/*! Clusterize.js - v0.0.2 - 2015-04-28
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed MIT */

;(function(f,b){"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define(b):this[f]=b()})("Clusterize",function(){var f=function(b){if(!(this instanceof f))return new f(b);var a=this,c={item_height:0,block_height:0,rows_in_block:50,rows_in_cluster:0,cluster_height:0,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,verify_change:!1};a.options={};"rows_in_block blocks_in_cluster verify_change show_no_data_row no_data_class no_data_text keep_parity tag".split(" ").forEach(function(h){a.options[h]=
"undefined"!=typeof b[h]&&null!=b[h]?b[h]:c[h]});a.scrollElem=document.getElementById(b.scrollId);a.contentElem=document.getElementById(b.contentId);var d=b.rows||[],e={data:""},l=a.scrollElem.scrollTop;a.calcClusterHeight(d);a.insertToDOM(d,e);a.scrollElem.scrollTop=l;var k=!1,g=function(){k!=(k=a.getClusterNum())&&a.insertToDOM(d,e)};a.scrollElem.addEventListener("scroll",g);a.destroy=function(b){a.scrollElem.removeEventListener("scroll",g);a.contentElem.innerHTML=b?a.generateEmptyRow().join(""):
d.join("")};a.update=function(b){d=a.isArray(b)?b:[];b=a.scrollElem.scrollTop;a.insertToDOM(d,e);a.scrollElem.scrollTop=b};a.append=function(b){b=a.isArray(b)?b:[];b.length&&(d=d.concat(b),a.insertToDOM(d,e))};a.clear=function(){a.update([])};a.getRowsAmount=function(){return d.length}};f.prototype={constructor:f,calcClusterHeight:function(b){var a=this.options;if(!a.item_height||!a.tag){if(!b.length)return;this.contentElem.innerHTML=b[0]+b[0]+b[0];b=this.contentElem.children[1];a.tag||(a.tag=b.tagName.toLowerCase());
a.item_height=b.offsetHeight}a.block_height=a.item_height*a.rows_in_block;a.rows_in_cluster=a.blocks_in_cluster*a.rows_in_block;a.cluster_height=a.blocks_in_cluster*a.block_height},getClusterNum:function(){var b=this.options;return Math.floor(this.scrollElem.scrollTop/(b.cluster_height-b.block_height))},generateEmptyRow:function(){var b=this.options;if(!b.tag||!b.show_no_data_row)return[];var a="<"+b.tag+' class="'+b.no_data_class+'">';switch(b.tag){case "tr":a+="<td>"+b.no_data_text+"</td>";break;
default:a+=b.no_data_text}a+="</"+b.tag+">";return[a]},generate:function(b,a){var c=this.options,d=b.length;if(!d)return this.generateEmptyRow();if(d<c.rows_in_block)return b;c.cluster_height||this.calcClusterHeight(b);var e=a*c.rows_in_cluster-c.rows_in_block*a,e=0<e?e:0,f=e+c.rows_in_cluster,k=e*c.item_height,d=(d-f)*c.item_height,g=[];0<k&&(c.keep_parity&&g.push("<"+c.tag+' class="clusterize-extra-row clusterize-keep-parity"></'+c.tag+">"),g.push("<"+c.tag+' class="clusterize-extra-row clusterize-top-space" style="height:'+
k+'px;"></'+c.tag+">"));for(;e<f;e++)b[e]&&g.push(b[e]);0<d&&g.push("<"+c.tag+' class="clusterize-extra-row clusterize-bottom-space" style="height:'+d+'px;"></'+c.tag+">");return g},insertToDOM:function(b,a){var c=this.generate(b,this.getClusterNum()).join("");if(!this.options.verify_change||this.options.verify_change&&this.dataChanged(c,a))this.contentElem.innerHTML=c},dataChanged:function(b,a){var c=JSON.stringify(b);return c!==a.data&&(a.data=c)},isArray:function(b){return"[object Array]"===Object.prototype.toString.call(b)}};
return f});