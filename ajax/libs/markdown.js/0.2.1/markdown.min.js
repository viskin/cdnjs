(function(F){var c=F.Markdown=function c(M){switch(typeof M){case"undefined":this.dialect=c.dialects.Gruber;break;case"object":this.dialect=M;break;default:if(M in c.dialects){this.dialect=c.dialects[M]}else{throw new Error("Unknown Markdown dialect '"+String(M)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};F.parse=function(O,M){var N=new c(M);return N.toTree(O)};F.toHTML=function r(O,N){var M=F.toHTMLTree(O,N);return F.renderJsonML(M)};F.toHTMLTree=function t(N,Q){if(typeof N==="string"){N=this.parse(N,Q)}var O=y(N),M={};if(O&&O.references){M=O.references}var P=f(N,M);m(P);return P};var d=c.mk_block=function(P,N,M){if(arguments.length==1){N="\n\n"}var O=new String(P);O.trailing=N;O.toSource=function(){return"Markdown.mk_block( "+uneval(P)+", "+uneval(N)+", "+uneval(M)+" )"};if(M!=undefined){O.lineNumber=M}return O};function C(N){var O=0,M=-1;while((M=N.indexOf("\n",M+1))!=-1){O++}return O}c.prototype.split_blocks=function w(O,R){var P=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,Q=[],M;var N=1;if((M=(/^(\s*\n)/)(O))!=null){N+=C(M[0]);P.lastIndex=M[0].length}while((M=P(O))!=null){Q.push(d(M[1],M[2],N));N+=C(M[0])}return Q};c.prototype.processBlock=function H(R,Q){var N=this.dialect.block,M=N.__order__;if("__call__" in N){return N.__call__.call(this,R,Q)}for(var P=0;P<M.length;P++){var O=N[M[P]].call(this,R,Q);if(O){if(!O instanceof Array||(O.length>0&&!(O[0] instanceof Array))){this.debug(M[P],"didn't return a proper array")}return O}}return[]};c.prototype.processInline=function e(M){return this.dialect.inline.__call__.call(this,String(M))};c.prototype.toTree=function D(O,N){var P=O instanceof Array?O:this.split_blocks(O);var Q=this.tree;try{this.tree=N||this.tree||["markdown"];P:while(P.length){var M=this.processBlock(P.shift(),P);if(!M.length){continue P}this.tree.push.apply(this.tree,M)}return this.tree}finally{if(N){this.tree=Q}}};c.prototype.debug=function(){var M=Array.prototype.slice.call(arguments);M.unshift(this.debug_indent);print.apply(print,M)};c.prototype.loop_re_over_block=function(P,Q,O){var N,M=Q.valueOf();while(M.length&&(N=P(M))!=null){M=M.substr(N[0].length);O.call(this,N)}return M};c.dialects={};c.dialects.Gruber={block:{atxHeader:function o(O,N){var M=O.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!M){return undefined}var P=["header",{level:M[1].length},M[2]];if(M[0].length<O.length){N.unshift(d(O.substr(M[0].length),O.trailing,O.lineNumber+2))}return[P]},setextHeader:function u(O,N){var M=O.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!M){return undefined}var Q=(M[2]==="=")?1:2;var P=["header",{level:Q},M[1]];if(M[0].length<O.length){N.unshift(d(O.substr(M[0].length),O.trailing,O.lineNumber+2))}return[P]},code:function h(S,R){var P=[],Q=/^(?: {0,3}\t| {4})(.*)\n?/,O;var N=S.match(Q);if(!N){return undefined}block_search:do{var M=this.loop_re_over_block(Q,S.valueOf(),function(T){P.push(T[1])});if(M.length){R.unshift(d(M,S.trailing));break block_search}else{if(R.length){var N=R[0].match(Q);if(!N){break block_search}P.push(S.trailing.replace(/[^\n]/g,"").substring(2));S=R.shift()}else{break block_search}}}while(true);return[["code_block",P.join("\n")]]},horizRule:function K(O,N){var M=O.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!M){return undefined}var P=[["hr"]];if(M[1]){P.unshift.apply(P,this.processBlock(M[1],[]))}if(M[3]){N.unshift(d(M[3]))}return P},lists:(function(){var P="[*+-]|\\d\\.",N=/[*+-]/,V=/\d+\./,T=new RegExp("^( {0,3})("+P+")[ \t]+"),O="(?: {0,3}\\t| {4})";function Q(W){return new RegExp("(?:^("+O+"{0,"+W+"} {0,3})("+P+")\\s+)|(^"+O+"{0,"+(W-1)+"}[ ]{0,4})")}function M(W){return W.replace(/ {0,3}\t/g,"    ")}function U(X,ad,ac,Y){if(ad){X.push(["para"].concat(ac));return}var W=X[X.length-1] instanceof Array&&X[X.length-1][0]=="para"?X[X.length-1]:X;if(Y&&X.length>1){ac.unshift(Y)}for(var aa=0;aa<ac.length;aa++){var ab=ac[aa],Z=typeof ab=="string";if(Z&&W.length>1&&typeof W[W.length-1]=="string"){W[W.length-1]+=ab}else{W.push(ab)}}}function R(ac,ab){var aa=new RegExp("^("+O+"{"+ac+"}.*?\\n?)*$"),Z=new RegExp("^"+O+"{"+ac+"}","gm"),Y=[];while(ab.length>0){if(aa(ab[0])){var X=ab.shift(),W=X.replace(Z,"");Y.push(d(W,X.trailing,X.lineNumber))}break}return Y}function S(Z,Y,W){var ab=Z.list;var aa=ab[ab.length-1];if(aa[1] instanceof Array&&aa[1][0]=="para"){return}if(Y+1==W.length){aa.push(["para"].concat(aa.splice(1)))}else{var X=aa.pop();aa.push(["para"].concat(aa.splice(1)),X)}}return function(ab,ah){var ai=ab.match(T);if(!ai){return undefined}function Z(aq){var ar=N(aq[2])?["bulletlist"]:["numberlist"];aa.push({list:ar,indent:aq[1]});return ar}var aa=[],al=Z(ai),Y,ag=false,ap=[aa[0].list];loose_search:while(true){var W=ab.split(/(?=\n)/);var am="";tight_search:for(var an=0;an<W.length;an++){var X="",aj=W[an].replace(/^\n/,function(aq){X=aq;return""});var ae=Q(aa.length);ai=aj.match(ae);if(ai[1]!==undefined){if(am.length){U(Y,ag,this.processInline(am),X);ag=false;am=""}ai[1]=M(ai[1]);var ac=Math.floor(ai[1].length/4)+1;if(ac>aa.length){al=Z(ai);Y.push(al);Y=al[1]=["listitem"]}else{var af=aa.some(function(ar,aq){if(ar.indent!=ai[1]){return false}al=ar.list;aa.splice(aq+1);return true});if(!af){ac++;if(ac<=aa.length){aa.splice(ac);al=aa[ac-1].list}else{al=Z(ai);Y.push(al)}}Y=["listitem"];al.push(Y)}X=""}if(aj.length>ai[0].length){am+=X+aj.substr(ai[0].length)}}if(am.length){U(Y,ag,this.processInline(am),X);ag=false;am=""}var ak=R(aa.length,ah);if(ak.length>0){aa.forEach(S,this);Y.push.apply(Y,this.toTree(ak,[]))}var ad=ah[0]&&ah[0].valueOf()||"";if(ad.match(T)||ad.match(/^ /)){ab=ah.shift();var ao=this.dialect.block.horizRule(ab,ah);if(ao){ap.push.apply(ap,ao);break}aa.forEach(S,this);ag=true;continue loose_search}break}return ap}})(),blockquote:function G(R,P){if(!R.match(/^>/m)){return undefined}var T=[];if(R[0]!=">"){var N=R.split(/\n/),Q=[];while(N.length&&N[0][0]!=">"){Q.push(N.shift())}R=N.join("\n");T.push.apply(T,this.processBlock(Q.join("\n"),[]))}while(P.length&&P[0][0]==">"){var M=P.shift();R+=R.trailing+M;R.trailing=M.trailing}var O=R.replace(/^> ?/gm,""),S=this.tree;T.push(this.toTree(O,["blockquote"]));return T},referenceDefn:function E(Q,P){var O=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!Q.match(O)){return undefined}if(!y(this.tree)){this.tree.splice(1,0,{})}var N=y(this.tree);if(N.references===undefined){N.references={}}var M=this.loop_re_over_block(O,Q,function(R){if(R[2]&&R[2][0]=="<"&&R[2][R[2].length-1]==">"){R[2]=R[2].substring(1,R[2].length-1)}var S=N.references[R[1].toLowerCase()]={href:R[2]};if(R[4]!==undefined){S.title=R[4]}else{if(R[5]!==undefined){S.title=R[5]}}});if(M.length){P.unshift(d(M,Q.trailing))}return[]},para:function z(N,M){return[["para"].concat(this.processInline(N))]}}};c.dialects.Gruber.inline={__call__:function n(S,M){var O=[],N,U=new RegExp("([\\s\\S]*?)("+(M.source||M)+")","g"),P=0;function T(V){if(typeof V=="string"&&typeof O[O.length-1]=="string"){O[O.length-1]+=V}else{O.push(V)}}while((N=U.exec(S))!=null){if(N[1]){T(N[1])}else{N[1]={length:0}}var R;if(N[2] in this.dialect.inline){R=this.dialect.inline[N[2]].call(this,S.substr(N.index+N[1].length),N,O)}R=R||[N[2].length,N[2]];var Q=R.shift();U.lastIndex+=(Q-N[2].length);R.forEach(T);P=U.lastIndex}if(S.length>P){T(S.substr(P))}return O},"\\":function q(M){if(M.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,M[1]]}else{return[1,"\\"]}},"![":function i(O){var M=O.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(M){if(M[2]&&M[2][0]=="<"&&M[2][M[2].length-1]==">"){M[2]=M[2].substring(1,M[2].length-1)}M[2]==this.dialect.inline.__call__.call(this,M[2],/\\/)[0];var N={alt:M[1],href:M[2]||""};if(M[4]!==undefined){N.title=M[4]}return[M[0].length,["img",N]]}M=O.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(M){return[M[0].length,["img_ref",{alt:M[1],ref:M[2].toLowerCase(),text:M[0]}]]}return[2,"!["]},"[":function j(O){var M=O.match(/^\[([\s\S]*?)\][ \t]*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(M){if(M[2]&&M[2][0]=="<"&&M[2][M[2].length-1]==">"){M[2]=M[2].substring(1,M[2].length-1)}M[2]=this.dialect.inline.__call__.call(this,M[2],/\\/)[0];var N={href:M[2]||""};if(M[4]!==undefined){N.title=M[4]}return[M[0].length,["link",N,M[1]]]}M=O.match(/^\[([\s\S]*?)\](?: ?\[(.*?)\])?/);if(M){if(M[2]===undefined||M[2]===""){M[2]=M[1]}return[M[0].length,["link_ref",{ref:M[2].toLowerCase(),original:M[0]},M[1]]]}return[1,"["]},"<":function s(N){var M;if((M=N.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(M[3]){return[M[0].length,["link",{href:"mailto:"+M[3]},M[3]]]}else{if(M[2]=="mailto"){return[M[0].length,["link",{href:M[1]},M[1].substr("mailto:".length)]]}else{return[M[0].length,["link",{href:M[1]},M[1]]]}}}return[1,"<"]},"`":function v(N){var M=N.match(/(`+)(([\s\S]*?)\1)/);if(M&&M[2]){return[M[1].length+M[2].length,["inlinecode",M[3]]]}else{return[1,"`"]}},"  \n":function J(M){return[3,["linebreak"]]}};function B(M,P){var O=M+"_state",Q=M=="strong"?"em_state":"strong_state";function N(R){this.len_after=R;this.name="close_"+P}return function(Y,X){if(this[O][0]==P){this[O].shift();return[Y.length,new N(Y.length-P.length)]}else{var R=this[Q].slice(),W=this[O].slice();this[O].unshift(P);var T=this.processInline(Y.substr(P.length));var U=T[T.length-1];var S=this[O].shift();if(U instanceof N){T.pop();var V=Y.length-U.len_after;return[V,[M].concat(T)]}else{this[Q]=R;this[O]=W;return[P.length,P]}}}}c.dialects.Gruber.inline["**"]=B("strong","**");c.dialects.Gruber.inline.__=B("strong","__");c.dialects.Gruber.inline["*"]=B("em","*");c.dialects.Gruber.inline._=B("em","_");c.buildBlockOrder=function(O){var M=[];for(var N in O){if(N=="__order__"||N=="__call__"){continue}M.push(N)}O.__order__=M};c.buildInlinePatterns=function(Q){var P=[];for(var N in Q){if(N=="__call__"){continue}var M=N.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");P.push(N.length==1?M:"(?:"+M+")")}P=P.join("|");var O=Q.__call__;Q.__call__=function(S,R){if(R!=undefined){return O.call(this,S,R)}else{return O.call(this,S,P)}}};c.subclassDialect=function(O){function M(){}M.prototype=O.block;function N(){}N.prototype=O.inline;return{block:new M(),inline:new N()}};c.buildBlockOrder(c.dialects.Gruber.block);c.buildInlinePatterns(c.dialects.Gruber.inline);c.dialects.Maruku=c.subclassDialect(c.dialects.Gruber);c.dialects.Maruku.block.document_meta=function g(R,O){if(R.lineNumber>1){return undefined}if(!R.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!y(this.tree)){this.tree.splice(1,0,{})}var Q=R.split(/\n/);for(p in Q){var M=Q[p].match(/(\w+):\s*(.*)$/),N=M[1].toLowerCase(),P=M[2];this.tree[1][N]=P}return[]};c.dialects.Maruku.block.block_meta=function A(T,Q){var P=T.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!P){return undefined}var O=k(P[2]);if(P[1]===""){var R=this.tree[this.tree.length-1],S=y(R);if(typeof R==="string"){return undefined}if(!S){S={};R.splice(1,0,S)}for(a in O){S[a]=O[a]}return[]}var N=T.replace(/\n.*$/,""),M=this.processBlock(N,[]);var S=y(M[0]);if(!S){S={};M[0].splice(1,0,S)}for(a in O){S[a]=O[a]}return M};c.dialects.Maruku.block.definition_list=function I(O,R){var T=/^((?:[^\s:].*\n)+):\s+([^]+)$/,S=["dl"];if((N=O.match(T))){var M=[O];while(R.length&&T.exec(R[0])){M.push(R.shift())}for(var U=0;U<M.length;++U){var N=M[U].match(T),Q=N[1].replace(/\n$/,"").split(/\n/),V=N[2].split(/\n:\s+/);for(var P=0;P<Q.length;++P){S.push(["dt",Q[P]])}for(var P=0;P<V.length;++P){S.push(["dd"].concat(this.processInline(V[P].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[S]};c.dialects.Maruku.inline["{:"]=function x(T,R,P){if(!P.length){return[2,"{:"]}var Q=P[P.length-1];if(typeof Q==="string"){return[2,"{:"]}var N=T.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!N){return[2,"{:"]}var S=k(N[1]),M=y(Q);if(!M){M={};Q.splice(1,0,M)}for(var O in S){M[O]=S[O]}return[N[0].length,""]};c.buildBlockOrder(c.dialects.Maruku.block);c.buildInlinePatterns(c.dialects.Maruku.inline);function y(M){return M instanceof Array&&M.length>1&&typeof M[1]==="object"&&!(M[1] instanceof Array)?M[1]:undefined}function k(P){var Q=l(P),M={};for(var N=0;N<Q.length;++N){if(/^#/.test(Q[N])){M.id=Q[N].substring(1)}else{if(/^\./.test(Q[N])){if(M["class"]){M["class"]=M["class"]+Q[N].replace(/./," ")}else{M["class"]=Q[N].substring(1)}}else{if(/=/.test(Q[N])){var O=Q[N].split(/=/);M[O[0]]=O[1]}}}}return M}function l(O){var Q=O.split(""),P=[""],M=false;while(Q.length){var N=Q.shift();switch(N){case" ":if(M){P[P.length-1]+=N}else{P.push("")}break;case"'":case'"':M=!M;break;case"\\":N=Q.shift();default:P[P.length-1]+=N;break}}return P}F.renderJsonML=function(O,M){M=M||{};M.root=M.root||false;var N=[];if(M.root){N.push(L(O))}else{O.shift();if(O.length&&typeof O[0]==="object"&&!(O[0] instanceof Array)){O.shift()}while(O.length){N.push(L(O.shift()))}}return N.join("\n\n")};function b(M){return M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function L(R){if(typeof R==="string"){return b(R)}var M=R.shift(),O={},P=[];if(R.length&&typeof R[0]==="object"&&!(R[0] instanceof Array)){O=R.shift()}while(R.length){P.push(arguments.callee(R.shift()))}var Q="";for(var N in O){Q+=" "+N+'="'+b(O[N])+'"'}return"<"+M+Q+">"+P.join("")+"</"+M+">"}function f(M,Q){var T=M.slice(0);var N=y(T);if(N){T[1]={};for(var P in N){T[1][P]=N[P]}N=T[1]}if(typeof T==="string"){return T}switch(T[0]){case"header":T[0]="h"+T[1].level;delete T[1].level;break;case"bulletlist":T[0]="ul";break;case"numberlist":T[0]="ol";break;case"listitem":T[0]="li";break;case"para":T[0]="p";break;case"markdown":T[0]="html";if(N){delete N.references}break;case"code_block":T[0]="pre";var P=N?2:1;var S=["code"];S.push.apply(S,T.splice(P));T[P]=S;break;case"inlinecode":T[0]="code";break;case"img":T[1].src=T[1].href;delete T[1].href;break;case"linebreak":T[0]="br";break;case"link":T[0]="a";break;case"link_ref":T[0]="a";var R=Q[N.ref];if(R){delete N.ref;N.href=R.href;if(R.title){N.title=R.title}delete N.original}else{return N.original}break}var P=1;if(N){for(var O in T[1]){P=2}if(P===1){T.splice(P,1)}}for(;P<T.length;++P){T[P]=arguments.callee(T[P],Q)}return T}function m(N){var M=y(N)?2:1;while(M<N.length){if(typeof N[M]==="string"){if(M+1<N.length&&typeof N[M+1]==="string"){N[M]+=N.splice(M+1,1)[0]}else{++M}}else{arguments.callee(N[M]);++M}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());