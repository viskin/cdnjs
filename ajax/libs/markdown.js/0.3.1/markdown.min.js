(function(G){var c=G.Markdown=function c(N){switch(typeof N){case"undefined":this.dialect=c.dialects.Gruber;break;case"object":this.dialect=N;break;default:if(N in c.dialects){this.dialect=c.dialects[N]}else{throw new Error("Unknown Markdown dialect '"+String(N)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};G.parse=function(P,N){var O=new c(N);return O.toTree(P)};G.toHTML=function r(Q,P,O){var N=G.toHTMLTree(Q,P,O);return G.renderJsonML(N)};G.toHTMLTree=function t(O,S,Q){if(typeof O==="string"){O=this.parse(O,S)}var P=z(O),N={};if(P&&P.references){N=P.references}var R=f(O,N,Q);m(R);return R};var d=c.mk_block=function(Q,O,N){if(arguments.length==1){O="\n\n"}var P=new String(Q);P.trailing=O;P.toSource=function(){return"Markdown.mk_block( "+uneval(Q)+", "+uneval(O)+", "+uneval(N)+" )"};if(N!=undefined){P.lineNumber=N}return P};function D(O){var P=0,N=-1;while((N=O.indexOf("\n",N+1))!=-1){P++}return P}c.prototype.split_blocks=function w(P,S){var Q=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,R=[],N;var O=1;if((N=/^(\s*\n)/.exec(P))!=null){O+=D(N[0]);Q.lastIndex=N[0].length}while((N=Q.exec(P))!=null){R.push(d(N[1],N[2],O));O+=D(N[0])}return R};c.prototype.processBlock=function I(S,R){var O=this.dialect.block,N=O.__order__;if("__call__" in O){return O.__call__.call(this,S,R)}for(var Q=0;Q<N.length;Q++){var P=O[N[Q]].call(this,S,R);if(P){if(!x(P)||(P.length>0&&!(x(P[0])))){this.debug(N[Q],"didn't return a proper array")}return P}}return[]};c.prototype.processInline=function e(N){return this.dialect.inline.__call__.call(this,String(N))};c.prototype.toTree=function E(P,O){var Q=P instanceof Array?P:this.split_blocks(P);var R=this.tree;try{this.tree=O||this.tree||["markdown"];Q:while(Q.length){var N=this.processBlock(Q.shift(),Q);if(!N.length){continue Q}this.tree.push.apply(this.tree,N)}return this.tree}finally{if(O){this.tree=R}}};c.prototype.debug=function(){var N=Array.prototype.slice.call(arguments);N.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,N)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,N)}};c.prototype.loop_re_over_block=function(Q,R,P){var O,N=R.valueOf();while(N.length&&(O=Q.exec(N))!=null){N=N.substr(O[0].length);P.call(this,O)}return N};c.dialects={};c.dialects.Gruber={block:{atxHeader:function o(P,O){var N=P.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!N){return undefined}var Q=["header",{level:N[1].length}];Array.prototype.push.apply(Q,this.processInline(N[2]));if(N[0].length<P.length){O.unshift(d(P.substr(N[0].length),P.trailing,P.lineNumber+2))}return[Q]},setextHeader:function u(P,O){var N=P.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!N){return undefined}var R=(N[2]==="=")?1:2;var Q=["header",{level:R},N[1]];if(N[0].length<P.length){O.unshift(d(P.substr(N[0].length),P.trailing,P.lineNumber+2))}return[Q]},code:function h(T,S){var Q=[],R=/^(?: {0,3}\t| {4})(.*)\n?/,P;var O=T.match(R);if(!O){return undefined}block_search:do{var N=this.loop_re_over_block(R,T.valueOf(),function(U){Q.push(U[1])});if(N.length){S.unshift(d(N,T.trailing));break block_search}else{if(S.length){var O=S[0].match(R);if(!O){break block_search}Q.push(T.trailing.replace(/[^\n]/g,"").substring(2));T=S.shift()}else{break block_search}}}while(true);return[["code_block",Q.join("\n")]]},horizRule:function L(P,O){var N=P.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!N){return undefined}var Q=[["hr"]];if(N[1]){Q.unshift.apply(Q,this.processBlock(N[1],[]))}if(N[3]){O.unshift(d(N[3]))}return Q},lists:(function(){var Q="[*+-]|\\d\\.",O=/[*+-]/,W=/\d+\./,U=new RegExp("^( {0,3})("+Q+")[ \t]+"),P="(?: {0,3}\\t| {4})";function R(X){return new RegExp("(?:^("+P+"{0,"+X+"} {0,3})("+Q+")\\s+)|(^"+P+"{0,"+(X-1)+"}[ ]{0,4})")}function N(X){return X.replace(/ {0,3}\t/g,"    ")}function V(Y,ae,ad,Z){if(ae){Y.push(["para"].concat(ad));return}var X=Y[Y.length-1] instanceof Array&&Y[Y.length-1][0]=="para"?Y[Y.length-1]:Y;if(Z&&Y.length>1){ad.unshift(Z)}for(var ab=0;ab<ad.length;ab++){var ac=ad[ab],aa=typeof ac=="string";if(aa&&X.length>1&&typeof X[X.length-1]=="string"){X[X.length-1]+=ac}else{X.push(ac)}}}function S(ad,ac){var ab=new RegExp("^("+P+"{"+ad+"}.*?\\n?)*$"),aa=new RegExp("^"+P+"{"+ad+"}","gm"),Z=[];while(ac.length>0){if(ab.exec(ac[0])){var Y=ac.shift(),X=Y.replace(aa,"");Z.push(d(X,Y.trailing,Y.lineNumber))}break}return Z}function T(aa,Z,X){var ac=aa.list;var ab=ac[ac.length-1];if(ab[1] instanceof Array&&ab[1][0]=="para"){return}if(Z+1==X.length){ab.push(["para"].concat(ab.splice(1)))}else{var Y=ab.pop();ab.push(["para"].concat(ab.splice(1)),Y)}}return function(ac,ai){var aj=ac.match(U);if(!aj){return undefined}function aa(ar){var at=O.exec(ar[2])?["bulletlist"]:["numberlist"];ab.push({list:at,indent:ar[1]});return at}var ab=[],am=aa(aj),Z,ah=false,aq=[ab[0].list];loose_search:while(true){var X=ac.split(/(?=\n)/);var an="";tight_search:for(var ao=0;ao<X.length;ao++){var Y="",ak=X[ao].replace(/^\n/,function(ar){Y=ar;return""});var af=R(ab.length);aj=ak.match(af);if(aj[1]!==undefined){if(an.length){V(Z,ah,this.processInline(an),Y);ah=false;an=""}aj[1]=N(aj[1]);var ad=Math.floor(aj[1].length/4)+1;if(ad>ab.length){am=aa(aj);Z.push(am);Z=am[1]=["listitem"]}else{var ag=ab.some(function(at,ar){if(at.indent!=aj[1]){return false}am=at.list;ab.splice(ar+1);return true});if(!ag){ad++;if(ad<=ab.length){ab.splice(ad);am=ab[ad-1].list}else{am=aa(aj);Z.push(am)}}Z=["listitem"];am.push(Z)}Y=""}if(ak.length>aj[0].length){an+=Y+ak.substr(aj[0].length)}}if(an.length){V(Z,ah,this.processInline(an),Y);ah=false;an=""}var al=S(ab.length,ai);if(al.length>0){ab.forEach(T,this);Z.push.apply(Z,this.toTree(al,[]))}var ae=ai[0]&&ai[0].valueOf()||"";if(ae.match(U)||ae.match(/^ /)){ac=ai.shift();var ap=this.dialect.block.horizRule(ac,ai);if(ap){aq.push.apply(aq,ap);break}ab.forEach(T,this);ah=true;continue loose_search}break}return aq}})(),blockquote:function H(S,Q){if(!S.match(/^>/m)){return undefined}var U=[];if(S[0]!=">"){var O=S.split(/\n/),R=[];while(O.length&&O[0][0]!=">"){R.push(O.shift())}S=O.join("\n");U.push.apply(U,this.processBlock(R.join("\n"),[]))}while(Q.length&&Q[0][0]==">"){var N=Q.shift();S+=S.trailing+N;S.trailing=N.trailing}var P=S.replace(/^> ?/gm,""),T=this.tree;U.push(this.toTree(P,["blockquote"]));return U},referenceDefn:function F(R,Q){var P=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!R.match(P)){return undefined}if(!z(this.tree)){this.tree.splice(1,0,{})}var O=z(this.tree);if(O.references===undefined){O.references={}}var N=this.loop_re_over_block(P,R,function(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}var T=O.references[S[1].toLowerCase()]={href:S[2]};if(S[4]!==undefined){T.title=S[4]}else{if(S[5]!==undefined){T.title=S[5]}}});if(N.length){Q.unshift(d(N,R.trailing))}return[]},para:function A(O,N){return[["para"].concat(this.processInline(O))]}}};c.dialects.Gruber.inline={__call__:function n(T,N){var P=[],O,V=new RegExp("([\\s\\S]*?)("+(N.source||N)+")","g"),Q=0;function U(W){if(typeof W=="string"&&typeof P[P.length-1]=="string"){P[P.length-1]+=W}else{P.push(W)}}while((O=V.exec(T))!=null){if(O[1]){U(O[1])}else{O[1]={length:0}}var S;if(O[2] in this.dialect.inline){S=this.dialect.inline[O[2]].call(this,T.substr(O.index+O[1].length),O,P)}S=S||[O[2].length,O[2]];var R=S.shift();V.lastIndex+=(R-O[2].length);S.forEach(U);Q=V.lastIndex}if(T.length>Q){U(T.substr(Q))}return P},"\\":function q(N){if(N.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,N[1]]}else{return[1,"\\"]}},"![":function i(P){var N=P.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(N){if(N[2]&&N[2][0]=="<"&&N[2][N[2].length-1]==">"){N[2]=N[2].substring(1,N[2].length-1)}N[2]==this.dialect.inline.__call__.call(this,N[2],/\\/)[0];var O={alt:N[1],href:N[2]||""};if(N[4]!==undefined){O.title=N[4]}return[N[0].length,["img",O]]}N=P.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(N){return[N[0].length,["img_ref",{alt:N[1],ref:N[2].toLowerCase(),text:N[0]}]]}return[2,"!["]},"[":function j(Q){var N=Q.match(/^\[([\s\S]*?)\][ \t]*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(N){if(N[2]&&N[2][0]=="<"&&N[2][N[2].length-1]==">"){N[2]=N[2].substring(1,N[2].length-1)}N[2]=this.dialect.inline.__call__.call(this,N[2],/\\/)[0];var O={href:N[2]||""};if(N[4]!==undefined){O.title=N[4]}var P=["link",O];Array.prototype.push.apply(P,this.processInline(N[1]));return[N[0].length,P]}N=Q.match(/^\[([\s\S]*?)\](?: ?\[(.*?)\])?/);if(N){if(N[2]===undefined||N[2]===""){N[2]=N[1]}O={ref:N[2].toLowerCase(),original:N[0]};P=["link_ref",O];Array.prototype.push.apply(P,this.processInline(N[1]));return[N[0].length,P]}return[1,"["]},"<":function s(O){var N;if((N=O.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(N[3]){return[N[0].length,["link",{href:"mailto:"+N[3]},N[3]]]}else{if(N[2]=="mailto"){return[N[0].length,["link",{href:N[1]},N[1].substr("mailto:".length)]]}else{return[N[0].length,["link",{href:N[1]},N[1]]]}}}return[1,"<"]},"`":function v(O){var N=O.match(/(`+)(([\s\S]*?)\1)/);if(N&&N[2]){return[N[1].length+N[2].length,["inlinecode",N[3]]]}else{return[1,"`"]}},"  \n":function K(N){return[3,["linebreak"]]}};function C(N,Q){var P=N+"_state",R=N=="strong"?"em_state":"strong_state";function O(S){this.len_after=S;this.name="close_"+Q}return function(Z,Y){if(this[P][0]==Q){this[P].shift();return[Z.length,new O(Z.length-Q.length)]}else{var S=this[R].slice(),X=this[P].slice();this[P].unshift(Q);var U=this.processInline(Z.substr(Q.length));var V=U[U.length-1];var T=this[P].shift();if(V instanceof O){U.pop();var W=Z.length-V.len_after;return[W,[N].concat(U)]}else{this[R]=S;this[P]=X;return[Q.length,Q]}}}}c.dialects.Gruber.inline["**"]=C("strong","**");c.dialects.Gruber.inline.__=C("strong","__");c.dialects.Gruber.inline["*"]=C("em","*");c.dialects.Gruber.inline._=C("em","_");c.buildBlockOrder=function(P){var N=[];for(var O in P){if(O=="__order__"||O=="__call__"){continue}N.push(O)}P.__order__=N};c.buildInlinePatterns=function(R){var Q=[];for(var O in R){if(O=="__call__"){continue}var N=O.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");Q.push(O.length==1?N:"(?:"+N+")")}Q=Q.join("|");var P=R.__call__;R.__call__=function(T,S){if(S!=undefined){return P.call(this,T,S)}else{return P.call(this,T,Q)}}};c.subclassDialect=function(P){function N(){}N.prototype=P.block;function O(){}O.prototype=P.inline;return{block:new N(),inline:new O()}};c.buildBlockOrder(c.dialects.Gruber.block);c.buildInlinePatterns(c.dialects.Gruber.inline);c.dialects.Maruku=c.subclassDialect(c.dialects.Gruber);c.dialects.Maruku.block.document_meta=function g(S,P){if(S.lineNumber>1){return undefined}if(!S.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!z(this.tree)){this.tree.splice(1,0,{})}var R=S.split(/\n/);for(p in R){var N=R[p].match(/(\w+):\s*(.*)$/),O=N[1].toLowerCase(),Q=N[2];this.tree[1][O]=Q}return[]};c.dialects.Maruku.block.block_meta=function B(U,R){var Q=U.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!Q){return undefined}var P=k(Q[2]);if(Q[1]===""){var S=this.tree[this.tree.length-1],T=z(S);if(typeof S==="string"){return undefined}if(!T){T={};S.splice(1,0,T)}for(a in P){T[a]=P[a]}return[]}var O=U.replace(/\n.*$/,""),N=this.processBlock(O,[]);var T=z(N[0]);if(!T){T={};N[0].splice(1,0,T)}for(a in P){T[a]=P[a]}return N};c.dialects.Maruku.block.definition_list=function J(P,S){var U=/^((?:[^\s:].*\n)+):\s+([^]+)$/,T=["dl"];if((O=P.match(U))){var N=[P];while(S.length&&U.exec(S[0])){N.push(S.shift())}for(var V=0;V<N.length;++V){var O=N[V].match(U),R=O[1].replace(/\n$/,"").split(/\n/),W=O[2].split(/\n:\s+/);for(var Q=0;Q<R.length;++Q){T.push(["dt",R[Q]])}for(var Q=0;Q<W.length;++Q){T.push(["dd"].concat(this.processInline(W[Q].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[T]};c.dialects.Maruku.inline["{:"]=function y(U,S,Q){if(!Q.length){return[2,"{:"]}var R=Q[Q.length-1];if(typeof R==="string"){return[2,"{:"]}var O=U.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!O){return[2,"{:"]}var T=k(O[1]),N=z(R);if(!N){N={};R.splice(1,0,N)}for(var P in T){N[P]=T[P]}return[O[0].length,""]};c.buildBlockOrder(c.dialects.Maruku.block);c.buildInlinePatterns(c.dialects.Maruku.inline);var x=G.isArray=function(N){return(N instanceof Array||typeof N==="array"||Array.isArray(N))};function z(N){return x(N)&&N.length>1&&typeof N[1]==="object"&&!(x(N[1]))?N[1]:undefined}function k(Q){var R=l(Q),N={};for(var O=0;O<R.length;++O){if(/^#/.test(R[O])){N.id=R[O].substring(1)}else{if(/^\./.test(R[O])){if(N["class"]){N["class"]=N["class"]+R[O].replace(/./," ")}else{N["class"]=R[O].substring(1)}}else{if(/=/.test(R[O])){var P=R[O].split(/=/);N[P[0]]=P[1]}}}}return N}function l(P){var R=P.split(""),Q=[""],N=false;while(R.length){var O=R.shift();switch(O){case" ":if(N){Q[Q.length-1]+=O}else{Q.push("")}break;case"'":case'"':N=!N;break;case"\\":O=R.shift();default:Q[Q.length-1]+=O;break}}return Q}G.renderJsonML=function(P,N){N=N||{};N.root=N.root||false;var O=[];if(N.root){O.push(M(P))}else{P.shift();if(P.length&&typeof P[0]==="object"&&!(P[0] instanceof Array)){P.shift()}while(P.length){O.push(M(P.shift()))}}return O.join("\n\n")};function b(N){return N.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function M(S){if(typeof S==="string"){return b(S)}var N=S.shift(),P={},Q=[];if(S.length&&typeof S[0]==="object"&&!(S[0] instanceof Array)){P=S.shift()}while(S.length){Q.push(arguments.callee(S.shift()))}var R="";for(var O in P){R+=" "+O+'="'+b(P[O])+'"'}return"<"+N+R+">"+Q.join("")+"</"+N+">"}function f(V,S,U){U=U||{};var R=V.slice(0);if(typeof U.preprocessTreeNode==="function"){R=U.preprocessTreeNode(R,S)}var T=z(R);if(T){R[1]={};for(var P in T){R[1][P]=T[P]}T=R[1]}if(typeof R==="string"){return R}switch(R[0]){case"header":R[0]="h"+R[1].level;delete R[1].level;break;case"bulletlist":R[0]="ul";break;case"numberlist":R[0]="ol";break;case"listitem":R[0]="li";break;case"para":R[0]="p";break;case"markdown":R[0]="html";if(T){delete T.references}break;case"code_block":R[0]="pre";var P=T?2:1;var N=["code"];N.push.apply(N,R.splice(P));R[P]=N;break;case"inlinecode":R[0]="code";break;case"img":R[1].src=R[1].href;delete R[1].href;break;case"linebreak":R[0]="br";break;case"link":R[0]="a";break;case"link_ref":R[0]="a";var O=S[T.ref];if(O){delete T.ref;T.href=O.href;if(O.title){T.title=O.title}delete T.original}else{return T.original}break}var P=1;if(T){for(var Q in R[1]){P=2}if(P===1){R.splice(P,1)}}for(;P<R.length;++P){R[P]=arguments.callee(R[P],S,U)}return R}function m(O){var N=z(O)?2:1;while(N<O.length){if(typeof O[N]==="string"){if(N+1<O.length&&typeof O[N+1]==="string"){O[N]+=O.splice(N+1,1)[0]}else{++N}}else{arguments.callee(O[N]);++N}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());