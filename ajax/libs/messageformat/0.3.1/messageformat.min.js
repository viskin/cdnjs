function propname(t,e){if(/^[A-Z_$][0-9A-Z_$]*$/i.test(t)&&["break","continue","delete","else","for","function","if","in","new","return","this","typeof","var","void","while","with","case","catch","default","do","finally","instanceof","switch","throw","try"].indexOf(t)<0)return e?e+"."+t:t;var r=JSON.stringify(t);return e?e+"["+r+"]":r}function bidiMarkText(t,e){function r(t){var e=["ar","ckb","fa","he","ks($|[^bfh])","lrc","mzn","pa-Arab","ps","ug","ur","uz-Arab","yi"];return new RegExp("^"+e.join("|^")).test(t)}var n=JSON.stringify(r(e)?"‏":"‎");return n+" + "+t+" + "+n}function MessageFormat(t,e,r){if(t)if("string"==typeof t){this.lc=[];for(var n=t;n;n=n.replace(/[-_]?[^-_]*$/,""))this.lc.push(n)}else this.lc=t;else this.lc=["en"];if(!e&&this.lc.every(function(t){return e=MessageFormat.plurals[t],!e}))throw new Error("Plural function for locale `"+this.lc.join(",")+"` not found");this.runtime=new Runtime(this.lc[0],e,r)}function Runtime(t,e,r){if(this.pluralFuncs={},this.pluralFuncs[t]=e,this.fmt={},r)for(var n in r)this.fmt[n]=r[n]}module.exports=MessageFormat,MessageFormat._parse=require("./messageformat-parser").parse,MessageFormat.plurals=require("make-plural/plurals"),MessageFormat.formatters={number:function(t){return new Function("v,lc,p","return Intl.NumberFormat(lc,\n    p=='integer' ? {maximumFractionDigits:0}\n  : p=='percent' ? {style:'percent'}\n  : p=='currency' ? {style:'currency', currency:'"+(t.currency||"USD")+"', minimumFractionDigits:2, maximumFractionDigits:2}\n  : {}).format(v)")},date:function(t,e,r){var n={day:"numeric",month:"short",year:"numeric"};switch(r){case"full":n.weekday="long";case"long":n.month="long";break;case"short":n.month="numeric"}return new Date(t).toLocaleDateString(e,n)},time:function(t,e,r){var n={second:"numeric",minute:"numeric",hour:"numeric"};switch(r){case"full":case"long":n.timeZoneName="short";break;case"short":delete n.minute}return new Date(t).toLocaleTimeString(e,n)}},MessageFormat.prototype.setBiDiSupport=function(t){return this.bidiSupport=!!t||"undefined"==typeof t,this},MessageFormat.prototype.setIntlSupport=function(t){return this.withIntlSupport=!!t||"undefined"==typeof t,this},Runtime.prototype={number:function(t,e){if(isNaN(t))throw new Error("'"+t+"' isn't a number.");return t-(e||0)},plural:function(t,e,r,n,o){if({}.hasOwnProperty.call(n,t))return n[t]();e&&(t-=e);var i=r(t,o);return i in n?n[i]():n.other()},select:function(t,e){return{}.hasOwnProperty.call(e,t)?e[t]():e.other()},toString:function(){var t=function(e,r){if("object"!=typeof e){var n=e.toString().replace(/^(function )\w*/,"$1"),o=/([ \t]*)\S.*$/.exec(n);return o?n.replace(new RegExp("^"+o[1],"mg"),""):n}var i=[];for(var a in e)"toString"!=a&&(0==r?i.push("var "+a+" = "+t(e[a],r+1)+";\n"):i.push(propname(a)+": "+t(e[a],r+1)));if(0==r)return i.join("");if(0==i.length)return"{}";for(var o="  ";--r;)o+="  ";return"{\n"+i.join(",\n").replace(/^/gm,o)+"\n}"};return t(this,0)}},MessageFormat.prototype._precompile=function(t,e){e=e||{keys:{},offset:{}};var r,n,o=[],i=[];switch(t.type){case"messageFormatPattern":for(r=0;r<t.statements.length;++r)o.push(this._precompile(t.statements[r],e));return n=o.join(" + ")||'""',e.pf_count?n:"function(d) { return "+n+"; }";case"messageFormatElement":if(e.pf_count=e.pf_count||0,t.output){var a=propname(t.argumentIndex,"d");return this.bidiSupport?bidiMarkText(a,this.lc):a}return e.keys[e.pf_count]=t.argumentIndex,this._precompile(t.elementFormat,e);case"elementFormat":switch(i=[propname(e.keys[e.pf_count],"d")],t.key){case"select":return i.push(this._precompile(t.val,e)),"select("+i.join(", ")+")";case"selectordinal":return i=i.concat([0,propname(this.lc[0],"pluralFuncs"),this._precompile(t.val,e),1]),"plural("+i.join(", ")+")";case"plural":return e.offset[e.pf_count||0]=t.val.offset||0,i=i.concat([e.offset[e.pf_count]||0,propname(this.lc[0],"pluralFuncs"),this._precompile(t.val,e)]),"plural("+i.join(", ")+")";default:return this.withIntlSupport&&!(t.key in this.runtime.fmt)&&t.key in MessageFormat.formatters&&(n=MessageFormat.formatters[t.key],this.runtime.fmt[t.key]="function"==typeof n(this)?n(this):n),i.push(JSON.stringify(this.lc)),t.val&&t.val.length&&i.push(JSON.stringify(1==t.val.length?t.val[0]:t.val)),"fmt."+t.key+"("+i.join(", ")+")"}case"pluralFormatPattern":case"selectFormatPattern":e.pf_count=e.pf_count||0,"selectFormatPattern"==t.type&&(e.offset[e.pf_count]=0);var s=!0;for(r=0;r<t.pluralForms.length;++r){var u=t.pluralForms[r].key;"other"===u&&(s=!1);var c=JSON.parse(JSON.stringify(e));c.pf_count++,o.push(propname(u)+": function() { return "+this._precompile(t.pluralForms[r].val,c)+";}")}if(s)throw new Error("No 'other' form found in "+t.type+" "+e.pf_count);return"{ "+o.join(", ")+" }";case"string":return JSON.stringify(t.val||"");case"octothorpe":return e.pf_count?(i=[propname(e.keys[e.pf_count-1],"d")],e.offset[e.pf_count-1]&&i.push(e.offset[e.pf_count-1]),"number("+i.join(", ")+")"):'"#"';default:throw new Error("Bad AST type: "+t.type)}},MessageFormat.prototype.compile=function(t,e){var r={},n=this.lc,o=function(t,e){try{var r=MessageFormat._parse(e);return t._precompile(r)}catch(n){throw new Error((r?"Precompiler":"Parser")+" error: "+n.toString())}},i=function(t,e){if(e||(e=0),"object"!=typeof t)return t;for(var r=[],n="",o=0;e>o;++o)n+="  ";for(var a in t)r.push("\n"+n+"  "+propname(a)+": "+i(t[a],e+1));return"{"+r.join(",")+"\n"+n+"}"};if("string"==typeof t){var a=new Function("number, plural, select, pluralFuncs, fmt","return "+o(this,t));return a(this.runtime.number,this.runtime.plural,this.runtime.select,this.runtime.pluralFuncs,this.runtime.fmt)}e=e||{};for(var s in t)if(e.locale&&(this.lc=e.locale[s]&&[].concat(e.locale[s])||n),"string"==typeof t[s])try{r[s]=o(this,t[s])}catch(u){throw u.message=u.message.replace(":"," with `"+s+"`:"),u}else{r[s]={};for(var c in t[s])try{r[s][c]=o(this,t[s][c])}catch(u){throw u.message=u.message.replace(":"," with `"+c+"` in `"+s+"`:"),u}}this.lc=n;var p=this.runtime.toString()+"\n";switch(e.global||""){case"exports":var l=[];for(var f in r)l.push(propname(f,"exports")+" = "+i(r[f]));return new Function(p+l.join(";\n"));case"module.exports":return new Function(p+"module.exports = "+i(r));case"":return new Function(p+"return "+i(r));default:return new Function("G",p+propname(e.global,"G")+" = "+i(r))}};