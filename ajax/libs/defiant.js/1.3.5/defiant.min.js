/*
 * defiant.js [v1.3.4]
 * http://www.defiantjs.com 
 * Copyright (c) 2013-2015, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the MIT License
 */
if("undefined"==typeof module)var module={exports:void 0};module.exports=Defiant=function(e,t){"use strict";var r={is_ie:/(msie|trident)/i.test(navigator.userAgent),is_safari:/safari/i.test(navigator.userAgent),env:"production",xml_decl:'<?xml version="1.0" encoding="utf-8"?>',namespace:'xmlns:d="defiant-namespace"',tabsize:4,render:function(e,t){var r,s,a,n,i=new XSLTProcessor,o=document.createElement("span"),l={match:"/"};switch(typeof e){case"object":this.extend(l,e),l.data||(l.data=t);break;case"string":l.template=e,l.data=t;break;default:throw"error"}if(l.data=JSON.toXML(l.data),r='//xsl:template[@name="'+l.template+'"]',this.xsl_template||this.gatherTemplates(),l.sorter&&(n=this.node.selectSingleNode(this.xsl_template,r+"//xsl:for-each//xsl:sort"),n&&(l.sorter.order&&n.setAttribute("order",l.sorter.order),l.sorter.select&&n.setAttribute("select",l.sorter.select),n.setAttribute("data-type",l.sorter.type||"text"))),a=this.node.selectSingleNode(this.xsl_template,r),a.setAttribute("match",l.match),i.importStylesheet(this.xsl_template),o.appendChild(i.transformToFragment(l.data,document)),a.removeAttribute("match"),this.is_safari){s=o.getElementsByTagName("script");for(var m=0,c=s.length;c>m;m++)s[m].defer=!0}return o.innerHTML},gatherTemplates:function(){for(var e=document.getElementsByTagName("script"),t="",r=0,s=e.length;s>r;r++)"defiant/xsl-template"===e[r].type&&(t+=e[r].innerHTML);this.xsl_template=this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" '+this.namespace+">"+t.replace(/defiant:(\w+)/g,"$1")+"</xsl:stylesheet>")},getSnapshot:function(e,t){return JSON.toXML(e,t||!0)},xmlFromString:function(e){var t,r;return e=e.replace(/>\s{1,}</g,"><"),null===e.trim().match(/<\?xml/)&&(e=this.xml_decl+e),this.is_ie?(r=new ActiveXObject("Msxml2.DOMDocument"),r.loadXML(e),-1===e.indexOf("xsl:stylesheet")&&r.setProperty("SelectionLanguage","XPath")):(t=new DOMParser,r=t.parseFromString(e,"text/xml")),r},extend:function(e,t){for(var r in t)e[r]&&"object"==typeof t[r]?this.extend(e[r],t[r]):e[r]=t[r];return e},node:{}};return r}(this);