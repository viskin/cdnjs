!function(){"Use Strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(e,a){var n=[],r=e.children();return r.length&&angular.forEach(r,function(e){n=n.concat(t(angular.element(e),a))}),void 0!==e.attr(a)&&n.push(e),n}function a(t,a){if(!t||""===t||g.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(a.display&&(""===a.display||!e(a.display))||!a.display&&!a.buttontext&&!a.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';g[t]=a}var n=!1;/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(document.addEventListener("click",function(e){var t=e||window.event,a=t.target;if(n&&null!==a){for(var r=!1,o=a;null!==o&&"html"!==o.tagName.toLowerCase()&&!r;)r="true"===o.contentEditable,o=o.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),a.focus())}n=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000px; left: -10000px;" unselectable="on" tabIndex="-1">'))}));var r=function(){var e,t=-1,a=window.navigator.userAgent,n=a.indexOf("MSIE "),r=a.indexOf("Trident/");if(n>0)t=parseInt(a.substring(n+5,a.indexOf(".",n)),10);else if(r>0){var o=a.indexOf("rv:");t=parseInt(a.substring(o+3,a.indexOf(".",o)),10)}return t>-1?t:e}();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o,l,i,s,d;if(r>8||void 0===r){for(var u,c=document.styleSheets,p=0;p<c.length;p++)if((0===c[p].media.length||c[p].media.mediaText.match(/(all|screen)/gi))&&c[p].href){if(c[p].href.match(/textangular\.(min\.|)css/gi)){o=c[p];break}u=c[p]}!o&&u?o=u:o||(o=function(){var e=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}()),l=function(e,t){s(o,e,t)},s=function(e,t,a){var n;return e.rules?n=Math.max(e.rules.length-1,0):e.cssRules&&(n=Math.max(e.cssRules.length-1,0)),e.insertRule?e.insertRule(t+"{"+a+"}",n):e.addRule(t,a,n),n},i=function(e){d(o,e)},d=function(e,t){e.removeRule?e.removeRule(t):e.deleteRule(t)}}var f=!1,m=angular.module("textAngular",["ngSanitize","textAngularSetup"]),g={};m.constant("taRegisterTool",a),m.value("taTools",g),m.config([function(){angular.forEach(g,function(e,t){delete g[t]})}]),m.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log",function(e,t,a,n,r,o,l,i,s,d){return{require:"?ngModel",scope:{},restrict:"EA",link:function(u,c,p,f){var m,g,h,v,y,E,b,x,T,w=p.serial?p.serial:Math.floor(1e16*Math.random()),C=p.name?p.name:"textAngularEditor"+w,S=function(e,a,n){t(function(){var t=function(){e.off(a,t),n()};e.on(a,t)},100)};T=r(p.taDefaultWrap),angular.extend(u,angular.copy(a),{wrapSelection:function(e,t,a){T(e,!1,t),a&&u["reApplyOnSelectorHandlerstaTextElement"+w](),u.displayElements.text[0].focus()},showHtml:!1}),p.taFocussedClass&&(u.classes.focussed=p.taFocussedClass),p.taTextEditorClass&&(u.classes.textEditor=p.taTextEditorClass),p.taHtmlEditorClass&&(u.classes.htmlEditor=p.taHtmlEditorClass),p.taTextEditorSetup&&(u.setup.textEditorSetup=u.$parent.$eval(p.taTextEditorSetup)),p.taHtmlEditorSetup&&(u.setup.htmlEditorSetup=u.$parent.$eval(p.taHtmlEditorSetup)),p.taFileDrop?u.fileDropHandler=u.$parent.$eval(p.taFileDrop):u.fileDropHandler=u.defaultFileDropHandler,b=c[0].innerHTML,c[0].innerHTML="",u.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},u.displayElements.popover.append(u.displayElements.popoverArrow),u.displayElements.popover.append(u.displayElements.popoverContainer),u.displayElements.scrollWindow.append(u.displayElements.popover),u.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),u.showPopover=function(e){u.displayElements.popover.css("display","block"),u.reflowPopover(e),s.addClass(u.displayElements.popover,"in"),S(c,"click keyup",function(){u.hidePopover()})},u.reflowPopover=function(e){u.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(u.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+"px"),u.displayElements.popover.removeClass("top").addClass("bottom")):(u.displayElements.popover.css("top",e[0].offsetTop-54+"px"),u.displayElements.popover.removeClass("bottom").addClass("top"));var t=u.displayElements.text[0].offsetWidth-u.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-u.displayElements.popover[0].offsetWidth/2;u.displayElements.popover.css("left",Math.max(0,Math.min(t,a))+"px"),u.displayElements.popoverArrow.css("margin-left",Math.min(a,Math.max(0,a-t))-11+"px")},u.hidePopover=function(){s.removeClass(u.displayElements.popover,"in",function(){u.displayElements.popover.css("display",""),u.displayElements.popoverContainer.attr("style",""),u.displayElements.popoverContainer.attr("class","popover-content")})},u.displayElements.resize.overlay.append(u.displayElements.resize.background),angular.forEach(u.displayElements.resize.anchors,function(e){u.displayElements.resize.overlay.append(e)}),u.displayElements.resize.overlay.append(u.displayElements.resize.info),u.displayElements.scrollWindow.append(u.displayElements.resize.overlay),u.reflowResizeOverlay=function(e){e=angular.element(e)[0],u.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),u.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},u.showResizeOverlay=function(e){var t=function(t){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:t.clientX,y:t.clientY};void 0===a.width&&(a.width=e[0].offsetWidth),void 0===a.height&&(a.height=e[0].offsetHeight),u.hidePopover();var n=a.height/a.width,r=function(t){var r={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},o=function(e,t){e=angular.element(e),"img"===e[0].tagName.toLowerCase()&&(t.height&&(e.attr("height",t.height),delete t.height),t.width&&(e.attr("width",t.width),delete t.width)),e.css(t)};if(t.shiftKey){var l=r.y/r.x;o(e,{width:n>l?r.x:r.y/n,height:n>l?r.x*n:r.y})}else o(e,{width:r.x,height:r.y});u.reflowResizeOverlay(e)};i.find("body").on("mousemove",r),S(u.displayElements.resize.overlay,"mouseup",function(){i.find("body").off("mousemove",r),u.showPopover(e)}),t.stopPropagation(),t.preventDefault()};u.displayElements.resize.anchors[3].on("mousedown",t),u.reflowResizeOverlay(e),S(c,"click",function(){u.hideResizeOverlay()})},u.hideResizeOverlay=function(){u.displayElements.resize.overlay.css("display","")},u.setup.htmlEditorSetup(u.displayElements.html),u.setup.textEditorSetup(u.displayElements.text),u.displayElements.html.attr({id:"taHtmlElement"+w,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),u.displayElements.text.attr({id:"taTextElement"+w,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),u.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),p.taDefaultWrap&&u.displayElements.text.attr("ta-default-wrap",p.taDefaultWrap),p.taUnsafeSanitizer&&(u.displayElements.text.attr("ta-unsafe-sanitizer",p.taUnsafeSanitizer),u.displayElements.html.attr("ta-unsafe-sanitizer",p.taUnsafeSanitizer)),u.displayElements.scrollWindow.append(u.displayElements.text),c.append(u.displayElements.scrollWindow),c.append(u.displayElements.html),u.displayElements.forminput.attr("name",C),c.append(u.displayElements.forminput),p.tabindex&&(c.removeAttr("tabindex"),u.displayElements.text.attr("tabindex",p.tabindex),u.displayElements.html.attr("tabindex",p.tabindex)),p.placeholder&&(u.displayElements.text.attr("placeholder",p.placeholder),u.displayElements.html.attr("placeholder",p.placeholder)),p.taDisabled&&(u.displayElements.text.attr("ta-readonly","disabled"),u.displayElements.html.attr("ta-readonly","disabled"),u.disabled=u.$parent.$eval(p.taDisabled),u.$parent.$watch(p.taDisabled,function(e){u.disabled=e,u.disabled?c.addClass(u.classes.disabled):c.removeClass(u.classes.disabled)})),e(u.displayElements.scrollWindow)(u),e(u.displayElements.html)(u),u.updateTaBindtaTextElement=u["updateTaBindtaTextElement"+w],u.updateTaBindtaHtmlElement=u["updateTaBindtaHtmlElement"+w],c.addClass("ta-root"),u.displayElements.scrollWindow.addClass("ta-text ta-editor "+u.classes.textEditor),u.displayElements.html.addClass("ta-html ta-editor "+u.classes.htmlEditor),u._actionRunning=!1;var $=!1;if(u.startAction=function(){return u._actionRunning=!0,l.rangy&&l.rangy.saveSelection?($=l.rangy.saveSelection(),function(){$&&l.rangy.restoreSelection($)}):void 0},u.endAction=function(){u._actionRunning=!1,$&&l.rangy.removeMarkers($),$=!1,u.updateSelectedStyles(),u.showHtml||u["updateTaBindtaTextElement"+w]()},y=function(){c.addClass(u.classes.focussed),x.focus()},u.displayElements.html.on("focus",y),u.displayElements.text.on("focus",y),E=function(e){return u._actionRunning||i[0].activeElement===u.displayElements.html[0]||i[0].activeElement===u.displayElements.text[0]||(c.removeClass(u.classes.focussed),x.unfocus(),t(function(){c.triggerHandler("blur")},0)),e.preventDefault(),!1},u.displayElements.html.on("blur",E),u.displayElements.text.on("blur",E),u.queryFormatBlockState=function(e){return!u.showHtml&&e.toLowerCase()===i[0].queryCommandValue("formatBlock").toLowerCase()},u.queryCommandState=function(e){return u.showHtml?"":i[0].queryCommandState(e)},u.switchView=function(){u.showHtml=!u.showHtml,s.enabled(!1,u.displayElements.html),s.enabled(!1,u.displayElements.text),u.showHtml?t(function(){return s.enabled(!0,u.displayElements.html),s.enabled(!0,u.displayElements.text),u.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,u.displayElements.html),s.enabled(!0,u.displayElements.text),u.displayElements.text[0].focus()},100)},p.ngModel){var A=!0;f.$render=function(){if(A){A=!1;var e=u.$parent.$eval(p.ngModel);void 0!==e&&null!==e||!b||""===b||f.$setViewValue(b)}u.displayElements.forminput.val(f.$viewValue),u._elementSelectTriggered||i[0].activeElement===u.displayElements.html[0]||i[0].activeElement===u.displayElements.text[0]||(u.html=f.$viewValue||"")};var L=function(e){return p.required&&f.$setValidity("required",!(!e||""===e.trim())),e};f.$parsers.push(L),f.$formatters.push(L)}else u.displayElements.forminput.val(b),u.html=b;if(u.$watch("html",function(e,t){e!==t&&(p.ngModel&&f.$viewValue!==e&&f.$setViewValue(e),u.displayElements.forminput.val(e))}),p.taTargetToolbars)x=o.registerEditor(C,u,p.taTargetToolbars.split(","));else{var D=angular.element('<div text-angular-toolbar name="textAngularToolbar'+w+'">');p.taToolbar&&D.attr("ta-toolbar",p.taToolbar),p.taToolbarClass&&D.attr("ta-toolbar-class",p.taToolbarClass),p.taToolbarGroupClass&&D.attr("ta-toolbar-group-class",p.taToolbarGroupClass),p.taToolbarButtonClass&&D.attr("ta-toolbar-button-class",p.taToolbarButtonClass),p.taToolbarActiveButtonClass&&D.attr("ta-toolbar-active-button-class",p.taToolbarActiveButtonClass),p.taFocussedClass&&D.attr("ta-focussed-class",p.taFocussedClass),c.prepend(D),e(D)(u.$parent),x=o.registerEditor(C,u,["textAngularToolbar"+w])}u.$on("$destroy",function(){o.unregisterEditor(C)}),u.$on("ta-element-select",function(e,t){x.triggerElementSelect(e,t)}),u.$on("ta-drop-event",function(e,t,a,n){u.displayElements.text[0].focus(),n&&n.files&&n.files.length>0&&(angular.forEach(n.files,function(e){try{return u.fileDropHandler(e,u.wrapSelection)||u.fileDropHandler!==u.defaultFileDropHandler&&u.defaultFileDropHandler(e,u.wrapSelection)}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation())}),u._bUpdateSelectedStyles=!1,u.updateSelectedStyles=function(){var e;void 0!==(e=n.getSelectionElement())&&e.parentNode!==u.displayElements.text[0]?x.updateSelectedStyles(angular.element(e)):x.updateSelectedStyles(),u._bUpdateSelectedStyles&&t(u.updateSelectedStyles,200)},m=function(){u._bUpdateSelectedStyles||(u._bUpdateSelectedStyles=!0,u.$apply(function(){u.updateSelectedStyles()}))},u.displayElements.html.on("keydown",m),u.displayElements.text.on("keydown",m),g=function(){u._bUpdateSelectedStyles=!1},u.displayElements.html.on("keyup",g),u.displayElements.text.on("keyup",g),h=function(e,t){t&&angular.extend(e,t),u.$apply(function(){return x.sendKeyCommand(e)?(u._bUpdateSelectedStyles||u.updateSelectedStyles(),e.preventDefault(),!1):void 0})},u.displayElements.html.on("keypress",h),u.displayElements.text.on("keypress",h),v=function(){u._bUpdateSelectedStyles=!1,u.$apply(function(){u.updateSelectedStyles()})},u.displayElements.html.on("mouseup",v),u.displayElements.text.on("mouseup",v)}}}]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===r?"div":8>=r?"P":"p":8>=r?e.toUpperCase():e:8>=r?"P":"p"}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,a){var n=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/gi,r=/^(ul|li|ol)$/gi,o=function(t,a){var n,r,o=t.find("li");for(r=o.length-1;r>=0;r--)n=angular.element("<"+a+">"+o[r].innerHTML+"</"+a+">"),t.after(n);t.remove(),e.setSelectionToElementEnd(n[0])},l=function(t,a){var n=angular.element("<"+a+">"+t[0].innerHTML+"</"+a+">");t.after(n),t.remove(),e.setSelectionToElementEnd(n.find("li")[0])},i=function(a,n,r){for(var o="",l=0;l<a.length;l++)o+="<"+t("li")+">"+a[l].innerHTML+"</"+t("li")+">";var i=angular.element("<"+r+">"+o+"</"+r+">");n.after(i),n.remove(),e.setSelectionToElementEnd(i.find("li")[0])};return function(s){return s=t(s),function(d,u,c){var p,f,m,g,h,v,y=angular.element("<"+s+">"),E=e.getSelectionElement(),b=angular.element(E);if(void 0!==E){var x=E.tagName.toLowerCase();if("insertorderedlist"===d.toLowerCase()||"insertunorderedlist"===d.toLowerCase()){var T=t("insertorderedlist"===d.toLowerCase()?"ol":"ul");if(x===T)return o(b,s);if("li"===x&&b.parent()[0].tagName.toLowerCase()===T&&1===b.parent().children().length)return o(b.parent(),s);if("li"===x&&b.parent()[0].tagName.toLowerCase()!==T&&1===b.parent().children().length)return l(b.parent(),T);if(x.match(n)&&!b.hasClass("ta-bind")){if("ol"===x||"ul"===x)return l(b,T);var w=!1;return angular.forEach(b.children(),function(e){e.tagName.match(n)&&(w=!0)}),w?i(b.children(),b,T):i([angular.element("<div>"+E.innerHTML+"</div>")[0]],b,T)}if(x.match(n)){if(g=e.getOnlySelectedElements(),1===g.length&&("ol"===g[0].tagName.toLowerCase()||"ul"===g[0].tagName.toLowerCase()))return g[0].tagName.toLowerCase()===T?o(angular.element(g[0]),s):l(angular.element(g[0]),T);m="";var C=[];for(p=0;p<g.length;p++)if(3!==g[p].nodeType){var S=angular.element(g[p]);m+="<"+t("li")+">"+S[0].innerHTML+"</"+t("li")+">",C.unshift(S)}return f=angular.element("<"+T+">"+m+"</"+T+">"),C.pop().replaceWith(f),angular.forEach(C,function(e){e.remove()}),void e.setSelectionToElementEnd(f[0])}}else{if("formatblock"===d.toLowerCase()){for(v=c.toLowerCase().replace(/[<>]/gi,""),f="li"===x?b.parent():b;!f[0].tagName.match(n);)f=f.parent(),x=f[0].tagName.toLowerCase();if(x===v){g=f.children();var $=!1;for(p=0;p<g.length;p++)$=$||g[p].tagName.match(n);$?(f.after(g),h=f.next(),f.remove(),f=h):(y.append(f[0].childNodes),f.after(y),f.remove(),f=y)}else if(f.parent()[0].tagName.toLowerCase()!==v||f.parent().hasClass("ta-bind"))if(x.match(r))f.wrap(c);else{g=e.getOnlySelectedElements(),0===g.length&&(g=[f[0]]);var A=!1;if(angular.forEach(g,function(e){3!==e.nodeType&&e.tagName.match(n)||(A=!0)}),A)for(;3===g[0].nodeType||!g[0].tagName.match(n);)g=[g[0].parentNode];if(angular.element(g[0]).hasClass("ta-bind"))f=angular.element(c),f[0].innerHTML=g[0].innerHTML,g[0].innerHTML=f[0].outerHTML;else if("blockquote"===v){for(m="",p=0;p<g.length;p++)m+=g[p].outerHTML;f=angular.element(c),f[0].innerHTML=m,g[0].parentNode.insertBefore(f[0],g[0]),angular.forEach(g,function(e){e.parentNode.removeChild(e)})}else for(p=0;p<g.length;p++)f=angular.element(c),f[0].innerHTML=g[p].innerHTML,g[p].parentNode.insertBefore(f[0],g[p]),g[p].parentNode.removeChild(g[p])}else{var L=f.parent(),D=L.contents();for(p=0;p<D.length;p++)L.parent().hasClass("ta-bind")&&3===D[p].nodeType&&(y=angular.element("<"+s+">"),y[0].innerHTML=D[p].outerHTML,D[p]=y[0]),L.parent()[0].insertBefore(D[p],L[0]);L.remove()}return void e.setSelectionToElementEnd(f[0])}if("createlink"===d.toLowerCase()){var H=e.getSelection();if(H.collapsed)return void e.insertHtml('<a href="'+c+'">'+c+"</a>")}}}try{a[0].execCommand(d,u,c)}catch(M){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions",function(e,t,a,o,s,d,u,c,p,m){return{require:"ngModel",link:function(d,g,h,v){var y,E,b,x=void 0!==g.attr("contenteditable")&&g.attr("contenteditable"),T=x||"textarea"===g[0].tagName.toLowerCase()||"input"===g[0].tagName.toLowerCase(),w=!1,C=!1,S=h.taUnsafeSanitizer||m.disableSanitizer,$=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/;void 0===h.taDefaultWrap&&(h.taDefaultWrap="p"),""===h.taDefaultWrap?(y="",E=void 0===r?"<div><br></div>":r>=11?"<p><br></p>":8>=r?"<P>&nbsp;</P>":"<p>&nbsp;</p>",b=void 0===r?/^<div>(\s|&nbsp;)*<\/div>$/gi:/^<p>(\s|&nbsp;)*<\/p>$/gi):(y=void 0===r||r>=11?"<"+h.taDefaultWrap+"><br></"+h.taDefaultWrap+">":8>=r?"<"+h.taDefaultWrap.toUpperCase()+"></"+h.taDefaultWrap.toUpperCase()+">":"<"+h.taDefaultWrap+"></"+h.taDefaultWrap+">",E=void 0===r||r>=11?"<"+h.taDefaultWrap+"><br></"+h.taDefaultWrap+">":8>=r?"<"+h.taDefaultWrap.toUpperCase()+">&nbsp;</"+h.taDefaultWrap.toUpperCase()+">":"<"+h.taDefaultWrap+">&nbsp;</"+h.taDefaultWrap+">",b=new RegExp("^<"+h.taDefaultWrap+">(\\s|&nbsp;)*<\\/"+h.taDefaultWrap+">$","ig")),g.addClass("ta-bind");var A=function(){if(x)return g[0].innerHTML;if(T)return g.val();throw"textAngular Error: attempting to update non-editable taBind"},L=function(e){e||(e=A()),e===E||e.match(b)?""!==v.$viewValue&&v.$setViewValue(""):v.$viewValue!==e&&v.$setViewValue(e)};if(d["updateTaBind"+(h.id||"")]=function(){w||L()},T)if(g.on("paste",function(t,n){n&&angular.extend(t,n);var r;if(t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData?(r=(t.originalEvent||t).clipboardData.getData("text/html"),r||(r=(t.originalEvent||t).clipboardData.getData("text/plain"))):a.clipboardData&&(r=a.clipboardData.getData("Text")),!r&&!w)return!0;if(t.preventDefault(),!w)if(r=e(r),o[0].selection){var l=o[0].selection.createRange();l.pasteHTML(r)}else o[0].execCommand("insertHtml",!1,r)}),g.on("paste cut",function(e){w?e.preventDefault():t(function(){v.$setViewValue(A())},0)}),x){if(g.on("keyup",function(e,t){if(t&&angular.extend(e,t),!w&&!$.test(e.keyCode)){if(""!==y&&13===e.keyCode&&!e.shiftKey){var a=u.getSelectionElement();if(a.tagName.toLowerCase()!==h.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||"<br>"===a.innerHTML.trim())){var n=angular.element(y);angular.element(a).replaceWith(n),u.setSelectionToElementStart(n[0])}}var r=A();""!==y&&""===r.trim()&&(g[0].innerHTML=y,u.setSelectionToElementStart(g.children()[0])),L(r)}}),g.on("blur",function(){C=!1,w||L(),v.$render()}),h.placeholder&&(r>8||void 0===r)){var D;if(!h.id)throw"textAngular Error: An unique ID is required for placeholders to work";D=l("#"+h.id+".placeholder-text:before",'content: "'+h.placeholder+'"'),d.$on("$destroy",function(){i(D)})}g.on("focus",function(){C=!0,v.$render()}),g.on("mousedown",function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else g.on("change blur",function(){w||v.$setViewValue(A())});var H=function(t){return v.$oldViewValue=e(s(t),v.$oldViewValue,S)},M=function(e){return h.required&&v.$setValidity("required",!(!e||e.trim()===E||e.trim().match(b)||""===e.trim())),e};v.$parsers.push(H),v.$parsers.push(M),v.$formatters.push(H),v.$formatters.push(M);var N=function(e){return d.$emit("ta-element-select",this),e.preventDefault(),!1},R=function(e,a){if(a&&angular.extend(e,a),!f&&!w){f=!0;var n;n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,d.$emit("ta-drop-event",this,e,n),t(function(){f=!1},100)}};d["reApplyOnSelectorHandlers"+(h.id||"")]=function(){w||angular.forEach(c,function(e){g.find(e).off("click",N).on("click",N)})};var W=function(e){g[0].innerHTML=e};v.$render=function(){var e=v.$viewValue||"";o[0].activeElement!==g[0]?x?(h.placeholder?""===e?(C?g.removeClass("placeholder-text"):g.addClass("placeholder-text"),W(y)):(g.removeClass("placeholder-text"),W(e)):W(""===e?y:e),w?g.off("drop",R):(angular.forEach(c,function(e){g.find(e).on("click",N)}),g.on("drop",R))):"textarea"!==g[0].tagName.toLowerCase()&&"input"!==g[0].tagName.toLowerCase()?W(p(e)):g.val(e):x&&g.removeClass("placeholder-text")},h.taReadonly&&(w=d.$eval(h.taReadonly),w?(g.addClass("ta-readonly"),"textarea"!==g[0].tagName.toLowerCase()&&"input"!==g[0].tagName.toLowerCase()||g.attr("disabled","disabled"),void 0!==g.attr("contenteditable")&&g.attr("contenteditable")&&g.removeAttr("contenteditable")):(g.removeClass("ta-readonly"),"textarea"===g[0].tagName.toLowerCase()||"input"===g[0].tagName.toLowerCase()?g.removeAttr("disabled"):x&&g.attr("contenteditable","true")),d.$watch(h.taReadonly,function(e,t){t!==e&&(e?(g.addClass("ta-readonly"),"textarea"!==g[0].tagName.toLowerCase()&&"input"!==g[0].tagName.toLowerCase()||g.attr("disabled","disabled"),void 0!==g.attr("contenteditable")&&g.attr("contenteditable")&&g.removeAttr("contenteditable"),angular.forEach(c,function(e){g.find(e).on("click",N)}),g.off("drop",R)):(g.removeClass("ta-readonly"),"textarea"===g[0].tagName.toLowerCase()||"input"===g[0].tagName.toLowerCase()?g.removeAttr("disabled"):x&&g.attr("contenteditable","true"),angular.forEach(c,function(e){g.find(e).off("click",N)}),g.on("drop",R)),w=e)})),x&&!w&&(angular.forEach(c,function(e){g.find(e).on("click",N)}),g.on("drop",R),g.on("blur",function(){/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(n=!0)}))}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(e){return function(a){var n=angular.element("<div></div>");return n[0].innerHTML=a,angular.forEach(e,function(e){var a=[];e.selector&&""!==e.selector?a=n.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(a=t(n,e.customAttribute)),angular.forEach(a,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),n[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function r(e){var t=angular.element("<div/>");t.html(e);var a=t.text().length;return o>=a?(n.$setValidity("taMaxText",!0),e):void n.$setValidity("taMaxText",!1)}var o=parseInt(e.$eval(a.taMaxText));if(isNaN(o))throw"Max text must be an integer";a.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";n.$dirty&&n.$setViewValue(n.$viewValue)}),n.$parsers.unshift(r)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function r(e){var t=angular.element("<div/>");t.html(e);var a=t.text().length;return!a||a>=o?(n.$setValidity("taMinText",!0),e):void n.$setValidity("taMinText",!1)}var o=parseInt(e.$eval(a.taMinText));if(isNaN(o))throw"Min text must be an integer";a.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";n.$dirty&&n.$setViewValue(n.$viewValue)}),n.$parsers.unshift(r)}}}).factory("taFixChrome",function(){var e=function(e){for(var t=angular.element("<div>"+e+"</div>"),a=angular.element(t).find("span"),n=0;n<a.length;n++){var r=angular.element(a[n]);r.attr("style")&&r.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(r.attr("style",r.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,"")),r.attr("style")&&""!==r.attr("style")||(r.next().length>0&&"BR"===r.next()[0].tagName&&r.next().remove(),r.replaceWith(r[0].innerHTML)))}var o=t[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return o!==t[0].innerHTML&&(t[0].innerHTML=o),t[0].innerHTML};return e}).factory("taSanitize",["$sanitize",function(e){return function(a,n,r){var o=angular.element("<div>"+a+"</div>");angular.forEach(t(o,"align"),function(e){e.css("text-align",e.attr("align")),e.removeAttr("align")});var l;a=o[0].innerHTML;try{l=e(a),r&&(l=a)}catch(i){l=n||""}return l=l.replace(/(&#9;)|(&#10;)/gi,"")}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,a,n,r,o){return{scope:{name:"@"},restrict:"EA",link:function(l,i,s){if(!l.name||""===l.name)throw"textAngular Error: A toolbar requires a name";angular.extend(l,angular.copy(a)),s.taToolbar&&(l.toolbar=l.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(l.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(l.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(l.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(l.classes.focussed=s.taFocussedClass),l.disabled=!0,l.focussed=!1,l._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+l.classes.toolbar),l.$watch("focussed",function(){l.focussed?i.addClass(l.classes.focussed):i.removeClass(l.classes.focussed)});var d=function(t,a){var n;if(n=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),n.addClass(l.classes.toolbarButton),n.attr("name",a.name),n.attr("unselectable","on"),n.attr("ng-disabled","isDisabled()"),n.attr("tabindex","-1"),n.attr("ng-click","executeAction()"),n.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&n.attr("title",t.tooltiptext),n.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!a._display&&(n[0].innerHTML="",t.buttontext&&(n[0].innerHTML=t.buttontext),t.iconclass)){var r=angular.element("<i>"),o=n[0].innerHTML;r.addClass(t.iconclass),n[0].innerHTML="",n.append(r),o&&""!==o&&n.append("&nbsp;"+o)}return a._lastToolDefinition=angular.copy(t),e(n)(a)};l.tools={},l._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:o,$editor:function(){return l._parent},isDisabled:function(){return this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?l.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(l.toolbar,function(e){var t=angular.element("<div>");t.addClass(l.classes.toolbarGroup),angular.forEach(e,function(e){l.tools[e]=angular.extend(l.$new(!0),n[e],u,{name:e}),l.tools[e].$element=d(n[e],l.tools[e]),t.append(l.tools[e].$element)}),i.append(t)}),l.updateToolDisplay=function(e,t,a){var n=l.tools[e];if(n){if(n._lastToolDefinition&&!a&&(t=angular.extend({},n._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=d(t,n);n.$element.replaceWith(r),n.$element=r}},l.addTool=function(e,t,a,r){l.tools[e]=angular.extend(l.$new(!0),n[e],u,{name:e}),l.tools[e].$element=d(n[e],l.tools[e]);var o;void 0===a&&(a=l.toolbar.length-1),o=angular.element(i.children()[a]),void 0===r?(o.append(l.tools[e].$element),l.toolbar[a][l.toolbar[a].length-1]=e):(o.children().eq(r).after(l.tools[e].$element),l.toolbar[a][r]=e)},t.registerToolbar(l),l.$on("$destroy",function(){t.unregisterToolbar(l.name)})}}}]).service("taToolExecuteAction",["$q",function(e){return function(t){void 0!==t&&(this.$editor=function(){return t});var a=e.defer(),n=a.promise,r=this.$editor();n["finally"](function(){r.endAction.call(r)});var o;try{o=this.action(a,r.startAction())}catch(l){}(o||void 0===o)&&a.resolve()}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,a){var n={},r={};return{registerEditor:function(a,o,l){if(!a||""===a)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(r[a])throw'textAngular Error: An Editor with name "'+a+'" already exists';var i=[];return angular.forEach(l,function(e){n[e]&&i.push(n[e])}),r[a]={scope:o,toolbars:l,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&i.push(e)},editorFunctions:{disable:function(){angular.forEach(i,function(e){e.disabled=!0})},enable:function(){angular.forEach(i,function(e){e.disabled=!1})},focus:function(){angular.forEach(i,function(e){e._parent=o,e.disabled=!1,e.focussed=!0})},unfocus:function(){angular.forEach(i,function(e){e.disabled=!0,e.focussed=!1})},updateSelectedStyles:function(e){angular.forEach(i,function(t){angular.forEach(t.tools,function(t){t.activeState&&(t.active=t.activeState(e))})})},sendKeyCommand:function(a){var n=!1;return(a.ctrlKey||a.metaKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&t.commandKeyCode===a.which)for(var l=0;l<i.length;l++)if(void 0!==i[l].tools[r]){e.call(i[l].tools[r],o),n=!0;break}}),n},triggerElementSelect:function(e,a){var n=function(e,t){for(var a=!0,n=0;n<t.length;n++)a=a&&e.attr(t[n]);return a},r=[],l={},s=!1;a=angular.element(a);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===a[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(a))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&n(a,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!n(a,e.onElementSelect.onlyWithAttrs)||(l[t]=e))}),d?(angular.forEach(l,function(e,t){e.onElementSelect.onlyWithAttrs&&n(a,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(l,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var u=0;u<r.length;u++){for(var c=r[u].tool,p=r[u].name,f=0;f<i.length;f++)if(void 0!==i[f].tools[p]){c.onElementSelect.action.call(i[f].tools[p],e,a,o),s=!0;break}if(s)break}return s}}},r[a].editorFunctions},retrieveEditor:function(e){return r[e]},unregisterEditor:function(e){delete r[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";
if(n[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';n[e.name]=e,angular.forEach(r,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return n[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete n[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,a){t.updateToolDisplay(a,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,a){e.resetToolDisplay(a)})},updateToolDisplay:function(e,t){var a=this;angular.forEach(n,function(n,r){a.updateToolbarToolDisplay(r,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(n,function(a,n){t.resetToolbarToolDisplay(n,e)})},updateToolbarToolDisplay:function(e,t,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(a,t[a],!0)},removeTool:function(e){delete t[e],angular.forEach(n,function(t){delete t.tools[e];for(var a=0;a<t.toolbar.length;a++){for(var n,r=0;r<t.toolbar[a].length;r++){if(t.toolbar[a][r]===e){n={group:a,index:r};break}if(void 0!==n)break}void 0!==n&&(t.toolbar[n.group].slice(n.index,1),t._$element.children().eq(n.group).children().eq(n.index).remove())}})},addTool:function(e,t,r,o){a(e,t),angular.forEach(n,function(a){a.addTool(e,t,r,o)})},addToolToToolbar:function(e,t,r,o,l){a(e,t),n[r].addTool(e,t,o,l)},refreshEditor:function(e){if(!r[e])throw'textAngular Error: No Editor with name "'+e+'" exists';r[e].scope.updateTaBindtaTextElement(),r[e].scope.$$phase||r[e].scope.$digest()}}}]).service("taSelection",["$window","$document",function(e,t){var a=t[0],n=function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},r=function(e){var t=e.startContainer,a=e.endContainer;if(t===a)return[t];for(var r=[];t&&t!==a;)t=n(t),t.parentNode===e.commonAncestorContainer&&r.push(t);for(t=e.startContainer;t&&t!==e.commonAncestorContainer;)t.parentNode===e.commonAncestorContainer&&r.unshift(t),t=t.parentNode;return r};return{getSelection:function(){var t,n,r;return a.selection&&a.selection.createRange?(t=a.selection.createRange(),r=t.parentElement(),n={isCollapsed:0===t.text.length}):e.getSelection&&(n=e.getSelection(),n.getRangeAt?n.rangeCount>0&&(t=n.getRangeAt(0)):(t=a.createRange(),t.setStart(n.anchorNode,n.anchorOffset),t.setEnd(n.focusNode,n.focusOffset),t.collapsed!==n.isCollapsed&&(t.setStart(n.focusNode,n.focusOffset),t.setEnd(n.anchorNode,n.anchorOffset))),t&&(r=t.commonAncestorContainer,r=3===r.nodeType?r.parentNode:r)),t?{start:{element:t.startContainer,offset:t.startOffset},end:{element:t.endContainer,offset:t.endOffset},container:r,collapsed:n.isCollapsed}:{start:{offset:0},end:{offset:0},container:void 0,collapsed:!0}},getOnlySelectedElements:function(){if(window.getSelection){var t=e.getSelection();if(!t.isCollapsed)return r(t.getRangeAt(0))}return[]},getSelectionElement:function(){return this.getSelection().container},setSelection:function(t,n,r){if(a.createRange&&e.getSelection){var o=a.createRange();o.selectNodeContents(t),o.setStart(t,n),o.setEnd(t,r);var l=e.getSelection();l.removeAllRanges(),l.addRange(o)}else if(a.selection&&a.body.createTextRange){var i=a.body.createTextRange();i.moveToElementText(t),i.moveEnd("character",n),i.moveStart("character",r),i.select()}},setSelectionToElementStart:function(t){if(a.createRange&&e.getSelection){var n=a.createRange();n.selectNodeContents(t),n.setStart(t,0),n.setEnd(t,0);var r=e.getSelection();r.removeAllRanges(),r.addRange(n)}else if(a.selection&&a.body.createTextRange){var o=a.body.createTextRange();o.moveToElementText(t),o.collapse(!0),o.moveEnd("character",0),o.moveStart("character",0),o.select()}},setSelectionToElementEnd:function(t){if(a.createRange&&e.getSelection){var n=a.createRange();n.selectNodeContents(t),n.collapse(!1);var r=e.getSelection();r.removeAllRanges(),r.addRange(n)}else if(a.selection&&a.body.createTextRange){var o=a.body.createTextRange();o.moveToElementText(t),o.collapse(!1),o.select()}},insertHtml:function(e){var t,a;if(window.getSelection){if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){a=t.getRangeAt(0),a.deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var r,o,l=document.createDocumentFragment();r=n.firstChild;)o=l.appendChild(r);a.insertNode(l),o&&(a=a.cloneRange(),a.setStartAfter(o),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}}}])}();
//# sourceMappingURL=./textAngular.min.js.map