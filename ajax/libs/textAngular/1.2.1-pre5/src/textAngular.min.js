!function(){"Use Strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(e,a){var n=[],o=e.children();return o.length&&angular.forEach(o,function(e){n=n.concat(t(angular.element(e),a))}),void 0!==e.attr(a)&&n.push(e),n}function a(t,a){if(!t||""===t||p.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(a.display&&(""===a.display||!e(a.display))||!a.display&&!a.buttontext&&!a.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';p[t]=a}var n=!1;/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(document.addEventListener("click",function(){var e=window.event.target;if(n&&null!==e){for(var t=!1,a=e;null!==a&&"html"!==a.tagName.toLowerCase()&&!t;)t="true"===a.contentEditable,a=a.parentNode;t||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),e.focus())}n=!1},!1),angular.element(document.body).append('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000; left: -10000;" unselectable="on" tabIndex="-1">'));var o=function(){var e,t=-1,a=window.navigator.userAgent,n=a.indexOf("MSIE "),o=a.indexOf("Trident/");if(n>0)t=parseInt(a.substring(n+5,a.indexOf(".",n)),10);else if(o>0){var r=a.indexOf("rv:");t=parseInt(a.substring(r+3,a.indexOf(".",r)),10)}return t>-1?t:e}();"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});var r,l,s;if(o>8||void 0===o){var d=function(){var e=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&e.appendChild(document.createTextNode("")),document.head.insertBefore(e,document.head.firstChild),e.sheet}();r=function(){var e=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}(),l=function(e,t){_addCSSRule(r,e,t)},_addCSSRule=function(e,t,a){var n;return e.rules?n=Math.max(e.rules.length-1,0):e.cssRules&&(n=Math.max(e.cssRules.length-1,0)),e.insertRule?e.insertRule(t+"{"+a+"}",n):e.addRule(t,a,n),n},s=function(e){_removeCSSRule(r,e)},_removeCSSRule=function(e,t){e.removeRule?e.removeRule(t):e.deleteRule(t)},_addCSSRule(d,".ta-scroll-window.form-control","height: 300px; overflow: auto; font-family: inherit; font-size: 100%; position: relative; padding: 0;"),_addCSSRule(d,".ta-root.focussed .ta-scroll-window.form-control","border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6);"),_addCSSRule(d,".ta-editor.ta-html","min-height: 300px; height: auto; overflow: auto; font-family: inherit; font-size: 100%;"),_addCSSRule(d,".ta-scroll-window .ta-bind","height: auto; min-height: 300px; padding: 6px 12px;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay","z-index: 100; position: absolute; display: none;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-info","position: absolute; bottom: 16px; right: 16px; border: 1px solid black; background-color: #FFF; padding: 0 4px; opacity: 0.7;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-background","position: absolute; bottom: 5px; right: 5px; left: 5px; top: 5px; border: 1px solid black; background-color: rgba(0, 0, 0, 0.2);"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner","width: 10px; height: 10px; position: absolute;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tl","top: 0; left: 0; border-left: 1px solid black; border-top: 1px solid black;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tr","top: 0; right: 0; border-right: 1px solid black; border-top: 1px solid black;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-bl","bottom: 0; left: 0; border-left: 1px solid black; border-bottom: 1px solid black;"),_addCSSRule(d,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-br","bottom: 0; right: 0; border: 1px solid black; cursor: se-resize; background-color: white;")}var u=!1,c=angular.module("textAngular",["ngSanitize"]);if(void 0===textAngularSetup)throw"textAngular Error: Setup Options are not defined, see textAngularSetup.js for example.";c.value("taOptions",textAngularSetup.options),c.value("taSelectableElements",textAngularSetup.selectableElements),c.value("taCustomRenderers",textAngularSetup.customDisplayRenderers);var p={};c.constant("taTranslations",textAngularSetup.translationStrings),c.constant("taRegisterTool",a),c.value("taTools",p);var f=textAngularSetup.registerTools[textAngularSetup.registerTools.length-1];textAngularSetup.registerTools[textAngularSetup.registerTools.length-1]=function(){angular.forEach(p,function(e,t){delete p[t]}),f.apply(this,arguments)},c.run(textAngularSetup.registerTools),c.directive("textAngular",["$compile","$timeout","taOptions","taSanitize","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log",function(e,t,a,n,o,r,l,i,s,d,u){return{require:"?ngModel",scope:{},restrict:"EA",link:function(n,c,p,f){var m,g,h,v,y,b,E,x,T,w=Math.floor(1e16*Math.random()),S=p.name?p.name:"textAngularEditor"+w,C=function(e,a,n){t(function(){var t=function(){e.off(a,t),n()};e.on(a,t)},100)};T=r(p.taDefaultWrap),angular.extend(n,angular.copy(a),{wrapSelection:function(e,t,a){T(e,!1,t),a&&n["reApplyOnSelectorHandlerstaTextElement"+w](),n.displayElements.text[0].focus()},showHtml:!1}),p.taFocussedClass&&(n.classes.focussed=p.taFocussedClass),p.taTextEditorClass&&(n.classes.textEditor=p.taTextEditorClass),p.taHtmlEditorClass&&(n.classes.htmlEditor=p.taHtmlEditorClass),p.taTextEditorSetup&&(n.setup.textEditorSetup=n.$parent.$eval(p.taTextEditorSetup)),p.taHtmlEditorSetup&&(n.setup.htmlEditorSetup=n.$parent.$eval(p.taHtmlEditorSetup)),p.taFileDrop?n.fileDropHandler=n.$parent.$eval(p.taFileDrop):n.fileDropHandler=n.defaultFileDropHandler,E=c[0].innerHTML,c[0].innerHTML="",n.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><div class="arrow"></div></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},n.displayElements.popover.append(n.displayElements.popoverContainer),n.displayElements.scrollWindow.append(n.displayElements.popover),n.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),n.showPopover=function(e){n.reflowPopover(e),n.displayElements.popover.css("display","block"),d.addClass(n.displayElements.popover,"in"),C(c,"click keyup",function(){n.hidePopover()})},n.reflowPopover=function(e){n.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(n.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+"px"),n.displayElements.popover.removeClass("top").addClass("bottom")):(n.displayElements.popover.css("top",e[0].offsetTop-54+"px"),n.displayElements.popover.removeClass("bottom").addClass("top")),n.displayElements.popover.css("left",Math.max(0,Math.min(n.displayElements.text[0].offsetWidth-305,e[0].offsetLeft+e[0].offsetWidth/2-152.5))+"px")},n.hidePopover=function(){d.removeClass(n.displayElements.popover,"in",function(){n.displayElements.popover.css("display",""),n.displayElements.popoverContainer.attr("style",""),n.displayElements.popoverContainer.attr("class","popover-content")})},n.displayElements.resize.overlay.append(n.displayElements.resize.background),angular.forEach(n.displayElements.resize.anchors,function(e){n.displayElements.resize.overlay.append(e)}),n.displayElements.resize.overlay.append(n.displayElements.resize.info),n.displayElements.scrollWindow.append(n.displayElements.resize.overlay),n.reflowResizeOverlay=function(e){e=angular.element(e)[0],n.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),n.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},n.showResizeOverlay=function(e){var t=function(t){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:t.clientX,y:t.clientY};void 0===a.width&&(a.width=e[0].offsetWidth),void 0===a.height&&(a.height=e[0].offsetHeight),n.hidePopover();var o=a.height/a.width,r=function(t){var r={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},l=function(e,t){e=angular.element(e),"img"===e[0].tagName.toLowerCase()&&(t.height&&(e.attr("height",t.height),delete t.height),t.width&&(e.attr("width",t.width),delete t.width)),e.css(t)};if(t.shiftKey){var i=r.y/r.x;l(e,{width:o>i?r.x:r.y/o,height:o>i?r.x*o:r.y})}else l(e,{width:r.x,height:r.y});n.reflowResizeOverlay(e)};s.find("body").on("mousemove",r),C(n.displayElements.resize.overlay,"mouseup",function(){s.find("body").off("mousemove",r),n.showPopover(e)}),t.stopPropagation(),t.preventDefault()};n.displayElements.resize.anchors[3].on("mousedown",t),n.reflowResizeOverlay(e),C(c,"click",function(){n.hideResizeOverlay()})},n.hideResizeOverlay=function(){n.displayElements.resize.overlay.css("display","")},n.setup.htmlEditorSetup(n.displayElements.html),n.setup.textEditorSetup(n.displayElements.text),n.displayElements.html.attr({id:"taHtmlElement"+w,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),n.displayElements.text.attr({id:"taTextElement"+w,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),n.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),p.taDefaultWrap&&n.displayElements.text.attr("ta-default-wrap",p.taDefaultWrap),n.displayElements.scrollWindow.append(n.displayElements.text),c.append(n.displayElements.scrollWindow),c.append(n.displayElements.html),n.displayElements.forminput.attr("name",S),c.append(n.displayElements.forminput),p.tabindex&&(c.removeAttr("tabindex"),n.displayElements.text.attr("tabindex",p.tabindex),n.displayElements.html.attr("tabindex",p.tabindex)),p.placeholder&&(n.displayElements.text.attr("placeholder",p.placeholder),n.displayElements.html.attr("placeholder",p.placeholder)),p.taDisabled&&(n.displayElements.text.attr("ta-readonly","disabled"),n.displayElements.html.attr("ta-readonly","disabled"),n.disabled=n.$parent.$eval(p.taDisabled),n.$parent.$watch(p.taDisabled,function(e){n.disabled=e,n.disabled?c.addClass(n.classes.disabled):c.removeClass(n.classes.disabled)})),e(n.displayElements.scrollWindow)(n),e(n.displayElements.html)(n),n.updateTaBindtaTextElement=n["updateTaBindtaTextElement"+w],n.updateTaBindtaHtmlElement=n["updateTaBindtaHtmlElement"+w],c.addClass("ta-root"),n.displayElements.scrollWindow.addClass("ta-text ta-editor "+n.classes.textEditor),n.displayElements.html.addClass("ta-html ta-editor "+n.classes.htmlEditor),n._actionRunning=!1;var A=!1;if(n.startAction=function(){return n._actionRunning=!0,i.rangy&&i.rangy.saveSelection?(A=i.rangy.saveSelection(),function(){A&&i.rangy.restoreSelection(A)}):void 0},n.endAction=function(){n._actionRunning=!1,A&&i.rangy.removeMarkers(A),A=!1,n.updateSelectedStyles(),n.showHtml||n["updateTaBindtaTextElement"+w]()},y=function(){c.addClass(n.classes.focussed),x.focus()},n.displayElements.html.on("focus",y),n.displayElements.text.on("focus",y),b=function(e){return n._actionRunning||s[0].activeElement===n.displayElements.html[0]||s[0].activeElement===n.displayElements.text[0]||(c.removeClass(n.classes.focussed),x.unfocus(),t(function(){c.triggerHandler("blur")},0)),e.preventDefault(),!1},n.displayElements.html.on("blur",b),n.displayElements.text.on("blur",b),n.queryFormatBlockState=function(e){return e.toLowerCase()===s[0].queryCommandValue("formatBlock").toLowerCase()},n.switchView=function(){n.showHtml=!n.showHtml,n.showHtml?t(function(){return n.displayElements.html[0].focus()},100):t(function(){return n.displayElements.text[0].focus()},100)},p.ngModel){var $=!0;f.$render=function(){if($){$=!1;var e=n.$parent.$eval(p.ngModel);void 0!==e&&null!==e||!E||""===E||f.$setViewValue(E)}n.displayElements.forminput.val(f.$viewValue),n._elementSelectTriggered||s[0].activeElement===n.displayElements.html[0]||s[0].activeElement===n.displayElements.text[0]||(n.html=f.$viewValue||"")}}else n.displayElements.forminput.val(E),n.html=E;if(n.$watch("html",function(e,t){e!==t&&(p.ngModel&&f.$viewValue!==e&&f.$setViewValue(e),n.displayElements.forminput.val(e))}),p.taTargetToolbars)x=l.registerEditor(S,n,p.taTargetToolbars.split(","));else{var L=angular.element('<div text-angular-toolbar name="textAngularToolbar'+w+'">');p.taToolbar&&L.attr("ta-toolbar",p.taToolbar),p.taToolbarClass&&L.attr("ta-toolbar-class",p.taToolbarClass),p.taToolbarGroupClass&&L.attr("ta-toolbar-group-class",p.taToolbarGroupClass),p.taToolbarButtonClass&&L.attr("ta-toolbar-button-class",p.taToolbarButtonClass),p.taToolbarActiveButtonClass&&L.attr("ta-toolbar-active-button-class",p.taToolbarActiveButtonClass),p.taFocussedClass&&L.attr("ta-focussed-class",p.taFocussedClass),c.prepend(L),e(L)(n.$parent),x=l.registerEditor(S,n,["textAngularToolbar"+w])}n.$on("$destroy",function(){l.unregisterEditor(S)}),n.$on("ta-element-select",function(e,t){x.triggerElementSelect(e,t)}),n.$on("ta-drop-event",function(e,t,a,o){n.displayElements.text[0].focus(),o&&o.files&&o.files.length>0&&(angular.forEach(o.files,function(e){try{return n.fileDropHandler(e,n.wrapSelection)||n.fileDropHandler!==n.defaultFileDropHandler&&n.defaultFileDropHandler(e,n.wrapSelection)}catch(t){u.error(t)}}),a.preventDefault(),a.stopPropagation())}),n._bUpdateSelectedStyles=!1,n.updateSelectedStyles=function(){var e;void 0!==(e=o.getSelectionElement())&&e.parentNode!==n.displayElements.text[0]?x.updateSelectedStyles(angular.element(e)):x.updateSelectedStyles(),n._bUpdateSelectedStyles&&t(n.updateSelectedStyles,200)},m=function(){n._bUpdateSelectedStyles||(n._bUpdateSelectedStyles=!0,n.$apply(function(){n.updateSelectedStyles()}))},n.displayElements.html.on("keydown",m),n.displayElements.text.on("keydown",m),g=function(){n._bUpdateSelectedStyles=!1},n.displayElements.html.on("keyup",g),n.displayElements.text.on("keyup",g),h=function(e,t){t&&angular.extend(e,t),n.$apply(function(){return x.sendKeyCommand(e)?(n._bUpdateSelectedStyles||n.updateSelectedStyles(),e.preventDefault(),!1):void 0})},n.displayElements.html.on("keypress",h),n.displayElements.text.on("keypress",h),v=function(){n._bUpdateSelectedStyles=!1,n.$apply(function(){n.updateSelectedStyles()})},n.displayElements.html.on("mouseup",v),n.displayElements.text.on("mouseup",v)}}}]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===o?"div":8>=o?"P":"p":8>=o?e.toUpperCase():e:8>=o?"P":"p"}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,a){var n=/(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)/gi,o=/(ul|li|ol)/gi,r=function(t,a){var n,o=t.find("li");for(i=o.length-1;i>=0;i--)n=angular.element("<"+a+">"+o[i].innerHTML+"</"+a+">"),t.after(n);t.remove(),e.setSelectionToElementEnd(n[0])},l=function(t,a){var n=angular.element("<"+a+">"+t[0].innerHTML+"</"+a+">");t.after(n),t.remove(),e.setSelectionToElementEnd(n.find("li")[0])},s=function(a,n,o){var r="";for(i=a.length-1;i>=0;i--)r+="<"+t("li")+">"+a[i].innerHTML+"</"+t("li")+">";var l=angular.element("<"+o+">"+r+"</"+o+">");n.after(l),n.remove(),e.setSelectionToElementEnd(l.find("li")[0])};return function(i){return i=t(i),function(d,u,c){var p,f,m,g,h=angular.element("<"+i+">"),v=e.getSelectionElement(),y=angular.element(v);if(void 0!==v){var b=v.tagName.toLowerCase();if("insertorderedlist"===d.toLowerCase()||"insertunorderedlist"===d.toLowerCase()){var E=t("insertorderedlist"===d.toLowerCase()?"ol":"ul");if(b===E)return r(y,i);if("li"===b&&y.parent()[0].tagName.toLowerCase()===E&&1===y.parent().children().length)return r(y.parent(),i);if("li"===b&&y.parent()[0].tagName.toLowerCase()!==E&&1===y.parent().children().length)return l(y.parent(),E);if(b.match(n)&&!y.hasClass("ta-bind"))return"ol"===b||"ul"===b?l(y,E):v.innerHTML.match(n)?s(y.children(),y,E):s(angular.element("<div>"+v.innerHTML+"</div>"),y,E);if(b.match(n)){if(g=e.getOnlySelectedElements(),1===g.length&&("ol"===g[0].tagName.toLowerCase()||"ul"===g[0].tagName.toLowerCase()))return g[0].tagName.toLowerCase()===E?r(angular.element(g[0]),i):l(angular.element(g[0]),E);m="";var x=[];for(p=0;p<g.length;p++)if(3!==g[p].nodeType){var T=angular.element(g[p]);m+="<"+t("li")+">"+T[0].innerHTML+"</"+t("li")+">",x.unshift(T)}return f=angular.element("<"+E+">"+m+"</"+E+">"),x.pop().replaceWith(f),angular.forEach(x,function(e){e.remove()}),void e.setSelectionToElementEnd(f[0])}}else if("formatblock"===d.toLowerCase()){for(f="li"===b?y.parent():y;!f[0].tagName.match(n);)f=f.parent();if(b===c.toLowerCase().replace(/[<>]/gi,""))h.append(f[0].innerHTML),f.after(h),f.remove(),f=h;else if(f.parent()[0].tagName.toLowerCase()!==c.toLowerCase().replace(/[<>]/gi,"")||f.parent().hasClass("ta-bind"))if(b.match(o))f.wrap(c);else{if(g=e.getOnlySelectedElements(),0===g.length&&(g=[f[0]]),m="",1===g.length&&3===g[0].nodeType)for(g[0]=g[0].parentNode;!g[0].tagName.match(n);)g[0]=g[0].parentNode;for(p=0;p<g.length;p++)m+=g[p].outerHTML;f=angular.element(c),f[0].innerHTML=m,g[0].parentNode.insertBefore(f[0],g[0]),angular.forEach(g,function(e){e.parentNode.removeChild(e)})}else{var w=f.parent(),S=w.contents();for(p=0;p<S.length;p++)w.parent().hasClass("ta-bind")&&3===S[p].nodeType&&(h=angular.element("<"+i+">"),h[0].innerHTML=S[p].outerHTML,S[p]=h[0]),w.parent()[0].insertBefore(S[p],w[0]);w.remove()}return void e.setSelectionToElementEnd(f[0])}}try{a[0].execCommand(d,u,c)}catch(C){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers",function(e,t,a,r,i,d,c,p,f){return{require:"ngModel",scope:{},link:function(d,m,g,h){var v,y,b=void 0!==m.attr("contenteditable")&&m.attr("contenteditable"),E=b||"textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase(),x=!1,T=!1;void 0===g.taDefaultWrap&&(g.taDefaultWrap="p"),""===g.taDefaultWrap?(v="",y=void 0===o?"<div><br></div>":o>=11?"<p><br></p>":8>=o?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(v=void 0===o||o>=11?"<"+g.taDefaultWrap+"><br></"+g.taDefaultWrap+">":8>=o?"<"+g.taDefaultWrap.toUpperCase()+"></"+g.taDefaultWrap.toUpperCase()+">":"<"+g.taDefaultWrap+"></"+g.taDefaultWrap+">",y=void 0===o||o>=11?"<"+g.taDefaultWrap+"><br></"+g.taDefaultWrap+">":8>=o?"<"+g.taDefaultWrap.toUpperCase()+">&nbsp;</"+g.taDefaultWrap.toUpperCase()+">":"<"+g.taDefaultWrap+">&nbsp;</"+g.taDefaultWrap+">"),m.addClass("ta-bind");var w=function(){if(b)return m[0].innerHTML;if(E)return m.val();throw"textAngular Error: attempting to update non-editable taBind"};if(d.$parent["updateTaBind"+(g.id||"")]=function(){x||h.$setViewValue(w())},E)if(b){if(m.on("cut",function(e){x?e.preventDefault():t(function(){h.$setViewValue(w())},0)}),m.on("paste",function(e,t){t&&angular.extend(e,t);var n;if(e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData?n=(e.originalEvent||e).clipboardData.getData("text/plain"):a.clipboardData&&(n=a.clipboardData.getData("Text")),!n&&!x)return!0;if(e.preventDefault(),!x){var o=angular.element("<div></div>");if(o[0].innerHTML=n,n=o.text(),r[0].selection){var l=r[0].selection.createRange();l.pasteHTML(n)}else r[0].execCommand("insertText",!1,n);h.$setViewValue(w())}}),m.on("keyup",function(e,t){if(t&&angular.extend(e,t),!x){if(""!==v&&13===e.keyCode&&!e.shiftKey){var a=c.getSelectionElement();if(a.tagName.toLowerCase()!==g.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||"<br>"===a.innerHTML.trim())){var n=angular.element(v);angular.element(a).replaceWith(n),c.setSelectionToElementStart(n[0])}}var o=w();""!==v&&""===o.trim()&&(m[0].innerHTML=v,c.setSelectionToElementStart(m.children()[0])),h.$setViewValue(o)}}),m.on("blur",function(){T=!1;var e=w();x||(e===y?h.$setViewValue(""):h.$setViewValue(w())),h.$render()}),g.placeholder&&(o>8||void 0===o)){var S;if(!g.id)throw"textAngular Error: An unique ID is required for placeholders to work";S=l("#"+g.id+".placeholder-text:before",'content: "'+g.placeholder+'"'),d.$on("$destroy",function(){s(S)})}m.on("focus",function(){T=!0,h.$render()})}else m.on("paste cut",function(){x||t(function(){h.$setViewValue(w())},0)}),m.on("change blur",function(){x||h.$setViewValue(w())});var C=function(t){return h.$oldViewValue=e(i(t),h.$oldViewValue)};h.$parsers.push(C),h.$formatters.push(C);var A=function(e){return d.$emit("ta-element-select",this),e.preventDefault(),!1},$=function(e,a){if(a&&angular.extend(e,a),!u&&!x){u=!0;var n;n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,d.$emit("ta-drop-event",this,e,n),t(function(){u=!1},100)}};d.$parent["reApplyOnSelectorHandlers"+(g.id||"")]=function(){x||angular.forEach(p,function(e){m.find(e).off("click",A).on("click",A)})},h.$render=function(){var e=h.$viewValue||"";r[0].activeElement!==m[0]?b?(g.placeholder?""===e?(T?m.removeClass("placeholder-text"):m.addClass("placeholder-text"),m[0].innerHTML=v):(m.removeClass("placeholder-text"),m[0].innerHTML=e):""===e?m[0].innerHTML=v:m[0].innerHTML=e,x?m.off("drop",$):(angular.forEach(p,function(e){m.find(e).on("click",A)}),m.on("drop",$))):"textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()?m[0].innerHTML=f(e):m.val(e):b&&m.removeClass("placeholder-text")},g.taReadonly&&(x=d.$parent.$eval(g.taReadonly),x?("textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()||m.attr("disabled","disabled"),void 0!==m.attr("contenteditable")&&m.attr("contenteditable")&&m.removeAttr("contenteditable")):"textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase()?m.removeAttr("disabled"):b&&m.attr("contenteditable","true"),d.$parent.$watch(g.taReadonly,function(e,t){t!==e&&(e?("textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()||m.attr("disabled","disabled"),void 0!==m.attr("contenteditable")&&m.attr("contenteditable")&&m.removeAttr("contenteditable"),angular.forEach(p,function(e){m.find(e).on("click",A)}),m.off("drop",$)):("textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase()?m.removeAttr("disabled"):b&&m.attr("contenteditable","true"),angular.forEach(p,function(e){m.find(e).off("click",A)}),m.on("drop",$)),x=e)})),b&&!x&&(angular.forEach(p,function(e){m.find(e).on("click",A)}),m.on("drop",$),m.on("blur",function(){/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(n=!0)}))}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(e){return function(a){var n=angular.element("<div></div>");return n[0].innerHTML=a,angular.forEach(e,function(e){var a=[];e.selector&&""!==e.selector?a=n.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(a=t(n,e.customAttribute)),angular.forEach(a,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),n[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function o(e){var t=angular.element("<div/>");t.html(e);var a=t.text().length;return r>=a?(n.$setValidity("taMaxText",!0),e):void n.$setValidity("taMaxText",!1)}var r=parseInt(e.$eval(a.taMaxText));if(isNaN(r))throw"Max text must be an integer";a.$observe("taMaxText",function(e){if(r=parseInt(e),isNaN(r))throw"Max text must be an integer";n.$dirty&&n.$setViewValue(n.$viewValue)}),n.$parsers.unshift(o)}}}).factory("taFixChrome",function(){var e=function(e){for(var t=angular.element("<div>"+e+"</div>"),a=angular.element(t).find("span"),n=0;n<a.length;n++){var o=angular.element(a[n]);o.attr("style")&&o.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(o.attr("style",o.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,"")),o.attr("style")&&""!==o.attr("style")||(o.next().length>0&&"BR"===o.next()[0].tagName&&o.next().remove(),o.replaceWith(o[0].innerHTML)))}var r=t[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return r!==t[0].innerHTML&&(t[0].innerHTML=r),t[0].innerHTML};return e}).factory("taSanitize",["$sanitize",function(e){return function(a,n){var o=angular.element("<div>"+a+"</div>");angular.forEach(t(o,"align"),function(e){e.css("text-align",e.attr("align")),e.removeAttr("align")}),a=o[0].innerHTML;var r;try{r=e(a)}catch(l){r=n||""}return r}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,a,n,o,r){return{scope:{name:"@"},restrict:"EA",link:function(l,i,s){if(!l.name||""===l.name)throw"textAngular Error: A toolbar requires a name";angular.extend(l,angular.copy(a)),s.taToolbar&&(l.toolbar=l.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(l.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(l.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(l.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(l.classes.focussed=s.taFocussedClass),l.disabled=!0,l.focussed=!1,l._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+l.classes.toolbar),l.$watch("focussed",function(){l.focussed?i.addClass(l.classes.focussed):i.removeClass(l.classes.focussed)});var d=function(t,a){var n;if(n=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),n.addClass(l.classes.toolbarButton),n.attr("name",a.name),n.attr("unselectable","on"),n.attr("ng-disabled","isDisabled()"),n.attr("tabindex","-1"),n.attr("ng-click","executeAction()"),n.attr("ng-class","displayActiveToolClass(active)"),n.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!a._display&&(n[0].innerHTML="",t.buttontext&&(n[0].innerHTML=t.buttontext),t.iconclass)){var o=angular.element("<i>"),r=n[0].innerHTML;o.addClass(t.iconclass),n[0].innerHTML="",n.append(o),r&&""!==r&&n.append("&nbsp;"+r)}return a._lastToolDefinition=angular.copy(t),e(n)(a)};l.tools={},l._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1}};var u={$window:r,$editor:function(){return l._parent},isDisabled:function(){return this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?l.classes.toolbarButtonActive:""},executeAction:o};angular.forEach(l.toolbar,function(e){var t=angular.element("<div>");t.addClass(l.classes.toolbarGroup),angular.forEach(e,function(e){l.tools[e]=angular.extend(l.$new(!0),n[e],u,{name:e}),l.tools[e].$element=d(n[e],l.tools[e]),t.append(l.tools[e].$element)}),i.append(t)}),l.updateToolDisplay=function(e,t,a){var n=l.tools[e];if(n){if(n._lastToolDefinition&&!a&&(t=angular.extend({},n._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var o=d(t,n);n.$element.replaceWith(o),n.$element=o}},l.addTool=function(e,t,a,o){l.tools[e]=angular.extend(l.$new(!0),n[e],u,{name:e}),l.tools[e].$element=d(n[e],l.tools[e]);var r;void 0===a&&(a=l.toolbar.length-1),r=angular.element(i.children()[a]),void 0===o?(r.append(l.tools[e].$element),l.toolbar[a][l.toolbar[a].length-1]=e):(r.children().eq(o).after(l.tools[e].$element),l.toolbar[a][o]=e)},t.registerToolbar(l),l.$on("$destroy",function(){t.unregisterToolbar(l.name)})}}}]).service("taToolExecuteAction",["$q",function(e){return function(t){void 0!==t&&(this.$editor=function(){return t});var a=e.defer(),n=a.promise,o=this.$editor();n["finally"](function(){o.endAction.call(o)});var r;try{r=this.action(a,o.startAction())}catch(l){}(r||void 0===r)&&a.resolve()}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,a){var n={},o={};return{registerEditor:function(a,r,l){if(!a||""===a)throw"textAngular Error: An editor requires a name";if(!r)throw"textAngular Error: An editor requires a scope";if(o[a])throw'textAngular Error: An Editor with name "'+a+'" already exists';var i=[];return angular.forEach(l,function(e){n[e]&&i.push(n[e])}),o[a]={scope:r,toolbars:l,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&i.push(e)},editorFunctions:{disable:function(){angular.forEach(i,function(e){e.disabled=!0})},enable:function(){angular.forEach(i,function(e){e.disabled=!1})},focus:function(){angular.forEach(i,function(e){e._parent=r,e.disabled=!1,e.focussed=!0})},unfocus:function(){angular.forEach(i,function(e){e.disabled=!0,e.focussed=!1})},updateSelectedStyles:function(e){angular.forEach(i,function(t){angular.forEach(t.tools,function(t){t.activeState&&(t.active=t.activeState(e))})})},sendKeyCommand:function(a){var n=!1;return(a.ctrlKey||a.metaKey)&&angular.forEach(t,function(t,o){if(t.commandKeyCode&&t.commandKeyCode===a.which)for(var l=0;l<i.length;l++)if(void 0!==i[l].tools[o]){e.call(i[l].tools[o],r),n=!0;break}}),n},triggerElementSelect:function(e,a){var n=function(e,t){for(var a=!0,n=0;n<t.length;n++)a=a&&e.attr(t[n]);return a},o=[],l={},s=!1;a=angular.element(a);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===a[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(a))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&n(a,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!n(a,e.onElementSelect.onlyWithAttrs)||(l[t]=e))}),d?(angular.forEach(l,function(e,t){e.onElementSelect.onlyWithAttrs&&n(a,e.onElementSelect.onlyWithAttrs)&&o.push({name:t,tool:e})}),o.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(l,function(e,t){o.push({name:t,tool:e})}),o.length>0)for(var u=o[0].tool,c=o[0].name,p=0;p<i.length;p++)if(void 0!==i[p].tools[c]){u.onElementSelect.action.call(i[p].tools[c],e,a,r),s=!0;break}return s}}},o[a].editorFunctions},retrieveEditor:function(e){return o[e]},unregisterEditor:function(e){delete o[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(n[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';n[e.name]=e,angular.forEach(o,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return n[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){
t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete n[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,a){t.updateToolDisplay(a,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,a){e.resetToolDisplay(a)})},updateToolDisplay:function(e,t){var a=this;angular.forEach(n,function(n,o){a.updateToolbarToolDisplay(o,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(n,function(a,n){t.resetToolbarToolDisplay(n,e)})},updateToolbarToolDisplay:function(e,t,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(a,t[a],!0)},removeTool:function(e){delete t[e],angular.forEach(n,function(t){delete t.tools[e];for(var a=0;a<t.toolbar.length;a++){for(var n,o=0;o<t.toolbar[a].length;o++){if(t.toolbar[a][o]===e){n={group:a,index:o};break}if(void 0!==n)break}void 0!==n&&(t.toolbar[n.group].slice(n.index,1),t._$element.children().eq(n.group).children().eq(n.index).remove())}})},addTool:function(e,t,o,r){a(e,t),angular.forEach(n,function(a){a.addTool(e,t,o,r)})},addToolToToolbar:function(e,t,o,r,l){a(e,t),n[o].addTool(e,t,r,l)},refreshEditor:function(e){if(!o[e])throw'textAngular Error: No Editor with name "'+e+'" exists';o[e].scope.updateTaBindtaTextElement(),o[e].scope.$$phase||o[e].scope.$digest()}}}]).service("taSelection",["$window","$document",function(e,t){_document=t[0];var a=function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},n=function(e){var t=e.startContainer,n=e.endContainer;if(t===n)return[t];for(var o=[];t&&t!==n;)t=a(t),t.parentNode===e.commonAncestorContainer&&o.push(t);for(t=e.startContainer;t&&t!==e.commonAncestorContainer;)t.parentNode===e.commonAncestorContainer&&o.unshift(t),t=t.parentNode;return o};return{getOnlySelectedElements:function(){if(window.getSelection){var t=e.getSelection();if(!t.isCollapsed)return n(t.getRangeAt(0))}return[]},getSelectionElement:function(){var t,a,n;return _document.selection&&_document.selection.createRange?(t=_document.selection.createRange(),t.parentElement()):e.getSelection&&(a=e.getSelection(),a.getRangeAt?a.rangeCount>0&&(t=a.getRangeAt(0)):(t=_document.createRange(),t.setStart(a.anchorNode,a.anchorOffset),t.setEnd(a.focusNode,a.focusOffset),t.collapsed!==a.isCollapsed&&(t.setStart(a.focusNode,a.focusOffset),t.setEnd(a.anchorNode,a.anchorOffset))),t)?(n=t.commonAncestorContainer,3===n.nodeType?n.parentNode:n):void 0},setSelectionToElementStart:function(t){if(_document.createRange&&e.getSelection){var a=_document.createRange();a.selectNodeContents(t),a.setStart(t,0),a.setEnd(t,0);var n=e.getSelection();n.removeAllRanges(),n.addRange(a)}else if(_document.selection&&_document.body.createTextRange){var o=_document.body.createTextRange();o.moveToElementText(t),o.collapse(!0),o.moveEnd("character",0),o.moveStart("character",0),o.select()}},setSelectionToElementEnd:function(t){if(_document.createRange&&e.getSelection){var a=_document.createRange();a.selectNodeContents(t),a.collapse(!1);var n=e.getSelection();n.removeAllRanges(),n.addRange(a)}else if(_document.selection&&_document.body.createTextRange){var o=_document.body.createTextRange();o.moveToElementText(t),o.collapse(!1),o.select()}}}}])}();
//# sourceMappingURL=./textAngular.min.js.map