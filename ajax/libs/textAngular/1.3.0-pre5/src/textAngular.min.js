!function(){"Use Strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(e,a){var n=[],r=e.children();return r.length&&angular.forEach(r,function(e){n=n.concat(t(angular.element(e),a))}),void 0!==e.attr(a)&&n.push(e),n}function a(t,a){if(!t||""===t||v.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(a.display&&(""===a.display||!e(a.display))||!a.display&&!a.buttontext&&!a.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';v[t]=a}if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js are required for textAngular to work correctly.";var n=!1;/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(document.addEventListener("click",function(e){var t=e||window.event,a=t.target;if(n&&null!==a){for(var r=!1,l=a;null!==l&&"html"!==l.tagName.toLowerCase()&&!r;)r="true"===l.contentEditable,l=l.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),a.focus())}n=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000px; left: -10000px;" unselectable="on" tabIndex="-1">'))}));var r=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/gi,l=/^(ul|li|ol)$/gi,o=function(){var e,t=-1,a=window.navigator.userAgent,n=a.indexOf("MSIE "),r=a.indexOf("Trident/");if(n>0)t=parseInt(a.substring(n+5,a.indexOf(".",n)),10);else if(r>0){var l=a.indexOf("rv:");t=parseInt(a.substring(l+3,a.indexOf(".",l)),10)}return t>-1?t:e}();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var i,s,d,u,c;if(o>8||void 0===o){for(var p,f=document.styleSheets,m=0;m<f.length;m++)if((0===f[m].media.length||f[m].media.mediaText.match(/(all|screen)/gi))&&f[m].href){if(f[m].href.match(/textangular\.(min\.|)css/gi)){i=f[m];break}p=f[m]}!i&&p?i=p:i||(i=function(){var e=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}()),s=function(e,t){u(i,e,t)},u=function(e,t,a){var n;return e.rules?n=Math.max(e.rules.length-1,0):e.cssRules&&(n=Math.max(e.cssRules.length-1,0)),e.insertRule?e.insertRule(t+"{"+a+"}",n):e.addRule(t,a,n),n},d=function(e){c(i,e)},c=function(e,t){e.removeRule?e.removeRule(t):e.deleteRule(t)}}var h=!1,g=angular.module("textAngular",["ngSanitize","textAngularSetup"]),v={};g.constant("taRegisterTool",a),g.value("taTools",v),g.config([function(){angular.forEach(v,function(e,t){delete v[t]})}]),g.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q",function(e,t,a,n,r,l,o,i,s,d,u){return{require:"?ngModel",scope:{},restrict:"EA",link:function(c,p,f,m){var h,g,v,y,E,b,x,T,w,C=f.serial?f.serial:Math.floor(1e16*Math.random()),S=f.name?f.name:"textAngularEditor"+C,$=function(e,a,n){t(function(){var t=function(){e.off(a,t),n()};e.on(a,t)},100)};w=r(f.taDefaultWrap),angular.extend(c,angular.copy(a),{wrapSelection:function(e,t,a){w(e,!1,t),a&&c["reApplyOnSelectorHandlerstaTextElement"+C](),c.displayElements.text[0].focus()},showHtml:!1}),f.taFocussedClass&&(c.classes.focussed=f.taFocussedClass),f.taTextEditorClass&&(c.classes.textEditor=f.taTextEditorClass),f.taHtmlEditorClass&&(c.classes.htmlEditor=f.taHtmlEditorClass),f.taTextEditorSetup&&(c.setup.textEditorSetup=c.$parent.$eval(f.taTextEditorSetup)),f.taHtmlEditorSetup&&(c.setup.htmlEditorSetup=c.$parent.$eval(f.taHtmlEditorSetup)),f.taFileDrop?c.fileDropHandler=c.$parent.$eval(f.taFileDrop):c.fileDropHandler=c.defaultFileDropHandler,x=p[0].innerHTML,p[0].innerHTML="",c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},c.displayElements.popover.append(c.displayElements.popoverArrow),c.displayElements.popover.append(c.displayElements.popoverContainer),c.displayElements.scrollWindow.append(c.displayElements.popover),c.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),c.showPopover=function(e){c.displayElements.popover.css("display","block"),c.reflowPopover(e),s.addClass(c.displayElements.popover,"in"),$(p,"click keyup",function(){c.hidePopover()})},c.reflowPopover=function(e){c.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(c.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+"px"),c.displayElements.popover.removeClass("top").addClass("bottom")):(c.displayElements.popover.css("top",e[0].offsetTop-54+"px"),c.displayElements.popover.removeClass("bottom").addClass("top"));var t=c.displayElements.text[0].offsetWidth-c.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-c.displayElements.popover[0].offsetWidth/2;c.displayElements.popover.css("left",Math.max(0,Math.min(t,a))+"px"),c.displayElements.popoverArrow.css("margin-left",Math.min(a,Math.max(0,a-t))-11+"px")},c.hidePopover=function(){s.removeClass(c.displayElements.popover,"in",function(){c.displayElements.popover.css("display",""),c.displayElements.popoverContainer.attr("style",""),c.displayElements.popoverContainer.attr("class","popover-content")})},c.displayElements.resize.overlay.append(c.displayElements.resize.background),angular.forEach(c.displayElements.resize.anchors,function(e){c.displayElements.resize.overlay.append(e)}),c.displayElements.resize.overlay.append(c.displayElements.resize.info),c.displayElements.scrollWindow.append(c.displayElements.resize.overlay),c.reflowResizeOverlay=function(e){e=angular.element(e)[0],c.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),c.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},c.showResizeOverlay=function(e){var t=function(t){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:t.clientX,y:t.clientY};void 0===a.width&&(a.width=e[0].offsetWidth),void 0===a.height&&(a.height=e[0].offsetHeight),c.hidePopover();var n=a.height/a.width,r=function(t){var r={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},l=function(e,t){e=angular.element(e),"img"===e[0].tagName.toLowerCase()&&(t.height&&(e.attr("height",t.height),delete t.height),t.width&&(e.attr("width",t.width),delete t.width)),e.css(t)};if(t.shiftKey){var o=r.y/r.x;l(e,{width:n>o?r.x:r.y/n,height:n>o?r.x*n:r.y})}else l(e,{width:r.x,height:r.y});c.reflowResizeOverlay(e)};i.find("body").on("mousemove",r),$(c.displayElements.resize.overlay,"mouseup",function(){i.find("body").off("mousemove",r),c.showPopover(e)}),t.stopPropagation(),t.preventDefault()};c.displayElements.resize.anchors[3].on("mousedown",t),c.reflowResizeOverlay(e),$(p,"click",function(){c.hideResizeOverlay()})},c.hideResizeOverlay=function(){c.displayElements.resize.overlay.css("display","")},c.setup.htmlEditorSetup(c.displayElements.html),c.setup.textEditorSetup(c.displayElements.text),c.displayElements.html.attr({id:"taHtmlElement"+C,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),c.displayElements.text.attr({id:"taTextElement"+C,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),c.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),f.taDefaultWrap&&c.displayElements.text.attr("ta-default-wrap",f.taDefaultWrap),f.taUnsafeSanitizer&&(c.displayElements.text.attr("ta-unsafe-sanitizer",f.taUnsafeSanitizer),c.displayElements.html.attr("ta-unsafe-sanitizer",f.taUnsafeSanitizer)),c.displayElements.scrollWindow.append(c.displayElements.text),p.append(c.displayElements.scrollWindow),p.append(c.displayElements.html),c.displayElements.forminput.attr("name",S),p.append(c.displayElements.forminput),f.tabindex&&(p.removeAttr("tabindex"),c.displayElements.text.attr("tabindex",f.tabindex),c.displayElements.html.attr("tabindex",f.tabindex)),f.placeholder&&(c.displayElements.text.attr("placeholder",f.placeholder),c.displayElements.html.attr("placeholder",f.placeholder)),f.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(f.taDisabled),c.$parent.$watch(f.taDisabled,function(e){c.disabled=e,c.disabled?p.addClass(c.classes.disabled):p.removeClass(c.classes.disabled)})),e(c.displayElements.scrollWindow)(c),e(c.displayElements.html)(c),c.updateTaBindtaTextElement=c["updateTaBindtaTextElement"+C],c.updateTaBindtaHtmlElement=c["updateTaBindtaHtmlElement"+C],p.addClass("ta-root"),c.displayElements.scrollWindow.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.htmlEditor),c._actionRunning=!1;var L=!1;if(c.startAction=function(){return c._actionRunning=!0,L=o.rangy.saveSelection(),function(){L&&o.rangy.restoreSelection(L)}},c.endAction=function(){c._actionRunning=!1,L&&o.rangy.removeMarkers(L),L=!1,c.updateSelectedStyles(),c.showHtml||c["updateTaBindtaTextElement"+C]()},E=function(){p.addClass(c.classes.focussed),T.focus()},c.displayElements.html.on("focus",E),c.displayElements.text.on("focus",E),b=function(e){return c._actionRunning||i[0].activeElement===c.displayElements.html[0]||i[0].activeElement===c.displayElements.text[0]||(p.removeClass(c.classes.focussed),T.unfocus(),t(function(){p.triggerHandler("blur")},0)),e.preventDefault(),!1},c.displayElements.html.on("blur",b),c.displayElements.text.on("blur",b),c.queryFormatBlockState=function(e){return!c.showHtml&&e.toLowerCase()===i[0].queryCommandValue("formatBlock").toLowerCase()},c.queryCommandState=function(e){return c.showHtml?"":i[0].queryCommandState(e)},c.switchView=function(){c.showHtml=!c.showHtml,s.enabled(!1,c.displayElements.html),s.enabled(!1,c.displayElements.text),c.showHtml?t(function(){return s.enabled(!0,c.displayElements.html),s.enabled(!0,c.displayElements.text),c.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,c.displayElements.html),s.enabled(!0,c.displayElements.text),c.displayElements.text[0].focus()},100)},f.ngModel){var A=!0;m.$render=function(){if(A){A=!1;var e=c.$parent.$eval(f.ngModel);void 0!==e&&null!==e||!x||""===x||m.$setViewValue(x)}c.displayElements.forminput.val(m.$viewValue),c._elementSelectTriggered||i[0].activeElement===c.displayElements.html[0]||i[0].activeElement===c.displayElements.text[0]||(c.html=m.$viewValue||"")};var M=function(e){return f.required&&m.$setValidity("required",!(!e||""===e.trim())),e};m.$parsers.push(M),m.$formatters.push(M)}else c.displayElements.forminput.val(x),c.html=x;if(c.$watch("html",function(e,t){e!==t&&(f.ngModel&&m.$viewValue!==e&&m.$setViewValue(e),c.displayElements.forminput.val(e))}),f.taTargetToolbars)T=l.registerEditor(S,c,f.taTargetToolbars.split(","));else{var H=angular.element('<div text-angular-toolbar name="textAngularToolbar'+C+'">');f.taToolbar&&H.attr("ta-toolbar",f.taToolbar),f.taToolbarClass&&H.attr("ta-toolbar-class",f.taToolbarClass),f.taToolbarGroupClass&&H.attr("ta-toolbar-group-class",f.taToolbarGroupClass),f.taToolbarButtonClass&&H.attr("ta-toolbar-button-class",f.taToolbarButtonClass),f.taToolbarActiveButtonClass&&H.attr("ta-toolbar-active-button-class",f.taToolbarActiveButtonClass),f.taFocussedClass&&H.attr("ta-focussed-class",f.taFocussedClass),p.prepend(H),e(H)(c.$parent),T=l.registerEditor(S,c,["textAngularToolbar"+C])}c.$on("$destroy",function(){l.unregisterEditor(S)}),c.$on("ta-element-select",function(e,t){T.triggerElementSelect(e,t)}),c.$on("ta-drop-event",function(e,t,a,n){c.displayElements.text[0].focus(),n&&n.files&&n.files.length>0&&(angular.forEach(n.files,function(e){try{u.when(c.fileDropHandler(e,c.wrapSelection)||c.fileDropHandler!==c.defaultFileDropHandler&&c.defaultFileDropHandler(e,c.wrapSelection))["finally"](function(){c["updateTaBindtaTextElement"+C]()})}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation())}),c._bUpdateSelectedStyles=!1,c.updateSelectedStyles=function(){var e;void 0!==(e=n.getSelectionElement())&&e.parentNode!==c.displayElements.text[0]?T.updateSelectedStyles(angular.element(e)):T.updateSelectedStyles(),c._bUpdateSelectedStyles&&t(c.updateSelectedStyles,200)},h=function(){c._bUpdateSelectedStyles||(c._bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()}))},c.displayElements.html.on("keydown",h),c.displayElements.text.on("keydown",h),g=function(){c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",g),c.displayElements.text.on("keyup",g),v=function(e,t){t&&angular.extend(e,t),c.$apply(function(){return T.sendKeyCommand(e)?(c._bUpdateSelectedStyles||c.updateSelectedStyles(),e.preventDefault(),!1):void 0})},c.displayElements.html.on("keypress",v),c.displayElements.text.on("keypress",v),y=function(){c._bUpdateSelectedStyles=!1,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("mouseup",y),c.displayElements.text.on("mouseup",y)}}}]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===o?"div":8>=o?"P":"p":8>=o?e.toUpperCase():e:8>=o?"P":"p"}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,a){var n=function(t,a){var n,r,l=t.find("li");for(r=l.length-1;r>=0;r--)n=angular.element("<"+a+">"+l[r].innerHTML+"</"+a+">"),t.after(n);t.remove(),e.setSelectionToElementEnd(n[0])},o=function(t,a){var n=angular.element("<"+a+">"+t[0].innerHTML+"</"+a+">");t.after(n),t.remove(),e.setSelectionToElementEnd(n.find("li")[0])},i=function(a,n,r){for(var l="",o=0;o<a.length;o++)l+="<"+t("li")+">"+a[o].innerHTML+"</"+t("li")+">";var i=angular.element("<"+r+">"+l+"</"+r+">");n.after(i),n.remove(),e.setSelectionToElementEnd(i.find("li")[0])};return function(s){return s=t(s),function(d,u,c){var p,f,m,h,g,v,y,E=angular.element("<"+s+">");try{y=e.getSelectionElement()}catch(b){}var x=angular.element(y);if(void 0!==y){var T=y.tagName.toLowerCase();if("insertorderedlist"===d.toLowerCase()||"insertunorderedlist"===d.toLowerCase()){var w=t("insertorderedlist"===d.toLowerCase()?"ol":"ul");if(T===w)return n(x,s);if("li"===T&&x.parent()[0].tagName.toLowerCase()===w&&1===x.parent().children().length)return n(x.parent(),s);if("li"===T&&x.parent()[0].tagName.toLowerCase()!==w&&1===x.parent().children().length)return o(x.parent(),w);if(T.match(r)&&!x.hasClass("ta-bind")){if("ol"===T||"ul"===T)return o(x,w);var C=!1;return angular.forEach(x.children(),function(e){e.tagName.match(r)&&(C=!0)}),C?i(x.children(),x,w):i([angular.element("<div>"+y.innerHTML+"</div>")[0]],x,w)}if(T.match(r)){if(h=e.getOnlySelectedElements(),1===h.length&&("ol"===h[0].tagName.toLowerCase()||"ul"===h[0].tagName.toLowerCase()))return h[0].tagName.toLowerCase()===w?n(angular.element(h[0]),s):o(angular.element(h[0]),w);m="";var S=[];for(p=0;p<h.length;p++)if(3!==h[p].nodeType){var $=angular.element(h[p]);m+="<"+t("li")+">"+$[0].innerHTML+"</"+t("li")+">",S.unshift($)}return f=angular.element("<"+w+">"+m+"</"+w+">"),S.pop().replaceWith(f),angular.forEach(S,function(e){e.remove()}),void e.setSelectionToElementEnd(f[0])}}else{if("formatblock"===d.toLowerCase()){for(v=c.toLowerCase().replace(/[<>]/gi,""),f="li"===T?x.parent():x;!f[0].tagName.match(r);)f=f.parent(),T=f[0].tagName.toLowerCase();if(T===v){h=f.children();var L=!1;for(p=0;p<h.length;p++)L=L||h[p].tagName.match(r);L?(f.after(h),g=f.next(),f.remove(),f=g):(E.append(f[0].childNodes),f.after(E),f.remove(),f=E)}else if(f.parent()[0].tagName.toLowerCase()!==v||f.parent().hasClass("ta-bind"))if(T.match(l))f.wrap(c);else{h=e.getOnlySelectedElements(),0===h.length&&(h=[f[0]]);var A=!1;if(angular.forEach(h,function(e){3!==e.nodeType&&e.tagName.match(r)||(A=!0)}),A)for(;3===h[0].nodeType||!h[0].tagName.match(r);)h=[h[0].parentNode];if(angular.element(h[0]).hasClass("ta-bind"))f=angular.element(c),f[0].innerHTML=h[0].innerHTML,h[0].innerHTML=f[0].outerHTML;else if("blockquote"===v){for(m="",p=0;p<h.length;p++)m+=h[p].outerHTML;f=angular.element(c),f[0].innerHTML=m,h[0].parentNode.insertBefore(f[0],h[0]),angular.forEach(h,function(e){e.parentNode.removeChild(e)})}else for(p=0;p<h.length;p++)f=angular.element(c),f[0].innerHTML=h[p].innerHTML,h[p].parentNode.insertBefore(f[0],h[p]),h[p].parentNode.removeChild(h[p])}else{var M=f.parent(),H=M.contents();for(p=0;p<H.length;p++)M.parent().hasClass("ta-bind")&&3===H[p].nodeType&&(E=angular.element("<"+s+">"),E[0].innerHTML=H[p].outerHTML,H[p]=E[0]),M.parent()[0].insertBefore(H[p],M[0]);M.remove()}return void e.setSelectionToElementEnd(f[0])}if("createlink"===d.toLowerCase()){var N=e.getSelection();if(N.collapsed)return void e.insertHtml('<a href="'+c+'">'+c+"</a>")}else if("inserthtml"===d.toLowerCase())return void e.insertHtml(c)}}try{a[0].execCommand(d,u,c)}catch(b){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions",function(e,t,a,r,l,i,u,c,p,f){return{require:"ngModel",link:function(i,m,g,v){var y,E,b,x=void 0!==m.attr("contenteditable")&&m.attr("contenteditable"),T=x||"textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase(),w=!1,C=!1,S=g.taUnsafeSanitizer||f.disableSanitizer,$=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/;void 0===g.taDefaultWrap&&(g.taDefaultWrap="p"),""===g.taDefaultWrap?(y="",E=void 0===o?"<div><br></div>":o>=11?"<p><br></p>":8>=o?"<P>&nbsp;</P>":"<p>&nbsp;</p>",b=void 0===o?/^<div>(\s|&nbsp;)*<\/div>$/gi:/^<p>(\s|&nbsp;)*<\/p>$/gi):(y=void 0===o||o>=11?"<"+g.taDefaultWrap+"><br></"+g.taDefaultWrap+">":8>=o?"<"+g.taDefaultWrap.toUpperCase()+"></"+g.taDefaultWrap.toUpperCase()+">":"<"+g.taDefaultWrap+"></"+g.taDefaultWrap+">",E=void 0===o||o>=11?"<"+g.taDefaultWrap+"><br></"+g.taDefaultWrap+">":8>=o?"<"+g.taDefaultWrap.toUpperCase()+">&nbsp;</"+g.taDefaultWrap.toUpperCase()+">":"<"+g.taDefaultWrap+">&nbsp;</"+g.taDefaultWrap+">",b=new RegExp("^<"+g.taDefaultWrap+">(\\s|&nbsp;)*<\\/"+g.taDefaultWrap+">$","ig")),m.addClass("ta-bind");var L=function(){if(x)return m[0].innerHTML;if(T)return m.val();throw"textAngular Error: attempting to update non-editable taBind"},A=function(e){e||(e=L()),e===E||e.match(b)?""!==v.$viewValue&&v.$setViewValue(""):v.$viewValue!==e&&v.$setViewValue(e)};if(i["updateTaBind"+(g.id||"")]=function(){w||A()},T)if(x){var M=function(e,t,a){m[0].childNodes&&m[0].childNodes.length>0?a(e,t):(that={s:e,_:t,cb:a},that.callself=function(){M(that.s,that._,that.cb)},setTimeout(that.callself,20))},H=function(n,r){if(text=m[0].innerHTML,m[0].innerHTML=n,a.rangy.restoreSelection(r),text.trim().length){if(text.match(/class=["']*Mso(Normal|List)/i)){var l=text.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);l=l?l[1]:text,l=l.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");for(var o=angular.element("<div>"+l+"</div>"),i={element:null,lastIndent:null,lastLi:null,isUl:!1},s=0;s<=o[0].childNodes.length;s++)if(o[0].childNodes[s]&&"#text"!==o[0].childNodes[s].nodeName&&"p"===o[0].childNodes[s].tagName.toLowerCase()){var d=angular.element(o[0].childNodes[s]),c=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(|CxSp(First|Middle|Last))/i);if(c){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1){d.remove();continue}var p="bullet"===c[1].toLowerCase()||"bullet"!==c[1].toLowerCase()&&!(d[0].childNodes[1].innerHTML.match(/^[0-9a-z]/gi)||d[0].childNodes[1].childNodes[0].innerHTML.match(/^[0-9a-z]/gi)),f=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)pt/i),h=parseFloat(f?f[1]:0);!c[2]||"first"===c[2].toLowerCase()||null===i.lastIndent&&null===i.element||i.isUl!==p&&i.lastIndent===h?(i.isUl=p,i.element=angular.element(p?"<ul>":"<ol>"),d.after(i.element)):null!=i.lastIndent&&i.lastIndent<h?(i.element=angular.element(p?"<ul>":"<ol>"),i.lastLi.append(i.element)):null!=i.lastIndent&&i.lastIndent>h&&(i.element=i.element.parent(),i.isUl="ul"===i.element[0].tagName.toLowerCase(),p!==i.isUl&&(i.isUl=p,i.element=angular.element(p?"<ul>":"<ol>"),d.after(i.element))),i.lastIndent=h,i.lastLi=angular.element("<li>"),i.element.append(i.lastLi),i.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}}text=o.html()}text=e(text),u.insertHtml(text),t(function(){v.$setViewValue(L())},0)}};if(m.on("paste",function(e,t){t&&angular.extend(e,t);var n=a.rangy.saveSelection();if(w)return e.stopPropagation(),e.preventDefault(),!1;var r=m[0].innerHTML,l=(e.originalEvent||e).clipboardData;return l&&l.getData?(/text\/html/.test(l.types)?m[0].innerHTML=l.getData("text/html"):/text\/plain/.test(l.types)?m[0].innerHTML=l.getData("text/plain"):m[0].innerHTML="",M(r,n,H),e.stopPropagation(),e.preventDefault(),!1):(m[0].innerHTML="",M(r,n,H),!0)}),m.on("cut",function(e){w?e.preventDefault():t(function(){v.$setViewValue(L())},0)}),m.on("keyup",function(e,t){if(t&&angular.extend(e,t),!w&&!$.test(e.keyCode)){if(""!==y&&13===e.keyCode&&!e.shiftKey){for(var a=u.getSelectionElement(),n=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/gi;!a.tagName.match(n)&&a!==m[0];)a=a.parentNode;if(a.tagName.toLowerCase()!==g.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||"<br>"===a.innerHTML.trim())){var r=angular.element(y);angular.element(a).replaceWith(r),u.setSelectionToElementStart(r[0])}}var l=L();""!==y&&""===l.trim()&&(m[0].innerHTML=y,u.setSelectionToElementStart(m.children()[0])),A(l)}}),m.on("blur",function(){C=!1,w||A(),v.$render()}),g.placeholder&&(o>8||void 0===o)){var N;if(!g.id)throw"textAngular Error: An unique ID is required for placeholders to work";N=s("#"+g.id+".placeholder-text:before",'content: "'+g.placeholder+'"'),i.$on("$destroy",function(){d(N)})}m.on("focus",function(){C=!0,v.$render()}),m.on("mousedown",function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else m.on("change blur",function(){w||v.$setViewValue(L())});var D=function(t){return v.$oldViewValue=e(l(t),v.$oldViewValue,S)},W=function(e){return g.required&&v.$setValidity("required",!(!e||e.trim()===E||e.trim().match(b)||""===e.trim())),e};v.$parsers.push(D),v.$parsers.push(W),v.$formatters.push(D),v.$formatters.push(W);var k=function(e){return i.$emit("ta-element-select",this),e.preventDefault(),!1},z=function(e,a){if(a&&angular.extend(e,a),!h&&!w){h=!0;var n;n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,i.$emit("ta-drop-event",this,e,n),t(function(){h=!1},100)}},V=i["reApplyOnSelectorHandlers"+(g.id||"")]=function(){w||angular.forEach(c,function(e){m.find(e).off("click",k).on("click",k)})},R=function(e){m[0].innerHTML=e};v.$render=function(){var e=v.$viewValue||"";r[0].activeElement!==m[0]?x?(g.placeholder?""===e?(C?m.removeClass("placeholder-text"):m.addClass("placeholder-text"),R(y)):(m.removeClass("placeholder-text"),R(e)):R(""===e?y:e),w?m.off("drop",z):(V(),m.on("drop",z))):"textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()?R(p(e)):m.val(e):x&&m.removeClass("placeholder-text")},g.taReadonly&&(w=i.$eval(g.taReadonly),w?(m.addClass("ta-readonly"),"textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()||m.attr("disabled","disabled"),void 0!==m.attr("contenteditable")&&m.attr("contenteditable")&&m.removeAttr("contenteditable")):(m.removeClass("ta-readonly"),"textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase()?m.removeAttr("disabled"):x&&m.attr("contenteditable","true")),i.$watch(g.taReadonly,function(e,t){t!==e&&(e?(m.addClass("ta-readonly"),"textarea"!==m[0].tagName.toLowerCase()&&"input"!==m[0].tagName.toLowerCase()||m.attr("disabled","disabled"),void 0!==m.attr("contenteditable")&&m.attr("contenteditable")&&m.removeAttr("contenteditable"),angular.forEach(c,function(e){m.find(e).on("click",k)}),m.off("drop",z)):(m.removeClass("ta-readonly"),"textarea"===m[0].tagName.toLowerCase()||"input"===m[0].tagName.toLowerCase()?m.removeAttr("disabled"):x&&m.attr("contenteditable","true"),angular.forEach(c,function(e){m.find(e).off("click",k)}),m.on("drop",z)),w=e)})),x&&!w&&(angular.forEach(c,function(e){m.find(e).on("click",k)}),m.on("drop",z),m.on("blur",function(){/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(n=!0)}))}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(e){return function(a){var n=angular.element("<div></div>");return n[0].innerHTML=a,angular.forEach(e,function(e){var a=[];e.selector&&""!==e.selector?a=n.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(a=t(n,e.customAttribute)),angular.forEach(a,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),n[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function r(e){var t=angular.element("<div/>");t.html(e);var a=t.text().length;return l>=a?(n.$setValidity("taMaxText",!0),e):void n.$setValidity("taMaxText",!1)}var l=parseInt(e.$eval(a.taMaxText));if(isNaN(l))throw"Max text must be an integer";a.$observe("taMaxText",function(e){if(l=parseInt(e),isNaN(l))throw"Max text must be an integer";n.$dirty&&n.$setViewValue(n.$viewValue)}),n.$parsers.unshift(r)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function r(e){var t=angular.element("<div/>");t.html(e);var a=t.text().length;return!a||a>=l?(n.$setValidity("taMinText",!0),e):void n.$setValidity("taMinText",!1)}var l=parseInt(e.$eval(a.taMinText));if(isNaN(l))throw"Min text must be an integer";a.$observe("taMinText",function(e){if(l=parseInt(e),isNaN(l))throw"Min text must be an integer";n.$dirty&&n.$setViewValue(n.$viewValue)}),n.$parsers.unshift(r)}}}).factory("taFixChrome",function(){var e=function(e){for(var t=angular.element("<div>"+e+"</div>"),a=angular.element(t).find("span"),n=0;n<a.length;n++){var r=angular.element(a[n]);r.attr("style")&&r.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(r.attr("style",r.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,"")),r.attr("style")&&""!==r.attr("style")||(r.next().length>0&&"BR"===r.next()[0].tagName&&r.next().remove(),r.replaceWith(r[0].innerHTML)))}var l=t[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return l!==t[0].innerHTML&&(t[0].innerHTML=l),t[0].innerHTML};return e}).factory("taSanitize",["$sanitize",function(e){return function(a,n,r){var l=angular.element("<div>"+a+"</div>");angular.forEach(t(l,"align"),function(e){e.css("text-align",e.attr("align")),e.removeAttr("align")});var o;a=l[0].innerHTML;try{o=e(a),r&&(o=a)}catch(i){o=n||""}return o}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,a,n,r,l){return{scope:{name:"@"},restrict:"EA",link:function(o,i,s){if(!o.name||""===o.name)throw"textAngular Error: A toolbar requires a name";angular.extend(o,angular.copy(a)),s.taToolbar&&(o.toolbar=o.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(o.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(o.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(o.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(o.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(o.classes.focussed=s.taFocussedClass),o.disabled=!0,o.focussed=!1,o._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+o.classes.toolbar),o.$watch("focussed",function(){o.focussed?i.addClass(o.classes.focussed):i.removeClass(o.classes.focussed)});var d=function(t,a){var n;if(n=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?n.addClass(t["class"]):n.addClass(o.classes.toolbarButton),n.attr("name",a.name),n.attr("unselectable","on"),n.attr("ng-disabled","isDisabled()"),n.attr("tabindex","-1"),n.attr("ng-click","executeAction()"),n.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&n.attr("title",t.tooltiptext),n.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!a._display&&(n[0].innerHTML="",t.buttontext&&(n[0].innerHTML=t.buttontext),t.iconclass)){var r=angular.element("<i>"),l=n[0].innerHTML;r.addClass(t.iconclass),n[0].innerHTML="",n.append(r),l&&""!==l&&n.append("&nbsp;"+l)}return a._lastToolDefinition=angular.copy(t),e(n)(a)};o.tools={},o._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:l,$editor:function(){return o._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?o.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(o.toolbar,function(e){var t=angular.element("<div>");t.addClass(o.classes.toolbarGroup),angular.forEach(e,function(e){o.tools[e]=angular.extend(o.$new(!0),n[e],u,{name:e}),o.tools[e].$element=d(n[e],o.tools[e]),t.append(o.tools[e].$element)}),i.append(t)}),o.updateToolDisplay=function(e,t,a){var n=o.tools[e];if(n){if(n._lastToolDefinition&&!a&&(t=angular.extend({},n._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=d(t,n);n.$element.replaceWith(r),n.$element=r}},o.addTool=function(e,t,a,r){o.tools[e]=angular.extend(o.$new(!0),n[e],u,{name:e}),o.tools[e].$element=d(n[e],o.tools[e]);var l;void 0===a&&(a=o.toolbar.length-1),l=angular.element(i.children()[a]),void 0===r?(l.append(o.tools[e].$element),o.toolbar[a][o.toolbar[a].length-1]=e):(l.children().eq(r).after(o.tools[e].$element),o.toolbar[a][r]=e)},t.registerToolbar(o),o.$on("$destroy",function(){t.unregisterToolbar(o.name)})}}}]).service("taToolExecuteAction",["$q","$log",function(e,t){return function(a){void 0!==a&&(this.$editor=function(){return a});var n=e.defer(),r=n.promise,l=this.$editor();
r["finally"](function(){l.endAction.call(l)});var o;try{o=this.action(n,l.startAction())}catch(i){t.error(i)}(o||void 0===o)&&n.resolve()}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,a){var n={},r={};return{registerEditor:function(a,l,o){if(!a||""===a)throw"textAngular Error: An editor requires a name";if(!l)throw"textAngular Error: An editor requires a scope";if(r[a])throw'textAngular Error: An Editor with name "'+a+'" already exists';var i=[];return angular.forEach(o,function(e){n[e]&&i.push(n[e])}),r[a]={scope:l,toolbars:o,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&i.push(e)},editorFunctions:{disable:function(){angular.forEach(i,function(e){e.disabled=!0})},enable:function(){angular.forEach(i,function(e){e.disabled=!1})},focus:function(){angular.forEach(i,function(e){e._parent=l,e.disabled=!1,e.focussed=!0})},unfocus:function(){angular.forEach(i,function(e){e.disabled=!0,e.focussed=!1})},updateSelectedStyles:function(e){angular.forEach(i,function(t){angular.forEach(t.tools,function(a){a.activeState&&(t._parent=l,a.active=a.activeState(e))})})},sendKeyCommand:function(a){var n=!1;return(a.ctrlKey||a.metaKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&t.commandKeyCode===a.which)for(var o=0;o<i.length;o++)if(void 0!==i[o].tools[r]){e.call(i[o].tools[r],l),n=!0;break}}),n},triggerElementSelect:function(e,a){var n=function(e,t){for(var a=!0,n=0;n<t.length;n++)a=a&&e.attr(t[n]);return a},r=[],o={},s=!1;a=angular.element(a);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===a[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(a))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&n(a,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!n(a,e.onElementSelect.onlyWithAttrs)||(o[t]=e))}),d?(angular.forEach(o,function(e,t){e.onElementSelect.onlyWithAttrs&&n(a,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(o,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var u=0;u<r.length;u++){for(var c=r[u].tool,p=r[u].name,f=0;f<i.length;f++)if(void 0!==i[f].tools[p]){c.onElementSelect.action.call(i[f].tools[p],e,a,l),s=!0;break}if(s)break}return s}}},r[a].editorFunctions},retrieveEditor:function(e){return r[e]},unregisterEditor:function(e){delete r[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(n[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';n[e.name]=e,angular.forEach(r,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return n[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete n[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,a){t.updateToolDisplay(a,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,a){e.resetToolDisplay(a)})},updateToolDisplay:function(e,t){var a=this;angular.forEach(n,function(n,r){a.updateToolbarToolDisplay(r,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(n,function(a,n){t.resetToolbarToolDisplay(n,e)})},updateToolbarToolDisplay:function(e,t,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,a){if(!n[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';n[e].updateToolDisplay(a,t[a],!0)},removeTool:function(e){delete t[e],angular.forEach(n,function(t){delete t.tools[e];for(var a=0;a<t.toolbar.length;a++){for(var n,r=0;r<t.toolbar[a].length;r++){if(t.toolbar[a][r]===e){n={group:a,index:r};break}if(void 0!==n)break}void 0!==n&&(t.toolbar[n.group].slice(n.index,1),t._$element.children().eq(n.group).children().eq(n.index).remove())}})},addTool:function(e,t,r,l){a(e,t),angular.forEach(n,function(a){a.addTool(e,t,r,l)})},addToolToToolbar:function(e,t,r,l,o){a(e,t),n[r].addTool(e,t,l,o)},refreshEditor:function(e){if(!r[e])throw'textAngular Error: No Editor with name "'+e+'" exists';r[e].scope.updateTaBindtaTextElement(),r[e].scope.$$phase||r[e].scope.$digest()}}}]).service("taSelection",["$window","$document",function(e,t){var a=t[0],n=e.rangy,l={getSelection:function(){var e=n.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,{start:{element:e.startContainer,offset:e.startOffset},end:{element:e.endContainer,offset:e.endOffset},container:t,collapsed:e.collapsed}},getOnlySelectedElements:function(){var e=n.getSelection();return e.collapsed?[]:e.getRangeAt(0).getNodes()},getSelectionElement:function(){return l.getSelection().container},setSelection:function(e,t,a){var r=n.createRange();r.setStart(e,t),r.setEnd(e,a),n.getSelection().setSingleRange(r)},setSelectionToElementStart:function(e){var t=n.createRange();t.selectNodeContents(e),t.collapse(!0),n.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=n.createRange();t.selectNodeContents(e),t.collapse(!1),n.getSelection().setSingleRange(t)},insertHtml:function(e){var t,o,i,s,d,u,c,p,f,m=angular.element("<div>"+e+"</div>"),h=n.getSelection().getRangeAt(0),g=a.createDocumentFragment(),v=m[0].childNodes,y=!0;if(v.length>0){s=[];for(i=0;i<v.length;i++)"p"===v[i].nodeName.toLowerCase()&&""===v[i].innerHTML.trim()||3===v[i].nodeType&&""===v[i].nodeValue.trim()||(y=y&&!r.test(v[i].nodeName),s.push(v[i]));for(var E in s)f=g.appendChild(s[E])}else y=!0,f=g=a.createTextNode(e);if(y)h.deleteContents();else if(h.collapsed){if(3===h.startContainer.nodeType){for(t=h.startContainer.parentNode,s=t.childNodes,u=[],c=[],d=0;d<s.length&&(u.push(s[d]),s[d]!==h.startContainer);d++);for(c.push(a.createTextNode(h.startContainer.nodeValue.substring(h.startOffset))),h.startContainer.nodeValue=h.startContainer.nodeValue.substring(0,h.startOffset),p=d+1;p<s.length;p++)c.push(s[p]);o=t.cloneNode(),t.childNodes=u,o.childNodes=c}else t=h.startContainer,o=t.cloneNode(),o.innerHTML=t.innerHTML.substring(h.startOffset),t.innerHTML=t.innerHTML.substring(0,h.startOffset);angular.element(t).after(o),h.setStartAfter(t),h.setEndAfter(t),/^(|<br(|\/)>)$/.test(t.innerHTML.trim())&&(h.setStartBefore(t),h.setEndBefore(t),angular.element(t).remove()),/^(|<br(|\/)>)$/.test(o.innerHTML.trim())&&angular.element(o).remove()}else h.deleteContents();h.insertNode(g),f&&l.setSelectionToElementEnd(f)}};return l}])}();
//# sourceMappingURL=./textAngular.min.js.map