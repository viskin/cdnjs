!function(t){var o,i;if("function"==typeof define&&define.amd)define(["leaflet","proj4"],t);else if("object"==typeof module&&"object"==typeof module.exports)o=require("leaflet"),i=require("proj4"),module.exports=t(o,i);else{if("undefined"==typeof window.L||"undefined"==typeof window.proj4)throw"Leaflet and proj4 must be loaded first";t(window.L,window.proj4)}}(function(t,o){return t.Proj={},t.Proj._isProj4Obj=function(t){return"undefined"!=typeof t.inverse&&"undefined"!=typeof t.forward},t.Proj.ScaleDependantTransformation=function(t){this.scaleTransforms=t},t.Proj.ScaleDependantTransformation.prototype.transform=function(t,o){return this.scaleTransforms[o].transform(t,o)},t.Proj.ScaleDependantTransformation.prototype.untransform=function(t,o){return this.scaleTransforms[o].untransform(t,o)},t.Proj.Projection=t.Class.extend({initialize:function(i,e){if(t.Proj._isProj4Obj(i))this._proj=i;else{var n=i;if(e)o.defs(n,e);else if(void 0===o.defs[n]){var s=n.split(":");if(s.length>3&&(n=s[s.length-3]+":"+s[s.length-1]),void 0===o.defs[n])throw"No projection definition for code "+n}this._proj=o(n)}},project:function(o){var i=this._proj.forward([o.lng,o.lat]);return new t.Point(i[0],i[1])},unproject:function(o,i){var e=this._proj.inverse([o.x,o.y]);return new t.LatLng(e[1],e[0],i)}}),t.Proj.CRS=t.Class.extend({includes:t.CRS,options:{transformation:new t.Transformation(1,0,-1,0)},initialize:function(o,i,e){var n,s,r,a;if(t.Proj._isProj4Obj(o)?(s=o,n=s.srsCode,a=i||{},this.projection=new t.Proj.Projection(s)):(n=o,r=i,a=e||{},this.projection=new t.Proj.Projection(n,r)),t.Util.setOptions(this,a),this.code=n,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new t.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var l=this.options.resolutions.length-1;l>=0;l--)this.options.resolutions[l]&&(this._scales[l]=1/this.options.resolutions[l])}},scale:function(t){var o,i,e,n,s=Math.floor(t);return t===s?this._scales[t]:(o=this._scales[s],i=this._scales[s+1],e=i-o,n=t-s,o+e*n)},getSize:function(o){var i,e,n,s=this.options.bounds;return s?(i=this.scale(o),e=this.transformation.transform(s.min,i),n=this.transformation.transform(s.max,i),t.point(Math.abs(n.x-e.x),Math.abs(n.y-e.y))):(i=256*Math.pow(2,o),t.point(i,i))}}),t.Proj.CRS.TMS=t.Proj.CRS.extend({options:{tileSize:256},initialize:function(o,i,e,n){var s,r,a,l,c;t.Proj._isProj4Obj(o)?(a=o,l=i,c=e||{},c.origin=[l[0],l[3]],t.Proj.CRS.prototype.initialize.call(this,a,c)):(s=o,r=i,l=e,c=n||{},c.origin=[l[0],l[3]],t.Proj.CRS.prototype.initialize.call(this,s,r,c)),this.projectedBounds=l,this._sizes=this._calculateSizes()},_calculateSizes:function(){var o,i,e,n,s=[],r=this.projectedBounds;for(i=this._scales.length-1;i>=0;i--)this._scales[i]&&(o=this.options.tileSize/this._scales[i],e=Math.ceil(parseFloat((r[2]-r[0])/o).toPrecision(3))*o*this._scales[i],n=Math.ceil(parseFloat((r[3]-r[1])/o).toPrecision(3))*o*this._scales[i],s[i]=t.point(e,n));return s},getSize:function(t){return this._sizes[t]}}),t.Proj.TileLayer={},t.Proj.TileLayer.TMS=t.TileLayer.extend({options:{continuousWorld:!0},initialize:function(o,i,e){var n,s,r,a,l=!0;if(!(i instanceof t.Proj.CRS.TMS))throw"CRS is not L.Proj.CRS.TMS.";for(t.TileLayer.prototype.initialize.call(this,o,e),this.options.tms=!1,this.crs=i,r=this.crs.projectedBounds,a=this.options.minZoom;a<this.options.maxZoom&&l;a++){var c=(r[3]-r[1])/this._projectedTileSize(a);l=Math.abs(c-Math.round(c))>.001}if(!l){for(n={},a=this.options.minZoom;a<this.options.maxZoom;a++)s=r[1]+Math.ceil((r[3]-r[1])/this._projectedTileSize(a))*this._projectedTileSize(a),n[this.crs.scale(a)]=new t.Transformation(1,-r[0],-1,s);this.crs=new t.Proj.CRS.TMS(this.crs.projection._proj,r,this.crs.options),this.crs.transformation=new t.Proj.ScaleDependantTransformation(n)}},getTileUrl:function(o){var i=this._map.getZoom(),e=Math.ceil((this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(i));return t.Util.template(this._url,t.Util.extend({s:this._getSubdomain(o),z:this._getZoomForUrl(),x:o.x,y:e-o.y-1},this.options))},_projectedTileSize:function(t){return this.options.tileSize/this.crs.scale(t)}}),t.Proj.GeoJSON=t.GeoJSON.extend({initialize:function(o,i){this._callLevel=0,t.GeoJSON.prototype.initialize.call(this,null,i),o&&this.addData(o)},addData:function(o){var i;o&&(o.crs&&"name"===o.crs.type?i=new t.Proj.CRS(o.crs.properties.name):o.crs&&o.crs.type&&(i=new t.Proj.CRS(o.crs.type+":"+o.crs.properties.code)),void 0!==i&&(this.options.coordsToLatLng=function(o){var e=t.point(o[0],o[1]);return i.projection.unproject(e)})),this._callLevel++;try{t.GeoJSON.prototype.addData.call(this,o)}finally{this._callLevel--,0===this._callLevel&&delete this.options.coordsToLatLng}}}),t.Proj.geoJson=function(o,i){return new t.Proj.GeoJSON(o,i)},t.Proj.ImageOverlay=t.ImageOverlay.extend({initialize:function(o,i,e){t.ImageOverlay.prototype.initialize.call(this,o,null,e),this._projBounds=i},_animateZoom:function(o){var i=t.point(this._projBounds.min.x,this._projBounds.max.y),e=t.point(this._projBounds.max.x,this._projBounds.min.y),n=this._projectedToNewLayerPoint(i,o.zoom,o.center),s=this._projectedToNewLayerPoint(e,o.zoom,o.center).subtract(n),r=n.add(s._multiplyBy((1-1/o.scale)/2));this._image.style[t.DomUtil.TRANSFORM]=t.DomUtil.getTranslateString(r)+" scale("+this._map.getZoomScale(o.zoom)+") "},_reset:function(){var o=this._map.getZoom(),i=this._map.getPixelOrigin(),e=t.bounds(this._transform(this._projBounds.min,o)._subtract(i),this._transform(this._projBounds.max,o)._subtract(i)),n=e.getSize(),s=this._image;t.DomUtil.setPosition(s,e.min),s.style.width=n.x+"px",s.style.height=n.y+"px"},_projectedToNewLayerPoint:function(t,o,i){var e=this._map._getNewTopLeftPoint(i,o).add(this._map._getMapPanePos());return this._transform(t,o)._subtract(e)},_transform:function(t,o){var i=this._map.options.crs,e=i.transformation,n=i.scale(o);return e.transform(t,n)}}),t.Proj.imageOverlay=function(o,i,e){return new t.Proj.ImageOverlay(o,i,e)},"undefined"!=typeof t.CRS&&(t.CRS.proj4js=function(){return function(o,i,e,n){return n=n||{},e&&(n.transformation=e),new t.Proj.CRS(o,i,n)}}()),t.Proj});