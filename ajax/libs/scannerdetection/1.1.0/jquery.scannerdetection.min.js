(function($){$.fn.scannerDetection=function(options){if(typeof options==="string"){this.each(function(){$(this).data("scannerDetection").options.onComplete.call(this,options)});return this}var defaults={onComplete:false,onError:false,onReceive:false,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endChar:[9,13],stopPropagation:false,preventDefault:false};if(typeof options==="function"){options={onComplete:options}}if(typeof options!=="object"){options=$.extend({},defaults)}else{options=$.extend({},defaults,options)}this.each(function(){var self=this,$self=$(self),firstCharTime=0,lastCharTime=0,stringWriting="",callIsScanner=false,testTimer=false;var initScannerDetection=function(){firstCharTime=0;stringWriting=""};var isScanner=function(){if(stringWriting.length>=options.minLength&&lastCharTime-firstCharTime<stringWriting.length*options.avgTimeByChar){if(options.onComplete)options.onComplete.call(self,stringWriting);$self.trigger("scannerDetectionComplete",{string:stringWriting});initScannerDetection();return true}else{if(options.onError)options.onError.call(self,stringWriting);$self.trigger("scannerDetectionError",{string:stringWriting});initScannerDetection();return false}};$self.data("scannerDetection",{options:options}).unbind(".scannerDetection").bind("keypress.scannerDetection",function(e){if(options.stopPropagation)e.stopImmediatePropagation();if(options.preventDefault)e.preventDefault();if(firstCharTime&&options.endChar.indexOf(e.which)!==-1){e.preventDefault();e.stopImmediatePropagation();callIsScanner=true}else{stringWriting+=String.fromCharCode(e.which);callIsScanner=false}if(!firstCharTime){firstCharTime=e.timeStamp}lastCharTime=e.timeStamp;if(testTimer)clearTimeout(testTimer);if(callIsScanner){isScanner();testTimer=false}else{testTimer=setTimeout(isScanner,options.timeBeforeScanTest)}if(options.onReceive)options.onReceive.call(self,e);$self.trigger("scannerDetectionReceive",{evt:e})})});return this}})(jQuery);