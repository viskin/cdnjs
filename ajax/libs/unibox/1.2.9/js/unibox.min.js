(function(a){a.fn.unibox=function(b){var d=this;var c=a.extend({suggestUrl:"",queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,extraHtml:undefined,minChars:3,maxWidth:d.outerWidth()},b);UniBox.init(d,c);return this}}(jQuery));var UniBox=function(){var d=-1;var i;var u;var r="";var m;var e=[];var f=true;var b;var t=300;var l="";var n=2;var k;var p=[];var o="all";var c=-1;function h(w){if(w!==undefined){var x=i.val();if(w.keyCode==9||w.keyCode==13||x.length<n){u.slideUp(t);d=-1}}else{u.slideUp(t);d=-1}}function g(x,w){var y=null;return function(){var A=this,z=arguments;clearTimeout(y);y=window.setTimeout(function(){x.apply(A,z)},w||50)}}function s(x,w){if(!f){return x}var z=w.split(" ");var y={};$.each(z,function(A,B){if(B.length<2){return}x=x.replace(new RegExp(B,"gi"),"##"+A+"##");y["##"+A+"##"]="<span>"+B+"</span>"});$.each(y,function(A,B){x=x.replace(new RegExp(A,"gi"),B)});return x}function v(x){if(c==13){h();return}var w=i.val();u.html("");$.each(x.suggests,function(z,y){var B=$('<div class="unibox-suggest-'+z+'"></div>');if(z.replace(/_/,"").length>0&&y.length>0){var A=$("<h4>"+z+"</h4>");B.append(A)}$.each(y,function(K,I){var H='<div class="unibox-selectable">';if(I.image!=undefined){H+='<div class="unibox-selectable-img-container"><img src="'+I.image+'"/></div>'}if(I.link!=undefined){H+='<a href="'+I.link+'">';H+=s(I.name,w);H+="</a>"}else{H+="<span>"+s(I.name,w)+"</span>"}if(b!=undefined){var J=b.match(/##(.*?)##/gi);var G=b;var E=false;for(var D in J){var F=J[D].replace(/#/g,"");var C=I[F];if(C==undefined){E=true;continue}var M=new RegExp(J[D],"g");G=G.replace(M,C)}if(!E){H+='<div class="unibox-extra">'+G+"</div>"}}H+='<div class="unibox-ca"></div></div>';var L=$(H);B.append(L)});u.append(B)});$(".unibox-selectable").click(function(){var z=$(this).find("span").text();i.val(z);var y=undefined;try{y=$(this).find("a").attr("href")}catch(A){}k(z,y);h()});$(".unibox-selectable .unibox-extra").click(function(){event.stopPropagation()});if(x.words.length>0&&l.length>0&&(o=="all"||o=="bottom")){u.append("<h4>"+l+"</h4>")}$.each(x.words,function(z,C){if((o=="all"||o=="bottom")){if(C.overlayImage!=undefined){u.append('<img class="unibox-vis" src="'+C.overlayImage+'" style="background-image: url(\''+C.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{u.append('<img class="unibox-vis" src="'+C.image+'">')}}var B=$("#unibox-invisible");B.html(w.replace(new RegExp(C.name,"gi"),"<span>"+C.name+"</span>"));if((o=="all"||o=="top")&&jQuery.inArray(C.image,p)==-1){var A=$("#unibox-invisible span")[0];if(A!=undefined&&C.name.length>0){var y=$(A).position().left;visImage=$('<div class="unibox-ivf"><img src="'+C.image+'" alt="'+C.name+'"></div>');visImage.css("left",i.offset().left+y-10);visImage.css("top",i.offset().top-80);$("body").append(visImage);setTimeout(function(){$(".unibox-ivf").find("img").addClass("l")},10)}p.push(C.image)}});$("img").error(function(){$(this).hide()});u.css("left",i.offset().left);u.css("top",i.offset().top+i.outerHeight());u.slideDown(t,function(){u.css("left",i.offset().left);u.css("top",i.offset().top+i.outerHeight())});e=$(".unibox-selectable");d=-1}function a(){p=[];$(".unibox-ivf").remove()}function j(y){if(i.val().length<=1){a()}if(y.keyCode!=38&&y.keyCode!=40&&y.keyCode!=13){if(y.keyCode==46||y.keyCode==8){a()}return}if(y.keyCode==38&&d>0){d--}else{if(y.keyCode==40){d++}}if(e.length>0&&d>-1){d=d%e.length;e.removeClass("active");var x=$(e[d]);x.addClass("active")}if(y.keyCode==13){if(k!=undefined){var A=i.val();var w=undefined;if(d!=-1){A=$($(".unibox-selectable.active span")[0]).text();i.val(A);try{w=$($(".unibox-selectable.active")[0]).find("a").attr("href")}catch(z){}}k(A,w)}else{if(d!=-1){window.location.href=$($(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}}function q(w){c=w.keyCode;if(w.keyCode==38||w.keyCode==40||w.keyCode==13){return}var x=i.val();if(x.length>=n){$.ajax(r+encodeURIComponent(x),{dataType:"json",success:function(y){v(y)}})}}return{init:function(y,w){i=y;f=w.highlight;b=w.extraHtml;r=w.suggestUrl;m=w.throttleTime;t=w.animationSpeed;n=w.minChars;k=w.enterCallback;o=w.instantVisualFeedback;l=w.queryVisualizationHeadline;i.attr("autocomplete","off");u=$('<div id="unibox-suggest-box"></div>');$("body").append(u);u.css("min-width",i.outerWidth());u.css("max-width",w.maxWidth);i.keydown(j);i.keydown(g(q,m));i.keydown(h);i.keyup(h);$("html").click(function(){u.slideUp(t)});u.click(function(z){z.stopPropagation()});var x=$('<div id="unibox-invisible">text whatever <span>this one</span></div>');i.parent().append(x)}}}();