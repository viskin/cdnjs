(function(a){a.fn.unibox=function(b){var d=this;var c=a.extend({suggestUrl:"",queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,extraHtml:undefined,minChars:3,maxWidth:d.outerWidth()},b);UniBox.init(d,c);return this}}(jQuery));var UniBox=function(){var e=-1;var j;var v;var s="";var n;var f=[];var g=true;var c;var u=300;var m="";var o=2;var l;var q=[];var p="all";var d=-1;function i(x){if(x!==undefined){var y=j.val();if(x.keyCode==9||x.keyCode==13||y.length<o){v.slideUp(u);e=-1}}else{v.slideUp(u);e=-1}}function h(y,x){var z=null;return function(){var B=this,A=arguments;clearTimeout(z);z=window.setTimeout(function(){y.apply(B,A)},x||50)}}function t(y,x){if(!g){return y}var A=x.split(" ");var z={};$.each(A,function(B,C){if(C.length<2){return}y=y.replace(new RegExp(C,"gi"),"##"+B+"##");z["##"+B+"##"]="<span>"+C+"</span>"});$.each(z,function(B,C){y=y.replace(new RegExp(B,"gi"),C)});return y}function w(z){if(d==13){i();return}var x=j.val();v.html("");$.each(z.suggests,function(B,A){var D=$('<div class="unibox-suggest-'+B+'"></div>');if(B.replace(/_/,"").length>0&&A.length>0){var C=$("<h4>"+B+"</h4>");D.append(C)}$.each(A,function(M,K){var J='<div class="unibox-selectable">';if(K.image!=undefined){J+='<div class="unibox-selectable-img-container"><img src="'+K.image+'"/></div>'}if(K.link!=undefined){J+='<a href="'+K.link+'">';J+=t(K.name,x);J+="</a>"}else{J+="<span>"+t(K.name,x)+"</span>"}if(c!=undefined){var L=c.match(/##(.*?)##/gi);var I=c;var G=false;for(var F in L){var H=L[F].replace(/#/g,"");var E=K[H];if(E==undefined){G=true;continue}var O=new RegExp(L[F],"g");I=I.replace(O,E)}if(!G){J+='<div class="unibox-extra">'+I+"</div>"}}J+='<div class="unibox-ca"></div></div>';var N=$(J);D.append(N)});v.append(D)});$(".unibox-selectable").click(function(){var B=$(this).find("span").text();j.val(B);var A=undefined;try{A=$(this).find("a").attr("href")}catch(C){}l.call(this,B,A);i()});$(".unibox-selectable .unibox-extra").click(function(){event.stopPropagation()});if(z.words.length>0&&m.length>0&&(p=="all"||p=="bottom")){v.append("<h4>"+m+"</h4>")}var y=[];$.each(z.words,function(B,E){if((p=="all"||p=="bottom")){if(E.overlayImage!=undefined){v.append('<img class="unibox-vis" src="'+E.overlayImage+'" style="background-image: url(\''+E.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{v.append('<img class="unibox-vis" src="'+E.image+'">')}}var D=$("#unibox-invisible");D.html(x.replace(new RegExp(E.name,"gi"),"<span>"+E.name+"</span>"));if((p=="all"||p=="top")&&jQuery.inArray(E.image,q)==-1){var C=$("#unibox-invisible span")[0];if(C!=undefined&&E.name.length>0){var A=$(C).position().left;visImage=$('<div class="unibox-ivf"><img src="'+E.image+'" alt="'+E.name+'"></div>');visImage.css("left",j.offset().left+A-10);visImage.css("top",j.offset().top-80);$("body").append(visImage);setTimeout(function(){$(".unibox-ivf").find("img").addClass("l")},10);y.push(E.image)}}else{if(jQuery.inArray(E.image,q)>-1){y.push(E.image)}}});q=y;$("img").error(function(){$(this).hide()});v.css("left",j.offset().left);v.css("top",j.offset().top+j.outerHeight());v.slideDown(u,function(){v.css("left",j.offset().left);v.css("top",j.offset().top+j.outerHeight())});f=$(".unibox-selectable");e=-1}function b(){var y=$(".unibox-ivf img").map(function(){return $(this).attr("src")}).get();for(var x=0;x<y.length;x++){if(jQuery.inArray(y[x],q)==-1){$('.unibox-ivf:has(img[src*="'+y[x]+'"])').remove()}}}function a(){q=[];$(".unibox-ivf").remove()}function k(z){if(j.val().length<=1){a()}if(z.keyCode!=38&&z.keyCode!=40&&z.keyCode!=13){b();return}if(z.keyCode==38&&e>0){e--}else{if(z.keyCode==40){e++}}if(f.length>0&&e>-1){e=e%f.length;f.removeClass("active");var y=$(f[e]);y.addClass("active")}if(z.keyCode==13){if(l!=undefined){var B=j.val();var x=undefined;if(e!=-1){B=$($(".unibox-selectable.active span")[0]).text();j.val(B);try{x=$($(".unibox-selectable.active")[0]).find("a").attr("href")}catch(A){}}l.call(this,B,x)}else{if(e!=-1){window.location.href=$($(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}}function r(x){d=x.keyCode;if(x.keyCode==38||x.keyCode==40||x.keyCode==13){return}var y=j.val();if(d==46&&y.length==0){a()}if(y.length>=o){$.ajax(s+encodeURIComponent(y),{dataType:"json",success:function(z){w(z)}})}}return{init:function(z,x){j=z;g=x.highlight;c=x.extraHtml;s=x.suggestUrl;n=x.throttleTime;u=x.animationSpeed;o=x.minChars;l=x.enterCallback;p=x.instantVisualFeedback;m=x.queryVisualizationHeadline;j.attr("autocomplete","off");v=$('<div id="unibox-suggest-box"></div>');$("body").append(v);v.css("min-width",j.outerWidth());v.css("max-width",x.maxWidth);j.keydown(k);j.keydown(h(r,n));j.keydown(i);j.keyup(i);$("html").click(function(){v.slideUp(u)});v.click(function(A){A.stopPropagation()});var y=$('<div id="unibox-invisible">text whatever <span>this one</span></div>');j.parent().append(y)}}}();