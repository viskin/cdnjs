(function(a){a.fn.unibox=function(b){var d=this;var c=a.extend({suggestUrl:"",queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,extraHtml:undefined,minChars:3,maxWidth:d.outerWidth()},b);UniBox.init(d,c);return this}}(jQuery));var UniBox=function(){var d=-1;var i;var v;var r="";var m;var e=[];var f=true;var b;var u=300;var l="";var n=2;var k;var p=[];var o="all";var c=-1;function h(x){if(x!==undefined){var y=i.val();if(x.keyCode==9||x.keyCode==13||y.length<n){v.slideUp(u);d=-1}}else{v.slideUp(u);d=-1}}function g(y,x){var z=null;return function(){var B=this,A=arguments;clearTimeout(z);z=window.setTimeout(function(){y.apply(B,A)},x||50)}}function s(y,x){if(!f){return y}var A=x.split(" ");var z={};$.each(A,function(B,C){if(C.length<2){return}y=y.replace(new RegExp(C,"gi"),"##"+B+"##");z["##"+B+"##"]="<span>"+C+"</span>"});$.each(z,function(B,C){y=y.replace(new RegExp(B,"gi"),C)});return y}function t(){return i.offset().left-$("body").offset().left}function w(y){if(c==13){h();return}var x=i.val();v.html("");$.each(y.suggests,function(A,z){var C=$('<div class="unibox-suggest-'+A+'"></div>');if(A.replace(/_/,"").length>0&&z.length>0){var B=$("<h4>"+A+"</h4>");C.append(B)}$.each(z,function(L,J){var I='<div class="unibox-selectable">';if(J.image!=undefined){I+='<div class="unibox-selectable-img-container"><img src="'+J.image+'"/></div>'}if(J.link!=undefined){I+='<a href="'+J.link+'">';I+=s(J.name,x);I+="</a>"}else{I+="<span>"+s(J.name,x)+"</span>"}if(b!=undefined){var K=b.match(/##(.*?)##/gi);var H=b;var F=false;for(var E in K){var G=K[E].replace(/#/g,"");var D=J[G];if(D==undefined){F=true;continue}var N=new RegExp(K[E],"g");H=H.replace(N,D)}if(!F){I+='<div class="unibox-extra">'+H+"</div>"}}I+='<div class="unibox-ca"></div></div>';var M=$(I);C.append(M)});v.append(C)});e=$(".unibox-selectable");d=-1;e.click(function(){var A=$(this).find("span").text();i.val(A);var z=undefined;try{z=$(this).find("a").attr("href")}catch(B){}k(A,z);h()});$(".unibox-selectable .unibox-extra").click(function(){event.stopPropagation()});if(y.words.length>0&&l.length>0&&(o=="all"||o=="bottom")){v.append("<h4>"+l+"</h4>")}$.each(y.words,function(A,D){if((o=="all"||o=="bottom")){if(D.overlayImage!=undefined){v.append('<img class="unibox-vis" src="'+D.overlayImage+'" style="background-image: url(\''+D.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{v.append('<img class="unibox-vis" src="'+D.image+'">')}}var C=$("#unibox-invisible");C.html(x.replace(new RegExp(D.name,"gi"),"<span>"+D.name+"</span>"));if((o=="all"||o=="top")&&jQuery.inArray(D.image,p)==-1){var B=$("#unibox-invisible span")[0];if(B!=undefined&&D.name.length>0){var z=$(B).position().left;visImage=$('<div class="unibox-ivf"><img src="'+D.image+'" alt="'+D.name+'"></div>');visImage.css("left",t()+z-10);visImage.css("top",i.offset().top-80);$("body").append(visImage);setTimeout(function(){$(".unibox-ivf").find("img").addClass("l")},10)}p.push(D.image)}});$("img").error(function(){$(this).hide()});v.css("left",t());v.css("top",i.offset().top+i.outerHeight());v.slideDown(u,function(){v.css("left",t());v.css("top",i.offset().top+i.outerHeight())})}function a(){p=[];$(".unibox-ivf").remove()}function j(z){if(i.val().length<=1){a()}if(z.keyCode!=38&&z.keyCode!=40&&z.keyCode!=13){if(z.keyCode==46||z.keyCode==8){a()}return}if(z.keyCode==38&&d>0){d--}else{if(z.keyCode==40){d++}}if(e.length>0&&d>-1){d=d%e.length;e.removeClass("active");var y=$(e[d]);y.addClass("active")}if(z.keyCode==13){if(k!=undefined){var B=i.val();var x=undefined;if(d!=-1){B=$($(".unibox-selectable.active span")[0]).text();i.val(B);try{x=$($(".unibox-selectable.active")[0]).find("a").attr("href")}catch(A){}}k(B,x)}else{if(d!=-1){window.location.href=$($(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}}function q(x){c=x.keyCode;if(x.keyCode==38||x.keyCode==40||x.keyCode==13){return}var y=i.val();if(y.length>=n){$.ajax(r+encodeURIComponent(y),{dataType:"json",success:function(z){w(z)}})}}return{init:function(z,x){i=z;f=x.highlight;b=x.extraHtml;r=x.suggestUrl;m=x.throttleTime;u=x.animationSpeed;n=x.minChars;k=x.enterCallback;o=x.instantVisualFeedback;l=x.queryVisualizationHeadline;i.attr("autocomplete","off");v=$('<div id="unibox-suggest-box"></div>');$("body").append(v);v.css("min-width",i.outerWidth());v.css("max-width",x.maxWidth);i.keydown(j);i.keydown(g(q,m));i.keydown(h);i.keyup(h);$("html").click(function(){v.slideUp(u)});v.click(function(A){A.stopPropagation()});var y=$('<div id="unibox-invisible">text whatever <span>this one</span></div>');i.parent().append(y)}}}();