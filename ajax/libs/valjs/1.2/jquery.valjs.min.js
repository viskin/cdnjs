window.ValJS=function(aa,g){function wa(){var a=0,b=null;this.add=function(){a+=1};this.stopWaiting=function(){b=null};this.remove=function(){--a;0>a&&(a=0)};this.commitRemove=function(){0===a&&b&&(b(),b=null)};this.wait=function(a){b=a}}function xa(a){this.vars.wfi=a}function ya(a){var b,c=0,d=0,e=0,f;for(b=0;b<this.e.length;b+=1)a=g(this.e[b]).data(E),f=a.getResults(),h(f)||(0===f.fail.length&&0===f.busy.length?a.waitingRules()&&(e+=1):0<f.fail.length?d+=1:0<f.busy.length&&(c+=1));d?O(this.jqContext,
"refreshform",{valjs:g.extend({status:"invalid",binding:a,context:this.jqContext,form:this.$form})}):d||e||c||O(this.jqContext,"refreshform",{valjs:g.extend({status:"valid",binding:a,context:this.jqContext,form:this.$form})});this.vars.wfi&&(d||e||c?d&&delete this.vars.wfi:(this.vars.wfi(),delete this.vars.wfi))}function v(a){var b=Array.prototype.slice.call(arguments,1);return g.prototype.data.apply(a,b)}function h(a){return void 0===a}function I(a){return"string"===typeof a}function m(a){return h(a)||
null===a||h(a.length)?0:a.length}function P(a,b){return g(b).find(a)}function K(a,b){var c={error:a};I(b)&&(b={error:b});g.isFunction(a)&&(a=c);I(a)?a=h(b)?c:g.extend(!0,c,b):h(a)?a=b:"object"===typeof a&&(a=g.extend(!0,{},a,b));return a}function za(a,b){var c=b.options,d;h(c)||h(c.msg)||(c.msg=K(c.msg));h(b.value)&&(b.value=!0);b=g.extend(!0,{},q.ruleDefaults,{name:a},b);this.name=a;this.options=b.options;this.bind=b.bind;this.testElement=b.testElement;this.run=b.run;this.async=b.async;this.prio=
b.prio;this.events=b.events;this.checkEvent=b.checkEvent;b.async&&(this.makePromise=function(){d=g.Deferred();return d.promise()},this.reject=function(){d.reject.apply(d,Array.prototype.slice.call(arguments))},this.resolve=function(){d.resolve.apply(d,Array.prototype.slice.call(arguments))},this.abort=b.abort)}function t(a,b){/^[a-z][a-z0-9]*$/.test(a)?(Y.rules.k.push(a),Y.rules[a]=new za(a,b)):g.error("Bad rule name")}function L(a,b,c){var d=a.config.elements,e=a.config.modifiers||{},f=d&&d[b]?[d[b]]:
[],g="";if(!c)return f[0];a.config.modifierSeparator&&d[b]&&(g=d[b]+a.config.modifierSeparator);if(I(c))f.push(h(g+e[c])?"":e[c]);else if(m(c))for(a=0;a<m(c);a+=1)f.push(h(g+e[c[a]])?"":e[c[a]]);return f.join(" ")}function ia(a){var b=a.element;return b?v(b,E).getCfg().iFindMsgFn(a):null}function T(a,b){return a.addClass(b)}function Z(a,b,c,d){if(a)return a.removeClass(b.vars[c]),T(a,L(b,c,d)),a}function U(a){var b=v(a,"valjs-ty"),c,d;if(!h(b))return v(a,"valjs-ty");b=a.prop("tagName").toLowerCase();
c={type:null};d=["text","checkbox","file","radio","submit"];"input"===b?(b=a.prop("type").toLowerCase(),h(b)||(-1===g.inArray(b,d)?(c[b]=!0,c.type="text"):c.type=b)):"select"===b?(c.type=b,c.isMultiple=h(a.attr("multiple"))?!1:!0):"textarea"===b&&(c.type=b);v(a,"valjs-ty",c);return c}function V(a){var b=U(a).type,c=v(a,E),d=c?c.g("c"):null,e=null,f={value:null,upd:!0};if("submit"===b)return f;switch(b){case "checkbox":case "radio":e=a.prop("checked");break;case "select":f.value=g.map(a.find("option"),
function(a){a=g(a);if(a.is(":selected"))return h(a.val())?a.text():a.val()});e=f.value.join(",");""===e&&0<m(f.value)&&(e=" ");break;default:e=a.val()}d=h(d)?"":d;d===e?f.upd=!1:c.resetRuleStatus();null===f.value&&(f.value=e);c&&c.s("c",e);return f}function Aa(a,b){var c={},d=a.attr("name");d&&!h(b[d])&&(h(b[d].findMsg)||(c.findMsg=b[d].findMsg),h(b[d].findLabel)||(c.findLabel=b[d].findLabel));return c}function ja(a){for(var b=/-([a-z0-9])/g,c=b.exec(a),d=String(a);null!==c;)d=d.replace(c[0],String(c[1].toUpperCase())),
c=b.exec(a);return d}function W(a,b){var c=a.attr("id"),d=c?P("label[for='"+a.attr("id")+"']",b.jqContext):null;c&&0!==m(d)||"LABEL"===a.parent().get(0).nodeName&&(d=a.parent());return d}function O(a,b,c){b=jQuery.Event(b+ka,c);a.trigger(b);return b}function la(a,b,c){var d=c.status,e=v(b,E).getCfg(),f=c.state,g=c.message,h=null,l=""!==g&&"valid"!==d,p,x=!1;p=W(b,a);"valid"===d?(h="valid",x=!0):"unknown"===d?(h="unknown",x=!0):(h=[d,f],"busy"===d&&(x=!1));c.ruleConfig=e[c.rule];c=ia({element:b,valjs:a,
create:l,validation:c});1===m(c)&&(x?c.html("").hide():c.html(g),Z(c,a,"msg",h));Z(b,a,"field",h);1===m(p)&&Z(p,a,"label",h);return b}function ma(a,b){var c=v(a,E),d;c.r("s");d={status:"unknown"};O(a,"refreshfield",{valjs:g.extend(d,{binding:c,context:b.jqContext,form:b.$form,element:a})}).isDefaultPrevented()||la(b,a,d)}function na(a,b){return(!0===b||a.is(":visible"))&&!a.is(":disabled")}function oa(a,b,c){var d=a.msgName;g.isFunction(b.msg)?c=b.msg(a):h(b.msg)||h(b.msg[d])?c=a.msgName:g.isFunction(b.msg[d])?
c=b.msg[d](a):I(d)&&(c=b.msg[d]);return c}function ba(a,b){var c,d={ok:!0,result:null},e=b.rule,f="";!0===a||"object"===typeof a&&!a.msg||(f=a,"boolean"===typeof f?c="error":"object"===typeof f?c=f.msg:I(f)&&(c=f),b.msgName=c,"object"===typeof a&&(c=g.extend(!0,{},a),b.result=c),e.options&&e.options.msg&&null===e.options.msg.error&&null!==b.config.msg.error&&(b.msgName="error"),f=oa(b,b.config,a),a=!1!==a?"object"===typeof a?g.extend(!0,{},a,{msg:f}):{msg:f}:{msg:f},d.ok=!1);d.result=a;return d}function Ba(a,
b,c,d,e,f){c={binding:v(b,E),event:d,config:f,valjs:a,element:b,field:g.extend({value:c.value},U(b))};c.binding.setRuleContext(e.name);d=e.run(c,b);c.binding.setRuleContext(null);return e.async?d:ba(d,{valjs:a,config:f,rule:e,element:b,msgName:null})}function Ca(a){var b=5381,c,d;for(c=0;c<m(a);c+=1)d=a.charCodeAt(c),b=(b<<5)+b+d;return b}function Da(a,b,c,d,e,f){var n,k=v(c,E).getCfg(),l=c.data(E),p,x,M,ca,H={hash:[],fail:[],busy:[],success:[],unresolved:[]},r,z,B;x=!1;for(n=0;n<m(b);n+=1)if(p=Y.rules[b[n]],
M=k[b[n]],B=p.async,x=l.getRuleStatus(p.name),z=null,!0===x.status)z=x.result,!1===z.ok?(H.hash.push(p.name+z.result),H.fail.push(z.result)):H.success.push(g.extend(!0,{},z,{rule:p.name}));else{if(x=l.g(b[n]+"_busy"))a.workers.remove(x.asyncId),p.abort&&p.abort();B&&0!==H.fail.length?(l.setRuleStatus(p.name,!1),H.hash.push(p.name)):(x=l.g(b[n]+"_resolved"),ca=l.g(b[n]+"_asyncfail"),h(x)?h(ca)?(x=!0,!e&&p.checkEvent&&(x=p.checkEvent(f),l.setRuleStatus(p.name,!1)),x&&(z=Ba(a,c,d,f,p,M),H.hash.push(p.name+
"_hash"),B?(r=p.name+(new Date).getTime()/1E3,a.workers.add(r),x=g.extend(!0,{},{rule:p.name,asyncId:r}),x.msg=oa({valjs:a,config:M,rule:p,element:c,msgName:"busy"},M),H.busy.push(x),l.s(b[n]+"_busy",x),z.fail(function(b){b=ba(b,{valjs:a,config:M,rule:p,element:c,msgName:null,asyncId:r});b.asyncId=r;l.s(p.name+"_asyncfail",b);l.r(p.name+"_busy");c.valjs("validateField",{force:!0,submit:e})}).done(function(b){b=ba(b,{valjs:a,config:M,rule:p,element:c,msgName:null});b.asyncId=r;l.s(p.name+"_resolved",
b);l.r(p.name+"_busy");c.valjs("validateField",{force:!0,submit:e})})):l.setRuleStatus(p.name,!0,z))):(z=ca,a.workers.remove(z.asyncId),l.r(b[n]+"_asyncfail"),!0===M.allowFailed&&(l.setRuleStatus(p.name,!0,!0),z={ok:!0,result:!0})):(z=x,l.r(b[n]+"_resolved"),a.workers.remove(z.asyncId),l.setRuleStatus(p.name,!0,z)));z&&(!1===z.ok?(H.hash.push(p.name+z.result.msg),H.fail.push(g.extend(!0,{},z.result,{rule:p.name}))):H.success.push(g.extend(!0,{},"success",{rule:p.name})))}a.workers.commitRemove();
H.hash=Ca((e?"1":"0")+H.hash.join("|"));return H}function da(a,b,c,d,e,f,n){var k=v(a,E),l=v(a,E).getCfg(),p=l?l.ruleNames:null,l=k.g("h");if(!1!==b.config.liveValidation||e||f){if(na(a,n)){h(e)&&(e=!1);h(d)&&(d=V(a,c));c=Da(b,p,a,d,e,c);k.updateResults(c);if(l===c.hash&&!1===b.config.alwaysTriggerFieldEvents)return k.g("s");k.s("h",c.hash);f=e;e=-1;k=v(a,E);d=h(b);if(!d&&0<m(c.fail)){if(k.setRuleContext(c.fail[0].rule),f={status:"invalid",state:f?"error":"warning",message:c.fail[0].msg,rule:c.fail[0].rule},
n=W(a,b))f.label=n.text()}else f={status:"valid"},e=1;!d&&1===e&&0<m(c.busy)&&(f.status="busy",f.message=c.busy[0].msg,e=0);k.s("v",e);k.s("s",f);O(a,"refreshfield",{currentTarget:a.get(0),valjs:g.extend(f,{binding:k,context:b.jqContext,form:b.$form,element:a})}).isDefaultPrevented()||la(b,a,f);k.setRuleContext(null);return 1===e?e:f}k.g("h")&&ma(a,b)}}function y(){}function ea(a,b){function c(){e.ruleNames.sort(function(a,b){a=d[a].prio;b=d[b].prio;return a<b?-1:a>b?1:0})}var d=Y.rules,e=null,f=
this,n=null,k={},l={};this.s=function(a,b){k[a]=b};this.g=function(a){return k[a]};this.r=function(a){delete k[a]};this.updateResults=function(b){var c=this.getResults();c&&b.hash===c.hash||(f.s("elementStatus",b),f.s("elementStatusT",new Date),a.elementUpdated(f))};this.getResults=function(){return f.g("elementStatus")};this.setRuleStatus=function(a,b,c){l[a]={status:b,result:c}};this.getRuleStatus=function(a){return l[a]||{status:!1}};this.resetRuleStatus=function(){l={}};this.waitingRules=function(){var a,
b;for(b=0;b<e.ruleNames.length;b+=1)if(a=e.ruleNames[b],!1===f.getRuleStatus(a).status)return!0;return!1};this.isValid=function(){return 1===f.g("v")};this.setRuleContext=function(a){n=a};this.getCfg=function(){return e};this.getContext=function(){return a.jqContext};this.getElement=function(){return b};this.getFieldStatus=function(){var a=f.g("v");return h(a)?0:a};this.getForm=function(){return a.$form};this.getRules=function(){return e.ruleNames};this.getRule=function(a){h(a)&&n&&(a=n);return I(a)&&
this.hasRule(a)?e[a]:null};this.hasRule=function(a){var b=0;if("[object Array]"===Object.prototype.toString.call(a)){for(b=0;b<a.length;b+=1)if(e.hasOwnProperty(a[b]))return!0;return!1}return e.hasOwnProperty(a)};this.getFieldType=function(){return U(b)};this.resetField=function(){ma(b,a);return b};this.getFieldValue=function(){return V(b)};this.validateField=function(c){var d=V(b);return da(b,a,void 0,d,c?c.submit:!1,!0)};this.isBound=function(){return 0<e.ruleNames.length};(function(){var p=h(a.config.msg)?
{}:{msg:K(a.config.msg)},x=g.extend({findMsg:a.config.findMsg,findLabel:a.config.findLabel},Aa(b,a.config)),n;n=(n=b.attr("data-"+a.config.attrPrefix+"msg"))?{msg:K(n)}:{};v(b,E,f);for(var k,l=0,r,z={ruleNames:[]},l=0;l<m(d.k);l+=1){k=h(d[d.k[l]].options)?{}:d[d.k[l]].options;r=d.k[l];var B=a.config,u={},D=b.attr("name"),A=g.extend(!0,{},B.fields),B=B.rules;h(B)||h(B[r])||(u=g.extend(u,B[r]),h(B[r].msg)||(u.msg=K(B[r].msg)));A&&D&&!h(A[D])&&(h(A[D].msg)||(u.msg=K(A[D].msg,u.msg)),h(A[D][r])||(u.elmRules=
{},u.elmRules[r]="instance.name",h(A[D][r].msg)||(u.msg=K(u.msg,A[D][r].msg),delete A[D][r].msg),u=g.extend(!0,u,A[D][r])));r=u;k=g.extend(!0,{},k,p,r,n);var D=a,B=b,A=d[d.k[l]],q=k;r={};var t="data-"+D.config.attrPrefix+A.name,F=B.attr(t),u=null,w=void 0,w=void 0;if(q=!h(q.elmRules)&&!h(q.elmRules[A.name]))u={data:{}};else if(h(F)){var u={binding:null,elmRules:void 0},w=void 0,G=A.name;!0===D.config.allowRuleInitialization&&(w=A.testElement({form:D.$form,context:D.jqContext,rule:A,element:B,valjs:D}),
"object"===typeof w?h(w[G])?u.binding={data:w}:(u.binding={data:{}},u.elmRules={},u.elmRules[G]=!0):"boolean"===typeof w&&!0===w&&(u.binding={data:{}},u.elmRules={},u.elmRules[G]=!0));w=u;u=w.binding;r.elmRules=w.elmRules}else r.elmRules={},r.elmRules[A.name]="attribute";h(F)||(u={data:{}},""!==F||h(A.options)||h(A.options.value)||(F=A.options.value),u.data.value=F);if(u||q){r.elmRules={};r.elmRules[A.name]=1;w={};if(null!==u){D=t;B=B[0].attributes;t=void 0;F={};w=q=G=void 0;for(t=0;t<m(B);t+=1)if(G=
B[t].name,0===G.indexOf(D+"-")&&G.length>D.length)if(q=ja(G.substr(m(D)+1)),B[t].value){var w=A,y=q,C=B[t].value;h(w.options)||h(w.options[y])||"boolean"===typeof w.options[y]&&("true"===C.toLowerCase()?C=!0:"false"===C.toLowerCase()&&(C=!1));w=C;y=D+"-msg";C=w;0===G.indexOf(y)?G===y?(F.msg=F.msg||{},F.msg.error=C):-1!==G.indexOf(y+"-")&&(F.msg=F.msg||{},F.msg[ja(G.substr((y+"-").length))]=C):F=C;F===w&&(F={},F[q]=w)}else w=F,G=q,y=A,q=h(y.options)||h(y.options[q])||"boolean"!==typeof y.options[q]?
{}:!0,w[G]=q;w=F}r=g.extend(!0,{},r,u.data,w);h(r.msg)||(r.msg=K(r.msg))}k=g.extend(!0,k,r);k.msg=k.msg||{};h(k.elmRules)||(delete k.elmRules,z.ruleNames.push(d.k[l]),z[d.k[l]]=k)}e=z;e.iFindMsgFn=x.findMsg;e.iFindLabelFn=x.findLabel;c();p={valjs:a,elm:b,config:e};a.config.setupField!==g.noop&&a.config.setupField(p);e=p.config;return this})();(function(){var c=e.ruleNames.slice(0),k,n,l;if(0===e.ruleNames.length)k=ia(b,a,!1),c=W(b,a),k&&k.hide(),k=L(a,"field"),b.removeClass(k),b.removeClass(a.vars.field),
c&&(k=L(a,"label"),c.removeClass(k),c.removeClass(a.vars.label)),b.removeData(E),b.removeData("valjs-ty"),b.removeData("vjs-i"),b.removeData("c");else if(e.ruleNames=[],0!==m(c)){for(k=0;k<m(c);k+=1)n=d[c[k]],null===n.bind||h(n.bind)||n.bind===g.noop?l=!0:(f.setRuleContext(n.name),l=n.bind(g.extend({config:a.config,context:a.jqContext,form:a.$form},{binding:f,valjs:a,element:b,field:U(b),config:e[n.name],rule:n})),f.setRuleContext(null)),!1!==l?("object"===typeof l&&(e[n.name]=g.extend(!0,{},e[n.name],
l)),e.ruleNames.push(c[k]),n.async&&f.s("hasAsync",!0)):delete e[c[k]];0!==e.ruleNames.length&&(e.fieldType=U(b),c=e,q.idCounter+=1,c.uid=q.idCounter,c=v(b,E)?"":"unknown",T(b,L(a,"field",c)).data(a.vars.off,0),Z(W(b,a),a,"label",c));return this}})()}function fa(a){var b=v(g(this),E),c=!1,d;b&&(d=V(g(this),a),!1===a.data.valjs.config.liveValidation&&"focusout"===a.type&&(c=d.upd=!0),a.type&&"change"===a.type&&!1===d.upd&&b.waitingRules(a)&&(d.upd=!0),!0===d.upd&&da(g(this),a.data.valjs,a,d,!1,c))}
function pa(a){var b=a.data.valjs,c=b.$form;"TEXTAREA"!==g(a.target).prop("tagName")&&(c.data("vjsf",b),"keydown"===a.type&&13===a.keyCode&&(v(c,"vjsf",b),0<m(b.s)?(a.preventDefault(),a.stopPropagation(),g(b.s).first().trigger("click")):0===m(c.find('input[type="submit"],button[type="submit"],button:not([type]),input[type="image"]'))&&(a.preventDefault(),c.trigger("submit"))))}function qa(a,b,c,d){var e,f,n,k={invalid:[],busy:[]},l=m(a.e);d=g.extend({includeHidden:!1},d);for(e=0;e<l;e+=1)n=g(a.e[e]),
f=V(n,b),f=da(n,a,b,f,!0===c?!0:!1,!1,!0===d.includeHidden),h(f)||!0===f||("invalid"===f.status?k.invalid.push(f):"busy"===f.status&&k.busy.push(f));return k}function Ea(a){a=a.find("input,select,textarea,button").serializeArray();var b={},c,d;for(d=0;d<m(a);d+=1)b[a[d].name]?(I(b[a[d].name])&&(c=String(b[a[d].name]),b[a[d].name]=[c]),b[a[d].name].push(a[d].value)):b[a[d].name]=a[d].value;return b}function Fa(a,b){if(b&&!0===b.valjsDone)return!0;var c=v(g(this),"vjsf"),d=null,e=g(this),f;if(!c)return!0;
c.workers.stopWaiting();f=c.jqContext;g(this).removeData("vjsf");d=qa(c,a,!0);if(0===m(d.invalid)){if(0===m(d.busy)){c=O(f,"submitform",{currentTarget:c.context,target:c.$form[0],valjs:g.extend({},{form:c.$form[0],context:c.context,formData:Ea(c.jqContext)})});c.isDefaultPrevented()?a.preventDefault():g(this).trigger("submit",{valjsDone:!0});return}c.waitForIt(function(){e.submit()})}O(f,"invalidform",{target:c.context,valjs:g.extend({},d,{form:c.$form[0],context:c.context})});g(this).removeData("vjsf");
a.preventDefault();return!1}function Q(a){var b=[],c;for(c=0;c<m(a);c+=1)b.push(a[c]+ka);return b.join(" ")}function R(a,b){return h(a)?-1:a.indexOf(b)}function Ga(a){var b=a.elements,c=a.modifiers||{},d=[],e,f,g,h={};for(e in c)c.hasOwnProperty(e)&&d.push(e);for(f in b)if(b.hasOwnProperty(f)){e=[];for(g=0;g<m(d);g+=1)e.push((a.modifierSeparator?b[f]+a.modifierSeparator:"")+c[d[g]]);h[f]=e.join(" ")}return h}function Ha(a,b){var c=null;if(0===R(b,"#"))return g(b);c=a.find('[name="'+b+'"]');0===m(c)&&
(c=a.find(b).first());return c}function X(a){var b=a.config.selector,c;a.e=[];b=P(b.elements,a.context);for(c=0;c<m(b);c+=1)(new ea(a,g(b[c]))).isBound()&&a.e.push(b[c]);v(a.$form,"vjs-b")||(v(a.$form,"vjs-b",1),a.$form.on(Q(["submit"]),{valjs:a},Fa));a.jqContext.on(Q(["keydown","keyup"]),{valjs:a},pa).on(Q(["click","change","keyup"]),"textarea, input:not([type=checkbox], [type=radio], [type=submit], [type=button])",{valjs:a},fa).on(Q(["click","change"]),"select",{valjs:a},fa).on(Q(["click","change"]),
"input[type=checkbox], input[type=radio]",{valjs:a},fa);g(a.s).on(Q(["click"]),{valjsSubmit:!0,valjs:a},pa)}function J(a){if(0===a)return"n/a";var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)),10);return Math.round(a/Math.pow(1024,b),2)+(0<b?" ":"")+(0<b?" KMGTPEZY"[b]+"iB":" bytes")}function ra(a){a.setDate(a.getDate()+3-(a.getDay()+6)%7);return a.getFullYear()}function Ia(a,b){var c,d,e,f={isDate:!1,isWeek:!1,isDateRelated:!1,pattern:"",macroPositions:[]};for(c=0;c<m(b);c+=1)f.macroPositions.push([b[c],
R(a,"%"+b[c])]),"m"===b[c]?f.isDate=!0:"H"===b[c]?f.isDateTime=!0:"w"===b[c]&&(f.isWeek=!0);f.isDateRelated=f.isDate||f.isDateTime;f.isDate=!f.isWeek&&!f.isDateTime;f.macroPositions.sort(function(a,b){a=a[1];b=b[1];return a<b?-1:a>b?1:0});for(c=0;c<f.macroPositions.length;c+=1);f.pattern=a.replace(".","\\.").replace("(","\\(").replace(")","\\)").replace(/\\/g,"\\\\");for(c=0;c<m(b);c+=1){d="%"+b[c];switch(b[c]){case "y":e="(\\d{4})";break;default:e="(\\d{1,2})"}f.pattern=f.pattern.replace(d,e)}return f}
function N(a,b,c){if("now"===a)return{date:new Date};var d;d=null;b=Ia(b,c);if(c=new RegExp("^"+b.pattern+"$"))if(a=c.exec(a)){d={};for(c=1;c<a.length;c+=1)d[b.macroPositions[c-1][0]]=parseInt(a[c],10);if(b.isDateRelated){var e,f;--d.m;e=b.isDate?new Date(d.y,d.m,d.d):new Date(d.y,d.m,d.d,d.H,d.M);e.getFullYear()===d.y&&e.getMonth()===d.m&&e.getDate()===d.d&&(b.isDateTime?e.getHours()===d.H&&e.getMinutes()===d.M&&(f=g.extend(!0,{},d,{date:e})):f=g.extend(!0,{},d,{date:e}));d=f}else f=new Date(d.y,
0,1+7*(d.w-1)),4>=f.getDay()?f.setDate(f.getDate()-f.getDay()+1):f.setDate(f.getDate()+8-f.getDay()),1===d.w&&ra(f)===d.y-1&&(e=g.extend(!0,{},d,{date:f})),f.getFullYear()===ra(f)&&f.getFullYear()===d.y&&(e=g.extend(!0,{},d,{date:f})),d=e}return d}function sa(a,b,c,d){var e=N(a.config.max,c,d);return(a=N(a.config.min,c,d))&&b<a.date?"min":e&&b>e.date?"max":!0}function ga(a,b){var c=a.field.value,d=a.config.format;if("d"===b){if(c=N(c,d,["y","m","d"]))return sa(a,c.date,"%y-%m-%d",["y","m","d"])}else if("dt"===
b){if(c=N(c,d,["y","m","d","H","M"]))return sa(a,c.date,"%y-%m-%d %H:%M",["y","m","d","H","M"])}else if("w"===b&&(c=N(c,d,["y","w"]))){var e=["y","w"],d=N(a.config.max,"%y-W%w",e),c=(e=N(a.config.min,"%y-W%w",e))&&c.date<e.date?"min":d&&c.date>d.date?"max":!0;return c}return!1}function ta(a,b){var c=a.valjs("getFieldType"),d=a.attr(b);return"select"===c.type&&!0===c.isMultiple?h(d)?!1:{value:d}:!1}function ha(a,b,c){if(!a)return NaN;"."!==b&&(a=a.replace(".","=-=!"));a=a.replace(b,".");a=a.replace(/^0+(\d)/,
"$1");c&&(a=a.replace(/\.0+$/,""),-1!==a.indexOf(".")&&(a=a.replace(/\.([0-9]+?)(0+)$/,".$1")));b=c?parseFloat(a):parseInt(a,10);return String(b)===String(a)?b:NaN}function ua(a){if(!("text"!==a.type&&"textarea"!==a.type||a.date||a.number||a.week||a.datetime))return!0}function S(a){return a.binding.getFieldValue().value}function C(a){return a.binding.getRule()}var q=function(a,b){this.valjsv="1.1";this.context=a;this.jqContext=g(a);this.jqContext.data("vjs-i",this);this.options=b;this.metadata=this.jqContext.data("valjs");
this.$form=null;this.workers=new wa;this.elementUpdated=ya;this.waitForIt=xa;this.vars={off:"valjs__off",clean:{}};this.e=[];this.s=[]},Ja=aa.ValJS&&aa.ValJS.global?aa.ValJS.global:{},Y=q,E="vjs-bn",ka=".valjs",va="week date datetime number listmax listmin filemin filemax".split(" ");y.prototype.hasRule=g.noop;y.prototype.getFieldType=g.noop;y.prototype.getRules=g.noop;y.prototype.resetField=g.noop;y.prototype.validateField=g.noop;y.prototype.getContext=g.noop;y.prototype.getForm=g.noop;y.prototype.isValid=
g.noop;y.prototype.getRule=g.noop;y.prototype.getFieldValue=g.noop;y.prototype.getFieldStatus=g.noop;ea.prototype=new y;q.prototype={defaults:{elements:{submit:"valjs__submit",field:"valjs__field",form:"valjs__form",label:"valjs__label",msg:"valjs__msg",context:"valjs__context"},alwaysTriggerFieldEvents:!1,liveValidation:!0,createMsg:!0,modifierSeparator:null,attrPrefix:"",findMsg:function(a){var b=a.element,c=a.valjs;a=a.create;var d=null,e=c.jqContext.find("[data-msg-for='"+b.attr("id")+"']");c.config.elements&&
c.config.elements.msg&&0===m(e)&&(d="LABEL"===b.parent().prop("tagName")?b.parent():b,e=d.next("."+c.config.elements.msg));0===m(e)&&a&&c.config.createMsg&&(e=g("<span>"),e=e.insertAfter(d));a&&e.show();return e},findLabel:W,allowRuleInitialization:!0,setupField:g.noop,autoEnableButtons:!0,modifiers:{valid:"valjs-valid",invalid:"valjs-invalid",unknown:"valjs-unknown",error:"valjs-error",warning:"valjs-warning",busy:"valjs-busy",failed:"valjs-failed"},selector:{elements:"input:not([type=submit], [type=button]),select,textarea",
submit:'input[type="submit"],button[type="submit"],button:not([type]),input[type="image"]'},submitform:g.noop},ruleDefaults:{testElement:g.noop,bind:g.noop,prio:100,run:g.noop,options:{value:!0},findMsg:g.noop},validateForm:function(a){var b=v(g(this),"vjs-i");a=g.extend({includeHidden:!1},a);return qa(b,jQuery.Event("validateForm"),!1,a)},updateBindings:function(){X(v(g(this),"vjs-i"))},getRuleMessages:function(){X(v(g(this),"vjs-i"))},init:function(){this.config=g.extend(!0,{},this.defaults,Ja,
q.global,this.options);var a=this,b=this.config.selector;this.vars=Ga(this.config);if("FORM"===this.jqContext.prop("tagName"))this.$form=this.jqContext;else if(this.$form=this.jqContext.closest("form"),v(this.$form,"vjs-i"))throw"valjs: form/context conflict";T(this.jqContext,L(this,"context"));T(this.$form.attr("novalidate",""),L(this,"form"));this.s=g(P(b.submit,this.jqContext));T(this.s,L(this,"submit"));if(this.config.submitform&&this.config.submitform!==g.noop)this.jqContext.on("submitform.valjs",
this.config.submitform);g.isFunction(this.config.init)?setTimeout(function(){X(a);a.config.init(a)},1):X(a);return this},refresh:function(){X(this)},isElementBound:function(){return v(g(this),E)?!0:!1},disable:function(a){this.valjsv&&(a=this.$elm.find(a),v(a,this.vars.off,1))}};q.idCounter=0;q.ruleDefaults=q.prototype.ruleDefaults;q.global={};q.addRule=t;q.rules={k:[]};g.fn.valjs=function(a){if(q.prototype[a])return q.prototype[a].apply(g(this),Array.prototype.slice.call(arguments,1));if(ea.prototype[a]&&
v(g(this),E)){var b=Array.prototype.slice.call(arguments,1),c=this.map(function(c){c=a;var e=b;if(q.prototype[c])c=q.prototype[c].apply(g(this),e);else{var f=v(g(this),E);c=f?f[c].apply(f,e):{}}return c});return 1===c.length?c[0]:c}if("object"===typeof a||!a)return this.each(function(){if(v(g(this),"vjs-i"))return g(this).valjs("updateBindings"),this;(new q(this,a||{})).init()});g.error("No ValJS method "+a)};t("listmin",{options:{msg:"Select more items"},testElement:function(a){return ta(a.element,
"min")},run:function(a){var b=a.config.value;return m(P("option:selected",a.element))>=b},bind:function(a){return{value:parseInt(a.config.value,10)}}});t("listmax",{options:{msg:"Too many items selected"},testElement:function(a){return ta(a.element,"max")},run:function(a){var b=a.config.value;return m(P("option:selected",a.element))<=b},bind:function(a){return{value:parseInt(a.config.value,10)}}});t("date",{options:{msg:{error:"Invalid date",max:"Enter an earlier date",min:"Enter a later date"},format:"%y-%m-%d"},
testElement:function(a){return a.element.attr("type")===a.rule.name},bind:function(a){a=a.element;var b,c={};if(b=a.attr("min"))c.min=b;if(b=a.attr("max"))c.max=b;return c},run:function(a){return 0===m(a.field.value)?!0:ga(a,"d")}});t("datetime",{options:{msg:{error:"Invalid date",max:"Enter an earlier date",min:"Enter a later date"},format:"%y-%m-%d %H:%M"},testElement:function(a){return a.element.attr("type")===a.rule.name},bind:function(a){a=a.element;var b,c={};if(b=a.attr("min"))c.min=b;if(b=
a.attr("max"))c.max=b;return c},run:function(a){return 0===m(a.field.value)?!0:ga(a,"dt")}});t("week",{options:{msg:{error:"Invalid week",max:"Enter an earlier week",min:"Enter a later week"},format:"%y-W%w"},testElement:function(a){return a.element.attr("type")===a.rule.name},bind:function(a){a=a.element;var b,c={};if(b=a.attr("min"))c.min=b;if(b=a.attr("max"))c.max=b;return c},run:function(a){return 0===m(a.field.value)?!0:ga(a,"w")}});t("required",{options:{msg:"Required",trim:!1,emptyIndex:void 0,
emptyValue:void 0},prio:10,testElement:function(a){return!h(a.element.attr(a.rule.name))},run:function(a){var b=a.element,c=a.field.type,d=a.field.value,e=0;if("text"===c||"textarea"===c||"file"===c){if(d=!0===a.config.trim?g.trim(a.field.value):d,0===m(d))return"error"}else if("select"===c)if(h(b.attr("multiple"))){if(!h(a.config.emptyIndex))return e=parseInt(a.config.emptyIndex,10),d=P("option:selected",b).index(),d===e?"error":!0;if(!h(a.config.emptyValue))return d[0]===a.config.emptyValue?"error":
!0;if(0===m(d[0]))return"error"}else{if(0===m(d))return"error"}else if(("checkbox"===c||"radio"===c)&&!1===d)return"error";return!0}});t("number",{options:{msg:{error:"Not a number",max:"Value too high",min:"Value too low"},separator:".",step:null},testElement:function(a){return"number"===a.element.attr("type")},run:function(a){var b=a.field.value,c="any"===a.config.step,d=ha(a.config.max,".",c),e=ha(a.config.min,".",c),f=b;if(0!==m(b)){f=ha(b,a.config.separator,c);if(isNaN(f))return!1;if(!isNaN(e)&&
f<e)return"min";if(!isNaN(d)&&f>d)return"max"}return!0},bind:function(a){return{step:a.element.attr("step"),min:a.element.attr("min"),max:a.element.attr("max")}}});t("textmax",{options:{msg:{error:"Text too long"}},prio:150,testElement:function(a){var b=a.element.valjs("getFieldType");if((a=a.element.attr("max"))&&ua(b))return{value:a}},bind:function(a){var b=C(a);return a.binding.hasRule(va)?!1:g.extend(!0,b,{value:parseInt(b.value,10)})},run:function(a){var b=S(a);a=C(a);return b&&m(b)>a.value?
!1:!0}});t("textmin",{options:{msg:{error:"Text too short"}},prio:150,testElement:function(a){var b=a.element.valjs("getFieldType");if((a=a.element.attr("min"))&&ua(b))return{value:a}},bind:function(a){var b=C(a);return a.binding.hasRule(va)?!1:g.extend(!0,b,{value:parseInt(b.value,10)})},run:function(a){var b=S(a);return b&&m(b)<C(a).value?!1:!0}});t("filemax",{options:{msg:{error:null,one:"File too large",all:"Total size too large"}},testElement:function(a){var b=a.element.valjs("getFieldType");
a=a.element.attr("max");if("file"===b.type&&a)return{value:a}},bind:function(a){a=C(a);return g.extend(!0,a,{value:parseInt(a.value,10)})},run:function(a){var b=C(a).value,c=a.binding.getElement()[0].files,d=m(c),e,f=0;if(0<d){for(e=0;e<d;e+=1)if(a=c[e].size,f+=a,a>b)return{msg:"one",maxKiB:b,maxsize:J(b),filename:c[e].name,fileKiB:a,filesize:J(a)};if(f>b)return{msg:"all",totalKiB:f,totalsize:J(f),maxsize:J(b),maxKiB:b}}return!0}});t("filemin",{options:{msg:{error:null,one:"File too small",all:"Total size too small"}},
testElement:function(a){var b=a.element.valjs("getFieldType");a=a.element.attr("min");if("file"===b.type&&a)return{value:a}},bind:function(a){a=C(a);return g.extend(!0,a,{value:parseInt(a.value,10)})},run:function(a){var b=C(a).value,c=a.binding.getElement()[0].files,d=m(c),e,f=0;if(0<d){for(e=0;e<d;e+=1)if(a=c[e].size,f+=a,a<b)return{msg:"one",minbytes:b,minsize:J(b),filename:c[e].name,filebytes:a,filesize:J(a)};if(f<b)return{msg:"all",totalbytes:f,totalsize:J(f),minsize:J(b),minbytes:b}}return!0}});
t("email",{options:{msg:{error:"Invalid e-mail"},domain:!0},testElement:function(a){return a.element.attr("type")===a.rule.name},run:function(a){var b=S(a),c,d=!0,e,f;return 0<m(b)?(I(b)||(b=b[0]),c=b.indexOf("@"),-1===c?d=!1:(d=b.substr(c+1),c=b.substr(0,c),e=c.length,f=d.length,d=1>e||64<e||1>f||255<f||"."===c[0]||"."===c[e-1]||/\.\./.test(c)||!/^[\u00e5\u00e4\u00f6A-Za-z0-9\\-\\.]+$/.test(d)||!/^[\u00e5\u00e4\u00f6A-Za-z0-9\\-\\.]+$/.test(d)||/\.\./.test(d)||!/^(\.|[A-Za-z0-9!#%&`_=\/$\'*+?\^{}|~.\-])+$/.test(c.replace("\\\\",
""))&&!/^"(\\\\"|[^"])+"$/.test(c.replace("\\\\",""))?!1:!0,a.config.domain&&(/\.[a-z]{2,4}$/.test(b)||(d=!1))),d?!0:!1):!0},bind:function(a){var b=a.binding.getFieldType().type;a=a.binding.getElement();return"select"!==b||h(a.attr("multiple"))?!0:!1}});t("confirm",{options:{msg:{error:"Fields don't match",invalidSource:"Source field invalid"}},run:function(a){var b=a.binding.getElement();a=C(a).celm;if(a.valjs("isElementBound")){if(!na(a))return!0;0===a.valjs("getFieldStatus")&&a.valjs("validateField");
if(-1===a.valjs("getFieldStatus"))return"invalidSource"}return a.val()===b.val()?!0:!1},bind:function(a){var b=Ha(a.context,a.config.value);if(!h(b)){if(a.valjs.config.liveValidation)b.on("keydown keyup change blur",function(){a.element.valjs("validateField")}).on("validfield.valjs",function(){a.element.valjs("validateField")});return{celm:b}}}});t("pattern",{options:{ignoreCase:!1,invert:!1,msg:{error:"Incorrect format"}},testElement:function(a){if(a=a.element.attr("pattern"))return{value:a}},run:function(a){var b=
C(a),c=b.invert,b=new RegExp(b.value,b.ignoreCase?"i":"");if(a=S(a)){if(b){if(a=b.test(a))return c?!1:!0;if(c)return!0}return!1}return!0}});t("url",{options:{value:"",msg:{error:"Invalid URL"}},testElement:function(a){return"url"===a.element.attr("type")},run:function(a){return(a=S(a))?/^(https?|s?ftp|wss?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a):
!0}});t("security",{options:{value:"luns",match:2,msg:{error:"Requirements not met"}},bind:function(a){return{match:parseInt(a.config.match,10)}},run:function(a){var b=C(a);a=S(a);var c=b.value,b=b.match,d=0;b>c.length&&(b=c.length);-1!==R(c,"l")&&(d+=a.match(/[a-z]/)?1:0);-1!==R(c,"u")&&(d+=a.match(/[A-Z]/)?1:0);-1!==R(c,"n")&&(d+=a.match(/\d/)?1:0);-1!==R(c,"s")&&(c=new RegExp("["+'!@#$%^&*()_+|~-=\u00e2\u20ac\u02dc{}[]:";\u00e2\u20ac\u2122<>?,./'.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+
"]"),a.match(c)&&(d+=1));return d>=b?!0:!1}});t("remote",{async:1E3,prio:1500,checkEvent:function(a){return a&&"change"===a.type},options:{allowFailed:!1,prepare:function(a){return{field:a.element.attr("name"),value:a.field.value}},msg:{error:"Invalid entry",fail:"Unable to validate",busy:"Validating..."},ajax:{method:"post",dataType:"json",success:function(a){if(I(a))return this.reject("fail");a.status&&"success"===a.status?this.resolve(!0):this.resolve(a.data)},error:function(a,b,c){"abort"!==b&&
this.reject("fail")}}},abort:function(){this._timer&&clearTimeout(this._timer);this._ajax&&(this._ajax.abort(),this._ajax=null)},run:function(a){var b={},c=this,d=a.binding.getRule(),b=d.prepare(a);this._timer&&clearTimeout(this._timer);this._timer=setTimeout(function(){c._ajax=g.ajax(g.extend(!0,{url:d.value,data:b},d.ajax,{context:c}))},300);return this.makePromise()}});return q}(window,jQuery);