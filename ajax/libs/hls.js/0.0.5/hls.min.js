!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){return function e(t,i,r){function s(a,o){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){var i=t[a][1][e];return s(i?i:e)},h,h.exports,e,t,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,i){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function n(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,i,r,n,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],o(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,n=new Array(r-1),l=1;r>l;l++)n[l-1]=arguments[l];i.apply(this,n)}else if(a(i)){for(r=arguments.length,n=new Array(r-1),l=1;r>l;l++)n[l-1]=arguments[l];for(u=i.slice(),r=u.length,l=0;r>l;l++)u[l].apply(this,n)}return!0},r.prototype.addListener=function(e,t){var i;if(!s(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var i;i=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var r=!1;return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var i,r,n,o;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],n=i.length,r=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(i)){for(o=n;o-->0;)if(i[o]===t||i[o].listener&&i[o].listener===t){r=o;break}if(0>r)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],s(i))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var i;return i=e._events&&e._events[t]?s(e._events[t])?1:e._events[t].length:0}},{}],2:[function(e,t,i){var r=arguments[3],s=arguments[4],n=arguments[5],a=JSON.stringify;t.exports=function(e){for(var t,i=Object.keys(n),o=0,l=i.length;l>o;o++){var u=i[o];if(n[u].exports===e){t=u;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},o=0,l=i.length;l>o;o++){var u=i[o];h[u]=u}s[t]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[t]=t,s[d]=[Function(["require"],"require("+a(t)+")(self)"),c];var f="("+r+")({"+Object.keys(s).map(function(e){return a(e)+":["+s[e][0]+","+a(s[e][1])+"]"}).join(",")+"},{},["+a(d)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(v.createObjectURL(new Blob([f],{type:"text/javascript"})))}},{}],3:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("../loader/fragment-loader")),o=s(e("../observer")),l=e("../utils/logger").logger,u=s(e("../demux/demuxer")),h=-1,d=0,c=1,f=2,v=3,g=4,b=5,m=function(){function e(e){this.levelController=e,this.fragmentLoader=new a,this.mp4segments=[],this.onsbue=this.onSourceBufferUpdateEnd.bind(this),this.onsbe=this.onSourceBufferError.bind(this),this.onmse=this.onMSEAttached.bind(this),this.onmp=this.onManifestParsed.bind(this),this.onll=this.onLevelLoaded.bind(this),this.onfl=this.onFragmentLoaded.bind(this),this.onis=this.onInitSegment.bind(this),this.onfpg=this.onFragmentParsing.bind(this),this.onfp=this.onFragmentParsed.bind(this),this.ontick=this.tick.bind(this),o.on(n.MSE_ATTACHED,this.onmse),o.on(n.MANIFEST_PARSED,this.onmp),this.demuxer=new u}return r(e,null,{destroy:{value:function(){this.stop(),this.fragmentLoader.destroy(),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.mp4segments=[];var e=this.sourceBuffer;e&&(e.audio&&(this.mediaSource.removeSourceBuffer(e.audio),e.audio.removeEventListener("updateend",this.onsbue),e.audio.removeEventListener("error",this.onsbe)),e.video&&(this.mediaSource.removeSourceBuffer(e.video),e.video.removeEventListener("updateend",this.onsbue),e.video.removeEventListener("error",this.onsbe)),this.sourceBuffer=null),o.removeListener(n.MANIFEST_PARSED,this.onmp),this.video&&(this.video.removeEventListener("seeking",this.onvseeking),this.video.removeEventListener("seeked",this.onvseeked),this.video.removeEventListener("loadedmetadata",this.onvmetadata),this.onvseeking=this.onvseeked=this.onvmetadata=null),this.state=d},writable:!0,enumerable:!0,configurable:!0},start:{value:function(){this.stop(),this.timer=setInterval(this.ontick,100),o.on(n.FRAG_LOADED,this.onfl),o.on(n.FRAG_PARSING_INIT_SEGMENT,this.onis),o.on(n.FRAG_PARSING_DATA,this.onfpg),o.on(n.FRAG_PARSED,this.onfp),o.on(n.LEVEL_LOADED,this.onll),this.state=h,this.tick()},writable:!0,enumerable:!0,configurable:!0},stop:{value:function(){this.timer&&clearInterval(this.timer),this.timer=void 0,o.removeListener(n.FRAG_LOADED,this.onfl),o.removeListener(n.FRAG_PARSED,this.onfp),o.removeListener(n.FRAG_PARSING_DATA,this.onfpg),o.removeListener(n.LEVEL_LOADED,this.onll),o.removeListener(n.FRAG_PARSING_INIT_SEGMENT,this.onis)},writable:!0,enumerable:!0,configurable:!0},tick:{value:function(){var e,t,i,r;switch(this.state){case h:this.startLevel=this.levelController.startLevel,-1===this.startLevel&&(this.startLevel=0,this.fragmentBitrateTest=!0),this.levelController.level=this.startLevel,this.state=f,this.loadedmetadata=!1;break;case d:e=this.loadedmetadata?this.video.currentTime:this.nextLoadPosition,t=this.startFragmentLoaded===!1?this.startLevel:this.levelController.nextLevel();var s=this.bufferInfo(e),n=s.len,a=s.end,o=Math.min(48e7/this.levels[t].bitrate,30);if(o>n){if(t!==this.level&&(this.levelController.level=t,this.demuxer&&this.demuxer.switchLevel()),i=this.levels[t].details,"undefined"==typeof i){this.state=f;break}var u,m=i.fragments,p=i.sliding,_=m[0].start+p;if(_>a){l.log("requested position:"+a+" is before start of playlist, reset video position to start:"+_),this.video.currentTime=_+.01;break}if(n>0&&1===this.video.buffered.length){if(r=this.frag.sn+1-m[0].sn,r>=m.length){this.state=f;break}u=m[r]}else for(r=0;r<m.length&&(u=m[r],_=u.start+p,!(a>=_&&_+u.duration>a));r++);if(r>=0&&r<m.length){if(this.frag&&u.sn===this.frag.sn){if(r===m.length-1)break;u=m[r+1],l.log("SN just loaded, load next one:"+u.sn)}l.log("Loading       "+u.sn+" of ["+m[0].sn+","+m[m.length-1].sn+"],level "+t),this.frag=u,this.level=t,this.fragmentLoader.load(u,t),this.state=c}}break;case c:case f:case v:break;case g:case b:if(this.sourceBuffer)if(this.sourceBuffer.audio&&this.sourceBuffer.audio.updating||this.sourceBuffer.video&&this.sourceBuffer.video.updating);else if(this.mp4segments.length){var w=this.mp4segments.shift();this.sourceBuffer[w.type].appendBuffer(w.data),this.state=b}}this._checkFragmentPlaying()},writable:!0,enumerable:!0,configurable:!0},bufferInfo:{value:function(e){var t,i,r,s,n=this.video,a=n.buffered,o=[];for(s=0;s<a.length;s++)o.length&&a.start(s)-o[o.length-1].end<.3?o[o.length-1].end=a.end(s):o.push({start:a.start(s),end:a.end(s)});for(s=0,t=0,i=r=e;s<o.length;s++)e+.3>=o[s].start&&e<o[s].end&&(i=o[s].start,r=o[s].end+.3,t=r-e);return{len:t,start:i,end:r}},writable:!0,enumerable:!0,configurable:!0},getFragment:{value:function(e){var t,i;for(t=this.bufferRange.length-1;t>=0;t--)if(i=this.bufferRange[t],e>=i.start&&e<=i.end)return i.frag;return null},writable:!0,enumerable:!0,configurable:!0},playbackLevel:{get:function(){var e=this.getFragment(this.video.currentTime);return e?e.level:-1},enumerable:!0,configurable:!0},isBuffered:{value:function(e){for(var t=this.video,i=t.buffered,r=0;r<i.length;r++)if(e>=i.start(r)&&e<=i.end(r))return!0;return!1},writable:!0,enumerable:!0,configurable:!0},_checkFragmentPlaying:{value:function(){var e;e=this.video&&this.video.seeking===!1&&this.isBuffered(this.video.currentTime)?this.getFragment(this.video.currentTime):null,e!==this.fragPlaying&&(this.fragPlaying=e,o.trigger(n.FRAG_PLAYING,{frag:e}))},writable:!0,enumerable:!0,configurable:!0},onMSEAttached:{value:function(e,t){this.video=t.video,this.mediaSource=t.mediaSource,this.onvseeking=this.onVideoSeeking.bind(this),this.onvseeked=this.onVideoSeeked.bind(this),this.onvmetadata=this.onVideoMetadata.bind(this),this.video.addEventListener("seeking",this.onvseeking),this.video.addEventListener("seeked",this.onvseeked),this.video.addEventListener("loadedmetadata",this.onvmetadata),this.levels&&this.start()},writable:!0,enumerable:!0,configurable:!0},onVideoSeeking:{value:function(){this.state===c&&0===this.bufferInfo(this.video.currentTime).len&&(l.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),this.fragmentLoader.abort(),this.state=d),this.tick()},writable:!0,enumerable:!0,configurable:!0},onVideoSeeked:{value:function(){this.tick()},writable:!0,enumerable:!0,configurable:!0},onVideoMetadata:{value:function(){this.video.currentTime!==this.startPosition&&(this.video.currentTime=this.startPosition),this.loadedmetadata=!0,this.tick()},writable:!0,enumerable:!0,configurable:!0},onManifestParsed:{value:function(e,t){this.audiocodecswitch=t.audiocodecswitch,this.audiocodecswitch&&l.log("both AAC/HE-AAC audio found in levels; declaring audio codec as HE-AAC"),this.levels=t.levels,this.startLevelLoaded=!1,this.startFragmentLoaded=!1,this.video&&this.start()},writable:!0,enumerable:!0,configurable:!0},onLevelLoaded:{value:function(e,t){var i=t.details.fragments,r=t.details.totalduration;l.log("level "+t.levelId+" loaded ["+i[0].sn+","+i[i.length-1].sn+"],duration:"+r);var s=this.levels[t.levelId],n=0,a=this.levels[this.level];if(a&&a.details&&a.details.live){n=a.details.sliding;var o=i[0].sn-a.details.fragments[0].sn;o>=0?n+=a.details.fragments[o].start:n-=i[-o].start,l.log("live playlist sliding:"+n.toFixed(3))}s.details=t.details,s.details.sliding=n,this.demuxer.setDuration(r),this.startLevelLoaded===!1&&(this.startPosition=t.details.live?Math.max(0,r-3*t.details.targetduration):0,this.nextLoadPosition=this.startPosition,this.startLevelLoaded=!0),this.state===f&&(this.state=d),this.tick()},writable:!0,enumerable:!0,configurable:!0},onFragmentLoaded:{value:function(e,t){this.state===c&&(this.fragmentBitrateTest===!0?(this.state=d,this.fragmentBitrateTest=!1,t.stats.tparsed=t.stats.tbuffered=new Date,o.trigger(n.FRAG_BUFFERED,{stats:t.stats,frag:this.frag}),this.frag=null):(this.state=v,this.stats=t.stats,this.demuxer.push(t.payload,this.levels[this.level].audioCodec,this.levels[this.level].videoCodec,this.frag.start)),this.startFragmentLoaded=!0)},writable:!0,enumerable:!0,configurable:!0},onInitSegment:{value:function(e,t){var i,r=this.levels[this.level].audioCodec,s=this.levels[this.level].videoCodec;void 0===r&&(r=t.audioCodec),void 0===s&&(s=t.videoCodec),this.audiocodecswitch&&2===t.audioChannelCount&&-1===navigator.userAgent.toLowerCase().indexOf("android")&&-1===navigator.userAgent.toLowerCase().indexOf("firefox")&&(r="mp4a.40.5"),this.sourceBuffer||(this.sourceBuffer={},this.bufferRange=[],l.log("selected A/V codecs for sourceBuffers:"+r+","+s),r&&(i=this.sourceBuffer.audio=this.mediaSource.addSourceBuffer("video/mp4;codecs="+r),i.addEventListener("updateend",this.onsbue),i.addEventListener("error",this.onsbe)),s&&(i=this.sourceBuffer.video=this.mediaSource.addSourceBuffer("video/mp4;codecs="+s),i.addEventListener("updateend",this.onsbue),i.addEventListener("error",this.onsbe))),r&&this.mp4segments.push({type:"audio",data:t.audioMoov}),s&&this.mp4segments.push({type:"video",data:t.videoMoov}),this.tick()},writable:!0,enumerable:!0,configurable:!0},onFragmentParsing:{value:function(e,t){this.tparse2=Date.now();var i=this.levels[this.level];i.details.live&&(i.details.sliding=t.startPTS-this.frag.start),l.log("      parsed data, type/startPTS/endPTS/startDTS/endDTS/sliding:"+t.type+"/"+t.startPTS.toFixed(3)+"/"+t.endPTS.toFixed(3)+"/"+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"/"+i.details.sliding.toFixed(3)),this.mp4segments.push({type:t.type,data:t.moof}),this.mp4segments.push({type:t.type,data:t.mdat}),this.nextLoadPosition=t.endPTS,this.bufferRange.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:this.frag}),this.tick()},writable:!0,enumerable:!0,configurable:!0},onFragmentParsed:{value:function(){this.state=g,this.stats.tparsed=new Date,this.tick()},writable:!0,enumerable:!0,configurable:!0},onSourceBufferUpdateEnd:{value:function(){this.state===b&&0===this.mp4segments.length&&(this.stats.tbuffered=new Date,o.trigger(n.FRAG_BUFFERED,{stats:this.stats,frag:this.frag}),this.state=d),this.tick()},writable:!0,enumerable:!0,configurable:!0},onSourceBufferError:{value:function(e){l.log(" buffer append error:"+e)},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=m},{"../demux/demuxer":5,"../events":9,"../loader/fragment-loader":11,"../observer":13,"../utils/logger":15}],4:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("../observer")),o=e("../utils/logger").logger,l=function(){function e(e){this.playlistLoader=e,this.onml=this.onManifestLoaded.bind(this),this.onfl=this.onFragmentLoaded.bind(this),this.onll=this.onLevelLoaded.bind(this),this.ontick=this.tick.bind(this),a.on(n.MANIFEST_LOADED,this.onml),a.on(n.FRAG_LOADED,this.onfl),a.on(n.LEVEL_LOADED,this.onll),this._manualLevel=this._autoLevelCapping=-1}return r(e,null,{destroy:{value:function(){a.removeListener(n.MANIFEST_LOADED,this.onml),a.removeListener(n.FRAG_LOADED,this.onfl),a.removeListener(n.LEVEL_LOADED,this.onll),this.timer&&clearInterval(this.timer),this._manualLevel=-1},writable:!0,enumerable:!0,configurable:!0},onManifestLoaded:{value:function(e,t){var i,r,s,l=[],u={},h=!1,d=!1;for(t.levels.forEach(function(e){u.hasOwnProperty(e.bitrate)||(l.push(e),u[e.bitrate]=!0),s=e.codecs,s&&(-1!==s.indexOf("mp4a.40.2")&&(h=!0),-1!==s.indexOf("mp4a.40.5")&&(d=!0))}),i=l[0].bitrate,l.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=l,r=0;r<l.length;r++)if(l[r].bitrate===i){this._firstLevel=r,o.log("manifest loaded,"+l.length+" level(s) found, first bitrate:"+i);break}a.trigger(n.MANIFEST_PARSED,{levels:this._levels,startLevel:this._startLevel,audiocodecswitch:h&&d})},writable:!0,enumerable:!0,configurable:!0},levels:{get:function(){return this._levels},enumerable:!0,configurable:!0},level:{get:function(){return this._level},set:function(e){if(this._level!==e)if(e>=0&&e<this._levels.length){this.timer&&(clearInterval(this.timer),this.timer=null),this._level=e,o.log("switching to level "+e),a.trigger(n.LEVEL_SWITCH,{levelId:e});var t=this._levels[e];(void 0===t.loading||t.details&&t.details.live===!0)&&(a.trigger(n.LEVEL_LOADING,{levelId:e}),o.log("(re)loading playlist for level "+e),this.playlistLoader.load(t.url,e),t.loading=!0)}else a.trigger(n.LEVEL_ERROR,{level:e,event:"invalid level idx"})},enumerable:!0,configurable:!0},manualLevel:{get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,this.level=e},enumerable:!0,configurable:!0},autoLevelCapping:{get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e},enumerable:!0,configurable:!0},firstLevel:{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:!0,configurable:!0},startLevel:{get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e},enumerable:!0,configurable:!0},onFragmentLoaded:{value:function(e,t){var i,r,s;i=t.stats,r=i.tfirst-i.trequest,s=i.tload-i.trequest,this.lastbw=8e3*i.length/s},writable:!0,enumerable:!0,configurable:!0},onLevelLoaded:{value:function(e,t){t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration))},writable:!0,enumerable:!0,configurable:!0},tick:{value:function(){a.trigger(n.LEVEL_LOADING,{levelId:this._level}),this.playlistLoader.load(this._levels[this._level].url,this._level)},writable:!0,enumerable:!0,configurable:!0},nextLevel:{value:function(){return-1!==this._manualLevel?this._manualLevel:this.nextAutoLevel()},writable:!0,enumerable:!0,configurable:!0},nextAutoLevel:{value:function(){var e,t,i,r=this.lastbw;for(i=-1===this._autoLevelCapping?this._levels.length-1:this._autoLevelCapping,t=0;i>=t;t++)if(e=t<=this._level?.8*r:.7*r,e<this._levels[t].bitrate)return Math.max(0,t-1);return t-1},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=l},{"../events":9,"../observer":13,"../utils/logger":15}],5:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("./tsdemuxer")),o=s(e("./tsdemuxerworker")),l=s(e("../observer")),u=e("../utils/logger").logger,h=function(){function t(){var t=!0;if(t&&"undefined"!=typeof Worker){u.log("TS demuxing in webworker");var i=e("webworkify");this.w=i(o),this.onwmsg=this.onWorkerMessage.bind(this),this.w.addEventListener("message",this.onwmsg),this.w.postMessage({cmd:"init"})}else this.demuxer=new a;this.demuxInitialized=!0}return r(t,null,{setDuration:{value:function(e){this.w?this.w.postMessage({cmd:"duration",data:e}):this.demuxer.setDuration(e)},writable:!0,enumerable:!0,configurable:!0},destroy:{value:function(){this.w?(this.w.removeEventListener("message",this.onwmsg),this.w.terminate(),this.w=null):this.demuxer.destroy()},writable:!0,enumerable:!0,configurable:!0},push:{value:function(e,t,i,r){this.w?this.w.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:i,timeOffset:r},[e]):(this.demuxer.push(new Uint8Array(e),t,i,r),this.demuxer.end())},writable:!0,enumerable:!0,configurable:!0},switchLevel:{value:function(){this.w?this.w.postMessage({cmd:"switchLevel"}):this.demuxer.switchLevel()},writable:!0,enumerable:!0,configurable:!0},onWorkerMessage:{value:function(e){switch(e.data.event){case n.FRAG_PARSING_INIT_SEGMENT:var t={};e.data.audioMoov&&(t.audioMoov=new Uint8Array(e.data.audioMoov),t.audioCodec=e.data.audioCodec,t.audioChannelCount=e.data.audioChannelCount),e.data.videoMoov&&(t.videoMoov=new Uint8Array(e.data.videoMoov),t.videoCodec=e.data.videoCodec,t.videoWidth=e.data.videoWidth,t.videoHeight=e.data.videoHeight),l.trigger(n.FRAG_PARSING_INIT_SEGMENT,t);break;case n.FRAG_PARSING_DATA:l.trigger(n.FRAG_PARSING_DATA,{moof:new Uint8Array(e.data.moof),mdat:new Uint8Array(e.data.mdat),startPTS:e.data.startPTS,endPTS:e.data.endPTS,startDTS:e.data.startDTS,endDTS:e.data.endDTS,type:e.data.type});break;case n.FRAG_PARSED:l.trigger(n.FRAG_PARSED)}},writable:!0,enumerable:!0,configurable:!0}}),t}();t.exports=h},{"../events":9,"../observer":13,"../utils/logger":15,"./tsdemuxer":7,"./tsdemuxerworker":8,webworkify:2}],6:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=e("../utils/logger").logger,n=function(){function e(e){this.workingData=e,this.workingBytesAvailable=this.workingData.byteLength,this.workingWord=0,this.workingBitsAvailable=0}return r(e,null,{loadWord:{value:function(){var e=this.workingData.byteLength-this.workingBytesAvailable,t=new Uint8Array(4),i=Math.min(4,this.workingBytesAvailable);if(0===i)throw new Error("no bytes available");t.set(this.workingData.subarray(e,e+i)),this.workingWord=new DataView(t.buffer).getUint32(0),this.workingBitsAvailable=8*i,this.workingBytesAvailable-=i},writable:!0,enumerable:!0,configurable:!0},skipBits:{value:function(e){var t;this.workingBitsAvailable>e?(this.workingWord<<=e,this.workingBitsAvailable-=e):(e-=this.workingBitsAvailable,t=e>>3,e-=t>>3,this.workingBytesAvailable-=t,this.loadWord(),this.workingWord<<=e,this.workingBitsAvailable-=e)},writable:!0,enumerable:!0,configurable:!0},readBits:{value:function(e){var t=Math.min(this.workingBitsAvailable,e),i=this.workingWord>>>32-t;return e>32&&s.error("Cannot read more than 32 bits at a time"),this.workingBitsAvailable-=t,this.workingBitsAvailable>0?this.workingWord<<=t:this.workingBytesAvailable>0&&this.loadWord(),t=e-t,t>0?i<<t|this.readBits(t):i},writable:!0,enumerable:!0,configurable:!0},skipLeadingZeros:{value:function(){var e;for(e=0;e<this.workingBitsAvailable;++e)if(0!==(this.workingWord&2147483648>>>e))return this.workingWord<<=e,this.workingBitsAvailable-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},writable:!0,enumerable:!0,configurable:!0},skipUnsignedExpGolomb:{value:function(){this.skipBits(1+this.skipLeadingZeros())},writable:!0,enumerable:!0,configurable:!0},skipExpGolomb:{value:function(){this.skipBits(1+this.skipLeadingZeros())},writable:!0,enumerable:!0,configurable:!0},readUnsignedExpGolomb:{value:function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},writable:!0,enumerable:!0,configurable:!0},readExpGolomb:{value:function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},writable:!0,enumerable:!0,configurable:!0},readBoolean:{value:function(){return 1===this.readBits(1)},writable:!0,enumerable:!0,configurable:!0},readUnsignedByte:{value:function(){return this.readBits(8)},writable:!0,enumerable:!0,configurable:!0},skipScalingList:{value:function(e){var t,i,r=8,s=8;for(t=0;e>t;t++)0!==s&&(i=this.readExpGolomb(),s=(r+i+256)%256),r=0===s?r:s},writable:!0,enumerable:!0,configurable:!0},readSequenceParameterSet:{value:function(){var e,t,i,r,s,n,a,o,l,u=0,h=0,d=0,c=0;if(this.readUnsignedByte(),e=this.readUnsignedByte(),t=this.readBits(5),this.skipBits(3),i=this.readUnsignedByte(),this.skipUnsignedExpGolomb(),100===e||110===e||122===e||144===e){var f=this.readUnsignedExpGolomb();if(3===f&&this.skipBits(1),this.skipUnsignedExpGolomb(),this.skipUnsignedExpGolomb(),this.skipBits(1),this.readBoolean())for(o=3!==f?8:12,l=0;o>l;l++)this.readBoolean()&&this.skipScalingList(6>l?16:64)}this.skipUnsignedExpGolomb();var v=this.readUnsignedExpGolomb();if(0===v)this.readUnsignedExpGolomb();else if(1===v)for(this.skipBits(1),this.skipExpGolomb(),this.skipExpGolomb(),r=this.readUnsignedExpGolomb(),l=0;r>l;l++)this.skipExpGolomb();return this.skipUnsignedExpGolomb(),this.skipBits(1),s=this.readUnsignedExpGolomb(),n=this.readUnsignedExpGolomb(),a=this.readBits(1),0===a&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(u=this.readUnsignedExpGolomb(),h=this.readUnsignedExpGolomb(),d=this.readUnsignedExpGolomb(),c=this.readUnsignedExpGolomb()),{profileIdc:e,profileCompatibility:t,levelIdc:i,width:16*(s+1)-2*u-2*h,height:(2-a)*(n+1)*16-2*d-2*c}},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=n},{"../utils/logger":15}],7:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("./exp-golomb")),o=s(e("../remux/mp4-generator")),l=s(e("../observer")),u=e("../utils/logger").logger,h=function(){function e(){this.switchLevel()}return r(e,null,{setDuration:{value:function(e){this._duration=e},writable:!0,enumerable:!0,configurable:!0},switchLevel:{value:function(){this.pmtParsed=!1,this._pmtId=this._avcId=this._aacId=-1,this._avcTrack={type:"video",sequenceNumber:0},this._aacTrack={type:"audio",sequenceNumber:0},this._avcSamples=[],this._avcSamplesLength=0,this._avcSamplesNbNalu=0,this._aacSamples=[],this._aacSamplesLength=0,this._initSegGenerated=!1},writable:!0,enumerable:!0,configurable:!0},push:{value:function(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.timeOffset=r;var s;for(s=0;s<e.length;s+=188)this._parseTSPacket(e,s)},writable:!0,enumerable:!0,configurable:!0},end:{value:function(){this._avcData&&(this._parseAVCPES(this._parsePES(this._avcData)),this._avcData=null),this._avcSamples.length&&this._flushAVCSamples(),this._aacData&&(this._parseAACPES(this._parsePES(this._aacData)),this._aacData=null),this._aacSamples.length&&this._flushAACSamples(),l.trigger(n.FRAG_PARSED)},writable:!0,enumerable:!0,configurable:!0},destroy:{value:function(){this._duration=0},writable:!0,enumerable:!0,configurable:!0},_parseTSPacket:{value:function(e,t){var i,r,s,n;if(71===e[t]){if(i=!!(64&e[t+1]),r=((31&e[t+1])<<8)+e[t+2],s=(48&e[t+3])>>4,s>1){if(n=t+5+e[t+4],n===t+188)return}else n=t+4;this.pmtParsed?r===this._avcId?(i&&(this._avcData&&this._parseAVCPES(this._parsePES(this._avcData)),this._avcData={data:[],size:0}),this._avcData.data.push(e.subarray(n,t+188)),this._avcData.size+=t+188-n):r===this._aacId&&(i&&(this._aacData&&this._parseAACPES(this._parsePES(this._aacData)),this._aacData={data:[],size:0}),this._aacData.data.push(e.subarray(n,t+188)),this._aacData.size+=t+188-n):(i&&(n+=e[n]+1),0===r?this._parsePAT(e,n):r===this._pmtId&&(this._parsePMT(e,n),this.pmtParsed=!0))}else u.log("parsing error")},writable:!0,enumerable:!0,configurable:!0},_parsePAT:{value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]},writable:!0,enumerable:!0,configurable:!0},_parsePMT:{value:function(e,t){var i,r,s,n;for(i=(15&e[t+1])<<8|e[t+2],r=t+3+i-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;r>t;){switch(n=(31&e[t+1])<<8|e[t+2],e[t]){case 15:this._aacId=n,this._aacTrack.id=n;break;case 27:this._avcId=n,this._avcTrack.id=n;break;default:u.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}},writable:!0,enumerable:!0,configurable:!0},_parsePES:{value:function(e){var t,i,r,s,n,a,o,l,u,h=0;if(t=e.data[0],r=(t[0]<<16)+(t[1]<<8)+t[2],1===r){for(s=(t[4]<<8)+t[5],i=t[7],192&i&&(o=(14&t[9])<<28|(255&t[10])<<21|(254&t[11])<<13|(255&t[12])<<6|(254&t[13])>>>2,o/=45,64&i?(l=(14&t[14])<<28|(255&t[15])<<21|(254&t[16])<<13|(255&t[17])<<6|(254&t[18])>>>2,l/=45):l=o),n=t[8],u=n+9,e.data[0]=e.data[0].subarray(u),e.size-=u,a=new Uint8Array(e.size);e.data.length;)t=e.data.shift(),a.set(t,h),h+=t.byteLength;return{data:a,pts:o,dts:l,len:s}}return null},writable:!0,enumerable:!0,configurable:!0},_parseAVCPES:{value:function(e){var t,i,r=this,s=this._avcTrack,n=!1;t=this._parseAVCNALu(e.data),e.data=null,t.units.forEach(function(e){switch(e.type){case 5:n=!0;break;case 7:if(!s.sps){var t=new a(e.data),i=t.readSequenceParameterSet();s.width=i.width,s.height=i.height,s.profileIdc=i.profileIdc,s.profileCompatibility=i.profileCompatibility,s.levelIdc=i.levelIdc,s.sps=[e.data],s.duration=9e4*r._duration;for(var o=e.data.subarray(1,4),l="avc1.",u=0;3>u;u++){var h=o[u].toString(16);h.length<2&&(h="0"+h),l+=h}s.codec=l}break;case 8:s.pps||(s.pps=[e.data])}}),i={units:t,pts:e.pts,dts:e.dts,key:n},this._avcSamples.push(i),this._avcSamplesLength+=t.length,this._avcSamplesNbNalu+=t.units.length,this._initSegGenerated||this._generateInitSegment()},writable:!0,enumerable:!0,configurable:!0},_flushAVCSamples:{value:function(){var e,t,i,r,s,a,h,d,c,f,v,g,b=8,m=this._avcTrack;for(m.samples=[],h=new Uint8Array(this._avcSamplesLength+4*this._avcSamplesNbNalu+8),e=new DataView(h.buffer),e.setUint32(0,h.byteLength),h.set(o.types.mdat,4);this._avcSamples.length;){for(t=this._avcSamples.shift(),r=0;t.units.units.length;)s=t.units.units.shift(),e.setUint32(b,s.data.byteLength),b+=4,h.set(s.data,b),b+=s.data.byteLength,r+=4+s.data.byteLength;if(t.pts-=this._initDTS,t.dts-=this._initDTS,void 0!==a)i.duration=Math.round(90*(t.dts-a)),i.duration<0&&(i.duration=0);else{if(this.nextAvcPts){var p=t.pts-this.nextAvcPts,_=Math.abs(p);300>_&&(p>1?u.log("AVC:"+p.toFixed(0)+" ms hole between fragments detected,filling it"):-1>p&&u.log("AVC:"+-p.toFixed(0)+" ms overlapping between fragments detected"),t.pts=this.nextAvcPts,t.dts=Math.max(t.dts-p,this.lastAvcDts))}v=t.pts,g=t.dts}i={size:r,compositionTimeOffset:90*(t.pts-t.dts),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradationPriority:0}},t.key===!0?(i.flags.dependsOn=2,i.flags.isNonSyncSample=0):(i.flags.dependsOn=1,i.flags.isNonSyncSample=1),m.samples.push(i),a=t.dts}i.duration=m.samples[m.samples.length-2].duration,this.lastAvcDts=t.dts,this.nextAvcPts=t.pts+i.duration/90,this._avcSamplesLength=0,this._avcSamplesNbNalu=0,c=v/1e3,f=this.nextAvcPts/1e3,d=o.moof(m.sequenceNumber++,90*g,m),l.trigger(n.FRAG_PARSING_DATA,{moof:d,mdat:h,startPTS:c,endPTS:f,startDTS:g/1e3,endDTS:(t.dts+i.duration/90)/1e3,type:"video"})},writable:!0,enumerable:!0,configurable:!0},_parseAVCNALu:{value:function(e){for(var t,i,r,s,n,a,o=0,l=e.byteLength,u=0,h=[],d=0;l>o;)switch(t=e[o++],u){case 0:0===t&&(u=1);break;case 1:u=0===t?2:0;break;case 2:case 3:if(0===t)u=3;else if(1===t){if(s=31&e[o],n)r={data:e.subarray(n,o-u-1),type:a},d+=o-u-1-n,h.push(r);else if(i=o-u-1,i&&this._avcSamples.length){var c=this._avcSamples[this._avcSamples.length-1],f=c.units.units[c.units.units.length-1],v=new Uint8Array(f.data.byteLength+i);v.set(f.data,0),v.set(e.subarray(0,i),f.data.byteLength),f.data=v,c.units.length+=i,this._avcSamplesLength+=i}n=o,a=s,(1===s||5===s)&&(o=l),u=0}else u=0}return n&&(r={data:e.subarray(n,l),type:a},d+=l-n,h.push(r)),{units:h,length:d}},writable:!0,enumerable:!0,configurable:!0},_parseAACPES:{value:function(e){var t,i,r,s,a,o,u,h=this._aacTrack,d=e.data;if(this.aacOverFlow){var c=new Uint8Array(this.aacOverFlow.byteLength+d.byteLength);c.set(this.aacOverFlow,0),c.set(d,this.aacOverFlow.byteLength),d=c}if(255!==d[0])return void l.trigger(n.FRAG_PARSING_ERROR,"Stream did not start with ADTS header.");for(h.audiosamplerate||(i=this._ADTStoAudioConfig(e.data,this.audioCodec),h.config=i.config,h.audiosamplerate=i.samplerate,h.channelCount=i.channelCount,h.codec=i.codec,h.duration=9e4*this._duration,console.log(h.codec+",rate:"+i.samplerate+",nb channel:"+i.channelCount)),s=u=0;s+5<d.length&&(r=(3&d[s+3])<<11,r|=d[s+4]<<3,r|=(224&d[s+5])>>>5,a=1&d[s+1]?7:9,r-=a,o=e.pts+1024*u*1e3/h.audiosamplerate,s+a+r<=d.length);)t={unit:d.subarray(s+a,s+a+r),
pts:o,dts:o},this._aacSamples.push(t),this._aacSamplesLength+=r,s+=r+a,u++;this._initSegGenerated||this._generateInitSegment(),this.aacOverFlow=s<d.length?d.subarray(s,d.length):null},writable:!0,enumerable:!0,configurable:!0},_flushAACSamples:{value:function(){var e,t,i,r,s,a,h,d,c,f,v,g=8,b=this._aacTrack;for(b.samples=[],a=new Uint8Array(this._aacSamplesLength+8),e=new DataView(a.buffer),e.setUint32(0,a.byteLength),a.set(o.types.mdat,4);this._aacSamples.length;){if(t=this._aacSamples.shift(),r=t.unit,a.set(r,g),g+=r.byteLength,t.pts-=this._initDTS,t.dts-=this._initDTS,void 0!==s)i.duration=Math.round(90*(t.dts-s)),i.duration<0&&(i.duration=0);else{if(this.nextAacPts&&this.nextAacPts!==t.pts){var m=t.pts-this.nextAacPts;Math.abs(m)>1&&Math.abs(m)<300&&(m>0?(u.log("AAC:"+m.toFixed(0)+" ms hole between fragments detected,filling it"),t.pts=Math.max(this.nextAacPts,this.lastAacDts),t.dts=t.pts):u.log("AAC:"+-m.toFixed(0)+" ms overlapping between fragments detected"))}f=t.pts,v=t.dts}i={size:r.byteLength,compositionTimeOffset:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradationPriority:0,dependsOn:1}},b.samples.push(i),s=t.dts}i.duration=b.samples[b.samples.length-2].duration,this.lastAacDts=t.dts,this.nextAacPts=t.pts+i.duration/90,this._aacSamplesLength=0,d=f/1e3,c=this.nextAacPts/1e3,h=o.moof(b.sequenceNumber++,90*v,b),l.trigger(n.FRAG_PARSING_DATA,{moof:h,mdat:a,startPTS:d,endPTS:c,startDTS:v/1e3,endDTS:(t.dts+i.duration/90)/1e3,type:"audio"})},writable:!0,enumerable:!0,configurable:!0},_ADTStoAudioConfig:{value:function(e,t){var i,r,s,n,a,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3];return i=((192&e[2])>>>6)+1,r=(60&e[2])>>>2,n=(1&e[2])<<2,-1===navigator.userAgent.toLowerCase().indexOf("android")&&(t&&-1!==t.indexOf("mp4a.40.5")||!t&&r>=6)?(i=5,s=r-3,a=new Array(4)):(-1===navigator.userAgent.toLowerCase().indexOf("android")&&-1===navigator.userAgent.toLowerCase().indexOf("firefox")?(i=5,a=new Array(4)):(i=2,a=new Array(2)),s=r),n|=(192&e[3])>>>6,a[0]=i<<3,a[0]|=(14&r)>>1,a[1]|=(1&r)<<7,a[1]|=n<<3,5===i&&(a[1]|=(14&s)>>1,a[2]=(1&s)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:o[r],channelCount:n,codec:"mp4a.40."+i}},writable:!0,enumerable:!0,configurable:!0},_generateInitSegment:{value:function(){-1===this._avcId?(this._aacTrack.config&&(l.trigger(n.FRAG_PARSING_INIT_SEGMENT,{audioMoov:o.initSegment([this._aacTrack]),audioCodec:this._aacTrack.codec,audioChannelCount:this._aacTrack.channelCount}),this._initSegGenerated=!0),void 0===this._initPTS&&(this._initPTS=this._aacSamples[0].pts-1e3*this.timeOffset,this._initDTS=this._aacSamples[0].dts-1e3*this.timeOffset)):-1===this._aacId?this._avcTrack.sps&&this._avcTrack.pps&&(l.trigger(n.FRAG_PARSING_INIT_SEGMENT,{videoMoov:o.initSegment([this._avcTrack]),videoCodec:this._avcTrack.codec,videoWidth:this._avcTrack.width,videoHeight:this._avcTrack.height}),this._initSegGenerated=!0,void 0===this._initPTS&&(this._initPTS=this._avcSamples[0].pts-1e3*this.timeOffset,this._initDTS=this._avcSamples[0].dts-1e3*this.timeOffset)):this._aacTrack.config&&this._avcTrack.sps&&this._avcTrack.pps&&(l.trigger(n.FRAG_PARSING_INIT_SEGMENT,{audioMoov:o.initSegment([this._aacTrack]),audioCodec:this._aacTrack.codec,audioChannelCount:this._aacTrack.channelCount,videoMoov:o.initSegment([this._avcTrack]),videoCodec:this._avcTrack.codec,videoWidth:this._avcTrack.width,videoHeight:this._avcTrack.height}),this._initSegGenerated=!0,void 0===this._initPTS&&(this._initPTS=Math.min(this._avcSamples[0].pts,this._aacSamples[0].pts)-1e3*this.timeOffset,this._initDTS=Math.min(this._avcSamples[0].dts,this._aacSamples[0].dts)-1e3*this.timeOffset))},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=h},{"../events":9,"../observer":13,"../remux/mp4-generator":14,"../utils/logger":15,"./exp-golomb":6}],8:[function(e,t,i){"use strict";var r=function(e){return e&&(e.default||e)},s=r(e("../events")),n=r(e("../demux/tsdemuxer")),a=r(e("../observer")),o=function(){self.addEventListener("message",function(e){switch(e.data.cmd){case"init":self.demuxer=new n;break;case"duration":self.demuxer.setDuration(e.data.data);break;case"switchLevel":self.demuxer.switchLevel();break;case"demux":self.demuxer.push(new Uint8Array(e.data.data),e.data.audioCodec,e.data.videoCodec,e.data.timeOffset),self.demuxer.end()}}),a.on(s.FRAG_PARSING_INIT_SEGMENT,function(e,t){var i={event:e},r=[];t.audioCodec&&(i.audioCodec=t.audioCodec,i.audioMoov=t.audioMoov.buffer,i.audioChannelCount=t.audioChannelCount,r.push(i.audioMoov)),t.videoCodec&&(i.videoCodec=t.videoCodec,i.videoMoov=t.videoMoov.buffer,i.videoWidth=t.videoWidth,i.videoHeight=t.videoHeight,r.push(i.videoMoov)),self.postMessage(i,r)}),a.on(s.FRAG_PARSING_DATA,function(e,t){var i={event:e,type:t.type,startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,moof:t.moof.buffer,mdat:t.mdat.buffer};self.postMessage(i,[i.moof,i.mdat])}),a.on(s.FRAG_PARSED,function(e){var t={event:e};self.postMessage(t)})};t.exports=o},{"../demux/tsdemuxer":7,"../events":9,"../observer":13}],9:[function(e,t,i){"use strict";t.exports={MSE_ATTACHED:"hlsMediaSourceAttached",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragmentLoading",FRAG_LOADED:"hlsFragmentLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragmentParsingInitSegment",FRAG_PARSING_DATA:"hlsFragmentParsingData",FRAG_PARSED:"hlsFragmentParsed",FRAG_BUFFERED:"hlsFragmentBuffered",FRAG_PLAYING:"hlsFragmentPlaying",LOAD_ERROR:"hlsLoadError",LEVEL_ERROR:"hlsLevelError",VIDEO_ERROR:"hlsVideoError",FRAG_PARSING_ERROR:"hlsFragmentParsingError"}},{}],10:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("./events")),a=s(e("./observer")),o=s(e("./loader/playlist-loader")),l=s(e("./controller/buffer-controller")),u=s(e("./controller/level-controller")),h=e("./utils/logger").logger,d=e("./utils/logger").enableLogs,c=function(){function e(){this.playlistLoader=new o,this.levelController=new u(this.playlistLoader),this.bufferController=new l(this.levelController),this.Events=n,this.debug=d,this.logEvt=this.logEvt,this.on=a.on.bind(a),this.off=a.removeListener.bind(a)}return r(e,{isSupported:{value:function(){return window.MediaSource&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},writable:!0,enumerable:!0,configurable:!0}},{destroy:{value:function(){this.playlistLoader&&(this.playlistLoader.destroy(),this.playlistLoader=null),this.bufferController&&(this.bufferController.destroy(),this.bufferController=null),this.levelController&&(this.levelController.destroy(),this.levelController=null),this.unloadSource(),this.detachVideo(),a.removeAllListeners()},writable:!0,enumerable:!0,configurable:!0},attachVideo:{value:function(e){this.video=e;var t=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(t),this.onverror=this.onVideoError.bind(this),e.addEventListener("error",this.onverror)},writable:!0,enumerable:!0,configurable:!0},detachVideo:{value:function(){var e=this.video,t=this.mediaSource;t&&(t.endOfStream(),t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),e.src="",this.mediaSource=null),this.onmso=this.onmse=this.onmsc=null,e&&(this.video=null,e.removeEventListener("error",this.onverror),this.onverror=null)},writable:!0,enumerable:!0,configurable:!0},loadSource:{value:function(e){this.url=e,h.log("loadSource:"+e),this.playlistLoader.load(e,null)},writable:!0,enumerable:!0,configurable:!0},unloadSource:{value:function(){this.url=null},writable:!0,enumerable:!0,configurable:!0},levels:{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0},level:{get:function(){return this.levelController.level},set:function(e){this.levelController.manualLevel=e},enumerable:!0,configurable:!0},firstLevel:{get:function(){return this.levelController.firstLevel},set:function(e){this.levelController.firstLevel=e},enumerable:!0,configurable:!0},startLevel:{get:function(){return this.levelController.startLevel},set:function(e){this.levelController.startLevel=e},enumerable:!0,configurable:!0},autoLevelCapping:{get:function(){return this.levelController.autoLevelCapping},set:function(e){this.levelController.autoLevelCapping=e},enumerable:!0,configurable:!0},autoLevelEnabled:{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0},manualLevel:{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0},playbackLevel:{get:function(){return this.bufferController.playbackLevel},enumerable:!0,configurable:!0},onMediaSourceOpen:{value:function(){a.trigger(n.MSE_ATTACHED,{video:this.video,mediaSource:this.mediaSource})},writable:!0,enumerable:!0,configurable:!0},onMediaSourceClose:{value:function(){h.log("media source closed")},writable:!0,enumerable:!0,configurable:!0},onMediaSourceEnded:{value:function(){h.log("media source ended")},writable:!0,enumerable:!0,configurable:!0},onVideoError:{value:function(){a.trigger(n.VIDEO_ERROR)},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=c},{"./controller/buffer-controller":3,"./controller/level-controller":4,"./events":9,"./loader/playlist-loader":12,"./observer":13,"./utils/logger":15}],11:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("../observer")),o=e("../utils/logger").logger,l=function(){function e(){}return r(e,null,{destroy:{value:function(){this.abort(),this.xhr=null},writable:!0,enumerable:!0,configurable:!0},abort:{value:function(){this.xhr&&4!==this.xhr.readyState&&this.xhr.abort()},writable:!0,enumerable:!0,configurable:!0},load:{value:function(e,t){this.frag=e,this.levelId=t,this.trequest=new Date,this.tfirst=null;var i=this.xhr=new XMLHttpRequest;i.onload=this.loadsuccess.bind(this),i.onerror=this.loaderror.bind(this),i.onprogress=this.loadprogress.bind(this),i.open("GET",e.url,!0),i.responseType="arraybuffer",i.send(),a.trigger(n.FRAG_LOADING,{frag:e})},writable:!0,enumerable:!0,configurable:!0},loadsuccess:{value:function(e){var t=e.currentTarget.response;a.trigger(n.FRAG_LOADED,{payload:t,frag:this.frag,stats:{trequest:this.trequest,tfirst:this.tfirst,tload:new Date,length:t.byteLength}})},writable:!0,enumerable:!0,configurable:!0},loaderror:{value:function(e){o.log("error loading "+this.frag.url),a.trigger(n.LOAD_ERROR,{url:this.frag.url,event:e})},writable:!0,enumerable:!0,configurable:!0},loadprogress:{value:function(){null===this.tfirst&&(this.tfirst=new Date)},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=l},{"../events":9,"../observer":13,"../utils/logger":15}],12:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e){return e&&(e.default||e)},n=s(e("../events")),a=s(e("../observer")),o=function(){function e(){this.manifestLoaded=!1}return r(e,null,{destroy:{value:function(){this.xhr&&4!==this.xhr.readyState&&(this.xhr.abort(),this.xhr=null),this.url=this.id=null},writable:!0,enumerable:!0,configurable:!0},load:{value:function(e,t){this.url=e,this.id=t,this.stats={trequest:new Date};var i=this.xhr=new XMLHttpRequest;i.onload=this.loadsuccess.bind(this),i.onerror=this.loaderror.bind(this),i.onprogress=this.loadprogress.bind(this),i.open("GET",e,!0),i.send()},writable:!0,enumerable:!0,configurable:!0},resolve:{value:function(e,t){var i,r=document,s=r.getElementsByTagName("base")[0],n=s&&s.href,a=r.head||r.getElementsByTagName("head")[0],o=s||a.appendChild(r.createElement("base")),l=r.createElement("a");return o.href=t,l.href=e,i=l.href,s?s.href=n:a.removeChild(o),i},writable:!0,enumerable:!0,configurable:!0},parseMasterPlaylist:{value:function(e,t){for(var i,r,s,n=[],a={},o=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"(.*)\",)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/g;null!=(i=o.exec(e));){for(i.shift(),i=i.filter(function(e){return void 0!==e}),a.url=this.resolve(i.pop(),t);i.length>0;)switch(i.shift()){case"RES":a.width=parseInt(i.shift()),a.height=parseInt(i.shift());break;case"BAND":a.bitrate=parseInt(i.shift());break;case"NAME":a.name=i.shift();break;case"CODECS":for(r=i.shift().split(",");r.length>0;)s=r.shift(),-1!==s.indexOf("avc1")?a.videoCodec=this.avc1toavcoti(s):a.audioCodec=s}n.push(a),a={}}return n},writable:!0,enumerable:!0,configurable:!0},avc1toavcoti:{value:function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("00"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},writable:!0,enumerable:!0,configurable:!0},parseLevelPlaylist:{value:function(e,t,i){var r,s,n=0,a=0,o={url:t,fragments:[],live:!0};for(s=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^\r\n]+)|(?:#EXT-X-(ENDLIST)))/g;null!==(r=s.exec(e));)switch(r.shift(),r=r.filter(function(e){return void 0!==e}),r[0]){case"MEDIA-SEQUENCE":n=o.startSN=parseInt(r[1]);break;case"TARGETDURATION":o.targetduration=parseFloat(r[1]);break;case"ENDLIST":o.live=!1;break;case"INF":var l=parseFloat(r[1]);o.fragments.push({url:this.resolve(r[2],t),duration:l,start:a,sn:n++,level:i}),a+=l}return o.totalduration=a,o.endSN=n-1,o},writable:!0,enumerable:!0,configurable:!0},loadsuccess:{value:function(e){var t,i=e.currentTarget.responseText,r=e.currentTarget.responseURL,s=this.id;void 0===r&&(r=this.url),this.stats.tload=new Date,this.stats.mtime=new Date(this.xhr.getResponseHeader("Last-Modified")),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0?(t=this.parseLevelPlaylist(i,r,s),null===this.id&&a.trigger(n.MANIFEST_LOADED,{levels:[t],url:r,stats:this.stats}),a.trigger(n.LEVEL_LOADED,{details:t,levelId:s,stats:this.stats})):a.trigger(n.MANIFEST_LOADED,{levels:this.parseMasterPlaylist(i,r),url:r,id:s,stats:this.stats}):a.trigger(n.LOAD_ERROR,{url:r,response:e.currentTarget})},writable:!0,enumerable:!0,configurable:!0},loaderror:{value:function(e){a.trigger(n.LOAD_ERROR,{url:this.url,response:e.currentTarget})},writable:!0,enumerable:!0,configurable:!0},loadprogress:{value:function(){void 0===this.stats.tfirst&&(this.stats.tfirst=new Date)},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=o},{"../events":9,"../observer":13}],13:[function(e,t,i){"use strict";var r=function(e){return Array.isArray(e)?e:Array.from(e)},s=function(e){return e&&(e.default||e)},n=s(e("events")),a=new n;a.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;t>s;s++)i[s-1]=arguments[s];a.emit.apply(a,[e,e].concat(r(i)))},t.exports=a},{events:1}],14:[function(e,t,i){"use strict";var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(){function e(){}return r(e,{init:{value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);e.MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),e.AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),e.MINOR_VERSION=new Uint8Array([0,0,0,1]),e.VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e.AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e.HDLR_TYPES={video:e.VIDEO_HDLR,audio:e.AUDIO_HDLR},e.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),e.STCO=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSC=e.STCO,e.STTS=e.STCO,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),e.FTYP=e.box(e.types.ftyp,e.MAJOR_BRAND,e.MINOR_VERSION,e.MAJOR_BRAND,e.AVC1_BRAND),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,e.DREF))},writable:!0,enumerable:!0,configurable:!0},box:{value:function(e){for(var t,i,r=Array.prototype.slice.call(arguments,1),s=0,n=r.length;n--;)s+=r[n].byteLength;for(t=new Uint8Array(s+8),i=new DataView(t.buffer),i.setUint32(0,t.byteLength),t.set(e,4),n=0,s=8;n<r.length;n++)t.set(r[n],s),s+=r[n].byteLength;return t},writable:!0,enumerable:!0,configurable:!0},hdlr:{value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},writable:!0,enumerable:!0,configurable:!0},mdat:{value:function(t){return e.box(e.types.mdat,t)},writable:!0,enumerable:!0,configurable:!0},mdhd:{value:function(t){return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))},writable:!0,enumerable:!0,configurable:!0},mdia:{value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration),e.hdlr(t.type),e.minf(t))},writable:!0,enumerable:!0,configurable:!0},mfhd:{value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},writable:!0,enumerable:!0,configurable:!0},minf:{value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},writable:!0,enumerable:!0,configurable:!0},moof:{value:function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))},writable:!0,enumerable:!0,configurable:!0},moov:{value:function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].duration)].concat(r).concat(e.mvex(t)))},writable:!0,enumerable:!0,configurable:!0},mvex:{value:function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(r))},writable:!0,enumerable:!0,configurable:!0},mvhd:{value:function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)},writable:!0,enumerable:!0,configurable:!0},sdtp:{value:function(t){var i,r,s=t.samples||[],n=new Uint8Array(4+s.length);for(r=0;r<s.length;r++)i=s[r].flags,n[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,n)},writable:!0,enumerable:!0,configurable:!0},stbl:{value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},writable:!0,enumerable:!0,configurable:!0},avc1:{value:function(t){var i,r=[],s=[];for(i=0;i<t.sps.length;i++)r.push(t.sps[i].byteLength>>>8&255),r.push(255&t.sps[i].byteLength),r=r.concat(Array.prototype.slice.call(t.sps[i]));for(i=0;i<t.pps.length;i++)s.push(t.pps[i].byteLength>>>8&255),s.push(255&t.pps[i].byteLength),s=s.concat(Array.prototype.slice.call(t.pps[i]));return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),e.box(e.types.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([t.sps.length]).concat(r).concat([t.pps.length]).concat(s))),e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},writable:!0,enumerable:!0,configurable:!0},esds:{value:function(e){return new Uint8Array([0,0,0,0,3,23+e.config.length,0,1,0,4,15+e.config.length,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e.config.length]).concat(e.config).concat([6,1,2]))},writable:!0,enumerable:!0,configurable:!0},mp4a:{value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.audiosamplerate>>8&255,255&t.audiosamplerate,0,0]),e.box(e.types.esds,e.esds(t)))},writable:!0,enumerable:!0,configurable:!0},stsd:{value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},writable:!0,enumerable:!0,configurable:!0},tkhd:{value:function(t){return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t.id>>24&255,t.id>>16&255,t.id>>8&255,255&t.id,0,0,0,0,t.duration>>24,t.duration>>16&255,t.duration>>8&255,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,t.width>>8&255,255&t.width,0,0,t.height>>8&255,255&t.height,0,0]))},writable:!0,enumerable:!0,configurable:!0},traf:{value:function(t,i){var r=e.sdtp(t);return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t.id>>24,t.id>>16&255,t.id>>8&255,255&t.id])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.trun(t,r.length+16+16+8+16+8+8),r)},writable:!0,enumerable:!0,configurable:!0},trak:{value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},writable:!0,enumerable:!0,configurable:!0},trex:{value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t.id>>24,t.id>>16&255,t.id>>8&255,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},writable:!0,enumerable:!0,configurable:!0},trun:{value:function(t,i){var r,s,n,a;for(r=t.samples||[],a=new Uint8Array(12+16*r.length),i+=8+a.byteLength,a.set([0,0,15,1,r.length>>>24&255,r.length>>>16&255,r.length>>>8&255,255&r.length,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;n<r.length;n++)s=r[n],a.set([s.duration>>>24&255,s.duration>>>16&255,s.duration>>>8&255,255&s.duration,s.size>>>24&255,s.size>>>16&255,s.size>>>8&255,255&s.size,s.flags.isLeading<<2|s.flags.dependsOn,s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,61440&s.flags.degradationPriority,15&s.flags.degradationPriority,s.compositionTimeOffset>>>24&255,s.compositionTimeOffset>>>16&255,s.compositionTimeOffset>>>8&255,255&s.compositionTimeOffset],12+16*n);return e.box(e.types.trun,a)},writable:!0,enumerable:!0,configurable:!0},initSegment:{value:function(t){e.types||e.init();var i,r=e.moov(t);return i=new Uint8Array(e.FTYP.byteLength+r.byteLength),i.set(e.FTYP),i.set(r,e.FTYP.byteLength),i},writable:!0,enumerable:!0,configurable:!0}}),e}();t.exports=s},{}],15:[function(e,t,i){"use strict";function r(){}{var s={log:r,warn:r,info:r,error:r},n=s;i.enableLogs=function(e){if(e===!0||"object"==typeof e){n.log=e.log?e.log.bind(e):console.log.bind(console),n.info=e.info?e.info.bind(e):console.info.bind(console),n.error=e.error?e.error.bind(e):console.error.bind(console),n.warn=e.warn?e.warn.bind(e):console.warn.bind(console);try{n.log()}catch(e){n.log=r,n.info=r,n.error=r,n.warn=r}}else n=s},i.logger=n}},{}]},{},[10])(10)});