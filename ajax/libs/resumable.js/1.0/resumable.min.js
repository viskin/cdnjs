"use strict";var Resumable=function(e){if(!(this instanceof Resumable)){return new Resumable(e)}this.version=1;this.support=((typeof(File)!=="undefined")&&(typeof(Blob)!=="undefined")&&(typeof(FileList)!=="undefined")&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||false));if(!this.support){return(false)}var g=this;g.files=[];g.defaults={chunkSize:1*1024*1024,forceChunkSize:false,simultaneousUploads:3,fileParameterName:"file",throttleProgressCallbacks:0.5,query:{},headers:{},preprocess:null,method:"multipart",prioritizeFirstAndLastChunk:false,target:"/",testChunks:true,generateUniqueIdentifier:null,maxChunkRetries:undefined,chunkRetryInterval:undefined,permanentErrors:[404,415,500,501],maxFiles:undefined,withCredentials:false,maxFilesErrorCallback:function(i,k){var j=g.getOpt("maxFiles");alert("Please upload "+j+" file"+(j===1?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(i,j){alert(i.fileName||i.name+" is too small, please upload files larger than "+c.formatSize(g.getOpt("minFileSize"))+".")},maxFileSize:undefined,maxFileSizeErrorCallback:function(i,j){alert(i.fileName||i.name+" is too large, please upload files less than "+c.formatSize(g.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(i,j){alert(i.fileName||i.name+" has type not allowed, please upload files of type "+g.getOpt("fileType")+".")}};g.opts=e||{};g.getOpt=function(k){var j=this;if(k instanceof Array){var i={};c.each(k,function(l){i[l]=j.getOpt(l)});return i}if(j instanceof h){if(typeof j.opts[k]!=="undefined"){return j.opts[k]}else{j=j.fileObj}}if(j instanceof a){if(typeof j.opts[k]!=="undefined"){return j.opts[k]}else{j=j.resumableObj}}if(j instanceof Resumable){if(typeof j.opts[k]!=="undefined"){return j.opts[k]}else{return j.defaults[k]}}};g.events=[];g.on=function(i,j){g.events.push(i.toLowerCase(),j)};g.fire=function(){var j=[];for(var k=0;k<arguments.length;k++){j.push(arguments[k])}var l=j[0].toLowerCase();for(var k=0;k<=g.events.length;k+=2){if(g.events[k]==l){g.events[k+1].apply(g,j.slice(1))}if(g.events[k]=="catchall"){g.events[k+1].apply(null,j)}}if(l=="fileerror"){g.fire("error",j[2],j[1])}if(l=="fileprogress"){g.fire("progress")}};var c={stopEvent:function(i){i.stopPropagation();i.preventDefault()},each:function(k,l){if(typeof(k.length)!=="undefined"){for(var j=0;j<k.length;j++){if(l(k[j])===false){return}}}else{for(j in k){if(l(j,k[j])===false){return}}}},generateUniqueIdentifier:function(k){var l=g.getOpt("generateUniqueIdentifier");if(typeof l==="function"){return l(k)}var i=k.webkitRelativePath||k.fileName||k.name;var j=k.size;return(j+"-"+i.replace(/[^0-9a-zA-Z_-]/img,""))},contains:function(k,j){var i=false;c.each(k,function(l){if(l==j){i=true;return false}return true});return i},formatSize:function(i){if(i<1024){return i+" bytes"}else{if(i<1024*1024){return(i/1024).toFixed(0)+" KB"}else{if(i<1024*1024*1024){return(i/1024/1024).toFixed(1)+" MB"}else{return(i/1024/1024/1024).toFixed(1)+" GB"}}}},getTarget:function(j){var i=g.getOpt("target");if(i.indexOf("?")<0){i+="?"}else{i+="&"}return i+j.join("&")}};var b=function(i){c.stopEvent(i);f(i.dataTransfer.files,i)};var d=function(i){i.preventDefault()};var f=function(i,k){var m=0;var l=g.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(typeof(l.maxFiles)!=="undefined"&&l.maxFiles<(i.length+g.files.length)){if(l.maxFiles===1&&g.files.length===1&&i.length===1){g.removeFile(g.files[0])}else{l.maxFilesErrorCallback(i,m++);return false}}var j=[];c.each(i,function(n){if(l.fileType.length>0&&!c.contains(l.fileType,n.type.split("/")[1])){l.fileTypeErrorCallback(n,m++);return false}if(typeof(l.minFileSize)!=="undefined"&&n.size<l.minFileSize){l.minFileSizeErrorCallback(n,m++);return false}if(typeof(l.maxFileSize)!=="undefined"&&n.size>l.maxFileSize){l.maxFileSizeErrorCallback(n,m++);return false}if(!g.getFromUniqueIdentifier(c.generateUniqueIdentifier(n))){var o=new a(g,n);g.files.push(o);j.push(o);g.fire("fileAdded",o,k)}});g.fire("filesAdded",j)};function a(l,i){var j=this;j.opts={};j.getOpt=l.getOpt;j._prevProgress=0;j.resumableObj=l;j.file=i;j.fileName=i.fileName||i.name;j.size=i.size;j.relativePath=i.webkitRelativePath||j.fileName;j.uniqueIdentifier=c.generateUniqueIdentifier(i);var m=false;var k=function(o,n){switch(o){case"progress":j.resumableObj.fire("fileProgress",j);break;case"error":j.abort();m=true;j.chunks=[];j.resumableObj.fire("fileError",j,n);break;case"success":if(m){return}j.resumableObj.fire("fileProgress",j);if(j.isComplete()){j.resumableObj.fire("fileSuccess",j,n)}break;case"retry":j.resumableObj.fire("fileRetry",j);break}};j.chunks=[];j.abort=function(){c.each(j.chunks,function(n){if(n.status()=="uploading"){n.abort()}});j.resumableObj.fire("fileProgress",j)};j.cancel=function(){var n=j.chunks;j.chunks=[];c.each(n,function(o){if(o.status()=="uploading"){o.abort();j.resumableObj.uploadNextChunk()}});j.resumableObj.removeFile(j);j.resumableObj.fire("fileProgress",j)};j.retry=function(){j.bootstrap();j.resumableObj.upload()};j.bootstrap=function(){j.abort();m=false;j.chunks=[];j._prevProgress=0;var n=j.getOpt("forceChunkSize")?Math.ceil:Math.floor;for(var o=0;o<Math.max(n(j.file.size/j.getOpt("chunkSize")),1);o++){j.chunks.push(new h(j.resumableObj,j,o,k))}};j.progress=function(){if(m){return(1)}var o=0;var n=false;c.each(j.chunks,function(p){if(p.status()=="error"){n=true}o+=p.progress(true)});o=(n?1:(o>0.999?1:o));o=Math.max(j._prevProgress,o);j._prevProgress=o;return(o)};j.isUploading=function(){var n=false;c.each(j.chunks,function(o){if(o.status()=="uploading"){n=true;return(false)}});return(n)};j.isComplete=function(){var n=false;c.each(j.chunks,function(p){var o=p.status();if(o=="pending"||o=="uploading"||p.preprocessState===1){n=true;return(false)}});return(!n)};j.bootstrap();return(this)}function h(k,i,l,n){var j=this;j.opts={};j.getOpt=k.getOpt;j.resumableObj=k;j.fileObj=i;j.fileObjSize=i.size;j.offset=l;j.callback=n;j.lastProgressCallback=(new Date);j.tested=false;j.retries=0;j.pendingRetry=false;j.preprocessState=0;var m=j.getOpt("chunkSize");j.loaded=0;j.startByte=j.offset*m;j.endByte=Math.min(j.fileObjSize,(j.offset+1)*m);if(j.fileObjSize-j.endByte<m&&!j.getOpt("forceChunkSize")){j.endByte=j.fileObjSize}j.xhr=null;j.test=function(){j.xhr=new XMLHttpRequest();var p=function(s){j.tested=true;var r=j.status();if(r=="success"){j.callback(r,j.message());j.resumableObj.uploadNextChunk()}else{j.send()}};j.xhr.addEventListener("load",p,false);j.xhr.addEventListener("error",p,false);var q=[];var o=j.getOpt("query");if(typeof o=="function"){o=o(j.fileObj,j)}c.each(o,function(s,r){q.push([encodeURIComponent(s),encodeURIComponent(r)].join("="))});q.push(["resumableChunkNumber",encodeURIComponent(j.offset+1)].join("="));q.push(["resumableChunkSize",encodeURIComponent(j.getOpt("chunkSize"))].join("="));q.push(["resumableCurrentChunkSize",encodeURIComponent(j.endByte-j.startByte)].join("="));q.push(["resumableTotalSize",encodeURIComponent(j.fileObjSize)].join("="));q.push(["resumableIdentifier",encodeURIComponent(j.fileObj.uniqueIdentifier)].join("="));q.push(["resumableFilename",encodeURIComponent(j.fileObj.fileName)].join("="));q.push(["resumableRelativePath",encodeURIComponent(j.fileObj.relativePath)].join("="));j.xhr.open("GET",c.getTarget(q));j.xhr.withCredentials=j.getOpt("withCredentials");c.each(j.getOpt("headers"),function(s,r){j.xhr.setRequestHeader(s,r)});j.xhr.send(null)};j.preprocessFinished=function(){j.preprocessState=2;j.send()};j.send=function(){var r=j.getOpt("preprocess");if(typeof r==="function"){switch(j.preprocessState){case 0:r(j);j.preprocessState=1;return;case 1:return;case 2:break}}if(j.getOpt("testChunks")&&!j.tested){j.test();return}j.xhr=new XMLHttpRequest();j.xhr.upload.addEventListener("progress",function(x){if((new Date)-j.lastProgressCallback>j.getOpt("throttleProgressCallbacks")*1000){j.callback("progress");j.lastProgressCallback=(new Date)}j.loaded=x.loaded||0},false);j.loaded=0;j.pendingRetry=false;j.callback("progress");var s=function(y){var x=j.status();if(x=="success"||x=="error"){j.callback(x,j.message());j.resumableObj.uploadNextChunk()}else{j.callback("retry",j.message());j.abort();j.retries++;var z=j.getOpt("chunkRetryInterval");if(z!==undefined){j.pendingRetry=true;setTimeout(j.send,z)}else{j.send()}}};j.xhr.addEventListener("load",s,false);j.xhr.addEventListener("error",s,false);var v={resumableChunkNumber:j.offset+1,resumableChunkSize:j.getOpt("chunkSize"),resumableCurrentChunkSize:j.endByte-j.startByte,resumableTotalSize:j.fileObjSize,resumableIdentifier:j.fileObj.uniqueIdentifier,resumableFilename:j.fileObj.fileName,resumableRelativePath:j.fileObj.relativePath,resumableTotalChunks:j.fileObj.chunks.length};var p=j.getOpt("query");if(typeof p=="function"){p=p(j.fileObj,j)}c.each(p,function(y,x){v[y]=x});var o=(j.fileObj.file.slice?"slice":(j.fileObj.file.mozSlice?"mozSlice":(j.fileObj.file.webkitSlice?"webkitSlice":"slice"))),w=j.fileObj.file[o](j.startByte,j.endByte),t=null,u=j.getOpt("target");if(j.getOpt("method")==="octet"){t=w;var q=[];c.each(v,function(y,x){q.push([encodeURIComponent(y),encodeURIComponent(x)].join("="))});u=c.getTarget(q)}else{t=new FormData();c.each(v,function(y,x){t.append(y,x)});t.append(j.getOpt("fileParameterName"),w)}j.xhr.open("POST",u);j.xhr.withCredentials=j.getOpt("withCredentials");c.each(j.getOpt("headers"),function(y,x){j.xhr.setRequestHeader(y,x)});j.xhr.send(t)};j.abort=function(){if(j.xhr){j.xhr.abort()}j.xhr=null};j.status=function(){if(j.pendingRetry){return("uploading")}else{if(!j.xhr){return("pending")}else{if(j.xhr.readyState<4){return("uploading")}else{if(j.xhr.status==200){return("success")}else{if(c.contains(j.getOpt("permanentErrors"),j.xhr.status)||j.retries>=j.getOpt("maxChunkRetries")){return("error")}else{j.abort();return("pending")}}}}}};j.message=function(){return(j.xhr?j.xhr.responseText:"")};j.progress=function(q){if(typeof(q)==="undefined"){q=false}var o=(q?(j.endByte-j.startByte)/j.fileObjSize:1);if(j.pendingRetry){return(0)}var p=j.status();switch(p){case"success":case"error":return(1*o);case"pending":return(0*o);default:return(j.loaded/(j.endByte-j.startByte)*o)}};return(this)}g.uploadNextChunk=function(){var j=false;if(g.getOpt("prioritizeFirstAndLastChunk")){c.each(g.files,function(k){if(k.chunks.length&&k.chunks[0].status()=="pending"&&k.chunks[0].preprocessState===0){k.chunks[0].send();j=true;return(false)}if(k.chunks.length>1&&k.chunks[k.chunks.length-1].status()=="pending"&&k.chunks[0].preprocessState===0){k.chunks[k.chunks.length-1].send();j=true;return(false)}});if(j){return(true)}}c.each(g.files,function(k){c.each(k.chunks,function(l){if(l.status()=="pending"&&l.preprocessState===0){l.send();j=true;return(false)}});if(j){return(false)}});if(j){return(true)}var i=false;c.each(g.files,function(k){if(!k.isComplete()){i=true;return(false)}});if(!i){g.fire("complete")}return(false)};g.assignBrowse=function(i,j){if(typeof(i.length)=="undefined"){i=[i]}c.each(i,function(l){var k;if(l.tagName==="INPUT"&&l.type==="file"){k=l}else{k=document.createElement("input");k.setAttribute("type","file");l.style.display="inline-block";l.style.position="relative";k.style.position="absolute";k.style.top=k.style.left=k.style.bottom=k.style.right=0;k.style.opacity=0;k.style.cursor="pointer";l.appendChild(k)}var m=g.getOpt("maxFiles");if(typeof(m)==="undefined"||m!=1){k.setAttribute("multiple","multiple")}else{k.removeAttribute("multiple")}if(j){k.setAttribute("webkitdirectory","webkitdirectory")}else{k.removeAttribute("webkitdirectory")}k.addEventListener("change",function(n){f(n.target.files);n.target.value=""},false)})};g.assignDrop=function(i){if(typeof(i.length)=="undefined"){i=[i]}c.each(i,function(j){j.addEventListener("dragover",d,false);j.addEventListener("drop",b,false)})};g.unAssignDrop=function(i){if(typeof(i.length)=="undefined"){i=[i]}c.each(i,function(j){j.removeEventListener("dragover",d);j.removeEventListener("drop",b)})};g.isUploading=function(){var i=false;c.each(g.files,function(j){if(j.isUploading()){i=true;return(false)}});return(i)};g.upload=function(){if(g.isUploading()){return}g.fire("uploadStart");for(var i=1;i<=g.getOpt("simultaneousUploads");i++){g.uploadNextChunk()}};g.pause=function(){c.each(g.files,function(i){i.abort()});g.fire("pause")};g.cancel=function(){for(var j=g.files.length-1;j>=0;j--){g.files[j].cancel()}g.fire("cancel")};g.progress=function(){var j=0;var i=0;c.each(g.files,function(k){j+=k.progress()*k.size;i+=k.size});return(i>0?j/i:0)};g.addFile=function(i){f([i])};g.removeFile=function(k){for(var j=g.files.length-1;j>=0;j--){if(g.files[j]===k){g.files.splice(j,1)}}};g.getFromUniqueIdentifier=function(i){var j=false;c.each(g.files,function(k){if(k.uniqueIdentifier==i){j=k}});return(j)};g.getSize=function(){var i=0;c.each(g.files,function(j){i+=j.size});return(i)};return(this)};if(typeof module!="undefined"){module.exports=Resumable};