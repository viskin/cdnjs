/*!
 * This file is used for define the EventProxy library.
 * @author <a href="mailto:shyvo1987@gmail.com">Jackson Tian</a>
 * @version 0.2.2
 */
;(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b()}else{this[a]=b()}}})("EventProxy",function(){var a=function(){if(!(this instanceof a)){return new a()}this._callbacks={};this._fired={}};a.prototype.addListener=function(c,d){this._callbacks=this._callbacks||{};this._callbacks[c]=this._callbacks[c]||[];this._callbacks[c].push(d);return this};a.prototype.bind=a.prototype.addListener;a.prototype.on=a.prototype.addListener;a.prototype.subscribe=a.prototype.addListener;a.prototype.removeListener=function(f,h){var e=this._callbacks,d,c;if(!f){this._callbacks={}}else{if(e){if(!h){e[f]=[]}else{var g=e[f];if(!g){return this}c=g.length;for(d=0;d<c;d++){if(h===g[d]){g[d]=null;break}}}}}return this};a.prototype.unbind=a.prototype.removeListener;a.prototype.removeAllListeners=function(c){return this.unbind(c)};a.prototype.trigger=function(f,d){var g,k,m,h,e,c;var j=2;var n=this._callbacks;while(j--){k=j?f:"all";g=n[k];if(g){for(e=0,c=g.length;e<c;e++){if(!(m=g[e])){g.splice(e,1);e--;c--}else{h=j?Array.prototype.slice.call(arguments,1):arguments;m.apply(this,h)}}}}return this};a.prototype.emit=a.prototype.trigger;a.prototype.fire=a.prototype.trigger;a.prototype.once=function(d,f){var c=this;var e=function(){f.apply(c,arguments);c.unbind(d,e)};this.bind(d,e);return this};a.prototype.immediate=function(c,e,d){this.bind(c,e);this.trigger(c,d);return this};a.prototype.asap=a.prototype.immediate;var b=function(h,g,i,e){var n=this,f,k=0,j=arguments.length,m,c,p,q,o,d=0,l={};if(j<3){return this}q=Array.prototype.slice.apply(arguments,[0,j-2]);p=arguments[j-2];o=arguments[j-1];if(typeof p!=="function"){return this}f=q.length;m=function(r){var s=o?"once":"bind";n[s](r,function(t){n._fired[r]=n._fired[r]||{};n._fired[r].data=t;if(!l[r]){l[r]=true;d++}})};for(k=0;k<f;k++){m(q[k])}c=function(r){if(d<f){return}if(!l[r]){return}var s=[];for(k=0;k<f;k++){s.push(n._fired[q[k]].data)}if(o){n.unbind("all",c)}p.apply(null,s)};n.bind("all",c)};a.prototype.all=function(e,d,f){var c=Array.prototype.concat.apply([],arguments);c.push(true);b.apply(this,c);return this};a.prototype.assign=a.prototype.all;a.prototype.fail=function(d){var c=this;c.once("error",function(e){c.unbind();d(e)});return this};a.prototype.tail=function(){var c=Array.prototype.concat.apply([],arguments);c.push(false);b.apply(this,c);return this};a.prototype.assignAll=a.prototype.tail;a.prototype.assignAlways=a.prototype.tail;a.prototype.after=function(d,h,i){if(h===0){i.call(null,[]);return this}var e=this,c=[],f;this._after=this._after||{};var g=d+"_group";this._after[g]={index:0,results:[]};f=function(j,k){if(j===d){h--;c.push(k);if(h<1){e.unbind("all",f);i.apply(null,[c])}}if(j===g){h--;e._after[g].results[k.index]=k.result;if(h<1){e.unbind("all",f);i.call(null,e._after[g].results)}}};e.bind("all",f);return this};a.prototype.group=function(c,g){var e=this;var f=c+"_group";var d=e._after[f].index;e._after[f].index++;return function(h,i){if(h){return e.emit("error",h)}e.emit(f,{index:d,result:g?g(i):i})}};a.prototype.any=function(){var g=this,e,i,c=arguments.length,j=arguments[c-1],f=Array.prototype.slice.apply(arguments,[0,c-1]),h=f.length,d=f.join("_");g.once(d,j);i=function(k){g.bind(k,function(l){g.trigger(d,{data:l,eventName:k})})};for(e=0;e<h;e++){i(f[e])}};a.prototype.not=function(c,e){var d=this;d.bind("all",function(f,g){if(f!==c){e(g)}})};a.prototype.done=function(c,e){var d=this;return function(g,h){if(g){return d.emit("error",g)}if(typeof c==="string"){return d.emit(c,e?e.call(h):h)}if(arguments.length<=2){return c(h)}var f=Array.prototype.slice.call(arguments,1);c.apply(null,f)}};a.create=function(){var c=new a();var e=Array.prototype.concat.apply([],arguments);if(e.length){var d=e[e.length-1];var f=e[e.length-2];if(typeof d==="function"&&typeof f==="function"){e.pop();c.fail(d)}c.assign.apply(c,Array.prototype.slice.call(e))}return c};a.EventProxy=a;return a});