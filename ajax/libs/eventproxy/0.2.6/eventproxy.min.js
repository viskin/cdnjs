/*!
 * This file is used for define the EventProxy library.
 * @author <a href="mailto:shyvo1987@gmail.com">Jackson Tian</a>
 * @version 0.2.2
 */
;(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b(require("debug")("eventproxy"))}else{this[a]=b()}}})("EventProxy",function(c){c=c||function(){};var b=function(){if(!(this instanceof b)){return new b()}this._callbacks={};this._fired={}};b.prototype.addListener=function(e,f){c("Add listener for %s",e);this._callbacks=this._callbacks||{};this._callbacks[e]=this._callbacks[e]||[];this._callbacks[e].push(f);return this};b.prototype.bind=b.prototype.addListener;b.prototype.on=b.prototype.addListener;b.prototype.subscribe=b.prototype.addListener;b.prototype.removeListener=function(h,k){var g=this._callbacks,f,e;if(!h){c("Remove all listeners");this._callbacks={}}else{if(g){if(!k){h!=="all"&&c("Remove all listeners of %s",h);g[h]=[]}else{var j=g[h];if(!j){return this}e=j.length;for(f=0;f<e;f++){if(k===j[f]){h!=="all"&&c("Remove a listener of %s",h);j[f]=null;break}}}}}return this};b.prototype.unbind=b.prototype.removeListener;b.prototype.removeAllListeners=function(e){return this.unbind(e)};b.prototype.trigger=function(h,f){var j,n,o,k,g,e;var m=2;var p=this._callbacks;c("Emit event %s with data %j",h,f);while(m--){n=m?h:"all";j=p[n];if(j){for(g=0,e=j.length;g<e;g++){if(!(o=j[g])){j.splice(g,1);g--;e--}else{k=m?Array.prototype.slice.call(arguments,1):arguments;o.apply(this,k)}}}}return this};b.prototype.emit=b.prototype.trigger;b.prototype.fire=b.prototype.trigger;var a=typeof process!=="undefined"&&process.nextTick||function(e){setTimeout(e,0)};b.prototype.emitLater=function(){var e=this;var f=arguments;a(function(){e.trigger.apply(e,f)})};b.prototype.once=function(f,h){var e=this;var g=function(){h.apply(e,arguments);e.unbind(f,g)};this.bind(f,g);return this};b.prototype.immediate=function(e,g,f){this.bind(e,g);this.trigger(e,f);return this};b.prototype.asap=b.prototype.immediate;var d=function(j,i,k,g){var p=this,h,m=0,l=arguments.length,o,e,r,s,q,f=0,n={};if(l<3){return this}s=Array.prototype.slice.apply(arguments,[0,l-2]);r=arguments[l-2];q=arguments[l-1];if(typeof r!=="function"){return this}c("Assign listener for events %j, once is %s",s,!!q);h=s.length;o=function(t){var u=q?"once":"bind";p[u](t,function(v){p._fired[t]=p._fired[t]||{};p._fired[t].data=v;if(!n[t]){n[t]=true;f++}})};for(m=0;m<h;m++){o(s[m])}e=function(t){if(f<h){return}if(!n[t]){return}var u=[];for(m=0;m<h;m++){u.push(p._fired[s[m]].data)}if(q){p.unbind("all",e)}c("Events %j all emited with data %j",s,u);r.apply(null,u)};p.bind("all",e)};b.prototype.all=function(g,f,h){var e=Array.prototype.concat.apply([],arguments);e.push(true);d.apply(this,e);return this};b.prototype.assign=b.prototype.all;b.prototype.fail=function(f){var e=this;e.once("error",function(g){e.unbind();f(g)});return this};b.prototype.tail=function(){var e=Array.prototype.concat.apply([],arguments);e.push(false);d.apply(this,e);return this};b.prototype.assignAll=b.prototype.tail;b.prototype.assignAlways=b.prototype.tail;b.prototype.after=function(f,j,k){if(j===0){k.call(null,[]);return this}var g=this,e=[],h;this._after=this._after||{};var i=f+"_group";this._after[i]={index:0,results:[]};c("After emit %s times, event %s's listenner will execute",j,f);h=function(l,m){if(l===f){j--;e.push(m);if(j<1){c("Event %s was emit %s, and execute the listenner",f,j);g.unbind("all",h);k.apply(null,[e])}}if(l===i){j--;g._after[i].results[m.index]=m.result;if(j<1){c("Event %s was emit %s, and execute the listenner",f,j);g.unbind("all",h);k.call(null,g._after[i].results)}}};g.bind("all",h);return this};b.prototype.group=function(e,i){var g=this;var h=e+"_group";var f=g._after[h].index;g._after[h].index++;return function(j,k){if(j){return g.emit("error",j)}g.emit(h,{index:f,result:i?i.apply(null,Array.prototype.slice.call(arguments,1)):k})}};b.prototype.any=function(){var i=this,g,k,e=arguments.length,l=arguments[e-1],h=Array.prototype.slice.apply(arguments,[0,e-1]),j=h.length,f=h.join("_");c("Add listenner for Any of events %j emit",h);i.once(f,l);k=function(m){i.bind(m,function(n){c("One of events %j emited, execute the listenner");i.trigger(f,{data:n,eventName:m})})};for(g=0;g<j;g++){k(h[g])}};b.prototype.not=function(e,g){var f=this;c("Add listenner for not event %s",e);f.bind("all",function(h,i){if(h!==e){c("listenner execute of event %s emit, but not event %s.",h,e);g(i)}})};b.prototype.done=function(e,g){var f=this;return function(i,j){if(i){return f.emit("error",i)}var h=Array.prototype.slice.call(arguments,1);if(typeof e==="string"){return f.emit(e,g?g.apply(null,h):j)}if(arguments.length<=2){return e(j)}e.apply(null,h)}};b.prototype.doneLater=function(f,g){var e=this.done(f,g);return function(i,j){var h=arguments;a(function(){e.apply(null,h)})}};b.create=function(){var e=new b();var g=Array.prototype.concat.apply([],arguments);if(g.length){var f=g[g.length-1];var h=g[g.length-2];if(typeof f==="function"&&typeof h==="function"){g.pop();e.fail(f)}e.assign.apply(e,Array.prototype.slice.call(g))}return e};b.EventProxy=b;return b});