/*!
 * This file is used for define the EventProxy library.
 * @author <a href="mailto:shyvo1987@gmail.com">Jackson Tian</a>
 * @version 0.2.2
 */
;(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b()}else{this[a]=b()}}})("EventProxy",function(){var b=function(){if(!(this instanceof b)){return new b()}this._callbacks={};this._fired={}};b.prototype.addListener=function(d,e){this._callbacks=this._callbacks||{};this._callbacks[d]=this._callbacks[d]||[];this._callbacks[d].push(e);return this};b.prototype.bind=b.prototype.addListener;b.prototype.on=b.prototype.addListener;b.prototype.subscribe=b.prototype.addListener;b.prototype.removeListener=function(g,j){var f=this._callbacks,e,d;if(!g){this._callbacks={}}else{if(f){if(!j){f[g]=[]}else{var h=f[g];if(!h){return this}d=h.length;for(e=0;e<d;e++){if(j===h[e]){h[e]=null;break}}}}}return this};b.prototype.unbind=b.prototype.removeListener;b.prototype.removeAllListeners=function(d){return this.unbind(d)};b.prototype.trigger=function(g,e){var h,m,n,j,f,d;var k=2;var o=this._callbacks;while(k--){m=k?g:"all";h=o[m];if(h){for(f=0,d=h.length;f<d;f++){if(!(n=h[f])){h.splice(f,1);f--;d--}else{j=k?Array.prototype.slice.call(arguments,1):arguments;n.apply(this,j)}}}}return this};b.prototype.emit=b.prototype.trigger;b.prototype.fire=b.prototype.trigger;var a=typeof process!=="undefined"&&process.nextTick||function(d){setTimeout(d,0)};b.prototype.emitLater=function(){var d=this;var e=arguments;a(function(){d.trigger.apply(d,e)})};b.prototype.once=function(e,g){var d=this;var f=function(){g.apply(d,arguments);d.unbind(e,f)};this.bind(e,f);return this};b.prototype.immediate=function(d,f,e){this.bind(d,f);this.trigger(d,e);return this};b.prototype.asap=b.prototype.immediate;var c=function(i,h,j,f){var o=this,g,l=0,k=arguments.length,n,d,q,r,p,e=0,m={};if(k<3){return this}r=Array.prototype.slice.apply(arguments,[0,k-2]);q=arguments[k-2];p=arguments[k-1];if(typeof q!=="function"){return this}g=r.length;n=function(s){var t=p?"once":"bind";o[t](s,function(u){o._fired[s]=o._fired[s]||{};o._fired[s].data=u;if(!m[s]){m[s]=true;e++}})};for(l=0;l<g;l++){n(r[l])}d=function(s){if(e<g){return}if(!m[s]){return}var t=[];for(l=0;l<g;l++){t.push(o._fired[r[l]].data)}if(p){o.unbind("all",d)}q.apply(null,t)};o.bind("all",d)};b.prototype.all=function(f,e,g){var d=Array.prototype.concat.apply([],arguments);d.push(true);c.apply(this,d);return this};b.prototype.assign=b.prototype.all;b.prototype.fail=function(e){var d=this;d.once("error",function(f){d.unbind();e(f)});return this};b.prototype.tail=function(){var d=Array.prototype.concat.apply([],arguments);d.push(false);c.apply(this,d);return this};b.prototype.assignAll=b.prototype.tail;b.prototype.assignAlways=b.prototype.tail;b.prototype.after=function(e,i,j){if(i===0){j.call(null,[]);return this}var f=this,d=[],g;this._after=this._after||{};var h=e+"_group";this._after[h]={index:0,results:[]};g=function(k,l){if(k===e){i--;d.push(l);if(i<1){f.unbind("all",g);j.apply(null,[d])}}if(k===h){i--;f._after[h].results[l.index]=l.result;if(i<1){f.unbind("all",g);j.call(null,f._after[h].results)}}};f.bind("all",g);return this};b.prototype.group=function(d,h){var f=this;var g=d+"_group";var e=f._after[g].index;f._after[g].index++;return function(i,j){if(i){return f.emit("error",i)}f.emit(g,{index:e,result:h?h(j):j})}};b.prototype.any=function(){var h=this,f,j,d=arguments.length,k=arguments[d-1],g=Array.prototype.slice.apply(arguments,[0,d-1]),i=g.length,e=g.join("_");h.once(e,k);j=function(l){h.bind(l,function(m){h.trigger(e,{data:m,eventName:l})})};for(f=0;f<i;f++){j(g[f])}};b.prototype.not=function(d,f){var e=this;e.bind("all",function(g,h){if(g!==d){f(h)}})};b.prototype.done=function(d,f){var e=this;return function(h,i){if(h){return e.emit("error",h)}var g=Array.prototype.slice.call(arguments,1);if(typeof d==="string"){return e.emit(d,f?f.apply(null,g):i)}if(arguments.length<=2){return d(i)}d.apply(null,g)}};b.prototype.doneLater=function(e,f){var d=this.done(e,f);return function(h,i){var g=arguments;a(function(){d.apply(null,g)})}};b.create=function(){var d=new b();var f=Array.prototype.concat.apply([],arguments);if(f.length){var e=f[f.length-1];var g=f[f.length-2];if(typeof e==="function"&&typeof g==="function"){f.pop();d.fail(e)}d.assign.apply(d,Array.prototype.slice.call(f))}return d};b.EventProxy=b;return b});