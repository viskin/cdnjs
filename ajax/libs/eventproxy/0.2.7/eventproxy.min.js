/*!
 * This file is used for define the EventProxy library.
 * @author <a href="mailto:shyvo1987@gmail.com">Jackson Tian</a>
 * @version 0.2.2
 * ```
 */
;!(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b(require("debug")("eventproxy"))}else{this[a]=b()}}})("EventProxy",function(c){c=c||function(){};var f=Array.prototype.slice;var d=Array.prototype.concat;var b=function(){if(!(this instanceof b)){return new b()}this._callbacks={};this._fired={}};b.prototype.addListener=function(g,h){c("Add listener for %s",g);this._callbacks[g]=this._callbacks[g]||[];this._callbacks[g].push(h);return this};b.prototype.bind=b.prototype.addListener;b.prototype.on=b.prototype.addListener;b.prototype.subscribe=b.prototype.addListener;b.prototype.headbind=function(g,h){c("Add listener for %s",g);this._callbacks[g]=this._callbacks[g]||[];this._callbacks[g].unshift(h);return this};b.prototype.removeListener=function(h,n){var k=this._callbacks;if(!h){c("Remove all listeners");this._callbacks={}}else{if(!n){c("Remove all listeners of %s",h);k[h]=[]}else{var m=k[h];if(m){var g=m.length;for(var j=0;j<g;j++){if(n===m[j]){c("Remove a listener of %s",h);m[j]=null;break}}}}}return this};b.prototype.unbind=b.prototype.removeListener;b.prototype.removeAllListeners=function(g){return this.unbind(g)};b.prototype.trigger=function(k,h){var m,p,q,n,j,g;var o=2;var r=this._callbacks;c("Emit event %s with data %j",k,h);while(o--){p=o?k:"all";m=r[p];if(m){for(j=0,g=m.length;j<g;j++){if(!(q=m[j])){m.splice(j,1);j--;g--}else{n=o?f.call(arguments,1):arguments;q.apply(this,n)}}}}return this};b.prototype.emit=b.prototype.trigger;b.prototype.fire=b.prototype.trigger;b.prototype.once=function(h,j){var g=this;var i=function(){j.apply(g,arguments);g.unbind(h,i)};this.bind(h,i);return this};var a=typeof process!=="undefined"&&process.nextTick||function(g){setTimeout(g,0)};b.prototype.emitLater=function(){var g=this;var h=arguments;a(function(){g.trigger.apply(g,h)})};b.prototype.immediate=function(g,i,h){this.bind(g,i);this.trigger(g,h);return this};b.prototype.asap=b.prototype.immediate;var e=function(l,k,m,i){var q=this;var n=arguments.length;var h=0;var r={};if(n<3){return this}var u=f.call(arguments,0,-2);var t=arguments[n-2];var s=arguments[n-1];if(typeof t!=="function"){return this}c("Assign listener for events %j, once is %s",u,!!s);var p=function(v){var w=s?"once":"bind";q[w](v,function(x){q._fired[v]=q._fired[v]||{};q._fired[v].data=x;if(!r[v]){r[v]=true;h++}})};var j=u.length;for(var o=0;o<j;o++){p(u[o])}var g=function(w){if(h<j){return}if(!r[w]){return}var x=[];for(var v=0;v<j;v++){x.push(q._fired[u[v]].data)}if(s){q.unbind("all",g)}c("Events %j all emited with data %j",u,x);t.apply(null,x)};q.bind("all",g)};b.prototype.all=function(i,h,j){var g=d.apply([],arguments);g.push(true);e.apply(this,g);return this};b.prototype.assign=b.prototype.all;b.prototype.fail=function(h){var g=this;g.once("error",function(i){g.unbind();h.apply(null,arguments)});return this};b.prototype.tail=function(){var g=d.apply([],arguments);g.push(false);e.apply(this,g);return this};b.prototype.assignAll=b.prototype.tail;b.prototype.assignAlways=b.prototype.tail;b.prototype.after=function(h,l,m){if(l===0){m.call(null,[]);return this}var i=this,g=[];this._after=this._after||{};var k=h+"_group";this._after[k]={index:0,results:[]};c("After emit %s times, event %s's listenner will execute",l,h);var j=function(n,o){if(n===h){l--;g.push(o);if(l<1){c("Event %s was emit %s, and execute the listenner",h,l);i.unbind("all",j);m.apply(null,[g])}}if(n===k){l--;i._after[k].results[o.index]=o.result;if(l<1){c("Event %s was emit %s, and execute the listenner",h,l);i.unbind("all",j);m.call(null,i._after[k].results)}}};i.bind("all",j);return this};b.prototype.group=function(g,k){var i=this;var j=g+"_group";var h=i._after[j].index;i._after[j].index++;return function(l,m){if(l){return i.emit.apply(i,["error"].concat(f.call(arguments)))}i.emit(j,{index:h,result:k?k.apply(null,f.call(arguments,1)):m})}};b.prototype.any=function(){var j=this,l=arguments[arguments.length-1],i=f.call(arguments,0,-1),g=i.join("_");c("Add listenner for Any of events %j emit",i);j.once(g,l);var k=function(m){j.bind(m,function(n){c("One of events %j emited, execute the listenner");j.trigger(g,{data:n,eventName:m})})};for(var h=0;h<i.length;h++){k(i[h])}};b.prototype.not=function(g,i){var h=this;c("Add listenner for not event %s",g);h.bind("all",function(j,k){if(j!==g){c("listenner execute of event %s emit, but not event %s.",j,g);i(k)}})};b.prototype.done=function(g,i){var h=this;return function(k,l){if(k){return h.emit.apply(h,["error"].concat(f.call(arguments)))}var j=f.call(arguments,1);if(typeof g==="string"){if(i){return h.emit(g,i.apply(null,j))}else{return h.emit.apply(h,[g].concat(j))}}if(arguments.length<=2){return g(l)}g.apply(null,j)}};b.prototype.doneLater=function(h,i){var g=this.done(h,i);return function(k,l){var j=arguments;a(function(){g.apply(null,j)})}};b.create=function(){var g=new b();var i=d.apply([],arguments);if(i.length){var h=i[i.length-1];var j=i[i.length-2];if(typeof h==="function"&&typeof j==="function"){i.pop();g.fail(h)}g.assign.apply(g,i)}return g};b.EventProxy=b;return b});