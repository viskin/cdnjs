// Cart.js
// version: 0.0.1
// author: Gavin Ballard
// license: MIT
(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};a={settings:{autoCommit:!0,dataAPI:!1,requestBodyClass:null,rivetsModels:{}},cart:null},a.init=function(b,c){return null==c&&(c={}),a.configure(c),a.cart=new a.Cart(b),a.settings.dataAPI&&a.Data.bind(),a.settings.requestBodyClass&&($(document).on("cart.requestStarted",function(){return $("body").addClass(a.settings.requestBodyClass)}),$(document).on("cart.requestComplete",function(){return $("body").removeClass(a.settings.requestBodyClass)})),a.Rivets.bindElements()},a.configure=function(b){return null==b&&(b={}),a.Utils.extend(a.settings,b)},a.Utils={wrapKeys:function(a,b,c){var d,e,f;null==b&&(b="properties"),f={};for(d in a)e=a[d],f[""+b+"["+d+"]"]=null!=c?c:e;return f},unwrapKeys:function(a,b,c){var d,e,f,g;null==b&&(b="properties"),e={};for(d in a)g=a[d],f=d.replace(""+b+"[","").replace("]",""),e[f]=null!=c?c:g;return e},extend:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},clone:function(a){var b,c;if(null==a||"object"!=typeof a)return a;c=new a.constructor;for(b in a)c[b]=clone(a[b]);return c}},c=[],b=!1,a.Queue={add:function(d,e,f,g,h){return null==g&&(g="POST"),null==h&&(h="json"),c.push({url:d,data:e,success:f,type:g,dataType:h}),b?void 0:(jQuery(document).trigger("cart.requestStarted"),a.Queue.process())},process:function(){var d;return c.length?(b=!0,d=c.shift(),d.complete=a.Queue.process,jQuery.ajax(d)):(b=!1,void jQuery(document).trigger("cart.requestComplete"))}},a.Cart=function(){function b(a){this.update=d(this.update,this),this.update(a)}return b.prototype.update=function(b){var c,d,e;for(d in b)e=b[d],"items"!==d&&(this[d]=e);return this.items=function(){var d,e,f,g;for(f=b.items,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(new a.Item(c));return g}()},b}(),a.Item=function(){function b(a){this.propertyArray=d(this.propertyArray,this),this.update=d(this.update,this),this.update(a)}return b.prototype.update=function(b){var c,d;for(c in b)d=b[c],"properties"!==c&&(this[c]=d);return this.properties=a.Utils.extend({},b.properties)},b.prototype.propertyArray=function(){var a,b,c,d;c=this.properties,d=[];for(a in c)b=c[a],d.push({name:a,value:b});return d},b}(),a.Core={getCart:function(){return a.Queue.add("/cart.js",{},a.cart.update,"GET")},addItem:function(b,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=a.Utils.wrapKeys(d),e.id=b,e.quantity=c,a.Queue.add("/cart/add.js",e),a.Core.getCart()},updateItem:function(b,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=a.Utils.wrapKeys(d),e.line=b,e.quantity=c,a.Queue.add("/cart/change.js",e,a.cart.update)},removeItem:function(b){return a.Core.updateItem(b,0)},updateItemById:function(b,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=a.Utils.wrapKeys(d),e.id=b,e.quantity=c,a.Queue.add("/cart/change.js",e,a.cart.update)},removeAll:function(b){var c;return c={id:b,quantity:0},a.Queue.add("/cart/change.js",c,a.cart.update)},clear:function(){return a.Queue.add("/cart/clear.js",{},a.cart.update)},getAttribute:function(b,c){return b in a.cart.attributes?a.cart.attributes[b]:c},setAttribute:function(b,c){var d;return d={},d[b]=c,a.Core.setAttributes(d)},getAttributes:function(){return a.cart.attributes},setAttributes:function(b){return null==b&&(b={}),a.Queue.add("/cart/update.js",a.Utils.wrapKeys(b,"attributes"),a.cart.update)},clearAttributes:function(){return a.Queue.add("/cart/update.js",a.Utils.wrapKeys(a.Core.getAttributes(),"attributes",""),a.cart.update)},getNote:function(){return a.cart.note},setNote:function(b){return a.Queue.add("/cart/update.js",{note:b},a.cart.update)}},a.Data={bind:function(){return jQuery(document).on("click","[data-cart-add]",a.Data.add),jQuery(document).on("click","[data-cart-remove]",a.Data.remove),jQuery(document).on("change","[data-cart-toggle]",a.Data.toggle),jQuery(document).on("change","[data-cart-toggle-attribute]",a.Data.toggleAttribute),jQuery(document).on("submit","[data-cart-submit]",a.Data.submit)},unbind:function(){},add:function(b){var c;return b.preventDefault(),c=jQuery(b.target).attr("data-cart-add"),a.Core.addItem(c)},remove:function(b){var c;return b.preventDefault(),c=jQuery(b.target).attr("data-cart-remove"),a.Core.removeItem(c)},toggle:function(b){var c,d;return c=jQuery(b.target),d=c.attr("data-cart-toggle"),c.is(":checked")?a.Core.addItem(d):a.Core.removeAll(d)},toggleAttribute:function(b){var c,d;return c=jQuery(b.target),d=c.attr("data-cart-toggle-attribute"),a.Core.setAttribute(d,c.is(":checked")?"Yes":"")},submit:function(b){var c,d,e,f;return b.preventDefault(),c=jQuery(b.target).serializeArray(),d=void 0,f=void 0,e={},jQuery.each(c,function(a,b){return"id"===b.name?d=b.value:"quantity"===b.name?f=b.value:e[b.name]=b.value}),a.Core.addItem(d,f,a.Utils.unwrapKeys(e))}},"rivets"in window?(a.Rivets={views:[],bindElements:function(){var b;return a.Rivets.unbindElements(),b=a.Utils.extend({cart:a.cart},a.settings.rivetsModels),jQuery("[data-cart-view]").each(function(){return a.Rivets.views.push(rivets.bind(this,b))})},unbindElements:function(){var b,c,d,e;for(e=a.Rivets.views,c=0,d=e.length;d>c;c++)b=e[c],b.unbind();return a.Rivets.views=[]}},rivets.formatters.eq=function(a,b){return a===b},rivets.formatters.lt=function(a,b){return b>a},rivets.formatters.gt=function(a,b){return a>b},rivets.formatters.not=function(a){return!a},rivets.formatters.empty=function(a){return!a.length},rivets.formatters.plus=function(a,b){return parseInt(a)+parseInt(b)},rivets.formatters.minus=function(a,b){return parseInt(a)-parseInt(b)},"Shopify"in window&&"formatMoney"in window.Shopify&&(rivets.formatters.money=function(b){return Shopify.formatMoney(b,a.settings.money_format)},rivets.formatters.money_with_currency=function(b){return Shopify.formatMoney(b,a.settings.money_with_currency_format)})):a.Rivets={bindElements:function(){},unbindElements:function(){}},a.factory=function(b){return b._=a,b.init=a.init,b.configure=a.configure,b.settings=a.settings,b.getCart=a.Core.getCart,b.addItem=a.Core.addItem,b.updateItem=a.Core.updateItem,b.updateItemById=a.Core.updateItemById,b.removeItem=a.Core.removeItem,b.removeAll=a.Core.removeAll,b.clear=a.Core.clear,b.getAttribute=a.Core.getAttribute,b.setAttribute=a.Core.setAttribute,b.getAttributes=a.Core.getAttributes,b.setAttributes=a.Core.setAttributes,b.clearAttributes=a.Core.clearAttributes,b.getNote=a.Core.getNote,b.setNote=a.Core.setNote,b.Cart=a.Cart,b.Item=a.Item},"object"==typeof exports?a.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(b){return a.factory(this.CartJS=b),b}):a.factory(this.CartJS={})}).call(this);