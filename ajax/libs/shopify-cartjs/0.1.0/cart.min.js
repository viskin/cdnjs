// Cart.js
// version: 0.0.1
// author: Gavin Ballard
// license: MIT
(function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){this.update=f(this.update,this)}return a.prototype.update=function(a){var b,d,e;for(d in a)e=a[d],"items"!==d&&(this[d]=e);return this.items=function(){var d,e,f,g;for(f=a.items,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(new c(b));return g}()},a}(),c=function(){function a(a){this.propertyArray=f(this.propertyArray,this),this.update=f(this.update,this),this.update(a)}return a.prototype.update=function(a){var c,d;for(c in a)d=a[c],"properties"!==c&&(this[c]=d);return this.properties=b.Utils.extend({},a.properties)},a.prototype.propertyArray=function(){var a,b,c,d;c=this.properties,d=[];for(a in c)b=c[a],d.push({name:a,value:b});return d},a}(),b={settings:{autoCommit:!0,dataAPI:!0,requestBodyClass:null,rivetsModels:{}},cart:new a},b.init=function(a,c){return null==c&&(c={}),b.configure(c),b.cart.update(a),b.settings.dataAPI&&b.Data.bind(),b.settings.requestBodyClass&&($(document).on("cart.requestStarted",function(){return $("body").addClass(b.settings.requestBodyClass)}),$(document).on("cart.requestComplete",function(){return $("body").removeClass(b.settings.requestBodyClass)})),b.Rivets.bindElements()},b.configure=function(a){return null==a&&(a={}),b.Utils.extend(b.settings,a)},b.Utils={wrapKeys:function(a,b,c){var d,e,f;null==b&&(b="properties"),f={};for(d in a)e=a[d],f[""+b+"["+d+"]"]=null!=c?c:e;return f},unwrapKeys:function(a,b,c){var d,e,f,g;null==b&&(b="properties"),e={};for(d in a)g=a[d],f=d.replace(""+b+"[","").replace("]",""),e[f]=null!=c?c:g;return e},extend:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},clone:function(a){var b,c;if(null==a||"object"!=typeof a)return a;c=new a.constructor;for(b in a)c[b]=clone(a[b]);return c}},e=[],d=!1,b.Queue={add:function(a,c,f,g,h){return null==g&&(g="POST"),null==h&&(h="json"),e.push({url:a,data:c,success:f,type:g,dataType:h}),d?void 0:(jQuery(document).trigger("cart.requestStarted",[b.cart]),b.Queue.process())},process:function(){var a;return e.length?(d=!0,a=e.shift(),a.complete=b.Queue.process,jQuery.ajax(a)):(d=!1,void jQuery(document).trigger("cart.requestComplete",[b.cart]))}},b.Core={getCart:function(){return b.Queue.add("/cart.js",{},b.cart.update,"GET")},addItem:function(a,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=b.Utils.wrapKeys(d),e.id=a,e.quantity=c,b.Queue.add("/cart/add.js",e),b.Core.getCart()},updateItem:function(a,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=b.Utils.wrapKeys(d),e.line=a,e.quantity=c,b.Queue.add("/cart/change.js",e,b.cart.update)},removeItem:function(a){return b.Core.updateItem(a,0)},updateItemById:function(a,c,d){var e;return null==c&&(c=1),null==d&&(d={}),e=b.Utils.wrapKeys(d),e.id=a,e.quantity=c,b.Queue.add("/cart/change.js",e,b.cart.update)},removeItemById:function(a){var c;return c={id:a,quantity:0},b.Queue.add("/cart/change.js",c,b.cart.update)},clear:function(){return b.Queue.add("/cart/clear.js",{},b.cart.update)},getAttribute:function(a,c){return a in b.cart.attributes?b.cart.attributes[a]:c},setAttribute:function(a,c){var d;return d={},d[a]=c,b.Core.setAttributes(d)},getAttributes:function(){return b.cart.attributes},setAttributes:function(a){return null==a&&(a={}),b.Queue.add("/cart/update.js",b.Utils.wrapKeys(a,"attributes"),b.cart.update)},clearAttributes:function(){return b.Queue.add("/cart/update.js",b.Utils.wrapKeys(b.Core.getAttributes(),"attributes",""),b.cart.update)},getNote:function(){return b.cart.note},setNote:function(a){return b.Queue.add("/cart/update.js",{note:a},b.cart.update)}},b.Data={bind:function(){return jQuery(document).on("click","[data-cart-add]",b.Data.add),jQuery(document).on("click","[data-cart-remove]",b.Data.remove),jQuery(document).on("click","[data-cart-remove-id]",b.Data.removeById),jQuery(document).on("change","[data-cart-toggle]",b.Data.toggle),jQuery(document).on("change","[data-cart-toggle-attribute]",b.Data.toggleAttribute),jQuery(document).on("submit","[data-cart-submit]",b.Data.submit)},unbind:function(){},add:function(a){var c;return a.preventDefault(),c=jQuery(a.target).data("cartAdd"),b.Core.addItem(c)},remove:function(a){var c;return a.preventDefault(),c=jQuery(a.target).data("cartRemove"),b.Core.removeItem(c)},removeById:function(a){var c;return a.preventDefault(),c=jQuery(a.target).data("cartRemoveId"),b.Core.removeItemById(c)},toggle:function(a){var c,d;return c=jQuery(a.target),d=c.attr("data-cart-toggle"),c.is(":checked")?b.Core.addItem(d):b.Core.removeAll(d)},toggleAttribute:function(a){var c,d;return c=jQuery(a.target),d=c.attr("data-cart-toggle-attribute"),b.Core.setAttribute(d,c.is(":checked")?"Yes":"")},submit:function(a){var c,d,e,f;return a.preventDefault(),c=jQuery(a.target).serializeArray(),d=void 0,f=void 0,e={},jQuery.each(c,function(a,b){return"id"===b.name?d=b.value:"quantity"===b.name?f=b.value:e[b.name]=b.value}),b.Core.addItem(d,f,b.Utils.unwrapKeys(e))}},"rivets"in window?(b.Rivets={views:[],bindElements:function(){var a;return b.Rivets.unbindElements(),a=b.Utils.extend({cart:b.cart},b.settings.rivetsModels),jQuery("[data-cart-view]").each(function(){return b.Rivets.views.push(rivets.bind(this,a))})},unbindElements:function(){var a,c,d,e;for(e=b.Rivets.views,c=0,d=e.length;d>c;c++)a=e[c],a.unbind();return b.Rivets.views=[]}},rivets.formatters.eq=function(a,b){return a===b},rivets.formatters.lt=function(a,b){return b>a},rivets.formatters.gt=function(a,b){return a>b},rivets.formatters.not=function(a){return!a},rivets.formatters.empty=function(a){return!a.length},rivets.formatters.plus=function(a,b){return parseInt(a)+parseInt(b)},rivets.formatters.minus=function(a,b){return parseInt(a)-parseInt(b)},"Shopify"in window&&("formatMoney"in window.Shopify&&(rivets.formatters.money=function(a){return Shopify.formatMoney(a,b.settings.money_format)},rivets.formatters.money_with_currency=function(a){return Shopify.formatMoney(a,b.settings.money_with_currency_format)}),"Image"in window.Shopify&&"getSizedImageUrl"in window.Shopify.Image&&(rivets.formatters.productImageSize=function(a,b){return Shopify.Image.getSizedImageUrl(a,b)}))):b.Rivets={bindElements:function(){},unbindElements:function(){}},b.factory=function(a){return a.init=b.init,a.configure=b.configure,a.cart=b.cart,a.settings=b.settings,a.getCart=b.Core.getCart,a.addItem=b.Core.addItem,a.updateItem=b.Core.updateItem,a.updateItemById=b.Core.updateItemById,a.removeItem=b.Core.removeItem,a.removeAll=b.Core.removeAll,a.clear=b.Core.clear,a.getAttribute=b.Core.getAttribute,a.setAttribute=b.Core.setAttribute,a.getAttributes=b.Core.getAttributes,a.setAttributes=b.Core.setAttributes,a.clearAttributes=b.Core.clearAttributes,a.getNote=b.Core.getNote,a.setNote=b.Core.setNote},"object"==typeof exports?b.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(a){return b.factory(this.CartJS=a),a}):b.factory(this.CartJS={})}).call(this);