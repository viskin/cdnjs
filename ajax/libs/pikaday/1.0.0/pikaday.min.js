/*!
 * Pikaday
 * Copyright Â© 2012 David Bushell | BSD & MIT license | http://dbushell.com/
 */
(function(h,o,e){var i=typeof h.moment==="function",d=!!h.addEventListener,s=h.setTimeout,q=function(D,E,F,C){if(d){D.addEventListener(E,F,!!C)}else{D.attachEvent("on"+E,F)}},u=function(D,E,F,C){if(d){D.removeEventListener(E,F,!!C)}else{D.detachEvent("on"+E,F)}},B=function(D,C,F){var E;if(o.createEvent){E=o.createEvent("HTMLEvents");E.initEvent(C,true,false);E=w(E,F);D.dispatchEvent(E)}else{if(o.createEventObject){E=o.createEventObject();E=w(E,F);D.fireEvent("on"+C,E)}}},v=function(C){return C.trim?C.trim():C.replace(/^\s+|\s+$/g,"")},a=function(C,D){return(" "+C.className+" ").indexOf(" "+D+" ")!==-1},l=function(C,D){if(!a(C,D)){C.className=(C.className==="")?D:C.className+" "+D}},m=function(C,D){C.className=v((" "+C.className+" ").replace(" "+D+" "," "))},k=function(C){return(/Array/).test(Object.prototype.toString.call(C))},z=function(C){return(/Date/).test(Object.prototype.toString.call(C))&&!isNaN(C.getTime())},g=function(C){return C%4===0&&C%100!==0||C%400===0},c=function(C,D){return[31,g(C)?29:28,31,30,31,30,31,31,30,31,30,31][D]},y=function(C){if(z(C)){C.setHours(0,0,0,0)}},p=function(D,C){return D.getTime()===C.getTime()},w=function(G,F,C){var E,D;for(E in F){D=G[E]!==e;if(D&&typeof F[E]==="object"&&F[E].nodeName===e){if(z(F[E])){if(C){G[E]=new Date(F[E].getTime())}}else{if(k(F[E])){if(C){G[E]=F[E].slice(0)}}else{G[E]=w({},F[E],C)}}}else{if(C||!D){G[E]=F[E]}}}return G},j={field:null,bound:e,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:false,firstDay:0,minDate:null,maxDate:null,yearRange:10,minYear:0,maxYear:9999,minMonth:e,maxMonth:e,isRTL:false,numberOfMonths:1,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},A=function(E,C,D){C+=E.firstDay;while(C>=7){C-=7}return D?E.i18n.weekdaysShort[C]:E.i18n.weekdays[C]},t=function(G,E,F,D,H){if(H){return'<td class="is-empty"></td>'}var C=[];if(D){C.push("is-disabled")}if(F){C.push("is-today")}if(E){C.push("is-selected")}return'<td data-day="'+G+'" class="'+C.join(" ")+'"><button class="pika-button" type="button">'+G+"</button></td>"},f=function(D,C){return"<tr>"+(C?D.reverse():D).join("")+"</tr>"},b=function(C){return"<tbody>"+C.join("")+"</tbody>"},x=function(E){var D,C=[];for(D=0;D<7;D++){C.push('<th scope="col"><abbr title="'+A(E,D)+'">'+A(E,D,true)+"</abbr></th>")}return"<thead>"+(E.isRTL?C.reverse():C).join("")+"</thead>"},r=function(M){var G,F,J,C=M._o,K=M._m,L=M._y,E=L===C.minYear,N=L===C.maxYear,I='<div class="pika-title">',D=true,H=true;for(J=[],G=0;G<12;G++){J.push('<option value="'+G+'"'+(G===K?" selected":"")+((E&&G<C.minMonth)||(N&&G>C.maxMonth)?"disabled":"")+">"+C.i18n.months[G]+"</option>")}I+='<div class="pika-label">'+C.i18n.months[K]+'<select class="pika-select pika-select-month">'+J.join("")+"</select></div>";if(k(C.yearRange)){G=C.yearRange[0];F=C.yearRange[1]+1}else{G=L-C.yearRange;F=1+L+C.yearRange}for(J=[];G<F&&G<=C.maxYear;G++){if(G>=C.minYear){J.push('<option value="'+G+'"'+(G===L?" selected":"")+">"+(G)+"</option>")}}I+='<div class="pika-label">'+L+'<select class="pika-select pika-select-year">'+J.join("")+"</select></div>";if(E&&(K===0||C.minMonth>=K)){D=false}if(N&&(K===11||C.maxMonth<=K)){H=false}I+='<button class="pika-prev'+(D?"":" is-disabled")+'" type="button">'+C.i18n.previousMonth+"</button>";I+='<button class="pika-next'+(H?"":" is-disabled")+'" type="button">'+C.i18n.nextMonth+"</button>";return I+="</div>"},n=function(C,D){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+x(C)+b(D)+"</table>"};h.Pikaday=function(E){var C=this,F=C.config(E);C._onMouseDown=function(H){if(!C._v){return}H=H||h.event;var G=H.target||H.srcElement;if(!G){return}if(!a(G,"is-disabled")){if(a(G,"pika-button")&&!a(G,"is-empty")){C.setDate(new Date(C._y,C._m,parseInt(G.innerHTML,10)));if(F.bound){s(function(){C.hide()},100)}return}else{if(a(G,"pika-prev")){C.prevMonth()}else{if(a(G,"pika-next")){C.nextMonth()}}}}if(!a(G,"pika-select")){if(H.preventDefault){H.preventDefault()}else{return H.returnValue=false}}else{C._c=true}};C._onChange=function(H){H=H||h.event;var G=H.target||H.srcElement;if(!G){return}if(a(G,"pika-select-month")){C.gotoMonth(G.value)}else{if(a(G,"pika-select-year")){C.gotoYear(G.value)}}};C._onInputChange=function(H){var G;if(H.firedBy===C){return}if(i){G=h.moment(F.field.value,F.format);G=G?G.toDate():null}else{G=new Date(Date.parse(F.field.value))}C.setDate(z(G)?G:null);if(!C._v){C.show()}};C._onInputFocus=function(G){C.show()};C._onInputClick=function(G){C.show()};C._onInputBlur=function(G){if(!C._c){C._b=s(function(){C.hide()},50)}C._c=false};C._onClick=function(H){H=H||h.event;var G=H.target||H.srcElement,I=G;if(!G){return}if(!d&&a(G,"pika-select")){if(!G.onchange){G.setAttribute("onchange","return;");q(G,"change",C._onChange)}}do{if(a(I,"pika-single")){return}}while((I=I.parentNode));if(C._v&&G!==F.field){C.hide()}};C.el=o.createElement("div");C.el.className="pika-single"+(F.isRTL?" is-rtl":"");q(C.el,"mousedown",C._onMouseDown,true);q(C.el,"change",C._onChange);if(F.field){if(F.bound){o.body.appendChild(C.el)}else{F.field.parentNode.insertBefore(C.el,F.field.nextSibling)}q(F.field,"change",C._onInputChange);if(!F.defaultDate){if(i&&F.field.value){F.defaultDate=h.moment(F.field.value,F.format).toDate()}else{F.defaultDate=new Date(Date.parse(F.field.value))}F.setDefaultDate=true}}var D=F.defaultDate;if(z(D)){if(F.setDefaultDate){C.setDate(D,true)}else{C.gotoDate(D)}}else{C.gotoDate(new Date())}if(F.bound){this.hide();C.el.className+=" is-bound";q(F.field,"click",C._onInputClick);q(F.field,"focus",C._onInputFocus);q(F.field,"blur",C._onInputBlur)}else{this.show()}};h.Pikaday.prototype={config:function(D){if(!this._o){this._o=w({},j,true)}var E=w(this._o,D,true);E.isRTL=!!E.isRTL;E.field=(E.field&&E.field.nodeName)?E.field:null;E.bound=!!(E.bound!==e?E.field&&E.bound:E.field);var C=parseInt(E.numberOfMonths,10)||1;E.numberOfMonths=C>4?4:C;if(!z(E.minDate)){E.minDate=false}if(!z(E.maxDate)){E.maxDate=false}if((E.minDate&&E.maxDate)&&E.maxDate<E.minDate){E.maxDate=E.minDate=false}if(E.minDate){y(E.minDate);E.minYear=E.minDate.getFullYear();E.minMonth=E.minDate.getMonth()}if(E.maxDate){y(E.maxDate);E.maxYear=E.maxDate.getFullYear();E.maxMonth=E.maxDate.getMonth()}if(k(E.yearRange)){var F=new Date().getFullYear()-10;E.yearRange[0]=parseInt(E.yearRange[0],10)||F;E.yearRange[1]=parseInt(E.yearRange[1],10)||F}else{E.yearRange=Math.abs(parseInt(E.yearRange,10))||j.yearRange;if(E.yearRange>100){E.yearRange=100}}return E},toString:function(C){return !z(this._d)?"":i?h.moment(this._d).format(C||this._o.format):this._d.toDateString()},getMoment:function(){return i?h.moment(this._d):null},setMoment:function(C){if(i&&h.moment.isMoment(C)){this.setDate(C.toDate())}},getDate:function(){return z(this._d)?new Date(this._d.getTime()):null},setDate:function(D,F){if(!D){this._d=null;return this.draw()}if(typeof D==="string"){D=new Date(Date.parse(D))}if(!z(D)){return}var E=this._o.minDate,C=this._o.maxDate;if(z(E)&&D<E){D=E}else{if(z(C)&&D>C){D=C}}this._d=new Date(D.getTime());y(this._d);this.gotoDate(this._d);if(this._o.field){this._o.field.value=this.toString();B(this._o.field,"change",{firedBy:this})}if(!F&&typeof this._o.onSelect==="function"){this._o.onSelect.call(this,this.getDate())}},gotoDate:function(C){if(!z(C)){return}this._y=C.getFullYear();this._m=C.getMonth();this.draw()},gotoToday:function(){this.gotoDate(new Date())},gotoMonth:function(C){if(!isNaN((C=parseInt(C,10)))){this._m=C<0?0:C>11?11:C;this.draw()}},nextMonth:function(){if(++this._m>11){this._m=0;this._y++}this.draw()},prevMonth:function(){if(--this._m<0){this._m=11;this._y--}this.draw()},gotoYear:function(C){if(!isNaN(C)){this._y=parseInt(C,10);this.draw()}},draw:function(D){if(!this._v&&!D){return}var C=this._o,K=C.minYear,G=C.maxYear,H=C.minMonth,F=C.maxMonth;if(this._y<=K){this._y=K;if(!isNaN(H)&&this._m<H){this._m=H}}if(this._y>=G){this._y=G;if(!isNaN(F)&&this._m>F){this._m=F}}this.el.innerHTML=r(this)+this.render(this._y,this._m);if(C.bound){var I=C.field,E=I.offsetLeft,J=I.offsetTop+I.offsetHeight;while((I=I.offsetParent)){E+=I.offsetLeft;J+=I.offsetTop}this.el.style.cssText="position:absolute;left:"+E+"px;top:"+J+"px;";s(function(){C.field.focus()},1)}if(typeof this._o.onDraw==="function"){var L=this;s(function(){L._o.onDraw.call(L)},0)}},render:function(M,L){var D=this._o,G=new Date(),Q=c(M,L),O=new Date(M,L,1).getDay(),J=[],S=[];y(G);if(D.firstDay>0){O-=D.firstDay;if(O<0){O+=7}}var R=Q+O,E=R;while(E>7){E-=7}R+=7-E;for(var I=0,C=0;I<R;I++){var N=new Date(M,L,1+(I-O)),P=(D.minDate&&N<D.minDate)||(D.maxDate&&N>D.maxDate),F=z(this._d)?p(N,this._d):false,K=p(N,G),H=I<O||I>=(Q+O);S.push(t(1+(I-O),F,K,P,H));if(++C===7){J.push(f(S,D.isRTL));S=[];C=0}}return n(D,J)},isVisible:function(){return this._v},show:function(){if(!this._v){if(this._o.bound){q(o,"click",this._onClick)}m(this.el,"is-hidden");this._v=true;this.draw();if(typeof this._o.onOpen==="function"){this._o.onOpen.call(this)}}},hide:function(){var C=this._v;if(C!==false){if(this._o.bound){u(o,"click",this._onClick)}this.el.style.cssText="";l(this.el,"is-hidden");this._v=false;if(C!==e&&typeof this._o.onClose==="function"){this._o.onClose.call(this)}}},destroy:function(){this.hide();u(this.el,"mousedown",this._onMouseDown,true);u(this.el,"change",this._onChange);if(this._o.field){u(this._o.field,"change",this._onInputChange);if(this._o.bound){u(this._o.field,"click",this._onInputClick);u(this._o.field,"focus",this._onInputFocus);u(this._o.field,"blur",this._onInputBlur)}}if(this.el.parentNode){this.el.parentNode.removeChild(this.el)}}}})(window,window.document);