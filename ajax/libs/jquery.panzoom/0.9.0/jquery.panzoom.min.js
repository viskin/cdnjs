/**
 * @license jquery.panzoom.js v0.9.0
 * Updated: Tue Jun 04 2013
 * Add pan and zoom functionality to any element
 * Copyright (c) 2013 timmy willison
 * Released under the MIT license
 * https://github.com/timmywil/jquery.panzoom/blob/master/MIT-License.txt
 */
(function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)})(this,function(t){"use strict";var e="undefined"!=typeof Modernizr&&Modernizr.touch;if(e){var n={props:["touches","pageX","pageY"],filter:function(t,e){var n;return!e.pageX&&e.touches&&(n=e.touches[0])&&(t.pageX=n.pageX,t.pageY=n.pageY),t}};t.each(["touchstart","touchmove","touchend"],function(e,a){t.event.fixHooks[a]=n})}var a="__pz__",i=Array.prototype.slice,s=/([A-Z])/g,o=/^http:[\w\.\/]+svg$/,r="(\\-?[\\d\\.e]+)",c="\\,?\\s*",h=RegExp("^matrix\\("+r+c+r+c+r+c+r+c+r+c+r+"\\)$"),u=function(e,n){1!==e.nodeType&&t.error("Panzoom called on non-Element node"),t.contains(document,e)||t.error("Panzoom element must be attached to the document");var i=t.data(e,a);if(i)return i;if(!(this instanceof u))return new u(e,n);this.options=n=t.extend({},u.defaults,n),this.elem=e;var r=this.$elem=t(e);this.$parent=r.parent(),this.isSVG=o.test(e.namespaceURI)&&"svg"!==e.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=t.cssProps.transform.replace(s,"-$1").toLowerCase(),this._buildTransition();var c=t(),h=this;return t.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(t,e){h[e]=n[e]||c}),this._initStyle(),this.enable(),t.data(e,a,this),this};return u.rmatrix=h,u.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,increment:.3,minScale:.4,maxScale:5,duration:200,easing:"ease-in-out"},u.prototype={constructor:u,instance:function(){return this},enable:function(){this.disable();var n=this,a=this.options.eventNamespace,i=(e?"touchend":"click")+a,s=(e?"touchstart":"mousedown")+a,o=this.options,r={};if(t.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var e=o["on"+this];t.isFunction(e)&&(r["panzoom"+this.toLowerCase()+a]=e)}),e?o.disablePan&&o.disableZoom||(r[s]=function(t){var e=t.touches;if(e){if(1===e.length&&!o.disablePan)return n._startMove(t.pageX,t.pageY),!1;if(2===e.length)return n._startMove(e),!1}}):o.disablePan||(r[s]=function(t){return 1===t.which&&null!=t.pageX&&null!=t.pageY?(n._startMove(t.pageX,t.pageY),!1):void 0}),this.$elem.on(r),!o.disableZoom){var c=this.$zoomIn,h=this.$zoomOut,u=this.$zoomRange,m=this.$reset;c.length&&h.length&&(c.on(i,function(t){t.preventDefault(),n.zoom()}),h.on(i,function(t){t.preventDefault(),n.zoom(!0)})),u.length&&(u.attr({min:o.minScale,max:o.maxScale,step:.05}).prop({value:this.getMatrix()[0]}),r={},r[s]=function(){n.transition(!0)},r["change"+a]=function(){n.zoom(+this.value,{noSetRange:!0})},u.on(r)),m.length&&m.on(i,function(t){t.preventDefault(),n.reset()})}},disable:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},destroy:function(){this._resetStyle(),this.disable(),t.removeData(this.elem,a)},reset:function(t){this.setMatrix(this._origTransform,{animate:"boolean"!=typeof t||t});var e=this.getMatrix();this.$zoomRange.val(e[0]),this._trigger("reset",e)},resetZoom:function(t){this._resetParts([0,3],t),this.$zoomRange.val(this.getMatrix()[0])},resetPan:function(t){this._resetParts([4,5],t)},getTransform:function(){var e=this.elem,n=t.style(e,"transform");return this.isSVG&&!n?n=t.attr(e,"transform"):"none"===n||h.test(n)||(n=t.style(e,"transform",t.css(e,"transform"))),n||"none"},getMatrix:function(t){var e=h.exec(t||this.getTransform());return e&&e.shift(),e||[1,0,0,1,0,0]},setMatrix:function(e,n){n||(n={}),"array"===t.type(e)&&(e="matrix("+e.join(",")+")"),this.transition(!n.animate),t[this.isSVG?"attr":"style"](this.elem,"transform",e||"none"),n.silent||this._trigger("change",e)},isPanning:function(){return this.panning},transition:function(e){var n=e||!this.options.transition?"none":this._transition;t.style(this.elem,"transition",n)},zoom:function(t,e){var n=!1,a=this.options;if(!a.disableZoom){"object"==typeof t?e=t:e||(e={});var i=this.getMatrix();e.middle&&(i[4]=+i[4]+(e.middle.pageX>i[4]?1:-1),i[5]=+i[5]+(e.middle.pageY>i[5]?1:-1)),"number"!=typeof t&&(t=+i[0]+this.options.increment*(t?-1:1),n=!0),t>a.maxScale?t=a.maxScale:a.minScale>t&&(t=a.minScale),i[0]=i[3]=t,this.setMatrix(i,{animate:"boolean"==typeof e.animate?e.animate:n}),e.noSetRange||this.$zoomRange.val(t),e.silent||this._trigger("zoom",t,e)}},option:function(e,n){var a;if(!e)return t.extend({},this.options);if("string"==typeof e){if(1===arguments.length)return this.options[e];a={},a[e]=n}else a=e;this._setOptions(a)},_setOptions:function(e){var n=this;t.each(e,function(e,a){switch(e){case"disablePan":n._resetStyle();case"disableZoom":case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"onStart":case"onEnd":case"onChange":case"eventNamespace":n.disable()}switch(n.options[e]=a,e){case"disablePan":n._initStyle();case"disableZoom":case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"onStart":case"onEnd":case"onChange":case"eventNamespace":n.enable();break;case"cursor":t.style(n.elem,"cursor",a);break;case"minScale":n.$zoomRange.attr("min",a);break;case"maxScale":n.$zoomRange.attr("max",a);break;case"startTransform":n._buildTransform();break;case"duration":case"easing":n._buildTransition();case"transition":n.transition()}})},_initStyle:function(){this.options.disablePan||this.$elem.css("cursor",this.options.cursor);var e=this.$parent;if(e.length&&!t.nodeName(e[0],"body")){var n={overflow:"hidden"};"static"===e.css("position")&&(n.position="relative"),e.css(n)}},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_buildTransform:function(){this._origTransform=this.options.startTransform||this.getTransform()},_buildTransition:function(){var t=this.options;this._transform&&(this._transition=this._transform+" "+t.duration+"ms "+t.easing)},_resetParts:function(t,e){for(var n=this.getMatrix(this._origTransform),a=this.getMatrix(),i=t.length;i--;)a[t[i]]=n[t[i]];this.setMatrix(a,{animate:"boolean"!=typeof e||e})},_getDistance:function(t){var e=t[0],n=t[1];return Math.sqrt(Math.pow(Math.abs(n.pageX-e.pageX),2)+Math.pow(Math.abs(n.pageY-e.pageY),2))},_getMiddle:function(t){var e=t[0],n=t[1];return{pageX:Math.abs(n.pageX-e.pageX)/2+e.pageX,pageY:Math.abs(n.pageY-e.pageY)/2+e.pageY}},_trigger:function(t){this.$elem.triggerHandler("panzoom"+t,[this].concat(i.call(arguments,1)))},_startMove:function(n,a){var i,s,o,r,c,h=this,u=this.options,m=u.eventNamespace,l=t(document).off(m),g=this.getMatrix(),f=g.slice(0),p=+f[4],d=+f[5];this.transition(!0),this.panning=!0,this._trigger("start",n,a),1===arguments.length?(s=n,o=this._getDistance(s),r=+g[0],c=this._getMiddle(s),i=function(t){t.preventDefault(),s=t.touches;var e=h._getMiddle(s);g[4]=p+e.pageX-c.pageX,g[5]=d+e.pageY-c.pageY,h.setMatrix(g),h._trigger("pan",g[4],g[5]);var n=h._getDistance(s)-o;h.zoom(n/300+r,{middle:e})}):i=function(t){t.preventDefault(),g[4]=p+t.pageX-n,g[5]=d+t.pageY-a,h.setMatrix(g),h._trigger("pan",g[4],g[5])},l.on((e?"touchend":"mouseup")+m,function(e){e.preventDefault(),t(this).off(m),h.panning=!1,h._trigger("end",!!t(f).not(g).length)}).on((e?"touchmove":"mousemove")+m,i)}},t.fn.panzoom=function(e){var n,s,o,r;return"string"==typeof e?(r=[],s=i.call(arguments,1),this.each(function(){n=t.data(this,a),n?"_"!==e.charAt(0)&&"function"==typeof(o=n[e])&&void 0!==(o=o.apply(n,s))&&r.push(o):r.push(void 0)}),r.length?1===r.length?r[0]:r:this):this.each(function(){new u(this,e)})},u});