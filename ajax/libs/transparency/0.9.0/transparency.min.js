/*! transparency - v0.8.2 - 2013-02-17
* https://github.com/leonidas/transparency
* Copyright (c) 2013 Jarno Keskikangas <jarno.keskikangas@leonidasoy.fi>; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},C={}.hasOwnProperty,k=[].slice;s=this.Transparency={},s.render=function(t,n,r,i){var s,o;n==null&&(n=[]),r==null&&(r={}),i==null&&(i={}),s=i.debug&&console?f:E,s("Transparency.render:",t,n,r,i);if(!t)return;return v(n)||(n=[n]),t=(o=l(t)).context||(o.context=new e(t)),t.detach().render(n,r,i).attach()},s.jQueryPlugin=function(e,t,n){var r,i,o;for(i=0,o=this.length;i<o;i++)r=this[i],s.render(r,e,t,n);return this},s.matcher=function(e,t){return e.el.id===t||N.call(e.classNames,t)>=0||e.el.name===t||e.el.getAttribute("data-bind")===t},s.clone=function(e){var t;return typeof (t=jQuery||Zepto)=="function"?t(e).clone()[0]:void 0},u=function(e){return function(){return e.apply(this,arguments),this}},e=function(){function e(e){this.el=e,this.template=a(this.el),this.instances=[new r(this.el)],this.instanceCache=[]}return e.prototype.detach=u(function(){this.parent=this.el.parentNode;if(this.parent)return this.nextSibling=this.el.nextSibling,this.parent.removeChild(this.el)}),e.prototype.attach=u(function(){if(this.parent)return this.nextSibling?this.parent.insertBefore(this.el,this.nextSibling):this.parent.appendChild(this.el)}),e.prototype.render=u(function(e,t,n){var i,s,o,u,f,l;while(e.length<this.instances.length)this.instanceCache.push(this.instances.pop().remove());l=[];for(i=u=0,f=e.length;u<f;i=++u)o=e[i],(s=this.instances[i])||(s=this.instanceCache.pop()||new r(a(this.template)),this.instances.push(s.appendTo(this.el))),l.push(s.render(o,i,t,n));return l}),e}(),r=function(){function e(e){this.queryCache={},this.childNodes=h(e),this.elements=p(e)}return e.prototype.remove=u(function(){var e,t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.parentNode.removeChild(e));return i}),e.prototype.appendTo=u(function(e){var t,n,r,i,s;i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(e.appendChild(t));return s}),e.prototype.render=u(function(e,t,n,r){var i;return i=[],this.reset(e).renderValues(e,i).renderDirectives(e,t,n).renderChildren(e,i,n,r)}),e.prototype.reset=u(function(e){var t,n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.reset(),s.push(l(t.el).model=e);return s}),e.prototype.renderValues=u(function(e,t){var n,r,i,s;if(y(e)&&(n=this.elements[0]))return n.empty().el.appendChild(e);if(typeof e=="object"){s=[];for(r in e){if(!C.call(e,r))continue;i=e[r],i!=null&&(b(i)?s.push(function(){var e,t,s,o;s=this.matchingElements(r),o=[];for(e=0,t=s.length;e<t;e++)n=s[e],n.nodeName==="input"?o.push(n.attr("value",i)):n.nodeName==="select"?o.push(n.attr("selected",i)):o.push(n.attr("text",i));return o}.call(this)):typeof i=="object"?s.push(t.push(r)):s.push(void 0))}return s}}),e.prototype.renderDirectives=u(function(e,t,n){var r,i,s,o,u,a,f;if(!n)return this;e=typeof e=="object"?e:{value:e},f=[];for(u in n){if(!C.call(n,u))continue;i=n[u],typeof i=="object"&&f.push(function(){var n,f,l,c;l=this.matchingElements(u),c=[];for(n=0,f=l.length;n<f;n++)o=l[n],c.push(function(){var n;n=[];for(r in i){s=i[r];if(typeof s!="function")continue;a=s.call(e,{element:o.el,index:t,value:o.originalAttributes[r]}),a!=null?n.push(o.attr(r,a)):n.push(void 0)}return n}());return c}.call(this))}return f}),e.prototype.renderChildren=u(function(e,t,n,r){var i,o,u,a,f;f=[];for(u=0,a=t.length;u<a;u++)o=t[u],f.push(function(){var t,u,a,f;a=this.matchingElements(o),f=[];for(t=0,u=a.length;t<u;t++)i=a[t],f.push(s.render(i.el,e[o],n[o],r));return f}.call(this));return f}),e.prototype.matchingElements=function(e){var t,n,r;return n=(r=this.queryCache)[e]||(r[e]=function(){var n,r,i,o;i=this.elements,o=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.matcher(t,e)&&o.push(t);return o}.call(this)),w("Matching elements for '"+e+"':",n),n},e}(),h=function(e){var t,n;n=[],t=e.firstChild;while(t)n.push(t),t=t.nextSibling;return n},p=function(e){var t;return t=[],x(e,t),t},x=function(e,r){var i,s;i=e.firstChild,s=[];while(i)i.nodeType===t&&(r.push(new n(i)),x(i,r)),s.push(i=i.nextSibling);return s},n=function(){function e(e){var t;this.el=e,this.childNodes=h(this.el),this.nodeName=this.el.nodeName.toLowerCase(),this.classNames=this.el.className.split(" "),this.isVoidElement=(t=this.nodeName,N.call(o,t)>=0),this.originalAttributes={}}return e.prototype.empty=function(){var e;while(e=this.el.firstChild)this.el.removeChild(e);return this},e.prototype.reset=function(){var e,t,n,r;n=this.originalAttributes,r=[];for(e in n)t=n[e],r.push(this.attr(e,t));return r},e.prototype.setHtml=function(e){var t,n,r,i,s;this.empty(),this.el.innerHTML=e,i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.el.appendChild(t));return s},e.prototype.setText=function(e){var t;return t=this.el.firstChild,t?t.nodeType!==i?this.el.insertBefore(this.el.ownerDocument.createTextNode(e),t):t.nodeValue=e:this.el.appendChild(this.el.ownerDocument.createTextNode(e))},e.prototype.getText=function(){var e;return function(){var t,n,r,s;r=this.childNodes,s=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.nodeType===i&&s.push(e.nodeValue);return s}.call(this).join("")},e.prototype.setSelected=function(e){var t,n,r,i,s;e=String(e),n=p(this.el),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],t.nodeName==="option"?t.el.value===e?s.push(t.el.selected=!0):s.push(t.el.selected=!1):s.push(void 0);return s},e.prototype.attr=function(e,t){var n,r,i,s,o,u,a,f,l,c;if(this.nodeName==="select"&&e==="selected")return this.setSelected(t);switch(e){case"text":if(!this.isVoidElement)return(u=(n=this.originalAttributes)["text"])==null&&(n.text=this.getText()),this.setText(t);break;case"html":return(a=(r=this.originalAttributes)["html"])==null&&(r.html=this.el.innerHTML),this.setHtml(t);case"class":return(f=(i=this.originalAttributes)["class"])==null&&(i["class"]=this.el.className),this.el.className=t;default:return this.el[e]=t,m(t)?((l=(s=this.originalAttributes)[e])==null&&(s[e]=this.el.getAttribute(e)||!1),t?this.el.setAttribute(e,e):this.el.removeAttribute(e)):((c=(o=this.originalAttributes)[e])==null&&(o[e]=this.el.getAttribute(e)||""),this.el.setAttribute(e,t.toString()))}},e}(),t=1,i=3,o=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],d=function(){return document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>"},a=typeof document=="undefined"||document===null||d()?function(e){return e.cloneNode(!0)}:function(e){var n,r,i,o,u;n=s.clone(e);if(n.nodeType===t){n.removeAttribute(c),u=n.getElementsByTagName("*");for(i=0,o=u.length;i<o;i++)r=u[i],r.removeAttribute(c)}return n},c="transparency",l=function(e){return e[c]||(e[c]={})},E=function(){},f=function(){var e;return e=1<=arguments.length?k.call(arguments,0):[],console.log.apply(console,e)},w=E,S=Object.prototype.toString,g=function(e){return S.call(e)==="[object Date]"},y=function(e){return e.nodeType===t},b=function(e){var t;return t=typeof e,t!=="object"&&t!=="function"||g(e)},m=function(e){return e===!0||e===!1},v=Array.isArray||function(e){return S.call(e)==="[object Array]"},(T=jQuery||Zepto)!=null&&(T.fn.render=s.jQueryPlugin),(typeof define!="undefined"&&define!==null?define.amd:void 0)&&define(function(){return s})}).call(this);