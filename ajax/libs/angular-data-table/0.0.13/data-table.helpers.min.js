"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):e.DataTable=t(angular)}(void 0,function(e){function t(e){return{restrict:"E",controller:"BodyController",controllerAs:"body",scope:{columns:"=",columnWidths:"=",rows:"=",options:"=",selected:"=?",expanded:"=?",onPage:"&",onTreeToggle:"&"},template:'\n        <div class="dt-body" ng-style="body.styles()">\n          <div class="dt-body-scroller" ng-style="body.scrollerStyles()">\n            <dt-group-row ng-repeat-start="r in body.tempRows track by $index"\n                          ng-if="r.group"\n                          ng-style="body.groupRowStyles(this, r)" \n                          on-group-toggle="body.onGroupToggle(this, group)"\n                          expanded="body.getRowExpanded(this, r)"\n                          tabindex="{{$index}}"\n                          row="r">\n            </dt-group-row>\n            <dt-row ng-repeat-end\n                    ng-if="!r.group"\n                    row="body.getRowValue($index)"\n                    tabindex="{{$index}}"\n                    columns="columns"\n                    column-widths="columnWidths"\n                    ng-keydown="body.keyDown($event, $index, r)"\n                    ng-click="body.rowClicked($event, $index, r)"\n                    on-tree-toggle="body.onTreeToggle(this, row, cell)"\n                    ng-class="body.rowClasses(this, r)"\n                    options="options"\n                    selected="body.isSelected(r)"\n                    on-checkbox-change="body.onCheckboxChange($index, row)"\n                    columns="body.columnsByPin"\n                    has-children="body.getRowHasChildren(r)"\n                    expanded="body.getRowExpanded(this, r)"\n                    ng-style="body.rowStyles(this, r)">\n            </dt-row>\n          </div>\n          <div ng-if="rows && !rows.length" \n               class="empty-row" \n               ng-bind="::options.emptyMessage">\n         </div>\n         <div ng-if="rows === undefined" \n               class="loading-row"\n               ng-bind="::options.loadingMessage">\n         </div>\n        </div>',replace:!0,link:function(t,n,o,r){function i(){e(function(){t.options.internal.offsetY=a,t.options.internal.offsetX=c,r.updatePage()}),s=!1}function l(){s||($(i),s=!0)}{var s=!1,a=0,c=0;k.create(n)}n.on("scroll",function(e){a=this.scrollTop,c=this.scrollLeft,l()})}}}function n(e){var t=0,n=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;t+=s.flexGrow||0}}catch(a){o=!0,r=a}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw r}}return t}function o(e){var t=0,n=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;t+=s.width}}catch(a){o=!0,r=a}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw r}}return t}function r(e,t){if(0>=t)return{columns:e,width:o(e)};for(var r=n(e),i=t,l=0,s=0,a=e.length;a>s;s++){var c=e[s];if(!c.flexGrow)return void(l+=c.width);var u=Math.floor(c.flexGrow/r*i),h=Math.floor(c.width+u);c.minWidth&&h<c.minWidth&&(h=c.minWidth),c.maxWidth&&h>c.maxWidth&&(h=c.maxWidth),l+=h,r-=c.flexGrow,i-=u,c.width=h}return{width:l}}function i(e){for(var t={left:[],center:[],right:[]},n=0,o=e.length;o>n;n++){var r=e[n];r.frozenLeft?t.left.push(r):r.frozenRight?t.right.push(r):t.center.push(r)}return t}function l(t,l){var s=o(t),a=n(t),c=Math.max(l-s,0),u=i(t);e.forEach(u,function(e){{var t=n(e),o=Math.floor(t/a*c);r(e,o)}a-=t,c-=o})}function s(e,t){return{left:o(e.left),center:o(e.center),right:o(e.right),total:o(t)}}function a(e,t){var n=i(e),r=s(n,e),l=t-(r.left+r.right),a=!0,c=!1,u=void 0;try{for(var h,d=n.center[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){var p=h.value;p.$$oldWidth&&(p.width=p.$$oldWidth)}}catch(g){c=!0,u=g}finally{try{!a&&d["return"]&&d["return"]()}finally{if(c)throw u}}for(var f=o(n.center),m=l-f,v=Math.floor(m/n.center.length),w=f>r.center,y=0,C=e.length;C>y;y++){var b=e[y];if(!b.frozenLeft&&!b.frozenRight){b.$$oldWidth||(b.$$oldWidth=b.width);var x=b.width+v;b.width=w?b.$$oldWidth:x}}}function c(){var e=((new Date).getTime()/1e3|0).toString(16);return e+"xxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)}).toLowerCase()}function u(){return{restrict:"E",controller:"PagerController",controllerAs:"pager",scope:{page:"=",size:"=",count:"=",onPage:"&"},template:'<div class="dt-pager">\n          <ul class="pager">\n            <li ng-class="{ disabled: !pager.canPrevious(this) }">\n              <a href ng-click="pager.selectPage(this, 1)" class="icon-left"></a>\n            </li>\n            <li ng-repeat="pg in pager.pages track by $index" ng-class="{ active: pg.active }">\n              <a href ng-click="pager.selectPage(this, pg.number)">{{pg.text}}</a>\n            </li>\n            <li ng-class="{ disabled: !pager.canNext(this) }">\n              <a href ng-click="pager.selectPage(this, pager.totalPages)" class="icon-right"></a>\n            </li>\n          </ul>\n        </div>',replace:!0}}function h(){return{restrict:"E",controller:"FooterController",controllerAs:"footer",scope:{paging:"=",onPage:"&"},template:'<div class="dt-footer">\n          <div class="page-count">{{paging.count}} total</div>\n          <dt-pager page="page"\n                 size="paging.size"\n                 count="paging.count"\n                 on-page="footer.onPage(this, page)"\n                 ng-show="paging.count > 1">\n           </dt-pager>\n        </div>',replace:!0}}function d(t,n,o){return{restrict:"E",controller:"CellController",controllerAs:"cell",scope:{options:"=",value:"=",selected:"=",column:"=",row:"=",expanded:"=",hasChildren:"=",onTreeToggle:"&",onCheckboxChange:"&"},template:'<div class="dt-cell" \n              data-title="{{::column.name}}" \n              ng-style="cell.styles(column)"\n              ng-class="cell.cellClass(column)">\n          <label ng-if="column.isCheckboxColumn" class="dt-checkbox">\n            <input type="checkbox" \n                   ng-checked="selected"\n                   ng-click="cell.onCheckboxChange(this)" />\n          </label>\n          <span ng-if="column.isTreeColumn && hasChildren"\n                ng-class="cell.treeClass(this)"\n                ng-click="cell.onTreeToggle($event, this)"></span>\n          <span class="dt-cell-content"></span>\n        </div>',replace:!0,compile:function(){return{pre:function(t,o,r,i){var l=e.element(o[0].querySelector(".dt-cell-content"));t.$outer=t.options.$outer,t.$watch("value",function(){if(l.empty(),t.column.template){var o=e.element("<span>"+t.column.template.trim()+"</span>");l.append(n(o)(t))}else if(t.column.cellRenderer){var o=e.element(t.column.cellRenderer(t,l));l.append(n(o)(t))}else l[0].innerHTML=i.getValue(t)})}}}}}function p(){return{restrict:"E",controller:"GroupRowController",controllerAs:"group",scope:{row:"=",onGroupToggle:"&",expanded:"="},replace:!0,template:'\n        <div class="dt-group-row">\n          <span ng-class="group.treeClass(this)"\n                ng-click="group.onGroupToggle($event, this)">\n          </span>\n          <span class="dt-group-row-label">\n            {{row.name}}\n          </span>\n        </div>'}}function g(){return{restrict:"E",controller:"RowController",controllerAs:"rowCtrl",scope:{row:"=",columns:"=",columnWidths:"=",expanded:"=",selected:"=",hasChildren:"=",options:"=",onCheckboxChange:"&",onTreeToggle:"&"},template:'\n        <div class="dt-row">\n          <div class="dt-row-left dt-row-block" \n               ng-if="columns[\'left\'].length"\n               ng-style="rowCtrl.stylesByGroup(this, \'left\')">\n            <dt-cell ng-repeat="column in columns[\'left\'] track by column.$id"\n                     on-tree-toggle="rowCtrl.onTreeToggle(this, cell)"\n                     column="column"\n                     options="options"\n                     has-children="hasChildren"\n                     on-checkbox-change="rowCtrl.onCheckboxChange(this)"\n                     selected="selected"\n                     expanded="expanded"\n                     row="row"\n                     value="rowCtrl.getValue(this, column)">\n            </dt-cell>\n          </div>\n          <div class="dt-row-center dt-row-block" \n               ng-style="rowCtrl.stylesByGroup(this, \'center\')">\n            <dt-cell ng-repeat="column in columns[\'center\'] track by column.$id"\n                     on-tree-toggle="rowCtrl.onTreeToggle(this, cell)"\n                     column="column"\n                     options="options"\n                     has-children="hasChildren"\n                     expanded="expanded"\n                     selected="selected"\n                     row="row"\n                     on-checkbox-change="rowCtrl.onCheckboxChange(this)"\n                     value="rowCtrl.getValue(this, column)">\n            </dt-cell>\n          </div>\n          <div class="dt-row-right dt-row-block" \n               ng-if="columns[\'right\'].length"\n               ng-style="rowCtrl.stylesByGroup(this, \'right\')">\n            <dt-cell ng-repeat="column in columns[\'right\'] track by column.$id"\n                     on-tree-toggle="rowCtrl.onTreeToggle(this, cell)"\n                     column="column"\n                     options="options"\n                     has-children="hasChildren"\n                     selected="selected"\n                     on-checkbox-change="rowCtrl.onCheckboxChange(this)"\n                     row="row"\n                     expanded="expanded"\n                     value="rowCtrl.getValue(this, column)">\n            </dt-cell>\n          </div>\n        </div>',replace:!0}}function f(e,t){if(!e||!t)return e;var n=e,o=t.split(".");if(o.length)for(var r=0,i=o.length;i>r;r++)n=n[o[r]];return n}function m(t){return{restrict:"E",controller:"HeaderCellController",controllerAs:"hcell",scope:{column:"=",onCheckboxChange:"&",onSort:"&",onResize:"&",selected:"="},replace:!0,template:'<div ng-class="hcell.cellClass(this)"\n              ng-style="hcell.styles(this)"\n              title="{{::column.name}}">\n          <div resizable="column.resizable" \n               on-resize="hcell.onResize(this, width, column)"\n               min-width="column.minWidth"\n               max-width="column.maxWidth">\n            <label ng-if="column.isCheckboxColumn && column.headerCheckbox" class="dt-checkbox">\n              <input type="checkbox" \n                     ng-checked="selected"\n                     ng-click="hcell.onCheckboxChange(this)" />\n            </label>\n            <span class="dt-header-cell-label" \n                  ng-click="hcell.sort(this)">\n            </span>\n            <span ng-class="hcell.sortClass(this)"></span>\n          </div>\n        </div>',compile:function(){return{pre:function(n,o,r,i){var l=o[0].querySelector(".dt-header-cell-label");if(n.column.headerRenderer){var s=e.element(n.column.headerRenderer(n,o));e.element(l).append(t(s)(n)[0])}else{var a=n.column.name;(void 0===a||null===a)&&(a=""),l.innerHTML=a}}}}}}function v(t){return{restrict:"E",controller:"HeaderController",controllerAs:"header",scope:{options:"=",columns:"=",columnWidths:"=",onSort:"&",onResize:"&",onCheckboxChange:"&"},template:'\n        <div class="dt-header" ng-style="header.styles(this)">\n          <div class="dt-header-inner" ng-style="header.innerStyles(this)">\n            <div class="dt-row-left"\n                 ng-style="header.stylesByGroup(this, \'left\')"\n                 ng-if="columns[\'left\'].length"\n                 sortable="options.reorderable"\n                 on-sortable-sort="columnsResorted(event, childScope)">\n              <dt-header-cell ng-repeat="column in columns[\'left\'] track by column.$id" \n                              on-checkbox-change="header.onCheckboxChange(this)"\n                              on-sort="header.onSort(this, column)"\n                              on-resize="header.onResize(this, column, width)"\n                              selected="header.isSelected(this)"\n                              column="column">\n              </dt-header-cell>\n            </div>\n            <div class="dt-row-center" \n                 sortable="options.reorderable"\n                 ng-style="header.stylesByGroup(this, \'center\')"\n                 on-sortable-sort="columnsResorted(event, childScope)">\n              <dt-header-cell ng-repeat="column in columns[\'center\'] track by column.$id" \n                              on-checkbox-change="header.onCheckboxChange(this)"\n                              on-sort="header.onSort(this, column)"\n                              selected="header.isSelected(this)"\n                              on-resize="header.onResize(this, column, width)"\n                              column="column">\n              </dt-header-cell>\n            </div>\n            <div class="dt-row-right"\n                 ng-if="columns[\'right\'].length"\n                 sortable="options.reorderable"\n                 ng-style="header.stylesByGroup(this, \'right\')"\n                 on-sortable-sort="columnsResorted(event, childScope)">\n              <dt-header-cell ng-repeat="column in columns[\'right\'] track by column.$id" \n                              on-checkbox-change="header.onCheckboxChange(this)"\n                              on-sort="header.onSort(this, column)"\n                              selected="header.isSelected(this)"\n                              on-resize="header.onResize(this, column, width)"\n                              column="column">\n              </dt-header-cell>\n            </div>\n          </div>\n        </div>',replace:!0,link:function(n,o,r,i){n.columnsResorted=function(o,r){var i=r.column,l=e.element(o.currentTarget),s=-1;e.forEach(l.children(),function(t,n){r===e.element(t).scope()&&(s=n)}),t(function(){e.forEach(n.columns,function(e){var t=e.indexOf(i);t>-1&&(e.splice(t,1),e.splice(s,0,i))})})}}}}function w(e,t,n){var o,r,i,l=null,s=0;n||(n={});var a=function(){s=n.leading===!1?0:new Date,l=null,i=e.apply(o,r)};return function(){var c=new Date;s||n.leading!==!1||(s=c);var u=t-(c-s);return o=this,r=arguments,0>=u?(clearTimeout(l),l=null,s=c,i=e.apply(o,r)):l||n.trailing===!1||(l=setTimeout(a,u)),i}}function y(e,t,n){var o,r,i,l,s;return function(){i=this,r=arguments,l=new Date;var a=function u(){var a=new Date-l;t>a?o=setTimeout(u,t-a):(o=null,n||(s=e.apply(i,r)))},c=n&&!o;return o||(o=setTimeout(a,t)),c&&(s=e.apply(i,r)),s}}function C(t){return{restrict:"AC",scope:{isSortable:"=sortable",onSortableSort:"&"},link:function(n,o,r){function i(e,t){if(e.parentNode==t.parentNode)for(var n=e;n;n=n.previousSibling)if(n===t)return!0;return!1}function l(e){var t=e.target;i(c,t)?t.parentNode.insertBefore(c,t):t.nextSibling&&t.hasAttribute("draggable")&&t.parentNode.insertBefore(c,t.nextSibling)}function s(t){t.preventDefault(),c.classList.remove("dt-clone"),o.off("dragend",s),o.off("dragenter",l),u!==c.nextSibling&&n.onSortableSort({event:t,childScope:e.element(c).scope()})}function a(e){return n.isSortable?(e=e.originalEvent||e,c=e.target,u=c.nextSibling,c.classList.add("dt-clone"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",c.textContent),o.on("dragenter",l),void o.on("dragend",s)):!1}var c,u,h=o[0];t(function(){e.forEach(h.children,function(e){e.draggable=!0})}),o.on("dragstart",a),n.$on("$destroy",function(){o.off("dragstart",a)})}}}function b(t,n,o){return{restrict:"AEC",scope:{isResizable:"=resizable",minWidth:"=",maxWidth:"=",onResize:"&"},link:function(n,r,i){function l(e){e=e.originalEvent||e;var t=c[0].scrollWidth,o=t+(e.movementX||0);(!n.minWidth||o>=n.minWidth)&&(!n.maxWidth||o<=n.maxWidth)&&c.css({width:o+"px"})}function s(){n.onResize&&o(function(){n.onResize({width:c[0].scrollWidth})}),t.unbind("mousemove",l),t.unbind("mouseup",s)}n.isResizable&&r.addClass("resizable");var a=e.element('<span class="dt-resize-handle" title="Resize"></span>'),c=r.parent();a.on("mousedown",function(e){return r[0].classList.contains("resizable")?(e.stopPropagation(),e.preventDefault(),t.on("mousemove",l),void t.on("mouseup",s)):!1}),r.append(a)}}}function x(t,n,o){return{restrict:"E",replace:!0,transclude:"element",controller:"DataTable",scope:{options:"=",rows:"=",selected:"=?",expanded:"=?",onSelect:"&",onSort:"&",onTreeToggle:"&",onPage:"&"},controllerAs:"dt",template:'<div class="dt" ng-class="dt.tableCss(this)">\n            <dt-header options="options"\n                       on-checkbox-change="dt.onHeaderCheckboxChange(this)"\n                       columns="dt.columnsByPin"\n                       column-widths="dt.columnWidths"\n                       ng-if="options.headerHeight"\n                       on-resize="dt.onResize(this, column, width)"\n                       selected="dt.isAllRowsSelected(this)"\n                       on-sort="dt.onSort(this)">\n            </dt-header>\n            <dt-body rows="rows"\n                     selected="selected"\n                     expanded="expanded"\n                     columns="dt.columnsByPin"\n                     column-widths="dt.columnWidths"\n                     options="options"\n                     on-page="dt.onBodyPage(this, offset, size)"\n                     on-tree-toggle="dt.onTreeToggle(this, row, cell)">\n             </dt-body>\n            <dt-footer ng-if="options.footerHeight"\n                       ng-style="{ height: options.footerHeight + \'px\' }"\n                       on-page="dt.onFooterPage(this, offset, size)"\n                       paging="options.paging">\n             </dt-footer>\n          </div>',compile:function(r,i){return{pre:function(r,i,l,s){function a(){if(r.options.internal.innerWidth=i[0].offsetWidth,r.options.scrollbarV){var e=i[0].offsetHeight;r.options.headerHeight&&(e-=r.options.headerHeight),r.options.footerHeight&&(e-=r.options.footerHeight),r.options.internal.bodyHeight=e}s.adjustColumns(),s.calculatePageSize()}i.addClass("dt-loaded"),n(a),e.element(t).bind("resize",o(function(){n(a)}))}}}}}!function(){function e(e){Array.prototype[e]||(Array.prototype[e]=function(t){var n,o,r,i=arguments[1];if("function"!=typeof t)throw new TypeError;for(r=i?function(){return t.apply(i,arguments)}:t,n=0,o=this.length;o>n;n++)if(r(this[n],n,this)===!0)return"find"===e?this[n]:n;return"find"!==e?-1:void 0})}for(var t in{find:1,findIndex:1})e(t)}();var k=function(){var e;return{create:function(t){e=t},setYOffset:function(t){e[0].scrollTop=t}}}(),$=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();t.$inject=["$timeout"];var R=function(e){return e=e.replace(/[^a-zA-Z0-9 ]/g," "),e=e.replace(/([a-z](?=[A-Z]))/g,"$1 "),e=e.replace(/([^a-zA-Z0-9 ])|^[0-9]+/g,"").trim().toLowerCase(),e=e.replace(/([ 0-9]+)([a-zA-Z])/g,function(e,t,n){return t.trim()+n.toUpperCase()})},T=Object.freeze({frozenLeft:!1,frozenRight:!1,className:void 0,heaerClassName:void 0,flexGrow:0,minWidth:void 0,maxWidth:void 0,width:150,resizable:!0,comparator:void 0,sortable:!0,sort:void 0,headerRenderer:void 0,cellRenderer:void 0,cellDataGetter:void 0,isTreeColumn:!1,isCheckboxColumn:!1,headerCheckbox:!1}),S=Object.freeze({scrollbarV:!0,rowHeight:30,forceFillColumns:!1,loadingMessage:"Loading...",emptyMessage:"No data to display",headerHeight:30,footerHeight:0,paging:{externalPaging:!1,size:void 0,count:0,offset:0},selectable:!1,multiSelect:!1,checkboxSelection:!1,reorderable:!0,internal:{offsetX:0,offsetY:0,innerWidth:0,bodyHeight:300}}),z=function(){function t(n,o,r,i){var l=this;_classCallCheck(this,t),e.extend(this,{$scope:n,$filter:o,$log:r}),n.options.$outer=n.$parent,this.defaults(n),n.$watch("options.columns",function(e,t){e.length>t.length&&l.transposeColumnDefaults(e),l.calculateColumns(e)},!0),i(function(e,t){var o=e[0].getElementsByTagName("column");l.buildColumns(n,o),l.transposeColumnDefaults(n.options.columns)})}return t.$inject=["$scope","$filter","$log","$transclude"],_createClass(t,[{key:"buildColumns",value:function(t,n){if(n&&n.length){var o=[];e.forEach(n,function(t){var n={};e.forEach(t.attributes,function(e){var t=R(e.name);if(T.hasOwnProperty(t)){var o=e.value;isNaN(e.value)||(o=parseInt(e.value)),n[t]=o}"class"===t&&(n.className=e.value),"name"===t&&(n.name=e.value)}),""!==t.innerHTML&&(n.template=t.innerHTML),o.push(n)}),t.options.columns=o}}},{key:"defaults",value:function(t){var n=this;t.expanded=t.expanded||{};var o=e.extend(e.copy(S),t.options);o.paging=e.extend(e.copy(S.paging),t.options.paging),t.options=o,t.options.selectable&&t.options.multiSelect&&(t.selected=t.selected||[]);var r=t.$watch("rows",function(e){e&&(r(),n.onSort(t))})}},{key:"transposeColumnDefaults",value:function(t){for(var n=0,o=t.length;o>n;n++){var r=t[n];r=e.extend(e.copy(T),r),r.$id=c(),r.name&&!r.prop&&(r.prop=R(r.name)),t[n]=r}}},{key:"calculateColumns",value:function(e){this.columnsByPin=i(e),this.columnWidths=s(this.columnsByPin,e)}},{key:"tableCss",value:function(e){return{fixed:e.options.scrollbarV,selectable:e.options.selectable,checkboxable:e.options.checkboxSelection}}},{key:"adjustColumns",value:function(){this.$scope.options.forceFillColumns?a(this.$scope.options.columns,this.$scope.options.internal.innerWidth):l(this.$scope.options.columns,this.$scope.options.internal.innerWidth)}},{key:"calculatePageSize",value:function(){this.$scope.options.paging.size=Math.ceil(this.$scope.options.internal.bodyHeight/this.$scope.options.rowHeight)+1}},{key:"onSort",value:function(e){if(e.rows){var t=e.options.columns.filter(function(e){return e.sort});if(t.length){this.$scope.onSort&&this.$scope.onSort({sorts:t});for(var n=[],o=0,r=t.length;r>o;o++){var i=t[o];if(i.comparator!==!1){var l="asc"===i.sort?"":"-";n.push(l+i.prop)}}if(n.length){var s,a=this.$filter("orderBy")(e.rows,n);e.rows.splice(0,e.rows.length),(s=e.rows).push.apply(s,_toConsumableArray(a))}}k.setYOffset(0)}}},{key:"onTreeToggle",value:function(e,t,n){e.onTreeToggle({row:t,cell:n})}},{key:"onBodyPage",value:function(e,t,n){e.onPage({offset:t,size:n})}},{key:"onFooterPage",value:function(e,t,n){var o=e.options.rowHeight*n,r=o*t;k.setYOffset(r)}},{key:"onHeaderCheckboxChange",value:function(e){if(e.rows){var t=e.selected.length===e.rows.length;if(e.selected.splice(0,e.selected.length),!t){var n;(n=e.selected).push.apply(n,_toConsumableArray(e.rows))}}}},{key:"isAllRowsSelected",value:function(e){return e.rows?e.selected.length===e.rows.length:!1}},{key:"onResize",value:function(e,t,n){var o=e.options.columns.indexOf(t);o>-1&&(e.options.columns[o].width=n,this.calculateColumns(e.options.columns))}}]),t}(),P=function(){function t(n){var o=this;_classCallCheck(this,t),e.extend(this,{size:n.size,count:n.count}),this.totalPages=this.calcTotalPages(),n.$watch("page",function(e){0!==e&&e<=o.totalPages&&o.getPages(e)})}return t.$inject=["$scope"],_createClass(t,[{key:"calcTotalPages",value:function(){var e=this.size<1?1:Math.ceil(this.count/this.size);return Math.max(e||0,1)}},{key:"selectPage",value:function(e,t){t>0&&t<=this.totalPages&&(e.page=t,e.onPage({page:t}))}},{key:"canPrevious",value:function(e){return 1!==e.page}},{key:"canNext",value:function(e){return e.page<=this.totalPages}},{key:"getPages",value:function(e){var t=[],n=1,o=this.totalPages,r=5,i=r<this.totalPages;i&&(n=(Math.ceil(e/r)-1)*r+1,o=Math.min(n+r-1,this.totalPages));for(var l=n;o>=l;l++)t.push({number:l,text:l,active:l===e});i&&(n>1&&t.unshift({number:n-1,text:"..."}),o<this.totalPages&&t.push({number:o+1,text:"..."})),this.pages=t}}]),t}(),W=function(){function e(t){var n=this;_classCallCheck(this,e),t.page=t.paging.offset+1,t.$watch("paging.offset",function(e){n.offsetChanged(t,e)})}return e.$inject=["$scope"],_createClass(e,[{key:"offsetChanged",value:function(e,t){e.page=t+1}},{key:"onPage",value:function(e,t){e.paging.offset=t-1,e.onPage({offset:e.paging.offset,size:e.paging.size})}}]),e}();d.$inject=["$rootScope","$compile","$log"];var A=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"styles",value:function(e){return{width:e.width+"px"}}},{key:"cellClass",value:function(e){var t={"dt-tree-col":e.isTreeColumn};return e.className&&(t[e.className]=!0),t}},{key:"treeClass",value:function(e){return{"dt-tree-toggle":!0,"icon-right":!e.expanded,"icon-down":e.expanded}}},{key:"onTreeToggle",value:function(e,t){e.stopPropagation(),t.expanded=!t.expanded,t.onTreeToggle({cell:{value:t.value,column:t.column,expanded:t.expanded}})}},{key:"onCheckboxChange",value:function(e){e.onCheckboxChange()}},{key:"getValue",value:function(e){var t=e.column.cellDataGetter?e.column.cellDataGetter(e.value):e.value;return(void 0===t||null===t)&&(t=""),t}}]),e}(),E=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"onGroupToggle",value:function(e,t){e.stopPropagation(),t.onGroupToggle({group:t.row})}},{key:"treeClass",value:function(e){return{"dt-tree-toggle":!0,"icon-right":!e.expanded,"icon-down":e.expanded}}}]),e}(),G=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getValue",value:function(e,t){return f(e.row,t.prop)}},{key:"onTreeToggle",value:function(e,t){e.onTreeToggle({cell:t,row:e.value})}},{key:"stylesByGroup",value:function(e,t){var n={width:e.columnWidths[t]+"px"};if("left"===t)n.transform="translate3d("+e.options.internal.offsetX+"px, 0, 0)";else if("right"===t){var o=e.columnWidths.total-e.options.internal.innerWidth-e.options.internal.offsetX;n.transform="translate3d(-"+o+"px, 0, 0)"}return n}},{key:"onCheckboxChange",value:function(e){e.onCheckboxChange({row:e.value})}}]),e}(),H={BACKSPACE:8,TAB:9,RETURN:13,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188,PERIOD:190,A:65,Z:90,ZERO:48,NUMPAD_0:96,NUMPAD_9:105},B=function(){function t(n,o,r){var i=this;_classCallCheck(this,t),e.extend(this,{$scope:n,options:n.options,selected:n.selected}),this.tempRows=[],this._viewportRowsStart=0,this._viewportRowsEnd=0,this.treeColumn=n.options.columns.find(function(e){return e.isTreeColumn}),this.groupColumn=n.options.columns.find(function(e){return e.group}),this.options.scrollbarV&&n.$watch("options.internal.offsetY",r(this.getRows.bind(this),10)),n.$watchCollection("rows",function(e,t){if(e)if(i.options.paging.externalPaging||(i.options.paging.count=e.length),i.count=i.options.paging.count,(i.treeColumn||i.groupColumn)&&i.buildRowsByGroup(),i.options.scrollbarV)i.getRows();else{var o,r=n.rows;i.treeColumn?r=i.buildTree():i.groupColumn&&(r=i.buildGroups()),i.tempRows.splice(0,i.tempRows.length),(o=i.tempRows).push.apply(o,_toConsumableArray(r))}}),this.options.scrollbarV&&(n.$watch("options.internal.offsetY",this.updatePage.bind(this)),n.$watch("options.paging.offset",function(e){n.onPage({offset:e,size:i.options.paging.size})}))}return t.$inject=["$scope","$timeout","throttle"],_createClass(t,[{key:"getFirstLastIndexes",value:function(){var e=Math.max(Math.floor((this.$scope.options.internal.offsetY||0)/this.options.rowHeight,0),0),t=Math.min(e+this.options.paging.size,this.count);return{first:e,last:t}}},{key:"updatePage",value:function(){var e=this.getFirstLastIndexes(),t=Math.ceil(e.first/this.options.paging.size);this.options.paging.offset=t}},{key:"buildRowsByGroup",value:function(){this.index={},this.rowsByGroup={};for(var e=this.treeColumn?this.treeColumn.relationProp:this.groupColumn.prop,t=0,n=this.$scope.rows.length;n>t;t++){var o=this.$scope.rows[t],r=o[e];if(r&&(this.rowsByGroup[r]?this.rowsByGroup[r].push(o):this.rowsByGroup[r]=[o]),this.treeColumn){var i=this.treeColumn.prop;if(this.index[o[i]]=o,void 0===o[e])o.$$depth=0;else{var l=this.index[o[e]];o.$$depth=l.$$depth+1,l.$$children?l.$$children.push(o[i]):l.$$children=[o[i]]}}}}},{key:"buildGroups",value:function(){var t=this,n=[];return e.forEach(this.rowsByGroup,function(e,o){n.push({name:o,group:!0}),t.$scope.expanded[o]&&n.push.apply(n,_toConsumableArray(e))}),n}},{key:"buildTree",value:function(){for(var e=0,t=[],n=0,o=this.$scope.rows.length;o>n;n++){var r=this.$scope.rows[n],i=r[this.treeColumn.relationProp],l=r[this.treeColumn.prop],s=this.rowsByGroup[l],a=this.$scope.expanded[l];i||(e++,t.push(r)),s&&s.length&&a&&(t.push.apply(t,_toConsumableArray(s)),e+=s.length)}return t}},{key:"getRows",value:function(e){if((this.treeColumn||this.groupColumn)&&!this.rowsByGroup)return!1;var t;this.treeColumn?(t=this.treeTemp||[],(e||!this.treeTemp)&&(this.treeTemp=t=this.buildTree(),this.count=t.length,this.tempRows.splice(0,this.tempRows.length))):this.groupColumn?(t=this.groupsTemp||[],(e||!this.groupsTemp)&&(this.groupsTemp=t=this.buildGroups(),this.count=t.length)):t=this.$scope.rows;for(var n=0,o=this.getFirstLastIndexes(),r=o.first;r<o.last||this.options.internal.bodyHeight<this._viewportHeight&&r<this.count;){var i=t[r];i&&(i.$$index=r,this.tempRows[n]=i),n++,this._viewportRowsEnd=r++}}},{key:"styles",value:function n(){var n={width:this.options.internal.innerWidth+"px"};return this.options.scrollbarV?this.options.scrollbarH===!1&&(n.overflowX="hidden"):n.overflowY="hidden",this.options.scrollbarV&&(n.height=this.options.internal.bodyHeight+"px"),n}},{key:"rowStyles",value:function(e,t){var n={height:e.options.rowHeight+"px"};return e.options.scrollbarV&&(n.transform="translate3d(0, "+t.$$index*e.options.rowHeight+"px, 0)"),n}},{key:"groupRowStyles",value:function(e,t){var n=this.rowStyles(e,t);return n.width=e.columnWidths.total+"px",n}},{key:"rowClasses",value:function(e,t){var n={selected:this.isSelected(t)};return this.treeColumn&&(n["dt-leaf"]=this.rowsByGroup[t[this.treeColumn.relationProp]],n["dt-has-leafs"]=this.rowsByGroup[t[this.treeColumn.prop]],n["dt-depth-"+t.$$depth]=!0),n}},{key:"isSelected",value:function(e){var t=!1;return this.options.selectable&&(t=this.options.multiSelect?this.selected.indexOf(e)>-1:this.selected===e),t}},{key:"keyDown",value:function(e,t,n){if(e.preventDefault(),e.keyCode===H.DOWN){var o=e.target.nextElementSibling;o&&o.focus()}else if(e.keyCode===H.UP){var r=e.target.previousElementSibling;r&&r.focus()}else e.keyCode===H.RETURN&&this.selectRow(t,n)}},{key:"rowClicked",value:function(e,t,n){this.options.checkboxSelection||(e.preventDefault(),this.selectRow(t,n),this.$scope.onSelect&&this.$scope.onSelect({row:n}))}},{key:"selectRow",value:function(e,t){if(this.options.selectable)if(this.options.multiSelect){var n=(event.ctrlKey||event.metaKey,event.shiftKey);if(n)this.selectRowsBetween(e,t);else{var o=this.selected.indexOf(t);o>-1?this.selected.splice(o,1):this.selected.push(t)}this.prevIndex=e}else this.selected=t}},{key:"selectRowsBetween",value:function(e){for(var t=e<this.prevIndex,n=0,o=this.tempRows.length;o>n;n++){var r=this.tempRows[n],i=n>=this.prevIndex&&e>=n,l=n<=this.prevIndex&&n>=e;if(t&&l||!t&&i){var s=this.selected.indexOf(r);-1===s&&this.selected.push(r)}}}},{key:"scrollerStyles",value:function(){return{height:this.count*this.options.rowHeight+"px"}}},{key:"getRowValue",value:function(e){return this.tempRows[e]}},{key:"getRowExpanded",value:function(e,t){return this.treeColumn?e.expanded[t[this.treeColumn.prop]]:this.groupColumn?e.expanded[t.name]:void 0}},{key:"getRowHasChildren",
value:function(e){if(this.treeColumn){var t=this.rowsByGroup[e[this.treeColumn.prop]];return void 0!==t||t&&!t.length}}},{key:"onTreeToggle",value:function(e,t,n){var o=t[this.treeColumn.prop];if(e.expanded[o]=!e.expanded[o],this.options.scrollbarV)this.getRows(!0);else{var r,i=this.buildTree();this.tempRows.splice(0,this.tempRows.length),(r=this.tempRows).push.apply(r,_toConsumableArray(i))}e.onTreeToggle({row:t,cell:n})}},{key:"onCheckboxChange",value:function(e,t){this.selectRow(e,t)}},{key:"onGroupToggle",value:function(e,t){if(e.expanded[t.name]=!e.expanded[t.name],this.options.scrollbarV)this.getRows(!0);else{var n,o=this.buildGroups();this.tempRows.splice(0,this.tempRows.length),(n=this.tempRows).push.apply(n,_toConsumableArray(o))}}}]),t}();m.$inject=["$compile"];var _=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"styles",value:function(e){return{width:e.column.width+"px",minWidth:e.column.minWidth+"px",maxWidth:e.column.maxWidth+"px",height:e.column.height+"px"}}},{key:"cellClass",value:function(e){var t={sortable:e.column.sortable,"dt-header-cell":!0,resizable:e.column.resizable};return e.column.heaerClassName&&(t[e.column.heaerClassName]=!0),t}},{key:"sort",value:function(e){e.column.sortable&&(e.column.sort?"asc"===e.column.sort?e.column.sort="desc":"desc"===e.column.sort&&(e.column.sort=void 0):e.column.sort="asc",e.onSort({column:e.column}))}},{key:"sortClass",value:function(e){return{"sort-btn":!0,"sort-asc icon-down":"asc"===e.column.sort,"sort-desc icon-up":"desc"===e.column.sort}}},{key:"onResize",value:function(e,t,n){e.onResize({column:n,width:t})}},{key:"onCheckboxChange",value:function(e){e.onCheckboxChange()}}]),e}();v.$inject=["$timeout"];var D=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"styles",value:function(e){return{width:e.options.internal.innerWidth+"px",height:e.options.headerHeight+"px"}}},{key:"innerStyles",value:function(e){return{width:e.columnWidths.total+"px"}}},{key:"onSort",value:function(e,t){e.onSort({column:t})}},{key:"stylesByGroup",value:function(e,t){var n={width:e.columnWidths[t]+"px"};if("center"===t)n.transform="translate3d(-"+e.options.internal.offsetX+"px, 0, 0)";else if("right"===t){var o=e.columnWidths.total-e.options.internal.innerWidth;n.transform="translate3d(-"+o+"px, 0, 0)"}return n}},{key:"onCheckboxChange",value:function(e){e.onCheckboxChange()}},{key:"onResize",value:function(e,t,n){e.onResize({column:t,width:n})}}]),e}();C.$inject=["$timeout"],b.$inject=["$document","debounce","$timeout"],x.$inject=["$window","$timeout","throttle"];var M=e.module("data-table",[]).controller("DataTable",z).directive("dt",x).directive("resizable",b).directive("sortable",C).constant("debounce",y).constant("throttle",w).controller("HeaderController",D).directive("dtHeader",v).controller("HeaderCellController",_).directive("dtHeaderCell",m).controller("BodyController",B).directive("dtBody",t).controller("RowController",G).directive("dtRow",g).controller("GroupRowController",E).directive("dtGroupRow",p).controller("CellController",A).directive("dtCell",d).controller("FooterController",W).directive("dtFooter",h).controller("PagerController",P).directive("dtPager",u);return M});