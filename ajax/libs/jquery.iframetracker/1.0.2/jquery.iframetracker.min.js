(function($){$.fn.iframeTracker=function(handler){$.iframeTracker.handlersList.push(handler);$(this).bind("mouseover",{handler:handler},function(e){e.data.handler.over=true;try{e.data.handler.overCallback(this)}catch(ex){}}).bind("mouseout",{handler:handler},function(e){e.data.handler.over=false;$.iframeTracker.focusRetriever.focus();try{e.data.handler.outCallback(this)}catch(ex){}})};$.iframeTracker={focusRetriever:null,focusRetrieved:false,handlersList:[],isIE8AndOlder:false,init:function(){try{if($.browser.msie==true&&$.browser.version<9){this.isIE8AndOlder=true}}catch(ex){try{var matches=navigator.userAgent.match(/(msie) ([\w.]+)/i);if(matches[2]<9){this.isIE8AndOlder=true}}catch(ex2){}}$(window).focus();$(window).blur(function(e){$.iframeTracker.windowLoseFocus(e)});$("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" /></div>');this.focusRetriever=$("#focus_retriever");this.focusRetrieved=false;$(document).mousemove(function(e){if(document.activeElement&&document.activeElement.tagName=="IFRAME"){$.iframeTracker.focusRetriever.focus();$.iframeTracker.focusRetrieved=true}});if(this.isIE8AndOlder){this.focusRetriever.blur(function(e){e.stopPropagation();e.preventDefault();$.iframeTracker.windowLoseFocus(e)})}if(this.isIE8AndOlder){$("body").click(function(e){$(window).focus()});$("form").click(function(e){e.stopPropagation()});try{$("body").on("click","form",function(e){e.stopPropagation()})}catch(ex){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+ex.message+")")}}},windowLoseFocus:function(event){for(var i in this.handlersList){if(this.handlersList[i].over==true){try{this.handlersList[i].blurCallback()}catch(ex){}}}}};$(document).ready(function(){$.iframeTracker.init()})})(jQuery);
