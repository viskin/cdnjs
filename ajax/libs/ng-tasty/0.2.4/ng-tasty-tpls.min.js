angular.module("ngTasty",["ngTasty.tpls","ngTasty.filter","ngTasty.service","ngTasty.table"]),angular.module("ngTasty.tpls",["template/table/head.html","template/table/pagination.html"]),angular.module("ngTasty.filter",["ngTasty.filter.cleanFieldName","ngTasty.filter.range"]),angular.module("ngTasty.filter.cleanFieldName",[]).filter("cleanFieldName",function(){return function(e){return e.replace(/[^a-zA-Z0-9-]+/g,"-").toLowerCase()}}),angular.module("ngTasty.filter.range",["ngTasty.service.filterInt"]).filter("range",["filterInt",function(e){return function(a,n,t,r){if(n=e(n),t=e(t),r=e(r),isNaN(n)&&(n=0),isNaN(t)&&(t=n,n=0),isNaN(r)&&(r=1),r>0&&n>=t||0>r&&t>=n)return[];for(var i=n;r>0?t>i:i>t;i+=r)a.push(i);return a}}]),angular.module("ngTasty.service",["ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]),angular.module("ngTasty.service.filterInt",[]).factory("filterInt",function(){return function(e){return/^(\-|\+)?([0-9]+|Infinity)$/.test(e)?Number(e):0/0}}),angular.module("ngTasty.service.debounce",[]).factory("debounce",["$timeout",function(e){return function(a,n){var t;return function(){var r=this,i=arguments;e.cancel(t),t=e(function(){t=null,a.apply(r,i)},n)}}}]),angular.module("ngTasty.service.setProperty",[]).factory("setProperty",function(){return function(e,a,n){return"undefined"!=typeof a[n]&&null!==a[n]&&(e[n]=a[n]),e}}),angular.module("ngTasty.service.joinObjects",[]).factory("joinObjects",["setProperty",function(e){return function(a,n){for(var t in n)e(a,n,t);return a}}]),angular.module("ngTasty.table",["ngTasty.filter.cleanFieldName","ngTasty.filter.range","ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]).constant("tableConfig",{query:{page:"page",count:"count",sortBy:"sort-by",sortOrder:"sort-order"},resource:void 0,resourceCallback:void 0}).controller("TableController",["$scope","$attrs","$timeout","$filter","tableConfig","debounce","setProperty","joinObjects",function(e,a,n,t,r,i,s,o){"use strict";if(this.$scope=e,e.query=r.query,e.resource=r.resource,e.resourceCallback=r.resourceCallback,e.clientSide=!0,e.url="",e.header={columns:[]},e.rows=[],e.params={},e.pagination={count:5,page:1,pages:1,size:1},e.theadDirective=!1,e.paginationDirective=!1,angular.isDefined(a.query)&&(e.query=e.$parent.$eval(a.query)),!angular.isDefined(a.resource)&&!angular.isDefined(a.resourceCallback))throw"AngularJS tastyTable directive: need the resource or resource-callback attribute";if(angular.isDefined(a.resource)){if(e.resource=e.$parent.$eval(a.resource),!angular.isObject(e.resource))throw"AngularJS tastyTable directive: the resource ("+a.resource+") it's not an object";if(!e.resource.header&&!e.resource.rows)throw"AngularJS tastyTable directive: the resource ("+a.resource+") has the property header or rows undefined"}if(angular.isDefined(a.resourceCallback)){if(e.resourceCallback=e.$parent.$eval(a.resourceCallback),!angular.isFunction(e.resourceCallback))throw"AngularJS tastyTable directive: the resource-callback ("+a.resourceCallback+") it's not a function";e.clientSide=!1}this.activate=function(a){e[a+"Directive"]=!0,e.params[a]=!0},this.setParams=function(a,n){e.params[a]=n},e.setDirectivesValues=function(a){return a?(e.header={columns:a.header,sortBy:a.sortBy||e.params.sortBy,sortOrder:a.sortOrder||e.params.sortOrder},e.rows=a.rows,void(e.pagination=a.pagination||e.pagination)):!1},e.buildClientResource=function(){var a,n,r,i;e.theadDirective&&(i="asc"===e.header.sortOrder?!1:!0,e.rows=t("orderBy")(e.rows,e.header.sortBy,i)),e.paginationDirective&&(e.pagination.page=e.params.page,e.pagination.count=e.params.count,e.pagination.size=e.rows.length,e.pagination.pages=Math.ceil(e.rows.length/e.pagination.count),n=e.pagination.count*e.pagination.page,a=n-e.pagination.count,a>=0&&n>=0&&(r=e.rows.slice(a,n),e.rows=r))},e.buildUrl=function(n,t){var r,i;return r={},e.theadDirective&&(r=s(r,n,"sortBy"),r=s(r,n,"sortOrder")),e.paginationDirective&&(r=s(r,n,"page"),r=s(r,n,"count")),a.filters&&(r=o(r,t)),Object.keys(r).map(function(a){return i=r[a],e.query[a]&&(a=e.query[a]),encodeURIComponent(a)+"="+encodeURIComponent(i)}).join("&")},e.updateClientSideResource=i(function(){e.setDirectivesValues(e.resource),e.buildClientResource()},100),e.updateServerSideResource=i(function(){e.url=e.buildUrl(e.params,e[a.filters]),e.resourceCallback(e.url).then(function(a){e.setDirectivesValues(a)})},100),e.initTable=function(){e.params.sortBy=void 0,e.params.sortOrder="asc",e.params.page=1,e.params.count=5,e.clientSide?e.updateClientSideResource():e.updateServerSideResource()},a.filters&&e.$watch(a.filters,function(a,n){a!==n&&e.updateServerSideResource()},!0),e.$watch("params",function(a,n){a!==n&&(e.clientSide?e.updateClientSideResource():e.updateServerSideResource())},!0),e.initTable()}]).directive("tastyTable",function(){return{restrict:"A",scope:!0,controller:"TableController"}}).directive("tastyThead",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{notSortBy:"="},templateUrl:"template/table/head.html",link:function(a,n,t,r){"use strict";r.activate("thead"),a.fields={},a.setFields=function(){var n,t,r,i;n=a.header.columns.length,a.header.columns.forEach(function(s){t=parseFloat((100/n).toFixed(2)),i=!0,r=!1,a.notSortBy&&(i=a.notSortBy.indexOf(s.key)<0),(s.key===a.header.sortBy||"-"+s.key===a.header.sortBy)&&(r=!0),a.fields[s.key]={active:r,sortable:i,width:{width:t+"%"},sort:e("cleanFieldName")(s.key)}}),"dsc"===a.header.sortOrder&&"-"!==a.header.sortBy[0]&&(a.header.sortBy="-"+a.header.sortBy)},a.sortBy=function(n){if(a.notSortBy&&a.notSortBy.indexOf(n.key)>=0)return!1;var t;t=e("cleanFieldName")(n.key),a.header.sortBy==t?(a.header.sortBy="-"+t,r.setParams("sortOrder","dsc")):(a.header.sortBy=t,r.setParams("sortOrder","asc")),r.setParams("sortBy",n.key)},a.isSortUp=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy=="-"+a.fields[e.key].sort},a.isSortDown=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy==a.fields[e.key].sort},r.$scope.$watch("header",function(e,n){e&&e!==n&&(a.header=e,a.setFields())},!0)}}}]).directive("tastyPagination",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{},templateUrl:"template/table/pagination.html",link:function(a,n,t,r){"use strict";var i,s,o,c,g,l;r.activate("pagination"),a.numPaginations=5,a.pagListCount=[5,25,50,100],a.pagination={},a.pagMinRange=1,a.pagMaxRange=1,i=function(e){r.setParams("page",e)},s=function(e){var n,t;n=e*a.pagination.page,n>a.pagination.size&&(t=Math.ceil(a.pagination.size/e),r.setParams("page",t)),r.setParams("count",e)},o=function(){var e;e=a.pagination.page,e>a.pagination.pages&&(e=a.pagination.pages),a.pagMinRange=e-2>0?e-2:1,a.pagMaxRange=e+2,a.pagination.page=e,l()},c=function(){return a.pagHideMinRange===!0||a.pagMinRange<1?!1:(a.pagMaxRange=a.pagMinRange,a.pagMinRange=a.pagMaxRange-a.numPaginations,void l())},g=function(){return a.pagHideMaxRange===!0||a.pagMaxRange>a.pagination.pages?!1:(a.pagMinRange=a.pagMaxRange,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages),a.pagMinRange=a.pagMaxRange-a.numPaginations,void l())},l=function(){a.pagMinRange=a.pagMinRange>0?a.pagMinRange:1,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages+1),a.pagHideMinRange=a.pagMinRange<=1,a.pagHideMaxRange=a.pagMaxRange>=a.pagination.pages,a.pagListCount=a.pagination.size<50?[5,25]:a.pagination.size<100?[5,25,50]:[5,25,50,100],a.rangePage=e("range")([],a.pagMinRange,a.pagMaxRange)},a.page={get:i,setCount:s,previous:c,remaining:g},r.$scope.$watch("pagination",function(e,n){e&&e!==n&&(a.pagination=e,o())},!0)}}}]),angular.module("template/table/head.html",[]).run(["$templateCache",function(e){e.put("template/table/head.html",'<tr>\n  <th ng-repeat="column in header.columns" \n  ng-class="{\'sortable\': fields[column.key].sortable, \n             \'active\': fields[column.key].active}"\n  ng-style="fields[column.key].width" \n  ng-click="sortBy(column)">\n    <span ng-bind="column.name"></span>\n    <span ng-if="isSortUp(column)" class="fa fa-sort-up"></span>\n    <span ng-if="isSortDown(column)" class="fa fa-sort-down"></span>\n  </th> \n</tr>')}]),angular.module("template/table/pagination.html",[]).run(["$templateCache",function(e){e.put("template/table/pagination.html",'<div class="row">\n  <div class="col-md-3 text-left">\n    <div class="btn-group">\n      <button type="button" class="btn btn-default" \n      ng-repeat="count in pagListCount" \n      ng-class="{active: count == pagination.count}" \n      ng-click="page.setCount(count)" ng-bind="count"></button>\n    </div>\n  </div>\n  <div class="col-md-6 text-center">\n    <ul class="pagination">\n      <li ng-class="{disabled: pagHideMinRange}">\n        <span ng-click="page.previous()">&laquo;</span>\n      </li>\n      <li ng-repeat="numPage in rangePage" \n      ng-class="{active: numPage == pagination.page}">\n        <span ng-click="page.get(numPage)">\n          <span ng-bind="numPage"></span>\n          <span class="sr-only" ng-if="numPage == pagination.page">(current)</span>\n        </span>\n      </li>\n      <li ng-class="{disabled: pagHideMaxRange}">\n        <span ng-click="page.remaining()">&raquo;</span>\n      </li>\n    </ul>\n  </div>\n  <div class="col-md-3 text-right">\n    <p>Page <span ng-bind="pagination.page"></span> \n    of <span ng-bind="pagination.pages"></span>,\n    of <span ng-bind="pagination.size"></span> entries</p>\n  </div>\n</div>')}]);