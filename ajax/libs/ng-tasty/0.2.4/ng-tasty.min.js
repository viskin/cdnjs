angular.module("ngTasty",["ngTasty.filter","ngTasty.service","ngTasty.table"]),angular.module("ngTasty.filter",["ngTasty.filter.cleanFieldName","ngTasty.filter.range"]),angular.module("ngTasty.filter.cleanFieldName",[]).filter("cleanFieldName",function(){return function(e){return e.replace(/[^a-zA-Z0-9-]+/g,"-").toLowerCase()}}),angular.module("ngTasty.filter.range",["ngTasty.service.filterInt"]).filter("range",["filterInt",function(e){return function(a,t,n,r){if(t=e(t),n=e(n),r=e(r),isNaN(t)&&(t=0),isNaN(n)&&(n=t,t=0),isNaN(r)&&(r=1),r>0&&t>=n||0>r&&n>=t)return[];for(var i=t;r>0?n>i:i>n;i+=r)a.push(i);return a}}]),angular.module("ngTasty.service",["ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]),angular.module("ngTasty.service.filterInt",[]).factory("filterInt",function(){return function(e){return/^(\-|\+)?([0-9]+|Infinity)$/.test(e)?Number(e):0/0}}),angular.module("ngTasty.service.debounce",[]).factory("debounce",["$timeout",function(e){return function(a,t){var n;return function(){var r=this,i=arguments;e.cancel(n),n=e(function(){n=null,a.apply(r,i)},t)}}}]),angular.module("ngTasty.service.setProperty",[]).factory("setProperty",function(){return function(e,a,t){return"undefined"!=typeof a[t]&&null!==a[t]&&(e[t]=a[t]),e}}),angular.module("ngTasty.service.joinObjects",[]).factory("joinObjects",["setProperty",function(e){return function(a,t){for(var n in t)e(a,t,n);return a}}]),angular.module("ngTasty.table",["ngTasty.filter.cleanFieldName","ngTasty.filter.range","ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]).constant("tableConfig",{query:{page:"page",count:"count",sortBy:"sort-by",sortOrder:"sort-order"},resource:void 0,resourceCallback:void 0}).controller("TableController",["$scope","$attrs","$timeout","$filter","tableConfig","debounce","setProperty","joinObjects",function(e,a,t,n,r,i,o,s){"use strict";if(this.$scope=e,e.query=r.query,e.resource=r.resource,e.resourceCallback=r.resourceCallback,e.clientSide=!0,e.url="",e.header={columns:[]},e.rows=[],e.params={},e.pagination={count:5,page:1,pages:1,size:1},e.theadDirective=!1,e.paginationDirective=!1,angular.isDefined(a.query)&&(e.query=e.$parent.$eval(a.query)),!angular.isDefined(a.resource)&&!angular.isDefined(a.resourceCallback))throw"AngularJS tastyTable directive: need the resource or resource-callback attribute";if(angular.isDefined(a.resource)){if(e.resource=e.$parent.$eval(a.resource),!angular.isObject(e.resource))throw"AngularJS tastyTable directive: the resource ("+a.resource+") it's not an object";if(!e.resource.header&&!e.resource.rows)throw"AngularJS tastyTable directive: the resource ("+a.resource+") has the property header or rows undefined"}if(angular.isDefined(a.resourceCallback)){if(e.resourceCallback=e.$parent.$eval(a.resourceCallback),!angular.isFunction(e.resourceCallback))throw"AngularJS tastyTable directive: the resource-callback ("+a.resourceCallback+") it's not a function";e.clientSide=!1}this.activate=function(a){e[a+"Directive"]=!0,e.params[a]=!0},this.setParams=function(a,t){e.params[a]=t},e.setDirectivesValues=function(a){return a?(e.header={columns:a.header,sortBy:a.sortBy||e.params.sortBy,sortOrder:a.sortOrder||e.params.sortOrder},e.rows=a.rows,void(e.pagination=a.pagination||e.pagination)):!1},e.buildClientResource=function(){var a,t,r,i;e.theadDirective&&(i="asc"===e.header.sortOrder?!1:!0,e.rows=n("orderBy")(e.rows,e.header.sortBy,i)),e.paginationDirective&&(e.pagination.page=e.params.page,e.pagination.count=e.params.count,e.pagination.size=e.rows.length,e.pagination.pages=Math.ceil(e.rows.length/e.pagination.count),t=e.pagination.count*e.pagination.page,a=t-e.pagination.count,a>=0&&t>=0&&(r=e.rows.slice(a,t),e.rows=r))},e.buildUrl=function(t,n){var r,i;return r={},e.theadDirective&&(r=o(r,t,"sortBy"),r=o(r,t,"sortOrder")),e.paginationDirective&&(r=o(r,t,"page"),r=o(r,t,"count")),a.filters&&(r=s(r,n)),Object.keys(r).map(function(a){return i=r[a],e.query[a]&&(a=e.query[a]),encodeURIComponent(a)+"="+encodeURIComponent(i)}).join("&")},e.updateClientSideResource=i(function(){e.setDirectivesValues(e.resource),e.buildClientResource()},100),e.updateServerSideResource=i(function(){e.url=e.buildUrl(e.params,e[a.filters]),e.resourceCallback(e.url).then(function(a){e.setDirectivesValues(a)})},100),e.initTable=function(){e.params.sortBy=void 0,e.params.sortOrder="asc",e.params.page=1,e.params.count=5,e.clientSide?e.updateClientSideResource():e.updateServerSideResource()},a.filters&&e.$watch(a.filters,function(a,t){a!==t&&e.updateServerSideResource()},!0),e.$watch("params",function(a,t){a!==t&&(e.clientSide?e.updateClientSideResource():e.updateServerSideResource())},!0),e.initTable()}]).directive("tastyTable",function(){return{restrict:"A",scope:!0,controller:"TableController"}}).directive("tastyThead",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{notSortBy:"="},templateUrl:"template/table/head.html",link:function(a,t,n,r){"use strict";r.activate("thead"),a.fields={},a.setFields=function(){var t,n,r,i;t=a.header.columns.length,a.header.columns.forEach(function(o){n=parseFloat((100/t).toFixed(2)),i=!0,r=!1,a.notSortBy&&(i=a.notSortBy.indexOf(o.key)<0),(o.key===a.header.sortBy||"-"+o.key===a.header.sortBy)&&(r=!0),a.fields[o.key]={active:r,sortable:i,width:{width:n+"%"},sort:e("cleanFieldName")(o.key)}}),"dsc"===a.header.sortOrder&&"-"!==a.header.sortBy[0]&&(a.header.sortBy="-"+a.header.sortBy)},a.sortBy=function(t){if(a.notSortBy&&a.notSortBy.indexOf(t.key)>=0)return!1;var n;n=e("cleanFieldName")(t.key),a.header.sortBy==n?(a.header.sortBy="-"+n,r.setParams("sortOrder","dsc")):(a.header.sortBy=n,r.setParams("sortOrder","asc")),r.setParams("sortBy",t.key)},a.isSortUp=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy=="-"+a.fields[e.key].sort},a.isSortDown=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy==a.fields[e.key].sort},r.$scope.$watch("header",function(e,t){e&&e!==t&&(a.header=e,a.setFields())},!0)}}}]).directive("tastyPagination",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{},templateUrl:"template/table/pagination.html",link:function(a,t,n,r){"use strict";var i,o,s,c,u,g;r.activate("pagination"),a.numPaginations=5,a.pagListCount=[5,25,50,100],a.pagination={},a.pagMinRange=1,a.pagMaxRange=1,i=function(e){r.setParams("page",e)},o=function(e){var t,n;t=e*a.pagination.page,t>a.pagination.size&&(n=Math.ceil(a.pagination.size/e),r.setParams("page",n)),r.setParams("count",e)},s=function(){var e;e=a.pagination.page,e>a.pagination.pages&&(e=a.pagination.pages),a.pagMinRange=e-2>0?e-2:1,a.pagMaxRange=e+2,a.pagination.page=e,g()},c=function(){return a.pagHideMinRange===!0||a.pagMinRange<1?!1:(a.pagMaxRange=a.pagMinRange,a.pagMinRange=a.pagMaxRange-a.numPaginations,void g())},u=function(){return a.pagHideMaxRange===!0||a.pagMaxRange>a.pagination.pages?!1:(a.pagMinRange=a.pagMaxRange,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages),a.pagMinRange=a.pagMaxRange-a.numPaginations,void g())},g=function(){a.pagMinRange=a.pagMinRange>0?a.pagMinRange:1,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages+1),a.pagHideMinRange=a.pagMinRange<=1,a.pagHideMaxRange=a.pagMaxRange>=a.pagination.pages,a.pagListCount=a.pagination.size<50?[5,25]:a.pagination.size<100?[5,25,50]:[5,25,50,100],a.rangePage=e("range")([],a.pagMinRange,a.pagMaxRange)},a.page={get:i,setCount:o,previous:c,remaining:u},r.$scope.$watch("pagination",function(e,t){e&&e!==t&&(a.pagination=e,s())},!0)}}}]);