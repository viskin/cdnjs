(function($){$.superscrollorama=function(options){var superscrollorama=this;var defaults={isVertical:true,triggerAtCenter:true,playoutAnimations:true};superscrollorama.settings=$.extend({},defaults,options);var animObjects=[],pinnedObjects=[],didScrollCheck=false;function init(){$("html, body").animate({scrollTop:0},0);$(window).scroll(function(){didScrollCheck=true});TweenLite.ticker.addEventListener("tick",tickHandler)}function tickHandler(){if(didScrollCheck){checkScrollAnim();didScrollCheck=false}}function resetPinObj(pinObj){pinObj.el.css("position",pinObj.origPosition);pinObj.el.css("top",pinObj.origPositioning.top);pinObj.el.css("bottom",pinObj.origPositioning.bottom);pinObj.el.css("left",pinObj.origPositioning.left);pinObj.el.css("right",pinObj.origPositioning.right)}function setTweenProgress(tween,progress){if(tween.totalProgress){tween.totalProgress(progress).pause()}else{tween.progress(progress).pause()}}function checkScrollAnim(){var currScrollPoint=superscrollorama.settings.isVertical?$(window).scrollTop():$(window).scrollLeft();var offsetAdjust=superscrollorama.settings.triggerAtCenter?superscrollorama.settings.isVertical?-$(window).height()/2:-$(window).width()/2:0;var i,startPoint,endPoint;var numAnim=animObjects.length;for(i=0;i<numAnim;i++){var animObj=animObjects[i],target=animObj.target,offset=animObj.offset;if(typeof target==="string"){startPoint=superscrollorama.settings.isVertical?$(target).offset().top:$(target).offset().left;offset+=offsetAdjust}else if(typeof target==="number"){startPoint=target}else if($.isFunction(target)){startPoint=target.call(this)}else{startPoint=superscrollorama.settings.isVertical?target.offset().top:target.offset().left;offset+=offsetAdjust}startPoint+=offset;endPoint=animObj.dur?startPoint+animObj.dur:startPoint;if(currScrollPoint>startPoint&&currScrollPoint<endPoint&&animObj.state!=="TWEENING"){animObj.state="TWEENING";animObj.start=startPoint;animObj.end=endPoint;setTweenProgress(animObj.tween,(currScrollPoint-animObj.start)/(animObj.end-animObj.start))}else if(currScrollPoint<startPoint&&animObj.state!=="BEFORE"){if(superscrollorama.settings.playoutAnimations){animObj.tween.reverse()}else{setTweenProgress(animObj.tween,0)}animObj.state="BEFORE"}else if(currScrollPoint>endPoint&&animObj.state!=="AFTER"){if(superscrollorama.settings.playoutAnimations){animObj.tween.play()}else{setTweenProgress(animObj.tween,1)}animObj.state="AFTER"}else if(animObj.state==="TWEENING"){setTweenProgress(animObj.tween,(currScrollPoint-animObj.start)/(animObj.end-animObj.start))}}var numPinned=pinnedObjects.length;for(i=0;i<numPinned;i++){var pinObj=pinnedObjects[i];var el=pinObj.el;var elHeight=el.outerHeight();if(pinObj.state!="PINNED"){if(pinObj.state==="UPDATE")resetPinObj(pinObj);startPoint=pinObj.spacer?superscrollorama.settings.isVertical?pinObj.spacer.offset().top:pinObj.spacer.offset().left:superscrollorama.settings.isVertical?el.offset().top:el.offset().left;startPoint+=pinObj.offset;endPoint=startPoint+pinObj.dur;if(currScrollPoint>startPoint&&currScrollPoint<endPoint){var oldState=pinObj.state;pinObj.state="PINNED";pinObj.origPositioning={top:el.css("top"),left:el.css("left"),bottom:el.css("bottom"),right:el.css("right")};var realCoordinates=el.offset();el.css("position","fixed");if(superscrollorama.settings.isVertical){el.css("top",-pinObj.offset);el.css("left",realCoordinates.left)}else{el.css("left",-pinObj.offset);el.css("top",realCoordinates.top)}pinObj.pinStart=startPoint;pinObj.pinEnd=endPoint;if(pinObj.spacer)pinObj.spacer.css("height",pinObj.dur+elHeight);if(oldState==="UPDATE"){if(pinObj.anim)setTweenProgress(pinObj.anim,0)}else if(pinObj.onPin){pinObj.onPin()}setTweenProgress(pinObj.anim,(currScrollPoint-pinObj.pinStart)/(pinObj.pinEnd-pinObj.pinStart))}}else{if(currScrollPoint<pinObj.pinStart||currScrollPoint>pinObj.pinEnd){pinObj.state=currScrollPoint<pinObj.pinStart?"BEFORE":"AFTER";if(pinObj.anim&&pinObj.state==="BEFORE"){setTweenProgress(pinObj.anim,0)}else if(pinObj.anim&&pinObj.state==="AFTER"){setTweenProgress(pinObj.anim,1)}resetPinObj(pinObj);if(pinObj.spacer)pinObj.spacer.css("height",currScrollPoint<pinObj.pinStart?0:pinObj.dur);if(pinObj.onUnpin)pinObj.onUnpin()}else if(pinObj.anim){setTweenProgress(pinObj.anim,(currScrollPoint-pinObj.pinStart)/(pinObj.pinEnd-pinObj.pinStart))}}}}superscrollorama.addTween=function(target,tween,dur,offset){tween.pause();animObjects.push({target:target,tween:tween,offset:offset||0,dur:dur||0,state:"BEFORE"});return superscrollorama};superscrollorama.pin=function(el,dur,vars){if(typeof el==="string")el=$(el);if(vars.anim)vars.anim.pause();var pinSpacer=null;if(el.css("position")==="relative"||el.css("position")==="static"){pinSpacer=$('<div class="pin-spacer"></div>');el.before(pinSpacer)}pinnedObjects.push({el:el,state:"BEFORE",dur:dur,offset:vars.offset||0,anim:vars.anim,origPosition:el.css("position"),spacer:pinSpacer,onPin:vars.onPin,onUnpin:vars.onUnpin});return superscrollorama};superscrollorama.updatePin=function(el,dur,vars){if(typeof el==="string")el=$(el);if(vars.anim)vars.anim.pause();var numPinned=pinnedObjects.length;for(i=0;i<numPinned;i++){var pinObj=pinnedObjects[i];if(el.get(0)==pinObj.el.get(0)){if(dur)pinObj.dur=dur;if(vars.anim)pinObj.anim=vars.anim;if(vars.offset)pinObj.offset=vars.offset;if(vars.onPin)pinObj.onPin=vars.onPin;if(vars.onUnpin)pinObj.onUnpin=vars.onUnpin;if((dur||vars.anim||vars.offset)&&pinObj.state==="PINNED"){pinObj.state="UPDATE";checkScrollAnim()}}}return superscrollorama};superscrollorama.triggerCheckAnim=function(immediately){if(immediately){checkScrollAnim()}else{didScrollCheck=true}return superscrollorama};init();return superscrollorama}})(jQuery);
