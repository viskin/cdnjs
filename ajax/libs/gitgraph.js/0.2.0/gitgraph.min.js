/* ==========================================================
 *                  GitGraph v0.2.0
 *      https://github.com/nicoespeon/gitgraph.js
 * ==========================================================
 * Copyright (c) 2013 Nicolas CARLO (@nicoespeon) ٩(^‿^)۶
 * Copyright (c) 2013 Fabien BERNARD (@fabien0102) ✌(✰‿✰)✌
 *
 * GitGraph.js may be freely distributed under the MIT Licence
 * ========================================================== */
function GitGraph(a){a="object"==typeof a?a:{},this.elementId="string"==typeof a.elementId?a.elementId:"gitGraph",this.author="string"==typeof a.author?a.author:"Sergio Flores <saxo-guy@epic.com>","string"==typeof a.template&&(a.template=(new Template).get(a.template)),this.template=a.template instanceof Template?a.template:new Template,this.canvas=document.getElementById(this.elementId),this.context=this.canvas.getContext("2d"),this.HEAD=null,this.branchs=[],this.columnMax=0,this.commitOffsetX=0,this.commitOffsetY=0,this.context.fillStyle="red",this.context.font="bold 15pt Calibri",this.context.fillText("Error: No render() at the end",150,100)}function Branch(a){a.parent instanceof GitGraph!=!1&&(a="object"==typeof a?a:{},this.parent=a.parent,this.parentBranch=a.parentBranch,this.originX="number"==typeof a.originX?a.originX:0,this.originY="number"==typeof a.originY?a.originY:0,this.name="string"==typeof a.name?a.name:"no-name",this.targetBranch=null,this.context=this.parent.context,this.template=this.parent.template,this.lineWidth=this.template.branch.lineWidth,this.spacingX=this.template.branch.spacingX,this.spacingY=this.template.branch.spacingY,this.size=0,this.height=0,this.width=0,this.commits=[],this.column=0,this.calculColumn(),this.offsetX=this.column*this.spacingX,this.offsetY=this.column*this.spacingY,this.color=a.color||this.template.branch.color||this.template.colors[this.column],this.checkout())}function Commit(a){a.parent instanceof GitGraph!=!1&&(a="object"==typeof a?a:{},this.parent=a.parent,this.template=this.parent.template,this.context=this.parent.context,this.author=a.author||this.parent.author,this.date=a.date||(new Date).toUTCString(),this.sha1=a.sha1||Math.random(100).toString(16).substring(3,10),this.message=a.message||"He doesn't like George Michael! Boooo!",this.arrowDisplay=a.arrowDisplay,this.messageDisplay=a.messageDisplay||this.template.commit.message.display,this.messageColor=a.messageColor||a.color,this.dotColor=a.dotColor||a.color,this.dotSize=a.dotSize||this.template.commit.dot.size,this.dotStrokeWidth=a.dotStrokeWidth||this.template.commit.dot.strokeWidth,this.dotStrokeColor=a.dotStrokeColor||this.template.commit.dot.strokeColor,this.x=a.x,this.y=a.y)}function Arrow(a){a="object"==typeof a?a:{},this.parent=a.parent,this.context=this.parent.context,this.template=this.parent.template,this.size=a.size||this.template.arrow.size,this.color=a.color||this.template.arrow.color,this.x=a.x+this.template.arrow.offsetX,this.y=a.y+this.template.arrow.offsetY;var b=Math.atan2(this.template.commit.spacingY,this.template.commit.spacingX),c=Math.PI/7,d=this.template.commit.dot.size,e=d*Math.cos(b)+this.x,f=d*Math.sin(b)+this.y,g=(d+this.size)*Math.cos(b-c)+this.x,h=(d+this.size)*Math.sin(b-c)+this.y,i=(d+this.size/2)*Math.cos(b)+this.x,j=(d+this.size/2)*Math.sin(b)+this.y,k=(d+this.size)*Math.cos(b+c)+this.x,l=(d+this.size)*Math.sin(b+c)+this.y;this.context.beginPath(),this.context.fillStyle=this.color,this.context.moveTo(e,f),this.context.lineTo(g,h),this.context.quadraticCurveTo(i,j,k,l),this.context.lineTo(k,l),this.context.fill()}function Template(a){a="object"==typeof a?a:{},a.branch=a.branch||{},a.arrow=a.arrow||{},a.commit=a.commit||{},a.commit.dot=a.commit.dot||{},a.commit.message=a.commit.message||{},this.colors=a.colors||["#6963FF","#47E8D4","#6BDB52","#E84BA5","#FFA657"],this.branch={},this.branch.color=a.branch.color||null,this.branch.lineWidth=a.branch.lineWidth||2,this.branch.mergeStyle=a.branch.mergeStyle||"bezier",this.branch.mergeCommit="boolean"==typeof a.branch.mergeCommit?a.branch.mergeCommit:!0,this.branch.spacingX="number"==typeof a.branch.spacingX?a.branch.spacingX:20,this.branch.spacingY=a.branch.spacingY||0,this.arrow={},this.arrow.size=a.arrow.size||null,this.arrow.color=a.arrow.color||this.branch.color||null,this.arrow.active="number"==typeof this.arrow.size,this.arrow.offsetX=a.arrow.offsetX||null,this.arrow.offsetY=a.arrow.offsetY||2,this.commit={},this.commit.spacingX=a.commit.spacingX||0,this.commit.spacingY="number"==typeof a.commit.spacingY?a.commit.spacingY:25,this.commit.color=a.commit.color||null,this.commit.dot={},this.commit.dot.color=a.commit.dot.color||null,this.commit.dot.size=a.commit.dot.size||3,this.commit.dot.strokeWidth=a.commit.dot.strokeWidth||null,this.commit.dot.strokeColor=a.commit.dot.strokeColor||null,this.commit.message={},this.commit.message.display="boolean"==typeof a.commit.message.display?a.commit.message.display:!0,this.commit.message.color=a.commit.message.color||null,this.commit.message.font=a.commit.message.font||"normal 12pt Calibri"}GitGraph.prototype.branch=function(a){if("string"==typeof a){var b=a;a={},a.name=b}a="object"==typeof a?a:{},a.parent=this,a.parentBranch=a.parentBranch||this.HEAD,a.parentBranch instanceof Branch&&(a.originX=a.parentBranch.commits[a.parentBranch.commits.length-1].x-this.template.commit.spacingX-a.parentBranch.offsetX,a.originY=a.parentBranch.commits[a.parentBranch.commits.length-1].y-this.template.commit.spacingY-a.parentBranch.offsetY);var c=new Branch(a);return this.branchs.push(c),c},GitGraph.prototype.commit=function(a){return this.HEAD.commit(a),this},GitGraph.prototype.render=function(){this.canvas.height=this.branchs[0].updateSize().height||this.branchs[this.branchs.length-1].offsetY+3*this.template.commit.dot.size,this.canvas.width=this.branchs[0].updateSize().width||1e3,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(2*this.template.commit.dot.size,2*this.template.commit.dot.size),this.template.commit.spacingY>0&&this.context.translate(0,this.canvas.height-3*this.template.commit.dot.size),this.template.commit.spacingX>0&&this.context.translate(this.canvas.width-3*this.template.commit.dot.size,0);for(var a,b=this.branchs.length-1;a=this.branchs[b];b--)a.updateSize(),a.render()},Branch.prototype.render=function(){this.parentBranch&&(this.context.beginPath(),this.context.moveTo(this.parentBranch.offsetX+this.originX+this.template.commit.spacingX,this.parentBranch.offsetY+this.originY+this.template.commit.spacingY),"bezier"===this.template.branch.mergeStyle?this.context.bezierCurveTo(this.parentBranch.offsetX+this.originX+this.template.commit.spacingX/2,this.parentBranch.offsetY+this.originY+this.template.commit.spacingY/2,this.offsetX+this.originX+this.template.commit.spacingX/2,this.offsetY+this.originY+this.template.commit.spacingY/2,this.offsetX+this.originX,this.offsetY+this.originY):this.context.lineTo(this.offsetX+this.originX,this.offsetY+this.originY),this.context.lineWidth=this.lineWidth,this.context.strokeStyle=this.color,this.context.stroke()),this.parentBranch||(this.context.beginPath(),this.context.moveTo(this.offsetX+this.originX,this.offsetY+this.originY)),this.context.lineTo(this.offsetX+this.originX-this.width,this.offsetY+this.originY-this.height),this.context.lineWidth=this.lineWidth,this.context.strokeStyle=this.color,this.context.stroke(),this.targetBranch&&("bezier"===this.template.branch.mergeStyle?this.context.bezierCurveTo(this.offsetX+this.originX-this.width-this.template.commit.spacingX/2,this.offsetY+this.originY-this.height-this.template.commit.spacingY/2,this.targetBranch.offsetX+this.originX-this.width-this.template.commit.spacingX/2,this.targetBranch.offsetY+this.originY-this.height-this.template.commit.spacingY/2,this.targetBranch.offsetX+this.originX-this.width-this.template.commit.spacingX,this.targetBranch.offsetY+this.originY-this.height-this.template.commit.spacingY):this.context.lineTo(this.targetBranch.offsetX+this.originX-this.width-this.template.commit.spacingX,this.targetBranch.offsetY+this.originY-this.height-this.template.commit.spacingY),this.context.lineWidth=this.lineWidth,this.context.strokeStyle=this.color,this.context.stroke());for(var a,b=0;a=this.commits[b];b++)a.render()},Branch.prototype.commit=function(a){if(!this.targetBranch){if("string"==typeof a){var b=a;a={},a.message=b}"object"!=typeof a&&(a={}),a.parent=this.parent,a.messageColor=a.messageColor||a.color||this.template.commit.message.color||null,a.dotColor=a.dotColor||a.color||this.template.commit.dot.color||null,a.color=a.color||this.template.commit.color||this.template.colors[this.column],a.x=this.offsetX-this.parent.commitOffsetX,a.y=this.offsetY-this.parent.commitOffsetY,a.arrowDisplay=0===this.commits.length||"mergeCommit"===a.type?!1:this.template.arrow.active;var c=new Commit(a);return this.commits.push(c),this.parent.commitOffsetX+=this.template.commit.spacingX,this.parent.commitOffsetY+=this.template.commit.spacingY,this}},Branch.prototype.checkout=function(){this.targetBranch||(this.parent.HEAD=this)},Branch.prototype.merge=function(a,b){if(this.targetBranch instanceof Branch!=!0){if(this.targetBranch=a||this.parent.HEAD,this.targetBranch instanceof Branch==!1||this.targetBranch===this)return this.targetBranch=null,void 0;this.height=this.originY+this.parent.commitOffsetY-this.template.commit.spacingY,this.width=this.originX+this.parent.commitOffsetX-this.template.commit.spacingX,b="string"==typeof b?b:"Merge branch `"+this.name+"` into `"+this.targetBranch.name+"`",this.targetBranch.commit({message:b,type:"mergeCommit"}),this.parent.HEAD=this.targetBranch}},Branch.prototype.updateSize=function(){return this.targetBranch instanceof Branch==!1&&(this.width=this.parent.commitOffsetX+this.template.commit.spacingX,this.height=this.parent.commitOffsetY+this.template.commit.spacingY),this.size=Math.sqrt(this.height*this.height+this.width*this.width),{width:Math.abs(this.width),height:Math.abs(this.height)}},Branch.prototype.calculColumn=function(){for(var a,b=0;a=this.parent.branchs[b];b++)a.updateSize(),a.originY-a.size<=this.originY&&this.column++;this.parent.columnMax=this.column>this.parent.columnMax?this.column:this.parent.columnMax},Commit.prototype.render=function(){if(this.context.beginPath(),this.context.arc(this.x,this.y,this.dotSize,0,2*Math.PI,!1),this.context.fillStyle=this.dotColor,this.context.strokeStyle=this.dotStrokeColor,this.context.lineWidth=this.dotStrokeWidth,"number"==typeof this.dotStrokeWidth&&this.context.stroke(),this.context.fill(),this.context.closePath(),this.arrowDisplay&&(this.arrow=new Arrow({parent:this.parent,x:this.x,y:this.y})),this.messageDisplay){var a=this.sha1+" "+this.message+" - "+this.author;this.context.font=this.template.commit.message.font,this.context.fillStyle=this.messageColor,this.context.fillText(a,(this.parent.columnMax+2)*this.template.branch.spacingX,this.y+3)}},Template.prototype.get=function(a){switch(a){case"blackarrow":return new Template({branch:{color:"#000000",lineWidth:4,spacingX:50,mergeStyle:"straight"},commit:{spacingY:-60,dot:{size:12,strokeColor:"#000000",strokeWidth:7},message:{color:"black"}},arrow:{size:16,offsetY:-2}});case"metro":return new Template({colors:["#979797","#008fb5","f1c109"],branch:{lineWidth:10,spacingX:50},commit:{spacingY:-80,dot:{size:14},message:{font:"normal 14pt Arial"}}})}};