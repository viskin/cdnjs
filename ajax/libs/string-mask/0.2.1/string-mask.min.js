!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.StringMask=t()}(this,function(){function e(e,t){for(var n=0,r=t-1,i={escape:!0};r>=0&&i&&i.escape;)i=o[e.charAt(r)],n+=i&&i.escape?1:0,r--;return n>0&&n%2===1}function t(e,t){var n=e.replace(/[^0]/g,"").length,r=t.replace(/[^\d]/g,"").length;return r-n}function n(e,t,n,r){return r&&"function"==typeof r.transform&&(t=r.transform(t)),n.reverse?t+e:e+t}function r(e,t,n){var i=e.charAt(t),s=o[i];return""===i?!1:s&&!s.escape?!0:r(e,t+n,n)}function i(e,t,n){var r=e.split("");return r.splice(n>=0?n:0,0,t),r.join("")}function s(e,t){this.options=t||{},this.options={reverse:this.options.reverse||!1,usedefaults:this.options.usedefaults||this.options.reverse},this.pattern=e}var o={0:{pattern:/\d/,_default:"0"},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,optional:!0,recursive:!0},S:{pattern:/[a-zA-Z]/},U:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},L:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},$:{escape:!0}};return s.prototype.process=function(s){function p(e){if(!d&&r(a,y,g.inc))return!0;if(d||(d=v.length>0),d){var t=v.shift();if(v.push(t),e.reverse&&c>=0)return y++,a=i(a,t,y),!0;if(!e.reverse&&c<s.length)return a=i(a,t,y),!0}return y<a.length&&y>=0}if(!s)return"";s+="";for(var a=this.pattern,u=!0,f="",c=this.options.reverse?s.length-1:0,h=t(a,s),l=!1,v=[],d=!1,g={start:this.options.reverse?a.length-1:0,end:this.options.reverse?-1:a.length,inc:this.options.reverse?-1:1},y=g.start;p(this.options);y+=g.inc){var A=a.charAt(y),m=s.charAt(c),w=o[A];if(!d||m){if(this.options.reverse&&e(a,y)){f=n(f,A,this.options,w),y+=g.inc;continue}if(!this.options.reverse&&l){f=n(f,A,this.options,w),l=!1;continue}if(!this.options.reverse&&w&&w.escape){l=!0;continue}}if(!d&&w&&w.recursive)v.push(A);else{if(d&&!m){w&&w.recursive||(f=n(f,A,this.options,w));continue}if(v.length>0&&w&&!w.recursive){u=!1;continue}if(!d&&v.length>0&&!m)continue}if(w)if(w.optional){if(w.pattern.test(m)&&h)f=n(f,m,this.options,w),c+=g.inc,h--;else if(v.length>0&&m){u=!1;break}}else if(w.pattern.test(m))f=n(f,m,this.options,w),c+=g.inc;else{if(m||!w._default||!this.options.usedefaults){u=!1;break}f=n(f,w._default,this.options,w)}else f=n(f,A,this.options,w),!d&&v.length&&v.push(A)}return{result:f,valid:u}},s.prototype.apply=function(e){return this.process(e).result},s.prototype.validate=function(e){return this.process(e).valid},s.process=function(e,t,n){return new s(t,n).process(e)},s.apply=function(e,t,n){return new s(t,n).apply(e)},s.validate=function(e,t,n){return new s(t,n).validate(e)},s});