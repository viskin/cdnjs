L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._kml=e,this._layers={},e&&this.addKML(e,t,this.options.async)},loadXML:function(e,t,n,a){void 0===a&&(a=this.options.async),void 0===n&&(n=this.options);var r=new window.XMLHttpRequest;r.open("GET",e,a);try{r.overrideMimeType("text/xml")}catch(o){}r.onreadystatechange=function(){4===r.readyState&&200===r.status&&t(r.responseXML,n)},r.send(null)},addKML:function(e,t,n){var a=this,r=function(e,t){a._addKML(e,t)};this.loadXML(e,r,t,n)},_addKML:function(e,t){var n=L.KML.parseKML(e);if(n&&n.length){for(var a=0;a<n.length;a++)this.fire("addlayer",{layer:n[a]}),this.addLayer(n[a]);this.latLngs=L.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(e){var t=this.parseStyle(e);this.parseStyleMap(e,t);for(var n,a=e.getElementsByTagName("Folder"),r=[],o=0;o<a.length;o++)this._check_folder(a[o])&&(n=this.parseFolder(a[o],t),n&&r.push(n));a=e.getElementsByTagName("Placemark");for(var s=0;s<a.length;s++)this._check_folder(a[s])&&(n=this.parsePlacemark(a[s],e,t),n&&r.push(n));a=e.getElementsByTagName("GroundOverlay");for(var l=0;l<a.length;l++)n=this.parseGroundOverlay(a[l]),n&&r.push(n);return r},_check_folder:function(e,t){for(e=e.parentNode;e&&"Folder"!==e.tagName;)e=e.parentNode;return!e||e===t},parseStyle:function(e){function t(e){for(var n={},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a],s=o.tagName;if(r[s])if("hotSpot"===s)for(var l=0;l<o.attributes.length;l++)n[o.attributes[l].name]=o.attributes[l].nodeValue;else{var i=o.childNodes[0].nodeValue;"color"===s?(n.opacity=parseInt(i.substring(0,2),16)/255,n.color="#"+i.substring(6,8)+i.substring(4,6)+i.substring(2,4)):"width"===s?n.weight=i:"Icon"===s?(g=t(o),g.href&&(n.href=g.href)):"href"===s&&(n.href=i)}}return n}for(var n={},a=e.getElementsByTagName("Style"),r={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},o=0;o<a.length;o++){var s,l=a[o],i={},h={},g={};s=l.getElementsByTagName("LineStyle"),s&&s[0]&&(i=t(s[0])),s=l.getElementsByTagName("PolyStyle"),s&&s[0]&&(h=t(s[0])),h.color&&(i.fillColor=h.color),h.opacity&&(i.fillOpacity=h.opacity),s=l.getElementsByTagName("IconStyle"),s&&s[0]&&(g=t(s[0])),g.href&&(i.icon=new L.KMLIcon({iconUrl:g.href,shadowUrl:null,anchorRef:{x:g.x,y:g.y},anchorType:{x:g.xunits,y:g.yunits}})),n["#"+l.getAttribute("id")]=i}return n},parseStyleMap:function(e,t){for(var n=e.getElementsByTagName("StyleMap"),a=0;a<n.length;a++){var r,o,s,l=n[a];r=l.getElementsByTagName("key"),r&&r[0]&&(o=r[0].textContent),r=l.getElementsByTagName("styleUrl"),r&&r[0]&&(s=r[0].textContent),"normal"===o&&(t["#"+l.getAttribute("id")]=t[s])}},parseFolder:function(e,t){var n,a,r=[];n=e.getElementsByTagName("Folder");for(var o=0;o<n.length;o++)this._check_folder(n[o],e)&&(a=this.parseFolder(n[o],t),a&&r.push(a));n=e.getElementsByTagName("Placemark");for(var s=0;s<n.length;s++)this._check_folder(n[s],e)&&(a=this.parsePlacemark(n[s],e,t),a&&r.push(a));n=e.getElementsByTagName("GroundOverlay");for(var l=0;l<n.length;l++)this._check_folder(n[l],e)&&(a=this.parseGroundOverlay(n[l]),a&&r.push(a));if(r.length)return 1===r.length?r[0]:new L.FeatureGroup(r)},parsePlacemark:function(e,t,n){var a,r,o,s,l={},i=["MultiGeometry","MultiTrack","gx:MultiTrack"];for(a in i)for(s=e.getElementsByTagName(i[a]),r=0;r<s.length;r++)return this.parsePlacemark(s[r],t,n);for(s=e.getElementsByTagName("styleUrl"),r=0;r<s.length;r++){var h=s[r].childNodes[0].nodeValue;for(var g in n[h])l[g]=n[h][g]}var d=[],c=["LineString","Polygon","Point","Track","gx:Track"];for(o in c){var u=c[o];for(s=e.getElementsByTagName(u),r=0;r<s.length;r++){var f=this["parse"+u.replace(/gx:/,"")](s[r],t,l);f&&d.push(f)}}if(d.length){var y=d[0];d.length>1&&(y=new L.FeatureGroup(d));var p,m="";for(s=e.getElementsByTagName("name"),s.length&&s[0].childNodes.length&&(p=s[0].childNodes[0].nodeValue),s=e.getElementsByTagName("description"),r=0;r<s.length;r++)for(o=0;o<s[r].childNodes.length;o++)m+=s[r].childNodes[o].nodeValue;return p&&y.on("add",function(e){y.bindPopup("<h2>"+p+"</h2>"+m)}),y}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(e,t,n){var a=this.parseCoords(e);if(a.length)return new L.Polyline(a,n)},parseTrack:function(e,t,n){var a=t.getElementsByTagName("gx:coord");0===a.length&&(a=t.getElementsByTagName("coord"));for(var r=[],o=0;o<a.length;o++)r=r.concat(this._read_gxcoords(a[o]));return r.length?new L.Polyline(r,n):void 0},parsePoint:function(e,t,n){var a=e.getElementsByTagName("coordinates");if(a.length){var r=a[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(r[1],r[0]),n)}},parsePolygon:function(e,t,n){var a,r,o,s=[],l=[];for(a=e.getElementsByTagName("outerBoundaryIs"),r=0;r<a.length;r++)o=this.parseCoords(a[r]),o&&s.push(o);for(a=e.getElementsByTagName("innerBoundaryIs"),r=0;r<a.length;r++)o=this.parseCoords(a[r]),o&&l.push(o);return s.length?(n.fillColor&&(n.fill=!0),1===s.length?new L.Polygon(s.concat(l),n):new L.MultiPolygon(s,n)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],a=0;a<t.length;a++)n=n.concat(this._read_coords(t[a]));return n},_read_coords:function(e){var t,n="",a=[];for(t=0;t<e.childNodes.length;t++)n+=e.childNodes[t].nodeValue;for(n=n.split(/[\s\n]+/),t=0;t<n.length;t++){var r=n[t].split(",");r.length<2||a.push(new L.LatLng(r[1],r[0]))}return a},_read_gxcoords:function(e){var t="",n=[];return t=e.firstChild.nodeValue.split(" "),n.push(new L.LatLng(t[1],t[0])),n},parseGroundOverlay:function(e){function t(e){for(var n={},a={},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o],l=s.tagName;if(r[l]){var i=s.childNodes[0].nodeValue;"Icon"===l?(a=t(s),a.href&&(n.href=a.href)):"href"===l?n.href=i:"color"===l&&(n.opacity=parseInt(i.substring(0,2),16)/255,n.color="#"+i.substring(6,8)+i.substring(4,6)+i.substring(2,4))}}return n}var n=e.getElementsByTagName("LatLonBox")[0],a=new L.LatLngBounds([n.getElementsByTagName("south")[0].childNodes[0].nodeValue,n.getElementsByTagName("west")[0].childNodes[0].nodeValue],[n.getElementsByTagName("north")[0].childNodes[0].nodeValue,n.getElementsByTagName("east")[0].childNodes[0].nodeValue]),r={Icon:!0,href:!0,color:!0},o={};if(o=t(e),void 0!==n.getElementsByTagName("rotation")[0]){var s=n.getElementsByTagName("rotation")[0].childNodes[0].nodeValue;o.rotation=parseFloat(s)}return new L.RotatedImageOverlay(o.href,a,{opacity:o.opacity,angle:o.rotation})}}),L.KMLIcon=L.Icon.extend({_setIconStyles:function(e,t){L.Icon.prototype._setIconStyles.apply(this,[e,t]);var n=this.options;this.options.popupAnchor=[0,-.83*e.height],"fraction"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x*e.width+"px"),"fraction"===n.anchorType.y&&(e.style.marginTop=-(1-n.anchorRef.y)*e.height+"px"),"pixels"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x+"px"),"pixels"===n.anchorType.y&&(e.style.marginTop=n.anchorRef.y-e.height+1+"px")}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.RotatedImageOverlay=L.ImageOverlay.extend({options:{angle:0},_reset:function(){L.ImageOverlay.prototype._reset.call(this),this._rotate()},_animateZoom:function(e){L.ImageOverlay.prototype._animateZoom.call(this,e),this._rotate()},_rotate:function(){if(L.DomUtil.TRANSFORM)this._image.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var e=this.options.angle*(Math.PI/180),t=Math.cos(e),n=Math.sin(e);this._image.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+t+", M12="+-n+", M21="+n+", M22="+t+")"}},getBounds:function(){return this._bounds}});
//# sourceMappingURL=./1.3.5/layer/vector/KML.min.js.map