L.GPX=L.FeatureGroup.extend({initialize:function(t,e){L.Util.setOptions(this,e),this._gpx=t,this._layers={},t&&this.addGPX(t,e,this.options.async)},loadXML:function(t,e,n,a){void 0==a&&(a=this.options.async),void 0==n&&(n=this.options);var r=new window.XMLHttpRequest;r.open("GET",t,a);try{r.overrideMimeType("text/xml")}catch(i){}r.onreadystatechange=function(){4==r.readyState&&200==r.status&&e(r.responseXML,n)},r.send(null)},addGPX:function(t,e,n){var a=this,r=function(t,e){a._addGPX(t,e)};this.loadXML(t,r,e,n)},_addGPX:function(t,e){var n=this.parseGPX(t,e);n&&(this.addLayer(n),this.fire("loaded"))},parseGPX:function(t,e){var n,a,r,i=[],s=!1,o=[["rte","rtept"],["trkseg","trkpt"]];for(n=0;n<o.length;n++)for(r=t.getElementsByTagName(o[n][0]),a=0;a<r.length;a++)for(var d=this.parse_trkseg(r[a],t,e,o[n][1]),h=0;h<d.length;h++)this.parse_name(r[a],d[h])&&(s=!0),i.push(d[h]);if(r=t.getElementsByTagName("wpt"),0!=e.display_wpt)for(a=0;a<r.length;a++){var d=this.parse_wpt(r[a],t,e);d&&(this.parse_name(r[a],d)&&(s=!0),i.push(d))}if(i.length){var l=i[0];return i.length>1&&(l=new L.FeatureGroup(i)),l}},parse_name:function(t,e){var n,a,r,i="";for(a=t.getElementsByTagName("name"),a.length&&(r=a[0].childNodes[0].nodeValue),a=t.getElementsByTagName("desc"),n=0;n<a.length;n++)for(var s=0;s<a[n].childNodes.length;s++)i+=a[n].childNodes[s].nodeValue;if(r){var o="<h2>"+r+"</h2>"+i;return e&&void 0===e._popup&&e.bindPopup(o),o}},parse_trkseg:function(t,e,n,a){var r=t.getElementsByTagName(a);if(!r.length)return[];for(var i=[],s=0;s<r.length;s++){var o=new L.LatLng(r[s].getAttribute("lat"),r[s].getAttribute("lon"));o.meta={};for(var d in r[s].childNodes){var h=r[s].childNodes[d];h.tagName&&(o.meta[h.tagName]=h.textContent)}i.push(o)}var l=[new L.Polyline(i,n)];return this.fire("addline",{line:l}),l},parse_wpt:function(t,e,n){var a=new L.Marker(new L.LatLng(t.getAttribute("lat"),t.getAttribute("lon")),n);return this.fire("addpoint",{point:a}),a}});
//# sourceMappingURL=./1.0.0/layer/vector/GPX.min.js.map