L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._kml=e,this._layers={},e&&this.addKML(e,t,this.options.async)},loadXML:function(e,t,n,o){void 0===o&&(o=this.options.async),void 0===n&&(n=this.options);var r=new window.XMLHttpRequest;if(void 0===r.withCredentials&&"undefined"!=typeof window.XDomainRequest){var a=new window.XDomainRequest;a.open("GET",e,o),a.onprogress=function(){},a.ontimeout=function(){},a.onerror=function(){},a.onload=function(){if(a.responseText){var e=new window.ActiveXObject("Microsoft.XMLDOM");e.loadXML(a.responseText),t(e,n)}},setTimeout(function(){a.send()},0)}else{r.open("GET",e,o),r.setRequestHeader("Accept","application/vnd.google-earth.kml+xml");try{r.overrideMimeType("text/xml")}catch(s){}r.onreadystatechange=function(){4===r.readyState&&200===r.status&&t(r.responseXML,n)},r.send(null)}},addKML:function(e,t,n){var o=this,r=function(e){o._addKML(e)};this.loadXML(e,r,t,n)},_addKML:function(e){var t=L.KML.parseKML(e);if(t&&t.length){for(var n=0;n<t.length;n++)this.fire("addlayer",{layer:t[n]}),this.addLayer(t[n]);this.latLngs=L.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(e){var t=this.parseStyles(e);this.parseStyleMap(e,t);for(var n,o=e.getElementsByTagName("Folder"),r=[],a=0;a<o.length;a++)this._check_folder(o[a])&&(n=this.parseFolder(o[a],t),n&&r.push(n));o=e.getElementsByTagName("Placemark");for(var s=0;s<o.length;s++)this._check_folder(o[s])&&(n=this.parsePlacemark(o[s],e,t),n&&r.push(n));o=e.getElementsByTagName("GroundOverlay");for(var i=0;i<o.length;i++)n=this.parseGroundOverlay(o[i]),n&&r.push(n);return r},_check_folder:function(e,t){for(e=e.parentNode;e&&"Folder"!==e.tagName;)e=e.parentNode;return!e||e===t},parseStyles:function(e){for(var t={},n=e.getElementsByTagName("Style"),o=0,r=n.length;r>o;o++){var a=this.parseStyle(n[o]);if(a){var s="#"+a.id;t[s]=a}}return t},parseStyle:function(e){function t(e){for(var n={},o=0;o<e.childNodes.length;o++){var r=e.childNodes[o],a=r.tagName;if(i[a])if("hotSpot"===a)for(var l=0;l<r.attributes.length;l++)n[r.attributes[l].name]=r.attributes[l].nodeValue;else{var h=r.childNodes[0].nodeValue;"color"===a?(n.opacity=parseInt(h.substring(0,2),16)/255,n.color="#"+h.substring(6,8)+h.substring(4,6)+h.substring(2,4)):"width"===a?n.weight=h:"Icon"===a?(s=t(r),s.href&&(n.href=s.href)):"href"===a&&(n.href=h)}}return n}var n,o,r={},a={},s={},i={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0};return n=e.getElementsByTagName("LineStyle"),n&&n[0]&&(r=t(n[0])),n=e.getElementsByTagName("PolyStyle"),n&&n[0]&&(a=t(n[0])),a.color&&(r.fillColor=a.color),a.opacity&&(r.fillOpacity=a.opacity),n=e.getElementsByTagName("IconStyle"),n&&n[0]&&(s=t(n[0])),s.href&&(r.icon=new L.KMLIcon({iconUrl:s.href,shadowUrl:null,anchorRef:{x:s.x,y:s.y},anchorType:{x:s.xunits,y:s.yunits}})),o=e.getAttribute("id"),o&&r&&(r.id=o),r},parseStyleMap:function(e,t){for(var n=e.getElementsByTagName("StyleMap"),o=0;o<n.length;o++){var r,a,s,i=n[o];r=i.getElementsByTagName("key"),r&&r[0]&&(a=r[0].textContent),r=i.getElementsByTagName("styleUrl"),r&&r[0]&&(s=r[0].textContent),"normal"===a&&(t["#"+i.getAttribute("id")]=t[s])}},parseFolder:function(e,t){var n,o,r=[];n=e.getElementsByTagName("Folder");for(var a=0;a<n.length;a++)this._check_folder(n[a],e)&&(o=this.parseFolder(n[a],t),o&&r.push(o));n=e.getElementsByTagName("Placemark");for(var s=0;s<n.length;s++)this._check_folder(n[s],e)&&(o=this.parsePlacemark(n[s],e,t),o&&r.push(o));n=e.getElementsByTagName("GroundOverlay");for(var i=0;i<n.length;i++)this._check_folder(n[i],e)&&(o=this.parseGroundOverlay(n[i]),o&&r.push(o));if(r.length)return 1===r.length?r[0]:new L.FeatureGroup(r)},parsePlacemark:function(e,t,n,o){var r,a,s,i,l,h,g=o||{};for(l=e.getElementsByTagName("styleUrl"),a=0;a<l.length;a++){var d=l[a].childNodes[0].nodeValue;for(var c in n[d])g[c]=n[d][c]}if(h=e.getElementsByTagName("Style")[0]){var u=this.parseStyle(e);if(u)for(i in u)g[i]=u[i]}var f=["MultiGeometry","MultiTrack","gx:MultiTrack"];for(r in f)for(l=e.getElementsByTagName(f[r]),a=0;a<l.length;a++)return this.parsePlacemark(l[a],t,n,g);var p=[],y=["LineString","Polygon","Point","Track","gx:Track"];for(s in y){var m=y[s];for(l=e.getElementsByTagName(m),a=0;a<l.length;a++){var v=this["parse"+m.replace(/gx:/,"")](l[a],t,g);v&&p.push(v)}}if(p.length){var N=p[0];p.length>1&&(N=new L.FeatureGroup(p));var T,M="";for(l=e.getElementsByTagName("name"),l.length&&l[0].childNodes.length&&(T=l[0].childNodes[0].nodeValue),l=e.getElementsByTagName("description"),a=0;a<l.length;a++)for(s=0;s<l[a].childNodes.length;s++)M+=l[a].childNodes[s].nodeValue;return T&&N.on("add",function(){N.bindPopup("<h2>"+T+"</h2>"+M)}),N}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(e,t,n){var o=this.parseCoords(e);if(o.length)return new L.Polyline(o,n)},parseTrack:function(e,t,n){var o=t.getElementsByTagName("gx:coord");0===o.length&&(o=t.getElementsByTagName("coord"));for(var r=[],a=0;a<o.length;a++)r=r.concat(this._read_gxcoords(o[a]));return r.length?new L.Polyline(r,n):void 0},parsePoint:function(e,t,n){var o=e.getElementsByTagName("coordinates");if(o.length){var r=o[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(r[1],r[0]),n)}},parsePolygon:function(e,t,n){var o,r,a,s=[],i=[];for(o=e.getElementsByTagName("outerBoundaryIs"),r=0;r<o.length;r++)a=this.parseCoords(o[r]),a&&s.push(a);for(o=e.getElementsByTagName("innerBoundaryIs"),r=0;r<o.length;r++)a=this.parseCoords(o[r]),a&&i.push(a);return s.length?(n.fillColor&&(n.fill=!0),1===s.length?new L.Polygon(s.concat(i),n):new L.MultiPolygon(s,n)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],o=0;o<t.length;o++)n=n.concat(this._read_coords(t[o]));return n},_read_coords:function(e){var t,n="",o=[];for(t=0;t<e.childNodes.length;t++)n+=e.childNodes[t].nodeValue;for(n=n.split(/[\s\n]+/),t=0;t<n.length;t++){var r=n[t].split(",");r.length<2||o.push(new L.LatLng(r[1],r[0]))}return o},_read_gxcoords:function(e){var t="",n=[];return t=e.firstChild.nodeValue.split(" "),n.push(new L.LatLng(t[1],t[0])),n},parseGroundOverlay:function(e){function t(e){for(var n={},o={},a=0;a<e.childNodes.length;a++){var s=e.childNodes[a],i=s.tagName;if(r[i]){var l=s.childNodes[0].nodeValue;"Icon"===i?(o=t(s),o.href&&(n.href=o.href)):"href"===i?n.href=l:"color"===i&&(n.opacity=parseInt(l.substring(0,2),16)/255,n.color="#"+l.substring(6,8)+l.substring(4,6)+l.substring(2,4))}}return n}var n=e.getElementsByTagName("LatLonBox")[0],o=new L.LatLngBounds([n.getElementsByTagName("south")[0].childNodes[0].nodeValue,n.getElementsByTagName("west")[0].childNodes[0].nodeValue],[n.getElementsByTagName("north")[0].childNodes[0].nodeValue,n.getElementsByTagName("east")[0].childNodes[0].nodeValue]),r={Icon:!0,href:!0,color:!0},a={};if(a=t(e),void 0!==n.getElementsByTagName("rotation")[0]){var s=n.getElementsByTagName("rotation")[0].childNodes[0].nodeValue;a.rotation=parseFloat(s)}return new L.RotatedImageOverlay(a.href,o,{opacity:a.opacity,angle:a.rotation})}}),L.KMLIcon=L.Icon.extend({_setIconStyles:function(e,t){L.Icon.prototype._setIconStyles.apply(this,[e,t]);var n=this.options;this.options.popupAnchor=[0,-.83*e.height],"fraction"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x*e.width+"px"),"fraction"===n.anchorType.y&&(e.style.marginTop=-(1-n.anchorRef.y)*e.height+1+"px"),"pixels"===n.anchorType.x&&(e.style.marginLeft=-n.anchorRef.x+"px"),"pixels"===n.anchorType.y&&(e.style.marginTop=n.anchorRef.y-e.height+1+"px")}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.RotatedImageOverlay=L.ImageOverlay.extend({options:{angle:0},_reset:function(){L.ImageOverlay.prototype._reset.call(this),this._rotate()},_animateZoom:function(e){L.ImageOverlay.prototype._animateZoom.call(this,e),this._rotate()},_rotate:function(){if(L.DomUtil.TRANSFORM)this._image.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var e=this.options.angle*(Math.PI/180),t=Math.cos(e),n=Math.sin(e);this._image.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+t+", M12="+-n+", M21="+n+", M22="+t+")"}},getBounds:function(){return this._bounds}});
//# sourceMappingURL=./1.6.0/layer/vector/KML.min.js.map