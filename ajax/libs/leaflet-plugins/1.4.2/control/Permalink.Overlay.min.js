L.Control.Permalink.include({initialize_overlay:function(){this.on("update",this._set_overlays,this),this.on("add",this._onadd_overlay,this)},_onadd_overlay:function(e){this._map.on("overlayadd",this._update_overlay,this),this._map.on("overlayremove",this._update_overlay,this),this._update_overlay()},_update_overlay:function(){if(this.options.layers){var overlayflags=this.options.layers.overlayFlags();overlayflags&&""!==overlayflags&&this._update({overlays:overlayflags})}},_set_overlays:function(e){var p=e.params;this.options.layers&&p.overlays&&this.options.layers.setOverlays(p.overlays)}}),L.Control.Layers.include({setOverlays:function(overlayflags){var obj,idx=0;for(var i in this._layers)if(this._layers.hasOwnProperty(i)&&(obj=this._layers[i],obj.overlay)){var visible=idx>=overlayflags.length||"T"===overlayflags[idx];idx++,!visible&&this._map.hasLayer(obj.layer)?this._map.removeLayer(obj.layer):visible&&!this._map.hasLayer(obj.layer)&&this._map.addLayer(obj.layer)}},overlayFlags:function(){var flags="";for(var i in this._layers)if(this._layers.hasOwnProperty(i)){var obj=this._layers[i];obj.overlay&&obj.overlay&&(flags+=this._map.hasLayer(obj.layer)?"T":"F")}return flags}});