!function(){function d2h(d){var hex="0123456789ABCDEF",r="";for(d=Math.floor(d);0!==d;)r=hex[d%16]+r,d=Math.floor(d/16);for(;r.length<2;)r="0"+r;return r}function gradient(color){function f2h(d){return d2h(256*d)}return 0>color?"#FF0000":1/3>color?"#FF"+f2h(3*color)+"00":2/3>color?"#"+f2h(2-3*color)+"FF00":1>color?"#00FF"+f2h(3*color-2):"#00FFFF"}function gpx2time(s){return 20!==s.length?new Date:new Date(s)}L.GPX.include({options:{maxSpeed:110,chunks:200},speedSplitEnable:function(options){return L.Util.setOptions(this,options),this.on("addline",this.speed_split,this)},speedSplitDisable:function(){return this.off("addline",this.speed_split,this)},speed_split:function(e){var l=e.line.pop(),ll=l.getLatLngs(),chunk=Math.floor(ll.length/this.options.chunks);3>chunk&&(chunk=3);for(var p=null,i=0;i<ll.length;i+=chunk){var d=0,t=null;i+chunk>ll.length&&(chunk=ll.length-i);for(var j=0;chunk>j;j++)p&&(d+=p.distanceTo(ll[i+j])),p=ll[i+j],t||(t=gpx2time(p.meta.time));p=ll[i+chunk-1],t=(gpx2time(p.meta.time)-t)/36e5;var speed=.001*d/t,color=gradient(speed/this.options.maxSpeed),poly=new L.Polyline(ll.slice(i,i+chunk+1),{color:color,weight:2,opacity:1});poly.bindPopup("Dist: "+d.toFixed()+"m; Speed: "+speed.toFixed(2)+" km/h"),e.line.push(poly)}}})}();