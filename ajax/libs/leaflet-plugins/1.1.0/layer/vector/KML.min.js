L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._kml=e,this._layers={},e&&this.addKML(e,t,this.options.async)},loadXML:function(e,t,n,r){void 0==r&&(r=this.options.async),void 0==n&&(n=this.options);var o=new window.XMLHttpRequest;o.open("GET",e,r);try{o.overrideMimeType("text/xml")}catch(a){}o.onreadystatechange=function(){4==o.readyState&&200==o.status&&t(o.responseXML,n)},o.send(null)},addKML:function(e,t,n){var r=this,o=function(e,t){r._addKML(e,t)};this.loadXML(e,o,t,n)},_addKML:function(e,t){var n=L.KML.parseKML(e);if(n&&n.length){for(var r=0;r<n.length;r++)this.fire("addlayer",{layer:n[r]}),this.addLayer(n[r]);this.latLngs=L.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(e){var t=this.parseStyle(e);this.parseStyleMap(e,t);for(var n,r=e.getElementsByTagName("Folder"),o=[],a=0;a<r.length;a++)this._check_folder(r[a])&&(n=this.parseFolder(r[a],t),n&&o.push(n));r=e.getElementsByTagName("Placemark");for(var s=0;s<r.length;s++)this._check_folder(r[s])&&(n=this.parsePlacemark(r[s],e,t),n&&o.push(n));return o},_check_folder:function(e,t){for(e=e.parentElement;e&&"Folder"!==e.tagName;)e=e.parentElement;return!e||e===t},parseStyle:function(e){function t(e){for(var n={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r],s=a.tagName;if(o[s])if("hotSpot"===s)for(var i=0;i<a.attributes.length;i++)n[a.attributes[i].name]=a.attributes[i].nodeValue;else{var l=a.childNodes[0].nodeValue;"color"===s?(n.opacity=parseInt(l.substring(0,2),16)/255,n.color="#"+l.substring(6,8)+l.substring(4,6)+l.substring(2,4)):"width"===s?n.weight=l:"Icon"===s?(c=t(a),c.href&&(n.href=c.href)):"href"===s&&(n.href=l)}}return n}for(var n={},r=e.getElementsByTagName("Style"),o={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},a=0;a<r.length;a++){var s,i=r[a],l={},h={},c={};s=i.getElementsByTagName("LineStyle"),s&&s[0]&&(l=t(s[0])),s=i.getElementsByTagName("PolyStyle"),s&&s[0]&&(h=t(s[0])),h.color&&(l.fillColor=h.color),h.opacity&&(l.fillOpacity=h.opacity),s=i.getElementsByTagName("IconStyle"),s&&s[0]&&(c=t(s[0])),c.href&&(l.icon=new L.KMLIcon({iconUrl:c.href,shadowUrl:null,iconAnchorRef:{x:c.x,y:c.y},iconAnchorType:{x:c.xunits,y:c.yunits}})),n["#"+i.getAttribute("id")]=l}return n},parseStyleMap:function(e,t){for(var n=e.getElementsByTagName("StyleMap"),r=0;r<n.length;r++){var o,a,s,i=n[r];o=i.getElementsByTagName("key"),o&&o[0]&&(a=o[0].textContent),o=i.getElementsByTagName("styleUrl"),o&&o[0]&&(s=o[0].textContent),"normal"==a&&(t["#"+i.getAttribute("id")]=t[s])}},parseFolder:function(e,t){var n,r,o=[];n=e.getElementsByTagName("Folder");for(var a=0;a<n.length;a++)this._check_folder(n[a],e)&&(r=this.parseFolder(n[a],t),r&&o.push(r));n=e.getElementsByTagName("Placemark");for(var s=0;s<n.length;s++)this._check_folder(n[s],e)&&(r=this.parsePlacemark(n[s],e,t),r&&o.push(r));if(o.length)return 1===o.length?o[0]:new L.FeatureGroup(o)},parsePlacemark:function(e,t,n){var r,o,a,s={};for(a=e.getElementsByTagName("styleUrl"),r=0;r<a.length;r++){var i=a[r].childNodes[0].nodeValue;for(var l in n[i])s[l]=n[i][l]}var h=[],c=["LineString","Polygon","Point"];for(o in c){var g=c[o];for(a=e.getElementsByTagName(g),r=0;r<a.length;r++){var d=this["parse"+g](a[r],t,s);d&&h.push(d)}}if(h.length){var p=h[0];h.length>1&&(p=new L.FeatureGroup(h));var y,u="";for(a=e.getElementsByTagName("name"),a.length&&a[0].childNodes.length&&(y=a[0].childNodes[0].nodeValue),a=e.getElementsByTagName("description"),r=0;r<a.length;r++)for(o=0;o<a[r].childNodes.length;o++)u+=a[r].childNodes[o].nodeValue;return y&&p.bindPopup("<h2>"+y+"</h2>"+u),p}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(e,t,n){var r=this.parseCoords(e);if(r.length)return new L.Polyline(r,n)},parsePoint:function(e,t,n){var r=e.getElementsByTagName("coordinates");if(r.length){var o=r[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(o[1],o[0]),n)}},parsePolygon:function(e,t,n){var r,o,a,s=[],i=[];for(r=e.getElementsByTagName("outerBoundaryIs"),o=0;o<r.length;o++)a=this.parseCoords(r[o]),a&&s.push(a);for(r=e.getElementsByTagName("innerBoundaryIs"),o=0;o<r.length;o++)a=this.parseCoords(r[o]),a&&i.push(a);return s.length?(n.fillColor&&(n.fill=!0),1===s.length?new L.Polygon(s.concat(i),n):new L.MultiPolygon(s,n)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),n=[],r=0;r<t.length;r++)n=n.concat(this._read_coords(t[r]));return n},_read_coords:function(e){var t,n="",r=[];for(t=0;t<e.childNodes.length;t++)n+=e.childNodes[t].nodeValue;for(n=n.split(/[\s\n]+/),t=0;t<n.length;t++){var o=n[t].split(",");o.length<2||r.push(new L.LatLng(o[1],o[0]))}return r}}),L.KMLIcon=L.Icon.extend({createIcon:function(){var e=this._createIcon("icon");return e.onload=function(){var t=e;this.style.width=t.width+"px",this.style.height=t.height+"px","UNITS_FRACTION"!==this.anchorType.x&&"fraction"!==this.anchorType.x||(e.style.marginLeft=-this.anchor.x*t.width+"px"),"UNITS_FRACTION"!==this.anchorType.y&&"fraction"!==this.anchorType.x||(e.style.marginTop=-(1-this.anchor.y)*t.height+"px"),this.style.display=""},e},_setIconStyles:function(e,t){L.Icon.prototype._setIconStyles.apply(this,[e,t]),e.anchor=this.options.iconAnchorRef,e.anchorType=this.options.iconAnchorType}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}});
//# sourceMappingURL=./1.1.0/layer/vector/KML.min.js.map