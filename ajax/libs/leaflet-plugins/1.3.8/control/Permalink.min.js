L.Control.Permalink=L.Control.extend({includes:L.Mixin.Events,options:{position:"bottomleft",useAnchor:!0,useLocation:!1,text:"Permalink"},initialize:function(t){L.Util.setOptions(this,t),this._params={},this._set_urlvars(),this.on("update",this._set_center,this);for(var i in this)"string"==typeof i&&0===i.indexOf("initialize_")&&this[i]()},onAdd:function(t){if(this._container=L.DomUtil.create("div","leaflet-control-attribution leaflet-control-permalink"),L.DomEvent.disableClickPropagation(this._container),this._map=t,this._href=L.DomUtil.create("a",null,this._container),this._href.innerHTML=this.options.text,t.on("moveend",this._update_center,this),this.fire("update",{params:this._params}),this._update_center(),this.options.useAnchor&&"onhashchange"in window){var i=this,r=window.onhashchange;window.onhashchange=function(){return i._set_urlvars(),r?r():void 0}}return this.fire("add",{map:t}),this._container},_update_center:function(){if(this._map){var t=this._round_point(this._map.getCenter());this._update({zoom:String(this._map.getZoom()),lat:String(t.lat),lon:String(t.lng)})}},_update_href:function(){var t=L.Util.getParamString(this._params),i="?";this.options.useAnchor&&(i="#");var r=this._url_base+i+t.slice(1);return this._href&&this._href.setAttribute("href",r),this.options.useLocation&&location.replace("#"+t.slice(1)),r},_round_point:function(t){var i=this._map.getBounds(),r=this._map.getSize(),n=i.getNorthEast(),e=i.getSouthWest(),a=function(t,i){if(0===i)return t;for(var r=1;1>i&&i>-1;)t*=10,i*=10,r*=10;return Math.floor(t)/r};return t.lat=a(t.lat,(n.lat-e.lat)/r.y),t.lng=a(t.lng,(n.lng-e.lng)/r.x),t},_update:function(t,i){for(var r in t)t.hasOwnProperty(r)&&(null!==t[r]&&void 0!==t[r]?this._params[r]=t[r]:delete this._params[r]);this._update_href()},_set_urlvars:function(){function t(t,i){for(var r in t)if(t.hasOwnProperty(r)&&t[r]!==i[r])return!1;return!0}this._url_base=window.location.href.split("#")[0].split("?")[0];var i;i=this.options.useAnchor?L.UrlUtil.queryParse(L.UrlUtil.hash()):L.UrlUtil.queryParse(L.UrlUtil.query()),t(i,this._params)&&t(this._params,i)||(this._params=i,this._update_href(),this.fire("update",{params:this._params}))},_set_center:function(t){var i=t.params;void 0!==i.zoom&&void 0!==i.lat&&void 0!==i.lon&&this._map.setView(new L.LatLng(i.lat,i.lon),i.zoom)}}),L.UrlUtil={queryParse:function(t){var i={},r="&";-1!==t.search("&amp;")&&(r="&amp;");for(var n=t.split(r),e=0;e<n.length;e++){var a=n[e].split("=");2===a.length&&(i[a[0]]=decodeURI(a[1]))}return i},query:function(){var t=window.location.href.split("#")[0],i=t.indexOf("?");return 0>i?"":t.slice(i+1)},hash:function(){return window.location.hash.slice(1)},updateParamString:function(t,i){var r=L.UrlUtil.queryParse(t);for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);return L.Util.getParamString(r).slice(1)}};
//# sourceMappingURL=./1.3.8/control/Permalink.min.js.map