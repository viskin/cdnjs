(function(a,b){if(typeof define==="function"&&define.amd){define(b(window))}else{if(typeof exports==="object"){if(typeof window==="object"&&window.DOMImplementation){module.exports=b(window)}else{module.exports=b(require("xmldom"))}}else{a.JXON=b(window)}}}(this,function(a){return new (function(){var n="keyValue",e="keyAttributes",r="@",d=true,j=true,b=true,c=false,f,p,o=true,l=[],m=/^\s*$/,h=/^(?:true|false)$/i;function k(t){if(!o){return t}if(m.test(t)){return null}if(h.test(t)){return t.toLowerCase()==="true"}if(isFinite(t)){return parseFloat(t)}if(b&&isFinite(Date.parse(t))){return new Date(t)}return t}function i(){}i.prototype.toString=function(){return"null"};i.prototype.valueOf=function(){return null};function s(t){return t===null?new i():t instanceof Object?t:new t.constructor(t)}function g(t,x,J,u){var O=l.length,z=t.hasChildNodes(),H=t.nodeType===t.ELEMENT_NODE&&t.hasAttributes(),Q=Boolean(x&2);var y,L,D=0,A="",N=Q?{}:(j?true:"");if(z){for(var C,P=0;P<t.childNodes.length;P++){C=t.childNodes.item(P);if(C.nodeType===4){A+=C.nodeValue}else{if(C.nodeType===3){A+=C.nodeValue.trim()}else{if(C.nodeType===1&&!(c&&C.prefix)){l.push(C)}}}}}var w=l.length,I=k(A);if(!Q&&(z||H)){N=x===0?s(I):{}}for(var E=O;E<w;E++){y=l[E].nodeName;if(d){y=y.toLowerCase()}L=g(l[E],x,J,u);if(N.hasOwnProperty(y)){if(N[y].constructor!==Array){N[y]=[N[y]]}N[y].push(L)}else{N[y]=L;D++}}if(H){var F=t.attributes.length,B=u?"":r,v=u?{}:N;for(var G,M,K=0;K<F;D++,K++){G=t.attributes.item(K);M=G.name;if(d){M=M.toLowerCase()}v[B+M]=k(G.value.trim())}if(u){if(J){Object.freeze(v)}N[e]=v;D-=F-1}}if(x===3||(x===2||x===1&&D>0)&&A){N[n]=I}else{if(!Q&&D===0&&A){N=I}}if(J&&(Q||D>0)){Object.freeze(N)}l.length=O;return N}function q(v,z,A){var x,w;if(A.constructor===String||A.constructor===Number||A.constructor===Boolean){z.appendChild(v.createTextNode(A.toString()));if(A===A.valueOf()){return}}else{if(A.constructor===Date){z.appendChild(v.createTextNode(A.toGMTString()))}}for(var y in A){x=A[y];if(x===null){x={}}if(isFinite(y)||x instanceof Function){continue}if(y===n){if(x!==null&&x!==true){z.appendChild(v.createTextNode(x.constructor===Date?x.toGMTString():String(x)))}}else{if(y===e){for(var t in x){z.setAttribute(t,x[t])}}else{if(y===r+"xmlns"){}else{if(y.charAt(0)===r){z.setAttribute(y.slice(1),x)}else{if(x.constructor===Array){for(var u=0;u<x.length;u++){w=v.createElementNS(x[u][r+"xmlns"]||z.namespaceURI,y);q(v,w,x[u]);z.appendChild(w)}}else{w=v.createElementNS((x||{})[r+"xmlns"]||z.namespaceURI,y);if(x instanceof Object){q(v,w,x)}else{if(x!==null&&x!==true){w.appendChild(v.createTextNode(x.toString()))}else{if(!j&&x===true){w.appendChild(v.createTextNode(x.toString()))}}}z.appendChild(w)}}}}}}}this.xmlToJs=this.build=function(x,w,v,u){var t=arguments.length>1&&typeof w==="number"?w&3:1;return g(x,t,v||false,arguments.length>3?u:t===3)};this.jsToXml=this.unbuild=function(v,x,u,y){var t=a.document&&a.document.implementation||new a.DOMImplementation();var w=t.createDocument(x||null,u||"",y||null);q(w,w.documentElement||w,v);return w};this.config=function(u){if(typeof u==="undefined"){return{valueKey:n,attrKey:e,attrPrefix:r,lowerCaseTags:d,trueIsEmpty:j,autoDate:b,ignorePrefixNodes:c,parseValues:o,parserErrorHandler:f}}for(var t in u){switch(t){case"valueKey":n=u.valueKey;break;case"attrKey":e=u.attrKey;break;case"attrPrefix":r=u.attrPrefix;break;case"lowerCaseTags":d=u.lowerCaseTags;break;case"trueIsEmpty":j=u.trueIsEmpty;break;case"autoDate":b=u.autoDate;break;case"ignorePrefixedNodes":c=u.ignorePrefixedNodes;break;case"parseValues":o=u.parseValues;break;case"parserErrorHandler":f=u.parserErrorHandler;p=new a.DOMParser({errorHandler:f,locator:{}});break;default:break}}};this.stringToXml=function(t){if(!p){p=new a.DOMParser()}return p.parseFromString(t,"application/xml")};this.xmlToString=function(t){if(typeof t.xml!=="undefined"){return t.xml}else{return(new a.XMLSerializer()).serializeToString(t)}};this.stringToJs=function(u){var t=this.stringToXml(u);return this.xmlToJs(t)};this.jsToString=this.stringify=function(u,v,t,w){return this.xmlToString(this.jsToXml(u,v,t,w))}})()}));