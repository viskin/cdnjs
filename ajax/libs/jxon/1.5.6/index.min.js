(function(a,b){if(typeof define==="function"&&define.amd){define(b(window))}else{if(typeof exports==="object"){if(typeof window==="object"&&window.DOMImplementation){module.exports=b(window)}else{module.exports=b(require("xmldom"))}}else{a.JXON=b(window)}}}(this,function(a){return new (function(){var o="keyValue",e="keyAttributes",n="@",k=true,c=true,q=true,b=false,h=true,l=[],d=/^\s*$/,p=/^(?:true|false)$/i;function m(r){if(!h){return r}if(d.test(r)){return null}if(p.test(r)){return r.toLowerCase()==="true"}if(isFinite(r)){return parseFloat(r)}if(q&&isFinite(Date.parse(r))){return new Date(r)}return r}function j(){}j.prototype.toString=function(){return"null"};j.prototype.valueOf=function(){return null};function f(r){return r===null?new j():r instanceof Object?r:new r.constructor(r)}function i(r,v,H,s){var M=l.length,x=r.hasChildNodes(),F=r.nodeType===r.ELEMENT_NODE&&r.hasAttributes(),O=Boolean(v&2);var w,J,B=0,y="",L=O?{}:(c?true:"");if(x){for(var A,N=0;N<r.childNodes.length;N++){A=r.childNodes.item(N);if(A.nodeType===4){y+=A.nodeValue}else{if(A.nodeType===3){y+=A.nodeValue.trim()}else{if(A.nodeType===1&&!(b&&A.prefix)){l.push(A)}}}}}var u=l.length,G=m(y);if(!O&&(x||F)){L=v===0?f(G):{}}for(var C=M;C<u;C++){w=l[C].nodeName;if(k){w=w.toLowerCase()}J=i(l[C],v,H,s);if(L.hasOwnProperty(w)){if(L[w].constructor!==Array){L[w]=[L[w]]}L[w].push(J)}else{L[w]=J;B++}}if(F){var D=r.attributes.length,z=s?"":n,t=s?{}:L;for(var E,K,I=0;I<D;B++,I++){E=r.attributes.item(I);K=E.name;if(k){K=K.toLowerCase()}t[z+K]=m(E.value.trim())}if(s){if(H){Object.freeze(t)}L[e]=t;B-=D-1}}if(v===3||(v===2||v===1&&B>0)&&y){L[o]=G}else{if(!O&&B===0&&y){L=G}}if(H&&(O||B>0)){Object.freeze(L)}l.length=M;return L}function g(t,x,y){var v,u;if(y.constructor===String||y.constructor===Number||y.constructor===Boolean){x.appendChild(t.createTextNode(y.toString()));if(y===y.valueOf()){return}}else{if(y.constructor===Date){x.appendChild(t.createTextNode(y.toGMTString()))}}for(var w in y){v=y[w];if(v===null){v={}}if(isFinite(w)||v instanceof Function){continue}if(w===o){if(v!==null&&v!==true){x.appendChild(t.createTextNode(v.constructor===Date?v.toGMTString():String(v)))}}else{if(w===e){for(var r in v){x.setAttribute(r,v[r])}}else{if(w===n+"xmlns"){}else{if(w.charAt(0)===n){x.setAttribute(w.slice(1),v)}else{if(v.constructor===Array){for(var s=0;s<v.length;s++){u=t.createElementNS(v[s][n+"xmlns"]||x.namespaceURI,w);g(t,u,v[s]);x.appendChild(u)}}else{u=t.createElementNS((v||{})[n+"xmlns"]||x.namespaceURI,w);if(v instanceof Object){g(t,u,v)}else{if(v!==null&&v!==true){u.appendChild(t.createTextNode(v.toString()))}else{if(!c&&v===true){u.appendChild(t.createTextNode(v.toString()))}}}x.appendChild(u)}}}}}}}this.xmlToJs=this.build=function(v,u,t,s){var r=arguments.length>1&&typeof u==="number"?u&3:1;return i(v,r,t||false,arguments.length>3?s:r===3)};this.jsToXml=this.unbuild=function(t,v,s,w){var r=a.document&&a.document.implementation||new a.DOMImplementation();var u=r.createDocument(v||null,s||"",w||null);g(u,u.documentElement||u,t);return u};this.config=function(s){if(typeof s==="undefined"){return{valueKey:o,attrKey:e,attrPrefix:n,lowerCaseTags:k,trueIsEmpty:c,autoDate:q,ignorePrefixNodes:b,parseValues:h}}for(var r in s){switch(r){case"valueKey":o=s.valueKey;break;case"attrKey":e=s.attrKey;break;case"attrPrefix":n=s.attrPrefix;break;case"lowerCaseTags":k=s.lowerCaseTags;break;case"trueIsEmpty":c=s.trueIsEmpty;break;case"autoDate":q=s.autoDate;break;case"ignorePrefixedNodes":b=s.ignorePrefixedNodes;break;case"parseValues":h=s.parseValues;break;default:break}}};this.stringToXml=function(r){return(new a.DOMParser()).parseFromString(r,"application/xml")};this.xmlToString=function(r){if(typeof r.xml!=="undefined"){return r.xml}else{return(new a.XMLSerializer()).serializeToString(r)}};this.stringToJs=function(s){var r=this.stringToXml(s);return this.xmlToJs(r)};this.jsToString=this.stringify=function(s,t,r,u){return this.xmlToString(this.jsToXml(s,t,r,u))}})()}));