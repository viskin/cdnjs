(function(b){if(typeof b.DOMParser==="undefined"){b.DOMParser=require("xmldom").DOMParser;b.document={};b.document.implementation=new (require("xmldom").DOMImplementation)()}var a=new (function(){var p="keyValue",f="keyAttributes",o="@",l=true,d=true,r=true,c=false,i=true,m=[],e=/^\s*$/,q=/^(?:true|false)$/i;function n(s){if(!i){return s}if(e.test(s)){return null}if(q.test(s)){return s.toLowerCase()==="true"}if(isFinite(s)){return parseFloat(s)}if(r&&isFinite(Date.parse(s))){return new Date(s)}return s}function k(){}k.prototype.toString=function(){return"null"};k.prototype.valueOf=function(){return null};function g(s){return s===null?new k():s instanceof Object?s:new s.constructor(s)}function j(s,w,I,t){var N=m.length,y=s.hasChildNodes(),G=s.nodeType===s.ELEMENT_NODE&&s.hasAttributes(),P=Boolean(w&2);var x,K,C=0,z="",M=P?{}:(d?true:"");if(y){for(var B,O=0;O<s.childNodes.length;O++){B=s.childNodes.item(O);if(B.nodeType===4){z+=B.nodeValue}else{if(B.nodeType===3){z+=B.nodeValue.trim()}else{if(B.nodeType===1&&!(c&&B.prefix)){m.push(B)}}}}}var v=m.length,H=n(z);if(!P&&(y||G)){M=w===0?g(H):{}}for(var D=N;D<v;D++){x=m[D].nodeName;if(l){x=x.toLowerCase()}K=j(m[D],w,I,t);if(M.hasOwnProperty(x)){if(M[x].constructor!==Array){M[x]=[M[x]]}M[x].push(K)}else{M[x]=K;C++}}if(G){var E=s.attributes.length,A=t?"":o,u=t?{}:M;for(var F,L,J=0;J<E;C++,J++){F=s.attributes.item(J);L=F.name;if(l){L=L.toLowerCase()}u[A+L]=n(F.value.trim())}if(t){if(I){Object.freeze(u)}M[f]=u;C-=E-1}}if(w===3||(w===2||w===1&&C>0)&&z){M[p]=H}else{if(!P&&C===0&&z){M=H}}if(I&&(P||C>0)){Object.freeze(M)}m.length=N;return M}function h(u,y,z){var w,v;if(z.constructor===String||z.constructor===Number||z.constructor===Boolean){y.appendChild(u.createTextNode(z.toString()));if(z===z.valueOf()){return}}else{if(z.constructor===Date){y.appendChild(u.createTextNode(z.toGMTString()))}}for(var x in z){w=z[x];if(isFinite(x)||w instanceof Function){continue}if(x===p){if(w!==null&&w!==true){y.appendChild(u.createTextNode(w.constructor===Date?w.toGMTString():String(w)))}}else{if(x===f){for(var s in w){y.setAttribute(s,w[s])}}else{if(x.charAt(0)===o&&x!==o+"xmlns"){y.setAttribute(x.slice(1),w)}else{if(w.constructor===Array){for(var t=0;t<w.length;t++){v=u.createElementNS(w[t][o+"xmlns"]||y.namespaceURI,x);h(u,v,w[t]);y.appendChild(v)}}else{v=u.createElementNS((w||{})[o+"xmlns"]||y.namespaceURI,x);if(w instanceof Object){h(u,v,w)}else{if(w!==null&&w!==true){v.appendChild(u.createTextNode(w.toString()))}else{if(!d&&w===true){v.appendChild(u.createTextNode(w.toString()))}}}y.appendChild(v)}}}}}}this.xmlToJs=this.build=function(w,v,u,t){var s=arguments.length>1&&typeof v==="number"?v&3:1;return j(w,s,u||false,arguments.length>3?t:s===3)};this.jsToXml=this.unbuild=function(t,v,s,w){var u=b.document.implementation.createDocument(v||null,s||"",w||null);h(u,u.documentElement||u,t);return u};this.config=function(t){if(typeof t==="undefined"){return{valueKey:p,attrKey:f,attrPrefix:o,lowerCaseTags:l,trueIsEmpty:d,autoDate:r,ignorePrefixNodes:c,parseValues:i}}for(var s in t){switch(s){case"valueKey":p=t.valueKey;break;case"attrKey":f=t.attrKey;break;case"attrPrefix":o=t.attrPrefix;break;case"lowerCaseTags":l=t.lowerCaseTags;break;case"trueIsEmpty":d=t.trueIsEmpty;break;case"autoDate":r=t.autoDate;break;case"ignorePrefixedNodes":c=t.ignorePrefixedNodes;break;case"parseValues":i=t.parseValues;break;default:break}}};this.stringToXml=function(s){return(new b.DOMParser()).parseFromString(s,"application/xml")};this.xmlToString=function(s){if(typeof s.xml!=="undefined"){return s.xml}else{if(typeof b.XMLSerializer==="undefined"){b.XMLSerializer=require("xmldom").XMLSerializer}return(new b.XMLSerializer()).serializeToString(s)}};this.stringToJs=function(t){var s=this.stringToXml(t);return this.xmlToJs(s)};this.jsToString=this.stringify=function(t,u,s,v){return this.xmlToString(this.jsToXml(t,u,s,v))}})();if(typeof module!=="undefined"){module.exports=a}else{if(typeof define==="function"&&define.amd){define(function(){return a})}else{b.JXON=a}}})(typeof window!=="undefined"?window:this);