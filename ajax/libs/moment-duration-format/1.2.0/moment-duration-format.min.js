/*! Moment Duration Format v1.2.0
 *  https://github.com/jsmreese/moment-duration-format 
 *  Date: 2014-04-23
 *
 *  Duration format plugin function for the Moment.js library
 *  http://momentjs.com/
 *
 *  Copyright 2014 John Madhavan-Reese
 *  Released under the MIT license
 */
(function(a,g){function b(j){var i;j=parseInt(j,10);if(!j||j<1){return""}i="";while(j){i+="0";j-=1}return i}function h(k,i,j){if(k==null){k=""}k=""+k;return(j?k:"")+b(i-k.length)+(j?"":k)}function d(l,k){var i=l.length,j;while(i--){if(k(l[i])>0){j=l[i];break}}return j}var e,c,f=(typeof require==="function");if(f){c=require("lodash")||require("underscore")}else{if(a._){c=a._}else{throw"Moment Duration Format cannot find Lo-Dash or Underscore"}}if(f){c=require("moment")}else{if(a.moment){e=a.moment}else{throw"Moment Duration Format cannot find Moment.js"}}e.duration.fn.format=function(){var q,p,l,i,m,n,k,o=[].slice.call(arguments),j=c.extend({},this.format.defaults),r=e.duration(this);j.duration=this;c.each(o,function(s){if(typeof s==="string"||typeof s==="function"){j.template=s;return}if(typeof s==="number"){j.precision=s;return}if(c.isObject(s)){c.extend(j,s)}});l=j.types=(c.isArray(j.types)?j.types:j.types.split(" "));if(typeof j.template==="function"){j.template=j.template.apply(j)}q=new RegExp(c.map(l,function(s){return j[s].source}).join("|"),"g");i=function(s){return c.find(l,function(t){return j[t].test(s)})};p=c.map(j.template.match(q),function(t,s){var u=i(t),v=t.length;return{index:s,length:v,token:(u==="escape"?t.replace(j.escape,"$1"):t),type:((u==="escape"||u==="general")?null:u)}},this);m=c.intersection(l,c.unique(c.compact(c.pluck(p,"type"))));if(!m.length){return c.pluck(p,"token").join("")}c.each(m,function(s,u){var y,v,x,w,t;y=r.as(s);v=(y>0?Math.floor(y):Math.ceil(y));x=y-v;w=((u+1)===m.length);t=(!u);c.each(p,function(z){if(z.type===s){c.extend(z,{value:y,wholeValue:v,decimalValue:x,isLeast:w,isMost:t});if(t){if(j.forceLength==null&&z.length>1){j.forceLength=true}}}});r.subtract(v,s)});if(j.trim){n=false;k=c[j.trim==="left"?"reduce":"reduceRight"](p,function(u,t,s){if(!(n||(t.isLeast||(t.type!=null&&t.wholeValue)))){return s}n=true;return u},-1);if(k!==-1){p=c[j.trim==="left"?"rest":"first"](p,j.trim==="left"?k+1:k)}}n=false;if(j.trim==="right"){p.reverse()}p=c.map(p,function(s){var u,t;if(!s.type){return s.token}if(s.isLeast&&(j.precision<0)){u=(Math.floor(s.wholeValue*Math.pow(10,j.precision))*Math.pow(10,-j.precision)).toString()}else{u=s.wholeValue.toString()}u=u.replace(/^\-/,"");if(s.length>1&&(n||s.isMost||j.forceLength)){u=h(u,s.length)}if(s.isLeast&&(j.precision>0)){t=s.decimalValue.toString().replace(/^\-/,"").split(/\.|e\-/);switch(t.length){case 1:u+="."+h(t[0],j.precision,true).slice(0,j.precision);break;case 2:u+="."+h(t[1],j.precision,true).slice(0,j.precision);break;case 3:u+="."+h(b((+t[2])-1)+(t[0]||"0")+t[1],j.precision,true).slice(0,j.precision);break;default:throw"Moment Duration Format: unable to parse token decimal value."}}if(s.isMost&&s.value<0){u="-"+u}n=true;return u});if(j.trim==="right"){p.reverse()}return p.join("")};e.duration.fn.format.defaults={escape:/\[(.+?)\]/,years:/[Yy]+/,months:/M+/,weeks:/[Ww]+/,days:/[Dd]+/,hours:/[Hh]+/,minutes:/m+/,seconds:/s+/,milliseconds:/S+/,general:/.+?/,types:"escape years months weeks days hours minutes seconds milliseconds general",trim:"left",precision:0,forceLength:null,template:function(){var i=this.types,k=this.duration,j;if(typeof c.findLast==="function"){j=c.findLast(i,function(l){return k._data[l]})}else{j=d(i,function(l){return k._data[l]})}switch(j){case"seconds":return"h:mm:ss";case"minutes":return"d[d] h:mm";case"hours":return"d[d] h[h]";case"days":return"M[m] d[d]";case"weeks":return"y[y] w[w]";case"months":return"y[y] M[m]";case"years":return"y[y]";default:return"y[y] M[m] d[d] h:mm:ss"}}}})(this);