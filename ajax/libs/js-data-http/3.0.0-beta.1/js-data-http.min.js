/*!
* js-data-http
* @version 3.0.0-beta.1 - Homepage <http://www.js-data.io/docs/dshttpadapter>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2015 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview Http adapter for js-data.
*/

!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("js-data")):"function"==typeof define&&define.amd?define(["js-data"],b):"object"==typeof exports?exports.DSHttpAdapter=b(require("js-data")):a.DSHttpAdapter=b(a.JSData)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function f(a,b){if(!b)return a;var c=[];return i.forOwn(b,function(a,b){null!==a&&"undefined"!=typeof a&&(i.isArray(a)||(a=[a]),i.forEach(a,function(a){"[object Date]"===window.toString.call(a)?a=a.toISOString():i.isObject(a)&&(a=i.toJson(a)),c.push(e(b)+"="+e(a))}))}),c.length>0&&(a+=(-1===a.indexOf("?")?"?":"&")+c.join("&")),a}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(1),i=h.DSUtils,j=i.deepMixIn,k=i.removeCircular,l=i.copy,m=i.makePath,n=i.isString,o=i.isNumber,p=function(){function a(){d(this,a)}return g(a,[{key:"queryTransform",value:function(a,b){return b}},{key:"deserialize",value:function(a,b){return b&&"data"in b?b.data:b}},{key:"serialize",value:function(a,b){return b}},{key:"log",value:function(){}},{key:"error",value:function(){}}]),a}(),q=p.prototype;q.httpLibName="axios",q.basePath="",q.forceTrailingSlash="",q.httpConfig={},q.useFetch=!1;var r=function(){function a(b){if(d(this,a),b=b||{},this.defaults=new p,this.http=b.http,delete b.http,console&&(this.defaults.log=function(a,b){return console["function"==typeof console.info?"info":"log"](a,b)}),console&&(this.defaults.error=function(a,b){return console["function"==typeof console.error?"error":"log"](a,b)}),j(this.defaults,b),this.defaults.useFetch&&window.fetch&&(this.defaults.deserialize=function(a,b){return b.json()},this.http=function(a){var b={method:a.method,headers:new window.Headers(a.headers)};return a.data&&(b.body=i.toJson(a.data)),window.fetch(new window.Request(f(a.url,a.params),b)).then(function(b){return b.config={method:a.method,url:a.url},b})}),!this.http)try{this.http=window[this.defaults.httpLibName]}catch(c){}}return g(a,[{key:"getEndpoint",value:function(a,b,c){var d=this;c=c||{},c.params=c.params||{};var e=void 0,f=a.parentKey,g=c.hasOwnProperty("endpoint")?c.endpoint:a.endpoint,h=a.parentField,j=a.getResource(a.parent),k=c.params[f];if(k===!1||!f||!j)return k===!1&&delete c.params[f],g;if(delete c.params[f],i._sn(b)?e=a.get(b):i._o(b)&&(e=b),e&&(k=k||e[f]||(e[h]?e[h][j.idAttribute]:null)),!k)return g;var l=function(){delete c.endpoint;var a={};return i.forOwn(c,function(b,c){a[c]=b}),{v:i.makePath(d.getEndpoint(j,k,i._(j,a)),k,g)}}();return"object"==typeof l?l.v:void 0}},{key:"getPath",value:function(a,b,c,d){var e=this;d=d||{};var f=[d.basePath||e.defaults.basePath||b.basePath,this.getEndpoint(b,n(c)||o(c)||"create"===a?c:null,d)];return("find"===a||"update"===a||"destroy"===a)&&f.push(c),m.apply(i,f)}},{key:"HTTP",value:function(a){function b(b){var e=d.toUTCString()+" - "+a.method.toUpperCase()+" "+a.url+" - "+b.status+" "+((new Date).getTime()-d.getTime())+"ms";return b.status>=200&&b.status<300?(c.defaults.log&&c.defaults.log(e,b),b):(c.defaults.error&&c.defaults.error("'FAILED: "+e,b),i.Promise.reject(b))}var c=this,d=new Date;a=l(a),a=j(a,c.defaults.httpConfig),c.defaults.forceTrailingSlash&&"/"!==a.url[a.url.length-1]&&(a.url+="/"),"object"==typeof a.data&&(a.data=k(a.data)),a.method=a.method.toUpperCase();var e=a.suffix||c.defaults.suffix;if(e&&a.url.substr(a.url.length-e.length)!==e&&(a.url+=e),!this.http)throw new Error("You have not configured this adapter with an http library!");return this.http(a).then(b,b)}},{key:"GET",value:function(a,b){return b=b||{},"method"in b||(b.method="get"),this.HTTP(j(b,{url:a}))}},{key:"POST",value:function(a,b,c){return c=c||{},"method"in c||(c.method="post"),this.HTTP(j(c,{url:a,data:b}))}},{key:"PUT",value:function(a,b,c){return c=c||{},"method"in c||(c.method="put"),this.HTTP(j(c,{url:a,data:b||{}}))}},{key:"DEL",value:function(a,b){return b=b||{},"method"in b||(b.method="delete"),this.HTTP(j(b,{url:a}))}},{key:"find",value:function(a,b,c){var d=this;return c=c?l(c):{},c.suffix=c.suffix||a.suffix,c.params=c.params||{},c.params=d.defaults.queryTransform(a,c.params),d.GET(d.getPath("find",a,b,c),c).then(function(b){var e=(c.deserialize?c.deserialize:d.defaults.deserialize)(a,b);return e?e:i.Promise.reject(new Error("Not Found!"))})}},{key:"findAll",value:function(a,b,c){var d=this;return c=c?l(c):{},c.suffix=c.suffix||a.suffix,c.params=c.params||{},b&&(b=d.defaults.queryTransform(a,b),j(c.params,b)),d.GET(d.getPath("findAll",a,b,c),c).then(function(b){return(c.deserialize?c.deserialize:d.defaults.deserialize)(a,b)})}},{key:"create",value:function(a,b,c){var d=this;return c=c?l(c):{},c.suffix=c.suffix||a.suffix,c.params=c.params||{},c.params=d.defaults.queryTransform(a,c.params),d.POST(d.getPath("create",a,b,c),c.serialize?c.serialize(a,b):d.defaults.serialize(a,b),c).then(function(b){return(c.deserialize?c.deserialize:d.defaults.deserialize)(a,b)})}},{key:"update",value:function(a,b,c,d){var e=this;return d=d?l(d):{},d.suffix=d.suffix||a.suffix,d.params=d.params||{},d.params=e.defaults.queryTransform(a,d.params),e.PUT(e.getPath("update",a,b,d),d.serialize?d.serialize(a,c):e.defaults.serialize(a,c),d).then(function(b){return(d.deserialize?d.deserialize:e.defaults.deserialize)(a,b)})}},{key:"updateAll",value:function(a,b,c,d){var e=this;return d=d?l(d):{},d.suffix=d.suffix||a.suffix,d.params=d.params||{},c&&(c=e.defaults.queryTransform(a,c),j(d.params,c)),this.PUT(e.getPath("updateAll",a,b,d),d.serialize?d.serialize(a,b):e.defaults.serialize(a,b),d).then(function(b){return(d.deserialize?d.deserialize:e.defaults.deserialize)(a,b)})}},{key:"destroy",value:function(a,b,c){var d=this;return c=c?l(c):{},c.suffix=c.suffix||a.suffix,c.params=c.params||{},c.params=d.defaults.queryTransform(a,c.params),d.DEL(d.getPath("destroy",a,b,c),c).then(function(b){return(c.deserialize?c.deserialize:d.defaults.deserialize)(a,b)})}},{key:"destroyAll",value:function(a,b,c){var d=this;return c=c?l(c):{},c.suffix=c.suffix||a.suffix,c.params=c.params||{},b&&(b=d.defaults.queryTransform(a,b),j(c.params,b)),this.DEL(d.getPath("destroyAll",a,b,c),c).then(function(b){return(c.deserialize?c.deserialize:d.defaults.deserialize)(a,b)})}}]),a}();a.exports=r},function(b,c){b.exports=a}])});
//# sourceMappingURL=js-data-http.min.map