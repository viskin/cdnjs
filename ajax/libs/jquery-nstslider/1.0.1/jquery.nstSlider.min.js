/*! Nestoria Slider - v1.0.1 - 2014-04-29
* http://lokku.github.io/jquery-nstslider/
* Copyright (c) 2014 Lokku Ltd.; Licensed MIT */
!function(a){var b,c,d,e,f,g={binarySearch:function(a,b,c,d){for(var e,f,g=0,h=a.length-1;h>=g;){e=(g+h)/2|0,f=c(a,e);var i=d(b,a,e);if(i>0)g=e+1;else{if(!(0>i))return e;h=e-1}}return-1},haveLimits:function(){var a=this,b=a.data("lower-limit"),c=a.data("upper-limit"),d=!1;return"undefined"!=typeof b&&"undefined"!=typeof c&&(d=!0),d},refresh_grips_style:function(){var a=this,b=a.data("settings");if("undefined"!=typeof b.highlight){var c=a.data("highlightedRangeMin");if("undefined"!=typeof c){var d=a.find(b.left_grip_selector),e=a.find(b.right_grip_selector),f=a.data("highlightedRangeMax"),g=a.data("cur_min"),h=a.data("cur_max"),i=b.highlight.grip_class;c>g||g>f?d.removeClass(i):d.addClass(i),c>h||h>f?e.removeClass(i):e.addClass(i)}}},set_position_from_val:function(a,b){var c=this,d=c.data("range_min"),e=c.data("range_max");d>a&&(a=d),a>e&&(a=e),c.data("has_right_grip")?(b>e&&(b=e),d>b&&(b=d)):b=c.data("cur_max");var f,h,i=c.data("value_to_pixel_mapping");if("undefined"!=typeof i)f=i(a),h=i(b);else{var j=c.width()-c.data("left_grip_width");f=g.rangemap_0_to_n.call(c,a,j),h=g.rangemap_0_to_n.call(c,b,j)}return g.set_handles_at_px.call(c,f,h),c.data("cur_min",a),c.data("has_right_grip")&&c.data("cur_max",b),c},set_position_from_px:function(a,b){var c=this;g.set_handles_at_px.call(c,a,b);var d,e,f=c.data("pixel_to_value_mapping");if("undefined"!=typeof f)d=f(a),e=f(b);else{var h=c.width()-c.data("left_grip_width");d=g.inverse_rangemap_0_to_n.call(c,a,h),e=g.inverse_rangemap_0_to_n.call(c,b,h)}return c.data("cur_min",d),c.data("has_right_grip")&&c.data("cur_max",e),c},set_handles_at_px:function(a,b){var c=this,d=c.data("settings"),e=d.left_grip_selector,f=d.right_grip_selector,g=d.value_bar_selector,h=c.data("left_grip_width"),i=h/2;return c.data("has_right_grip")?(c.find(g).css("left",a+i+"px").css("width",b-a+i+"px"),c.find(e).css("left",a+"px")):(b>a?c.find(g).css("left",a+i+"px").css("width",b-a+i+"px"):c.find(g).css("left",b+i+"px").css("width",a-b+i+"px"),c.find(e).css("left",a+"px")),c.find(f).css("left",b+"px"),c},drag_start_func_touch:function(a,b,c,e,f){var h=this,i=a.originalEvent,j=i.touches[0],k=j.pageY,l=j.pageX,m=h.find(b.value_bar_selector),n=Math.abs(m.offset().top-k),o=m.offset().left,p=o-l,q=l-(o+m.width());n>b.touch_tolerance_value_bar_y||p>b.touch_tolerance_value_bar_x||q>b.touch_tolerance_value_bar_x||(i.preventDefault(),d=j.pageX,g.drag_start_func.call(h,j,b,c,e,f))},drag_start_func:function(d,e,i,j,k){var l=this;if(l.find(e.left_grip_selector+","+e.value_bar_selector+","+e.right_grip_selector).removeClass(e.animating_css_class),h.is_enabled.call(l)){var m=a(d.target);if(k!==!1||m.is(e.left_grip_selector)||m.is(e.right_grip_selector)||m.is(e.value_bar_selector)||m.is(l)){b=l;var n,o,p,q,r,s,t,u=parseInt(i.css("left").replace("px",""),10),v=l.width()-l.data("left_grip_width"),w=i.offset().left;t=l.data("has_right_grip")?parseInt(j.css("left").replace("px",""),10):g.rangemap_0_to_n.call(l,l.data("cur_max"),v),o=d.pageX-l.data("left_grip_width")/2,p=Math.abs(w-o),r=o-w,l.data("has_right_grip")?(n=j.offset().left,q=Math.abs(n-o),s=o-n):(q=2*p,s=2*r),e.user_drag_start_callback.call(l,d),p===q?w>o?(u+=r,f=!0):(t+=s,f=!1):q>p?(u+=r,f=!0):(t+=s,f=!1),t>v&&(t=v),0>u&&(u=0),c=!0;var x=l.data("cur_min"),y=l.data("cur_max");g.set_position_from_px.call(l,u,t),g.refresh_grips_style.call(l),g.notify_changed_implicit.call(l,"drag_start",x,y)}}},drag_move_func_touch:function(a){if(c===!0){var b=a.originalEvent;b.preventDefault();var d=b.touches[0];g.drag_move_func(d)}},drag_move_func:function(a){if(c){var e,h=b,i=h.data("settings"),j=h.width()-h.data("left_grip_width"),k=h.find(i.left_grip_selector),l=h.find(i.right_grip_selector),m=parseInt(k.css("left").replace("px",""),10);e=h.data("has_right_grip")?parseInt(l.css("left").replace("px",""),10):g.rangemap_0_to_n.call(h,h.data("cur_max"),j);var n=a.pageX,o=n-d,p=h.offset().left+h.data("left_grip_width"),q=p+j,r=0,s=0;p>n&&(r=1,s=0),n>q&&(s=1,r=0),h.data("has_right_grip")&&(f?j>=e&&m+o>e&&(f=!1,m=e):m>=0&&m>e+o&&(f=!0,e=m));var t=m,u=e;if((o>0&&!r||0>o&&!s)&&(f?t+=o:u+=o),j>=u&&t>=0&&j>=t&&(!h.data("has_right_grip")||u>=t)){var v=h.data("cur_min"),w=h.data("cur_max");g.set_position_from_px.call(h,t,u),g.refresh_grips_style.call(h),g.notify_changed_implicit.call(h,"drag_move",v,w)}d=n}},drag_end_func_touch:function(a){var b=a.originalEvent;b.preventDefault();var c=b.touches[0];g.drag_end_func(c)},drag_end_func:function(){var a=b;if("undefined"!=typeof a){c=!1,d=void 0;var g=h.get_current_min_value.call(a),i=h.get_current_max_value.call(a);a.data("beforestart_min")!==g||a.data("beforestart_max")!==i?(a.data("beforestart_min",g),a.data("beforestart_max",i),e.call(a,h.get_current_min_value.call(a),h.get_current_max_value.call(a),f,!0)):e.call(a,h.get_current_min_value.call(a),h.get_current_max_value.call(a),f,!1),b=void 0;var j=a.data("settings");a.find(j.left_grip_selector+","+j.value_bar_selector+","+j.right_grip_selector).addClass(j.animating_css_class)}},get_rounding_for_value:function(a){var b=this,c=b.data("rounding"),d=b.data("rounding_ranges");if("object"==typeof d){var e=g.binarySearch.call(b,d,a,function(a,b){return a[b].range},function(a,b,c){return a<b[c].range?c>0?a>=b[c-1].range?0:-1:0:1});if(c=1,e>-1)c=parseInt(d[e].value,10);else{var f=d.length-1;a>=d[f].range&&(c=d[f].value)}}return c},notify_changed_implicit:function(a,b,c){var d=this,e=!1;("init"===a||"refresh"===a)&&(e=!0);var f=h.get_current_min_value.call(d),i=h.get_current_max_value.call(d);return e||(b=h.round_value_according_to_rounding.call(d,b),c=h.round_value_according_to_rounding.call(d,c)),(e||f!==b||i!==c)&&(g.notify_changed_explicit.call(d,a,b,c,f,i),e=1),e},notify_changed_explicit:function(a,b,c,d,e){var f=this,g=f.data("value_changed_callback");return g.call(f,a,d,e,b,c),f},validate_params:function(b){var c=this,d=c.data("range_min"),e=c.data("range_max"),f=c.data("cur_min"),h=c.data("lower-limit"),i=c.data("upper-limit"),j=g.haveLimits.call(c);"undefined"==typeof d&&a.error("the data-range_min attribute was not defined"),"undefined"==typeof e&&a.error("the data-range_max attribute was not defined"),"undefined"==typeof f&&a.error("the data-cur_min attribute must be defined"),d>e&&a.error("Invalid input parameter. must be min < max"),j&&h>i&&a.error("Invalid data-lower-limit or data-upper-limit"),0===c.find(b.left_grip_selector).length&&a.error("Cannot find element pointed by left_grip_selector: "+b.left_grip_selector),"undefined"!=typeof b.right_grip_selector&&0===c.find(b.right_grip_selector).length&&a.error("Cannot find element pointed by right_grip_selector: "+b.right_grip_selector),"undefined"!=typeof b.value_bar_selector&&0===c.find(b.value_bar_selector).length&&a.error("Cannot find element pointed by value_bar_selector"+b.value_bar_selector)},rangemap_0_to_n:function(a,b){var c=this,d=c.data("range_min"),e=c.data("range_max");return d>=a?0:a>=e?b:Math.floor((b*a-b*d)/(e-d))},inverse_rangemap_0_to_n:function(a,b){var c=this,d=c.data("range_min"),e=c.data("range_max");if(0>=a)return d;if(a>=b)return e;var f=(e-d)*a/b;return f+d}},h={teardown:function(){var b=this;b.data("initialized",!1),b.removeData();var c=a(document);c.unbind("mousemove.nstSlider"),c.unbind("mouseup.nstSlider");var d=b.parent();return d.unbind("mousedown.nstSlider"),d.unbind("touchstart.nstSlider"),d.unbind("touchmove.nstSlider"),d.unbind("touchend.nstSlider"),b},init:function(b){var c=a.extend({animating_css_class:"nst-animating",touch_tolerance_value_bar_y:30,touch_tolerance_value_bar_x:15,left_grip_selector:".nst-slider-grip-left",right_grip_selector:void 0,highlight:void 0,rounding:void 0,value_bar_selector:void 0,value_changed_callback:function(){},user_mouseup_callback:function(){},user_drag_start_callback:function(){}},b),d=a(document);return d.unbind("mouseup.nstSlider"),d.unbind("mousemove.nstSlider"),d.bind("mousemove.nstSlider",g.drag_move_func),d.bind("mouseup.nstSlider",g.drag_end_func),e=c.user_mouseup_callback,this.each(function(){var b=a(this),d=b.parent();b.data("enabled",!0);var e=b.data("range_min"),f=b.data("range_max"),i=b.data("cur_min"),j=b.data("cur_max");"undefined"==typeof j&&(j=i),""===e&&(e=0),""===f&&(f=0),""===i&&(i=0),""===j&&(j=0),b.data("range_min",e),b.data("range_max",f),b.data("cur_min",i),b.data("cur_max",j),g.validate_params.call(b,c),b.data("settings",c),"undefined"!=typeof c.rounding?h.set_rounding.call(b,c.rounding):"undefined"!=typeof b.data("rounding")?h.set_rounding.call(b,b.data("rounding")):h.set_rounding.call(b,1);var k=b.find(c.left_grip_selector)[0],l=a(k),m=a(b.find(c.right_grip_selector)[0]),n=!1;b.find(c.right_grip_selector).length>0&&(n=!0),b.data("has_right_grip",n);var o=l.width(),p=o;n===!0&&(p=m.width()),b.data("left_grip_width",o),b.data("right_grip_width",p),b.data("value_bar_selector",c.value_bar_selector),b.data("value_changed_callback",c.value_changed_callback),e===f||i===j?h.set_range.call(b,e,f):g.set_position_from_val.call(b,b.data("cur_min"),b.data("cur_max")),g.notify_changed_implicit.call(b,"init"),b.data("beforestart_min",h.get_current_min_value.call(b)),b.data("beforestart_max",h.get_current_max_value.call(b)),d.bind("mousedown.nstSlider",function(a){g.drag_start_func.call(b,a,c,l,m,!1)}),d.bind("touchstart.nstSlider",function(a){g.drag_start_func_touch.call(b,a,c,l,m,!0)}),d.bind("touchend.nstSlider",function(a){g.drag_end_func_touch.call(b,a)}),d.bind("touchmove.nstSlider",function(a){g.drag_move_func_touch.call(b,a)});var q=b.data("histogram");"undefined"!=typeof q&&h.set_step_histogram.call(b,q)})},get_range_min:function(){var a=this;return a.data("range_min")},get_range_max:function(){var a=this;return a.data("range_max")},get_current_min_value:function(){var b,c=a(this),d=h.get_range_min.call(c),e=h.get_range_max.call(c),f=c.data("cur_min");if(b=d>=f?d:h.round_value_according_to_rounding.call(c,f),g.haveLimits.call(c)){if(d>=b)return c.data("lower-limit");if(b>=e)return c.data("upper-limit")}else{if(d>=b)return d;if(b>=e)return e}return b},get_current_max_value:function(){var b,c=a(this),d=h.get_range_min.call(c),e=h.get_range_max.call(c),f=c.data("cur_max");if(b=f>=e?e:h.round_value_according_to_rounding.call(c,f),g.haveLimits.call(c)){if(b>=e)return c.data("upper-limit");if(d>=b)return c.data("lower-limit")}else{if(b>=e)return e;if(d>=b)return d}return b},is_handle_to_left_extreme:function(){var a=this;return g.haveLimits.call(a)?a.data("lower-limit")===h.get_current_min_value.call(a):h.get_range_min.call(a)===h.get_current_min_value.call(a)},is_handle_to_right_extreme:function(){var a=this;return g.haveLimits.call(a)?a.data("upper-limit")===h.get_current_max_value.call(a):h.get_range_max.call(a)===h.get_current_max_value.call(a)},refresh:function(){var a=this,b=a.data("last_step_histogram");return"undefined"!=typeof b&&h.set_step_histogram.call(a,b),g.set_position_from_val.call(a,h.get_current_min_value.call(a),h.get_current_max_value.call(a)),g.notify_changed_implicit.call(a,"refresh"),a},disable:function(){var a=this;return a.data("enabled",!1),a},enable:function(){var a=this;return a.data("enabled",!0),a},is_enabled:function(){var a=this;return a.data("enabled")},set_position:function(a,b){var c=this,d=c.data("cur_min"),e=c.data("cur_max");a>b?g.set_position_from_val.call(c,b,a):g.set_position_from_val.call(c,a,b),g.refresh_grips_style.call(c),g.notify_changed_implicit.call(c,"set_position",d,e),c.data("beforestart_min",a),c.data("beforestart_max",b)},set_step_histogram:function(b){var c=this;c.data("last_step_histogram",b),"undefined"==typeof b&&(a.error("got an undefined histogram in set_step_histogram"),g.unset_step_histogram.call(c));var d=c.width()-c.data("left_grip_width"),e=b.length;if(!(0>=d)){var f,i=0;for(f=0;e>f;f++)i+=b[f];if(0===i)return h.unset_step_histogram.call(c),c;var j=parseFloat(i)/d;for(f=0;e>f;f++)b[f]=b[f]/j;var k=[b[0]];for(f=1;e>f;f++){var l=k[f-1]+b[f];k.push(l)}k.push(d);for(var m=[c.data("range_min")],n=0,o=m[0],p=0;d>=n;){var q=parseInt(k.shift(),10),r=g.inverse_rangemap_0_to_n.call(c,p+1,e+1);p++;var s=q-n,t=r-o;for(f=n;q>f;f++){var u=o+t*(f-n+1)/s;m.push(u),n++,o=u}if(n===d)break}m[m.length-1]=c.data("range_max");var v=function(a){return m[a]},w=function(b){var d=g.binarySearch.call(c,m,b,function(a,b){return a[b]},function(b,c,d){return b===c[d]?0:b<c[d]&&0===d?0:c[d-1]<=b&&b<c[d]?0:b>c[d]?1:b<=c[d-1]?-1:void a.error("cannot compare s: "+b+" with a["+d+"]. a is: "+c.join(","))});return d};return c.data("pixel_to_value_mapping",v),c.data("value_to_pixel_mapping",w),c}},unset_step_histogram:function(){var a=this;return a.removeData("pixel_to_value_mapping"),a.removeData("value_to_pixel_mapping"),a.removeData("last_step_histogram"),a},set_range:function(a,b){var c=this,d=h.get_current_min_value.call(c),e=h.get_current_max_value.call(c);return c.data("range_min",a),c.data("range_max",b),g.set_position_from_val.call(c,d,e),g.notify_changed_implicit.call(c,"set_range",d,e),c},highlight_range:function(b,c){var d=this,e=d.data("settings");"undefined"==typeof e.highlight&&a.error('you cannot call highlight_range if you haven\' specified the "highlight" parameter in construction!'),b||(b=0),c||(c=0);var f=d.width(),h=g.rangemap_0_to_n.call(d,b,f),i=g.rangemap_0_to_n.call(d,c,f),j=i-h,k=d.find(e.highlight.panel_selector);return k.css("left",h+"px"),k.css("width",j+"px"),d.data("highlightedRangeMin",b),d.data("highlightedRangeMax",c),g.refresh_grips_style.call(d),d},set_rounding:function(b){var c=this;"string"==typeof b&&b.indexOf("{")>-1&&(b=a.parseJSON(b)),c.data("rounding",b);var d=[];if("object"==typeof b){var e;for(e in b)if(b.hasOwnProperty(e)){var f=b[e];d.push({range:f,value:e})}d.sort(function(a,b){return a.range-b.range}),c.data("rounding_ranges",d)}else c.removeData("rounding_ranges");return c},get_rounding:function(){var a=this;return a.data("rounding")},round_value_according_to_rounding:function(b){var c=this,d=g.get_rounding_for_value.call(c,b);if(d>0){var e=b/d,f=parseInt(e,10),h=e-f;h>.5&&f++;var i=f*d;return i}return a.error("rounding must be > 0, got "+d+" instead"),b}},i="nstSlider";a.fn[i]=function(b){if(h[b]){if(this.data("initialized")===!0)return h[b].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+b+" called on an uninitialized instance of "+i)}return"object"!=typeof b&&b?void a.error("Cannot call method "+b):(this.data("initialized",!0),h.init.apply(this,arguments))}}(jQuery);