!function(t){"use strict";!function(){function n(n,e,r){return{scope:{width:"@",height:"@"},restrict:"AE",template:"<svg></svg>",link:function(e,a){function i(n){n=n.map(function(n){return""===n.name?p:t.copy(n)}),t.extend(u,n.reduce(function(t,n){return t[n.name]=n,t},{})),n.forEach(function(t){var n=t.name.split(/\./).slice(0,-1).join("."),e=t.name!=n&&u[n];e&&((e.children||(e.children=[])).push(t),t.px=e.px,t.py=e.py,f.push(t))})}function c(){function t(t){var n=t.name.split(".").pop();return t.sticky&&(n+=" (STICKY)"),t.deepStateRedirect&&(n+=" (DSR)"),n}v=v.data(l.nodes(p),function(t){return t.name}),h=h.data(l.links(f),function(t){return t.target.name}),m=m.data(d),f.forEach(function(t){t.y=70*t.depth});var n=v.enter();m.enter().append("circle").attr("class","active").attr("r",13).attr("cx",function(t){return t.parent.px||100}).attr("cy",function(t){return t.parent.py||100}),n.append("circle").attr("class","node").attr("r",9).attr("cx",function(t){return t.parent.px}).attr("cy",function(t){return t.parent.py}),n.append("text").attr("class","label").attr("x",function(t){return t.parent.px}).attr("y",function(t){return t.parent.py}).attr("text-anchor",function(){return"middle"}).text(t).style("fill-opacity",1),h.enter().insert("path",".node").attr("class","link").attr("d",function(t){var n={x:t.source.px,y:t.source.py};return x({source:n,target:n})});var e=y.transition().duration(A);e.selectAll(".link").attr("d",x);var r={entered:"#AF0",exited:"#777",active:"#0f0",inactive:"#55F",future:"#009"};e.selectAll(".node").attr("cx",function(t){return t.px=t.x}).attr("cy",function(t){return t.py=t.y}).attr("r",function(t){return"active"===t.status?15:10}).style("fill",function(t){return r[t.status]||"#FFF"}),e.selectAll(".label").attr("x",function(t){return t.px=t.x}).attr("y",function(t){return t.py=t.y-15}).attr("transform",function(t){return"rotate(-25 "+t.x+" "+t.y+")"}),e.selectAll(".active").attr("x",function(t){return t.px=t.x}).attr("y",function(t){return t.py=t.y-15})}var u={},o=e.width||400,s=e.height||400,l=d3.layout.tree().size([o-20,s-20]).separation(function(t,n){return t.parent==n.parent?10:25}),p=n.get().filter(function(t){return""===t.name})[0],f=l(p);p.parent=p,p.px=p.x=o/2,p.py=p.y=s/2;var d={};d.px=d.x=p.px,d.py=d.y=p.py;{var x=d3.svg.diagonal(),y=d3.select(a.find("svg")[0]).attr("width",o).attr("height",s).append("g").attr("transform","translate(10, 10)"),v=y.selectAll(".node"),h=y.selectAll(".link"),m=y.selectAll(".active"),g=200,A=200;setInterval(c,g)}r(function(){e.states=n.get(),t.forEach(f,function(t){var e=n.get(t.name);e&&(t.status=e.status||"exited")})},250),e.$watchCollection("states",function(t,n){var e=(n||[]).map(function(t){return t.name});i((t||[]).filter(function(t){return-1==e.indexOf(t.name)}))}),c(g)}}}var e=t.module("ct.ui.router.extras.statevis",["ct.ui.router.extras.core"]);e.directive("stateVis",["$state","$timeout","$interval",n])}()}(angular);