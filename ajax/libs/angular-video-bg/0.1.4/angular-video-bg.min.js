angular.module("angularVideoBg",[]),angular.module("angularVideoBg").directive("videoBg",["$window","$q",function(a,b){return{restrict:"EA",replace:!0,scope:{videoId:"=",ratio:"=?",loop:"=?",mute:"=?",start:"=?",end:"=?",contentZIndex:"=?",allowClickEvents:"=?"},transclude:!0,template:"<div><div></div><div ng-transclude></div></div>",link:function(c,d,e,f){function g(a,b){var c=["top","right","bottom","left"],d=function(c,d){return c[d]=parseInt(b.call(u,a+"-"+d),10),c};return c.reduce(d,{})}function h(a,b){function c(){var a,c=Array.prototype.slice.call(arguments),d=0,e=function(b,c){return b+a[c]};for(var f in b)b.hasOwnProperty(f)&&(a=b[f],d+=c.reduce(e,0));return d}return{width:a.width+c("left","right"),height:a.height+c("top","bottom")}}function i(){var a=["width","height"],b=["border","margin","padding"];return a=a.reduce(function(a,b){return a[b]=parseInt(u.getPropertyValue(b),10),a},{}),b=b.reduce(function(a,b){return a[b]=g(b,u.getPropertyValue),a},{}),h(a,b)}function j(){var a=parseInt(s.width/c.ratio,10),b=parseInt(s.height*c.ratio,10),d=s.height<a;return{width:d?s.width:b,height:d?a:s.height}}function k(){s=i(),t=j()}function l(){var a=d.children().eq(1),b=!!a.children().length,c=Array.prototype.slice.call(d.parent().children());if(console.log("Parent content children:",a),b)return d.css({position:"relative"}),a;d.css({position:"absolute"});var e=c.indexOf(d[0]);return e>-1&&c.splice(e,1),angular.element(c)}function m(){var a=l();w=d.children().eq(0),console.log("Parent content children:",a),d.css({width:s.width+"px",height:s.height+"px"}),a.css({position:"relative",zIndex:c.contentZIndex||99});var b={zIndex:1,position:"absolute",width:t.width+"px",height:t.height+"px",left:parseInt((s.width-t.width)/2,10)+"px",top:parseInt((s.height-t.height)/2,10)+"px"};c.allowClickEvents||(b.pointerEvents="none"),w.css(b)}function n(){c.mute&&!r.isMuted()?r.mute():r.isMuted()&&r.unMute()}function o(){k();var a={autoplay:1,controls:0,iv_load_policy:3,cc_load_policy:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,playlist:c.videoId,loop:c.loop?1:0};c.end&&(a.end=c.end),c.start&&(a.start=c.start),r=new YT.Player(q,{width:t.width,height:t.height,videoId:c.videoId,playerVars:a,events:{onReady:n}}),m()}function p(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}d.css({overflow:"hidden"}),c.ratio=c.ratio||16/9,c.loop=void 0===c.loop?!0:c.loop,c.mute=void 0===c.mute?!0:c.mute;var q,r,s,t,u=a.getComputedStyle(d.parent()[0]),v=document.querySelector('script[src="//www.youtube.com/iframe_api"]'),w=d.children().eq(0);if(q="player"+Array.prototype.slice.call(document.querySelectorAll("div[video-id]")).indexOf(d[0]),w.attr("id",q),!a.youTubeIframeAPIReady){var x=b.defer();a.youTubeIframeAPIReady=x.promise,a.onYouTubeIframeAPIReady=function(){x.resolve()}}if(!v){var y=document.createElement("script");y.src="//www.youtube.com/iframe_api";var z=document.getElementsByTagName("script")[0];z.parentNode.insertBefore(y,z)}a.youTubeIframeAPIReady.then(o),angular.element(a).on("resize",p(function(){k(),m(),console.log("Window resized!")},300))}}}]);