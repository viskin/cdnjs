angular.module("angularVideoBg",[]),angular.module("angularVideoBg").directive("videoBg",["$window","$q","$timeout",function(a,b,c){return{restrict:"EA",replace:!0,scope:{videoId:"=",ratio:"=?",loop:"=?",mute:"=?",start:"=?",end:"=?",contentZIndex:"=?",allowClickEvents:"=?",mobileImage:"=?",playerCallback:"&?"},transclude:!0,template:"<div><div></div><div ng-transclude></div></div>",link:function(d,e,f,g){function h(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function i(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/"),d=a.indexOf("Edge/");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(c>0){var e=a.indexOf("rv:");return parseInt(a.substring(e+3,a.indexOf(".",e)),10)}return d>0?parseInt(a.substring(d+5,a.indexOf(".",d)),10):!1}function j(a,b){var c=["top","right","bottom","left"],d=function(c,d){return c[d]=parseInt(b.call(v,a+"-"+d),10),c};return c.reduce(d,{})}function k(a,b){function c(){var a,c=Array.prototype.slice.call(arguments),d=0,e=function(b,c){return a[c]?b+a[c]:b};for(var f in b)b.hasOwnProperty(f)&&(a=b[f],d+=c.reduce(e,0));return d}return{width:a.width+c("left","right"),height:i()&&i()<12?a.height:a.height+c("top","bottom")}}function l(){var a=e.children().eq(1),b=!!a.children().length,c=Array.prototype.slice.call(e.parent().children());if(e.parent().css({position:"relative",overflow:"hidden"}),!b){e.css({position:"absolute",left:"0",top:"0"});var f=c.indexOf(e[0]);f>-1&&c.splice(f,1),a=angular.element(c)}a.css({position:"relative",zIndex:d.contentZIndex||99})}function m(){v=a.getComputedStyle(e.parent()[0]);var b=["width","height"],c=["border","margin"];return i()&&i()<12&&c.push("padding"),b=b.reduce(function(a,b){return a[b]=parseInt(v.getPropertyValue(b),10),a},{}),c=c.reduce(function(a,b){return a[b]=j(b,v.getPropertyValue),a},{}),k(b,c)}function n(){var a=parseInt(y.width/d.ratio,10),b=parseInt(y.height*d.ratio,10),c=y.height<a;return{width:c?y.width:b,height:c?a:y.height}}function o(){l(),y=m(),z=n()}function p(){var a={zIndex:1,position:"absolute",width:z.width+"px",height:z.height+"px",left:parseInt((y.width-z.width)/2,10)+"px",top:parseInt((y.height-z.height)/2,10)+"px"};d.allowClickEvents||(a.pointerEvents="none"),B.css(a)}function q(){x.seekTo(d.start||0)}function r(){var a,b;a=d.end?d.end-(d.start||0):d.start?x.getDuration()-d.start:x.getDuration(),b=1e3*a,setTimeout(q,b)}function s(){C&&c(function(){C({player:x})}),d.mute&&!x.isMuted()?x.mute():x.isMuted()&&x.unMute(),q()}function t(a){a.data===YT.PlayerState.PLAYING&&(B.css("display","block"),d.loop&&r())}function u(){o();var a={autoplay:1,controls:0,iv_load_policy:3,cc_load_policy:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,playlist:d.videoId};x=new YT.Player(w,{width:z.width,height:z.height,videoId:d.videoId,playerVars:a,events:{onReady:s,onStateChange:t}}),B=e.children().eq(0),B.css("display","none"),p()}var v,w,x,y,z,A=document.querySelector('script[src="//www.youtube.com/iframe_api"]'),B=e.children().eq(0),C=d.playerCallback;if(w="player"+Array.prototype.slice.call(document.querySelectorAll("div[video-id]")).indexOf(e[0]),B.attr("id",w),d.ratio=d.ratio||16/9,d.loop=void 0===d.loop?!0:d.loop,d.mute=void 0===d.mute?!0:d.mute,d.mobileImage=d.mobileImage||"//img.youtube.com/vi/"+d.videoId+"/maxresdefault.jpg",e.parent().css({backgroundImage:"url("+d.mobileImage+")",backgroundSize:"cover",backgroundPosition:"center center"}),!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if(!a.youTubeIframeAPIReady){var D=b.defer();a.youTubeIframeAPIReady=D.promise,a.onYouTubeIframeAPIReady=function(){D.resolve()}}if(!A){var E=document.createElement("script");E.src="//www.youtube.com/iframe_api";var F=document.getElementsByTagName("script")[0];F.parentNode.insertBefore(E,F)}a.youTubeIframeAPIReady.then(u),angular.element(a).on("resize",h(function(){o(),p()},300))}}}}]);