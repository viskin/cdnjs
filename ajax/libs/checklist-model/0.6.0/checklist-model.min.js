angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function($parse,$compile){function contains(arr,item,comparator){if(angular.isArray(arr))for(var i=arr.length;i--;)if(comparator(arr[i],item))return!0;return!1}function add(arr,item,comparator){return arr=angular.isArray(arr)?arr:[],contains(arr,item,comparator)||arr.push(item),arr}function remove(arr,item,comparator){if(angular.isArray(arr))for(var i=arr.length;i--;)if(comparator(arr[i],item)){arr.splice(i,1);break}return arr}function postLinkFn(scope,elem,attrs){function setChecked(newArr,oldArr){scope[attrs.ngModel]=contains(newArr,value,comparator)}var checklistModel=attrs.checklistModel;attrs.$set("checklistModel",null),$compile(elem)(scope),attrs.$set("checklistModel",checklistModel);var getter=$parse(checklistModel),setter=getter.assign,checklistChange=$parse(attrs.checklistChange),value=attrs.checklistValue?$parse(attrs.checklistValue)(scope.$parent):attrs.value,comparator=angular.equals;if(attrs.hasOwnProperty("checklistComparator"))if("."==attrs.checklistComparator[0]){var comparatorExpression=attrs.checklistComparator.substring(1);comparator=function(a,b){return a[comparatorExpression]===b[comparatorExpression]}}else comparator=$parse(attrs.checklistComparator)(scope.$parent);scope.$watch(attrs.ngModel,function(newValue,oldValue){if(newValue!==oldValue){var current=getter(scope.$parent);angular.isFunction(setter)&&(newValue===!0?setter(scope.$parent,add(current,value,comparator)):setter(scope.$parent,remove(current,value,comparator))),checklistChange&&checklistChange(scope)}}),angular.isFunction(scope.$parent.$watchCollection)?scope.$parent.$watchCollection(checklistModel,setChecked):scope.$parent.$watch(checklistModel,setChecked,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(tElement,tAttrs){if(("INPUT"!==tElement[0].tagName||"checkbox"!==tAttrs.type)&&"MD-CHECKBOX"!==tElement[0].tagName&&!tAttrs.btnCheckbox)throw'checklist-model should be applied to `input[type="checkbox"]` or `md-checkbox`.';if(!tAttrs.checklistValue&&!tAttrs.value)throw"You should provide `value` or `checklist-value`.";return tAttrs.ngModel||tAttrs.$set("ngModel","checked"),postLinkFn}}}]);