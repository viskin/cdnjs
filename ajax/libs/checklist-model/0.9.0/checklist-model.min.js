angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,c){function b(g,k,h){if(angular.isArray(g)){for(var j=g.length;j--;){if(h(g[j],k)){return true}}}return false}function f(g,i,h){g=angular.isArray(g)?g:[];if(!b(g,i,h)){g.push(i)}return g}function a(g,k,h){if(angular.isArray(g)){for(var j=g.length;j--;){if(h(g[j],k)){g.splice(j,1);break}}}return g}function d(r,j,p){var h=p.checklistModel;p.$set("checklistModel",null);c(j)(r);p.$set("checklistModel",h);var q=e(h);var m=e(p.checklistChange);var o=e(p.checklistBeforeChange);var s=e(p.ngModel);var g=angular.equals;if(p.hasOwnProperty("checklistComparator")){if(p.checklistComparator[0]=="."){var k=p.checklistComparator.substring(1);g=function(u,t){return u[k]===t[k]}}else{g=e(p.checklistComparator)(r.$parent)}}r.$watch(p.ngModel,function(u,t){if(u===t){return}if(o&&(o(r)===false)){s.assign(r,b(q(r.$parent),i(),g));return}n(i(),u);if(m){m(r)}});r.$watch(i,function(v,t){if(v!=t&&angular.isDefined(t)&&r[p.ngModel]===true){var u=q(r.$parent);q.assign(r.$parent,a(u,t,g));q.assign(r.$parent,f(u,v,g))}});function i(){return p.checklistValue?e(p.checklistValue)(r.$parent):p.value}function n(u,t){var v=q(r.$parent);if(angular.isFunction(q.assign)){if(t===true){q.assign(r.$parent,f(v,u,g))}else{q.assign(r.$parent,a(v,u,g))}}}function l(u,t){if(o&&(o(r)===false)){n(i(),s(r));return}s.assign(r,b(u,i(),g))}if(angular.isFunction(r.$parent.$watchCollection)){r.$parent.$watchCollection(h,l)}else{r.$parent.$watch(h,l,true)}}return{restrict:"A",priority:1000,terminal:true,scope:true,compile:function(g,h){if(!h.checklistValue&&!h.value){throw"You should provide `value` or `checklist-value`."}if(!h.ngModel){h.$set("ngModel","checked")}return d}}}]);