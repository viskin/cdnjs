/**
 * angular-ui-handsontable 0.3.9
 * 
 * Date: Wed May 15 2013 03:06:48 GMT+0200 (Central European Daylight Time)
*/

document.all&&!document.addEventListener&&(document.createElement("ui-handsontable"),document.createElement("datacolumn"),document.createElement("optionlist")),angular.module("uiHandsontable",[]).factory("getHandsontableSettings",function(){return function(e){var t=e.data("uiDatagrid");return t||(t={settings:{columns:[],colHeaders:!0,outsideClickDeselects:!0,autoComplete:[]},$container:$('<div class="ui-handsontable-container"></div>')},e.data("uiDatagrid",t)),t}}).factory("getDatacolumnSettings",function(){return function(e){var t=e.data("uiDatagridDatacolumn");return t||(t={},e.data("uiDatagridDatacolumn",t)),t}}).directive("uiHandsontable",function(e,t,n){for(var i=["data","width","height","rowHeaders","colHeaders","colWidths","columns","cells","dataSchema","contextMenu","onSelection","onSelectionByProp","onBeforeChange","onChange","onCopyLimit","startRows","startCols","minRows","minCols","maxRows","maxCols","minSpareRows","minSpareCols","multiSelect","fillHandle","undo","outsideClickDeselects","enterBeginsEditing","enterMoves","tabMoves","autoWrapRow","autoWrapCol","copyRowsLimit","copyColsLimit","currentRowClassName","currentColClassName","asyncRendering","stretchH","columnSorting","manualColumnMove","manualColumnResize"],o={selectedIndex:"=selectedindex"},s=0,r=i.length;r>s;s++)o[i[s]]="="+i[s].toLowerCase();var a={restrict:"EA",scope:o,priority:490,compile:function(o,s){var r,a,l,c=function(t,n,i){var o=n.optionList,s=o.match(/^\s*(.+)\s+in\s+(.*)\s*$/);if(!s)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+o+"'.");var r,a,l,c=s[1],h=s[2],u=t.$new();i.$container.on("blur","textarea",function(){l&&l()}),n.source=function(e,o){l&&l();var s=function(){var e=i.$container.data("handsontable"),n=e.getSelected()[0];return u[i.lhs]=t.$parent.$eval(i.rhs)[n],u.$eval(h)};r=s(),u.$$phase||u.$apply(),o(r),a.$apply(),l=t.$parent.$watch(s,function(t,i){t!==i&&setTimeout(function(){n.source(e,o)},0)}),n.saveOnBlur||(u.$eval(n.value+' = "'+$.trim(e).replace(/"/g,'"')+'"'),u.$apply())},n.sorter=function(e){return e},n.highlighter=function(t){var i,o=u.$new();return o[c]=t,a=o,n.transclude?n.transclude(o,function(e){i=e[0]}):i=e("<span>"+n.optionTemplate+"</span>")(o),i},n.onSelect=function(e,t,i,o,s){u[c]=r[s],u.$eval(n.clickrow),u.$apply()}},h=s.datarows;if(h&&(r=h.match(/^\s*(.+)\s+in\s+(.*)\s*$/)),!r)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+h+"'.");return a=r[1],l=r[2],function(e,o,s){var r,h,u=n(o);u.lhs=a,u.rhs=l,u.settings=angular.extend(u.settings,e.$parent.$eval(s.uiHandsontable||s.settings));for(r in i)i.hasOwnProperty(r)&&e[i[r]]!==void 0&&(u.settings[i[r]]=e[i[r]]);$(o).append(u.$container);var d=e.$parent.$eval(l);if(d!==void 0&&(u.settings.data=d),u.settings.columns){var p=RegExp("^("+a+"\\.)");for(r=0,h=u.settings.columns.length;h>r;r++)u.settings.columns[r].data=u.settings.columns[r].value.replace(p,""),"autocomplete"===u.settings.columns[r].type&&c(e,u.settings.columns[r],u)}u.settings.afterChange=function(){t.$$phase||e.$apply()},u.settings.afterSelectionByProp=function(t,n,i,o){e.$emit("datagridSelection",u.$container,t,n,i,o)},u.$container.handsontable(u.settings);var f=0;for(e.$watch(function(){if(e.$parent.$eval(l)!==u.$container.handsontable("getData"))return!0;var t=u.$container.data("handsontable"),n=t.countRows();if(f!==n)return f=n;for(var i="",o=t.countCols(),s=t.rowOffset(),r=s+t.countVisibleRows();r>s;s++)for(var a=0;o>a;a++)i+=t.getDataAtCell(s,a);return i},function(t,n){1==t?u.$container.handsontable("loadData",e.$parent.$eval(l)):t!==n&&u.$container.handsontable("render")},!1),r=0,h=i.length;h>r;r++)(function(t){e.$watch(t,function(n,i){if(n!==i){if("columns"===t)for(var o=RegExp("^("+a+"\\.)"),s=0,r=n.length;r>s;s++)n[s].data=n[s].value.replace(o,""),"autocomplete"===n[s].type&&c(e,n[s],u);var l={};l[t]=n,u.$container.handsontable("updateSettings",l)}},!0)})(i[r])}}};return a}).directive("datacolumn",function(e,t){var n={restrict:"E",priority:500,compile:function(n,i){return function(n,o,s){var r,a=e(o.parent()),l=t(o),c=n.$parent.$eval(s.title),h=n.$parent.$eval(s.width),u=n.$parent.$eval(s.type),d=s.options,p=[];for(r in s)i.hasOwnProperty(r)&&p.push(r);l.value=s.value,l.source=null,l.saveOnBlur=-1!==$.inArray("saveonblur",p),l.strict=-1!==$.inArray("strict",p);var f=n.$new(),m=n.$parent.$eval(d)||{};switch(m.value=s.value,m.type=u,m.title=c,m.width=h,u){case"autocomplete":for(r in l)l.hasOwnProperty(r)&&(m[r]=l[r]);break;case"checkbox":s.checkedtemplate!==void 0&&(m.checkedTemplate=n.$parent.$eval(s.checkedtemplate)),s.uncheckedtemplate!==void 0&&(m.uncheckedTemplate=n.$parent.$eval(s.uncheckedtemplate))}s.readonly!==void 0&&(m.readOnly=!0);for(r in s)s.hasOwnProperty(r)&&"$"!==r.charAt(0)&&m[r]===void 0&&(m[r]=f.$eval(s[r]));a.settings.columns.push(m)}}};return n}).directive("optionlist",function(e){var t={restrict:"E",transclude:"element",priority:510,compile:function(t,n,i){return function(t,n,o){var s=e(n.parent());s.optionList=o.datarows,s.clickrow=o.clickrow,s.transclude=i}}};return t}).directive("selectedindex",function(e){var t={restrict:"A",priority:491,compile:function(){return function(t,n){var i,o,s,r=e(n).$container;e(n).settings.afterSelection=function(e,n){i=!0,o=e,s=n,t.$$phase||void 0===t.selectedIndex||t.selectedIndex==e||t.$apply(function(){t.selectedIndex=e})},e(n).settings.afterDeselect=function(){i=!1,o=null,t.$$phase||void 0===t.selectedIndex||null==t.selectedIndex||t.$apply(function(){t.selectedIndex=null})},t.$watch("selectedIndex",function(e){var t=parseInt(e,10);if(e!==void 0&&null!==e&&t!==o){var n=s||0;r.handsontable("selectCell",t,n,t,n,!0)}},!1)}}};return t});var Handsontable={extension:{},helper:{}};(function(e,t,n){"use strict";function i(e){this.isCellEdited=!1,this.instance=e,this.createElements(),this.bindEvents()}function o(e){this.isCellEdited=!1,this.instance=e,this.createElements(),this.bindEvents(),this.emptyStringLabel="   "}function s(e,t,i,o){n.helper.stringify(e.getDataAtRowProp(t,i))===n.helper.stringify(o.checkedTemplate)?e.setDataAtRowProp(t,i,o.uncheckedTemplate):e.setDataAtRowProp(t,i,o.checkedTemplate)}function r(t){if(!e.datepicker)throw Error("jQuery UI Datepicker dependency not found. Did you forget to include jquery-ui.custom.js or its substitute?");this.isCellEdited=!1,this.instance=t,this.createElements(),this.bindEvents()}function a(e){this.isCellEdited=!1,this.instance=e,this.createElements(),this.bindEvents()}function l(){var t,i=this,o=5;this.beforeInit=function(){this.autoColumnWidths=[],this.autoColumnSizeTmp={thead:null,theadTh:null,theadStyle:null,tbody:null,tbodyTd:null,noRenderer:null,noRendererTd:null,renderer:null,rendererTd:null,container:null,containerStyle:null,$container:null,$noRenderer:null,$renderer:null}},this.determineColumnWidth=function(i){var s,r=t.autoColumnSizeTmp;r.container||(s=document,r.thead=s.createElement("table"),r.thead.appendChild(s.createElement("thead")).appendChild(s.createElement("tr")).appendChild(s.createElement("th")),r.theadTh=r.thead.getElementsByTagName("th")[0],r.thead.className="htTable",r.theadStyle=r.thead.style,r.theadStyle.tableLayout="auto",r.theadStyle.width="auto",r.tbody=r.thead.cloneNode(!1),r.tbody.appendChild(s.createElement("tbody")).appendChild(s.createElement("tr")).appendChild(s.createElement("td")),r.tbodyTd=r.tbody.getElementsByTagName("td")[0],r.noRenderer=r.tbody.cloneNode(!0),r.noRendererTd=r.noRenderer.getElementsByTagName("td")[0],r.renderer=r.tbody.cloneNode(!0),r.rendererTd=r.renderer.getElementsByTagName("td")[0],r.container=s.createElement("div"),r.container.className=t.rootElement[0].className+" hidden",r.containerStyle=r.container.style,r.container.appendChild(r.thead),r.container.appendChild(r.tbody),r.container.appendChild(r.noRenderer),r.container.appendChild(r.renderer),r.$container=e(r.container),r.$noRenderer=e(r.noRenderer),r.$renderer=e(r.renderer),t.rootElement[0].parentNode.appendChild(r.container)),r.container.className=t.rootElement[0].className+" hidden";for(var a=t.countRows(),l={},c=0,h=0;a>h;h++){var u=n.helper.stringify(t.getDataAtCell(h,i)),d=u.length;d>c&&(c=d),l[d]||(l[d]={needed:o,strings:[]}),l[d].needed&&(l[d].strings.push(u),l[d].needed--)}var p=t.getSettings();p.colHeaders&&t.view.appendColHeader(i,r.theadTh);var f="";for(var m in l)if(l.hasOwnProperty(m))for(var g=0,w=l[m].strings.length;w>g;g++)f+=l[m].strings[g]+"<br>";r.tbodyTd.innerHTML=f,t.view.wt.wtDom.empty(r.rendererTd),t.view.wt.wtDom.empty(r.noRendererTd),r.containerStyle.display="block";var v=r.$container.outerWidth(),y=t.getCellMeta(0,i);if(y.renderer){var b=9999999999;r.noRendererTd.appendChild(document.createTextNode(b)),y.renderer(t,r.rendererTd,0,i,t.colToProp(i),b,y),v+=r.$renderer.width()-r.$noRenderer.width()}return r.containerStyle.display="none",v},this.determineColumnsWidth=function(){t=this;var e=this.getSettings();if(e.autoColumnSize||!e.colWidths)for(var n=this.countCols(),o=0;n>o;o++)this.autoColumnWidths[o]=i.determineColumnWidth(o)},this.getColWidth=function(e,t){this.autoColumnWidths[e]&&this.autoColumnWidths[e]>t.width&&(t.width=this.autoColumnWidths[e])}}function c(){var t,n=this;this.afterInit=function(){var t=this;this.getSettings().columnSorting&&(this.sortIndex=[],this.rootElement.on("click.handsontable",".columnSorting",function(i){var o=e(i.target);if(o.is(".columnSorting")){var s=o.closest("th").index();t.getSettings().rowHeaders&&s--,t.sortColumn===s?t.sortOrder=!t.sortOrder:(t.sortColumn=s,t.sortOrder=!0),n.sort.call(t),t.render()}}))},this.sort=function(){t=!1;var e=this;this.sortIndex.length=0;for(var n=0,i=this.countRows();i>n;n++)this.sortIndex.push([n,e.getDataAtCell(n,this.sortColumn)]);this.sortIndex.sort(function(t,n){return t[1]===n[1]?0:null===t[1]?1:null===n[1]?-1:t[1]<n[1]?e.sortOrder?-1:1:t[1]>n[1]?e.sortOrder?1:-1:0}),t=!0},this.translateRow=function(e){t&&this.sortIndex&&this.sortIndex.length&&(e.row=this.sortIndex[e.row][0])},this.getColHeader=function(t,n){this.getSettings().columnSorting&&(e(n).find("span.colHeader")[0].className+=" columnSorting")}}function h(){function t(e){var t=s.getSelected();if(t)switch(e){case"row_above":s.alter("insert_row",t[0]);break;case"row_below":s.alter("insert_row",t[2]+1);break;case"col_left":s.alter("insert_col",t[1]);break;case"col_right":s.alter("insert_col",t[3]+1);break;case"remove_row":s.alter(e,t[0],t[2]-t[0]+1);break;case"remove_col":s.alter(e,t[1],t[3]-t[1]+1);break;case"undo":s.undo();break;case"redo":s.redo()}}function n(e){return s.countRows()>=s.getSettings().maxRows&&("row_above"===e||"row_below"===e)?!0:s.countCols()>=s.getSettings().maxCols&&("col_left"===e||"col_right"===e)?!0:!1}var i,o,s=this,r=s.rootElement[0].id,a={row_above:{name:"Insert row above",disabled:n},row_below:{name:"Insert row below",disabled:n},hsep1:"---------",col_left:{name:"Insert column on the left",disabled:n},col_right:{name:"Insert column on the right",disabled:n},hsep2:"---------",remove_row:{name:"Remove row",disabled:n},remove_col:{name:"Remove column",disabled:n},hsep3:"---------",undo:{name:"Undo",disabled:function(){return!s.isUndoAvailable()}},redo:{name:"Redo",disabled:function(){return!s.isRedoAvailable()}}},l={selector:"#"+r+" table, #"+r+" div",trigger:"right",callback:t},c={},h=s.getSettings();if(h.contextMenu){if(h.contextMenu===!0)c.items=a;else if("[object Array]"===Object.prototype.toString.apply(h.contextMenu))for(c.items={},i=0,o=h.contextMenu.length;o>i;i++){var u=h.contextMenu[i];if(a[u]===void 0)throw Error('Context menu key "'+u+'" is not recognised');c.items[u]=a[u]}else if("[object Object]"===Object.prototype.toString.apply(h.contextMenu)){if(c=h.contextMenu,c.items)for(i in c.items)c.items.hasOwnProperty(i)&&a[i]&&(c.items[i]="string"==typeof c.items[i]?a[i]:e.extend(!0,a[i],c.items[i]));else c.items=a;if(c.callback){var d=l.callback,p=c.callback;c.callback=function(e,t){d(e,t),p(e,t)}}}if(!r)throw Error("Handsontable container must have an id");e.contextMenu(e.extend(!0,l,c))}}function u(){var t=this.rootElement[0].id;e.contextMenu("destroy","#"+t+" table, #"+t+" div")}function d(){var t,n,i,o,s,r,a=document.createElement("DIV"),l=a.style;a.className="ghost",l.position="absolute",l.top="25px",l.left=0,l.width="10px",l.height="10px",l.backgroundColor="#CCC",l.opacity=.7,e(document).mousemove(function(e){n&&(l.left=r+e.pageX-s+6+"px","none"===l.display&&(l.display="block"))}),e(document).mouseup(function(){n&&(o>i&&o--,t.getSettings().rowHeaders&&(i--,o--),t.manualColumnPositions.splice(o,0,t.manualColumnPositions.splice(i,1)[0]),e(".manualColumnMover.active").removeClass("active"),n=!1,t.forceFullRender=!0,t.view.render(),l.display="none",t.runHooks("afterColumnMove",i,o))}),this.beforeInit=function(){this.manualColumnPositions=[]},this.afterInit=function(){if(this.getSettings().manualColumnMove){var c=this;this.rootElement.on("mousedown.handsontable",".manualColumnMover",function(o){t=c;var h=e(o.target),u=h.closest("th");i=u.index(),n=!0,s=o.pageX;var d=c.rootElement.find(".htCore");d.parent()[0].appendChild(a),l.width=h.parent().width()+"px",l.height=d.height()+"px",r=parseInt(u.offset().left-d.offset().left,10),l.left=r+6+"px"}),this.rootElement.on("mouseenter.handsontable","td, th",function(){if(n){e(".manualColumnMover.active").removeClass("active");var t=c.rootElement.find("thead th");o=e(this).index();var i=t.eq(o).find(".manualColumnMover").addClass("active");t.not(i).removeClass("active")}})}},this.modifyCol=function(e){return this.getSettings().manualColumnMove?(this.manualColumnPositions[e]===void 0&&(this.manualColumnPositions[e]=e),this.manualColumnPositions[e]):e},this.getColHeader=function(e,t){if(this.getSettings().manualColumnMove){var n=document.createElement("DIV");n.className="manualColumnMover",t.firstChild.appendChild(n)}}}function p(){var t,n,i,o,s,r,a,l,c,h,u=0,d=document.createElement("DIV"),p=document.createElement("DIV"),f=p.style;d.className="manualColumnResizer",p.className="manualColumnResizerLine",f.position="absolute",f.top=0,f.left=0,f.width=0,f.borderRight="1px dashed #777",p.appendChild(d),e(document).mousemove(function(e){t&&(i=c+(e.pageX-l),r=m(n,i),f.left=h+i-1+"px","none"===f.display&&(f.display="block"))}),e(document).mouseup(function(){t&&(e(".manualColumnResizer.active").removeClass("active"),t=!1,s.forceFullRender=!0,s.view.render(),f.display="none",s.runHooks("afterColumnResize",n,r))}),this.beforeInit=function(){this.manualColumnWidths=[]},this.afterInit=function(){if(this.getSettings().manualColumnResize){var d=this;this.rootElement.on("mousedown.handsontable",".manualColumnResizer",function(){null==o&&(o=setTimeout(function(){u>=2&&(m(n,M.determineColumnWidth.call(s,n)),s.runHooks("afterColumnResize",n,r)),u=0,o=null},500)),u++}),this.rootElement.on("mousedown.handsontable",".manualColumnResizer",function(o){var r=o.target,u=d.rootElement.find(".htCore"),m=e(r.parentNode.parentNode);s=d,n=r.getAttribute("rel"),a=e(d.rootElement[0].getElementsByTagName("col")[m.index()]),t=!0,l=o.pageX,c=a.width(),i=c,r.className+=" active",f.height=u.height()+"px",u.parent()[0].appendChild(p),h=parseInt(m.offset().left-u.offset().left,10),f.left=h+i-1+"px"})}};var m=function(e,t){return t=Math.max(t,20),t=Math.min(t,500),s.manualColumnWidths[e]=t,t};this.getColHeader=function(e,t){if(this.getSettings().manualColumnResize){var n=document.createElement("DIV");n.className="manualColumnResizer",n.setAttribute("rel",e),t.firstChild.appendChild(n)}},this.getColWidth=function(e,t){this.getSettings().manualColumnResize&&this.manualColumnWidths[e]&&(t.width=this.manualColumnWidths[e])}}function f(e){var t,n=this;e=e||document.body,this.elDiv=document.createElement("DIV"),t=this.elDiv.style,t.position="fixed",t.top=0,t.left=0,e.appendChild(this.elDiv),this.elTextarea=document.createElement("TEXTAREA"),this.elTextarea.className="copyPaste",t=this.elTextarea.style,t.width="1px",t.height="1px",this.elDiv.appendChild(this.elTextarea),t.opacity!==void 0&&(t.opacity=0),this._bindEvent(e,"keydown",function(e){var t=!1;e.metaKey?t=!0:e.ctrlKey&&-1===navigator.userAgent.indexOf("Mac")&&(t=!0),t&&(n.selectNodeText(n.elTextarea),setTimeout(function(){n.selectNodeText(n.elTextarea)},0)),!t||67!==e.keyCode&&86!==e.keyCode&&88!==e.keyCode||(88===e.keyCode?setTimeout(function(){n.triggerCut(e)},0):86===e.keyCode&&setTimeout(function(){n.triggerPaste(e)},0))})}function m(e,t){var n;this.instance=e,this.settings=t,this.wtDom=this.instance.wtDom,this.main=document.createElement("div"),n=this.main.style,n.position="absolute",n.top=0,n.left=0;for(var i=0;5>i;i++){var o=document.createElement("DIV");o.className="wtBorder "+(t.className||""),n=o.style,n.backgroundColor=t.border.color,n.height=t.border.width+"px",n.width=t.border.width+"px",this.main.appendChild(o)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.topStyle=this.top.style,this.leftStyle=this.left.style,this.bottomStyle=this.bottom.style,this.rightStyle=this.right.style,this.corner=this.main.childNodes[4],this.corner.className+=" corner",this.cornerStyle=this.corner.style,this.cornerStyle.width="5px",this.cornerStyle.height="5px",this.cornerStyle.border="2px solid #FFF",this.disappear(),e.wtTable.hider.appendChild(this.main)}function g(){this.offset=0,this.total=0,this.fixedCount=0}function w(){this.cache=[]}function v(){this.countTH=0}function y(e,t,n){var i,o=0;for(this.containerSizeFn=e,this.cellSizesSum=0,this.cellSizes=[],this.cellCount=0,this.remainingSize=0;;){if(i=t(o),void 0===i)break;if(this.cellSizesSum>=this.getContainerSize(this.cellSizesSum+i))break;this.cellSizes.push(i),this.cellSizesSum+=i,this.cellCount++,o++}var s=this.getContainerSize(this.cellSizesSum);if(this.remainingSize=this.cellSizesSum-s,"all"===n){if(0>this.remainingSize){var r,a=s/this.cellSizesSum;for(o=0;this.cellCount-1>o;o++)r=Math.floor(a*this.cellSizes[o]),this.remainingSize+=r-this.cellSizes[o],this.cellSizes[o]=r;this.cellSizes[this.cellCount-1]-=this.remainingSize,this.remainingSize=0}}else"last"===n&&0>this.remainingSize&&(this.cellSizes[this.cellCount-1]-=this.remainingSize,this.remainingSize=0)}function b(e){var t=this,n=[];if(this.wtSettings=new k(this,e),this.wtDom=new C,this.wtTable=new D(this),this.wtScroll=new T(this),this.wtWheel=new $(this),this.wtEvent=new S(this),this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var i=0,o=this.wtTable.THEAD.childNodes[0].childNodes.length;o>i;i++)n.push(this.wtTable.THEAD.childNodes[0].childNodes[i].innerHTML);this.hasSetting("columnHeaders")||this.update("columnHeaders",function(e,i){t.wtDom.avoidInnerHTML(i,n[e])})}this.selections={};var s=this.getSetting("selections");if(s)for(var r in s)s.hasOwnProperty(r)&&(this.selections[r]=new R(this,s[r]));this.drawn=!1,this.drawInterrupted=!1}function C(){}function S(t){var n=this;this.instance=t,this.wtDom=this.instance.wtDom;var i=[null,null,null,null];this.instance.dblClickTimeout=null;var o,s=function(e){var t=n.parentCell(e.target);t.TD&&"TD"===t.TD.nodeName?n.instance.hasSetting("onCellMouseDown")&&n.instance.getSetting("onCellMouseDown",e,t.coords,t.TD):n.wtDom.hasClass(e.target,"corner")&&n.instance.getSetting("onCellCornerMouseDown",e,e.target),2!==e.button&&(t.TD&&"TD"===t.TD.nodeName?(i.shift(),i.push(t.TD)):n.wtDom.hasClass(e.target,"corner")&&(i.shift(),i.push(e.target)))},r=function(e){if(n.instance.hasSetting("onCellMouseOver")){var t=n.wtDom.closest(e.target,["TD","TH"]);t&&t!==o&&(o=t,"TD"===t.nodeName&&n.instance.getSetting("onCellMouseOver",e,n.instance.wtTable.getCoords(t),t))}},a=function(e){if(2!==e.button){var t=n.parentCell(e.target);t.TD&&"TD"===t.TD.nodeName?(i.shift(),i.push(t.TD)):(i.shift(),i.push(e.target)),null!==i[3]&&i[3]===i[2]&&(n.instance.dblClickTimeout&&i[2]===i[1]&&i[1]===i[0]?(t.TD?n.instance.getSetting("onCellDblClick",e,t.coords,t.TD):n.wtDom.hasClass(e.target,"corner")&&n.instance.getSetting("onCellCornerDblClick",e,t.coords,t.TD),clearTimeout(n.instance.dblClickTimeout),n.instance.dblClickTimeout=null):(clearTimeout(n.instance.dblClickTimeout),n.instance.dblClickTimeout=setTimeout(function(){n.instance.dblClickTimeout=null},500)))}};e(this.instance.wtTable.parent).on("mousedown",s),e(this.instance.wtTable.TABLE).on("mouseover",r),e(this.instance.wtTable.parent).on("mouseup",a)}function x(){}function T(e){this.instance=e,this.wtScrollbarV=new N(e),this.wtScrollbarH=new V(e)}function E(){}function R(e,t){this.instance=e,this.settings=t,this.selected=[],t.border&&(this.border=new m(e,t))}function k(e,t){var n=this;this.instance=e,this.defaults={table:void 0,scrollH:"auto",scrollV:"auto",stretchH:"hybrid",currentRowClassName:null,currentColumnClassName:null,data:void 0,offsetRow:0,offsetColumn:0,fixedColumnsLeft:0,fixedRowsTop:0,rowHeaders:null,columnHeaders:null,totalRows:void 0,totalColumns:void 0,width:null,height:null,cellRenderer:function(e,t,i){var o=n.getSetting("data",e,t);n.instance.wtDom.avoidInnerHTML(i,void 0===o||null===o?"":o)},columnWidth:50,selections:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,scrollbarWidth:10,scrollbarHeight:10,rowHeaderWidth:50},this.settings={};for(var i in this.defaults)if(this.defaults.hasOwnProperty(i))if(void 0!==t[i])this.settings[i]=t[i];else{if(void 0===this.defaults[i])throw Error('A required setting "'+i+'" was not provided');this.settings[i]=this.defaults[i]}this.rowHeightCache=[]}function D(t){this.instance=t,this.TABLE=this.instance.getSetting("table"),this.wtDom=this.instance.wtDom,this.wtDom.removeTextNodes(this.TABLE),this.hasEmptyCellProblem=e.browser.msie&&7>=parseInt(e.browser.version,10),this.hasCellSpacingProblem=e.browser.msie&&7>=parseInt(e.browser.version,10),this.hasCellSpacingProblem&&(this.TABLE.cellSpacing=0);var n=this.TABLE.parentNode;if(!n||1!==n.nodeType||!this.wtDom.hasClass(n,"wtHolder")){var i=document.createElement("DIV");if(this.instance.hasSetting("width")&&this.instance.hasSetting("height")){var o=i.style;o.position="absolute",o.top="0",o.left="0",o.width="4000px",o.height="4000px"}i.className="wtSpreader",n&&n.insertBefore(i,this.TABLE),i.appendChild(this.TABLE)}if(this.spreader=this.TABLE.parentNode,n=this.spreader.parentNode,!n||1!==n.nodeType||!this.wtDom.hasClass(n,"wtHolder")){var s=document.createElement("DIV");s.className="wtHider",n&&n.insertBefore(s,this.spreader),s.appendChild(this.spreader)}if(this.hider=this.spreader.parentNode,this.hiderStyle=this.hider.style,this.hiderStyle.position="relative",n=this.hider.parentNode,!n||1!==n.nodeType||!this.wtDom.hasClass(n,"wtHolder")){var r=document.createElement("DIV");r.style.position="relative",r.className="wtHolder",n&&n.insertBefore(r,this.hider),r.appendChild(this.hider)}if(this.parent=this.hider.parentNode,this.TBODY=this.TABLE.getElementsByTagName("TBODY")[0],this.TBODY||(this.TBODY=document.createElement("TBODY"),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.getElementsByTagName("THEAD")[0],this.THEAD||(this.THEAD=document.createElement("THEAD"),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.getElementsByTagName("COLGROUP")[0],this.COLGROUP||(this.COLGROUP=document.createElement("COLGROUP"),this.TABLE.insertBefore(this.COLGROUP,this.THEAD)),this.instance.hasSetting("columnHeaders")&&!this.THEAD.childNodes.length){var a=document.createElement("TR");this.THEAD.appendChild(a)}this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length,this.oldCellCache=new w,this.currentCellCache=new w,this.rowFilter=new x,this.columnFilter=new v}function $(t){var n=this;this.instance=t,e(this.instance.wtTable.TABLE).on("mousewheel",function(e,t,i,o){clearTimeout(n.instance.wheelTimeout),n.instance.wheelTimeout=setTimeout(function(){o?n.instance.wtScroll.wtScrollbarV.visible&&n.instance.scrollVertical(-Math.ceil(o)).draw():i&&n.instance.wtScroll.wtScrollbarH.visible&&n.instance.scrollHorizontal(Math.ceil(i)).draw()},0),e.preventDefault()})}n.Core=function(i,o){function s(t,n){for(var i=e.Deferred(),o=[],s=function(n){var i=e.Deferred();o.push(i);var s=t[n][3],r="string"==typeof s?s.toLowerCase():null;return function(e){for(var o=!1,a=0,l=e.length;l>a;a++){if(s===e[a]){o=!0;break}if(r===e[a].toLowerCase()){t[n][3]=e[a],o=!0;break}}o||(t[n]=null),i.resolve()}},r=t.length-1;r>=0;r--){var a=w.getCellMeta(t[r][0],u.propToCol(t[r][1]));a.strict&&a.source&&(e.isFunction(a.source)?a.source(t[r][3],s(r)):s(r)(a.source))}return e.when.apply(e,o).then(function(){for(var o=t.length-1;o>=0;o--)if(null===t[o])t.splice(o,1);else{var s=w.getCellMeta(t[o][0],u.propToCol(t[o][1]));"number"===s.dataType&&"string"==typeof t[o][3]&&t[o][3].length>0&&/^[0-9\s]*[.]*[0-9]*$/.test(t[o][3])&&(t[o][3]=numeral().unformat(t[o][3]||"0"))}if(t.length){var r=w.runHooks("beforeChange",t,n);"function"==typeof r?e.when(r).then(function(){i.resolve()}):(r===!1&&t.splice(0,t.length),i.resolve())}else i.resolve()}),e.when(i)}function r(e,t){var n=e.length-1;if(!(0>n)){for(;n>=0;n--)if(null!==e[n]){if(l.settings.minSpareRows)for(;e[n][0]>w.countRows()-1;)u.createRow();if("array"===l.dataType&&l.settings.minSpareCols)for(;u.propToCol(e[n][1])>w.countCols()-1;)u.createCol();u.set(e[n][0],e[n][1],e[n][3])}else e.splice(n,1);w.forceFullRender=!0,d.adjustRowsAndCols(),p.refreshBorders(),w.runHooks("afterChange",e,t||"edit")}}function a(t,n,i){return"object"==typeof t?t:e.isPlainObject(i)?i:[[t,n,i]]}var l,c,h,u,d,p,m,g,w=this,v=function(){};n.helper.inherit(v,H),n.helper.extend(v.prototype,o),this.rootElement=i,this.guid="ht_"+n.helper.randomString(),this.rootElement[0].id||(this.rootElement[0].id=this.guid),l={columnSettings:[],columnsSettingConflicts:["data","width"],settings:new v,settingsFromDOM:{},selStart:new n.SelectionPoint,selEnd:new n.SelectionPoint,editProxy:!1,isPopulated:null,scrollable:null,undoRedo:null,extensions:{},colToProp:null,propToCol:null,dataSchema:null,dataType:"array",firstRun:!0},c={beforeInitWalkontable:[],beforeInit:[],beforeRender:[],beforeChange:[],beforeGet:[],beforeSet:[],beforeGetCellMeta:[],beforeAutofill:[],afterInit:[],afterLoadData:[],afterRender:[],afterChange:[],afterGetCellMeta:[],afterGetColHeader:[],afterGetColWidth:[],afterDestroy:[],afterRemoveRow:[],afterCreateRow:[],afterRemoveCol:[],afterCreateCol:[],afterColumnResize:[],afterColumnMove:[],afterDeselect:[],afterSelection:[],afterSelectionByProp:[],afterSelectionEnd:[],afterSelectionEndByProp:[],afterCopyLimit:[]},h={onBeforeChange:"beforeChange",onChange:"afterChange",onCreateRow:"afterCreateRow",onCreateCol:"afterCreateCol",onSelection:"afterSelection",onCopyLimit:"afterCopyLimit",onSelectionEnd:"afterSelectionEnd",onSelectionByProp:"afterSelectionByProp",onSelectionEndByProp:"afterSelectionEndByProp"},u={recursiveDuckSchema:function(t){var n;if(e.isPlainObject(t)){n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.isPlainObject(t[i])?u.recursiveDuckSchema(t[i]):null)}else n=[];return n},recursiveDuckColumns:function(t,n,i){var o,s;if(n===void 0&&(n=0,i=""),e.isPlainObject(t))for(s in t)t.hasOwnProperty(s)&&(null===t[s]?(o=i+s,l.colToProp.push(o),l.propToCol[o]=n,n++):n=u.recursiveDuckColumns(t[s],n,s+"."));return n},createMap:function(){if(u.getSchema()===void 0)throw Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");var e,t,n=u.getSchema();if(l.colToProp=[],l.propToCol={},l.settings.columns)for(e=0,t=l.settings.columns.length;t>e;e++)l.colToProp[e]=l.settings.columns[e].data,l.propToCol[l.settings.columns[e].data]=e;else u.recursiveDuckColumns(n)},colToProp:function(e){return e=n.PluginModifiers.run(w,"col",e),l.colToProp&&l.colToProp[e]!==void 0?l.colToProp[e]:e},propToCol:function(e){var t;return t=l.propToCol[e]!==void 0?l.propToCol[e]:e,t=n.PluginModifiers.run(w,"col",t)},getSchema:function(){return l.settings.dataSchema?"function"==typeof l.settings.dataSchema?l.settings.dataSchema():l.settings.dataSchema:l.duckDataSchema},createRow:function(t){var n,i=w.countRows();if(("number"!=typeof t||t>=i)&&(t=i),"array"===l.dataType){n=[];for(var o=0,s=w.countCols();s>o;o++)n.push(null)}else n="function"===l.dataType?l.settings.dataSchema(t):e.extend(!0,{},u.getSchema());t===i?v.prototype.data.push(n):v.prototype.data.splice(t,0,n),w.runHooks("afterCreateRow",t),w.forceFullRender=!0},createCol:function(e){if("object"===l.dataType||l.settings.columns)throw Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting");var t=0,i=w.countRows(),o=v.prototype.data,s=n.helper.columnFactory(v,l.columnsSettingConflicts,n.TextCell);if("number"!=typeof e||e>=w.countCols()){for(;i>t;t++)o[t]===void 0&&(o[t]=[]),o[t].push("");l.columnSettings.push(s)}else{for(;i>t;t++)o[t].splice(e,0,"");l.columnSettings.splice(e,0,s)}w.runHooks("afterCreateCol",e),w.forceFullRender=!0},removeRow:function(e,t){t||(t=1),"number"!=typeof e&&(e=-t),v.prototype.data.splice(e,t),w.runHooks("afterRemoveRow",e,t),w.forceFullRender=!0},removeCol:function(e,t){if("object"===l.dataType||l.settings.columns)throw Error("cannot remove column with object data source or columns option specified");t||(t=1),"number"!=typeof e&&(e=-t);for(var n=v.prototype.data,i=0,o=w.countRows();o>i;i++)n[i].splice(e,t);w.runHooks("afterRemoveCol",e,t),l.columnSettings.splice(e,t),w.forceFullRender=!0},spliceCol:function(e,t,n){for(var i,o=arguments.length>=4?[].slice.call(arguments,3):[],s=[],r=[],a=[],l=v.prototype.data,c=o.length-n,h=t+n,u=l.length,d=0;u>d;d++)t>d?s.push(l[d][e]):d>=h?a.push(l[d][e]):r.push(l[d][e]);for(i=[].concat(s,o,a),c>0&&(u+=c,w.alter("insert_row",null,c,"spliceCol",!0)),d=0;u>d;d++)l[d][e]=i[d]!==void 0?i[d]:null;return w.forceFullRender=!0,p.refreshBorders(),r},spliceRow:function(e,t,n){for(var i,o=arguments.length>=4?[].slice.call(arguments,3):[],s=[],r=[],a=[],l=v.prototype.data[e],c=o.length-n,h=t+n,u=l.length,d=0;u>d;d++)t>d?s.push(l[d]):d>=h?a.push(l[d]):r.push(l[d]);for(i=[].concat(s,o,a),c>0&&(u+=c,w.alter("insert_col",null,c,"spliceRow",!0)),d=0;u>d;d++)l[d]=i[d]!==void 0?i[d]:null;return w.forceFullRender=!0,p.refreshBorders(),r},getVars:{},get:function(e,t){if(u.getVars.row=e,u.getVars.prop=t,w.runHooks("beforeGet",u.getVars),"string"==typeof u.getVars.prop&&u.getVars.prop.indexOf(".")>-1){var n=u.getVars.prop.split("."),i=l.settings.data[u.getVars.row];if(!i)return null;for(var o=0,s=n.length;s>o;o++)if(i=i[n[o]],i===void 0)return null;return i}return"function"==typeof u.getVars.prop?u.getVars.prop(l.settings.data.slice(u.getVars.row,u.getVars.row+1)[0]):l.settings.data[u.getVars.row]?l.settings.data[u.getVars.row][u.getVars.prop]:null},setVars:{},set:function(e,t,n,i){if(u.setVars.row=e,u.setVars.prop=t,u.setVars.value=n,w.runHooks("beforeSet",u.setVars,i||"datamapGet"),"string"==typeof u.setVars.prop&&u.setVars.prop.indexOf(".")>-1){for(var o=u.setVars.prop.split("."),s=l.settings.data[u.setVars.row],r=0,a=o.length-1;a>r;r++)s=s[o[r]];s[o[r]]=u.setVars.value}else"function"==typeof u.setVars.prop?u.setVars.prop(l.settings.data.slice(u.setVars.row,u.setVars.row+1)[0],u.setVars.value):l.settings.data[u.setVars.row][u.setVars.prop]=u.setVars.value},clear:function(){for(var e=0;w.countRows()>e;e++)for(var t=0;w.countCols()>t;t++)u.set(e,u.colToProp(t),"")},getAll:function(){return l.settings.data},getRange:function(e,t){var n,i,o,s,r,a=[];for(i=Math.max(e.row,t.row),s=Math.max(e.col,t.col),n=Math.min(e.row,t.row);i>=n;n++){for(r=[],o=Math.min(e.col,t.col);s>=o;o++)r.push(u.get(n,u.colToProp(o)));a.push(r)}return a},getText:function(e,t){return SheetClip.stringify(u.getRange(e,t))}},d={alter:function(t,n,i,o,s){var r,a,c,h,f,m,g,v;switch(r=e.extend(!0,[],u.getAll()),t){case"insert_row":for(i||(i=1),v=0;i>v&&w.countRows()<l.settings.maxRows;)u.createRow(n),v++;
v&&(l.selStart.exists()&&l.selStart.row()>=n?(l.selStart.row(l.selStart.row()+v),p.transformEnd(v,0)):p.refreshBorders());break;case"insert_col":for(i||(i=1),v=0;i>v&&w.countCols()<l.settings.maxCols;)u.createCol(n),v++;v&&(l.selStart.exists()&&l.selStart.col()>=n?(l.selStart.col(l.selStart.col()+v),p.transformEnd(0,v)):p.refreshBorders());break;case"remove_row":u.removeRow(n,i),d.adjustRowsAndCols(),p.refreshBorders();break;case"remove_col":u.removeCol(n,i),d.adjustRowsAndCols(),p.refreshBorders();break;default:throw Error('There is no such action "'+t+'"')}for(c=[],a=u.getAll(),h=0,f=a.length;f>h;h++)for(m=0,g=a[h].length;g>m;m++)c.push([h,m,r[h]?r[h][m]:null,a[h][m]]);w.runHooks("afterChange",c,o||t),s||d.adjustRowsAndCols()},adjustRowsAndCols:function(){var e,t,n,i=w.countEmptyRows(!0);if(t=w.countRows(),l.settings.minRows>t)for(e=0;l.settings.minRows-t>e;e++)u.createRow();if(l.settings.minSpareRows>i)for(;l.settings.minSpareRows>i&&w.countRows()<l.settings.maxRows;i++)u.createRow();if(n=w.countEmptyCols(!0),!l.settings.columns&&w.countCols()<l.settings.minCols)for(;w.countCols()<l.settings.minCols;n++)u.createCol();if(!l.settings.columns&&"array"===l.dataType&&l.settings.minSpareCols>n)for(;l.settings.minSpareCols>n&&w.countCols()<l.settings.maxCols;n++)u.createCol();if(l.settings.enterBeginsEditing)for(;(l.settings.minRows||l.settings.minSpareRows)&&w.countRows()>l.settings.minRows&&l.settings.minSpareRows&&i>l.settings.minSpareRows;i--)u.removeRow();if(l.settings.enterBeginsEditing&&!l.settings.columns)for(;(l.settings.minCols||l.settings.minSpareCols)&&w.countCols()>l.settings.minCols&&l.settings.minSpareCols&&n>l.settings.minSpareCols;n--)u.removeCol();var o=w.countRows(),s=w.countCols();if((0===o||0===s)&&p.deselect(),l.selStart.exists()){var r,a=l.selStart.row(),c=l.selStart.col(),h=l.selEnd.row(),d=l.selEnd.col();a>o-1?(a=o-1,r=!0,h>a&&(h=a)):h>o-1&&(h=o-1,r=!0,a>h&&(a=h)),c>s-1?(c=s-1,r=!0,d>c&&(d=c)):d>s-1&&(d=s-1,r=!0,c>d&&(c=d)),r&&w.selectCell(a,c,h,d)}},populateFromArray:function(e,t,n,i){var o,s,r,a,c=[],h={};if(s=t.length,0===s)return!1;for(h.row=e.row,h.col=e.col,o=0;s>o&&!(n&&h.row>n.row||!l.settings.minSpareRows&&h.row>w.countRows()-1||h.row>=l.settings.maxRows);o++){for(h.col=e.col,a=t[o]?t[o].length:0,r=0;a>r&&!(n&&h.col>n.col||!l.settings.minSpareCols&&h.col>w.countCols()-1||h.col>=l.settings.maxCols);r++)w.getCellMeta(h.row,h.col).isWritable&&c.push([h.row,h.col,t[o][r]]),h.col++,n&&r===a-1&&(r=-1);h.row++,n&&o===s-1&&(o=-1)}w.setDataAtCell(c,null,null,i||"populateFromArray")},getCornerCoords:function(t){function n(t,n,i){function o(e){return e[i]}return Array.prototype.map?t.apply(Math,n.map(o)):t.apply(Math,e.map(n,o))}return{TL:{row:n(Math.min,t,"row"),col:n(Math.min,t,"col")},BR:{row:n(Math.max,t,"row"),col:n(Math.max,t,"col")}}},getCellsAtCoords:function(e,t){var n,i,o=d.getCornerCoords([e,t]),s=[];for(n=o.TL.row;o.BR.row>=n;n++)for(i=o.TL.col;o.BR.col>=i;i++)s.push(w.view.getCellAtCoords({row:n,col:i}));return s}},this.selection=p={inProgress:!1,begin:function(){w.selection.inProgress=!0},finish:function(){var e=w.getSelected();w.runHooks("afterSelectionEnd",e[0],e[1],e[2],e[3]),w.runHooks("afterSelectionEndByProp",e[0],w.colToProp(e[1]),e[2],w.colToProp(e[3])),w.selection.inProgress=!1},isInProgress:function(){return w.selection.inProgress},setRangeStart:function(e){l.selStart.coords(e),p.setRangeEnd(e)},setRangeEnd:function(e,t){w.selection.begin(),l.selEnd.coords(e),l.settings.multiSelect||l.selStart.coords(e),w.view.wt.selections.current.clear(),w.view.wt.selections.current.add(l.selStart.arr()),w.view.wt.selections.area.clear(),p.isMultiple()&&(w.view.wt.selections.area.add(l.selStart.arr()),w.view.wt.selections.area.add(l.selEnd.arr())),(l.settings.currentRowClassName||l.settings.currentColClassName)&&(w.view.wt.selections.highlight.clear(),w.view.wt.selections.highlight.add(l.selStart.arr()),w.view.wt.selections.highlight.add(l.selEnd.arr())),w.runHooks("afterSelection",l.selStart.row(),l.selStart.col(),l.selEnd.row(),l.selEnd.col()),w.runHooks("afterSelectionByProp",l.selStart.row(),u.colToProp(l.selStart.col()),l.selEnd.row(),u.colToProp(l.selEnd.col())),t!==!1&&(w.view.scrollViewport(e),w.view.wt.draw(!0),w.view.scrollViewport(e)),p.refreshBorders()},refreshBorders:function(e,t){t||m.destroy(e),w.view.render(),p.isSelected()&&!t&&m.prepare()},isMultiple:function(){return!(l.selEnd.col()===l.selStart.col()&&l.selEnd.row()===l.selStart.row())},transformStart:function(e,t,n){l.selStart.row()+e>w.countRows()-1?n&&l.settings.minSpareRows>0?w.alter("insert_row",w.countRows()):l.settings.autoWrapCol&&l.selStart.col()+t<w.countCols()-1&&(e=1-w.countRows(),t=1):l.settings.autoWrapCol&&0>l.selStart.row()+e&&l.selStart.col()+t>=0&&(e=w.countRows()-1,t=-1),l.selStart.col()+t>w.countCols()-1?n&&l.settings.minSpareCols>0?w.alter("insert_col",w.countCols()):l.settings.autoWrapRow&&l.selStart.row()+e<w.countRows()-1&&(e=1,t=1-w.countCols()):l.settings.autoWrapRow&&0>l.selStart.col()+t&&l.selStart.row()+e>=0&&(e=-1,t=w.countCols()-1);var i=w.countRows(),o=w.countCols(),s={row:l.selStart.row()+e,col:l.selStart.col()+t};0>s.row?s.row=0:s.row>0&&s.row>=i&&(s.row=i-1),0>s.col?s.col=0:s.col>0&&s.col>=o&&(s.col=o-1),p.setRangeStart(s)},transformEnd:function(e,t){if(l.selEnd.exists()){var n=w.countRows(),i=w.countCols(),o={row:l.selEnd.row()+e,col:l.selEnd.col()+t};0>o.row?o.row=0:o.row>0&&o.row>=n&&(o.row=n-1),0>o.col?o.col=0:o.col>0&&o.col>=i&&(o.col=i-1),p.setRangeEnd(o)}},isSelected:function(){return l.selEnd.exists()},inInSelection:function(e){if(!p.isSelected())return!1;var t=d.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]);return t.TL.row<=e.row&&t.BR.row>=e.row&&t.TL.col<=e.col&&t.BR.col>=e.col},deselect:function(){p.isSelected()&&(w.selection.inProgress=!1,l.selEnd=new n.SelectionPoint,w.view.wt.selections.current.clear(),w.view.wt.selections.area.clear(),m.destroy(),p.refreshBorders(),w.runHooks("afterDeselect"))},selectAll:function(){l.settings.multiSelect&&(p.setRangeStart({row:0,col:0}),p.setRangeEnd({row:w.countRows()-1,col:w.countCols()-1},!1))},empty:function(){if(p.isSelected()){var e,t,n=d.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]),i=[];for(e=n.TL.row;n.BR.row>=e;e++)for(t=n.TL.col;n.BR.col>=t;t++)w.getCellMeta(e,t).isWritable&&i.push([e,t,""]);w.setDataAtCell(i)}}},this.autofill=g={handle:null,init:function(){g.handle?g.handle.disabled=!1:g.handle={}},disable:function(){g.handle.disabled=!0},selectAdjacent:function(){var e,t,n,i,o;e=p.isMultiple()?w.view.wt.selections.area.getCorners():w.view.wt.selections.current.getCorners(),t=u.getAll();e:for(n=e[2]+1;w.countRows()>n;n++){for(o=e[1];e[3]>=o;o++)if(t[n][o])break e;(t[n][e[1]-1]||t[n][e[3]+1])&&(i=n)}i&&(w.view.wt.selections.fill.clear(),w.view.wt.selections.fill.add([e[0],e[1]]),w.view.wt.selections.fill.add([i,e[3]]),g.apply())},apply:function(){var e,t,n,i,o;g.handle.isDragged=0,e=w.view.wt.selections.fill.getCorners(),e&&(w.view.wt.selections.fill.clear(),t=p.isMultiple()?w.view.wt.selections.area.getCorners():w.view.wt.selections.current.getCorners(),e[0]===t[0]&&e[1]<t[1]?(n={row:e[0],col:e[1]},i={row:e[2],col:t[1]-1}):e[0]===t[0]&&e[3]>t[3]?(n={row:e[0],col:t[3]+1},i={row:e[2],col:e[3]}):e[0]<t[0]&&e[1]===t[1]?(n={row:e[0],col:e[1]},i={row:t[0]-1,col:e[3]}):e[2]>t[2]&&e[1]===t[1]&&(n={row:t[2]+1,col:e[1]},i={row:e[2],col:e[3]}),n&&(o=SheetClip.parse(u.getText(l.selStart.coords(),l.selEnd.coords())),w.runHooks("beforeAutofill",n,i,o),d.populateFromArray(n,o,i,"autofill"),p.setRangeStart({row:e[0],col:e[1]}),p.setRangeEnd({row:e[2],col:e[3]})))},showBorder:function(e){e.row=e[0],e.col=e[1];var t=d.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]);if("horizontal"!==l.settings.fillHandle&&(t.BR.row<e.row||t.TL.row>e.row))e=[e.row,t.BR.col];else{if("vertical"===l.settings.fillHandle)return;e=[t.BR.row,e.col]}w.view.wt.selections.fill.clear(),w.view.wt.selections.fill.add([l.selStart.coords().row,l.selStart.coords().col]),w.view.wt.selections.fill.add([l.selEnd.coords().row,l.selEnd.coords().col]),w.view.wt.selections.fill.add(e),w.view.render()}},m={init:function(){function t(){p.empty()}function i(e){w.addHookOnce("afterChange",function(e){if(e.length){var t=e[e.length-1];p.setRangeEnd({row:t[0],col:w.propToCol(t[1])})}});var t=e.replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),n=SheetClip.parse(t),i=d.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]);switch(l.settings.pasteMode){case"shift_down":w.alter("insert_row",i.TL.row,n.length);break;case"shift_right":w.alter("insert_col",i.TL.col,n[0].length);break;default:}d.populateFromArray(i.TL,n,{row:Math.max(i.BR.row,n.length-1+i.TL.row),col:Math.max(i.BR.col,n[0].length-1+i.TL.col)},"paste")}function o(e){if(l.settings.beforeOnKeyDown&&l.settings.beforeOnKeyDown.call(w,e),!s.children(".context-menu-list:visible").length){if(17===e.keyCode||224===e.keyCode||91===e.keyCode||93===e.keyCode)return m.setCopyableText(),void 0;if(l.lastKeyCode=e.keyCode,p.isSelected()){var t=(e.ctrlKey||e.metaKey)&&!e.altKey;if(n.helper.isPrintableChar(e.keyCode)&&t)return 65===e.keyCode?(p.selectAll(),m.setCopyableText(),e.preventDefault()):89===e.keyCode||e.shiftKey&&90===e.keyCode?l.undoRedo&&l.undoRedo.redo():90===e.keyCode&&l.undoRedo&&l.undoRedo.undo(),void 0;var i=e.shiftKey?p.setRangeEnd:p.setRangeStart;switch(e.keyCode){case 38:e.shiftKey?p.transformEnd(-1,0):p.transformStart(-1,0),e.preventDefault(),e.stopPropagation();break;case 9:var o="function"==typeof l.settings.tabMoves?l.settings.tabMoves(e):l.settings.tabMoves;e.shiftKey?p.transformStart(-o.row,-o.col):p.transformStart(o.row,o.col,!0),e.preventDefault(),e.stopPropagation();break;case 39:e.shiftKey?p.transformEnd(0,1):p.transformStart(0,1),e.preventDefault(),e.stopPropagation();break;case 37:e.shiftKey?p.transformEnd(0,-1):p.transformStart(0,-1),e.preventDefault(),e.stopPropagation();break;case 8:case 46:l.settings.onDeleteDown?l.settings.onDeleteDown(e):(p.empty(e),e.preventDefault());break;case 40:e.shiftKey?p.transformEnd(1,0):p.transformStart(1,0),e.preventDefault(),e.stopPropagation();break;case 113:e.preventDefault();break;case 13:if(l.settings.onEnterDown)l.settings.onEnterDown(e);else{var r="function"==typeof l.settings.enterMoves?l.settings.enterMoves(e):l.settings.enterMoves;e.shiftKey?p.transformStart(-r.row,-r.col):p.transformStart(r.row,r.col,!0),e.preventDefault()}break;case 36:e.ctrlKey||e.metaKey?i({row:0,col:l.selStart.col()}):i({row:l.selStart.row(),col:0}),e.preventDefault(),e.stopPropagation();break;case 35:e.ctrlKey||e.metaKey?i({row:w.countRows()-1,col:l.selStart.col()}):i({row:l.selStart.row(),col:w.countCols()-1}),e.preventDefault(),e.stopPropagation();break;case 33:p.transformStart(-w.countVisibleRows(),0),w.view.wt.scrollVertical(-w.countVisibleRows()),w.view.render(),e.preventDefault(),e.stopPropagation();break;case 34:p.transformStart(w.countVisibleRows(),0),w.view.wt.scrollVertical(w.countVisibleRows()),w.view.render(),e.preventDefault(),e.stopPropagation();break;default:}}}}var s=e(document.body);w.copyPaste=new f(w.rootElement[0]),w.copyPaste.onCut(t),w.copyPaste.onPaste(i),w.rootElement.on("keydown.handsontable."+w.guid,o)},destroy:function(e){if("function"==typeof l.editorDestroyer){var t=l.editorDestroyer;l.editorDestroyer=null,t(e)}},setCopyableText:function(){var e=Math.min(l.selStart.row(),l.selEnd.row()),t=Math.min(l.selStart.col(),l.selEnd.col()),n=Math.max(l.selStart.row(),l.selEnd.row()),i=Math.max(l.selStart.col(),l.selEnd.col()),o=Math.min(n,e+l.settings.copyRowsLimit-1),s=Math.min(i,t+l.settings.copyColsLimit-1);w.copyPaste.copyable(u.getText({row:e,col:t},{row:o,col:s})),(n!==o||i!==s)&&w.runHooks("afterCopyLimit",n-e+1,i-t+1,l.settings.copyRowsLimit,l.settings.copyColsLimit)},prepare:function(){if(w.getCellMeta(l.selStart.row(),l.selStart.col()).isWritable){w.listen();var e=w.view.getCellAtCoords(l.selStart.coords());l.editorDestroyer=w.view.applyCellTypeMethod("editor",e,l.selStart.row(),l.selStart.col())}}},this.init=function(){w.runHooks("beforeInit"),m.init(),this.updateSettings(l.settings,!0),this.parseSettingsFromDOM(),this.focusCatcher=new n.FocusCatcher(this),this.view=new n.TableView(this),this.forceFullRender=!0,this.view.render(),"object"==typeof l.firstRun&&(w.runHooks("afterChange",l.firstRun[0],l.firstRun[1]),l.firstRun=!1),w.runHooks("afterInit")},this.setDataAtCell=function(e,t,n,i){var o,l,c,h=a(e,t,n),d=[];for(o=0,l=h.length;l>o;o++){if("object"!=typeof h[o])throw Error("Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter");if("number"!=typeof h[o][1])throw Error("Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`");c=u.colToProp(h[o][1]),d.push([h[o][0],c,u.get(h[o][0],c),h[o][2]])}i||"object"!=typeof e||(i=t),s(d,i).then(function(){r(d,i)})},this.setDataAtRowProp=function(e,t,n,i){var o,l,c=a(e,t,n),h=[];for(o=0,l=c.length;l>o;o++)h.push([c[o][0],c[o][1],u.get(c[o][0],c[o][1]),c[o][2]]);i||"object"!=typeof e||(i=t),s(h,i).then(function(){r(h,i)})},this.listen=function(){w.focusCatcher.listen()},this.destroyEditor=function(e){p.refreshBorders(e)},this.populateFromArray=function(e,t,n,i,o,s){if("object"!=typeof n)throw Error("populateFromArray parameter `input` must be an array");return d.populateFromArray({row:e,col:t},n,"number"==typeof i?{row:i,col:o}:null,s)},this.spliceCol=function(){return u.spliceCol.apply(null,arguments)},this.spliceRow=function(){return u.spliceRow.apply(null,arguments)},this.getCornerCoords=function(e){return d.getCornerCoords(e)},this.getSelected=function(){return p.isSelected()?[l.selStart.row(),l.selStart.col(),l.selEnd.row(),l.selEnd.col()]:void 0},this.parseSettingsFromDOM=function(){var e=this.rootElement.css("overflow");if("scroll"===e||"auto"===e?(this.rootElement[0].style.overflow="visible",l.settingsFromDOM.overflow=e):(void 0===l.settings.width||void 0===l.settings.height)&&(l.settingsFromDOM.overflow="auto"),l.settingsFromDOM.width=void 0===l.settings.width?this.rootElement.width():void 0,l.settingsFromDOM.height=void 0,void 0===l.settings.height&&("scroll"===l.settingsFromDOM.overflow||"auto"===l.settingsFromDOM.overflow)){var n=this.rootElement[0].cloneNode(!1),i=this.rootElement[0].parentNode;if(i){n.removeAttribute("id"),i.appendChild(n);var o=parseInt(t.getComputedStyle(n,null).getPropertyValue("height"),10);o>0&&(l.settingsFromDOM.height=o),i.removeChild(n)}}},this.render=function(){w.view&&(w.forceFullRender=!0,w.parseSettingsFromDOM(),p.refreshBorders(null,!0))},this.loadData=function(t){if(!t.push||!t.splice)throw Error("loadData only accepts array of objects or array of arrays ("+typeof t+" given)");l.isPopulated=!1,v.prototype.data=t,l.dataType=l.settings.dataSchema instanceof Array||t[0]instanceof Array?"array":e.isFunction(l.settings.dataSchema)?"function":"object",l.duckDataSchema=t[0]?u.recursiveDuckSchema(t[0]):{},u.createMap(),d.adjustRowsAndCols(),w.runHooks("afterLoadData"),l.firstRun?l.firstRun=[null,"loadData"]:(w.runHooks("afterChange",null,"loadData"),w.render()),l.isPopulated=!0,w.clearUndo()},this.getData=function(e,t,n,i){return e===void 0?u.getAll():u.getRange({row:e,col:t},{row:n,col:i})},this.updateSettings=function(e,t){var i,o,s,r,a;if(e.rows!==void 0)throw Error("'rows' setting is no longer supported. do you mean startRows, minRows or maxRows?");if(e.cols!==void 0)throw Error("'cols' setting is no longer supported. do you mean startCols, minCols or maxCols?");e.undo!==void 0&&(l.undoRedo&&e.undo===!1?l.undoRedo=null:l.undoRedo||e.undo!==!0||(l.undoRedo=new n.UndoRedo(w)));for(i in e)"data"!==i&&(void 0!==c[i]||void 0!==h[i]?w.addHook(i,e[i]):(!t&&e.hasOwnProperty(i)&&(v.prototype[i]=e[i]),n.extension[i]&&(l.extensions[i]=new n.extension[i](w,e[i]))));if(void 0===e.data&&void 0===l.settings.data){var f,m=[];for(o=0,s=l.settings.startRows;s>o;o++){for(f=[],r=0,a=l.settings.startCols;a>r;r++)f.push(null);m.push(f)}w.loadData(m)}else void 0!==e.data?w.loadData(e.data):void 0!==e.columns&&u.createMap();if(a=w.countCols(),a>0){var y,b,C;for(i=0;a>i;i++)if(l.columnSettings[i]=n.helper.columnFactory(v,l.columnsSettingConflicts,n.TextCell),b=l.columnSettings[i].prototype,e.columns){C=e.columns[i];for(y in C)C.hasOwnProperty(y)&&(b[y]=C[y])}}e.fillHandle!==void 0&&(g.handle&&e.fillHandle===!1?g.disable():g.handle||e.fillHandle===!1||g.init()),d.adjustRowsAndCols(),w.view&&(w.forceFullRender=!0,p.refreshBorders(null,!0))},this.getSettings=function(){return l.settings},this.getSettingsFromDOM=function(){return l.settingsFromDOM},this.clear=function(){p.selectAll(),p.empty()},this.isUndoAvailable=function(){return l.undoRedo&&l.undoRedo.isUndoAvailable()},this.isRedoAvailable=function(){return l.undoRedo&&l.undoRedo.isRedoAvailable()},this.undo=function(){l.undoRedo&&l.undoRedo.undo()},this.redo=function(){l.undoRedo&&l.undoRedo.redo()},this.clearUndo=function(){l.undoRedo&&l.undoRedo.clear()},this.alter=function(e,t,n,i,o){d.alter(e,t,n,i,o)},this.getCell=function(e,t){return w.view.getCellAtCoords({row:e,col:t})},this.colToProp=function(e){return u.colToProp(e)},this.propToCol=function(e){return u.propToCol(e)},this.getDataAtCell=function(e,t){return u.get(e,u.colToProp(t))},this.getDataAtRowProp=function(e,t){return u.get(e,t)},this.getDataAtCol=function(e){return[].concat.apply([],u.getRange({row:0,col:e},{row:l.settings.data.length-1,col:e}))},this.getDataAtProp=function(e){return[].concat.apply([],u.getRange({row:0,col:u.propToCol(e)},{row:l.settings.data.length-1,col:u.propToCol(e)}))},this.getDataAtRow=function(e){return l.settings.data[e]},this.getCellMeta=function(e,t){var i,o,s,r=function(){},a=u.colToProp(t);if(l.columnSettings[t]===void 0&&(l.columnSettings[t]=n.helper.columnFactory(v,l.columnsSettingConflicts,n.TextCell)),r.prototype=new l.columnSettings[t],l.settings.cells){var c,h=l.settings.cells(e,t,a)||{};for(c in h)h.hasOwnProperty(c)&&(r.prototype[c]=h[c])}if(i=new r,w.runHooks("beforeGetCellMeta",e,t,i),"string"==typeof i.type&&n.cellTypes[i.type]?o=n.cellTypes[i.type]:"object"==typeof i.type&&(o=i.type),o)for(s in o)o.hasOwnProperty(s)&&(i[s]=o[s]);return i.isWritable=!i.readOnly,w.runHooks("afterGetCellMeta",e,t,i),i},this.getRowHeader=function(e){if(void 0===e){for(var t=[],n=0,i=w.countRows();i>n;n++)t.push(w.getRowHeader(n));return t}return"[object Array]"===Object.prototype.toString.call(l.settings.rowHeaders)&&void 0!==l.settings.rowHeaders[e]?l.settings.rowHeaders[e]:"function"==typeof l.settings.rowHeaders?l.settings.rowHeaders(e):l.settings.rowHeaders&&"string"!=typeof l.settings.rowHeaders&&"number"!=typeof l.settings.rowHeaders?e+1:l.settings.rowHeaders},this.getColHeader=function(e){if(void 0===e){for(var t=[],i=0,o=w.countCols();o>i;i++)t.push(w.getColHeader(i));return t}return e=n.PluginModifiers.run(w,"col",e),l.settings.columns&&l.settings.columns[e]&&l.settings.columns[e].title?l.settings.columns[e].title:"[object Array]"===Object.prototype.toString.call(l.settings.colHeaders)&&void 0!==l.settings.colHeaders[e]?l.settings.colHeaders[e]:"function"==typeof l.settings.colHeaders?l.settings.colHeaders(e):l.settings.colHeaders&&"string"!=typeof l.settings.colHeaders&&"number"!=typeof l.settings.colHeaders?n.helper.spreadsheetColumnLabel(e):l.settings.colHeaders},this.getColWidth=function(e){e=n.PluginModifiers.run(w,"col",e);var t={};return t.width=l.settings.columns&&l.settings.columns[e]&&l.settings.columns[e].width?l.settings.columns[e].width:"[object Array]"===Object.prototype.toString.call(l.settings.colWidths)&&void 0!==l.settings.colWidths[e]?l.settings.colWidths[e]:50,w.runHooks("afterGetColWidth",e,t),t.width},this.countRows=function(){return l.settings.data.length},this.countCols=function(){return"object"===l.dataType||"function"===l.dataType?l.settings.columns&&l.settings.columns.length?l.settings.columns.length:l.colToProp.length:"array"===l.dataType?l.settings.columns&&l.settings.columns.length?l.settings.columns.length:l.settings.data&&l.settings.data[0]&&l.settings.data[0].length?l.settings.data[0].length:0:void 0},this.rowOffset=function(){return w.view.wt.getSetting("offsetRow")},this.colOffset=function(){return w.view.wt.getSetting("offsetColumn")},this.countVisibleRows=function(){return w.view.wt.wtTable.countVisibleRows()},this.countVisibleCols=function(){return w.view.wt.wtTable.countVisibleColumns()},this.countEmptyRows=function(e){for(var t=w.countRows()-1,n=0;t>=0;){if(w.isEmptyRow(t))n++;else if(e)break;t--}return n},this.countEmptyCols=function(e){if(1>w.countRows())return 0;for(var t=w.countCols()-1,n=0;t>=0;){if(w.isEmptyCol(t))n++;else if(e)break;t--}return n},this.isEmptyRow=function(e){if(l.settings.isEmptyRow)return l.settings.isEmptyRow.call(this,e);for(var t,n=0,i=this.countCols();i>n;n++)if(t=this.getDataAtCell(e,n),""!==t&&null!==t&&t!==void 0)return!1;return!0},this.isEmptyCol=function(e){if(l.settings.isEmptyCol)return l.settings.isEmptyCol.call(this,e);for(var t,n=0,i=this.countRows();i>n;n++)if(t=this.getDataAtCell(n,e),""!==t&&null!==t&&t!==void 0)return!1;return!0},this.selectCell=function(e,t,n,i,o){if("number"!=typeof e||0>e||e>=w.countRows())return!1;if("number"!=typeof t||0>t||t>=w.countCols())return!1;if(n!==void 0){if("number"!=typeof n||0>n||n>=w.countRows())return!1;if("number"!=typeof i||0>i||i>=w.countCols())return!1}return l.selStart.coords({row:e,col:t}),w.listen(),n===void 0?p.setRangeEnd({row:e,col:t},o):p.setRangeEnd({row:n,col:i},o),w.selection.finish(),!0},this.selectCellByProp=function(){return arguments[1]=u.propToCol(arguments[1]),arguments[3]!==void 0&&(arguments[3]=u.propToCol(arguments[3])),w.selectCell.apply(w,arguments)},this.deselectCell=function(){p.deselect()},this.destroy=function(){w.clearTimeouts(),w.view&&w.view.wt.destroy(),w.rootElement.empty(),w.rootElement.removeData("handsontable"),w.rootElement.off(".handsontable"),e(t).off("."+w.guid),e(document.documentElement).off("."+w.guid),w.runHooks("afterDestroy")},this.getInstance=function(){return w.rootElement.data("handsontable")},this.addHook=function(e,t){if(e in h&&(e=h[e]),c[e]===void 0&&(c[e]=[]),t instanceof Array)for(var n=0,i=t.length;i>n;n++)c[e].push(t[n]);else c[e].push(t)},this.addHookOnce=function(e,t){e in h&&(e=h[e]),c[e]===void 0&&(c[e]=[]);var n=function(){return this.removeHook(e,n),t.apply(this,arguments)};c[e].push(n)},this.removeHook=function(e,t){e in h&&(e=h[e]);for(var n=0,i=c[e].length;i>n;n++)if(c[e][n]==t)return c[e].splice(n,1),!0;return!1},this.runHooks=function(e,t,i,o,s,r){if(e in h&&(e=h[e]),c[e]!==void 0)for(var a=0,l=c[e].length;l>a;a++)c[e][a].call(w,t,i,o,s,r);n.PluginHooks.run(w,e,t,i,o,s,r)},this.timeouts={},this.registerTimeout=function(e,t,n){clearTimeout(this.timeouts[e]),this.timeouts[e]=setTimeout(t,n||0)},this.clearTimeouts=function(){for(var e in this.timeouts)this.timeouts.hasOwnProperty(e)&&clearTimeout(this.timeouts[e])},this.version="0.9.0-beta2"};var H=function(){};H.prototype={data:void 0,width:void 0,height:void 0,startRows:5,startCols:5,minRows:0,minCols:0,maxRows:1/0,maxCols:1/0,minSpareRows:0,minSpareCols:0,multiSelect:!0,fillHandle:!0,undo:!0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,pasteMode:"overwrite",currentRowClassName:void 0,currentColClassName:void 0,stretchH:"hybrid",isEmptyRow:void 0,isEmptyCol:void 0,observeDOMVisibility:!0},e.fn.handsontable=function(e){var t,i,o,s,r,a=this.first(),l=a.data("handsontable");if("string"!=typeof e)return r=e||{},l?l.updateSettings(r):(l=new n.Core(a,r),a.data("handsontable",l),l.init()),a;if(o=[],arguments.length>1)for(t=1,i=arguments.length;i>t;t++)o.push(arguments[t]);if(l){if(void 0===l[e])throw Error("Handsontable do not provide action: "+e);s=l[e].apply(l,o)}return s},n.FocusCatcher=function(t){this.el=document.createElement("DIV"),this.el.style.position="fixed",this.el.style.top="0",this.el.style.left="0",this.el.style.width="1px",this.el.style.height="1px",this.el.setAttribute("tabindex",1e4),t.rootElement.append(this.el),this.$el=e(this.el)},n.FocusCatcher.prototype.listen=function(){this.el.focus()},n.TableView=function(n){var i=this,o=e(t),s=e(document.documentElement);this.instance=n,this.settings=n.getSettings(),this.settingsFromDOM=n.getSettingsFromDOM(),n.rootElement.data("originalStyle",n.rootElement.attr("style")),n.rootElement.addClass("handsontable");var r=document.createElement("TABLE");r.className="htCore",r.appendChild(document.createElement("THEAD")),r.appendChild(document.createElement("TBODY")),n.$table=e(r),n.rootElement.prepend(n.$table),s.on("keyup."+n.guid,function(e){n.selection.isInProgress()&&!e.shiftKey&&n.selection.finish()});var a,l;s.on("mouseup."+n.guid,function(e){n.selection.isInProgress()&&1===e.which&&n.selection.finish(),a=!1,clearInterval(l),l=null,n.autofill.handle&&n.autofill.handle.isDragged&&(n.autofill.handle.isDragged>1&&n.autofill.apply(),n.autofill.handle.isDragged=0)}),s.on("mousedown."+n.guid,function(t){var o=t.target;if(o!==i.wt.wtTable.spreader)for(;null!==o&&o!==document.documentElement;){if(o===n.rootElement[0]||"X-HANDSONTABLE"===o.nodeName||"context-menu-layer"===o.id||e(o).is(".context-menu-list")||e(o).is(".typeahead li"))return;o=o.parentNode}i.settings.outsideClickDeselects?n.deselectCell():n.destroyEditor()}),n.$table.on("selectstart",function(e){e.preventDefault()}),n.$table.on("mouseenter",function(){l&&(clearInterval(l),l=null)}),n.$table.on("mouseleave",function(e){if(a||n.autofill.handle&&n.autofill.handle.isDragged){var t,o,s=1,c=i.wt.wtDom.offset(r),h=c.top+s,u=c.left+s,d=i.containerWidth-i.wt.getSetting("scrollbarWidth")-2*s,p=i.containerHeight-i.wt.getSetting("scrollbarHeight")-2*s,f=0,m=0;h>e.pageY?(f=-1,t="scrollVertical"):e.pageY>=h+p?(f=1,t="scrollVertical"):u>e.pageX?(m=-1,t="scrollHorizontal"):e.pageX>=u+d&&(m=1,t="scrollHorizontal"),t&&(o=function(){(a||n.autofill.handle&&n.autofill.handle.isDragged)&&i.wt[t](f+m).draw()},o(),l=setInterval(o,100))}});var c=function(){t.getSelection?t.getSelection().empty?t.getSelection().empty():t.getSelection().removeAllRanges&&t.getSelection().removeAllRanges():document.selection&&document.selection.empty()},h={table:r,stretchH:this.settings.stretchH,data:n.getDataAtCell,totalRows:n.countRows,totalColumns:n.countCols,offsetRow:0,offsetColumn:0,width:this.getWidth(),height:this.getHeight(),fixedColumnsLeft:this.settings.fixedColumnsLeft,fixedRowsTop:this.settings.fixedRowsTop,rowHeaders:this.settings.rowHeaders?function(e,t){i.appendRowHeader(e,t)}:null,columnHeaders:this.settings.colHeaders?function(e,t){i.appendColHeader(e,t)}:null,columnWidth:n.getColWidth,cellRenderer:function(e,t,n){i.applyCellTypeMethod("renderer",n,e,t)},selections:{current:{className:"current",border:{width:2,color:"#5292F7",style:"solid",cornerVisible:function(){return i.settings.fillHandle&&!i.isCellEdited()&&!n.selection.isMultiple()}}},area:{className:"area",border:{width:1,color:"#89AFF9",style:"solid",cornerVisible:function(){return i.settings.fillHandle&&!i.isCellEdited()&&n.selection.isMultiple()}}},highlight:{highlightRowClassName:i.settings.currentRowClassName,highlightColumnClassName:i.settings.currentColClassName},fill:{className:"fill",border:{width:1,color:"red",style:"solid"}}},onCellMouseDown:function(e,t,o){a=!0;var s={row:t[0],col:t[1]};2===e.button&&n.selection.inInSelection(s)||(e.shiftKey?n.selection.setRangeEnd(s):n.selection.setRangeStart(s)),e.preventDefault(),c(),i.settings.afterOnCellMouseDown&&i.settings.afterOnCellMouseDown.call(n,e,t,o),setTimeout(function(){n.listen()})},onCellMouseOver:function(e,t){var i={row:t[0],col:t[1]};a?n.selection.setRangeEnd(i):n.autofill.handle&&n.autofill.handle.isDragged&&(n.autofill.handle.isDragged++,n.autofill.showBorder(t))},onCellCornerMouseDown:function(e){n.autofill.handle.isDragged=1,e.preventDefault()},onCellCornerDblClick:function(){n.autofill.selectAdjacent()},beforeDraw:function(e){i.beforeRender(e)}};n.runHooks("beforeInitWalkontable",h),this.wt=new b(h),o.on("resize."+n.guid,function(){n.registerTimeout("resizeTimeout",function(){n.parseSettingsFromDOM();var e=i.getWidth(),t=i.getHeight();(h.width!==e||h.height!==t)&&(n.forceFullRender=!0,i.render(),h.width=e,h.height=t)},60)}),e(i.wt.wtTable.spreader).on("mousedown.handsontable, contextmenu.handsontable",function(e){e.target===i.wt.wtTable.spreader&&3===e.which&&e.stopPropagation()}),s.on("click."+n.guid,function(){i.settings.observeDOMVisibility&&i.wt.drawInterrupted&&(i.instance.forceFullRender=!0,i.render())})},n.TableView.prototype.isCellEdited=function(){return this.instance.textEditor&&this.instance.textEditor.isCellEdited||this.instance.autocompleteEditor&&this.instance.autocompleteEditor.isCellEdited||this.instance.handsontableEditor&&this.instance.handsontableEditor.isCellEdited},n.TableView.prototype.getWidth=function(){var e=void 0!==this.settings.width?this.settings.width:this.settingsFromDOM.width;return"function"==typeof e?e():e},n.TableView.prototype.getHeight=function(){var e=void 0!==this.settings.height?this.settings.height:this.settingsFromDOM.height;return"function"==typeof e?e():e},n.TableView.prototype.beforeRender=function(e){e&&(this.instance.runHooks("beforeRender"),this.wt.update("width",this.getWidth()),this.wt.update("height",this.getHeight()))},n.TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.rootElement.triggerHandler("render.handsontable"),this.instance.forceFullRender&&this.instance.runHooks("afterRender"),this.instance.forceFullRender=!1},n.TableView.prototype.applyCellTypeMethod=function(e,t,n,i){var o=this.instance.colToProp(i),s=this.instance.getCellMeta(n,i);return s[e]?s[e](this.instance,t,n,i,o,this.instance.getDataAtRowProp(n,o),s):void 0},n.TableView.prototype.getCellAtCoords=function(e){var t=this.wt.wtTable.getCell([e.row,e.col]);return 0>t?null:t},n.TableView.prototype.scrollViewport=function(e){this.wt.scrollViewport([e.row,e.col])},n.TableView.prototype.appendRowHeader=function(e,t){this.wt.wtDom.avoidInnerHTML(t,this.instance.getRowHeader(e))},n.TableView.prototype.appendColHeader=function(e,t){var n=document.createElement("DIV"),i=document.createElement("SPAN");for(n.className="relative",i.className="colHeader",this.wt.wtDom.avoidInnerHTML(i,this.instance.getColHeader(e)),n.appendChild(i);t.firstChild;)t.removeChild(t.firstChild);t.appendChild(n),this.instance.runHooks("afterGetColHeader",e,t)},n.helper.isPrintableChar=function(e){return 32==e||e>=48&&57>=e||e>=96&&111>=e||e>=186&&192>=e||e>=219&&222>=e||e>=226||e>=65&&90>=e},n.helper.stringify=function(e){switch(typeof e){case"string":case"number":return e+"";case"object":return null===e?"":""+e;case"undefined":return"";default:return""+e}},n.helper.spreadsheetColumnLabel=function(e){for(var t,n=e+1,i="";n>0;)t=(n-1)%26,i=String.fromCharCode(65+t)+i,n=parseInt((n-t)/26,10);return i},n.helper.isDescendant=function(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1},n.helper.randomString=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()},n.helper.inherit=function(e,t){function n(){}return n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e},n.helper.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},n.helper.columnFactory=function(e,t,n){var i=0,o=t.length,s=function(){};for(s.prototype=new e;o>i;i++)s.prototype[t[i]]=void 0;for(i in n)n.hasOwnProperty(i)&&(s.prototype[i]=n[i]);return s},n.UndoRedo=function(e){var t=this;this.instance=e,this.clear(),n.PluginHooks.add("afterChange",function(e,n){"undo"!==n&&"redo"!==n&&t.add(e,n)})},n.UndoRedo.prototype.undo=function(){var t,n;if(this.isUndoAvailable()){var i=e.extend(!0,[],this.data[this.rev]);for(t=0,n=i.length;n>t;t++)i[t].splice(3,1);this.instance.setDataAtRowProp(i,null,null,"undo"),this.rev--}},n.UndoRedo.prototype.redo=function(){var t,n;
if(this.isRedoAvailable()){this.rev++;var i=e.extend(!0,[],this.data[this.rev]);for(t=0,n=i.length;n>t;t++)i[t].splice(2,1);this.instance.setDataAtRowProp(i,null,null,"redo")}},n.UndoRedo.prototype.isUndoAvailable=function(){return this.rev>=0},n.UndoRedo.prototype.isRedoAvailable=function(){return this.rev<this.data.length-1},n.UndoRedo.prototype.add=function(e){this.rev++,this.data.splice(this.rev),this.data.push(e)},n.UndoRedo.prototype.clear=function(){this.data=[],this.rev=-1},n.SelectionPoint=function(){this._row=null,this._col=null},n.SelectionPoint.prototype.exists=function(){return null!==this._row},n.SelectionPoint.prototype.row=function(e){return void 0!==e&&(this._row=e),this._row},n.SelectionPoint.prototype.col=function(e){return void 0!==e&&(this._col=e),this._col},n.SelectionPoint.prototype.coords=function(e){return void 0!==e&&(this._row=e.row,this._col=e.col),{row:this._row,col:this._col}},n.SelectionPoint.prototype.arr=function(e){return void 0!==e&&(this._row=e[0],this._col=e[1]),[this._row,this._col]},n.TextRenderer=function(e,t,i,o,s,r,a){var l=n.helper.stringify(r);l.match(/\n/)?(l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t.innerHTML=l.replace(/\n/g,"<br/>")):(e.view.wt.wtDom.empty(t),t.appendChild(document.createTextNode(l))),a.readOnly&&(t.className="htDimmed")},n.AutocompleteRenderer=function(e,t,i,o,s,r,a){var l=document.createElement("DIV");l.className="htAutocomplete";var c=document.createElement("DIV");c.className="htAutocompleteArrow",c.appendChild(document.createTextNode("▼")),e.acArrowListener||(e.acArrowListener=function(){e.view.wt.getSetting("onCellDblClick")},e.rootElement.on("mouseup",".htAutocompleteArrow",e.acArrowListener)),n.TextRenderer(e,l,i,o,s,r,a),l.firstChild||l.appendChild(document.createTextNode(" ")),l.appendChild(c),e.view.wt.wtDom.empty(t),t.appendChild(l)},n.CheckboxRenderer=function(t,i,o,s,r,a,l){l.checkedTemplate===void 0&&(l.checkedTemplate=!0),l.uncheckedTemplate===void 0&&(l.uncheckedTemplate=!1),t.view.wt.wtDom.empty(i);var c=document.createElement("INPUT");c.className="htCheckboxRendererInput",c.type="checkbox",c.setAttribute("autocomplete","off"),a===l.checkedTemplate||a===n.helper.stringify(l.checkedTemplate)?(c.checked=!0,i.appendChild(c)):a===l.uncheckedTemplate||a===n.helper.stringify(l.uncheckedTemplate)?i.appendChild(c):null===a?(c.className+=" noValue",i.appendChild(c)):i.appendChild(document.createTextNode("#bad value#"));var h=e(c);return l.readOnly?h.on("click",function(e){e.preventDefault()}):(h.on("mousedown",function(e){this.checked?t.setDataAtRowProp(o,r,l.uncheckedTemplate):t.setDataAtRowProp(o,r,l.checkedTemplate),e.stopPropagation()}),h.on("mouseup",function(e){e.stopPropagation()})),i},n.NumericRenderer=function(e,t,i,o,s,r,a){"number"==typeof r?(a.language!==void 0&&numeral.language(a.language),e.view.wt.wtDom.empty(t),t.className="htNumeric",t.appendChild(document.createTextNode(numeral(r).format(a.format||"0")))):n.TextRenderer(e,t,i,o,s,r,a)},i.prototype.createElements=function(){this.wtDom=new C,this.TEXTAREA=document.createElement("TEXTAREA"),this.TEXTAREA.className="handsontableInput",this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,this.$textarea=e(this.TEXTAREA),this.TEXTAREA_PARENT=document.createElement("DIV"),this.TEXTAREA_PARENT.className="handsontableInputHolder",this.textareaParentStyle=this.TEXTAREA_PARENT.style,this.textareaParentStyle.top=0,this.textareaParentStyle.left=0,this.textareaParentStyle.display="none",this.$textareaParent=e(this.TEXTAREA_PARENT),this.TEXTAREA_PARENT.appendChild(this.TEXTAREA),this.instance.rootElement[0].appendChild(this.TEXTAREA_PARENT);var t=this;n.PluginHooks.add("afterRender",function(){t.instance.registerTimeout("refresh_editor_dimensions",function(){t.refreshDimensions()},0)})},i.prototype.bindEvents=function(){var e=this;this.$textareaParent.off(".editor").on("keydown.editor",function(t){var n=(t.ctrlKey||t.metaKey)&&!t.altKey;if(17===t.keyCode||224===t.keyCode||91===t.keyCode||93===t.keyCode)return t.stopImmediatePropagation(),void 0;switch(t.keyCode){case 38:case 40:e.finishEditing(!1);break;case 9:e.finishEditing(!1),t.preventDefault();break;case 39:e.getCaretPosition(e.TEXTAREA)===e.TEXTAREA.value.length?e.finishEditing(!1):t.stopImmediatePropagation();break;case 37:0===e.getCaretPosition(e.TEXTAREA)?e.finishEditing(!1):t.stopImmediatePropagation();break;case 27:e.instance.destroyEditor(!0),t.stopImmediatePropagation();break;case 13:var i=e.instance.getSelected(),o=!(i[0]===i[2]&&i[1]===i[3]);t.ctrlKey&&!o||t.altKey?(e.TEXTAREA.value=e.TEXTAREA.value+"\n",e.TEXTAREA.focus(),t.stopImmediatePropagation()):e.finishEditing(!1,n),t.preventDefault();break;default:t.stopImmediatePropagation()}})},i.prototype.bindTemporaryEvents=function(e,t,i,o,s,r){function a(){l.beginEditing(t,i,o,!0)}this.TD=e,this.row=t,this.col=i,this.prop=o,this.originalValue=s,this.cellProperties=r;var l=this;this.instance.focusCatcher.$el.on("keydown.editor",function(e){var s=(e.ctrlKey||e.metaKey)&&!e.altKey;if(!l.isCellEdited)if(n.helper.isPrintableChar(e.keyCode))s||l.beginEditing(t,i,o);else if(113===e.keyCode)l.beginEditing(t,i,o,!0),e.stopImmediatePropagation(),e.preventDefault();else if(13===e.keyCode&&l.instance.getSettings().enterBeginsEditing){var r=l.instance.getSelected(),a=!(r[0]===r[2]&&r[1]===r[3]);s&&!a||e.altKey?l.beginEditing(t,i,o,!0,"\n"):l.beginEditing(t,i,o,!0),e.preventDefault(),e.stopImmediatePropagation()}}),this.instance.view.wt.update("onCellDblClick",a)},i.prototype.unbindTemporaryEvents=function(){this.instance.focusCatcher.$el.off(".editor"),this.instance.view.wt.update("onCellDblClick",null)},i.prototype.getCaretPosition=function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),i=n.duplicate();return n.moveToBookmark(t.getBookmark()),i.setEndPoint("EndToStart",n),i.text.length}return 0},i.prototype.setCaretPosition=function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},i.prototype.beginEditing=function(e,t,i,o,s){if(!this.isCellEdited){this.isCellEdited=!0,this.row=e,this.col=t,this.prop=i;var r={row:e,col:t};this.instance.view.scrollViewport(r),this.instance.view.render(),this.$textarea.on("cut.editor",function(e){e.stopPropagation()}),this.$textarea.on("paste.editor",function(e){e.stopPropagation()}),this.TEXTAREA.value=o?n.helper.stringify(this.originalValue)+(s||""):"",this.refreshDimensions(),this.TEXTAREA.focus(),this.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)}},i.prototype.refreshDimensions=function(){if(this.isCellEdited){this.TD=this.instance.getCell(this.row,this.col);var t=e(this.TD),n=this.wtDom.offset(this.TD),i=this.wtDom.offset(this.instance.rootElement[0]),o=this.instance.rootElement.scrollTop(),s=this.instance.rootElement.scrollLeft(),r=n.top-i.top+o-1,a=n.left-i.left+s-1,l=this.instance.getSettings(),c=l.rowHeaders===!1?0:1,h=l.colHeaders===!1?0:1;0>r&&(r=0),0>a&&(a=0),c>0&&parseInt(t.css("border-top-width"),10)>0&&(r+=1),h>0&&parseInt(t.css("border-left-width"),10)>0&&(a+=1),e.browser.msie&&7>=parseInt(e.browser.version,10)&&(r-=1),this.textareaParentStyle.top=r+"px",this.textareaParentStyle.left=a+"px";var u=t.width(),d=t.outerHeight()-4;parseInt(t.css("border-top-width"),10)>0&&(d-=1),parseInt(t.css("border-left-width"),10)>0&&c>0&&(u-=1),this.$textarea.autoResize({maxHeight:200,minHeight:d,minWidth:u,maxWidth:Math.max(168,u),animate:!1,extraSpace:0}),this.textareaParentStyle.display="block"}},i.prototype.finishEditing=function(t,n){if(this.isCellEdited&&(this.isCellEdited=!1,!t)){var i=[[e.trim(this.TEXTAREA.value)]];if(n){var o=this.instance.getSelected();this.instance.populateFromArray(o[0],o[1],i,o[2],o[3],"edit")}else this.instance.populateFromArray(this.row,this.col,i,null,null,"edit")}this.unbindTemporaryEvents(),document.activeElement===this.TEXTAREA&&this.instance.listen(),this.textareaParentStyle.display="none"},n.TextEditor=function(e,t,n,o,s,r,a){return e.textEditor||(e.textEditor=new i(e)),e.textEditor.bindTemporaryEvents(t,n,o,s,r,a),function(t){e.textEditor.finishEditing(t)}},n.helper.inherit(o,i),o.prototype.createElements=function(){i.prototype.createElements.call(this),this.$textarea.typeahead(),this.typeahead=this.$textarea.data("typeahead"),this.typeahead._render=this.typeahead.render,this.typeahead.minLength=0,this.typeahead.lookup=function(){var t;return this.query=this.$element.val(),t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this},this.typeahead.matcher=function(){return!0};var t=this.typeahead.process,n=this;this.typeahead.process=function(i){for(var o=!1,s=0,r=i.length;r>s;s++)""===i[s]&&(o||(i=e.extend([],i),o=!0),i[s]=n.emptyStringLabel);return t.call(this,i)}},o.prototype.bindEvents=function(){var e=this;this.$textarea.off("keydown").off("keyup").off("keypress"),this.$textareaParent.off(".acEditor").on("keydown.acEditor",function(t){switch(t.keyCode){case 38:e.typeahead.prev(),t.stopImmediatePropagation();break;case 40:e.typeahead.next(),t.stopImmediatePropagation();break;case 13:t.preventDefault()}}),this.$textareaParent.on("keyup.acEditor",function(t){(n.helper.isPrintableChar(t.keyCode)||113===t.keyCode||13===t.keyCode||8===t.keyCode||46===t.keyCode)&&e.typeahead.lookup()}),i.prototype.bindEvents.call(this)},o.prototype.bindTemporaryEvents=function(e,t,n,o,s,r){function a(){h.beginEditing(t,n,o,!0),h.instance.registerTimeout("IE9_align_fix",function(){h.typeahead.lookup()},1)}var l,c,h=this;this.typeahead.select=function(){var e=this.hide();h.instance.destroyEditor(!0);var i=this.$menu.find(".active").attr("data-value");return i===h.emptyStringLabel&&(i=""),"function"==typeof r.onSelect?r.onSelect(t,n,o,i,this.$menu.find(".active").index()):h.instance.setDataAtRowProp(t,o,i),e},this.typeahead.render=function(e){return h.typeahead._render.call(this,e),r.strict||this.$menu.find("li:eq(0)").removeClass("active"),this};for(l in r)if("options"===l)for(c in r.options)this.typeahead.options[c]=r.options[c];else this.typeahead[l]=r[l];i.prototype.bindTemporaryEvents.call(this,e,t,n,o,s,r),this.instance.view.wt.update("onCellDblClick",a)},o.prototype.finishEditing=function(e,t){e||(this.isMenuExpanded()&&this.typeahead.$menu.find(".active").length?(this.typeahead.select(),this.isCellEdited=!1):this.cellProperties.strict&&(this.isCellEdited=!1)),i.prototype.finishEditing.call(this,e,t)},o.prototype.isMenuExpanded=function(){return this.typeahead.$menu.is(":visible")?this.typeahead:!1},n.AutocompleteEditor=function(e,t,n,i,s,r,a){return e.autocompleteEditor||(e.autocompleteEditor=new o(e)),e.autocompleteEditor.bindTemporaryEvents(t,n,i,s,r,a),function(t){e.autocompleteEditor.finishEditing(t)}},n.CheckboxEditor=function(e,t,i,o,r,a,l){return l===void 0&&(l={}),l.checkedTemplate===void 0&&(l.checkedTemplate=!0),l.uncheckedTemplate===void 0&&(l.uncheckedTemplate=!1),e.$table.on("keydown.editor",function(t){var o=(t.ctrlKey||t.metaKey)&&!t.altKey;!o&&n.helper.isPrintableChar(t.keyCode)&&(s(e,i,r,l),t.stopImmediatePropagation(),t.preventDefault())}),e.view.wt.update("onCellDblClick",function(){s(e,i,r,l)}),function(){e.$table.off(".editor"),e.view.wt.update("onCellDblClick",null)}},n.helper.inherit(r,i),r.prototype.createElements=function(){i.prototype.createElements.call(this),this.datePicker=document.createElement("DIV"),this.datePickerStyle=this.datePicker.style,this.datePickerStyle.position="absolute",this.datePickerStyle.top=0,this.datePickerStyle.left=0,this.datePickerStyle.zIndex=99,this.instance.rootElement[0].appendChild(this.datePicker),this.$datePicker=e(this.datePicker);var t=this,n={dateFormat:"yy-mm-dd",showButtonPanel:!0,changeMonth:!0,changeYear:!0,altField:this.$textarea,onSelect:function(){t.finishEditing(!1)}};this.$datePicker.datepicker(n),this.hideDatepicker()},r.prototype.beginEditing=function(e,t,n,o,s){i.prototype.beginEditing.call(this,e,t,n,o,s),this.showDatepicker()},r.prototype.finishEditing=function(e,t){this.hideDatepicker(),i.prototype.finishEditing.call(this,e,t)},r.prototype.showDatepicker=function(){var t=e(this.instance.dateEditor.TD),n=t.position();this.datePickerStyle.top=n.top+t.height()+"px",this.datePickerStyle.left=n.left+"px";var i={defaultDate:this.originalValue||void 0};e.extend(i,this.cellProperties),this.$datePicker.datepicker("option",i),this.originalValue&&this.$datePicker.datepicker("setDate",this.originalValue),this.datePickerStyle.display="block"},r.prototype.hideDatepicker=function(){this.datePickerStyle.display="none"},n.DateEditor=function(e,t,n,i,o,s,a){return e.dateEditor||(e.dateEditor=new r(e)),e.dateEditor.bindTemporaryEvents(t,n,i,o,s,a),function(t){e.dateEditor.finishEditing(t)}},n.helper.inherit(a,i),a.prototype.createElements=function(){i.prototype.createElements.call(this);var t=document.createElement("DIV");t.className="handsontableEditor",this.TEXTAREA_PARENT.appendChild(t),this.$htContainer=e(t)},a.prototype.bindTemporaryEvents=function(t,n,o,s,r,a){var l=this,c={colHeaders:!0,cells:function(){return{readOnly:!0}},fillHandle:!1,width:2e3,afterOnCellMouseDown:function(){var e=this.getSelected();l.TEXTAREA.value=this.getDataAtCell(e[0],e[1]),l.instance.destroyEditor()},beforeOnKeyDown:function(e){switch(e.keyCode){case 27:l.instance.destroyEditor(!0);break;case 13:var t=this.getSelected();l.TEXTAREA.value=this.getDataAtCell(t[0],t[1]),l.instance.destroyEditor()}}};a.handsontable&&(c=e.extend(c,a.handsontable)),this.$htContainer.handsontable(c),i.prototype.bindTemporaryEvents.call(this,t,n,o,s,r,a)},a.prototype.beginEditing=function(e,t,n,o,s){var r=this.instance.getSettings().onBeginEditing;r&&r()===!1||(i.prototype.beginEditing.call(this,e,t,n,o,s),this.$htContainer.handsontable("render"),this.$htContainer.handsontable("selectCell",0,0))},a.prototype.finishEditing=function(e,t){if(n.helper.isDescendant(this.instance.rootElement[0],document.activeElement)){var o=this;setTimeout(function(){o.instance.listen()},0),o.instance.listen()}this.$htContainer.handsontable("destroy"),i.prototype.finishEditing.call(this,e,t)},a.prototype.isMenuExpanded=function(){return this.typeahead.$menu.is(":visible")?this.typeahead:!1},n.HandsontableEditor=function(e,t,n,i,o,s,r){return e.handsontableEditor||(e.handsontableEditor=new a(e)),e.handsontableEditor.bindTemporaryEvents(t,n,i,o,s,r),e.registerEditor=e.handsontableEditor,function(t){e.handsontableEditor.finishEditing(t)}},n.AutocompleteCell={renderer:n.AutocompleteRenderer,editor:n.AutocompleteEditor},n.CheckboxCell={renderer:n.CheckboxRenderer,editor:n.CheckboxEditor},n.TextCell={renderer:n.TextRenderer,editor:n.TextEditor},n.NumericCell={renderer:n.NumericRenderer,editor:n.TextEditor,dataType:"number"},n.DateCell={renderer:n.AutocompleteRenderer,editor:n.DateEditor},n.HandsontableCell={renderer:n.AutocompleteRenderer,editor:n.HandsontableEditor},n.cellTypes={autocomplete:n.AutocompleteCell,checkbox:n.CheckboxCell,text:n.TextCell,numeric:n.NumericCell,date:n.DateCell,handsontable:n.HandsontableCell},n.PluginHooks=function(){var e={beforeInitWalkontable:[],beforeInit:[],beforeRender:[],beforeChange:[],beforeGet:[],beforeSet:[],beforeGetCellMeta:[],beforeAutofill:[],afterInit:[],afterLoadData:[],afterRender:[],afterChange:[],afterGetCellMeta:[],afterGetColHeader:[],afterGetColWidth:[],afterDestroy:[],afterRemoveRow:[],afterCreateRow:[],afterRemoveCol:[],afterCreateCol:[],afterColumnResize:[],afterColumnMove:[],afterDeselect:[],afterSelection:[],afterSelectionByProp:[],afterSelectionEnd:[],afterSelectionEndByProp:[],afterCopyLimit:[]},t={onBeforeChange:"beforeChange",onChange:"afterChange",onCreateRow:"afterCreateRow",onCreateCol:"afterCreateCol",onSelection:"afterSelection",onCopyLimit:"afterCopyLimit",onSelectionEnd:"afterSelectionEnd",onSelectionByProp:"afterSelectionByProp",onSelectionEndByProp:"afterSelectionEndByProp"};return{add:function(n,i){n in t&&(n=t[n]),e[n].push(i)},remove:function(n,i){n in t&&(n=t[n]);for(var o=0,s=e[n].length;s>o;o++)if(e[n][o]==i)return e[n].splice(o,1),!0;return!1},run:function(n,i,o,s,r,a,l){if(i in t&&(i=t[i]),e[i]!==void 0)for(var c=0,h=e[i].length;h>c;c++)e[i][c].call(n,o,s,r,a,l)}}}(),n.PluginModifiers={modifiers:{col:[]},push:function(e,t){this.modifiers[e].push(t)},unshift:function(e,t){this.modifiers[e].unshift(t)},run:function(e,t,n,i,o,s,r){for(var a=0,l=this.modifiers[t].length;l>a;a++)n=this.modifiers[t][a].call(e,n,i,o,s,r);return n}};var M=new l;n.PluginHooks.add("beforeInit",M.beforeInit),n.PluginHooks.add("beforeRender",M.determineColumnsWidth),n.PluginHooks.add("afterGetColWidth",M.getColWidth);var P=new c;n.PluginHooks.add("afterInit",P.afterInit),n.PluginHooks.add("beforeGet",P.translateRow),n.PluginHooks.add("beforeSet",P.translateRow),n.PluginHooks.add("afterGetColHeader",P.getColHeader),n.PluginHooks.add("afterInit",h),n.PluginHooks.add("afterDestroy",u),n.PluginHooks.add("beforeGetCellMeta",function(e,t,i){var o,s,r,a=this.getSettings(),l=this.getData();if(a.autoComplete)for(o=0,s=a.autoComplete.length;s>o;o++)if(a.autoComplete[o].match(e,t,l)){i.type===void 0?i.type=n.AutocompleteCell:(i.type.renderer===void 0&&(i.type.renderer=n.AutocompleteCell.renderer),i.type.editor===void 0&&(i.type.editor=n.AutocompleteCell.editor));for(r in a.autoComplete[o])a.autoComplete[o].hasOwnProperty(r)&&"match"!==r&&i[o]===void 0&&(i[r]="source"===r?a.autoComplete[o][r](e,t):a.autoComplete[o][r]);break}});var A=new d;n.PluginHooks.add("beforeInit",A.beforeInit),n.PluginHooks.add("afterInit",A.afterInit),n.PluginHooks.add("afterGetColHeader",A.getColHeader),n.PluginModifiers.push("col",A.modifyCol);var O=new p;n.PluginHooks.add("beforeInit",O.beforeInit),n.PluginHooks.add("afterInit",O.afterInit),n.PluginHooks.add("afterGetColHeader",O.getColHeader),n.PluginHooks.add("afterGetColWidth",O.getColWidth),function(e){function t(i){return this.filter(t.resizableFilterSelector).each(function(){new n(e(this),i)}),this}function n(n,i){this.clones||(this.config=e.extend({},t.defaults,i),this.el=n,this.nodeName=n[0].nodeName.toLowerCase(),this.previousScrollTop=null,"original"===i.maxWidth&&(i.maxWidth=n.width()),"original"===i.minWidth&&(i.minWidth=n.width()),"original"===i.maxHeight&&(i.maxHeight=n.height()),"original"===i.minHeight&&(i.minHeight=n.height()),"textarea"===this.nodeName&&n.css({resize:"none",overflowY:"hidden"}),n.data("AutoResizer",this),this.createClone(),this.injectClone(),this.bind())}t.defaults={onResize:function(){},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500},t.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","padding"],t.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden",border:"1px solid black",padding:"0.49em"},t.resizableFilterSelector="textarea,input:not(input[type]),input[type=text],input[type=password]",t.AutoResizer=n,e.fn.autoResize=t,n.prototype={bind:function(){var t=e.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",t).bind("change.autoResize",t),this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var n=this.el,i=this,o=this.config;this.clones=e(),("original"!==o.minHeight||"original"!==o.maxHeight)&&(this.hClone=n.clone().height("auto"),this.clones=this.clones.add(this.hClone)),("original"!==o.minWidth||"original"!==o.maxWidth)&&(this.wClone=e("<div/>").width("auto").css({whiteSpace:"nowrap","float":"left"}),this.clones=this.clones.add(this.wClone)),e.each(t.cloneCSSProperties,function(e,t){i.clones.css(t,n.css(t))}),this.clones.removeAttr("name").removeAttr("id").attr("tabIndex",-1).css(t.cloneCSSValues)},check:function(e,t){var n=this.config,i=this.wClone,o=this.hClone,s=this.el,r=s.val();if(i){i.text(r);var a=i.outerWidth(),l=a+n.extraSpace>=n.minWidth?a+n.extraSpace:n.minWidth,c=s.width();l=Math.min(l,n.maxWidth),(c>l&&l>=n.minWidth||l>=n.minWidth&&n.maxWidth>=l)&&(n.onResize.call(s),s.scrollLeft(0),n.animate&&!t?s.stop(1,1).animate({width:l},n.animate):s.width(l))}if(o){l&&o.width(l),o.height(0).val(r).scrollTop(1e4);var h=o[0].scrollTop+n.extraSpace;if(this.previousScrollTop===h)return;if(this.previousScrollTop=h,h>=n.maxHeight)return s.css("overflowY",""),void 0;s.css("overflowY","hidden"),n.minHeight>h&&(h=n.minHeight),n.onResize.call(s),n.animate&&!t?s.stop(1,1).animate({height:h},n.animate):s.height(h)}},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clones.remove(),delete this.el,delete this.hClone,delete this.wClone,delete this.clones},injectClone:function(){(t.cloneContainer||(t.cloneContainer=e("<arclones/>").appendTo("body"))).empty().append(this.clones)}}}(jQuery),function(e){function t(e){return e.split('"').length-1}e.SheetClip={parse:function(e){var n,i,o,s,r,a,l,c=[],h=0;for(o=e.split("\n"),o.length>1&&""===o[o.length-1]&&o.pop(),n=0,i=o.length;i>n;n+=1){for(o[n]=o[n].split("	"),s=0,r=o[n].length;r>s;s+=1)c[h]||(c[h]=[]),a&&0===s?(l=c[h].length-1,c[h][l]=c[h][l]+"\n"+o[n][0],a&&1&t(o[n][0])&&(a=!1,c[h][l]=c[h][l].substring(0,c[h][l].length-1).replace(/""/g,'"'))):s===r-1&&0===o[n][s].indexOf('"')?(c[h].push(o[n][s].substring(1).replace(/""/g,'"')),a=!0):(c[h].push(o[n][s].replace(/""/g,'"')),a=!1);a||(h+=1)}return c},stringify:function(e){var t,n,i,o,s,r="";for(t=0,n=e.length;n>t;t+=1){for(i=0,o=e[t].length;o>i;i+=1)i>0&&(r+="	"),s=e[t][i],r+="string"==typeof s?s.indexOf("\n")>-1?'"'+s.replace(/"/g,'""')+'"':s:null===s||void 0===s?"":s;r+="\n"}return r}}}(t),f.prototype.selectNodeText=function(e){e.select()},f.prototype.copyable=function(e){if("string"!=typeof e&&void 0===e.toString)throw Error("copyable requires string parameter");this.elTextarea.value=e},f.prototype.onCopy=function(e){this.copyCallback=e},f.prototype.onCut=function(e){this.cutCallback=e},f.prototype.onPaste=function(e){this.pasteCallback=e},f.prototype.triggerCut=function(e){var t=this;t.cutCallback&&setTimeout(function(){t.cutCallback(e)},0)},f.prototype.triggerPaste=function(e,t){var n=this;n.pasteCallback&&setTimeout(function(){n.pasteCallback((t||n.elTextarea.value).replace(/\n$/,""),e)},0)},f.prototype._bindEvent=function(){return document.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,n,i){e.attachEvent("on"+n,function(){var n=t.event;return n.target=n.srcElement,n.relatedTarget=n.relatedTarget||"mouseover"==n.type?n.fromElement:n.toElement,3===n.target.nodeType&&(n.target=n.target.parentNode),i.call(e,n)})}}(),m.prototype.appear=function(t){var n,i,o,s,r,a,l,c,h,u,d,p;if(!this.disabled){var f,m,g,w,v,y,b,C=this.instance,S=!1,x=!1,T=!1,E=!1;for(C.wtTable.isRowInViewport(t[0])||(S=!0),C.wtTable.isRowInViewport(t[2])||(T=!0),y=C.wtTable.countVisibleRows(),v=0;y>v;v++)if(b=C.wtTable.rowFilter.visibleToSource(v),b>=t[0]&&t[2]>=b){f=b;break}for(v=y-1;v>=0;v--)if(b=C.wtTable.rowFilter.visibleToSource(v),b>=t[0]&&t[2]>=b){g=b;break}if(S&&T)x=!0,E=!0;else{for(C.wtTable.isColumnInViewport(t[1])||(x=!0),C.wtTable.isColumnInViewport(t[3])||(E=!0),y=C.wtTable.countVisibleColumns(),v=0;y>v;v++)if(b=C.wtTable.columnFilter.visibleToSource(v),b>=t[1]&&t[3]>=b){m=b;break}for(v=y-1;v>=0;v--)if(b=C.wtTable.columnFilter.visibleToSource(v),b>=t[1]&&t[3]>=b){w=b;break}}if(void 0===f||void 0===m)return this.disappear(),void 0;n=f!==g||m!==w,i=e(C.wtTable.getCell([f,m])),o=n?e(C.wtTable.getCell([g,w])):i,s=this.wtDom.offset(i[0]),r=n?this.wtDom.offset(o[0]):s,a=this.wtDom.offset(C.wtTable.TABLE),c=s.top,d=r.top+o.outerHeight()-c,u=s.left,p=r.left+o.outerWidth()-u,l=c-a.top-1,h=u-a.left-1,parseInt(i.css("border-top-width"),10)>0&&(l+=1,d-=1),parseInt(i.css("border-left-width"),10)>0&&(h+=1,p-=1),S?this.topStyle.display="none":(this.topStyle.top=l+"px",this.topStyle.left=h+"px",this.topStyle.width=p+"px",this.topStyle.display="block"),x?this.leftStyle.display="none":(this.leftStyle.top=l+"px",this.leftStyle.left=h+"px",this.leftStyle.height=d+"px",this.leftStyle.display="block");var R=Math.floor(this.settings.border.width/2);T?this.bottomStyle.display="none":(this.bottomStyle.top=l+d-R+"px",this.bottomStyle.left=h+"px",this.bottomStyle.width=p+"px",this.bottomStyle.display="block"),E?this.rightStyle.display="none":(this.rightStyle.top=l+"px",this.rightStyle.left=h+p-R+"px",this.rightStyle.height=d+1+"px",this.rightStyle.display="block"),T||E||!this.hasSetting(this.settings.border.cornerVisible)?this.cornerStyle.display="none":(this.cornerStyle.top=l+d-4+"px",this.cornerStyle.left=h+p-4+"px",this.cornerStyle.display="block")}},m.prototype.disappear=function(){this.topStyle.display="none",this.leftStyle.display="none",this.bottomStyle.display="none",this.rightStyle.display="none",this.cornerStyle.display="none"},m.prototype.hasSetting=function(e){return"function"==typeof e?e():!!e},g.prototype.source=function(e){return e},g.prototype.offsetted=function(e){return e+this.offset},g.prototype.unOffsetted=function(e){return e-this.offset},g.prototype.fixed=function(e){return this.fixedCount>e?e-this.offset:e},g.prototype.unFixed=function(e){return this.fixedCount>e?e+this.offset:e},g.prototype.visibleToSource=function(e){return this.source(this.offsetted(this.fixed(e)))},g.prototype.sourceToVisible=function(e){return this.source(this.unOffsetted(this.unFixed(e)))},w.prototype.add=function(e,t,n){this.cache[e]||(this.cache[e]=[]),this.cache[e][t]||(this.cache[e][t]=[]),this.cache[e][t][n]=!0},w.prototype.test=function(e,t,n){return this.cache[e]&&this.cache[e][t]&&this.cache[e][t][n]},v.prototype=new g,v.prototype.readSettings=function(e){this.offset=e.wtSettings.settings.offsetColumn,this.total=e.getSetting("totalColumns"),this.fixedCount=e.getSetting("fixedColumnsLeft"),this.countTH=e.hasSetting("rowHeaders")?1:0},v.prototype.offsettedTH=function(e){return e-this.countTH},v.prototype.unOffsettedTH=function(e){return e+this.countTH},v.prototype.visibleRowHeadedColumnToSourceColumn=function(e){return this.visibleToSource(this.offsettedTH(e))},v.prototype.sourceColumnToVisibleRowHeadedColumn=function(e){return this.unOffsettedTH(this.sourceToVisible(e))},y.prototype.getContainerSize=function(e){var t="function"==typeof this.containerSizeFn?this.containerSizeFn(e):this.containerSizeFn;return(void 0===t||null===t||1>t)&&(t=1/0),t},y.prototype.getSize=function(e){return this.cellSizes[e]},b.prototype.draw=function(e){return this.drawInterrupted=!1,e||this.wtDom.isVisible(this.wtTable.TABLE)?(this.getSetting("beforeDraw",!e),e=e&&this.getSetting("offsetRow")===this.lastOffsetRow&&this.getSetting("offsetColumn")===this.lastOffsetColumn,this.drawn&&(this.scrollVertical(0),this.scrollHorizontal(0)),this.lastOffsetRow=this.getSetting("offsetRow"),this.lastOffsetColumn=this.getSetting("offsetColumn"),this.wtTable.draw(e),this.getSetting("onDraw"),this):(this.drawInterrupted=!0,void 0)},b.prototype.update=function(e,t){return this.wtSettings.update(e,t)},b.prototype.scrollVertical=function(e){return this.wtScroll.scrollVertical(e)},b.prototype.scrollHorizontal=function(e){return this.wtScroll.scrollHorizontal(e)},b.prototype.scrollViewport=function(e){return this.wtScroll.scrollViewport(e),this},b.prototype.getViewport=function(){return[this.wtTable.rowFilter.visibleToSource(0),this.wtTable.columnFilter.visibleToSource(0),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]},b.prototype.getSetting=function(e,t,n,i){return this.wtSettings.getSetting(e,t,n,i)},b.prototype.hasSetting=function(e){return this.wtSettings.has(e)},b.prototype.destroy=function(){this.wtScroll.destroy(),clearTimeout(this.wheelTimeout),clearTimeout(this.dblClickTimeout)},C.prototype.closest=function(e,t){for(;null!=e;){if(1===e.nodeType&&t.indexOf(e.nodeName)>-1)return e;e=e.parentNode}return null},C.prototype.prevSiblings=function(e){for(var t=[];null!=(e=e.previousSibling);)1===e.nodeType&&t.push(e);return t},document.documentElement.classList?(C.prototype.hasClass=function(e,t){return e.classList.contains(t)},C.prototype.addClass=function(e,t){e.classList.add(t)},C.prototype.removeClass=function(e,t){e.classList.remove(t)}):(C.prototype.hasClass=function(e,t){return e.className.match(RegExp("(\\s|^)"+t+"(\\s|$)"))},C.prototype.addClass=function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},C.prototype.removeClass=function(e,t){if(this.hasClass(e,t)){var n=RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}),C.prototype.removeTextNodes=function(e,t){if(3===e.nodeType)t.removeChild(e);else if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(e.nodeName)>-1)for(var n=e.childNodes,i=n.length-1;i>=0;i--)this.removeTextNodes(n[i],e)},C.prototype.empty=function(e){for(var t;t=e.lastChild;)e.removeChild(t)},C.prototype.avoidInnerHTML=function(e,t){if(/(<(.*)>|&(.*);)/g.test(t))e.innerHTML=t;else{for(var n;n=e.lastChild;)e.removeChild(n);e.appendChild(document.createTextNode(t))}},C.prototype.isVisible=function(e){try{if(!e.offsetParent)return!1}catch(t){return!1}if(e.offsetWidth>0||e.parentNode&&e.parentNode.offsetWidth>0)return!0;for(var n=e;n!==document.documentElement;){if(null===n)return!1;if(11===n.nodeType)return!1;if("none"===n.style.display)return!1;n=n.parentNode}return!0},C.prototype.offset=function(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{left:t,top:n}},S.prototype.parentCell=function(e){var t={};return t.TD=this.wtDom.closest(e,["TD","TH"]),t.TD?t.coords=this.instance.wtTable.getCoords(t.TD):!t.TD&&this.wtDom.hasClass(e,"wtBorder")&&this.wtDom.hasClass(e,"current")&&!this.wtDom.hasClass(e,"corner")&&(t.coords=this.instance.selections.current.selected[0],t.TD=this.instance.wtTable.getCell(t.coords)),t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),t.requestAnimFrame=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),t.cancelRequestAnimFrame=function(){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout}(),t.getComputedStyle||function(){var e,n={getPropertyValue:function(t){return"float"==t&&(t="styleFloat"),e.currentStyle[t.toUpperCase()]||null}};t.getComputedStyle=function(t){return e=t,n}}(),x.prototype=new g,x.prototype.readSettings=function(e){this.offset=e.wtSettings.settings.offsetRow,this.total=e.getSetting("totalRows"),this.fixedCount=e.getSetting("fixedRowsTop")},T.prototype.destroy=function(){clearInterval(this.wtScrollbarV.dragdealer.interval),clearInterval(this.wtScrollbarH.dragdealer.interval)},T.prototype.refreshScrollbars=function(){this.wtScrollbarH.readSettings(),this.wtScrollbarV.readSettings(),this.wtScrollbarH.prepare(),this.wtScrollbarV.prepare(),this.wtScrollbarH.refresh(),this.wtScrollbarV.refresh()},T.prototype.scrollVertical=function(e){if(!this.instance.drawn)throw Error("scrollVertical can only be called after table was drawn to DOM");var t,n=this.instance,i=n.getSetting("offsetRow"),o=n.getSetting("fixedRowsTop"),s=n.getSetting("totalRows"),r=n.getSetting("height")||1/0;if(s>0){if(1/0!==r){var a=n.wtDom.offset(n.wtTable.TBODY),l=n.wtTable.tableOffset,c=a.top-l.top;r-=c,r-=n.getSetting("scrollbarHeight")}t=this.scrollLogic(e,i,s,o,r,function(e){return o>e-i?n.getSetting("rowHeight",e-i):n.getSetting("rowHeight",e)
})}else t=0;return t!==i&&n.update("offsetRow",t),n},T.prototype.scrollHorizontal=function(e){if(!this.instance.drawn)throw Error("scrollHorizontal can only be called after table was drawn to DOM");var t,n=this.instance,i=n.getSetting("offsetColumn"),o=n.getSetting("fixedColumnsLeft"),s=n.getSetting("totalColumns"),r=n.getSetting("width")-n.getSetting("rowHeaderWidth");return t=s>0?this.scrollLogic(e,i,s,o,r,function(e){return o>e-i?n.getSetting("columnWidth",e-i):n.getSetting("columnWidth",e)}):0,t!==i&&n.update("offsetColumn",t),n},T.prototype.scrollLogic=function(e,t,n,i,o,s){var r,a=t+e,l=0;if(a>i){for(a>=n-i&&(a=n-i-1),r=a;o>l&&n>r;)l+=s(r),r++;if(o>l)for(;a>0&&(l+=s(a-1),o>l);)a--}else 0>a&&(a=0);return a},T.prototype.scrollViewport=function(e){var t=this.instance.getSetting("offsetRow"),n=this.instance.getSetting("offsetColumn"),i=this.instance.wtTable.getLastVisibleRow(),o=this.instance.wtTable.getLastVisibleColumn(),s=this.instance.getSetting("totalRows"),r=this.instance.getSetting("totalColumns"),a=this.instance.getSetting("fixedRowsTop"),l=this.instance.getSetting("fixedColumnsLeft");if(0>e[0]||e[0]>s-1)throw Error("row "+e[0]+" does not exist");if(0>e[1]||e[1]>r-1)throw Error("column "+e[1]+" does not exist");return e[0]>i?this.scrollVertical(e[0]-i+1):e[0]===i&&this.instance.wtTable.isLastRowIncomplete()?this.scrollVertical(e[0]-i+1):t>e[0]-a?this.scrollVertical(e[0]-a-t):this.scrollVertical(0),e[1]>o?this.scrollHorizontal(e[1]-o+1):e[1]===o&&this.instance.wtTable.isLastColumnIncomplete()?this.scrollHorizontal(e[1]-o+1):n>e[1]-l?this.scrollHorizontal(e[1]-l-n):this.scrollHorizontal(0),this.instance},E.prototype.init=function(){var t=this;this.$table=e(this.instance.wtTable.TABLE),this.$thead=this.$table.find("thead"),this.$tbody=this.$table.find("tbody"),this.slider=document.createElement("DIV"),this.sliderStyle=this.slider.style,this.sliderStyle.position="absolute",this.sliderStyle.top="0",this.sliderStyle.left="0",this.sliderStyle.display="none",this.slider.className="dragdealer "+this.type,this.handle=document.createElement("DIV"),this.handleStyle=this.handle.style,this.handle.className="handle",this.slider.appendChild(this.handle),this.instance.wtTable.parent.appendChild(this.slider);var n=!0;this.dragTimeout=null;var i,o=function(){t.onScroll(i)};this.dragdealer=new X(this.slider,{vertical:"vertical"===this.type,horizontal:"horizontal"===this.type,slide:!1,speed:100,animationCallback:function(e,s){return n?(n=!1,void 0):(t.skipRefresh=!0,i="vertical"===t.type?s:e,null===t.dragTimeout&&(t.dragTimeout=setInterval(o,100),o()),void 0)},callback:function(e,n){t.skipRefresh=!1,clearInterval(t.dragTimeout),t.dragTimeout=null,i="vertical"===t.type?n:e,t.onScroll(i)}}),this.skipRefresh=!1},E.prototype.onScroll=function(e){if(this.instance.drawn&&(this.readSettings(),this.total>this.visibleCount)){var t=Math.round(this.handlePosition*this.total/this.sliderSize);1===e?"vertical"===this.type?this.instance.scrollVertical(1/0).draw():this.instance.scrollHorizontal(1/0).draw():t!==this.offset?"vertical"===this.type?this.instance.scrollVertical(t-this.offset).draw():this.instance.scrollHorizontal(t-this.offset).draw():this.refresh()}},E.prototype.getHandleSizeRatio=function(e,t){return!t||e>t?1:e/t},E.prototype.prepare=function(){if(!this.skipRefresh){var e=this.getHandleSizeRatio(this.visibleCount,this.total);this.visible=(1===e||isNaN(e))&&"auto"===this.scrollMode||"none"===this.scrollMode?!1:!0}},E.prototype.refresh=function(){if(!this.skipRefresh){if(!this.visible)return this.sliderStyle.display="none",void 0;var e,t,n,i,o=this.visibleCount,s=this.$table.outerWidth()||this.$tbody.outerWidth()||this.$thead.outerWidth(),r=this.$table.outerHeight(),a=this.instance.hasSetting("width")?this.instance.getSetting("width"):s,l=this.instance.hasSetting("height")?this.instance.getSetting("height"):r;a&&l&&(this.instance.hasSetting("width")&&this.instance.wtScroll.wtScrollbarV.visible&&(a-=this.instance.getSetting("scrollbarWidth")),a>s+this.instance.getSetting("scrollbarWidth")&&(a=s),this.instance.hasSetting("height")&&this.instance.wtScroll.wtScrollbarH.visible&&(l-=this.instance.getSetting("scrollbarHeight")),l>r+this.instance.getSetting("scrollbarHeight")&&(l=r),"vertical"===this.type?(this.instance.wtTable.isLastRowIncomplete()&&o--,t=l-2,this.sliderStyle.top=this.$table.position().top+"px",this.sliderStyle.left=a-1+"px",this.sliderStyle.height=t+"px"):(this.instance.wtTable.isLastColumnIncomplete()&&o--,t=a-2,this.sliderStyle.left=this.$table.position().left+"px",this.sliderStyle.top=l-1+"px",this.sliderStyle.width=t+"px"),e=this.getHandleSizeRatio(o,this.total),n=Math.round(t*e),10>n&&(n=15),i=Math.floor(t*(this.offset/this.total)),n+i>t&&(i=t-n),"vertical"===this.type?(this.handleStyle.height=n+"px",this.handleStyle.top=i+"px"):(this.handleStyle.width=n+"px",this.handleStyle.left=i+"px"),this.sliderStyle.display="block")}};var N=function(e){this.instance=e,this.type="vertical",this.init()};N.prototype=new E,N.prototype.readSettings=function(){this.scrollMode=this.instance.getSetting("scrollV"),this.offset=this.instance.getSetting("offsetRow"),this.total=this.instance.getSetting("totalRows"),this.visibleCount=this.instance.wtTable.countVisibleRows(),this.handlePosition=parseInt(this.handleStyle.top,10),this.sliderSize=parseInt(this.sliderStyle.height,10),this.fixedCount=this.instance.getSetting("fixedRowsTop")};var V=function(e){this.instance=e,this.type="horizontal",this.init()};V.prototype=new E,V.prototype.readSettings=function(){this.scrollMode=this.instance.getSetting("scrollH"),this.offset=this.instance.getSetting("offsetColumn"),this.total=this.instance.getSetting("totalColumns"),this.visibleCount=this.instance.wtTable.countVisibleColumns(),this.handlePosition=parseInt(this.handleStyle.left,10),this.sliderSize=parseInt(this.sliderStyle.width,10),this.fixedCount=this.instance.getSetting("fixedColumnsLeft")},R.prototype.add=function(e){this.selected.push(e)},R.prototype.clear=function(){this.selected.length=0},R.prototype.getCorners=function(){var e,t,n,i,o,s=this.selected.length;if(s>0&&(e=n=this.selected[0][0],t=i=this.selected[0][1],s>1))for(o=1;s>o;o++)e>this.selected[o][0]?e=this.selected[o][0]:this.selected[o][0]>n&&(n=this.selected[o][0]),t>this.selected[o][1]?t=this.selected[o][1]:this.selected[o][1]>i&&(i=this.selected[o][1]);return[e,t,n,i]},R.prototype.draw=function(){var e,t,n,i,o,s=this.instance.wtTable.countVisibleRows(),r=this.instance.wtTable.countVisibleColumns();if(this.selected.length){for(e=this.getCorners(),t=0;s>t;t++)for(n=0;r>n;n++)i=this.instance.wtTable.rowFilter.visibleToSource(t),o=this.instance.wtTable.columnFilter.visibleToSource(n),i>=e[0]&&e[2]>=i&&o>=e[1]&&e[3]>=o?this.instance.wtTable.currentCellCache.add(t,n,this.settings.className):i>=e[0]&&e[2]>=i?this.instance.wtTable.currentCellCache.add(t,n,this.settings.highlightRowClassName):o>=e[1]&&e[3]>=o&&this.instance.wtTable.currentCellCache.add(t,n,this.settings.highlightColumnClassName);this.border&&this.border.appear(e)}else this.border&&this.border.disappear()},k.prototype.update=function(e,t){if(void 0===t)for(var n in e)e.hasOwnProperty(n)&&(this.settings[n]=e[n]);else this.settings[e]=t;return this.instance},k.prototype.getSetting=function(e,t,n,i){return this[e]?this[e](t,n,i):this._getSetting(e,t,n,i)},k.prototype._getSetting=function(e,t,n,i){return"function"==typeof this.settings[e]?this.settings[e](t,n,i):void 0!==t&&"[object Array]"===Object.prototype.toString.call(this.settings[e])&&void 0!==t?this.settings[e][t]:this.settings[e]},k.prototype.has=function(e){return!!this.settings[e]},k.prototype.rowHeight=function(e){return this.rowHeightCache[e]!==void 0?this.rowHeightCache[e]:20},k.prototype.columnWidth=function(e){return Math.min(200,this._getSetting("columnWidth",e))};var I=1,L=2,B=4,F=8,_=16,z=32;D.prototype.refreshHiderDimensions=function(){var e=this.instance.getSetting("height"),t=this.instance.getSetting("width");(e||t)&&(this.hiderStyle.overflow="hidden"),e&&(this.hiderStyle.height=this.instance.wtScroll.wtScrollbarH.visible?e-this.instance.getSetting("scrollbarHeight")+"px":e+"px"),t&&(this.hiderStyle.width=this.instance.wtScroll.wtScrollbarV.visible?t-this.instance.getSetting("scrollbarWidth")+"px":t+"px")},D.prototype.refreshStretching=function(){var e=this.instance,t=e.getSetting("stretchH"),n=e.getSetting("scrollH"),i=e.getSetting("scrollbarWidth"),o=e.getSetting("totalColumns"),s=e.getSetting("offsetColumn"),r=e.hasSetting("rowHeaders")?e.getSetting("rowHeaderWidth"):0,a=e.getSetting("width")-r,l=function(e){return"scroll"===n||"auto"===n&&e>a?a-i:a},c=this,h=function(t){var n=c.columnFilter.visibleToSource(t);return o>n?e.getSetting("columnWidth",n):void 0};"hybrid"===t&&(t=s>0?"last":"none"),this.columnStrategy=new y(l,h,t),this.rowStrategy={cells:[],cellCount:0,remainingSize:0}},D.prototype.adjustAvailableNodes=function(){var e,t,n=this.instance.hasSetting("rowHeaders")?1:0;for(this.refreshStretching(),e=this.columnStrategy.cellCount;e+n>this.colgroupChildrenLength;)this.COLGROUP.appendChild(document.createElement("COL")),this.colgroupChildrenLength++;for(;this.colgroupChildrenLength>e+n;)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.colgroupChildrenLength--;if(this.instance.hasSetting("columnHeaders")){for(t=this.THEAD.firstChild;e+n>this.theadChildrenLength;)t.appendChild(document.createElement("TH")),this.theadChildrenLength++;for(;this.theadChildrenLength>e+n;)t.removeChild(t.lastChild),this.theadChildrenLength--}},D.prototype.adjustColumns=function(e,t){for(var n=e.childNodes.length;t>n;){var i=document.createElement("TD");e.appendChild(i),n++}for(;n>t;)e.removeChild(e.lastChild),n--},D.prototype.draw=function(e){return this.rowFilter.readSettings(this.instance),this.columnFilter.readSettings(this.instance),e||(this.tableOffset=this.wtDom.offset(this.TABLE),this.adjustAvailableNodes(),this._doDraw()),this.refreshPositions(e),this.instance.drawn=!0,this},D.prototype._doDraw=function(){var e,t,n,i,o,s=0,r=this.instance.getSetting("totalRows"),a=this.columnStrategy.cellCount,l=this.instance.hasSetting("rowHeaders"),c=l?1:0;for(t=0;this.colgroupChildrenLength>t;t++)c>t?this.wtDom.addClass(this.COLGROUP.childNodes[t],"rowHeader"):this.wtDom.removeClass(this.COLGROUP.childNodes[t],"rowHeader");var h=this.instance.hasSetting("columnHeaders");for(h&&(i=this.THEAD.firstChild,c&&(o=i.firstChild,this.wtDom.empty(o),this.hasEmptyCellProblem&&(o.innerHTML="&nbsp;"))),t=0;a>t;t++)h&&this.instance.getSetting("columnHeaders",this.columnFilter.visibleToSource(t),i.childNodes[c+t]),this.COLGROUP.childNodes[t+c].style.width=this.columnStrategy.getSize(t)+"px";if(a>0)for(e=this.rowFilter.visibleToSource(s);r>e;){for(s>=this.tbodyChildrenLength?(i=document.createElement("TR"),c&&i.appendChild(document.createElement("TH")),this.TBODY.appendChild(i),this.tbodyChildrenLength++):i=0===s?this.TBODY.firstChild:i.nextSibling,this.rowStrategy.cellCount++,c&&this.instance.getSetting("rowHeaders",e,i.firstChild),this.adjustColumns(i,a+c),t=0;a>t;t++)n=this.columnFilter.visibleToSource(t),o=0===t?i.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(n)]:o.nextSibling,o.className="",o.removeAttribute("style"),this.instance.getSetting("cellRenderer",e,n,o),this.hasEmptyCellProblem&&""===o.innerHTML&&(o.innerHTML="&nbsp;");var u=this.isCellVisible(e,n,o);if(u&(z|F))break;s++,e=this.rowFilter.visibleToSource(s)}for(s=this.countVisibleRows();this.tbodyChildrenLength>s;)this.TBODY.removeChild(this.TBODY.lastChild),this.tbodyChildrenLength--},D.prototype.refreshPositions=function(e){this.instance.wtScroll.refreshScrollbars(),this.refreshHiderDimensions(),this.refreshSelections(e)},D.prototype.refreshSelections=function(e){var t,n,i,o,s,r,a=[],l=this.countVisibleRows(),c=this.countVisibleColumns();if(this.oldCellCache=this.currentCellCache,this.currentCellCache=new w,this.instance.selections)for(n in this.instance.selections)this.instance.selections.hasOwnProperty(n)&&(this.instance.selections[n].draw(),this.instance.selections[n].settings.className&&a.push(this.instance.selections[n].settings.className),this.instance.selections[n].settings.highlightRowClassName&&a.push(this.instance.selections[n].settings.highlightRowClassName),this.instance.selections[n].settings.highlightColumnClassName&&a.push(this.instance.selections[n].settings.highlightColumnClassName));for(r=a.length,t=0;l>t;t++)for(i=0;c>i;i++)for(n=this.rowFilter.visibleToSource(t),o=this.columnFilter.visibleToSource(i),s=0;r>s;s++)this.currentCellCache.test(t,i,a[s])?this.wtDom.addClass(this.getCell([n,o]),a[s]):e&&this.oldCellCache.test(t,i,a[s])&&this.wtDom.removeClass(this.getCell([n,o]),a[s])},D.prototype.isCellVisible=function(t,n,i){var o=0,s=this.wtDom.offset(i),r=this.tableOffset,a=s.top-r.top,l=e(i),c=l.outerHeight(),h=this.instance.hasSetting("height")?this.instance.getSetting("height"):1/0;return this.instance.wtSettings.rowHeightCache[t]=c,a>h?o|=z:a+c>h?(this.rowStrategy.remainingSize=h-a,o|=F):o|=L,o|=this.isColumnInViewport(n)?this.getLastVisibleColumn()===n&&this.columnStrategy.remainingSize>0?B:I:_},D.prototype.getCell=function(e){return this.isRowBeforeViewport(e[0])?-1:this.isRowAfterViewport(e[0])?-2:this.isColumnBeforeViewport(e[1])?-3:this.isColumnAfterViewport(e[1])?-4:this.TBODY.childNodes[this.rowFilter.sourceToVisible(e[0])].childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e[1])]},D.prototype.getCoords=function(e){return[this.rowFilter.visibleToSource(this.wtDom.prevSiblings(e.parentNode).length),this.columnFilter.visibleRowHeadedColumnToSourceColumn(e.cellIndex)]},D.prototype.countVisibleRows=function(){return this.rowStrategy&&this.rowStrategy.cellCount||0},D.prototype.countVisibleColumns=function(){return this.columnStrategy&&this.columnStrategy.cellCount||0},D.prototype.getLastVisibleRow=function(){return this.rowFilter.visibleToSource(this.rowStrategy.cellCount-1)},D.prototype.getLastVisibleColumn=function(){return this.columnFilter.visibleToSource(this.columnStrategy.cellCount-1)},D.prototype.isLastRowIncomplete=function(){return this.rowStrategy.remainingSize>0},D.prototype.isLastColumnIncomplete=function(){return this.columnStrategy.remainingSize>0},D.prototype.isRowBeforeViewport=function(e){return this.rowFilter.sourceToVisible(e)<this.rowFilter.fixedCount&&e>=this.rowFilter.fixedCount},D.prototype.isRowAfterViewport=function(e){return e>this.getLastVisibleRow()},D.prototype.isColumnBeforeViewport=function(e){return this.columnFilter.sourceToVisible(e)<this.columnFilter.fixedCount&&e>=this.columnFilter.fixedCount},D.prototype.isColumnAfterViewport=function(e){return e>this.getLastVisibleColumn()},D.prototype.isRowInViewport=function(e){return!this.isRowBeforeViewport(e)&&!this.isRowAfterViewport(e)},D.prototype.isColumnInViewport=function(e){return!this.isColumnBeforeViewport(e)&&!this.isColumnAfterViewport(e)};var W={x:0,y:0,init:function(){this.setEvent("mouse"),this.setEvent("touch")},setEvent:function(e){var t=document["on"+e+"move"]||function(){};document["on"+e+"move"]=function(e){t(e),W.refresh(e)}},refresh:function(e){e||(e=t.event),"mousemove"==e.type?this.set(e):e.touches&&this.set(e.touches[0])},set:function(e){e.pageX||e.pageY?(this.x=e.pageX,this.y=e.pageY):(e.clientX||e.clientY)&&(this.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop)}};W.init();var j={get:function(e){var t=0,n=0;if(e.offsetParent)do n+=e.offsetLeft,t+=e.offsetTop;while(e=e.offsetParent);return[n,t]}},X=function(e,t){if("string"==typeof e&&(e=document.getElementById(e)),e){var n=e.getElementsByTagName("div")[0];n&&-1!=n.className.search(/(^|\s)handle(\s|$)/)&&(this.init(e,n,t||{}),this.setup())}};X.prototype={init:function(e,t,n){this.wrapper=e,this.handle=t,this.options=n,this.disabled=this.getOption("disabled",!1),this.horizontal=this.getOption("horizontal",!0),this.vertical=this.getOption("vertical",!1),this.slide=this.getOption("slide",!0),this.steps=this.getOption("steps",0),this.snap=this.getOption("snap",!1),this.loose=this.getOption("loose",!1),this.speed=this.getOption("speed",10)/100,this.xPrecision=this.getOption("xPrecision",0),this.yPrecision=this.getOption("yPrecision",0),this.callback=n.callback||null,this.animationCallback=n.animationCallback||null,this.bounds={left:n.left||0,right:-(n.right||0),top:n.top||0,bottom:-(n.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0},this.value={prev:[-1,-1],current:[n.x||0,n.y||0],target:[n.x||0,n.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.activity=!1,this.dragging=!1,this.tapping=!1},getOption:function(e,t){return void 0!==this.options[e]?this.options[e]:t},setup:function(){this.setWrapperOffset(),this.setBoundsPadding(),this.setBounds(),this.setSteps(),this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=j.get(this.wrapper)},setBoundsPadding:function(){this.bounds.left||this.bounds.right||(this.bounds.left=j.get(this.handle)[0]-this.offset.wrapper[0],this.bounds.right=-this.bounds.left),this.bounds.top||this.bounds.bottom||(this.bounds.top=j.get(this.handle)[1]-this.offset.wrapper[1],this.bounds.bottom=-this.bounds.top)},setBounds:function(){this.bounds.x0=this.bounds.left,this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right,this.bounds.xRange=this.bounds.x1-this.bounds.x0-this.handle.offsetWidth,this.bounds.y0=this.bounds.top,this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom,this.bounds.yRange=this.bounds.y1-this.bounds.y0-this.handle.offsetHeight,this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth)),this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var e=0;this.steps-1>=e;e++)this.stepRatios[e]=e/(this.steps-1)}},addListeners:function(){var e=this;this.wrapper.onselectstart=function(){return!1},this.handle.onmousedown=this.handle.ontouchstart=function(t){e.handleDownHandler(t)},this.wrapper.onmousedown=this.wrapper.ontouchstart=function(t){e.wrapperDownHandler(t)};var n=document.onmouseup||function(){};document.onmouseup=function(t){n(t),e.documentUpHandler(t)};var i=document.ontouchend||function(){};document.ontouchend=function(t){i(t),e.documentUpHandler(t)};var o=t.onresize||function(){};t.onresize=function(t){o(t),e.documentResizeHandler(t)},this.wrapper.onmousemove=function(){e.activity=!0},this.wrapper.onclick=function(){return!e.activity},this.interval=setInterval(function(){e.animate()},25),e.animate(!1,!0)},handleDownHandler:function(e){this.activity=!1,W.refresh(e),this.preventDefaults(e,!0),this.startDrag(),this.cancelEvent(e)},wrapperDownHandler:function(e){W.refresh(e),this.preventDefaults(e,!0),this.startTap()},documentUpHandler:function(){this.stopDrag(),this.stopTap()},documentResizeHandler:function(){this.setWrapperOffset(),this.setBounds(),this.update()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},setStep:function(e,t,n){this.setValue(this.steps&&e>1?(e-1)/(this.steps-1):0,this.steps&&t>1?(t-1)/(this.steps-1):0,n)},setValue:function(e,t,n){this.setTargetValue([e,t||0]),n&&this.groupCopy(this.value.current,this.value.target)},startTap:function(e){this.disabled||(this.tapping=!0,this.setWrapperOffset(),this.setBounds(),void 0===e&&(e=[W.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,W.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]),this.setTargetOffset(e))},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current),this.result())},startDrag:function(){this.disabled||(this.setWrapperOffset(),this.setBounds(),this.offset.mouse=[W.x-j.get(this.handle)[0],W.y-j.get(this.handle)[1]],this.dragging=!0)},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var e=this.groupClone(this.value.current);if(this.slide){var t=this.change;e[0]+=4*t[0],e[1]+=4*t[1]}this.setTargetValue(e),this.result()}},feedback:function(){var e=this.value.current;this.snap&&this.steps>1&&(e=this.getClosestSteps(e)),this.groupCompare(e,this.value.prev)||("function"==typeof this.animationCallback&&this.animationCallback(e[0],e[1]),this.groupCopy(this.value.prev,e))},result:function(){"function"==typeof this.callback&&this.callback(this.value.target[0],this.value.target[1])},animate:function(e,t){if(!e||this.dragging){if(this.dragging){var n=this.groupClone(this.value.target),i=[W.x-this.offset.wrapper[0]-this.offset.mouse[0],W.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(i,this.loose),this.change=[this.value.target[0]-n[0],this.value.target[1]-n[1]]}(this.dragging||t)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||t)&&(this.update(),this.feedback())}},glide:function(){var e=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return e[0]||e[1]?(Math.abs(e[0])>this.bounds.xStep||Math.abs(e[1])>this.bounds.yStep?(this.value.current[0]+=e[0]*this.speed,this.value.current[1]+=e[1]*this.speed):this.groupCopy(this.value.current,this.value.target),!0):!1},update:function(){this.offset.current=this.snap?this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.getOffsetsByRatios(this.value.current),this.show()},show:function(){this.groupCompare(this.offset.current,this.offset.prev)||(this.horizontal&&(this.handle.style.left=this.offset.current[0]+""+"px"),this.vertical&&(this.handle.style.top=this.offset.current[1]+""+"px"),this.groupCopy(this.offset.prev,this.offset.current))},setTargetValue:function(e,t){var n=t?this.getLooseValue(e):this.getProperValue(e);this.groupCopy(this.value.target,n),this.offset.target=this.getOffsetsByRatios(n)},setTargetOffset:function(e,t){var n=this.getRatiosByOffsets(e),i=t?this.getLooseValue(n):this.getProperValue(n);this.groupCopy(this.value.target,i),this.offset.target=this.getOffsetsByRatios(i)},getLooseValue:function(e){var t=this.getProperValue(e);return[t[0]+(e[0]-t[0])/4,t[1]+(e[1]-t[1])/4]},getProperValue:function(e){var t=this.groupClone(e);return t[0]=Math.max(t[0],0),t[1]=Math.max(t[1],0),t[0]=Math.min(t[0],1),t[1]=Math.min(t[1],1),(!this.dragging&&!this.tapping||this.snap)&&this.steps>1&&(t=this.getClosestSteps(t)),t},getRatiosByOffsets:function(e){return[this.getRatioByOffset(e[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(e[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(e,t,n){return t?(e-n)/t:0},getOffsetsByRatios:function(e){return[this.getOffsetByRatio(e[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(e[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(e,t,n){return Math.round(e*t)+n},getClosestSteps:function(e){return[this.getClosestStep(e[0]),this.getClosestStep(e[1])]},getClosestStep:function(e){for(var t=0,n=1,i=0;this.steps-1>=i;i++)n>Math.abs(this.stepRatios[i]-e)&&(n=Math.abs(this.stepRatios[i]-e),t=i);return this.stepRatios[t]},groupCompare:function(e,t){return e[0]==t[0]&&e[1]==t[1]},groupCopy:function(e,t){e[0]=t[0],e[1]=t[1]},groupClone:function(e){return[e[0],e[1]]},preventDefaults:function(e,n){e||(e=t.event),e.preventDefault&&e.preventDefault(),e.returnValue=!1,n&&document.selection&&document.selection.empty()},cancelEvent:function(e){e||(e=t.event),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}},jQuery.browser||function(){var e,t;jQuery.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=jQuery.uaMatch(navigator.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),jQuery.browser=t}(),function(e){function n(n){var i=n||t.event,o=[].slice.call(arguments,1),s=0,r=0,a=0;return n=e.event.fix(i),n.type="mousewheel",i.wheelDelta&&(s=i.wheelDelta/120),i.detail&&(s=-i.detail/3),a=s,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(a=0,r=-1*s),void 0!==i.wheelDeltaY&&(a=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(r=-1*i.wheelDeltaX/120),o.unshift(n,s,r,a),(e.event.dispatch||e.event.handle).apply(this,o)}var i=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var o=i.length;o;)e.event.fixHooks[i[--o]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],n,!1);else this.onmousewheel=n},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],n,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery)})(jQuery,window,Handsontable),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var t;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var t,n=[],i=[],o=[];t=e.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?i.push(t):o.push(t):n.push(t);return n.concat(i,o)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,i){return t=e(n.options.item).attr("data-value",i),t.find("a").html(n.highlighter(i)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(){var t=this.$menu.find(".active").removeClass("active"),n=t.next();n.length||(n=e(this.$menu.find("li")[0])),n.addClass("active")},prev:function(){var e=this.$menu.find(".active").removeClass("active"),t=e.prev();t.length||(t=this.$menu.find("li").last()),t.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t="function"==typeof this.$element[e]),t},move:function(e){if(this.shown){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){this.suppressKeyPressRepeat||this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(e){e.stopPropagation(),e.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var i=e(this),o=i.data("typeahead"),s="object"==typeof n&&n;o||i.data("typeahead",o=new t(this,s)),"string"==typeof n&&o[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var t=e(this);t.data("typeahead")||t.typeahead(t.data())})}(window.jQuery),function(){function e(e){this._n=e}function t(e,t,n){var i,o=Math.pow(10,t);if(i=(Math.round(e*o)/o).toFixed(t),n){var s=RegExp("0{1,"+n+"}$");i=i.replace(s,"")}return i}function n(e,t){var n;return n=t.indexOf("$")>-1?o(e,t):t.indexOf("%")>-1?s(e,t):t.indexOf(":")>-1?r(e,t):l(e,t)}function i(e,t){if(t.indexOf(":")>-1)e._n=a(t);else if(t===f)e._n=0;else{var n=t;"."!==d[p].delimiters.decimal&&(t=t.replace(/\./g,"").replace(d[p].delimiters.decimal,"."));for(var i=RegExp(d[p].abbreviations.thousand+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),o=RegExp(d[p].abbreviations.million+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),s=RegExp(d[p].abbreviations.billion+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),r=RegExp(d[p].abbreviations.trillion+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),l=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=!1,h=0;l.length>=h&&!(c=t.indexOf(l[h])>-1?Math.pow(1024,h+1):!1);h++);e._n=(c?c:1)*(n.match(i)?Math.pow(10,3):1)*(n.match(o)?Math.pow(10,6):1)*(n.match(s)?Math.pow(10,9):1)*(n.match(r)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*Number((t.indexOf("(")>-1?"-":"")+t.replace(/[^0-9\.-]+/g,"")),e._n=c?Math.ceil(e._n):e._n}return e._n}function o(e,t){var i=1>=t.indexOf("$")?!0:!1,o="";t.indexOf(" $")>-1?(o=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(o=" ",t=t.replace("$ ","")):t=t.replace("$","");var s=n(e,t);return i?s.indexOf("(")>-1||s.indexOf("-")>-1?(s=s.split(""),s.splice(1,0,d[p].currency.symbol+o),s=s.join("")):s=d[p].currency.symbol+o+s:s.indexOf(")")>-1?(s=s.split(""),s.splice(-1,0,o+d[p].currency.symbol),s=s.join("")):s=s+o+d[p].currency.symbol,s}function s(e,t){var i="";t.indexOf(" %")>-1?(i=" ",t=t.replace(" %","")):t=t.replace("%",""),e._n=100*e._n;var o=n(e,t);return o.indexOf(")")>-1?(o=o.split(""),o.splice(-1,0,i+"%"),o=o.join("")):o=o+i+"%",o}function r(e){var t=Math.floor(e._n/60/60),n=Math.floor((e._n-60*60*t)/60),i=Math.round(e._n-60*60*t-60*n);return t+":"+(10>n?"0"+n:n)+":"+(10>i?"0"+i:i)}function a(e){var t=e.split(":"),n=0;return 3===t.length?(n+=60*60*Number(t[0]),n+=60*Number(t[1]),n+=Number(t[2])):2===t.lenght&&(n+=60*Number(t[0]),n+=Number(t[1])),Number(n)}function l(e,n){var i=!1,o=!1,s="",r="",a="",l=Math.abs(e._n);if(0===e._n&&null!==f)return f;if(n.indexOf("(")>-1&&(i=!0,n=n.slice(1,-1)),n.indexOf("a")>-1&&(n.indexOf(" a")>-1?(s=" ",n=n.replace(" a","")):n=n.replace("a",""),l>=Math.pow(10,12)?(s+=d[p].abbreviations.trillion,e._n=e._n/Math.pow(10,12)):Math.pow(10,12)>l&&l>=Math.pow(10,9)?(s+=d[p].abbreviations.billion,e._n=e._n/Math.pow(10,9)):Math.pow(10,9)>l&&l>=Math.pow(10,6)?(s+=d[p].abbreviations.million,e._n=e._n/Math.pow(10,6)):Math.pow(10,6)>l&&l>=Math.pow(10,3)&&(s+=d[p].abbreviations.thousand,e._n=e._n/Math.pow(10,3))),n.indexOf("b")>-1){n.indexOf(" b")>-1?(r=" ",n=n.replace(" b","")):n=n.replace("b","");
for(var c,h,u=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],m=0;u.length>=m;m++)if(c=Math.pow(1024,m),h=Math.pow(1024,m+1),e._n>=c&&h>e._n){r+=u[m],c>0&&(e._n=e._n/c);break}}n.indexOf("o")>-1&&(n.indexOf(" o")>-1?(a=" ",n=n.replace(" o","")):n=n.replace("o",""),a+=d[p].ordinal(e._n)),n.indexOf("[.]")>-1&&(o=!0,n=n.replace("[.]","."));var g=(""+e._n).split(".")[0],w=n.split(".")[1],v=n.indexOf(","),y="",b=!1;return w?(w.indexOf("[")>-1?(w=w.replace("]",""),w=w.split("["),y=t(e._n,w[0].length+w[1].length,w[1].length)):y=t(e._n,w.length),g=y.split(".")[0],y=y.split(".")[1].length?d[p].delimiters.decimal+y.split(".")[1]:"",o&&0===Number(y)&&(y="")):g=t(e._n,null),g.indexOf("-")>-1&&(g=g.slice(1),b=!0),v>-1&&(g=(""+g).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+d[p].delimiters.thousands)),0===n.indexOf(".")&&(g=""),(i&&b?"(":"")+(!i&&b?"-":"")+g+y+(a?a:"")+(s?s:"")+(r?r:"")+(i&&b?")":"")}function c(e,t){d[e]=t}var h,u="1.4.7",d={},p="en",f=null,m="undefined"!=typeof module&&module.exports;h=function(t){return h.isNumeral(t)?t=t.value():Number(t)||(t=0),new e(Number(t))},h.version=u,h.isNumeral=function(t){return t instanceof e},h.language=function(e,t){return e?(e&&!t&&(p=e),(t||!d[e])&&c(e,t),h):p},h.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$"}}),h.zeroFormat=function(e){f="string"==typeof e?e:null},h.fn=e.prototype={clone:function(){return h(this)},format:function(e){return n(this,e?e:h.defaultFormat)},unformat:function(e){return i(this,e?e:h.defaultFormat)},value:function(){return this._n},valueOf:function(){return this._n},set:function(e){return this._n=Number(e),this},add:function(e){return this._n=this._n+Number(e),this},subtract:function(e){return this._n=this._n-Number(e),this},multiply:function(e){return this._n=this._n*Number(e),this},divide:function(e){return this._n=this._n/Number(e),this},difference:function(e){var t=this._n-Number(e);return 0>t&&(t=-t),t}},m&&(module.exports=h),"undefined"==typeof ender&&(this.numeral=h),"function"==typeof define&&define.amd&&define([],function(){return h})}.call(this),function(e,t){function n(e){for(var t,n=e.split(/\s+/),i=[],o=0;t=n[o];o++)t=t[0].toUpperCase(),i.push(t);return i}function i(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function o(n,s,r){return r||(r=0),s.each(function(){var s,a,l=e(this),c=this,h=this.nodeName.toLowerCase();switch("label"==h&&l.find("input, textarea, select").length&&(s=l.text(),l=l.children().first(),c=l.get(0),h=c.nodeName.toLowerCase()),h){case"menu":a={name:l.attr("label"),items:{}},r=o(a.items,l.children(),r);break;case"a":case"button":a={name:l.text(),disabled:!!l.attr("disabled"),callback:function(){return function(){l.click()}}()};break;case"menuitem":case"command":switch(l.attr("type")){case t:case"command":case"menuitem":a={name:l.attr("label"),disabled:!!l.attr("disabled"),callback:function(){return function(){l.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!l.attr("disabled"),name:l.attr("label"),selected:!!l.attr("checked")};break;case"radio":a={type:"radio",disabled:!!l.attr("disabled"),name:l.attr("label"),radio:l.attr("radiogroup"),value:l.attr("id"),selected:!!l.attr("checked")};break;default:a=t}break;case"hr":a="-------";break;case"input":switch(l.attr("type")){case"text":a={type:"text",name:s||i(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"checkbox":a={type:"checkbox",name:s||i(c),disabled:!!l.attr("disabled"),selected:!!l.attr("checked")};break;case"radio":a={type:"radio",name:s||i(c),disabled:!!l.attr("disabled"),radio:!!l.attr("name"),value:l.val(),selected:!!l.attr("checked")};break;default:a=t}break;case"select":a={type:"select",name:s||i(c),disabled:!!l.attr("disabled"),selected:l.val(),options:{}},l.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:s||i(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"label":break;default:a={type:"html",html:l.clone(!0)}}a&&(r++,n["key"+r]=a)}),r}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement;var s=null,r=!1,a=e(window),l=0,c={},h={},u={},d={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(n,i,o){var s;if(!i&&!o)return n.determinePosition.call(this,n.$menu),t;if("maintain"===i&&"maintain"===o)s=n.$menu.position();else{var r=n.$trigger.parents().andSelf().filter(function(){return"fixed"==e(this).css("position")}).length;r&&(o-=a.scrollTop(),i-=a.scrollLeft()),s={top:o,left:i}}var l=a.scrollTop()+a.height(),c=a.scrollLeft()+a.width(),h=n.$menu.height(),u=n.$menu.width();s.top+h>l&&(s.top-=h),s.left+u>c&&(s.left-=u),n.$menu.css(s)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var n={top:0,left:this.outerWidth()};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},p={timer:null,pageX:null,pageY:null},f=function(e){for(var t=0,n=e;;)if(t=Math.max(t,parseInt(n.css("z-index"),10)||0),n=n.parent(),!n||!n.length||"html body".indexOf(n.prop("nodeName").toLowerCase())>-1)break;return t},m={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var n=e(this);if(t.preventDefault(),t.stopImmediatePropagation(),!("right"!=t.data.trigger&&t.originalEvent||n.hasClass("context-menu-disabled"))){if(s=n,t.data.build){var i=t.data.build(s,t);if(i===!1)return;if(t.data=e.extend(!0,{},d,t.data,i||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),Error("No Items sepcified");t.data.$trigger=s,g.create(t.data)}g.show.call(n,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var n=e(this);s&&s.length&&!s.is(n)&&s.data("contextMenu").$menu.trigger("contextmenu:hide"),2==t.button&&(s=n.data("contextMenuActive",!0))},mouseup:function(t){var n=e(this);n.data("contextMenuActive")&&s&&s.length&&s.is(n)&&!n.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),s=n,n.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),n.removeData("contextMenuActive")},mouseenter:function(t){var n=e(this),i=e(t.relatedTarget),o=e(document);i.is(".context-menu-list")||i.closest(".context-menu-list").length||s&&s.length||(p.pageX=t.pageX,p.pageY=t.pageY,p.data=t.data,o.on("mousemove.contextMenuShow",m.mousemove),p.timer=setTimeout(function(){p.timer=null,o.off("mousemove.contextMenuShow"),s=n,n.trigger(e.Event("contextmenu",{data:p.data,pageX:p.pageX,pageY:p.pageY}))},t.data.delay))},mousemove:function(e){p.pageX=e.pageX,p.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(!n.is(".context-menu-list")&&!n.closest(".context-menu-list").length){try{clearTimeout(p.timer)}catch(t){}p.timer=null}},layerClick:function(n){var i,o,s,r=e(this),l=r.data("contextMenuRoot"),h=!1,u=n.button,d=n.pageX,p=n.pageY;n.preventDefault(),n.stopImmediatePropagation(),r.on("mouseup",function(){h=!0}),setTimeout(function(){var f,m;if("left"==l.trigger&&0==u||"right"==l.trigger&&2==u)if(document.elementFromPoint){l.$layer.hide(),i=document.elementFromPoint(d-a.scrollLeft(),p-a.scrollTop()),l.$layer.show(),s=[];for(var g in c)s.push(g);if(i=e(i).closest(s.join(", ")),i.length&&i.is(l.$trigger[0]))return l.position.call(l.$trigger,l,d,p),t}else if(o=l.$trigger.offset(),f=e(window),o.top+=f.scrollTop(),o.top<=n.pageY&&(o.left+=f.scrollLeft(),o.left<=n.pageX&&(o.bottom=o.top+l.$trigger.outerHeight(),o.bottom>=n.pageY&&(o.right=o.left+l.$trigger.outerWidth(),o.right>=n.pageX))))return l.position.call(l.$trigger,l,d,p),t;m=function(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),l.$menu.trigger("contextmenu:hide"),i&&i.length&&setTimeout(function(){i.contextMenu({x:d,y:p})},50)},h?m():r.on("mouseup",m)},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var n=s.data("contextMenu")||{};switch(n.$menu.children(),e.keyCode){case 9:case 38:if(m.keyStop(e,n),n.isInput){if(9==e.keyCode&&e.shiftKey)return e.preventDefault(),n.$selected&&n.$selected.find("input, textarea, select").blur(),n.$menu.trigger("prevcommand"),t;if(38==e.keyCode&&"checkbox"==n.$selected.find("input, textarea, select").prop("type"))return e.preventDefault(),t}else if(9!=e.keyCode||e.shiftKey)return n.$menu.trigger("prevcommand"),t;case 40:if(m.keyStop(e,n),!n.isInput)return n.$menu.trigger("nextcommand"),t;if(9==e.keyCode)return e.preventDefault(),n.$selected&&n.$selected.find("input, textarea, select").blur(),n.$menu.trigger("nextcommand"),t;if(40==e.keyCode&&"checkbox"==n.$selected.find("input, textarea, select").prop("type"))return e.preventDefault(),t;break;case 37:if(m.keyStop(e,n),n.isInput||!n.$selected||!n.$selected.length)break;if(!n.$selected.parent().hasClass("context-menu-root")){var i=n.$selected.parent().parent();return n.$selected.trigger("contextmenu:blur"),n.$selected=i,t}break;case 39:if(m.keyStop(e,n),n.isInput||!n.$selected||!n.$selected.length)break;var o=n.$selected.data("contextMenu")||{};if(o.$menu&&n.$selected.hasClass("context-menu-submenu"))return n.$selected=null,o.$selected=null,o.$menu.trigger("nextcommand"),t;break;case 35:case 36:return n.$selected&&n.$selected.find("input, textarea, select").length?t:((n.$selected&&n.$selected.parent()||n.$menu).children(":not(.disabled, .not-selectable)")[36==e.keyCode?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault(),t);case 13:if(m.keyStop(e,n),n.isInput){if(n.$selected&&!n.$selected.is("textarea, select"))return e.preventDefault(),t;break}return n.$selected&&n.$selected.trigger("mouseup"),t;case 32:case 33:case 34:return m.keyStop(e,n),t;case 27:return m.keyStop(e,n),n.$menu.trigger("contextmenu:hide"),t;default:var r=String.fromCharCode(e.keyCode).toUpperCase();if(n.accesskeys[r])return n.accesskeys[r].$node.trigger(n.accesskeys[r].$menu?"contextmenu:focus":"mouseup"),t}e.stopPropagation(),n.$selected&&n.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var i=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=i}for(var o=n.$menu.children(),s=n.$selected&&n.$selected.prev().length?n.$selected.prev():o.last(),r=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if(s=s.prev().length?s.prev():o.last(),s.is(r))return;n.$selected&&m.itemMouseleave.call(n.$selected.get(0),t),m.itemMouseenter.call(s.get(0),t);var a=s.find("input, textarea, select");a.length&&a.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var i=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=i}for(var o=n.$menu.children(),s=n.$selected&&n.$selected.next().length?n.$selected.next():o.first(),r=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if(s=s.next().length?s.next():o.first(),s.is(r))return;n.$selected&&m.itemMouseleave.call(n.$selected.get(0),t),m.itemMouseenter.call(s.get(0),t);var a=s.find("input, textarea, select");a.length&&a.focus()},focusInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),i=n.contextMenu,o=n.contextMenuRoot;o.$selected=i.$selected=t,o.isInput=i.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),i=n.contextMenu,o=n.contextMenuRoot;o.isInput=i.isInput=!1},menuMouseenter:function(){var t=e(this).data().contextMenuRoot;t.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(n){var i=e(this),o=i.data(),s=o.contextMenu,r=o.contextMenuRoot;return r.hovering=!0,n&&r.$layer&&r.$layer.is(n.relatedTarget)&&(n.preventDefault(),n.stopImmediatePropagation()),(s.$menu?s:r).$menu.children(".hover").trigger("contextmenu:blur"),i.hasClass("disabled")||i.hasClass("not-selectable")?(s.$selected=null,t):(i.trigger("contextmenu:focus"),t)},itemMouseleave:function(n){var i=e(this),o=i.data(),s=o.contextMenu,r=o.contextMenuRoot;return r!==s&&r.$layer&&r.$layer.is(n.relatedTarget)?(r.$selected&&r.$selected.trigger("contextmenu:blur"),n.preventDefault(),n.stopImmediatePropagation(),r.$selected=s.$selected=s.$node,t):(i.trigger("contextmenu:blur"),t)},itemClick:function(t){var n,i=e(this),o=i.data(),s=o.contextMenu,r=o.contextMenuRoot,a=o.contextMenuKey;if(s.items[a]&&!i.hasClass("disabled")&&!i.hasClass("context-menu-submenu")){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(r.callbacks[a]))n=r.callbacks[a];else{if(!e.isFunction(r.callback))return;n=r.callback}n.call(r.$trigger,a,r)!==!1?r.$menu.trigger("contextmenu:hide"):r.$menu.parent().length&&g.update.call(r.$trigger,r)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var i=e(this).data("contextMenuRoot");g.hide.call(i.$trigger,i,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),i=n.data(),o=i.contextMenu,s=i.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),o.$selected=s.$selected=n,o.$node&&s.positionSubmenu.call(o.$node,o.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),i=n.data(),o=i.contextMenu;i.contextMenuRoot,n.removeClass("hover"),o.$selected=null}},g={show:function(n,i,o){var r=e(this),a={};if(e("#context-menu-layer").trigger("mousedown"),n.$trigger=r,n.events.show.call(r,n)===!1)return s=null,t;if(g.update.call(r,n),n.position.call(r,n,i,o),n.zIndex&&(a.zIndex=f(r)+n.zIndex),g.layer.call(n.$menu,n,a.zIndex),n.$menu.find("ul").css("zIndex",a.zIndex+1),n.$menu.css(a)[n.animation.show](n.animation.duration),r.data("contextMenu",n),e(document).off("keydown.contextMenu").on("keydown.contextMenu",m.key),n.autoHide){var l=r.position();l.right=l.left+r.outerWidth(),l.bottom=l.top+this.outerHeight(),e(document).on("mousemove.contextMenuAutoHide",function(e){!n.$layer||n.hovering||e.pageX>=l.left&&e.pageX<=l.right&&e.pageY>=l.top&&e.pageY<=l.bottom||n.$menu.trigger("contextmenu:hide")})}},hide:function(n,i){var o=e(this);if(n||(n=o.data("contextMenu")||{}),i||!n.events||n.events.hide.call(o,n)!==!1){if(n.$layer){setTimeout(function(e){return function(){e.remove()}}(n.$layer),10);try{delete n.$layer}catch(r){n.$layer=null}}s=null,n.$menu.find(".hover").trigger("contextmenu:blur"),n.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),n.$menu&&n.$menu[n.animation.hide](n.animation.duration,function(){n.build&&(n.$menu.remove(),e.each(n,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:n[e]=t;try{delete n[e]}catch(i){}return!0}}))})}},create:function(i,o){o===t&&(o=i),i.$menu=e('<ul class="context-menu-list '+(i.className||"")+'"></ul>').data({contextMenu:i,contextMenuRoot:o}),e.each(["callbacks","commands","inputs"],function(e,t){i[t]={},o[t]||(o[t]={})}),o.accesskeys||(o.accesskeys={}),e.each(i.items,function(t,s){var r=e('<li class="context-menu-item '+(s.className||"")+'"></li>'),a=null,l=null;if(s.$node=r.data({contextMenu:i,contextMenuRoot:o,contextMenuKey:t}),s.accesskey)for(var c,h=n(s.accesskey),d=0;c=h[d];d++)if(!o.accesskeys[c]){o.accesskeys[c]=s,s._name=s.name.replace(RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}if("string"==typeof s)r.addClass("context-menu-separator not-selectable");else if(s.type&&u[s.type])u[s.type].call(r,s,i,o),e.each([i,o],function(n,i){i.commands[t]=s,e.isFunction(s.callback)&&(i.callbacks[t]=s.callback)});else{switch("html"==s.type?r.addClass("context-menu-html not-selectable"):s.type?(a=e("<label></label>").appendTo(r),e("<span></span>").html(s._name||s.name).appendTo(a),r.addClass("context-menu-input"),i.hasTypes=!0,e.each([i,o],function(e,n){n.commands[t]=s,n.inputs[t]=s})):s.items&&(s.type="sub"),s.type){case"text":l=e('<input type="text" value="1" name="context-menu-input-'+t+'" value="">').val(s.value||"").appendTo(a);break;case"textarea":l=e('<textarea name="context-menu-input-'+t+'"></textarea>').val(s.value||"").appendTo(a),s.height&&l.height(s.height);break;case"checkbox":l=e('<input type="checkbox" value="1" name="context-menu-input-'+t+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(a);break;case"radio":l=e('<input type="radio" value="1" name="context-menu-input-'+s.radio+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(a);break;case"select":l=e('<select name="context-menu-input-'+t+'">').appendTo(a),s.options&&(e.each(s.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(l)}),l.val(s.selected));break;case"sub":e("<span></span>").html(s._name||s.name).appendTo(r),s.appendTo=s.$node,g.create(s,o),r.data("contextMenu",s).addClass("context-menu-submenu"),s.callback=null;break;case"html":e(s.html).appendTo(r);break;default:e.each([i,o],function(n,i){i.commands[t]=s,e.isFunction(s.callback)&&(i.callbacks[t]=s.callback)}),e("<span></span>").html(s._name||s.name||"").appendTo(r)}s.type&&"sub"!=s.type&&"html"!=s.type&&(l.on("focus",m.focusInput).on("blur",m.blurInput),s.events&&l.on(s.events,i)),s.icon&&r.addClass("icon icon-"+s.icon)}s.$input=l,s.$label=a,r.appendTo(i.$menu),!i.hasTypes&&e.support.eventSelectstart&&r.on("selectstart.disableTextSelect",m.abortevent)}),i.$node||i.$menu.css("display","none").addClass("context-menu-root"),i.$menu.appendTo(i.appendTo||document.body)},update:function(n,i){var o=this;i===t&&(i=n,n.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var t=e(this);t.width(t.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),r=n.items[s],a=e.isFunction(r.disabled)&&r.disabled.call(o,s,i)||r.disabled===!0;if(t[a?"addClass":"removeClass"]("disabled"),r.type)switch(t.find("input, select, textarea").prop("disabled",a),r.type){case"text":case"textarea":r.$input.val(r.value||"");break;case"checkbox":case"radio":r.$input.val(r.value||"").prop("checked",!!r.selected);break;case"select":r.$input.val(r.selected||"")}r.$menu&&g.update.call(o,r,i)})},layer:function(t,n){var i=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:a.height(),width:a.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",m.abortevent).on("mousedown",m.layerClick);return e.support.fixedPosition||i.css({position:"absolute",height:e(document).height()}),i}};e.fn.contextMenu=function(n){if(n===t)this.first().trigger("contextmenu");else if(n.x&&n.y)this.first().trigger(e.Event("contextmenu",{pageX:n.x,pageY:n.y}));else if("hide"===n){var i=this.data("contextMenu").$menu;i&&i.trigger("contextmenu:hide")}else n?this.removeClass("context-menu-disabled"):n||this.addClass("context-menu-disabled");return this},e.contextMenu=function(n,i){"string"!=typeof n&&(i=n,n="create"),"string"==typeof i?i={selector:i}:i===t&&(i={});var o=e.extend(!0,{},d,i||{}),s=e(document);switch(n){case"create":if(!o.selector)throw Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||e.isEmptyObject(o.items)))throw Error("No Items sepcified");switch(l++,o.ns=".contextMenu"+l,c[o.selector]=o.ns,h[o.ns]=o,o.trigger||(o.trigger="right"),r||(s.on({"contextmenu:hide.contextMenu":m.hideMenu,"prevcommand.contextMenu":m.prevItem,"nextcommand.contextMenu":m.nextItem,"contextmenu.contextMenu":m.abortevent,"mouseenter.contextMenu":m.menuMouseenter,"mouseleave.contextMenu":m.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",m.inputClick).on({"mouseup.contextMenu":m.itemClick,"contextmenu:focus.contextMenu":m.focusItem,"contextmenu:blur.contextMenu":m.blurItem,"contextmenu.contextMenu":m.abortevent,"mouseenter.contextMenu":m.itemMouseenter,"mouseleave.contextMenu":m.itemMouseleave},".context-menu-item"),r=!0),s.on("contextmenu"+o.ns,o.selector,o,m.contextmenu),o.trigger){case"hover":s.on("mouseenter"+o.ns,o.selector,o,m.mouseenter).on("mouseleave"+o.ns,o.selector,o,m.mouseleave);break;case"left":s.on("click"+o.ns,o.selector,o,m.click)}o.build||g.create(o);break;case"destroy":if(o.selector){if(c[o.selector]){var a=e(".context-menu-list").filter(":visible");a.length&&a.data().contextMenuRoot.$trigger.is(o.selector)&&a.trigger("contextmenu:hide",{force:!0});try{h[c[o.selector]].$menu&&h[c[o.selector]].$menu.remove(),delete h[c[o.selector]]}catch(u){h[c[o.selector]]=null}s.off(c[o.selector])}}else s.off(".contextMenu .contextMenuAutoHide"),e.each(c,function(e,t){s.off(t)}),c={},h={},l=0,r=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof i&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,i){i===t&&(i={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=i[e]||"";break;case"checkbox":t.selected=i[e]?!0:!1;break;case"radio":t.selected=(i[t.radio]||"")==t.value?!0:!1;break;case"select":t.selected=i[e]||""}})},e.contextMenu.getInputValues=function(n,i){return i===t&&(i={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":i[e]=t.$input.val();break;case"checkbox":i[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(i[t.radio]=t.value)}}),i},e.contextMenu.fromMenu=function(t){var n=e(t),i={};return o(i,n.children()),i},e.contextMenu.defaults=d,e.contextMenu.types=u}(jQuery);