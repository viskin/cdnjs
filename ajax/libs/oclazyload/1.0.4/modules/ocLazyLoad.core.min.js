(function(angular,window){"use strict";var regModules=["ng","oc.lazyLoad"],regInvokes={},regConfigs=[],modulesToLoad=[],realModules=[],recordDeclarations=[],broadcast=angular.noop,runBlocks={},justLoaded=[];var ocLazyLoad=angular.module("oc.lazyLoad",["ng"]);ocLazyLoad.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function($controllerProvider,$provide,$compileProvider,$filterProvider,$injector,$animateProvider){var modules={},providers={$controllerProvider:$controllerProvider,$compileProvider:$compileProvider,$filterProvider:$filterProvider,$provide:$provide,$injector:$injector,$animateProvider:$animateProvider},debug=false,events=false,moduleCache=[];moduleCache.push=function(value){if(this.indexOf(value)===-1){Array.prototype.push.apply(this,arguments)}};this.config=function(config){if(angular.isDefined(config.modules)){if(angular.isArray(config.modules)){angular.forEach(config.modules,function(moduleConfig){modules[moduleConfig.name]=moduleConfig})}else{modules[config.modules.name]=config.modules}}if(angular.isDefined(config.debug)){debug=config.debug}if(angular.isDefined(config.events)){events=config.events}};this._init=function _init(element){if(modulesToLoad.length===0){var elements=[element],names=["ng:app","ng-app","x-ng-app","data-ng-app"],NG_APP_CLASS_REGEXP=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/,append=function append(elm){return elm&&elements.push(elm)};angular.forEach(names,function(name){names[name]=true;append(document.getElementById(name));name=name.replace(":","\\:");if(typeof element[0]!=="undefined"&&element[0].querySelectorAll){angular.forEach(element[0].querySelectorAll("."+name),append);angular.forEach(element[0].querySelectorAll("."+name+"\\:"),append);angular.forEach(element[0].querySelectorAll("["+name+"]"),append)}});angular.forEach(elements,function(elm){if(modulesToLoad.length===0){var className=" "+element.className+" ";var match=NG_APP_CLASS_REGEXP.exec(className);if(match){modulesToLoad.push((match[2]||"").replace(/\s+/g,","))}else{angular.forEach(elm.attributes,function(attr){if(modulesToLoad.length===0&&names[attr.name]){modulesToLoad.push(attr.value)}})}}})}if(modulesToLoad.length===0&&!((window.jasmine||window.mocha)&&angular.isDefined(angular.mock))){console.error("No module found during bootstrap, unable to init ocLazyLoad. You should always use the ng-app directive or angular.boostrap when you use ocLazyLoad.")}var addReg=function addReg(moduleName){if(regModules.indexOf(moduleName)===-1){regModules.push(moduleName);var mainModule=angular.module(moduleName);_invokeQueue(null,mainModule._invokeQueue,moduleName);_invokeQueue(null,mainModule._configBlocks,moduleName);angular.forEach(mainModule.requires,addReg)}};angular.forEach(modulesToLoad,function(moduleName){addReg(moduleName)});modulesToLoad=[];recordDeclarations.pop()};var stringify=function stringify(obj){var cache=[];return JSON.stringify(obj,function(key,value){if(angular.isObject(value)&&value!==null){if(cache.indexOf(value)!==-1){return}cache.push(value)}return value})};var hashCode=function hashCode(str){var hash=0,i,chr,len;if(str.length==0){return hash}for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash};function _register(providers,registerModules,params){if(registerModules){var k,moduleName,moduleFn,tempRunBlocks=[];for(k=registerModules.length-1;k>=0;k--){moduleName=registerModules[k];if(!angular.isString(moduleName)){moduleName=getModuleName(moduleName)}if(!moduleName||justLoaded.indexOf(moduleName)!==-1||modules[moduleName]&&realModules.indexOf(moduleName)===-1){continue}var newModule=regModules.indexOf(moduleName)===-1;moduleFn=ngModuleFct(moduleName);if(newModule){regModules.push(moduleName);_register(providers,moduleFn.requires,params)}if(moduleFn._runBlocks.length>0){runBlocks[moduleName]=[];while(moduleFn._runBlocks.length>0){runBlocks[moduleName].push(moduleFn._runBlocks.shift())}}if(angular.isDefined(runBlocks[moduleName])&&(newModule||params.rerun)){tempRunBlocks=tempRunBlocks.concat(runBlocks[moduleName])}_invokeQueue(providers,moduleFn._invokeQueue,moduleName,params.reconfig);_invokeQueue(providers,moduleFn._configBlocks,moduleName,params.reconfig);broadcast(newModule?"ocLazyLoad.moduleLoaded":"ocLazyLoad.moduleReloaded",moduleName);registerModules.pop();justLoaded.push(moduleName)}var instanceInjector=providers.getInstanceInjector();angular.forEach(tempRunBlocks,function(fn){instanceInjector.invoke(fn)})}}function _registerInvokeList(args,moduleName){var invokeList=args[2][0],type=args[1],newInvoke=false;if(angular.isUndefined(regInvokes[moduleName])){regInvokes[moduleName]={}}if(angular.isUndefined(regInvokes[moduleName][type])){regInvokes[moduleName][type]={}}var onInvoke=function onInvoke(invokeName,signature){if(!regInvokes[moduleName][type].hasOwnProperty(invokeName)){regInvokes[moduleName][type][invokeName]=[]}if(regInvokes[moduleName][type][invokeName].indexOf(signature)===-1){newInvoke=true;regInvokes[moduleName][type][invokeName].push(signature);broadcast("ocLazyLoad.componentLoaded",[moduleName,type,invokeName])}};function signature(data){if(angular.isArray(data)){return hashCode(data.toString())}else if(angular.isObject(data)){return hashCode(stringify(data))}else{if(angular.isDefined(data)&&data!==null){return hashCode(data.toString())}else{return data}}}if(angular.isString(invokeList)){onInvoke(invokeList,signature(args[2][1]))}else if(angular.isObject(invokeList)){angular.forEach(invokeList,function(invoke,key){if(angular.isString(invoke)){onInvoke(invoke,signature(invokeList[1]))}else{onInvoke(key,signature(invoke))}})}else{return false}return newInvoke}function _invokeQueue(providers,queue,moduleName,reconfig){if(!queue){return}var i,len,args,provider;for(i=0,len=queue.length;i<len;i++){args=queue[i];if(angular.isArray(args)){if(providers!==null){if(providers.hasOwnProperty(args[0])){provider=providers[args[0]]}else{throw new Error("unsupported provider "+args[0])}}var isNew=_registerInvokeList(args,moduleName);if(args[1]!=="invoke"){if(isNew&&angular.isDefined(provider)){provider[args[1]].apply(provider,args[2])}}else{var callInvoke=function callInvoke(fct){var invoked=regConfigs.indexOf(moduleName+"-"+fct);if(invoked===-1||reconfig){if(invoked===-1){regConfigs.push(moduleName+"-"+fct)}if(angular.isDefined(provider)){provider[args[1]].apply(provider,args[2])}}};if(angular.isFunction(args[2][0])){callInvoke(args[2][0])}else if(angular.isArray(args[2][0])){for(var j=0,jlen=args[2][0].length;j<jlen;j++){if(angular.isFunction(args[2][0][j])){callInvoke(args[2][0][j])}}}}}}}function getModuleName(module){var moduleName=null;if(angular.isString(module)){moduleName=module}else if(angular.isObject(module)&&module.hasOwnProperty("name")&&angular.isString(module.name)){moduleName=module.name}return moduleName}function moduleExists(moduleName){if(!angular.isString(moduleName)){return false}try{return ngModuleFct(moduleName)}catch(e){if(/No module/.test(e)||e.message.indexOf("$injector:nomod")>-1){return false}}}this.$get=["$log","$rootElement","$rootScope","$cacheFactory","$q",function($log,$rootElement,$rootScope,$cacheFactory,$q){var instanceInjector,filesCache=$cacheFactory("ocLazyLoad");if(!debug){$log={};$log["error"]=angular.noop;$log["warn"]=angular.noop;$log["info"]=angular.noop}providers.getInstanceInjector=function(){return instanceInjector?instanceInjector:instanceInjector=$rootElement.data("$injector")||angular.injector()};broadcast=function broadcast(eventName,params){if(events){$rootScope.$broadcast(eventName,params)}if(debug){$log.info(eventName,params)}};function reject(e){var deferred=$q.defer();$log.error(e.message);deferred.reject(e);return deferred.promise}return{_broadcast:broadcast,_$log:$log,_getFilesCache:function getFilesCache(){return filesCache},toggleWatch:function toggleWatch(watch){if(watch){recordDeclarations.push(true)}else{recordDeclarations.pop()}},getModuleConfig:function getModuleConfig(moduleName){if(!angular.isString(moduleName)){throw new Error("You need to give the name of the module to get")}if(!modules[moduleName]){return null}return angular.copy(modules[moduleName])},setModuleConfig:function setModuleConfig(moduleConfig){if(!angular.isObject(moduleConfig)){throw new Error("You need to give the module config object to set")}modules[moduleConfig.name]=moduleConfig;return moduleConfig},getModules:function getModules(){return regModules},isLoaded:function isLoaded(modulesNames){var moduleLoaded=function moduleLoaded(module){var isLoaded=regModules.indexOf(module)>-1;if(!isLoaded){isLoaded=!!moduleExists(module)}return isLoaded};if(angular.isString(modulesNames)){modulesNames=[modulesNames]}if(angular.isArray(modulesNames)){var i,len;for(i=0,len=modulesNames.length;i<len;i++){if(!moduleLoaded(modulesNames[i])){return false}}return true}else{throw new Error("You need to define the module(s) name(s)")}},_getModuleName:getModuleName,_getModule:function getModule(moduleName){try{return ngModuleFct(moduleName)}catch(e){if(/No module/.test(e)||e.message.indexOf("$injector:nomod")>-1){e.message='The module "'+stringify(moduleName)+'" that you are trying to load does not exist. '+e.message}throw e}},moduleExists:moduleExists,_loadDependencies:function _loadDependencies(moduleName,localParams){var loadedModule,requires,diff,promisesList=[],self=this;moduleName=self._getModuleName(moduleName);if(moduleName===null){return $q.when()}else{try{loadedModule=self._getModule(moduleName)}catch(e){return reject(e)}requires=self.getRequires(loadedModule)}angular.forEach(requires,function(requireEntry){if(angular.isString(requireEntry)){var config=self.getModuleConfig(requireEntry);if(config===null){moduleCache.push(requireEntry);return}requireEntry=config;config.name=undefined}if(self.moduleExists(requireEntry.name)){diff=requireEntry.files.filter(function(n){return self.getModuleConfig(requireEntry.name).files.indexOf(n)<0});if(diff.length!==0){self._$log.warn('Module "',moduleName,'" attempted to redefine configuration for dependency. "',requireEntry.name,'"\n Additional Files Loaded:',diff)}if(angular.isDefined(self.filesLoader)){promisesList.push(self.filesLoader(requireEntry,localParams).then(function(){return self._loadDependencies(requireEntry)}))}else{return reject(new Error("Error: New dependencies need to be loaded from external files ("+requireEntry.files+"), but no loader has been defined."))}return}else if(angular.isArray(requireEntry)){var files=[];angular.forEach(requireEntry,function(entry){var config=self.getModuleConfig(entry);if(config===null){files.push(entry)}else if(config.files){files=files.concat(config.files)}});if(files.length>0){requireEntry={files:files}}}else if(angular.isObject(requireEntry)){if(requireEntry.hasOwnProperty("name")&&requireEntry["name"]){self.setModuleConfig(requireEntry);moduleCache.push(requireEntry["name"])}}if(angular.isDefined(requireEntry.files)&&requireEntry.files.length!==0){if(angular.isDefined(self.filesLoader)){promisesList.push(self.filesLoader(requireEntry,localParams).then(function(){return self._loadDependencies(requireEntry)}))}else{return reject(new Error('Error: the module "'+requireEntry.name+'" is defined in external files ('+requireEntry.files+"), but no loader has been defined."))}}});return $q.all(promisesList)},inject:function inject(moduleName){var localParams=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var self=this,deferred=$q.defer();if(angular.isDefined(moduleName)&&moduleName!==null){if(angular.isArray(moduleName)){var promisesList=[];angular.forEach(moduleName,function(module){promisesList.push(self.inject(module))});return $q.all(promisesList)}else{self._addToLoadList(self._getModuleName(moduleName),true)}}if(modulesToLoad.length>0){var res=modulesToLoad.slice();var loadNext=function loadNext(moduleName){moduleCache.push(moduleName);self._loadDependencies(moduleName,localParams).then(function success(){try{justLoaded=[];_register(providers,moduleCache,localParams)}catch(e){self._$log.error(e.message);deferred.reject(e);return}if(modulesToLoad.length>0){loadNext(modulesToLoad.shift())}else{deferred.resolve(res)}},function error(err){deferred.reject(err)})};loadNext(modulesToLoad.shift())}else{deferred.resolve()}return deferred.promise},getRequires:function getRequires(module){var requires=[];angular.forEach(module.requires,function(requireModule){if(regModules.indexOf(requireModule)===-1){requires.push(requireModule)}});return requires},_invokeQueue:_invokeQueue,_registerInvokeList:_registerInvokeList,_register:_register,_addToLoadList:_addToLoadList}}];this._init(angular.element(window.document))}]);var bootstrapFct=angular.bootstrap;angular.bootstrap=function(element,modules,config){angular.forEach(modules.slice(),function(module){_addToLoadList(module,true,true)});return bootstrapFct(element,modules,config)};var _addToLoadList=function _addToLoadList(name,force,real){if((recordDeclarations.length>0||force)&&angular.isString(name)&&modulesToLoad.indexOf(name)===-1){modulesToLoad.push(name);if(real){realModules.push(name)}}};var ngModuleFct=angular.module;angular.module=function(name,requires,configFn){_addToLoadList(name,false,true);return ngModuleFct(name,requires,configFn)};if(typeof module!=="undefined"&&typeof exports!=="undefined"&&module.exports===exports){module.exports="oc.lazyLoad"}})(angular,window);