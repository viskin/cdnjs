(function(root,factory){if(typeof define==="function"&&define.amd){define(["cldr","../globalize","./number","./plural"],factory)}else if(typeof exports==="object"){module.exports=factory(require("cldrjs"),require("globalize"))}else{factory(root.Cldr,root.Globalize)}})(this,function(Cldr,Globalize){var formatMessage=Globalize._formatMessage,runtimeBind=Globalize._runtimeBind,validateParameterPresence=Globalize._validateParameterPresence,validateParameterTypePlainObject=Globalize._validateParameterTypePlainObject,validateParameterTypeNumber=Globalize._validateParameterTypeNumber,validateParameterTypeString=Globalize._validateParameterTypeString;var unitFormat=function(value,numberFormatter,pluralGenerator,unitProperties){var compoundUnitPattern=unitProperties.compoundUnitPattern,dividend,dividendProperties,formattedValue,divisor,divisorProperties,message,pluralValue;unitProperties=unitProperties.unitProperties;formattedValue=numberFormatter(value);pluralValue=pluralGenerator(value);if(unitProperties instanceof Array){dividendProperties=unitProperties[0];divisorProperties=unitProperties[1];dividend=formatMessage(dividendProperties[pluralValue],[value]);divisor=formatMessage(divisorProperties.one,[""]).trim();return formatMessage(compoundUnitPattern,[dividend,divisor])}message=unitProperties[pluralValue];return formatMessage(message,[formattedValue])};var unitFormatterFn=function(numberFormatter,pluralGenerator,unitProperties){return function unitFormatter(value){validateParameterPresence(value,"value");validateParameterTypeNumber(value,"value");return unitFormat(value,numberFormatter,pluralGenerator,unitProperties)}};var unitCategories=["acceleration","angle","area","digital","duration","length","mass","power","pressure","speed","temperature","volume"];function stripPluralGarbage(data){var aux,pluralCount;if(data){aux={};for(pluralCount in data){aux[pluralCount.replace(/unitPattern-count-/,"")]=data[pluralCount]}}return aux}var get=function(unit,form,cldr){var ret;unit=unit.replace(/\//,"-per-");[""].concat(unitCategories).some(function(category){return ret=cldr.main(["units",form,category.length?category+"-"+unit:unit])});ret=stripPluralGarbage(ret);if(!ret&&/-per-/.test(unit)){unit=unit.split("-per-");ret=unit.map(function(unit){return get(unit,form,cldr)});if(!ret[0]||!ret[1]){return}}return ret};var unitGet=get;var unitProperties=function(unit,form,cldr){var compoundUnitPattern,unitProperties;compoundUnitPattern=cldr.main(["units",form,"per/compoundUnitPattern"]);unitProperties=unitGet(unit,form,cldr);return{compoundUnitPattern:compoundUnitPattern,unitProperties:unitProperties}};Globalize.formatUnit=Globalize.prototype.formatUnit=function(value,unit,options){validateParameterPresence(value,"value");validateParameterTypeNumber(value,"value");return this.unitFormatter(unit,options)(value)};Globalize.unitFormatter=Globalize.prototype.unitFormatter=function(unit,options){var args,form,numberFormatter,pluralGenerator,returnFn,properties;validateParameterPresence(unit,"unit");validateParameterTypeString(unit,"unit");validateParameterTypePlainObject(options,"options");options=options||{};args=[unit,options];form=options.form||"long";properties=unitProperties(unit,form,this.cldr);numberFormatter=options.numberFormatter||this.numberFormatter();pluralGenerator=this.pluralGenerator();returnFn=unitFormatterFn(numberFormatter,pluralGenerator,properties);runtimeBind(args,this.cldr,returnFn,[numberFormatter,pluralGenerator,properties]);return returnFn};return Globalize});
