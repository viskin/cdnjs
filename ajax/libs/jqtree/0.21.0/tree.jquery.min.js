(function(){var d,k,r,w,t,v,u,b,f,i,h,x,j,A,c,o,q,n,m,e,l,a,g,z,s=[].slice,p={}.hasOwnProperty,y=function(E,C){for(var B in C){if(p.call(C,B)){E[B]=C[B]}}function D(){this.constructor=E}D.prototype=C.prototype;E.prototype=new D();E.__super__=C.prototype;return E};d=this.jQuery;n=(function(){B.prototype.defaults={};function B(D,C){this.$el=d(D);this.options=d.extend({},this.defaults,C)}B.prototype.destroy=function(){return this._deinit()};B.prototype._init=function(){return null};B.prototype._deinit=function(){return null};B.register=function(I,G){var H,F,C,D,E;D=function(){return"simple_widget_"+G};E=function(K,J){var L;L=d.data(K,J);if(L&&(L instanceof B)){return L}else{return null}};F=function(L,K){var N,M,Q,P,O,J;N=D();for(O=0,J=L.length;O<J;O++){M=L[O];Q=E(M,N);if(!Q){P=new I(M,K);if(!d.data(M,N)){d.data(M,N,P)}P._init()}}return L};C=function(L){var N,M,P,O,K,J;N=D();J=[];for(O=0,K=L.length;O<K;O++){M=L[O];P=E(M,N);if(P){P.destroy()}J.push(d.removeData(M,N))}return J};H=function(Q,N,O){var J,R,M,K,L,P;R=null;for(L=0,P=Q.length;L<P;L++){J=Q[L];M=d.data(J,D());if(M&&(M instanceof B)){K=M[N];if(K&&(typeof K==="function")){R=K.apply(M,O)}}}return R};return d.fn[G]=function(){var L,K,M,N,J;M=arguments[0],K=2<=arguments.length?s.call(arguments,1):[];L=this;if(M===void 0||typeof M==="object"){J=M;return F(L,J)}else{if(typeof M==="string"&&M[0]!=="_"){N=M;if(N==="destroy"){return C(L)}else{return H(L,N,K)}}}}};return B})();this.SimpleWidget=n;h=(function(B){y(C,B);function C(){return C.__super__.constructor.apply(this,arguments)}C.is_mouse_handled=false;C.prototype._init=function(){this.$el.bind("mousedown.mousewidget",d.proxy(this._mouseDown,this));this.$el.bind("touchstart.mousewidget",d.proxy(this._touchStart,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;this._is_mouse_delay_met=true;return this.mouse_down_info=null};C.prototype._deinit=function(){var D;this.$el.unbind("mousedown.mousewidget");this.$el.unbind("touchstart.mousewidget");D=d(document);D.unbind("mousemove.mousewidget");return D.unbind("mouseup.mousewidget")};C.prototype._mouseDown=function(E){var D;if(E.which!==1){return}D=this._handleMouseDown(E,this._getPositionInfo(E));if(D){E.preventDefault()}return D};C.prototype._handleMouseDown=function(E,D){if(C.is_mouse_handled){return}if(this.is_mouse_started){this._handleMouseUp(D)}this.mouse_down_info=D;if(!this._mouseCapture(D)){return}this._handleStartMouse();this.is_mouse_handled=true;return true};C.prototype._handleStartMouse=function(){var D;D=d(document);D.bind("mousemove.mousewidget",d.proxy(this._mouseMove,this));D.bind("touchmove.mousewidget",d.proxy(this._touchMove,this));D.bind("mouseup.mousewidget",d.proxy(this._mouseUp,this));D.bind("touchend.mousewidget",d.proxy(this._touchEnd,this));if(this.mouse_delay){return this._startMouseDelayTimer()}};C.prototype._startMouseDelayTimer=function(){if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout((function(D){return function(){return D._is_mouse_delay_met=true}})(this),this.mouse_delay);return this._is_mouse_delay_met=false};C.prototype._mouseMove=function(D){return this._handleMouseMove(D,this._getPositionInfo(D))};C.prototype._handleMouseMove=function(E,D){if(this.is_mouse_started){this._mouseDrag(D);return E.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==false;if(this.is_mouse_started){this._mouseDrag(D)}else{this._handleMouseUp(D)}return !this.is_mouse_started};C.prototype._getPositionInfo=function(D){return{page_x:D.pageX,page_y:D.pageY,target:D.target,original_event:D}};C.prototype._mouseUp=function(D){return this._handleMouseUp(this._getPositionInfo(D))};C.prototype._handleMouseUp=function(D){var E;E=d(document);E.unbind("mousemove.mousewidget");E.unbind("touchmove.mousewidget");E.unbind("mouseup.mousewidget");E.unbind("touchend.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(D)}};C.prototype._mouseCapture=function(D){return true};C.prototype._mouseStart=function(D){return null};C.prototype._mouseDrag=function(D){return null};C.prototype._mouseStop=function(D){return null};C.prototype.setMouseDelay=function(D){return this.mouse_delay=D};C.prototype._touchStart=function(D){var E;if(D.originalEvent.touches.length>1){return}E=D.originalEvent.changedTouches[0];return this._handleMouseDown(D,this._getPositionInfo(E))};C.prototype._touchMove=function(D){var E;if(D.originalEvent.touches.length>1){return}E=D.originalEvent.changedTouches[0];return this._handleMouseMove(D,this._getPositionInfo(E))};C.prototype._touchEnd=function(D){var E;if(D.originalEvent.touches.length>1){return}E=D.originalEvent.changedTouches[0];return this._handleMouseUp(this._getPositionInfo(E))};return C})(n);this.Tree={};d=this.jQuery;A={getName:function(B){return A.strings[B-1]},nameToIndex:function(B){var C,E,D;for(C=E=1,D=A.strings.length;1<=D?E<=D:E>=D;C=1<=D?++E:--E){if(A.strings[C-1]===B){return C}}return 0}};A.BEFORE=1;A.AFTER=2;A.INSIDE=3;A.NONE=4;A.strings=["before","after","inside","none"];this.Tree.Position=A;x=(function(){function B(D,C,E){if(C==null){C=false}if(E==null){E=B}this.setData(D);this.children=[];this.parent=null;if(C){this.id_mapping={};this.tree=this;this.node_class=E}}B.prototype.setData=function(F){var D,E,C;if(typeof F!=="object"){return this.name=F}else{C=[];for(D in F){E=F[D];if(D==="label"){C.push(this.name=E)}else{C.push(this[D]=E)}}return C}};B.prototype.initFromData=function(D){var C,E;E=(function(F){return function(G){F.setData(G);if(G.children){return C(G.children)}}})(this);C=(function(F){return function(J){var K,H,I,G;for(I=0,G=J.length;I<G;I++){K=J[I];H=new F.tree.node_class("");H.initFromData(K);F.addChild(H)}return null}})(this);E(D);return null};B.prototype.loadFromData=function(F){var D,G,E,C;this.removeChildren();for(E=0,C=F.length;E<C;E++){G=F[E];D=new this.tree.node_class(G);this.addChild(D);if(typeof G==="object"&&G.children){D.loadFromData(G.children)}}return null};B.prototype.addChild=function(C){this.children.push(C);return C._setParent(this)};B.prototype.addChildAtPosition=function(D,C){this.children.splice(C,0,D);return D._setParent(this)};B.prototype._setParent=function(C){this.parent=C;this.tree=C.tree;return this.tree.addNodeToIndex(this)};B.prototype.removeChild=function(C){C.removeChildren();return this._removeChild(C)};B.prototype._removeChild=function(C){this.children.splice(this.getChildIndex(C),1);return this.tree.removeNodeFromIndex(C)};B.prototype.getChildIndex=function(C){return d.inArray(C,this.children)};B.prototype.hasChildren=function(){return this.children.length!==0};B.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};B.prototype.iterate=function(D){var C;C=(function(E){return function(H,L){var K,F,J,G,I;if(H.children){I=H.children;for(J=0,G=I.length;J<G;J++){K=I[J];F=D(K,L);if(E.hasChildren()&&F){C(K,L+1)}}return null}}})(this);C(this,0);return null};B.prototype.moveNode=function(D,E,C){if(D.isParentOf(E)){return}D.parent._removeChild(D);if(C===A.AFTER){return E.parent.addChildAtPosition(D,E.parent.getChildIndex(E)+1)}else{if(C===A.BEFORE){return E.parent.addChildAtPosition(D,E.parent.getChildIndex(E))}else{if(C===A.INSIDE){return E.addChildAtPosition(D,0)}}}};B.prototype.getData=function(){var C;C=(function(D){return function(H){var L,G,J,I,F,K,E;L=[];for(K=0,E=H.length;K<E;K++){J=H[K];I={};for(G in J){F=J[G];if((G!=="parent"&&G!=="children"&&G!=="element"&&G!=="tree")&&Object.prototype.hasOwnProperty.call(J,G)){I[G]=F}}if(J.hasChildren()){I.children=C(J.children)}L.push(I)}return L}})(this);return C(this.children)};B.prototype.getNodeByName=function(D){var C;C=null;this.iterate(function(E){if(E.name===D){C=E;return false}else{return true}});return C};B.prototype.addAfter=function(D){var E,C;if(!this.parent){return null}else{C=new this.tree.node_class(D);E=this.parent.getChildIndex(this);this.parent.addChildAtPosition(C,E+1);return C}};B.prototype.addBefore=function(D){var E,C;if(!this.parent){return null}else{C=new this.tree.node_class(D);E=this.parent.getChildIndex(this);this.parent.addChildAtPosition(C,E);return C}};B.prototype.addParent=function(G){var I,H,F,E,C,D;if(!this.parent){return null}else{H=new this.tree.node_class(G);H._setParent(this.tree);F=this.parent;D=F.children;for(E=0,C=D.length;E<C;E++){I=D[E];H.addChild(I)}F.children=[];F.addChild(H);return H}};B.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};B.prototype.append=function(D){var C;C=new this.tree.node_class(D);this.addChild(C);return C};B.prototype.prepend=function(D){var C;C=new this.tree.node_class(D);this.addChildAtPosition(C,0);return C};B.prototype.isParentOf=function(D){var C;C=D.parent;while(C){if(C===this){return true}C=C.parent}return false};B.prototype.getLevel=function(){var D,C;D=0;C=this;while(C.parent){D+=1;C=C.parent}return D};B.prototype.getNodeById=function(C){return this.id_mapping[C]};B.prototype.addNodeToIndex=function(C){if(C.id!=null){return this.id_mapping[C.id]=C}};B.prototype.removeNodeFromIndex=function(C){if(C.id!=null){return delete this.id_mapping[C.id]}};B.prototype.removeChildren=function(){this.iterate((function(C){return function(D){C.tree.removeNodeFromIndex(D);return true}})(this));return this.children=[]};B.prototype.getPreviousSibling=function(){var C;if(!this.parent){return null}else{C=this.parent.getChildIndex(this)-1;if(C>=0){return this.parent.children[C]}else{return null}}};B.prototype.getNextSibling=function(){var C;if(!this.parent){return null}else{C=this.parent.getChildIndex(this)+1;if(C<this.parent.children.length){return this.parent.children[C]}else{return null}}};B.prototype.getNodesByProperty=function(C,D){return this.filter(function(E){return E[C]===D})};B.prototype.filter=function(D){var C;C=[];this.iterate(function(E){if(D(E)){C.push(E)}return true});return C};return B})();this.Tree.Node=x;t=(function(){function B(C){this.tree_widget=C;this.opened_icon_element=this.createButtonElement(C.options.openedIcon);this.closed_icon_element=this.createButtonElement(C.options.closedIcon)}B.prototype.render=function(C){if(C&&C.parent){return this.renderFromNode(C)}else{return this.renderFromRoot()}};B.prototype.renderNode=function(F){var C,D,E;d(F.element).remove();D=new j(F.parent,this.tree_widget);C=this.createLi(F);this.attachNodeData(F,C);E=F.getPreviousSibling();if(E){d(E.element).after(C)}else{D.getUl().prepend(C)}if(F.children){return this.renderFromNode(F)}};B.prototype.renderFromRoot=function(){var C;C=this.tree_widget.element;C.empty();return this.createDomElements(C[0],this.tree_widget.tree.children,true,true)};B.prototype.renderFromNode=function(C){var D;D=this.tree_widget._getNodeElementForNode(C);D.getUl().remove();return this.createDomElements(D.$element[0],C.children,false,false)};B.prototype.createDomElements=function(G,D,K,E){var C,J,H,F,I;H=this.createUl(K);G.appendChild(H);for(F=0,I=D.length;F<I;F++){C=D[F];J=this.createLi(C);H.appendChild(J);this.attachNodeData(C,J);if(C.hasChildren()){this.createDomElements(J,C.children,false,C.is_open)}}return null};B.prototype.attachNodeData=function(D,C){D.element=C;return d(C).data("node",D)};B.prototype.createUl=function(E){var D,C;if(E){D="jqtree-tree"}else{D=""}C=document.createElement("ul");C.className="jqtree_common "+D;return C};B.prototype.createLi=function(D){var C;if(D.isFolder()){C=this.createFolderLi(D)}else{C=this.createNodeLi(D)}if(this.tree_widget.options.onCreateLi){this.tree_widget.options.onCreateLi(D,d(C))}return C};B.prototype.createFolderLi=function(G){var E,H,D,F,C,J,K,I;E=this.getButtonClasses(G);C=this.getFolderClasses(G);F=this.escapeIfNecessary(G.name);if(G.is_open){J=this.opened_icon_element}else{J=this.closed_icon_element}K=document.createElement("li");K.className="jqtree_common "+C;D=document.createElement("div");D.className="jqtree-element jqtree_common";K.appendChild(D);H=document.createElement("a");H.className="jqtree_common "+E;H.appendChild(J.cloneNode());D.appendChild(H);I=document.createElement("span");I.className="jqtree_common jqtree-title jqtree-title-folder";D.appendChild(I);I.innerHTML=F;return K};B.prototype.createNodeLi=function(F){var H,I,E,C,G,D;G=["jqtree_common"];if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(F)){G.push("jqtree-selected")}H=G.join(" ");E=this.escapeIfNecessary(F.name);C=document.createElement("li");C.className=H;I=document.createElement("div");I.className="jqtree-element jqtree_common";C.appendChild(I);D=document.createElement("span");D.className="jqtree-title jqtree_common";D.innerHTML=E;I.appendChild(D);return C};B.prototype.getButtonClasses=function(D){var C;C=["jqtree-toggler"];if(!D.is_open){C.push("jqtree-closed")}return C.join(" ")};B.prototype.getFolderClasses=function(D){var C;C=["jqtree-folder"];if(!D.is_open){C.push("jqtree-closed")}if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(D)){C.push("jqtree-selected")}return C.join(" ")};B.prototype.escapeIfNecessary=function(C){if(this.tree_widget.options.autoEscape){return l(C)}else{return C}};B.prototype.createButtonElement=function(C){var D;if(typeof C==="string"){D=document.createElement("div");D.innerHTML=C;return document.createTextNode(D.innerHTML)}else{return d(C)[0]}};return B})();f=(function(C){y(B,C);function B(){return B.__super__.constructor.apply(this,arguments)}B.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:x,dataFilter:null,keyboardSupport:true,openFolderDelay:500};B.prototype.toggle=function(E,D){if(D==null){D=true}if(E.is_open){return this.closeNode(E,D)}else{return this.openNode(E,D)}};B.prototype.getTree=function(){return this.tree};B.prototype.selectNode=function(D){return this._selectNode(D,false)};B.prototype._selectNode=function(F,D){var H,G,I,E;if(D==null){D=false}if(!this.select_node_handler){return}H=(function(J){return function(){if(J.options.onCanSelectNode){return J.options.selectable&&J.options.onCanSelectNode(F)}else{return J.options.selectable}}})(this);I=(function(J){return function(){var K;K=F.parent;if(K&&K.parent&&!K.is_open){return J.openNode(K,false)}}})(this);E=(function(J){return function(){if(J.options.saveState){return J.save_state_handler.saveState()}}})(this);if(!F){this._deselectCurrentNode();E();return}if(!H()){return}if(this.select_node_handler.isNodeSelected(F)){if(D){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null,previous_node:F})}}else{G=this.getSelectedNode();this._deselectCurrentNode();this.addToSelection(F);this._triggerEvent("tree.select",{node:F,deselected_node:G});I()}return E()};B.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};B.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};B.prototype.loadData=function(D,E){return this._loadData(D,E)};B.prototype.loadDataFromUrl=function(D,F,E){if(d.type(D)!=="string"){E=F;F=D;D=null}return this._loadDataFromUrl(D,F,E)};B.prototype.reload=function(){return this.loadDataFromUrl()};B.prototype._loadDataFromUrl=function(I,J,F){var K,H,E,L,G,D;K=null;H=(function(M){return function(){var N;if(!J){K=M.element}else{N=new v(J,M);K=N.getLi()}return K.addClass("jqtree-loading")}})(this);D=(function(M){return function(){if(K){return K.removeClass("jqtree-loading")}}})(this);G=(function(M){return function(){if(d.type(I)==="string"){I={url:I}}if(!I.method){return I.method="get"}}})(this);E=(function(M){return function(N){D();M._loadData(N,J);if(F&&d.isFunction(F)){return F()}}})(this);L=(function(M){return function(){G();return d.ajax({url:I.url,data:I.data,type:I.method.toUpperCase(),cache:false,dataType:"json",success:function(N){var O;if(d.isArray(N)||typeof N==="object"){O=N}else{O=d.parseJSON(N)}if(M.options.dataFilter){O=M.options.dataFilter(O)}return E(O)},error:function(N){D();if(M.options.onLoadFailed){return M.options.onLoadFailed(N)}}})}})(this);if(!I){I=this._getDataUrlInfo(J)}H();if(I===false||I===null){D()}else{if(d.isArray(I)){E(I)}else{return L()}}};B.prototype._loadData=function(G,H){var I,E,F,D;if(!G){return}this._triggerEvent("tree.load_data",{tree_data:G});if(!H){this._initTree(G)}else{E=this.select_node_handler.getSelectedNodesUnder(H);for(F=0,D=E.length;F<D;F++){I=E[F];this.select_node_handler.removeFromSelection(I)}H.loadFromData(G);H.load_on_demand=false;this._refreshElements(H.parent)}if(this.isDragging()){return this.dnd_handler.refresh()}};B.prototype.getNodeById=function(D){return this.tree.getNodeById(D)};B.prototype.getNodeByName=function(D){return this.tree.getNodeByName(D)};B.prototype.openNode=function(E,D){if(D==null){D=true}return this._openNode(E,D)};B.prototype._openNode=function(F,D,G){var H,E;if(D==null){D=true}H=(function(I){return function(K,L,J){var M;M=new v(K,I);return M.open(J,L)}})(this);if(F.isFolder()){if(F.load_on_demand){return this._loadFolderOnDemand(F,D,G)}else{E=F.parent;while(E&&!E.is_open){if(E.parent){H(E,false,null)}E=E.parent}H(F,D,G);return this._saveState()}}};B.prototype._loadFolderOnDemand=function(E,D,F){if(D==null){D=true}return this._loadDataFromUrl(null,E,(function(G){return function(){return G._openNode(E,D,F)}})(this))};B.prototype.closeNode=function(E,D){if(D==null){D=true}if(E.isFolder()){new v(E,this).close(D);return this._saveState()}};B.prototype.isDragging=function(){if(this.dnd_handler){return this.dnd_handler.is_dragging}else{return false}};B.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh()};B.prototype.addNodeAfter=function(E,D){var F;F=D.addAfter(E);this._refreshElements(D.parent);return F};B.prototype.addNodeBefore=function(E,D){var F;F=D.addBefore(E);this._refreshElements(D.parent);return F};B.prototype.addParentNode=function(E,D){var F;F=D.addParent(E);this._refreshElements(F.parent);return F};B.prototype.removeNode=function(E){var D;D=E.parent;if(D){this.select_node_handler.removeFromSelection(E,true);E.remove();return this._refreshElements(D.parent)}};B.prototype.appendNode=function(F,G){var D,E;if(!G){G=this.tree}D=G.isFolder();E=G.append(F);if(D){this._refreshElements(G)}else{this._refreshElements(G.parent)}return E};B.prototype.prependNode=function(E,F){var D;if(!F){F=this.tree}D=F.prepend(E);this._refreshElements(F);return D};B.prototype.updateNode=function(D,F){var E;E=F.id&&F.id!==D.id;if(E){this.tree.removeNodeFromIndex(D)}D.setData(F);if(E){this.tree.addNodeToIndex(D)}this.renderer.renderNode(D);return this._selectCurrentNode()};B.prototype.moveNode=function(F,G,D){var E;E=A.nameToIndex(D);this.tree.moveNode(F,G,E);return this._refreshElements()};B.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};B.prototype.addToSelection=function(D){if(D){this.select_node_handler.addToSelection(D);this._getNodeElementForNode(D).select();return this._saveState()}};B.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};B.prototype.isNodeSelected=function(D){return this.select_node_handler.isNodeSelected(D)};B.prototype.removeFromSelection=function(D){this.select_node_handler.removeFromSelection(D);this._getNodeElementForNode(D).deselect();return this._saveState()};B.prototype.scrollToNode=function(E){var D,F;D=d(E.element);F=D.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(F)};B.prototype.getState=function(){return this.save_state_handler.getState()};B.prototype.setState=function(D){this.save_state_handler.setState(D);return this._refreshElements()};B.prototype.setOption=function(D,E){return this.options[D]=E};B.prototype._init=function(){B.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.is_initialized=false;this.renderer=new t(this);if(typeof c!=="undefined"&&c!==null){this.save_state_handler=new c(this)}else{this.options.saveState=false}if(typeof q!=="undefined"&&q!==null){this.select_node_handler=new q(this)}if(typeof r!=="undefined"&&r!==null){this.dnd_handler=new r(this)}else{this.options.dragAndDrop=false}if(typeof o!=="undefined"&&o!==null){this.scroll_handler=new o(this)}if((typeof i!=="undefined"&&i!==null)&&(typeof q!=="undefined"&&q!==null)){this.key_handler=new i(this)}this._initData();this.element.click(d.proxy(this._click,this));this.element.dblclick(d.proxy(this._dblclick,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",d.proxy(this._contextmenu,this))}};B.prototype._deinit=function(){this.element.empty();this.element.unbind();this.key_handler.deinit();this.tree=null;return B.__super__._deinit.call(this)};B.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};B.prototype._getDataUrlInfo=function(E){var D,F;D=this.options.dataUrl||this.element.data("url");F=(function(G){return function(){var J,I,H;H={url:D};if(E&&E.id){J={node:E.id};H.data=J}else{I=G._getNodeIdToBeSelected();if(I){J={selected_node:I};H.data=J}}return H}})(this);if(d.isFunction(D)){return D(E)}else{if(d.type(D)==="string"){return F()}else{return D}}};B.prototype._getNodeIdToBeSelected=function(){if(this.options.saveState){return this.save_state_handler.getNodeIdToBeSelected()}else{return null}};B.prototype._initTree=function(D){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);if(this.select_node_handler){this.select_node_handler.clear()}this.tree.loadFromData(D);this._openNodes();this._refreshElements();if(!this.is_initialized){this.is_initialized=true;return this._triggerEvent("tree.init")}};B.prototype._openNodes=function(){var D;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){D=-1}else{D=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(E,F){if(E.hasChildren()){E.is_open=true}return F!==D})};B.prototype._refreshElements=function(D){if(D==null){D=null}this.renderer.render(D);return this._triggerEvent("tree.refresh")};B.prototype._click=function(F){var G,E,D;G=this._getClickTarget(F.target);if(G){if(G.type==="button"){this.toggle(G.node,this.options.slide);F.preventDefault();return F.stopPropagation()}else{if(G.type==="label"){D=G.node;E=this._triggerEvent("tree.click",{node:D,click_event:F});if(!E.isDefaultPrevented()){return this._selectNode(D,true)}}}}};B.prototype._dblclick=function(D){var E;E=this._getClickTarget(D.target);if(E&&E.type==="label"){return this._triggerEvent("tree.dblclick",{node:E.node,click_event:D})}};B.prototype._getClickTarget=function(F){var H,E,D,G;D=d(F);H=D.closest(".jqtree-toggler");if(H.length){G=this._getNode(H);if(G){return{type:"button",node:G}}}else{E=D.closest(".jqtree-element");if(E.length){G=this._getNode(E);if(G){return{type:"label",node:G}}}}return null};B.prototype._getNode=function(D){var E;E=D.closest("li.jqtree_common");if(E.length===0){return null}else{return E.data("node")}};B.prototype._getNodeElementForNode=function(D){if(D.isFolder()){return new v(D,this)}else{return new j(D,this)}};B.prototype._getNodeElement=function(D){var E;E=this._getNode(D);if(E){return this._getNodeElementForNode(E)}else{return null}};B.prototype._contextmenu=function(F){var D,E;D=d(F.target).closest("ul.jqtree-tree .jqtree-element");if(D.length){E=this._getNode(D);if(E){F.preventDefault();F.stopPropagation();this._triggerEvent("tree.contextmenu",{node:E,click_event:F});return false}}};B.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};B.prototype._mouseCapture=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(D)}else{return false}};B.prototype._mouseStart=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(D)}else{return false}};B.prototype._mouseDrag=function(E){var D;if(this.options.dragAndDrop){D=this.dnd_handler.mouseDrag(E);if(this.scroll_handler){this.scroll_handler.checkScrolling()}return D}else{return false}};B.prototype._mouseStop=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(D)}else{return false}};B.prototype._triggerEvent=function(F,D){var E;E=d.Event(F);d.extend(E,D);this.element.trigger(E);return E};B.prototype.testGenerateHitAreas=function(D){this.dnd_handler.current_item=this._getNodeElementForNode(D);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};B.prototype._selectCurrentNode=function(){var D,E;D=this.getSelectedNode();if(D){E=this._getNodeElementForNode(D);if(E){return E.select()}}};B.prototype._deselectCurrentNode=function(){var D;D=this.getSelectedNode();if(D){return this.removeFromSelection(D)}};return B})(h);n.register(f,"tree");j=(function(){function B(C,D){this.init(C,D)}B.prototype.init=function(C,D){this.node=C;this.tree_widget=D;if(!C.element){C.element=this.tree_widget.element}return this.$element=d(C.element)};B.prototype.getUl=function(){return this.$element.children("ul:first")};B.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};B.prototype.getLi=function(){return this.$element};B.prototype.addDropHint=function(C){if(C===A.INSIDE){return new k(this.$element)}else{return new u(this.node,this.$element,C)}};B.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};B.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return B})();v=(function(C){y(B,C);function B(){return B.__super__.constructor.apply(this,arguments)}B.prototype.open=function(G,D){var F,E;if(D==null){D=true}if(!this.node.is_open){this.node.is_open=true;F=this.getButton();F.removeClass("jqtree-closed");F.html("");F.append(this.tree_widget.renderer.opened_icon_element.cloneNode());E=(function(H){return function(){H.getLi().removeClass("jqtree-closed");if(G){G()}return H.tree_widget._triggerEvent("tree.open",{node:H.node})}})(this);if(D){return this.getUl().slideDown("fast",E)}else{this.getUl().show();return E()}}};B.prototype.close=function(D){var F,E;if(D==null){D=true}if(this.node.is_open){this.node.is_open=false;F=this.getButton();F.addClass("jqtree-closed");F.html("");F.append(this.tree_widget.renderer.closed_icon_element.cloneNode());E=(function(G){return function(){G.getLi().addClass("jqtree-closed");return G.tree_widget._triggerEvent("tree.close",{node:G.node})}})(this);if(D){return this.getUl().slideUp("fast",E)}else{this.getUl().hide();return E()}}};B.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};B.prototype.addDropHint=function(D){if(!this.node.is_open&&D===A.INSIDE){return new k(this.$element)}else{return new u(this.node,this.$element,D)}};return B})(j);l=function(B){return(""+B).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};z=function(G,D){var C,F,E,B;for(C=E=0,B=G.length;E<B;C=++E){F=G[C];if(F===D){return C}}return -1};a=function(C,B){if(C.indexOf){return C.indexOf(B)}else{return z(C,B)}};this.Tree.indexOf=a;this.Tree._indexOf=z;g=function(B){return typeof B==="number"&&B%1===0};e=function(){var C,D,F,B,E;C=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;D={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};F=function(G){C.lastIndex=0;if(C.test(G)){return'"'+G.replace(C,function(H){var I;I=D[H];return(typeof I==="string"?I:"\\u"+("0000"+H.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+G+'"'}};B=function(N,K){var I,G,J,O,M,H,L;M=K[N];switch(typeof M){case"string":return F(M);case"number":if(isFinite(M)){return String(M)}else{return"null"}case"boolean":case"null":return String(M);case"object":if(!M){return"null"}J=[];if(Object.prototype.toString.apply(M)==="[object Array]"){for(I=H=0,L=M.length;H<L;I=++H){O=M[I];J[I]=B(I,M)||"null"}return(J.length===0?"[]":"["+J.join(",")+"]")}for(G in M){if(Object.prototype.hasOwnProperty.call(M,G)){O=B(G,M);if(O){J.push(F(G)+":"+O)}}}return(J.length===0?"{}":"{"+J.join(",")+"}")}};E=function(G){return B("",{"":G})};return E};this.Tree.get_json_stringify_function=e;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){if(this.JSON==null){this.JSON={}}this.JSON.stringify=e()}c=(function(){function B(C){this.tree_widget=C}B.prototype.saveState=function(){var C;C=JSON.stringify(this.getState());if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(C)}else{if(this.supportsLocalStorage()){return localStorage.setItem(this.getCookieName(),C)}else{if(d.cookie){d.cookie.raw=true;return d.cookie(this.getCookieName(),C,{path:"/"})}}}};B.prototype.restoreState=function(){var C;C=this.getStateFromStorage();if(C){this.setState(d.parseJSON(C));return true}else{return false}};B.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(this.supportsLocalStorage()){return localStorage.getItem(this.getCookieName())}else{if(d.cookie){d.cookie.raw=true;return d.cookie(this.getCookieName())}else{return null}}}};B.prototype.getState=function(){var D,C;D=(function(E){return function(){var F;F=[];E.tree_widget.tree.iterate(function(G){if(G.is_open&&G.id&&G.hasChildren()){F.push(G.id)}return true});return F}})(this);C=(function(E){return function(){var F;return(function(){var J,H,I,G;I=this.tree_widget.getSelectedNodes();G=[];for(J=0,H=I.length;J<H;J++){F=I[J];G.push(F.id)}return G}).call(E)}})(this);return{open_nodes:D(),selected_node:C()}};B.prototype.setState=function(I){var H,J,F,E,G,D,C;if(I){J=I.open_nodes;E=I.selected_node;if(g(E)){E=[E]}this.tree_widget.tree.iterate((function(K){return function(L){L.is_open=L.id&&L.hasChildren()&&(a(J,L.id)>=0);return true}})(this));if(E&&this.tree_widget.select_node_handler){this.tree_widget.select_node_handler.clear();C=[];for(G=0,D=E.length;G<D;G++){H=E[G];F=this.tree_widget.getNodeById(H);if(F){C.push(this.tree_widget.select_node_handler.addToSelection(F))}else{C.push(void 0)}}return C}}};B.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};B.prototype.supportsLocalStorage=function(){var C;C=function(){var D,E;if(typeof localStorage==="undefined"||localStorage===null){return false}else{try{E="_storage_test";sessionStorage.setItem(E,true);sessionStorage.removeItem(E)}catch(F){D=F;return false}return true}};if(this._supportsLocalStorage==null){this._supportsLocalStorage=C()}return this._supportsLocalStorage};B.prototype.getNodeIdToBeSelected=function(){var C,D;D=this.getStateFromStorage();if(D){C=d.parseJSON(D);return C.selected_node}else{return null}};return B})();q=(function(){function B(C){this.tree_widget=C;this.clear()}B.prototype.getSelectedNode=function(){var C;C=this.getSelectedNodes();if(C.length){return C[0]}else{return false}};B.prototype.getSelectedNodes=function(){var E,D,C;if(this.selected_single_node){return[this.selected_single_node]}else{C=[];for(E in this.selected_nodes){D=this.tree_widget.getNodeById(E);if(D){C.push(D)}}return C}};B.prototype.getSelectedNodesUnder=function(D){var F,E,C;if(this.selected_single_node){if(D.isParentOf(this.selected_single_node)){return[this.selected_single_node]}else{return[]}}else{C=[];for(F in this.selected_nodes){E=this.tree_widget.getNodeById(F);if(E&&D.isParentOf(E)){C.push(E)}}return C}};B.prototype.isNodeSelected=function(C){if(C.id){return this.selected_nodes[C.id]}else{if(this.selected_single_node){return this.selected_single_node.element===C.element}else{return false}}};B.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};B.prototype.removeFromSelection=function(C,D){if(D==null){D=false}if(!C.id){if(this.selected_single_node&&C.element===this.selected_single_node.element){return this.selected_single_node=null}}else{delete this.selected_nodes[C.id];if(D){return C.iterate((function(E){return function(F){delete E.selected_nodes[C.id];return true}})(this))}}};B.prototype.addToSelection=function(C){if(C.id){return this.selected_nodes[C.id]=true}else{return this.selected_single_node=C}};return B})();r=(function(){function B(C){this.tree_widget=C;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false;this.current_item=null}B.prototype.mouseCapture=function(D){var C,E;C=d(D.target);if(!this.mustCaptureElement(C)){return null}if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(C)){return null}E=this.tree_widget._getNodeElement(C);if(E&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(E.node)){E=null}}this.current_item=E;return this.current_item!==null};B.prototype.mouseStart=function(C){var D;this.refresh();D=d(C.target).offset();this.drag_element=new w(this.current_item.node,C.page_x-D.left,C.page_y-D.top,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};B.prototype.mouseDrag=function(C){var E,D;this.drag_element.move(C.page_x,C.page_y);E=this.findHoveredArea(C.page_x,C.page_y);D=this.canMoveToArea(E);if(D&&E){if(this.hovered_area!==E){this.hovered_area=E;if(this.mustOpenFolderTimer(E)){this.startOpenFolderTimer(E.node)}this.updateDropHint()}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};B.prototype.mustCaptureElement=function(C){return !C.is("input,select")};B.prototype.canMoveToArea=function(C){var D;if(!C){return false}else{if(this.tree_widget.options.onCanMoveTo){D=A.getName(C.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,C.node,D)}else{return true}}};B.prototype.mouseStop=function(C){this.moveItem(C);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();if(this.current_item){this.current_item.$element.removeClass("jqtree-moving");this.current_item=null}this.is_dragging=false;return false};B.prototype.refresh=function(){this.removeHitAreas();this.generateHitAreas();if(this.current_item){this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node);if(this.is_dragging){return this.current_item.$element.addClass("jqtree-moving")}}};B.prototype.removeHitAreas=function(){return this.hit_areas=[]};B.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};B.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};B.prototype.removeHover=function(){return this.hovered_area=null};B.prototype.generateHitAreas=function(){var C;C=new b(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom);return this.hit_areas=C.generate()};B.prototype.findHoveredArea=function(D,I){var G,F,H,C,E;F=this.getTreeDimensions();if(D<F.left||I<F.top||D>F.right||I>F.bottom){return null}C=0;H=this.hit_areas.length;while(C<H){E=(C+H)>>1;G=this.hit_areas[E];if(I<G.top){H=E}else{if(I>G.bottom){C=E+1}else{return G}}}return null};B.prototype.mustOpenFolderTimer=function(D){var C;C=D.node;return C.isFolder()&&!C.is_open&&D.position===A.INSIDE};B.prototype.updateDropHint=function(){var C;if(!this.hovered_area){return}this.removeDropHint();C=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=C.addDropHint(this.hovered_area.position)};B.prototype.startOpenFolderTimer=function(D){var C;C=(function(E){return function(){return E.tree_widget._openNode(D,E.tree_widget.options.slide,function(){E.refresh();return E.updateDropHint()})}})(this);this.stopOpenFolderTimer();return this.open_folder_timer=setTimeout(C,this.tree_widget.options.openFolderDelay)};B.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};B.prototype.moveItem=function(E){var F,H,G,C,D,I;if(this.hovered_area&&this.hovered_area.position!==A.NONE&&this.canMoveToArea(this.hovered_area)){G=this.current_item.node;I=this.hovered_area.node;C=this.hovered_area.position;D=G.parent;if(C===A.INSIDE){this.hovered_area.node.is_open=true}F=(function(J){return function(){J.tree_widget.tree.moveNode(G,I,C);J.tree_widget.element.empty();return J.tree_widget._refreshElements()}})(this);H=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:G,target_node:I,position:A.getName(C),previous_parent:D,do_move:F,original_event:E.original_event}});if(!H.isDefaultPrevented()){return F()}}};B.prototype.getTreeDimensions=function(){var C;C=this.tree_widget.element.offset();return{left:C.left,top:C.top,right:C.left+this.tree_widget.element.width(),bottom:C.top+this.tree_widget.element.height()+16}};return B})();m=(function(){function B(C){this.tree=C}B.prototype.iterate=function(){var C,D;C=true;D=(function(E){return function(H,F){var O,G,N,K,L,I,M,J;L=(H.is_open||!H.element)&&H.hasChildren();if(H.element){O=d(H.element);if(!O.is(":visible")){return}if(C){E.handleFirstNode(H,O);C=false}if(!H.hasChildren()){E.handleNode(H,F,O)}else{if(H.is_open){if(!E.handleOpenFolder(H,O)){L=false}}else{E.handleClosedFolder(H,F,O)}}}if(L){N=H.children.length;J=H.children;for(K=I=0,M=J.length;I<M;K=++I){G=J[K];if(K===(N-1)){D(H.children[K],null)}else{D(H.children[K],H.children[K+1])}}if(H.is_open){return E.handleAfterOpenFolder(H,F,O)}}}})(this);return D(this.tree,null)};B.prototype.handleNode=function(E,D,C){};B.prototype.handleOpenFolder=function(D,C){};B.prototype.handleClosedFolder=function(E,D,C){};B.prototype.handleAfterOpenFolder=function(E,D,C){};B.prototype.handleFirstNode=function(D,C){};return B})();b=(function(B){y(C,B);function C(D,F,E){C.__super__.constructor.call(this,D);this.current_node=F;this.tree_bottom=E}C.prototype.generate=function(){this.positions=[];this.last_top=0;this.iterate();return this.generateHitAreas(this.positions)};C.prototype.getTop=function(D){return D.offset().top};C.prototype.addPosition=function(F,D,G){var E;E={top:G,node:F,position:D};this.positions.push(E);return this.last_top=G};C.prototype.handleNode=function(F,E,D){var G;G=this.getTop(D);if(F===this.current_node){this.addPosition(F,A.NONE,G)}else{this.addPosition(F,A.INSIDE,G)}if(E===this.current_node||F===this.current_node){return this.addPosition(F,A.NONE,G)}else{return this.addPosition(F,A.AFTER,G)}};C.prototype.handleOpenFolder=function(E,D){if(E===this.current_node){return false}if(E.children[0]!==this.current_node){this.addPosition(E,A.INSIDE,this.getTop(D))}return true};C.prototype.handleClosedFolder=function(F,E,D){var G;G=this.getTop(D);if(F===this.current_node){return this.addPosition(F,A.NONE,G)}else{this.addPosition(F,A.INSIDE,G);if(E!==this.current_node){return this.addPosition(F,A.AFTER,G)}}};C.prototype.handleFirstNode=function(E,D){if(E!==this.current_node){return this.addPosition(E,A.BEFORE,this.getTop(d(E.element)))}};C.prototype.handleAfterOpenFolder=function(F,E,D){if(F===this.current_node.node||E===this.current_node.node){return this.addPosition(F,A.NONE,this.last_top)}else{return this.addPosition(F,A.AFTER,this.last_top)}};C.prototype.generateHitAreas=function(F){var J,G,D,I,H,E;I=-1;J=[];G=[];for(H=0,E=F.length;H<E;H++){D=F[H];if(D.top!==I&&J.length){if(J.length){this.generateHitAreasForGroup(G,J,I,D.top)}I=D.top;J=[]}J.push(D)}this.generateHitAreasForGroup(G,J,I,this.tree_bottom);return G};C.prototype.generateHitAreasForGroup=function(F,G,J,D){var E,L,H,I,K;K=Math.min(G.length,4);E=Math.round((D-J)/K);L=J;H=0;while(H<K){I=G[H];F.push({top:L,bottom:L+E,node:I.node,position:I.position});L+=E;H+=1}return null};return C})(m);w=(function(){function B(E,D,C,F){this.offset_x=D;this.offset_y=C;this.$element=d('<span class="jqtree-title jqtree-dragging">'+E.name+"</span>");this.$element.css("position","absolute");F.append(this.$element)}B.prototype.move=function(D,C){return this.$element.offset({left:D-this.offset_x,top:C-this.offset_y})};B.prototype.remove=function(){return this.$element.remove()};return B})();u=(function(){function B(E,D,C){this.$element=D;this.node=E;this.$ghost=d('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(C===A.AFTER){this.moveAfter()}else{if(C===A.BEFORE){this.moveBefore()}else{if(C===A.INSIDE){if(E.isFolder()&&E.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}B.prototype.remove=function(){return this.$ghost.remove()};B.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};B.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};B.prototype.moveInsideOpenFolder=function(){return d(this.node.children[0].element).before(this.$ghost)};B.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return B})();k=(function(){function B(D){var C,E;C=D.children(".jqtree-element");E=D.width()-4;this.$hint=d('<span class="jqtree-border"></span>');C.append(this.$hint);this.$hint.css({width:E,height:C.height()-4})}B.prototype.remove=function(){return this.$hint.remove()};return B})();o=(function(){function B(C){this.tree_widget=C;this.previous_top=-1;this._initScrollParent()}B.prototype._initScrollParent=function(){var C,D,E;D=(function(F){return function(){var L,I,H,K,G,J;L=["overflow","overflow-y"];H=function(N){var O,Q,M,P;for(Q=0,M=L.length;Q<M;Q++){O=L[Q];if((P=d.css(N,O))==="auto"||P==="scroll"){return true}}return false};if(H(F.tree_widget.$el[0])){return F.tree_widget.$el}J=F.tree_widget.$el.parents();for(K=0,G=J.length;K<G;K++){I=J[K];if(H(I)){return d(I)}}return null}})(this);E=(function(F){return function(){F.scroll_parent_top=0;return F.$scroll_parent=null}})(this);if(this.tree_widget.$el.css("position")==="fixed"){E()}C=D();if(C&&C.length&&C[0].tagName!=="HTML"){this.$scroll_parent=C;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return E()}};B.prototype.checkScrolling=function(){var C;C=this.tree_widget.dnd_handler.hovered_area;if(C&&C.top!==this.previous_top){this.previous_top=C.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(C)}else{return this._handleScrollingWithDocument(C)}}};B.prototype._handleScrollingWithScrollParent=function(D){var C;C=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-D.bottom;if(C<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((D.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};B.prototype._handleScrollingWithDocument=function(D){var C;C=D.top-d(document).scrollTop();if(C<20){return d(document).scrollTop(d(document).scrollTop()-20)}else{if(d(window).height()-(D.bottom-d(document).scrollTop())<20){return d(document).scrollTop(d(document).scrollTop()+20)}}};B.prototype.scrollTo=function(D){var C;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=D}else{C=this.tree_widget.$el.offset().top;return d(document).scrollTop(D+C)}};B.prototype.isScrolledIntoView=function(D){var C,H,G,F,E;C=d(D);if(this.$scroll_parent){E=0;F=this.$scroll_parent.height();G=C.offset().top-this.scroll_parent_top;H=G+C.height()}else{E=d(window).scrollTop();F=E+d(window).height();G=C.offset().top;H=G+C.height()}return(H<=F)&&(G>=E)};return B})();i=(function(){var F,C,E,B;C=37;B=38;E=39;F=40;function D(G){this.tree_widget=G;if(G.options.keyboardSupport){d(document).bind("keydown.jqtree",d.proxy(this.handleKeyDown,this))}}D.prototype.deinit=function(){return d(document).unbind("keydown.jqtree")};D.prototype.handleKeyDown=function(M){var K,I,N,L,J,G,H;if(!this.tree_widget.options.keyboardSupport){return}if(d(document.activeElement).is("textarea,input,select")){return true}K=this.tree_widget.getSelectedNode();H=(function(O){return function(P){if(P){O.tree_widget.selectNode(P);if(O.tree_widget.scroll_handler&&(!O.tree_widget.scroll_handler.isScrolledIntoView(d(P.element).find(".jqtree-element")))){O.tree_widget.scrollToNode(P)}return false}else{return true}}})(this);N=(function(O){return function(){return H(O.getNextNode(K))}})(this);G=(function(O){return function(){return H(O.getPreviousNode(K))}})(this);J=(function(O){return function(){if(K.isFolder()&&!K.is_open){O.tree_widget.openNode(K);return false}else{return true}}})(this);L=(function(O){return function(){if(K.isFolder()&&K.is_open){O.tree_widget.closeNode(K);return false}else{return true}}})(this);if(!K){return true}else{I=M.which;switch(I){case F:return N();case B:return G();case E:return J();case C:return L()}}};D.prototype.getNextNode=function(G,I){var H;if(I==null){I=true}if(I&&G.hasChildren()&&G.is_open){return G.children[0]}else{if(!G.parent){return null}else{H=G.getNextSibling();if(H){return H}else{return this.getNextNode(G.parent,false)}}}};D.prototype.getPreviousNode=function(H){var G;if(!H.parent){return null}else{G=H.getPreviousSibling();if(G){if(!G.hasChildren()||!G.is_open){return G}else{return this.getLastChild(G)}}else{if(H.parent.parent){return H.parent}else{return null}}}};D.prototype.getLastChild=function(H){var G;if(!H.hasChildren()){return null}else{G=H.children[H.children.length-1];if(!G.hasChildren()||!G.is_open){return G}else{return this.getLastChild(G)}}};return D})()}).call(this);