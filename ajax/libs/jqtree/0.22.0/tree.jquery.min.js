(function(){var d,k,r,x,u,w,v,b,f,i,h,y,j,B,c,o,q,n,m,e,l,a,g,t,A,s=[].slice,p={}.hasOwnProperty,z=function(F,D){for(var C in D){if(p.call(D,C)){F[C]=D[C]}}function E(){this.constructor=F}E.prototype=D.prototype;F.prototype=new E();F.__super__=D.prototype;return F};t="0.22.0";d=this.jQuery;n=(function(){C.prototype.defaults={};function C(E,D){this.$el=d(E);this.options=d.extend({},this.defaults,D)}C.prototype.destroy=function(){return this._deinit()};C.prototype._init=function(){return null};C.prototype._deinit=function(){return null};C.register=function(J,H){var I,G,D,E,F;E=function(){return"simple_widget_"+H};F=function(L,K){var M;M=d.data(L,K);if(M&&(M instanceof C)){return M}else{return null}};G=function(M,L){var O,N,R,Q,P,K;O=E();for(P=0,K=M.length;P<K;P++){N=M[P];R=F(N,O);if(!R){Q=new J(N,L);if(!d.data(N,O)){d.data(N,O,Q)}Q._init()}}return M};D=function(M){var O,N,Q,P,L,K;O=E();K=[];for(P=0,L=M.length;P<L;P++){N=M[P];Q=F(N,O);if(Q){Q.destroy()}K.push(d.removeData(N,O))}return K};I=function(R,O,P){var K,S,N,L,M,Q;S=null;for(M=0,Q=R.length;M<Q;M++){K=R[M];N=d.data(K,E());if(N&&(N instanceof C)){L=N[O];if(L&&(typeof L==="function")){S=L.apply(N,P)}}}return S};return d.fn[H]=function(){var M,L,N,O,K;N=arguments[0],L=2<=arguments.length?s.call(arguments,1):[];M=this;if(N===void 0||typeof N==="object"){K=N;return G(M,K)}else{if(typeof N==="string"&&N[0]!=="_"){O=N;if(O==="destroy"){return D(M)}else{return I(M,O,L)}}}}};return C})();this.SimpleWidget=n;h=(function(C){z(D,C);function D(){return D.__super__.constructor.apply(this,arguments)}D.is_mouse_handled=false;D.prototype._init=function(){this.$el.bind("mousedown.mousewidget",d.proxy(this._mouseDown,this));this.$el.bind("touchstart.mousewidget",d.proxy(this._touchStart,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;this._is_mouse_delay_met=true;return this.mouse_down_info=null};D.prototype._deinit=function(){var E;this.$el.unbind("mousedown.mousewidget");this.$el.unbind("touchstart.mousewidget");E=d(document);E.unbind("mousemove.mousewidget");return E.unbind("mouseup.mousewidget")};D.prototype._mouseDown=function(F){var E;if(F.which!==1){return}E=this._handleMouseDown(F,this._getPositionInfo(F));if(E){F.preventDefault()}return E};D.prototype._handleMouseDown=function(F,E){if(D.is_mouse_handled){return}if(this.is_mouse_started){this._handleMouseUp(E)}this.mouse_down_info=E;if(!this._mouseCapture(E)){return}this._handleStartMouse();this.is_mouse_handled=true;return true};D.prototype._handleStartMouse=function(){var E;E=d(document);E.bind("mousemove.mousewidget",d.proxy(this._mouseMove,this));E.bind("touchmove.mousewidget",d.proxy(this._touchMove,this));E.bind("mouseup.mousewidget",d.proxy(this._mouseUp,this));E.bind("touchend.mousewidget",d.proxy(this._touchEnd,this));if(this.mouse_delay){return this._startMouseDelayTimer()}};D.prototype._startMouseDelayTimer=function(){if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout((function(E){return function(){return E._is_mouse_delay_met=true}})(this),this.mouse_delay);return this._is_mouse_delay_met=false};D.prototype._mouseMove=function(E){return this._handleMouseMove(E,this._getPositionInfo(E))};D.prototype._handleMouseMove=function(F,E){if(this.is_mouse_started){this._mouseDrag(E);return F.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==false;if(this.is_mouse_started){this._mouseDrag(E)}else{this._handleMouseUp(E)}return !this.is_mouse_started};D.prototype._getPositionInfo=function(E){return{page_x:E.pageX,page_y:E.pageY,target:E.target,original_event:E}};D.prototype._mouseUp=function(E){return this._handleMouseUp(this._getPositionInfo(E))};D.prototype._handleMouseUp=function(E){var F;F=d(document);F.unbind("mousemove.mousewidget");F.unbind("touchmove.mousewidget");F.unbind("mouseup.mousewidget");F.unbind("touchend.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(E)}};D.prototype._mouseCapture=function(E){return true};D.prototype._mouseStart=function(E){return null};D.prototype._mouseDrag=function(E){return null};D.prototype._mouseStop=function(E){return null};D.prototype.setMouseDelay=function(E){return this.mouse_delay=E};D.prototype._touchStart=function(E){var F;if(E.originalEvent.touches.length>1){return}F=E.originalEvent.changedTouches[0];return this._handleMouseDown(E,this._getPositionInfo(F))};D.prototype._touchMove=function(E){var F;if(E.originalEvent.touches.length>1){return}F=E.originalEvent.changedTouches[0];return this._handleMouseMove(E,this._getPositionInfo(F))};D.prototype._touchEnd=function(E){var F;if(E.originalEvent.touches.length>1){return}F=E.originalEvent.changedTouches[0];return this._handleMouseUp(this._getPositionInfo(F))};return D})(n);this.Tree={};d=this.jQuery;B={getName:function(C){return B.strings[C-1]},nameToIndex:function(C){var D,F,E;for(D=F=1,E=B.strings.length;1<=E?F<=E:F>=E;D=1<=E?++F:--F){if(B.strings[D-1]===C){return D}}return 0}};B.BEFORE=1;B.AFTER=2;B.INSIDE=3;B.NONE=4;B.strings=["before","after","inside","none"];this.Tree.Position=B;y=(function(){function C(E,D,F){if(D==null){D=false}if(F==null){F=C}this.setData(E);this.children=[];this.parent=null;if(D){this.id_mapping={};this.tree=this;this.node_class=F}}C.prototype.setData=function(G){var E,F,D;if(typeof G!=="object"){return this.name=G}else{D=[];for(E in G){F=G[E];if(E==="label"){D.push(this.name=F)}else{D.push(this[E]=F)}}return D}};C.prototype.initFromData=function(E){var D,F;F=(function(G){return function(H){G.setData(H);if(H.children){return D(H.children)}}})(this);D=(function(G){return function(K){var L,I,J,H;for(J=0,H=K.length;J<H;J++){L=K[J];I=new G.tree.node_class("");I.initFromData(L);G.addChild(I)}return null}})(this);F(E);return null};C.prototype.loadFromData=function(G){var E,H,F,D;this.removeChildren();for(F=0,D=G.length;F<D;F++){H=G[F];E=new this.tree.node_class(H);this.addChild(E);if(typeof H==="object"&&H.children){E.loadFromData(H.children)}}return null};C.prototype.addChild=function(D){this.children.push(D);return D._setParent(this)};C.prototype.addChildAtPosition=function(E,D){this.children.splice(D,0,E);return E._setParent(this)};C.prototype._setParent=function(D){this.parent=D;this.tree=D.tree;return this.tree.addNodeToIndex(this)};C.prototype.removeChild=function(D){D.removeChildren();return this._removeChild(D)};C.prototype._removeChild=function(D){this.children.splice(this.getChildIndex(D),1);return this.tree.removeNodeFromIndex(D)};C.prototype.getChildIndex=function(D){return d.inArray(D,this.children)};C.prototype.hasChildren=function(){return this.children.length!==0};C.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};C.prototype.iterate=function(E){var D;D=(function(F){return function(I,M){var L,G,K,H,J;if(I.children){J=I.children;for(K=0,H=J.length;K<H;K++){L=J[K];G=E(L,M);if(F.hasChildren()&&G){D(L,M+1)}}return null}}})(this);D(this,0);return null};C.prototype.moveNode=function(E,F,D){if(E.isParentOf(F)){return}E.parent._removeChild(E);if(D===B.AFTER){return F.parent.addChildAtPosition(E,F.parent.getChildIndex(F)+1)}else{if(D===B.BEFORE){return F.parent.addChildAtPosition(E,F.parent.getChildIndex(F))}else{if(D===B.INSIDE){return F.addChildAtPosition(E,0)}}}};C.prototype.getData=function(){var D;D=(function(E){return function(I){var M,H,K,J,G,L,F;M=[];for(L=0,F=I.length;L<F;L++){K=I[L];J={};for(H in K){G=K[H];if((H!=="parent"&&H!=="children"&&H!=="element"&&H!=="tree")&&Object.prototype.hasOwnProperty.call(K,H)){J[H]=G}}if(K.hasChildren()){J.children=D(K.children)}M.push(J)}return M}})(this);return D(this.children)};C.prototype.getNodeByName=function(E){var D;D=null;this.iterate(function(F){if(F.name===E){D=F;return false}else{return true}});return D};C.prototype.addAfter=function(E){var F,D;if(!this.parent){return null}else{D=new this.tree.node_class(E);F=this.parent.getChildIndex(this);this.parent.addChildAtPosition(D,F+1);return D}};C.prototype.addBefore=function(E){var F,D;if(!this.parent){return null}else{D=new this.tree.node_class(E);F=this.parent.getChildIndex(this);this.parent.addChildAtPosition(D,F);return D}};C.prototype.addParent=function(H){var J,I,G,F,D,E;if(!this.parent){return null}else{I=new this.tree.node_class(H);I._setParent(this.tree);G=this.parent;E=G.children;for(F=0,D=E.length;F<D;F++){J=E[F];I.addChild(J)}G.children=[];G.addChild(I);return I}};C.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};C.prototype.append=function(E){var D;D=new this.tree.node_class(E);this.addChild(D);return D};C.prototype.prepend=function(E){var D;D=new this.tree.node_class(E);this.addChildAtPosition(D,0);return D};C.prototype.isParentOf=function(E){var D;D=E.parent;while(D){if(D===this){return true}D=D.parent}return false};C.prototype.getLevel=function(){var E,D;E=0;D=this;while(D.parent){E+=1;D=D.parent}return E};C.prototype.getNodeById=function(D){return this.id_mapping[D]};C.prototype.addNodeToIndex=function(D){if(D.id!=null){return this.id_mapping[D.id]=D}};C.prototype.removeNodeFromIndex=function(D){if(D.id!=null){return delete this.id_mapping[D.id]}};C.prototype.removeChildren=function(){this.iterate((function(D){return function(E){D.tree.removeNodeFromIndex(E);return true}})(this));return this.children=[]};C.prototype.getPreviousSibling=function(){var D;if(!this.parent){return null}else{D=this.parent.getChildIndex(this)-1;if(D>=0){return this.parent.children[D]}else{return null}}};C.prototype.getNextSibling=function(){var D;if(!this.parent){return null}else{D=this.parent.getChildIndex(this)+1;if(D<this.parent.children.length){return this.parent.children[D]}else{return null}}};C.prototype.getNodesByProperty=function(D,E){return this.filter(function(F){return F[D]===E})};C.prototype.filter=function(E){var D;D=[];this.iterate(function(F){if(E(F)){D.push(F)}return true});return D};return C})();this.Tree.Node=y;u=(function(){function C(D){this.tree_widget=D;this.opened_icon_element=this.createButtonElement(D.options.openedIcon);this.closed_icon_element=this.createButtonElement(D.options.closedIcon)}C.prototype.render=function(D){if(D&&D.parent){return this.renderFromNode(D)}else{return this.renderFromRoot()}};C.prototype.renderNode=function(G){var D,E,F;d(G.element).remove();E=new j(G.parent,this.tree_widget);D=this.createLi(G);this.attachNodeData(G,D);F=G.getPreviousSibling();if(F){d(F.element).after(D)}else{E.getUl().prepend(D)}if(G.children){return this.renderFromNode(G)}};C.prototype.renderFromRoot=function(){var D;D=this.tree_widget.element;D.empty();return this.createDomElements(D[0],this.tree_widget.tree.children,true,true)};C.prototype.renderFromNode=function(D){var E;E=this.tree_widget._getNodeElementForNode(D);E.getUl().remove();return this.createDomElements(E.$element[0],D.children,false,false)};C.prototype.createDomElements=function(H,E,L,F){var D,K,I,G,J;I=this.createUl(L);H.appendChild(I);for(G=0,J=E.length;G<J;G++){D=E[G];K=this.createLi(D);I.appendChild(K);this.attachNodeData(D,K);if(D.hasChildren()){this.createDomElements(K,D.children,false,D.is_open)}}return null};C.prototype.attachNodeData=function(E,D){E.element=D;return d(D).data("node",E)};C.prototype.createUl=function(F){var E,D;if(F){E="jqtree-tree"}else{E=""}D=document.createElement("ul");D.className="jqtree_common "+E;return D};C.prototype.createLi=function(E){var D;if(E.isFolder()){D=this.createFolderLi(E)}else{D=this.createNodeLi(E)}if(this.tree_widget.options.onCreateLi){this.tree_widget.options.onCreateLi(E,d(D))}return D};C.prototype.createFolderLi=function(H){var F,I,E,G,D,K,L,J;F=this.getButtonClasses(H);D=this.getFolderClasses(H);G=this.escapeIfNecessary(H.name);if(H.is_open){K=this.opened_icon_element}else{K=this.closed_icon_element}L=document.createElement("li");L.className="jqtree_common "+D;E=document.createElement("div");E.className="jqtree-element jqtree_common";L.appendChild(E);I=document.createElement("a");I.className="jqtree_common "+F;I.appendChild(K.cloneNode());E.appendChild(I);J=document.createElement("span");J.className="jqtree_common jqtree-title jqtree-title-folder";E.appendChild(J);J.innerHTML=G;return L};C.prototype.createNodeLi=function(G){var I,J,F,D,H,E;H=["jqtree_common"];if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(G)){H.push("jqtree-selected")}I=H.join(" ");F=this.escapeIfNecessary(G.name);D=document.createElement("li");D.className=I;J=document.createElement("div");J.className="jqtree-element jqtree_common";D.appendChild(J);E=document.createElement("span");E.className="jqtree-title jqtree_common";E.innerHTML=F;J.appendChild(E);return D};C.prototype.getButtonClasses=function(E){var D;D=["jqtree-toggler"];if(!E.is_open){D.push("jqtree-closed")}return D.join(" ")};C.prototype.getFolderClasses=function(E){var D;D=["jqtree-folder"];if(!E.is_open){D.push("jqtree-closed")}if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(E)){D.push("jqtree-selected")}return D.join(" ")};C.prototype.escapeIfNecessary=function(D){if(this.tree_widget.options.autoEscape){return l(D)}else{return D}};C.prototype.createButtonElement=function(D){var E;if(typeof D==="string"){E=document.createElement("div");E.innerHTML=D;return document.createTextNode(E.innerHTML)}else{return d(D)[0]}};return C})();f=(function(D){z(C,D);function C(){return C.__super__.constructor.apply(this,arguments)}C.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:y,dataFilter:null,keyboardSupport:true,openFolderDelay:500};C.prototype.toggle=function(F,E){if(E==null){E=null}if(E===null){E=this.options.slide}if(F.is_open){return this.closeNode(F,E)}else{return this.openNode(F,E)}};C.prototype.getTree=function(){return this.tree};C.prototype.selectNode=function(E){return this._selectNode(E,false)};C.prototype._selectNode=function(G,E){var I,H,J,F;if(E==null){E=false}if(!this.select_node_handler){return}I=(function(K){return function(){if(K.options.onCanSelectNode){return K.options.selectable&&K.options.onCanSelectNode(G)}else{return K.options.selectable}}})(this);J=(function(K){return function(){var L;L=G.parent;if(L&&L.parent&&!L.is_open){return K.openNode(L,false)}}})(this);F=(function(K){return function(){if(K.options.saveState){return K.save_state_handler.saveState()}}})(this);if(!G){this._deselectCurrentNode();F();return}if(!I()){return}if(this.select_node_handler.isNodeSelected(G)){if(E){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null,previous_node:G})}}else{H=this.getSelectedNode();this._deselectCurrentNode();this.addToSelection(G);this._triggerEvent("tree.select",{node:G,deselected_node:H});J()}return F()};C.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};C.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};C.prototype.loadData=function(E,F){return this._loadData(E,F)};C.prototype.loadDataFromUrl=function(E,G,F){if(d.type(E)!=="string"){F=G;G=E;E=null}return this._loadDataFromUrl(E,G,F)};C.prototype.reload=function(){return this.loadDataFromUrl()};C.prototype._loadDataFromUrl=function(J,K,G){var L,I,F,M,H,E;L=null;I=(function(N){return function(){var O;if(!K){L=N.element}else{O=new w(K,N);L=O.getLi()}return L.addClass("jqtree-loading")}})(this);E=(function(N){return function(){if(L){return L.removeClass("jqtree-loading")}}})(this);H=(function(N){return function(){if(d.type(J)==="string"){J={url:J}}if(!J.method){return J.method="get"}}})(this);F=(function(N){return function(O){E();N._loadData(O,K);if(G&&d.isFunction(G)){return G()}}})(this);M=(function(N){return function(){H();return d.ajax({url:J.url,data:J.data,type:J.method.toUpperCase(),cache:false,dataType:"json",success:function(O){var P;if(d.isArray(O)||typeof O==="object"){P=O}else{P=d.parseJSON(O)}if(N.options.dataFilter){P=N.options.dataFilter(P)}return F(P)},error:function(O){E();if(N.options.onLoadFailed){return N.options.onLoadFailed(O)}}})}})(this);if(!J){J=this._getDataUrlInfo(K)}I();if(!J){E()}else{if(d.isArray(J)){F(J)}else{return M()}}};C.prototype._loadData=function(H,I){var J,F,G,E;if(!H){return}this._triggerEvent("tree.load_data",{tree_data:H});if(!I){this._initTree(H)}else{F=this.select_node_handler.getSelectedNodesUnder(I);for(G=0,E=F.length;G<E;G++){J=F[G];this.select_node_handler.removeFromSelection(J)}I.loadFromData(H);I.load_on_demand=false;this._refreshElements(I.parent)}if(this.isDragging()){return this.dnd_handler.refresh()}};C.prototype.getNodeById=function(E){return this.tree.getNodeById(E)};C.prototype.getNodeByName=function(E){return this.tree.getNodeByName(E)};C.prototype.openNode=function(F,E){if(E==null){E=null}if(E===null){E=this.options.slide}return this._openNode(F,E)};C.prototype._openNode=function(G,E,H){var I,F;if(E==null){E=true}I=(function(J){return function(L,M,K){var N;N=new w(L,J);return N.open(K,M)}})(this);if(G.isFolder()){if(G.load_on_demand){return this._loadFolderOnDemand(G,E,H)}else{F=G.parent;while(F&&!F.is_open){if(F.parent){I(F,false,null)}F=F.parent}I(G,E,H);return this._saveState()}}};C.prototype._loadFolderOnDemand=function(F,E,G){if(E==null){E=true}return this._loadDataFromUrl(null,F,(function(H){return function(){return H._openNode(F,E,G)}})(this))};C.prototype.closeNode=function(F,E){if(E==null){E=null}if(E===null){E=this.options.slide}if(F.isFolder()){new w(F,this).close(E);return this._saveState()}};C.prototype.isDragging=function(){if(this.dnd_handler){return this.dnd_handler.is_dragging}else{return false}};C.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh()};C.prototype.addNodeAfter=function(F,E){var G;G=E.addAfter(F);this._refreshElements(E.parent);return G};C.prototype.addNodeBefore=function(F,E){var G;G=E.addBefore(F);this._refreshElements(E.parent);return G};C.prototype.addParentNode=function(F,E){var G;G=E.addParent(F);this._refreshElements(G.parent);return G};C.prototype.removeNode=function(F){var E;E=F.parent;if(E){this.select_node_handler.removeFromSelection(F,true);F.remove();return this._refreshElements(E.parent)}};C.prototype.appendNode=function(G,H){var E,F;if(!H){H=this.tree}E=H.isFolder();F=H.append(G);if(E){this._refreshElements(H)}else{this._refreshElements(H.parent)}return F};C.prototype.prependNode=function(F,G){var E;if(!G){G=this.tree}E=G.prepend(F);this._refreshElements(G);return E};C.prototype.updateNode=function(E,G){var F;F=G.id&&G.id!==E.id;if(F){this.tree.removeNodeFromIndex(E)}E.setData(G);if(F){this.tree.addNodeToIndex(E)}this.renderer.renderNode(E);return this._selectCurrentNode()};C.prototype.moveNode=function(G,H,E){var F;F=B.nameToIndex(E);this.tree.moveNode(G,H,F);return this._refreshElements()};C.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};C.prototype.addToSelection=function(E){if(E){this.select_node_handler.addToSelection(E);this._getNodeElementForNode(E).select();return this._saveState()}};C.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};C.prototype.isNodeSelected=function(E){return this.select_node_handler.isNodeSelected(E)};C.prototype.removeFromSelection=function(E){this.select_node_handler.removeFromSelection(E);this._getNodeElementForNode(E).deselect();return this._saveState()};C.prototype.scrollToNode=function(F){var E,G;E=d(F.element);G=E.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(G)};C.prototype.getState=function(){return this.save_state_handler.getState()};C.prototype.setState=function(E){this.save_state_handler.setState(E);return this._refreshElements()};C.prototype.setOption=function(E,F){return this.options[E]=F};C.prototype.getVersion=function(){return t};C.prototype._init=function(){C.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.is_initialized=false;this.renderer=new u(this);if(typeof c!=="undefined"&&c!==null){this.save_state_handler=new c(this)}else{this.options.saveState=false}if(typeof q!=="undefined"&&q!==null){this.select_node_handler=new q(this)}if(typeof r!=="undefined"&&r!==null){this.dnd_handler=new r(this)}else{this.options.dragAndDrop=false}if(typeof o!=="undefined"&&o!==null){this.scroll_handler=new o(this)}if((typeof i!=="undefined"&&i!==null)&&(typeof q!=="undefined"&&q!==null)){this.key_handler=new i(this)}this._initData();this.element.click(d.proxy(this._click,this));this.element.dblclick(d.proxy(this._dblclick,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",d.proxy(this._contextmenu,this))}};C.prototype._deinit=function(){this.element.empty();this.element.unbind();this.key_handler.deinit();this.tree=null;return C.__super__._deinit.call(this)};C.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};C.prototype._getDataUrlInfo=function(F){var E,G;E=this.options.dataUrl||this.element.data("url");G=(function(H){return function(){var K,J,I;I={url:E};if(F&&F.id){K={node:F.id};I.data=K}else{J=H._getNodeIdToBeSelected();if(J){K={selected_node:J};I.data=K}}return I}})(this);if(d.isFunction(E)){return E(F)}else{if(d.type(E)==="string"){return G()}else{return E}}};C.prototype._getNodeIdToBeSelected=function(){if(this.options.saveState){return this.save_state_handler.getNodeIdToBeSelected()}else{return null}};C.prototype._initTree=function(E){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);if(this.select_node_handler){this.select_node_handler.clear()}this.tree.loadFromData(E);this._openNodes();this._refreshElements();if(!this.is_initialized){this.is_initialized=true;return this._triggerEvent("tree.init")}};C.prototype._openNodes=function(){var E;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){E=-1}else{E=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(F,G){if(F.hasChildren()){F.is_open=true}return G!==E})};C.prototype._refreshElements=function(E){if(E==null){E=null}this.renderer.render(E);return this._triggerEvent("tree.refresh")};C.prototype._click=function(G){var H,F,E;H=this._getClickTarget(G.target);if(H){if(H.type==="button"){this.toggle(H.node,this.options.slide);G.preventDefault();return G.stopPropagation()}else{if(H.type==="label"){E=H.node;F=this._triggerEvent("tree.click",{node:E,click_event:G});if(!F.isDefaultPrevented()){return this._selectNode(E,true)}}}}};C.prototype._dblclick=function(E){var F;F=this._getClickTarget(E.target);if(F&&F.type==="label"){return this._triggerEvent("tree.dblclick",{node:F.node,click_event:E})}};C.prototype._getClickTarget=function(G){var I,F,E,H;E=d(G);I=E.closest(".jqtree-toggler");if(I.length){H=this._getNode(I);if(H){return{type:"button",node:H}}}else{F=E.closest(".jqtree-element");if(F.length){H=this._getNode(F);if(H){return{type:"label",node:H}}}}return null};C.prototype._getNode=function(E){var F;F=E.closest("li.jqtree_common");if(F.length===0){return null}else{return F.data("node")}};C.prototype._getNodeElementForNode=function(E){if(E.isFolder()){return new w(E,this)}else{return new j(E,this)}};C.prototype._getNodeElement=function(E){var F;F=this._getNode(E);if(F){return this._getNodeElementForNode(F)}else{return null}};C.prototype._contextmenu=function(G){var E,F;E=d(G.target).closest("ul.jqtree-tree .jqtree-element");if(E.length){F=this._getNode(E);if(F){G.preventDefault();G.stopPropagation();this._triggerEvent("tree.contextmenu",{node:F,click_event:G});return false}}};C.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};C.prototype._mouseCapture=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(E)}else{return false}};C.prototype._mouseStart=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(E)}else{return false}};C.prototype._mouseDrag=function(F){var E;if(this.options.dragAndDrop){E=this.dnd_handler.mouseDrag(F);if(this.scroll_handler){this.scroll_handler.checkScrolling()}return E}else{return false}};C.prototype._mouseStop=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(E)}else{return false}};C.prototype._triggerEvent=function(G,E){var F;F=d.Event(G);d.extend(F,E);this.element.trigger(F);return F};C.prototype.testGenerateHitAreas=function(E){this.dnd_handler.current_item=this._getNodeElementForNode(E);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};C.prototype._selectCurrentNode=function(){var E,F;E=this.getSelectedNode();if(E){F=this._getNodeElementForNode(E);if(F){return F.select()}}};C.prototype._deselectCurrentNode=function(){var E;E=this.getSelectedNode();if(E){return this.removeFromSelection(E)}};return C})(h);n.register(f,"tree");j=(function(){function C(D,E){this.init(D,E)}C.prototype.init=function(D,E){this.node=D;this.tree_widget=E;if(!D.element){D.element=this.tree_widget.element}return this.$element=d(D.element)};C.prototype.getUl=function(){return this.$element.children("ul:first")};C.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};C.prototype.getLi=function(){return this.$element};C.prototype.addDropHint=function(D){if(D===B.INSIDE){return new k(this.$element)}else{return new v(this.node,this.$element,D)}};C.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};C.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return C})();w=(function(D){z(C,D);function C(){return C.__super__.constructor.apply(this,arguments)}C.prototype.open=function(H,E){var G,F;if(E==null){E=true}if(!this.node.is_open){this.node.is_open=true;G=this.getButton();G.removeClass("jqtree-closed");G.html("");G.append(this.tree_widget.renderer.opened_icon_element.cloneNode());F=(function(I){return function(){I.getLi().removeClass("jqtree-closed");if(H){H()}return I.tree_widget._triggerEvent("tree.open",{node:I.node})}})(this);if(E){return this.getUl().slideDown("fast",F)}else{this.getUl().show();return F()}}};C.prototype.close=function(E){var G,F;if(E==null){E=true}if(this.node.is_open){this.node.is_open=false;G=this.getButton();G.addClass("jqtree-closed");G.html("");G.append(this.tree_widget.renderer.closed_icon_element.cloneNode());F=(function(H){return function(){H.getLi().addClass("jqtree-closed");return H.tree_widget._triggerEvent("tree.close",{node:H.node})}})(this);if(E){return this.getUl().slideUp("fast",F)}else{this.getUl().hide();return F()}}};C.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};C.prototype.addDropHint=function(E){if(!this.node.is_open&&E===B.INSIDE){return new k(this.$element)}else{return new v(this.node,this.$element,E)}};return C})(j);l=function(C){return(""+C).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};A=function(H,E){var D,G,F,C;for(D=F=0,C=H.length;F<C;D=++F){G=H[D];if(G===E){return D}}return -1};a=function(D,C){if(D.indexOf){return D.indexOf(C)}else{return A(D,C)}};this.Tree.indexOf=a;this.Tree._indexOf=A;g=function(C){return typeof C==="number"&&C%1===0};e=function(){var D,E,G,C,F;D=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;E={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};G=function(H){D.lastIndex=0;if(D.test(H)){return'"'+H.replace(D,function(I){var J;J=E[I];return(typeof J==="string"?J:"\\u"+("0000"+I.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+H+'"'}};C=function(O,L){var J,H,K,P,N,I,M;N=L[O];switch(typeof N){case"string":return G(N);case"number":if(isFinite(N)){return String(N)}else{return"null"}case"boolean":case"null":return String(N);case"object":if(!N){return"null"}K=[];if(Object.prototype.toString.apply(N)==="[object Array]"){for(J=I=0,M=N.length;I<M;J=++I){P=N[J];K[J]=C(J,N)||"null"}return(K.length===0?"[]":"["+K.join(",")+"]")}for(H in N){if(Object.prototype.hasOwnProperty.call(N,H)){P=C(H,N);if(P){K.push(G(H)+":"+P)}}}return(K.length===0?"{}":"{"+K.join(",")+"}")}};F=function(H){return C("",{"":H})};return F};this.Tree.get_json_stringify_function=e;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){if(this.JSON==null){this.JSON={}}this.JSON.stringify=e()}c=(function(){function C(D){this.tree_widget=D}C.prototype.saveState=function(){var D;D=JSON.stringify(this.getState());if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(D)}else{if(this.supportsLocalStorage()){return localStorage.setItem(this.getCookieName(),D)}else{if(d.cookie){d.cookie.raw=true;return d.cookie(this.getCookieName(),D,{path:"/"})}}}};C.prototype.restoreState=function(){var D;D=this.getStateFromStorage();if(D){this.setState(D);return true}else{return false}};C.prototype.getStateFromStorage=function(){var D;D=this._loadFromStorage();if(D){return this._parseState(D)}else{return null}};C.prototype._parseState=function(E){var D;D=d.parseJSON(E);if(D&&D.selected_node&&g(D.selected_node)){D.selected_node=[D.selected_node]}return D};C.prototype._loadFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(this.supportsLocalStorage()){return localStorage.getItem(this.getCookieName())}else{if(d.cookie){d.cookie.raw=true;return d.cookie(this.getCookieName())}else{return null}}}};C.prototype.getState=function(){var E,D;E=(function(F){return function(){var G;G=[];F.tree_widget.tree.iterate(function(H){if(H.is_open&&H.id&&H.hasChildren()){G.push(H.id)}return true});return G}})(this);D=(function(F){return function(){var G;return(function(){var K,I,J,H;J=this.tree_widget.getSelectedNodes();H=[];for(K=0,I=J.length;K<I;K++){G=J[K];H.push(G.id)}return H}).call(F)}})(this);return{open_nodes:E(),selected_node:D()}};C.prototype.setState=function(J){var I,K,G,F,H,E,D;if(J){K=J.open_nodes;F=J.selected_node;this.tree_widget.tree.iterate((function(L){return function(M){M.is_open=M.id&&M.hasChildren()&&(a(K,M.id)>=0);return true}})(this));if(F&&this.tree_widget.select_node_handler){this.tree_widget.select_node_handler.clear();D=[];for(H=0,E=F.length;H<E;H++){I=F[H];G=this.tree_widget.getNodeById(I);if(G){D.push(this.tree_widget.select_node_handler.addToSelection(G))}else{D.push(void 0)}}return D}}};C.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};C.prototype.supportsLocalStorage=function(){var D;D=function(){var E,F;if(typeof localStorage==="undefined"||localStorage===null){return false}else{try{F="_storage_test";sessionStorage.setItem(F,true);sessionStorage.removeItem(F)}catch(G){E=G;return false}return true}};if(this._supportsLocalStorage==null){this._supportsLocalStorage=D()}return this._supportsLocalStorage};C.prototype.getNodeIdToBeSelected=function(){var D;D=this.getStateFromStorage();if(D&&D.selected_node){return D.selected_node[0]}else{return null}};return C})();q=(function(){function C(D){this.tree_widget=D;this.clear()}C.prototype.getSelectedNode=function(){var D;D=this.getSelectedNodes();if(D.length){return D[0]}else{return false}};C.prototype.getSelectedNodes=function(){var F,E,D;if(this.selected_single_node){return[this.selected_single_node]}else{D=[];for(F in this.selected_nodes){E=this.tree_widget.getNodeById(F);if(E){D.push(E)}}return D}};C.prototype.getSelectedNodesUnder=function(E){var G,F,D;if(this.selected_single_node){if(E.isParentOf(this.selected_single_node)){return[this.selected_single_node]}else{return[]}}else{D=[];for(G in this.selected_nodes){F=this.tree_widget.getNodeById(G);if(F&&E.isParentOf(F)){D.push(F)}}return D}};C.prototype.isNodeSelected=function(D){if(D.id){return this.selected_nodes[D.id]}else{if(this.selected_single_node){return this.selected_single_node.element===D.element}else{return false}}};C.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};C.prototype.removeFromSelection=function(D,E){if(E==null){E=false}if(!D.id){if(this.selected_single_node&&D.element===this.selected_single_node.element){return this.selected_single_node=null}}else{delete this.selected_nodes[D.id];if(E){return D.iterate((function(F){return function(G){delete F.selected_nodes[D.id];return true}})(this))}}};C.prototype.addToSelection=function(D){if(D.id){return this.selected_nodes[D.id]=true}else{return this.selected_single_node=D}};return C})();r=(function(){function C(D){this.tree_widget=D;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false;this.current_item=null}C.prototype.mouseCapture=function(E){var D,F;D=d(E.target);if(!this.mustCaptureElement(D)){return null}if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(D)){return null}F=this.tree_widget._getNodeElement(D);if(F&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(F.node)){F=null}}this.current_item=F;return this.current_item!==null};C.prototype.mouseStart=function(D){var E;this.refresh();E=d(D.target).offset();this.drag_element=new x(this.current_item.node,D.page_x-E.left,D.page_y-E.top,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};C.prototype.mouseDrag=function(D){var F,E;this.drag_element.move(D.page_x,D.page_y);F=this.findHoveredArea(D.page_x,D.page_y);E=this.canMoveToArea(F);if(E&&F){if(!F.node.isFolder()){this.stopOpenFolderTimer()}if(this.hovered_area!==F){this.hovered_area=F;if(this.mustOpenFolderTimer(F)){this.startOpenFolderTimer(F.node)}else{this.stopOpenFolderTimer()}this.updateDropHint()}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};C.prototype.mustCaptureElement=function(D){return !D.is("input,select")};C.prototype.canMoveToArea=function(D){var E;if(!D){return false}else{if(this.tree_widget.options.onCanMoveTo){E=B.getName(D.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,D.node,E)}else{return true}}};C.prototype.mouseStop=function(D){this.moveItem(D);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();if(this.current_item){this.current_item.$element.removeClass("jqtree-moving");this.current_item=null}this.is_dragging=false;return false};C.prototype.refresh=function(){this.removeHitAreas();if(this.current_item){this.generateHitAreas();this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node);if(this.is_dragging){return this.current_item.$element.addClass("jqtree-moving")}}};C.prototype.removeHitAreas=function(){return this.hit_areas=[]};C.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};C.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};C.prototype.removeHover=function(){return this.hovered_area=null};C.prototype.generateHitAreas=function(){var D;D=new b(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom);return this.hit_areas=D.generate()};C.prototype.findHoveredArea=function(E,J){var H,G,I,D,F;G=this.getTreeDimensions();if(E<G.left||J<G.top||E>G.right||J>G.bottom){return null}D=0;I=this.hit_areas.length;while(D<I){F=(D+I)>>1;H=this.hit_areas[F];if(J<H.top){I=F}else{if(J>H.bottom){D=F+1}else{return H}}}return null};C.prototype.mustOpenFolderTimer=function(E){var D;D=E.node;return D.isFolder()&&!D.is_open&&E.position===B.INSIDE};C.prototype.updateDropHint=function(){var D;if(!this.hovered_area){return}this.removeDropHint();D=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=D.addDropHint(this.hovered_area.position)};C.prototype.startOpenFolderTimer=function(E){var D;D=(function(F){return function(){return F.tree_widget._openNode(E,F.tree_widget.options.slide,function(){F.refresh();return F.updateDropHint()})}})(this);this.stopOpenFolderTimer();return this.open_folder_timer=setTimeout(D,this.tree_widget.options.openFolderDelay)};C.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};C.prototype.moveItem=function(F){var G,I,H,D,E,J;if(this.hovered_area&&this.hovered_area.position!==B.NONE&&this.canMoveToArea(this.hovered_area)){H=this.current_item.node;J=this.hovered_area.node;D=this.hovered_area.position;E=H.parent;if(D===B.INSIDE){this.hovered_area.node.is_open=true}G=(function(K){return function(){K.tree_widget.tree.moveNode(H,J,D);K.tree_widget.element.empty();return K.tree_widget._refreshElements()}})(this);I=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:H,target_node:J,position:B.getName(D),previous_parent:E,do_move:G,original_event:F.original_event}});if(!I.isDefaultPrevented()){return G()}}};C.prototype.getTreeDimensions=function(){var D;D=this.tree_widget.element.offset();return{left:D.left,top:D.top,right:D.left+this.tree_widget.element.width(),bottom:D.top+this.tree_widget.element.height()+16}};return C})();m=(function(){function C(D){this.tree=D}C.prototype.iterate=function(){var D,E;D=true;E=(function(F){return function(I,G){var P,H,O,L,M,J,N,K;M=(I.is_open||!I.element)&&I.hasChildren();if(I.element){P=d(I.element);if(!P.is(":visible")){return}if(D){F.handleFirstNode(I,P);D=false}if(!I.hasChildren()){F.handleNode(I,G,P)}else{if(I.is_open){if(!F.handleOpenFolder(I,P)){M=false}}else{F.handleClosedFolder(I,G,P)}}}if(M){O=I.children.length;K=I.children;for(L=J=0,N=K.length;J<N;L=++J){H=K[L];if(L===(O-1)){E(I.children[L],null)}else{E(I.children[L],I.children[L+1])}}if(I.is_open){return F.handleAfterOpenFolder(I,G,P)}}}})(this);return E(this.tree,null)};C.prototype.handleNode=function(F,E,D){};C.prototype.handleOpenFolder=function(E,D){};C.prototype.handleClosedFolder=function(F,E,D){};C.prototype.handleAfterOpenFolder=function(F,E,D){};C.prototype.handleFirstNode=function(E,D){};return C})();b=(function(C){z(D,C);function D(E,G,F){D.__super__.constructor.call(this,E);this.current_node=G;this.tree_bottom=F}D.prototype.generate=function(){this.positions=[];this.last_top=0;this.iterate();return this.generateHitAreas(this.positions)};D.prototype.getTop=function(E){return E.offset().top};D.prototype.addPosition=function(G,E,H){var F;F={top:H,node:G,position:E};this.positions.push(F);return this.last_top=H};D.prototype.handleNode=function(G,F,E){var H;H=this.getTop(E);if(G===this.current_node){this.addPosition(G,B.NONE,H)}else{this.addPosition(G,B.INSIDE,H)}if(F===this.current_node||G===this.current_node){return this.addPosition(G,B.NONE,H)}else{return this.addPosition(G,B.AFTER,H)}};D.prototype.handleOpenFolder=function(F,E){if(F===this.current_node){return false}if(F.children[0]!==this.current_node){this.addPosition(F,B.INSIDE,this.getTop(E))}return true};D.prototype.handleClosedFolder=function(G,F,E){var H;H=this.getTop(E);if(G===this.current_node){return this.addPosition(G,B.NONE,H)}else{this.addPosition(G,B.INSIDE,H);if(F!==this.current_node){return this.addPosition(G,B.AFTER,H)}}};D.prototype.handleFirstNode=function(F,E){if(F!==this.current_node){return this.addPosition(F,B.BEFORE,this.getTop(d(F.element)))}};D.prototype.handleAfterOpenFolder=function(G,F,E){if(G===this.current_node.node||F===this.current_node.node){return this.addPosition(G,B.NONE,this.last_top)}else{return this.addPosition(G,B.AFTER,this.last_top)}};D.prototype.generateHitAreas=function(G){var K,H,E,J,I,F;J=-1;K=[];H=[];for(I=0,F=G.length;I<F;I++){E=G[I];if(E.top!==J&&K.length){if(K.length){this.generateHitAreasForGroup(H,K,J,E.top)}J=E.top;K=[]}K.push(E)}this.generateHitAreasForGroup(H,K,J,this.tree_bottom);return H};D.prototype.generateHitAreasForGroup=function(G,H,K,E){var F,M,I,J,L;L=Math.min(H.length,4);F=Math.round((E-K)/L);M=K;I=0;while(I<L){J=H[I];G.push({top:M,bottom:M+F,node:J.node,position:J.position});M+=F;I+=1}return null};return D})(m);x=(function(){function C(F,E,D,G){this.offset_x=E;this.offset_y=D;this.$element=d('<span class="jqtree-title jqtree-dragging">'+F.name+"</span>");this.$element.css("position","absolute");G.append(this.$element)}C.prototype.move=function(E,D){return this.$element.offset({left:E-this.offset_x,top:D-this.offset_y})};C.prototype.remove=function(){return this.$element.remove()};return C})();v=(function(){function C(F,E,D){this.$element=E;this.node=F;this.$ghost=d('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(D===B.AFTER){this.moveAfter()}else{if(D===B.BEFORE){this.moveBefore()}else{if(D===B.INSIDE){if(F.isFolder()&&F.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}C.prototype.remove=function(){return this.$ghost.remove()};C.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};C.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};C.prototype.moveInsideOpenFolder=function(){return d(this.node.children[0].element).before(this.$ghost)};C.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return C})();k=(function(){function C(E){var D,F;D=E.children(".jqtree-element");F=E.width()-4;this.$hint=d('<span class="jqtree-border"></span>');D.append(this.$hint);this.$hint.css({width:F,height:D.height()-4})}C.prototype.remove=function(){return this.$hint.remove()};return C})();o=(function(){function C(D){this.tree_widget=D;this.previous_top=-1;this._initScrollParent()}C.prototype._initScrollParent=function(){var D,E,F;E=(function(G){return function(){var M,J,I,L,H,K;M=["overflow","overflow-y"];I=function(O){var P,R,N,Q;for(R=0,N=M.length;R<N;R++){P=M[R];if((Q=d.css(O,P))==="auto"||Q==="scroll"){return true}}return false};if(I(G.tree_widget.$el[0])){return G.tree_widget.$el}K=G.tree_widget.$el.parents();for(L=0,H=K.length;L<H;L++){J=K[L];if(I(J)){return d(J)}}return null}})(this);F=(function(G){return function(){G.scroll_parent_top=0;return G.$scroll_parent=null}})(this);if(this.tree_widget.$el.css("position")==="fixed"){F()}D=E();if(D&&D.length&&D[0].tagName!=="HTML"){this.$scroll_parent=D;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return F()}};C.prototype.checkScrolling=function(){var D;D=this.tree_widget.dnd_handler.hovered_area;if(D&&D.top!==this.previous_top){this.previous_top=D.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(D)}else{return this._handleScrollingWithDocument(D)}}};C.prototype._handleScrollingWithScrollParent=function(E){var D;D=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-E.bottom;if(D<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((E.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};C.prototype._handleScrollingWithDocument=function(E){var D;D=E.top-d(document).scrollTop();if(D<20){return d(document).scrollTop(d(document).scrollTop()-20)}else{if(d(window).height()-(E.bottom-d(document).scrollTop())<20){return d(document).scrollTop(d(document).scrollTop()+20)}}};C.prototype.scrollTo=function(E){var D;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=E}else{D=this.tree_widget.$el.offset().top;return d(document).scrollTop(E+D)}};C.prototype.isScrolledIntoView=function(E){var D,I,H,G,F;D=d(E);if(this.$scroll_parent){F=0;G=this.$scroll_parent.height();H=D.offset().top-this.scroll_parent_top;I=H+D.height()}else{F=d(window).scrollTop();G=F+d(window).height();H=D.offset().top;I=H+D.height()}return(I<=G)&&(H>=F)};return C})();i=(function(){var G,D,F,C;D=37;C=38;F=39;G=40;function E(H){this.tree_widget=H;if(H.options.keyboardSupport){d(document).bind("keydown.jqtree",d.proxy(this.handleKeyDown,this))}}E.prototype.deinit=function(){return d(document).unbind("keydown.jqtree")};E.prototype.handleKeyDown=function(N){var L,J,O,M,K,H,I;if(!this.tree_widget.options.keyboardSupport){return}if(d(document.activeElement).is("textarea,input,select")){return true}L=this.tree_widget.getSelectedNode();I=(function(P){return function(Q){if(Q){P.tree_widget.selectNode(Q);if(P.tree_widget.scroll_handler&&(!P.tree_widget.scroll_handler.isScrolledIntoView(d(Q.element).find(".jqtree-element")))){P.tree_widget.scrollToNode(Q)}return false}else{return true}}})(this);O=(function(P){return function(){return I(P.getNextNode(L))}})(this);H=(function(P){return function(){return I(P.getPreviousNode(L))}})(this);K=(function(P){return function(){if(L.isFolder()&&!L.is_open){P.tree_widget.openNode(L);return false}else{return true}}})(this);M=(function(P){return function(){if(L.isFolder()&&L.is_open){P.tree_widget.closeNode(L);return false}else{return true}}})(this);if(!L){return true}else{J=N.which;switch(J){case G:return O();case C:return H();case F:return K();case D:return M()}}};E.prototype.getNextNode=function(H,J){var I;if(J==null){J=true}if(J&&H.hasChildren()&&H.is_open){return H.children[0]}else{if(!H.parent){return null}else{I=H.getNextSibling();if(I){return I}else{return this.getNextNode(H.parent,false)}}}};E.prototype.getPreviousNode=function(I){var H;if(!I.parent){return null}else{H=I.getPreviousSibling();if(H){if(!H.hasChildren()||!H.is_open){return H}else{return this.getLastChild(H)}}else{if(I.parent.parent){return I.parent}else{return null}}}};E.prototype.getLastChild=function(I){var H;if(!I.hasChildren()){return null}else{H=I.children[I.children.length-1];if(!H.hasChildren()||!H.is_open){return H}else{return this.getLastChild(H)}}};return E})()}).call(this);