(function(){var c,h,n,u,q,p,d,e,v,g,z,b,m,k,t,j,s,i,a,y,f,x,r,o=[].slice,l={}.hasOwnProperty,w=function(D,B){for(var A in B){if(l.call(B,A)){D[A]=B[A]}}function C(){this.constructor=D}C.prototype=B.prototype;D.prototype=new C();D.__super__=B.prototype;return D};c=this.jQuery;k=(function(){A.prototype.defaults={};function A(C,B){this.$el=c(C);this.options=c.extend({},this.defaults,B)}A.prototype.destroy=function(){return this._deinit()};A.prototype._init=function(){return null};A.prototype._deinit=function(){return null};A.register=function(G,E){var F,D,B,C;C=function(){return"simple_widget_"+E};D=function(J,I){var L,K,N,M,H;L=C();for(M=0,H=J.length;M<H;M++){K=J[M];N=new G(K,I);if(!c.data(K,L)){c.data(K,L,N)}N._init()}return J};B=function(J){var L,K,N,M,I,H;L=C();H=[];for(M=0,I=J.length;M<I;M++){K=J[M];N=c.data(K,L);if(N&&(N instanceof A)){N.destroy()}H.push(c.removeData(K,L))}return H};F=function(O,L,M){var H,P,K,I,J,N;P=null;for(J=0,N=O.length;J<N;J++){H=O[J];K=c.data(H,C());if(K&&(K instanceof A)){I=K[L];if(I&&(typeof I==="function")){P=I.apply(K,M)}}}return P};return c.fn[E]=function(){var J,I,K,L,H;K=arguments[0],I=2<=arguments.length?o.call(arguments,1):[];J=this;if(K===void 0||typeof K==="object"){H=K;return D(J,H)}else{if(typeof K==="string"&&K[0]!=="_"){L=K;if(L==="destroy"){return B(J)}else{return F(J,L,I)}}}}};return A})();this.SimpleWidget=k;e=(function(A){w(B,A);function B(){return B.__super__.constructor.apply(this,arguments)}B.is_mouse_handled=false;B.prototype._init=function(){this.$el.bind("mousedown.mousewidget",c.proxy(this._mouseDown,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;return this._is_mouse_delay_met=true};B.prototype._deinit=function(){var C;this.$el.unbind("mousedown.mousewidget");C=c(document);C.unbind("mousemove.mousewidget");return C.unbind("mouseup.mousewidget")};B.prototype._mouseDown=function(C){var D;if(B.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(C)}if(C.which!==1){return}if(!this._mouseCapture(C)){return}this.mouse_down_event=C;D=c(document);D.bind("mousemove.mousewidget",c.proxy(this._mouseMove,this));D.bind("mouseup.mousewidget",c.proxy(this._mouseUp,this));if(this.mouse_delay){this._startMouseDelayTimer()}C.preventDefault();this.is_mouse_handled=true;return true};B.prototype._startMouseDelayTimer=function(){var C=this;if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(){return C._is_mouse_delay_met=true},this.mouse_delay);return this._is_mouse_delay_met=false};B.prototype._mouseMove=function(C){if(this.is_mouse_started){this._mouseDrag(C);return C.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(C)}else{this._mouseUp(C)}return !this.is_mouse_started};B.prototype._mouseUp=function(C){var D;D=c(document);D.unbind("mousemove.mousewidget");D.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(C)}return false};B.prototype._mouseCapture=function(C){return true};B.prototype._mouseStart=function(C){return null};B.prototype._mouseDrag=function(C){return null};B.prototype._mouseStop=function(C){return null};return B})(k);this.Tree={};c=this.jQuery;a=function(F,C){var B,E,D,A;if(F.indexOf){return F.indexOf(C)}else{for(B=D=0,A=F.length;D<A;B=++D){E=F[B];if(E===C){return B}}return -1}};this.Tree.indexOf=a;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){y=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};x=function(A){y.lastIndex=0;if(y.test(A)){return'"'+A.replace(y,function(B){var C;C=f[B];return(typeof C==="string"?C:"\\u"+("0000"+B.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+A+'"'}};r=function(H,E){var C,A,D,I,G,B,F;G=E[H];switch(typeof G){case"string":return x(G);case"number":if(isFinite(G)){return String(G)}else{return"null"}case"boolean":case"null":return String(G);case"object":if(!G){return"null"}D=[];if(Object.prototype.toString.apply(G)==="[object Array]"){for(C=B=0,F=G.length;B<F;C=++B){I=G[C];D[C]=r(C,G)||"null"}return(D.length===0?"[]":"["+D.join(",")+"]")}for(A in G){if(Object.prototype.hasOwnProperty.call(G,A)){I=r(A,G);if(I){D.push(x(A)+":"+I)}}}return(D.length===0?"{}":"{"+D.join(",")+"}")}};if(!(this.JSON!=null)){this.JSON={}}this.JSON.stringify=function(A){return r("",{"":A})}}i=function(A){return(""+A).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};z={getName:function(A){return z.strings[A-1]},nameToIndex:function(A){var B,D,C;for(B=D=1,C=z.strings.length;1<=C?D<=C:D>=C;B=1<=C?++D:--D){if(z.strings[B-1]===A){return B}}return 0}};z.BEFORE=1;z.AFTER=2;z.INSIDE=3;z.NONE=4;z.strings=["before","after","inside","none"];this.Tree.Position=z;v=(function(){function A(B){this.setData(B);this.children=[];this.parent=null}A.prototype.setData=function(E){var C,D,B;if(typeof E!=="object"){return this.name=E}else{B=[];for(C in E){D=E[C];if(C==="label"){B.push(this.name=D)}else{B.push(this[C]=D)}}return B}};A.prototype.initFromData=function(C){var B,D,E=this;D=function(F){E.setData(F);if(F.children){return B(F.children)}};B=function(I){var J,G,H,F;for(H=0,F=I.length;H<F;H++){J=I[H];G=new A("");G.initFromData(J);E.addChild(G)}return null};D(C);return null};A.prototype.loadFromData=function(E){var C,F,D,B;this.children=[];for(D=0,B=E.length;D<B;D++){F=E[D];C=new A(F);this.addChild(C);if(typeof F==="object"&&F.children){C.loadFromData(F.children)}}return null};A.prototype.addChild=function(B){this.children.push(B);return B._setParent(this)};A.prototype.addChildAtPosition=function(C,B){this.children.splice(B,0,C);return C._setParent(this)};A.prototype._setParent=function(B){this.parent=B;this.tree=B.tree;return this.tree.addNodeToIndex(this)};A.prototype.removeChild=function(B){this.children.splice(this.getChildIndex(B),1);return this.tree.removeNodeFromIndex(B)};A.prototype.getChildIndex=function(B){return c.inArray(B,this.children)};A.prototype.hasChildren=function(){return this.children.length!==0};A.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};A.prototype.iterate=function(D){var B,C=this;B=function(G,K){var J,E,I,F,H;if(G.children){H=G.children;for(I=0,F=H.length;I<F;I++){J=H[I];E=D(J,K);if(C.hasChildren()&&E){B(J,K+1)}}return null}};B(this,0);return null};A.prototype.moveNode=function(C,D,B){if(C.isParentOf(D)){return}C.parent.removeChild(C);if(B===z.AFTER){return D.parent.addChildAtPosition(C,D.parent.getChildIndex(D)+1)}else{if(B===z.BEFORE){return D.parent.addChildAtPosition(C,D.parent.getChildIndex(D))}else{if(B===z.INSIDE){return D.addChildAtPosition(C,0)}}}};A.prototype.getData=function(){var B,C=this;B=function(G){var K,F,I,H,E,J,D;K=[];for(J=0,D=G.length;J<D;J++){I=G[J];H={};for(F in I){E=I[F];if((F!=="parent"&&F!=="children"&&F!=="element"&&F!=="tree")&&Object.prototype.hasOwnProperty.call(I,F)){H[F]=E}}if(I.hasChildren()){H.children=B(I.children)}K.push(H)}return K};return B(this.children)};A.prototype.getNodeByName=function(C){var B;B=null;this.iterate(function(D){if(D.name===C){B=D;return false}else{return true}});return B};A.prototype.addAfter=function(C){var D,B;if(!this.parent){return null}else{B=new A(C);D=this.parent.getChildIndex(this);this.parent.addChildAtPosition(B,D+1);return B}};A.prototype.addBefore=function(C){var D,B;if(!this.parent){return null}else{B=new A(C);D=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(B,D)}};A.prototype.addParent=function(F){var H,G,E,D,B,C;if(!this.parent){return null}else{G=new A(F);G._setParent(this.tree);E=this.parent;C=E.children;for(D=0,B=C.length;D<B;D++){H=C[D];G.addChild(H)}E.children=[];E.addChild(G);return G}};A.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};A.prototype.append=function(C){var B;B=new A(C);this.addChild(B);return B};A.prototype.prepend=function(C){var B;B=new A(C);this.addChildAtPosition(B,0);return B};A.prototype.isParentOf=function(C){var B;B=C.parent;while(B){if(B===this){return true}B=B.parent}return false};return A})();s=(function(A){w(B,A);function B(C){B.__super__.constructor.call(this,C,null,true);this.id_mapping={};this.tree=this}B.prototype.getNodeById=function(C){return this.id_mapping[C]};B.prototype.addNodeToIndex=function(C){if(C.id){return this.id_mapping[C.id]=C}};B.prototype.removeNodeFromIndex=function(C){if(C.id){return delete this.id_mapping[C.id]}};return B})(v);this.Tree.Tree=s;j="&#x25ba;";t="&#x25bc;";d=(function(B){w(A,B);function A(){return A.__super__.constructor.apply(this,arguments)}A.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:false,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,autoEscape:true,dataUrl:null};A.prototype.toggle=function(C){if(C.is_open){return this.closeNode(C)}else{return this.openNode(C)}};A.prototype.getTree=function(){return this.tree};A.prototype.selectNode=function(C,D){return this.select_node_handler.selectNode(C,D)};A.prototype.getSelectedNode=function(){return this.selected_node||false};A.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};A.prototype.loadData=function(C,G,F){var E,D;if(typeof C==="string"){D=C;return this._loadDataFromServer(D,G,F)}else{E=C;this._loadData(E,G);if(F){return F()}}};A.prototype._loadData=function(G,H){var I,F,E,C,D;this._triggerEvent("tree.load_data",{tree_data:G});if(!H){this._initTree(G)}else{F=new v("");F._setParent(H.tree);F.loadFromData(G);D=F.children;for(E=0,C=D.length;E<C;E++){I=D[E];H.addChild(I)}this._refreshElements(H.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};A.prototype._loadDataFromServer=function(C,F,E){var H,D,G=this;if(!C){return}if(F){D=new q(F,this);H=D.getLi();H.addClass("jqtree-loading")}else{H=null}return c.ajax({url:C,cache:false,success:function(I){var J;if(c.isArray(I)||typeof I==="object"){J=I}else{J=c.parseJSON(I)}if(H){H.removeClass("loading")}G._loadData(J,F);if(E){return E()}}})};A.prototype.getNodeById=function(C){return this.tree.getNodeById(C)};A.prototype.getNodeByName=function(C){return this.tree.getNodeByName(C)};A.prototype.openNode=function(C,D){return this._openNode(C,D)};A.prototype._openNode=function(C,E,F){var D;if(C.isFolder()){if(C.load_on_demand){return this._loadFolderOnDemand(C,E,F)}else{D=new q(C,this);D.open(F,E);return this._saveState()}}};A.prototype._loadFolderOnDemand=function(C,D,E){var F=this;C.load_on_demand=false;return this.loadData(this._getDataUrl(C),C,function(){return F._openNode(C,D,E)})};A.prototype.closeNode=function(C,D){if(C.isFolder()){new q(C,this).close(D);return this._saveState()}};A.prototype.isDragging=function(){return this.is_dragging};A.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};A.prototype.addNodeAfter=function(D,C){var E;E=C.addAfter(D);this._refreshElements(C.parent);return E};A.prototype.addNodeBefore=function(D,C){var E;E=C.addBefore(D);this._refreshElements(C.parent);return E};A.prototype.addParentNode=function(D,C){var E;E=C.addParent(D);this._refreshElements(E.parent);return E};A.prototype.removeNode=function(D){var C;C=D.parent;if(C){D.remove();return this._refreshElements(C.parent)}};A.prototype.appendNode=function(E,F){var C,D;if(!F){F=this.tree}C=F.isFolder();D=F.append(E);if(C){this._refreshElements(F)}else{this._refreshElements(F.parent)}return D};A.prototype.prependNode=function(D,E){var C;if(!E){E=this.tree}C=E.prepend(D);this._refreshElements(E);return C};A.prototype.updateNode=function(C,D){C.setData(D);this._refreshElements(C.parent);return this.select_node_handler.selectCurrentNode()};A.prototype.moveNode=function(E,F,C){var D;D=z.nameToIndex(C);this.tree.moveNode(E,F,D);return this._refreshElements()};A.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};A.prototype._init=function(){A.__super__._init.call(this);this.element=this.$el;this.selected_node=null;this.mouse_delay=300;this.save_state_handler=new b(this);this.select_node_handler=new m(this);this.dnd_handler=new n(this);this._initData();this.element.click(c.proxy(this._click,this));return this.element.bind("contextmenu",c.proxy(this._contextmenu,this))};A.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return A.__super__._deinit.call(this)};A.prototype._initData=function(){if(this.options.data){return this.loadData(this.options.data)}else{return this.loadData(this._getDataUrl())}};A.prototype._getDataUrl=function(D){var C;C=this.options.dataUrl||this.element.data("url");if(c.isFunction(C)){return C(D)}else{if(D){C+="?node="+D.id}return C}};A.prototype._initTree=function(C){this.tree=new s();this.tree.loadFromData(C);this._openNodes();this._refreshElements();this.select_node_handler.selectCurrentNode();return this._triggerEvent("tree.init")};A.prototype._openNodes=function(){var C;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){C=-1}else{C=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(D,E){D.is_open=true;return E!==C})};A.prototype._refreshElements=function(F){var K,J,C,E,M,I,G,L,D,H=this;if(F==null){F=null}G=function(N){if(H.options.autoEscape){return i(N)}else{return N}};M=function(O){var N;if(O){N=' class="jqtree-tree"'}else{N=""}return c("<ul"+N+"></ul>")};C=function(N){var O;if(N.isFolder()){O=J(N)}else{O=E(N)}if(H.options.onCreateLi){H.options.onCreateLi(N,O)}return O};E=function(O){var N;N=G(O.name);return c('<li><div><span class="jqtree-title">'+N+"</span></div></li>")};J=function(R){var N,P,O,T,Q,S;Q=function(){var U;U=["jqtree-toggler"];if(!R.is_open){U.push("jqtree-closed")}return U.join(" ")};S=function(){var U;U=["jqtree-folder"];if(!R.is_open){U.push("jqtree-closed")}return U.join(" ")};P=Q();T=S();O=G(R.name);if(R.is_open){N=t}else{N=j}return c('<li class="'+T+'"><div><a class="'+P+'">'+N+'</a><span class="jqtree-title">'+O+"</span></div></li>")};I=function(U,O,V,P){var S,R,N,Q,T;R=M(V);U.append(R);for(Q=0,T=O.length;Q<T;Q++){N=O[Q];S=C(N);R.append(S);N.element=S[0];S.data("node",N);if(N.hasChildren()){I(S,N.children,false,N.is_open)}}return null};if(F&&F.parent){L=false;D=this._getNodeElementForNode(F);D.getUl().remove();K=D.$element}else{F=this.tree;K=this.element;K.empty();L=true}I(K,F.children,L,L);return this._triggerEvent("tree.refresh")};A.prototype._click=function(E){var C,D;if(E.ctrlKey){return}C=c(E.target);if(C.is(".jqtree-toggler")){D=this._getNode(C);if(D){this.toggle(D);E.preventDefault();return E.stopPropagation()}}else{if(C.is("div")||C.is("span")){D=this._getNode(C);if(D){this._triggerEvent("tree.click",{node:D});return this.selectNode(D)}}}};A.prototype._getNode=function(C){var D;D=C.closest("li");if(D.length===0){return null}else{return D.data("node")}};A.prototype._getNodeElementForNode=function(C){if(C.isFolder()){return new q(C,this)}else{return new g(C,this)}};A.prototype._getNodeElement=function(C){var D;D=this._getNode(C);if(D){return this._getNodeElementForNode(D)}else{return null}};A.prototype._contextmenu=function(E){var C,D;C=c(E.target).closest("ul.jqtree-tree div");if(C.length){D=this._getNode(C);if(D){E.preventDefault();E.stopPropagation();this._triggerEvent("tree.contextmenu",{node:D,click_event:E});return false}}};A.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};A.prototype._mouseCapture=function(C){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(C)}else{return false}};A.prototype._mouseStart=function(C){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(C)}else{return false}};A.prototype._mouseDrag=function(C){if(this.options.dragAndDrop){return this.dnd_handler.mouseDrag(C)}else{return false}};A.prototype._mouseStop=function(){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop()}else{return false}};A.prototype._triggerEvent=function(E,C){var D;D=c.Event(E);c.extend(D,C);this.element.trigger(D);return D};A.prototype.testGenerateHitAreas=function(C){this.dnd_handler.current_item=this._getNodeElementForNode(C);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};return A})(e);k.register(d,"tree");p=(function(){function A(D,C,B){this.$element=C;this.node=D;this.$ghost=c('<li class="jqtree-ghost"><span class="jqtree-circle"></span><span class="jqtree-line"></span></li>');if(B===z.AFTER){this.moveAfter()}else{if(B===z.BEFORE){this.moveBefore()}else{if(B===z.INSIDE){if(D.isFolder()&&D.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}A.prototype.remove=function(){return this.$ghost.remove()};A.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};A.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};A.prototype.moveInsideOpenFolder=function(){return c(this.node.children[0].element).before(this.$ghost)};A.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return A})();h=(function(){function A(C){var B,D;B=C.children("div");D=C.width()-4;this.$hint=c('<span class="jqtree-border"></span>');B.append(this.$hint);this.$hint.css({width:D,height:B.height()-4})}A.prototype.remove=function(){return this.$hint.remove()};return A})();g=(function(){function A(B,C){this.init(B,C)}A.prototype.init=function(B,C){this.node=B;this.tree_widget=C;return this.$element=c(B.element)};A.prototype.getUl=function(){return this.$element.children("ul:first")};A.prototype.getSpan=function(){return this.$element.children("div").find("span.jqtree-title")};A.prototype.getLi=function(){return this.$element};A.prototype.addDropHint=function(B){if(B===z.INSIDE){return new h(this.$element)}else{return new p(this.node,this.$element,B)}};A.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};A.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return A})();q=(function(B){w(A,B);function A(){return A.__super__.constructor.apply(this,arguments)}A.prototype.open=function(F,E){var D,C,G=this;if(!this.node.is_open){this.node.is_open=true;D=this.getButton();D.removeClass("jqtree-closed");D.html(t);C=function(){G.getLi().removeClass("jqtree-closed");if(F){F()}return G.tree_widget._triggerEvent("tree.open",{node:G.node})};if(E){this.getUl().show();return C()}else{return this.getUl().slideDown("fast",C)}}};A.prototype.close=function(E){var D,C,F=this;if(this.node.is_open){this.node.is_open=false;D=this.getButton();D.addClass("jqtree-closed");D.html(j);C=function(){F.getLi().addClass("jqtree-closed");return F.tree_widget._triggerEvent("tree.close",{node:F.node})};if(E){this.getUl().hide();return C()}else{return this.getUl().slideUp("fast",C)}}};A.prototype.getButton=function(){return this.$element.children("div").find("a.jqtree-toggler")};A.prototype.addDropHint=function(C){if(!this.node.is_open&&C===z.INSIDE){return new h(this.$element)}else{return new p(this.node,this.$element,C)}};return A})(g);u=(function(){function A(D,C,B,E){this.offset_x=C;this.offset_y=B;this.$element=c('<span class="jqtree-title jqtree-dragging">'+D.name+"</span>");this.$element.css("position","absolute");E.append(this.$element)}A.prototype.move=function(C,B){return this.$element.offset({left:C-this.offset_x,top:B-this.offset_y})};A.prototype.remove=function(){return this.$element.remove()};return A})();b=(function(){function A(B){this.tree_widget=B}A.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(this.getState())}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),this.getState())}else{if(c.cookie){return c.cookie(this.getCookieName(),this.getState(),{path:"/"})}}}};A.prototype.restoreState=function(){var B;B=this.getStateFromStorage();if(B){this.setState(B);return true}else{return false}};A.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.getItem(this.getCookieName())}else{if(c.cookie){return c.cookie(this.getCookieName(),{path:"/"})}else{return null}}}};A.prototype.getState=function(){var C,B,D=this;C=[];this.tree_widget.tree.iterate(function(E){if(E.is_open&&E.id&&E.hasChildren()){C.push(E.id)}return true});B="";if(this.tree_widget.selected_node){B=this.tree_widget.selected_node.id}return JSON.stringify({open_nodes:C,selected_node:B})};A.prototype.setState=function(D){var C,E,B,F=this;C=c.parseJSON(D);if(C){E=C.open_nodes;B=C.selected_node;return this.tree_widget.tree.iterate(function(G){if(G.id&&G.hasChildren()&&(a(E,G.id)>=0)){G.is_open=true}if(B&&(G.id===B)){F.tree_widget.selected_node=G}return true})}};A.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return A})();m=(function(){function A(B){this.tree_widget=B}A.prototype.selectNode=function(C,E){var D,B,F=this;D=function(){if(!F.tree_widget.options.selectable){return false}if(!F.tree_widget.options.onCanSelectNode){return true}return F.tree_widget.options.onCanSelectNode(C)};if(D()){if(this.tree_widget.selected_node){this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node).deselect();this.tree_widget.selected_node=null}if(C){this.tree_widget._getNodeElementForNode(C).select();this.tree_widget.selected_node=C;this.tree_widget._triggerEvent("tree.select",{node:C});if(E){B=this.tree_widget.selected_node.parent;while(B){if(!B.is_open){this.tree_widget.openNode(B,true)}B=B.parent}}}if(this.tree_widget.options.saveState){return this.tree_widget.save_state_handler.saveState()}}};A.prototype.selectCurrentNode=function(){var B;if(this.tree_widget.selected_node){B=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node);if(B){return B.select()}}};return A})();n=(function(){function A(B){this.tree_widget=B;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}A.prototype.mouseCapture=function(C){var B,D;B=c(C.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(B)){return null}D=this.tree_widget._getNodeElement(B);if(D&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(D.node)){D=null}}this.current_item=D;return this.current_item!==null};A.prototype.mouseStart=function(C){var B,E,D;this.refreshHitAreas();D=this.getOffsetFromEvent(C),B=D[0],E=D[1];this.drag_element=new u(this.current_item.node,B,E,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};A.prototype.mouseDrag=function(C){var B,D;this.drag_element.move(C.pageX,C.pageY);B=this.findHoveredArea(C.pageX,C.pageY);if(B&&this.tree_widget.options.onCanMoveTo){D=z.getName(B.position);if(!this.tree_widget.options.onCanMoveTo(this.current_item.node,B.node,D)){B=null}}if(!B){this.removeDropHint();this.removeHover();this.stopOpenFolderTimer()}else{if(this.hovered_area!==B){this.hovered_area=B;this.updateDropHint()}}return true};A.prototype.mouseStop=function(){this.moveItem();this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("jqtree-moving");this.is_dragging=false;return false};A.prototype.getOffsetFromEvent=function(C){var B;B=c(C.target).offset();return[C.pageX-B.left,C.pageY-B.top]};A.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};A.prototype.removeHitAreas=function(){return this.hit_areas=[]};A.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};A.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};A.prototype.removeHover=function(){return this.hovered_area=null};A.prototype.generateHitAreas=function(){var B,I,D,H,F,M,C,G,E,K,J,L=this;J=[];K=0;I=function(N){return N.offset().top};B=function(O,N,P){J.push({top:P,node:O,position:N});return K=P};D=function(S){var R,N,Q,P,O;Q=-1;R=[];for(P=0,O=J.length;P<O;P++){N=J[P];if(N.top!==Q){if(R.length){S(R,Q,N.top)}Q=N.top;R=[]}R.push(N)}return S(R,Q,L.tree_widget.element.offset().top+L.tree_widget.element.height())};C=function(P,O,N){var Q;Q=I(N);if(P===L.current_item.node){B(P,z.NONE,Q)}else{B(P,z.INSIDE,Q)}if(O===L.current_item.node||P===L.current_item.node){return B(P,z.NONE,Q)}else{return B(P,z.AFTER,Q)}};G=function(O,N){if(O===L.current_item.node){return false}if(O.children[0]!==L.current_item.node){B(O,z.INSIDE,I(N))}return true};H=function(P,O,N){if(P===L.current_item.node||O===L.current_item.node){return B(P,z.NONE,K)}else{return B(P,z.AFTER,K)}};F=function(P,O,N){var Q;Q=I(N);if(P===L.current_item.node){return B(P,z.NONE,Q)}else{B(P,z.INSIDE,Q);if(O!==L.current_item.node){return B(P,z.AFTER,Q)}}};M=function(O,N){if(O!==L.current_item.node){return B(O,z.BEFORE,I(c(O.element)))}};this.iterateVisibleNodes(C,G,F,H,M);E=[];D(function(Q,U,P){var R,T,N,S,O;R=(P-U)/Q.length;T=U;for(S=0,O=Q.length;S<O;S++){N=Q[S];E.push({top:T,bottom:T+R,node:N.node,position:N.position});T+=R}return null});return this.hit_areas=E};A.prototype.iterateVisibleNodes=function(D,I,C,G,E){var F,B,H=this;F=true;B=function(L,J){var S,K,R,O,P,M,Q,N;P=(L.is_open||!L.element)&&L.hasChildren();if(L.element){S=c(L.element);if(!S.is(":visible")){return}if(F){E(L,S);F=false}if(!L.hasChildren()){D(L,J,S)}else{if(L.is_open){if(!I(L,S)){P=false}}else{C(L,J,S)}}}if(P){R=L.children.length;N=L.children;for(O=M=0,Q=N.length;M<Q;O=++M){K=N[O];if(O===(R-1)){B(L.children[O],null)}else{B(L.children[O],L.children[O+1])}}if(L.is_open){return G(L,J,S)}}};return B(this.tree_widget.tree)};A.prototype.findHoveredArea=function(C,H){var F,G,B,E,D;D=this.tree_widget.element.offset();if(C<D.left||H<D.top||C>(D.left+this.tree_widget.element.width())||H>(D.top+this.tree_widget.element.height())){return null}B=0;G=this.hit_areas.length;while(B<G){E=(B+G)>>1;F=this.hit_areas[E];if(H<F.top){G=E}else{if(H>F.bottom){B=E+1}else{return F}}}return null};A.prototype.updateDropHint=function(){var B,C;this.stopOpenFolderTimer();if(!this.hovered_area){return}B=this.hovered_area.node;if(B.isFolder()&&!B.is_open&&this.hovered_area.position===z.INSIDE){this.startOpenFolderTimer(B)}this.removeDropHint();C=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=C.addDropHint(this.hovered_area.position)};A.prototype.startOpenFolderTimer=function(C){var B,D=this;B=function(){return D.tree_widget._openNode(C,false,function(){D.refreshHitAreas();return D.updateDropHint()})};return this.open_folder_timer=setTimeout(B,500)};A.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};A.prototype.moveItem=function(){var D,F,E,B,C,G,H=this;if(this.hovered_area&&this.hovered_area.position!==z.NONE){E=this.current_item.node;G=this.hovered_area.node;B=this.hovered_area.position;C=E.parent;if(B===z.INSIDE){this.hovered_area.node.is_open=true}D=function(){H.tree_widget.tree.moveNode(E,G,B);H.tree_widget.element.empty();return H.tree_widget._refreshElements()};F=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:E,target_node:G,position:z.getName(B),previous_parent:C,do_move:D}});if(!F.isDefaultPrevented()){return D()}}};return A})();this.Tree.Node=v}).call(this);