(function(){var e,j,q,v,t,s,f,g,w,i,B,d,m,p,n,k,a,A,h,z,u,y,l,c,b,r=[].slice,o={}.hasOwnProperty,x=function(F,D){for(var C in D){if(o.call(D,C)){F[C]=D[C]}}function E(){this.constructor=F}E.prototype=D.prototype;F.prototype=new E();F.__super__=D.prototype;return F};e=this.jQuery;n=(function(){C.prototype.defaults={};function C(E,D){this.$el=e(E);this.options=e.extend({},this.defaults,D)}C.prototype.destroy=function(){return this._deinit()};C.prototype._init=function(){return null};C.prototype._deinit=function(){return null};C.register=function(I,G){var H,F,D,E;E=function(){return"simple_widget_"+G};F=function(L,K){var N,M,P,O,J;N=E();for(O=0,J=L.length;O<J;O++){M=L[O];P=new I(M,K);if(!e.data(M,N)){e.data(M,N,P)}P._init()}return L};D=function(L){var N,M,P,O,K,J;N=E();J=[];for(O=0,K=L.length;O<K;O++){M=L[O];P=e.data(M,N);if(P&&(P instanceof C)){P.destroy()}J.push(e.removeData(M,N))}return J};H=function(Q,N,O){var J,R,M,K,L,P;R=null;for(L=0,P=Q.length;L<P;L++){J=Q[L];M=e.data(J,E());if(M&&(M instanceof C)){K=M[N];if(K&&(typeof K==="function")){R=K.apply(M,O)}}}return R};return e.fn[G]=function(){var L,K,M,N,J;M=arguments[0],K=2<=arguments.length?r.call(arguments,1):[];L=this;if(M===void 0||typeof M==="object"){J=M;return F(L,J)}else{if(typeof M==="string"&&M[0]!=="_"){N=M;if(N==="destroy"){return D(L)}else{return H(L,N,K)}}}}};return C})();this.SimpleWidget=n;g=(function(C){x(D,C);function D(){l=D.__super__.constructor.apply(this,arguments);return l}D.is_mouse_handled=false;D.prototype._init=function(){this.$el.bind("mousedown.mousewidget",e.proxy(this._mouseDown,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;return this._is_mouse_delay_met=true};D.prototype._deinit=function(){var E;this.$el.unbind("mousedown.mousewidget");E=e(document);E.unbind("mousemove.mousewidget");return E.unbind("mouseup.mousewidget")};D.prototype._mouseDown=function(E){var F;if(D.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(E)}if(E.which!==1){return}if(!this._mouseCapture(E)){return}this.mouse_down_event=E;F=e(document);F.bind("mousemove.mousewidget",e.proxy(this._mouseMove,this));F.bind("mouseup.mousewidget",e.proxy(this._mouseUp,this));if(this.mouse_delay){this._startMouseDelayTimer()}E.preventDefault();this.is_mouse_handled=true;return true};D.prototype._startMouseDelayTimer=function(){var E=this;if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(){return E._is_mouse_delay_met=true},this.mouse_delay);return this._is_mouse_delay_met=false};D.prototype._mouseMove=function(E){if(this.is_mouse_started){this._mouseDrag(E);return E.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(E)}else{this._mouseUp(E)}return !this.is_mouse_started};D.prototype._mouseUp=function(E){var F;F=e(document);F.unbind("mousemove.mousewidget");F.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(E)}return false};D.prototype._mouseCapture=function(E){return true};D.prototype._mouseStart=function(E){return null};D.prototype._mouseDrag=function(E){return null};D.prototype._mouseStop=function(E){return null};D.prototype.setMouseDelay=function(E){return this.mouse_delay=E};return D})(n);this.Tree={};e=this.jQuery;y=function(H,E){var D,G,F,C;for(D=F=0,C=H.length;F<C;D=++F){G=H[D];if(G===E){return D}}return -1};a=function(D,C){if(D.indexOf){return D.indexOf(C)}else{return y(D,C)}};this.Tree.indexOf=a;this.Tree._indexOf=y;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){A=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};z=function(C){A.lastIndex=0;if(A.test(C)){return'"'+C.replace(A,function(D){var E;E=h[D];return(typeof E==="string"?E:"\\u"+("0000"+D.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+C+'"'}};u=function(J,G){var E,C,F,K,I,D,H;I=G[J];switch(typeof I){case"string":return z(I);case"number":if(isFinite(I)){return String(I)}else{return"null"}case"boolean":case"null":return String(I);case"object":if(!I){return"null"}F=[];if(Object.prototype.toString.apply(I)==="[object Array]"){for(E=D=0,H=I.length;D<H;E=++D){K=I[E];F[E]=u(E,I)||"null"}return(F.length===0?"[]":"["+F.join(",")+"]")}for(C in I){if(Object.prototype.hasOwnProperty.call(I,C)){K=u(C,I);if(K){F.push(z(C)+":"+K)}}}return(F.length===0?"{}":"{"+F.join(",")+"}")}};if(this.JSON==null){this.JSON={}}this.JSON.stringify=function(C){return u("",{"":C})}}k=function(C){return(""+C).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};B={getName:function(C){return B.strings[C-1]},nameToIndex:function(D){var E,F,C;for(E=F=1,C=B.strings.length;1<=C?F<=C:F>=C;E=1<=C?++F:--F){if(B.strings[E-1]===D){return E}}return 0}};B.BEFORE=1;B.AFTER=2;B.INSIDE=3;B.NONE=4;B.strings=["before","after","inside","none"];this.Tree.Position=B;w=(function(){function C(E,D,F){if(D==null){D=false}if(F==null){F=C}this.setData(E);this.children=[];this.parent=null;if(D){this.id_mapping={};this.tree=this;this.node_class=F}}C.prototype.setData=function(G){var E,F,D;if(typeof G!=="object"){return this.name=G}else{D=[];for(E in G){F=G[E];if(E==="label"){D.push(this.name=F)}else{D.push(this[E]=F)}}return D}};C.prototype.initFromData=function(E){var D,F,G=this;F=function(H){G.setData(H);if(H.children){return D(H.children)}};D=function(K){var L,I,J,H;for(J=0,H=K.length;J<H;J++){L=K[J];I=new G.tree.node_class("");I.initFromData(L);G.addChild(I)}return null};F(E);return null};C.prototype.loadFromData=function(G){var E,H,F,D;this.removeChildren();for(F=0,D=G.length;F<D;F++){H=G[F];E=new this.tree.node_class(H);this.addChild(E);if(typeof H==="object"&&H.children){E.loadFromData(H.children)}}return null};C.prototype.addChild=function(D){this.children.push(D);return D._setParent(this)};C.prototype.addChildAtPosition=function(E,D){this.children.splice(D,0,E);return E._setParent(this)};C.prototype._setParent=function(D){this.parent=D;this.tree=D.tree;return this.tree.addNodeToIndex(this)};C.prototype.removeChild=function(D){D.removeChildren();return this._removeChild(D)};C.prototype._removeChild=function(D){this.children.splice(this.getChildIndex(D),1);return this.tree.removeNodeFromIndex(D)};C.prototype.getChildIndex=function(D){return e.inArray(D,this.children)};C.prototype.hasChildren=function(){return this.children.length!==0};C.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};C.prototype.iterate=function(F){var D,E=this;D=function(J,M){var L,H,K,I,G;if(J.children){G=J.children;for(K=0,I=G.length;K<I;K++){L=G[K];H=F(L,M);if(E.hasChildren()&&H){D(L,M+1)}}return null}};D(this,0);return null};C.prototype.moveNode=function(E,F,D){if(E.isParentOf(F)){return}E.parent._removeChild(E);if(D===B.AFTER){return F.parent.addChildAtPosition(E,F.parent.getChildIndex(F)+1)}else{if(D===B.BEFORE){return F.parent.addChildAtPosition(E,F.parent.getChildIndex(F))}else{if(D===B.INSIDE){return F.addChildAtPosition(E,0)}}}};C.prototype.getData=function(){var D,E=this;D=function(I){var M,H,K,J,G,L,F;M=[];for(L=0,F=I.length;L<F;L++){K=I[L];J={};for(H in K){G=K[H];if((H!=="parent"&&H!=="children"&&H!=="element"&&H!=="tree")&&Object.prototype.hasOwnProperty.call(K,H)){J[H]=G}}if(K.hasChildren()){J.children=D(K.children)}M.push(J)}return M};return D(this.children)};C.prototype.getNodeByName=function(E){var D;D=null;this.iterate(function(F){if(F.name===E){D=F;return false}else{return true}});return D};C.prototype.addAfter=function(E){var F,D;if(!this.parent){return null}else{D=new this.tree.node_class(E);F=this.parent.getChildIndex(this);this.parent.addChildAtPosition(D,F+1);return D}};C.prototype.addBefore=function(E){var F,D;if(!this.parent){return null}else{D=new this.tree.node_class(E);F=this.parent.getChildIndex(this);this.parent.addChildAtPosition(D,F);return D}};C.prototype.addParent=function(H){var J,I,G,F,E,D;if(!this.parent){return null}else{I=new this.tree.node_class(H);I._setParent(this.tree);G=this.parent;D=G.children;for(F=0,E=D.length;F<E;F++){J=D[F];I.addChild(J)}G.children=[];G.addChild(I);return I}};C.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};C.prototype.append=function(E){var D;D=new this.tree.node_class(E);this.addChild(D);return D};C.prototype.prepend=function(E){var D;D=new this.tree.node_class(E);this.addChildAtPosition(D,0);return D};C.prototype.isParentOf=function(E){var D;D=E.parent;while(D){if(D===this){return true}D=D.parent}return false};C.prototype.getLevel=function(){var E,D;E=0;D=this;while(D.parent){E+=1;D=D.parent}return E};C.prototype.getNodeById=function(D){return this.id_mapping[D]};C.prototype.addNodeToIndex=function(D){if(D.id){return this.id_mapping[D.id]=D}};C.prototype.removeNodeFromIndex=function(D){if(D.id){return delete this.id_mapping[D.id]}};C.prototype.removeChildren=function(){var D=this;this.iterate(function(E){D.tree.removeNodeFromIndex(E);return true});return this.children=[]};return C})();this.Tree.Node=w;f=(function(D){x(C,D);function C(){c=C.__super__.constructor.apply(this,arguments);return c}C.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:w};C.prototype.toggle=function(F,E){if(E==null){E=true}if(F.is_open){return this.closeNode(F,E)}else{return this.openNode(F,E)}};C.prototype.getTree=function(){return this.tree};C.prototype.selectNode=function(E){return this._selectNode(E,true)};C.prototype._selectNode=function(G,E){var H,J,F,I=this;if(E==null){E=false}H=function(){if(!I.options.onCanSelectNode){return I.options.selectable}return I.options.selectable&&I.options.onCanSelectNode(G)};J=function(){var K;K=G.parent;if(!K.is_open&&K.parent){return I.openNode(K,false)}};F=function(){if(I.options.saveState){return I.save_state_handler.saveState()}};if(!G){this._deselectCurrentNode();F;return}if(!H()){return}if(this.select_node_handler.isNodeSelected(G)){if(E){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null})}}else{this._deselectCurrentNode();this.addToSelection(G);this._triggerEvent("tree.select",{node:G});J()}return F()};C.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};C.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};C.prototype.loadData=function(E,F){return this._loadData(E,F)};C.prototype.loadDataFromUrl=function(E,G,F){if(e.type(E)!=="string"){F=G;G=E;E=null}return this._loadDataFromUrl(E,G,F)};C.prototype._loadDataFromUrl=function(E,K,I){var G,J,F,H,L=this;G=null;J=function(){var M;if(!K){G=L.element}else{M=new t(K,L);G=M.getLi()}return G.addClass("jqtree-loading")};H=function(){if(G){return G.removeClass("jqtree-loading")}};F=function(){if(e.type(E)==="string"){E={url:E}}if(!E.method){return E.method="get"}};J();if(!E){E=this._getDataUrlInfo(K)}F();return e.ajax({url:E.url,data:E.data,type:E.method.toUpperCase(),cache:false,dataType:"json",success:function(M){var N;if(e.isArray(M)||typeof M==="object"){N=M}else{N=e.parseJSON(M)}H();L._loadData(N,K);if(I&&e.isFunction(I)){return I()}},error:function(M){H();if(L.options.onLoadFailed){return L.options.onLoadFailed(M)}}})};C.prototype._loadData=function(H,I){var J,F,G,E;this._triggerEvent("tree.load_data",{tree_data:H});if(!I){this._initTree(H,false,this.options.nodeClass)}else{F=this.select_node_handler.getSelectedNodes(I);for(G=0,E=F.length;G<E;G++){J=F[G];this.select_node_handler.removeFromSelection(J)}I.loadFromData(H);I.load_on_demand=false;this._refreshElements(I.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};C.prototype.getNodeById=function(E){return this.tree.getNodeById(E)};C.prototype.getNodeByName=function(E){return this.tree.getNodeByName(E)};C.prototype.openNode=function(F,E){if(E==null){E=true}return this._openNode(F,E)};C.prototype._openNode=function(G,E,H){var J,F,I=this;if(E==null){E=true}J=function(L,M,K){var N;N=new t(L,I);return N.open(K,M)};if(G.isFolder()){if(G.load_on_demand){return this._loadFolderOnDemand(G,E,H)}else{F=G.parent;while(F&&!F.is_open){if(F.parent){J(F,false,null)}F=F.parent}J(G,E,H);return this._saveState()}}};C.prototype._loadFolderOnDemand=function(F,E,G){var H=this;if(E==null){E=true}return this._loadDataFromUrl(null,F,function(){return H._openNode(F,E,G)})};C.prototype.closeNode=function(F,E){if(E==null){E=true}if(F.isFolder()){new t(F,this).close(E);return this._saveState()}};C.prototype.isDragging=function(){return this.is_dragging};C.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};C.prototype.addNodeAfter=function(F,E){var G;G=E.addAfter(F);this._refreshElements(E.parent);return G};C.prototype.addNodeBefore=function(F,E){var G;G=E.addBefore(F);this._refreshElements(E.parent);return G};C.prototype.addParentNode=function(F,E){var G;G=E.addParent(F);this._refreshElements(G.parent);return G};C.prototype.removeNode=function(F){var E;E=F.parent;if(E){this.select_node_handler.removeFromSelection(F,true);F.remove();return this._refreshElements(E.parent)}};C.prototype.appendNode=function(G,H){var E,F;if(!H){H=this.tree}E=H.isFolder();F=H.append(G);if(E){this._refreshElements(H)}else{this._refreshElements(H.parent)}return F};C.prototype.prependNode=function(F,G){var E;if(!G){G=this.tree}E=G.prepend(F);this._refreshElements(G);return E};C.prototype.updateNode=function(E,F){E.setData(F);this._refreshElements(E.parent);return this._selectCurrentNode()};C.prototype.moveNode=function(G,H,E){var F;F=B.nameToIndex(E);this.tree.moveNode(G,H,F);return this._refreshElements()};C.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};C.prototype.addToSelection=function(E){this.select_node_handler.addToSelection(E);return this._getNodeElementForNode(E).select()};C.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};C.prototype.isNodeSelected=function(E){return this.select_node_handler.isNodeSelected(E)};C.prototype.removeFromSelection=function(E){this.select_node_handler.removeFromSelection(E);return this._getNodeElementForNode(E).deselect()};C.prototype.scrollToNode=function(F){var E,G;E=e(F.element);G=E.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(G)};C.prototype._init=function(){C.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.save_state_handler=new d(this);this.select_node_handler=new p(this);this.dnd_handler=new q(this);this.scroll_handler=new m(this);this._initData();this.element.click(e.proxy(this._click,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",e.proxy(this._contextmenu,this))}};C.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return C.__super__._deinit.call(this)};C.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};C.prototype._getDataUrlInfo=function(G){var H,F,E;F=this.options.dataUrl||this.element.data("url");if(e.isFunction(F)){return F(G)}else{if(e.type(F)==="string"){E={url:F};if(G&&G.id){H={node:G.id};E.data=H}return E}else{return F}}};C.prototype._initTree=function(E){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);this.select_node_handler.clear();this.tree.loadFromData(E);this._openNodes();this._refreshElements();return this._triggerEvent("tree.init")};C.prototype._openNodes=function(){var E;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){E=-1}else{E=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(F,G){if(F.hasChildren()){F.is_open=true}return G!==E})};C.prototype._refreshElements=function(H){var M,L,E,G,O,K,I,N,F,J=this;if(H==null){H=null}I=function(P){if(J.options.autoEscape){return k(P)}else{return P}};O=function(Q){var P;if(Q){P="jqtree-tree"}else{P=""}return e('<ul class="jqtree_common '+P+'"></ul>')};E=function(P){var Q;if(P.isFolder()){Q=L(P)}else{Q=G(P)}if(J.options.onCreateLi){J.options.onCreateLi(P,Q)}return Q};G=function(Q){var S,P,R;R=["jqtree_common"];if(J.select_node_handler.isNodeSelected(Q)){R.push("jqtree-selected")}S=R.join(" ");P=I(Q.name);return e('<li class="'+S+'"><div class="jqtree-element jqtree_common"><span class="jqtree-title jqtree_common">'+P+"</span></div></li>")};L=function(T){var P,R,Q,V,S,U;S=function(){var W;W=["jqtree-toggler"];if(!T.is_open){W.push("jqtree-closed")}return W.join(" ")};U=function(){var W;W=["jqtree-folder"];if(!T.is_open){W.push("jqtree-closed")}if(J.select_node_handler.isNodeSelected(T)){W.push("jqtree-selected")}return W.join(" ")};R=S();V=U();Q=I(T.name);if(T.is_open){P=J.options.openedIcon}else{P=J.options.closedIcon}return e('<li class="jqtree_common '+V+'"><div class="jqtree-element jqtree_common"><a class="jqtree_common '+R+'">'+P+'</a><span class="jqtree_common jqtree-title">'+Q+"</span></div></li>")};K=function(W,Q,X,R){var U,T,P,S,V;T=O(X);W.append(T);for(S=0,V=Q.length;S<V;S++){P=Q[S];U=E(P);T.append(U);P.element=U[0];U.data("node",P);if(P.hasChildren()){K(U,P.children,false,P.is_open)}}return null};if(H&&H.parent){N=false;F=this._getNodeElementForNode(H);F.getUl().remove();M=F.$element}else{H=this.tree;M=this.element;M.empty();N=true}K(M,H.children,N,N);return this._triggerEvent("tree.refresh")};C.prototype._click=function(J){var I,F,E,H,G;if(J.ctrlKey){return}E=e(J.target);I=E.closest(".jqtree-toggler");if(I.length){G=this._getNode(I);if(G){this.toggle(G,this.options.slide);J.preventDefault();return J.stopPropagation()}}else{F=E.closest(".jqtree-element");if(F.length){G=this._getNode(F);if(G){H=this._triggerEvent("tree.click",{node:G});if(!H.isDefaultPrevented()){return this._selectNode(G,true)}}}}};C.prototype._getNode=function(E){var F;F=E.closest("li");if(F.length===0){return null}else{return F.data("node")}};C.prototype._getNodeElementForNode=function(E){if(E.isFolder()){return new t(E,this)}else{return new i(E,this)}};C.prototype._getNodeElement=function(E){var F;F=this._getNode(E);if(F){return this._getNodeElementForNode(F)}else{return null}};C.prototype._contextmenu=function(G){var E,F;E=e(G.target).closest("ul.jqtree-tree .jqtree-element");if(E.length){F=this._getNode(E);if(F){G.preventDefault();G.stopPropagation();this._triggerEvent("tree.contextmenu",{node:F,click_event:G});return false}}};C.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};C.prototype._mouseCapture=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(E)}else{return false}};C.prototype._mouseStart=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(E)}else{return false}};C.prototype._mouseDrag=function(F){var E;if(this.options.dragAndDrop){E=this.dnd_handler.mouseDrag(F);this.scroll_handler.checkScrolling();return E}else{return false}};C.prototype._mouseStop=function(E){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(E)}else{return false}};C.prototype._triggerEvent=function(G,E){var F;F=e.Event(G);e.extend(F,E);this.element.trigger(F);return F};C.prototype.testGenerateHitAreas=function(E){this.dnd_handler.current_item=this._getNodeElementForNode(E);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};C.prototype._selectCurrentNode=function(){var E,F;E=this.getSelectedNode();if(E){F=this._getNodeElementForNode(E);if(F){return F.select()}}};C.prototype._deselectCurrentNode=function(){var E;E=this.getSelectedNode();if(E){return this.removeFromSelection(E)}};return C})(g);n.register(f,"tree");s=(function(){function C(F,E,D){this.$element=E;this.node=F;this.$ghost=e('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(D===B.AFTER){this.moveAfter()}else{if(D===B.BEFORE){this.moveBefore()}else{if(D===B.INSIDE){if(F.isFolder()&&F.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}C.prototype.remove=function(){return this.$ghost.remove()};C.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};C.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};C.prototype.moveInsideOpenFolder=function(){return e(this.node.children[0].element).before(this.$ghost)};C.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return C})();j=(function(){function C(E){var D,F;D=E.children(".jqtree-element");F=E.width()-4;this.$hint=e('<span class="jqtree-border"></span>');D.append(this.$hint);this.$hint.css({width:F,height:D.height()-4})}C.prototype.remove=function(){return this.$hint.remove()};return C})();i=(function(){function C(D,E){this.init(D,E)}C.prototype.init=function(D,E){this.node=D;this.tree_widget=E;return this.$element=e(D.element)};C.prototype.getUl=function(){return this.$element.children("ul:first")};C.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};C.prototype.getLi=function(){return this.$element};C.prototype.addDropHint=function(D){if(D===B.INSIDE){return new j(this.$element)}else{return new s(this.node,this.$element,D)}};C.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};C.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return C})();t=(function(D){x(C,D);function C(){b=C.__super__.constructor.apply(this,arguments);return b}C.prototype.open=function(H,E){var G,F,I=this;if(E==null){E=true}if(!this.node.is_open){this.node.is_open=true;G=this.getButton();G.removeClass("jqtree-closed");G.html(this.tree_widget.options.openedIcon);F=function(){I.getLi().removeClass("jqtree-closed");if(H){H()}return I.tree_widget._triggerEvent("tree.open",{node:I.node})};if(E){return this.getUl().slideDown("fast",F)}else{this.getUl().show();return F()}}};C.prototype.close=function(E){var G,F,H=this;if(E==null){E=true}if(this.node.is_open){this.node.is_open=false;G=this.getButton();G.addClass("jqtree-closed");G.html(this.tree_widget.options.closedIcon);F=function(){H.getLi().addClass("jqtree-closed");return H.tree_widget._triggerEvent("tree.close",{node:H.node})};if(E){return this.getUl().slideUp("fast",F)}else{this.getUl().hide();return F()}}};C.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};C.prototype.addDropHint=function(E){if(!this.node.is_open&&E===B.INSIDE){return new j(this.$element)}else{return new s(this.node,this.$element,E)}};return C})(i);v=(function(){function C(F,E,D,G){this.offset_x=E;this.offset_y=D;this.$element=e('<span class="jqtree-title jqtree-dragging">'+F.name+"</span>");this.$element.css("position","absolute");G.append(this.$element)}C.prototype.move=function(E,D){return this.$element.offset({left:E-this.offset_x,top:D-this.offset_y})};C.prototype.remove=function(){return this.$element.remove()};return C})();d=(function(){function C(D){this.tree_widget=D}C.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(this.getState())}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),this.getState())}else{if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName(),this.getState(),{path:"/"})}}}};C.prototype.restoreState=function(){var D;D=this.getStateFromStorage();if(D){this.setState(D);return true}else{return false}};C.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.getItem(this.getCookieName())}else{if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName())}else{return null}}}};C.prototype.getState=function(){var F,E,D,G=this;F=[];this.tree_widget.tree.iterate(function(H){if(H.is_open&&H.id&&H.hasChildren()){F.push(H.id)}return true});E=this.tree_widget.getSelectedNode();if(E){D=E.id}else{D=""}return JSON.stringify({open_nodes:F,selected_node:D})};C.prototype.setState=function(G){var F,H,E,D,I=this;F=e.parseJSON(G);if(F){H=F.open_nodes;D=F.selected_node;this.tree_widget.tree.iterate(function(J){if(J.id&&J.hasChildren()&&(a(H,J.id)>=0)){J.is_open=true}return true});if(D){E=this.tree_widget.getNodeById(D);if(E){return this.tree_widget.select_node_handler.addToSelection(E)}}}};C.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return C})();p=(function(){function C(D){this.tree_widget=D;this.clear()}C.prototype.getSelectedNode=function(){var D;D=this.getSelectedNodes();if(D.length){return D[0]}else{return false}};C.prototype.getSelectedNodes=function(){var F,E,D;if(this.selected_single_node){return[this.selected_single_node]}else{D=[];for(F in this.selected_nodes){E=this.tree_widget.getNodeById(F);if(E){D.push(E)}}return D}};C.prototype.isNodeSelected=function(D){if(D.id){return this.selected_nodes[D.id]}else{if(this.selected_single_node){return this.selected_single_node.element===D.element}else{return false}}};C.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};C.prototype.removeFromSelection=function(D,F){var E=this;if(F==null){F=false}if(!D.id){if(D.element===this.selected_single_node){return this.selected_single_node=null}}else{delete this.selected_nodes[D.id];if(F){return D.iterate(function(G){delete E.selected_nodes[D.id];return true})}}};C.prototype.addToSelection=function(D){if(D.id){return this.selected_nodes[D.id]=true}else{return this.selected_single_node=D}};return C})();q=(function(){function C(D){this.tree_widget=D;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}C.prototype.mouseCapture=function(E){var D,F;D=e(E.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(D)){return null}F=this.tree_widget._getNodeElement(D);if(F&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(F.node)){F=null}}this.current_item=F;return this.current_item!==null};C.prototype.mouseStart=function(E){var D,G,F;this.refreshHitAreas();F=this.getOffsetFromEvent(E),D=F[0],G=F[1];this.drag_element=new v(this.current_item.node,D,G,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};C.prototype.mouseDrag=function(F){var E,D;this.drag_element.move(F.pageX,F.pageY);E=this.findHoveredArea(F.pageX,F.pageY);D=this.canMoveToArea(E);if(E){if(this.hovered_area!==E){this.hovered_area=E;if(this.mustOpenFolderTimer(E)){this.startOpenFolderTimer(E.node)}if(D){this.updateDropHint()}}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};C.prototype.canMoveToArea=function(D){var E;if(!D){return false}else{if(this.tree_widget.options.onCanMoveTo){E=B.getName(D.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,D.node,E)}else{return true}}};C.prototype.mouseStop=function(D){this.moveItem(D);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("jqtree-moving");this.is_dragging=false;return false};C.prototype.getOffsetFromEvent=function(E){var D;D=e(E.target).offset();return[E.pageX-D.left,E.pageY-D.top]};C.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};C.prototype.removeHitAreas=function(){return this.hit_areas=[]};C.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};C.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};C.prototype.removeHover=function(){return this.hovered_area=null};C.prototype.generateHitAreas=function(){var D,K,F,J,H,O,E,I,G,M,L,N=this;L=[];M=0;K=function(P){return P.offset().top};D=function(Q,P,R){L.push({top:R,node:Q,position:P});return M=R};F=function(U){var T,P,S,R,Q;S=-1;T=[];for(R=0,Q=L.length;R<Q;R++){P=L[R];if(P.top!==S){if(T.length){U(T,S,P.top)}S=P.top;T=[]}T.push(P)}return U(T,S,N.tree_widget.element.offset().top+N.tree_widget.element.height())};E=function(R,Q,P){var S;S=K(P);if(R===N.current_item.node){D(R,B.NONE,S)}else{D(R,B.INSIDE,S)}if(Q===N.current_item.node||R===N.current_item.node){return D(R,B.NONE,S)}else{return D(R,B.AFTER,S)}};I=function(Q,P){if(Q===N.current_item.node){return false}if(Q.children[0]!==N.current_item.node){D(Q,B.INSIDE,K(P))}return true};J=function(R,Q,P){if(R===N.current_item.node||Q===N.current_item.node){return D(R,B.NONE,M)}else{return D(R,B.AFTER,M)}};H=function(R,Q,P){var S;S=K(P);if(R===N.current_item.node){return D(R,B.NONE,S)}else{D(R,B.INSIDE,S);if(Q!==N.current_item.node){return D(R,B.AFTER,S)}}};O=function(Q,P){if(Q!==N.current_item.node){return D(Q,B.BEFORE,K(e(Q.element)))}};this.iterateVisibleNodes(E,I,H,J,O);G=[];F(function(S,W,R){var T,V,P,U,Q;T=(R-W)/S.length;V=W;for(U=0,Q=S.length;U<Q;U++){P=S[U];G.push({top:V,bottom:V+T,node:P.node,position:P.position});V+=T}return null});return this.hit_areas=G};C.prototype.iterateVisibleNodes=function(F,K,E,I,G){var H,D,J=this;H=true;D=function(O,L){var U,M,T,Q,R,P,S,N;R=(O.is_open||!O.element)&&O.hasChildren();if(O.element){U=e(O.element);if(!U.is(":visible")){return}if(H){G(O,U);H=false}if(!O.hasChildren()){F(O,L,U)}else{if(O.is_open){if(!K(O,U)){R=false}}else{E(O,L,U)}}}if(R){T=O.children.length;N=O.children;for(Q=P=0,S=N.length;P<S;Q=++P){M=N[Q];if(Q===(T-1)){D(O.children[Q],null)}else{D(O.children[Q],O.children[Q+1])}}if(O.is_open){return I(O,L,U)}}};return D(this.tree_widget.tree)};C.prototype.findHoveredArea=function(E,J){var H,I,D,G,F;F=this.tree_widget.element.offset();if(E<F.left||J<F.top||E>(F.left+this.tree_widget.element.width())||J>(F.top+this.tree_widget.element.height())){return null}D=0;I=this.hit_areas.length;while(D<I){G=(D+I)>>1;H=this.hit_areas[G];if(J<H.top){I=G}else{if(J>H.bottom){D=G+1}else{return H}}}return null};C.prototype.mustOpenFolderTimer=function(E){var D;D=E.node;return D.isFolder()&&!D.is_open&&E.position===B.INSIDE};C.prototype.updateDropHint=function(){var D;if(!this.hovered_area){return}this.removeDropHint();D=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=D.addDropHint(this.hovered_area.position)};C.prototype.startOpenFolderTimer=function(E){var D,F=this;D=function(){return F.tree_widget._openNode(E,F.tree_widget.options.slide,function(){F.refreshHitAreas();return F.updateDropHint()})};return this.open_folder_timer=setTimeout(D,500)};C.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};C.prototype.moveItem=function(J){var F,H,G,D,E,I,K=this;if(this.hovered_area&&this.hovered_area.position!==B.NONE&&this.canMoveToArea(this.hovered_area)){G=this.current_item.node;I=this.hovered_area.node;D=this.hovered_area.position;E=G.parent;if(D===B.INSIDE){this.hovered_area.node.is_open=true}F=function(){K.tree_widget.tree.moveNode(G,I,D);K.tree_widget.element.empty();return K.tree_widget._refreshElements()};H=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:G,target_node:I,position:B.getName(D),previous_parent:E,do_move:F,original_event:J}});if(!H.isDefaultPrevented()){return F()}}};return C})();m=(function(){function C(D){this.tree_widget=D;this.previous_top=-1;this._initScrollParent()}C.prototype._initScrollParent=function(){var D,E,F,G=this;E=function(){var O,L,Q,H,N,M,P,I,K,J;L=["overflow","overflow-y"];H=null;K=G.tree_widget.$el.parents();for(N=0,P=K.length;N<P;N++){Q=K[N];for(M=0,I=L.length;M<I;M++){O=L[M];if((J=e.css(Q,O))==="auto"||J==="scroll"){return e(Q)}}}return null};F=function(){G.scroll_parent_top=0;return G.$scroll_parent=null};if(this.tree_widget.$el.css("position")==="fixed"){F()}D=E();if(D&&D.length&&D[0].tagName!=="HTML"){this.$scroll_parent=D;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return F()}};C.prototype.checkScrolling=function(){var D;D=this.tree_widget.dnd_handler.hovered_area;if(D&&D.top!==this.previous_top){this.previous_top=D.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(D)}else{return this._handleScrollingWithDocument(D)}}};C.prototype._handleScrollingWithScrollParent=function(E){var D;D=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-E.bottom;if(D<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((E.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};C.prototype._handleScrollingWithDocument=function(E){var D;D=E.top-e(document).scrollTop();if(D<20){return e(document).scrollTop(e(document).scrollTop()-20)}else{if(e(window).height()-(E.bottom-e(document).scrollTop())<20){return e(document).scrollTop(e(document).scrollTop()+20)}}};C.prototype.scrollTo=function(E){var D;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=E}else{D=this.tree_widget.$el.offset().top;return e(document).scrollTop(E+D)}};return C})()}).call(this);