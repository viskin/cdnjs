(function(){var c,h,o,u,r,q,d,e,v,g,A,b,k,n,l,t,j,i,a,z,f,y,s,x,p=[].slice,m={}.hasOwnProperty,w=function(E,C){for(var B in C){if(m.call(C,B)){E[B]=C[B]}}function D(){this.constructor=E}D.prototype=C.prototype;E.prototype=new D();E.__super__=C.prototype;return E};c=this.jQuery;l=(function(){B.prototype.defaults={};function B(D,C){this.$el=c(D);this.options=c.extend({},this.defaults,C)}B.prototype.destroy=function(){return this._deinit()};B.prototype._init=function(){return null};B.prototype._deinit=function(){return null};B.register=function(H,F){var G,E,C,D;D=function(){return"simple_widget_"+F};E=function(K,J){var M,L,O,N,I;M=D();for(N=0,I=K.length;N<I;N++){L=K[N];O=new H(L,J);if(!c.data(L,M)){c.data(L,M,O)}O._init()}return K};C=function(K){var M,L,O,N,J,I;M=D();I=[];for(N=0,J=K.length;N<J;N++){L=K[N];O=c.data(L,M);if(O&&(O instanceof B)){O.destroy()}I.push(c.removeData(L,M))}return I};G=function(P,M,N){var I,Q,L,J,K,O;Q=null;for(K=0,O=P.length;K<O;K++){I=P[K];L=c.data(I,D());if(L&&(L instanceof B)){J=L[M];if(J&&(typeof J==="function")){Q=J.apply(L,N)}}}return Q};return c.fn[F]=function(){var K,J,L,M,I;L=arguments[0],J=2<=arguments.length?p.call(arguments,1):[];K=this;if(L===void 0||typeof L==="object"){I=L;return E(K,I)}else{if(typeof L==="string"&&L[0]!=="_"){M=L;if(M==="destroy"){return C(K)}else{return G(K,M,J)}}}}};return B})();this.SimpleWidget=l;e=(function(B){w(C,B);function C(){return C.__super__.constructor.apply(this,arguments)}C.is_mouse_handled=false;C.prototype._init=function(){this.$el.bind("mousedown.mousewidget",c.proxy(this._mouseDown,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;return this._is_mouse_delay_met=true};C.prototype._deinit=function(){var D;this.$el.unbind("mousedown.mousewidget");D=c(document);D.unbind("mousemove.mousewidget");return D.unbind("mouseup.mousewidget")};C.prototype._mouseDown=function(D){var E;if(C.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(D)}if(D.which!==1){return}if(!this._mouseCapture(D)){return}this.mouse_down_event=D;E=c(document);E.bind("mousemove.mousewidget",c.proxy(this._mouseMove,this));E.bind("mouseup.mousewidget",c.proxy(this._mouseUp,this));if(this.mouse_delay){this._startMouseDelayTimer()}D.preventDefault();this.is_mouse_handled=true;return true};C.prototype._startMouseDelayTimer=function(){var D=this;if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(){return D._is_mouse_delay_met=true},this.mouse_delay);return this._is_mouse_delay_met=false};C.prototype._mouseMove=function(D){if(this.is_mouse_started){this._mouseDrag(D);return D.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(D)}else{this._mouseUp(D)}return !this.is_mouse_started};C.prototype._mouseUp=function(D){var E;E=c(document);E.unbind("mousemove.mousewidget");E.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(D)}return false};C.prototype._mouseCapture=function(D){return true};C.prototype._mouseStart=function(D){return null};C.prototype._mouseDrag=function(D){return null};C.prototype._mouseStop=function(D){return null};C.prototype.setMouseDelay=function(D){return this.mouse_delay=D};return C})(l);this.Tree={};c=this.jQuery;x=function(G,D){var C,F,E,B;for(C=E=0,B=G.length;E<B;C=++E){F=G[C];if(F===D){return C}}return -1};a=function(C,B){if(C.indexOf){return C.indexOf(B)}else{return x(C,B)}};this.Tree.indexOf=a;this.Tree._indexOf=x;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){z=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};y=function(B){z.lastIndex=0;if(z.test(B)){return'"'+B.replace(z,function(C){var D;D=f[C];return(typeof D==="string"?D:"\\u"+("0000"+C.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+B+'"'}};s=function(I,F){var D,B,E,J,H,C,G;H=F[I];switch(typeof H){case"string":return y(H);case"number":if(isFinite(H)){return String(H)}else{return"null"}case"boolean":case"null":return String(H);case"object":if(!H){return"null"}E=[];if(Object.prototype.toString.apply(H)==="[object Array]"){for(D=C=0,G=H.length;C<G;D=++C){J=H[D];E[D]=s(D,H)||"null"}return(E.length===0?"[]":"["+E.join(",")+"]")}for(B in H){if(Object.prototype.hasOwnProperty.call(H,B)){J=s(B,H);if(J){E.push(y(B)+":"+J)}}}return(E.length===0?"{}":"{"+E.join(",")+"}")}};if(this.JSON==null){this.JSON={}}this.JSON.stringify=function(B){return s("",{"":B})}}i=function(B){return(""+B).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};A={getName:function(B){return A.strings[B-1]},nameToIndex:function(B){var C,E,D;for(C=E=1,D=A.strings.length;1<=D?E<=D:E>=D;C=1<=D?++E:--E){if(A.strings[C-1]===B){return C}}return 0}};A.BEFORE=1;A.AFTER=2;A.INSIDE=3;A.NONE=4;A.strings=["before","after","inside","none"];this.Tree.Position=A;v=(function(){function B(D,C,E){if(C==null){C=false}if(E==null){E=B}this.setData(D);this.children=[];this.parent=null;if(C){this.id_mapping={};this.tree=this;this.node_class=E}}B.prototype.setData=function(F){var D,E,C;if(typeof F!=="object"){return this.name=F}else{C=[];for(D in F){E=F[D];if(D==="label"){C.push(this.name=E)}else{C.push(this[D]=E)}}return C}};B.prototype.initFromData=function(D){var C,E,F=this;E=function(G){F.setData(G);if(G.children){return C(G.children)}};C=function(J){var K,H,I,G;for(I=0,G=J.length;I<G;I++){K=J[I];H=new F.tree.node_class("");H.initFromData(K);F.addChild(H)}return null};E(D);return null};B.prototype.loadFromData=function(F){var D,G,E,C;this.removeChildren();for(E=0,C=F.length;E<C;E++){G=F[E];D=new this.tree.node_class(G);this.addChild(D);if(typeof G==="object"&&G.children){D.loadFromData(G.children)}}return null};B.prototype.addChild=function(C){this.children.push(C);return C._setParent(this)};B.prototype.addChildAtPosition=function(D,C){this.children.splice(C,0,D);return D._setParent(this)};B.prototype._setParent=function(C){this.parent=C;this.tree=C.tree;return this.tree.addNodeToIndex(this)};B.prototype.removeChild=function(C){C.removeChildren();return this._removeChild(C)};B.prototype._removeChild=function(C){this.children.splice(this.getChildIndex(C),1);return this.tree.removeNodeFromIndex(C)};B.prototype.getChildIndex=function(C){return c.inArray(C,this.children)};B.prototype.hasChildren=function(){return this.children.length!==0};B.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};B.prototype.iterate=function(E){var C,D=this;C=function(H,L){var K,F,J,G,I;if(H.children){I=H.children;for(J=0,G=I.length;J<G;J++){K=I[J];F=E(K,L);if(D.hasChildren()&&F){C(K,L+1)}}return null}};C(this,0);return null};B.prototype.moveNode=function(D,E,C){if(D.isParentOf(E)){return}D.parent._removeChild(D);if(C===A.AFTER){return E.parent.addChildAtPosition(D,E.parent.getChildIndex(E)+1)}else{if(C===A.BEFORE){return E.parent.addChildAtPosition(D,E.parent.getChildIndex(E))}else{if(C===A.INSIDE){return E.addChildAtPosition(D,0)}}}};B.prototype.getData=function(){var C,D=this;C=function(H){var L,G,J,I,F,K,E;L=[];for(K=0,E=H.length;K<E;K++){J=H[K];I={};for(G in J){F=J[G];if((G!=="parent"&&G!=="children"&&G!=="element"&&G!=="tree")&&Object.prototype.hasOwnProperty.call(J,G)){I[G]=F}}if(J.hasChildren()){I.children=C(J.children)}L.push(I)}return L};return C(this.children)};B.prototype.getNodeByName=function(D){var C;C=null;this.iterate(function(E){if(E.name===D){C=E;return false}else{return true}});return C};B.prototype.addAfter=function(D){var E,C;if(!this.parent){return null}else{C=new this.tree.node_class(D);E=this.parent.getChildIndex(this);this.parent.addChildAtPosition(C,E+1);return C}};B.prototype.addBefore=function(D){var E,C;if(!this.parent){return null}else{C=new this.tree.node_class(D);E=this.parent.getChildIndex(this);this.parent.addChildAtPosition(C,E);return C}};B.prototype.addParent=function(G){var I,H,F,E,C,D;if(!this.parent){return null}else{H=new this.tree.node_class(G);H._setParent(this.tree);F=this.parent;D=F.children;for(E=0,C=D.length;E<C;E++){I=D[E];H.addChild(I)}F.children=[];F.addChild(H);return H}};B.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};B.prototype.append=function(D){var C;C=new this.tree.node_class(D);this.addChild(C);return C};B.prototype.prepend=function(D){var C;C=new this.tree.node_class(D);this.addChildAtPosition(C,0);return C};B.prototype.isParentOf=function(D){var C;C=D.parent;while(C){if(C===this){return true}C=C.parent}return false};B.prototype.getLevel=function(){var D,C;D=0;C=this;while(C.parent){D+=1;C=C.parent}return D};B.prototype.getNodeById=function(C){return this.id_mapping[C]};B.prototype.addNodeToIndex=function(C){if(C.id){return this.id_mapping[C.id]=C}};B.prototype.removeNodeFromIndex=function(C){if(C.id){return delete this.id_mapping[C.id]}};B.prototype.removeChildren=function(){var C=this;this.iterate(function(D){C.tree.removeNodeFromIndex(D);return true});return this.children=[]};return B})();this.Tree.Node=v;j="&#x25ba;";t="&#x25bc;";d=(function(C){w(B,C);function B(){return B.__super__.constructor.apply(this,arguments)}B.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:false,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,slide:true,nodeClass:v};B.prototype.toggle=function(E,D){if(D==null){D=true}if(E.is_open){return this.closeNode(E,D)}else{return this.openNode(E,D)}};B.prototype.getTree=function(){return this.tree};B.prototype.selectNode=function(D){return this.select_node_handler.selectNode(D)};B.prototype.getSelectedNode=function(){return this.selected_node||false};B.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};B.prototype.loadData=function(D,E){this._loadData(D,E);if(!E){return this.selected_node=null}};B.prototype.loadDataFromUrl=function(D,F,E){if(c.type(D)!=="string"){F=D;E=F;D=null;E=null}this._loadDataFromUrl(D,F,E);if(!F){return this.selected_node=null}};B.prototype._loadDataFromUrl=function(D,J,H){var F,I,E,G,K=this;F=null;I=function(){var L;if(!J){F=K.element}else{L=new r(J,K);F=L.getLi()}return F.addClass("jqtree-loading")};G=function(){if(F){return F.removeClass("jqtree-loading")}};E=function(){if(c.type(D)==="string"){D={url:D}}if(!D.method){return D.method="get"}};I();if(!D){D=this._getDataUrlInfo(J)}E();return c.ajax({url:D.url,data:D.data,type:D.method.toUpperCase(),cache:false,dataType:"json",success:function(L){var M;if(c.isArray(L)||typeof L==="object"){M=L}else{M=c.parseJSON(L)}G();K._loadData(M,J);if(H&&c.isFunction(H)){return H()}},error:function(L){G();if(K.options.onLoadFailed){return K.options.onLoadFailed(L)}}})};B.prototype._loadData=function(D,E){this._triggerEvent("tree.load_data",{tree_data:D});if(!E){this._initTree(D,false,this.options.nodeClass)}else{if(this.selected_node&&E.isParentOf(this.selected_node)){this.selected_node=null}E.loadFromData(D);E.load_on_demand=false;this._refreshElements(E.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};B.prototype.getNodeById=function(D){return this.tree.getNodeById(D)};B.prototype.getNodeByName=function(D){return this.tree.getNodeByName(D)};B.prototype.openNode=function(E,D){if(D==null){D=true}return this._openNode(E,D)};B.prototype._openNode=function(F,D,G){var I,E,H=this;if(D==null){D=true}I=function(K,L,J){var M;M=new r(K,H);return M.open(J,L)};if(F.isFolder()){if(F.load_on_demand){return this._loadFolderOnDemand(F,D,G)}else{E=F.parent;while(E&&!E.is_open){if(E.parent){I(E,false,null)}E=E.parent}I(F,D,G);return this._saveState()}}};B.prototype._loadFolderOnDemand=function(E,D,F){var G=this;if(D==null){D=true}return this._loadDataFromUrl(null,E,function(){return G._openNode(E,D,F)})};B.prototype.closeNode=function(E,D){if(D==null){D=true}if(E.isFolder()){new r(E,this).close(D);return this._saveState()}};B.prototype.isDragging=function(){return this.is_dragging};B.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};B.prototype.addNodeAfter=function(E,D){var F;F=D.addAfter(E);this._refreshElements(D.parent);return F};B.prototype.addNodeBefore=function(E,D){var F;F=D.addBefore(E);this._refreshElements(D.parent);return F};B.prototype.addParentNode=function(E,D){var F;F=D.addParent(E);this._refreshElements(F.parent);return F};B.prototype.removeNode=function(F){var D,E,G=this;D=function(){var H;if(!G.selected_node){return false}else{if(G.selected_node===F){return true}else{H=true;G.tree.iterate(function(I){if(F===I){H=true;return false}else{return true}});return H}}};E=F.parent;if(E){if(D()){this.selected_node=null}F.remove();return this._refreshElements(E.parent)}};B.prototype.appendNode=function(F,G){var D,E;if(!G){G=this.tree}D=G.isFolder();E=G.append(F);if(D){this._refreshElements(G)}else{this._refreshElements(G.parent)}return E};B.prototype.prependNode=function(E,F){var D;if(!F){F=this.tree}D=F.prepend(E);this._refreshElements(F);return D};B.prototype.updateNode=function(D,E){D.setData(E);this._refreshElements(D.parent);return this.select_node_handler.selectCurrentNode()};B.prototype.moveNode=function(F,G,D){var E;E=A.nameToIndex(D);this.tree.moveNode(F,G,E);return this._refreshElements()};B.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};B.prototype._init=function(){B.__super__._init.call(this);this.element=this.$el;this.selected_node=null;this.mouse_delay=300;this.save_state_handler=new b(this);this.select_node_handler=new n(this);this.dnd_handler=new o(this);this.scroll_handler=new k(this);this._initData();this.element.click(c.proxy(this._click,this));return this.element.bind("contextmenu",c.proxy(this._contextmenu,this))};B.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return B.__super__._deinit.call(this)};B.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};B.prototype._getDataUrlInfo=function(F){var G,E,D;E=this.options.dataUrl||this.element.data("url");if(c.isFunction(E)){return E(F)}else{if(c.type(E)==="string"){D={url:E};if(F&&F.id){G={node:F.id};D.data=G}return D}else{return E}}};B.prototype._initTree=function(D){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);this.tree.loadFromData(D);this._openNodes();this._refreshElements();return this._triggerEvent("tree.init")};B.prototype._openNodes=function(){var D;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){D=-1}else{D=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(E,F){if(E.hasChildren()){E.is_open=true}return F!==D})};B.prototype._refreshElements=function(G){var L,K,D,F,N,J,H,M,E,I=this;if(G==null){G=null}H=function(O){if(I.options.autoEscape){return i(O)}else{return O}};N=function(P){var O;if(P){O="jqtree-tree"}else{O=""}return c('<ul class="jqtree_common '+O+'"></ul>')};D=function(O){var P;if(O.isFolder()){P=K(O)}else{P=F(O)}if(I.options.onCreateLi){I.options.onCreateLi(O,P)}return P};F=function(P){var R,O,Q;Q=["jqtree_common"];if(P===I.selected_node){Q.push("jqtree-selected")}R=Q.join(" ");O=H(P.name);return c('<li class="'+R+'"><div class="jqtree-element jqtree_common"><span class="jqtree-title jqtree_common">'+O+"</span></div></li>")};K=function(S){var O,Q,P,U,R,T;R=function(){var V;V=["jqtree-toggler"];if(!S.is_open){V.push("jqtree-closed")}return V.join(" ")};T=function(){var V;V=["jqtree-folder"];if(!S.is_open){V.push("jqtree-closed")}if(S===I.selected_node){V.push("jqtree-selected")}return V.join(" ")};Q=R();U=T();P=H(S.name);if(S.is_open){O=t}else{O=j}return c('<li class="jqtree_common '+U+'"><div class="jqtree-element jqtree_common"><a class="jqtree_common '+Q+'">'+O+'</a><span class="jqtree_common jqtree-title">'+P+"</span></div></li>")};J=function(V,P,W,Q){var T,S,O,R,U;S=N(W);V.append(S);for(R=0,U=P.length;R<U;R++){O=P[R];T=D(O);S.append(T);O.element=T[0];T.data("node",O);if(O.hasChildren()){J(T,O.children,false,O.is_open)}}return null};if(G&&G.parent){M=false;E=this._getNodeElementForNode(G);E.getUl().remove();L=E.$element}else{G=this.tree;L=this.element;L.empty();M=true}J(L,G.children,M,M);return this._triggerEvent("tree.refresh")};B.prototype._click=function(H){var G,E,D,F;if(H.ctrlKey){return}D=c(H.target);G=D.closest(".jqtree-toggler");if(G.length){F=this._getNode(G);if(F){this.toggle(F,this.options.slide);H.preventDefault();return H.stopPropagation()}}else{E=D.closest(".jqtree-element");if(E.length){F=this._getNode(E);if(F){this._triggerEvent("tree.click",{node:F});return this.select_node_handler.selectNode(F,true)}}}};B.prototype._getNode=function(D){var E;E=D.closest("li");if(E.length===0){return null}else{return E.data("node")}};B.prototype._getNodeElementForNode=function(D){if(D.isFolder()){return new r(D,this)}else{return new g(D,this)}};B.prototype._getNodeElement=function(D){var E;E=this._getNode(D);if(E){return this._getNodeElementForNode(E)}else{return null}};B.prototype._contextmenu=function(F){var D,E;D=c(F.target).closest("ul.jqtree-tree .jqtree-element");if(D.length){E=this._getNode(D);if(E){F.preventDefault();F.stopPropagation();this._triggerEvent("tree.contextmenu",{node:E,click_event:F});return false}}};B.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};B.prototype._mouseCapture=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(D)}else{return false}};B.prototype._mouseStart=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(D)}else{return false}};B.prototype._mouseDrag=function(E){var D;if(this.options.dragAndDrop){D=this.dnd_handler.mouseDrag(E);this.scroll_handler.checkScrolling();return D}else{return false}};B.prototype._mouseStop=function(D){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(D)}else{return false}};B.prototype._triggerEvent=function(F,D){var E;E=c.Event(F);c.extend(E,D);this.element.trigger(E);return E};B.prototype.testGenerateHitAreas=function(D){this.dnd_handler.current_item=this._getNodeElementForNode(D);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};return B})(e);l.register(d,"tree");q=(function(){function B(E,D,C){this.$element=D;this.node=E;this.$ghost=c('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(C===A.AFTER){this.moveAfter()}else{if(C===A.BEFORE){this.moveBefore()}else{if(C===A.INSIDE){if(E.isFolder()&&E.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}B.prototype.remove=function(){return this.$ghost.remove()};B.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};B.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};B.prototype.moveInsideOpenFolder=function(){return c(this.node.children[0].element).before(this.$ghost)};B.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return B})();h=(function(){function B(D){var C,E;C=D.children(".jqtree-element");E=D.width()-4;this.$hint=c('<span class="jqtree-border"></span>');C.append(this.$hint);this.$hint.css({width:E,height:C.height()-4})}B.prototype.remove=function(){return this.$hint.remove()};return B})();g=(function(){function B(C,D){this.init(C,D)}B.prototype.init=function(C,D){this.node=C;this.tree_widget=D;return this.$element=c(C.element)};B.prototype.getUl=function(){return this.$element.children("ul:first")};B.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};B.prototype.getLi=function(){return this.$element};B.prototype.addDropHint=function(C){if(C===A.INSIDE){return new h(this.$element)}else{return new q(this.node,this.$element,C)}};B.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};B.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return B})();r=(function(C){w(B,C);function B(){return B.__super__.constructor.apply(this,arguments)}B.prototype.open=function(G,D){var F,E,H=this;if(D==null){D=true}if(!this.node.is_open){this.node.is_open=true;F=this.getButton();F.removeClass("jqtree-closed");F.html(t);E=function(){H.getLi().removeClass("jqtree-closed");if(G){G()}return H.tree_widget._triggerEvent("tree.open",{node:H.node})};if(D){return this.getUl().slideDown("fast",E)}else{this.getUl().show();return E()}}};B.prototype.close=function(D){var F,E,G=this;if(D==null){D=true}if(this.node.is_open){this.node.is_open=false;F=this.getButton();F.addClass("jqtree-closed");F.html(j);E=function(){G.getLi().addClass("jqtree-closed");return G.tree_widget._triggerEvent("tree.close",{node:G.node})};if(D){return this.getUl().slideUp("fast",E)}else{this.getUl().hide();return E()}}};B.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};B.prototype.addDropHint=function(D){if(!this.node.is_open&&D===A.INSIDE){return new h(this.$element)}else{return new q(this.node,this.$element,D)}};return B})(g);u=(function(){function B(E,D,C,F){this.offset_x=D;this.offset_y=C;this.$element=c('<span class="jqtree-title jqtree-dragging">'+E.name+"</span>");this.$element.css("position","absolute");F.append(this.$element)}B.prototype.move=function(D,C){return this.$element.offset({left:D-this.offset_x,top:C-this.offset_y})};B.prototype.remove=function(){return this.$element.remove()};return B})();b=(function(){function B(C){this.tree_widget=C}B.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(this.getState())}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),this.getState())}else{if(c.cookie){c.cookie.raw=true;return c.cookie(this.getCookieName(),this.getState(),{path:"/"})}}}};B.prototype.restoreState=function(){var C;C=this.getStateFromStorage();if(C){this.setState(C);return true}else{return false}};B.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.getItem(this.getCookieName())}else{if(c.cookie){c.cookie.raw=true;return c.cookie(this.getCookieName())}else{return null}}}};B.prototype.getState=function(){var D,C,E=this;D=[];this.tree_widget.tree.iterate(function(F){if(F.is_open&&F.id&&F.hasChildren()){D.push(F.id)}return true});C="";if(this.tree_widget.selected_node){C=this.tree_widget.selected_node.id}return JSON.stringify({open_nodes:D,selected_node:C})};B.prototype.setState=function(E){var D,F,C,G=this;D=c.parseJSON(E);if(D){F=D.open_nodes;C=D.selected_node;return this.tree_widget.tree.iterate(function(H){if(H.id&&H.hasChildren()&&(a(F,H.id)>=0)){H.is_open=true}if(C&&(H.id===C)){G.tree_widget.selected_node=H}return true})}};B.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return B})();n=(function(){function B(C){this.tree_widget=C}B.prototype.selectNode=function(G,C){var H,F,J,E,D,I=this;if(C==null){C=false}H=function(){if(!I.tree_widget.options.onCanSelectNode){return true}return I.tree_widget.options.onCanSelectNode(G)};F=function(K,L){if(C&&K&&L){if(L.id){return L.id===K.id}else{return L.element===K.element}}else{return false}};if(H()){if(this.tree_widget.selected_node){D=this.tree_widget.selected_node;this.tree_widget._getNodeElementForNode(D).deselect();this.tree_widget.selected_node=null}else{D=null}if(G){J=this.tree_widget._getNodeElementForNode(G);if(F(D,G)){J.deselect();this.tree_widget._triggerEvent("tree.select",{node:null})}else{J.select();this.tree_widget.selected_node=G;this.tree_widget._triggerEvent("tree.select",{node:G});E=this.tree_widget.selected_node.parent;if(!E.is_open){this.tree_widget.openNode(E,false)}}}if(this.tree_widget.options.saveState){return this.tree_widget.save_state_handler.saveState()}}};B.prototype.selectCurrentNode=function(){var C;if(this.tree_widget.selected_node){C=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node);if(C){return C.select()}}};return B})();o=(function(){function B(C){this.tree_widget=C;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}B.prototype.mouseCapture=function(D){var C,E;C=c(D.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(C)){return null}E=this.tree_widget._getNodeElement(C);if(E&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(E.node)){E=null}}this.current_item=E;return this.current_item!==null};B.prototype.mouseStart=function(D){var C,F,E;this.refreshHitAreas();E=this.getOffsetFromEvent(D),C=E[0],F=E[1];this.drag_element=new u(this.current_item.node,C,F,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};B.prototype.mouseDrag=function(D){var C,E;this.drag_element.move(D.pageX,D.pageY);C=this.findHoveredArea(D.pageX,D.pageY);if(C&&this.tree_widget.options.onCanMoveTo){E=A.getName(C.position);if(!this.tree_widget.options.onCanMoveTo(this.current_item.node,C.node,E)){C=null}}if(!C){this.removeDropHint();this.removeHover();this.stopOpenFolderTimer()}else{if(this.hovered_area!==C){this.hovered_area=C;this.updateDropHint()}}return true};B.prototype.mouseStop=function(C){this.moveItem(C);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("jqtree-moving");this.is_dragging=false;return false};B.prototype.getOffsetFromEvent=function(D){var C;C=c(D.target).offset();return[D.pageX-C.left,D.pageY-C.top]};B.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};B.prototype.removeHitAreas=function(){return this.hit_areas=[]};B.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};B.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};B.prototype.removeHover=function(){return this.hovered_area=null};B.prototype.generateHitAreas=function(){var C,J,E,I,G,N,D,H,F,L,K,M=this;K=[];L=0;J=function(O){return O.offset().top};C=function(P,O,Q){K.push({top:Q,node:P,position:O});return L=Q};E=function(T){var S,O,R,Q,P;R=-1;S=[];for(Q=0,P=K.length;Q<P;Q++){O=K[Q];if(O.top!==R){if(S.length){T(S,R,O.top)}R=O.top;S=[]}S.push(O)}return T(S,R,M.tree_widget.element.offset().top+M.tree_widget.element.height())};D=function(Q,P,O){var R;R=J(O);if(Q===M.current_item.node){C(Q,A.NONE,R)}else{C(Q,A.INSIDE,R)}if(P===M.current_item.node||Q===M.current_item.node){return C(Q,A.NONE,R)}else{return C(Q,A.AFTER,R)}};H=function(P,O){if(P===M.current_item.node){return false}if(P.children[0]!==M.current_item.node){C(P,A.INSIDE,J(O))}return true};I=function(Q,P,O){if(Q===M.current_item.node||P===M.current_item.node){return C(Q,A.NONE,L)}else{return C(Q,A.AFTER,L)}};G=function(Q,P,O){var R;R=J(O);if(Q===M.current_item.node){return C(Q,A.NONE,R)}else{C(Q,A.INSIDE,R);if(P!==M.current_item.node){return C(Q,A.AFTER,R)}}};N=function(P,O){if(P!==M.current_item.node){return C(P,A.BEFORE,J(c(P.element)))}};this.iterateVisibleNodes(D,H,G,I,N);F=[];E(function(R,V,Q){var S,U,O,T,P;S=(Q-V)/R.length;U=V;for(T=0,P=R.length;T<P;T++){O=R[T];F.push({top:U,bottom:U+S,node:O.node,position:O.position});U+=S}return null});return this.hit_areas=F};B.prototype.iterateVisibleNodes=function(E,J,D,H,F){var G,C,I=this;G=true;C=function(M,K){var T,L,S,P,Q,N,R,O;Q=(M.is_open||!M.element)&&M.hasChildren();if(M.element){T=c(M.element);if(!T.is(":visible")){return}if(G){F(M,T);G=false}if(!M.hasChildren()){E(M,K,T)}else{if(M.is_open){if(!J(M,T)){Q=false}}else{D(M,K,T)}}}if(Q){S=M.children.length;O=M.children;for(P=N=0,R=O.length;N<R;P=++N){L=O[P];if(P===(S-1)){C(M.children[P],null)}else{C(M.children[P],M.children[P+1])}}if(M.is_open){return H(M,K,T)}}};return C(this.tree_widget.tree)};B.prototype.findHoveredArea=function(D,I){var G,H,C,F,E;E=this.tree_widget.element.offset();if(D<E.left||I<E.top||D>(E.left+this.tree_widget.element.width())||I>(E.top+this.tree_widget.element.height())){return null}C=0;H=this.hit_areas.length;while(C<H){F=(C+H)>>1;G=this.hit_areas[F];if(I<G.top){H=F}else{if(I>G.bottom){C=F+1}else{return G}}}return null};B.prototype.updateDropHint=function(){var C,D;this.stopOpenFolderTimer();if(!this.hovered_area){return}C=this.hovered_area.node;if(C.isFolder()&&!C.is_open&&this.hovered_area.position===A.INSIDE){this.startOpenFolderTimer(C)}this.removeDropHint();D=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=D.addDropHint(this.hovered_area.position)};B.prototype.startOpenFolderTimer=function(D){var C,E=this;C=function(){return E.tree_widget._openNode(D,E.tree_widget.options.slide,function(){E.refreshHitAreas();return E.updateDropHint()})};return this.open_folder_timer=setTimeout(C,500)};B.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};B.prototype.moveItem=function(I){var E,G,F,C,D,H,J=this;if(this.hovered_area&&this.hovered_area.position!==A.NONE){F=this.current_item.node;H=this.hovered_area.node;C=this.hovered_area.position;D=F.parent;if(C===A.INSIDE){this.hovered_area.node.is_open=true}E=function(){J.tree_widget.tree.moveNode(F,H,C);J.tree_widget.element.empty();return J.tree_widget._refreshElements()};G=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:F,target_node:H,position:A.getName(C),previous_parent:D,do_move:E,original_event:I}});if(!G.isDefaultPrevented()){return E()}}};return B})();k=(function(){function B(C){this.tree_widget=C;this.previous_top=-1;this._initScrollParent()}B.prototype._initScrollParent=function(){var C,D,E,F=this;D=function(){var N,I,P,G,L,K,O,H,M,J;I=["overflow","overflow-y"];G=null;M=F.tree_widget.$el.parents();for(L=0,O=M.length;L<O;L++){P=M[L];for(K=0,H=I.length;K<H;K++){N=I[K];if((J=c.css(P,N))==="auto"||J==="scroll"){return c(P)}}}return null};E=function(){F.scroll_parent_top=0;return F.$scroll_parent=null};if(this.tree_widget.$el.css("position")==="fixed"){E()}C=D();if(C&&C.length&&C[0].tagName!=="HTML"){this.$scroll_parent=C;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return E()}};B.prototype.checkScrolling=function(){var C;C=this.tree_widget.dnd_handler.hovered_area;if(C&&C.top!==this.previous_top){this.previous_top=C.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(C)}else{return this._handleScrollingWithDocument(C)}}};B.prototype._handleScrollingWithScrollParent=function(D){var C;C=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-D.bottom;if(C<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((D.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};B.prototype._handleScrollingWithDocument=function(D){var C;C=D.top-c(document).scrollTop();if(C<20){return c(document).scrollTop(c(document).scrollTop()-20)}else{if(c(window).height()-(D.bottom-c(document).scrollTop())<20){return c(document).scrollTop(c(document).scrollTop()+20)}}};return B})()}).call(this);