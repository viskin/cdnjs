(function(){var c,g,o,l,k,d,b,e,p,f,r,h,m,a,n,j=[].slice,i={}.hasOwnProperty,q=function(v,t){for(var s in t){if(i.call(t,s)){v[s]=t[s]}}function u(){this.constructor=v}u.prototype=t.prototype;v.prototype=new u;v.__super__=t.prototype;return v};c=this.jQuery;h=(function(){s.name="SimpleWidget";s.prototype.defaults={};function s(u,t){this.$el=c(u);this.options=c.extend({},this.defaults,t);this._init()}s.prototype.destroy=function(){return this._deinit()};s.prototype._init=function(){return null};s.prototype._deinit=function(){return null};s.register=function(y,w){var x,v,t,u;u=function(){return"simple_widget_"+w};v=function(A,z){var B;B=u();A.each(function(){var C;C=new y(this,z);if(!c.data(this,B)){return c.data(this,B,C)}});return A};t=function(z){var A;A=u();return z.each(function(){var B;B=c.data(this,A);if(B&&(B instanceof s)){B.destroy()}return c.removeData(this,A)})};x=function(B,C,A){var z;z=null;B.each(function(){var E,D;E=c.data(this,u());if(E&&(E instanceof s)){D=E[C];if(D&&(typeof D==="function")){return z=D.apply(E,A)}}});return z};return c.fn[w]=function(){var B,A,C,D,z;C=arguments[0],A=2<=arguments.length?j.call(arguments,1):[];B=this;if(C===void 0||typeof C==="object"){z=C;return v(B,z)}else{if(typeof C==="string"&&C[0]!=="_"){D=C;if(D==="destroy"){return t(B)}else{return x(B,D,A)}}}}};return s})();this.SimpleWidget=h;e=(function(s){q(t,s);t.name="MouseWidget";function t(){return t.__super__.constructor.apply(this,arguments)}t.is_mouse_handled=false;t.prototype._init=function(){this.$el.bind("mousedown.mousewidget",c.proxy(this._mouseDown,this));return this.is_mouse_started=false};t.prototype._deinit=function(){var u;this.$el.unbind("mousedown.mousewidget");u=c(document);u.unbind("mousemove.mousewidget");return u.unbind("mouseup.mousewidget")};t.prototype._mouseDown=function(u){var v;if(t.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(u)}if(u.which!==1){return}if(!this._mouseCapture(u)){return}this.mouse_down_event=u;v=c(document);v.bind("mousemove.mousewidget",c.proxy(this._mouseMove,this));v.bind("mouseup.mousewidget",c.proxy(this._mouseUp,this));u.preventDefault();this.is_mouse_handled=true;return true};t.prototype._mouseMove=function(u){if(this.is_mouse_started){this._mouseDrag(u);return u.preventDefault()}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(u)}else{this._mouseUp(u)}return !this.is_mouse_started};t.prototype._mouseUp=function(u){var v;v=c(document);v.unbind("mousemove.mousewidget");v.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(u)}return false};t.prototype._mouseCapture=function(u){return true};t.prototype._mouseStart=function(u){return null};t.prototype._mouseDrag=function(u){return null};t.prototype._mouseStop=function(u){return null};return t})(h);this.Tree={};c=this.jQuery;a=function(x,u){var t,w,v,s;if(x.indexOf){return x.indexOf(u)}else{for(t=v=0,s=x.length;v<s;t=++v){w=x[t];if(w===u){return t}}return -1}};this.Tree.indexOf=a;b={};b.escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.quote=function(s){b.escapable.lastIndex=0;if(b.escapable.test(s)){return'"'+s.replace(b.escapable,function(t){var u;u=b.meta[t];return(typeof u==="string"?u:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+s+'"'}};b.str=function(A,x){var u,s,w,B,z,t,y;z=x[A];switch(typeof z){case"string":return b.quote(z);case"number":if(isFinite(z)){return String(z)}else{return"null"}case"boolean":case"null":return String(z);case"object":if(!z){return"null"}w=[];if(Object.prototype.toString.apply(z)==="[object Array]"){for(u=t=0,y=z.length;t<y;u=++t){B=z[u];w[u]=b.str(u,z)||"null"}return(w.length===0?"[]":"["+w.join(",")+"]")}for(s in z){if(Object.prototype.hasOwnProperty.call(z,s)){B=b.str(s,z);if(B){w.push(b.quote(s)+":"+B)}}}return(w.length===0?"{}":"{"+w.join(",")+"}")}};n=function(s){return b.str("",{"":s})};this.Tree.toJson=n;r={getName:function(s){if(s===r.BEFORE){return"before"}else{if(s===r.AFTER){return"after"}else{if(s===r.INSIDE){return"inside"}else{return"none"}}}}};r.BEFORE=1;r.AFTER=2;r.INSIDE=3;r.NONE=4;this.Tree.Position=r;p=(function(){s.name="Node";function s(t){this.setData(t)}s.prototype.setData=function(v){var t,u;if(typeof v!=="object"){this.name=v}else{for(t in v){u=v[t];if(t==="label"){this.name=u}else{this[t]=u}}}this.children=[];return this.parent=null};s.prototype.initFromData=function(u){var t,v,w=this;v=function(x){w.setData(x);if(x.children){return t(x.children)}};t=function(A){var B,y,z,x;for(z=0,x=A.length;z<x;z++){B=A[z];y=new s("");y.initFromData(B);w.addChild(y)}return null};v(u);return null};s.prototype.loadFromData=function(w){var u,x,v,t;this.children=[];for(v=0,t=w.length;v<t;v++){x=w[v];u=new s(x);this.addChild(u);if(typeof x==="object"&&x.children){u.loadFromData(x.children)}}return null};s.prototype.addChild=function(t){this.children.push(t);return t._setParent(this)};s.prototype.addChildAtPosition=function(u,t){this.children.splice(t,0,u);return u._setParent(this)};s.prototype._setParent=function(t){this.parent=t;this.tree=t.tree;return this.tree.addNodeToIndex(this)};s.prototype.removeChild=function(t){this.children.splice(this.getChildIndex(t),1);return this.tree.removeNodeFromIndex(t)};s.prototype.getChildIndex=function(t){return c.inArray(t,this.children)};s.prototype.hasChildren=function(){return this.children.length!==0};s.prototype.iterate=function(v){var t,u=this;t=function(y,C){var B,w,A,x,z;if(y.children){z=y.children;for(A=0,x=z.length;A<x;A++){B=z[A];w=v(B,C);if(u.hasChildren()&&w){t(B,C+1)}}return null}};t(this,0);return null};s.prototype.moveNode=function(u,v,t){u.parent.removeChild(u);if(t===r.AFTER){return v.parent.addChildAtPosition(u,v.parent.getChildIndex(v)+1)}else{if(t===r.BEFORE){return v.parent.addChildAtPosition(u,v.parent.getChildIndex(v))}else{if(t===r.INSIDE){return v.addChildAtPosition(u,0)}}}};s.prototype.getData=function(){var t,u=this;t=function(z){var D,y,B,A,x,C,w;D=[];for(C=0,w=z.length;C<w;C++){B=z[C];A={};for(y in B){x=B[y];if((y!=="parent"&&y!=="children"&&y!=="element"&&y!=="tree")&&Object.prototype.hasOwnProperty.call(B,y)){A[y]=x}}if(B.hasChildren()){A.children=t(B.children)}D.push(A)}return D};return t(this.children)};s.prototype.getNodeByName=function(u){var t;t=null;this.iterate(function(v){if(v.name===u){t=v;return false}else{return true}});return t};s.prototype.addAfter=function(u){var v,t;if(!this.parent){return null}else{t=new s(u);v=this.parent.getChildIndex(this);this.parent.addChildAtPosition(t,v+1);return t}};s.prototype.addBefore=function(u){var v,t;if(!this.parent){return null}else{t=new s(u);v=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,v)}};s.prototype.addParent=function(x){var z,y,w,v,t,u;if(!this.parent){return null}else{y=new s(x);y._setParent(this.tree);w=this.parent;u=w.children;for(v=0,t=u.length;v<t;v++){z=u[v];y.addChild(z)}w.children=[];w.addChild(y);return y}};s.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};s.prototype.append=function(u){var t;t=new s(u);this.addChild(t);return t};s.prototype.prepend=function(u){var t;t=new s(u);this.addChildAtPosition(t,0);return t};return s})();m=(function(s){q(t,s);t.name="Tree";function t(u){t.__super__.constructor.call(this,u,null,true);this.id_mapping={};this.tree=this}t.prototype.getNodeById=function(u){return this.id_mapping[u]};t.prototype.addNodeToIndex=function(u){if(u.id){return this.id_mapping[u.id]=u}};t.prototype.removeNodeFromIndex=function(u){if(u.id){return delete this.id_mapping[u.id]}};return t})(p);this.Tree.Tree=m;d=(function(t){q(s,t);s.name="JqTreeWidget";function s(){return s.__super__.constructor.apply(this,arguments)}s.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:false,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null};s.prototype.toggle=function(u){if(u.hasChildren()){new l(u,this.element).toggle()}if(this.options.saveState){return this._saveState()}};s.prototype.getTree=function(){return this.tree};s.prototype.selectNode=function(v,w){var u;if(this.options.selectable){if(this.selected_node){this._getNodeElementForNode(this.selected_node).deselect()}if(v){this._getNodeElementForNode(v).select();this.selected_node=v;if(w){u=this.selected_node.parent;while(u){if(!u.is_open){this.openNode(u,true)}u=u.parent}}}if(this.options.saveState){return this._saveState()}}};s.prototype.getSelectedNode=function(){return this.selected_node||false};s.prototype.toJson=function(){return n(this.tree.getData())};s.prototype.loadData=function(y,z){var A,x,w,u,v;if(!z){this._initTree(y)}else{x=new p("");x._setParent(z.tree);x.loadFromData(y);v=x.children;for(w=0,u=v.length;w<u;w++){A=v[w];z.addChild(A)}this._refreshElements(z.parent)}if(this.is_dragging){return this._refreshHitAreas()}};s.prototype.getNodeById=function(u){return this.tree.getNodeById(u)};s.prototype.getNodeByName=function(u){return this.tree.getNodeByName(u)};s.prototype.openNode=function(u,v){if(u.hasChildren()){new l(u,this.element).open(null,v);if(this.options.saveState){return this._saveState()}}};s.prototype.closeNode=function(u,v){if(u.hasChildren()){new l(u,this.element).close(v);if(this.options.saveState){return this._saveState()}}};s.prototype.isDragging=function(){return this.is_dragging};s.prototype.refreshHitAreas=function(){return this._refreshHitAreas()};s.prototype.addNodeAfter=function(v,u){var w;w=u.addAfter(v);this._refreshElements(u.parent);return w};s.prototype.addNodeBefore=function(v,u){var w;w=u.addBefore(v);this._refreshElements(u.parent);return w};s.prototype.addParentNode=function(v,u){var w;w=u.addParent(v);this._refreshElements(w.parent);return w};s.prototype.removeNode=function(v){var u;u=v.parent;if(u){v.remove();return this._refreshElements(u)}};s.prototype.appendNode=function(v,w){var u;if(!w){w=this.tree}u=w.append(v);this._refreshElements(w);return u};s.prototype.prependNode=function(v,w){var u;if(!w){w=this.tree}u=w.prepend(v);this._refreshElements(w);return u};s.prototype._init=function(){s.__super__._init.apply(this,arguments);this.element=this.$el;this._initData();this.element.click(c.proxy(this._click,this));this.element.bind("contextmenu",c.proxy(this._contextmenu,this));this.hovered_area=null;this.$ghost=null;this.hit_areas=[];return this.is_dragging=false};s.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return s.__super__._deinit.apply(this,arguments)};s.prototype._initData=function(){var u,v=this;if(this.options.data){return this._initTree(this.options.data)}else{u=this.options.dataUrl||this.element.data("url");if(u){return c.ajax({url:u,cache:false,success:function(w){var x;if(c.isArray(w)||typeof w==="object"){x=w}else{x=c.parseJSON(w)}return v._initTree(x)}})}}};s.prototype._initTree=function(u){var v;this.tree=new m();this.tree.loadFromData(u);this.selected_node=null;this._openNodes();this._refreshElements();if(this.selected_node){v=this._getNodeElementForNode(this.selected_node);if(v){return v.select()}}};s.prototype._openNodes=function(){var u;if(this.options.saveState){if(this._restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){u=-1}else{u=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(v,w){v.is_open=true;return w!==u})};s.prototype._refreshElements=function(y){var C,B,u,w,D,x,A,v,z=this;if(y==null){y=null}D=function(G,F){var E;if(G){E=""}else{E=' class="tree"'}return c("<ul"+E+"></ul>")};u=function(E){var F;if(E.hasChildren()){F=B(E)}else{F=w(E)}if(z.options.onCreateLi){z.options.onCreateLi(E,F)}return F};w=function(E){return c('<li><div><span class="title">'+E.name+"</span></div></li>")};B=function(I){var G,H,F,E;F=function(){var J;J=["toggler"];if(!I.is_open){J.push("closed")}return J.join(" ")};E=function(){var J;J=["folder"];if(!I.is_open){J.push("closed")}return J.join(" ")};G=F();H=E();return c('<li class="'+H+'"><div><a class="'+G+'">&raquo;</a><span class="title">'+I.name+"</span></div></li>")};A=function(M,F,I,G){var K,J,E,H,L;J=D(I,G);M.append(J);for(H=0,L=F.length;H<L;H++){E=F[H];K=u(E);J.append(K);E.element=K[0];K.data("node",E);if(E.hasChildren()){A(K,E.children,I+1,E.is_open)}}return null};if(y&&y.parent){x=1;v=this._getNodeElementForNode(y);v.getUl().remove();C=v.$element}else{y=this.tree;C=this.element;C.empty();x=0}return A(C,y.children,x,true)};s.prototype._click=function(x){var u,w,v,y;if(x.ctrlKey){return}u=c(x.target);if(u.is(".toggler")){y=this._getNodeElement(u);if(y&&y.node.hasChildren()){y.toggle();if(this.options.saveState){this._saveState()}x.preventDefault();return x.stopPropagation()}}else{if(u.is("div")||u.is("span")){v=this._getNode(u);if(v){if((!this.options.onCanSelectNode)||this.options.onCanSelectNode(v)){this.selectNode(v);w=c.Event("tree.click");w.node=v;return this.element.trigger(w)}}}}};s.prototype._getNode=function(u){var v;v=u.closest("li");if(v.length===0){return null}else{return v.data("node")}};s.prototype._restoreState=function(){var u;if(this.options.onGetStateFromStorage){u=this.options.onGetStateFromStorage()}else{if(localStorage){u=localStorage.getItem(this._getCookieName())}else{if(c.cookie){u=c.cookie(this._getCookieName(),{path:"/"})}else{u=null}}}if(!u){return false}else{this._setState(u);return true}};s.prototype._saveState=function(){if(this.options.onSetStateFromStorage){return this.options.onSetStateFromStorage(this._getState())}else{if(localStorage){return localStorage.setItem(this._getCookieName(),this._getState())}else{if(c.cookie){return c.cookie(this._getCookieName(),this._getState(),{path:"/"})}}}};s.prototype._getState=function(){var v,u,w=this;v=[];this.tree.iterate(function(x){if(x.is_open&&x.id&&x.hasChildren()){v.push(x.id)}return true});u="";if(this.selected_node){u=this.selected_node.id}return n({open_nodes:v,selected_node:u})};s.prototype._setState=function(w){var v,x,u,y=this;v=c.parseJSON(w);if(v){x=v.open_nodes;u=v.selected_node;return this.tree.iterate(function(z){if(z.id&&z.hasChildren()&&(a(x,z.id)>=0)){z.is_open=true}if(u&&(z.id===u)){y.selected_node=z}return true})}};s.prototype._getCookieName=function(){if(typeof this.options.saveState==="string"){return this.options.saveState}else{return"tree"}};s.prototype._getNodeElementForNode=function(u){if(u.hasChildren()){return new l(u,this.element)}else{return new f(u,this.element)}};s.prototype._getNodeElement=function(u){var v;v=this._getNode(u);if(v){return this._getNodeElementForNode(v)}else{return null}};s.prototype._contextmenu=function(x){var u,w,v;u=c(x.target).closest("ul.tree div");if(u.length){v=this._getNode(u);if(v){x.preventDefault();x.stopPropagation();w=c.Event("tree.contextmenu");w.node=v;w.click_event=x;this.element.trigger(w);return false}}};s.prototype._mouseCapture=function(v){var u,w;if(!this.options.dragAndDrop){return}u=c(v.target);if(this.options.onIsMoveHandle&&!this.options.onIsMoveHandle(u)){return null}w=this._getNodeElement(u);if(w&&this.options.onCanMove){if(!this.options.onCanMove(w.node)){w=null}}this.current_item=w;return this.current_item!==null};s.prototype._mouseStart=function(v){var u,x,w;if(!this.options.dragAndDrop){return}this._refreshHitAreas();w=this._getOffsetFromEvent(v),u=w[0],x=w[1];this.drag_element=new o(this.current_item.node,u,x,this.element);this.is_dragging=true;this.current_item.$element.addClass("moving");return true};s.prototype._mouseDrag=function(v){var u,w;if(!this.options.dragAndDrop){return}this.drag_element.move(v.pageX,v.pageY);u=this._findHoveredArea(v.pageX,v.pageY);if(u&&this.options.onCanMoveTo){w=r.getName(u.position);if(!this.options.onCanMoveTo(this.current_item.node,u.node,w)){u=null}}if(!u){this._removeDropHint();this._removeHover();this._stopOpenFolderTimer()}else{if(this.hovered_area!==u){this.hovered_area=u;this._updateDropHint()}}return true};s.prototype._mouseStop=function(){if(!this.options.dragAndDrop){return}this._moveItem();this._clear();this._removeHover();this._removeDropHint();this._removeHitAreas();this.current_item.$element.removeClass("moving");this.is_dragging=false;return false};s.prototype._refreshHitAreas=function(){this._removeHitAreas();return this._generateHitAreas()};s.prototype._generateHitAreas=function(){var u,B,w,A,y,F,v,z,x,D,C,E=this;C=[];D=0;B=function(G){return G.offset().top};u=function(H,G,I){C.push({top:I,node:H,position:G});return D=I};w=function(L){var K,G,J,I,H;J=-1;K=[];for(I=0,H=C.length;I<H;I++){G=C[I];if(G.top!==J){if(K.length){L(K,J,G.top)}J=G.top;K=[]}K.push(G)}return L(K,J,E.element.offset().top+E.element.height())};v=function(I,H,G){var J;J=B(G);if(I===E.current_item.node){u(I,r.NONE,J)}else{u(I,r.INSIDE,J)}if(H===E.current_item.node||I===E.current_item.node){return u(I,r.NONE,J)}else{return u(I,r.AFTER,J)}};z=function(H,G){if(H===E.current_item.node){return false}if(H.children[0]!==E.current_item.node){u(H,r.INSIDE,B(G))}return true};A=function(I,H,G){if(I===E.current_item.node||H===E.current_item.node){return u(I,r.NONE,D)}else{return u(I,r.AFTER,D)}};y=function(I,H,G){var J;J=B(G);if(I===E.current_item.node){return u(I,r.NONE,J)}else{u(I,r.INSIDE,J);if(H!==E.current_item.node){return u(I,r.AFTER,J)}}};F=function(H,G){if(H!==E.current_item.node){return u(H,r.BEFORE,B(c(H.element)))}};this._iterateVisibleNodes(v,z,y,A,F);x=[];w(function(J,N,I){var K,M,G,L,H;K=(I-N)/J.length;M=N;for(L=0,H=J.length;L<H;L++){G=J[L];x.push({top:M,bottom:M+K,node:G.node,position:G.position});M+=K}return null});return this.hit_areas=x};s.prototype.testGenerateHitAreas=function(u){this.current_item=this._getNodeElementForNode(u);this._generateHitAreas();return this.hit_areas};s.prototype._removeHitAreas=function(){return this.hit_areas=[]};s.prototype._iterateVisibleNodes=function(w,B,v,z,x){var y,u,A=this;y=true;u=function(E,C){var L,D,K,H,I,F,J,G;I=(E.is_open||!E.element)&&E.hasChildren();if(E.element){L=c(E.element);if(!L.is(":visible")){return}if(y){x(E,L);y=false}if(!E.hasChildren()){w(E,C,L)}else{if(E.is_open){if(!B(E,L)){I=false}}else{v(E,C,L)}}}if(I){K=E.children.length;G=E.children;for(H=F=0,J=G.length;F<J;H=++F){D=G[H];if(H===(K-1)){u(E.children[H],null)}else{u(E.children[H],E.children[H+1])}}if(E.is_open){return z(E,C,L)}}};return u(this.tree)};s.prototype._getOffsetFromEvent=function(v){var u;u=c(v.target).offset();return[v.pageX-u.left,v.pageY-u.top]};s.prototype._findHoveredArea=function(v,C){var A,B,u,z,w;w=this.element.offset();if(v<w.left||C<w.top||v>(w.left+this.element.width())||C>(w.top+this.element.height())){return null}u=0;B=this.hit_areas.length;while(u<B){z=(u+B)>>1;A=this.hit_areas[z];if(C<A.top){B=z}else{if(C>A.bottom){u=z+1}else{return A}}}return null};s.prototype._updateDropHint=function(){var u,v;this._stopOpenFolderTimer();if(!this.hovered_area){return}u=this.hovered_area.node;if(u.hasChildren()&&!u.is_open&&this.hovered_area.position===r.INSIDE){this._startOpenFolderTimer(u)}this._removeDropHint();v=this._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=v.addDropHint(this.hovered_area.position)};s.prototype._startOpenFolderTimer=function(v){var u,w=this;u=function(){return w._getNodeElementForNode(v).open(function(){w._refreshHitAreas();return w._updateDropHint()})};return this.open_folder_timer=setTimeout(u,500)};s.prototype._stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};s.prototype._removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};s.prototype._removeHover=function(){return this.hovered_area=null};s.prototype._moveItem=function(){var w,y,x,u,v,z,A=this;if(this.hovered_area&&this.hovered_area.position!==r.NONE){x=this.current_item.node;z=this.hovered_area.node;u=this.hovered_area.position;v=x.parent;if(u===r.INSIDE){this.hovered_area.node.is_open=true}w=function(){A.tree.moveNode(x,z,u);A.element.empty();return A._refreshElements()};y=c.Event("tree.move");y.move_info={moved_node:x,target_node:z,position:r.getName(u),previous_parent:v,do_move:w};this.element.trigger(y);if(!y.isDefaultPrevented()){return w()}}};s.prototype._clear=function(){this.drag_element.remove();return this.drag_element=null};return s})(e);h.register(d,"tree");k=(function(){s.name="GhostDropHint";function s(v,u,t){this.$element=u;this.node=v;this.$ghost=c('<li class="ghost"><span class="circle"></span><span class="line"></span></li>');if(t===r.AFTER){this.moveAfter()}else{if(t===r.BEFORE){this.moveBefore()}else{if(t===r.INSIDE){if(v.hasChildren()&&v.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}s.prototype.remove=function(){return this.$ghost.remove()};s.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};s.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};s.prototype.moveInsideOpenFolder=function(){return c(this.node.children[0].element).before(this.$ghost)};s.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("inside")};return s})();g=(function(){s.name="BorderDropHint";function s(u){var t,v;t=u.children("div");v=u.width()-4;this.$hint=c('<span class="border"></span>');t.append(this.$hint);this.$hint.css({width:v,height:t.height()-4})}s.prototype.remove=function(){return this.$hint.remove()};return s})();f=(function(){s.name="NodeElement";function s(u,t){this.init(u,t)}s.prototype.init=function(u,t){this.node=u;this.tree_element=t;return this.$element=c(u.element)};s.prototype.getUl=function(){return this.$element.children("ul:first")};s.prototype.getSpan=function(){return this.$element.children("div").find("span.title")};s.prototype.getLi=function(){return this.$element};s.prototype.addDropHint=function(t){if(t===r.INSIDE){return new g(this.$element)}else{return new k(this.node,this.$element,t)}};s.prototype.select=function(){return this.getLi().addClass("selected")};s.prototype.deselect=function(){return this.getLi().removeClass("selected")};return s})();l=(function(t){q(s,t);s.name="FolderElement";function s(){return s.__super__.constructor.apply(this,arguments)}s.prototype.toggle=function(){if(this.node.is_open){return this.close()}else{return this.open()}};s.prototype.open=function(w,v){var u,x=this;if(!this.node.is_open){this.node.is_open=true;this.getButton().removeClass("closed");u=function(){var y;x.getLi().removeClass("closed");if(w){w()}y=c.Event("tree.open");y.node=x.node;return x.tree_element.trigger(y)};if(v){this.getUl().show();return u()}else{return this.getUl().slideDown("fast",u)}}};s.prototype.close=function(v){var u,w=this;if(this.node.is_open){this.node.is_open=false;this.getButton().addClass("closed");u=function(){var x;w.getLi().addClass("closed");x=c.Event("tree.close");x.node=w.node;return w.tree_element.trigger(x)};if(v){this.getUl().hide();return u()}else{return this.getUl().slideUp("fast",u)}}};s.prototype.getButton=function(){return this.$element.children("div").find("a.toggler")};s.prototype.addDropHint=function(u){if(!this.node.is_open&&u===r.INSIDE){return new g(this.$element)}else{return new k(this.node,this.$element,u)}};return s})(f);o=(function(){s.name="DragElement";function s(v,u,t,w){this.offset_x=u;this.offset_y=t;this.$element=c('<span class="title tree-dragging">'+v.name+"</span>");this.$element.css("position","absolute");w.append(this.$element)}s.prototype.move=function(u,t){return this.$element.offset({left:u-this.offset_x,top:t-this.offset_y})};s.prototype.remove=function(){return this.$element.remove()};return s})();this.Tree.Node=p}).call(this);