(function(){var e,k,r,w,u,t,f,h,g,x,j,C,d,n,q,o,l,a,B,i,A,v,z,m,c,b,s=[].slice,p={}.hasOwnProperty,y=function(G,E){for(var D in E){if(p.call(E,D)){G[D]=E[D]}}function F(){this.constructor=G}F.prototype=E.prototype;G.prototype=new F();G.__super__=E.prototype;return G};e=this.jQuery;o=(function(){D.prototype.defaults={};function D(F,E){this.$el=e(F);this.options=e.extend({},this.defaults,E)}D.prototype.destroy=function(){return this._deinit()};D.prototype._init=function(){return null};D.prototype._deinit=function(){return null};D.register=function(J,H){var I,G,E,F;F=function(){return"simple_widget_"+H};G=function(M,L){var O,N,Q,P,K;O=F();for(P=0,K=M.length;P<K;P++){N=M[P];Q=new J(N,L);if(!e.data(N,O)){e.data(N,O,Q)}Q._init()}return M};E=function(M){var O,N,Q,P,L,K;O=F();K=[];for(P=0,L=M.length;P<L;P++){N=M[P];Q=e.data(N,O);if(Q&&(Q instanceof D)){Q.destroy()}K.push(e.removeData(N,O))}return K};I=function(R,O,P){var K,S,N,L,M,Q;S=null;for(M=0,Q=R.length;M<Q;M++){K=R[M];N=e.data(K,F());if(N&&(N instanceof D)){L=N[O];if(L&&(typeof L==="function")){S=L.apply(N,P)}}}return S};return e.fn[H]=function(){var M,L,N,O,K;N=arguments[0],L=2<=arguments.length?s.call(arguments,1):[];M=this;if(N===void 0||typeof N==="object"){K=N;return G(M,K)}else{if(typeof N==="string"&&N[0]!=="_"){O=N;if(O==="destroy"){return E(M)}else{return I(M,O,L)}}}}};return D})();this.SimpleWidget=o;g=(function(D){y(E,D);function E(){m=E.__super__.constructor.apply(this,arguments);return m}E.is_mouse_handled=false;E.prototype._init=function(){this.$el.bind("mousedown.mousewidget",e.proxy(this._mouseDown,this));this.$el.bind("touchstart.mousewidget",e.proxy(this._touchStart,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;this._is_mouse_delay_met=true;return this.mouse_down_info=null};E.prototype._deinit=function(){var F;this.$el.unbind("mousedown.mousewidget");this.$el.unbind("touchstart.mousewidget");F=e(document);F.unbind("mousemove.mousewidget");return F.unbind("mouseup.mousewidget")};E.prototype._mouseDown=function(G){var F;if(G.which!==1){return}F=this._handleMouseDown(G,this._getPositionInfo(G));if(F){G.preventDefault()}return F};E.prototype._handleMouseDown=function(G,F){if(E.is_mouse_handled){return}if(this.is_mouse_started){this._handleMouseUp(F)}this.mouse_down_info=F;if(!this._mouseCapture(F)){return}this._handleStartMouse();this.is_mouse_handled=true;return true};E.prototype._handleStartMouse=function(){var F;F=e(document);F.bind("mousemove.mousewidget",e.proxy(this._mouseMove,this));F.bind("touchmove.mousewidget",e.proxy(this._touchMove,this));F.bind("mouseup.mousewidget",e.proxy(this._mouseUp,this));F.bind("touchend.mousewidget",e.proxy(this._touchEnd,this));if(this.mouse_delay){return this._startMouseDelayTimer()}};E.prototype._startMouseDelayTimer=function(){var F=this;if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(){return F._is_mouse_delay_met=true},this.mouse_delay);return this._is_mouse_delay_met=false};E.prototype._mouseMove=function(F){return this._handleMouseMove(F,this._getPositionInfo(F))};E.prototype._handleMouseMove=function(G,F){if(this.is_mouse_started){this._mouseDrag(F);return G.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==false;if(this.is_mouse_started){this._mouseDrag(F)}else{this._handleMouseUp(F)}return !this.is_mouse_started};E.prototype._getPositionInfo=function(F){return{page_x:F.pageX,page_y:F.pageY,target:F.target,original_event:F}};E.prototype._mouseUp=function(F){return this._handleMouseUp(this._getPositionInfo(F))};E.prototype._handleMouseUp=function(F){var G;G=e(document);G.unbind("mousemove.mousewidget");G.unbind("touchmove.mousewidget");G.unbind("mouseup.mousewidget");G.unbind("touchend.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(F)}};E.prototype._mouseCapture=function(F){return true};E.prototype._mouseStart=function(F){return null};E.prototype._mouseDrag=function(F){return null};E.prototype._mouseStop=function(F){return null};E.prototype.setMouseDelay=function(F){return this.mouse_delay=F};E.prototype._touchStart=function(F){var G;if(F.originalEvent.touches.length>1){return}G=F.originalEvent.changedTouches[0];return this._handleMouseDown(F,this._getPositionInfo(G))};E.prototype._touchMove=function(F){var G;if(F.originalEvent.touches.length>1){return}G=F.originalEvent.changedTouches[0];return this._handleMouseMove(F,this._getPositionInfo(G))};E.prototype._touchEnd=function(F){var G;if(F.originalEvent.touches.length>1){return}G=F.originalEvent.changedTouches[0];return this._handleMouseUp(this._getPositionInfo(G))};return E})(o);this.Tree={};e=this.jQuery;C={getName:function(D){return C.strings[D-1]},nameToIndex:function(E){var F,G,D;for(F=G=1,D=C.strings.length;1<=D?G<=D:G>=D;F=1<=D?++G:--G){if(C.strings[F-1]===E){return F}}return 0}};C.BEFORE=1;C.AFTER=2;C.INSIDE=3;C.NONE=4;C.strings=["before","after","inside","none"];this.Tree.Position=C;x=(function(){function D(F,E,G){if(E==null){E=false}if(G==null){G=D}this.setData(F);this.children=[];this.parent=null;if(E){this.id_mapping={};this.tree=this;this.node_class=G}}D.prototype.setData=function(H){var F,G,E;if(typeof H!=="object"){return this.name=H}else{E=[];for(F in H){G=H[F];if(F==="label"){E.push(this.name=G)}else{E.push(this[F]=G)}}return E}};D.prototype.initFromData=function(F){var E,G,H=this;G=function(I){H.setData(I);if(I.children){return E(I.children)}};E=function(L){var M,J,K,I;for(K=0,I=L.length;K<I;K++){M=L[K];J=new H.tree.node_class("");J.initFromData(M);H.addChild(J)}return null};G(F);return null};D.prototype.loadFromData=function(H){var F,I,G,E;this.removeChildren();for(G=0,E=H.length;G<E;G++){I=H[G];F=new this.tree.node_class(I);this.addChild(F);if(typeof I==="object"&&I.children){F.loadFromData(I.children)}}return null};D.prototype.addChild=function(E){this.children.push(E);return E._setParent(this)};D.prototype.addChildAtPosition=function(F,E){this.children.splice(E,0,F);return F._setParent(this)};D.prototype._setParent=function(E){this.parent=E;this.tree=E.tree;return this.tree.addNodeToIndex(this)};D.prototype.removeChild=function(E){E.removeChildren();return this._removeChild(E)};D.prototype._removeChild=function(E){this.children.splice(this.getChildIndex(E),1);return this.tree.removeNodeFromIndex(E)};D.prototype.getChildIndex=function(E){return e.inArray(E,this.children)};D.prototype.hasChildren=function(){return this.children.length!==0};D.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};D.prototype.iterate=function(G){var E,F=this;E=function(K,N){var M,I,L,J,H;if(K.children){H=K.children;for(L=0,J=H.length;L<J;L++){M=H[L];I=G(M,N);if(F.hasChildren()&&I){E(M,N+1)}}return null}};E(this,0);return null};D.prototype.moveNode=function(F,G,E){if(F.isParentOf(G)){return}F.parent._removeChild(F);if(E===C.AFTER){return G.parent.addChildAtPosition(F,G.parent.getChildIndex(G)+1)}else{if(E===C.BEFORE){return G.parent.addChildAtPosition(F,G.parent.getChildIndex(G))}else{if(E===C.INSIDE){return G.addChildAtPosition(F,0)}}}};D.prototype.getData=function(){var E,F=this;E=function(J){var N,I,L,K,H,M,G;N=[];for(M=0,G=J.length;M<G;M++){L=J[M];K={};for(I in L){H=L[I];if((I!=="parent"&&I!=="children"&&I!=="element"&&I!=="tree")&&Object.prototype.hasOwnProperty.call(L,I)){K[I]=H}}if(L.hasChildren()){K.children=E(L.children)}N.push(K)}return N};return E(this.children)};D.prototype.getNodeByName=function(F){var E;E=null;this.iterate(function(G){if(G.name===F){E=G;return false}else{return true}});return E};D.prototype.addAfter=function(F){var G,E;if(!this.parent){return null}else{E=new this.tree.node_class(F);G=this.parent.getChildIndex(this);this.parent.addChildAtPosition(E,G+1);return E}};D.prototype.addBefore=function(F){var G,E;if(!this.parent){return null}else{E=new this.tree.node_class(F);G=this.parent.getChildIndex(this);this.parent.addChildAtPosition(E,G);return E}};D.prototype.addParent=function(I){var K,J,H,G,F,E;if(!this.parent){return null}else{J=new this.tree.node_class(I);J._setParent(this.tree);H=this.parent;E=H.children;for(G=0,F=E.length;G<F;G++){K=E[G];J.addChild(K)}H.children=[];H.addChild(J);return J}};D.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};D.prototype.append=function(F){var E;E=new this.tree.node_class(F);this.addChild(E);return E};D.prototype.prepend=function(F){var E;E=new this.tree.node_class(F);this.addChildAtPosition(E,0);return E};D.prototype.isParentOf=function(F){var E;E=F.parent;while(E){if(E===this){return true}E=E.parent}return false};D.prototype.getLevel=function(){var F,E;F=0;E=this;while(E.parent){F+=1;E=E.parent}return F};D.prototype.getNodeById=function(E){return this.id_mapping[E]};D.prototype.addNodeToIndex=function(E){if(E.id){return this.id_mapping[E.id]=E}};D.prototype.removeNodeFromIndex=function(E){if(E.id){return delete this.id_mapping[E.id]}};D.prototype.removeChildren=function(){var E=this;this.iterate(function(F){E.tree.removeNodeFromIndex(F);return true});return this.children=[]};D.prototype.getPreviousSibling=function(){var E;if(!this.parent){return null}else{E=this.parent.getChildIndex(this)-1;if(E>=0){return this.parent.children[E]}else{return null}}};D.prototype.getNextSibling=function(){var E;if(!this.parent){return null}else{E=this.parent.getChildIndex(this)+1;if(E<this.parent.children.length){return this.parent.children[E]}else{return null}}};return D})();this.Tree.Node=x;f=(function(E){y(D,E);function D(){c=D.__super__.constructor.apply(this,arguments);return c}D.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:x};D.prototype.toggle=function(G,F){if(F==null){F=true}if(G.is_open){return this.closeNode(G,F)}else{return this.openNode(G,F)}};D.prototype.getTree=function(){return this.tree};D.prototype.selectNode=function(F){return this._selectNode(F,true)};D.prototype._selectNode=function(H,F){var I,K,G,J=this;if(F==null){F=false}if(!this.select_node_handler){return}I=function(){if(J.options.onCanSelectNode){return J.options.selectable&&J.options.onCanSelectNode(H)}else{return J.options.selectable}};K=function(){var L;L=H.parent;if(L&&L.parent&&!L.is_open){return J.openNode(L,false)}};G=function(){if(J.options.saveState){return J.save_state_handler.saveState()}};if(!H){this._deselectCurrentNode();G();return}if(!I()){return}if(this.select_node_handler.isNodeSelected(H)){if(F){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null,previous_node:H})}}else{this._deselectCurrentNode();this.addToSelection(H);this._triggerEvent("tree.select",{node:H});K()}return G()};D.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};D.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};D.prototype.loadData=function(F,G){return this._loadData(F,G)};D.prototype.loadDataFromUrl=function(F,H,G){if(e.type(F)!=="string"){G=H;H=F;F=null}return this._loadDataFromUrl(F,H,G)};D.prototype._loadDataFromUrl=function(F,L,J){var H,K,G,I,M=this;H=null;K=function(){var N;if(!L){H=M.element}else{N=new u(L,M);H=N.getLi()}return H.addClass("jqtree-loading")};I=function(){if(H){return H.removeClass("jqtree-loading")}};G=function(){if(e.type(F)==="string"){F={url:F}}if(!F.method){return F.method="get"}};K();if(!F){F=this._getDataUrlInfo(L)}G();return e.ajax({url:F.url,data:F.data,type:F.method.toUpperCase(),cache:false,dataType:"json",success:function(N){var O;if(e.isArray(N)||typeof N==="object"){O=N}else{O=e.parseJSON(N)}I();M._loadData(O,L);if(J&&e.isFunction(J)){return J()}},error:function(N){I();if(M.options.onLoadFailed){return M.options.onLoadFailed(N)}}})};D.prototype._loadData=function(I,J){var K,G,H,F;this._triggerEvent("tree.load_data",{tree_data:I});if(!J){this._initTree(I)}else{G=this.select_node_handler.getSelectedNodes(J);for(H=0,F=G.length;H<F;H++){K=G[H];this.select_node_handler.removeFromSelection(K)}J.loadFromData(I);J.load_on_demand=false;this._refreshElements(J.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};D.prototype.getNodeById=function(F){return this.tree.getNodeById(F)};D.prototype.getNodeByName=function(F){return this.tree.getNodeByName(F)};D.prototype.openNode=function(G,F){if(F==null){F=true}return this._openNode(G,F)};D.prototype._openNode=function(H,F,I){var K,G,J=this;if(F==null){F=true}K=function(M,N,L){var O;O=new u(M,J);return O.open(L,N)};if(H.isFolder()){if(H.load_on_demand){return this._loadFolderOnDemand(H,F,I)}else{G=H.parent;while(G&&!G.is_open){if(G.parent){K(G,false,null)}G=G.parent}K(H,F,I);return this._saveState()}}};D.prototype._loadFolderOnDemand=function(G,F,H){var I=this;if(F==null){F=true}return this._loadDataFromUrl(null,G,function(){return I._openNode(G,F,H)})};D.prototype.closeNode=function(G,F){if(F==null){F=true}if(G.isFolder()){new u(G,this).close(F);return this._saveState()}};D.prototype.isDragging=function(){return this.is_dragging};D.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};D.prototype.addNodeAfter=function(G,F){var H;H=F.addAfter(G);this._refreshElements(F.parent);return H};D.prototype.addNodeBefore=function(G,F){var H;H=F.addBefore(G);this._refreshElements(F.parent);return H};D.prototype.addParentNode=function(G,F){var H;H=F.addParent(G);this._refreshElements(H.parent);return H};D.prototype.removeNode=function(G){var F;F=G.parent;if(F){this.select_node_handler.removeFromSelection(G,true);G.remove();return this._refreshElements(F.parent)}};D.prototype.appendNode=function(H,I){var F,G;if(!I){I=this.tree}F=I.isFolder();G=I.append(H);if(F){this._refreshElements(I)}else{this._refreshElements(I.parent)}return G};D.prototype.prependNode=function(G,H){var F;if(!H){H=this.tree}F=H.prepend(G);this._refreshElements(H);return F};D.prototype.updateNode=function(F,H){var G;G=H.id&&H.id!==F.id;if(G){this.tree.removeNodeFromIndex(F)}F.setData(H);if(G){this.tree.addNodeToIndex(F)}this._refreshElements(F.parent);return this._selectCurrentNode()};D.prototype.moveNode=function(H,I,F){var G;G=C.nameToIndex(F);this.tree.moveNode(H,I,G);return this._refreshElements()};D.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};D.prototype.addToSelection=function(F){this.select_node_handler.addToSelection(F);return this._getNodeElementForNode(F).select()};D.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};D.prototype.isNodeSelected=function(F){return this.select_node_handler.isNodeSelected(F)};D.prototype.removeFromSelection=function(F){this.select_node_handler.removeFromSelection(F);return this._getNodeElementForNode(F).deselect()};D.prototype.scrollToNode=function(G){var F,H;F=e(G.element);H=F.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(H)};D.prototype.getState=function(){return this.save_state_handler.getState()};D.prototype.setState=function(F){this.save_state_handler.setState(F);return this._refreshElements()};D.prototype._init=function(){D.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.is_initialized=false;if(typeof d!=="undefined"&&d!==null){this.save_state_handler=new d(this)}else{this.options.saveState=false}if(typeof q!=="undefined"&&q!==null){this.select_node_handler=new q(this)}if(typeof r!=="undefined"&&r!==null){this.dnd_handler=new r(this)}else{this.options.dragAndDrop=false}if(typeof n!=="undefined"&&n!==null){this.scroll_handler=new n(this)}if((typeof h!=="undefined"&&h!==null)&&(typeof q!=="undefined"&&q!==null)){this.key_handler=new h(this)}this._initData();this.element.click(e.proxy(this._click,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",e.proxy(this._contextmenu,this))}};D.prototype._deinit=function(){this.element.empty();this.element.unbind();this.key_handler.deinit();this.tree=null;return D.__super__._deinit.call(this)};D.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};D.prototype._getDataUrlInfo=function(H){var I,G,F;G=this.options.dataUrl||this.element.data("url");if(e.isFunction(G)){return G(H)}else{if(e.type(G)==="string"){F={url:G};if(H&&H.id){I={node:H.id};F.data=I}return F}else{return G}}};D.prototype._initTree=function(F){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);if(this.select_node_handler){this.select_node_handler.clear()}this.tree.loadFromData(F);this._openNodes();this._refreshElements();if(!this.is_initialized){this.is_initialized=true;return this._triggerEvent("tree.init")}};D.prototype._openNodes=function(){var F;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){F=-1}else{F=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(G,H){if(G.hasChildren()){G.is_open=true}return H!==F})};D.prototype._refreshElements=function(I){var N,M,F,H,P,L,J,O,G,K=this;if(I==null){I=null}J=function(Q){if(K.options.autoEscape){return l(Q)}else{return Q}};P=function(R){var Q;if(R){Q="jqtree-tree"}else{Q=""}return e('<ul class="jqtree_common '+Q+'"></ul>')};F=function(Q){var R;if(Q.isFolder()){R=M(Q)}else{R=H(Q)}if(K.options.onCreateLi){K.options.onCreateLi(Q,R)}return R};H=function(R){var T,Q,S;S=["jqtree_common"];if(K.select_node_handler&&K.select_node_handler.isNodeSelected(R)){S.push("jqtree-selected")}T=S.join(" ");Q=J(R.name);return e('<li class="'+T+'"><div class="jqtree-element jqtree_common"><span class="jqtree-title jqtree_common">'+Q+"</span></div></li>")};M=function(U){var Q,S,R,W,T,V;T=function(){var X;X=["jqtree-toggler"];if(!U.is_open){X.push("jqtree-closed")}return X.join(" ")};V=function(){var X;X=["jqtree-folder"];if(!U.is_open){X.push("jqtree-closed")}if(K.select_node_handler&&K.select_node_handler.isNodeSelected(U)){X.push("jqtree-selected")}return X.join(" ")};S=T();W=V();R=J(U.name);if(U.is_open){Q=K.options.openedIcon}else{Q=K.options.closedIcon}return e('<li class="jqtree_common '+W+'"><div class="jqtree-element jqtree_common"><a class="jqtree_common '+S+'">'+Q+'</a><span class="jqtree_common jqtree-title">'+R+"</span></div></li>")};L=function(X,R,Y,S){var V,U,Q,T,W;U=P(Y);X.append(U);for(T=0,W=R.length;T<W;T++){Q=R[T];V=F(Q);U.append(V);Q.element=V[0];V.data("node",Q);if(Q.hasChildren()){L(V,Q.children,false,Q.is_open)}}return null};if(I&&I.parent){O=false;G=this._getNodeElementForNode(I);G.getUl().remove();N=G.$element}else{I=this.tree;N=this.element;N.empty();O=true}L(N,I.children,O,O);return this._triggerEvent("tree.refresh")};D.prototype._click=function(K){var J,G,F,I,H;F=e(K.target);J=F.closest(".jqtree-toggler");if(J.length){H=this._getNode(J);if(H){this.toggle(H,this.options.slide);K.preventDefault();return K.stopPropagation()}}else{G=F.closest(".jqtree-element");if(G.length){H=this._getNode(G);if(H){I=this._triggerEvent("tree.click",{node:H});if(!I.isDefaultPrevented()){return this._selectNode(H,true)}}}}};D.prototype._getNode=function(F){var G;G=F.closest("li");if(G.length===0){return null}else{return G.data("node")}};D.prototype._getNodeElementForNode=function(F){if(F.isFolder()){return new u(F,this)}else{return new j(F,this)}};D.prototype._getNodeElement=function(F){var G;G=this._getNode(F);if(G){return this._getNodeElementForNode(G)}else{return null}};D.prototype._contextmenu=function(H){var F,G;F=e(H.target).closest("ul.jqtree-tree .jqtree-element");if(F.length){G=this._getNode(F);if(G){H.preventDefault();H.stopPropagation();this._triggerEvent("tree.contextmenu",{node:G,click_event:H});return false}}};D.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};D.prototype._mouseCapture=function(F){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(F)}else{return false}};D.prototype._mouseStart=function(F){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(F)}else{return false}};D.prototype._mouseDrag=function(G){var F;if(this.options.dragAndDrop){F=this.dnd_handler.mouseDrag(G);if(this.scroll_handler){this.scroll_handler.checkScrolling()}return F}else{return false}};D.prototype._mouseStop=function(F){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(F)}else{return false}};D.prototype._triggerEvent=function(H,F){var G;G=e.Event(H);e.extend(G,F);this.element.trigger(G);return G};D.prototype.testGenerateHitAreas=function(F){this.dnd_handler.current_item=this._getNodeElementForNode(F);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};D.prototype._selectCurrentNode=function(){var F,G;F=this.getSelectedNode();if(F){G=this._getNodeElementForNode(F);if(G){return G.select()}}};D.prototype._deselectCurrentNode=function(){var F;F=this.getSelectedNode();if(F){return this.removeFromSelection(F)}};return D})(g);o.register(f,"tree");j=(function(){function D(E,F){this.init(E,F)}D.prototype.init=function(E,F){this.node=E;this.tree_widget=F;return this.$element=e(E.element)};D.prototype.getUl=function(){return this.$element.children("ul:first")};D.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};D.prototype.getLi=function(){return this.$element};D.prototype.addDropHint=function(E){if(E===C.INSIDE){return new k(this.$element)}else{return new t(this.node,this.$element,E)}};D.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};D.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return D})();u=(function(E){y(D,E);function D(){b=D.__super__.constructor.apply(this,arguments);return b}D.prototype.open=function(I,F){var H,G,J=this;if(F==null){F=true}if(!this.node.is_open){this.node.is_open=true;H=this.getButton();H.removeClass("jqtree-closed");H.html(this.tree_widget.options.openedIcon);G=function(){J.getLi().removeClass("jqtree-closed");if(I){I()}return J.tree_widget._triggerEvent("tree.open",{node:J.node})};if(F){return this.getUl().slideDown("fast",G)}else{this.getUl().show();return G()}}};D.prototype.close=function(F){var H,G,I=this;if(F==null){F=true}if(this.node.is_open){this.node.is_open=false;H=this.getButton();H.addClass("jqtree-closed");H.html(this.tree_widget.options.closedIcon);G=function(){I.getLi().addClass("jqtree-closed");return I.tree_widget._triggerEvent("tree.close",{node:I.node})};if(F){return this.getUl().slideUp("fast",G)}else{this.getUl().hide();return G()}}};D.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};D.prototype.addDropHint=function(F){if(!this.node.is_open&&F===C.INSIDE){return new k(this.$element)}else{return new t(this.node,this.$element,F)}};return D})(j);l=function(D){return(""+D).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};z=function(I,F){var E,H,G,D;for(E=G=0,D=I.length;G<D;E=++G){H=I[E];if(H===F){return E}}return -1};a=function(E,D){if(E.indexOf){return E.indexOf(D)}else{return z(E,D)}};this.Tree.indexOf=a;this.Tree._indexOf=z;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){B=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};A=function(D){B.lastIndex=0;if(B.test(D)){return'"'+D.replace(B,function(E){var F;F=i[E];return(typeof F==="string"?F:"\\u"+("0000"+E.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+D+'"'}};v=function(K,H){var F,D,G,L,J,E,I;J=H[K];switch(typeof J){case"string":return A(J);case"number":if(isFinite(J)){return String(J)}else{return"null"}case"boolean":case"null":return String(J);case"object":if(!J){return"null"}G=[];if(Object.prototype.toString.apply(J)==="[object Array]"){for(F=E=0,I=J.length;E<I;F=++E){L=J[F];G[F]=v(F,J)||"null"}return(G.length===0?"[]":"["+G.join(",")+"]")}for(D in J){if(Object.prototype.hasOwnProperty.call(J,D)){L=v(D,J);if(L){G.push(A(D)+":"+L)}}}return(G.length===0?"{}":"{"+G.join(",")+"}")}};if(this.JSON==null){this.JSON={}}this.JSON.stringify=function(D){return v("",{"":D})}}d=(function(){function D(E){this.tree_widget=E}D.prototype.saveState=function(){var E;E=JSON.stringify(this.getState());if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(E)}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),E)}else{if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName(),E,{path:"/"})}}}};D.prototype.restoreState=function(){var E;E=this.getStateFromStorage();if(E){this.setState(e.parseJSON(E));return true}else{return false}};D.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.getItem(this.getCookieName())}else{if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName())}else{return null}}}};D.prototype.getState=function(){var G,F,E,H=this;G=[];this.tree_widget.tree.iterate(function(I){if(I.is_open&&I.id&&I.hasChildren()){G.push(I.id)}return true});F=this.tree_widget.getSelectedNode();if(F){E=F.id}else{E=""}return{open_nodes:G,selected_node:E}};D.prototype.setState=function(G){var H,F,E,I=this;if(G){H=G.open_nodes;E=G.selected_node;this.tree_widget.tree.iterate(function(J){J.is_open=J.id&&J.hasChildren()&&(a(H,J.id)>=0);return true});if(E&&this.tree_widget.select_node_handler){this.tree_widget.select_node_handler.clear();F=this.tree_widget.getNodeById(E);if(F){return this.tree_widget.select_node_handler.addToSelection(F)}}}};D.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return D})();q=(function(){function D(E){this.tree_widget=E;this.clear()}D.prototype.getSelectedNode=function(){var E;E=this.getSelectedNodes();if(E.length){return E[0]}else{return false}};D.prototype.getSelectedNodes=function(){var G,F,E;if(this.selected_single_node){return[this.selected_single_node]}else{E=[];for(G in this.selected_nodes){F=this.tree_widget.getNodeById(G);if(F){E.push(F)}}return E}};D.prototype.isNodeSelected=function(E){if(E.id){return this.selected_nodes[E.id]}else{if(this.selected_single_node){return this.selected_single_node.element===E.element}else{return false}}};D.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};D.prototype.removeFromSelection=function(E,G){var F=this;if(G==null){G=false}if(!E.id){if(E.element===this.selected_single_node.element){return this.selected_single_node=null}}else{delete this.selected_nodes[E.id];if(G){return E.iterate(function(H){delete F.selected_nodes[E.id];return true})}}};D.prototype.addToSelection=function(E){if(E.id){return this.selected_nodes[E.id]=true}else{return this.selected_single_node=E}};return D})();r=(function(){function D(E){this.tree_widget=E;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}D.prototype.mouseCapture=function(F){var E,G;E=e(F.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(E)){return null}G=this.tree_widget._getNodeElement(E);if(G&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(G.node)){G=null}}this.current_item=G;return this.current_item!==null};D.prototype.mouseStart=function(E){var F;this.refreshHitAreas();F=e(E.target).offset();this.drag_element=new w(this.current_item.node,E.page_x-F.left,E.page_y-F.top,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};D.prototype.mouseDrag=function(E){var G,F;this.drag_element.move(E.page_x,E.page_y);G=this.findHoveredArea(E.page_x,E.page_y);F=this.canMoveToArea(G);if(G){if(this.hovered_area!==G){this.hovered_area=G;if(this.mustOpenFolderTimer(G)){this.startOpenFolderTimer(G.node)}if(F){this.updateDropHint()}}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};D.prototype.canMoveToArea=function(E){var F;if(!E){return false}else{if(this.tree_widget.options.onCanMoveTo){F=C.getName(E.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,E.node,F)}else{return true}}};D.prototype.mouseStop=function(E){this.moveItem(E);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();if(this.current_item){this.current_item.$element.removeClass("jqtree-moving")}this.is_dragging=false;return false};D.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};D.prototype.removeHitAreas=function(){return this.hit_areas=[]};D.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};D.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};D.prototype.removeHover=function(){return this.hovered_area=null};D.prototype.generateHitAreas=function(){var E,L,G,K,I,P,F,J,H,N,M,O=this;M=[];N=0;L=function(Q){return Q.offset().top};E=function(R,Q,S){M.push({top:S,node:R,position:Q});return N=S};G=function(V){var U,Q,T,S,R;T=-1;U=[];for(S=0,R=M.length;S<R;S++){Q=M[S];if(Q.top!==T){if(U.length){V(U,T,Q.top)}T=Q.top;U=[]}U.push(Q)}return V(U,T,O.tree_widget.element.offset().top+O.tree_widget.element.height())};F=function(S,R,Q){var T;T=L(Q);if(S===O.current_item.node){E(S,C.NONE,T)}else{E(S,C.INSIDE,T)}if(R===O.current_item.node||S===O.current_item.node){return E(S,C.NONE,T)}else{return E(S,C.AFTER,T)}};J=function(R,Q){if(R===O.current_item.node){return false}if(R.children[0]!==O.current_item.node){E(R,C.INSIDE,L(Q))}return true};K=function(S,R,Q){if(S===O.current_item.node||R===O.current_item.node){return E(S,C.NONE,N)}else{return E(S,C.AFTER,N)}};I=function(S,R,Q){var T;T=L(Q);if(S===O.current_item.node){return E(S,C.NONE,T)}else{E(S,C.INSIDE,T);if(R!==O.current_item.node){return E(S,C.AFTER,T)}}};P=function(R,Q){if(R!==O.current_item.node){return E(R,C.BEFORE,L(e(R.element)))}};this.iterateVisibleNodes(F,J,I,K,P);H=[];G(function(T,X,S){var U,W,Q,V,R;U=(S-X)/T.length;W=X;for(V=0,R=T.length;V<R;V++){Q=T[V];H.push({top:W,bottom:W+U,node:Q.node,position:Q.position});W+=U}return null});return this.hit_areas=H};D.prototype.iterateVisibleNodes=function(G,L,F,J,H){var I,E,K=this;I=true;E=function(P,M){var V,N,U,R,S,Q,T,O;S=(P.is_open||!P.element)&&P.hasChildren();if(P.element){V=e(P.element);if(!V.is(":visible")){return}if(I){H(P,V);I=false}if(!P.hasChildren()){G(P,M,V)}else{if(P.is_open){if(!L(P,V)){S=false}}else{F(P,M,V)}}}if(S){U=P.children.length;O=P.children;for(R=Q=0,T=O.length;Q<T;R=++Q){N=O[R];if(R===(U-1)){E(P.children[R],null)}else{E(P.children[R],P.children[R+1])}}if(P.is_open){return J(P,M,V)}}};return E(this.tree_widget.tree)};D.prototype.findHoveredArea=function(F,K){var I,J,E,H,G;G=this.tree_widget.element.offset();if(F<G.left||K<G.top||F>(G.left+this.tree_widget.element.width())||K>(G.top+this.tree_widget.element.height())){return null}E=0;J=this.hit_areas.length;while(E<J){H=(E+J)>>1;I=this.hit_areas[H];if(K<I.top){J=H}else{if(K>I.bottom){E=H+1}else{return I}}}return null};D.prototype.mustOpenFolderTimer=function(F){var E;E=F.node;return E.isFolder()&&!E.is_open&&F.position===C.INSIDE};D.prototype.updateDropHint=function(){var E;if(!this.hovered_area){return}this.removeDropHint();E=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=E.addDropHint(this.hovered_area.position)};D.prototype.startOpenFolderTimer=function(F){var E,G=this;E=function(){return G.tree_widget._openNode(F,G.tree_widget.options.slide,function(){G.refreshHitAreas();return G.updateDropHint()})};return this.open_folder_timer=setTimeout(E,500)};D.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};D.prototype.moveItem=function(G){var H,J,I,E,F,K,L=this;if(this.hovered_area&&this.hovered_area.position!==C.NONE&&this.canMoveToArea(this.hovered_area)){I=this.current_item.node;K=this.hovered_area.node;E=this.hovered_area.position;F=I.parent;if(E===C.INSIDE){this.hovered_area.node.is_open=true}H=function(){L.tree_widget.tree.moveNode(I,K,E);L.tree_widget.element.empty();return L.tree_widget._refreshElements()};J=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:I,target_node:K,position:C.getName(E),previous_parent:F,do_move:H,original_event:G.original_event}});if(!J.isDefaultPrevented()){return H()}}};return D})();w=(function(){function D(G,F,E,H){this.offset_x=F;this.offset_y=E;this.$element=e('<span class="jqtree-title jqtree-dragging">'+G.name+"</span>");this.$element.css("position","absolute");H.append(this.$element)}D.prototype.move=function(F,E){return this.$element.offset({left:F-this.offset_x,top:E-this.offset_y})};D.prototype.remove=function(){return this.$element.remove()};return D})();t=(function(){function D(G,F,E){this.$element=F;this.node=G;this.$ghost=e('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(E===C.AFTER){this.moveAfter()}else{if(E===C.BEFORE){this.moveBefore()}else{if(E===C.INSIDE){if(G.isFolder()&&G.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}D.prototype.remove=function(){return this.$ghost.remove()};D.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};D.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};D.prototype.moveInsideOpenFolder=function(){return e(this.node.children[0].element).before(this.$ghost)};D.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return D})();k=(function(){function D(F){var E,G;E=F.children(".jqtree-element");G=F.width()-4;this.$hint=e('<span class="jqtree-border"></span>');E.append(this.$hint);this.$hint.css({width:G,height:E.height()-4})}D.prototype.remove=function(){return this.$hint.remove()};return D})();n=(function(){function D(E){this.tree_widget=E;this.previous_top=-1;this._initScrollParent()}D.prototype._initScrollParent=function(){var E,F,G,H=this;F=function(){var P,M,R,I,O,N,Q,J,L,K;M=["overflow","overflow-y"];I=null;L=H.tree_widget.$el.parents();for(O=0,Q=L.length;O<Q;O++){R=L[O];for(N=0,J=M.length;N<J;N++){P=M[N];if((K=e.css(R,P))==="auto"||K==="scroll"){return e(R)}}}return null};G=function(){H.scroll_parent_top=0;return H.$scroll_parent=null};if(this.tree_widget.$el.css("position")==="fixed"){G()}E=F();if(E&&E.length&&E[0].tagName!=="HTML"){this.$scroll_parent=E;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return G()}};D.prototype.checkScrolling=function(){var E;E=this.tree_widget.dnd_handler.hovered_area;if(E&&E.top!==this.previous_top){this.previous_top=E.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(E)}else{return this._handleScrollingWithDocument(E)}}};D.prototype._handleScrollingWithScrollParent=function(F){var E;E=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-F.bottom;if(E<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((F.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};D.prototype._handleScrollingWithDocument=function(F){var E;E=F.top-e(document).scrollTop();if(E<20){return e(document).scrollTop(e(document).scrollTop()-20)}else{if(e(window).height()-(F.bottom-e(document).scrollTop())<20){return e(document).scrollTop(e(document).scrollTop()+20)}}};D.prototype.scrollTo=function(F){var E;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=F}else{E=this.tree_widget.$el.offset().top;return e(document).scrollTop(F+E)}};D.prototype.isScrolledIntoView=function(F){var E,J,I,H,G;E=e(F);if(this.$scroll_parent){G=0;H=this.$scroll_parent.height();I=E.offset().top-this.scroll_parent_top;J=I+E.height()}else{G=e(window).scrollTop();H=G+e(window).height();I=E.offset().top;J=I+E.height()}return(J<=H)&&(I>=G)};return D})();h=(function(){var H,E,G,D;E=37;D=38;G=39;H=40;function F(I){this.tree_widget=I;e(document).bind("keydown.jqtree",e.proxy(this.handleKeyDown,this))}F.prototype.deinit=function(){return e(document).unbind("keydown.jqtree")};F.prototype.handleKeyDown=function(O){var J,Q,I,N,P,L,K,M=this;J=this.tree_widget.getSelectedNode();K=function(R){if(R){M.tree_widget.selectNode(R);if(M.tree_widget.scroll_handler&&(!M.tree_widget.scroll_handler.isScrolledIntoView(e(R.element).find(".jqtree-element")))){M.tree_widget.scrollToNode(R)}return false}else{return true}};I=function(){return K(M.getNextNode(J))};L=function(){return K(M.getPreviousNode(J))};P=function(){if(J.hasChildren()&&!J.is_open){M.tree_widget.openNode(J);return false}else{return true}};N=function(){if(J.hasChildren()&&J.is_open){M.tree_widget.closeNode(J);return false}else{return true}};if(!J){return true}else{Q=O.which;switch(Q){case H:return I();case D:return L();case G:return P();case E:return N()}}};F.prototype.getNextNode=function(I,K){var J;if(K==null){K=true}if(K&&I.hasChildren()&&I.is_open){return I.children[0]}else{if(!I.parent){return null}else{J=I.getNextSibling();if(J){return J}else{return this.getNextNode(I.parent,false)}}}};F.prototype.getPreviousNode=function(J){var I;if(!J.parent){return null}else{I=J.getPreviousSibling();if(I){if(!I.hasChildren()||!I.is_open){return I}else{return this.getLastChild(I)}}else{if(J.parent.parent){return J.parent}else{return null}}}};F.prototype.getLastChild=function(J){var I;if(!J.hasChildren()){return null}else{I=J.children[J.children.length-1];if(!I.hasChildren()||!I.is_open){return I}else{return this.getLastChild(I)}}};return F})()}).call(this);