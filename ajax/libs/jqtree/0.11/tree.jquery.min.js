(function(){var d,h,m,s,p,o,e,b,f,t,g,v,c,l,j,q,i,a,r,n=[].slice,k={}.hasOwnProperty,u=function(z,x){for(var w in x){if(k.call(x,w)){z[w]=x[w]}}function y(){this.constructor=z}y.prototype=x.prototype;z.prototype=new y();z.__super__=x.prototype;return z};d=this.jQuery;j=(function(){w.prototype.defaults={};function w(y,x){this.$el=d(y);this.options=d.extend({},this.defaults,x);this._init()}w.prototype.destroy=function(){return this._deinit()};w.prototype._init=function(){return null};w.prototype._deinit=function(){return null};w.register=function(C,A){var B,z,x,y;y=function(){return"simple_widget_"+A};z=function(E,D){var F;F=y();E.each(function(){var G;G=new C(this,D);if(!d.data(this,F)){return d.data(this,F,G)}});return E};x=function(D){var E;E=y();return D.each(function(){var F;F=d.data(this,E);if(F&&(F instanceof w)){F.destroy()}return d.removeData(this,E)})};B=function(F,G,E){var D;D=null;F.each(function(){var I,H;I=d.data(this,y());if(I&&(I instanceof w)){H=I[G];if(H&&(typeof H==="function")){return D=H.apply(I,E)}}});return D};return d.fn[A]=function(){var F,E,G,H,D;G=arguments[0],E=2<=arguments.length?n.call(arguments,1):[];F=this;if(G===void 0||typeof G==="object"){D=G;return z(F,D)}else{if(typeof G==="string"&&G[0]!=="_"){H=G;if(H==="destroy"){return x(F)}else{return B(F,H,E)}}}}};return w})();this.SimpleWidget=j;f=(function(w){u(x,w);function x(){return x.__super__.constructor.apply(this,arguments)}x.is_mouse_handled=false;x.prototype._init=function(){this.$el.bind("mousedown.mousewidget",d.proxy(this._mouseDown,this));return this.is_mouse_started=false};x.prototype._deinit=function(){var y;this.$el.unbind("mousedown.mousewidget");y=d(document);y.unbind("mousemove.mousewidget");return y.unbind("mouseup.mousewidget")};x.prototype._mouseDown=function(y){var z;if(x.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(y)}if(y.which!==1){return}if(!this._mouseCapture(y)){return}this.mouse_down_event=y;z=d(document);z.bind("mousemove.mousewidget",d.proxy(this._mouseMove,this));z.bind("mouseup.mousewidget",d.proxy(this._mouseUp,this));y.preventDefault();this.is_mouse_handled=true;return true};x.prototype._mouseMove=function(y){if(this.is_mouse_started){this._mouseDrag(y);return y.preventDefault()}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(y)}else{this._mouseUp(y)}return !this.is_mouse_started};x.prototype._mouseUp=function(y){var z;z=d(document);z.unbind("mousemove.mousewidget");z.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(y)}return false};x.prototype._mouseCapture=function(y){return true};x.prototype._mouseStart=function(y){return null};x.prototype._mouseDrag=function(y){return null};x.prototype._mouseStop=function(y){return null};return x})(j);this.Tree={};d=this.jQuery;a=function(B,y){var x,A,z,w;if(B.indexOf){return B.indexOf(y)}else{for(x=z=0,w=B.length;z<w;x=++z){A=B[x];if(A===y){return x}}return -1}};this.Tree.indexOf=a;b={};b.escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.quote=function(w){b.escapable.lastIndex=0;if(b.escapable.test(w)){return'"'+w.replace(b.escapable,function(x){var y;y=b.meta[x];return(typeof y==="string"?y:"\\u"+("0000"+x.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+w+'"'}};b.str=function(D,A){var y,w,z,E,C,x,B;C=A[D];switch(typeof C){case"string":return b.quote(C);case"number":if(isFinite(C)){return String(C)}else{return"null"}case"boolean":case"null":return String(C);case"object":if(!C){return"null"}z=[];if(Object.prototype.toString.apply(C)==="[object Array]"){for(y=x=0,B=C.length;x<B;y=++x){E=C[y];z[y]=b.str(y,C)||"null"}return(z.length===0?"[]":"["+z.join(",")+"]")}for(w in C){if(Object.prototype.hasOwnProperty.call(C,w)){E=b.str(w,C);if(E){z.push(b.quote(w)+":"+E)}}}return(z.length===0?"{}":"{"+z.join(",")+"}")}};r=function(w){return b.str("",{"":w})};this.Tree.toJson=r;i=function(w){return(""+w).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};v={getName:function(w){if(w===v.BEFORE){return"before"}else{if(w===v.AFTER){return"after"}else{if(w===v.INSIDE){return"inside"}else{return"none"}}}}};v.BEFORE=1;v.AFTER=2;v.INSIDE=3;v.NONE=4;this.Tree.Position=v;t=(function(){function w(x){this.setData(x)}w.prototype.setData=function(z){var x,y;if(typeof z!=="object"){this.name=z}else{for(x in z){y=z[x];if(x==="label"){this.name=y}else{this[x]=y}}}this.children=[];return this.parent=null};w.prototype.initFromData=function(y){var x,z,A=this;z=function(B){A.setData(B);if(B.children){return x(B.children)}};x=function(E){var F,C,D,B;for(D=0,B=E.length;D<B;D++){F=E[D];C=new w("");C.initFromData(F);A.addChild(C)}return null};z(y);return null};w.prototype.loadFromData=function(A){var y,B,z,x;this.children=[];for(z=0,x=A.length;z<x;z++){B=A[z];y=new w(B);this.addChild(y);if(typeof B==="object"&&B.children){y.loadFromData(B.children)}}return null};w.prototype.addChild=function(x){this.children.push(x);return x._setParent(this)};w.prototype.addChildAtPosition=function(y,x){this.children.splice(x,0,y);return y._setParent(this)};w.prototype._setParent=function(x){this.parent=x;this.tree=x.tree;return this.tree.addNodeToIndex(this)};w.prototype.removeChild=function(x){this.children.splice(this.getChildIndex(x),1);return this.tree.removeNodeFromIndex(x)};w.prototype.getChildIndex=function(x){return d.inArray(x,this.children)};w.prototype.hasChildren=function(){return this.children.length!==0};w.prototype.iterate=function(z){var x,y=this;x=function(C,G){var F,A,E,B,D;if(C.children){D=C.children;for(E=0,B=D.length;E<B;E++){F=D[E];A=z(F,G);if(y.hasChildren()&&A){x(F,G+1)}}return null}};x(this,0);return null};w.prototype.moveNode=function(y,z,x){y.parent.removeChild(y);if(x===v.AFTER){return z.parent.addChildAtPosition(y,z.parent.getChildIndex(z)+1)}else{if(x===v.BEFORE){return z.parent.addChildAtPosition(y,z.parent.getChildIndex(z))}else{if(x===v.INSIDE){return z.addChildAtPosition(y,0)}}}};w.prototype.getData=function(){var x,y=this;x=function(C){var G,B,E,D,A,F,z;G=[];for(F=0,z=C.length;F<z;F++){E=C[F];D={};for(B in E){A=E[B];if((B!=="parent"&&B!=="children"&&B!=="element"&&B!=="tree")&&Object.prototype.hasOwnProperty.call(E,B)){D[B]=A}}if(E.hasChildren()){D.children=x(E.children)}G.push(D)}return G};return x(this.children)};w.prototype.getNodeByName=function(y){var x;x=null;this.iterate(function(z){if(z.name===y){x=z;return false}else{return true}});return x};w.prototype.addAfter=function(y){var z,x;if(!this.parent){return null}else{x=new w(y);z=this.parent.getChildIndex(this);this.parent.addChildAtPosition(x,z+1);return x}};w.prototype.addBefore=function(y){var z,x;if(!this.parent){return null}else{x=new w(y);z=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(x,z)}};w.prototype.addParent=function(B){var D,C,A,z,x,y;if(!this.parent){return null}else{C=new w(B);C._setParent(this.tree);A=this.parent;y=A.children;for(z=0,x=y.length;z<x;z++){D=y[z];C.addChild(D)}A.children=[];A.addChild(C);return C}};w.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};w.prototype.append=function(y){var x;x=new w(y);this.addChild(x);return x};w.prototype.prepend=function(y){var x;x=new w(y);this.addChildAtPosition(x,0);return x};return w})();q=(function(w){u(x,w);function x(y){x.__super__.constructor.call(this,y,null,true);this.id_mapping={};this.tree=this}x.prototype.getNodeById=function(y){return this.id_mapping[y]};x.prototype.addNodeToIndex=function(y){if(y.id){return this.id_mapping[y.id]=y}};x.prototype.removeNodeFromIndex=function(y){if(y.id){return delete this.id_mapping[y.id]}};return x})(t);this.Tree.Tree=q;e=(function(x){u(w,x);function w(){return w.__super__.constructor.apply(this,arguments)}w.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:false,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,autoEscape:true,dataUrl:null};w.prototype.toggle=function(y){if(y.hasChildren()){new p(y,this.element).toggle()}return this._saveState()};w.prototype.getTree=function(){return this.tree};w.prototype.selectNode=function(y,z){return this.select_node_handler.selectNode(y,z)};w.prototype.getSelectedNode=function(){return this.selected_node||false};w.prototype.toJson=function(){return r(this.tree.getData())};w.prototype.loadData=function(C,D){var E,B,A,y,z;if(!D){this._initTree(C)}else{B=new t("");B._setParent(D.tree);B.loadFromData(C);z=B.children;for(A=0,y=z.length;A<y;A++){E=z[A];D.addChild(E)}this._refreshElements(D.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};w.prototype.getNodeById=function(y){return this.tree.getNodeById(y)};w.prototype.getNodeByName=function(y){return this.tree.getNodeByName(y)};w.prototype.openNode=function(y,z){if(y.hasChildren()){new p(y,this.element).open(null,z);return this._saveState()}};w.prototype.closeNode=function(y,z){if(y.hasChildren()){new p(y,this.element).close(z);return this._saveState()}};w.prototype.isDragging=function(){return this.is_dragging};w.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};w.prototype.addNodeAfter=function(z,y){var A;A=y.addAfter(z);this._refreshElements(y.parent);return A};w.prototype.addNodeBefore=function(z,y){var A;A=y.addBefore(z);this._refreshElements(y.parent);return A};w.prototype.addParentNode=function(z,y){var A;A=y.addParent(z);this._refreshElements(A.parent);return A};w.prototype.removeNode=function(z){var y;y=z.parent;if(y){z.remove();return this._refreshElements(y.parent)}};w.prototype.appendNode=function(A,B){var y,z;if(!B){B=this.tree}y=B.hasChildren();z=B.append(A);if(y){this._refreshElements(B)}else{this._refreshElements(B.parent)}return z};w.prototype.prependNode=function(z,A){var y;if(!A){A=this.tree}y=A.prepend(z);this._refreshElements(A);return y};w.prototype._init=function(){w.__super__._init.call(this);this.element=this.$el;this._initData();this.element.click(d.proxy(this._click,this));return this.element.bind("contextmenu",d.proxy(this._contextmenu,this))};w.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return w.__super__._deinit.call(this)};w.prototype._initData=function(){var y,z=this;if(this.options.data){return this._initTree(this.options.data)}else{y=this.options.dataUrl||this.element.data("url");if(y){return d.ajax({url:y,cache:false,success:function(A){var B;if(d.isArray(A)||typeof A==="object"){B=A}else{B=d.parseJSON(A)}return z._initTree(B)}})}}};w.prototype._initTree=function(z){var y;this.tree=new q();this.tree.loadFromData(z);this.selected_node=null;this.save_state_handler=new c(this);this.select_node_handler=new l(this);this.dnd_handler=new m(this);this._openNodes();this._refreshElements();this.select_node_handler.selectCurrentNode();y=d.Event("tree.init");return this.element.trigger(y)};w.prototype._openNodes=function(){var y;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){y=-1}else{y=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(z,A){z.is_open=true;return A!==y})};w.prototype._refreshElements=function(B){var G,F,y,A,I,E,C,H,z,D=this;if(B==null){B=null}C=function(J){if(D.options.autoEscape){return i(J)}else{return J}};I=function(K){var J;if(K){J=' class="tree"'}else{J=""}return d("<ul"+J+"></ul>")};y=function(J){var K;if(J.hasChildren()){K=F(J)}else{K=A(J)}if(D.options.onCreateLi){D.options.onCreateLi(J,K)}return K};A=function(K){var J;J=C(K.name);return d('<li><div><span class="title">'+J+"</span></div></li>")};F=function(O){var L,M,N,K,J;K=function(){var P;P=["toggler"];if(!O.is_open){P.push("closed")}return P.join(" ")};J=function(){var P;P=["folder"];if(!O.is_open){P.push("closed")}return P.join(" ")};L=K();N=J();M=C(O.name);return d('<li class="'+N+'"><div><a class="'+L+'">&raquo;</a><span class="title">'+M+"</span></div></li>")};E=function(Q,K,R,L){var O,N,J,M,P;N=I(R);Q.append(N);for(M=0,P=K.length;M<P;M++){J=K[M];O=y(J);N.append(O);J.element=O[0];O.data("node",J);if(J.hasChildren()){E(O,J.children,false,J.is_open)}}return null};if(B&&B.parent){H=false;z=this._getNodeElementForNode(B);z.getUl().remove();G=z.$element}else{B=this.tree;G=this.element;G.empty();H=true}return E(G,B.children,H,H)};w.prototype._click=function(B){var y,A,z,C;if(B.ctrlKey){return}y=d(B.target);if(y.is(".toggler")){C=this._getNodeElement(y);if(C&&C.node.hasChildren()){C.toggle();this._saveState();B.preventDefault();return B.stopPropagation()}}else{if(y.is("div")||y.is("span")){z=this._getNode(y);if(z){if((!this.options.onCanSelectNode)||this.options.onCanSelectNode(z)){this.selectNode(z);A=d.Event("tree.click");A.node=z;return this.element.trigger(A)}}}}};w.prototype._getNode=function(y){var z;z=y.closest("li");if(z.length===0){return null}else{return z.data("node")}};w.prototype._getNodeElementForNode=function(y){if(y.hasChildren()){return new p(y,this.element)}else{return new g(y,this.element)}};w.prototype._getNodeElement=function(y){var z;z=this._getNode(y);if(z){return this._getNodeElementForNode(z)}else{return null}};w.prototype._contextmenu=function(B){var y,A,z;y=d(B.target).closest("ul.tree div");if(y.length){z=this._getNode(y);if(z){B.preventDefault();B.stopPropagation();A=d.Event("tree.contextmenu");A.node=z;A.click_event=B;this.element.trigger(A);return false}}};w.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};w.prototype._mouseCapture=function(y){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(y)}else{return false}};w.prototype._mouseStart=function(y){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(y)}else{return false}};w.prototype._mouseDrag=function(y){if(this.options.dragAndDrop){return this.dnd_handler.mouseDrag(y)}else{return false}};w.prototype._mouseStop=function(){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop()}else{return false}};w.prototype.testGenerateHitAreas=function(y){this.dnd_handler.current_item=this._getNodeElementForNode(y);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};return w})(f);j.register(e,"tree");o=(function(){function w(z,y,x){this.$element=y;this.node=z;this.$ghost=d('<li class="ghost"><span class="circle"></span><span class="line"></span></li>');if(x===v.AFTER){this.moveAfter()}else{if(x===v.BEFORE){this.moveBefore()}else{if(x===v.INSIDE){if(z.hasChildren()&&z.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}w.prototype.remove=function(){return this.$ghost.remove()};w.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};w.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};w.prototype.moveInsideOpenFolder=function(){return d(this.node.children[0].element).before(this.$ghost)};w.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("inside")};return w})();h=(function(){function w(y){var x,z;x=y.children("div");z=y.width()-4;this.$hint=d('<span class="border"></span>');x.append(this.$hint);this.$hint.css({width:z,height:x.height()-4})}w.prototype.remove=function(){return this.$hint.remove()};return w})();g=(function(){function w(y,x){this.init(y,x)}w.prototype.init=function(y,x){this.node=y;this.tree_element=x;return this.$element=d(y.element)};w.prototype.getUl=function(){return this.$element.children("ul:first")};w.prototype.getSpan=function(){return this.$element.children("div").find("span.title")};w.prototype.getLi=function(){return this.$element};w.prototype.addDropHint=function(x){if(x===v.INSIDE){return new h(this.$element)}else{return new o(this.node,this.$element,x)}};w.prototype.select=function(){return this.getLi().addClass("selected")};w.prototype.deselect=function(){return this.getLi().removeClass("selected")};return w})();p=(function(x){u(w,x);function w(){return w.__super__.constructor.apply(this,arguments)}w.prototype.toggle=function(){if(this.node.is_open){return this.close()}else{return this.open()}};w.prototype.open=function(A,z){var y,B=this;if(!this.node.is_open){this.node.is_open=true;this.getButton().removeClass("closed");y=function(){var C;B.getLi().removeClass("closed");if(A){A()}C=d.Event("tree.open");C.node=B.node;return B.tree_element.trigger(C)};if(z){return y()}else{return this.getUl().slideDown("fast",y)}}};w.prototype.close=function(z){var y,A=this;if(this.node.is_open){this.node.is_open=false;this.getButton().addClass("closed");y=function(){var B;A.getLi().addClass("closed");B=d.Event("tree.close");B.node=A.node;return A.tree_element.trigger(B)};if(z){return y()}else{return this.getUl().slideUp("fast",y)}}};w.prototype.getButton=function(){return this.$element.children("div").find("a.toggler")};w.prototype.addDropHint=function(y){if(!this.node.is_open&&y===v.INSIDE){return new h(this.$element)}else{return new o(this.node,this.$element,y)}};return w})(g);s=(function(){function w(z,y,x,A){this.offset_x=y;this.offset_y=x;this.$element=d('<span class="title tree-dragging">'+z.name+"</span>");this.$element.css("position","absolute");A.append(this.$element)}w.prototype.move=function(y,x){return this.$element.offset({left:y-this.offset_x,top:x-this.offset_y})};w.prototype.remove=function(){return this.$element.remove()};return w})();c=(function(){function w(x){this.tree_widget=x}w.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(this.getState())}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),this.getState())}else{if(d.cookie){return d.cookie(this.getCookieName(),this.getState(),{path:"/"})}}}};w.prototype.restoreState=function(){var x;if(this.tree_widget.options.onGetStateFromStorage){x=this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){x=localStorage.getItem(this.getCookieName())}else{if(d.cookie){x=d.cookie(this.getCookieName(),{path:"/"})}else{x=null}}}if(!x){return false}else{this.setState(x);return true}};w.prototype.getState=function(){var y,x,z=this;y=[];this.tree_widget.tree.iterate(function(A){if(A.is_open&&A.id&&A.hasChildren()){y.push(A.id)}return true});x="";if(this.tree_widget.selected_node){x=this.tree_widget.selected_node.id}return r({open_nodes:y,selected_node:x})};w.prototype.setState=function(z){var y,A,x,B=this;y=d.parseJSON(z);if(y){A=y.open_nodes;x=y.selected_node;return this.tree_widget.tree.iterate(function(C){if(C.id&&C.hasChildren()&&(a(A,C.id)>=0)){C.is_open=true}if(x&&(C.id===x)){B.tree_widget.selected_node=C}return true})}};w.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return w})();l=(function(){function w(x){this.tree_widget=x}w.prototype.selectNode=function(y,z){var x;if(this.tree_widget.options.selectable){if(this.tree_widget.selected_node){this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node).deselect();this.tree_widget.selected_node=null}if(y){this.tree_widget._getNodeElementForNode(y).select();this.tree_widget.selected_node=y;if(z){x=this.tree_widget.selected_node.parent;while(x){if(!x.is_open){this.tree_widget.openNode(x,true)}x=x.parent}}}if(this.tree_widget.options.saveState){return this.tree_widget.save_state_handler.saveState()}}};w.prototype.selectCurrentNode=function(){var x;if(this.tree_widget.selected_node){x=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node);if(x){return x.select()}}};return w})();m=(function(){function w(x){this.tree_widget=x;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}w.prototype.mouseCapture=function(y){var x,z;x=d(y.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(x)){return null}z=this.tree_widget._getNodeElement(x);if(z&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(z.node)){z=null}}this.current_item=z;return this.current_item!==null};w.prototype.mouseStart=function(y){var x,A,z;this.refreshHitAreas();z=this.getOffsetFromEvent(y),x=z[0],A=z[1];this.drag_element=new s(this.current_item.node,x,A,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("moving");return true};w.prototype.mouseDrag=function(y){var x,z;this.drag_element.move(y.pageX,y.pageY);x=this.findHoveredArea(y.pageX,y.pageY);if(x&&this.tree_widget.options.onCanMoveTo){z=v.getName(x.position);if(!this.tree_widget.options.onCanMoveTo(this.current_item.node,x.node,z)){x=null}}if(!x){this.removeDropHint();this.removeHover();this.stopOpenFolderTimer()}else{if(this.hovered_area!==x){this.hovered_area=x;this.updateDropHint()}}return true};w.prototype.mouseStop=function(){this.moveItem();this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("moving");this.is_dragging=false;return false};w.prototype.getOffsetFromEvent=function(y){var x;x=d(y.target).offset();return[y.pageX-x.left,y.pageY-x.top]};w.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};w.prototype.removeHitAreas=function(){return this.hit_areas=[]};w.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};w.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};w.prototype.removeHover=function(){return this.hovered_area=null};w.prototype.generateHitAreas=function(){var x,E,z,D,B,I,y,C,A,G,F,H=this;F=[];G=0;E=function(J){return J.offset().top};x=function(K,J,L){F.push({top:L,node:K,position:J});return G=L};z=function(O){var N,J,M,L,K;M=-1;N=[];for(L=0,K=F.length;L<K;L++){J=F[L];if(J.top!==M){if(N.length){O(N,M,J.top)}M=J.top;N=[]}N.push(J)}return O(N,M,H.tree_widget.element.offset().top+H.tree_widget.element.height())};y=function(L,K,J){var M;M=E(J);if(L===H.current_item.node){x(L,v.NONE,M)}else{x(L,v.INSIDE,M)}if(K===H.current_item.node||L===H.current_item.node){return x(L,v.NONE,M)}else{return x(L,v.AFTER,M)}};C=function(K,J){if(K===H.current_item.node){return false}if(K.children[0]!==H.current_item.node){x(K,v.INSIDE,E(J))}return true};D=function(L,K,J){if(L===H.current_item.node||K===H.current_item.node){return x(L,v.NONE,G)}else{return x(L,v.AFTER,G)}};B=function(L,K,J){var M;M=E(J);if(L===H.current_item.node){return x(L,v.NONE,M)}else{x(L,v.INSIDE,M);if(K!==H.current_item.node){return x(L,v.AFTER,M)}}};I=function(K,J){if(K!==H.current_item.node){return x(K,v.BEFORE,E(d(K.element)))}};this.iterateVisibleNodes(y,C,B,D,I);A=[];z(function(M,Q,L){var N,P,J,O,K;N=(L-Q)/M.length;P=Q;for(O=0,K=M.length;O<K;O++){J=M[O];A.push({top:P,bottom:P+N,node:J.node,position:J.position});P+=N}return null});return this.hit_areas=A};w.prototype.iterateVisibleNodes=function(z,E,y,C,A){var B,x,D=this;B=true;x=function(H,F){var O,G,N,K,L,I,M,J;L=(H.is_open||!H.element)&&H.hasChildren();if(H.element){O=d(H.element);if(!O.is(":visible")){return}if(B){A(H,O);B=false}if(!H.hasChildren()){z(H,F,O)}else{if(H.is_open){if(!E(H,O)){L=false}}else{y(H,F,O)}}}if(L){N=H.children.length;J=H.children;for(K=I=0,M=J.length;I<M;K=++I){G=J[K];if(K===(N-1)){x(H.children[K],null)}else{x(H.children[K],H.children[K+1])}}if(H.is_open){return C(H,F,O)}}};return x(this.tree_widget.tree)};w.prototype.findHoveredArea=function(A,F){var D,E,z,C,B;B=this.tree_widget.element.offset();if(A<B.left||F<B.top||A>(B.left+this.tree_widget.element.width())||F>(B.top+this.tree_widget.element.height())){return null}z=0;E=this.hit_areas.length;while(z<E){C=(z+E)>>1;D=this.hit_areas[C];if(F<D.top){E=C}else{if(F>D.bottom){z=C+1}else{return D}}}return null};w.prototype.updateDropHint=function(){var x,y;this.stopOpenFolderTimer();if(!this.hovered_area){return}x=this.hovered_area.node;if(x.hasChildren()&&!x.is_open&&this.hovered_area.position===v.INSIDE){this.startOpenFolderTimer(x)}this.removeDropHint();y=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=y.addDropHint(this.hovered_area.position)};w.prototype.startOpenFolderTimer=function(y){var x,z=this;x=function(){return z.tree_widget._getNodeElementForNode(y).open(function(){z.refreshHitAreas();return z.updateDropHint()})};return this.open_folder_timer=setTimeout(x,500)};w.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};w.prototype.moveItem=function(){var z,B,A,x,y,C,D=this;if(this.hovered_area&&this.hovered_area.position!==v.NONE){A=this.current_item.node;C=this.hovered_area.node;x=this.hovered_area.position;y=A.parent;if(x===v.INSIDE){this.hovered_area.node.is_open=true}z=function(){D.tree_widget.tree.moveNode(A,C,x);D.tree_widget.element.empty();return D.tree_widget._refreshElements()};B=d.Event("tree.move");B.move_info={moved_node:A,target_node:C,position:v.getName(x),previous_parent:y,do_move:z};this.tree_widget.element.trigger(B);if(!B.isDefaultPrevented()){return z()}}};return w})();this.Tree.Node=t}).call(this);