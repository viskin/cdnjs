(function(){var c,h,m,s,p,o,d,e,t,g,x,b,l,j,r,i,a,w,f,v,q,n=[].slice,k={}.hasOwnProperty,u=function(B,z){for(var y in z){if(k.call(z,y)){B[y]=z[y]}}function A(){this.constructor=B}A.prototype=z.prototype;B.prototype=new A();B.__super__=z.prototype;return B};c=this.jQuery;j=(function(){y.prototype.defaults={};function y(A,z){this.$el=c(A);this.options=c.extend({},this.defaults,z)}y.prototype.destroy=function(){return this._deinit()};y.prototype._init=function(){return null};y.prototype._deinit=function(){return null};y.register=function(E,C){var D,B,z,A;A=function(){return"simple_widget_"+C};B=function(H,G){var J,I,L,K,F;J=A();for(K=0,F=H.length;K<F;K++){I=H[K];L=new E(I,G);if(!c.data(I,J)){c.data(I,J,L)}L._init()}return H};z=function(H){var J,I,L,K,G,F;J=A();F=[];for(K=0,G=H.length;K<G;K++){I=H[K];L=c.data(I,J);if(L&&(L instanceof y)){L.destroy()}F.push(c.removeData(I,J))}return F};D=function(M,J,K){var F,N,I,G,H,L;N=null;for(H=0,L=M.length;H<L;H++){F=M[H];I=c.data(F,A());if(I&&(I instanceof y)){G=I[J];if(G&&(typeof G==="function")){N=G.apply(I,K)}}}return N};return c.fn[C]=function(){var H,G,I,J,F;I=arguments[0],G=2<=arguments.length?n.call(arguments,1):[];H=this;if(I===void 0||typeof I==="object"){F=I;return B(H,F)}else{if(typeof I==="string"&&I[0]!=="_"){J=I;if(J==="destroy"){return z(H)}else{return D(H,J,G)}}}}};return y})();this.SimpleWidget=j;e=(function(y){u(z,y);function z(){return z.__super__.constructor.apply(this,arguments)}z.is_mouse_handled=false;z.prototype._init=function(){this.$el.bind("mousedown.mousewidget",c.proxy(this._mouseDown,this));return this.is_mouse_started=false};z.prototype._deinit=function(){var A;this.$el.unbind("mousedown.mousewidget");A=c(document);A.unbind("mousemove.mousewidget");return A.unbind("mouseup.mousewidget")};z.prototype._mouseDown=function(A){var B;if(z.is_mouse_handled){return}if(!this.is_mouse_started){this._mouseUp(A)}if(A.which!==1){return}if(!this._mouseCapture(A)){return}this.mouse_down_event=A;B=c(document);B.bind("mousemove.mousewidget",c.proxy(this._mouseMove,this));B.bind("mouseup.mousewidget",c.proxy(this._mouseUp,this));A.preventDefault();this.is_mouse_handled=true;return true};z.prototype._mouseMove=function(A){if(this.is_mouse_started){this._mouseDrag(A);return A.preventDefault()}this.is_mouse_started=this._mouseStart(this.mouse_down_event)!==false;if(this.is_mouse_started){this._mouseDrag(A)}else{this._mouseUp(A)}return !this.is_mouse_started};z.prototype._mouseUp=function(A){var B;B=c(document);B.unbind("mousemove.mousewidget");B.unbind("mouseup.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(A)}return false};z.prototype._mouseCapture=function(A){return true};z.prototype._mouseStart=function(A){return null};z.prototype._mouseDrag=function(A){return null};z.prototype._mouseStop=function(A){return null};return z})(j);this.Tree={};c=this.jQuery;a=function(D,A){var z,C,B,y;if(D.indexOf){return D.indexOf(A)}else{for(z=B=0,y=D.length;B<y;z=++B){C=D[z];if(C===A){return z}}return -1}};this.Tree.indexOf=a;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){w=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};v=function(y){w.lastIndex=0;if(w.test(y)){return'"'+y.replace(w,function(z){var A;A=f[z];return(typeof A==="string"?A:"\\u"+("0000"+z.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+y+'"'}};q=function(F,C){var A,y,B,G,E,z,D;E=C[F];switch(typeof E){case"string":return v(E);case"number":if(isFinite(E)){return String(E)}else{return"null"}case"boolean":case"null":return String(E);case"object":if(!E){return"null"}B=[];if(Object.prototype.toString.apply(E)==="[object Array]"){for(A=z=0,D=E.length;z<D;A=++z){G=E[A];B[A]=q(A,E)||"null"}return(B.length===0?"[]":"["+B.join(",")+"]")}for(y in E){if(Object.prototype.hasOwnProperty.call(E,y)){G=q(y,E);if(G){B.push(v(y)+":"+G)}}}return(B.length===0?"{}":"{"+B.join(",")+"}")}};if(!(this.JSON!=null)){this.JSON={}}this.JSON.stringify=function(y){return q("",{"":y})}}i=function(y){return(""+y).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};x={getName:function(y){return x.strings[y-1]},nameToIndex:function(y){var z,B,A;for(z=B=1,A=x.strings.length;1<=A?B<=A:B>=A;z=1<=A?++B:--B){if(x.strings[z-1]===y){return z}}return 0}};x.BEFORE=1;x.AFTER=2;x.INSIDE=3;x.NONE=4;x.strings=["before","after","inside","none"];this.Tree.Position=x;t=(function(){function y(z){this.setData(z);this.children=[];this.parent=null}y.prototype.setData=function(C){var A,B,z;if(typeof C!=="object"){return this.name=C}else{z=[];for(A in C){B=C[A];if(A==="label"){z.push(this.name=B)}else{z.push(this[A]=B)}}return z}};y.prototype.initFromData=function(A){var z,B,C=this;B=function(D){C.setData(D);if(D.children){return z(D.children)}};z=function(G){var H,E,F,D;for(F=0,D=G.length;F<D;F++){H=G[F];E=new y("");E.initFromData(H);C.addChild(E)}return null};B(A);return null};y.prototype.loadFromData=function(C){var A,D,B,z;this.children=[];for(B=0,z=C.length;B<z;B++){D=C[B];A=new y(D);this.addChild(A);if(typeof D==="object"&&D.children){A.loadFromData(D.children)}}return null};y.prototype.addChild=function(z){this.children.push(z);return z._setParent(this)};y.prototype.addChildAtPosition=function(A,z){this.children.splice(z,0,A);return A._setParent(this)};y.prototype._setParent=function(z){this.parent=z;this.tree=z.tree;return this.tree.addNodeToIndex(this)};y.prototype.removeChild=function(z){this.children.splice(this.getChildIndex(z),1);return this.tree.removeNodeFromIndex(z)};y.prototype.getChildIndex=function(z){return c.inArray(z,this.children)};y.prototype.hasChildren=function(){return this.children.length!==0};y.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};y.prototype.iterate=function(B){var z,A=this;z=function(E,I){var H,C,G,D,F;if(E.children){F=E.children;for(G=0,D=F.length;G<D;G++){H=F[G];C=B(H,I);if(A.hasChildren()&&C){z(H,I+1)}}return null}};z(this,0);return null};y.prototype.moveNode=function(A,B,z){if(A.isParentOf(B)){return}A.parent.removeChild(A);if(z===x.AFTER){return B.parent.addChildAtPosition(A,B.parent.getChildIndex(B)+1)}else{if(z===x.BEFORE){return B.parent.addChildAtPosition(A,B.parent.getChildIndex(B))}else{if(z===x.INSIDE){return B.addChildAtPosition(A,0)}}}};y.prototype.getData=function(){var z,A=this;z=function(E){var I,D,G,F,C,H,B;I=[];for(H=0,B=E.length;H<B;H++){G=E[H];F={};for(D in G){C=G[D];if((D!=="parent"&&D!=="children"&&D!=="element"&&D!=="tree")&&Object.prototype.hasOwnProperty.call(G,D)){F[D]=C}}if(G.hasChildren()){F.children=z(G.children)}I.push(F)}return I};return z(this.children)};y.prototype.getNodeByName=function(A){var z;z=null;this.iterate(function(B){if(B.name===A){z=B;return false}else{return true}});return z};y.prototype.addAfter=function(A){var B,z;if(!this.parent){return null}else{z=new y(A);B=this.parent.getChildIndex(this);this.parent.addChildAtPosition(z,B+1);return z}};y.prototype.addBefore=function(A){var B,z;if(!this.parent){return null}else{z=new y(A);B=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(z,B)}};y.prototype.addParent=function(D){var F,E,C,B,z,A;if(!this.parent){return null}else{E=new y(D);E._setParent(this.tree);C=this.parent;A=C.children;for(B=0,z=A.length;B<z;B++){F=A[B];E.addChild(F)}C.children=[];C.addChild(E);return E}};y.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};y.prototype.append=function(A){var z;z=new y(A);this.addChild(z);return z};y.prototype.prepend=function(A){var z;z=new y(A);this.addChildAtPosition(z,0);return z};y.prototype.isParentOf=function(A){var z;z=A.parent;while(z){if(z===this){return true}z=z.parent}return false};return y})();r=(function(y){u(z,y);function z(A){z.__super__.constructor.call(this,A,null,true);this.id_mapping={};this.tree=this}z.prototype.getNodeById=function(A){return this.id_mapping[A]};z.prototype.addNodeToIndex=function(A){if(A.id){return this.id_mapping[A.id]=A}};z.prototype.removeNodeFromIndex=function(A){if(A.id){return delete this.id_mapping[A.id]}};return z})(t);this.Tree.Tree=r;d=(function(z){u(y,z);function y(){return y.__super__.constructor.apply(this,arguments)}y.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:false,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,autoEscape:true,dataUrl:null};y.prototype.toggle=function(A){if(A.is_open){return this.closeNode(A)}else{return this.openNode(A)}};y.prototype.getTree=function(){return this.tree};y.prototype.selectNode=function(A,B){return this.select_node_handler.selectNode(A,B)};y.prototype.getSelectedNode=function(){return this.selected_node||false};y.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};y.prototype.loadData=function(E,F){var G,D,C,A,B;this._triggerEvent("tree.load_data",{tree_data:E});if(!F){this._initTree(E)}else{D=new t("");D._setParent(F.tree);D.loadFromData(E);B=D.children;for(C=0,A=B.length;C<A;C++){G=B[C];F.addChild(G)}this._refreshElements(F.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};y.prototype.getNodeById=function(A){return this.tree.getNodeById(A)};y.prototype.getNodeByName=function(A){return this.tree.getNodeByName(A)};y.prototype.openNode=function(A,B){return this._openNode(A,B)};y.prototype._openNode=function(A,C,D){var B;if(A.isFolder()){if(A.load_on_demand){return this._loadFolderOnDemand(A,C,D)}else{B=new p(A,this);B.open(D,C);return this._saveState()}}};y.prototype._loadFolderOnDemand=function(B,D,E){var G,A,C,F=this;B.load_on_demand=false;A=this._getDataUrl(B);C=new p(B,this);if(A&&C){G=C.getLi();G.addClass("jqtree-loading");return this._loadDataFromServer(A,function(H){G.removeClass("loading");F.loadData(H,B);return F._openNode(B,D,E)})}};y.prototype.closeNode=function(A,B){if(A.isFolder()){new p(A,this).close(B);return this._saveState()}};y.prototype.isDragging=function(){return this.is_dragging};y.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};y.prototype.addNodeAfter=function(B,A){var C;C=A.addAfter(B);this._refreshElements(A.parent);return C};y.prototype.addNodeBefore=function(B,A){var C;C=A.addBefore(B);this._refreshElements(A.parent);return C};y.prototype.addParentNode=function(B,A){var C;C=A.addParent(B);this._refreshElements(C.parent);return C};y.prototype.removeNode=function(B){var A;A=B.parent;if(A){B.remove();return this._refreshElements(A.parent)}};y.prototype.appendNode=function(C,D){var A,B;if(!D){D=this.tree}A=D.isFolder();B=D.append(C);if(A){this._refreshElements(D)}else{this._refreshElements(D.parent)}return B};y.prototype.prependNode=function(B,C){var A;if(!C){C=this.tree}A=C.prepend(B);this._refreshElements(C);return A};y.prototype.updateNode=function(A,B){A.setData(B);this._refreshElements(A.parent);return this.select_node_handler.selectCurrentNode()};y.prototype.moveNode=function(C,D,A){var B;B=x.nameToIndex(A);this.tree.moveNode(C,D,B);return this._refreshElements()};y.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};y.prototype._init=function(){y.__super__._init.call(this);this.element=this.$el;this.selected_node=null;this.save_state_handler=new b(this);this.select_node_handler=new l(this);this.dnd_handler=new m(this);this._initData();this.element.click(c.proxy(this._click,this));return this.element.bind("contextmenu",c.proxy(this._contextmenu,this))};y.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return y.__super__._deinit.call(this)};y.prototype._initData=function(){var A,B=this;if(this.options.data){return this.loadData(this.options.data)}else{A=this._getDataUrl();if(A){return this._loadDataFromServer(A,function(C){return B.loadData(C)})}}};y.prototype._getDataUrl=function(B){var A;A=this.options.dataUrl||this.element.data("url");if(c.isFunction(A)){return A(B)}else{if(B){A+="?node="+B.id}return A}};y.prototype._loadDataFromServer=function(A,C){var B=this;return c.ajax({url:A,cache:false,success:function(D){var E;if(c.isArray(D)||typeof D==="object"){E=D}else{E=c.parseJSON(D)}return C(E)}})};y.prototype._initTree=function(A){this.tree=new r();this.tree.loadFromData(A);this._openNodes();this._refreshElements();this.select_node_handler.selectCurrentNode();return this._triggerEvent("tree.init")};y.prototype._openNodes=function(){var A;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){A=-1}else{A=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(B,C){B.is_open=true;return C!==A})};y.prototype._refreshElements=function(D){var I,H,A,C,K,G,E,J,B,F=this;if(D==null){D=null}E=function(L){if(F.options.autoEscape){return i(L)}else{return L}};K=function(M){var L;if(M){L=' class="jqtree-tree"'}else{L=""}return c("<ul"+L+"></ul>")};A=function(L){var M;if(L.isFolder()){M=H(L)}else{M=C(L)}if(F.options.onCreateLi){F.options.onCreateLi(L,M)}return M};C=function(M){var L;L=E(M.name);return c('<li><div><span class="jqtree-title">'+L+"</span></div></li>")};H=function(Q){var N,O,P,M,L;M=function(){var R;R=["jqtree-toggler"];if(!Q.is_open){R.push("jqtree-closed")}return R.join(" ")};L=function(){var R;R=["jqtree-folder"];if(!Q.is_open){R.push("jqtree-closed")}return R.join(" ")};N=M();P=L();O=E(Q.name);return c('<li class="'+P+'"><div><a class="'+N+'">&raquo;</a><span class="jqtree-title">'+O+"</span></div></li>")};G=function(S,M,T,N){var Q,P,L,O,R;P=K(T);S.append(P);for(O=0,R=M.length;O<R;O++){L=M[O];Q=A(L);P.append(Q);L.element=Q[0];Q.data("node",L);if(L.hasChildren()){G(Q,L.children,false,L.is_open)}}return null};if(D&&D.parent){J=false;B=this._getNodeElementForNode(D);B.getUl().remove();I=B.$element}else{D=this.tree;I=this.element;I.empty();J=true}G(I,D.children,J,J);return this._triggerEvent("tree.refresh")};y.prototype._click=function(C){var A,B;if(C.ctrlKey){return}A=c(C.target);if(A.is(".jqtree-toggler")){B=this._getNode(A);if(B){this.toggle(B);C.preventDefault();return C.stopPropagation()}}else{if(A.is("div")||A.is("span")){B=this._getNode(A);if(B){if((!this.options.onCanSelectNode)||this.options.onCanSelectNode(B)){this.selectNode(B);return this._triggerEvent("tree.click",{node:B})}}}}};y.prototype._getNode=function(A){var B;B=A.closest("li");if(B.length===0){return null}else{return B.data("node")}};y.prototype._getNodeElementForNode=function(A){if(A.isFolder()){return new p(A,this)}else{return new g(A,this)}};y.prototype._getNodeElement=function(A){var B;B=this._getNode(A);if(B){return this._getNodeElementForNode(B)}else{return null}};y.prototype._contextmenu=function(C){var A,B;A=c(C.target).closest("ul.tree div");if(A.length){B=this._getNode(A);if(B){C.preventDefault();C.stopPropagation();this._triggerEvent("tree.contextmenu",{node:B,click_event:C});return false}}};y.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};y.prototype._mouseCapture=function(A){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(A)}else{return false}};y.prototype._mouseStart=function(A){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(A)}else{return false}};y.prototype._mouseDrag=function(A){if(this.options.dragAndDrop){return this.dnd_handler.mouseDrag(A)}else{return false}};y.prototype._mouseStop=function(){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop()}else{return false}};y.prototype._triggerEvent=function(C,A){var B;B=c.Event(C);c.extend(B,A);this.element.trigger(B);return B};y.prototype.testGenerateHitAreas=function(A){this.dnd_handler.current_item=this._getNodeElementForNode(A);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};return y})(e);j.register(d,"tree");o=(function(){function y(B,A,z){this.$element=A;this.node=B;this.$ghost=c('<li class="jqtree-ghost"><span class="jqtree-circle"></span><span class="jqtree-line"></span></li>');if(z===x.AFTER){this.moveAfter()}else{if(z===x.BEFORE){this.moveBefore()}else{if(z===x.INSIDE){if(B.isFolder()&&B.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}y.prototype.remove=function(){return this.$ghost.remove()};y.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};y.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};y.prototype.moveInsideOpenFolder=function(){return c(this.node.children[0].element).before(this.$ghost)};y.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return y})();h=(function(){function y(A){var z,B;z=A.children("div");B=A.width()-4;this.$hint=c('<span class="jqtree-border"></span>');z.append(this.$hint);this.$hint.css({width:B,height:z.height()-4})}y.prototype.remove=function(){return this.$hint.remove()};return y})();g=(function(){function y(z,A){this.init(z,A)}y.prototype.init=function(z,A){this.node=z;this.tree_widget=A;return this.$element=c(z.element)};y.prototype.getUl=function(){return this.$element.children("ul:first")};y.prototype.getSpan=function(){return this.$element.children("div").find("span.jqtree-title")};y.prototype.getLi=function(){return this.$element};y.prototype.addDropHint=function(z){if(z===x.INSIDE){return new h(this.$element)}else{return new o(this.node,this.$element,z)}};y.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};y.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return y})();p=(function(z){u(y,z);function y(){return y.__super__.constructor.apply(this,arguments)}y.prototype.open=function(C,B){var A,D=this;if(!this.node.is_open){this.node.is_open=true;this.getButton().removeClass("jqtree-closed");A=function(){D.getLi().removeClass("jqtree-closed");if(C){C()}return D.tree_widget._triggerEvent("tree.open",{node:D.node})};if(B){this.getUl().show();return A()}else{return this.getUl().slideDown("fast",A)}}};y.prototype.close=function(B){var A,C=this;if(this.node.is_open){this.node.is_open=false;this.getButton().addClass("jqtree-closed");A=function(){C.getLi().addClass("jqtree-closed");return C.tree_widget._triggerEvent("tree.close",{node:C.node})};if(B){this.getUl().hide();return A()}else{return this.getUl().slideUp("fast",A)}}};y.prototype.getButton=function(){return this.$element.children("div").find("a.jqtree-toggler")};y.prototype.addDropHint=function(A){if(!this.node.is_open&&A===x.INSIDE){return new h(this.$element)}else{return new o(this.node,this.$element,A)}};return y})(g);s=(function(){function y(B,A,z,C){this.offset_x=A;this.offset_y=z;this.$element=c('<span class="jqtree-title jqtree-dragging">'+B.name+"</span>");this.$element.css("position","absolute");C.append(this.$element)}y.prototype.move=function(A,z){return this.$element.offset({left:A-this.offset_x,top:z-this.offset_y})};y.prototype.remove=function(){return this.$element.remove()};return y})();b=(function(){function y(z){this.tree_widget=z}y.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(this.getState())}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.setItem(this.getCookieName(),this.getState())}else{if(c.cookie){return c.cookie(this.getCookieName(),this.getState(),{path:"/"})}}}};y.prototype.restoreState=function(){var z;z=this.getStateFromStorage();if(z){this.setState(z);return true}else{return false}};y.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(typeof localStorage!=="undefined"&&localStorage!==null){return localStorage.getItem(this.getCookieName())}else{if(c.cookie){return c.cookie(this.getCookieName(),{path:"/"})}else{return null}}}};y.prototype.getState=function(){var A,z,B=this;A=[];this.tree_widget.tree.iterate(function(C){if(C.is_open&&C.id&&C.hasChildren()){A.push(C.id)}return true});z="";if(this.tree_widget.selected_node){z=this.tree_widget.selected_node.id}return JSON.stringify({open_nodes:A,selected_node:z})};y.prototype.setState=function(B){var A,C,z,D=this;A=c.parseJSON(B);if(A){C=A.open_nodes;z=A.selected_node;return this.tree_widget.tree.iterate(function(E){if(E.id&&E.hasChildren()&&(a(C,E.id)>=0)){E.is_open=true}if(z&&(E.id===z)){D.tree_widget.selected_node=E}return true})}};y.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};return y})();l=(function(){function y(z){this.tree_widget=z}y.prototype.selectNode=function(A,B){var z;if(this.tree_widget.options.selectable){if(this.tree_widget.selected_node){this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node).deselect();this.tree_widget.selected_node=null}if(A){this.tree_widget._getNodeElementForNode(A).select();this.tree_widget.selected_node=A;if(B){z=this.tree_widget.selected_node.parent;while(z){if(!z.is_open){this.tree_widget.openNode(z,true)}z=z.parent}}}if(this.tree_widget.options.saveState){return this.tree_widget.save_state_handler.saveState()}}};y.prototype.selectCurrentNode=function(){var z;if(this.tree_widget.selected_node){z=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node);if(z){return z.select()}}};return y})();m=(function(){function y(z){this.tree_widget=z;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}y.prototype.mouseCapture=function(A){var z,B;z=c(A.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(z)){return null}B=this.tree_widget._getNodeElement(z);if(B&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(B.node)){B=null}}this.current_item=B;return this.current_item!==null};y.prototype.mouseStart=function(A){var z,C,B;this.refreshHitAreas();B=this.getOffsetFromEvent(A),z=B[0],C=B[1];this.drag_element=new s(this.current_item.node,z,C,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};y.prototype.mouseDrag=function(A){var z,B;this.drag_element.move(A.pageX,A.pageY);z=this.findHoveredArea(A.pageX,A.pageY);if(z&&this.tree_widget.options.onCanMoveTo){B=x.getName(z.position);if(!this.tree_widget.options.onCanMoveTo(this.current_item.node,z.node,B)){z=null}}if(!z){this.removeDropHint();this.removeHover();this.stopOpenFolderTimer()}else{if(this.hovered_area!==z){this.hovered_area=z;this.updateDropHint()}}return true};y.prototype.mouseStop=function(){this.moveItem();this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("jqtree-moving");this.is_dragging=false;return false};y.prototype.getOffsetFromEvent=function(A){var z;z=c(A.target).offset();return[A.pageX-z.left,A.pageY-z.top]};y.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};y.prototype.removeHitAreas=function(){return this.hit_areas=[]};y.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};y.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};y.prototype.removeHover=function(){return this.hovered_area=null};y.prototype.generateHitAreas=function(){var z,G,B,F,D,K,A,E,C,I,H,J=this;H=[];I=0;G=function(L){return L.offset().top};z=function(M,L,N){H.push({top:N,node:M,position:L});return I=N};B=function(Q){var P,L,O,N,M;O=-1;P=[];for(N=0,M=H.length;N<M;N++){L=H[N];if(L.top!==O){if(P.length){Q(P,O,L.top)}O=L.top;P=[]}P.push(L)}return Q(P,O,J.tree_widget.element.offset().top+J.tree_widget.element.height())};A=function(N,M,L){var O;O=G(L);if(N===J.current_item.node){z(N,x.NONE,O)}else{z(N,x.INSIDE,O)}if(M===J.current_item.node||N===J.current_item.node){return z(N,x.NONE,O)}else{return z(N,x.AFTER,O)}};E=function(M,L){if(M===J.current_item.node){return false}if(M.children[0]!==J.current_item.node){z(M,x.INSIDE,G(L))}return true};F=function(N,M,L){if(N===J.current_item.node||M===J.current_item.node){return z(N,x.NONE,I)}else{return z(N,x.AFTER,I)}};D=function(N,M,L){var O;O=G(L);if(N===J.current_item.node){return z(N,x.NONE,O)}else{z(N,x.INSIDE,O);if(M!==J.current_item.node){return z(N,x.AFTER,O)}}};K=function(M,L){if(M!==J.current_item.node){return z(M,x.BEFORE,G(c(M.element)))}};this.iterateVisibleNodes(A,E,D,F,K);C=[];B(function(O,S,N){var P,R,L,Q,M;P=(N-S)/O.length;R=S;for(Q=0,M=O.length;Q<M;Q++){L=O[Q];C.push({top:R,bottom:R+P,node:L.node,position:L.position});R+=P}return null});return this.hit_areas=C};y.prototype.iterateVisibleNodes=function(B,G,A,E,C){var D,z,F=this;D=true;z=function(J,H){var Q,I,P,M,N,K,O,L;N=(J.is_open||!J.element)&&J.hasChildren();if(J.element){Q=c(J.element);if(!Q.is(":visible")){return}if(D){C(J,Q);D=false}if(!J.hasChildren()){B(J,H,Q)}else{if(J.is_open){if(!G(J,Q)){N=false}}else{A(J,H,Q)}}}if(N){P=J.children.length;L=J.children;for(M=K=0,O=L.length;K<O;M=++K){I=L[M];if(M===(P-1)){z(J.children[M],null)}else{z(J.children[M],J.children[M+1])}}if(J.is_open){return E(J,H,Q)}}};return z(this.tree_widget.tree)};y.prototype.findHoveredArea=function(A,F){var D,E,z,C,B;B=this.tree_widget.element.offset();if(A<B.left||F<B.top||A>(B.left+this.tree_widget.element.width())||F>(B.top+this.tree_widget.element.height())){return null}z=0;E=this.hit_areas.length;while(z<E){C=(z+E)>>1;D=this.hit_areas[C];if(F<D.top){E=C}else{if(F>D.bottom){z=C+1}else{return D}}}return null};y.prototype.updateDropHint=function(){var z,A;this.stopOpenFolderTimer();if(!this.hovered_area){return}z=this.hovered_area.node;if(z.isFolder()&&!z.is_open&&this.hovered_area.position===x.INSIDE){this.startOpenFolderTimer(z)}this.removeDropHint();A=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=A.addDropHint(this.hovered_area.position)};y.prototype.startOpenFolderTimer=function(A){var z,B=this;z=function(){return B.tree_widget._openNode(A,false,function(){B.refreshHitAreas();return B.updateDropHint()})};return this.open_folder_timer=setTimeout(z,500)};y.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};y.prototype.moveItem=function(){var B,D,C,z,A,E,F=this;if(this.hovered_area&&this.hovered_area.position!==x.NONE){C=this.current_item.node;E=this.hovered_area.node;z=this.hovered_area.position;A=C.parent;if(z===x.INSIDE){this.hovered_area.node.is_open=true}B=function(){F.tree_widget.tree.moveNode(C,E,z);F.tree_widget.element.empty();return F.tree_widget._refreshElements()};D=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:C,target_node:E,position:x.getName(z),previous_parent:A,do_move:B}});if(!D.isDefaultPrevented()){return B()}}};return y})();this.Tree.Node=t}).call(this);