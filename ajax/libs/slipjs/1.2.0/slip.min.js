window.Slip=function(){"use strict";function t(e,i){if("string"==typeof e&&(e=document.querySelector(e)),!e||!e.addEventListener)throw new Error("Please specify DOM node to attach to");return this&&this!==window?(this.options=i,this.cancel=this.setState.bind(this,this.states.idle),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onSelection=this.onSelection.bind(this),this.setState(this.states.idle),void this.attach(e)):new t(e,i)}function e(t){var e=t.style[h];if(e)return{value:e,original:e};if(window.getComputedStyle){var i=window.getComputedStyle(t).getPropertyValue(l);if(i&&"none"!==i)return{value:i,original:""}}return{value:"",original:""}}function i(t,e){for(var i=0,n=0,s=0;s<e.length;s++)1===e[s].nodeType&&(n++,e[s]===t.node&&(i=n-1));return i}var n=/Chrome\/[34]/.test(navigator.userAgent),s=n,o=n,a=document.createElement("div"),r="webkitTransition"in a.style?"webkitTransition":"transition",h="webkitTransform"in a.style?"webkitTransform":"transform",l="webkitTransform"===h?"-webkit-transform":"transform",c="webkitUserSelect"in a.style?"webkitUserSelect":"userSelect";a.style[h]="translateZ(0)";var u=a.style[h]?"translateZ(0) ":"",d=a.style[h]?"translateZ(1px) ":"";a=null;var v=0,f=!1,g=function(){};return t.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function(){return this.target=null,this.usingTouch=!1,this.removeMouseHandlers(),{allowTextSelection:!0}},undecided:function(){if(this.target.height=this.target.node.offsetHeight,this.target.node.style[r]="",this.dispatch(this.target.originalTarget,"beforewait"))var t=setTimeout(function(){var t=this.getAbsoluteMovement();this.canPreventScrolling&&t.x<15&&t.y<25&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300);else this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder);return{leaveState:function(){clearTimeout(t)},onMove:function(){var t=this.getAbsoluteMovement();if(t.x>20&&t.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe"))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}return t.y>20&&this.setState(this.states.idle),t.x>1.2*t.y?!1:void 0},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var t=this.dispatch(this.target.originalTarget,"tap");return this.setState(this.states.idle),t}}},swipe:function(){function t(){n.className=n.className.replace(/(?:^| )slip-swiping-container/,"")}var e=!1,n=this.container,s=i(this.target,this.container.childNodes);return n.className+=" slip-swiping-container",this.target.height=this.target.node.offsetHeight,{leaveState:function(){e?this.animateSwipe(function(e){return e.node.style[h]=e.baseTransform.original,e.node.style[r]="",this.dispatch(e.node,"afterswipe")?(t(),!0):void this.animateToZero(void 0,e)}.bind(this)):(this.animateToZero(t),this.dispatch(this.target.node,"cancelswipe"))},onMove:function(){var t=this.getTotalMovement();return Math.abs(t.y)<this.target.height+20?(this.target.node.style[h]="translate("+t.x+"px,0) "+u+this.target.baseTransform.value,!1):void this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var t,i=this.latestPosition.x-this.previousPosition.x,n=this.latestPosition.y-this.previousPosition.y,o=Math.sqrt(i*i+n*n)/(this.latestPosition.time-this.previousPosition.time+1),a=this.getAbsoluteMovement(),r=o>.6&&a.time>110;return t=i>0?"right":"left",r&&this.dispatch(this.target.node,"swipe",{direction:t,originalIndex:s})&&(e=!0),this.setState(this.states.idle),!r}}},reorder:function(){function t(){n&&(clearTimeout(n),n=null);var t=this.getTotalMovement();this.target.node.style[h]="translate(0,"+t.y+"px) "+d+this.target.baseTransform.value;var e=this.target.height;return f.forEach(function(i){var n=0;i.pos<0&&t.y<0&&i.pos>t.y?n=e:i.pos>0&&t.y>0&&i.pos<t.y&&(n=-e),i.node.style[h]=n?"translate(0,"+n+"px) "+u+i.baseTransform.value:i.baseTransform.original}),!1}this.target.height=this.target.node.offsetHeight;for(var n,s=this.container.childNodes,a=i(this.target,s),v=this.target.node.offsetTop+this.target.height/2,f=[],g=0;g<s.length;g++)if(1==s[g].nodeType&&s[g]!==this.target.node){var m=s[g].offsetTop;s[g].style[r]=l+" 0.2s ease-in-out",f.push({node:s[g],baseTransform:e(s[g]),pos:m+(v>m?s[g].offsetHeight:0)-v})}return this.target.node.className+=" slip-reordering",this.target.node.style.zIndex="99999",this.target.node.style[c]="none",o&&(this.container.style.webkitTransformStyle="preserve-3d"),t.call(this),{leaveState:function(){n&&clearTimeout(n),o&&(this.container.style.webkitTransformStyle=""),this.target.node.className=this.target.node.className.replace(/(?:^| )slip-reordering/,""),this.target.node.style[c]="",this.animateToZero(function(t){t.node.style.zIndex=""}),f.forEach(function(t){t.node.style[h]=t.baseTransform.original,t.node.style[r]=""})},onMove:t,onLeave:function(){n&&clearTimeout(n),n=setTimeout(function(){n=null,this.cancel()}.bind(this),700)},onEnd:function(){var t=this.getTotalMovement();if(t.y<0){for(var e=0;e<f.length;e++)if(f[e].pos>t.y){this.dispatch(this.target.node,"reorder",{spliceIndex:e,insertBefore:f[e].node,originalIndex:a});break}}else for(var e=f.length-1;e>=0;e--)if(f[e].pos<t.y){this.dispatch(this.target.node,"reorder",{spliceIndex:e+1,insertBefore:f[e+1]?f[e+1].node:null,originalIndex:a});break}return this.setState(this.states.idle),!1}}}},attach:function(t){v++,this.container&&this.detach(),!f&&s&&(f=!0,document.body.addEventListener("touchstart",g,!1)),this.container=t,this.otherNodes=[],document.addEventListener("selectionchange",this.onSelection,!1),this.container.addEventListener("touchcancel",this.cancel,!1),this.container.addEventListener("touchstart",this.onTouchStart,!1),this.container.addEventListener("touchmove",this.onTouchMove,!1),this.container.addEventListener("touchend",this.onTouchEnd,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel(),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("touchend",this.onTouchEnd,!1),this.container.removeEventListener("touchmove",this.onTouchMove,!1),this.container.removeEventListener("touchstart",this.onTouchStart,!1),this.container.removeEventListener("touchcancel",this.cancel,!1),document.removeEventListener("selectionchange",this.onSelection,!1),v--,!v&&f&&(f=!1,document.body.removeEventListener("touchstart",g,!1))},setState:function(t){if(this.state){if(this.state.ctor===t)return;this.state.leaveState&&this.state.leaveState.call(this)}var e=this.state,i=t.call(this);this.state===e&&(i.ctor=t,this.state=i)},findTargetNode:function(t){for(;t&&t.parentNode!==this.container;)t=t.parentNode;return t},onSelection:function(t){var e=t.target===document||this.findTargetNode(t);e&&(t.cancelable||t.defaultPrevented?this.state.allowTextSelection||t.preventDefault():this.setState(this.states.idle))},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(t){this.usingTouch||(t.target===document.documentElement||t.relatedTarget===document.documentElement)&&this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(t){!this.usingTouch&&0==t.button&&this.setTarget(t)&&(this.addMouseHandlers(),this.canPreventScrolling=!0,this.startAtPosition({x:t.clientX,y:t.clientY,time:t.timeStamp}))},onTouchStart:function(t){return this.usingTouch=!0,this.canPreventScrolling=!0,t.touches.length>1?void this.setState(this.states.idle):void(this.setTarget(t)&&this.startAtPosition({x:t.touches[0].clientX,y:t.touches[0].clientY-window.scrollY,time:t.timeStamp}))},setTarget:function(t){var i=this.findTargetNode(t.target);if(!i)return this.setState(this.states.idle),!1;for(var n=i.parentNode;n&&!(n.scrollHeight>n.clientHeight&&"visible"!=window.getComputedStyle(n)["overflow-y"]);)n=n.parentNode;return this.target={originalTarget:t.target,node:i,scrollContainer:n,baseTransform:e(i)},!0},startAtPosition:function(t){this.startPosition=this.previousPosition=this.latestPosition=t,this.setState(this.states.undecided)},updatePosition:function(t,e){if(null!=this.target){this.latestPosition=e;var i=40,n=0,s=this.target.scrollContainer||document.body,o=s.getBoundingClientRect(),a=this.target.node.getBoundingClientRect(),r=Math.min(o.bottom,window.innerHeight)-a.bottom,h=a.top-Math.max(o.top,0);i>r?n=i-r:i>h&&(n=h-i);var l=s.scrollTop;s.scrollTop+=n,l!=s.scrollTop&&(this.startPosition.y+=l-s.scrollTop),this.state.onMove&&this.state.onMove.call(this)===!1&&t.preventDefault(),this.latestPosition.time-this.previousPosition.time>100&&(this.previousPosition=this.latestPosition)}},onMouseMove:function(t){this.updatePosition(t,{x:t.clientX,y:t.clientY,time:t.timeStamp})},onTouchMove:function(t){this.updatePosition(t,{x:t.touches[0].clientX,y:t.touches[0].clientY-window.scrollY,time:t.timeStamp}),this.canPreventScrolling=!1},onMouseUp:function(t){this.usingTouch||0!==t.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&t.preventDefault()},onTouchEnd:function(t){t.touches.length>1?this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&t.preventDefault()},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}},getAbsoluteMovement:function(){return{x:Math.abs(this.latestPosition.x-this.startPosition.x),y:Math.abs(this.latestPosition.y-this.startPosition.y),time:this.latestPosition.time-this.startPosition.time}},dispatch:function(t,e,i){var n=document.createEvent("CustomEvent");return n&&n.initCustomEvent?n.initCustomEvent("slip:"+e,!0,!0,i):(n=document.createEvent("Event"),n.initEvent("slip:"+e,!0,!0),n.detail=i),t.dispatchEvent(n)},getSiblings:function(t){for(var i=[],n=t.node.nextSibling;n;)1==n.nodeType&&i.push({node:n,baseTransform:e(n)}),n=n.nextSibling;return i},animateToZero:function(t,e){e=e||this.target,e.node.style[r]=l+" 0.1s ease-out",e.node.style[h]="translate(0,0) "+u+e.baseTransform.value,setTimeout(function(){e.node.style[r]="",e.node.style[h]=e.baseTransform.original,t&&t.call(this,e)}.bind(this),101)},animateSwipe:function(t){var e=this.target,i=this.getSiblings(e),n="translate(0,"+this.target.height+"px) "+u+" ";e.node.style[r]="all 0.1s linear",e.node.style[h]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+u+e.baseTransform.value,setTimeout(function(){t.call(this,e)&&(i.forEach(function(t){t.node.style[r]="",t.node.style[h]=n+t.baseTransform.value}),setTimeout(function(){i.forEach(function(t){t.node.style[r]=l+" 0.1s ease-in-out",t.node.style[h]="translate(0,0) "+u+t.baseTransform.value}),setTimeout(function(){i.forEach(function(t){t.node.style[r]="",t.node.style[h]=t.baseTransform.original})},101)},1))}.bind(this),101)}},"function"==typeof define&&define.amd&&define(function(){return t}),t}();