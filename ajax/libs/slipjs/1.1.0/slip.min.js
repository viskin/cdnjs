/*!
    Slip.js 1.1

    © 2014 Kornel Lesiński <kornel@geekhood.net>. All rights reserved.

    Redistribution and use in source and binary forms, with or without modification,
    are permitted provided that the following conditions are met:

    1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

    2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
    DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
    SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
    USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
;window.Slip=(function(){var m=/Chrome\/[34]/.test(navigator.userAgent);var a=m;var k=m;var f=document.createElement("div");var p="webkitTransition" in f.style?"webkitTransition":"transition";var d="webkitTransform" in f.style?"webkitTransform":"transform";var i=d==="webkitTransform"?"-webkit-transform":"transform";var c="webkitUserSelect" in f.style?"webkitUserSelect":"userSelect";f.style[d]="translateZ(0)";var r=f.style[d]?"translateZ(0) ":"";var s=f.style[d]?"translateZ(1px) ":"";f=null;var j=0;var e=false;var h=function(){};function g(t,u){if("string"===typeof t){t=document.querySelector(t)}if(!t||!t.addEventListener){throw new Error("Please specify DOM node to attach to")}if(!this||this===window){return new g(t,u)}this.options=u;this.cancel=this.setState.bind(this,this.states.idle);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onMouseLeave=this.onMouseLeave.bind(this);this.onSelection=this.onSelection.bind(this);this.setState(this.states.idle);this.attach(t)}function o(v){var t=v.style[d];if(t){return{value:t,original:t}}if(window.getComputedStyle){var u=window.getComputedStyle(v).getPropertyValue(i);if(u&&u!=="none"){return{value:u,original:""}}}return{value:"",original:""}}g.prototype={container:null,options:{},state:null,target:null,usingTouch:false,mouseHandlersAttached:false,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:false,states:{idle:function l(){this.target=null;this.usingTouch=false;this.removeMouseHandlers();return{allowTextSelection:true}},undecided:function b(){this.target.height=this.target.node.offsetHeight;this.target.node.style[p]="";if(!this.dispatch(this.target.originalTarget,"beforewait")){this.setState(this.states.reorder)}else{var t=setTimeout(function(){var u=this.getAbsoluteMovement();if(this.canPreventScrolling&&u.x<15&&u.y<25){if(this.dispatch(this.target.originalTarget,"beforereorder")){this.setState(this.states.reorder)}}}.bind(this),300)}return{leaveState:function(){clearTimeout(t)},onMove:function(){var u=this.getAbsoluteMovement();if(u.x>20&&u.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe")){this.setState(this.states.swipe);return false}else{this.setState(this.states.idle)}}if(u.y>20){this.setState(this.states.idle)}if(u.x>u.y*1.2){return false}},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var u=this.dispatch(this.target.originalTarget,"tap");this.setState(this.states.idle);return u}}},swipe:function q(){var t=false;var u=this.container;u.className+=" slip-swiping-container";function v(){u.className=u.className.replace(/(?:^| )slip-swiping-container/,"")}this.target.height=this.target.node.offsetHeight;return{leaveState:function(){if(t){this.animateSwipe(function(w){w.node.style[d]=w.baseTransform.original;w.node.style[p]="";if(this.dispatch(w.node,"afterswipe")){v();return true}else{this.animateToZero(undefined,w)}}.bind(this))}else{this.animateToZero(v)}},onMove:function(){var w=this.getTotalMovement();if(Math.abs(w.y)<this.target.height+20){this.target.node.style[d]="translate("+w.x+"px,0) "+r+this.target.baseTransform.value;return false}else{this.setState(this.states.idle)}},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var y=this.latestPosition.x-this.previousPosition.x;var x=this.latestPosition.y-this.previousPosition.y;var A=Math.sqrt(y*y+x*x)/(this.latestPosition.time-this.previousPosition.time+1);var w=this.getAbsoluteMovement();var z=A>0.6&&w.time>110;var B;if(y>0){B="right"}else{B="left"}if(z){if(this.dispatch(this.target.node,"swipe",{direction:B})){t=true}}this.setState(this.states.idle);return !z}}},reorder:function n(){this.target.height=this.target.node.offsetHeight;var y=0;var w=0;var u;var A=this.target.node.offsetTop+this.target.height/2;var z=[];var v=this.container.childNodes;for(var x=0;x<v.length;x++){if(v[x].nodeType===1){w++;if(v[x]===this.target.node){y=w-1}}if(v[x].nodeType!=1||v[x]===this.target.node){continue}var C=v[x].offsetTop;v[x].style[p]=i+" 0.2s ease-in-out";z.push({node:v[x],baseTransform:o(v[x]),pos:C+(C<A?v[x].offsetHeight:0)-A})}this.target.node.className+=" slip-reordering";this.target.node.style.zIndex="99999";this.target.node.style[c]="none";if(k){this.container.style.webkitTransformStyle="preserve-3d"}function B(){if(u){clearTimeout(u);u=null}var D=this.getTotalMovement();this.target.node.style[d]="translate(0,"+D.y+"px) "+s+this.target.baseTransform.value;var t=this.target.height;z.forEach(function(F){var E=0;if(F.pos<0&&D.y<0&&F.pos>D.y){E=t}else{if(F.pos>0&&D.y>0&&F.pos<D.y){E=-t}}F.node.style[d]=E?"translate(0,"+E+"px) "+r+F.baseTransform.value:F.baseTransform.original});return false}B.call(this);return{leaveState:function(){if(u){clearTimeout(u)}if(k){this.container.style.webkitTransformStyle=""}this.target.node.className=this.target.node.className.replace(/(?:^| )slip-reordering/,"");this.target.node.style[c]="";this.animateToZero(function(t){t.node.style.zIndex=""});z.forEach(function(t){t.node.style[d]=t.baseTransform.original;t.node.style[p]=""})},onMove:B,onLeave:function(){if(u){clearTimeout(u)}u=setTimeout(function(){u=null;this.cancel()}.bind(this),700)},onEnd:function(){var t=this.getTotalMovement();if(t.y<0){for(var D=0;D<z.length;D++){if(z[D].pos>t.y){this.dispatch(this.target.node,"reorder",{spliceIndex:D,insertBefore:z[D].node,originalIndex:y});break}}}else{for(var D=z.length-1;D>=0;D--){if(z[D].pos<t.y){this.dispatch(this.target.node,"reorder",{spliceIndex:D+1,insertBefore:z[D+1]?z[D+1].node:null,originalIndex:y});break}}}this.setState(this.states.idle);return false}}}},attach:function(t){j++;if(this.container){this.detach()}if(!e&&a){e=true;document.body.addEventListener("touchstart",h,false)}this.container=t;this.otherNodes=[];document.addEventListener("selectionchange",this.onSelection,false);this.container.addEventListener("touchcancel",this.cancel,false);this.container.addEventListener("touchstart",this.onTouchStart,false);this.container.addEventListener("touchmove",this.onTouchMove,false);this.container.addEventListener("touchend",this.onTouchEnd,false);this.container.addEventListener("mousedown",this.onMouseDown,false)},detach:function(){this.cancel();this.container.removeEventListener("mousedown",this.onMouseDown,false);this.container.removeEventListener("touchend",this.onTouchEnd,false);this.container.removeEventListener("touchmove",this.onTouchMove,false);this.container.removeEventListener("touchstart",this.onTouchStart,false);this.container.removeEventListener("touchcancel",this.cancel,false);document.removeEventListener("selectionchange",this.onSelection,false);j--;if(!j&&e){e=false;document.body.removeEventListener("touchstart",h,false)}},setState:function(u){if(this.state){if(this.state.ctor===u){return}if(this.state.leaveState){this.state.leaveState.call(this)}}var v=this.state;var t=u.call(this);if(this.state===v){t.ctor=u;this.state=t}},findTargetNode:function(t){while(t&&t.parentNode!==this.container){t=t.parentNode}return t},onSelection:function(u){var t=u.target===document||this.findTargetNode(u);if(!t){return}if(u.cancelable||u.defaultPrevented){if(!this.state.allowTextSelection){u.preventDefault()}}else{this.setState(this.states.idle)}},addMouseHandlers:function(){if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;document.documentElement.addEventListener("mouseleave",this.onMouseLeave,false);window.addEventListener("mousemove",this.onMouseMove,true);window.addEventListener("mouseup",this.onMouseUp,true);window.addEventListener("blur",this.cancel,false)}},removeMouseHandlers:function(){if(this.mouseHandlersAttached){this.mouseHandlersAttached=false;document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,false);window.removeEventListener("mousemove",this.onMouseMove,true);window.removeEventListener("mouseup",this.onMouseUp,true);window.removeEventListener("blur",this.cancel,false)}},onMouseLeave:function(t){if(this.usingTouch){return}if(t.target===document.documentElement||t.relatedTarget===document.documentElement){if(this.state.onLeave){this.state.onLeave.call(this)}}},onMouseDown:function(t){if(this.usingTouch||t.button!=0||!this.setTarget(t)){return}this.addMouseHandlers();this.canPreventScrolling=true;this.startAtPosition({x:t.clientX,y:t.clientY,time:t.timeStamp})},onTouchStart:function(t){this.usingTouch=true;this.canPreventScrolling=true;if(t.touches.length>1){this.setState(this.states.idle);return}if(!this.setTarget(t)){return}this.startAtPosition({x:t.touches[0].clientX,y:t.touches[0].clientY-window.scrollY,time:t.timeStamp})},setTarget:function(v){var u=this.findTargetNode(v.target);if(!u){this.setState(this.states.idle);return false}var t=u.parentNode;while(t){if(t.scrollHeight>t.clientHeight&&window.getComputedStyle(t)["overflow-y"]!="visible"){break}else{t=t.parentNode}}this.target={originalTarget:v.target,node:u,scrollContainer:t,baseTransform:o(u)};return true},startAtPosition:function(t){this.startPosition=this.previousPosition=this.latestPosition=t;this.setState(this.states.undecided)},updatePosition:function(x,y){this.latestPosition=y;var C=40,v=0;var z=this.target.scrollContainer||document.body,A=z.getBoundingClientRect(),t=this.target.node.getBoundingClientRect(),u=Math.min(A.bottom,window.innerHeight)-t.bottom,w=t.top-Math.max(A.top,0);if(u<C){v=C-u}else{if(w<C){v=w-C}}var B=z.scrollTop;z.scrollTop+=v;if(B!=z.scrollTop){this.startPosition.y+=B-z.scrollTop}if(this.state.onMove){if(this.state.onMove.call(this)===false){x.preventDefault()}}if(this.latestPosition.time-this.previousPosition.time>100){this.previousPosition=this.latestPosition}},onMouseMove:function(t){this.updatePosition(t,{x:t.clientX,y:t.clientY,time:t.timeStamp})},onTouchMove:function(t){this.updatePosition(t,{x:t.touches[0].clientX,y:t.touches[0].clientY-window.scrollY,time:t.timeStamp});this.canPreventScrolling=false},onMouseUp:function(t){if(this.usingTouch||t.button!==0){return}if(this.state.onEnd&&false===this.state.onEnd.call(this)){t.preventDefault()}},onTouchEnd:function(t){if(t.touches.length>1){this.cancel()}else{if(this.state.onEnd&&false===this.state.onEnd.call(this)){t.preventDefault()}}},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}},getAbsoluteMovement:function(){return{x:Math.abs(this.latestPosition.x-this.startPosition.x),y:Math.abs(this.latestPosition.y-this.startPosition.y),time:this.latestPosition.time-this.startPosition.time}},dispatch:function(w,t,u){var v=document.createEvent("CustomEvent");if(v&&v.initCustomEvent){v.initCustomEvent("slip:"+t,true,true,u)}else{v=document.createEvent("Event");v.initEvent("slip:"+t,true,true);v.detail=u}return w.dispatchEvent(v)},getSiblings:function(u){var v=[];var t=u.node.nextSibling;while(t){if(t.nodeType==1){v.push({node:t,baseTransform:o(t)})}t=t.nextSibling}return v},animateToZero:function(u,t){t=t||this.target;t.node.style[p]=i+" 0.1s ease-out";t.node.style[d]="translate(0,0) "+r+t.baseTransform.value;setTimeout(function(){t.node.style[p]="";t.node.style[d]=t.baseTransform.original;if(u){u.call(this,t)}}.bind(this),101)},animateSwipe:function(w){var u=this.target;var v=this.getSiblings(u);var t="translate(0,"+this.target.height+"px) "+r+" ";u.node.style[p]="all 0.1s linear";u.node.style[d]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+r+u.baseTransform.value;setTimeout(function(){if(w.call(this,u)){v.forEach(function(x){x.node.style[p]="";x.node.style[d]=t+x.baseTransform.value});setTimeout(function(){v.forEach(function(x){x.node.style[p]=i+" 0.1s ease-in-out";x.node.style[d]="translate(0,0) "+r+x.baseTransform.value});setTimeout(function(){v.forEach(function(x){x.node.style[p]="";x.node.style[d]=x.baseTransform.original})},101)},1)}}.bind(this),101)}};if("function"===typeof define&&define.amd){define(function(){return g})}return g})();