/*!
 * skrollr v0.3.0
 * Parallax scrolling for the masses.
 *
 * Copyright 2012, Alexander Prinzhorn (@Prinzhorn) and contributors.
 *
 * skrollr can be used by everyone under the terms of the MIT license.
 *
 * Demo: http://prinzhorn.github.com/skrollr/
 * Source: https://github.com/Prinzhorn/skrollr
*/
(function(l,o,g){var e=function(){};var t=Object.prototype.hasOwnProperty;var f=l.requestAnimationFrame||l.webkitRequestAnimationFrame||l.mozRequestAnimationFrame||l.oRequestAnimationFrame||l.msRequestAnimationFrame||function(u){setTimeout(u,1000/30)};var b=/^\s*(.*)\s$/;var c=/^data(-end)?-?(\d+)?$/;var i=/:|;/g;var j=/^([a-z-]+)\[(\w+)\]$/;var q=/-([a-z])/g;var h=/(:?\+|-)?[\d.]+/g;var d=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g;var s=["O","Moz","webkit","ms"];var k={begin:function(){return 0},end:function(){return 1},linear:function(u){return u},quadratic:function(u){return u*u},cubic:function(u){return u*u*u*u},swing:function(u){return(-Math.cos(u*Math.PI)/2)+0.5},bounce:function(v){var u;switch(true){case (v<=0.5083):u=3;break;case (v<=0.8489):u=9;break;case (v<=0.96208):u=27;break;case (v<=0.99981):u=91;break;default:return 1}return 1-Math.abs(3*Math.cos(v*u*1.028)/u)}};var p={};function r(J){var I=this;J=J||{};if(J.easing){for(var G in J.easing){k[G]=J.easing[G]}}I.scale=J.scale||1;I.listeners={beforerender:J.beforerender||e,render:J.render||e};I.skrollables=[];I.maxKeyFrame=J.maxKeyFrame||0;I.dir="down";I.lastTop=-1;I.curTop=0;var H=o.getElementsByTagName("*");var E=[];for(var B=0;B<H.length;B++){var v=H[B];var D=[];if(!v.attributes){continue}for(var A=0;A<v.attributes.length;A++){var F=v.attributes[A];var C=F.name.match(c);if(C!==null){var u;var z;u=(C[2]|0)*I.scale;z={frame:u,props:F.value};D.push(z);if(C[1]==="-end"){E.push(z)}if(u>this.maxKeyFrame){I.maxKeyFrame=u}}}if(D.length){I.skrollables.push({element:v,keyFrames:D});m(v,"skrollable")}}for(var B=0;B<E.length;B++){var z=E[B];z.frame=I.maxKeyFrame-z.frame}for(var B=0;B<I.skrollables.length;B++){var y=I.skrollables[B];y.keyFrames.sort(function(L,K){return L.frame-K.frame});I._parseProps(y);I._fillProps(y)}var x=o.createElement("div");var w=x.style;w.width="1px";w.height=(I.maxKeyFrame+o.documentElement.clientHeight)+"px";w.position="absolute";w.right=w.top=w.zIndex="0";o.getElementsByTagName("body")[0].appendChild(x);I._render();x=w=E=J=g;return I}r.prototype.setScrollTop=function(u){pageYOffset=o.body.scrollTop=o.documentElement.scrollTop=u};r.prototype.on=function(u,v){this.listeners[u]=v||e};r.prototype.off=function(u){this.listeners[u]=e};r.prototype._calcSteps=function(v,w){var E=this;var z=v.keyFrames;if(w<z[0].frame){m(v.element,"hidden")}else{if(w>z[z.length-1].frame){n(v.element,"hidden");var C=z[z.length-1];var A;for(var D in C.props){if(t.call(C.props,D)){A=E._interpolateString(C.props[D].value);E._setStyle(v.element,D,A)}}}else{n(v.element,"hidden");for(var y=0;y<z.length-1;y++){if(w>=z[y].frame&&w<=z[y+1].frame){var x=z[y];var B=z[y+1];for(var D in x.props){if(t.call(x.props,D)){var u=(w-x.frame)/(B.frame-x.frame);u=x.props[D].easing(u);var A=E._calcInterpolation(x.props[D].value,B.props[D].value,u);A=E._interpolateString(A);E._setStyle(v.element,D,A)}}break}}}}};r.prototype._render=function(){var u=this;u.curTop=l.pageYOffset||o.documentElement.scrollTop||o.body.scrollTop||0;if(u.lastTop!==u.curTop){u.dir=(u.curTop>=u.lastTop)?"down":"up";var x={curTop:u.curTop,lastTop:u.lastTop,maxTop:u.maxKeyFrame,direction:u.dir};var w=u.listeners.beforerender.call(u,x);if(w!==false){for(var v=0;v<u.skrollables.length;v++){u._calcSteps(u.skrollables[v],u.curTop)}u.lastTop=u.curTop;u.listeners.render.call(u,x)}}f(function(){u._render()})};r.prototype._parseProps=function(v){var C=this;for(var y=0;y<v.keyFrames.length;y++){var w=v.keyFrames[y];var A=w.props.split(i);var u;var B;var z;w.props={};for(var x=0;x<A.length-1;x+=2){u=A[x];B=A[x+1];z=u.match(j);if(z!==null){u=z[1];z=z[2]}else{z="linear"}B=C._parseProp(B);w.props[u]={value:B,easing:k[z]}}}};r.prototype._parseProp=function(v){var u=[];v=v.replace(d,function(w){return w.replace(h,function(x){return(parseInt(x,10)/255)*100+"%"})});v=v.replace(h,function(w){u.push(parseFloat(w,10));return"?"});u.unshift(v);return u};r.prototype._fillProps=function(v){var u={};for(var w=0;w<v.keyFrames.length;w++){this._fillPropForFrame(v.keyFrames[w],u)}u={};for(var w=v.keyFrames.length-1;w>=0;w--){this._fillPropForFrame(v.keyFrames[w],u)}};r.prototype._fillPropForFrame=function(w,u){for(var v in u){if(!t.call(w.props,v)){w.props[v]=u[v]}}for(var v in w.props){u[v]=w.props[v]}};r.prototype._calcInterpolation=function(y,x,v){if(y.length!==x.length){throw"Can't interpolate between \""+y[0]+'" and "'+x[0]+'"'}var u=[y[0]];for(var w=1;w<y.length;w++){u[w]=y[w]+((x[w]-y[w])*v)}return u};r.prototype._interpolateString=function(v){var u=1;return v[0].replace(/\?/g,function(){return v[u++]})};r.prototype._setStyle=function(w,A,y){var v=w.style;A=A.replace(q,function(C,B){return B.toUpperCase()}).replace("-","");if(A==="zIndex"){v[A]=""+(y|0);return}try{v[A]=y}catch(z){}var x=A.slice(0,1).toUpperCase()+A.slice(1);try{for(var u=0;u<s.length;u++){v[s[u]+x]=y}}catch(z){}if(p.setStyle){for(var u=0;u<p.setStyle.length;u++){p.setStyle[0].call(this,w,A,y)}}};var m=function(v,u){if(a(v.className).indexOf(a(u))===-1){v.className=(v.className+" "+u).replace(b,"$1")}};var n=function(v,u){v.className=(a(v.className)).replace(a(u),"").replace(b,"$1")};var a=function(u){return" "+u+" "};l.skrollr={init:function(u){return new r(u)},plugin:function(v,u){if(p[v]){p[v].push(u)}else{p[v]=[u]}},VERSION:"0.3.0"}}(window,document));