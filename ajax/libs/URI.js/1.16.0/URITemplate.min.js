/*!
 * URI.js - Mutating URLs
 * URI Template Support - http://tools.ietf.org/html/rfc6570
 *
 * Version: 1.16.0
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(a,b){if(typeof exports==="object"){module.exports=b(require("./URI"))}else{if(typeof define==="function"&&define.amd){define(["./URI"],b)}else{a.URITemplate=b(a.URI,a)}}}(this,function(d,c){var f=c&&c.URITemplate;var b=Object.prototype.hasOwnProperty;function h(i){if(h._cache[i]){return h._cache[i]}if(!(this instanceof h)){return new h(i)}this.expression=i;h._cache[i]=this;return this}function e(i){this.data=i;this.cache={}}var g=h.prototype;var a={"":{prefix:"",separator:",",named:false,empty_name_separator:false,encode:"encode"},"+":{prefix:"",separator:",",named:false,empty_name_separator:false,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:false,empty_name_separator:false,encode:"encodeReserved"},".":{prefix:".",separator:".",named:false,empty_name_separator:false,encode:"encode"},"/":{prefix:"/",separator:"/",named:false,empty_name_separator:false,encode:"encode"},";":{prefix:";",separator:";",named:true,empty_name_separator:false,encode:"encode"},"?":{prefix:"?",separator:"&",named:true,empty_name_separator:true,encode:"encode"},"&":{prefix:"&",separator:"&",named:true,empty_name_separator:true,encode:"encode"}};h._cache={};h.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g;h.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/;h.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/;h.expand=function(n,m){var r=a[n.operator];var p=r.named?"Named":"Unnamed";var q=n.variables;var k=[];var o,j,l;for(l=0;(j=q[l]);l++){o=m.get(j.name);if(!o.val.length){if(o.type){k.push("")}continue}k.push(h["expand"+p](o,r,j.explode,j.explode&&r.separator||",",j.maxlength,j.name))}if(k.length){return r.prefix+k.join(r.separator)}else{return""}};h.expandNamed=function(s,w,t,p,m,k){var x="";var r=w.encode;var q=w.empty_name_separator;var j=!s[r].length;var u=s.type===2?"":d[r](k);var v,o,n;for(o=0,n=s.val.length;o<n;o++){if(m){v=d[r](s.val[o][1].substring(0,m));if(s.type===2){u=d[r](s.val[o][0].substring(0,m))}}else{if(j){v=d[r](s.val[o][1]);if(s.type===2){u=d[r](s.val[o][0]);s[r].push([u,v])}else{s[r].push([undefined,v])}}else{v=s[r][o][1];if(s.type===2){u=s[r][o][0]}}}if(x){x+=p}if(!t){if(!o){x+=d[r](k)+(q||v?"=":"")}if(s.type===2){x+=u+","}x+=v}else{x+=u+(q||v?"=":"")+v}}return x};h.expandUnnamed=function(r,v,s,o,k){var w="";var q=v.encode;var p=v.empty_name_separator;var j=!r[q].length;var t,u,n,m;for(n=0,m=r.val.length;n<m;n++){if(k){u=d[q](r.val[n][1].substring(0,k))}else{if(j){u=d[q](r.val[n][1]);r[q].push([r.type===2?d[q](r.val[n][0]):undefined,u])}else{u=r[q][n][1]}}if(w){w+=o}if(r.type===2){if(k){t=d[q](r.val[n][0].substring(0,k))}else{t=r[q][n][0]}w+=t;if(s){w+=(p||u?"=":"")}else{w+=","}}w+=u}return w};h.noConflict=function(){if(c.URITemplate===h){c.URITemplate=f}return h};g.expand=function(n){var j="";if(!this.parts||!this.parts.length){this.parse()}if(!(n instanceof e)){n=new e(n)}for(var m=0,k=this.parts.length;m<k;m++){j+=typeof this.parts[m]==="string"?this.parts[m]:h.expand(this.parts[m],n)}return j};g.parse=function(){var s=this.expression;var k=h.EXPRESSION_PATTERN;var j=h.VARIABLE_PATTERN;var r=h.VARIABLE_NAME_PATTERN;var o=[];var t=0;var u,m,q;k.lastIndex=0;while(true){m=k.exec(s);if(m===null){o.push(s.substring(t));break}else{o.push(s.substring(t,m.index));t=m.index+m[0].length}if(!a[m[1]]){throw new Error('Unknown Operator "'+m[1]+'" in "'+m[0]+'"')}else{if(!m[3]){throw new Error('Unclosed Expression "'+m[0]+'"')}}u=m[2].split(",");for(var p=0,n=u.length;p<n;p++){q=u[p].match(j);if(q===null){throw new Error('Invalid Variable "'+u[p]+'" in "'+m[0]+'"')}else{if(q[1].match(r)){throw new Error('Invalid Variable Name "'+q[1]+'" in "'+m[0]+'"')}}u[p]={name:q[1],explode:!!q[3],maxlength:q[4]&&parseInt(q[4],10)}}if(!u.length){throw new Error('Expression Missing Variable(s) "'+m[0]+'"')}o.push({expression:m[0],operator:m[1],variables:u})}if(!o.length){o.push(s)}this.parts=o;return this};e.prototype.get=function(m){var o=this.data;var p={type:0,val:[],encode:[],encodeReserved:[]};var k,j,n;if(this.cache[m]!==undefined){return this.cache[m]}this.cache[m]=p;if(String(Object.prototype.toString.call(o))==="[object Function]"){n=o(m)}else{if(String(Object.prototype.toString.call(o[m]))==="[object Function]"){n=o[m](m)}else{n=o[m]}}if(n===undefined||n===null){return p}else{if(String(Object.prototype.toString.call(n))==="[object Array]"){for(k=0,j=n.length;k<j;k++){if(n[k]!==undefined&&n[k]!==null){p.val.push([undefined,String(n[k])])}}if(p.val.length){p.type=3}}else{if(String(Object.prototype.toString.call(n))==="[object Object]"){for(k in n){if(b.call(n,k)&&n[k]!==undefined&&n[k]!==null){p.val.push([k,String(n[k])])}}if(p.val.length){p.type=2}}else{p.type=1;p.val.push([undefined,String(n)])}}}return p};d.expand=function(l,k){var j=new h(l);var i=j.expand(k);return new d(i)};return h}));