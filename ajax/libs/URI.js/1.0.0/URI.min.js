!function(r){function e(t){return"[object Array]"===String(Object.prototype.toString.call(t))}function s(t,s){var n,a,i={};if(e(s))for(n=0,a=s.length;a>n;n++)i[s[n]]=!0;else i[s]=!0;for(n=0,a=t.length;a>n;n++)i[t[n]]!==r&&(t.splice(n,1),a--,n--);return t}RegExp.escape||(RegExp.escape=function(t){return t.replace(/(\^|\$|\\|\||\/|\*|\+|\?|\{|\}|\(|\)|\[|\]|\.)/g,"\\$1")});var n=function(t){return this instanceof n?(t===r&&(t=location.href+""),this.href(t),this):new n(t)},a=n.prototype;n.encode=encodeURIComponent,n.decode=decodeURIComponent,a.encode=n.encode,a.decode=n.decode,n.idn_expression=/[^a-z0-9\.-]/i,n.punycode_expression=/(^xn--)/i,n.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,n.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,n.defaultPorts={http:"80",https:"443",ftp:"21"},n.parse=function(t){var r,e={};return r=t.indexOf("#"),r>-1&&(e.fragment=t.substr(r+1)||null,t=t.substr(0,r)),r=t.indexOf("?"),r>-1&&(e.query=t.substr(r+1)||null,t=t.substr(0,r)),r=t.indexOf("://"),r>-1&&(e.protocol=t.substr(0,r),t=t.substr(r+3),t=n.parseAuthority(t,e)),e.path=t,e},n.parseHost=function(r,e){var s=r.indexOf("/");if(-1===s&&(s=r.length),"["===r[0]){var n=r.indexOf("]");e.hostname=r.substring(1,n)||null,e.port=r.substring(n+2,s)||null}else r.indexOf(":")!==r.lastIndexOf(":")?(e.hostname=r.substr(0,s)||null,e.port=null):(t=r.substr(0,s).split(":"),e.hostname=t[0]||null,e.port=t[1]||null);return r.substr(s)||"/"},n.parseAuthority=function(r,e){var s=r.indexOf("@");return s>-1?(t=r.substr(0,s).split(":"),e.username=t[0]?n.decode(t[0]):null,e.password=t[1]?n.decode(t[1]):null,r=r.substr(s+1)):(e.username=null,e.password=null),n.parseHost(r,e)},n.parseQuery=function(t){t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");for(var r={},e=t.split("&"),s=e.length,a=0;s>a;a++){var i=e[a].split("="),o=n.decode(i.shift()),h=n.decode(i.join("="));r[o]?("string"==typeof r[o]&&(r[o]=[r[o]]),r[o].push(h)):r[o]=h}return r},n.build=function(t){var r="";return"string"==typeof t.protocol&&t.protocol.length&&(r+=t.protocol+"://"),r+=n.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path[0]&&"string"==typeof t.hostname&&(r+="/"),r+=t.path),"string"==typeof t.query&&(r+="?"+t.query),"string"==typeof t.fragment&&(r+="#"+t.fragment),r},n.buildHost=function(t){var r="";return t.hostname?(n.ip6_expression.test(t.hostname)?r+=t.port?"["+t.hostname+"]:"+t.port:t.hostname:(r+=t.hostname,t.port&&(r+=":"+t.port)),r):""},n.buildAuthority=function(t){var r="";return t.username&&(r+=n.encode(t.username),t.password&&(r+=":"+n.encode(t.password)),r+="@"),r+=n.buildHost(t)},n.buildQuery=function(t){var s="";for(var a in t)if(Object.hasOwnProperty.call(t,a)){var i=n.encode(a+"");if(e(t[a]))for(var o={},h=0,p=t[a].length;p>h;h++)t[a][h]!==r&&o[t[a][h]+""]===r&&(s+="&"+i+"="+n.encode(t[a][h]+""),o[t[a][h]+""]=!0);else t[a]!==r&&(s+="&"+i+"="+n.encode(t[a]+""))}return s.substr(1)},n.addQuery=function(t,s,a){if("object"==typeof s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.addQuery(t,i,s[i]);else{if("string"!=typeof s)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(t[s]===r)return void(t[s]=a);"string"==typeof t[s]&&(t[s]=[t[s]]),e(a)||(a=[a]),t[s]=t[s].concat(a)}},n.removeQuery=function(t,a,i){if(e(a))for(var o=0,h=a.length;h>o;o++)t[a[o]]=r;else if("object"==typeof a)for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&n.removeQuery(t,p,a[p]);else{if("string"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");i!==r?t[a]===i?t[a]=r:e(t[a])&&(t[a]=s(t[a],i)):t[a]=r}},n.commonPath=function(t,r){var e,s=Math.min(t.length,r.length);for(e=0;s>e;e++)if(t[e]!==r[e]){e--;break}return 1>e?t[0]===r[0]&&"/"===t[0]?"/":"":("/"!==t[e]&&(e=t.substr(0,e).lastIndexOf("/")),t.substr(0,e+1))},a.build=function(){return this._string=n.build(this._parts),this},a.toString=function(){return this._string},a.valueOf=function(){return this.toString()};var i,o={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};for(i in o)a[i]=function(t){return function(e,s){return e===r?this._parts[t]||"":(this._parts[t]=e,s!==!1&&this.build(),this)}}(o[i]);o={query:"?",fragment:"#"};for(i in o)a[i]=function(t,e){return function(s,n){return s===r?this._parts[t]||"":(null!==s&&(s+="",s[0]===e&&(s=s.substr(1))),this._parts[t]=s,n!==!1&&this.build(),this)}}(i,o[i]);o={search:["?","query"],hash:["#","fragment"]};for(i in o)a[i]=function(t,r){return function(e,s){var n=this[t](e,s);return"string"==typeof n&&n.length?r+n:n}}(o[i][1],o[i][0]);a.pathname=function(t,e){return t===r?this._parts.path||"/":(this._parts.path=t||"/",e!==!1&&this.build(),this)},a.path=a.pathname,a.href=function(t,e){if(t===r)return this.toString();this._string="",this._parts={protocol:null,username:null,password:null,hostname:null,port:null,path:null,query:null,fragment:null};var s,a=t instanceof n,i="object"==typeof t&&(t.hostname||t.path);if("string"==typeof t)this._parts=n.parse(t);else{if(!a&&!i)throw new TypeError("invalid input");var o=a?t._parts:t;for(s in o)Object.hasOwnProperty.call(this._parts,s)&&(this._parts[s]=o[s])}return e!==!1&&this.build(),this},a.is=function(t){var r=!1,e=!1,s=!1,a=!1,i=!1,o=!1,h=!0;switch(this._parts.hostname&&(h=!1,e=n.ip4_expression.test(this._parts.hostname),s=n.ip6_expression.test(this._parts.hostname),r=e||s,a=!r,i=a&&n.idn_expression.test(this._parts.hostname),o=a&&n.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return h;case"domain":case"name":return a;case"ip":return r;case"ip4":case"ipv4":case"inet4":return e;case"ip6":case"ipv6":case"inet6":return s;case"idn":return i;case"punycode":return o}return null},a.host=function(t,e){return t===r?this._parts.hostname?n.buildHost(this._parts):"":(n.parseHost(t,this._parts),e!==!1&&this.build(),this)},a.authority=function(t,e){return t===r?this._parts.hostname?n.buildAuthority(this._parts):"":(n.parseAuthority(t,this._parts),e!==!1&&this.build(),this)},a.domain=function(t,e){if(t===r)return!this._parts.hostname||this.is("IP")?"":this._parts.hostname.match(/\.?([^\.]+.[^\.]+)$/)[1]||this._parts.hostname;if(!t)throw new TypeError("cannot set domain empty");if(!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var s=new RegExp(RegExp.escape(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(s,t)}return e!==!1&&this.build(),this},a.tld=function(t,e){if(t===r){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.lastIndexOf(".");return this._parts.hostname.substr(s+1)}if(!t)throw new TypeError("cannot set TLD empty");if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");var n=new RegExp(RegExp.escape(this.tld())+"$");return this._parts.hostname=this._parts.hostname.replace(n,t),e!==!1&&this.build(),this},a.directory=function(t,e){if(t===r){if(!this._parts.path||"/"===this._parts.path)return"/";var s=this._parts.path.length-this.filename().length-1;return this._parts.path.substring(0,s)}var n=this._parts.path.length-this.filename().length,a=this._parts.path.substring(0,n),i=new RegExp("^"+RegExp.escape(a));return this.is("relative")||(t||(t="/"),"/"!==t[0]&&(t="/"+t)),t&&"/"!==t[t.length-1]&&(t+="/"),this._parts.path=this._parts.path.replace(i,t),e!==!1&&this.build(),this},a.filename=function(t,e){if(t===r){if(!this._parts.path||"/"===this._parts.path)return"";var s=this._parts.path.lastIndexOf("/");return this._parts.path.substr(s+1)}"/"===t[0]&&(t=t.substr(1));var n=new RegExp(RegExp.escape(this.filename())+"$");return this._parts.path=this._parts.path.replace(n,t),e!==!1&&this.build(),this},a.suffix=function(t,e){if(t===r){if(!this._parts.path||"/"===this._parts.path)return"";var s,n=this.filename(),a=n.lastIndexOf(".");return-1===a?"":(s=n.substr(a+1),/^[a-z0-9]+$/i.test(s)?s:"")}"."===t[0]&&(t=t.substr(1));var i,o=this.suffix();if(o)i=new RegExp(t?RegExp.escape(o)+"$":RegExp.escape("."+o)+"$");else{if(!t)return this;this._parts.path+="."+t}return i&&(this._parts.path=this._parts.path.replace(i,t)),e!==!1&&this.build(),this};var h=a.query;a.query=function(t,e){return t===!0?n.parseQuery(this._parts.query):t!==r&&"string"!=typeof t?(this._parts.query=n.buildQuery(t),e!==!1&&this.build(),this):h.call(this,t,e)},a.addQuery=function(t,r,e){var s=n.parseQuery(this._parts.query);return n.addQuery(s,t,r),this._parts.query=n.buildQuery(s),"string"!=typeof t&&(e=r),e!==!1&&this.build(),this},a.removeQuery=function(t,r,e){var s=n.parseQuery(this._parts.query);return n.removeQuery(s,t,r),this._parts.query=n.buildQuery(s),"string"!=typeof t&&(e=r),e!==!1&&this.build(),this},a.addSearch=a.addQuery,a.removeSearch=a.removeQuery,a.normalize=function(){return this.normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},a.normalizeHostname=function(t){return this.is("IDN")&&window.punycode?this._parts.hostname=punycode.toASCII(this._parts.hostname):this.is("IPv6")&&window.IPv6&&(this._parts.hostname=IPv6.best(this._parts.hostname)),t!==!1&&this.build(),this},a.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===n.defaultPorts[this._parts.protocol]&&(this._parts.port=null),t!==!1&&this.build(),this},a.normalizePath=function(t){if(!this._parts.path||"/"===this._parts.path)return this;var r,e,s,n,a=this._parts.path;for("/"!==a[0]&&("."===a[0]&&(e=a.substr(0,a.indexOf("/"))),r=!0,a="/"+a),a=a.replace(/(\/(\.\/)+)|\/{2,}/g,"/");;){if(s=a.indexOf("/../"),-1===s)break;if(0===s){a=a.substr(3);break}n=a.substr(0,s).lastIndexOf("/"),-1===n&&(n=s),a=a.substr(0,n)+a.substr(s+3)}return r&&this.is("relative")&&(a=e?e+a:a.substr(1)),this._parts.path=a,t!==!1&&this.build(),this},a.normalizePathname=a.normalizePath,a.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(n.parseQuery(this._parts.query)):this._parts.query=null),t!==!1&&this.build(),this},a.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null),t!==!1&&this.build(),this},a.normalizeSearch=a.normalizeQuery,a.normalizeHash=a.normalizeFragment,a.absoluteTo=function(t){if(!this.is("relative"))throw new Error("Cannot resolve non-relative URL");t instanceof n||(t=new n(t));for(var r,e=new n(this),s=["protocol","username","password","hostname","port"],a=0;r=s[a];a++)e._parts[r]=t._parts[r];return"/"!==e.path()[0]&&(e._parts.path=t.directory()+"/"+e._parts.path,e.normalizePath()),e.build(),e},a.relativeTo=function(t){if(t instanceof n||(t=new n(t)),"/"!==this.path()[0]||"/"!==t.path()[0])throw new Error("Cannot calculate common path from non-relative URLs");for(var r,e=new n(this),s=["protocol","username","password","hostname","port"],a=n.commonPath(e.path(),t.path()),i=t.directory(),o=0;r=s[o];o++)e._parts[r]=null;if(!a||"/"===a)return e;if(i+"/"===a)e._parts.path="./"+e.filename();else{for(var h="../",p=new RegExp("^"+RegExp.escape(a)),u=i.replace(p,"/").match(/\//g).length-1;u--;)h+="../";e._parts.path=e._parts.path.replace(p,h)}return e.build(),e},window.URI=n}();