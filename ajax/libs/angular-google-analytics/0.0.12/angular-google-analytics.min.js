/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.12 - 2015-03-17
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var a,b,c,d,e,f,g=!1,h=!0,i="",j=!1,k="$routeChangeSuccess",l="auto",m=!1,n=!1,o=!1,p=!1,q=!1,r={allowLinker:!0},s=!1,t=!1;this._logs=[],this.setAccount=function(b){return a=b,!0},this.trackPages=function(a){return h=a,!0},this.trackPrefix=function(a){return i=a,!0},this.setDomainName=function(a){return c=a,!0},this.useDisplayFeatures=function(a){return b=!!a,!0},this.useAnalytics=function(a){return j=!!a,!0},this.useEnhancedLinkAttribution=function(a){return o=!!a,!0},this.useCrossDomainLinker=function(a){return q=!!a,!0},this.setCrossLinkDomains=function(a){return f=a,!0},this.setPageEvent=function(a){return k=a,!0},this.setCookieConfig=function(a){return l=a,!0},this.useECommerce=function(a,b){return m=!!a,n=!!b,!0},this.setRemoveRegExp=function(a){return a instanceof RegExp?(d=a,!0):!1},this.setExperimentId=function(a){return e=a,!0},this.ignoreFirstPageLoad=function(a){return p=!!a,!0},this.trackUrlParams=function(a){return s=!!a,!0},this.delayScriptTag=function(a){return t=!!a,!0},this.$get=["$document","$location","$log","$rootScope","$window",function(u,v,w,x,y){function z(a){!j&&y._gaq&&"function"==typeof a&&a()}function A(a){j&&y.ga&&"function"==typeof a&&a()}function B(a,b){return!angular.isUndefined(b)&&"name"in b&&b.name?b.name+"."+a:a}function C(a,b){return a in b&&b[a]}var D=this,E=function(){var a=s?v.url():v.path();return d?a.replace(d,""):a};return this._log=function(){arguments.length>0&&(arguments.length>1&&"warn"===arguments[0]&&w.warn(Array.prototype.slice.call(arguments,1)),this._logs.push(arguments))},this._createScriptTag=function(){if(!a)return D._log("warn","No account id set to create script tag"),void 0;if(g)return D._log("warn","Script tag already created"),void 0;y._gaq=[],y._gaq.push(["_setAccount",a]),c&&y._gaq.push(["_setDomainName",c]),o&&y._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),h&&!p&&(d?y._gaq.push(["_trackPageview",E()]):y._gaq.push(["_trackPageview"]));var e;return e=b?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var a=u[0],b=a.createElement("script");b.type="text/javascript",b.async=!0,b.src=e;var c=a.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}(e),g=!0},this._createAnalyticsScriptTag=function(){if(!a)return D._log("warn","No account id set to create analytics script tag"),void 0;if(g)return D._log("warn","Analytics script tag already created"),void 0;if(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(a)?a.forEach(function(a){var b,c="cookieConfig"in a?a.cookieConfig:l;C("crossDomainLinker",a)&&(a.allowLinker=a.crossDomainLinker),angular.forEach(["name","allowLinker"],function(c){c in a&&(angular.isUndefined(b)&&(b={}),b[c]=a[c])}),angular.isUndefined(b)?y.ga("create",a.tracker,c):y.ga("create",a.tracker,c,b),b&&"allowLinker"in b&&b.allowLinker&&(y.ga(B("require",a),"linker"),C("crossLinkDomains",a)&&y.ga(B("linker:autoLink",a),a.crossLinkDomains))}):q?(y.ga("create",a,l,r),y.ga("require","linker"),f&&y.ga("linker:autoLink",f)):y.ga("create",a,l),b&&y.ga("require","displayfeatures"),h&&!p&&y.ga("send","pageview",E()),y.ga&&(m&&(n?y.ga("require","ec","ec.js"):y.ga("require","ecommerce","ecommerce.js")),o&&y.ga("require","linkid","linkid.js"),e)){var c=document.createElement("script"),d=document.getElementsByTagName("script")[0];c.src="//www.google-analytics.com/cx/api.js?experiment="+e,d.parentNode.insertBefore(c,d)}return g=!0},this._ecommerceEnabled=function(){return m?n?(this._log("warn","Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true, false);"),!1):!0:(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, false);"),!1)},this._enhancedEcommerceEnabled=function(){return m?n?!0:(this._log("warn","Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true, true);"),!1):(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, true);"),!1)},this._trackPage=function(b,c,d){var e=this,f=arguments;b=b?b:E(),c=c?c:u[0].title,z(function(){y._gaq.push(["_set","title",c]),y._gaq.push(["_trackPageview",i+b]),e._log("_trackPageview",b,c,f)}),A(function(){var g={page:i+b,title:c};angular.isObject(d)&&angular.extend(g,d),angular.isArray(a)?a.forEach(function(a){y.ga(B("send",a),"pageview",g)}):y.ga("send","pageview",g),e._log("pageview",b,c,f)})},this._trackEvent=function(b,c,d,e,f,g){var h=this,i=arguments;z(function(){y._gaq.push(["_trackEvent",b,c,d,e,!!f]),h._log("trackEvent",i)}),A(function(){var j={};angular.isDefined(f)&&(j.nonInteraction=!!f),angular.isObject(g)&&angular.extend(j,g),angular.isArray(a)?a.forEach(function(a){C("trackEvent",a)&&y.ga(B("send",a),"event",b,c,d,e,j)}):y.ga("send","event",b,c,d,e,j),h._log("event",i)})},this._addTrans=function(a,b,c,d,e,f,g,h,i){var j=this,k=arguments;z(function(){y._gaq.push(["_addTrans",a,b,c,d,e,f,g,h]),j._log("_addTrans",k)}),A(function(){j._ecommerceEnabled()&&(y.ga("ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:e,currency:i||"USD"}),j._log("ecommerce:addTransaction",k))})},this._addItem=function(a,b,c,d,e,f){var g=this,h=arguments;z(function(){y._gaq.push(["_addItem",a,b,c,d,e,f]),g._log("_addItem",h)}),A(function(){g._ecommerceEnabled()&&(y.ga("ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:e,quantity:f}),g._log("ecommerce:addItem",h))})},this._trackTrans=function(){var a=this,b=arguments;z(function(){y._gaq.push(["_trackTrans"]),a._log("_trackTrans",b)}),A(function(){a._ecommerceEnabled()&&(y.ga("ecommerce:send"),a._log("ecommerce:send",b))})},this._clearTrans=function(){var a=this,b=arguments;A(function(){a._ecommerceEnabled()&&(y.ga("ecommerce:clear"),a._log("ecommerce:clear",b))})},this._addProduct=function(a,b,c,d,e,f,g,h,i){var j=this,k=arguments;z(function(){y._gaq.push(["_addProduct",a,b,c,d,e,f,g,h,i]),j._log("_addProduct",k)}),A(function(){j._enhancedEcommerceEnabled()&&(y.ga("ec:addProduct",{id:a,name:b,category:c,brand:d,variant:e,price:f,quantity:g,coupon:h,position:i}),j._log("ec:addProduct",k))})},this._addImpression=function(a,b,c,d,e,f,g,h){var i=this,j=arguments;z(function(){y._gaq.push(["_addImpression",a,b,c,d,e,f,g,h]),i._log("_addImpression",j)}),A(function(){i._enhancedEcommerceEnabled()&&y.ga("ec:addImpression",{id:a,name:b,category:e,brand:d,variant:f,list:c,position:g,price:h}),i._log("ec:addImpression",j)})},this._addPromo=function(a,b,c,d){var e=this,f=arguments;z(function(){y._gaq.push(["_addPromo",a,b,c,d]),e._log("_addPromo",arguments)}),A(function(){e._enhancedEcommerceEnabled()&&(y.ga("ec:addPromo",{id:a,name:b,creative:c,position:d}),e._log("ec:addPromo",f))})},this._getActionFieldObject=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},this._setAction=function(a,b){var c=this,d=arguments;z(function(){y._gaq.push(["_setAction",a,b]),c._log("__setAction",d)}),A(function(){c._enhancedEcommerceEnabled()&&(y.ga("ec:setAction",a,b),c._log("ec:setAction",d))})},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",this._getActionFieldObject(a,b,c,d,e,f,g,h,i)),this._pageView()},this._trackRefund=function(a){this._setAction("refund",this._getActionFieldObject(a)),this._pageView()},this._trackCheckOut=function(a,b){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,a,b)),this._pageView()},this._trackCart=function(a){-1!==["add","remove"].indexOf(a)&&(this._setAction(a),this._send("event","UX","click",a+" to cart"))},this._promoClick=function(a){this._setAction("promo_click"),this._send("event","Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,a,null,null)),this._send("event","UX","click",a)},this._send=function(){var a=this,b=Array.prototype.slice.call(arguments);b.unshift("send"),A(function(){y.ga.apply(this,b),a._log(b)})},this._pageView=function(){this._send("pageview")},this._set=function(a,b){var c=this;A(function(){y.ga("set",a,b),c._log("set",a,b)})},t||(j?this._createAnalyticsScriptTag():this._createScriptTag()),h&&x.$on(k,function(){D._trackPage()}),{_logs:D._logs,displayFeatures:b,ecommerce:m,enhancedEcommerce:n,enhancedLinkAttribution:o,getUrl:E,experimentId:e,ignoreFirstPageLoad:p,delayScriptTag:t,setCookieConfig:D._setCookieConfig,getCookieConfig:function(){return l},createAnalyticsScriptTag:function(a){return a&&(l=a),D._createAnalyticsScriptTag()},createScriptTag:function(a){return a&&(l=a),D._createScriptTag()},ecommerceEnabled:function(){return D._ecommerceEnabled()},enhancedEcommerceEnabled:function(){return D._enhancedEcommerceEnabled()},trackPage:function(a,b,c){D._trackPage(a,b,c)},trackEvent:function(a,b,c,d,e,f){D._trackEvent(a,b,c,d,e,f)},addTrans:function(a,b,c,d,e,f,g,h,i){D._addTrans(a,b,c,d,e,f,g,h,i)},addItem:function(a,b,c,d,e,f){D._addItem(a,b,c,d,e,f)},trackTrans:function(){D._trackTrans()},clearTrans:function(){D._clearTrans()},addProduct:function(a,b,c,d,e,f,g,h,i){D._addProduct(a,b,c,d,e,f,g,h,i)},addPromo:function(a,b,c,d){D._addPromo(a,b,c,d)},addImpression:function(a,b,c,d,e,f,g,h){D._addImpression(a,b,c,d,e,f,g,h)},productClick:function(a){D._productClick(a)},promoClick:function(a){D._promoClick(a)},trackDetail:function(){D._setAction("detail"),D._pageView()},trackCart:function(a){D._trackCart(a)},trackCheckout:function(a,b){D._trackCheckOut(a,b)},trackTransaction:function(a,b,c,d,e,f,g,h,i){D._trackTransaction(a,b,c,d,e,f,g,h,i)},setAction:function(a,b){D._setAction(a,b)},send:function(a){D._send(a)},pageView:function(){D._pageView()},set:function(a,b){D._set(a,b)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.gaTrackEvent)({});d.bind("click",function(){f.length>1&&a.trackEvent.apply(a,f)})}}}]);