/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.10 - 2015-01-22
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var e,n,t,i,a,c,o=!1,r=!0,s="",u=!1,l="$routeChangeSuccess",d="auto",g=!1,m=!1,_=!1,f=!1,h=!1,p={allowLinker:!0};this._logs=[],this.setAccount=function(n){return e=n,!0},this.trackPages=function(e){return r=e,!0},this.trackPrefix=function(e){return s=e,!0},this.setDomainName=function(e){return t=e,!0},this.useDisplayFeatures=function(e){return n=!!e,!0},this.useAnalytics=function(e){return u=!!e,!0},this.useEnhancedLinkAttribution=function(e){return _=!!e,!0},this.useCrossDomainLinker=function(e){return h=!!e,!0},this.setCrossLinkDomains=function(e){return c=e,!0},this.setPageEvent=function(e){return l=e,!0},this.setCookieConfig=function(e){return d=e,!0},this.useECommerce=function(e,n){return g=!!e,m=!!n,!0},this.setRemoveRegExp=function(e){return e instanceof RegExp?(i=e,!0):!1},this.setExperimentId=function(e){return a=e,!0},this.ignoreFirstPageLoad=function(e){return f=!!e,!0},this.$get=["$document","$location","$log","$rootScope","$window",function(k,v,E,w,y){function A(e){!u&&y._gaq&&"function"==typeof e&&e()}function P(e){u&&y.ga&&"function"==typeof e&&e()}function b(){if(!e)return I._log("warn","No account id set to create script tag"),void 0;y._gaq=[],y._gaq.push(["_setAccount",e]),t&&y._gaq.push(["_setDomainName",t]),_&&y._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),r&&!f&&(i?y._gaq.push(["_trackPageview",L()]):y._gaq.push(["_trackPageview"]));var a;a=n?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var e=k[0],n=e.createElement("script");n.type="text/javascript",n.async=!0,n.src=a;var t=e.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}(a),o=!0}function q(e,n){return!angular.isUndefined(n)&&"name"in n&&n.name?n.name+"."+e:e}function C(e,n){return e in n&&n[e]}function T(){if(!e)return I._log("warn","No account id set to create analytics script tag"),void 0;if(function(e,n,t,i,a,c,o){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,c=n.createElement(t),o=n.getElementsByTagName(t)[0],c.async=1,c.src=i,o.parentNode.insertBefore(c,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(e)?e.forEach(function(e){var n,t="cookieConfig"in e?e.cookieConfig:d;C("crossDomainLinker",e)&&(e.allowLinker=e.crossDomainLinker),angular.forEach(["name","allowLinker"],function(t){t in e&&(angular.isUndefined(n)&&(n={}),n[t]=e[t])}),angular.isUndefined(n)?y.ga("create",e.tracker,t):y.ga("create",e.tracker,t,n),n&&"allowLinker"in n&&n.allowLinker&&(y.ga(q("require",e),"linker"),C("crossLinkDomains",e)&&y.ga(q("linker:autoLink",e),e.crossLinkDomains))}):h?(y.ga("create",e,d,p),y.ga("require","linker"),c&&y.ga("linker:autoLink",c)):y.ga("create",e,d),n&&y.ga("require","displayfeatures"),r&&!f&&y.ga("send","pageview",L()),y.ga&&(g&&(m?y.ga("require","ec","ec.js"):y.ga("require","ecommerce","ecommerce.js")),_&&y.ga("require","linkid","linkid.js"),a)){var t=document.createElement("script"),i=document.getElementsByTagName("script")[0];t.src="//www.google-analytics.com/cx/api.js?experiment="+a,i.parentNode.insertBefore(t,i)}}var I=this,L=function(){var e=v.path();return i?e.replace(i,""):e};return this._log=function(){arguments.length>0&&(arguments.length>1&&"warn"===arguments[0]&&E.warn(Array.prototype.slice.call(arguments,1)),this._logs.push(arguments))},this._ecommerceEnabled=function(){return g?m?(this._log("warn","Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true, false);"),!1):!0:(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, false);"),!1)},this._enhancedEcommerceEnabled=function(){return g?m?!0:(this._log("warn","Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true, true);"),!1):(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, true);"),!1)},this._trackPage=function(n,t){var i=this,a=arguments;n=n?n:L(),t=t?t:k[0].title,A(function(){y._gaq.push(["_set","title",t]),y._gaq.push(["_trackPageview",s+n]),i._log("_trackPageview",n,t,a)}),P(function(){angular.isArray(e)?e.forEach(function(e){y.ga(q("send",e),"pageview",{page:s+n,title:t})}):y.ga("send","pageview",{page:s+n,title:t}),i._log("pageview",n,t,a)})},this._trackEvent=function(n,t,i,a,c){var o=this,r=arguments;A(function(){y._gaq.push(["_trackEvent",n,t,i,a,!!c]),o._log("trackEvent",r)}),P(function(){angular.isArray(e)?e.forEach(function(e){C("trackEvent",e)&&y.ga(q("send",e),"event",n,t,i,a)}):y.ga("send","event",n,t,i,a),o._log("event",r)})},this._addTrans=function(e,n,t,i,a,c,o,r,s){var u=this,l=arguments;A(function(){y._gaq.push(["_addTrans",e,n,t,i,a,c,o,r]),u._log("_addTrans",l)}),P(function(){u._ecommerceEnabled()&&(y.ga("ecommerce:addTransaction",{id:e,affiliation:n,revenue:t,tax:i,shipping:a,currency:s||"USD"}),u._log("ecommerce:addTransaction",l))})},this._addItem=function(e,n,t,i,a,c){var o=this,r=arguments;A(function(){y._gaq.push(["_addItem",e,n,t,i,a,c]),o._log("_addItem",r)}),P(function(){o._ecommerceEnabled()&&(y.ga("ecommerce:addItem",{id:e,name:t,sku:n,category:i,price:a,quantity:c}),o._log("ecommerce:addItem",r))})},this._trackTrans=function(){var e=this,n=arguments;A(function(){y._gaq.push(["_trackTrans"]),e._log("_trackTrans",n)}),P(function(){e._ecommerceEnabled()&&(y.ga("ecommerce:send"),e._log("ecommerce:send",n))})},this._clearTrans=function(){var e=this,n=arguments;P(function(){e._ecommerceEnabled()&&(y.ga("ecommerce:clear"),e._log("ecommerce:clear",n))})},this._addProduct=function(e,n,t,i,a,c,o,r,s){var u=this,l=arguments;A(function(){y._gaq.push(["_addProduct",e,n,t,i,a,c,o,r,s]),u._log("_addProduct",l)}),P(function(){u._enhancedEcommerceEnabled()&&(y.ga("ec:addProduct",{id:e,name:n,category:t,brand:i,variant:a,price:c,quantity:o,coupon:r,position:s}),u._log("ec:addProduct",l))})},this._addImpression=function(e,n,t,i,a,c,o,r){var s=this,u=arguments;A(function(){y._gaq.push(["_addImpression",e,n,t,i,a,c,o,r]),s._log("_addImpression",u)}),P(function(){s._enhancedEcommerceEnabled()&&y.ga("ec:addImpression",{id:e,name:n,category:a,brand:i,variant:c,list:t,position:o,price:r}),s._log("ec:addImpression",u)})},this._addPromo=function(e,n,t,i){var a=this,c=arguments;A(function(){y._gaq.push(["_addPromo",e,n,t,i]),a._log("_addPromo",arguments)}),P(function(){a._enhancedEcommerceEnabled()&&(y.ga("ec:addPromo",{id:e,name:n,creative:t,position:i}),a._log("ec:addPromo",c))})},this._getActionFieldObject=function(e,n,t,i,a,c,o,r,s){var u={};return e&&(u.id=e),n&&(u.affiliation=n),t&&(u.revenue=t),i&&(u.tax=i),a&&(u.shipping=a),c&&(u.coupon=c),o&&(u.list=o),r&&(u.step=r),s&&(u.option=s),u},this._setAction=function(e,n){var t=this,i=arguments;A(function(){y._gaq.push(["_setAction",e,n]),t._log("__setAction",i)}),P(function(){t._enhancedEcommerceEnabled()&&(y.ga("ec:setAction",e,n),t._log("ec:setAction",i))})},this._trackTransaction=function(e,n,t,i,a,c,o,r,s){this._setAction("purchase",this._getActionFieldObject(e,n,t,i,a,c,o,r,s)),this._pageView()},this._trackRefund=function(e){this._setAction("refund",this._getActionFieldObject(e)),this._pageView()},this._trackCheckOut=function(e,n){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,e,n)),this._pageView()},this._trackCart=function(e){-1!==["add","remove"].indexOf(e)&&(this._setAction(e),this._send("event","UX","click",e+"to cart"))},this._promoClick=function(e){this._setAction("promo_click"),this._send("event","Internal Promotions","click",e)},this._productClick=function(e){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,e,null,null)),this._send("event","UX","click",e)},this._send=function(e){var n=this;P(function(){y.ga("send",e),n._log("send",e)})},this._pageView=function(){this._send("pageview")},this._set=function(e,n){var t=this;P(function(){y.ga("set",e,n),t._log("set",e,n)})},u?T():b(),r&&w.$on(l,function(){I._trackPage()}),{_logs:I._logs,cookieConfig:d,displayFeatures:n,ecommerce:g,enhancedEcommerce:m,enhancedLinkAttribution:_,getUrl:L,experimentId:a,ignoreFirstPageLoad:f,ecommerceEnabled:function(){return I._ecommerceEnabled()},enhancedEcommerceEnabled:function(){return I._enhancedEcommerceEnabled()},trackPage:function(e,n){I._trackPage(e,n)},trackEvent:function(e,n,t,i,a){I._trackEvent(e,n,t,i,a)},addTrans:function(e,n,t,i,a,c,o,r,s){I._addTrans(e,n,t,i,a,c,o,r,s)},addItem:function(e,n,t,i,a,c){I._addItem(e,n,t,i,a,c)},trackTrans:function(){I._trackTrans()},clearTrans:function(){I._clearTrans()},addProduct:function(e,n,t,i,a,c,o,r,s){I._addProduct(e,n,t,i,a,c,o,r,s)},addPromo:function(e,n,t,i){I._addPromo(e,n,t,i)},addImpression:function(e,n,t,i,a,c,o,r){I._addImpression(e,n,t,i,a,c,o,r)},productClick:function(e){I._productClick(e)},promoClick:function(e){I._promoClick(e)},trackDetail:function(){I._setAction("detail"),I._pageView()},trackCart:function(e){I._trackCart(e)},trackCheckout:function(e,n){I._trackCheckOut(e,n)},trackTransaction:function(e,n,t,i,a,c,o,r,s){I._trackTransaction(e,n,t,i,a,c,o,r,s)},setAction:function(e,n){I._setAction(e,n)},send:function(e){I._send(e)},pageView:function(){I._pageView()},set:function(e,n){I._set(e,n)}}}]});