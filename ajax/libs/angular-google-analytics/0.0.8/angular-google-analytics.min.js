/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.8 - 2014-10-26
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var e,t,n,a,i,c,s=!1,r=!0,o="",u=!1,l="$routeChangeSuccess",g="auto",m=!1,d=!1,_=!1,h=!1,p=!1,f={allowLinker:!0};this._logs=[],this.setAccount=function(t){return e=t,!0},this.trackPages=function(e){return r=e,!0},this.trackPrefix=function(e){return o=e,!0},this.setDomainName=function(e){return n=e,!0},this.useDisplayFeatures=function(e){return t=!!e,!0},this.useAnalytics=function(e){return u=!!e,!0},this.useEnhancedLinkAttribution=function(e){return _=!!e,!0},this.useCrossDomainLinker=function(e){return p=!!e,!0},this.setCrossLinkDomains=function(e){return c=e,!0},this.setPageEvent=function(e){return l=e,!0},this.setCookieConfig=function(e){return g=e,!0},this.useECommerce=function(e,t){return m=!!e,d=!!t,!0},this.setRemoveRegExp=function(e){return e instanceof RegExp?(a=e,!0):!1},this.setExperimentId=function(e){return i=e,!0},this.ignoreFirstPageLoad=function(e){h=!!e},this.$get=["$document","$rootScope","$location","$window",function(k,v,w,y){function A(){if(e){y._gaq=[],y._gaq.push(["_setAccount",e]),n&&y._gaq.push(["_setDomainName",n]),_&&y._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),r&&!h&&(a?y._gaq.push(["_trackPageview",P()]):y._gaq.push(["_trackPageview"]));var i;i=t?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var e=k[0],t=e.createElement("script");t.type="text/javascript",t.async=!0,t.src=i;var n=e.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}(i),s=!0}}function E(){if(!e)return console.warn("No account id set for Analytics.js");if(function(e,t,n,a,i,c,s){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,c=t.createElement(n),s=t.getElementsByTagName(n)[0],c.async=1,c.src=a,s.parentNode.insertBefore(c,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(e)?e.forEach(function(e){y.ga("create",e.tracker,g,{name:e.name})}):p?(y.ga("create",e,g,f),y.ga("require","linker"),c&&y.ga("linker:autoLink",c)):y.ga("create",e,g),t&&y.ga("require","displayfeatures"),r&&!h&&y.ga("send","pageview",P()),y.ga&&(m&&(d?y.ga("require","ec","ec.js"):y.ga("require","ecommerce","ecommerce.js")),_&&y.ga("require","linkid","linkid.js"),i)){var n=document.createElement("script"),a=document.getElementsByTagName("script")[0];n.src="//www.google-analytics.com/cx/api.js?experiment="+i,a.parentNode.insertBefore(n,a)}}var P=function(){var e=w.path();return a?e.replace(a,""):e};this._log=function(){this._logs.push(arguments)},this._trackPage=function(t,n){n=n?n:k[0].title,r&&!u&&y._gaq?(y._gaq.push(["_set","title",n]),y._gaq.push(["_trackPageview",o+t]),this._log("_trackPageview",arguments)):r&&u&&y.ga&&(angular.isArray(e)?e.forEach(function(e){y.ga(e.name+".send","pageview",{page:o+t,title:n})}):y.ga("send","pageview",{page:o+t,title:n}),this._log("pageview",arguments))},this._trackEvent=function(e,t,n,a){!u&&y._gaq?(y._gaq.push(["_trackEvent",e,t,n,a]),this._log("trackEvent",arguments)):y.ga&&(y.ga("send","event",e,t,n,a),this._log("event",arguments))},this._addTrans=function(e,t,n,a,i,c,s,r,o){!u&&y._gaq?(y._gaq.push(["_addTrans",e,t,n,a,i,c,s,r]),this._log("_addTrans",arguments)):y.ga&&(m?d?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(y.ga("ecommerce:addTransaction",{id:e,affiliation:t,revenue:n,tax:a,shipping:i,currency:o||"USD"}),this._log("ecommerce:addTransaction",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._addItem=function(e,t,n,a,i,c){!u&&y._gaq?(y._gaq.push(["_addItem",e,t,n,a,i,c]),this._log("_addItem",arguments)):y.ga&&(m?d?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(y.ga("ecommerce:addItem",{id:e,name:n,sku:t,category:a,price:i,quantity:c}),this._log("ecommerce:addItem",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._trackTrans=function(){!u&&y._gaq?(y._gaq.push(["_trackTrans"]),this._log("_trackTrans",arguments)):y.ga&&(m?d?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(y.ga("ecommerce:send"),this._log("ecommerce:send",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._clearTrans=function(){y.ga&&(m?d?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(y.ga("ecommerce:clear"),this._log("ecommerce:clear",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._addProduct=function(e,t,n,a,i,c,s,r,o){!u&&y._gaq?(y._gaq.push(["_addProduct",e,t,n,a,i,c,s,r,o]),this._log("_addProduct",arguments)):y.ga&&(m?d?(y.ga("ec:addProduct",{id:e,name:t,category:n,brand:a,variant:i,price:c,quantity:s,coupon:r,position:o}),this._log("ec:addProduct",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._addImpression=function(e,t,n,a,i,c,s,r){!u&&y._gaq?(y._gaq.push(["_addImpression",e,t,n,a,i,c,s,r]),this._log("_addImpression",arguments)):y.ga&&(m?d?y.ga("ec:addImpression",{id:e,name:t,category:i,brand:a,variant:c,list:n,position:s,price:r}):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"),this._log("ec:addImpression",arguments))},this._addPromo=function(e,t,n,a){!u&&y._gaq?(y._gaq.push(["_addPromo",e,t,n,a]),this._log("_addPromo",arguments)):y.ga&&(m?d?(y.ga("ec:addPromo",{id:e,name:t,creative:n,position:a}),this._log("ec:addPromo",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._getActionFieldObject=function(e,t,n,a,i,c,s,r,o){var u={};return e&&(u.id=e),t&&(u.affiliation=t),n&&(u.revenue=n),a&&(u.tax=a),i&&(u.shipping=i),c&&(u.coupon=c),s&&(u.list=s),r&&(u.step=r),o&&(u.option=o),u},this._setAction=function(e,t){!u&&y._gaq?(y._gaq.push(["_setAction",e,t]),this._log("__setAction",arguments)):y.ga&&(m?d?(y.ga("ec:setAction",e,t),this._log("ec:setAction",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._trackTransaction=function(e,t,n,a,i,c,s,r,o){this._setAction("purchase",this._getActionFieldObject(e,t,n,a,i,c,s,r,o)),this._pageView()},this._trackRefund=function(e){this._setAction("refund",this._getActionFieldObject(e)),this._pageView()},this._trackCheckOut=function(e,t){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,e,t)),this._pageView()},this._trackCart=function(e){-1!==["add","remove"].indexOf(e)&&(this._setAction(e),this._send("event","UX","click",e+"to cart"))},this._promoClick=function(e){this._setAction("promo_click"),this._send("event","Internal Promotions","click",e)},this._productClick=function(e){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,e,null,null)),this._send("event","UX","click",e)},this._send=function(e){y.ga&&(y.ga("send",e),this._log("send",e))},this._pageView=function(){this._send("pageview")},this._set=function(e,t){y.ga&&(y.ga("set",e,t),this._log("set",e,t))},u?E():A();var q=this;return r&&v.$on(l,function(){q._trackPage(P())}),{_logs:q._logs,cookieConfig:g,displayFeatures:t,ecommerce:m,enhancedEcommerce:d,enhancedLinkAttribution:_,getUrl:P,experimentId:i,ignoreFirstPageLoad:h,trackPage:function(e,t){q._trackPage(e,t)},trackEvent:function(e,t,n,a){q._trackEvent(e,t,n,a)},addTrans:function(e,t,n,a,i,c,s,r,o){q._addTrans(e,t,n,a,i,c,s,r,o)},addItem:function(e,t,n,a,i,c){q._addItem(e,t,n,a,i,c)},trackTrans:function(){q._trackTrans()},clearTrans:function(){q._clearTrans()},addProduct:function(e,t,n,a,i,c,s,r,o){q._addProduct(e,t,n,a,i,c,s,r,o)},addPromo:function(e,t,n,a){q._addPromo(e,t,n,a)},addImpression:function(e,t,n,a,i,c,s,r){q._addImpression(e,t,n,a,i,c,s,r)},productClick:function(e){q._productClick(e)},promoClick:function(e){q._promoClick(e)},trackDetail:function(){q._setAction("detail"),q._pageView()},trackCart:function(e){q._trackCart(e)},trackCheckout:function(e,t){q._trackCheckOut(e,t)},trackTransaction:function(e,t,n,a,i,c,s,r,o){q._trackTransaction(e,t,n,a,i,c,s,r,o)},setAction:function(e,t){q._setAction(e,t)},send:function(e){q._send(e)},pageView:function(){q._pageView()},set:function(e,t){q._set(e,t)}}}]});