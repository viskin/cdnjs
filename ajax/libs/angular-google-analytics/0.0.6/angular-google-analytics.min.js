/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.6 - 2014-10-07
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var e,t,n,a,r,i,s=!1,c=!0,o="",g=!1,u="$routeChangeSuccess",m="auto",l=!1,d=!1,_=!1,h=!1,f={allowLinker:!0};this._logs=[],this.setAccount=function(t){return e=t,!0},this.trackPages=function(e){return c=e,!0},this.trackPrefix=function(e){return o=e,!0},this.setDomainName=function(e){return n=e,!0},this.useDisplayFeatures=function(e){return t=!!e,!0},this.useAnalytics=function(e){return g=!!e,!0},this.useEnhancedLinkAttribution=function(e){return d=!!e,!0},this.useCrossDomainLinker=function(e){return h=!!e,!0},this.setCrossLinkDomains=function(e){return i=e,!0},this.setPageEvent=function(e){return u=e,!0},this.setCookieConfig=function(e){return m=e,!0},this.useECommerce=function(e){return l=!!e,!0},this.setRemoveRegExp=function(e){return e instanceof RegExp?(a=e,!0):!1},this.setExperimentId=function(e){return r=e,!0},this.ignoreFirstPageLoad=function(e){_=!!e},this.$get=["$document","$rootScope","$location","$window",function(p,k,v,w){function q(){if(e){w._gaq=[],w._gaq.push(["_setAccount",e]),d&&w._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),c&&!_&&(a?w._gaq.push(["_trackPageview",E()]):w._gaq.push(["_trackPageview"])),n&&w._gaq.push(["_setDomainName",n]);var r;r=t?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var e=p[0],t=e.createElement("script");t.type="text/javascript",t.async=!0,t.src=r;var n=e.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}(r),s=!0}}function y(){if(!e)return console.warn("No account id set for Analytics.js");if(function(e,t,n,a,r,i,s){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(n),s=t.getElementsByTagName(n)[0],i.async=1,i.src=a,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(e)?e.forEach(function(e){w.ga("create",e.tracker,m,{name:e.name})}):h?(w.ga("create",e,m,f),w.ga("require","linker"),i&&w.ga("linker:autoLink",i)):w.ga("create",e,m),t&&w.ga("require","displayfeatures"),c&&!_&&w.ga("send","pageview",E()),w.ga&&(l&&w.ga("require","ecommerce","ecommerce.js"),d&&w.ga("require","linkid","linkid.js"),r)){var n=document.createElement("script"),a=document.getElementsByTagName("script")[0];n.src="//www.google-analytics.com/cx/api.js?experiment="+r,a.parentNode.insertBefore(n,a)}}var E=function(){var e=v.path();return a?e.replace(a,""):e};this._log=function(){this._logs.push(arguments)},this._trackPage=function(t,n){n=n?n:p[0].title,c&&!g&&w._gaq?(w._gaq.push(["_set","title",n]),w._gaq.push(["_trackPageview",o+t]),this._log("_trackPageview",arguments)):c&&g&&w.ga&&(angular.isArray(e)?e.forEach(function(e){w.ga(e.name+".send","pageview",{page:o+t,title:n})}):w.ga("send","pageview",{page:o+t,title:n}),this._log("pageview",arguments))},this._trackEvent=function(e,t,n,a){!g&&w._gaq?(w._gaq.push(["_trackEvent",e,t,n,a]),this._log("trackEvent",arguments)):w.ga&&(w.ga("send","event",e,t,n,a),this._log("event",arguments))},this._addTrans=function(e,t,n,a,r,i,s,c,o){!g&&w._gaq?(w._gaq.push(["_addTrans",e,t,n,a,r,i,s,c]),this._log("_addTrans",arguments)):w.ga&&(l?(w.ga("ecommerce:addTransaction",{id:e,affiliation:t,revenue:n,tax:a,shipping:r,currency:o||"USD"}),this._log("ecommerce:addTransaction",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true);"))},this._addItem=function(e,t,n,a,r,i){!g&&w._gaq?(w._gaq.push(["_addItem",e,t,n,a,r,i]),this._log("_addItem",arguments)):w.ga&&(w.ga("ecommerce:addItem",{id:e,name:n,sku:t,category:a,price:r,quantity:i}),this._log("ecommerce:addItem",arguments))},this._trackTrans=function(){!g&&w._gaq?(w._gaq.push(["_trackTrans"]),this._log("_trackTrans",arguments)):w.ga&&(w.ga("ecommerce:send"),this._log("ecommerce:send",arguments))},this._clearTrans=function(){w.ga&&(w.ga("ecommerce:clear"),this._log("ecommerce:clear",arguments))},this._send=function(e){w.ga&&(w.ga("send",e),this._log("send",e))},this._set=function(e,t){w.ga&&(w.ga("set",e,t),this._log("set",e,t))},g?y():q();var T=this;return c&&k.$on(u,function(){T._trackPage(E())}),{_logs:T._logs,cookieConfig:m,displayFeatures:t,ecommerce:l,enhancedLinkAttribution:d,getUrl:E,experimentId:r,ignoreFirstPageLoad:_,trackPage:function(e,t){T._trackPage(e,t)},trackEvent:function(e,t,n,a){T._trackEvent(e,t,n,a)},addTrans:function(e,t,n,a,r,i,s,c,o){T._addTrans(e,t,n,a,r,i,s,c,o)},addItem:function(e,t,n,a,r,i){T._addItem(e,t,n,a,r,i)},trackTrans:function(){T._trackTrans()},clearTrans:function(){T._clearTrans()},send:function(e){T._send(e)},set:function(e,t){T._set(e,t)}}}]});