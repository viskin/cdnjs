define(function(){function e(){for(var e=[],n=u.length;n>-1;n-=1)if(u[n])for(var r=u[n],t=0;t<r.length;t+=1){for(var a=r[t],o=!0,f=0;f<a.keys.length;f+=1){var i=a.keys[f];c.indexOf(i)<0&&(o=!1)}o&&e.push(a)}return e}function n(n){if(1>c)return!0;for(var r,t=e(),a=[],o=0;o<t.length;o+=1){for(var f=t[o],i=!1,u=0;u<f.keys.length;u+=1){var s=f.keys[u];if(a.indexOf(s)>-1){i=!0;break}}if(!i){"function"==typeof f.callback&&(f.callback(n,f.keys,f.keyCombo)||(r=!1)),l[f.keyCombo]||(l[f.keyCombo]=f);for(var u=0;u<f.keys.length;u+=1){var s=f.keys[u];a.indexOf(s)<0&&a.push(s)}}}return a.length?!1:r}function r(n){var r,t=e();for(var a in l)if(l.hasOwnProperty(a)){for(var o=l[a],f=!1,i=0;i<t.length;i+=1){var c=t[i].keyCombo;if(c===a){f=!0;break}}f||("function"==typeof o.endCallback&&(o.endCallback(n,o.keys,o.keyCombo)||(r=!1)),delete l[a])}return r}function t(e,n,r){function t(){if(f&&f.length){var e=u[f.length];if(e.indexOf(i)>-1){var n=u[f.length].indexOf(i);delete u[f.length][n]}}}for(var a=e.toLowerCase().replace(/\s/g,"").split(","),o=0;o<a.length;o+=1){var f=a[o].split("+");if(f.length){u[f.length]||(u[f.length]=[]);var i={callback:n,endCallback:r,keyCombo:a[o],keys:f};u[f.length].push(i)}}return{clear:t}}function a(e,n,r,a,o){function f(){"function"==typeof c&&c(),"function"==typeof l&&l(),"function"==typeof u&&u(),"function"==typeof s&&s(),"function"==typeof k&&clearInterval(k)}var i=[0,0];if("function"==typeof o){var c=t(e,function(){0===i[0]&&(i[0]=-1)},function(){i[0]=0}).clear,l=t(n,function(){0===i[0]&&(i[0]=1)},function(){i[0]=0}).clear,u=t(r,function(){0===i[1]&&(i[1]=-1)},function(){i[1]=0}).clear,s=t(a,function(){0===i[1]&&(i[1]=1)},function(){i[1]=0}).clear,k=setInterval(function(){var e;0===i[0]&&0===i[1]||(-1===i[0]&&-1===i[1]?e=315:-1===i[0]&&1===i[1]?e=45:1===i[0]&&-1===i[1]?e=225:1===i[0]&&1===i[1]?e=135:-1===i[0]&&0===i[1]?e=0:1===i[0]&&0===i[1]?e=180:0===i[0]&&-1===i[1]?e=270:0===i[0]&&1===i[1]&&(e=90),o(e))},1);return{clear:f}}}function o(e){if("all"===e)return void(u=[]);e=e.replace(/\s/g,"").split(",");for(var n=u.length;n>-1;n-=1)if(u[n]){for(var r=u[n],t=!0,a=0;a<r.length;a+=1){for(var o=r[a],f=0;f<o.keys.length;f+=1){for(var i=o.keys[f],c=0;c<e.length;c+=1){var l=e[c];if(l===i){t=!0;break}}if(t)break}if(t)break}t&&delete u[n]}}function f(){return c}var i={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,"break":19,capslock:20,escape:27,esc:27,space:32,spacebar:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,windows:91,win:91,_91:92,select:93,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,num:144,scrolllock:145,scroll:145,semicolon:186,equal:187,equalsign:187,comma:188,dash:189,period:190,slash:191,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},c=[],l={},u=[];return document.addEventListener("keydown",function(e){for(var r in i)i.hasOwnProperty(r)&&e.keyCode===i[r]&&c.indexOf(r)<0&&c.push(r);return n(e)}),document.addEventListener("keyup",function(e){for(var n in i)if(i.hasOwnProperty(n)&&e.keyCode===i[n]){var t=c.indexOf(n);t>-1&&c.splice(t,1)}return r(e)}),{bind:{key:t,axis:a},activeKeys:f,unbind:{key:o}}});