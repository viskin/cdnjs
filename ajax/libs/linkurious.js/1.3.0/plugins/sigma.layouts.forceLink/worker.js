(function(undefined){"use strict";function crush(a){var b,c,d,e=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],f=["source","target","weight"],g=["node","centerX","centerY","size","nextSibling","firstChild","mass","massCenterX","massCenterY"];for(c=0,d=g.length;d>c;c++)b=new RegExp("rp\\(([^,]*), '"+g[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);for(c=0,d=e.length;d>c;c++)b=new RegExp("np\\(([^,]*), '"+e[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);for(c=0,d=f.length;d>c;c++)b=new RegExp("ep\\(([^,]*), '"+f[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);return a}function getWorkerFn(){var a=crush?crush(Worker.toString()):Worker.toString();return";("+a+").call(this);"}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,inWebWorker=!("document"in _root),Worker=function(){function a(){var a,b,c={},d=arguments.length;for(a=d-1;a>=0;a--)for(b in arguments[a])c[b]=arguments[a][b];return c}function b(a){var b;for(b in a)"hasOwnProperty"in a&&!a.hasOwnProperty(b)||delete a[b];return a}function c(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))}function d(a,b,c,d,e){return(e-d)*(a-b)/(c-b)+d}function e(a){return Math.acos(a.x/Math.sqrt(a.x*a.x+a.y*a.y))}function f(a,b,c,d){return{xi:-(d-b),yi:c-a,xi_prime:d-b,yi_prime:-(c-a)}}function g(a,b){return{x:(a.xi_prime-a.xi)/b,y:(a.yi_prime-a.yi)/b}}function h(a,b,c,d,e){return{x:a+(c-a)*e,y:b+(d-b)*e}}function i(a,b){if(a%t.ppn!==0)throw new Error('Invalid argument in np: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in np: "i" is not an integer.');if(b in u)return a+u[b];throw new Error("ForceLink.Worker - Inexistant node property given ("+b+").")}function j(a,b){if(a%t.ppe!==0)throw new Error('Invalid argument in ep: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in ep: "i" is not an integer.');if(b in v)return a+v[b];throw new Error("ForceLink.Worker - Inexistant edge property given ("+b+").")}function k(a,b){if(a%t.ppr!==0)throw new Error('Invalid argument in rp: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in rp: "i" is not an integer.');if(b in w)return a+w[b];throw new Error("ForceLink.Worker - Inexistant region property given ("+b+").")}function l(a,b,c){c=c||{};p=a,q=b,t.nodesLength=p.length,t.edgesLength=q.length,m(c)}function m(b){t.settings=a(b,t.settings)}function n(){var a,b,l,m,n,o,s,u,v,w,x,y,z,A,B,C,D;for(l=0;l<t.nodesLength;l+=t.ppn)p[i(l,"old_dx")]=p[i(l,"dx")],p[i(l,"old_dy")]=p[i(l,"dy")],p[i(l,"dx")]=0,p[i(l,"dy")]=0;if(t.settings.outboundAttractionDistribution){for(v=0,l=0;l<t.nodesLength;l+=t.ppn)v+=p[i(l,"mass")];v/=t.nodesLength}if(t.settings.barnesHutOptimize){var E,F,G=1/0,H=-(1/0),I=1/0,J=-(1/0);for(r=[],l=0;l<t.nodesLength;l+=t.ppn)G=Math.min(G,p[i(l,"x")]),H=Math.max(H,p[i(l,"x")]),I=Math.min(I,p[i(l,"y")]),J=Math.max(J,p[i(l,"y")]);for(r[k(0,"node")]=-1,r[k(0,"centerX")]=(G+H)/2,r[k(0,"centerY")]=(I+J)/2,r[k(0,"size")]=Math.max(H-G,J-I),r[k(0,"nextSibling")]=-1,r[k(0,"firstChild")]=-1,r[k(0,"mass")]=0,r[k(0,"massCenterX")]=0,r[k(0,"massCenterY")]=0,a=1,l=0;l<t.nodesLength;l+=t.ppn)for(b=0;;)if(r[k(b,"firstChild")]>=0)E=p[i(l,"x")]<r[k(b,"centerX")]?p[i(l,"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]:r[k(b,"firstChild")]+t.ppr:p[i(l,"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]+2*t.ppr:r[k(b,"firstChild")]+3*t.ppr,r[k(b,"massCenterX")]=(r[k(b,"massCenterX")]*r[k(b,"mass")]+p[i(l,"x")]*p[i(l,"mass")])/(r[k(b,"mass")]+p[i(l,"mass")]),r[k(b,"massCenterY")]=(r[k(b,"massCenterY")]*r[k(b,"mass")]+p[i(l,"y")]*p[i(l,"mass")])/(r[k(b,"mass")]+p[i(l,"mass")]),r[k(b,"mass")]+=p[i(l,"mass")],b=E;else{if(r[k(b,"node")]<0){r[k(b,"node")]=l;break}if(r[k(b,"firstChild")]=a*t.ppr,s=r[k(b,"size")]/2,u=r[k(b,"firstChild")],r[k(u,"node")]=-1,r[k(u,"centerX")]=r[k(b,"centerX")]-s,r[k(u,"centerY")]=r[k(b,"centerY")]-s,r[k(u,"size")]=s,r[k(u,"nextSibling")]=u+t.ppr,r[k(u,"firstChild")]=-1,r[k(u,"mass")]=0,r[k(u,"massCenterX")]=0,r[k(u,"massCenterY")]=0,u+=t.ppr,r[k(u,"node")]=-1,r[k(u,"centerX")]=r[k(b,"centerX")]-s,r[k(u,"centerY")]=r[k(b,"centerY")]+s,r[k(u,"size")]=s,r[k(u,"nextSibling")]=u+t.ppr,r[k(u,"firstChild")]=-1,r[k(u,"mass")]=0,r[k(u,"massCenterX")]=0,r[k(u,"massCenterY")]=0,u+=t.ppr,r[k(u,"node")]=-1,r[k(u,"centerX")]=r[k(b,"centerX")]+s,r[k(u,"centerY")]=r[k(b,"centerY")]-s,r[k(u,"size")]=s,r[k(u,"nextSibling")]=u+t.ppr,r[k(u,"firstChild")]=-1,r[k(u,"mass")]=0,r[k(u,"massCenterX")]=0,r[k(u,"massCenterY")]=0,u+=t.ppr,r[k(u,"node")]=-1,r[k(u,"centerX")]=r[k(b,"centerX")]+s,r[k(u,"centerY")]=r[k(b,"centerY")]+s,r[k(u,"size")]=s,r[k(u,"nextSibling")]=r[k(b,"nextSibling")],r[k(u,"firstChild")]=-1,r[k(u,"mass")]=0,r[k(u,"massCenterX")]=0,r[k(u,"massCenterY")]=0,a+=4,E=p[i(r[k(b,"node")],"x")]<r[k(b,"centerX")]?p[i(r[k(b,"node")],"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]:r[k(b,"firstChild")]+t.ppr:p[i(r[k(b,"node")],"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]+2*t.ppr:r[k(b,"firstChild")]+3*t.ppr,r[k(b,"mass")]=p[i(r[k(b,"node")],"mass")],r[k(b,"massCenterX")]=p[i(r[k(b,"node")],"x")],r[k(b,"massCenterY")]=p[i(r[k(b,"node")],"y")],r[k(E,"node")]=r[k(b,"node")],r[k(b,"node")]=-1,F=p[i(l,"x")]<r[k(b,"centerX")]?p[i(l,"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]:r[k(b,"firstChild")]+t.ppr:p[i(l,"y")]<r[k(b,"centerY")]?r[k(b,"firstChild")]+2*t.ppr:r[k(b,"firstChild")]+3*t.ppr,E!==F){r[k(F,"node")]=l;break}b=E}}if(t.settings.barnesHutOptimize)for(w=t.settings.scalingRatio,l=0;l<t.nodesLength;l+=t.ppn)for(b=0;;)if(r[k(b,"firstChild")]>=0){if(C=Math.sqrt((p[i(l,"x")]-r[k(b,"massCenterX")])*(p[i(l,"x")]-r[k(b,"massCenterX")])+(p[i(l,"y")]-r[k(b,"massCenterY")])*(p[i(l,"y")]-r[k(b,"massCenterY")])),2*r[k(b,"size")]/C<t.settings.barnesHutTheta){if(x=p[i(l,"x")]-r[k(b,"massCenterX")],y=p[i(l,"y")]-r[k(b,"massCenterY")],t.settings.adjustSize?C>0?(D=w*p[i(l,"mass")]*r[k(b,"mass")]/C/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D):0>C&&(D=-w*p[i(l,"mass")]*r[k(b,"mass")]/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D):C>0&&(D=w*p[i(l,"mass")]*r[k(b,"mass")]/C/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D),r[k(b,"nextSibling")]<0)break;b=r[k(b,"nextSibling")];continue}b=r[k(b,"firstChild")]}else{if(r[k(b,"node")]>=0&&r[k(b,"node")]!==l&&(x=p[i(l,"x")]-p[i(r[k(b,"node")],"x")],y=p[i(l,"y")]-p[i(r[k(b,"node")],"y")],C=Math.sqrt(x*x+y*y),t.settings.adjustSize?C>0?(D=w*p[i(l,"mass")]*p[i(r[k(b,"node")],"mass")]/C/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D):0>C&&(D=-w*p[i(l,"mass")]*p[i(r[k(b,"node")],"mass")]/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D):C>0&&(D=w*p[i(l,"mass")]*p[i(r[k(b,"node")],"mass")]/C/C,p[i(l,"dx")]+=x*D,p[i(l,"dy")]+=y*D)),r[k(b,"nextSibling")]<0)break;b=r[k(b,"nextSibling")]}else for(w=t.settings.scalingRatio,m=0;m<t.nodesLength;m+=t.ppn)for(n=0;m>n;n+=t.ppn)x=p[i(m,"x")]-p[i(n,"x")],y=p[i(m,"y")]-p[i(n,"y")],t.settings.adjustSize?(C=Math.sqrt(x*x+y*y)-p[i(m,"size")]-p[i(n,"size")],C>0?(D=w*p[i(m,"mass")]*p[i(n,"mass")]/C/C,p[i(m,"dx")]+=x*D,p[i(m,"dy")]+=y*D,p[i(n,"dx")]+=x*D,p[i(n,"dy")]+=y*D):0>C&&(D=100*w*p[i(m,"mass")]*p[i(n,"mass")],p[i(m,"dx")]+=x*D,p[i(m,"dy")]+=y*D,p[i(n,"dx")]-=x*D,p[i(n,"dy")]-=y*D)):(C=Math.sqrt(x*x+y*y),C>0&&(D=w*p[i(m,"mass")]*p[i(n,"mass")]/C/C,p[i(m,"dx")]+=x*D,p[i(m,"dy")]+=y*D,p[i(n,"dx")]-=x*D,p[i(n,"dy")]-=y*D));for(u=t.settings.gravity/t.settings.scalingRatio,w=t.settings.scalingRatio,l=0;l<t.nodesLength;l+=t.ppn)D=0,x=p[i(l,"x")],y=p[i(l,"y")],C=Math.sqrt(x*x+y*y),t.settings.strongGravityMode?C>0&&(D=w*p[i(l,"mass")]*u):C>0&&(D=w*p[i(l,"mass")]*u/C),p[i(l,"dx")]-=x*D,p[i(l,"dy")]-=y*D;for(w=1*(t.settings.outboundAttractionDistribution?v:1),o=0;o<t.edgesLength;o+=t.ppe)m=q[j(o,"source")],n=q[j(o,"target")],s=q[j(o,"weight")],B=Math.pow(s,t.settings.edgeWeightInfluence),x=p[i(m,"x")]-p[i(n,"x")],y=p[i(m,"y")]-p[i(n,"y")],t.settings.adjustSizes?(C=Math.sqrt(x*x+y*y-p[i(m,"size")]-p[i(n,"size")]),t.settings.linLogMode?t.settings.outboundAttractionDistribution?C>0&&(D=-w*B*Math.log(1+C)/C/p[i(m,"mass")]):C>0&&(D=-w*B*Math.log(1+C)/C):t.settings.outboundAttractionDistribution?C>0&&(D=-w*B/p[i(m,"mass")]):C>0&&(D=-w*B)):(C=Math.sqrt(x*x+y*y),t.settings.linLogMode?t.settings.outboundAttractionDistribution?C>0&&(D=-w*B*Math.log(1+C)/C/p[i(m,"mass")]):C>0&&(D=-w*B*Math.log(1+C)/C):t.settings.outboundAttractionDistribution?(C=1,D=-w*B/p[i(m,"mass")]):(C=1,D=-w*B)),C>0&&(p[i(m,"dx")]+=x*D,p[i(m,"dy")]+=y*D,p[i(n,"dx")]-=x*D,p[i(n,"dy")]-=y*D);var K,L,M,N,O=0;if(t.settings.adjustSizes)for(l=0;l<t.nodesLength;l+=t.ppn)p[i(l,"fixed")]||(K=Math.sqrt(p[i(l,"dx")]*p[i(l,"dx")]+p[i(l,"dy")]*p[i(l,"dy")]),K>t.maxForce&&(p[i(l,"dx")]=p[i(l,"dx")]*t.maxForce/K,p[i(l,"dy")]=p[i(l,"dy")]*t.maxForce/K),L=p[i(l,"mass")]*Math.sqrt((p[i(l,"old_dx")]-p[i(l,"dx")])*(p[i(l,"old_dx")]-p[i(l,"dx")])+(p[i(l,"old_dy")]-p[i(l,"dy")])*(p[i(l,"old_dy")]-p[i(l,"dy")])),M=Math.sqrt((p[i(l,"old_dx")]+p[i(l,"dx")])*(p[i(l,"old_dx")]+p[i(l,"dx")])+(p[i(l,"old_dy")]+p[i(l,"dy")])*(p[i(l,"old_dy")]+p[i(l,"dy")]))/2,N=.1*Math.log(1+M)/(1+Math.sqrt(L)),z=p[i(l,"x")],A=p[i(l,"y")],p[i(l,"x")]=p[i(l,"x")]+p[i(l,"dx")]*(N/t.settings.slowDown),p[i(l,"y")]=p[i(l,"y")]+p[i(l,"dy")]*(N/t.settings.slowDown),x=p[i(l,"x")],y=p[i(l,"y")],C=Math.sqrt((x-z)*(x-z)+(y-A)*(y-A)),O+=C);else for(l=0;l<t.nodesLength;l+=t.ppn)p[i(l,"fixed")]||(L=p[i(l,"mass")]*Math.sqrt((p[i(l,"old_dx")]-p[i(l,"dx")])*(p[i(l,"old_dx")]-p[i(l,"dx")])+(p[i(l,"old_dy")]-p[i(l,"dy")])*(p[i(l,"old_dy")]-p[i(l,"dy")])),M=Math.sqrt((p[i(l,"old_dx")]+p[i(l,"dx")])*(p[i(l,"old_dx")]+p[i(l,"dx")])+(p[i(l,"old_dy")]+p[i(l,"dy")])*(p[i(l,"old_dy")]+p[i(l,"dy")]))/2,N=p[i(l,"convergence")]*Math.log(1+M)/(1+Math.sqrt(L)),p[i(l,"convergence")]=Math.min(1,Math.sqrt(N*(p[i(l,"dx")]*p[i(l,"dx")]+p[i(l,"dy")]*p[i(l,"dy")])/(1+Math.sqrt(L)))),z=p[i(l,"x")],A=p[i(l,"y")],p[i(l,"x")]=p[i(l,"x")]+p[i(l,"dx")]*(N/t.settings.slowDown),p[i(l,"y")]=p[i(l,"y")]+p[i(l,"dy")]*(N/t.settings.slowDown),x=p[i(l,"x")],y=p[i(l,"y")],C=Math.sqrt((x-z)*(x-z)+(y-A)*(y-A)),O+=C);if(t.iterations++,t.settings.autoStop&&(t.converged=t.iterations>t.settings.maxIterations||O/t.nodesLength<t.settings.avgDistanceThreshold,t.converged&&t.settings.alignNodeSiblings)){var P,Q,R={},S={};for(o=0;o<t.edgesLength;o+=t.ppe)m=q[j(o,"source")],n=q[j(o,"target")],m!==n&&(R[m]=R[m]||{},R[n]=R[n]||{},R[m][n]=!0,R[n][m]=!0);Object.keys(R).forEach(function(a){a=~~a,Q=Object.keys(R[a]),2==Q.length&&(P=Q[0]+";"+Q[1],P in S?S[P].push(a):(P=Q[1]+";"+Q[0],S[P]||(S[P]=[~~Q[1],~~Q[0]]),S[P].push(a)))});var T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga=t.settings.nodeSiblingsAngleMin;Object.keys(S).forEach(function(a){if(U=S[a].shift(),V=S[a].shift(),T=S[a].filter(function(a){return!p[i(a,"fixed")]}),1!=T.length){if(Y=p[i(U,"x")],Z=p[i(U,"y")],$=p[i(V,"x")],_=p[i(V,"y")],W=Object.keys(R[U]).length,X=Object.keys(R[V]).length,aa=d(W/(W+X),0,1,.25,.75),ca=h(Y,Z,$,_,aa),da=f(Y,Z,$,_),ba=c(Y,Z,$,_),ea=g(da,ba),fa=e(ea),2*ga>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");ga>0&&(ga>fa||fa>Math.PI-ga&&fa<=Math.PI?ea={x:2*Math.cos(Math.PI-ga),y:2*Math.sin(Math.PI-ga)}:(fa>2*Math.PI-ga||fa>=Math.PI&&fa<Math.PI+ga)&&(ea={x:2*Math.cos(ga),y:2*Math.sin(ga)}));var b=0,j=1,k=1;T.length%2==1&&(k=0,b=1);for(var l=0;l<T.length;l++)p[i(T[l],"x")]=ca.x+j*ea.x*k*(b||l>=2?t.settings.nodeSiblingsScale:2*t.settings.nodeSiblingsScale/3),p[i(T[l],"y")]=ca.y+j*ea.y*k*(b||l>=2?t.settings.nodeSiblingsScale:2*t.settings.nodeSiblingsScale/3),j=-j,k+=(l+b)%2}})}}function o(a){for(var b=0;a>b;b++)n();s()}var p,q,r,s,t={ppn:10,ppe:3,ppr:9,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:1,iterationsPerRender:1,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!1,alignNodeSiblings:!1,nodeSiblingsScale:1,nodeSiblingsAngleMin:0}},u={x:0,y:1,dx:2,dy:3,old_dx:4,old_dy:5,mass:6,convergence:7,size:8,fixed:9},v={source:0,target:1,weight:2},w={node:0,centerX:1,centerY:2,size:3,nextSibling:4,firstChild:5,mass:6,massCenterX:7,massCenterY:8};s="undefined"!=typeof window&&window.document?function(){if(!t.autoStop||t.converged){var a;document.createEvent?(a=document.createEvent("Event"),a.initEvent("newCoords",!0,!1)):(a=document.createEventObject(),a.eventType="newCoords"),a.eventName="newCoords",a.data={nodes:p.buffer,converged:t.converged},requestAnimationFrame(function(){document.dispatchEvent(a)})}}:function(){(!t.autoStop||t.converged)&&self.postMessage({nodes:p.buffer,converged:t.converged},[p.buffer])};var x=function(a){switch(a.data.action){case"start":l(new Float32Array(a.data.nodes),new Float32Array(a.data.edges),a.data.config),o(t.settings.startingIterations);break;case"loop":p=new Float32Array(a.data.nodes),o(t.settings.iterationsPerRender);break;case"config":m(a.data.config);break;case"kill":b(t),p=null,q=null,r=null,self.removeEventListener("message",x)}};self.addEventListener("message",x)};if(inWebWorker)eval(getWorkerFn());else{if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.layouts.getForceLinkWorker=getWorkerFn}}).call(this);
//# sourceMappingURL=worker.js.map