!function(e,t){"function"==typeof define&&define.amd?define(["knockout"],t):"object"==typeof exports?module.exports=t(require("knockout")):e.KnockoutElse=t(e.ko)}(this,function(e){"use strict";function t(e){return!!e&&"object"==typeof e&&e.constructor===Object}function n(e){return 8==e.nodeType&&h.test(d?e.text:e.nodeValue)}function i(e){return e&&e.nodeType&&1===e.nodeType}function s(e,t){return"string"==typeof e?i(t)&&t.attributes&&t.attributes[e]:i(t)}function a(t,n){return e.utils.arrayFirst(e.virtualElements.childNodes(t),s.bind(this,n))}function o(t,n){return e.utils.arrayFilter(e.virtualElements.childNodes(t),s.bind(this,n))}function u(t,n){var i,n,s=document.createElement("div");t.content?i=t.content:"SCRIPT"===t.tagName?(i=document.createElement("div"),i.innerHTML=t.innerHTML):i=t;var o=a(i,n?null:"data-template");return s.insertBefore(o.cloneNode(!0),null),e.removeNode(o),s}function r(e,t){return{status:"existing",value:e,index:t}}function l(t){var i=this;this.element=t.element,this.container=n(this.element)?this.element.parentNode:this.element,this.$context=t.$context,this.data=t.data,this.as=t.as,this.noContext=t.noContext,this.namedTemplate=void 0!==t.name,this.templateNode=u(t.name?document.getElementById(t.name).cloneNode(!0):t.element,this.namedTemplate),this.afterQueueFlush=t.afterQueueFlush,this.beforeQueueFlush=t.beforeQueueFlush,this.changeQueue=[],this.lastNodesList=[],this.indexesToDelete=[],this.rendering_queued=!1,this.existingElements=o(this.container,this.namedTemplate?null:"data-init"),"function"==typeof t.createElement&&e.utils.arrayForEach(this.existingElements,function(e){i.data.push(t.createElement())});var s=e.unwrap(this.data);s.map&&this.onArrayChange(s.map(r)),e.isObservable(this.data)&&(this.data.indexOf||(this.data=this.data.extend({trackArrayChanges:!0})),this.changeSubs=this.data.subscribe(this.onArrayChange,this,"arrayChange"))}var d=document&&"<!--test-->"===document.createComment("test").text,h=d?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/;l.animateFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},l.prototype.dispose=function(){this.changeSubs&&this.changeSubs.dispose()},l.prototype.onArrayChange=function(t){var n=this,i={added:[],existing:[],deleted:[]};e.utils.arrayForEach(t,function(e){i[e.status].push(e)}),i.deleted.length>0&&(this.changeQueue.push.apply(this.changeQueue,i.deleted),this.changeQueue.push({status:"clearDeletedIndexes"})),this.changeQueue.push.apply(this.changeQueue,i.existing),this.changeQueue.push.apply(this.changeQueue,i.added),this.changeQueue.length>0&&!this.rendering_queued&&(this.rendering_queued=!0,l.animateFrame.call(window,function(){n.processQueue()}))},l.prototype.processQueue=function(){var t=this;"function"==typeof this.beforeQueueFlush&&this.beforeQueueFlush(this.changeQueue),e.utils.arrayForEach(this.changeQueue,function(e){t[e.status](e.index,e.value)}),this.rendering_queued=!1,"function"==typeof this.afterQueueFlush&&this.afterQueueFlush(this.changeQueue),this.changeQueue=[]},l.prototype.createChildContext=function(e,t){return this.noContext?this.$context.extend({$item:t}):this.$context.createChildContext(t,this.as||null,function(t){t.$index=e})},l.prototype.existing=function(t,n){var i=this.existingElements[t];this.lastNodesList.splice(t,0,i),e.applyBindings(this.createChildContext(t,n),i)},l.prototype.added=function(t,n){var i=this.lastNodesList[t-1]||null,s=this.templateNode.cloneNode(!0),a=e.virtualElements.childNodes(s);this.lastNodesList.splice(t,0,a[a.length-1]),e.applyBindingsToDescendants(this.createChildContext(t,n),s);for(var o=a.length-1;o>=0;--o){var u=a[o];if(!u)return;e.virtualElements.insertAfter(this.element,u,i)}},l.prototype.deleted=function(t,n){var i=this.lastNodesList[t],s=this.lastNodesList[t-1]||this.element;do i=i.previousSibling,e.removeNode(i&&i.nextSibling||e.virtualElements.firstChild(this.element));while(i&&i!==s);this.lastNodesList[t]=this.lastNodesList[t-1],this.indexesToDelete.push(t)},l.prototype.clearDeletedIndexes=function(){for(var e=this.indexesToDelete.length-1;e>=0;--e)this.lastNodesList.splice(this.indexesToDelete[e],1);this.indexesToDelete=[]},e.bindingHandlers.foreachInit={init:function(n,i,s,a,o){var u,r=i();return t(r)?(r.element=r.element||n,r.$context=o,u=new l(r)):u=new l({element:n,data:e.unwrap(o.$rawData)===r?o.$rawData:r,$context:o,createElement:r.createElement}),e.utils.domNodeDisposal.addDisposeCallback(n,function(){u.dispose()}),{controlsDescendantBindings:!0}},InitializedForeach:l},e.virtualElements.allowedBindings.foreachInit=!0,e.bindingHandlers.init={init:function(i,s,a,o){var u=s(),r=e.utils.peekObservable(u),l=t(u)&&void 0===u.value&&void 0===u.convert&&void 0===u.field;if(l)for(var d in u)u.hasOwnProperty(d)&&o[d](u[d]);else{var h=n(i)?e.virtualElements.firstChild(i):i,c=t(u)&&void 0!==u.value?u.value:a.get("checked")?h.checked:h.innerText||h.textContent||h.value;t(u)&&"function"==typeof u.convert&&(c=u.convert(c));var m=(e.isObservable(u)?u:void 0)||(t(u)?u.field:void 0)||a.get("text")||a.get("textInput")||a.get("value")||a.get("checked");m(c,r)}}},e.virtualElements.allowedBindings.init=!0});