angular.module("monospaced.elastic",[]).directive("msdElastic",["$timeout","$window",function(a,b){return{restrict:"A, C",link:function(c,d,s){var m=d[0],k=d;if(m.nodeName!=="TEXTAREA"||!b.getComputedStyle){return}k.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var o=m.value;m.value="";m.value=o;var x=s.msdElastic==="\\n"?"\n":s.msdElastic,q=angular.element(b),u=angular.element('<textarea tabindex="-1" style="position: absolute; top: -999px; right: auto; bottom: auto; left: 0 ;overflow: hidden; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; min-height: 0!important; height: 0!important; padding: 0;word-wrap: break-word; border: 0;"/>').data("elastic",true),p=u[0],l=getComputedStyle(m),y=l.getPropertyValue("resize"),n=l.getPropertyValue("box-sizing")==="border-box"||l.getPropertyValue("-moz-box-sizing")==="border-box"||l.getPropertyValue("-webkit-box-sizing")==="border-box",w=!n?{width:0,height:0}:{width:parseInt(l.getPropertyValue("border-top-width"),10)+parseInt(l.getPropertyValue("padding-top"),10)+parseInt(l.getPropertyValue("padding-bottom"),10)+parseInt(l.getPropertyValue("border-bottom-width"),10),height:parseInt(l.getPropertyValue("border-right-width"),10)+parseInt(l.getPropertyValue("padding-right"),10)+parseInt(l.getPropertyValue("padding-left"),10)+parseInt(l.getPropertyValue("border-left-width"),10)},e=parseInt(l.getPropertyValue("min-height"),10),v=parseInt(l.getPropertyValue("height"),10),i=Math.max(e,v)-w.height,r=parseInt(l.getPropertyValue("max-height"),10),j,h,f=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if(k.data("elastic")){return}r=r&&r>0?r:90000;if(p.parentNode!==document.body){angular.element(document.body).append(p)}k.css({resize:(y==="none"||y==="vertical")?"none":"horizontal"}).data("elastic",true);function g(){j=m;l=getComputedStyle(m);angular.forEach(f,function(A){p.style[A]=l.getPropertyValue(A)})}function t(){var C,A,B,D;if(j!==m){g()}if(!h){h=true;p.value=m.value+x;p.style.overflowY=m.style.overflowY;C=m.style.height===""?"auto":parseInt(m.style.height,10);B=parseInt(n?m.offsetWidth:getComputedStyle(m).getPropertyValue("width"),10)-w.width;p.style.width=B+"px";A=p.scrollHeight;if(A>r){A=r;D="scroll"}else{if(A<i){A=i}}A+=w.height;m.style.overflowY=D||"hidden";if(C!==A){m.style.height=A+"px"}a(function(){h=false},1)}}function z(){h=false;t()}if("onpropertychange" in m&&"oninput" in m){m.oninput=m.onkeyup=t}else{m.oninput=t}q.bind("resize",z);t();c.$on("$destroy",function(){u.remove();q.unbind("resize",z)})}}}]);