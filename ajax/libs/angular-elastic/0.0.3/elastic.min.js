angular.module("monospaced.elastic",[]).directive("msdElastic",["$window","$timeout",function(b,a){return{restrict:"A, C",link:function(c,e){var o=e[0];if(o.nodeName!=="TEXTAREA"){return}e.css({overflow:"hidden",resize:"none"});var p=angular.element(b),r=document.createElement("div"),l=angular.element(r).css({position:"absolute",top:"-10000px",left:"-10000px","white-space":"pre-wrap","word-wrap":"break-word"}),m=getComputedStyle(o),f=parseInt(m.getPropertyValue("line-height"),10)||parseInt(m.getPropertyValue("font-size"),10),h=parseInt(m.getPropertyValue("height"),10)||f*3,q=parseInt(m.getPropertyValue("max-height"),10)||Number.MAX_VALUE,g=0,k=["padding-right","padding-left","border-right-width","border-right-style","border-left-width","border-left-style","width","font-weight","font-size","font-family","line-height"];if(q<0){q=Number.MAX_VALUE}var t=k.length,j;while(t--){j=k[t].toString();l.css(j,m.getPropertyValue(j))}e.parent().append(l);function d(){var i=Math.floor(parseInt(o.offsetWidth,10));if(r.offsetWidth!==i){l.css({width:i+"px"});u(true)}}function s(i,w){var v=Math.floor(parseInt(i,10));if(o.offsetHeight!==v){e.css({height:v+"px",overflow:w})}}function n(){var i=r.offsetHeight;if(i<q){if(i>h){e.css({height:i+"px"})}else{e.css({height:h+"px"})}}}function u(w){var x,i=l.html().replace(/<br>/ig,"<br />"),v=e.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");if(w||v+"&nbsp;"!==i){l.html(v+"&nbsp;");x=r.offsetHeight;if(Math.abs((x+f)-o.offsetHeight)>3){g=x+f;if(g>=q){return s(q,"auto")}if(g<=h){return s(h,"hidden")}return s(g,"hidden")}}}e.bind("keyup change cut paste",u).bind("input paste",function(){a(u,250)}).bind("blur",n).bind("resize",d);p.bind("resize",d);u();n();a(function(){e.css({"-webkit-transition":"height 50ms ease-in-out","-moz-transition":"height 50ms ease-in-out","-o-transition":"height 50ms ease-in-out",transition:"height 50ms ease-in-out"})});c.$on("$destroy",function(){l.remove();p.unbind("resize",d)})}}}]);