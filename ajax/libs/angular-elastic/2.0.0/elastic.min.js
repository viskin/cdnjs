angular.module("monospaced.elastic",[]).directive("msdElastic",["$timeout","$window",function(a,b){return{require:"ngModel",restrict:"A, C",link:function(c,d,t,o){var m=d[0],k=d;if(m.nodeName!=="TEXTAREA"||!b.getComputedStyle){return}k.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var p=m.value;m.value="";m.value=p;var y=t.msdElastic==="\\n"?"\n":t.msdElastic,r=angular.element(b),v=angular.element('<textarea tabindex="-1" style="position: absolute; top: -999px; right: auto; bottom: auto; left: 0 ;overflow: hidden; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; min-height: 0!important; height: 0!important; padding: 0;word-wrap: break-word; border: 0;"/>').data("elastic",true),q=v[0],l=getComputedStyle(m),z=l.getPropertyValue("resize"),n=l.getPropertyValue("box-sizing")==="border-box"||l.getPropertyValue("-moz-box-sizing")==="border-box"||l.getPropertyValue("-webkit-box-sizing")==="border-box",x=!n?{width:0,height:0}:{width:parseInt(l.getPropertyValue("border-right-width"),10)+parseInt(l.getPropertyValue("padding-right"),10)+parseInt(l.getPropertyValue("padding-left"),10)+parseInt(l.getPropertyValue("border-left-width"),10),height:parseInt(l.getPropertyValue("border-top-width"),10)+parseInt(l.getPropertyValue("padding-top"),10)+parseInt(l.getPropertyValue("padding-bottom"),10)+parseInt(l.getPropertyValue("border-bottom-width"),10)},e=parseInt(l.getPropertyValue("min-height"),10),w=parseInt(l.getPropertyValue("height"),10),i=Math.max(e,w)-x.height,s=parseInt(l.getPropertyValue("max-height"),10),j,h,f=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if(k.data("elastic")){return}s=s&&s>0?s:90000;if(q.parentNode!==document.body){angular.element(document.body).append(q)}k.css({resize:(z==="none"||z==="vertical")?"none":"horizontal"}).data("elastic",true);function g(){j=m;l=getComputedStyle(m);angular.forEach(f,function(B){q.style[B]=l.getPropertyValue(B)})}function u(){var D,B,C,E;if(j!==m){g()}if(!h){h=true;q.value=m.value+y;q.style.overflowY=m.style.overflowY;D=m.style.height===""?"auto":parseInt(m.style.height,10);C=parseInt(n?m.offsetWidth:getComputedStyle(m).getPropertyValue("width"),10)-x.width;q.style.width=C+"px";B=q.scrollHeight;if(B>s){B=s;E="scroll"}else{if(B<i){B=i}}B+=x.height;m.style.overflowY=E||"hidden";if(D!==B){m.style.height=B+"px"}a(function(){h=false},1)}}function A(){h=false;u()}if("onpropertychange" in m&&"oninput" in m){m.oninput=m.onkeyup=u}else{m.oninput=u}r.bind("resize",A);c.$watch(function(){return o.$modelValue},function(B){A()});c.$on("$destroy",function(){v.remove();r.unbind("resize",A)})}}}]);