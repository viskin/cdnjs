angular.module("monospaced.elastic",[]).directive("msdElastic",["$window","$timeout",function(b,a){return{restrict:"A, C",link:function(t,k){var e=k[0];if(e.nodeName!=="TEXTAREA"){return}k.css({overflow:"hidden",resize:"none"});var h=document.createElement("div"),f=angular.element(h).css({position:"absolute",top:"-10000px",left:"-10000px","word-wrap":"break-word","white-space":"pre-wrap"}),c=getComputedStyle(e),o=parseInt(c.getPropertyValue("line-height"),10)||parseInt(c.getPropertyValue("font-size"),10),r=parseInt(c.getPropertyValue("height"),10)||o*3,q=parseInt(c.getPropertyValue("max-height"),10)||Number.MAX_VALUE,l=0,d=["padding-right","padding-left","font-size","line-height","font-family","width","font-weight","border-right-width","border-right-style","border-left-width","border-left-style"];if(q<0){q=Number.MAX_VALUE}k.parent().append(f);var j=d.length,p;while(j--){p=d[j].toString();f.css(p,c.getPropertyValue(p))}function m(){var i=Math.floor(parseInt(e.offsetWidth,10));if(h.offsetWidth!==i){f.css({width:i+"px"});g(true)}}function s(i,v){var u=Math.floor(parseInt(i,10));if(e.offsetHeight!==u){k.css({height:u+"px",overflow:v})}}function n(){var i=h.offsetHeight;if(i<q){if(i>r){k.css({height:i+"px"})}else{k.css({height:r+"px"})}}}function g(w){var v=k.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");var u=f.html().replace(/<br>/ig,"<br />");if(w||v+"&nbsp;"!==u){f.html(v+"&nbsp;");var x=h.offsetHeight;if(Math.abs((x+o)-e.offsetHeight)>3){var i=x+o;if(i>=q){s(q,"auto")}else{if(i<=r){s(r,"hidden")}else{s(i,"hidden")}}}}}k.bind("keyup change cut paste",function(){g()});angular.element(b).bind("resize",m);k.bind("resize",m);k.bind("update",g);k.bind("blur",n);k.bind("input paste",function(){a(g,250)});g();n();a(function(){k.css({"-webkit-transition":"height 50ms ease-in-out","-moz-transition":"height 50ms ease-in-out","-o-transition":"height 50ms ease-in-out",transition:"height 50ms ease-in-out"})});t.$on("$destroy",function(){f.remove()})}}}]);