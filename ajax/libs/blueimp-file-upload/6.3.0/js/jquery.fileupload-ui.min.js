!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","loadImage","./jquery.fileupload.js"],t):t(window.jQuery,window.tmpl,window.loadImage)}(function(t,e,i){"use strict";t.widget("blueimpUI.fileupload",t.blueimp.fileupload,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:1,acceptFileTypes:/.+$/i,previewFileTypes:/^image\/(gif|jpeg|png)$/,previewMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,dataType:"json",add:function(e,i){var n=t(this).data("fileupload"),a=i.files;n._adjustMaxNumberOfFiles(-a.length),i.isAdjusted=!0,i.files.valid=i.isValidated=n._validate(a),i.context=n._renderUpload(a).appendTo(n._files).data("data",i),n._reflow=t.support.transition&&i.context[0].offsetWidth,n._transitionCallback(i.context.addClass("in"),function(t){n._trigger("added",e,i)!==!1&&(n.options.autoUpload||i.autoUpload)&&i.isValidated&&i.submit()})},send:function(e,i){var n=t(this).data("fileupload");return i.isValidated||(i.isAdjusted||n._adjustMaxNumberOfFiles(-i.files.length),n._validate(i.files))?(i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!t.support.transition&&"progress-animated").find(".bar").css("width",parseInt(100,10)+"%"),n._trigger("sent",e,i)):!1},done:function(e,i){var n,a=t(this).data("fileupload");i.context?i.context.each(function(o){var s=t.isArray(i.result)&&i.result[o]||{error:"emptyResult"};s.error&&a._adjustMaxNumberOfFiles(1),a._transitionCallback(t(this).removeClass("in"),function(o){n=a._renderDownload([s]).css("height",o.height()).replaceAll(o),a._reflow=t.support.transition&&n[0].offsetWidth,a._transitionCallback(n.addClass("in"),function(t){i.context=t,a._trigger("completed",e,i)})})}):(n=a._renderDownload(i.result).appendTo(a._files),a._reflow=t.support.transition&&n[0].offsetWidth,a._transitionCallback(n.addClass("in"),function(t){i.context=t,a._trigger("completed",e,i)}))},fail:function(e,i){var n,a=t(this).data("fileupload");a._adjustMaxNumberOfFiles(i.files.length),i.context?i.context.each(function(o){if("abort"!==i.errorThrown){var s=i.files[o];s.error=s.error||i.errorThrown||!0,a._transitionCallback(t(this).removeClass("in"),function(o){n=a._renderDownload([s]).replaceAll(o),a._reflow=t.support.transition&&n[0].offsetWidth,a._transitionCallback(n.addClass("in"),function(t){i.context=t,a._trigger("failed",e,i)})})}else a._transitionCallback(t(this).removeClass("in"),function(t){t.remove(),a._trigger("failed",e,i)})}):"abort"!==i.errorThrown?(a._adjustMaxNumberOfFiles(-i.files.length),i.context=a._renderUpload(i.files).appendTo(a._files).data("data",i),a._reflow=t.support.transition&&i.context[0].offsetWidth,a._transitionCallback(i.context.addClass("in"),function(t){i.context=t,a._trigger("failed",e,i)})):a._trigger("failed",e,i)},progress:function(t,e){e.context&&e.context.find(".progress .bar").css("width",parseInt(e.loaded/e.total*100,10)+"%")},progressall:function(e,i){t(this).find(".fileupload-buttonbar .progress .bar").css("width",parseInt(i.loaded/i.total*100,10)+"%")},start:function(e){var i=t(this).data("fileupload");i._transitionCallback(t(this).find(".fileupload-buttonbar .progress").addClass("in"),function(t){i._trigger("started",e)})},stop:function(e){var i=t(this).data("fileupload");i._transitionCallback(t(this).find(".fileupload-buttonbar .progress").removeClass("in"),function(t){t.find(".bar").css("width","0%"),i._trigger("stopped",e)})},destroy:function(e,i){var n=t(this).data("fileupload");i.url&&t.ajax(i),n._adjustMaxNumberOfFiles(1),n._transitionCallback(i.context.removeClass("in"),function(t){t.remove(),n._trigger("destroyed",e,i)})}},_enableDragToDesktop:function(){var e=t(this),i=e.prop("href"),n=decodeURIComponent(i.split("/").pop()).replace(/:/g,"-"),a="application/octet-stream";e.bind("dragstart",function(t){try{t.originalEvent.dataTransfer.setData("DownloadURL",[a,n,i].join(":"))}catch(e){}})},_adjustMaxNumberOfFiles:function(t){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=t,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":(t/1e3).toFixed(2)+" KB"},_hasError:function(t){return t.error?t.error:this.options.maxNumberOfFiles<0?"maxNumberOfFiles":this.options.acceptFileTypes.test(t.type)||this.options.acceptFileTypes.test(t.name)?this.options.maxFileSize&&t.size>this.options.maxFileSize?"maxFileSize":"number"==typeof t.size&&t.size<this.options.minFileSize?"minFileSize":null:"acceptFileTypes"},_validate:function(e){var i=this,n=!!e.length;return t.each(e,function(t,e){e.error=i._hasError(e),e.error&&(n=!1)}),n},_renderTemplate:function(e,i){return t(this.options.templateContainer).html(e({files:i,formatFileSize:this._formatFileSize,options:this.options})).children()},_renderUpload:function(e){var n=this,a=this.options,o=this._renderTemplate(a.uploadTemplate,e);return o.find(".preview span").each(function(o,s){var l=e[o];a.previewFileTypes.test(l.type)&&(!a.previewMaxFileSize||l.size<a.previewMaxFileSize)&&i(e[o],function(e){t(s).append(e),n._reflow=t.support.transition&&s.offsetWidth,t(s).addClass("in")},{maxWidth:a.previewMaxWidth,maxHeight:a.previewMaxHeight,canvas:a.previewAsCanvas})}),o},_renderDownload:function(t){var e=this._renderTemplate(this.options.downloadTemplate,t);return e.find("a").each(this._enableDragToDesktop),e},_startHandler:function(e){e.preventDefault();var i=t(this),n=i.closest(".template-upload"),a=n.data("data");a&&a.submit&&!a.jqXHR&&a.submit()&&i.prop("disabled",!0)},_cancelHandler:function(e){e.preventDefault();var i=t(this).closest(".template-upload"),n=i.data("data")||{};n.jqXHR?n.jqXHR.abort():(n.errorThrown="abort",e.data.fileupload._trigger("fail",e,n))},_deleteHandler:function(e){e.preventDefault();var i=t(this);e.data.fileupload._trigger("destroy",e,{context:i.closest(".template-download"),url:i.attr("data-url"),type:i.attr("data-type"),dataType:e.data.fileupload.options.dataType})},_transitionCallback:function(e,i){var n=this;t.support.transition&&e.hasClass("fade")?e.bind(t.support.transition.end,function(a){a.target===e[0]&&(e.unbind(t.support.transition.end),i.call(n,e))}):i.call(this,e)},_initButtonBarEventHandlers:function(){var e=this.element.find(".fileupload-buttonbar"),i=this._files,n=this.options.namespace;e.find(".start").bind("click."+n,function(t){t.preventDefault(),i.find(".start button").click()}),e.find(".cancel").bind("click."+n,function(t){t.preventDefault(),i.find(".cancel button").click()}),e.find(".delete").bind("click."+n,function(t){t.preventDefault(),i.find(".delete input:checked").siblings("button").click()}),e.find(".toggle").bind("change."+n,function(e){i.find(".delete input").prop("checked",t(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){t.blueimp.fileupload.prototype._initEventHandlers.call(this);var e={fileupload:this};this._files.delegate(".start button","click."+this.options.namespace,e,this._startHandler).delegate(".cancel button","click."+this.options.namespace,e,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,e,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._files.undelegate(".start button","click."+this.options.namespace).undelegate(".cancel button","click."+this.options.namespace).undelegate(".delete button","click."+this.options.namespace),t.blueimp.fileupload.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){this.options.templateContainer=document.createElement(this._files.prop("nodeName")),this.options.uploadTemplate=e("template-upload"),this.options.downloadTemplate=e("template-download")},_initFiles:function(){this._files=this.element.find(".files")},_create:function(){this._initFiles(),t.blueimp.fileupload.prototype._create.call(this),this._initTemplates()},destroy:function(){t.blueimp.fileupload.prototype.destroy.call(this)},enable:function(){t.blueimp.fileupload.prototype.enable.call(this),this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton()},disable:function(){this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton(),t.blueimp.fileupload.prototype.disable.call(this)}})});
//# sourceMappingURL=./jquery.fileupload-ui.min.js.map