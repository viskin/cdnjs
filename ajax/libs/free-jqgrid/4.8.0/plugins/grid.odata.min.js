(function(a){a.jgrid.extend({odataGenColModel:function(b){var f=this[0],c=f.p,e=a(f);var d=a.extend(true,{parsecolfunc:null,parsemetadatafunc:null,successfunc:null,errorfunc:null,metadataurl:c.url+"/$metadata",async:false},b||{});a.ajax({url:d.metadataurl,type:"GET",dataType:"xml",async:d.async,cache:false}).done(function(l,h,n){var g=e.triggerHandler("jqGridODataParseMetadata",l);if(g===undefined&&a.isFunction(d.parsemetadatafunc)){g=d.parsemetadatafunc(l,h,n)}if(g!==undefined){c.colModel=g}else{var k=a('EntityType[Name!="Default"] Property',l);if(k.length>0){var m=[];k.each(function(r,q){var i=a(q).attr("Name");var o=a(q).attr("Type").replace("Edm.","");var p=a(q).attr("Nullable");m.push({name:i,type:o,nullable:p})});if(m.length===0){if(a.isFunction(d.errorfunc)){d.errorfunc(n,"parse $metadata error",0)}}g=e.triggerHandler("jqGridODataParseColumns",m);if(g===undefined&&a.isFunction(d.parsecolfunc)){g=d.parsecolfunc(m)}if(g!==undefined){c.colModel=g}else{var j;c.colModel=[];for(j=0;j<m.length;j++){c.colModel.push({label:m[j].name,name:m[j].name,index:m[j].name,editable:true})}}}}if(a.isFunction(d.successfunc)){d.successfunc()}}).fail(function(i,h,g){if(a.isFunction(d.errorfunc)){d.errorfunc(i,h,g)}})},odataInit:function(e){return this.each(function(){var k=this,j=a(k),h=k.p;if(!k.grid||!h){return}var i=a.extend(true,{datatype:"json",gencolumns:false,odataurl:h.url},e||{});if(!i.version||i.version<4){i=a.extend(true,{annotations:false,annotationName:"",inlinecount:true,count:false,top:false},i||{})}else{i=a.extend(true,{annotations:true,annotationName:"@jqgrid.GridModelAnnotate",inlinecount:false,count:true,top:true},i||{})}if(i.datatype==="jsonp"){i.callback="jsonCallback_"+Math.floor((Math.random()*1000)+1)}if(i.gencolumns){var g=a.extend(true,{parsecolfunc:null,parsemetadatafunc:null,errorfunc:null,successfunc:null,async:false,metadataurl:(e.odataurl||h.url)+"/$metadata"},e||{});if(g.async){g.successfunc=function(){if(k.grid.hDiv){k.grid.hDiv.loading=false}j.trigger("reloadGrid")};if(k.grid.hDiv){k.grid.hDiv.loading=true}}j.jqGrid("odataGenColModel",g)}b(h,i)});function b(g,h){g.inlineEditing=a.extend(true,{beforeSaveRow:function(i,k,j){if(i.extraparam.oper==="edit"){i.url=h.odataurl;i.mtype="PATCH";i.url+="("+k+")"}else{i.url=h.odataurl;i.mtype="POST"}return true},serializeSaveData:function(i){return JSON.stringify(i)},ajaxSaveOptions:{contentType:"application/json;charset=utf-8",datatype:"json"}},g.inlineEditing||{});a.extend(g.formEditing,{onclickSubmit:function(i,k,j){if(j==="add"){i.url=h.odataurl;i.mtype="POST"}else{if(j==="edit"){i.url=h.odataurl+"("+k[g.id+"_id"]+")";i.mtype="PUT"}}return k},ajaxEditOptions:{contentType:"application/json;charset=utf-8",datatype:"json"},serializeEditData:function(i){return JSON.stringify(i)}});a.extend(g.formDeleting,{url:h.odataurl,mtype:"DELETE",serializeDelData:function(i){return""},onclickSubmit:function(i,j){i.url+="("+j+")";return""},ajaxDelOptions:{contentType:"application/json;charset=utf-8",datatype:"json"}});a.extend(g,{serializeGridData:function(i){i=d(g,h,i);return i},ajaxGridOptions:{contentType:"application/json;charset=utf-8",datatype:"json"},datatype:h.datatype,jsonpCallback:h.callback,contentType:"application/json;charset=utf-8",mtype:"GET",url:h.odataurl});if(h.annotations){a.extend(true,g,{loadBeforeSend:function(i){i.setRequestHeader("Prefer",'odata.include-annotations="*"')},jsonReader:{root:"value",repeatitems:false,records:function(i){return i[h.annotationName].records},page:function(i){return i[h.annotationName].page},total:function(i){return i[h.annotationName].total},userdata:function(i){return i[h.annotationName].userdata}}})}else{a.extend(true,g,{jsonReader:{root:"value",repeatitems:false,records:"odata.count",page:function(k){if(k["odata.nextLink"]!==undefined){var j=k["odata.nextLink"].split("skip=")[1];return Math.ceil(parseInt(j,10)/g.rowNum)}var i=k["odata.count"];return Math.ceil(parseInt(i,10)/g.rowNum)},total:function(j){var i=j["odata.count"];return Math.ceil(parseInt(i,10)/g.rowNum)},userdata:"userdata"}})}}function d(j,l,h){var k={$skip:(parseInt(h.page,10)-1)*j.rowNum,$format:l.datatype};if(l.datatype==="jsonp"){k.$callback=l.jsonpCallback}if(l.count){k.$count=true}if(l.top){k.$top=h.rows}if(l.inlinecount){k.$inlinecount="allpages"}if(h.sidx){k.$orderby=h.sidx+" "+h.sord}if(!h._search){return k}if(h.filters){var g=a.parseJSON(h.filters);var i=f(g,j);if(i.length>0){k.$filter=i}}else{k.$filter=c(j,h.searchField,h.searchString,h.searchOper)}return k}function c(m,l,h,k){var j,g;if(l&&(h||k==="nu"||k==="nn")){if(h){for(j=0;j<m.colModel.length;j++){g=m.colModel[j];if(g.name===l){if(g.odata===false){return}if(g.odataunformat){l=a.isFunction(g.odataunformat)?g.odataunformat(l,h,k):g.odataunformat;if(!l){return}}if(!g.searchrules||(!g.searchrules.integer&&!g.searchrules.date)){h="'"+h+"'"}else{if(g.searchrules&&g.searchrules.date){h=(new Date(h)).toISOString()}}break}}}switch(k){case"in":case"cn":return"substringof("+h+", "+l+") eq true";case"ni":case"nc":return"substringof("+h+", "+l+") eq false";case"bw":return"startswith("+l+", "+h+") eq true";case"bn":return"startswith("+l+", "+h+") eq false";case"ew":return"endswith("+l+", "+h+") eq true";case"en":return"endswith("+l+", "+h+") eq false";case"nu":return l+" eq null";case"nn":return l+" ne null";default:return l+" "+k+" "+h}}}function f(g,l){var h,k,m="",j;if(g.groups){if(g.groups.length){for(h=0;h<g.groups.length;h++){m+="("+f(g.groups[h],l)+")";if(h<g.groups.length-1){m+=" "+g.groupOp.toLowerCase()+" "}}if(g.rules&&g.rules.length){m+=" "+g.groupOp.toLowerCase()+" "}}}if(g.rules.length){for(h=0;h<g.rules.length;h++){k=g.rules[h];j=c(l,k.field,k.data,k.op);if(j){m+=j+" "+g.groupOp.toLowerCase()+" "}}}m=m.trim().replace(/.(and|or)$/,"").trim();return m}}})}(jQuery));