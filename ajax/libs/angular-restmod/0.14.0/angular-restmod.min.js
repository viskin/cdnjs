/**
 * API Bound Models for AngularJS
 * @version v0.14.0 - 2014-05-19
 * @link https://github.com/angular-platanus/restmod
 * @author Ignacio Baixas <iobaixas@gmai.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){"use strict";a.module("plRestmod",["ng","platanus.inflector"]);var c={chain:function(a,b){return a?function(c){return b.call(this,a.call(this,c))}:b},override:function(a,b){return a&&"function"==typeof b?function(){var c=this.$super;try{return this.$super=a,b.apply(this,arguments)}finally{this.$super=c}}:b},extendOverriden:function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=c.override(a[d],b[d]))}};a.module("plRestmod").constant("Utils",c);var d=a.bind,e=a.forEach,f=a.extend,g=a.isObject,h=a.isArray,i=a.isFunction,j=Array.prototype.slice,k="C",l="U",m="R",n="CU",o="CRU";a.module("plRestmod").provider("$restmod",function(){var a=[];return{pushModelBase:function(){return Array.prototype.push.apply(a,arguments),this},$get:["$http","$q","$injector","$parse","$filter","$inflector",function(p,q,r,s,t,u){var v={model:function(v){function w(a,b){var c,d,e,f;if(c=L[a])for(e=j.call(arguments,2),d=0;f=c[d];d++)f.apply(b,e);if(b.$cb&&(c=b.$cb[a]))for(e||(e=j.call(arguments,2)),d=0;f=c[d];d++)f.apply(b,e)}function x(a,b,c,d){function e(){return b.canceled?(a.$status="canceled",q.resolve(a)):(a.$response=null,a.$error=!1,w("before-request",a,b),p(b).then(function(d){return b.canceled?(a.$status="canceled",a):(a.$pending.splice(a.$pending.indexOf(b),1),0===a.$pending.length&&(a.$pending=null),a.$status="ok",a.$response=d,w("after-request",a,d),c&&c.call(a,d),a)},function(c){return b.canceled?(a.$status="canceled",a):(a.$pending.splice(a.$pending.indexOf(b),1),0===a.$pending.length&&(a.$pending=null),a.$status="error",a.$response=c,w("after-request-error",a,c),d&&d.call(a,c),q.reject(a))}))}a.$pending=a.$pending||[],a.$pending.push(b),a.$promise=a.$promise?a.$promise.then(e,e):e()}function y(a){a.$pending&&e(a.$pending,function(a){a.canceled=!0}),a.$promise=null}function z(a,c,d,e,f,g){var h,i,j,k,l,m,n,o=g||{};for(h in a)if(a.hasOwnProperty(h)&&"$"!==h[0]){if(i=f&&M?M(h):h,k=d+i,l=F[k],l&&-1!==l.indexOf(e))continue;if(n=a[h],m=f?J[k]:K[k]){if(n=m.call(c,n),n===b)continue}else"object"==typeof n&&n&&(f||"function"!=typeof n.toJSON)&&(n=A(n,c,k,e,f));j=!f&&N?N(i):i,o[j]=n}return o}function A(a,b,c,d,e){if(h(a)){var f,g,i,j=c+"[]",k=e?J[j]:K[j],l=[];for(f=0,g=a.length;g>f;f++)i=a[f],k?i=k.call(b,i):"object"==typeof i&&i&&(e||"function"!=typeof i.toJSON)&&(i=A(i,b,c,d,e)),l.push(i);return l}return z(a,b,c+".",d,e)}function B(a,b){return a&&b?(a+"").replace(/\/$/,"")+"/"+(b+"").replace(/(\/$|^\/)/g,""):null}function C(a,b){this.$scope=a,this.$pk=b,this.$type=C;for(var c,d=0;c=I[d];d++)this[c[0]]="function"==typeof c[1]?c[1].apply(this):c[1];w("after-init",this)}function D(a){for(var b=0,c=a.length;c>b;b++)E(a[b])}function E(a){a.$chain?D(a.$chain):"string"==typeof a?E(r.get(a)):h(a)||i(a)?r.invoke(a,Q,{$builder:Q}):Q.describe(a)}var F={},G=null,H="id",I=[],J={},K={},L={},M=u.camelize,N=function(a){return u.parameterize(a,"_")};C.$single=function(a){return new C({$urlFor:function(){return G?B(G,a):a}},"")},C.$anonymous=function(){return!v},C.$baseUrl=function(){return G?B(G,v):v},C.$inferKey=function(a){return a&&"undefined"!=typeof a[H]?a[H]:null},C.$$setMask=function(a,b){b?F[a]=b===!0?o:b:delete F[a]},C.$$registerHook=function(a,b){var c=L[a];return c||(c=L[a]=[]),c.push(b),this},C.prototype={$url:function(){return this.$scope.$urlFor(this.$pk)},$buildScope:function(a,b){if(!a.$buildOwnScope){var c=this;return{$collectionUrl:function(){return B(c.$url(),b)},$urlFor:function(b){return a.$anonymous()?this.$fetchUrlFor():a.$urlFor(b)},$fetchUrlFor:function(){return B(c.$url(),b)},$createUrlFor:function(){return null}}}},$extend:function(a){for(var b in a)a.hasOwnProperty(b)&&"$"!==b[0]&&(this[b]=a[b]);return this},$each:function(a,b){for(var c in this)this.hasOwnProperty(c)&&"$"!==c[0]&&a.call(b||this[c],this[c],c);return this},$callback:function(a){return w(a,this,j.call(arguments,1)),this},$on:function(a,b){var c=(this.$cb||(this.$cb={}))[a]||(this.$cb[a]=[]);return c.push(b),this},$send:function(a,b,c){return x(this,a,b,c),this},$then:function(a,b){return this.$promise=this.$promise.then(a,b),this},$finally:function(a){return this.$promise=this.$promise["finally"](a),this},$decode:function(a,b){return z(a,this,"",b||m,!0,this),this.$pk||(this.$pk=C.$inferKey(a)),w("after-feed",this,a),this},$encode:function(a){var b=z(this,this,"",a||k,!1);return w("before-render",this,b),b},$fetch:function(){var a=this.$scope.$fetchUrlFor?this.$scope.$fetchUrlFor(this.$pk):this.$url();if(!a)throw new Error("Cannot fetch an unbound resource");var b={method:"GET",url:a};return w("before-fetch",this,b),this.$send(b,function(a){var b=a.data;if(!b||h(b))throw new Error("Expected object while feeding resource");this.$decode(b),w("after-fetch",this,a)},function(a){w("after-fetch-error",this,a)})},$save:function(){var a,c=this.$scope.$updateUrlFor?this.$scope.$updateUrlFor(this.$pk):this.$url();if(c)return a={method:"PUT",url:c,data:this.$encode(k)},w("before-update",this,a),w("before-save",this,a),this.$send(a,function(a){var b=a.data;b&&!h(b)&&this.$decode(b),w("after-update",this,a),w("after-save",this,a)},function(a){w("after-update-error",this,a),w("after-save-error",this,a)});if(c=this.$scope.$createUrlFor?this.$scope.$createUrlFor(this.$pk):this.$scope.$url&&this.$scope.$url(),!c)throw new Error("Create is not supported by this resource");return a={method:"POST",url:c,data:this.$encode(l)},w("before-save",this,a),w("before-create",this,a),this.$send(a,function(a){var c=a.data;c&&!h(c)&&this.$decode(c),this.$scope.$isCollection&&this.$position===b&&!this.$preventReveal&&this.$scope.$add(this,this.$revealAt),w("after-create",this,a),w("after-save",this,a)},function(a){w("after-create-error",this,a),w("after-save-error",this,a)})},$destroy:function(){var a=this.$scope.$destroyUrlFor?this.$scope.$destroyUrlFor(this.$pk):this.$url();if(!a)throw new Error("Cannot destroy an unbound resource");var b={method:"DELETE",url:a};return w("before-destroy",this,b),this.$send(b,function(a){this.$scope.$remove&&this.$scope.$remove(this),w("after-destroy",this,a)},function(a){w("after-destroy-error",this,a)})},$moveTo:function(a){return this.$position!==b||(this.$revealAt=a),this},$reveal:function(a){return a===b||a?this.$scope.$add(this,this.$revealAt):this.$preventReveal=!0,this}};var O={$url:function(){return this.$scope?this.$scope.$collectionUrl():C.$baseUrl()},$urlFor:function(a){var b=C.$baseUrl();return B(b?b:this.$url(),a)},$callback:function(a){return w(a,this,j.call(arguments,1)),this},$on:function(a,b){var c=(this.$cb||(this.$cb={}))[a]||(this.$cb[a]=[]);return c.push(b),this},$new:function(a){return new C(this,a)},$build:function(a){return this.$new().$extend(a)},$buildRaw:function(a){var b=this.$new(C.$inferKey(a));return b.$decode(a),b},$find:function(a){return this.$new(a).$fetch()},$create:function(a){return this.$build(a).$save()},$collection:function(a,b){var c=[];for(var d in O)this.hasOwnProperty(d)&&(c[d]=this[d]);return c.$isCollection=!0,c.$scope=b||this.$scope,c.$params=this.$params?f({},this.$params,a):a,c.$resolved=!1,c},$search:function(a){return this.$collection(a).$fetch()},$then:function(a,b){if(!this.$isCollection)throw new Error("$then is only supported by collections");return this.$promise=this.$promise.then(a,b),this},$finally:function(a){return this.$promise=this.$promise["finally"](a),this},$feed:function(a){if(!this.$isCollection)throw new Error("$feed is only supported by collections");this.$resolved||(this.length=0);for(var b=0,c=a.length;c>b;b++)this.$buildRaw(a[b]).$reveal();return this.$resolved=!0,this},$reset:function(){if(!this.$isCollection)throw new Error("$reset is only supported by collections");return y(this),this.$resolved=!1,this},$fetch:function(a){if(!this.$isCollection)throw new Error("$fetch is only supported by collections");var b=a?f({},this.$params||{},a):this.$params,c={method:"GET",url:this.$url(),params:b};return w("before-fetch-many",this,c),x(this,c,function(a){var b=a.data;if(!b||!h(b))throw new Error("Error in resource {0} configuration. Expected response to be array");this.$feed(b),w("after-fetch-many",this,a)},function(a){w("after-fetch-many-error",this,a)}),this},$refresh:function(a){return this.$reset().$fetch(a)},$add:function(a,c){return this.$isCollection&&a.$position===b&&(c!==b?this.splice(c,0,a):this.push(a),a.$position=!0,w("after-add",this,a)),this},$remove:function(a){var c=this.$indexOf(a);return-1!==c&&(this.splice(c,1),a.$position=b,w("after-remove",this,a)),this},$indexOf:function(a){var b="function"==typeof a?a:!1;if(this.$isCollection)for(var c=0,d=this.length;d>c;c++)if(b?b(this[c]):this[c]===a)return c;return-1}},P={init:["attrDefault"],mask:["attrMask"],ignore:["attrMask"],decode:["attrDecoder","param","chain"],encode:["attrEncoder","param","chain"],serialize:["attrSerializer"],hasMany:["attrAsCollection","path","source","inverseOf"],hasOne:["attrAsResource","path","source","inverseOf"],belongsTo:["attrAsReference","inline","key","source","prefetch"]},Q={setHttpOptions:function(){},setUrlPrefix:function(a){return G=a,this},setPrimaryKey:function(a){return H=a,this},setNameDecoder:function(a){return M=a,this},setNameEncoder:function(a){return N=a,this},disableRenaming:function(){return this.setNameDecoder(!1).setNameEncoder(!1)},extend:function(a,b,d){return"string"==typeof a?(this[a]=c.override(this[name],b),d&&(P[d[0]]=d,d[0]=a)):c.extendOverriden(this,a),this},describe:function(a){return e(a,function(a,b){switch(b.charAt(0)){case"@":this.classDefine(b.substring(1),a);break;case"~":b=u.parameterize(b.substring(1)),this.on(b,a);break;default:g(a)?this.attribute(b,a):i(a)?this.define(b,a):this.attrDefault(b,a)}},this),this},attribute:function(a,b){var c,d,e,f;for(c in b)if(b.hasOwnProperty(c)&&(d=P[c])){for(e=[a,b[c]],f=1;f<d.length;f++)e.push(b[d[f]]);e.push(b),this[d[0]].apply(this,e)}return this},attrDefault:function(a,b){return I.push([a,b]),this},attrMask:function(a,b){return C.$$setMask(a,b),this},attrSerializer:function(a,b,c){return"string"==typeof b&&(b=r.get(u.camelize(b,!0)+"Serializer")),i(b)&&(b=b(c)),b.decode&&this.attrDecoder(a,d(b,b.decode)),b.encode&&this.attrEncoder(a,d(b,b.encode)),this},attrDecoder:function(a,b,d,e){if("string"==typeof b){var f=t(b);b=function(a){return f(a,d)}}return J[a]=e?c.chain(J[a],b):b,this},attrEncoder:function(a,b,d,e){if("string"==typeof b){var f=t(b);b=function(a){return f(a,d)}}return K[a]=e?c.chain(K[a],b):b,this},attrAsCollection:function(a,b,c,d,e){return this.attrDefault(a,function(){"string"==typeof b&&(b=r.get(b),e&&b.$$setMask(e,n));var d=this,f=this.$buildScope(b,c||u.parameterize(a)),g=b.$collection(null,f);return e&&g.$on("after-add",function(a){a[e]=d}),g}).attrDecoder(d||c||a,function(b){this[a].$reset().$feed(b)}).attrMask(a,n)},attrAsResource:function(a,b,c,d,e){return this.attrDefault(a,function(){"string"==typeof b&&(b=r.get(b),e&&b.$$setMask(e,n));var d=this.$buildScope(b,c||u.parameterize(a)),f=new b(d);return e&&(f[e]=this),f}).attrDecoder(d||c||a,function(b){this[a].$decode(b)}).attrMask(a,n)},attrAsReference:function(a,b,c,d,e,f){var g=c?e||a:d||a+"Id";this.attrDefault(a,null).attrMask(a,n).attrDecoder(g,function(d){"string"==typeof b&&(b=r.get(b)),c?this[a]&&this[a].$pk===b.$inferKey(d)?this[a].$decode(d):this[a]=b.$buildRaw(d):this[a]&&this[a].$pk===d||(this[a]=b.$new(d),f&&this[a].$fetch())})},define:function(a,b){return"string"==typeof a?C.prototype[a]=c.override(C.prototype[a],b):c.extendOverriden(C.prototype,a),this},classDefine:function(a,b){return"string"==typeof a?O[a]=c.override(O[a],b):c.extendOverriden(O,a),this},on:function(a,b){return C.$$registerHook(a,b),this},attrExpression:function(a,b){var c=s(b);this.on("after-feed",function(){this[a]=c(this)})}};return D(a),D(C.$chain=j.call(arguments,1)),f(C,O),C},mixin:function(){return{$isAbstract:!0,$chain:j.call(arguments,0)}},singleton:function(a){return v.model.apply(this,arguments).$single(a)}};return v}]}}).factory("model",["$restmod",function(a){return a.model}]).factory("mixin",["$restmod",function(a){return a.mixin}])}(angular);