window.perfBar=window.perfBar||{};(function(){perfBar.init=function(g){var h=require("./classList.js");var f=require("./templates/bar.hbs");document.body.innerHTML+=f();h();this.el=document.getElementById("perfBar");this.metricsContainer=this.el.querySelector(".perfBar-cf");this.disabledMetrics={};g=g||{};this.config=g;e();this.perf=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;if(g.lazy){this.__runner();return}window.onload=this.__runner};perfBar.__runner=function(){setTimeout(function(){if(perfBar.perf){perfBar.runPerfMetrics("perf")}perfBar.runPerfMetrics("others")},1000)};perfBar.metricTemplate=function(g){var h=require("./templates/stat.hbs");var f=g.budget;if(f&&Object.keys(f).length){a(g);if(f.max>=g.value||f.min<=g.value){g.isGood=true}if(f.max<=g.value||f.min>=g.value){g.isBad=true}}return h(g)};perfBar.metrics={};perfBar.addMetric=function(f){if(typeof f!=="object"){return new Error("metric is not an Object.")}if(!f.id){return new Error("Id can't be empty.")}if(!f.label){return new Error("Label can't be empty.")}if(!f.hasOwnProperty("value")){return new Error("Value can't be empty.")}if(this.disabledMetrics[f.id]){return}this.mergeBudget(f);var g=document.getElementById("perfBar-metric-"+f.id);if(this.metrics[f.id]&&g){g.outerHTML=this.metricTemplate(f);this.metrics[f.id]=f;return}this.metricsContainer.innerHTML+=this.metricTemplate(f);this.metrics[f.id]=f};perfBar.updateMetric=function(h,g){if(typeof g!=="object"){return new Error("update is not an Object.")}if(!Object.keys(g).length){return}if(!this.metrics[h]){g.id=h;return this.addMetric(g)}for(var f in g){if(!g.hasOwnProperty(f)){return}switch(f){case"value":this.metrics[h].value=g[f];break;case"label":this.metrics[h].label=g[f];break;case"unit":this.metrics[h].unit=g[f];break;case"budget":this.metrics[h].budget=g[f];break}}document.getElementById("perfBar-metric-"+h).outerHTML=this.metricTemplate(this.metrics[h])};perfBar.deleteMetric=function(f){if(!f||!this.metrics[f]){return}(document.getElementById("perfBar-metric-"+f)).remove();return delete this.metrics[f]};perfBar.enable=function(f){if(!f){return}if(!this.disabledMetrics[f]){return true}delete this.disabledMetrics[f];if(this.metrics[f]){this.addMetric(this.metrics[f])}return true};perfBar.disable=function(f){if(!f){return}if(this.disabledMetrics[f]){return true}this.disabledMetrics[f]=this.metrics[f];return(document.getElementById("perfBar-metric-"+f)).remove()};var b={perf:[],others:[]};perfBar.runPerfMetrics=function(g){for(var f=0;f<b[g].length;f++){b[g][f]()}delete b[g]};b.perf.push(function(){perfBar.addMetric({id:"loadTime",value:(perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart),unit:"ms",label:"Load Time",budget:{max:5000}})});b.perf.push(function(){perfBar.addMetric({id:"latency",value:(perfBar.perf.timing.responseStart-perfBar.perf.timing.connectStart),unit:"ms",label:"Latency",budget:{max:50}})});b.perf.push(function(){var f=Math.round((perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart)*0.8);perfBar.addMetric({id:"frontEnd",value:(perfBar.perf.timing.loadEventStart-perfBar.perf.timing.responseEnd),unit:"ms",label:"Front End",budget:{max:f}})});b.perf.push(function(){var f=Math.round((perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart)*0.2);perfBar.addMetric({id:"backEnd",value:(perfBar.perf.timing.responseEnd-perfBar.perf.timing.navigationStart),unit:"ms",label:"Back End",budget:{max:f}})});b.perf.push(function(){perfBar.addMetric({id:"respnseDuration",value:(perfBar.perf.timing.responseEnd-perfBar.perf.timing.responseStart),unit:"ms",label:"Response Duration"})});b.perf.push(function(){perfBar.addMetric({id:"requestDuration",value:(perfBar.perf.timing.responseStart-perfBar.perf.timing.requestStart),unit:"ms",label:"Request Duration"})});b.perf.push(function(){if(!perfBar.perf.navigation){return}perfBar.addMetric({id:"redirectCount",value:perfBar.perf.navigation.redirectCount,label:"Redirects"})});b.perf.push(function(){perfBar.addMetric({id:"loadEventTime",value:(perfBar.perf.timing.loadEventEnd-perfBar.perf.timing.loadEventStart),unit:"ms",label:"Load Event duration"})});b.perf.push(function(){perfBar.addMetric({id:"domContentLoaded",value:(perfBar.perf.timing.domContentLoadedEventStart-perfBar.perf.timing.domInteractive),unit:"ms",label:"DOM Content loaded"})});b.perf.push(function(){perfBar.addMetric({id:"processing",value:perfBar.perf.timing.loadEventStart-perfBar.perf.timing.domLoading,unit:"ms",label:"Processing Duration"})});b.others.push(function(){perfBar.addMetric({id:"numOfEl",value:document.documentElement.querySelectorAll("*").length,label:"DOM elements"})});b.others.push(function(){perfBar.addMetric({id:"cssCount",value:document.querySelectorAll('link[rel="stylesheet"]').length,label:"CSS"})});b.others.push(function(){perfBar.addMetric({id:"jsCount",value:document.querySelectorAll("script").length,label:"JavaScript"})});b.others.push(function(){perfBar.addMetric({id:"imgCount",value:document.querySelectorAll("img").length,label:"Images"})});b.others.push(function(){var h=0;var f=document.querySelectorAll("img[src]");for(var g=0;g<f.length;g++){if(f[g].src.match(/^data:+/)){h++}}perfBar.addMetric({id:"dataURIImagesCount",value:h,label:"Data URI images"})});b.others.push(function(){perfBar.addMetric({id:"inlineCSSCount",value:document.querySelectorAll("style").length,label:"Inline CSS"})});b.others.push(function(){var h=document.querySelectorAll("script");var g=0;for(var f=0;f<h.length;f++){if(!h[f].src){g++}}perfBar.addMetric({id:"inlineJSCount",value:g,label:"Inline JavaScript"})});b.others.push(function(){var h=document.querySelectorAll('link[rel="stylesheet"]');var f=[];for(var g=0;g<h.length;g++){f.push(h[g].href)}var j=c(f);perfBar.addMetric({id:"thirdCSS",value:j,label:"3rd Party CSS"})});b.others.push(function(){var j=document.querySelectorAll("script[src]");var f=[];for(var g=0;g<j.length;g++){f.push(j[g].src)}var h=c(f);perfBar.addMetric({id:"thirdJS",value:h,label:"3rd Party JavaScript"})});b.others.push(function(){var f=d();perfBar.addMetric({id:"globalJS",value:f,label:"JavaScript Globals"})});perfBar.mergeBudget=function(g){if(!this.config.budget){return}if(!this.config.budget[g.id]){return}var f=this.config.budget;if(!g.budget||typeof g.budget!="object"){g.budget=f[g.id];return}if(f[g.id].max){g.budget.max=f[g.id].max}if(f[g.id].min){g.budget.min=f[g.id].min}};function a(h){var f=h.budget;var g="Min Value is ";var i="Max Value is ";var j=h.unit||"";var k=[];if(f.hasOwnProperty("min")){k.push(g+f.min+j+".")}if(f.hasOwnProperty("max")){k.push(i+f.max+j+".")}h.hint=k.join(" ")}function d(){var k={},g,j={},f,h=document.createElement("iframe");for(f in window){k[f]={type:typeof window[f],val:window[f]}}h.style.display="none";document.body.appendChild(h);h.src="about:blank";h=h.contentWindow||h.contentDocument;for(f in k){if(typeof h[f]!="undefined"){delete k[f]}else{if(j[k[f].type]){delete k[f]}}}g="addEventListener,document,location,navigator,window,perfBar".split(",");f=g.length;while(--f){delete k[g[f]]}return Object.keys(k).length}function c(h){var g=document.createElement("a");var f=0;for(var j=0;j<h.length;j++){g.href=h[j];if(g.hostname!=window.location.hostname){f++}}return f}function e(){perfBar.el.querySelector(".perfBar-bar").addEventListener("click",function(f){perfBar.el.classList.toggle("perfBar-is-active")})}})();