window.perfBar=window.perfBar||{};(function(){perfBar.init=function(A){var B=require("./classList.js");var z=require("./templates/bar.hbs");document.body.innerHTML+=z();B();this.el=document.getElementById("perfBar");this.metricsContainer=this.el.querySelector(".perfBar-cf");this.disabledMetrics={};A=A||{};this.config=A;c();this.perf=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;if(A.lazy){this.__runner();return}window.onload=this.__runner};perfBar.__runner=function(){setTimeout(function(){if(perfBar.perf){perfBar.runPerfMetrics("perf")}perfBar.runPerfMetrics("others")},1000)};perfBar.metricTemplate=function(A){var B=require("./templates/stat.hbs");var z=A.budget;if(z&&Object.keys(z).length){v(A);if(z.max>=A.value||z.min<=A.value){A.isGood=true}if(z.max<=A.value||z.min>=A.value){A.isBad=true}}return B(A)};perfBar.metrics={};perfBar.addMetric=function(z){if(typeof z!=="object"){return new Error("metric is not an Object.")}if(!z.id){return new Error("Id can't be empty.")}if(!z.label){return new Error("Label can't be empty.")}if(!z.hasOwnProperty("value")){return new Error("Value can't be empty.")}if(this.disabledMetrics[z.id]){return}this.mergeBudget(z);var A=document.getElementById("perfBar-metric-"+z.id);if(this.metrics[z.id]&&A){A.outerHTML=this.metricTemplate(z);this.metrics[z.id]=z;return}this.metricsContainer.innerHTML+=this.metricTemplate(z);this.metrics[z.id]=z};perfBar.updateMetric=function(B,A){if(typeof A!=="object"){return new Error("update is not an Object.")}if(!Object.keys(A).length){return}if(!this.metrics[B]){A.id=B;return this.addMetric(A)}for(var z in A){if(!A.hasOwnProperty(z)){return}switch(z){case"value":this.metrics[B].value=A[z];break;case"label":this.metrics[B].label=A[z];break;case"unit":this.metrics[B].unit=A[z];break;case"budget":this.metrics[B].budget=A[z];break}}document.getElementById("perfBar-metric-"+B).outerHTML=this.metricTemplate(this.metrics[B])};perfBar.deleteMetric=function(z){if(!z||!this.metrics[z]){return}(document.getElementById("perfBar-metric-"+z)).remove();return delete this.metrics[z]};perfBar.enable=function(z){if(!z){return}if(!this.disabledMetrics[z]){return true}delete this.disabledMetrics[z];if(this.metrics[z]){this.addMetric(this.metrics[z])}return true};perfBar.disable=function(z){if(!z){return}if(this.disabledMetrics[z]){return true}this.disabledMetrics[z]=this.metrics[z];return(document.getElementById("perfBar-metric-"+z)).remove()};var u={perf:[],others:[]};perfBar.runPerfMetrics=function(A){for(var z=0;z<u[A].length;z++){u[A][z]()}delete u[A]};u.perf.push(function p(){perfBar.addMetric({id:"loadTime",value:(perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart),unit:"ms",label:"Load Time",budget:{max:5000}})});u.perf.push(function t(){perfBar.addMetric({id:"latency",value:(perfBar.perf.timing.responseStart-perfBar.perf.timing.connectStart),unit:"ms",label:"Latency",budget:{max:50}})});u.perf.push(function j(){var A=0;var z=0;if(window.chrome&&window.chrome.loadTimes){A=window.chrome.loadTimes().firstPaintTime*1000;z=A-(window.chrome.loadTimes().startLoadTime*1000)}else{if(typeof window.performance.timing.msFirstPaint==="number"){A=window.performance.timing.msFirstPaint;z=A-window.performance.timing.navigationStart}}if(!z){return}perfBar.addMetric({id:"FirstPaint",value:Math.round(z),unit:"ms",label:"First Paint",budget:{max:100}})});u.perf.push(function o(){var z=Math.round((perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart)*0.8);perfBar.addMetric({id:"frontEnd",value:(perfBar.perf.timing.loadEventStart-perfBar.perf.timing.responseEnd),unit:"ms",label:"Front End",budget:{max:z}})});u.perf.push(function g(){var z=Math.round((perfBar.perf.timing.loadEventStart-perfBar.perf.timing.navigationStart)*0.2);perfBar.addMetric({id:"backEnd",value:(perfBar.perf.timing.responseEnd-perfBar.perf.timing.navigationStart),unit:"ms",label:"Back End",budget:{max:z}})});u.perf.push(function h(){perfBar.addMetric({id:"respnseDuration",value:(perfBar.perf.timing.responseEnd-perfBar.perf.timing.responseStart),unit:"ms",label:"Response Duration"})});u.perf.push(function i(){perfBar.addMetric({id:"requestDuration",value:(perfBar.perf.timing.responseStart-perfBar.perf.timing.requestStart),unit:"ms",label:"Request Duration"})});u.perf.push(function w(){if(!perfBar.perf.navigation){return}perfBar.addMetric({id:"redirectCount",value:perfBar.perf.navigation.redirectCount,label:"Redirects"})});u.perf.push(function l(){perfBar.addMetric({id:"loadEventTime",value:(perfBar.perf.timing.loadEventEnd-perfBar.perf.timing.loadEventStart),unit:"ms",label:"Load Event duration"})});u.perf.push(function r(){perfBar.addMetric({id:"domContentLoaded",value:(perfBar.perf.timing.domContentLoadedEventStart-perfBar.perf.timing.domInteractive),unit:"ms",label:"DOM Content loaded"})});u.perf.push(function m(){perfBar.addMetric({id:"processing",value:perfBar.perf.timing.loadEventStart-perfBar.perf.timing.domLoading,unit:"ms",label:"Processing Duration"})});u.others.push(function s(){perfBar.addMetric({id:"numOfEl",value:document.documentElement.querySelectorAll("*").length,label:"DOM elements"})});u.others.push(function y(){perfBar.addMetric({id:"cssCount",value:document.querySelectorAll('link[rel="stylesheet"]').length,label:"CSS"})});u.others.push(function b(){perfBar.addMetric({id:"jsCount",value:document.querySelectorAll("script").length,label:"JavaScript"})});u.others.push(function f(){perfBar.addMetric({id:"imgCount",value:document.querySelectorAll("img").length,label:"Images"})});u.others.push(function n(){var B=0;var z=document.querySelectorAll("img[src]");for(var A=0;A<z.length;A++){if(z[A].src.match(/^data:+/)){B++}}perfBar.addMetric({id:"dataURIImagesCount",value:B,label:"Data URI images"})});u.others.push(function e(){perfBar.addMetric({id:"inlineCSSCount",value:document.querySelectorAll("style").length,label:"Inline CSS"})});u.others.push(function a(){var B=document.querySelectorAll("script");var A=0;for(var z=0;z<B.length;z++){if(!B[z].src){A++}}perfBar.addMetric({id:"inlineJSCount",value:A,label:"Inline JavaScript"})});u.others.push(function q(){var B=document.querySelectorAll('link[rel="stylesheet"]');var z=[];for(var A=0;A<B.length;A++){z.push(B[A].href)}var C=k(z);perfBar.addMetric({id:"thirdCSS",value:C,label:"3rd Party CSS"})});u.others.push(function q(){var C=document.querySelectorAll("script[src]");var z=[];for(var A=0;A<C.length;A++){z.push(C[A].src)}var B=k(z);perfBar.addMetric({id:"thirdJS",value:B,label:"3rd Party JavaScript"})});u.others.push(function x(){var z=d();perfBar.addMetric({id:"globalJS",value:z,label:"JavaScript Globals"})});perfBar.mergeBudget=function(A){if(!this.config.budget){return}if(!this.config.budget[A.id]){return}var z=this.config.budget;if(!A.budget||typeof A.budget!="object"){A.budget=z[A.id];return}if(z[A.id].max){A.budget.max=z[A.id].max}if(z[A.id].min){A.budget.min=z[A.id].min}};function v(B){var z=B.budget;var A="Min Value is ";var C="Max Value is ";var D=B.unit||"";var E=[];if(z.hasOwnProperty("min")){E.push(A+z.min+D+".")}if(z.hasOwnProperty("max")){E.push(C+z.max+D+".")}B.hint=E.join(" ")}function d(){var D={},A,C={},z,B=document.createElement("iframe");for(z in window){D[z]={type:typeof window[z],val:window[z]}}B.style.display="none";document.body.appendChild(B);B.src="about:blank";B=B.contentWindow||B.contentDocument;for(z in D){if(typeof B[z]!="undefined"){delete D[z]}else{if(C[D[z].type]){delete D[z]}}}A="addEventListener,document,location,navigator,window,perfBar".split(",");z=A.length;while(--z){delete D[A[z]]}return Object.keys(D).length}function k(B){var A=document.createElement("a");var z=0;for(var C=0;C<B.length;C++){A.href=B[C];if(A.hostname!=window.location.hostname){z++}}return z}function c(){perfBar.el.querySelector(".perfBar-bar").addEventListener("click",function(z){perfBar.el.classList.toggle("perfBar-is-active")})}})();