/* jQuery.my 1.1.3
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */

!function(e){function t(e,t){return(t||"").split(".").reduce(function(e,t){return null!=e&&null!=e[t]?e[t]:void 0},e)}function r(e,r){var n,i;if(V(r))return r;if(W(r)){if(n=t(e,r),null==n&&(n=Object.clone(N._src[r],!0)),null==n&&(n=t(N,r),V(n)&&V(n._self)?n=Object.clone(n._self,!0):V(n)&&(n=Object.clone(n,!0))),null==n&&t(e,"params.cache")&&(i=t(e,"params.cache"),Y(i)?n=i(r):V(i)&&(n=X(r,i)),V(n)&&(V(n._self)&&(n=Object.clone(n._self,!0)),Object.merge(n,{params:{cache:i}},!0))),null!=n&&V(n))return i=i||t(e,"params.cache"),i&&Object.merge(n,{params:{cache:i}},!0),n;throw"Component "+r+" not found"}return Y(r)?r.apply(e,Array.prototype.slice.call(arguments,2)):null}function n(r,n){var i,o,s,l,c,u=n||N,d=r;if(!(V(u)&&V(d)&&V(d.ui)&&W(d.id)))return"Invalid arguments.";u.hasOwnProperty("_src")||(u._src={}),s=d.id;try{d=Object.clone(r,!0)}catch(f){return"Can’t mount circular-referencing obj."}try{(!d.params||d.params&&!d.params.strict)&&x(d,!0)}catch(f){return"Invalid manifest, parse error."}if(i=a(d),W(i))return rt.con(i),i;if(Object.merge(d,{params:{strict:!0}},!0),u._src[s]=d,l=rt.mask(u,s)){if(l.params&&l.params.protect)return"Can’t mount on protected.";l._self&&delete l._self,e.extend(!0,u,rt.unmask("",s))}return e.extend(!0,u,rt.unmask(d,s)),o=Object.keys(u._src).filter(function(e){return e.startsWith(s+".")}),o.sort(),o.forEach(function(t){var r;(r=rt.mask(u,t))&&(r._self&&delete r._self,e.extend(!0,u,rt.unmask("",t))),e.extend(!0,u,rt.unmask(u._src[t],t))}),c=t(u,s),_?c._self=u._src[s]:Object.defineProperty(c,"_self",{get:function(){return u._src[s]},set:function(){throw"Can not change repo."},enumerable:!1,configurable:!0}),c}function a(e){var t,r,n=[];if(V(e.files)&&Object.size(e.files))for(t in e.files)if(r=e.files[t],V(r)&&r.data&&!r.url)if(D)try{rt.base642blob(r.data,function(e){r.blob=e,r.url=D.createObjectURL(r.blob)},r.content_type||r.mime),n.push(t)}catch(i){return"Invalid base64 data in files/"+t+"."}else r.url="data:"+(r.content_type||r.mime)+";base64,"+r.data,n.push(t);return n}function o(t,r){V(r)&&r.channel&&r.message&&t.find(".my-listen-"+rt.sdbmCode(r.channel)).each(function(){var t,n=e(this),i=n.data("my"),a=void 0;if(i&&i.ui.listen&&Y(i.ui.listen[r.channel])){t=i.ui.listen[r.channel];try{a=t.call(i.manifest||i.root.my().manifest,i.data,r.message,n)}catch(o){rt.con("Listener failed: "+o.message,o.stack)}void 0!==a&&(null===a?n.trigger("check"):a&&n.trigger("recalc"))}})}function s(r,n){function i(t,r){var n;return W(t)?/[\/]/.test(t)?(n=T(!0,{},k,{ref:r,ajax:{url:t}}),J.test(r)&&(n.ajax.dataType="json")):t.length&&(n=T(!0,{},k,{ref:r,ajax:t})):V(t)&&(n=T(!0,{},k,{ref:r,ajax:e.extend(!0,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username","headers"]))}),n.ajax.url||(n=null)),n}function a(){g.reject(w)}function o(){O+=1;var e=b[O];if(e)s(e).then(o).fail(a);else{var t=c(x),n=Object.keys(Object.findAll(t,function(e,t){return!t}));n.length&&w.push((1===n.length?"Key "+n[0]+" is":"Keys "+n.join(", ")+" are")+" not present after all."),w.length?a():g.resolve(r)}}function s(t){function n(){c-=1,s?l.reject():.5>c&&l.resolve()}var i,a,o,s=!1,l=e.Deferred(),c=t.length;for(a=0;c>a;a++)i=t[a],o=W(i.ajax)?j.loader:et,o(i.ajax).then(function(e,t){J.test(t.ref)&&(null!=e?T(!0,r,rt.unmask(e,t.ref.from(5))):(s=!0,w.push("Invalid data for ‘"+t.ref+"’ resource."))),n()}.fill(void 0,i)).fail(function(e,t){w.push("Failed to load ‘"+t.ref+"’ resource."),s=!0,n()}.fill(void 0,i));return l.promise()}function l(e){var n=!1;return J.test(e)?null!=t(r,e.from(5))&&(n=!0):null!=t(window,e)&&(n=!0),n}function c(e){for(var t in e)e[t]===!1&&(e[t]=l(t));return e}var u,d,f,m,h,p,y,v,g=e.Deferred(),b=[],x={},w=[],j=T(!0,{ajaxTimeout:1e4,loader:tt.params.loader},n||{}),k={ref:null,ajax:{type:"GET",async:!0,timeout:j.ajaxTimeout}};if(V(r))if(B(r.require)){for(m=r.require,u=0;u<m.length;u++)if(h=m[u],W(h))x[h]=l(h);else if(V(h)){v=[];for(d in h){if(p=null,h[d]===!0)x[d]=l(d);else if(W(h[d])||V(h[d]))p=i(h[d],d);else if(B(h[d])){for(p=[],f=0;f<h[d].length;f++)(W(h[d][f])||V(h[d][f]))&&(y=i(h[d][f],d),y&&p.push(y));p.length||(p=null)}p&&!(x[d]=l(d))&&v.add(p)}v.length&&b.push(v)}var O=-1;o()}else g.resolve(r);else g.reject(["Invalid manifest."]);return g.promise()}function l(e,t){var r,n,i=e.data("myval");return i||(n=c(e,tt.vals),Y(n)&&(r=n(e,E),void 0===r?e.data("myval",function(e,t){return E!=t&&n(e,t),e.val()}.fill(e,void 0)):e.data("myval",n.fill(e,void 0))),i=e.data("myval")),Y(i)?(r=i(),(r!==t&&(0==t||0==r)||r!=t||V(t))&&(r=i(t)),r):E}function c(e,t){function r(e,t,o){for(var s in t)if(""!=s&&e.is(s)){a=a+(a?" ### ":"")+s;var l=t[s],c=M(l);if(!/^(nul|un|ob)/.test(c)&&o>i)return n=l,void(i=o);c==P&&r(e,l,o+1)}E!=t[""]&&typeof t[""]!=P&&o>i&&(n=t[""],i=o)}var n=E,i=0,a="";return r(e,t,1),n}function u(e,t,r,n){var i,a,o,s=[],l=r.bind,c=M(l);if(c==A)return l.call(f(n).manifest,e,t,n);if(c===L||c===F){if(c===L&&!/\./.test(l))return t!=E?e[l]=t:void 0===e[l]&&(e[l]=E),e[l];for(c===L&&(s=l.split(".").each(function(e,t){this[t]=e+""})),c===F&&(s=l.slice(0).each(function(e,t){this[t]=e+""})),"this"===s[0]?(a=f(n).manifest,s.shift()):a=e,i=0;i<s.length;i++){if(i===s.length-1)return t!=E?a[s[i]]=t:void 0===a[s[i]]&&(a[s[i]]=E),a[s[i]];0==i?(o=a,a=a[s[0]]):(o=o[s[i-1]],a=a[s[i]]),void 0===a&&(a=o[s[i]]={})}}return E}function d(t,r,n,i){var a,o,s=n.check;if(s!=E){var l=f(i).params.messages,c=n.error,u=c||l.patternMismatch||l[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var d=i[0].validationMessage+"";if(""!==d)return d.substr(0,1).toUpperCase()+d.substr(1);o=i[0].validity;for(a in o)""===d&&"valid"!=a&&Q(o[a])&&o[a]&&l[a]&&(d=l[a]);return d||c}switch(M(s).to(1)){case"f":return h=s.call(f(i).manifest,t,r,i),null===h||void 0===h?"":h;case"r":return s.test(String(r))?"":u;case"a":return s.indexOf(r)>-1?"":u;case"s":return r==s?"":u;case"o":return s[r]?"":u;case"b":if(i.is(".my-form-list,.ui-sortable")){var m=i.data("listSrc")||i.data("my").listSrc||">*",h={};return i.find(m).filter("*:not(.ui-sortable-placeholder)").each(function(t){var r=e(this);r.data("my")&&!r.my("valid")&&(h[t]=r.my("errors"))}),h}return i.hasClass("my-form")&&s?i.my("valid")?"":i.my("errors"):""}return l.formError||"Error"}return""}function f(e){var t=e.my();return t?t.root?t.root.my():t:null}function m(t,r,n){var i=n.compact(),a=i.replace(/:disabled/g,""),o=a!==i,s="self:"===a.to(5);return s&&(a=a.replace(/^self:/g,"")),r.each(function(){var n=e(this),i=n.my(),l=!s&&i?i.container:n;l.toggleClass(a,!!t),o&&void 0!==i&&!!t!=!!i.disabled&&(n.my().disabled=!!t,i._disable||(n.my()._disable=c(r,tt.offon).fill(void 0,r)),i._disable(!!t))}),r}function h(e,t,r){var n,i,a,o,s,c,f,p,y,v,g,b=!1,x=!1,w=e,j=w.my(),k="";if(j){if(p=j.selector,y=j.root,y.hasClass("my-form-init"))return{};if(v=y.find(p),g=y.my().ui,b=e.hasClass("my-form"),x=e.hasClass("my-form-list"),b?(n=e,i=j.ddata,a=j.dui,o=j.dparams):(n=j.container,i=j.data,a=j.ui,o=j.params),a.bind!=E){if(s=$(t)?t:l(v,u(i,E,a,v)),E!=a.check){k="Unknown error";try{k=d(i,s,a,v)}catch(O){rt.con("Error "+O.message+" validating "+p,y,O.stack)}}var C=o.errorCss,q="ui-state-error";try{E!=t&&(s=l(v,u(i,t,a,v)))}catch(O){k=o.messages.formError||"Error"}if(""===k)b?j.derrors[p]="":j.errors[p]="",n.removeClass(C),n.attr("title")&&n.attr("title",""),b||x||o.effect(n.find(o.errorTip),!1,o.animate/2),w.removeClass(q),w.find(".ui-widget").removeClass(q);else{if(b)j.derrors[p]=k;else if(x)j.errors[p]=k;else{n.addClass(C),j.errors[p]=k;var z=n.find(o.errorTip).eq(0);z.size()?o.effect(z.addClass(C).html(k),!0,o.animate):n.attr("title",(k||"").stripTags())}w.is(".hasDatepicker")&&(w.is("input")?w.addClass(q):w.find(".ui-widget").addClass(q)),w.is(".ui-slider")&&w.addClass(q)}}var D=t==E?s:t;if(a.css)for(c in a.css)f=a.css[c],K(f)?m(f.test(D),v,c):Y(f)&&m(f.call(y.my().manifest,i,D,v),v,c);var _,N,S=a.recalc,M=[],R={};if(r&&a.recalc&&y.my()){for(g=y.my().ui,_=0;_<S.length;_++)S[_]&&W(S[_])&&(N=S[_].compact())&&g[N]&&(g[N].recalc?-1===M.indexOf(N)&&M.push(N):R[N]=!0);for(_=0;_<M.length;_++)R=T(!0,R,h(y.find(M[_]),E,r-1));if(t!==E){for(_ in R)R[_]===!0&&_!=p&&(g[_].delay&&!g[_].recalc?g[_]._update(y.find(_),E,r-1):h(y.find(_),E,r-1));return{}}}return R||{}}}function p(e,t,r,n){var i,a,o,s,l,c,u,d,f,m=t;if(!V(m)||isNaN(s=m.remember)||!V(i=m.history))return E;if(V(e)&&s){if(c=Object.clone(e,!0),u=Date.now(),o=Object.keys(i).sort(),o.length&&(u-o.last()<m.historyDelay||Object.equal(i[o.last()],c)))return E;if(m.history[u]=c,o.push(u),o.length>=2*s){for(f={},a=s;2*s>a;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(H),m.history[o.last()]}if(!isNaN(e)||e===E){if(l=parseInt(e)||0,0>l)return E;if(o=Object.keys(i).sort(),l>=o.length&&(l=o.length-1),d=Object.clone(m.history[o[o.length-l-1]],!0),r){for(f={},a=0;a<o.length-l-1;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(H),d}return n||m.form.trigger(H),E}function y(n,i,a,o){function s(){var i=null,a=j.manifest;if(Y(a)||V(a)&&V(a.ui)?p=a:W(a)&&(p=r(C,a.replace(J,""))),p&&W(j.bind)){var s=t(J.test(j.bind)?C:x.data,j.bind.replace(J,""));if(null===k&&(k=e.Deferred()),B(s)||j.list){n.addClass("my-form-list");var c="",f=">*";if(/^<.+>$/.test(j.list)?c=j.list:f=j.list||f,!c){var m=n.find(f);c="<div></div>",m.size()&&(c=e(c).append(m.eq(0).clone(!0)).html(),m.eq(0).remove())}n.data("formlist")||n.data("formlist",{}),n.data("formlist").generator={manifest:p,delay:(j.delay||w.delay||10)/1.3,template:c,selector:f,parent:C,bind:j.bind,hash:Y(j.hash)?j.hash.bind(C):u(j.hash),id:Y(j.id)?j.id.bind(C):u(j.id),ext:!(!j.id&&!j.hash),stamp:0},n.on("insert.my",function(t,r){t.stopPropagation();var n={what:void 0,where:0};null==r?n.where=1e6:V(r)?Object.merge(n,r):(W(r)||G(r))&&(n.where=r),e(t.target).my("insert",n.where,n.what)}),n.on("remove.my",function(t){t.stopPropagation(),e(t.target).my("remove")})}else try{i=n.my(r(C,p),V(s)?s:void 0)}catch(h){l("$.my subform init of "+o+" failed: "+h.message,h.stack)}}Z(i)?i.then(d,function(e,t){l("Init of subform "+o+" failed with error: "+e,t)}):d()}function l(e,t){rt.con(e,t),k&&k.reject(e,t)}function u(e){var r=M(e).to(3);return e?"str"===r?t.fill(void 0,e):"arr"===r?rt.mask.fill(void 0,e):null:null}function d(){n.each(function(){var t,r,s=e(this),l=!1,u=s[0].nextSibling;if(r=u&&u.CodeMirror?u.CodeMirror:null,r&&s.addClass("my-codemirror"),t=j.events||c(s,tt.events),s.is(".my-form")?T(s.data("my"),{dui:j,root:i,selector:o,dparams:w,devents:t,ddata:x.data,container:w.container(s),derrors:x.errors}):(s.data("my",{events:t,selector:o,initial:m,previous:m,root:i,container:w.container(s),id:x.id,ui:j,data:x.data,params:w,errors:x.errors}),a._update=j.delay?h.debounce(j.delay):E,l=!0),l)if(s.cleditor&&s.parent().is(".cleditorMain")){var d=s.cleditor()[0];if(d&&d.$frame&&d.$frame[0]){s.addClass("my-cleditor"),T(s.data("my"),{container:w.container(s)});var f,p=function(e){s.val(e).trigger(H)},b=Number.random(1e5,1e6-1);e(d.$frame[0]).attr("id","cleditCool"+b),f=document.frames?document.frames["cleditCool"+b].document:e("#cleditCool"+b)[0].contentWindow.document;var k=e(f).find("body");e(f).bind("keyup.my",function(){p(e(this).find("body").html())}),s.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){p(k.html())}),e("body").on("click","div.cleditorPopup",function(){p(k.html())})}}else if(s.is("div.redactor_box textarea")){var O,C="my-redactor-9";try{O=s.getEditor(),C="my-redactor-8"}catch(q){O=s.redactor("getEditor")}O&&(s.addClass(C),O.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(s)))}else s.is(".ace_editor")?ace.edit(n[0]).on(H,function(e){e.trigger("ace")}.fill(s)):r&&r.on(H,function(e){e.trigger("codemirror")}.fill(s));s.my()._changed=v.debounce(y),s.my()._recalc=g.debounce(y),s.bind(t,function(e){e.type==H&&e.stopPropagation(),l&&(x.locktill=Date.now()+a.delay),s.my()._changed(s,i,a,w)}),/check(\.my)?/.test(t+"")||s.on("check.my",function(){return s.my()._changed(s,i,a,w,!0),!1}),s.on("recalc.my, redraw.my",function(e){e.stopPropagation(),s.my()._recalc(s,i,a,w)})}),k&&k.resolve()}var f,m,p,y,x=i.my(),w=(x||{}).params,j=a,k=null,O=0,C=x.manifest;return x?(y=a.delay,n.size()?(j.init!=E&&(f=b(C,j.init,n,x)),Z(f)?(O+=1,k=e.Deferred(),f.then(s,function(e,t){l("Init of "+o+" failed: "+e,t)})):s()):rt.con("Not found "+o+" selector.",i),k):(rt.con("Failed to find $root building "+o+" selector."),null)}function v(e,t,r,n,i){var a=e.data("my"),o=t.data("my");if(a&&!a.disabled){p(a.ddata||a.data,a.dparams||a.params);var s=t.find(a.selector);h(e,i?E:l(s,E),r.recalcDepth||n.recalcDepth),void 0===o.orphan&&a.root.parent().hasClass("ui-sortable")&&(o.orphan=!a.root.parent().hasClass("my-form-list")),o.orphan&&a.root.parent().trigger("check"),n.change&&n.change.call(e)}}function g(e,r,n,i){var a=e.my();if(a&&!a.disabled){var o=r.find(a.selector);o.is(".my-form")?o.my("redraw"):h(e,o.is(".my-form-list")?t(o.my().data,o.data("formlist").generator.bind):E,n.recalcDepth||i.recalcDepth)}}function b(e,r,n,i){var a;if(W(r)){if(a=t(e,r),void 0===a)return n.html(r.assign(i.data)),null}else a=r;if(Y(a))return a.apply(e,Array.prototype.slice.call(arguments,2));if(B(a))try{n.formgen(a)}catch(o){}return null}function x(e,t){var r,n="",i="",a=!t,o=[];for(n in e)if(e.hasOwnProperty(n)&&(a||!/^(data|files|require)$/.test(n)))if(r=e[n],i=M(r),/^(ob|ar)/.test(i))x(r);else if("string"===i&&/^(function\s*\(|new\sRegExp)/.test(r))if(o=r.match(/^function\s*\(([^\)]*)\)\s*\{([\s\S]*)\}[\s\n\r\t]*$/)){if(3===o.length)try{e[n]=Function(o[1],o[2])}catch(s){console.log(s.message,s.stack,r)}}else if((o=r.match(/^new\sRegExp\s*\(\/([\s\S]+)\/([a-z]*)\)$/))&&3===o.length)try{e[n]=RegExp(o[1],o[2])}catch(s){console.log(s.message,s.stack,r)}o=null}function w(e,r,n){var i=V(r)?r:null;return Object.each(e,function(t,r){var n=typeof r;/^str|^fu/.test(n)&&(e[t]={bind:r})}),Object.each(e,function(r,a){var o,s,l,c=[],u=[],d=/\s?[,;]\s?/;a.recalc&&(W(a.recalc)?c=a.recalc.split(d):B(a.recalc)&&(c=a.recalc),c=c.compact(!0).unique()),c.length&&(e[r].recalc=c),null==a.bind&&(a.bind=function(){});var f;if(a.listen&&(f=j(a.listen),a.listen=Object.size(f)?f:void 0),a.watch)for(W(a.watch)?u=a.watch.split(d):B(a.watch)&&(u=a.watch.slice(0)),u=u.compact(!0).unique(),l=0;l<u.length;l++)(o=e[u[l]])&&(s=o.recalc,s?W(s)?o.recalc+=","+r:B(s)&&-1==s.indexOf(r)&&o.recalc.push(r):o.recalc=[r]);null!==i&&["css","check","manifest","list","hash","id"].each(function(e){if(W(a[e])){var r=t(i,a[e].replace(J,""));null!=r&&(a[e]=r)}}),a.delay=isNaN(a.delay)?n.delay:a.delay-0}),e}function j(e){var t,r={},n=function(){return null};if(W(e))e.split(/[,\s]+/).compact(!0).unique().map(function(e){r[e]=n});else if(B(e))e.compact(!0).unique().map(function(e){r[e]=n});else if(V(e))for(t in e)r[t]=Y(e[t])?e[t]:function(){return e[t]};return r}function k(e){var t=e,r={};if(W(t)&&(t=t.split(/[,\s]+/)),B(t)){for(t=t.compact(!0),i=0;i<t.length;i++)r[t[i]]=!0;return r}return V(t)?e:null}function O(e,t){function r(i,a,o,s){var l,c,u,d,f=i;if(W(f)&&(/[\r\n]/.test(f)||f.split("}",3).length>2?f=rt.css2json(f):o.push(a+(/\{/.test(f)?f:"{"+f+"}"))),B(f)&&f.length)for(l=0;l<f.length;l++)r(f[l],a,o,s);else if(V(f))for(l in f)for(d=n(a,l),c=0;c<d.length;c++)r(f[l],d[c],o,s);else if(Y(f))try{u=f.call(t,e,t),r(u,a,s,s)}catch(m){}}function n(e,t){var r,n="",i=t+"";return(" "===i.to(1)||/^[a-z]/i.test(i))&&(n=" "),r=i.split(/\s*,\s*/).compact(!0),r.length||r.push(""),r.map(function(t){return e+n+t})}var i=[],a=[],o=t;return V(o)&&V(o.style)?(r(t.style,"",i,a),[i,a]):""}function C(){return{con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();return t&&t.data?t.data:e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,r){return e[t](r?"disable":"enable")},overlap:function(){function e(e,t,r){return void 0===r||null===r?t:V(r)?Object.merge(t,r,!1):r}if(!arguments.length)return{};if(1===arguments.length)return arguments[0];for(var t=1;t<arguments.length;t++)Object.merge(arguments[0],arguments[t],!1,e);return arguments[0]},patch:function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(V(t[n])?e.hasOwnProperty(n)?r(e[n],t[n]):e[n]=Object.clone(t[n],!0):e.hasOwnProperty(n)||(e[n]=B(t[n])?t[n].clone(!0):t[n]));return e},kickoff:function(e,t){var r,n=t&&"object"==typeof t?Object.clone(t,!0):{};for(r in e)e.hasOwnProperty(r)&&(delete e[r],void 0!==n[r]&&(e[r]=n[r]))},sdbmCode:function(e){for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++)r=t.charCodeAt(n)+(r<<6)+(r<<16)-r;return(1e11+r).toString(36)},tojson:function(){function e(e){return 10>e?"0"+e:e}function t(e,i,a){var o,s,l,c,u=0,d=i||0,f=r;switch(a&&W(a)&&(u=String(a).length,f=String(a).repeat(10)),(typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e):"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\([^\)]*)([\n\t][^)]*)(\).*)/,"$1 $3$5").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===A)return t(e.toJSON(),d+(a?1:0),a);if(o=[],B(e)){for(s=0;s<e.length;s+=1)o.push(t(e[s],d+(a?1:0),a)||"null");return"["+o.join(","+(a?"\n"+f.to(d*u+u):""))+"]"}for(l in e)W(l)&&(c=t(e[l],d+(a?1:0),a),c&&o.push((a?"\n"+f.to(d*u+u):"")+t(l,d+(a?1:0),a)+": "+c));return"{"+o.join(",")+(a?"\n"+f.to(d*u):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var r="	".repeat(10),n=JSON.stringify;return t.fill(void 0,0,void 0)}(),fromjson:function(e){var t=JSON.parse(e);return x(t),t},mask:function(e,r){function n(e,t){if(!V(t))return{};var r={};for(var i in t)!V(t[i])&&e.hasOwnProperty(i)?r[i]=Object.clone(e[i],!0):e.hasOwnProperty(i)&&(r[i]=V(e[i])?n(e[i],t[i]):Object.clone(e[i],!0));return r}if(!V(e))return null;var i,a=r;if(W(a))return t(e,a);if(B(a)){i=[];for(var o=0;o<a.length;o++)i[o]=W(a[o])?t(e,a[o])||null:null;return i}return V(a)?n(e,a):void 0},unmask:function(e,t){function r(e,t,r){var n,i,a,o=Object.clone(t,!0),s=0;if(/\./.test(r))for(i=r.split(".").each(function(e,t){this[t]=String(e).compact()}),n=e;s<i.length;s++)s===i.length-1&&(n[i[s]]=o),0===s?(n=e[i[0]],a=e):(a=a[i[s-1]],n=n[i[s]]),void 0===n&&(n=a[i[s]]={});else null!=t&&(e[r]=o);return e}var n={};if(V(e)&&V(t))return rt.mask(e,t);if(B(e)&&B(t)){for(var i=0;i<t.length;i++)null!=e[i]&&r(n,e[i],t[i]);return n}return W(t)?r({},e,t):null},getref:t,require:s,repo:function(){return N},restyles:function(){return S},unjson:function(e){return x(e),e},blob2base64:function(e,t,r){var n=new FileReader;n.onload=function(){t(r?n.result:n.result.split(",")[1])},n.readAsDataURL(e)},base642blob:function(e,t,r){for(var n,i=atob(e),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o),l=0;a>l;l++)s[l]=i.charCodeAt(l);return n=new Blob([s],{type:r||"application/octet-stream"}),Y(t)?void t(n):n},base64:function(t,r,n){var i=(M(t),null),a=W(t)?t:e.my.tojson(t),o=W(n)?"data:"+n+";base64,":"";if(r){try{i=decodeURIComponent(escape(window.atob(a)))}catch(s){i=null}if(null!==i&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(i))try{i=e.my.fromjson(i)}catch(s){i=null}return i}return o+window.btoa((n===!0?"ï»¿":"")+unescape(encodeURIComponent(a)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(!0).reduce(function(e,t){var r,n,i,a=t.trim();return/^[^{]+\{[^\}]+\}$/.test(a)&&(r=a.to(-1).split("{"),n=" "+r[0].trim(),i=r[1].trim(),";"!=i.last()&&(i+=";"),e[n]||(e[n]=""),e[n]+=i),e},{});return t}}}var q,z="jQuery.my 1.1.3",D=window.URL||window.webkitURL,_=!document.addEventListener,N=t(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Global manifest cache"},S=t(e,"my.f.restyles")?e.my.f.restyles():{},T=e.extend,M=e.type,E=null,$=function(e){return null!==e&&void 0!==e},R="{yyyy}-{MM}-{dd}",I="{HH}:{mm}",P="object",U="data",F="array",L="string",A="function",H="change",J=/^this\./,B=Object.isArray,Q=Object.isBoolean,W=Object.isString,V=Object.isObject,G=Object.isNumber,K=Object.isRegExp,Y=Object.isFunction,Z=function(e){return!!(null!=e&&(V(e)||e.jquery)&&Y(e.then)&&Y(e.fail)&&Y(e.state))},X=function(e,r){var i,a;return W(e)?(i=e,a=t(V(r)?r:N,i),"exist"===r?V(a):a?Object.clone(a,!0):null):V(e)?(a=n(e,r),V(a)?a:null):void 0===e?N._src:null===e?Object.reject(N,/^_/):null},et=e.ajax,tt={vals:{".my-form":function(e,t){if(e&&e.my){var r=e.my(U);return Object.equal(r,t)?r:e.my(U,t,!0)}return t||E},".hasDatepicker":function(e,t){$(t)&&e.datepicker("setDate",""==t?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(R):""},".my-tags":function(e,t){return $(t)&&(W(t)||G(t)?e.tags(U,[t+""]):B(t)&&e.tags(U,t)),e.tags(U)},".ui-draggable":function(e,t){if($(t)&&V(t)){var r={};isNaN(t.left)||(r.left=Number(t.left).ceil(2)+"px"),isNaN(t.top)||(r.top=Number(t.top).ceil(2)+"px"),(r.left||r.top)&&e.css(r)}var n=e.position();return{left:t&&!isNaN(t.left)?(1*t.left).ceil(2):n.left.ceil(2),top:t&&!isNaN(t.top)?(1*t.top).ceil(2):n.top.ceil(2)}},".my-form-list":function(t,n){function i(){var r,n,i=e(this),a=i.data("my");a&&(r=i.data("formlist"),n=r.index,r.hash=b(a.data,n)+"",r.oid=x!==b?x(a.data,n)+"":r.hash),t.trigger("check.my")}function a(e){e.data("my").locktill+j/1.3<z&&e.my("redraw")}var o,s,l,c,u,d,f="ui-sortable",m="."+f+"-placeholder",h=t.data("formlist")||{},p=h.generator||{},y=p.selector||">.my-form",v=p.template||"<div></div>",g=/\{/.test(v),b=p.hash||rt.sdbmCode,x=p.id||rt.sdbmCode,w=p.ext,j=p.delay||50,k=t.is("."+f),O=!!t.children(m).size(),C=[],q=[],z=Date.now(),D=t.find(k?t.sortable("option","items"):y);if($(n)&&B(n)){if(O)return n;if(s=[],D.each(function(){var t=e(this),r=t.data("my");r&&s.push(r.data)}),c=!1,s.length===n.length)for(c=!0,o=0;o<s.length;o++)s[o]!==n[o]&&(c=!1);if((!c||w)&&(l=e.extend(!0,[],s,n),!Object.equal(s,l)||l.length!=n.length)){var _=[],N=[],S={},T={};for(q=[],o=0;o<n.length;o++)N[o]=x(n[o],o)+"",S[N[o]]=o,_[o]=(x!==b?b(n[o],o):N[o])+"";for(D.each(function(){var t=e(this),r=t.data("formlist")||{},n=r.oid;n&&S.hasOwnProperty(n)?T[n]=e(this):t.is(".my-form")?t.my("remove",!0):t.remove()}),o=0;o<n.length;o++)T[N[o]]?(u=T[N[o]].detach().appendTo(t),C.push(u.my("data")),_[o]!==(u.data("formlist")||{}).hash&&q.push(u)):(u=e(g?v.assign(n[o]):v).appendTo(t),u.data("formlist",{list:n[o],index:o,hash:_[o],oid:N[o]}),u.my(r(p.parent,p.manifest,n[o],o,n,t),n[o]).then(function(e){e.on("change.my",i.debounce(j/1.3))}.fill(u)),C.push(u.my("data")));if(q.length&&w){for(o=0;o<q.length;o++)a(q[o]);q=[]}return C}return s}if(D.size()){if(z-p.stamp>1.4*j||z-p.stamp>100||!p.stashed||p.stashed.length!==D.size()-(O?1:0)){O&&(d=t.find(">."+f+"-helper"));var M=0;for(D.each(function(t,r){var n,i,a,o=e(r),s=!1;O&&o.hasClass(f+"-helper")||(O&&o.hasClass(f+"-placeholder")&&(o=d),n=o.data("my"),i=o.data("formlist"),n&&i&&(C.push(n.data),M!=i.index&&(i.index=M,s=!0),w&&(a=b(n.data,M)+"",a!==i.hash&&(i.hash=a,s=!0)),M+=1,s&&q.push(o)))}),o=0;o<q.length;o++)a(q[o]);q=[],p.stamp=z,p.stashed=C}else C=p.stashed.slice(0);return C}return n||[]},".ui-sortable":function(t,r){var n,i=[],a="ui-sortable",o=">."+a+"-placeholder",s=t.find(t.sortable("option","items"));if($(r)&&B(r)){var l={},c={},u=r.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(o).size())return u;s.each(function(){l[rt.sdbmCode(rt.extval(e(this)))]=e(this)});for(var d=u.length-1;d>=0;d--){var f=rt.sdbmCode(u[d]);l[f]&&(l[f].prependTo(t).show(),c[f]=!0,-1==i.indexOf(u[d])&&i.push(u[d]))}i=i.reverse();for(d in l)c[d]||l[d].hide()}else{var m=t.find(o),h=t.eq(0);0!=m.size()?(h.my()[a]!=m.position().left+""+m.position().top?(s=s.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)"),n=t.find(t.sortable("option","items")).filter(".ui-sortable-helper"),s.each(function(){var t=e(this);i.push(rt.extval(t.is(".ui-sortable-placeholder")?n:t))}),h.my()[a]=m.position().left+""+m.position().top,h.my()[a+"1"]=i):i=h.my()[a+"1"],i==E&&s.each(function(){i.push(rt.extval(e(this)))})):(s=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)"),s.each(function(){i.push(rt.extval(e(this)))}))}return i},"input[type=date]":function(e,t){if($(t))return r=""!=t?Date.create(t).format(R):"",W(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(R):""},"input[type=time]":function(e,t){if($(t))return r=""!=t?Date.create(t).format(I):"",W(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(I):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){$(t)&&e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){$(t)&&e.val(t).trigger("update")},"div.select2-container+input":function(e,t){return $(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val"))&&e.select2("val",B(t)?t:[t]),e.select2("val")},"":function(e,t){$(t)&&e.val(t+"")}},":radio":function(t,r){var n=-1;if($(r)){t.each(function(t){var i=e(this).val();r+""==i+""&&(n=t)});var i=t.eq(0).checkboxradio;if(i&&t.each(function(t){var r=e(this);n!=t&&r.is(":checked")&&r.prop("checked",!1).checkboxradio("refresh")}),n>-1){var a=t.eq(n);a.is(":checked")||(a.prop("checked",!0),i&&a.checkboxradio("refresh"))}else i||t.each(function(){e(this).prop("checked",!1)})}if(-1==n)for(var o=0;o<t.size();o++)t.eq(o).is(":checked")&&(n=o);return-1!=n?t.eq(n).val():""},":checkbox":function(t,r){var n=r,i=[];if($(n)){B(n)||(n=[r]);var a=!!t.eq(0).checkboxradio;t.each(function(){var t=e(this),r=t.val(),o=t.is(":checked");-1!=n.indexOf(r)?(i.push(r),o||t.prop("checked",!0)):o&&t.prop("checked",!1),a&&t.checkboxradio("refresh")})}else t.each(function(){var t=e(this);t.is(":checked")&&i.push(t.val())});return i}},select:{".ui-slider-switch":function(e,t){$(t)&&(e.val(t+""),e.slider("refresh"))},"div.select2-container+select":{"[multiple]":function(e,t){return $(t)&&e.select2("val",B(t)?t:[t]),e.select2("val")},"":function(e,t){return $(t)&&e.select2("val",t+""),e.select2("val")}},"[multiple]":function(e,t){$(t)&&(e.val(t,[]),e.selectmenu&&e.data("uiSelectmenu")&&e.selectmenu("refresh",!0))},"":function(t,r){$(r)&&(t.val(r+""),t.selectmenu&&(t.data("uiSelectmenu")?t.selectmenu("refresh",!0):t.find("option").each(function(n){var i=e(this);rt.extval(i)==r&&t.selectmenu("value",n)})))}},textarea:{".my-cleditor":function(e,t){return $(t)&&e.val(t).cleditor()[0].updateFrame(),e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");return $(t)?(r?e.redactor("set",t):e.setCode(t,!1),t):r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){return $(t)?(e[0].nextSibling.CodeMirror.setValue(t),t):e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){$(t)&&e.val(t+"")}},"fieldset,form,section,footer,aside,.my-container":function(e,t){var r=Array.prototype.slice.call(e[0],0).sort(),n=t;return $(t)&&(W(t)&&(n=t.split(/[,\s]+/).compact(!0)),B(n)&&(n.sort(),n.join(" ")!==r.join(" ")&&(e.atrr("css",n.join(" ")),r=n))),r},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){return $(t)&&e.slider("option",e.slider("option","values")?"values":"value",rt.clone(t)),rt.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,r){if($(r)){if(""!=r){var n=E;if(t.find(":radio").each(function(){n=(e(this).val()||e(this).button("option","label"))==r?e(this):n}),n)return n.attr("checked",!0),t.buttonset("refresh"),r}}else{var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}return t.find(":radio:checked").attr("checked",!1),t.buttonset("refresh"),""},".ace_editor":function(e,t){return $(t)&&ace.edit(e[0]).setValue(t),ace.edit(e[0]).getValue(t)},"":function(e,t){return $(t)&&e.html(t),e.html()}},"pre,code":function(e,t){return $(t)&&e.html(t),e.html()},img:function(e,t){return $(t)&&e.attr("src",t),e.attr("src")||""},"":function(e,t){return $(t)&&e.html(t),e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:q="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:q},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+("Micro"===navigator.appName.to(5)?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var r=t[0].parentNode,n=r.nodeName;return/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n)?e(r):t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){rt.jquix(t,"selectable",e)},".ui-slider":function(e,t){rt.jquix(t,"slider",e)},".ui-draggable":function(e,t){rt.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){rt.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){rt.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){rt.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")}),t.removeClass("my-form-list"),t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor(),e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea(),e.removeClass("my-codemirror")}}}};tt.params={container:function(e){return c(e,tt.containers)(e)},change:E,recalcDepth:2,delay:0,strict:!1,restyle:-1,locale:q=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(tt.msg,function(e,t){return t[q]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,r){return t?e.fadeIn(r):void e.fadeOut(r)
},remember:0,silent:!1,history:{},historyDelay:100,loader:function(t){var r=e.Deferred(),n=X(t+"");return n?r.resolve(n):r.reject(null),r.promise()},ajaxTimeout:1e4};var rt=C(),nt={init:function(r,n,i){function s(e){var r,n,i,a,o,s,l={},c=!0,u=e.inherit;if(l=k(u),!Object.size(l))return null;if(a=ct.parents(".my-form").eq(0),!a.size())return null;if(o=a.data("my"),!o||!o.manifest)return null;i=o.manifest,n=i.expose,c=!n;for(r in l)(c||n[r])&&(s=t(i,r),null!=s&&(/\./.test(r)||W(l[r])?T(!0,I,rt.unmask(s,W(l[r])?l[r]:r)):e[r]=s))}function c(){var e,t;for(var e in et)for(t in $[e].listen)et[e].addClass("my-listen-"+rt.sdbmCode(t));Q.radio&&ct.on("radio.my",function(e,t){var r,n;if(V(t)&&t.channel&&t.message&&Y(Q.radio[t.channel])){r=Q.radio[t.channel];try{n=r.call(Q,e,t)}catch(i){rt.con("Radio handler failed: "+i.message,i.stack)}void 0!==n&&(e.stopPropagation(),n&&o(ct,t))}})}function d(){R.strict||x(I,!0),Q=T(!0,Q,Object.reject(I,["data"])),$=w(T(!0,{},I.ui||{}),Q,R),Q.radio&&(Q.radio=j(Q.radio)),Q.expose&&(Q.expose=k(Q.expose)),_=Number.random(268435456,4294967295).toString(16),z=I.id||"my"+_,N=rt.sdbmCode(z),Q.id=z,R.form=ct,I.params&&I.params.depth&&(R.recalcDepth=I.params.depth);for(P in Q)Y(Q[P])&&(Q[P]=Q[P].bind(Q));I.error&&(W(I.error)?at=function(e,t){return I.error.assign(T({message:e+"",err:t+""},I))}:Y(I.error)&&(at=function(e,t){M=null;try{M=I.error(e,t)}catch(r){M=R.messages.initFailed}return M})),T(ct.data("my"),{id:z,cid:_,mid:N,errors:Object.extended(),ui:Object.extended($),disabled:!1,manifest:Q,locFiles:[],modals:{},radio:{}}),ct.addClass("my-form"),L="my-manifest-"+N,A="my-form-"+_,ct.addClass(A+" "+L)}function f(t){function r(e,t){return'<style id="'+t+'" data-count="0">.'+t+e.join(" \n."+t)+"\n</style>"}Q.style&&(F=O(ct,Q,L,A),F&&F[0].length&&!t&&(H=e("style#"+L),H.size()||(H=e(r(F[0],L)).appendTo(e("body"))),H.data("count",1*H.data("count")+1),ct.data("my").style=H),F&&F[1].length&&(J=e("style#"+A),J.size()?t&&(e(r(F[1],A)).replaceAll(J),J=e("style#"+A)):(J=e(r(F[1],A)).appendTo(e("body")),R.restyle>-1&&!S[_]&&(S[_]=function(){f(!0)}.debounce(R.restyle)),ct.data("my").restyle=f.fill(!0).debounce(0)),ct.data("my").localStyle=J))}function m(){var t,r,n=e.Deferred();if(r=a(Q),W(r))g("Error decoding base64 to local Blob/URL",r),n.reject();else{if(D)for(t=0;t<r.length;t++)K.push(Q.files[r[t]].url);K.length&&(ct.data("my").locFiles=K),n.resolve()}return n.promise()}function h(){if(I.init!=E){lt=ct.find(">*").clone();try{B=b(Q,I.init,ct,I)}catch(t){return g(W(t)?t:t.message,t.stack),ct}}if(Z(B)?B.then(function(){p()},function(e,t){g(e,t)}):p(),!it){if(!ct.my())return g("Internal error initializing controls",""),ct;ct.data("my").initial=T(!0,{},G),e.mobile&&e.mobile.changePage(e.mobile.activePage)}}function p(){function e(e){it||(t[e]=l(ct.find(e),E),r-=1,.5>r&&v(t))}var t={},r=Object.size($);ct.addClass(ot),Object.each($,function(t){if(!it){var r=ct.find(t),n=y(r,ct,$[t],t);Z(n)?n.then(e.fill(t)).fail(function(e,r){g("Error building "+t+", "+e,r)}):it||e(t)}})}function v(e){var t,r,n;for(var i in $){if(it)return;if(t=$[i],n=ct.find(i),n.size()){t.listen&&(et[i]=n.eq(0));try{r=u(G,E,t,n),r==E&&e[i]!=E&&void 0!==r&&u(G,e[i],t,n)}catch(a){rt.con("Transient fail linking "+i+" of form $('.my-form-"+_+"')",a.message,a.stack)}try{r!=E&&l(n,r),n.eq(0).trigger("check.my")}catch(a){g("Error linking "+i,a.message,a.stack)}}}ct.removeClass(ot),lt=null,nt.resolve(G)}function g(e,t){var r;if(it=!0,rt.con("Form "+z+" failed to initialize: "+e,t),ct.removeClass(ot),r=at(e,t),W(r)||V(r)&&r.jquery?ct.html(r):r===!0&&ct.html(lt),R.silent)nt.resolve(G);else{if(!ct.my().ddata){if(ct.removeData("my"),ct.removeClass("my-form"),H)if("1"==H.data("count"))try{H.remove()}catch(n){}else H.data("count",H.data("count")-1);if(J)try{delete S[_],J.remove()}catch(n){}}nt.reject("Form "+z+" failed to initialize: "+e,t)}}var C,q,z,_,N,M,$,R,I,P,F,L,A,H,J,B,Q={},G={},K=[],et={},nt=e.Deferred(),it=!1,at=function(){},ot="my-form-init",st="std",lt="";if(W(r)){if(C=X(r),!C)return nt.reject("No manifest with id "+r+" found in repo."),nt.promise();V(i)&&V(n)?(C=T(C,n),q=i):q=n,st="repo"}else C=r,q=n;if(!C)return this;I=V(q)&&"repo"!=st?T(!0,{},C):C;var ct=this.eq(0),ut=ct.my();return V(ut)&&ut.id&&ut.ui?(rt.con("jQuery.my is already bind.",ct),ct.my("ui",I.ui),ct.my(U,I.data),nt.resolve(ct.my(U)).promise()):(R=I.params||{},R.strict||(R=T(!0,{},R),x(R)),R=T(!0,{},tt.params,R),nt.fail(function(){ct.removeClass(A+" "+L)}),T(ct,nt.promise()),V(q)?(G=rt.patch(q,I.data||{}),I.data=G):G=I.data||{},Q.data=G,ct.data("my",{data:G,params:R,promise:nt.promise(),locktill:0}),ct.addClass(ot),I.inherit&&s(I),rt.require(I,R).then(function(){d(),m().then(function(){f(),h()})}).fail(function(e){d(),g("Linker of ‘require’ property failed.",e)}),nt.then(c),ct)},redraw:function(e,t){var r=this,n=r.my();return n&&n.ui&&(n.ui.each(function(t){var i=r.find(t);h(i,e?E:void 0,n.params.recalcDepth),e||(i.is(".my-form")&&i.my("redraw"),i.trigger(i.is(".my-form-list")?"redraw":"check.my"))}),!t&&e&&r.trigger(H)),r},data:function(e,t){var r=this;return V(e)&&(r.my().data=rt.overlap(r.my().data,e),this.my("redraw",t)),r.my().data},errors:function(){var t=e(this).my().errors,r={};for(var n in t)t[n]&&W(t[n])&&(r[n]=t[n]),V(t[n])&&Object.keys(t[n]).length&&(r[n]=t[n]);return r},valid:function(){var t=e(this).my().errors,r=0;for(var n in t)t[n]&&W(t[n])?r++:V(t[n])&&Object.keys(t[n]).length&&r++;return!r},reset:function(){try{rt.kickoff(this.my().data,this.my().initial),this.my("redraw")}catch(e){return!1}return!0},id:function(e,t){if(W(e))return X(e,t);var r=this.my();return r&&r.id?r.id:E},remove:function(e){var t,r,n,i,a,o,s,l,u=this;if(!this.my())return E;if(this.my().root&&!this.my().ddata&&(u=this.my().root),n=u.my(),a=n.data,s=n.cid,l=n.mid,u.unbind(".my"),V(n)&&n.manifest&&Y(n.manifest.die))try{n.manifest.die.call(n.manifest,u,n.manifest)}catch(d){}if(t=n.style)if("1"==t.data("count"))try{t.remove()}catch(d){}else t.data("count",t.data("count")-1);if(r=n.localStyle)try{delete S[s],r.remove()}catch(d){}if(window.URL&&(i=n.locFiles)&&i.length)for(var f=0;f<i.length;f++)try{URL.revokeObjectURL(i[f])}catch(d){}if(o=(n||{}).ui,o&&o.each(function(e){var t,r,n,i=u.find(e);if((r=i.data("modal"))&&(r.cancel(),i.removeData("modal")),r=i.data("modals"))for(n in r)r[n]&&r[n].cancel();i.unbind(".my");try{t=c(i,tt.destroy),Y(t)&&t(i)}catch(a){}i.removeData("formlist").removeData("myval").removeData("my")}),e&&u.is(".my-form"))u.remove();else if(u.data("formlist")&&u.is(".my-form")){var m=u.parents(".my-form-list").eq(0);u.remove(),m.trigger("check")}else u.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form");return u.removeClass("my-form-"+s+" my-manifest-"+l),a},undo:function(e){var t,r=this,n=r.my(),i=n.params.history,a=Object.keys(i).sort(),o=1*(parseInt(e)||0);return!a.length||0>o?E:(n.params.errors&&n.params.errors.values().compact(!0).length?Object.equal(n.data,n.lastCorrect)||(o+=1):Object.equal(i[a.last()],n.data)&&(o+=1),t=p(o,n.params,!0),t&&(rt.kickoff(r.my().data,t),r.my("redraw")),r.my().data)},ui:function(e){var t,r=this,n=r.my(),i=[];if(!n)return E;T(!0,{},n.ui);if(!V(e))return n.ui;for(t in e)i.push(t);for(n.ui=w(rt.overlap(n.ui,e)),t=0;t<i.length;t++)y(r.find(i[t]),r,n.ui[i[t]],i[t]);for(t in e)r.find(t).eq(0).trigger("check");return n.ui},disabled:function(e){var t,r,n,i,a=this,o=a.my();if(!o)return void 0;if(e==E)return o.disabled;if(e){for(r in o.ui)t=a.find(r).eq(0),n=t.my(),n&&(n.predisabled=n.disabled),m(!0,t,":disabled");a.addClass("my-disabled")}else{for(r in o.ui)t=a.find(r).eq(0),n=t.my(),i=!1,n&&n.predisabled&&(i=!0),m(i,t,":disabled");a.removeClass("my-disabled"),a.my("redraw")}},find:function(e){var t=this,r=t.my();return r&&r.root&&(t=r.root),t.find(e)},radio:function(e,t){this.trigger("radio",W(e)?{channel:e,message:t}:e)},manifest:function(e){return"json"==e?rt.tojson(this.my().manifest):this.my().manifest},version:function(){return z},history:function(e,t){return p(e,this.my().params,t)},val:function(e){return l(this,e)},container:function(e){return c(e,tt.containers)(e)},promise:function(e){return Y(e)&&this.my().promise.then(e),this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,r){var n,i,a=this.is(".my-form-list")?this:this.my().root||this,o=a.is(".my-form-list")?a:a.parent(".my-form-list"),s=(a.data("formlist")||{}).index,l=r;if(null==s&&(s=0),n=t(o.my().data,o.data("formlist").generator.bind),!V(l))if(V(o.data("formlist").generator.manifest))l=Object.clone(o.data("formlist").generator.manifest.data,!0)||{};else{if(o===a)throw"No data to insert, cannot guess when manifest is function.";l=Object.clone(a.my().manifest.data,!0)}if("before"===e)i=s;else if("after"===e)i=s+1;else{if(isNaN(e))throw"Invalid position for insert";i=(1*e).clamp(0,n.length)}n.add(l,i),o.trigger("redraw")}};e.my||(e.my={}),e.extend(e.my,{f:e.extend({},rt),tojson:rt.tojson,fromjson:rt.fromjson,radio:function(t,r){o(e(document),W(t)?{channel:t,message:r}:t)},rules:tt,cache:function(e,t){return Y(e)?X=e:X(e,t)},version:function(){return z},ajax:function(e){return Y(e)?et=e:et.apply(this,Array.prototype.slice.call(arguments))}}),e.my.chain=function(){function e(){if(n.length&&i){var t,r=n.shift(),a=function(){e.delay(r[1])}.once();try{t=r[0]()}catch(o){a()}Z(t)?(t.then(a,a),a.delay(r[1])):a()}}var t=1,r=1e3,n=[],i=!1,a=function(i,a,o){n.push([i,a||t,o||r]),e()};return a.delay=function(e){return isNaN(e)||(t=(e-0).clamp(0,1e6)),t},a.timeout=function(e){return isNaN(e)||(r=(e-0).clamp(1,1e6)),r},a.start=function(){i=!0,e()},a.stop=function(){i=!1},a}(),e.fn.my=function(t){var r;if(void 0===t)return this.data("my");if(W(t)&&"{"==t.substr(0,1)){try{r=JSON.parse(t)}catch(n){}if(r)return nt.init.apply(this,[r].add(Array.prototype.slice.call(arguments,1)))}return W(t)&&nt[t]?nt[t].apply(this,Array.prototype.slice.call(arguments,1)):W(t)&&X(t,"exist")?nt.init.apply(this,arguments):typeof t!==P&&t?void e.error("Method "+t+" does not exist on jQuery.my"):nt.init.apply(this,arguments)},e(window).off(".my").on("radio.my",function(t,r){t.stopPropagation(),o(e(document),r)}).on("resize.my",function(){for(var e in S)try{S[e]()}catch(t){}}.debounce(100))}(jQuery),function(e){function t(e,t,r){if(l(t))return e+t;if(c(t))return r=i(!0,r,t),e;if(s(t)&&t.length>1&&l(t[1])){for(var n,u,f,m,h,p,y,v,g=t[0],b="",x=1;x<t.length;){if(l(t[x]))if(m=t[x].replace(/\s/g,""),f=m.split(/[\.#]/i),u=r.alias[f[0]]||f[0],n=m.substr(f[0].length),/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(m)){y=d.tmpl[u]||d.tmpl[""],p={style:"","class":"",txt:""},v="";var w=c(t[x+1]);if(w){x+=1;for(h in t[x])""!==d.attnames[h]&&(p[d.attnames[h]||h]=t[x][h])}p.style||p["class"]||!r.styles[u]||(p.style=r.styles[u]),p.id||"#"!=n.to(1)||(p.id=n.from(1).split(".")[0]),!p["class"]&&/\./.test(n)&&(p["class"]=("#"==n.to(1)?n.substr(p.id.length+1):n).split(".").compact(!0).join(" "));for(h in p)v+=h+'="'+p[h]+'" ';if(w)for(h in t[x])""===d.attnames[h]&&(p[h]=t[x][h]);p.ext=v,!p.txt&&d.txt[u]&&(p.txt=d.txt[u](p)),p._tag=u,b+=typeof y==o?y(p)||"":typeof y==a?y.assign(p):""}else b+=t[x];x+=1}return b&&(b="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&g?"padding-left:"+r.label+"; ":"")+'">'+(g?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+g+"</"+r.labelTag+">":"")+b+"</"+r.rowTag+">"),e+b}return e}function r(e){var t=e;if(l(t)&&(t=t.split(/[\s,]/).compact(!0)),s(t)){for(var r={},n=0;n<t.length;n++){var i=t[n];if(c(i)){var a=Object.keys(i);1==a.length?r[a[0]]=i[a[0]]+"":r[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else r[i]=i+""}t=r}return c(t)?t:{}}function n(r,n){var a={};return s(r)?(i(!0,a,d.params,n||{}),r.length?r.reduce(t.fill(void 0,void 0,a),""):""):c(r)?void e.extend(d,r):""}var i=e.extend,a="string",o="function",s=Object.isArray,l=(Object.isBoolean,Object.isString),c=Object.isObject,u=(Object.isNumber,Object.isRegExp,Object.isFunction,'<input type="'),d={tmpl:{num:u+'number" {ext}/>',inp:u+'text" {ext}/>',sli:u+'range" {ext}/>',dat:u+'date" {ext}/>',btn:u+'button" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!s(e.vals))return"";var t=i({style:"",css:""},e);return t.txt=e.vals.reduce(function(e,t){return e+"<span class=\"my-shortcut\" onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," "),'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(t)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=r(e.vals);return Object.keys(t).reduce(function(e,r){return e+'<option value="'+r+'">'+t[r]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}},f={init:function(t,r){return e(this).html(n(t,r))}};e.my||(e.my={}),e.my.formgen=n,e.fn.formgen=function(t){return l(t)&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.formgen"):f.init.apply(this,arguments)}}(jQuery),function(e){function t(t,r,n,i){var a,s,l,d,f,m,h;if("object"==typeof r&&r.jquery)r.is("img")&&(m=r,f=r.attr("alt")||r.attr("title")||r.data("text")||"",s=m[0].naturalWidth||m[0].width,a=m[0].naturalHeight||m[0].height,1>a&&(a=1),1>s&&(s=1),d=e(window).width()-90,l=e(window).height()-90,a>l&&(s=s*(l/a)|0,a=l),s>d&&(s=d,a=a*(d/s)|0),h=300>s?300:s,o(t,{source:"image",manifest:{init:function(e){e.html(this.HTML),e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+s+"px;max-height:"+a+'px"><h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:m.attr("src"),text:f},esc:!0,screen:!0,width:i||h,focus:!1,global:!0,z:"1995"},n));else if(u(r)&&r.manifest)o(t,r,n);else{if(!c(r))return null;o(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:r,ui:{"div:eq(0)":function(){}}},data:{},esc:!0,focus:!1,width:i},n)}return t}var r,n={},i="body",a=!1,o=e.extend,s={},l=(Object.isArray,Object.isBoolean),c=Object.isString,u=Object.isObject,d=Object.isNumber,f=(Object.isRegExp,Object.isFunction);e(document).keydown(function(e){var t,r,n=e.keyCode;if(!1!==a&&(13===n||27===n)){if(r=a.data("modal"),t=r.form,27==n&&(r.esc||Object.equal(t.data("my").initial,t.my("data"))))return a.modal(!0),!1;if(13==n&&r.enter)return function(e){e.modal()}.fill(a).delay(50),!1}}),n.modal=function(r,n,o){var s,c={},u=e(i),d=u.find(">.my-modal-proxy"),m={global:!0,screen:!0,done:f(n)?n:void 0,z:"1995"};return l(r)||null==r?d.modal(r):(s=e.Deferred(),t(c,r,m,o)?a?s.reject("Locked").promise():(d.size()||(d=e('<div class="my-modal-proxy"></div>').prependTo(u),d.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})),d.modal(c)):s.reject("Invalid data").promise())},n.modal.loading=function(t){e(i).find(">.my-modal").toggleClass("my-modal-loading",!!t)},n.modal.parent=function(t){return t&&e(t).size()?void(i=t):e(i)},n.modal.parentBack=function(t){return t&&e(t).size()?void(r=t):e(r||i)},n.modal.visible=function(){return!!a},e.my||(e.my={}),e.my.modal=n.modal,e.fn.modal=function(n,m,h){function p(){var t,r,n=window,i=!!M.global,a=w.offset(),o=D.offset();M.pos={px:a.left,py:a.top,pw:w.outerWidth(),ph:w.outerHeight(),ox:o.left,oy:o.top,ow:D.outerWidth(),oh:D.outerHeight(),ww:r,wh:t};var s=1*(M.x.match(/\-?\d+(\.\d+)?/)||[0])[0],l=1*(M.y.match(/\-?\d+(\.\d+)?/)||[0])[0],c=M.x.has("left")?-1:M.x.has("right")?1:0,u=M.y.has("top")?-1:M.y.has("bottom")?1:0,f=M.pos.ox+M.pos.ow/2-M.pos.px,m=M.pos.oy+M.pos.oh/2-M.pos.py;if(i&&(M.pos.wh=t=n.innerHeight||e(n).height(),M.pos.ww=r=n.innerWidth||e(n).width(),f=r/2,m=t/2.5),s=M.x.has("%")?M.pos.ow/100*s:s,l=M.y.has("%")?M.pos.oh/100*l:l,M.pos.pix=f,M.pos.piy=m,f=f+c*(M.pos.ow/2)+s*(c>0?-1:1)-(M.width+_)*(c+1)/2,i?(m=(t-M.height-20)/3,10>m&&(m=10)):m=m+u*(M.pos.oh/2)+l*(u>0?-1:1)-(M.height||0)*(u+1)/2,f=f.round(1),m=m.round(1),M.pos.vx=f,M.pos.vy=m,M.bound!==!1&&!M.global){var h=(d(M.bound)?M.bound:0).clamp(-100,100);M.pos.pw-2*h<M.width+_?M.pos.vx=-(M.width+_-M.pos.pw)/2:M.pos.vx+M.width+_>M.pos.pw-h?M.pos.vx=M.pos.pw-h-M.width-_:M.pos.vx<h&&(M.pos.vx=h),M.pos.ph-2*h<M.height?(M.pos.vy=h,M.height=M.pos.ph-2*h):M.pos.vy+M.height>M.pos.ph-h?M.pos.vy=M.pos.ph-h-M.height:M.pos.vy<h&&(M.pos.vy=h)}}function y(t){if(t||(M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p()),b.css({width:M.width+_+"px",display:"block"}),M.global)b.css({left:"50%","margin-left":"-"+((M.width+_)/2).round(0)+"px"});else if(b.css({left:M.pos.vx+"px"}),M.nose){e("style#my-modal-style-"+M.cid).size()||b.append('<style id="my-modal-style-'+M.cid+'"></style>');var r="",n=e("style#my-modal-style-"+M.cid);("top"==M.nose||"bottom"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {left:"+(M.pos.ox-M.pos.px+M.pos.ow/2-M.pos.vx)+"px!important;}",n.text(r)),("left"==M.nose||"right"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {top:"+(M.pos.oy-M.pos.py+M.pos.oh/2-M.pos.vy)+"px!important;}",n.text(r))}M.screen?M.global?(j.css({top:0,left:0,width:2*M.pos.ww+"px",height:2*M.pos.wh+"px",display:"block",position:"fixed","z-index":M.z-1}),c(M.screen)&&j.css({background:M.screen?M.screen:"rgba(30,65,100,0.8)"})):j.css({top:0,left:0,position:"absolute",width:M.pos.pw+"px",height:M.pos.ph+"px",display:"block",background:c(M.screen)?M.screen:"rgba(40,80,120,0.5)","z-index":M.z-1}):j.size()&&j.hide(),M.height>M.pos.wh?(b.height(M.pos.wh-30),x.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})):x.css({"overflow-y":"none"}),b.animate({top:M.pos.vy+"px",opacity:"1"},M.animate)}function v(){try{x.my("remove")}catch(t){}w.data("modals")[M.cid]=null,x.parent().unbind(".my").remove(),j.off(".my"+M.cid),M.screen&&function(e){e&&a||j.hide()}.delay(50,M.global),M.global&&(a=!1,e("body").css({overflow:"auto"}))}function g(e){try{S(null,null)}catch(t){}(function(){q.reject(e)}).delay(0)}var b,x,w,j,k,O,C,q=e.Deferred(),z={},D=this,_=0,N=0,S=f(m)?m:function(){return!1},T=u(n)?n:{},M=D.data("modal");if(o(D,q.promise()),M){if(null==n||l(n)){if(x=M.form,j=M.bg,w=M.root,S=M.done,O=x.my("data"),C=!1,n){try{S(null,null)}catch(E){}v(),D.removeData("modal"),s[M.cid]&&s[M.cid].reject("Cancelled"),delete s[M.cid],M=null}else{try{C=S(x.my("valid")?null:x.my("errors"),O)}catch(E){}C||(v(),D.removeData("modal"),function(){s[M.cid]&&s[M.cid].resolve(O),delete s[M.cid],M=null}.delay(0))}return D}if(T)return g("Locked"),D}return D.is(":visible")?(T=t(z,n,{}))?T.global&&a?(g("Locked"),D):(M=o({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:D,manifest:{},data:{},global:!1,screen:!1,drag:!1,focus:!0,close:!0,silent:!0,esc:!1,enter:!1,bound:!1,nose:"",width:h||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},T,{promise:q.promise(),cid:Number.random(268435456,4294967295).toString(16)}),M.done=f(M.done)?M.done:S,c(M.align)&&M.align&&(M.x=(M.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0],M.y=(M.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]),M.width=1*(e.my.f.getref(c(M.manifest)?e.my.cache(M.manifest):M.manifest,"params.width")||M.width),M.type="DOM",D.hasClass("my-form")?(M.type="form",M.root=M.root||D):D.data("my")?(M.type="control",M.root=M.root||D.my().root):(M.root=M.root||D.parents(".my-form").eq(0),M.root.size()||(M.root=e(i))),M.global?(M.root=e(i),M.bgroot=e(r||i)):M.bgroot=M.root,w=M.root,w.data("modals")||w.data("modals",{}),p(),b=e('<div class="my-modal my-modal-'+(M.global?"fullscreen ":"overlay ")+M.css+(M.nose?" nose-"+M.nose:"")+'"></div>').prependTo(M.root),b.addClass("my-modal-"+M.cid),_=b.outerWidth(),N=b.outerHeight(),b.hide(),b.html('<div class="my-modal-form"></div>'),x=b.find(".my-modal-form"),M.close&&(k=e(c(M.close)?M.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(b).on("click.my",function(){D.modal(!0)}),k.css({"z-index":("+"===(M.z+"").to(1)?"+":"")+(1*M.z+1)})),j=M.bgroot.find(">.my-modal-screen"),M.screen&&(j.size()||(j=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(M.root)),M.esc&&j.on("click.my"+M.cid,function(){D.modal(!0)})),D.data("modal",M),M.silent&&b.on("change.my",function(){return!1}),b.css({display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),b.css(M.global?{position:"fixed",left:"50%",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto","margin-left":"-"+((M.width+_)/2).round(0)+"px"}:{position:"absolute",left:M.pos.vx+"px",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),x.my(M.manifest,M.data).then(function(){var t,r,n,i,l;if(o(M,{form:x,bg:j,cancel:function(){D.modal(!0)},commit:function(){D.modal()}}),b.data("modal",M),M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p(),b.css({top:M.pos.vy+"px"}),y(!0),w.data("modals")[M.cid]=M,s[M.cid]=q,x.bind("commit.my",function(){return M.commit.delay(50),!1}).bind("cancel.my",function(){return M.cancel.delay(50),!1}),b.bind("layout.my",function(){y()}.debounce(50)),M.global&&(a=D,e("body").css({overflow:"hidden"})),M.global||!M.esc&&!M.enter||x.bind("keydown.my",function(t){var r=t.keyCode;return 27==r&&M.esc?(M.cancel(),!1):13==r&&M.enter&&!e(t.target).is("textarea")?(M.commit.delay(50),!1):void 0}),M.focus===!0){i=!1,l=M.manifest.ui;for(n in l)i||(r=x.find(n),r.size()&&r.is("input, textarea")&&(i=!0,r.focus()))}else c(M.focus)&&x.find(M.focus).focus();if(t=x.find("img").filter(function(){return""!=e(this).attr("src")}),t.size()){var u=function(){"manifest"!==M.source&&b.css({width:"auto"}),y()}.after(t.size());t.each(function(){e(this).bind("load",u)})}M.drag&&e.fn.draggable&&(c(M.drag)?b.draggable({handle:M.drag}):b.draggable()),q.notify("Ready")}).fail(function(e){v(),D.data("modal",null),q.reject(e)}),D):(g("Invalid data"),D):(g("Object must be visible"),D)}}(jQuery);
