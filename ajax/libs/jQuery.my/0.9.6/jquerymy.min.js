/*
 * jQuery.my 0.9.6, jquerymy.com
 * (c) ermouth, 2014-04-29
 */
;(function($){function _getref(e,t){return(t||"").split(".").reduce(function(e,t){if(null!=e&&null!=e[t])return e[t];else return undefined},e)}function _manifest(e,t){var n,r;if(isO(t))return t;else if(isS(t)){n=_getref(e,t);if(null==n)n=Object.clone(forms._src[t],true);if(null==n){n=_getref(forms,t);if(isO(n)&&isO(n._self))n=Object.clone(n._self,true);else if(isO(n))n=Object.clone(n,true)}if(null==n&&_getref(e,"params.cache")){r=_getref(e,"params.cache");if(isF(r))n=r(t);else if(isO(r))n=_cache(t,r);if(isO(n)){if(isO(n._self))n=Object.clone(n._self,true);Object.merge(n,{params:{cache:r}},true)}}if(null!=n&&isO(n)){r=r||_getref(e,"params.cache");if(r)Object.merge(n,{params:{cache:r}},true);return n}else throw"Component "+t+" not found"}else if(isF(t)){return t.apply(e,Array.prototype.slice.call(arguments,2))}else return null}function _putmanifest(e,t){var n=t||forms,r=e,i,s,o,u,a;if(!(isO(n)&&isO(r)&&isO(r.ui)&&isO(r.data)&&isS(r.id)))return"Invalid arguments.";if(!n.hasOwnProperty("_src"))n._src={};s=r.id;i=s.split(".").compact(true);if(null!=i.slice(2).find(function(e){return/^[^A-Z0-9]/.test(e)})||/^[^A-Z]/.test(i[1]))return"All path parts exept 1st must start with caps/nums.";try{r=Object.clone(e,true)}catch(l){return"Can't mount circular-referencing obj."}try{if(!r.params||r.params&&!r.params.strict)_unjson(r)}catch(l){return"Invalid manifest, parse error."}Object.merge(r,{params:{strict:true}},true);n._src[s]=r;if(o=f.mask(n,s)){if(o.params&&o.params.protect)return"Can't mount on protected";if(o._self)delete o._self}Object.merge(n,f.unmask(r,s),true);u=_getref(n,s);Object.defineProperty(u,"_self",{get:function(){return n._src[s]},set:function(){throw"Can not change repo"},enumerable:false,configurable:true});return u}function _field(e,t){var n=e.data("myval");if(!n){var r=_traverse(e,MY.vals);if(isF(r)){var i=r(e,N);if(i===undefined){e.data("myval",function(e,t){if(t!=N)r(e,t);return e.val()}.fill(e,undefined))}else e.data("myval",r.fill(e,undefined))}n=e.data("myval")}if(isF(n)){var i=n();if(i!=t||isO(t))i=n(t);return i}else return N}function _traverse(e,t){function s(e,t,o){for(var u in t)if(u!=""&&e.is(u)){i=i+(i?" ### ":"")+u;var a=t[u],f=$.type(a);if(!/^(nul|un|ob)/.test(f)&&o>r){n=a;r=o;return}else if(f==Ob)s(e,a,o+1)}if(t[""]!=N&&typeof t[""]!=Ob&&o>r){n=t[""];r=o}}var n=N,r=0,i="";s(e,t,1);return n}function _bind(e,t,n,r){var i=n.bind,s,o=[],u,a,f=$.type(i);if(f==Fu){return i.call(_form(r).manifest,e,t,r)}if(f==St||f==Ar){if(f==St&&!/\./.test(i)){if(t!=N)e[i]=t;else if(e[i]===undefined)e[i]=N;return e[i]}if(f==St)o=i.split(".").each(function(e,t){this[t]=String(e).compact()});if(f==Ar)o=i.slice(0).each(function(e,t){this[t]=String(e).compact()});u=e;for(s=0;s<o.length;s++){if(s==o.length-1){if(t!=N)u[o[s]]=t;else if(u[o[s]]===undefined)u[o[s]]=N;return u[o[s]]}if(s==0){u=e[o[0]];a=e}else{a=a[o[s-1]];u=u[o[s]]}if(u===undefined)u=a[o[s]]={}}}return N}function _validate(e,t,n,r){var i="",s=n.check,o="",u="",a,f;if(s!=N){a=_form(r).params.messages;o=n["error"],err0=o||a.patternMismatch||a[""]||"Error";if(r[0].hasOwnProperty("validity")&&!r[0].validity.valid){u=r[0].validationMessage+"";if(u!=="")return u.substr(0,1).toUpperCase()+u.substr(1);else{f=r[0].validity;for(i in f)if(u===""&&i!="valid"&&isB(f[i])&&f[i]){if(a[i])u=a[i]}return u||o}}switch($.type(s).to(1)){case"f":return s.call(_form(r).manifest,e,t,r);case"r":return s.test(String(t))?"":err0;case"a":return s.indexOf(t)>-1?"":err0;case"s":return t==s?"":err0;case"o":return s[t]?"":err0;case"b":{if(r.is(".my-form-list,.ui-sortable")){var l=r.data("listSrc")||r.data("my").listSrc||">*",c={};r.find(l).filter("*:not(.ui-sortable-placeholder)").each(function(e){var t=$(this);if(t.data("my")&&!t.my("valid"))c[e]=t.my("errors")});return c}else if(r.hasClass("my-form")){return!s?"":r.my("valid")?"":r.my("errors")}return""}}return a.formError||"Error"}else return""}function _form(e){var t=e.my();if(!t)return null;return t.root?t.root.my():t}function _css(e,t,n){var r=n.compact(),i=r.replace(/:disabled/g,"");t.each(function(){var n=$(this),s=n.my(),o=s?s.container:n;if(e){if(!o.is(i))o.addClass(i)}else o.removeClass(i);if(i!=r&&s!==undefined&&!!e!=!!s.disabled){n.my().disabled=!!e;if(!s._disable)n.my()._disable=_traverse(t,MY.offon).fill(undefined,t);s._disable(!!e)}});return t}function _update(e,t,r){var i=e,s=i.my(),o="Unknown error";if(s){var u=s.selector,a=s.root,l=a.find(u),c=a.my().ui,h=e.hasClass("my-form"),p=e.hasClass("my-form-list");if(h)var d=e,v=s.ddata,m=s.dui,g=s.dparams;else d=s.container,v=s.data,m=s.ui,g=s.params;if(m.bind!=N){if(n(t))var y=t;else y=_field(l,_bind(v,N,m,l));try{var o=_validate(v,y,m,l)}catch(b){f.con("Error "+b.name+" validating "+u,a)}var w=g.errorCss;var E="ui-state-error";try{if(t!=N)y=_field(l,_bind(v,t,m,l))}catch(b){o=g.messages.formError||"Error"}if(o==""){if(!h)s.errors[u]="";else s.derrors[u]="";d.removeClass(w);if(d.attr("title"))d.attr("title","");if(!h&&!p)g.effect(d.find(g.errorTip),false,g.animate/2);i.removeClass(E);i.find(".ui-widget").removeClass(E)}else{if(h){s.derrors[u]=o}else if(p){s.errors[u]=o}else{d.addClass(w);s.errors[u]=o;var S=d.find(g.errorTip).eq(0);if(S.size()){g.effect(S.addClass(w).html(o),true,g.animate)}else d.attr("title",(o||"").stripTags())}if(i.is(".hasDatepicker")){if(i.is("input"))i.addClass(E);else i.find(".ui-widget").addClass(E)}if(i.is(".ui-slider"))i.addClass(E)}}var x=t==N?y:t;if(m.css){for(var T in m.css){var C=m.css[T];if(isR(C))_css(C.test(x),l,T);else if(isF(C))_css(C.call(a.my().manifest,v,x,l),l,T)}}var k,L=m.recalc,A=[],O={},M;if(r&&m.recalc&&a.my()){for(var c=a.my().ui,k=0;k<L.length;k++){if(L[k]&&isS(L[k])&&(M=L[k].compact())&&c[M]){if(c[M].recalc){if(A.indexOf(M)==-1)A.push(M)}else O[M]=true}}for(k=0;k<A.length;k++)O=$E(true,O,_update(a.find(A[k]),N,r-1));if(t!==N){for(k in O)if(O[k]===true&&k!=u){if(c[k].delay&&!c[k].recalc)c[k]._update(a.find(k),N,r-1);else _update(a.find(k),N,r-1)}return{}}}return O||{}}}function _history(e,t,n,r){var i=t,s,o;if($.type(i)!=Ob||isNaN(o=i.remember)||$.type(s=i.history)!=Ob)return N;if(isO(e)&&o){var u=Object.extended(JSON.parse(JSON.stringify(e))),a=(new Date).valueOf(),f=s.keys().sort();if(f.length&&(a-f[f.length-1]<i.historyDelay||s[f[f.length-1]].equals(u)))return N;i.history[a]=u;f.push(a);if(f.length>=o*2){var l=Object.extended();for(var c=o;c<o*2;c++)l[f[c]]=s[f[c]];t.history=l}if(!r)i.form.trigger(Ch);return i.history[f[f.length-1]]}else if(!r)i.form.trigger(Ch);if(!isNaN(e)||e===N){var h=parseInt(e)||0;if(h<0)return N;var f=s.keys().sort();if(h>=f.length)h=f.length-1;var p=i.history[f[f.length-h-1]].clone(true);if(n){var l=Object.extended();for(var c=0;c<f.length-h-1;c++)l[f[c]]=s[f[c]];t.history=l}if(!r)i.form.trigger(Ch);return p}}function _build(e,t,n,r){function p(){var t=null;if(isF(o.manifest)||isO(o.manifest)&&isO(o.manifest.ui))h=o.manifest;else if(isS(o.manifest)){h=_manifest(i.manifest,o.manifest)}if(h&&isS(o.bind)){var n=_getref(i.data,o.bind);if(u===null)u=$.Deferred();if(isA(n)||o.list){e.addClass("my-form-list");var a="",f=">*";if(/^<.+>$/.test(o.list))a=o.list;else f=o.list||f;if(!a){var l=e.find(f);if(l.size()){a=$(a).append(l.eq(0).clone(true)).html();l.eq(0).remove()}else a="<div></div>"}if(!e.data("formlist"))e.data("formlist",{});e.data("formlist").generator={manifest:h,delay:(o.delay||s.delay||10)/1.3,template:a,selector:f,parent:i.manifest,bind:o.bind};e.on("insert.my",function(e,t){e.stopPropagation();var n={what:undefined,where:0};if(null==t)n.where=1e6;else if(isO(t))Object.merge(n,t);else if(isS(t)||isN(t))n.where=t;$(e.target).my("insert",n.where,n.what)});e.on("remove.my",function(e,t){e.stopPropagation();$(e.target).my("remove")})}else{try{t=e.my(_manifest(i.manifest,h),isO(n)?n:undefined)}catch(c){d("$.my subform init of "+r+" failed: "+c.message,c.stack)}}}if(isP(t)){t.then(v,function(e,t){d("Init of subform "+r+" failed with error: "+e,t)})}else v()}function d(e,t){f.con(e,t);if(u)u.reject(e,t)}function v(){e.each(function(){var u=$(this),a,f;f=u[0].nextSibling&&u[0].nextSibling.CodeMirror?u[0].nextSibling.CodeMirror:null;if(f)u.addClass("my-codemirror");a=o.events||_traverse(u,MY.events);if(!u.is(".my-form")){u.data("my",{events:a,selector:r,initial:l,previous:l,root:t,container:s.container(u),id:i.id,ui:o,data:i.data,params:s,errors:i.errors});n._update=o.delay?_update.debounce(o.delay):N}else{$E(u.data("my"),{dui:o,root:t,selector:r,dparams:s,devents:a,ddata:i.data,container:s.container(u),derrors:i.errors})}if(u.cleditor&&u.parent().is(".cleditorMain")){var c=u.cleditor()[0];if(c&&c.$frame&&c.$frame[0]){u.addClass("my-cleditor");$E(u.data("my"),{container:s.container(u)});var h=function(e){u.val(e).trigger(Ch)};var p,d=Number.random(1e5,1e6-1);$(c.$frame[0]).attr("id","cleditCool"+d);if(!document.frames)p=$("#cleditCool"+d)[0].contentWindow.document;else p=document.frames["cleditCool"+d].document;var v=$(p).find("body");$(p).bind("keyup.my",function(){h($(this).find("body").html())});u.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){h(v.html())});$("body").on("click","div.cleditorPopup",function(){h(v.html())})}}else if(u.is("div.redactor_box textarea")){var m,g="my-redactor-9";try{m=u.getEditor();g="my-redactor-8"}catch(y){m=u.redactor("getEditor")}if(m){u.addClass(g);m.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(u))}}else if(u.is(".ace_editor"))ace.edit(e[0]).on(Ch,function(e){e.trigger("ace")}.fill(u));else if(f){f.on(Ch,function(e){e.trigger("codemirror")}.fill(u))}u.my()._changed=_changed.debounce(n.delay||s.delay);u.my()._recalc=_recalc.debounce(n.delay||s.delay);u.bind(a,function(e){if(e.type==Ch)e.stopPropagation();u.my()._changed(u,t,n,s)});u.on("recalc.my, redraw.my",function(e){e.stopPropagation();u.my()._recalc(u,t,n,s)})});if(u)u.resolve()}var i=t.my(),s=(i||{}).params,o=n,u=null,a,l,c=0,h;if(!i){f.con("Failed to find $root building "+r+" selector.");return null}if(e.size()){if(o.init!=N)a=_prepare(i.manifest,o.init,e,i);if(isP(a)){c+=1;u=$.Deferred();a.then(p,function(e,t){d("Init of "+r+" failed: "+e,t)})}else p()}else f.con("Not found "+r+" selector.",t);return u}function _changed(e,t,n,r){var i=e.my();if(i&&!i.disabled){_history(i.ddata||i.data,i.dparams||i.params);var s=t.find(i.selector),o=_field(s,N);_update(e,o,n.recalcDepth||r.recalcDepth);if(i.root.parent().is(".ui-sortable"))i.root.parent().trigger("check");if(r.change)r.change.call(e)}}function _recalc(e,t,n,r){var i=e.my();if(i&&!i.disabled){var s=t.find(i.selector);if(s.is(".my-form"))s.my("redraw");else _update(e,s.is(".my-form-list")?_getref(s.my().data,s.data("formlist").generator.bind):N,n.recalcDepth||r.recalcDepth)}}function _prepare(e,t,n,r){if(isS(t))n.html(t.assign(r.data));else if(isF(t))return t.apply(e,Array.prototype.slice.call(arguments,2));else if(isA(t)){try{n.formgen(t)}catch(i){}}return null}function _unjson(node){for(var i in node)if(node.hasOwnProperty(i)){var n=node[i],t=$.type(n);if(/^(ob|ar)/.test(t))_unjson(n);else if(t==St&&/(^function\s\(|^new\sRegExp)/.test(n)){try{node[i]=eval("0||("+n+")")}catch(e){console.log(e.message,e.stack,n)}}}}function _normalize(e,t){var n=isO(t)?t:null;Object.each(e,function(t,n){var r=typeof n;if(/^str|^fu/.test(r))e[t]={bind:n}});Object.each(e,function(t,r){var i=typeof r;var s=[],o=[],u=[],a,f=/\s?[,;]\s?/;if(r.recalc){if(isS(r.recalc))o=r.recalc.split(f);else if(isA(r.recalc))o=r.recalc;o=o.compact(true).unique()}if(o.length)e[t].recalc=o;if(r.watch){if(isS(r.watch))u=r.watch.split(f);else if(isA(r.watch))u=r.watch.slice(0);u=u.compact(true).unique();for(var l,c=0;c<u.length;c++)if(a=e[u[c]]){l=a.recalc;if(!l)a.recalc=[t];else if(isS(l))a.recalc+=","+t;else if(isA(l)&&l.indexOf(t)==-1)a["recalc"].push(t)}}if(null!==n)["css","check","manifest","list"].each(function(e){var t;if(isS(r[e])){var i=_getref(n,r[e]);if(i!=null)r[e]=i}})});return e}function _style(e,t,n,r){function f(n,r,i,s){var o,u,a,c;if(isS(n))i.push(r+(/\{/.test(n)?n:"{"+n+"}"));else if(isA(n)&&n.length)for(o=0;o<n.length;o++)f(n[o],r,i,s);else if(isO(n)){for(o in n){c=l(r,o);for(u=0;u<c.length;u++)f(n[o],c[u],i,s)}}else if(isF(n)){try{a=n.call(t,e,t);f(a,r,s,s)}catch(h){}}}function l(e,t){var n="",r=t+"",i;if(" "===r.to(1)||/^[a-z]/i.test(r))n=" ";i=r.split(/\s*,\s*/).compact(true);if(!i.length)i.push("");return i.map(function(t){return e+n+t})}var i={},s={},o=[],u=[],a=t;if(!isO(a)||!isO(a.style))return"";f(t.style,"",o,u);return[o,u]}function _getHelpersLib(){return{con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();if(t&&t.data)return t.data;return e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,n){return e[t](n?"disable":"enable")},overlap:function(e,t){if(arguments.length==0)return{};if(arguments.length==1)return arguments[0];for(var n=1;n<arguments.length;n++)Object.merge(arguments[0],arguments[n],false,function(e,t,n){if(n===undefined||n===null)return t;if(!isO(n))return n;else return Object.merge(t,n,false)});return arguments[0]},patch:function e(t,n){for(var r in n){if(n.hasOwnProperty(r)){if(isO(n[r])){if(!t.hasOwnProperty(r))t[r]=Object.clone(n[r],true);else e(t[r],n[r])}else if(!t.hasOwnProperty(r)){if(isA(n[r]))t[r]=n[r].clone(true);else t[r]=n[r]}}}return t},kickoff:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(t[n]===undefined)delete e[n];else e[n]=t[n]}},sdbmCode:function(e){for(var t=JSON.stringify(e),n=0,r=0;r<t.length;r++)n=t.charCodeAt(r)+(n<<6)+(n<<16)-n;return(1e11+n).toString(36)},tojson:function(){function e(e){return e<10?"0"+e:e}function r(e,i,s){var o=0,u,a,f,l,c,h=i||0,p=t;if(s&&isS(s)){o=String(s).length;p=String(s).repeat(10)}switch((typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e)+"":"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\(.*)/,"$1 $3").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===Fu)return r(e.toJSON(),h+(s?1:0),s);u=[];if(isA(e)){for(a=0;a<e.length;a+=1){u.push(r(e[a],h+(s?1:0),s)||"null")}return"["+u.join(","+(s?"\n"+p.to(h*o+o):""))+"]"}for(f in e)if(isS(f)){c=r(e[f],h+(s?1:0),s);if(c)u.push((s?"\n"+p.to(h*o+o):"")+r(f,h+(s?1:0),s)+": "+c)}return"{"+u.join(",")+(s?"\n"+p.to(h*o):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"};RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var t="	".repeat(10),n=JSON.stringify;return r.fill(undefined,0,undefined)}(),fromjson:function(e){var t=JSON.parse(e);_unjson(t);return t},mask:function(e,t){function s(e,t){if(!isO(t))return{};var n={};for(var r in t){if(!isO(t[r])&&e.hasOwnProperty(r)){n[r]=Object.clone(e[r],true)}else if(e.hasOwnProperty(r)){if(isO(e[r]))n[r]=s(e[r],t[r]);else n[r]=Object.clone(e[r],true)}}return n}if(!isO(e))return null;var n,r=t;if(isS(r)){return _getref(e,r)}else if(isA(r)){n=[];for(var i=0;i<r.length;i++){n[i]=isS(r[i])?_getref(e,r[i])||null:null}return n}else if(isO(r))return s(e,r)},unmask:function(e,t){function i(e,t,n){var r,i,s,o=Object.clone(t,true),u=0;if(!/\./.test(n)){if(null!=t)e[n]=o}else{i=n.split(".").each(function(e,t){this[t]=String(e).compact()});r=e;for(;u<i.length;u++){if(u===i.length-1)r[i[u]]=o;if(u===0)r=e[i[0]],s=e;else s=s[i[u-1]],r=r[i[u]];if(undefined===r)r=s[i[u]]={}}}return e}var n={};if(isO(e)&&isO(t))return f.mask(e,t);else if(isA(e)&&isA(t)){for(var r=0;r<t.length;r++){if(e[r]!=null)i(n,e[r],t[r])}return n}else if(isS(t))return i({},e,t);else return null},getref:_getref,unjson:function(e){_unjson(e);return e}}}var _version="jQuery.my 0.9.6";var lang="en",forms={_src:{},_name:"Global manifest cache"},$E=$.extend,N=null,TMP,n=function(e){return e!==null&&e!==undefined},d8="{yyyy}-{MM}-{dd}",h24="{HH}:{mm}",Ob="object",Da="data",Ar="array",St="string",Fu="function",Ch="change",isA=Object.isArray,isB=Object.isBoolean,isS=Object.isString,isO=Object.isObject,isN=Object.isNumber,isR=Object.isRegExp,isF=Object.isFunction,isP=function(e){return!!(null!=e&&(isO(e)||e.jquery)&&isF(e.then)&&isF(e.fail)&&isF(e.state))},isRej=function(e){return isP(e)?e.state()==="rejected":null};var _cache=function(t,n){var r,i;if(isS(t)){r=t,i=_getref(isO(n)?n:forms,r);if("exist"===n)return isO(i);return!i?null:Object.clone(i,true)}else if(isO(t)){i=_putmanifest(t,n);if(!isO(i))return f.con(i),null;return i}else if(undefined===t){return forms._src}else if(null===t){return Object.reject(forms,/^_/)}else return null};var MY={vals:{".my-form":function(e,t){if(e&&e.my){var n=e.my(Da);return Object.equal(n,t)?n:e.my(Da,t,true)}else return t||N},".hasDatepicker":function(e,t){if(n(t))e.datepicker("setDate",t==""?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(d8):""},".my-tags":function(e,t){if(n(t)){var r=t;if(isS(t)||isN(t))e.tags(Da,[t+""]);else if(isA(t))e.tags(Da,t)}return e.tags(Da)},".ui-draggable":function(e,t){if(n(t)&&isO(t)){var r={};if(!isNaN(t.left))r.left=Number(t.left).ceil(2)+"px";if(!isNaN(t.top))r.top=Number(t.top).ceil(2)+"px";if(r.left||r.top)e.css(r)}var i=e.position();return{left:t&&!isNaN(t.left)?(t.left*1).ceil(2):i.left.ceil(2),top:t&&!isNaN(t.top)?(t.top*1).ceil(2):i.top.ceil(2)}},".my-form-list":function(e,t){var r,i,s,o,u="ui-sortable",a=">."+u+"-placeholder",l=e.data("formlist")||{},c=l.generator||{},h=c.selector||">*",p=c.template||"<div></div>",d=c.delay||50,v=e.is("."+u),m=[];var g=v?e.find(e.sortable("option","items")):e.find(h);if(n(t)&&isA(t)){if(v&&e.find(a).size()!=0){return t}i=[];g.each(function(){var e=$(this);if(e.data("my"))i.push(e.my("data"))});o=false;if(i.length==t.length)for(o=true,r=0;r<i.length;r++)if(i[r]!==t[r])o=false;if(!o){s=$.extend(true,[],i,t);if(!Object.equal(i,s)||s.length!=t.length){var y=[],b={},w={};for(var r=0;r<t.length;r++){y[r]=f.sdbmCode(t[r]);b[y[r]]=r}g.filter("*:not(.ui-sortable-placeholder)").each(function(e,t){var n=$(this),r=n.data("formlist")||{},i=r.sdbmCode;if(i&&b.hasOwnProperty(i))w[i]=$(this);else n.remove()});for(var r=0;r<t.length;r++){if(w[y[r]]){var E=w[y[r]].detach().appendTo(e);m.push(E.my("data"))}else{var E=$(/\{/.test(p)?p.assign(t[r]):p).appendTo(e);E.data("formlist",{index:r});E.on("change.my",function(){if($(this).data("my")){$(this).data("formlist").sdbmCode=f.sdbmCode($(this).my("data"))}e.trigger("check.my")}.debounce(d/1.3));E.data("formlist").list=t[r];E.my(_manifest(c.parent,c.manifest,t[r],r,t,e),t[r]);m.push(E.my("data"))}}return m}}return i}else if(g.size()){g.filter("*:not(.ui-sortable-placeholder)").each(function(e){var t=$(this);if(t.is(".my-form")&&t.data("my")){m.push(t.my("data"));if(e!=t.data("formlist").index){t.data("formlist").index=e;t.my("redraw")}}});return m}return t||[]},".ui-sortable":function(e,t){var r=[],i="ui-sortable",s=">."+i+"-placeholder",o=e.find(e.sortable("option","items"));if(n(t)&&isA(t)){var u={},a={},l=t.unique();if(e.find("input:focus:eq(0),textarea:focus:eq(0)").size()!=0||e.find(s).size()!=0)return l;o.each(function(){u[f.sdbmCode(f.extval($(this)))]=$(this)});for(var c=l.length-1;c>=0;c--){var h=f.sdbmCode(l[c]);if(u[h]){u[h].prependTo(e).show();a[h]=true;if(r.indexOf(l[c])==-1)r.push(l[c])}}r=r.reverse();for(c in u)if(!a[c])u[c].hide()}else{var p=e.find(s),d=e.eq(0);if(p.size()!=0){if(d.my()[i]!=p.position().left+""+p.position().top){var o=o.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");var v=e.find(e.sortable("option","items")).filter(".ui-sortable-helper");o.each(function(){var e=$(this);if(e.is(".ui-sortable-placeholder")){r.push(f.extval(v))}else r.push(f.extval(e))});d.my()[i]=p.position().left+""+p.position().top;d.my()[i+"1"]=r}else r=d.my()[i+"1"];if(r==N)o.each(function(){r.push(f.extval($(this)))})}else{var o=e.find(e.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");o.each(function(){r.push(f.extval($(this)))})}}return r},"input[type=date]":function(e,t){if(n(t)){if(t!="")r=Date.create(t).format(d8);else r="";if(isS(r)&&!r.has("Invalid"))e.val(r);return r}var r=e.val();return r!=""?Date.create(r).format(d8):""},"input[type=time]":function(e,t){if(n(t)){if(t!="")r=Date.create(t).format(h24);else r="";if(isS(r)&&!r.has("Invalid"))e.val(r);return r}var r=e.val();return r!=""?Date.create(r).format(h24):""},"input,button":{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){if(n(t))e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){if(n(t))e.val(t).trigger("update")},"div.select2-container+input":function(e,t){if(n(t)&&!(JSON.stringify(t)===JSON.stringify(e.select2("val"))))e.select2("val",isA(t)?t:[t]);return e.select2("val")},"":function(e,t){if(n(t))e.val(t)}},":radio":function(e,t){var r=-1;if(n(t)){e.each(function(e){var n=$(this).val();if(t+""===n+"")r=e});var i=e.eq(0).checkboxradio;if(i)e.each(function(e){var t=$(this);if(r!=e&&t.is(":checked"))t.attr("checked",false).checkboxradio("refresh")});if(r>-1){var s=e.eq(r);if(!s.is(":checked")){s.attr("checked",true);if(i)s.checkboxradio("refresh")}}else if(!i)e.each(function(){$(this).attr("checked",false)})}if(r==-1)for(var o=0;o<e.size();o++){if(e.eq(o).is(":checked"))r=o}return r!=-1?e.eq(r).val():""},":checkbox":function(e,t){var r=-1,i=t,s=[],o={};if(n(i)){if($.type(i)!=Ar)i=[t];var u=!!e.eq(0).checkboxradio;e.each(function(e){var t=$(this),n=t.val(),r=t.is(":checked");if(i.indexOf(n)!=-1){s.push(n);if(!r)t.attr("checked",true)}else if(r)t.attr("checked",false);if(u)t.checkboxradio("refresh")})}else{e.each(function(e){var t=$(this);if(t.is(":checked"))s.push(t.val())})}return s}},select:{".ui-slider-switch":function(e,t){if(n(t)){e.val(String(t||""));e.slider("refresh")}},"div.select2-container+select":{"[multiple]":function(e,t){if(n(t))e.select2("val",isA(t)?t:[t]);return e.select2("val")},"":function(e,t){if(n(t))e.select2("val",t+"");return e.select2("val")}},"[multiple]":function(e,t){if(n(t)){e.val(t,[]);if(e.selectmenu)e.selectmenu("refresh",true)}},"":function(e,t){if(n(t)){e.val(String(t||""));if(e.selectmenu){if(e.selectmenu("option").theme!=N)e.selectmenu("refresh",true);else e.find("option").each(function(n){var r=$(this);if(f.extval(r)==t)e.selectmenu("value",n)})}}}},textarea:{".my-cleditor":function(e,t){if(n(t))e.val(t).cleditor()[0].updateFrame();return e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");if(n(t)){if(r)e.redactor("set",t);else e.setCode(t);return t}return r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){if(n(t)){e[0].nextSibling.CodeMirror.setValue(t);return t}return e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){if(n(t))e.val(t)}},"div,span,a,p,form,fieldset,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){if(n(t))e.slider("option",e.slider("option","values")?"values":"value",f.clone(t));return f.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(e,t){if(!n(t)){var r=e.find(":radio:checked");if(r.size()&&r.button)return r.val()||r.button("option","label")}else if(t!=""){var i=N;e.find(":radio").each(function(){i=($(this).val()||$(this).button("option","label"))==t?$(this):i});if(i){i.attr("checked",true);e.buttonset("refresh");return t}}e.find(":radio:checked").attr("checked",false);e.buttonset("refresh");return""},".ace_editor":function(e,t){if(n(t))ace.edit(e[0]).setValue(t);return ace.edit(e[0]).getValue(t)},"":function(e,t){if(n(t))e.html(t);return e.html()}},"pre,code":function(e,t){if(n(t))e.html(t);return e.html()},img:function(e,t){if(n(t))e.attr("src",t);return e.attr("src")||""},"":function(e,t){if(n(t))e.html(t);return e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:TMP="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:TMP},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list,.ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my ","img, :radio, :checkbox":"click.my check.my ","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+(navigator.appName.to(5)==="Micro"?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(e){return e.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){f.jquix(t,"selectable",e)},".ui-slider":function(e,t){f.jquix(t,"slider",e)},".ui-draggable":function(e,t){f.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){f.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){f.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){f.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}}};MY.params={container:function(e){return _traverse(e,MY.containers)(e)},change:N,recalcDepth:2,delay:0,strict:false,locale:TMP=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(MY.msg,function(e,t){return t[TMP]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",pendingCss:"my-form-pending",animate:0,effect:function(e,t,n){if(t)return e.fadeIn(n);e.fadeOut(n)},remember:0,silent:false,history:Object.extended(),historyDelay:100};var f=_getHelpersLib();var methods={init:function(e,t,n){function O(){function r(t){if(!E){e[t]=_field(k.find(t),N);n-=1;if(n<.5)M(e)}}var e={},t,n=Object.size(c);k.addClass(h.pendingCss);Object.each(c,function(e,t){if(E)return;var n=k.find(e),i=_build(n,k,c[e],e);if(isP(i)){i.then(r.fill(e)).fail(function(t,n){_("Error building "+e+", "+t,n)})}else if(!E)r(e)})}function M(e){for(selector in c){if(E)return;var t=k.find(selector);if(t.size()){try{var n=c[selector];var r=_bind(l,N,n,t);if(r!=N)_field(t,r);else{try{if(e[selector]!=N&&r!==undefined)_bind(l,e[selector],n,t)}catch(i){}}t.eq(0).trigger("check.my")}catch(i){_("Error linking "+selector,i.stack)}}}k.removeClass(h.pendingCss);C=null;w.resolve(l)}function _(e,t){var n;E=true;f.con("Form "+s+" failed to initialize: "+e,t);k.removeClass(h.pendingCss);n=x(e,t);if(isS(n)||isO(n)&&n.jquery)k.html(n);else if(n===true)k.html(C);if(!h.silent){if(!k.my().ddata){k.removeData("my");k.removeClass("my-form");if(y){if(y.data("count")=="1"){try{y.remove()}catch(r){}}else y.data("count",y.data("count")-1)}if(b){try{b.remove()}catch(r){}}}w.reject("Form "+s+" failed to initialize: "+e,t)}else w.resolve(l)}var r,i,s,o,u,a,l,c,h,p,d,v,m,g,y,b,w=$.Deferred(),E=false,S,x=function(){},T="std",C="";if(isS(e)){r=_cache(e);if(r){if(isO(n)&&isO(t))r=$E(r,t),i=n;else i=t;T="repo"}else{w.reject("No manifest with id "+e+" found in repo.");return w.promise()}}else{r=e;i=t}if(!r)return this;if(isO(i)&&T!="repo")p=$E(true,{},r);else p=r;var k=this.eq(0),L=k.my();if(isO(L)&&L.id&&L.ui){f.con("jQuery.my is already bind.",k);k.my("ui",p.ui);k.my(Da,p.data);return w.resolve(k.my(Da)).promise()}if(!p.params||p.params&&!p.params.strict)_unjson(p);u=$E(true,{},p);h=$E(true,{},MY.params,p.params||{});c=_normalize($E(true,{},p.ui||{}),u);o=Number.random(268435456,4294967295).toString(16);s=p.id||"my"+o;l={};h.form=k;if(p.params&&p.params.depth)h.recalcDepth=p.params.depth;for(d in u)if(isF(u[d]))u[d].bind(u);if($.type(i)=="object"){l=f.patch(i,p.data||{});p.data=l}else l=p.data||{};if(p.error){if(isS(p.error)){x=function(){return p.error.assign(l)}}else if(isF(p.error)){x=function(e,t){a=null;try{a=p.error(e,t)}catch(n){a=h.messages.initFailed}return a}}}$.extend(k,w.promise());k.data("my",{id:s,cid:o,data:l,params:h,errors:Object.extended(),ui:Object.extended(c),disabled:false,manifest:u,promise:w.promise()});u.id=s;k.addClass("my-form");m="my-manifest-"+f.sdbmCode(s);g="my-form-"+o;k.addClass(g+" "+m);w.fail(function(){k.removeClass(g+" "+m)});if(u.style){v=_style(k,u,m,g);if(v&&v[0].length){y=$("style#"+m);if(!y.size()){y=$('<style id="'+m+'" data-count="0">'+"."+m+v[0].join(" \n."+m)+"\n"+"</style>").appendTo($("body"))}y.data("count",y.data("count")*1+1);k.data("my").style=y}if(v&&v[1].length){b=$("style#"+g);if(!b.size()){b=$('<style id="'+g+'" data-count="0">'+"."+g+v[1].join(" \n."+g)+"\n"+"</style>").appendTo($("body"))}k.data("my").localStyle=b}}if(p.init!=N){C=k.find(">*").clone();try{S=_prepare(u,p.init,k,p)}catch(A){_(isS(A)?A:A.message,A.stack);return k}}if(isP(S)){k.addClass(h.pendingCss);S.then(function(){O()},function(e,t){_(e,t)})}else O();if(!E){if(!k.my())return _("Internal error initializing controls",""),k;k.data("my").initial=$E(true,{},l);if($.mobile)$.mobile.changePage($.mobile.activePage)}return k},redraw:function(e,t){var n=this,r=n.my();if(r&&r.ui){r.ui.each(function(t){var i=n.find(t);_update(i,e?N:undefined,r.params.recalcDepth);if(!e){if(i.is(".my-form"))i.my("redraw");if(i.is(".my-form-list"))i.trigger("redraw");else i.trigger("check.my")}});if(!t&&e)n.trigger(Ch)}return n},data:function(e,t){var n=this;if(isO(e)){n.my().data=f.overlap(n.my().data,e);this.my("redraw",t)}return n.my().data},errors:function(){var e=$(this).my().errors,t={};for(var n in e){if(e[n]&&isS(e[n]))t[n]=e[n];if(isO(e[n])&&Object.keys(e[n]).length)t[n]=e[n]}return t},valid:function(){var e=$(this).my().errors,t={},n=0;for(var r in e){if(e[r]&&isS(e[r]))n++;else if(isO(e[r])&&Object.keys(e[r]).length)n++}return!n},reset:function(){try{f.kickoff(this.my().data,this.my().initial);this.my("redraw")}catch(e){return false}return true},id:function(e,t){if(isS(e))return _cache(e,t);else{var n=this.my();return n&&n.id?n.id:N}},remove:function(e){var t=this,n,r,i;if(this.my().root&&!this.my().ddata){t=this.my().root}i=t.my().data;if(n=t.my().style){if(n.data("count")=="1"){try{n.remove()}catch(s){}}else n.data("count",n.data("count")-1)}if(r=t.my().localStyle){try{r.remove()}catch(s){}}t.my().ui.each(function(e){var n=t.find(e);n.unbind(".my").removeData("my")});t.removeData("my").removeClass("my-form").unbind(".my");if(t.data("formlist")||e)t.remove();return i},undo:function(e){var t=this,n=t.my(),r=n.params.history,i=r.keys().sort(),s=1*(parseInt(e)||0);if(!i.length||s<0)return N;if(!n.params.errors||!n.params.errors.values().compact(true).length){if(r[i[i.length-1]].equals(Object.extended(n.data)))s+=1}else{if(!Object.extended(n.data).equals(Object.extended(n.lastCorrect)))s+=1}t.my().data=Object.merge(t.my().data,_history(s,n.params,true)||{});t.my("redraw");return t.my().data},ui:function(e){var t=this,n=t.my(),r=[],i;if(!n)return N;var s=$E(true,{},n.ui);if($.type(e)!=Ob)return n.ui;for(i in e)if(true||!s[i])r.push(i);n.ui=_normalize(f.overlap(n.ui,e));for(i=0;i<r.length;i++)_build(t.find(r[i]),t,n.ui[r[i]],r[i]);for(i in e)t.find(i).eq(0).trigger("check");return n.ui},disabled:function(e){var t=this,n=t.my();if(!n)return undefined;if(e==N)return n.disabled;if(!!e){for(var r in n.ui){var i=t.find(r).eq(0),s=i.my();if(s)s.predisabled=s.disabled;_css(true,i,":disabled")}t.addClass("my-disabled")}else{for(var r in n.ui){var i=t.find(r).eq(0),s=i.my(),o=false;if(s&&s.predisabled)o=true;_css(o,i,":disabled")}t.removeClass("my-disabled");t.my("redraw")}},find:function(t){var n=this,r=n.my(),i;if(r&&r.root)n=r.root;return n.find(t)},manifest:function(e){return e=="json"?f.tojson(this.my().manifest):this.my().manifest},version:function(){return _version},history:function(e,t){return _history(e,this.my().params,t)},val:function(e){return _field(this,e)},container:function(e){return _traverse(e,MY.containers)(e)},promise:function(e){if(isF(e))this.my().promise.then(e);return this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var n=this.is(".my-form-list")?this:this.my().root||this,r=n.is(".my-form-list")?n:n.parent(".my-form-list"),i=(n.data("formlist")||{}).index,s,o=t,u;if(null==i)i=0;s=_getref(r.my().data,r.data("formlist").generator.bind);if(!isO(o)){if(!isO(r.data("formlist").generator.manifest)){if(r===n)throw"No data to insert, cannot guess when manifest is function.";o=Object.clone(n.my().manifest.data,true)}else o=Object.clone(r.data("formlist").generator.manifest.data,true)||{}}if("before"===e)u=i;else if("after"===e)u=i+1;else if(!isNaN(e)){u=(1*e).clamp(0,s.length)}else throw"Invalid position for insert";s.add(o,u);r.trigger("redraw")}};if(!$.my)$.my={};$.extend($.my,{f:f,tojson:f.tojson,fromjson:f.fromjson,rules:MY,cache:function(e,t){if(isF(e))return _cache=e;else return _cache(e,t)}});$.fn.my=function(e){var t;if(e===undefined)return this.data("my");if(isS(e)&&e.substr(0,1)=="{"){try{t=JSON.parse(e)}catch(n){}if(t)return methods.init.apply(this,[t].add(Array.prototype.slice.call(arguments,1)))}if(isS(e)&&methods[e])return methods[e].apply(this,Array.prototype.slice.call(arguments,1));else if(isS(e)&&_cache(e,"exist"))return methods.init.apply(this,arguments);else if(typeof e===Ob||!e)return methods.init.apply(this,arguments);else $.error("Method "+e+" does not exist on jQuery.my")};return;})(jQuery);(function(e){function w(e,n,r){if(h(n))return e+n;if(p(n)){r=t(true,r,n);return e}else if(l(n)&&n.length>1&&h(n[1])){var i=n[0],s="",o,f,c,d,v=1,m,g,y,w;while(v<n.length){if(h(n[v])){d=n[v].replace(/\s/g,"");c=d.split(/[\.#]/i);f=r.alias[c[0]]||c[0];o=d.substr(c[0].length);if(/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(d)){y=b.tmpl[f]||b.tmpl[""];g={style:"","class":"",txt:""};w="";var E=p(n[v+1]);if(E){v+=1;for(m in n[v])if(b.attnames[m]!=="")g[b.attnames[m]||m]=n[v][m]}if(!g.style&&!g["class"]&&r.styles[f])g.style=r.styles[f];if(!g.id&&o.to(1)=="#")g.id=o.from(1).split(".")[0];if(!g["class"]&&o.has("."))g["class"]=(o.to(1)=="#"?o.substr(g.id.length+1):o).split(".").compact(true).join(" ");for(m in g)w+=m+'="'+g[m]+'" ';if(E)for(m in n[v])if(b.attnames[m]==="")g[m]=n[v][m];g.ext=w;if(!g.txt&&b.txt[f])g.txt=b.txt[f](g);g._tag=f;s+=typeof y==a?y(g)||"":typeof y==u?y.assign(g):""}else s+=n[v]}v+=1}if(s){s="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&i?"padding-left:"+r.label+"; ":"")+'">'+(i?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+i+"</"+r.labelTag+">":"")+s+"</"+r.rowTag+">"}return e+s}return e}function E(e){var t=e;if(h(t)){t=t.split(/[\s,]/).compact(true)}if(l(t)){var n={};for(var r=0;r<t.length;r++){var i=t[r];if(p(i)){var s=Object.keys(i);if(s.length==1)n[s[0]]=i[s[0]]+"";else n[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else n[i]=i+""}t=n}if(p(t))return t;else return{}}function S(n,r){var i={};if(l(n)){t(true,i,b.params,r||{});var s=n.length?n.reduce(w.fill(undefined,undefined,i),""):"";return s}else if(p(n)){e.extend(b,n)}else return""}var t=e.extend,n=function(e){return e!==null&&e!==undefined},r=null,i="object",s="data",o="array",u="string",a="function",f="change",l=Object.isArray,c=Object.isBoolean,h=Object.isString,p=Object.isObject,d=Object.isNumber,v=Object.isRegExp,m=Object.isFunction;var g='<input type="',y=" {ext} ";var b={tmpl:{num:g+'number" {ext}/>',inp:g+'text" {ext}/>',sli:g+'range" {ext}/>',dat:g+'date" {ext}/>',btn:g+'button" {ext}/>',div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!l(e.vals))return"";var n=t({style:"",css:""},e);n.txt=e.vals.reduce(function(e,t){return e+'<span class="my-shortcut" '+"onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," ");return'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(n)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=E(e.vals);return Object.keys(t).reduce(function(e,n){return e+'<option value="'+n+'">'+t[n]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}};var x={init:function(t,n){return e(this).html(S(t,n))}};if(!e.my)e.my={};e.my.formgen=S;e.fn.formgen=function(t){if(h(t)&&x[t])return x[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return x.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.formgen")}})(jQuery);(function(e){function v(i){var s=window,o=s.innerHeight||e(s).height(),u=s.innerWidth||e(s).width(),a=n.height(),f=i||r.width();n.removeClass("loading").css({left:(u-f-60)/2+"px",width:f*1+60+"px",display:"block"});t.css({width:u*2+"px",height:o*2+"px",display:"block"});if(a>o){n.height(o);r.css({"overflow-y":"overlay"})}else{r.css({"overflow-y":"none"})}n.animate({top:(a>=o?0:(o-a)/3.5)+"px"},parseFloat(n.css("top"))<o?300:0)}var t,n,r,i={},s="body",o=false,u,a=Object.isArray,f=Object.isBoolean,l=Object.isString,c=Object.isObject,h=Object.isNumber,p=Object.isRegExp,d=Object.isFunction;$(document).keydown(function(e){if(e.keyCode==27&&$(s).find(">.my-modal").is(":visible")&&(!r.is(".my-form")||r.data("escapable")||Object.equal(r.data("my").initial,r.my("data"))))i.modal(true)});i.modal=function(a,h,p){var m=h||function(){return false},g,y=false,b=false,w=true,E="",S,x=p||820,T=300;if(o){if(f(a)||a===null||a===undefined){if(d(n.data("done")))m=n.data("done");else m=function(){return false};y=false,w=true;if(!a){if(!r.is(".my-form"))y=m(null,true);else{y=m(r.my("valid")?null:r.my("errors"),r.my("data"));if(!y)w=r.my("remove")}}else if(a===true&&u.state()!="rejected"){if(r.is(".my-form"))r.my("remove");m(null,null);u.reject("Cancelled")}if(!y){r.html("");n.css({display:"none"});(function(){if(!o)t.css({display:"none"})}).delay(5);o=false;n.data("done",null);(function(){u.resolve(w)}).delay(0)}return}g=$.Deferred();m(null,null);g.reject("Locked");return g.promise()}u=$.Deferred();o=true;if(!n||!$(s).find(">.my-modal").size()){n=$('<div class="my-modal" style="display:none;"></div>').prependTo($(s))}n.html('<div class="my-modal-form"></div>');r=n.find(".my-modal-form");$('<div class="my-modal-close" title="Close">×</div>').prependTo(n).on("click",function(){i.modal(true)});if(!t||!$(s).find(">.my-modal-screen").size()){t=$('<div class="my-modal-screen" style="display:none;"></div>').prependTo($(s)).on("click",function(){if(!r.is(".my-form")||r.data("escapable"))i.modal(true)})}if(typeof a=="object"&&a.jquery){if(a.is("img")){E=a.attr("alt")||a.attr("title")||a.data("text");r.html('<img src="'+a.attr("src")+'" style="width:'+x+'px"/>'+(E?"<h4>"+E+"</h4>":""));r.find("img").on("click",function(){i.modal()});n.css({top:"3000px",display:"block"});T=n.height();b=1}}else if(c(a)&&a.manifest){w=a.data||{};m=d(a.done)?a.done:m;x=1*($.my.f.getref(l(a.manifest)?$.my.cache(a.manifest):a.manifest,"params.width")||a.width||x);n.css({top:"3000px",display:"block"});r.data("my",null);b=1;r.my(a.manifest,w).then(function(){v.delay(20);u.notify("Ready")}).fail(function(e){u.reject(e);b=0;i.modal(true)});n.data("done",m);r.data("escapable",!!a.esc);r.bind("commit.my",function(){i.modal()}.debounce(50)).bind("cancel.my",function(){i.modal(true)}.debounce(50)).bind("layout.my",function(){v()})}else if(l(a)){r.html(a);n.css({top:"3000px",display:"block",width:"auto"});x=1*(n.width()||x);b=1}else if(a===true)return o=false,u.reject("Cancelled").promise();else return o=false,u.reject("Invalid data").promise();if(b){v(x);S=r.find("img").filter(function(){return $(this).attr("src")!=""});if(S.size()){var N=function(){v(p);u.notify("Ready")}.after(S.size());S.each(function(){$(this).bind("load",N)})}else{u.notify("Ready")}}return u.promise()};i.modal.loading=function(e){$(s).find(">.my-modal").toggleClass("my-modal-loading",!!e)};i.modal.parent=function(e){if(!e||!$(e).size())return $(s);s=e};i.modal.visible=function(){return o};if(!e.my)e.my={};e.my.modal=i.modal})(jQuery);