/* jQuery.my 1.1.0
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */

;(function(e){function M(e,t){return(t||"").split(".").reduce(function(e,t){if(null!=e&&null!=e[t])return e[t];else return undefined},e)}function _(e,t){var n,r;if(N(t))return t;else if(T(t)){n=M(e,t);if(null==n)n=Object.clone(o._src[t],true);if(null==n){n=M(o,t);if(N(n)&&N(n._self))n=Object.clone(n._self,true);else if(N(n))n=Object.clone(n,true)}if(null==n&&M(e,"params.cache")){r=M(e,"params.cache");if(L(r))n=r(t);else if(N(r))n=O(t,r);if(N(n)){if(N(n._self))n=Object.clone(n._self,true);Object.merge(n,{params:{cache:r}},true)}}if(null!=n&&N(n)){r=r||M(e,"params.cache");if(r)Object.merge(n,{params:{cache:r}},true);return n}else throw"Component "+t+" not found"}else if(L(t)){return t.apply(e,Array.prototype.slice.call(arguments,2))}else return null}function D(e,t){var n,r,i=t||o,u=e,a,f,l,c;if(!(N(i)&&N(u)&&N(u.ui)&&T(u.id)))return"Invalid arguments.";if(!i.hasOwnProperty("_src"))i._src={};f=u.id;try{u=Object.clone(e,true)}catch(h){return"Can’t mount circular-referencing obj."}try{if(!u.params||u.params&&!u.params.strict)G(u,true)}catch(h){return"Invalid manifest, parse error."}n=P(u);if(T(n)){B.con(n);return n}Object.merge(u,{params:{strict:true}},true);i._src[f]=u;if(l=B.mask(i,f)){if(l.params&&l.params.protect)return"Can’t mount on protected";if(l._self)delete l._self}Object.merge(i,B.unmask(u,f),true);c=M(i,f);if(s)c["_self"]=i._src[f];else Object.defineProperty(c,"_self",{get:function(){return i._src[f]},set:function(){throw"Can not change repo"},enumerable:false,configurable:true});return c}function P(e){var t,n=[],i;if(N(e.files)&&Object.size(e.files)){for(t in e.files){i=e.files[t];if(N(i)&&i.data&&!i.url){if(r){try{B.base642blob(i.data,function(e){i.blob=e;i.url=r.createObjectURL(i.blob)},i.content_type||i.mime);n.push(t)}catch(s){return"Invalid base64 data in files/"+t+"."}}else{i.url="data:"+(i.content_type||i.mime)+";base64,"+i.data;n.push(t)}}}}return n}function j(t,n){var r=false,i,s;if(N(n)&&n.channel&&n.message){t.find(".my-listen-"+B.sdbmCode(n.channel)).each(function(){var t=e(this),r=t.data("my"),i,s=undefined;if(r&&r.ui.listen&&L(r.ui.listen[n.channel])){i=r.ui.listen[n.channel];try{s=i.call(r.manifest||r.root.my().manifest,r.data,n.message,t)}catch(o){B.con("Listener failed: "+o.message,o.stack)}if(s!==undefined){if(s===null)t.trigger("check");else if(s)t.trigger("recalc")}}})}}function F(t,n){function b(t,n){var r;if(T(t)){if(/[\/]/.test(t)){r=a(true,{},g,{ref:n,ajax:{url:t}});if(E.test(n))r.ajax.dataType="json"}else if(t.length){r=a(true,{},g,{ref:n,ajax:t})}}else if(N(t)){r=a(true,{},g,{ref:n,ajax:e.extend(true,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username"]))});if(!r.ajax.url)r=null}return r}function w(){o.reject(l)}function x(){y+=1;var e=u[y];if(!e){var n=L(f),r=Object.keys(Object.findAll(n,function(e,t){return!t}));if(r.length)l.push((r.length===1?"Key "+r[0]+" is":"Keys "+r.join(", ")+" are")+" not present after all.");if(l.length)w();else o.resolve(t)}else C(e).then(x).fail(w)}function C(n){function h(){u-=1;if(s)o.reject();else if(u<.5)o.resolve()}var r,i,s=false,o=e.Deferred(),u=n.length,f,c;for(i=0;i<u;i++){r=n[i];f=T(r.ajax)?p.loader:e.ajax,c=N(r.ajax)&&/\.js$/i.test(r.ajax.url);f(r.ajax).then(function(e,n){if(E.test(n.ref)){if(e!=null){a(true,t,B.unmask(e,n.ref.from(5)))}else{s=true;l.push("Invalid data for ‘"+n.ref+"’ resource.")}}h()}.fill(undefined,r)).fail(function(e,t){l.push("Failed to load ‘"+t.ref+"’ resource.");s=true;h()}.fill(undefined,r))}return o.promise()}function k(e){var n=false;if(E.test(e)){if(M(t,e.from(5))!=null)n=true}else if(M(window,e)!=null)n=true;return n}function L(e){for(var t in e)if(e[t]===false)e[t]=k(t);return e}var r,i,s,o=e.Deferred(),u=[],f={},l=[],c,h,p=a(true,{ajaxTimeout:1e4,loader:H.params.loader},n||{}),d,v,m,g={ref:null,ajax:{type:"GET",async:true,timeout:p.ajaxTimeout}};if(!N(t))o.reject(["Invalid manifest."]);else if(!S(t.require))o.resolve(t);else{c=t.require;for(r=0;r<c.length;r++){h=c[r];if(T(h))f[h]=k(h);else if(N(h)){m=[];for(i in h){d=null;if(h[i]===true){f[i]=k(i)}else if(T(h[i])||N(h[i])){d=b(h[i],i)}else if(S(h[i])){d=[];for(s=0;s<h[i].length;s++){if(T(h[i][s])||N(h[i][s])){v=b(h[i][s],i);if(v)d.push(v)}}if(!d.length)d=null}if(d&&!(f[i]=k(i)))m.add(d)}if(m.length)u.push(m)}}var y=-1;x()}return o.promise()}function I(e,t){var n=e.data("myval"),r,i;if(!n){i=q(e,H.vals);if(L(i)){r=i(e,l);if(r===undefined){e.data("myval",function(e,t){if(l!=t)i(e,t);return e.val()}.fill(e,undefined))}else e.data("myval",i.fill(e,undefined))}n=e.data("myval")}if(L(n)){r=n();if(r!==t&&(false==t||false==r)||r!=t||N(t))r=n(t);return r}else return l}function q(e,t){function s(e,t,o){for(var u in t)if(u!=""&&e.is(u)){i=i+(i?" ### ":"")+u;var a=t[u],c=f(a);if(!/^(nul|un|ob)/.test(c)&&o>r){n=a;r=o;return}else if(c==v)s(e,a,o+1)}if(l!=t[""]&&typeof t[""]!=v&&o>r){n=t[""];r=o}}var n=l,r=0,i="";s(e,t,1);return n}function R(e,t,n,r){var i,s=[],o,u,a,c=n.bind,h=f(c);if(h==b){return c.call(z(r).manifest,e,t,r)}if(h===y||h===g){if(h===y&&!/\./.test(c)){if(t!=l)e[c]=t;else if(e[c]===undefined)e[c]=l;return e[c]}if(h===y)s=c.split(".").each(function(e,t){this[t]=e+""});if(h===g)s=c.slice(0).each(function(e,t){this[t]=e+""});if(s[0]==="this"){o=z(r).manifest;s.shift()}else o=e;for(i=0;i<s.length;i++){if(i===s.length-1){if(t!=l)o[s[i]]=t;else if(o[s[i]]===undefined)o[s[i]]=l;return o[s[i]]}if(i==0){u=o;o=o[s[0]]}else{u=u[s[i-1]];o=o[s[i]]}if(o===undefined)o=u[s[i]]={}}}return l}function U(t,n,r,i){var s=r.check,o,u;if(s!=l){var a=z(i).params.messages,c=r.error,h=c||a.patternMismatch||a[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var p=i[0].validationMessage+"";if(p!=="")return p.substr(0,1).toUpperCase()+p.substr(1);else{u=i[0].validity;for(o in u){if(p===""&&o!="valid"&&x(u[o])&&u[o]&&a[o])p=a[o]}return p||c}}switch(f(s).to(1)){case"f":{v=s.call(z(i).manifest,t,n,i);return v===null||v===undefined?"":v};case"r":return s.test(String(n))?"":h;case"a":return s.indexOf(n)>-1?"":h;case"s":return n==s?"":h;case"o":return s[n]?"":h;case"b":{if(i.is(".my-form-list,.ui-sortable")){var d=i.data("listSrc")||i.data("my").listSrc||">*",v={};i.find(d).filter("*:not(.ui-sortable-placeholder)").each(function(t){var n=e(this);if(n.data("my")&&!n.my("valid"))v[t]=n.my("errors")});return v}else if(i.hasClass("my-form")){return!s?"":i.my("valid")?"":i.my("errors")}return""}}return a.formError||"Error"}return""}function z(e){var t=e.my();if(!t)return null;return t.root?t.root.my():t}function W(t,n,r){var i=r.compact(),s=i.replace(/:disabled/g,""),o=s!==i,u=s.to(5)==="self:";if(u){s=s.replace(/^self:/g,"")}n.each(function(){var r=e(this),i=r.my(),a=!u&&i?i.container:r;a.toggleClass(s,!!t);if(o&&i!==undefined&&!!t!=!!i.disabled){r.my().disabled=!!t;if(!i._disable)r.my()._disable=q(n,H.offon).fill(undefined,n);i._disable(!!t)}});return n}function X(e,t,n){var r,i,s,o,u,f,c,p,d,v,m,g=false,y=false,b=e,w=b.my(),E="";if(w){p=w.selector;d=w.root;if(d.hasClass("my-form-init"))return{};v=d.find(p);m=d.my().ui;g=e.hasClass("my-form");y=e.hasClass("my-form-list");if(g){r=e;i=w.ddata;s=w.dui;o=w.dparams}else{r=w.container;i=w.data;s=w.ui;o=w.params}if(s.bind!=l){if(h(t))u=t;else u=I(v,R(i,l,s,v));if(l!=s.check){E="Unknown error";try{E=U(i,u,s,v)}catch(S){B.con("Error "+S.message+" validating "+p,d,S.stack)}}var x=o.errorCss;var N="ui-state-error";try{if(l!=t)u=I(v,R(i,t,s,v))}catch(S){E=o.messages.formError||"Error"}if(E===""){if(!g)w.errors[p]="";else w.derrors[p]="";r.removeClass(x);if(r.attr("title"))r.attr("title","");if(!g&&!y)o.effect(r.find(o.errorTip),false,o.animate/2);b.removeClass(N);b.find(".ui-widget").removeClass(N)}else{if(g)w.derrors[p]=E;else if(y)w.errors[p]=E;else{r.addClass(x);w.errors[p]=E;var C=r.find(o.errorTip).eq(0);if(C.size()){o.effect(C.addClass(x).html(E),true,o.animate)}else r.attr("title",(E||"").stripTags())}if(b.is(".hasDatepicker")){if(b.is("input"))b.addClass(N);else b.find(".ui-widget").addClass(N)}if(b.is(".ui-slider"))b.addClass(N)}}var A=t==l?u:t;if(s.css){for(f in s.css){c=s.css[f];if(k(c))W(c.test(A),v,f);else if(L(c))W(c.call(d.my().manifest,i,A,v),v,f)}}var O,M=s.recalc,_=[],D={},P;if(n&&s.recalc&&d.my()){m=d.my().ui;for(O=0;O<M.length;O++){if(M[O]&&T(M[O])&&(P=M[O].compact())&&m[P]){if(m[P].recalc){if(_.indexOf(P)===-1)_.push(P)}else D[P]=true}}for(O=0;O<_.length;O++)D=a(true,D,X(d.find(_[O]),l,n-1));if(t!==l){for(O in D)if(D[O]===true&&O!=p){if(m[O].delay&&!m[O].recalc)m[O]._update(d.find(O),l,n-1);else X(d.find(O),l,n-1)}return{}}}return D||{}}}function V(e,t,n,r){var i=t,s,o,u,a,f,c,h,p,d;if(!N(i)||isNaN(a=i.remember)||!N(s=i.history))return l;if(N(e)&&a){c=Object.clone(e,true);h=Date.now();u=Object.keys(s).sort();if(u.length&&(h-u.last()<i.historyDelay||Object.equal(s[u.last()],c)))return l;i.history[h]=c;u.push(h);if(u.length>=a*2){d={};for(o=a;o<a*2;o++)d[u[o]]=s[u[o]];t.history=d}if(!r)i.form.trigger(w);return i.history[u.last()]}else if(!isNaN(e)||e===l){f=parseInt(e)||0;if(f<0)return l;u=Object.keys(s).sort();if(f>=u.length)f=u.length-1;p=Object.clone(i.history[u[u.length-f-1]],true);if(n){d={};for(o=0;o<u.length-f-1;o++)d[u[o]]=s[u[o]];t.history=d}if(!r)i.form.trigger(w);return p}else if(!r)i.form.trigger(w);return l}function $(t,n,r,i){function y(){var n=null,r=u.manifest;if(L(r)||N(r)&&N(r.ui))v=r;else if(T(r)){v=_(m,r.replace(E,""))}if(v&&T(u.bind)){var a=M(E.test(u.bind)?m:s.data,u.bind.replace(E,""));if(c===null)c=e.Deferred();if(S(a)||u.list){t.addClass("my-form-list");var f="",l=">*";if(/^<.+>$/.test(u.list))f=u.list;else l=u.list||l;if(!f){var h=t.find(l);f="<div></div>";if(h.size()){f=e(f).append(h.eq(0).clone(true)).html();h.eq(0).remove()}}if(!t.data("formlist"))t.data("formlist",{});t.data("formlist").generator={manifest:v,delay:(u.delay||o.delay||10)/1.3,template:f,selector:l,parent:m,bind:u.bind,hash:L(u.hash)?u.hash.bind(m):x(u.hash),id:L(u.id)?u.id.bind(m):x(u.id),ext:!!(u.id||u.hash),stamp:0};t.on("insert.my",function(t,n){t.stopPropagation();var r={what:undefined,where:0};if(null==n)r.where=1e6;else if(N(n))Object.merge(r,n);else if(T(n)||C(n))r.where=n;e(t.target).my("insert",r.where,r.what)});t.on("remove.my",function(t){t.stopPropagation();e(t.target).my("remove")})}else{try{n=t.my(_(m,v),N(a)?a:undefined)}catch(p){b("$.my subform init of "+i+" failed: "+p.message,p.stack)}}}if(A(n)){n.then(k,function(e,t){b("Init of subform "+i+" failed with error: "+e,t)})}else k()}function b(e,t){B.con(e,t);if(c)c.reject(e,t)}function x(e){var t=f(e).to(3);return!e?null:t==="str"?M.fill(undefined,e):t==="arr"?B.mask.fill(undefined,e):null}function k(){t.each(function(){var f=e(this),c,h,d=false,v=f[0].nextSibling;h=v&&v.CodeMirror?v.CodeMirror:null;if(h)f.addClass("my-codemirror");c=u.events||q(f,H.events);if(!f.is(".my-form")){f.data("my",{events:c,selector:i,initial:p,previous:p,root:n,container:o.container(f),id:s.id,ui:u,data:s.data,params:o,errors:s.errors});r._update=u.delay?X.debounce(u.delay):l;d=true}else{a(f.data("my"),{dui:u,root:n,selector:i,dparams:o,devents:c,ddata:s.data,container:o.container(f),derrors:s.errors})}if(d){if(f.cleditor&&f.parent().is(".cleditorMain")){var m=f.cleditor()[0];if(m&&m.$frame&&m.$frame[0]){f.addClass("my-cleditor");a(f.data("my"),{container:o.container(f)});var y=function(e){f.val(e).trigger(w)};var b,E=Number.random(1e5,1e6-1);e(m.$frame[0]).attr("id","cleditCool"+E);if(!document.frames)b=e("#cleditCool"+E)[0].contentWindow.document;else b=document.frames["cleditCool"+E].document;var S=e(b).find("body");e(b).bind("keyup.my",function(){y(e(this).find("body").html())});f.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){y(S.html())});e("body").on("click","div.cleditorPopup",function(){y(S.html())})}}else if(f.is("div.redactor_box textarea")){var x,T="my-redactor-9";try{x=f.getEditor();T="my-redactor-8"}catch(N){x=f.redactor("getEditor")}if(x){f.addClass(T);x.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(f))}}else if(f.is(".ace_editor"))ace.edit(t[0]).on(w,function(e){e.trigger("ace")}.fill(f));else if(h){h.on(w,function(e){e.trigger("codemirror")}.fill(f))}}f.my()._changed=J.debounce(g);f.my()._recalc=K.debounce(g);f.bind(c,function(e){if(e.type==w)e.stopPropagation();if(d)s.locktill=Date.now()+r.delay;f.my()._changed(f,n,r,o)});if(!/check(\.my)?/.test(c+""))f.on("check.my",function(e){f.my()._changed(f,n,r,o,true);return false});f.on("recalc.my, redraw.my",function(e){e.stopPropagation();f.my()._recalc(f,n,r,o)})});if(c)c.resolve()}var s=n.my(),o=(s||{}).params,u=r,c=null,h,p,d=0,v,m=s.manifest,g;if(!s){B.con("Failed to find $root building "+i+" selector.");return null}g=r.delay;if(t.size()){if(u.init!=l)h=Q(m,u.init,t,s);if(A(h)){d+=1;c=e.Deferred();h.then(y,function(e,t){b("Init of "+i+" failed: "+e,t)})}else y()}else B.con("Not found "+i+" selector.",n);return c}function J(e,t,n,r,i){var s=e.data("my"),o=t.data("my");if(s&&!s.disabled){V(s.ddata||s.data,s.dparams||s.params);var u=t.find(s.selector);X(e,!i?I(u,l):l,n.recalcDepth||r.recalcDepth);if(undefined===o.orphan){if(s.root.parent().hasClass("ui-sortable")){o.orphan=!s.root.parent().hasClass("my-form-list")}}if(o.orphan)s.root.parent().trigger("check");if(r.change)r.change.call(e)}}function K(e,t,n,r){var i=e.my();if(i&&!i.disabled){var s=t.find(i.selector);if(s.is(".my-form"))s.my("redraw");else X(e,s.is(".my-form-list")?M(s.my().data,s.data("formlist").generator.bind):l,n.recalcDepth||r.recalcDepth)}}function Q(e,t,n,r){var i;if(T(t)){i=M(e,t);if(undefined===i){n.html(t.assign(r.data));return null}}else i=t;if(L(i))return i.apply(e,Array.prototype.slice.call(arguments,2));else if(S(i)){try{n.formgen(i)}catch(s){}}return null}function G(e,t){var n="",r,i="",s=!t,o=[];for(n in e)if(e.hasOwnProperty(n)&&(s||!/^(data|files|require)$/.test(n))){r=e[n];i=f(r);if(/^(ob|ar)/.test(i))G(r);else if(i==="string"&&/^(function\s\(|new\sRegExp)/.test(r)){if(o=r.match(/^function\s\(([^\)]*)\)\s*\{([\s\S]*)\}$/)){if(o.length===3){try{e[n]=Function(o[1],o[2])}catch(u){console.log(u.message,u.stack,r)}}}else if(o=r.match(/^new\sRegExp\(\/([\s\S]+)\/([a-z]*)\)$/)){if(o.length===3){try{e[n]=RegExp(o[1],o[2])}catch(u){console.log(u.message,u.stack,r)}}}}}o=null}function Y(e,t,n){var r=N(t)?t:null;Object.each(e,function(t,n){var r=typeof n;if(/^str|^fu/.test(r))e[t]={bind:n}});Object.each(e,function(t,i){var s=[],o=[],u,a=/\s?[,;]\s?/,f,l;if(i.recalc){if(T(i.recalc))s=i.recalc.split(a);else if(S(i.recalc))s=i.recalc;s=s.compact(true).unique()}if(s.length)e[t].recalc=s;if(null==i.bind)i.bind=function(){};var c;if(i.listen){c=Z(i.listen);if(Object.size(c))i.listen=c;else i.listen=undefined}if(i.watch){if(T(i.watch))o=i.watch.split(a);else if(S(i.watch))o=i.watch.slice(0);o=o.compact(true).unique();for(l=0;l<o.length;l++)if(u=e[o[l]]){f=u.recalc;if(!f)u.recalc=[t];else if(T(f))u.recalc+=","+t;else if(S(f)&&f.indexOf(t)==-1)u.recalc.push(t)}}if(null!==r)["css","check","manifest","list","hash","id"].each(function(e){if(T(i[e])){var t=M(r,i[e].replace(E,""));if(t!=null)i[e]=t}});i.delay=!isNaN(i.delay)?i.delay-0:n.delay});return e}function Z(e){var t,n={},r,i=function(){return null};if(T(e))e.split(/[,\s]+/).compact(true).unique().map(function(e){n[e]=i});else if(S(e))e.compact(true).unique().map(function(e){n[e]=i});else if(N(e)){for(t in e){if(!L(e[t]))n[t]=function(){return e[t]};else n[t]=e[t]}}return n}function et(e){var t=e,n={};if(T(t))t=t.split(/[,\s]+/);if(S(t)){t=t.compact(true);for(i=0;i<t.length;i++)n[t[i]]=true;return n}else if(N(t))return e;else return null}function tt(e,t,n){function o(n,r,i,s){var a,f,l,c,h=n;if(T(h)){if(/[\r\n]/.test(h)||h.split("}",3).length>2){h=B.css2json(h)}else i.push(r+(/\{/.test(h)?h:"{"+h+"}"))}if(S(h)&&h.length){for(a=0;a<h.length;a++)o(h[a],r,i,s)}else if(N(h)){for(a in h){c=u(r,a);for(f=0;f<c.length;f++)o(h[a],c[f],i,s)}}else if(L(h)){try{l=h.call(t,e,t);o(l,r,s,s)}catch(p){}}}function u(e,t){var n="",r=t+"",i;if(" "===r.to(1)||/^[a-z]/i.test(r))n=" ";i=r.split(/\s*,\s*/).compact(true);if(!i.length)i.push("");return i.map(function(t){return e+n+t})}var r=[],i=[],s=t;if(!N(s)||!N(s.style))return"";o(t.style,"",r,i);return[r,i]}function rt(){return{con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();if(t&&t.data)return t.data;return e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,n){return e[t](n?"disable":"enable")},overlap:function(e,t){function r(e,t,n){if(n===undefined||n===null)return t;if(!N(n))return n;else return Object.merge(t,n,false)}if(!arguments.length)return{};if(arguments.length===1)return arguments[0];for(var n=1;n<arguments.length;n++)Object.merge(arguments[0],arguments[n],false,r);return arguments[0]},patch:function t(e,n){for(var r in n){if(n.hasOwnProperty(r)){if(N(n[r])){if(!e.hasOwnProperty(r))e[r]=Object.clone(n[r],true);else t(e[r],n[r])}else if(!e.hasOwnProperty(r)){if(S(n[r]))e[r]=n[r].clone(true);else e[r]=n[r]}}}return e},kickoff:function(e,t){var n=t&&typeof t=="object"?Object.clone(t,true):{},r;for(r in e)if(e.hasOwnProperty(r)){delete e[r];if(n[r]!==undefined)e[r]=n[r]}},sdbmCode:function(e){for(var t=JSON.stringify(e),n=0,r=0;r<t.length;r++)n=t.charCodeAt(r)+(n<<6)+(n<<16)-n;return(1e11+n).toString(36)},tojson:function(){function e(e){return e<10?"0"+e:e}function r(e,i,s){var o=0,u,a,f,l,c=i||0,h=t;if(s&&T(s)){o=String(s).length;h=String(s).repeat(10)}switch((typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e)+"":"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\(.*)/,"$1 $3").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===b)return r(e.toJSON(),c+(s?1:0),s);u=[];if(S(e)){for(a=0;a<e.length;a+=1){u.push(r(e[a],c+(s?1:0),s)||"null")}return"["+u.join(","+(s?"\n"+h.to(c*o+o):""))+"]"}for(f in e)if(T(f)){l=r(e[f],c+(s?1:0),s);if(l)u.push((s?"\n"+h.to(c*o+o):"")+r(f,c+(s?1:0),s)+": "+l)}return"{"+u.join(",")+(s?"\n"+h.to(c*o):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"};RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var t="	".repeat(10),n=JSON.stringify;return r.fill(undefined,0,undefined)}(),fromjson:function(e){var t=JSON.parse(e);G(t);return t},mask:function(e,t){function s(e,t){if(!N(t))return{};var n={};for(var r in t){if(!N(t[r])&&e.hasOwnProperty(r)){n[r]=Object.clone(e[r],true)}else if(e.hasOwnProperty(r)){if(N(e[r]))n[r]=s(e[r],t[r]);else n[r]=Object.clone(e[r],true)}}return n}if(!N(e))return null;var n,r=t;if(T(r)){return M(e,r)}else if(S(r)){n=[];for(var i=0;i<r.length;i++){n[i]=T(r[i])?M(e,r[i])||null:null}return n}else if(N(r))return s(e,r)},unmask:function(e,t){function i(e,t,n){var r,i,s,o=Object.clone(t,true),u=0;if(!/\./.test(n)){if(null!=t)e[n]=o}else{i=n.split(".").each(function(e,t){this[t]=String(e).compact()});r=e;for(;u<i.length;u++){if(u===i.length-1)r[i[u]]=o;if(u===0)r=e[i[0]],s=e;else s=s[i[u-1]],r=r[i[u]];if(undefined===r)r=s[i[u]]={}}}return e}var n={};if(N(e)&&N(t))return B.mask(e,t);else if(S(e)&&S(t)){for(var r=0;r<t.length;r++){if(e[r]!=null)i(n,e[r],t[r])}return n}else if(T(t))return i({},e,t);else return null},getref:M,require:F,repo:function(){return o},restyles:function(){return u},unjson:function(e){G(e);return e},blob2base64:function(e,t,n){var r=new FileReader;r.onload=function(){t(n?r.result:r.result.split(",")[1])};r.readAsDataURL(e)},base642blob:function(e,t,n){var r=atob(e),i=r.length,s=new ArrayBuffer(i),o=new Uint8Array(s),u;for(var a=0;a<i;a++)o[a]=r.charCodeAt(a);u=new Blob([o],{type:n||"application/octet-stream"});if(L(t))t(u);else return u},base64:function(t,n,r){var i=f(t),s=null,o=T(t)?t:e.my.tojson(t),u=T(r)?"data:"+r+";base64,":"";if(n){try{s=decodeURIComponent(escape(window.atob(o)))}catch(a){s=null}if(null!==s&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(s)){try{s=e.my.fromjson(s)}catch(a){s=null}}return s}return u+window.btoa((r===true?"ï»¿":"")+unescape(encodeURIComponent(o)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(true).reduce(function(e,t){var n=t.trim(),r,i,s;if(/^[^{]+\{[^\}]+\}$/.test(n)){r=n.to(-1).split("{");i=" "+r[0].trim();s=r[1].trim();if(s.last()!=";")s+=";";if(!e[i])e[i]="";e[i]+=s}return e},{});return t}}}var t="jQuery.my 1.1.0";var n="en",r=window.URL||window.webkitURL,s=!document.addEventListener,o=M(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Global manifest cache"},u=M(e,"my.f.restyles")?e.my.f.restyles():{},a=e.extend,f=e.type,l=null,c,h=function(e){return e!==null&&e!==undefined},p="{yyyy}-{MM}-{dd}",d="{HH}:{mm}",v="object",m="data",g="array",y="string",b="function",w="change",E=/^this\./,S=Object.isArray,x=Object.isBoolean,T=Object.isString,N=Object.isObject,C=Object.isNumber,k=Object.isRegExp,L=Object.isFunction,A=function(e){return!!(null!=e&&(N(e)||e.jquery)&&L(e.then)&&L(e.fail)&&L(e.state))};var O=function(t,n){var r,i;if(T(t)){r=t;i=M(N(n)?n:o,r);if("exist"===n)return N(i);return!i?null:Object.clone(i,true)}else if(N(t)){i=D(t,n);if(!N(i)){console.log(i);return null}return i}else if(undefined===t){return o._src}else if(null===t){return Object.reject(o,/^_/)}else return null};var H={vals:{".my-form":function(e,t){if(e&&e.my){var n=e.my(m);return Object.equal(n,t)?n:e.my(m,t,true)}else return t||l},".hasDatepicker":function(e,t){if(h(t))e.datepicker("setDate",t==""?t:Date.create(t));var n=e.datepicker("getDate");return n?n.format(p):""},".my-tags":function(e,t){if(h(t)){if(T(t)||C(t))e.tags(m,[t+""]);else if(S(t))e.tags(m,t)}return e.tags(m)},".ui-draggable":function(e,t){if(h(t)&&N(t)){var n={};if(!isNaN(t.left))n.left=Number(t.left).ceil(2)+"px";if(!isNaN(t.top))n.top=Number(t.top).ceil(2)+"px";if(n.left||n.top)e.css(n)}var r=e.position();return{left:t&&!isNaN(t.left)?(t.left*1).ceil(2):r.left.ceil(2),top:t&&!isNaN(t.top)?(t.top*1).ceil(2):r.top.ceil(2)}},".my-form-list":function(t,n){function H(){var n=e(this),r,i,s=n.data("my");if(s){r=n.data("formlist");i=r.index;r.hash=m(s.data,i)+"";if(g!==m)r.oid=g(s.data,i)+"";else r.oid=r.hash}t.trigger("check.my")}function j(e){if(e.data("my").locktill+b/1.3<k)e.my("redraw")}var r,i,s,o,u=0,a="ui-sortable",f="."+a+"-placeholder",l=t.data("formlist")||{},c=l.generator||{},p=c.selector||">.my-form",d=c.template||"<div></div>",v=/\{/.test(d),m=c.hash||B.sdbmCode,g=c.id||B.sdbmCode,y=c.ext,b=c.delay||50,w=t.is("."+a),E=!!t.children(f).size(),x=[],T=[],N,C,k=Date.now();var L=w?t.find(t.sortable("option","items")):t.find(p);if(h(n)&&S(n)){if(E)return n;i=[];L.each(function(){var t=e(this),n=t.data("my");if(n)i.push(n.data)});o=false;if(i.length===n.length)for(o=true,r=0;r<i.length;r++)if(i[r]!==n[r])o=false;if(!o||y){s=e.extend(true,[],i,n);if(!Object.equal(i,s)||s.length!=n.length){var A=[],O=[],M={},D={};T=[];for(r=0;r<n.length;r++){O[r]=g(n[r],r)+"";M[O[r]]=r;A[r]=(g!==m?m(n[r],r):O[r])+""}L.each(function(){var t=e(this),n=t.data("formlist")||{},r=n.oid;if(r&&M.hasOwnProperty(r))D[r]=e(this);else{if(t.is(".my-form"))t.my("remove",true);else t.remove()}});for(r=0;r<n.length;r++){if(D[O[r]]){N=D[O[r]].detach().appendTo(t);x.push(N.my("data"));if(A[r]!==(N.data("formlist")||{}).hash)T.push(N)}else{N=e(v?d.assign(n[r]):d).appendTo(t);N.data("formlist",{list:n[r],index:r,hash:A[r],oid:O[r]});N.my(_(c.parent,c.manifest,n[r],r,n,t),n[r]).then(function(e){e.on("change.my",H.debounce(b/1.3))}.fill(N));x.push(N.my("data"))}}if(T.length&&y){for(r=0;r<T.length;r++)j(T[r]);T=[]}return x}}return i}else if(L.size()){if(k-c.stamp>1.4*b||k-c.stamp>100||!c.stashed||c.stashed.length!==L.size()-(E?1:0)){if(E)C=t.find(">."+a+"-helper");var P=0;L.each(function(t,n){var r=e(n),i,s,o,u=false;if(!E||!r.hasClass(a+"-helper")){if(E&&r.hasClass(a+"-placeholder"))r=C;i=r.data("my");s=r.data("formlist");if(i&&s){x.push(i.data);if(P!=s.index){s.index=P;u=!0}if(y){o=m(i.data,P)+"";if(o!==s.hash){s.hash=o;u=!0}}P+=1;if(u)T.push(r)}}});for(r=0;r<T.length;r++)j(T[r]);T=[];c.stamp=k;c.stashed=x}else x=c.stashed.slice(0);return x}return n||[]},".ui-sortable":function(t,n){var r=[],i="ui-sortable",s=">."+i+"-placeholder",o=t.find(t.sortable("option","items")),u;if(h(n)&&S(n)){var a={},f={},c=n.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(s).size())return c;o.each(function(){a[B.sdbmCode(B.extval(e(this)))]=e(this)});for(var p=c.length-1;p>=0;p--){var d=B.sdbmCode(c[p]);if(a[d]){a[d].prependTo(t).show();f[d]=true;if(r.indexOf(c[p])==-1)r.push(c[p])}}r=r.reverse();for(p in a)if(!f[p])a[p].hide()}else{var v=t.find(s),m=t.eq(0);if(v.size()!=0){if(m.my()[i]!=v.position().left+""+v.position().top){o=o.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");u=t.find(t.sortable("option","items")).filter(".ui-sortable-helper");o.each(function(){var t=e(this);if(t.is(".ui-sortable-placeholder")){r.push(B.extval(u))}else r.push(B.extval(t))});m.my()[i]=v.position().left+""+v.position().top;m.my()[i+"1"]=r}else r=m.my()[i+"1"];if(r==l)o.each(function(){r.push(B.extval(e(this)))})}else{o=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");o.each(function(){r.push(B.extval(e(this)))})}}return r},"input[type=date]":function(e,t){if(h(t)){if(t!="")n=Date.create(t).format(p);else n="";if(T(n)&&!/Invalid/.test(n))e.val(n);return n}var n=e.val();return n!=""?Date.create(n).format(p):""},"input[type=time]":function(e,t){if(h(t)){if(t!="")n=Date.create(t).format(d);else n="";if(T(n)&&!/Invalid/.test(n))e.val(n);return n}var n=e.val();return n!=""?Date.create(n).format(d):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){if(h(t))e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){if(h(t))e.val(t).trigger("update")},"div.select2-container+input":function(e,t){if(h(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val")))e.select2("val",S(t)?t:[t]);return e.select2("val")},"":function(e,t){if(h(t))e.val(t+"")}},":radio":function(t,n){var r=-1;if(h(n)){t.each(function(t){var i=e(this).val();if(n+""===i+"")r=t});var i=t.eq(0).checkboxradio;if(i)t.each(function(t){var n=e(this);if(r!=t&&n.is(":checked"))n.prop("checked",false).checkboxradio("refresh")});if(r>-1){var s=t.eq(r);if(!s.is(":checked")){s.prop("checked",true);if(i)s.checkboxradio("refresh")}}else if(!i)t.each(function(){e(this).prop("checked",false)})}if(r==-1)for(var o=0;o<t.size();o++){if(t.eq(o).is(":checked"))r=o}return r!=-1?t.eq(r).val():""},":checkbox":function(t,n){var r=-1,i=n,s=[];if(h(i)){if(!S(i))i=[n];var o=!!t.eq(0).checkboxradio;t.each(function(t){var n=e(this),r=n.val(),u=n.is(":checked");if(i.indexOf(r)!=-1){s.push(r);if(!u)n.prop("checked",true)}else if(u)n.prop("checked",false);if(o)n.checkboxradio("refresh")})}else{t.each(function(){var t=e(this);if(t.is(":checked"))s.push(t.val())})}return s}},select:{".ui-slider-switch":function(e,t){if(h(t)){e.val(t+"");e.slider("refresh")}},"div.select2-container+select":{"[multiple]":function(e,t){if(h(t))e.select2("val",S(t)?t:[t]);return e.select2("val")},"":function(e,t){if(h(t))e.select2("val",t+"");return e.select2("val")}},"[multiple]":function(e,t){if(h(t)){e.val(t,[]);if(e.selectmenu&&e.data("uiSelectmenu"))e.selectmenu("refresh",true)}},"":function(t,n){if(h(n)){t.val(n+"");if(t.selectmenu){if(t.data("uiSelectmenu"))t.selectmenu("refresh",true);else t.find("option").each(function(r){var i=e(this);if(B.extval(i)==n)t.selectmenu("value",r)})}}}},textarea:{".my-cleditor":function(e,t){if(h(t))e.val(t).cleditor()[0].updateFrame();return e.val()},"div.redactor_box textarea,.redactor":function(e,t){var n=e.hasClass("my-redactor-9");if(h(t)){if(n)e.redactor("set",t);else e.setCode(t,false);return t}return n?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){if(h(t)){e[0].nextSibling.CodeMirror.setValue(t);return t}return e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){if(h(t))e.val(t+"")}},"fieldset,form,section,aside,.my-container":function(e,t){var n=Array.prototype.slice.call(e[0],0).sort(),r=t;if(h(t)){if(T(t))r=t.split(/[,\s]+/).compact(true);if(S(r)){r.sort();if(r.join(" ")!==n.join(" ")){e.atrr("css",r.join(" "));n=r}}}return n},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){if(h(t))e.slider("option",e.slider("option","values")?"values":"value",B.clone(t));return B.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,n){if(!h(n)){var r=t.find(":radio:checked");if(r.size()&&r.button)return r.val()||r.button("option","label")}else if(n!=""){var i=l;t.find(":radio").each(function(){i=(e(this).val()||e(this).button("option","label"))==n?e(this):i});if(i){i.attr("checked",true);t.buttonset("refresh");return n}}t.find(":radio:checked").attr("checked",false);t.buttonset("refresh");return""},".ace_editor":function(e,t){if(h(t))ace.edit(e[0]).setValue(t);return ace.edit(e[0]).getValue(t)},"":function(e,t){if(h(t))e.html(t);return e.html()}},"pre,code":function(e,t){if(h(t))e.html(t);return e.html()},img:function(e,t){if(h(t))e.attr("src",t);return e.attr("src")||""},"":function(e,t){if(h(t))e.html(t);return e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:c="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:c},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+(navigator.appName.to(5)==="Micro"?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var n=t[0].parentNode,r=n.nodeName;if(/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(r))return e(n);else return t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){B.jquix(t,"selectable",e)},".ui-slider":function(e,t){B.jquix(t,"slider",e)},".ui-draggable":function(e,t){B.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){B.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){B.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){B.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")});t.removeClass("my-form-list");t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor();e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea();e.removeClass("my-codemirror")}}}};H.params={container:function(e){return q(e,H.containers)(e)},change:l,recalcDepth:2,delay:0,strict:false,restyle:-1,locale:c=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(H.msg,function(e,t){return t[c]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,n){if(t)return e.fadeIn(n);e.fadeOut(n)},remember:0,silent:false,history:{},historyDelay:100,loader:function(t,n){var r=e.Deferred(),i=O(t+"");if(i)r.resolve(i);else r.reject(null);return r.promise()},ajaxTimeout:1e4};var B=rt();B.require=F;var nt={init:function(t,n,i){function rt(e){var t,n={},r,i=true,s=e.inherit,o,u,f,l;n=et(s);if(!Object.size(n))return null;u=K.parents(".my-form").eq(0);if(!u.size())return null;f=u.data("my");if(!f||!f.manifest)return null;o=f.manifest;r=o.expose;i=!r;for(t in n){if(i||r[t]){l=M(o,t);if(l!=null){if(!/\./.test(t)&&!T(n[t]))e[t]=l;else a(true,b,B.unmask(l,T(n[t])?n[t]:t))}}}}function it(){var e,t;for(var e in S){for(t in g[e].listen){S[e].addClass("my-listen-"+B.sdbmCode(t))}}if(p.radio){K.on("radio.my",function(e,t){var n=false,r,i;if(N(t)&&t.channel&&t.message&&L(p.radio[t.channel])){r=p.radio[t.channel];try{i=r.call(p,e,t)}catch(s){B.con("Radio handler failed: "+s.message,s.stack)}if(i!==undefined){e.stopPropagation();if(i)j(K,t)}}})}}function st(){if(!y.strict)G(b,true);p=a(true,p,Object.reject(b,["data"]));g=Y(a(true,{},b.ui||{}),p,y);if(p.radio)p.radio=Z(p.radio);if(p.expose)p.expose=et(p.expose);c=Number.random(268435456,4294967295).toString(16);f=b.id||"my"+c;h=B.sdbmCode(f);p.id=f;y.form=K;if(b.params&&b.params.depth)y.recalcDepth=b.params.depth;for(w in p)if(L(p[w]))p[w]=p[w].bind(p);if(b.error){if(T(b.error)){W=function(e,t){return b.error.assign(a({message:e+"",err:t+""},b))}}else if(L(b.error)){W=function(e,t){d=null;try{d=b.error(e,t)}catch(n){d=y.messages.initFailed}return d}}}a(K.data("my"),{id:f,cid:c,mid:h,errors:Object.extended(),ui:Object.extended(g),disabled:false,manifest:p,locFiles:[],modals:{},radio:{}});K.addClass("my-form");C="my-manifest-"+h;k="my-form-"+c;K.addClass(k+" "+C)}function ot(t){function r(e,t){return'<style id="'+t+'" data-count="0">'+"."+t+e.join(" \n."+t)+"\n"+"</style>"}var n="";if(p.style){x=tt(K,p,C,k);if(x&&x[0].length&&!t){_=e("style#"+C);if(!_.size()){_=e(r(x[0],C)).appendTo(e("body"))}_.data("count",_.data("count")*1+1);K.data("my").style=_}if(x&&x[1].length){D=e("style#"+k);if(!D.size()){D=e(r(x[1],k)).appendTo(e("body"));if(y.restyle>-1&&!u[c]){u[c]=function(){ot(true)}.debounce(y.restyle)}K.data("my").restyle=ot.fill(true).debounce(0)}else if(t){e(r(x[1],k)).replaceAll(D);D=e("style#"+k)}K.data("my").localStyle=D}}}function ut(){var t,n=e.Deferred(),i;i=P(p);if(T(i)){ct("Error decoding base64 to local Blob/URL",i);n.reject()}else{if(r)for(t=0;t<i.length;t++)E.push(p.files[i[t]].url);if(E.length)K.data("my").locFiles=E;n.resolve()}return n.promise()}function at(){if(b.init!=l){J=K.find(">*").clone();try{z=Q(p,b.init,K,b)}catch(t){ct(T(t)?t:t.message,t.stack);return K}}if(A(z)){z.then(function(){ft()},function(e,t){ct(e,t)})}else ft();if(!U){if(!K.my())return ct("Internal error initializing controls",""),K;K.data("my").initial=a(true,{},v);if(e.mobile)e.mobile.changePage(e.mobile.activePage)}}function ft(){function n(n){if(!U){e[n]=I(K.find(n),l);t-=1;if(t<.5)lt(e)}}var e={},t=Object.size(g);K.addClass(X);Object.each(g,function(e){if(U)return;var t=K.find(e),r=$(t,K,g[e],e);if(A(r)){r.then(n.fill(e)).fail(function(t,n){ct("Error building "+e+", "+t,n)})}else if(!U)n(e)})}function lt(e){var t,n,r;for(var i in g){if(U)return;t=g[i];r=K.find(i);if(r.size()){if(t.listen)S[i]=r.eq(0);try{n=R(v,l,t,r);if(n==l&&e[i]!=l&&n!==undefined)R(v,e[i],t,r)}catch(s){B.con("Transient fail linking "+i+" of form $('.my-form-"+c+"')",s.message,s.stack)}try{if(n!=l)I(r,n);r.eq(0).trigger("check.my")}catch(s){ct("Error linking "+i,s.message,s.stack)}}}K.removeClass(X);J=null;q.resolve(v)}function ct(e,t){var n;U=true;B.con("Form "+f+" failed to initialize: "+e,t);K.removeClass(X);n=W(e,t);if(T(n)||N(n)&&n.jquery)K.html(n);else if(n===true)K.html(J);if(!y.silent){if(!K.my().ddata){K.removeData("my");K.removeClass("my-form");if(_){if(_.data("count")=="1"){try{_.remove()}catch(r){}}else _.data("count",_.data("count")-1)}if(D){try{delete u[c];D.remove()}catch(r){}}}q.reject("Form "+f+" failed to initialize: "+e,t)}else q.resolve(v)}var s,o,f,c,h,p={},d,v={},g,y,b,w,E=[],S={},x,C,k,_,D,q=e.Deferred(),U=false,z,W=function(){},X="my-form-init",V="std",J="";if(T(t)){s=O(t);if(s){if(N(i)&&N(n)){s=a(s,n);o=i}else o=n;V="repo"}else{q.reject("No manifest with id "+t+" found in repo.");return q.promise()}}else{s=t;o=n}if(!s)return this;if(N(o)&&V!="repo")b=a(true,{},s);else b=s;var K=this.eq(0),nt=K.my();if(N(nt)&&nt.id&&nt.ui){B.con("jQuery.my is already bind.",K);K.my("ui",b.ui);K.my(m,b.data);return q.resolve(K.my(m)).promise()}y=b.params||{};if(!y.strict){y=a(true,{},y);G(y)}y=a(true,{},H.params,y);q.fail(function(){K.removeClass(k+" "+C)});a(K,q.promise());if(N(o)){v=B.patch(o,b.data||{});b.data=v}else v=b.data||{};p.data=v;K.data("my",{data:v,params:y,promise:q.promise(),locktill:0});K.addClass(X);if(b.inherit)rt(b);F(b,y).then(function(){st();ut().then(function(){ot();at()})}).fail(function(e){st();ct("Linker of ‘require’ property failed.",e)});q.then(it);return K},redraw:function(e,t){var n=this,r=n.my();if(r&&r.ui){r.ui.each(function(t){var i=n.find(t);X(i,e?l:undefined,r.params.recalcDepth);if(!e){if(i.is(".my-form"))i.my("redraw");if(i.is(".my-form-list"))i.trigger("redraw");else i.trigger("check.my")}});if(!t&&e)n.trigger(w)}return n},data:function(e,t){var n=this;if(N(e)){n.my().data=B.overlap(n.my().data,e);this.my("redraw",t)}return n.my().data},errors:function(){var t=e(this).my().errors,n={};for(var r in t){if(t[r]&&T(t[r]))n[r]=t[r];if(N(t[r])&&Object.keys(t[r]).length)n[r]=t[r]}return n},valid:function(){var t=e(this).my().errors,n=0;for(var r in t){if(t[r]&&T(t[r]))n++;else if(N(t[r])&&Object.keys(t[r]).length)n++}return!n},reset:function(){try{B.kickoff(this.my().data,this.my().initial);this.my("redraw")}catch(e){return false}return true},id:function(e,t){if(T(e))return O(e,t);else{var n=this.my();return n&&n.id?n.id:l}},remove:function(e){var t=this,n,r,i,s,o,a,f,c;if(!this.my())return l;if(this.my().root&&!this.my().ddata)t=this.my().root;i=t.my();o=i.data;f=i.cid;c=i.mid;t.unbind(".my");if(N(i)&&i.manifest&&L(i.manifest.die)){try{i.manifest.die.call(i.manifest,t,i.manifest)}catch(h){}}if(n=i.style){if(n.data("count")=="1"){try{n.remove()}catch(h){}}else n.data("count",n.data("count")-1)}if(r=i.localStyle){try{delete u[f];r.remove()}catch(h){}}if(window.URL&&(s=i.locFiles)&&s.length){for(var p=0;p<s.length;p++){try{URL.revokeObjectURL(s[p])}catch(h){}}}a=(i||{}).ui;if(a){a.each(function(e){var n=t.find(e),r,i,s;if(i=n.data("modal")){i.cancel();n.removeData("modal")}if(i=n.data("modals")){for(s in i)if(i[s])i[s].cancel()}n.unbind(".my");try{r=q(n,H.destroy);if(L(r))r(n)}catch(o){}n.removeData("formlist").removeData("myval").removeData("my")})}if(e&&t.is(".my-form")){t.remove()}else if(t.data("formlist")&&t.is(".my-form")){var d=t.parents(".my-form-list").eq(0);t.remove();d.trigger("check")}else{t.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form")}t.removeClass("my-form-"+f+" my-manifest-"+c);return o},undo:function(e){var t=this,n=t.my(),r=n.params.history,i=Object.keys(r).sort(),s=1*(parseInt(e)||0),o;if(!i.length||s<0)return l;if(!n.params.errors||!n.params.errors.values().compact(true).length){if(Object.equal(r[i.last()],n.data))s+=1}else if(!Object.equal(n.data,n.lastCorrect))s+=1;o=V(s,n.params,true);if(o){B.kickoff(t.my().data,o);t.my("redraw")}return t.my().data},ui:function(e){var t=this,n=t.my(),r=[],i;if(!n)return l;var s=a(true,{},n.ui);if(!N(e))return n.ui;for(i in e)if(true||!s[i])r.push(i);n.ui=Y(B.overlap(n.ui,e));for(i=0;i<r.length;i++)$(t.find(r[i]),t,n.ui[r[i]],r[i]);for(i in e)t.find(i).eq(0).trigger("check");return n.ui},disabled:function(e){var t,n,r,i,s=this,o=s.my();if(!o)return undefined;if(e==l)return o.disabled;if(!!e){for(n in o.ui){t=s.find(n).eq(0);r=t.my();if(r)r.predisabled=r.disabled;W(true,t,":disabled")}s.addClass("my-disabled")}else{for(n in o.ui){t=s.find(n).eq(0);r=t.my();i=false;if(r&&r.predisabled)i=true;W(i,t,":disabled")}s.removeClass("my-disabled");s.my("redraw")}},find:function(t){var n=this,r=n.my();if(r&&r.root)n=r.root;return n.find(t)},radio:function(t,n){this.trigger("radio",T(t)?{channel:t,message:n}:t)},manifest:function(e){return e=="json"?B.tojson(this.my().manifest):this.my().manifest},version:function(){return t},history:function(e,t){return V(e,this.my().params,t)},val:function(e){return I(this,e)},container:function(e){return q(e,H.containers)(e)},promise:function(e){if(L(e))this.my().promise.then(e);return this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var n=this.is(".my-form-list")?this:this.my().root||this,r=n.is(".my-form-list")?n:n.parent(".my-form-list"),i=(n.data("formlist")||{}).index,s,o=t,u;if(null==i)i=0;s=M(r.my().data,r.data("formlist").generator.bind);if(!N(o)){if(!N(r.data("formlist").generator.manifest)){if(r===n)throw"No data to insert, cannot guess when manifest is function.";o=Object.clone(n.my().manifest.data,true)}else o=Object.clone(r.data("formlist").generator.manifest.data,true)||{}}if("before"===e)u=i;else if("after"===e)u=i+1;else if(!isNaN(e)){u=(1*e).clamp(0,s.length)}else throw"Invalid position for insert";s.add(o,u);r.trigger("redraw")}};if(!e.my)e.my={};e.extend(e.my,{f:e.extend({},B),tojson:B.tojson,fromjson:B.fromjson,radio:function(t,n){j(e(document),T(t)?{channel:t,message:n}:t)},rules:H,cache:function(e,t){if(L(e))return O=e;else return O(e,t)},version:function(){return t}});e.my.chain=function(){function s(){if(n.length&&r){var e=n.shift(),t,i=function(){s.delay(e[1])}.once();try{t=e[0]()}catch(o){i()}if(A(t)){t.then(i,i);i.delay(e[1])}else i()}}var e=1,t=1e3,n=[],r=false,i=function(r,i,o){n.push([r,i||e,o||t]);s()};i.delay=function(t){if(!isNaN(t))e=(t-0).clamp(0,1e6);return e};i.timeout=function(e){if(!isNaN(e))t=(e-0).clamp(1,1e6);return t};i.start=function(){r=true;s()};i.stop=function(){r=false};return i}();e.fn.my=function(t){var n;if(t===undefined)return this.data("my");if(T(t)&&t.substr(0,1)=="{"){try{n=JSON.parse(t)}catch(r){}if(n)return nt.init.apply(this,[n].add(Array.prototype.slice.call(arguments,1)))}if(T(t)&&nt[t])return nt[t].apply(this,Array.prototype.slice.call(arguments,1));else if(T(t)&&O(t,"exist"))return nt.init.apply(this,arguments);else if(typeof t===v||!t)return nt.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.my")};e(window).off(".my").on("radio.my",function(t,n){t.stopPropagation();j(e(document),n)}).on("resize.my",function(){for(var t in u)u[t]()}.debounce(100));return})(jQuery);(function(e){function w(e,n,r){if(h(n))return e+n;if(p(n)){r=t(true,r,n);return e}else if(l(n)&&n.length>1&&h(n[1])){var i=n[0],s="",o,f,c,d,v=1,m,g,y,w;while(v<n.length){if(h(n[v])){d=n[v].replace(/\s/g,"");c=d.split(/[\.#]/i);f=r.alias[c[0]]||c[0];o=d.substr(c[0].length);if(/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(d)){y=b.tmpl[f]||b.tmpl[""];g={style:"","class":"",txt:""};w="";var E=p(n[v+1]);if(E){v+=1;for(m in n[v])if(b.attnames[m]!=="")g[b.attnames[m]||m]=n[v][m]}if(!g.style&&!g["class"]&&r.styles[f])g.style=r.styles[f];if(!g.id&&o.to(1)=="#")g.id=o.from(1).split(".")[0];if(!g["class"]&&/\./.test(o))g["class"]=(o.to(1)=="#"?o.substr(g.id.length+1):o).split(".").compact(true).join(" ");for(m in g)w+=m+'="'+g[m]+'" ';if(E)for(m in n[v])if(b.attnames[m]==="")g[m]=n[v][m];g.ext=w;if(!g.txt&&b.txt[f])g.txt=b.txt[f](g);g._tag=f;s+=typeof y==a?y(g)||"":typeof y==u?y.assign(g):""}else s+=n[v]}v+=1}if(s){s="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&i?"padding-left:"+r.label+"; ":"")+'">'+(i?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+i+"</"+r.labelTag+">":"")+s+"</"+r.rowTag+">"}return e+s}return e}function E(e){var t=e;if(h(t)){t=t.split(/[\s,]/).compact(true)}if(l(t)){var n={};for(var r=0;r<t.length;r++){var i=t[r];if(p(i)){var s=Object.keys(i);if(s.length==1)n[s[0]]=i[s[0]]+"";else n[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else n[i]=i+""}t=n}if(p(t))return t;else return{}}function S(n,r){var i={};if(l(n)){t(true,i,b.params,r||{});return n.length?n.reduce(w.fill(undefined,undefined,i),""):""}else if(p(n)){e.extend(b,n)}else return""}var t=e.extend,n=function(e){return e!==null&&e!==undefined},r=null,i="object",s="data",o="array",u="string",a="function",f="change",l=Object.isArray,c=Object.isBoolean,h=Object.isString,p=Object.isObject,d=Object.isNumber,v=Object.isRegExp,m=Object.isFunction;var g='<input type="',y=" {ext} ";var b={tmpl:{num:g+'number" {ext}/>',inp:g+'text" {ext}/>',sli:g+'range" {ext}/>',dat:g+'date" {ext}/>',btn:g+'button" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!l(e.vals))return"";var n=t({style:"",css:""},e);n.txt=e.vals.reduce(function(e,t){return e+'<span class="my-shortcut" '+"onclick=\"$(this).parents('.my-row')"+".find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," ");return'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(n)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=E(e.vals);return Object.keys(t).reduce(function(e,n){return e+'<option value="'+n+'">'+t[n]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}};var x={init:function(t,n){return e(this).html(S(t,n))}};if(!e.my)e.my={};e.my.formgen=S;e.fn.formgen=function(t){if(h(t)&&x[t])return x[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return x.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.formgen")}})(jQuery);(function(e){function d(t,n,r,i){var o,u,a,c,h,p,d;if(typeof n=="object"&&n.jquery){if(n.is("img")){p=n;h=n.attr("alt")||n.attr("title")||n.data("text")||"";u=p[0].naturalWidth||p[0].width;o=p[0].naturalHeight||p[0].height;if(o<1)o=1;if(u<1)u=1;c=e(window).width()-90;a=e(window).height()-90;if(a<o)u=u*(a/o)|0,o=a;if(c<u)u=c,o=o*(c/u)|0;d=u<300?300:u;s(t,{source:"image",manifest:{init:function(e){e.html(this.HTML);e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+u+"px;max-height:"+o+'px">'+'<h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:p.attr("src"),text:h},esc:true,screen:true,width:i||d,focus:false,global:true,z:"1995"},r)}}else if(l(n)&&n.manifest){s(t,n,r)}else if(f(n)){s(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:n,ui:{"div:eq(0)":function(){}}},data:{},esc:true,focus:false,width:i},r)}else return null;return t}var t={},n="body",r,i=false,s=e.extend,o={},u=Object.isArray,a=Object.isBoolean,f=Object.isString,l=Object.isObject,c=Object.isNumber,h=Object.isRegExp,p=Object.isFunction;e(document).keydown(function(e){var t=e.keyCode,n,r;if(false!==i&&(t===13||t===27)){r=i.data("modal");n=r.form;if(t==27&&(r.esc||Object.equal(n.data("my").initial,n.my("data")))){i.modal(true);return false}else if(t==13&&r.enter){(function(e){e.modal()}).fill(i).delay(50);return false}}});t.modal=function(r,s,o){var u={},f=e(n),l,c=f.find(">.my-modal-proxy"),h={global:true,screen:true,done:p(s)?s:undefined,z:"1995"};if(!a(r)&&null!=r){l=e.Deferred();if(!d(u,r,h,o)){return l.reject("Invalid data").promise()}if(i){return l.reject("Locked").promise()}else{if(!c.size()){c=e('<div class="my-modal-proxy"></div>').prependTo(f);c.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})}return c.modal(u)}}else{return c.modal(r)}};t.modal.loading=function(t){e(n).find(">.my-modal").toggleClass("my-modal-loading",!!t)};t.modal.parent=function(t){if(!t||!e(t).size())return e(n);n=t};t.modal.parentBack=function(t){if(!t||!e(t).size())return e(r||n);r=t};t.modal.visible=function(){return!!i};if(!e.my)e.my={};e.my.modal=t.modal;e.fn.modal=function(t,u,h){function D(){var t=window,n,r,i=!!L.global,s=w.offset(),o=b.offset();L.pos={px:s.left,py:s.top,pw:w.outerWidth(),ph:w.outerHeight(),ox:o.left,oy:o.top,ow:b.outerWidth(),oh:b.outerHeight(),ww:r,wh:n};var u=(L.x.match(/\-?\d+(\.\d+)?/)||[0])[0]*1,a=(L.y.match(/\-?\d+(\.\d+)?/)||[0])[0]*1,f=L.x.has("left")?-1:L.x.has("right")?1:0,l=L.y.has("top")?-1:L.y.has("bottom")?1:0,h=L.pos.ox+L.pos.ow/2-L.pos.px,p=L.pos.oy+L.pos.oh/2-L.pos.py;if(i){L.pos.wh=n=t.innerHeight||e(t).height();L.pos.ww=r=t.innerWidth||e(t).width();h=r/2;p=n/2.5}u=L.x.has("%")?L.pos.ow/100*u:u;a=L.y.has("%")?L.pos.oh/100*a:a;L.pos.pix=h;L.pos.piy=p;h=h+f*(L.pos.ow/2)+u*(f>0?-1:1)-(L.width+T)*(f+1)/2;if(i){p=(n-L.height-20)/3;if(p<10)p=10}else{p=p+l*(L.pos.oh/2)+a*(l>0?-1:1)-(L.height||0)*(l+1)/2}h=h.round(1);p=p.round(1);L.pos.vx=h;L.pos.vy=p;if(L.bound!==false&&!L.global){var d=(c(L.bound)?L.bound:0).clamp(-100,100);if(L.pos.pw-2*d<L.width+T){L.pos.vx=-(L.width+T-L.pos.pw)/2}else if(L.pos.vx+L.width+T>L.pos.pw-d){L.pos.vx=L.pos.pw-d-L.width-T}else if(L.pos.vx<d){L.pos.vx=d}if(L.pos.ph-2*d<L.height){L.pos.vy=d;L.height=L.pos.ph-2*d}else if(L.pos.vy+L.height>L.pos.ph-d){L.pos.vy=L.pos.ph-d-L.height}else if(L.pos.vy<d){L.pos.vy=d}}}function P(t){if(!t){L.height=g.outerHeight();if(L.source!=="manifest")L.width=g.width();D()}g.css({width:L.width+T+"px",display:"block"});if(!L.global){g.css({left:L.pos.vx+"px"});if(L.nose){if(!e("style#my-modal-style-"+L.cid).size()){g.append('<style id="my-modal-style-'+L.cid+'"></style>')}var n="",r=e("style#my-modal-style-"+L.cid);if(L.nose=="top"||L.nose=="bottom"){n+="div.my-modal-"+L.cid+".nose-"+L.nose+":before {left:"+(L.pos.ox-L.pos.px+L.pos.ow/2-L.pos.vx)+"px!important;}";r.text(n)}if(L.nose=="left"||L.nose=="right"){n+="div.my-modal-"+L.cid+".nose-"+L.nose+":before {top:"+(L.pos.oy-L.pos.py+L.pos.oh/2-L.pos.vy)+"px!important;}";r.text(n)}}}else g.css({left:"50%","margin-left":"-"+((L.width+T)/2).round(0)+"px"});if(L.screen){if(!L.global)E.css({top:0,left:0,position:"absolute",width:L.pos.pw+"px",height:L.pos.ph+"px",display:"block",background:f(L.screen)?L.screen:"rgba(40,80,120,0.5)","z-index":L.z-1});else{E.css({top:0,left:0,width:L.pos.ww*2+"px",height:L.pos.wh*2+"px",display:"block",position:"fixed","z-index":L.z-1});if(f(L.screen))E.css({background:L.screen?L.screen:"rgba(30,65,100,0.8)"})}}else if(E.size())E.hide();if(L.height>L.pos.wh){g.height(L.pos.wh-30);y.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})}else{y.css({"overflow-y":"none"})}g.animate({top:L.pos.vy+"px",opacity:"1"},L.animate)}function H(){try{y.my("remove")}catch(t){}w.data("modals")[L.cid]=null;y.parent().unbind(".my").remove();E.off(".my"+L.cid);if(L.screen){(function(e){if(!e||!i)E.hide()}).delay(50,L.global)}if(L.global){i=false;e("body").css({overflow:"auto"})}}function B(e){try{C(null,null)}catch(t){}(function(){v.reject(e)}).delay(0)}var v=e.Deferred(),m={},g,y,b=this,w,E,S,x,T=0,N=0,C=p(u)?u:function(){return false},k=l(t)?t:{},L=b.data("modal"),A,O;s(b,v.promise());if(L){if(t==null||a(t)){y=L.form;E=L.bg;w=L.root;C=L.done;A=y.my("data");O=false;if(!t){try{O=C(y.my("valid")?null:y.my("errors"),A)}catch(_){}if(!O){H();b.removeData("modal");(function(){if(o[L.cid])o[L.cid].resolve(A);delete o[L.cid];L=null}).delay(0)}}else{try{C(null,null)}catch(_){}H();b.removeData("modal");if(o[L.cid])o[L.cid].reject("Cancelled");delete o[L.cid];L=null}return b}else if(k){B("Locked");return b}}if(!b.is(":visible")){B("Object must be visible");return b}if(!(k=d(m,t,{}))){B("Invalid data");return b}if(k.global&&i){B("Locked");return b}L=s({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:b,manifest:{},data:{},global:false,screen:false,drag:false,focus:true,close:true,silent:true,esc:false,enter:false,bound:false,nose:"",width:h||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},k,{promise:v.promise(),cid:Number.random(268435456,4294967295).toString(16)});L.done=p(L.done)?L.done:C;if(f(L.align)&&L.align){L.x=(L.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0];L.y=(L.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]}L.width=1*(e.my.f.getref(f(L.manifest)?e.my.cache(L.manifest):L.manifest,"params.width")||L.width);L.type="DOM";if(b.hasClass("my-form")){L.type="form";L.root=L.root||b}else if(b.data("my")){L.type="control";L.root=L.root||b.my().root}else{L.root=L.root||b.parents(".my-form").eq(0);if(!L.root.size())L.root=e(n)}if(L.global){L.root=e(n);L.bgroot=e(r||n)}else L.bgroot=L.root;w=L.root;if(!w.data("modals"))w.data("modals",{});D();g=e('<div class="my-modal my-modal-'+(L.global?"fullscreen ":"overlay ")+L.css+(L.nose?" nose-"+L.nose:"")+'"></div>').prependTo(L.root);g.addClass("my-modal-"+L.cid);T=g.outerWidth();N=g.outerHeight();g.hide();g.html('<div class="my-modal-form"></div>');y=g.find(".my-modal-form");if(L.close){S=e(f(L.close)?L.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(g).on("click.my",function(){b.modal(true)});S.css({"z-index":((L.z+"").to(1)==="+"?"+":"")+(L.z*1+1)})}E=L.bgroot.find(">.my-modal-screen");if(L.screen){if(!E.size()){E=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(L.root)}if(L.esc)E.on("click.my"+L.cid,function(){b.modal(true)})}b.data("modal",L);if(L.silent)g.on("change.my",function(){return false});g.css({display:"block",height:"none",opacity:"0.005","z-index":L.z,width:"auto"});if(!L.global)g.css({position:"absolute",left:L.pos.vx+"px",top:L.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":L.z,width:"auto"});else g.css({position:"fixed",left:"50%",top:L.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":L.z,width:"auto","margin-left":"-"+((L.width+T)/2).round(0)+"px"});y.my(L.manifest,L.data).then(function(){var t,n,r,u,a;s(L,{form:y,bg:E,cancel:function(){b.modal(true)},commit:function(){b.modal()}});g.data("modal",L);L.height=g.outerHeight();if(L.source!=="manifest")L.width=g.width();D();g.css({top:L.pos.vy+"px"});P(true);w.data("modals")[L.cid]=L;o[L.cid]=v;y.bind("commit.my",function(){L.commit.delay(50);return false}).bind("cancel.my",function(){L.cancel.delay(50);return false});g.bind("layout.my",function(){P()}.debounce(50));if(L.global){i=b;e("body").css({overflow:"hidden"})}if(!L.global&&(L.esc||L.enter)){y.bind("keydown.my",function(t){var n=t.keyCode;if(n==27&&L.esc){L.cancel();return false}else if(n==13&&L.enter&&!e(t.target).is("textarea")){L.commit.delay(50);return false}})}if(L.focus===true){u=false;a=L.manifest.ui;for(r in a){if(!u){n=y.find(r);if(n.size()&&n.is("input, textarea")){u=true;n.focus()}}}}else if(f(L.focus))y.find(L.focus).focus();t=y.find("img").filter(function(){return e(this).attr("src")!=""});if(t.size()){var l=function(){if(L.source!=="manifest")g.css({width:"auto"});P()}.after(t.size());t.each(function(){e(this).bind("load",l)})}if(L.drag&&e.fn.draggable){if(!f(L.drag))g.draggable();else g.draggable({handle:L.drag})}v.notify("Ready")}).fail(function(e){H();b.data("modal",null);v.reject(e)});return b}})(jQuery);
