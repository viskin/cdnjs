/*
 * jQuery.my 0.4.4 beta minified. 
 * 
 * (c) ermouth
 * See details at jquerymy.com
 * 
 * Requires jQuery 1.7.1+, SugarJS 1.2.5+
 * Minified with jscompress.com
 */
;(function(a){var b=function(a){return a!==null&&a!==undefined};var c="en";var d={};var e={vals:{".my-form":function(a,b){if(a)return a.my("data",b,true);else return b},".hasDatepicker":function(a,c){if(b(c))a.datepicker("setDate",f.date8601(c));return f.date8601(a.datepicker("getDate")||new Date)},".ui-draggable":function(c,d){if(b(d)&&a.type(d)=="object"){var e={};if(!isNaN(d.left))e.left=Number(d.left.ceil(2))+"px";if(!isNaN(d.top))e.top=Number(d.top.ceil(2))+"px";if(e.left||e.top)c.css(e)}var f=c.position();return{left:d&&d.left?d.left.ceil(2):f.left.ceil(2),top:d&&d.top?d.top.ceil(2):f.top.ceil(2)}},".ui-sortable":function(c,d){var e=[],g=">div.ui-sortable-placeholder";if(b(d)&&a.type(d)=="array"){if(c.find("input:focus:eq(0)").size()!=0||c.find(g).size()!=0)return j;var h={},i={},j=d.unique();var k=c.find(c.sortable("option","items"));k.each(function(){h[JSON.stringify(f.extval(a(this)))]=a(this)});for(var l=j.length-1;l>=0;l--){var m=JSON.stringify(j[l]);if(h[m]){h[m].prependTo(c).show();i[m]=true;if(e.indexOf(j[l])==-1)e.push(j[l])}}e=e.reverse();for(l in h)if(!i[l])h[l].hide()}else{if(c.find(g).size()!=0){var k=c.find(c.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");var o=c.find(c.sortable("option","items")).filter(".ui-sortable-helper");k.each(function(){var b=a(this);if(b.is(".ui-sortable-placeholder"))e.push(f.extval(o));else e.push(f.extval(b))})}else{var k=c.find(c.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");k.each(function(){e.push(f.extval(a(this)))})}}return e},"input[type=date]":function(c,d){var e=c.val();if(b(d)){e=f.date8601(d);if(a.type(e)=="string"&&!e.has("Invalid")){c.val(e.to(10))}else if(a.type(e)=="date"){c.val(f.date8601(e).to(10))}}var g=e!=""?Date.create(e):Date.create("$@#");return g},"input,button":{"[type='text'],[type='number'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(a,c){if(b(c))a.val(c).slider("refresh")},".tagstrip input.value":function(a,c){if(b(c))a.val(c).trigger("update")},"":function(a,c){if(b(c))a.val(c)}},":radio":function(c,d){var e=-1;if(b(d)){c.each(function(b){var c=a(this).val();if(String(d)===String(c))e=b});var f=c.eq(0).checkboxradio;if(f){c.each(function(b){var c=a(this);if(e!=b&&c.is(":checked"))c.attr("checked",false).checkboxradio("refresh")})}if(e>-1){var g=c.eq(e);if(!g.is(":checked")){g.attr("checked",true);if(f)g.checkboxradio("refresh")}}else if(!f){c.each(function(){a(this).attr("checked",false)})}}if(e==-1){for(var h=0;h<c.size();h++){if(c.eq(h).is(":checked"))e=h}}return e!=-1?c.eq(e).val():""},":checkbox":function(c,d){var e=-1,f=d,g=[],h={};if(b(f)){if(a.type(f)!="array")f=[d];c.each(function(b){var c=a(this),d=c.val(),e=c.is(":checked");if(f.indexOf(d)!=-1){g.push(d);if(!e)c.attr("checked",true)}else if(e)c.attr("checked",false)})}else{c.each(function(b){var c=a(this);if(c.is(":checked"))g.push(c.val())})}return g}},select:{".ui-slider-switch":function(a,c){if(b(c)){a.val(String(c||""));a.slider("refresh")}},"[multiple]":function(a,c){if(b(c)){a.val(c,[]);if(a.selectmenu)a.selectmenu("refresh",true)}},"":function(c,d){if(b(d)){c.val(String(d||""));if(c.selectmenu){if(c.selectmenu("option").theme!=null)c.selectmenu("refresh",true);else{c.find("option").each(function(b){var e=a(this);if(f.extval(e)==d)c.selectmenu("value",b)})}}}}},textarea:function(a,c){if(b(c))a.val(c)},"div,span,a,p,form,fieldset,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(a,c){if(b(c))a.slider("option",a.slider("option","values")?"values":"value",f.clone(c));return f.clone(a.slider("option","values")||a.slider("option","value")||"")},".ui-buttonset":function(c,d){if(!b(d)){var e=c.find(":radio:checked");if(e.size()&&e.button)return e.val()||e.button("option","label")}else if(d!=""){var f=null;c.find(":radio").each(function(){f=(a(this).val()||a(this).button("option","label"))==d?a(this):f});if(f){f.attr("checked",true);c.buttonset("refresh");return d}}c.find(":radio:checked").attr("checked",false);c.buttonset("refresh");return""},"":function(a,c){if(b(c))a.html(c);return a.html()}},"pre,code":function(a,c){if(b(c))a.html(c);return a.html()},img:function(a,c){if(b(c))a.attr("src",val);return a.attr("src")||""},"":function(a,c){if(b(c))a.html(c);return a.html()||a.text()||String(a.val())||""}},events:{".my-form":"change.my check.my",".ui-slider":"slide.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","img, a, .pseudolink, input[type=button], button, :radio, :checkbox":"click.my check.my ",".ui-buttonset,input, select, textarea":"blur.my input.my change.my check.my"+(a.browser.msie?" keyup.my":""),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input, textarea, select, button, :radio":function(a){return a.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(a){return a.parents(".tagstrip").eq(0)},".hasDatepicker, .ui-widget, input, textarea, select, button":function(a){return a.parents("div,span,a,p,form,fieldset,li,td,th,h1,h2,h3,h4,h5,h6").eq(0)},"":function(a){return a}}};var f={con:function(){try{console.log(arguments)}catch(a){}},clone:function(a){return a.clone?a.clone():a},extval:function(a){var b=a.data("my");if(b&&b.data)return b.data;return a.data("value")||a.val()||a.text()||a.html()||""},overlap:function(b,c){return Object.merge(b,c,false,function(b,c,d){if(a.type(d)!="object")return d;else return Object.merge(c,d,false)})},field:function(a,b){if(!a.data("myval")){var c=f.traverse(a,e.vals);if(typeof c=="function"){var d=c(a,null);if(d===undefined){a.data("myval",function(a,b){if(b!=null)c(a,b);return a.val()}.fill(a,undefined))}else{a.data("myval",c.fill(a,undefined))}}}var g=a.data("myval");if(typeof g=="function"){var d=g();if(d!=b)d=g(b);return d}else return null},traverse:function(b,c){function g(c,h){for(var i in c){if(i!=""&&b.is(i)){f=f+(f?" ### ":"")+i;var j=a.type(c[i]);if(!/^(null|undefined|object)/.test(a.type(c[i]))&&h>e){d=c[i];e=h;return}else if(j=="object"){g(c[i],h+1)}}}if(c[""]!=null&&typeof c[""]!="object"&&h>e){d=c[""];e=h}}var d=null,e=0,f="";g(c,1);return d},bind:function(a,b,c,d){var e=c.bind;if(typeof e=="function"){return e(a,b,d)}else if(typeof e=="string"){if(b!=null)a[e]=b;else if(a[e]===undefined)a[e]=null;return a[e]}return null},date8601:function(b){if(typeof b=="number"||!isNaN(b)&&parseInt(b)==b)return new Date(parseInt(b));if(typeof b=="string")return Date.create(b,c);if(a.type(b)=="date"||b==null)return Date.create(b,c).format("{yyyy}-{MM}-{dd}T{HH}:{mm}{isotz}");return new Date},isOut:function(b,c,d,e){var f=d.check;if(f!=null){var g=d["error"]||e.data("my").root.data("my").params.errorMessage||"Error";switch(a.type(f)){case"function":return f(b,c,e);case"regexp":return f.test(String(c))?"":g;case"array":return f.indexOf(c)>-1?"":g;case"string":return c==f?"":g;case"object":return f[c]?"":g}return g}else{return""}},update:function(b,c,d){var e=b,g=e.data("my"),h="Unknown error";if(g){if(b.hasClass("my-form")){var i=g.droot,j=b;var k=g.dselector,l=g.ddata,m=g.dui;var n=g.dparams,o=i.data("my").ui;var p=i.find(k)}else{var i=g.root,j=g.container;var k=g.selector,l=g.data,m=g.ui;var n=g.params,o=i.data("my").ui;var p=i.find(k)}if(c!=null){var q=c}else{q=f.field(p,f.bind(l,null,m,p))}try{var h=f.isOut(l,q,m,p)}catch(r){f.con("Error "+r.name+" validating "+k)}var s=n.errorCss;var t="ui-state-error";if(h==""){g.errors[k]="";if(c!=null){q=f.field(p,f.bind(l,c,m,p))}n.effect(j.removeClass(s).find(n.errorTip),false,n.animate/2);e.removeClass(t);e.find(".ui-widget").removeClass(t)}else{g.errors[k]=h;n.effect(j.addClass(s).find(n.errorTip).addClass(s).html(h),true,n.animate);if(e.is(".hasDatepicker")){if(e.is("input"))e.addClass(t);else e.find(".ui-widget").addClass(t)}if(e.is(".ui-slider"))e.addClass(t)}var u=c==null?q:c;if(m.css){for(var v in m.css){var w=m.css[v];if(Object.isRegExp(w)){if(w.test(u))j.addClass(v);else j.removeClass(v)}else if(Object.isFunction(w)){if(w(l,u,p))j.addClass(v);else j.removeClass(v)}}}if(d&&m.recalc){var x=m.recalc,y=[],z={};if(Object.isString(x))x=x.split(",");if(Object.isArray(x)){for(var A in x){if(x[A]&&a.type(x[A])=="string"){var B=x[A].compact();if(o[B]){if(o[B].recalc){if(y.indexOf(B)==-1)y.push(B)}else z[B]=true}}}for(var A=0;A<y.length;A++){z=a.extend(true,z,f.update(i.find(y[A]),null,d-1))}if(c!==null){for(A in z){if(z[A]===true&&A!=k)f.update(i.find(A),null,d-1)}return{}}}}return z||{}}},history:function(b,c,d,e){var f=c;if(a.type(f)!="object"||isNaN(f.remember)||a.type(f.history)!="object")return null;var g=f.history;var h=f.remember;if(a.type(b)=="object"){var i=Object.extended(a.extend(true,{},b));var j=(new Date).valueOf();var k=g.keys().sort();if(k.length>0&&j-k[k.length-1]<f.historyDelay)return null;if(k.length>0&&g[k[k.length-1]].equals(i))return null;f.history[j]=i;k.push(j);if(k.length>=h*2){var l=Object.extended();for(var m=h;m<h*2;m++)l[k[m]]=g[k[m]];c.history=l}if(!e)f.form.trigger("change");return f.history[k[k.length-1]]}if(!isNaN(b)||b===null){var n=parseInt(b)||0;if(n<0)return null;var k=g.keys().sort();if(n>=k.length)n=k.length-1;var o=f.history[k[k.length-n-1]].clone(true);if(d){var l=Object.extended();for(var m=0;m<k.length-n-1;m++)l[k[m]]=g[k[m]];c.history=l}if(!e)f.form.trigger("change");return o}}};var g={init:function(b){var c=this.eq(0);if(!b)return this;if(Object.isObject(c.data("my"))&&c.data("my").id&&c.data("my").ui){f.con("$.my is already bind!");return c}var g=a.extend(true,{getContainer:function(a){return f.traverse(a,e.containers)(a)},change:function(){},recalcDepth:2,delay:0,animate:0,errorMessage:"Incorrect input!",errorTip:".my-error-tip",errorCss:"my-error",effect:function(a,b,c){if(b){a.fadeIn(c);return}a.fadeOut(c)},oninit:function(){},remember:100,form:c,history:Object.extended(),historyDelay:100},b.params||{});var h=a.extend(true,{},b.ui||{});var i=b.id||"my"+Number.random(1e8,999999999);var j=b.data||{};c.data("my",{id:i,data:j,params:g,errors:Object.extended(),ui:Object.extended(h)});c.bind("check.my",function(){a(this).my("redraw")});for(var k in h){var l=a(this).find(k);var m=h[k];if(l.size()>0){var n;l.each(function(){var b=a(this);var d=l;var h=m.events||f.traverse(b,e.events);var q=!!b.is(".my-form");if(!q){b.data("my",{events:h,selector:k,initial:n,previous:n,root:c,container:g.getContainer(b),id:i,ui:m,data:j,params:g,errors:c.data("my").errors})}else{a.extend(b.data("my"),{dui:m,droot:c,dselector:k,dparams:g,devents:h,ddata:j})}b.bind(h,function(){var d=b.data("my");if(!d.errors||d.errors.values().join("").length==0)c.data("my").lastCorrect=a.extend(true,{},d.ddata||d.data);f.history(d.ddata||d.data,d.dparams||d.params);var e=c.find(d.dselector||d.selector);var h=f.field(e,null);f.update(b,h,m.recalcDepth||g.recalcDepth);if(d.root.parent().is(".ui-sortable"))d.root.parent().trigger("check");g.change()}.debounce(m.delay||g.delay))})}else{f.con("Not found "+k+" selector at form "+i)}}for(var k in h){var l=a(this).find(k);if(l.size()>0){var m=h[k];var n=f.bind(j,null,m,l);if(n!=null){f.field(l,n)}l.eq(0).trigger("check")}}if(!c.data("my"))return null;c.data("my").initial=a.extend(true,{},j);c.addClass("my-form");d[i]=c;if(a.mobile)a.mobile.changePage(a.mobile.activePage);return c},redraw:function(a,b){var c=this;c.data("my").ui.each(function(b){f.update(c.find(b),a?null:undefined,c.data("my").params.recalcDepth)});if(!b)c.trigger("change");return c},data:function(b,c){var d=this;if(a.type(b)=="object"){d.data("my").data=f.overlap(d.data("my").data,b);this.my("redraw",null,c)}return d.data("my").data},errors:function(){var b=a(this).data("my").errors,c={};for(var d in b){if(b[d]&&typeof b[d]=="string")c[d]=b[d]}return c},reset:function(){try{this.data("my").data=Object.merge(this.data("my").data,this.data("my").initial);this.my("redraw")}catch(a){return false}return true},id:function(a){if(typeof a=="string"){return d[a]||null}else{var b=this.data("my");if(b&&b.id){return b.id}else{return null}}},remove:function(){var a=this;a.data("my").ui.each(function(b){var c=a.find(b);c.unbind(".my").removeData("my")});var b=a.data("my").data;a.removeData("my").removeClass("my-form").unbind(".my");return b},undo:function(a){var b=this;var c=b.data("my");var d=c.params.history;var e=d.keys().sort();var g=1*(parseInt(a)||0);if(e.length==0||g<0)return null;if(!c.params.errors||c.params.errors.values().compact(true).length==0){if(d[e[e.length-1]].equals(Object.extended(c.data)))g+=1}else{if(!Object.extended(c.data).equals(Object.extended(c.lastCorrect)))g+=1}b.data("my").data=Object.merge(b.data("my").data,f.history(g,c.params,true)||{});b.my("redraw");return b.data("my").data},history:function(a,b){return f.history(a,this.data("my").params,b)},val:function(a){return f.field(this,a)},cont:function(a){return f.traverse(a,e.containers)(a)}};a.fn.my=function(b){if(g[b]){return g[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return g.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.my")}}})(jQuery)