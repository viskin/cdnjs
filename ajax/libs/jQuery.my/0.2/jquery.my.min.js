/*
 * jQuery.my 0.2 beta. 
 * 
 * (c) ermouth
 * See details at jquerymy.com
 * 
 * Minified with jscompress.com
 * Requires jQuery 1.7.1+, SugarJS 1.2.5+
 * 
 */

(function(a){var b={};var c={con:function(){try{console.log(arguments)}catch(a){}},bind:function(a,b,c,d){var e=c.bind;if(typeof e=="function"){return e(a,b,d)}else if(typeof e=="string"){if(b!=null){a[e]=String(b)}else{if(a[e]===undefined)a[e]=null}return a[e]}return null},isOut:function(b,c,d,e){var f=d.check;if(f!=null){var g=d["error"]||e.data("my").root.data("my").params.errorMessage||"Error";var h=a.type(f);if(h=="function"){return f(b,c,e)}else if(h=="regexp"){return f.test(String(c))?"":g}else if(h=="array"){return f.indexOf(c)>-1?"":g}else if(h=="string"){return c==f?"":g}else if(h=="object"){return f[c]?"":g}return g}else{return""}},field:function(b,c){var d=b[0].nodeName.toLowerCase();if(c!=null){var e=String(c);if(d=="input"){var f=b.eq(0).attr("type").toLowerCase();if(/^number|text|hidden|password$/.test(f)){if(b.val()!=e){b.val(e);if(b.hasClass("ui-slider-input"))b.slider("refresh");if(b.data("tagstrip")&&b.data("tagstrip").root)b.trigger("update")}}else if(f=="radio"){var g=-1;b.each(function(b){var c=a(this).val();if(c===e)g=b});b.each(function(){a(this).attr("checked",false).checkboxradio("refresh")});if(g>-1){b.eq(g).attr("checked",true).checkboxradio("refresh")}}}else if(d=="select"){if(b.val()!=e){b.val(e);if(b.hasClass("ui-slider-switch"))b.slider("refresh");else{if(b.selectmenu)b.selectmenu("refresh",true)}}}else if(d=="textarea"){if(b.val()!=e)b.val(e)}else if(/^p|div|span|li|t[dh]|a$/.test(d)){b.html(e)}else if(d=="img"){b.attr("src",e)}return e}else{if(d=="input"){var f=b.eq(0).attr("type").toLowerCase();if(/^number|text|hidden|password|button$/.test(f)){return b.val()}else if(f=="radio"){var h="";b.each(function(){if(this.attributes["checked"])h=a(this).val()});return h}}else if(/^select|textarea$/.test(d)){return b.val()}else if(/^p|div|span|li|t[dh]|h[1-6]|a$/.test(d)){return b.html().compact()}else if(d=="img"){return b.attr("src")}}},update:function(b,d,e){var g=b,h=g.data("my"),i="Unknown error";if(h){$root=h.root,$container=h.container;var j=h.selector,k=h.data,l=h.ui;var m=$root.data("my").params,n=$root.data("my").ui;if(d!=null){var o=d}else{o=c.field($root.find(j),c.bind(k,null,l,b))}try{var i=c.isOut(k,o,l,g)}catch(p){c.con("Error "+p.name+" validating "+j)}if(i==""){$root.data("my").errors[j]="";c.bind(k,o,l,b);$container.removeClass(m.errorCss).find(m.errorTip).removeClass(m.errorCss).html("").hide()}else{$root.data("my").errors[j]=i;$container.addClass(m.errorCss).find(m.errorTip).addClass(m.errorCss).show().html(i)}if(l.css){for(var q in l.css){var r=l.css[q];if(Object.isRegExp(r)){if(r.test(o))$container.addClass(q);else $container.removeClass(q)}else if(Object.isFunction(r)){if(r(k,o,b))$container.addClass(q);else $container.removeClass(q)}}}if(e&&l.recalc){var s=l.recalc,t=[],u={};if(Object.isString(s))s=s.split(",");if(Object.isArray(s)){for(var v in s){if(s[v]&&Object.isString(s[v])){var w=s[v].compact();if(n[w]){if(n[w].recalc){if(t.indexOf(w)==-1)t.push(w)}else{u[w]=true}}}}for(var v=0;v<t.length;v++){u=a.extend(true,u,c.update($root.find(t[v]),null,e-1))}if(d!==null){for(v in u){if(u[v]===true&&v!=j)c.update($root.find(v),null,e-1)}return{}}}}return u||{}}}};var d={};var e={init:function(b){var e=this;if(!b)return e;if(Object.isObject(e.data("my"))&&e.data("my").id&&e.data("my").ui){c.con("$.my is already bind!");return e}var g=a.extend(true,{getContainer:function(b){if(!/^(div|span|a|li|p|h[1-6]|t[dh])$/.test(a(b)[0].tagName.toLowerCase())){var c=b.parents('*[data-role="fieldcontain"], *.tagstrip');if(c.size()==0){var d=b.parents("*");var e=false;for(var f=0;f<3;f++){if(!e&&/div|span|form|p|fieldset/.test(d[f].tagName.toLowerCase())){e=d[f]}}if(!e)return b;else return a(e)}return a(c[0])}else{return b}},change:function(){},recalcDepth:2,delay:0,errorMessage:"Incorrect input!",errorTip:".my-error-tip",errorCss:"my-error",oninit:function(){},remember:10,undos:[]},b.params||{});var h=a.extend(true,{},b.ui||{});var i=b.id||"auto"+Math.random(1e8,999999999);var j=b.data||{};e.data("my",{id:i,data:j,params:g,errors:Object.extended(),ui:Object.extended(h)});for(var k in h){var l=a(this).find(k);var m=h[k];if(l.size()>0){var n=c.bind(j,null,m,l);if(n!=null){c.field(l,n)}else{n=c.field(l,null);n=c.bind(j,n,m,l)}l.each(function(){var b=a(this);var d="blur.my input.my change.my check.my"+(a.browser.msie?" keyup.my":"");if(b.is('[type="button"]'))d="click.my check.my";b.data("my",{id:i,events:d,selector:k,ui:m,initial:n,previous:n,root:e,data:j,container:g.getContainer(b),errors:e.data("my").errors}).bind(d,function(){var a=b.data("my");c.update(b,c.field(a.root.find(a.selector)),a.ui.recalcDepth||g.recalcDepth);g.change()}.debounce(g.delay))})}else{c.con("Not found "+k+" selector at form "+i)}}for(var k in h){this.find(k).trigger("check")}e.data("my").initial=a.extend(true,{},j);d[i]=e;if(a.mobile)a.mobile.changePage(a.mobile.activePage);return e},redraw:function(a){var b=this;b.data("my").ui.each(function(d){c.update(b.find(d),a?null:undefined,b.data("my").params.reclcDepth)})},data:function(b){if(b!=null){a.extend(true,this.data("my").data,b);this.my("redraw")}return a(this).data("my").data},errors:function(){var b=a(this).data("my").errors,c={};for(var d in b){if(b[d]&&typeof b[d]=="string")c[d]=b[d]}return c},reset:function(){try{a.extend(true,this.data("my").data,this.data("my").initial);this.my("redraw")}catch(b){return false}return true},id:function(a){if(typeof a=="string"){return d[a]||null}else{var b=this.data("my");if(b&&b.id){return b.id}else{return null}}},remove:function(){var a=this;a.data("my").ui.each(function(b){var c=a.find(b);c.unbind(c.data("my").events).removeData("my")});var b=a.data("my").data;a.removeData("my");return b}};a.fn.my=function(b){if(e[b]){return e[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return e.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.my")}}})(jQuery)