/*
 * jQuery.my 0.9.9, jquerymy.com
 * (c) ermouth, 2014-07-05
 */
;(function($){function _getref(e,t){return(t||"").split(".").reduce(function(e,t){if(null!=e&&null!=e[t])return e[t];else return undefined},e)}function _manifest(e,t){var n,r;if(isO(t))return t;else if(isS(t)){n=_getref(e,t);if(null==n)n=Object.clone(forms._src[t],true);if(null==n){n=_getref(forms,t);if(isO(n)&&isO(n._self))n=Object.clone(n._self,true);else if(isO(n))n=Object.clone(n,true)}if(null==n&&_getref(e,"params.cache")){r=_getref(e,"params.cache");if(isF(r))n=r(t);else if(isO(r))n=_cache(t,r);if(isO(n)){if(isO(n._self))n=Object.clone(n._self,true);Object.merge(n,{params:{cache:r}},true)}}if(null!=n&&isO(n)){r=r||_getref(e,"params.cache");if(r)Object.merge(n,{params:{cache:r}},true);return n}else throw"Component "+t+" not found"}else if(isF(t)){return t.apply(e,Array.prototype.slice.call(arguments,2))}else return null}function _putmanifest(e,t){var n=t||forms,r=e,i,s,o,u;if(!(isO(n)&&isO(r)&&isO(r.ui)&&isO(r.data)&&isS(r.id)))return"Invalid arguments.";if(!n.hasOwnProperty("_src"))n._src={};s=r.id;i=s.split(".").compact(true);try{r=Object.clone(e,true)}catch(a){return"Can't mount circular-referencing obj."}try{if(!r.params||r.params&&!r.params.strict)_unjson(r)}catch(a){return"Invalid manifest, parse error."}Object.merge(r,{params:{strict:true}},true);n._src[s]=r;if(o=f.mask(n,s)){if(o.params&&o.params.protect)return"Can't mount on protected";if(o._self)delete o._self}Object.merge(n,f.unmask(r,s),true);u=_getref(n,s);Object.defineProperty(u,"_self",{get:function(){return n._src[s]},set:function(){throw"Can not change repo"},enumerable:false,configurable:true});return u}function _field(e,t){var n=e.data("myval"),r,i;if(!n){i=_traverse(e,MY.vals);if(isF(i)){r=i(e,N);if(r===undefined){e.data("myval",function(e,t){if(N!=t)i(e,t);return e.val()}.fill(e,undefined))}else e.data("myval",i.fill(e,undefined))}n=e.data("myval")}if(isF(n)){r=n();if(r!==t&&(false==t||false==r)||r!=t||isO(t))r=n(t);return r}else return N}function _traverse(e,t){function s(e,t,o){for(var u in t)if(u!=""&&e.is(u)){i=i+(i?" ### ":"")+u;var a=t[u],f=$.type(a);if(!/^(nul|un|ob)/.test(f)&&o>r){n=a;r=o;return}else if(f==Ob)s(e,a,o+1)}if(N!=t[""]&&typeof t[""]!=Ob&&o>r){n=t[""];r=o}}var n=N,r=0,i="";s(e,t,1);return n}function _bind(e,t,n,r){var i=n.bind,s,o=[],u,a,f=$.type(i);if(f==Fu){return i.call(_form(r).manifest,e,t,r)}if(f===St||f===Ar){if(f===St&&!/\./.test(i)){if(t!=N)e[i]=t;else if(e[i]===undefined)e[i]=N;return e[i]}if(f===St)o=i.split(".").each(function(e,t){this[t]=String(e).compact()});if(f===Ar)o=i.slice(0).each(function(e,t){this[t]=String(e).compact()});u=e;for(s=0;s<o.length;s++){if(s==o.length-1){if(t!=N)u[o[s]]=t;else if(u[o[s]]===undefined)u[o[s]]=N;return u[o[s]]}if(s==0){u=e[o[0]];a=e}else{a=a[o[s-1]];u=u[o[s]]}if(u===undefined)u=a[o[s]]={}}}return N}function _validate(e,t,n,r){var i=n.check,s,o;if(i!=N){var u=_form(r).params.messages,a=n.error,f=a||u.patternMismatch||u[""]||"Error";if(r.size()&&Object.prototype.hasOwnProperty.call(r[0],"validity")&&!r[0].validity.valid){var l=r[0].validationMessage+"";if(l!=="")return l.substr(0,1).toUpperCase()+l.substr(1);else{o=r[0].validity;for(s in o){if(l===""&&s!="valid"&&isB(o[s])&&o[s]&&u[s])l=u[s]}return l||a}}switch($.type(i).to(1)){case"f":{h=i.call(_form(r).manifest,e,t,r);return h===null||h===undefined?"":h};case"r":return i.test(String(t))?"":f;case"a":return i.indexOf(t)>-1?"":f;case"s":return t==i?"":f;case"o":return i[t]?"":f;case"b":{if(r.is(".my-form-list,.ui-sortable")){var c=r.data("listSrc")||r.data("my").listSrc||">*",h={};r.find(c).filter("*:not(.ui-sortable-placeholder)").each(function(e){var t=$(this);if(t.data("my")&&!t.my("valid"))h[e]=t.my("errors")});return h}else if(r.hasClass("my-form")){return!i?"":r.my("valid")?"":r.my("errors")}return""}}return u.formError||"Error"}return""}function _form(e){var t=e.my();if(!t)return null;return t.root?t.root.my():t}function _css(e,t,n){var r=n.compact(),i=r.replace(/:disabled/g,"");t.each(function(){var n=$(this),s=n.my(),o=s?s.container:n;if(e){if(!o.is(i))o.addClass(i)}else o.removeClass(i);if(i!=r&&s!==undefined&&!!e!=!!s.disabled){n.my().disabled=!!e;if(!s._disable)n.my()._disable=_traverse(t,MY.offon).fill(undefined,t);s._disable(!!e)}});return t}function _update(e,t,r){var i,s,o,u,a,l,c,h=e,p=h.my(),d="Unknown error";if(p){var v=p.selector,m=p.root,g=m.find(v),y=m.my().ui,b=e.hasClass("my-form"),w=e.hasClass("my-form-list");if(b){i=e;s=p.ddata;o=p.dui;u=p.dparams}else{i=p.container;s=p.data;o=p.ui;u=p.params}if(o.bind!=N){if(n(t))a=t;else a=_field(g,_bind(s,N,o,g));try{d=_validate(s,a,o,g)}catch(E){f.con("Error "+E.name+" validating "+v,m)}var S=u.errorCss;var x="ui-state-error";try{if(t!=N)a=_field(g,_bind(s,t,o,g))}catch(E){d=u.messages.formError||"Error"}if(d==""){if(!b)p.errors[v]="";else p.derrors[v]="";i.removeClass(S);if(i.attr("title"))i.attr("title","");if(!b&&!w)u.effect(i.find(u.errorTip),false,u.animate/2);h.removeClass(x);h.find(".ui-widget").removeClass(x)}else{if(b){p.derrors[v]=d}else if(w){p.errors[v]=d}else{i.addClass(S);p.errors[v]=d;var T=i.find(u.errorTip).eq(0);if(T.size()){u.effect(T.addClass(S).html(d),true,u.animate)}else i.attr("title",(d||"").stripTags())}if(h.is(".hasDatepicker")){if(h.is("input"))h.addClass(x);else h.find(".ui-widget").addClass(x)}if(h.is(".ui-slider"))h.addClass(x)}}var C=t==N?a:t;if(o.css){for(l in o.css){c=o.css[l];if(isR(c))_css(c.test(C),g,l);else if(isF(c))_css(c.call(m.my().manifest,s,C,g),g,l)}}var k,L=o.recalc,A=[],O={},M;if(r&&o.recalc&&m.my()){y=m.my().ui;for(k=0;k<L.length;k++){if(L[k]&&isS(L[k])&&(M=L[k].compact())&&y[M]){if(y[M].recalc){if(A.indexOf(M)===-1)A.push(M)}else O[M]=true}}for(k=0;k<A.length;k++)O=$E(true,O,_update(m.find(A[k]),N,r-1));if(t!==N){for(k in O)if(O[k]===true&&k!=v){if(y[k].delay&&!y[k].recalc)y[k]._update(m.find(k),N,r-1);else _update(m.find(k),N,r-1)}return{}}}return O||{}}}function _history(e,t,n,r){var i=t,s,o,u,a,f,l,c,h,p;if(!isO(i)||isNaN(a=i.remember)||!isO(s=i.history))return N;if(isO(e)&&a){l=Object.clone(e,true);c=Date.now();u=Object.keys(s).sort();if(u.length&&(c-u.last()<i.historyDelay||Object.equal(s[u.last()],l)))return N;i.history[c]=l;u.push(c);if(u.length>=a*2){p={};for(o=a;o<a*2;o++)p[u[o]]=s[u[o]];t.history=p}if(!r)i.form.trigger(Ch);return i.history[u.last()]}else if(!isNaN(e)||e===N){f=parseInt(e)||0;if(f<0)return N;u=Object.keys(s).sort();if(f>=u.length)f=u.length-1;h=Object.clone(i.history[u[u.length-f-1]],true);if(n){p={};for(o=0;o<u.length-f-1;o++)p[u[o]]=s[u[o]];t.history=p}if(!r)i.form.trigger(Ch);return h}else if(!r)i.form.trigger(Ch);return N}function _build(e,t,n,r){function p(){var t=null;if(isF(o.manifest)||isO(o.manifest)&&isO(o.manifest.ui))h=o.manifest;else if(isS(o.manifest)){h=_manifest(i.manifest,o.manifest)}if(h&&isS(o.bind)){var n=_getref(i.data,o.bind);if(u===null)u=$.Deferred();if(isA(n)||o.list){e.addClass("my-form-list");var a="",f=">*";if(/^<.+>$/.test(o.list))a=o.list;else f=o.list||f;if(!a){var l=e.find(f);a="<div></div>";if(l.size()){a=$(a).append(l.eq(0).clone(true)).html();l.eq(0).remove()}}if(!e.data("formlist"))e.data("formlist",{});e.data("formlist").generator={manifest:h,delay:(o.delay||s.delay||10)/1.3,template:a,selector:f,parent:i.manifest,bind:o.bind};e.on("insert.my",function(e,t){e.stopPropagation();var n={what:undefined,where:0};if(null==t)n.where=1e6;else if(isO(t))Object.merge(n,t);else if(isS(t)||isN(t))n.where=t;$(e.target).my("insert",n.where,n.what)});e.on("remove.my",function(e){e.stopPropagation();$(e.target).my("remove")})}else{try{t=e.my(_manifest(i.manifest,h),isO(n)?n:undefined)}catch(c){d("$.my subform init of "+r+" failed: "+c.message,c.stack)}}}if(isP(t)){t.then(v,function(e,t){d("Init of subform "+r+" failed with error: "+e,t)})}else v()}function d(e,t){f.con(e,t);if(u)u.reject(e,t)}function v(){e.each(function(){var u=$(this),a,f;f=u[0].nextSibling&&u[0].nextSibling.CodeMirror?u[0].nextSibling.CodeMirror:null;if(f)u.addClass("my-codemirror");a=o.events||_traverse(u,MY.events);if(!u.is(".my-form")){u.data("my",{events:a,selector:r,initial:l,previous:l,root:t,container:s.container(u),id:i.id,ui:o,data:i.data,params:s,errors:i.errors});n._update=o.delay?_update.debounce(o.delay):N}else{$E(u.data("my"),{dui:o,root:t,selector:r,dparams:s,devents:a,ddata:i.data,container:s.container(u),derrors:i.errors})}if(u.cleditor&&u.parent().is(".cleditorMain")){var c=u.cleditor()[0];if(c&&c.$frame&&c.$frame[0]){u.addClass("my-cleditor");$E(u.data("my"),{container:s.container(u)});var h=function(e){u.val(e).trigger(Ch)};var p,d=Number.random(1e5,1e6-1);$(c.$frame[0]).attr("id","cleditCool"+d);if(!document.frames)p=$("#cleditCool"+d)[0].contentWindow.document;else p=document.frames["cleditCool"+d].document;var v=$(p).find("body");$(p).bind("keyup.my",function(){h($(this).find("body").html())});u.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){h(v.html())});$("body").on("click","div.cleditorPopup",function(){h(v.html())})}}else if(u.is("div.redactor_box textarea")){var m,g="my-redactor-9";try{m=u.getEditor();g="my-redactor-8"}catch(y){m=u.redactor("getEditor")}if(m){u.addClass(g);m.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(u))}}else if(u.is(".ace_editor"))ace.edit(e[0]).on(Ch,function(e){e.trigger("ace")}.fill(u));else if(f){f.on(Ch,function(e){e.trigger("codemirror")}.fill(u))}u.my()._changed=_changed.debounce(n.delay||s.delay);u.my()._recalc=_recalc.debounce(n.delay||s.delay);u.bind(a,function(e){if(e.type==Ch)e.stopPropagation();u.my()._changed(u,t,n,s)});u.on("recalc.my, redraw.my",function(e){e.stopPropagation();u.my()._recalc(u,t,n,s)})});if(u)u.resolve()}var i=t.my(),s=(i||{}).params,o=n,u=null,a,l,c=0,h;if(!i){f.con("Failed to find $root building "+r+" selector.");return null}if(e.size()){if(o.init!=N)a=_prepare(i.manifest,o.init,e,i);if(isP(a)){c+=1;u=$.Deferred();a.then(p,function(e,t){d("Init of "+r+" failed: "+e,t)})}else p()}else f.con("Not found "+r+" selector.",t);return u}function _changed(e,t,n,r){var i=e.my();if(i&&!i.disabled){_history(i.ddata||i.data,i.dparams||i.params);var s=t.find(i.selector),o=_field(s,N);_update(e,o,n.recalcDepth||r.recalcDepth);if(i.root.parent().is(".ui-sortable"))i.root.parent().trigger("check");if(r.change)r.change.call(e)}}function _recalc(e,t,n,r){var i=e.my();if(i&&!i.disabled){var s=t.find(i.selector);if(s.is(".my-form"))s.my("redraw");else _update(e,s.is(".my-form-list")?_getref(s.my().data,s.data("formlist").generator.bind):N,n.recalcDepth||r.recalcDepth)}}function _prepare(e,t,n,r){var i;if(isS(t)){i=_getref(e,t);if(undefined===i){n.html(t.assign(r.data));return null}}else i=t;if(isF(i))return i.apply(e,Array.prototype.slice.call(arguments,2));else if(isA(i)){try{n.formgen(i)}catch(s){}}return null}function _unjson(node){for(var i in node)if(node.hasOwnProperty(i)){var n=node[i],t=$.type(n);if(/^(ob|ar)/.test(t))_unjson(n);else if(t==St&&/(^function\s\(|^new\sRegExp)/.test(n)){try{node[i]=eval("0||("+n+")")}catch(e){console.log(e.message,e.stack,n)}}}}function _normalize(e,t){var n=isO(t)?t:null;Object.each(e,function(t,n){var r=typeof n;if(/^str|^fu/.test(r))e[t]={bind:n}});Object.each(e,function(t,r){var i=[],s=[],o,u=/\s?[,;]\s?/,a,f;if(r.recalc){if(isS(r.recalc))i=r.recalc.split(u);else if(isA(r.recalc))i=r.recalc;i=i.compact(true).unique()}if(i.length)e[t].recalc=i;if(null==r.bind)r.bind=function(){};if(r.watch){if(isS(r.watch))s=r.watch.split(u);else if(isA(r.watch))s=r.watch.slice(0);s=s.compact(true).unique();for(f=0;f<s.length;f++)if(o=e[s[f]]){a=o.recalc;if(!a)o.recalc=[t];else if(isS(a))o.recalc+=","+t;else if(isA(a)&&a.indexOf(t)==-1)o.recalc.push(t)}}if(null!==n)["css","check","manifest","list"].each(function(e){if(isS(r[e])){var t=_getref(n,r[e]);if(t!=null)r[e]=t}})});return e}function _style(e,t){function s(n,r,i,u){var a,f,l,c;if(isS(n))i.push(r+(/\{/.test(n)?n:"{"+n+"}"));else if(isA(n)&&n.length)for(a=0;a<n.length;a++)s(n[a],r,i,u);else if(isO(n)){for(a in n){c=o(r,a);for(f=0;f<c.length;f++)s(n[a],c[f],i,u)}}else if(isF(n)){try{l=n.call(t,e,t);s(l,r,u,u)}catch(h){}}}function o(e,t){var n="",r=t+"",i;if(" "===r.to(1)||/^[a-z]/i.test(r))n=" ";i=r.split(/\s*,\s*/).compact(true);if(!i.length)i.push("");return i.map(function(t){return e+n+t})}var n=[],r=[],i=t;if(!isO(i)||!isO(i.style))return"";s(t.style,"",n,r);return[n,r]}function _getHelpersLib(){return{con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();if(t&&t.data)return t.data;return e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,n){return e[t](n?"disable":"enable")},overlap:function(e,t){function r(e,t,n){if(n===undefined||n===null)return t;if(!isO(n))return n;else return Object.merge(t,n,false)}if(!arguments.length)return{};if(arguments.length===1)return arguments[0];for(var n=1;n<arguments.length;n++)Object.merge(arguments[0],arguments[n],false,r);return arguments[0]},patch:function e(t,n){for(var r in n){if(n.hasOwnProperty(r)){if(isO(n[r])){if(!t.hasOwnProperty(r))t[r]=Object.clone(n[r],true);else e(t[r],n[r])}else if(!t.hasOwnProperty(r)){if(isA(n[r]))t[r]=n[r].clone(true);else t[r]=n[r]}}}return t},kickoff:function(e,t){var n=t&&typeof t=="object"?Object.clone(t,true):{},r;for(r in e)if(e.hasOwnProperty(r)){delete e[r];if(n[r]!==undefined)e[r]=n[r]}},sdbmCode:function(e){for(var t=JSON.stringify(e),n=0,r=0;r<t.length;r++)n=t.charCodeAt(r)+(n<<6)+(n<<16)-n;return(1e11+n).toString(36)},tojson:function(){function e(e){return e<10?"0"+e:e}function r(e,i,s){var o=0,u,a,f,l,c=i||0,h=t;if(s&&isS(s)){o=String(s).length;h=String(s).repeat(10)}switch((typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e)+"":"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\(.*)/,"$1 $3").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===Fu)return r(e.toJSON(),c+(s?1:0),s);u=[];if(isA(e)){for(a=0;a<e.length;a+=1){u.push(r(e[a],c+(s?1:0),s)||"null")}return"["+u.join(","+(s?"\n"+h.to(c*o+o):""))+"]"}for(f in e)if(isS(f)){l=r(e[f],c+(s?1:0),s);if(l)u.push((s?"\n"+h.to(c*o+o):"")+r(f,c+(s?1:0),s)+": "+l)}return"{"+u.join(",")+(s?"\n"+h.to(c*o):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"};RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var t="	".repeat(10),n=JSON.stringify;return r.fill(undefined,0,undefined)}(),fromjson:function(e){var t=JSON.parse(e);_unjson(t);return t},mask:function(e,t){function s(e,t){if(!isO(t))return{};var n={};for(var r in t){if(!isO(t[r])&&e.hasOwnProperty(r)){n[r]=Object.clone(e[r],true)}else if(e.hasOwnProperty(r)){if(isO(e[r]))n[r]=s(e[r],t[r]);else n[r]=Object.clone(e[r],true)}}return n}if(!isO(e))return null;var n,r=t;if(isS(r)){return _getref(e,r)}else if(isA(r)){n=[];for(var i=0;i<r.length;i++){n[i]=isS(r[i])?_getref(e,r[i])||null:null}return n}else if(isO(r))return s(e,r)},unmask:function(e,t){function i(e,t,n){var r,i,s,o=Object.clone(t,true),u=0;if(!/\./.test(n)){if(null!=t)e[n]=o}else{i=n.split(".").each(function(e,t){this[t]=String(e).compact()});r=e;for(;u<i.length;u++){if(u===i.length-1)r[i[u]]=o;if(u===0)r=e[i[0]],s=e;else s=s[i[u-1]],r=r[i[u]];if(undefined===r)r=s[i[u]]={}}}return e}var n={};if(isO(e)&&isO(t))return f.mask(e,t);else if(isA(e)&&isA(t)){for(var r=0;r<t.length;r++){if(e[r]!=null)i(n,e[r],t[r])}return n}else if(isS(t))return i({},e,t);else return null},getref:_getref,unjson:function(e){_unjson(e);return e}}}var _version="jQuery.my 0.9.9";var lang="en",forms={_src:{},_name:"Global manifest cache"},$E=$.extend,N=null,TMP,n=function(e){return e!==null&&e!==undefined},d8="{yyyy}-{MM}-{dd}",h24="{HH}:{mm}",Ob="object",Da="data",Ar="array",St="string",Fu="function",Ch="change",isA=Object.isArray,isB=Object.isBoolean,isS=Object.isString,isO=Object.isObject,isN=Object.isNumber,isR=Object.isRegExp,isF=Object.isFunction,isP=function(e){return!!(null!=e&&(isO(e)||e.jquery)&&isF(e.then)&&isF(e.fail)&&isF(e.state))},isRej=function(e){return isP(e)?e.state()==="rejected":null};var _cache=function(t,n){var r,i;if(isS(t)){r=t;i=_getref(isO(n)?n:forms,r);if("exist"===n)return isO(i);return!i?null:Object.clone(i,true)}else if(isO(t)){i=_putmanifest(t,n);if(!isO(i))return f.con(i),null;return i}else if(undefined===t){return forms._src}else if(null===t){return Object.reject(forms,/^_/)}else return null};var MY={vals:{".my-form":function(e,t){if(e&&e.my){var n=e.my(Da);return Object.equal(n,t)?n:e.my(Da,t,true)}else return t||N},".hasDatepicker":function(e,t){if(n(t))e.datepicker("setDate",t==""?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(d8):""},".my-tags":function(e,t){if(n(t)){if(isS(t)||isN(t))e.tags(Da,[t+""]);else if(isA(t))e.tags(Da,t)}return e.tags(Da)},".ui-draggable":function(e,t){if(n(t)&&isO(t)){var r={};if(!isNaN(t.left))r.left=Number(t.left).ceil(2)+"px";if(!isNaN(t.top))r.top=Number(t.top).ceil(2)+"px";if(r.left||r.top)e.css(r)}var i=e.position();return{left:t&&!isNaN(t.left)?(t.left*1).ceil(2):i.left.ceil(2),top:t&&!isNaN(t.top)?(t.top*1).ceil(2):i.top.ceil(2)}},".my-form-list":function(e,t){function S(){var t=$(this);if(t.data("my"))t.data("formlist").sdbmCode=f.sdbmCode(t.my("data"));e.trigger("check.my")}var r,i,s,o,u="ui-sortable",a=">."+u+"-placeholder",l=e.data("formlist")||{},c=l.generator||{},h=c.selector||">*",p=c.template||"<div></div>",d=c.delay||50,v=e.is("."+u),m=[],g;var y=v?e.find(e.sortable("option","items")):e.find(h);if(n(t)&&isA(t)){if(v&&e.find(a).size()!=0){return t}i=[];y.each(function(){var e=$(this);if(e.data("my"))i.push(e.my("data"))});o=false;if(i.length==t.length)for(o=true,r=0;r<i.length;r++)if(i[r]!==t[r])o=false;if(!o){s=$.extend(true,[],i,t);if(!Object.equal(i,s)||s.length!=t.length){var b=[],w={},E={};for(r=0;r<t.length;r++){b[r]=f.sdbmCode(t[r]);w[b[r]]=r}y.filter("*:not(.ui-sortable-placeholder)").each(function(){var e=$(this),t=e.data("formlist")||{},n=t.sdbmCode;if(n&&w.hasOwnProperty(n))E[n]=$(this);else e.remove()});for(r=0;r<t.length;r++){if(E[b[r]]){g=E[b[r]].detach().appendTo(e);m.push(g.my("data"))}else{g=$(/\{/.test(p)?p.assign(t[r]):p).appendTo(e);g.data("formlist",{index:r});g.on("change.my",S.debounce(d/1.3));g.data("formlist").list=t[r];g.my(_manifest(c.parent,c.manifest,t[r],r,t,e),t[r]);m.push(g.my("data"))}}(function(){e.trigger(Ch)}).debounce();return m}}return i}else if(y.size()){y.filter("*:not(.ui-sortable-placeholder)").each(function(e){var t=$(this);if(t.is(".my-form")&&t.data("my")){m.push(t.my("data"));if(e!=t.data("formlist").index){t.data("formlist").index=e;t.my("redraw")}}});return m}return t||[]},".ui-sortable":function(e,t){var r=[],i="ui-sortable",s=">."+i+"-placeholder",o=e.find(e.sortable("option","items")),u;if(n(t)&&isA(t)){var a={},l={},c=t.unique();if(e.find("input:focus:eq(0),textarea:focus:eq(0)").size()||e.find(s).size())return c;o.each(function(){a[f.sdbmCode(f.extval($(this)))]=$(this)});for(var h=c.length-1;h>=0;h--){var p=f.sdbmCode(c[h]);if(a[p]){a[p].prependTo(e).show();l[p]=true;if(r.indexOf(c[h])==-1)r.push(c[h])}}r=r.reverse();for(h in a)if(!l[h])a[h].hide()}else{var d=e.find(s),v=e.eq(0);if(d.size()!=0){if(v.my()[i]!=d.position().left+""+d.position().top){o=o.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");u=e.find(e.sortable("option","items")).filter(".ui-sortable-helper");o.each(function(){var e=$(this);if(e.is(".ui-sortable-placeholder")){r.push(f.extval(u))}else r.push(f.extval(e))});v.my()[i]=d.position().left+""+d.position().top;v.my()[i+"1"]=r}else r=v.my()[i+"1"];if(r==N)o.each(function(){r.push(f.extval($(this)))})}else{o=e.find(e.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");o.each(function(){r.push(f.extval($(this)))})}}return r},"input[type=date]":function(e,t){if(n(t)){if(t!="")r=Date.create(t).format(d8);else r="";if(isS(r)&&!/Invalid/.test(r))e.val(r);return r}var r=e.val();return r!=""?Date.create(r).format(d8):""},"input[type=time]":function(e,t){if(n(t)){if(t!="")r=Date.create(t).format(h24);else r="";if(isS(r)&&!/Invalid/.test(r))e.val(r);return r}var r=e.val();return r!=""?Date.create(r).format(h24):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){if(n(t))e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){if(n(t))e.val(t).trigger("update")},"div.select2-container+input":function(e,t){if(n(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val")))e.select2("val",isA(t)?t:[t]);return e.select2("val")},"":function(e,t){if(n(t))e.val(t+"")}},":radio":function(e,t){var r=-1;if(n(t)){e.each(function(e){var n=$(this).val();if(t+""===n+"")r=e});var i=e.eq(0).checkboxradio;if(i)e.each(function(e){var t=$(this);if(r!=e&&t.is(":checked"))t.prop("checked",false).checkboxradio("refresh")});if(r>-1){var s=e.eq(r);if(!s.is(":checked")){s.prop("checked",true);if(i)s.checkboxradio("refresh")}}else if(!i)e.each(function(){$(this).prop("checked",false)})}if(r==-1)for(var o=0;o<e.size();o++){if(e.eq(o).is(":checked"))r=o}return r!=-1?e.eq(r).val():""},":checkbox":function(e,t){var r=-1,i=t,s=[];if(n(i)){if(!isA(i))i=[t];var o=!!e.eq(0).checkboxradio;e.each(function(e){var t=$(this),n=t.val(),r=t.is(":checked");if(i.indexOf(n)!=-1){s.push(n);if(!r)t.prop("checked",true)}else if(r)t.prop("checked",false);if(o)t.checkboxradio("refresh")})}else{e.each(function(){var e=$(this);if(e.is(":checked"))s.push(e.val())})}return s}},select:{".ui-slider-switch":function(e,t){if(n(t)){e.val(t+"");e.slider("refresh")}},"div.select2-container+select":{"[multiple]":function(e,t){if(n(t))e.select2("val",isA(t)?t:[t]);return e.select2("val")},"":function(e,t){if(n(t))e.select2("val",t+"");return e.select2("val")}},"[multiple]":function(e,t){if(n(t)){e.val(t,[]);if(e.selectmenu)e.selectmenu("refresh",true)}},"":function(e,t){if(n(t)){e.val(t+"");if(e.selectmenu){if(e.selectmenu("option").theme!==undefined)e.selectmenu("refresh",true);else e.find("option").each(function(n){var r=$(this);if(f.extval(r)==t)e.selectmenu("value",n)})}}}},textarea:{".my-cleditor":function(e,t){if(n(t))e.val(t).cleditor()[0].updateFrame();return e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");if(n(t)){if(r)e.redactor("set",t);else e.setCode(t,false);return t}return r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){if(n(t)){e[0].nextSibling.CodeMirror.setValue(t);return t}return e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){if(n(t))e.val(t+"")}},"fieldset,form,section,aside,.my-container":function(e,t){var r=Array.prototype.slice.call(e[0],0).sort(),i=t;if(n(t)){if(isS(t))i=t.split(/[,\s]+/).compact(true);if(isA(i)){i.sort();if(i.join(" ")!==r.join(" ")){e.atrr("css",i.join(" "));r=i}}}return r},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){if(n(t))e.slider("option",e.slider("option","values")?"values":"value",f.clone(t));return f.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(e,t){if(!n(t)){var r=e.find(":radio:checked");if(r.size()&&r.button)return r.val()||r.button("option","label")}else if(t!=""){var i=N;e.find(":radio").each(function(){i=($(this).val()||$(this).button("option","label"))==t?$(this):i});if(i){i.attr("checked",true);e.buttonset("refresh");return t}}e.find(":radio:checked").attr("checked",false);e.buttonset("refresh");return""},".ace_editor":function(e,t){if(n(t))ace.edit(e[0]).setValue(t);return ace.edit(e[0]).getValue(t)},"":function(e,t){if(n(t))e.html(t);return e.html()}},"pre,code":function(e,t){if(n(t))e.html(t);return e.html()},img:function(e,t){if(n(t))e.attr("src",t);return e.attr("src")||""},"":function(e,t){if(n(t))e.html(t);return e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:TMP="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:TMP},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list,.ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my ","img, :radio, :checkbox":"click.my check.my ","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+(navigator.appName.to(5)==="Micro"?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(e){var t=e[0].parentNode,n=t.nodeName;if(/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n))return $(t);else return e.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){f.jquix(t,"selectable",e)},".ui-slider":function(e,t){f.jquix(t,"slider",e)},".ui-draggable":function(e,t){f.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){f.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){f.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){f.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(e){e.find(">.my-form").each(function(){$(this).my("remove")});e.removeClass("my-form-list");e.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(e){e.find(">.my-form").each(function(){$(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor();e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea();e.removeClass("my-codemirror")}}}};MY.params={container:function(e){return _traverse(e,MY.containers)(e)},change:N,recalcDepth:2,delay:0,strict:false,locale:TMP=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(MY.msg,function(e,t){return t[TMP]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",pendingCss:"my-form-pending",animate:0,effect:function(e,t,n){if(t)return e.fadeIn(n);e.fadeOut(n)},remember:0,silent:false,history:{},historyDelay:100};var f=_getHelpersLib();var methods={init:function(e,t,n){function M(){function n(n){if(!S){e[n]=_field(L.find(n),N);t-=1;if(t<.5)_(e)}}var e={},t=Object.size(h);L.addClass(p.pendingCss);Object.each(h,function(e){if(S)return;var t=L.find(e),r=_build(t,L,h[e],e);if(isP(r)){r.then(n.fill(e)).fail(function(t,n){D("Error building "+e+", "+t,n)})}else if(!S)n(e)})}function _(e){for(var t in h){if(S)return;var n=L.find(t);if(n.size()){try{var r=h[t];var i=_bind(c,N,r,n);if(i!=N)_field(n,i);else{try{if(e[t]!=N&&i!==undefined)_bind(c,e[t],r,n)}catch(s){}}n.eq(0).trigger("check.my")}catch(s){D("Error linking "+t,s.stack)}}}L.removeClass(p.pendingCss);k=null;E.resolve(c)}function D(e,t){var n;S=true;f.con("Form "+s+" failed to initialize: "+e,t);L.removeClass(p.pendingCss);n=T(e,t);if(isS(n)||isO(n)&&n.jquery)L.html(n);else if(n===true)L.html(k);if(!p.silent){if(!L.my().ddata){L.removeData("my");L.removeClass("my-form");if(b){if(b.data("count")=="1"){try{b.remove()}catch(r){}}else b.data("count",b.data("count")-1)}if(w){try{w.remove()}catch(r){}}}E.reject("Form "+s+" failed to initialize: "+e,t)}else E.resolve(c)}var r,i,s,o,u,a,l,c,h,p,d,v,m,g,y,b,w,E=$.Deferred(),S=false,x,T=function(){},C="std",k="";if(isS(e)){r=_cache(e);if(r){if(isO(n)&&isO(t)){r=$E(r,t);i=n}else i=t;C="repo"}else{E.reject("No manifest with id "+e+" found in repo.");return E.promise()}}else{r=e;i=t}if(!r)return this;if(isO(i)&&C!="repo")d=$E(true,{},r);else d=r;var L=this.eq(0),A=L.my();if(isO(A)&&A.id&&A.ui){f.con("jQuery.my is already bind.",L);L.my("ui",d.ui);L.my(Da,d.data);return E.resolve(L.my(Da)).promise()}if(!d.params||d.params&&!d.params.strict)_unjson(d);a=$E(true,{},d);p=$E(true,{},MY.params,d.params||{});h=_normalize($E(true,{},d.ui||{}),a);o=Number.random(268435456,4294967295).toString(16);s=d.id||"my"+o;u=f.sdbmCode(s);c={};p.form=L;if(d.params&&d.params.depth)p.recalcDepth=d.params.depth;for(v in a)if(isF(a[v]))a[v].bind(a);if(isO(i)){c=f.patch(i,d.data||{});d.data=c}else c=d.data||{};if(d.error){if(isS(d.error)){T=function(){return d.error.assign(c)}}else if(isF(d.error)){T=function(e,t){l=null;try{l=d.error(e,t)}catch(n){l=p.messages.initFailed}return l}}}$.extend(L,E.promise());L.data("my",{id:s,cid:o,mid:u,data:c,params:p,errors:Object.extended(),ui:Object.extended(h),disabled:false,manifest:a,promise:E.promise()});a.id=s;L.addClass("my-form");g="my-manifest-"+u;y="my-form-"+o;L.addClass(y+" "+g);E.fail(function(){L.removeClass(y+" "+g)});if(a.style){m=_style(L,a,g,y);if(m&&m[0].length){b=$("style#"+g);if(!b.size()){b=$('<style id="'+g+'" data-count="0">'+"."+g+m[0].join(" \n."+g)+"\n"+"</style>").appendTo($("body"))}b.data("count",b.data("count")*1+1);L.data("my").style=b}if(m&&m[1].length){w=$("style#"+y);if(!w.size()){w=$('<style id="'+y+'" data-count="0">'+"."+y+m[1].join(" \n."+y)+"\n"+"</style>").appendTo($("body"))}L.data("my").localStyle=w}}if(d.init!=N){k=L.find(">*").clone();try{x=_prepare(a,d.init,L,d)}catch(O){D(isS(O)?O:O.message,O.stack);return L}}if(isP(x)){L.addClass(p.pendingCss);x.then(function(){M()},function(e,t){D(e,t)})}else M();if(!S){if(!L.my())return D("Internal error initializing controls",""),L;L.data("my").initial=$E(true,{},c);if($.mobile)$.mobile.changePage($.mobile.activePage)}return L},redraw:function(e,t){var n=this,r=n.my();if(r&&r.ui){r.ui.each(function(t){var i=n.find(t);_update(i,e?N:undefined,r.params.recalcDepth);if(!e){if(i.is(".my-form"))i.my("redraw");if(i.is(".my-form-list"))i.trigger("redraw");else i.trigger("check.my")}});if(!t&&e)n.trigger(Ch)}return n},data:function(e,t){var n=this;if(isO(e)){n.my().data=f.overlap(n.my().data,e);this.my("redraw",t)}return n.my().data},errors:function(){var e=$(this).my().errors,t={};for(var n in e){if(e[n]&&isS(e[n]))t[n]=e[n];if(isO(e[n])&&Object.keys(e[n]).length)t[n]=e[n]}return t},valid:function(){var e=$(this).my().errors,t=0;for(var n in e){if(e[n]&&isS(e[n]))t++;else if(isO(e[n])&&Object.keys(e[n]).length)t++}return!t},reset:function(){try{f.kickoff(this.my().data,this.my().initial);this.my("redraw")}catch(e){return false}return true},id:function(e,t){if(isS(e))return _cache(e,t);else{var n=this.my();return n&&n.id?n.id:N}},remove:function(e){var t=this,n,r,i,s,o,u,a;if(!this.my())return N;if(this.my().root&&!this.my().ddata)t=this.my().root;i=t.my();s=i.data;u=i.cid;a=i.mid;t.unbind(".my");if(n=i.style){if(n.data("count")=="1"){try{n.remove()}catch(f){}}else n.data("count",n.data("count")-1)}if(r=i.localStyle){try{r.remove()}catch(f){}}o=(i||{}).ui;if(o){o.each(function(e){var n=t.find(e),r;n.unbind(".my");try{r=_traverse(n,MY.destroy);if(isF(r))r(n)}catch(i){}n.removeData("formlist").removeData("myval").removeData("my")})}if(t.data("formlist")&&t.is(".my-form")||e){var l=t.parents(".my-form-list").eq(0);t.remove();l.trigger("check")}else{t.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form")}t.removeClass("my-form-"+u+" my-manifest-"+a);return s},undo:function(e){var t=this,n=t.my(),r=n.params.history,i=Object.keys(r).sort(),s=1*(parseInt(e)||0),o;if(!i.length||s<0)return N;if(!n.params.errors||!n.params.errors.values().compact(true).length){if(Object.equal(r[i.last()],n.data))s+=1}else if(!Object.equal(n.data,n.lastCorrect))s+=1;o=_history(s,n.params,true);if(o){f.kickoff(t.my().data,o);t.my("redraw")}return t.my().data},ui:function(e){var t=this,n=t.my(),r=[],i;if(!n)return N;var s=$E(true,{},n.ui);if(!isO(e))return n.ui;for(i in e)if(true||!s[i])r.push(i);n.ui=_normalize(f.overlap(n.ui,e));for(i=0;i<r.length;i++)_build(t.find(r[i]),t,n.ui[r[i]],r[i]);for(i in e)t.find(i).eq(0).trigger("check");return n.ui},disabled:function(e){var t,n,r,i,s=this,o=s.my();if(!o)return undefined;if(e==N)return o.disabled;if(!!e){for(n in o.ui){t=s.find(n).eq(0);r=t.my();if(r)r.predisabled=r.disabled;_css(true,t,":disabled")}s.addClass("my-disabled")}else{for(n in o.ui){t=s.find(n).eq(0);r=t.my();i=false;if(r&&r.predisabled)i=true;_css(i,t,":disabled")}s.removeClass("my-disabled");s.my("redraw")}},find:function(t){var n=this,r=n.my();if(r&&r.root)n=r.root;return n.find(t)},manifest:function(e){return e=="json"?f.tojson(this.my().manifest):this.my().manifest},version:function(){return _version},history:function(e,t){return _history(e,this.my().params,t)},val:function(e){return _field(this,e)},container:function(e){return _traverse(e,MY.containers)(e)},promise:function(e){if(isF(e))this.my().promise.then(e);return this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var n=this.is(".my-form-list")?this:this.my().root||this,r=n.is(".my-form-list")?n:n.parent(".my-form-list"),i=(n.data("formlist")||{}).index,s,o=t,u;if(null==i)i=0;s=_getref(r.my().data,r.data("formlist").generator.bind);if(!isO(o)){if(!isO(r.data("formlist").generator.manifest)){if(r===n)throw"No data to insert, cannot guess when manifest is function.";o=Object.clone(n.my().manifest.data,true)}else o=Object.clone(r.data("formlist").generator.manifest.data,true)||{}}if("before"===e)u=i;else if("after"===e)u=i+1;else if(!isNaN(e)){u=(1*e).clamp(0,s.length)}else throw"Invalid position for insert";s.add(o,u);r.trigger("redraw")}};if(!$.my)$.my={};$.extend($.my,{f:f,tojson:f.tojson,fromjson:f.fromjson,rules:MY,cache:function(e,t){if(isF(e))return _cache=e;else return _cache(e,t)},version:function(){return _version}});$.my.chain=function(){function s(){if(n.length&&r){var e=n.shift(),t,i=function(){s.delay(e[1])}.once();try{t=e[0]()}catch(o){i()}if(isP(t)){t.then(i,i);i.delay(e[1])}else i()}}var e=1,t=1e3,n=[],r=false,i=function(r,i,o){n.push([r,i||e,o||t]);s()};i.delay=function(t){if(!isNaN(t))e=(t-0).clamp(0,1e6);return e};i.timeout=function(e){if(!isNaN(e))t=(e-0).clamp(1,1e6);return t};i.start=function(){r=true;s()};i.stop=function(){r=false};return i}();$.fn.my=function(e){var t;if(e===undefined)return this.data("my");if(isS(e)&&e.substr(0,1)=="{"){try{t=JSON.parse(e)}catch(n){}if(t)return methods.init.apply(this,[t].add(Array.prototype.slice.call(arguments,1)))}if(isS(e)&&methods[e])return methods[e].apply(this,Array.prototype.slice.call(arguments,1));else if(isS(e)&&_cache(e,"exist"))return methods.init.apply(this,arguments);else if(typeof e===Ob||!e)return methods.init.apply(this,arguments);else $.error("Method "+e+" does not exist on jQuery.my")};return})(jQuery);(function(e){function w(e,n,r){if(h(n))return e+n;if(p(n)){r=t(true,r,n);return e}else if(l(n)&&n.length>1&&h(n[1])){var i=n[0],s="",o,f,c,d,v=1,m,g,y,w;while(v<n.length){if(h(n[v])){d=n[v].replace(/\s/g,"");c=d.split(/[\.#]/i);f=r.alias[c[0]]||c[0];o=d.substr(c[0].length);if(/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(d)){y=b.tmpl[f]||b.tmpl[""];g={style:"","class":"",txt:""};w="";var E=p(n[v+1]);if(E){v+=1;for(m in n[v])if(b.attnames[m]!=="")g[b.attnames[m]||m]=n[v][m]}if(!g.style&&!g["class"]&&r.styles[f])g.style=r.styles[f];if(!g.id&&o.to(1)=="#")g.id=o.from(1).split(".")[0];if(!g["class"]&&/\./.test(o))g["class"]=(o.to(1)=="#"?o.substr(g.id.length+1):o).split(".").compact(true).join(" ");for(m in g)w+=m+'="'+g[m]+'" ';if(E)for(m in n[v])if(b.attnames[m]==="")g[m]=n[v][m];g.ext=w;if(!g.txt&&b.txt[f])g.txt=b.txt[f](g);g._tag=f;s+=typeof y==a?y(g)||"":typeof y==u?y.assign(g):""}else s+=n[v]}v+=1}if(s){s="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&i?"padding-left:"+r.label+"; ":"")+'">'+(i?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+i+"</"+r.labelTag+">":"")+s+"</"+r.rowTag+">"}return e+s}return e}function E(e){var t=e;if(h(t)){t=t.split(/[\s,]/).compact(true)}if(l(t)){var n={};for(var r=0;r<t.length;r++){var i=t[r];if(p(i)){var s=Object.keys(i);if(s.length==1)n[s[0]]=i[s[0]]+"";else n[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else n[i]=i+""}t=n}if(p(t))return t;else return{}}function S(n,r){var i={};if(l(n)){t(true,i,b.params,r||{});return n.length?n.reduce(w.fill(undefined,undefined,i),""):""}else if(p(n)){e.extend(b,n)}else return""}var t=e.extend,n=function(e){return e!==null&&e!==undefined},r=null,i="object",s="data",o="array",u="string",a="function",f="change",l=Object.isArray,c=Object.isBoolean,h=Object.isString,p=Object.isObject,d=Object.isNumber,v=Object.isRegExp,m=Object.isFunction;var g='<input type="',y=" {ext} ";var b={tmpl:{num:g+'number" {ext}/>',inp:g+'text" {ext}/>',sli:g+'range" {ext}/>',dat:g+'date" {ext}/>',btn:g+'button" {ext}/>',div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!l(e.vals))return"";var n=t({style:"",css:""},e);n.txt=e.vals.reduce(function(e,t){return e+'<span class="my-shortcut" '+"onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," ");return'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(n)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=E(e.vals);return Object.keys(t).reduce(function(e,n){return e+'<option value="'+n+'">'+t[n]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}};var x={init:function(t,n){return e(this).html(S(t,n))}};if(!e.my)e.my={};e.my.formgen=S;e.fn.formgen=function(t){if(h(t)&&x[t])return x[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return x.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.formgen")}})(jQuery);(function(e){function v(i){var s=window,o=s.innerHeight||e(s).height(),u=s.innerWidth||e(s).width(),a=n.height(),f=i||r.width();n.removeClass("loading").css({left:(u-f-60)/2+"px",width:f*1+60+"px",display:"block"});t.css({width:u*2+"px",height:o*2+"px",display:"block"});if(a>o){n.height(o);r.css({"overflow-y":"overlay"})}else{r.css({"overflow-y":"none"})}n.animate({top:(a>=o?0:(o-a)/3.5)+"px"},parseFloat(n.css("top"))<o?300:0)}var t,n,r,i={},s="body",o=false,u,a=Object.isArray,f=Object.isBoolean,l=Object.isString,c=Object.isObject,h=Object.isNumber,p=Object.isRegExp,d=Object.isFunction;$(document).keydown(function(e){if(e.keyCode==27&&$(s).find(">.my-modal").is(":visible")&&(!r.is(".my-form")||r.data("escapable")||Object.equal(r.data("my").initial,r.my("data"))))i.modal(true)});i.modal=function(h,p,m){var g=p||function(){return false},y,b=false,w=false,E=true,S="",x,T=m||820,N=300;if(o){if(f(h)||h===null||h===undefined){if(d(n.data("done")))g=n.data("done");else g=function(){return false};b=false;E=true;if(!h){if(!r.is(".my-form"))b=g(null,true);else{b=g(r.my("valid")?null:r.my("errors"),r.my("data"));if(!b)E=r.my("remove")}}else if(h===true&&u.state()!="rejected"){if(r.is(".my-form"))r.my("remove");g(null,null);u.reject("Cancelled")}if(!b){r.html("");n.css({display:"none"});(function(){if(!o)t.css({display:"none"})}).delay(5);o=false;n.data("done",null);(function(){u.resolve(E)}).delay(0)}return}y=$.Deferred();g(null,null);y.reject("Locked");return y.promise()}u=$.Deferred();o=true;if(!n||!$(s).find(">.my-modal").size()){n=$('<div class="my-modal" style="display:none;"></div>').prependTo($(s))}n.html('<div class="my-modal-form"></div>');r=n.find(".my-modal-form");$('<div class="my-modal-close" title="Close">×</div>').prependTo(n).on("click",function(){i.modal(true)});if(!t||!$(s).find(">.my-modal-screen").size()){t=$('<div class="my-modal-screen" style="display:none;"></div>').prependTo($(s)).on("click",function(){if(!r.is(".my-form")||r.data("escapable"))i.modal(true)})}if(typeof h=="object"&&h.jquery){if(h.is("img")){S=h.attr("alt")||h.attr("title")||h.data("text");r.html(function(){var t=h,n=t[0].naturalWidth||t[0].width,r=t[0].naturalHeight||t[0].height,i=e(window).width()-90,s=e(window).height()-90,o;if(s<r)n=n*(s/r)|0,r=s;if(i<n)n=i,r=r*(i/n)|0;o='<img src = "'+t.attr("src")+'" class="db" style="max-width:'+n+"px;max-height:"+r+'px">';T=n<300?300:n;return o}()+(S?'<h4 class="mt10">'+S+"</h4>":""));r.find("img").on("click",function(){i.modal()});n.css({top:"3000px",display:"block"});N=n.height();w=1}}else if(c(h)&&h.manifest){E=h.data||{};g=d(h.done)?h.done:g;T=1*($.my.f.getref(l(h.manifest)?$.my.cache(h.manifest):h.manifest,"params.width")||h.width||T);n.css({top:"3000px",display:"block"});r.data("my",null);w=1;r.my(h.manifest,E).then(function(){v.delay(20);u.notify("Ready")}).fail(function(e){u.reject(e);w=0;i.modal(true)});n.data("done",g);r.data("escapable",!!h.esc);r.bind("commit.my",function(){i.modal()}.debounce(50)).bind("cancel.my",function(){i.modal(true)}.debounce(50)).bind("layout.my",function(){v()})}else if(l(h)){r.html(h);n.css({top:"3000px",display:"block",width:"auto"});T=1*(n.width()||T);w=1}else if(h===true)return o=false,u.reject("Cancelled").promise();else return o=false,u.reject("Invalid data").promise();if(w){v(T);x=r.find("img").filter(function(){return $(this).attr("src")!=""});if(x.size()){var C=function(){v(m);u.notify("Ready")}.after(x.size());x.each(function(){$(this).bind("load",C)})}else{u.notify("Ready")}}return u.promise()};i.modal.loading=function(e){$(s).find(">.my-modal").toggleClass("my-modal-loading",!!e)};i.modal.parent=function(e){if(!e||!$(e).size())return $(s);s=e};i.modal.visible=function(){return o};if(!e.my)e.my={};e.my.modal=i.modal})(jQuery);