/*
 * jQuery.my 0.7.0 minified
 * Requires jQuery 1.8.1+, SugarJS 1.3.7+
 * See more details at jquerymy.com
 * 
 * (c) ermouth 
 * 2013-01-17
 */
;(function(e){var t="jQuery.my 0.7.0";var n=function(e){return e!==null&&e!==undefined},r="en",i={},s="{yyyy}-{MM}-{dd}";var o={vals:{".my-form":function(e,t){if(e&&e.my){var n=e.my("data");return Object.equal(n,t)?n:e.my("data",t,true)}else return t||null},".hasDatepicker":function(e,t){if(n(t))e.datepicker("setDate",t==""?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(s):""},".my-tags":function(t,r){if(n(r)){var i=r;if(typeof r=="string")t.tags("data",[r]);else if(e.type(r)=="array")t.tags("data",r)}return t.tags("data")},".ui-draggable":function(t,r){if(n(r)&&e.type(r)=="object"){var i={};if(!isNaN(r.left))i.left=Number(r.left.ceil(2))+"px";if(!isNaN(r.top))i.top=Number(r.top.ceil(2))+"px";if(i.left||i.top)t.css(i)}var s=t.position();return{left:r&&r.left?r.left.ceil(2):s.left.ceil(2),top:r&&r.top?r.top.ceil(2):s.top.ceil(2)}},".ui-sortable":function(t,r){var i=[],s="ui-sortable",o=">."+s+"-placeholder",a=t.find(t.sortable("option","items"));if(n(r)&&e.type(r)=="array"){var l={},c={},h=r.unique();if(t.find("input:focus:eq(0)").size()!=0||t.find(o).size()!=0)return h;a.each(function(){l[JSON.stringify(u.extval(e(this)))]=e(this)});for(var p=h.length-1;p>=0;p--){var d=JSON.stringify(h[p]);if(l[d]){l[d].prependTo(t).show();c[d]=true;if(i.indexOf(h[p])==-1)i.push(h[p])}}i=i.reverse();for(p in l)if(!c[p])l[p].hide()}else{var v=t.find(o),m=t.eq(0);if(v.size()!=0){if(m.data("my")[s]!=v.position().left+""+v.position().top){var a=a.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");var g=t.find(t.sortable("option","items")).filter(".ui-sortable-helper");a.each(function(){var t=e(this);if(t.is(".ui-sortable-placeholder")){i.push(u.extval(g))}else i.push(u.extval(t))});m.data("my")[s]=v.position().left+""+v.position().top;m.data("my")[s+"1"]=i}else i=m.data("my")[s+"1"];if(i==null){console.log(1);a.each(function(){i.push(u.extval(e(this)))})}}else{var a=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");a.each(function(){i.push(u.extval(e(this)))})}}return i},"input[type=date]":function(t,r){if(n(r)){if(r!="")i=Date.create(r).format(s);else i="";if(e.type(i)=="string"&&!i.has("Invalid"))t.val(i);return i}var i=t.val();return i!=""?Date.create(i).format(s):""},"input,button":{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){if(n(t))e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){if(n(t))e.val(t).trigger("update")},"div.select2-container+input":function(t,r){if(n(r))t.select2("val",e.type(r)=="array"?r:[r]);return t.select2("val")},"":function(e,t){if(n(t))e.val(t)}},":radio":function(t,r){var i=-1;if(n(r)){t.each(function(t){var n=e(this).val();if(String(r)===String(n))i=t});var s=t.eq(0).checkboxradio;if(s)t.each(function(t){var n=e(this);if(i!=t&&n.is(":checked"))n.attr("checked",false).checkboxradio("refresh")});if(i>-1){var o=t.eq(i);if(!o.is(":checked")){o.attr("checked",true);if(s)o.checkboxradio("refresh")}}else if(!s){t.each(function(){e(this).attr("checked",false)})}}if(i==-1)for(var u=0;u<t.size();u++){if(t.eq(u).is(":checked"))i=u}return i!=-1?t.eq(i).val():""},":checkbox":function(t,r){var i=-1,s=r,o=[],u={};if(n(s)){if(e.type(s)!="array")s=[r];var a=!!t.eq(0).checkboxradio;t.each(function(t){var n=e(this),r=n.val(),i=n.is(":checked");if(s.indexOf(r)!=-1){o.push(r);if(!i)n.attr("checked",true)}else if(i)n.attr("checked",false);if(a)n.checkboxradio("refresh")})}else{t.each(function(t){var n=e(this);if(n.is(":checked"))o.push(n.val())})}return o}},select:{".ui-slider-switch":function(e,t){if(n(t)){e.val(String(t||""));e.slider("refresh")}},"[multiple]":function(e,t){if(n(t)){e.val(t,[]);if(e.selectmenu)e.selectmenu("refresh",true)}},"":function(t,r){if(n(r)){t.val(String(r||""));if(t.selectmenu){if(t.selectmenu("option").theme!=null)t.selectmenu("refresh",true);else{t.find("option").each(function(n){var i=e(this);if(u.extval(i)==r)t.selectmenu("value",n)})}}}}},textarea:{".my-cleditor":function(e,t){if(n(t))e.val(t).cleditor()[0].updateFrame();return e.val()},"div.redactor_box textarea":function(e,t){if(n(t))e.setCode(t);return e.getCode()},"":function(e,t){if(n(t))e.val(t)}},"div,span,a,p,form,fieldset,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){if(n(t))e.slider("option",e.slider("option","values")?"values":"value",u.clone(t));return u.clone(e.slider("option","values")||e.slider("option","value")||"")},".ui-buttonset":function(t,r){if(!n(r)){var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}else if(r!=""){var s=null;t.find(":radio").each(function(){s=(e(this).val()||e(this).button("option","label"))==r?e(this):s});if(s){s.attr("checked",true);t.buttonset("refresh");return r}}t.find(":radio:checked").attr("checked",false);t.buttonset("refresh");return""},".ace_editor":function(e,t){if(n(t))ace.edit(e[0]).setValue(t);return ace.edit(e[0]).getValue(t)},"":function(e,t){if(n(t))e.html(t);return e.html()}},"pre,code":function(e,t){if(n(t))e.html(t);return e.html()},img:function(e,t){if(n(t))e.attr("src",val);return e.attr("src")||""},"":function(e,t){if(n(t))e.html(t);return e.html()||e.text()||String(e.val())||""}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".ace_editor":"ace.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my ","img, a, .pseudolink, input[type=button], button, :radio, :checkbox":"click.my check.my ",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+(e.browser.msie?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(e){return e.parents("div,span,a,p,form,fieldset,li,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){u.jquix(t,"selectable",e)},".ui-slider":function(e,t){u.jquix(t,"slider",e)},".ui-draggable":function(e,t){u.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){u.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){u.jquix(t,"datepicker",e)},"div.select2-container+input":function(e,t){u.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}}};var u={con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.data("my");if(t&&t.data)return t.data;return e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,n){return e[t](n?"disable":"enable")},overlap:function(t,n){return Object.merge(t,n,false,function(t,n,r){if(e.type(r)!="object")return r;else return Object.merge(n,r,false)})},field:function(t,n){var r=t.data("myval");if(!r){var i=u.traverse(t,o.vals);if(typeof i=="function"){var s=i(t,null);if(s===undefined){t.data("myval",function(e,t){if(t!=null)i(e,t);return e.val()}.fill(t,undefined))}else{t.data("myval",i.fill(t,undefined))}}r=t.data("myval")}if(typeof r=="function"){var s=r();if(s!=n||e.type(n)=="object")s=r(n);return s}else return null},traverse:function(t,n){function o(n,u){for(var a in n){if(a!=""&&t.is(a)){s=s+(s?" ### ":"")+a;var f=e.type(n[a]);if(!/^(null|undefined|object)/.test(e.type(n[a]))&&u>i){r=n[a];i=u;return}else if(f=="object"){o(n[a],u+1)}}}if(n[""]!=null&&typeof n[""]!="object"&&u>i){r=n[""];i=u}}var r=null,i=0,s="";o(n,1);return r},bind:function(t,n,r,i){var s=r.bind,o,u=[],a,f,l=e.type(s);if(l=="function"){return s(t,n,i)}if(l=="string"||l=="array"){if(l=="string"&&!/\./.test(s)){if(n!=null)t[s]=n;else if(t[s]===undefined)t[s]=null;return t[s]}if(l=="string")u=s.split(".").each(function(e,t){this[t]=String(e).compact()});if(l=="array")u=s.slice(0).each(function(e,t){this[t]=String(e).compact()});a=t;for(o=0;o<u.length;o++){if(o==u.length-1){if(n!=null)a[u[o]]=n;else if(a[u[o]]===undefined)a[u[o]]=null;return a[u[o]]}if(o==0){a=t[u[0]];f=t}else{f=f[u[o-1]];a=a[u[o]]}if(a===undefined)a=f[u[o]]={}}}return null},isOut:function(t,n,r,i){var s=r.check;if(s!=null){var o=r["error"]||i.data("my").root.data("my").params.errorMessage||"Error";switch(e.type(s).to(1)){case"f":return s(t,n,i);case"r":return s.test(String(n))?"":o;case"a":return s.indexOf(n)>-1?"":o;case"s":return n==s?"":o;case"o":return s[n]?"":o}return o}else{return""}},css:function(e,t,n){var r=n.compact(),i=r.replace(/:disabled/g,""),s=t.eq(0),a=s.data("my"),l=a?a.container:t;if(i)e?l.addClass(i):l.removeClass(i);if(i!=r){if(a!==undefined&&!!e!=!!a.disabled){s.data("my").disabled=!!e;if(!a._disable)s.data("my")._disable=u.traverse(t,o.offon).fill(undefined,t);a._disable(!!e)}}return l},update:function(t,r,i){var s=t,o=s.data("my"),a="Unknown error";if(o){var l=o.selector,c=o.root,h=c.find(l),p=c.data("my").ui,d=t.hasClass("my-form");if(d)var v=t,m=o.ddata,g=o.dui,y=o.dparams;else v=o.container,m=o.data,g=o.ui,y=o.params;if(n(r))var b=r;else b=u.field(h,u.bind(m,null,g,h));try{var a=u.isOut(m,b,g,h)}catch(w){u.con("Error "+w.name+" validating "+l,c)}var E=y.errorCss;var S="ui-state-error";if(a==""){o.errors[l]="";if(r!=null)b=u.field(h,u.bind(m,r,g,h));y.effect(v.removeClass(E).find(y.errorTip),false,y.animate/2);s.removeClass(S);s.find(".ui-widget").removeClass(S)}else{o.errors[l]=a;y.effect(v.addClass(E).find(y.errorTip).addClass(E).html(a),true,y.animate);if(s.is(".hasDatepicker")){if(s.is("input"))s.addClass(S);else s.find(".ui-widget").addClass(S)}if(s.is(".ui-slider"))s.addClass(S)}var x=r==null?b:r;if(g.css){for(var T in g.css){var N=g.css[T];if(Object.isRegExp(N))u.css(N.test(x),h,T);else if(Object.isFunction(N))u.css(N(m,x,h),h,T)}}if(i&&g.recalc){var C,k=g.recalc,L=[],A={},p=c.data("my").ui,O;if(typeof k=="string")k=k.split(",");if(Object.isArray(k)){for(var C in k){if(k[C]&&e.type(k[C])=="string"&&(O=k[C].compact())){if(p[O].recalc){if(L.indexOf(O)==-1)L.push(O)}else A[O]=true}}for(C=0;C<L.length;C++)A=e.extend(true,A,u.update(c.find(L[C]),null,i-1));if(r!==null){for(C in A)if(A[C]===true&&C!=l){if(p[C].delay&&!p[C].recalc)p[C]._update(c.find(C),null,i-1);else u.update(c.find(C),null,i-1)}return{}}}}return A||{}}},history:function(t,n,r,i){var s=n;if(e.type(s)!="object"||isNaN(s.remember)||e.type(s.history)!="object")return null;var o=s.history;var u=s.remember;if(e.type(t)=="object"&&u){var a=Object.extended(JSON.parse(JSON.stringify(t)));var f=(new Date).valueOf();var l=o.keys().sort();if(l.length>0&&f-l[l.length-1]<s.historyDelay)return null;if(l.length>0&&o[l[l.length-1]].equals(a))return null;s.history[f]=a;l.push(f);if(l.length>=u*2){var c=Object.extended();for(var h=u;h<u*2;h++)c[l[h]]=o[l[h]];n.history=c}if(!i)s.form.trigger("change");return s.history[l[l.length-1]]}else if(!i)s.form.trigger("change");if(!isNaN(t)||t===null){var p=parseInt(t)||0;if(p<0)return null;var l=o.keys().sort();if(p>=l.length)p=l.length-1;var d=s.history[l[l.length-p-1]].clone(true);if(r){var c=Object.extended();for(var h=0;h<l.length-p-1;h++)c[l[h]]=o[l[h]];n.history=c}if(!i)s.form.trigger("change");return d}},initControl:function(t,n,r,i){var s=n.data("my"),a=s.params,l;if(t.size()){if(r.init!=null)u.prepare(r.init,t,s);t.each(function(){var t=e(this),c=r.events||u.traverse(t,o.events);if(!t.is(".my-form")){t.data("my",{events:c,selector:i,initial:l,previous:l,root:n,container:a.container(t),id:s.id,ui:r,data:s.data,params:a,errors:s.errors});r._update=r.delay?u.update.debounce(r.delay):null}else{e.extend(t.data("my"),{dui:r,root:n,selector:i,dparams:a,devents:c,ddata:s.data})}if(t.cleditor&&t.parent().is(".cleditorMain")){var h=t.cleditor()[0];if(h&&h.$frame&&h.$frame[0]){t.addClass("my-cleditor");e.extend(t.data("my"),{container:a.container(t)});var d=function(e){t.val(e).trigger("change")};var m,g=Number.random(1e5,1e6-1);e(h.$frame[0]).attr("id","cleditCool"+g);if(!document.frames)m=e("#cleditCool"+g)[0].contentWindow.document;else m=document.frames["cleditCool"+g].document;var y=e(m).find("body");e(m).bind("keyup.my",function(){d(e(this).find("body").html())});t.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){d(y.html())});e("body").on("click","div.cleditorPopup",function(){d(y.html())})}}if(t.is("div.redactor_box textarea"))t.getEditor().bind("input",function(e){e.trigger("redactor")}.fill(t));if(t.is(".ace_editor"))ace.edit(e("#ace")[0]).on("change",function(e){e.trigger("ace")}.fill(t));t.data("my")._changed=u.changed.debounce(r.delay||a.delay);t.bind(c,function(e){if(e.type=="change")e.stopPropagation();t.data("my")._changed(t,n,r,a)})})}else u.con("Not found "+i+" selector.",n);return t},changed:function(t,n,r,i){var s=t.data("my");if(s&&!s.disabled){if(!s.errors||s.errors.values().join("").length==0&&n)n.data("my").lastCorrect=e.extend(true,{},s.ddata||s.data);u.history(s.ddata||s.data,s.dparams||s.params);var o=n.find(s.selector);var a=u.field(o,null);u.update(t,a,r.recalcDepth||i.recalcDepth);if(s.root.parent().is(".ui-sortable"))s.root.parent().trigger("check");if(i.change)i.change.call(t)}},prepare:function(t,n,r){var i=e.type(t);if(i=="string")n.html(t.assign(r));if(i=="function")t.apply(n,Array.prototype.slice.call(arguments,1));return n}};var a={init:function(t){var n=this.eq(0),r=n.data("my");if(!t)return this;if(Object.isObject(r)&&r.id&&r.ui){u.con("$.my is already bind.",n);n.my("ui",t.ui);n.my("data",t.data);return n}if(t.init!=null)u.prepare(t.init,n,t);var s=e.extend(true,{container:function(e){return u.traverse(e,o.containers)(e)},change:null,recalcDepth:2,delay:0,animate:0,errorMessage:"Incorrect input!",errorTip:".my-error-tip",errorCss:"my-error",effect:function(e,t,n){if(t){e.fadeIn(n);return}e.fadeOut(n)},remember:0,form:n,history:Object.extended(),historyDelay:100},t.params||{});var a=e.extend(true,{},t.ui||{});e.each(a,function(e,t){var n=typeof t;if(n=="string"||n=="function")a[e]={bind:t}});var l=t.id||"my"+Number.random(1e5,1e6-1);var c=t.data||{};n.data("my",{id:l,data:c,params:s,errors:Object.extended(),ui:Object.extended(a),disabled:false});n.addClass("my-form");var h={};for(var p in a){var d=n.find(p);u.initControl(d,n,a[p],p);h[p]=u.field(d,null)}for(var p in a){var d=n.find(p);if(d.size()){var v=a[p];var m=u.bind(c,null,v,d);if(m!=null)u.field(d,m);else{try{if(h[p]!=null)u.bind(c,h[p],v,d)}catch(g){}}d.eq(0).trigger("check.my")}}if(!n.data("my"))return null;n.data("my").initial=e.extend(true,{},c);i[l]=n;if(e.mobile)e.mobile.changePage(e.mobile.activePage);return n},redraw:function(e,t){var n=this,r=n.data("my");r.ui.each(function(t){u.update(n.find(t),e?null:undefined,r.params.recalcDepth)});if(!t)n.trigger("change");return n},data:function(t,n){var r=this;if(e.type(t)=="object"){r.data("my").data=u.overlap(r.data("my").data,t);this.my("redraw",null,n)}return r.data("my").data},errors:function(){var t=e(this).data("my").errors,n={};for(var r in t){if(t[r]&&typeof t[r]=="string")n[r]=t[r]}return n},valid:function(){return!Object.values(e(this).data("my").errors).compact(true).length},reset:function(){try{this.data("my").data=Object.merge(this.data("my").data,this.data("my").initial);this.my("redraw")}catch(e){return false}return true},id:function(e){if(typeof e=="string"){return i[e]||null}else{var t=this.data("my");if(t&&t.id){return t.id}else{return null}}},remove:function(){var e=this;e.data("my").ui.each(function(t){var n=e.find(t);n.unbind(".my").removeData("my")});var t=e.data("my").data;e.removeData("my").removeClass("my-form").unbind(".my");return t},undo:function(e){var t=this,n=t.data("my"),r=n.params.history,i=r.keys().sort(),s=1*(parseInt(e)||0);if(i.length==0||s<0)return null;if(!n.params.errors||n.params.errors.values().compact(true).length==0){if(r[i[i.length-1]].equals(Object.extended(n.data)))s+=1}else{if(!Object.extended(n.data).equals(Object.extended(n.lastCorrect)))s+=1}t.data("my").data=Object.merge(t.data("my").data,u.history(s,n.params,true)||{});t.my("redraw");return t.data("my").data},ui:function(t){var n=e(this),r=n.data("my"),i=[];if(!r)return null;var s=e.extend(true,{},r.ui);if(e.type(t)!="object")return r.ui;for(var o in t)if(true||!s[o])i.push(o);r.ui=u.overlap(r.ui,t);for(var o in i)u.initControl(n.find(i[o]),n,r.ui[i[o]],i[o]);for(var o in t)n.find(o).eq(0).trigger("check");return r.ui},disabled:function(t){var n=e(this),r=n.data("my");if(!r)return undefined;if(t==null)return r.disabled;if(!!t){for(var i in r.ui){var s=n.find(i).eq(0),o=s.data("my");if(o)o.predisabled=o.disabled;u.css(true,s,":disabled")}n.addClass("my-disabled")}else{for(var i in r.ui){var s=n.find(i).eq(0),o=s.data("my"),a=false;if(o&&o.predisabled)a=true;u.css(a,s,":disabled")}n.removeClass("my-disabled");n.my("redraw")}},version:function(){return t},history:function(e,t){return u.history(e,this.data("my").params,t)},val:function(e){return u.field(this,e)},container:function(e){return u.traverse(e,o.containers)(e)}};if(!e.my)e.my={};e.my.f=u;e.my.bolter=o;e.fn.my=function(t){if(a[t])return a[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return a.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.my")}})(jQuery);