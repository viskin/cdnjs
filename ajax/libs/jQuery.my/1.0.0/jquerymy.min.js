/* jQuery.my 1.0.0
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */

;(function(e){function O(e,t){return(t||"").split(".").reduce(function(e,t){if(null!=e&&null!=e[t])return e[t];else return undefined},e)}function M(e,t){var n,r;if(x(t))return t;else if(S(t)){n=O(e,t);if(null==n)n=Object.clone(s._src[t],true);if(null==n){n=O(s,t);if(x(n)&&x(n._self))n=Object.clone(n._self,true);else if(x(n))n=Object.clone(n,true)}if(null==n&&O(e,"params.cache")){r=O(e,"params.cache");if(C(r))n=r(t);else if(x(r))n=A(t,r);if(x(n)){if(x(n._self))n=Object.clone(n._self,true);Object.merge(n,{params:{cache:r}},true)}}if(null!=n&&x(n)){r=r||O(e,"params.cache");if(r)Object.merge(n,{params:{cache:r}},true);return n}else throw"Component "+t+" not found"}else if(C(t)){return t.apply(e,Array.prototype.slice.call(arguments,2))}else return null}function _(e,t){var n,r,o=t||s,u=e,a,f,l,c;if(!(x(o)&&x(u)&&x(u.ui)&&S(u.id)))return"Invalid arguments.";if(!o.hasOwnProperty("_src"))o._src={};f=u.id;try{u=Object.clone(e,true)}catch(h){return"Can't mount circular-referencing obj."}try{if(!u.params||u.params&&!u.params.strict)K(u,true)}catch(h){return"Invalid manifest, parse error."}n=D(u);if(S(n)){H.con(n);return n}Object.merge(u,{params:{strict:true}},true);o._src[f]=u;if(l=H.mask(o,f)){if(l.params&&l.params.protect)return"Can't mount on protected";if(l._self)delete l._self}Object.merge(o,H.unmask(u,f),true);c=O(o,f);if(i)c["_self"]=o._src[f];else Object.defineProperty(c,"_self",{get:function(){return o._src[f]},set:function(){throw"Can not change repo"},enumerable:false,configurable:true});return c}function D(e){var t,n=[],i;if(x(e.files)&&Object.size(e.files)){for(t in e.files){i=e.files[t];if(x(i)&&i.data&&!i.url){if(r){try{H.base642blob(i.data,function(e){i.blob=e;i.url=r.createObjectURL(i.blob)},i.content_type||i.mime);n.push(t)}catch(s){return"Invalid base64 data in files/"+t+"."}}else{i.url="data:"+(i.content_type||i.mime)+";base64,"+i.data;n.push(t)}}}}return n}function B(t,n){function E(t,n){var r;if(S(t)){if(/[\/]/.test(t)){r=o(true,{},g,{ref:n,ajax:{url:t}});if(b.test(n))r.ajax.dataType="json"}else if(t.length){r=o(true,{},g,{ref:n,ajax:t})}}else if(x(t)){r=o(true,{},g,{ref:n,ajax:e.extend(true,{},Object.select(t,["accepts","async","cache","data","dataType","password","timeout","type","url","username"]))});if(!r.ajax.url)r=null}return r}function T(){u.reject(l)}function N(){y+=1;var e=a[y];if(!e){var n=L(f),r=Object.keys(Object.findAll(n,function(e,t){return!t}));if(r.length)l.push((r.length===1?"Key "+r[0]+" is":"Keys "+r.join(", ")+" are")+" not present after all.");if(l.length)T();else u.resolve(t)}else C(e).then(N).fail(T)}function C(n){function h(){a-=1;if(s)u.reject();else if(a<.5)u.resolve()}var r,i,s=false,u=e.Deferred(),a=n.length,f,c;for(i=0;i<a;i++){r=n[i];f=S(r.ajax)?p.loader:e.ajax,c=x(r.ajax)&&/\.js$/i.test(r.ajax.url);f(r.ajax).then(function(e,n){if(b.test(n.ref)){if(e!=null){o(true,t,H.unmask(e,n.ref.from(5)))}else{s=true;l.push("Invalid data for ‘"+n.ref+"’ resource.")}}h()}.fill(undefined,r)).fail(function(e,t){l.push("Failed to load ‘"+t.ref+"’ resource.");s=true;h()}.fill(undefined,r))}return u.promise()}function k(e){var n=false;if(b.test(e)){if(O(t,e.from(5))!=null)n=true}else if(O(window,e)!=null)n=true;return n}function L(e){for(var t in e)if(e[t]===false)e[t]=k(t);return e}var r,i,s,u=e.Deferred(),a=[],f={},l=[],c,h,p=o(true,{ajaxTimeout:1e4,loader:P.params.loader},n||{}),d,v,m,g={ref:null,ajax:{type:"GET",async:true,timeout:p.ajaxTimeout}};if(!x(t))u.reject(["Invalid manifest."]);else if(!w(t.require))u.resolve(t);else{c=t.require;for(r=0;r<c.length;r++){h=c[r];if(S(h))f[h]=k(h);else if(x(h)){m=[];for(i in h){d=null;if(h[i]===true){f[i]=k(i)}else if(S(h[i])||x(h[i])){d=E(h[i],i)}else if(w(h[i])){d=[];for(s=0;s<h[i].length;s++){if(S(h[i][s])||x(h[i][s])){v=E(h[i][s],i);if(v)d.push(v)}}if(!d.length)d=null}if(d&&!(f[i]=k(i)))m.add(d)}if(m.length)a.push(m)}}var y=-1;N()}return u.promise()}function j(e,t){var n=e.data("myval"),r,i;if(!n){i=F(e,P.vals);if(C(i)){r=i(e,a);if(r===undefined){e.data("myval",function(e,t){if(a!=t)i(e,t);return e.val()}.fill(e,undefined))}else e.data("myval",i.fill(e,undefined))}n=e.data("myval")}if(C(n)){r=n();if(r!==t&&(false==t||false==r)||r!=t||x(t))r=n(t);return r}else return a}function F(e,t){function s(e,t,o){for(var f in t)if(f!=""&&e.is(f)){i=i+(i?" ### ":"")+f;var l=t[f],c=u(l);if(!/^(nul|un|ob)/.test(c)&&o>r){n=l;r=o;return}else if(c==p)s(e,l,o+1)}if(a!=t[""]&&typeof t[""]!=p&&o>r){n=t[""];r=o}}var n=a,r=0,i="";s(e,t,1);return n}function I(e,t,n,r){var i,s=[],o,f,l,c=n.bind,h=u(c);if(h==g){return c.call(R(r).manifest,e,t,r)}if(h===m||h===v){if(h===m&&!/\./.test(c)){if(t!=a)e[c]=t;else if(e[c]===undefined)e[c]=a;return e[c]}if(h===m)s=c.split(".").each(function(e,t){this[t]=e+""});if(h===v)s=c.slice(0).each(function(e,t){this[t]=e+""});if(s[0]==="this"){o=R(r).manifest;s.shift()}else o=e;for(i=0;i<s.length;i++){if(i===s.length-1){if(t!=a)o[s[i]]=t;else if(o[s[i]]===undefined)o[s[i]]=a;return o[s[i]]}if(i==0){f=o;o=o[s[0]]}else{f=f[s[i-1]];o=o[s[i]]}if(o===undefined)o=f[s[i]]={}}}return a}function q(t,n,r,i){var s=r.check,o,f;if(s!=a){var l=R(i).params.messages,c=r.error,h=c||l.patternMismatch||l[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var p=i[0].validationMessage+"";if(p!=="")return p.substr(0,1).toUpperCase()+p.substr(1);else{f=i[0].validity;for(o in f){if(p===""&&o!="valid"&&E(f[o])&&f[o]&&l[o])p=l[o]}return p||c}}switch(u(s).to(1)){case"f":{v=s.call(R(i).manifest,t,n,i);return v===null||v===undefined?"":v};case"r":return s.test(String(n))?"":h;case"a":return s.indexOf(n)>-1?"":h;case"s":return n==s?"":h;case"o":return s[n]?"":h;case"b":{if(i.is(".my-form-list,.ui-sortable")){var d=i.data("listSrc")||i.data("my").listSrc||">*",v={};i.find(d).filter("*:not(.ui-sortable-placeholder)").each(function(t){var n=e(this);if(n.data("my")&&!n.my("valid"))v[t]=n.my("errors")});return v}else if(i.hasClass("my-form")){return!s?"":i.my("valid")?"":i.my("errors")}return""}}return l.formError||"Error"}return""}function R(e){var t=e.my();if(!t)return null;return t.root?t.root.my():t}function U(t,n,r){var i=r.compact(),s=i.replace(/:disabled/g,"");n.each(function(){var r=e(this),o=r.my(),u=o?o.container:r;if(t){if(!u.is(s))u.addClass(s)}else u.removeClass(s);if(s!=i&&o!==undefined&&!!t!=!!o.disabled){r.my().disabled=!!t;if(!o._disable)r.my()._disable=F(n,P.offon).fill(undefined,n);o._disable(!!t)}});return n}function z(e,t,n){var r,i,s,u,f,c,h,p,d,v,m,g=false,y=false,b=e,w=b.my(),E="";if(w){p=w.selector;d=w.root;if(d.hasClass("my-form-init"))return{};v=d.find(p);m=d.my().ui;g=e.hasClass("my-form");y=e.hasClass("my-form-list");if(g){r=e;i=w.ddata;s=w.dui;u=w.dparams}else{r=w.container;i=w.data;s=w.ui;u=w.params}if(s.bind!=a){if(l(t))f=t;else f=j(v,I(i,a,s,v));if(a!=s.check){E="Unknown error";try{E=q(i,f,s,v)}catch(x){H.con("Error "+x.message+" validating "+p,d,x.stack)}}var T=u.errorCss;var k="ui-state-error";try{if(a!=t)f=j(v,I(i,t,s,v))}catch(x){E=u.messages.formError||"Error"}if(E===""){if(!g)w.errors[p]="";else w.derrors[p]="";r.removeClass(T);if(r.attr("title"))r.attr("title","");if(!g&&!y)u.effect(r.find(u.errorTip),false,u.animate/2);b.removeClass(k);b.find(".ui-widget").removeClass(k)}else{if(g)w.derrors[p]=E;else if(y)w.errors[p]=E;else{r.addClass(T);w.errors[p]=E;var L=r.find(u.errorTip).eq(0);if(L.size()){u.effect(L.addClass(T).html(E),true,u.animate)}else r.attr("title",(E||"").stripTags())}if(b.is(".hasDatepicker")){if(b.is("input"))b.addClass(k);else b.find(".ui-widget").addClass(k)}if(b.is(".ui-slider"))b.addClass(k)}}var A=t==a?f:t;if(s.css){for(c in s.css){h=s.css[c];if(N(h))U(h.test(A),v,c);else if(C(h))U(h.call(d.my().manifest,i,A,v),v,c)}}var O,M=s.recalc,_=[],D={},P;if(n&&s.recalc&&d.my()){m=d.my().ui;for(O=0;O<M.length;O++){if(M[O]&&S(M[O])&&(P=M[O].compact())&&m[P]){if(m[P].recalc){if(_.indexOf(P)===-1)_.push(P)}else D[P]=true}}for(O=0;O<_.length;O++)D=o(true,D,z(d.find(_[O]),a,n-1));if(t!==a){for(O in D)if(D[O]===true&&O!=p){if(m[O].delay&&!m[O].recalc)m[O]._update(d.find(O),a,n-1);else z(d.find(O),a,n-1)}return{}}}return D||{}}}function W(e,t,n,r){var i=t,s,o,u,f,l,c,h,p,d;if(!x(i)||isNaN(f=i.remember)||!x(s=i.history))return a;if(x(e)&&f){c=Object.clone(e,true);h=Date.now();u=Object.keys(s).sort();if(u.length&&(h-u.last()<i.historyDelay||Object.equal(s[u.last()],c)))return a;i.history[h]=c;u.push(h);if(u.length>=f*2){d={};for(o=f;o<f*2;o++)d[u[o]]=s[u[o]];t.history=d}if(!r)i.form.trigger(y);return i.history[u.last()]}else if(!isNaN(e)||e===a){l=parseInt(e)||0;if(l<0)return a;u=Object.keys(s).sort();if(l>=u.length)l=u.length-1;p=Object.clone(i.history[u[u.length-l-1]],true);if(n){d={};for(o=0;o<u.length-l-1;o++)d[u[o]]=s[u[o]];t.history=d}if(!r)i.form.trigger(y);return p}else if(!r)i.form.trigger(y);return a}function X(t,n,r,i){function E(){var n=null,r=l.manifest;if(C(r)||x(r)&&x(r.ui))v=r;else if(S(r)){v=M(m,r.replace(b,""))}if(v&&S(l.bind)){var o=O(s.data,l.bind);if(c===null)c=e.Deferred();if(w(o)||l.list){t.addClass("my-form-list");var u="",a=">*";if(/^<.+>$/.test(l.list))u=l.list;else a=l.list||a;if(!u){var h=t.find(a);u="<div></div>";if(h.size()){u=e(u).append(h.eq(0).clone(true)).html();h.eq(0).remove()}}if(!t.data("formlist"))t.data("formlist",{});t.data("formlist").generator={manifest:v,delay:(l.delay||f.delay||10)/1.3,template:u,selector:a,parent:m,bind:l.bind,hash:C(l.hash)?l.hash.bind(m):L(l.hash),id:C(l.id)?l.id.bind(m):L(l.id),ext:!!(l.id||l.hash),stamp:0};t.on("insert.my",function(t,n){t.stopPropagation();var r={what:undefined,where:0};if(null==n)r.where=1e6;else if(x(n))Object.merge(r,n);else if(S(n)||T(n))r.where=n;e(t.target).my("insert",r.where,r.what)});t.on("remove.my",function(t){t.stopPropagation();e(t.target).my("remove")})}else{try{n=t.my(M(m,v),x(o)?o:undefined)}catch(p){N("$.my subform init of "+i+" failed: "+p.message,p.stack)}}}if(k(n)){n.then(A,function(e,t){N("Init of subform "+i+" failed with error: "+e,t)})}else A()}function N(e,t){H.con(e,t);if(c)c.reject(e,t)}function L(e){var t=u(e).to(3);return!e?null:t==="str"?O.fill(undefined,e):t==="arr"?H.mask.fill(undefined,e):null}function A(){t.each(function(){var u=e(this),c,h,d=false,v=u[0].nextSibling;h=v&&v.CodeMirror?v.CodeMirror:null;if(h)u.addClass("my-codemirror");c=l.events||F(u,P.events);if(!u.is(".my-form")){u.data("my",{events:c,selector:i,initial:p,previous:p,root:n,container:f.container(u),id:s.id,ui:l,data:s.data,params:f,errors:s.errors});r._update=l.delay?z.debounce(l.delay):a;d=true}else{o(u.data("my"),{dui:l,root:n,selector:i,dparams:f,devents:c,ddata:s.data,container:f.container(u),derrors:s.errors})}if(d){if(u.cleditor&&u.parent().is(".cleditorMain")){var m=u.cleditor()[0];if(m&&m.$frame&&m.$frame[0]){u.addClass("my-cleditor");o(u.data("my"),{container:f.container(u)});var b=function(e){u.val(e).trigger(y)};var w,E=Number.random(1e5,1e6-1);e(m.$frame[0]).attr("id","cleditCool"+E);if(!document.frames)w=e("#cleditCool"+E)[0].contentWindow.document;else w=document.frames["cleditCool"+E].document;var S=e(w).find("body");e(w).bind("keyup.my",function(){b(e(this).find("body").html())});u.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){b(S.html())});e("body").on("click","div.cleditorPopup",function(){b(S.html())})}}else if(u.is("div.redactor_box textarea")){var x,T="my-redactor-9";try{x=u.getEditor();T="my-redactor-8"}catch(N){x=u.redactor("getEditor")}if(x){u.addClass(T);x.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(u))}}else if(u.is(".ace_editor"))ace.edit(t[0]).on(y,function(e){e.trigger("ace")}.fill(u));else if(h){h.on(y,function(e){e.trigger("codemirror")}.fill(u))}}u.my()._changed=V.debounce(g);u.my()._recalc=$;u.bind(c,function(e){if(e.type==y)e.stopPropagation();if(d)s.locktill=Date.now()+r.delay;u.my()._changed(u,n,r,f)});if(!/check(\.my)?/.test(c+""))u.on("check.my",function(e){u.my()._changed(u,n,r,f,true);return false});u.on("recalc.my, redraw.my",function(e){e.stopPropagation();u.my()._recalc(u,n,r,f)})});if(c)c.resolve()}var s=n.my(),f=(s||{}).params,l=r,c=null,h,p,d=0,v,m=s.manifest,g;if(!s){H.con("Failed to find $root building "+i+" selector.");return null}g=r.delay;if(t.size()){if(l.init!=a)h=J(m,l.init,t,s);if(k(h)){d+=1;c=e.Deferred();h.then(E,function(e,t){N("Init of "+i+" failed: "+e,t)})}else E()}else H.con("Not found "+i+" selector.",n);return c}function V(e,t,n,r,i){var s=e.data("my"),o=t.data("my");if(s&&!s.disabled){W(s.ddata||s.data,s.dparams||s.params);var u=t.find(s.selector);z(e,!i?j(u,a):a,n.recalcDepth||r.recalcDepth);if(undefined===o.orphan){if(s.root.parent().hasClass("ui-sortable")){o.orphan=!s.root.parent().hasClass("my-form-list")}}if(o.orphan)s.root.parent().trigger("check");if(r.change)r.change.call(e)}}function $(e,t,n,r){var i=e.my();if(i&&!i.disabled){var s=t.find(i.selector);if(s.is(".my-form"))s.my("redraw");else z(e,s.is(".my-form-list")?O(s.my().data,s.data("formlist").generator.bind):a,n.recalcDepth||r.recalcDepth)}}function J(e,t,n,r){var i;if(S(t)){i=O(e,t);if(undefined===i){n.html(t.assign(r.data));return null}}else i=t;if(C(i))return i.apply(e,Array.prototype.slice.call(arguments,2));else if(w(i)){try{n.formgen(i)}catch(s){}}return null}function K(e,t){var n="",r,i="",s=!t,o=[];for(n in e)if(e.hasOwnProperty(n)&&(s||!/^(data|files|require)$/.test(n))){r=e[n];i=u(r);if(/^(ob|ar)/.test(i))K(r);else if(i==="string"&&/^(function\s\(|new\sRegExp)/.test(r)){if(o=r.match(/^function\s\(([^\)]*)\)\s*\{([\s\S]*)\}$/)){if(o.length===3){try{e[n]=Function(o[1],o[2])}catch(a){console.log(a.message,a.stack,r)}}}else if(o=r.match(/^new\sRegExp\(\/([\s\S]+)\/([a-z]*)\)$/)){if(o.length===3){try{e[n]=RegExp(o[1],o[2])}catch(a){console.log(a.message,a.stack,r)}}}}}o=null}function Q(e,t,n){var r=x(t)?t:null;Object.each(e,function(t,n){var r=typeof n;if(/^str|^fu/.test(r))e[t]={bind:n}});Object.each(e,function(t,i){var s=[],o=[],u,a=/\s?[,;]\s?/,f,l;if(i.recalc){if(S(i.recalc))s=i.recalc.split(a);else if(w(i.recalc))s=i.recalc;s=s.compact(true).unique()}if(s.length)e[t].recalc=s;if(null==i.bind)i.bind=function(){};if(i.watch){if(S(i.watch))o=i.watch.split(a);else if(w(i.watch))o=i.watch.slice(0);o=o.compact(true).unique();for(l=0;l<o.length;l++)if(u=e[o[l]]){f=u.recalc;if(!f)u.recalc=[t];else if(S(f))u.recalc+=","+t;else if(w(f)&&f.indexOf(t)==-1)u.recalc.push(t)}}if(null!==r)["css","check","manifest","list","hash","id"].each(function(e){if(S(i[e])){var t=O(r,i[e].replace(b,""));if(t!=null)i[e]=t}});i.delay=!isNaN(i.delay)?i.delay-0:n.delay});return e}function G(e,t){function s(n,r,i,u){var a,f,l,c,h=n;if(S(h)){if(/[\r\n]/.test(h)||h.split("}",3).length>2){h=H.css2json(h)}else i.push(r+(/\{/.test(h)?h:"{"+h+"}"))}if(w(h)&&h.length){for(a=0;a<h.length;a++)s(h[a],r,i,u)}else if(x(h)){for(a in h){c=o(r,a);for(f=0;f<c.length;f++)s(h[a],c[f],i,u)}}else if(C(h)){try{l=h.call(t,e,t);s(l,r,u,u)}catch(p){}}}function o(e,t){var n="",r=t+"",i;if(" "===r.to(1)||/^[a-z]/i.test(r))n=" ";i=r.split(/\s*,\s*/).compact(true);if(!i.length)i.push("");return i.map(function(t){return e+n+t})}var n=[],r=[],i=t;if(!x(i)||!x(i.style))return"";s(t.style,"",n,r);return[n,r]}function Z(){return{con:function(){try{console.log(arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();if(t&&t.data)return t.data;return e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,n){return e[t](n?"disable":"enable")},overlap:function(e,t){function r(e,t,n){if(n===undefined||n===null)return t;if(!x(n))return n;else return Object.merge(t,n,false)}if(!arguments.length)return{};if(arguments.length===1)return arguments[0];for(var n=1;n<arguments.length;n++)Object.merge(arguments[0],arguments[n],false,r);return arguments[0]},patch:function t(e,n){for(var r in n){if(n.hasOwnProperty(r)){if(x(n[r])){if(!e.hasOwnProperty(r))e[r]=Object.clone(n[r],true);else t(e[r],n[r])}else if(!e.hasOwnProperty(r)){if(w(n[r]))e[r]=n[r].clone(true);else e[r]=n[r]}}}return e},kickoff:function(e,t){var n=t&&typeof t=="object"?Object.clone(t,true):{},r;for(r in e)if(e.hasOwnProperty(r)){delete e[r];if(n[r]!==undefined)e[r]=n[r]}},sdbmCode:function(e){for(var t=JSON.stringify(e),n=0,r=0;r<t.length;r++)n=t.charCodeAt(r)+(n<<6)+(n<<16)-n;return(1e11+n).toString(36)},tojson:function(){function e(e){return e<10?"0"+e:e}function r(e,i,s){var o=0,u,a,f,l,c=i||0,h=t;if(s&&S(s)){o=String(s).length;h=String(s).repeat(10)}switch((typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e)+"":"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\(.*)/,"$1 $3").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===g)return r(e.toJSON(),c+(s?1:0),s);u=[];if(w(e)){for(a=0;a<e.length;a+=1){u.push(r(e[a],c+(s?1:0),s)||"null")}return"["+u.join(","+(s?"\n"+h.to(c*o+o):""))+"]"}for(f in e)if(S(f)){l=r(e[f],c+(s?1:0),s);if(l)u.push((s?"\n"+h.to(c*o+o):"")+r(f,c+(s?1:0),s)+": "+l)}return"{"+u.join(",")+(s?"\n"+h.to(c*o):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"};RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var t="	".repeat(10),n=JSON.stringify;return r.fill(undefined,0,undefined)}(),fromjson:function(e){var t=JSON.parse(e);K(t);return t},mask:function(e,t){function s(e,t){if(!x(t))return{};var n={};for(var r in t){if(!x(t[r])&&e.hasOwnProperty(r)){n[r]=Object.clone(e[r],true)}else if(e.hasOwnProperty(r)){if(x(e[r]))n[r]=s(e[r],t[r]);else n[r]=Object.clone(e[r],true)}}return n}if(!x(e))return null;var n,r=t;if(S(r)){return O(e,r)}else if(w(r)){n=[];for(var i=0;i<r.length;i++){n[i]=S(r[i])?O(e,r[i])||null:null}return n}else if(x(r))return s(e,r)},unmask:function(e,t){function i(e,t,n){var r,i,s,o=Object.clone(t,true),u=0;if(!/\./.test(n)){if(null!=t)e[n]=o}else{i=n.split(".").each(function(e,t){this[t]=String(e).compact()});r=e;for(;u<i.length;u++){if(u===i.length-1)r[i[u]]=o;if(u===0)r=e[i[0]],s=e;else s=s[i[u-1]],r=r[i[u]];if(undefined===r)r=s[i[u]]={}}}return e}var n={};if(x(e)&&x(t))return H.mask(e,t);else if(w(e)&&w(t)){for(var r=0;r<t.length;r++){if(e[r]!=null)i(n,e[r],t[r])}return n}else if(S(t))return i({},e,t);else return null},getref:O,require:B,repo:function(){return s},unjson:function(e){K(e);return e},blob2base64:function(e,t,n){var r=new FileReader;r.onload=function(){t(n?r.result:r.result.split(",")[1])};r.readAsDataURL(e)},base642blob:function(e,t,n){var r=atob(e),i=r.length,s=new ArrayBuffer(i),o=new Uint8Array(s);for(var u=0;u<i;u++)o[u]=r.charCodeAt(u);t(new Blob([o],{type:n||"application/octet-stream"}))},base64:function(t,n,r){var i=u(t),s=null,o=S(t)?t:e.my.tojson(t),a=S(r)?"data:"+r+";base64,":"";if(n){try{s=decodeURIComponent(escape(window.atob(o)))}catch(f){s=null}if(null!==s&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(s)){try{s=e.my.fromjson(s)}catch(f){s=null}}return s}return a+window.btoa((r===true?"ï»¿":"")+unescape(encodeURIComponent(o)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(true).reduce(function(e,t){var n=t.trim(),r,i,s;if(/^[^{]+\{[^\}]+\}$/.test(n)){r=n.to(-1).split("{");i=" "+r[0].trim();s=r[1].trim();if(s.last()!=";")s+=";";if(!e[i])e[i]="";e[i]+=s}return e},{});return t}}}var t="jQuery.my 1.0.0";var n="en",r=window.URL||window.webkitURL,i=!document.addEventListener,s=O(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Global manifest cache"},o=e.extend,u=e.type,a=null,f,l=function(e){return e!==null&&e!==undefined},c="{yyyy}-{MM}-{dd}",h="{HH}:{mm}",p="object",d="data",v="array",m="string",g="function",y="change",b=/^this\./,w=Object.isArray,E=Object.isBoolean,S=Object.isString,x=Object.isObject,T=Object.isNumber,N=Object.isRegExp,C=Object.isFunction,k=function(e){return!!(null!=e&&(x(e)||e.jquery)&&C(e.then)&&C(e.fail)&&C(e.state))},L=function(e){return k(e)?e.state()==="rejected":null};var A=function(t,n){var r,i;if(S(t)){r=t;i=O(x(n)?n:s,r);if("exist"===n)return x(i);return!i?null:Object.clone(i,true)}else if(x(t)){i=_(t,n);if(!x(i)){console.log(i);return null}return i}else if(undefined===t){return s._src}else if(null===t){return Object.reject(s,/^_/)}else return null};var P={vals:{".my-form":function(e,t){if(e&&e.my){var n=e.my(d);return Object.equal(n,t)?n:e.my(d,t,true)}else return t||a},".hasDatepicker":function(e,t){if(l(t))e.datepicker("setDate",t==""?t:Date.create(t));var n=e.datepicker("getDate");return n?n.format(c):""},".my-tags":function(e,t){if(l(t)){if(S(t)||T(t))e.tags(d,[t+""]);else if(w(t))e.tags(d,t)}return e.tags(d)},".ui-draggable":function(e,t){if(l(t)&&x(t)){var n={};if(!isNaN(t.left))n.left=Number(t.left).ceil(2)+"px";if(!isNaN(t.top))n.top=Number(t.top).ceil(2)+"px";if(n.left||n.top)e.css(n)}var r=e.position();return{left:t&&!isNaN(t.left)?(t.left*1).ceil(2):r.left.ceil(2),top:t&&!isNaN(t.top)?(t.top*1).ceil(2):r.top.ceil(2)}},".my-form-list":function(t,n){function P(){var n=e(this),r,i,s=n.data("my");if(s){r=n.data("formlist");i=r.index;r.hash=m(s.data,i)+"";if(g!==m)r.oid=g(s.data,i)+"";else r.oid=r.hash}t.trigger("check.my")}function B(e){if(e.data("my").locktill+b/1.3<k)e.my("redraw")}var r,i,s,o,u=0,a="ui-sortable",f="."+a+"-placeholder",c=t.data("formlist")||{},h=c.generator||{},p=h.selector||">.my-form",d=h.template||"<div></div>",v=/\{/.test(d),m=h.hash||H.sdbmCode,g=h.id||H.sdbmCode,y=h.ext,b=h.delay||50,E=t.is("."+a),S=!!t.children(f).size(),x=[],T=[],N,C,k=Date.now();var L=E?t.find(t.sortable("option","items")):t.find(p);if(l(n)&&w(n)){if(S)return n;i=[];L.each(function(){var t=e(this),n=t.data("my");if(n)i.push(n.data)});o=false;if(i.length===n.length)for(o=true,r=0;r<i.length;r++)if(i[r]!==n[r])o=false;if(!o||y){s=e.extend(true,[],i,n);if(!Object.equal(i,s)||s.length!=n.length){var A=[],O=[],_={},D={};T=[];for(r=0;r<n.length;r++){O[r]=g(n[r],r)+"";_[O[r]]=r;A[r]=(g!==m?m(n[r],r):O[r])+""}L.each(function(){var t=e(this),n=t.data("formlist")||{},r=n.oid;if(r&&_.hasOwnProperty(r))D[r]=e(this);else{if(t.is(".my-form"))t.my("remove",true);else t.remove()}});for(r=0;r<n.length;r++){if(D[O[r]]){N=D[O[r]].detach().appendTo(t);x.push(N.my("data"));if(A[r]!==(N.data("formlist")||{}).hash)T.push(N)}else{N=e(v?d.assign(n[r]):d).appendTo(t);N.data("formlist",{list:n[r],index:r,hash:A[r],oid:O[r]});N.my(M(h.parent,h.manifest,n[r],r,n,t),n[r]).then(function(e){e.on("change.my",P.debounce(b/1.3))}.fill(N));x.push(N.my("data"))}}if(T.length&&y){for(r=0;r<T.length;r++)B(T[r]);T=[]}return x}}return i}else if(L.size()){if(k-h.stamp>1.4*b||k-h.stamp>100||!h.stashed||h.stashed.length!==L.size()-(S?1:0)){if(S)C=t.find(">."+a+"-helper");L.each(function(t){var n=e(this),r,i,s,o=false;if(!S||!n.hasClass(a+"-helper")){if(S&&n.hasClass(a+"-placeholder"))n=C;r=n.data("my");i=n.data("formlist");if(r&&i){x.push(r.data);if(u!=i.index){i.index=u;o=!0}if(y){s=m(r.data,u)+"";if(s!==i.hash){i.hash=s;o=!0}}u+=1;if(o)T.push(n)}}});for(r=0;r<T.length;r++)B(T[r]);T=[];h.stamp=k;h.stashed=x}else x=h.stashed.slice(0);return x}return n||[]},".ui-sortable":function(t,n){var r=[],i="ui-sortable",s=">."+i+"-placeholder",o=t.find(t.sortable("option","items")),u;if(l(n)&&w(n)){var f={},c={},h=n.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(s).size())return h;o.each(function(){f[H.sdbmCode(H.extval(e(this)))]=e(this)});for(var p=h.length-1;p>=0;p--){var d=H.sdbmCode(h[p]);if(f[d]){f[d].prependTo(t).show();c[d]=true;if(r.indexOf(h[p])==-1)r.push(h[p])}}r=r.reverse();for(p in f)if(!c[p])f[p].hide()}else{var v=t.find(s),m=t.eq(0);if(v.size()!=0){if(m.my()[i]!=v.position().left+""+v.position().top){o=o.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)");u=t.find(t.sortable("option","items")).filter(".ui-sortable-helper");o.each(function(){var t=e(this);if(t.is(".ui-sortable-placeholder")){r.push(H.extval(u))}else r.push(H.extval(t))});m.my()[i]=v.position().left+""+v.position().top;m.my()[i+"1"]=r}else r=m.my()[i+"1"];if(r==a)o.each(function(){r.push(H.extval(e(this)))})}else{o=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)");o.each(function(){r.push(H.extval(e(this)))})}}return r},"input[type=date]":function(e,t){if(l(t)){if(t!="")n=Date.create(t).format(c);else n="";if(S(n)&&!/Invalid/.test(n))e.val(n);return n}var n=e.val();return n!=""?Date.create(n).format(c):""},"input[type=time]":function(e,t){if(l(t)){if(t!="")n=Date.create(t).format(h);else n="";if(S(n)&&!/Invalid/.test(n))e.val(n);return n}var n=e.val();return n!=""?Date.create(n).format(h):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){if(l(t))e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){if(l(t))e.val(t).trigger("update")},"div.select2-container+input":function(e,t){if(l(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val")))e.select2("val",w(t)?t:[t]);return e.select2("val")},"":function(e,t){if(l(t))e.val(t+"")}},":radio":function(t,n){var r=-1;if(l(n)){t.each(function(t){var i=e(this).val();if(n+""===i+"")r=t});var i=t.eq(0).checkboxradio;if(i)t.each(function(t){var n=e(this);if(r!=t&&n.is(":checked"))n.prop("checked",false).checkboxradio("refresh")});if(r>-1){var s=t.eq(r);if(!s.is(":checked")){s.prop("checked",true);if(i)s.checkboxradio("refresh")}}else if(!i)t.each(function(){e(this).prop("checked",false)})}if(r==-1)for(var o=0;o<t.size();o++){if(t.eq(o).is(":checked"))r=o}return r!=-1?t.eq(r).val():""},":checkbox":function(t,n){var r=-1,i=n,s=[];if(l(i)){if(!w(i))i=[n];var o=!!t.eq(0).checkboxradio;t.each(function(t){var n=e(this),r=n.val(),u=n.is(":checked");if(i.indexOf(r)!=-1){s.push(r);if(!u)n.prop("checked",true)}else if(u)n.prop("checked",false);if(o)n.checkboxradio("refresh")})}else{t.each(function(){var t=e(this);if(t.is(":checked"))s.push(t.val())})}return s}},select:{".ui-slider-switch":function(e,t){if(l(t)){e.val(t+"");e.slider("refresh")}},"div.select2-container+select":{"[multiple]":function(e,t){if(l(t))e.select2("val",w(t)?t:[t]);return e.select2("val")},"":function(e,t){if(l(t))e.select2("val",t+"");return e.select2("val")}},"[multiple]":function(e,t){if(l(t)){e.val(t,[]);if(e.selectmenu)e.selectmenu("refresh",true)}},"":function(t,n){if(l(n)){t.val(n+"");if(t.selectmenu){if(t.selectmenu("option").theme!==undefined)t.selectmenu("refresh",true);else t.find("option").each(function(r){var i=e(this);if(H.extval(i)==n)t.selectmenu("value",r)})}}}},textarea:{".my-cleditor":function(e,t){if(l(t))e.val(t).cleditor()[0].updateFrame();return e.val()},"div.redactor_box textarea,.redactor":function(e,t){var n=e.hasClass("my-redactor-9");if(l(t)){if(n)e.redactor("set",t);else e.setCode(t,false);return t}return n?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){if(l(t)){e[0].nextSibling.CodeMirror.setValue(t);return t}return e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){if(l(t))e.val(t+"")}},"fieldset,form,section,aside,.my-container":function(e,t){var n=Array.prototype.slice.call(e[0],0).sort(),r=t;if(l(t)){if(S(t))r=t.split(/[,\s]+/).compact(true);if(w(r)){r.sort();if(r.join(" ")!==n.join(" ")){e.atrr("css",r.join(" "));n=r}}}return n},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){if(l(t))e.slider("option",e.slider("option","values")?"values":"value",H.clone(t));return H.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,n){if(!l(n)){var r=t.find(":radio:checked");if(r.size()&&r.button)return r.val()||r.button("option","label")}else if(n!=""){var i=a;t.find(":radio").each(function(){i=(e(this).val()||e(this).button("option","label"))==n?e(this):i});if(i){i.attr("checked",true);t.buttonset("refresh");return n}}t.find(":radio:checked").attr("checked",false);t.buttonset("refresh");return""},".ace_editor":function(e,t){if(l(t))ace.edit(e[0]).setValue(t);return ace.edit(e[0]).getValue(t)},"":function(e,t){if(l(t))e.html(t);return e.html()}},"pre,code":function(e,t){if(l(t))e.html(t);return e.html()},img:function(e,t){if(l(t))e.attr("src",t);return e.attr("src")||""},"":function(e,t){if(l(t))e.html(t);return e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:f="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:f},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+(navigator.appName.to(5)==="Micro"?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var n=t[0].parentNode,r=n.nodeName;if(/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(r))return e(n);else return t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){H.jquix(t,"selectable",e)},".ui-slider":function(e,t){H.jquix(t,"slider",e)},".ui-draggable":function(e,t){H.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){H.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){H.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){H.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")});t.removeClass("my-form-list");t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor();e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea();e.removeClass("my-codemirror")}}}};P.params={container:function(e){return F(e,P.containers)(e)},change:a,recalcDepth:2,delay:0,strict:false,locale:f=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(P.msg,function(e,t){return t[f]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,n){if(t)return e.fadeIn(n);e.fadeOut(n)},remember:0,silent:false,history:{},historyDelay:100,loader:function(t,n){var r=e.Deferred(),i=A(t+"");if(i)r.resolve(i);else r.reject(null);return r.promise()},ajaxTimeout:1e4};var H=Z();H.require=B;var Y={init:function(t,n,i){function $(){if(!g.strict)K(y,true);h=o(true,h,Object.reject(y,["data"]));m=Q(o(true,{},y.ui||{}),h,g);l=Number.random(268435456,4294967295).toString(16);f=y.id||"my"+l;c=H.sdbmCode(f);h.id=f;g.form=W;if(y.params&&y.params.depth)g.recalcDepth=y.params.depth;for(b in h)if(C(h[b]))h[b].bind(h);if(y.error){if(S(y.error)){q=function(e,t){return y.error.assign(o({message:e+"",err:t+""},y))}}else if(C(y.error)){q=function(e,t){p=null;try{p=y.error(e,t)}catch(n){p=g.messages.initFailed}return p}}}o(W.data("my"),{id:f,cid:l,mid:c,errors:Object.extended(),ui:Object.extended(m),disabled:false,manifest:h,locFiles:[]});W.addClass("my-form");T="my-manifest-"+c;N="my-form-"+l;W.addClass(N+" "+T)}function Y(){if(h.style){E=G(W,h,T,N);if(E&&E[0].length){L=e("style#"+T);if(!L.size()){L=e('<style id="'+T+'" data-count="0">'+"."+T+E[0].join(" \n."+T)+"\n"+"</style>").appendTo(e("body"))}L.data("count",L.data("count")*1+1);W.data("my").style=L}if(E&&E[1].length){O=e("style#"+N);if(!O.size()){O=e('<style id="'+N+'" data-count="0">'+"."+N+E[1].join(" \n."+N)+"\n"+"</style>").appendTo(e("body"))}W.data("my").localStyle=O}}}function Z(){var t,n=e.Deferred(),i;i=D(h);if(S(i)){rt("Error decoding base64 to local Blob/URL",i);n.reject()}else{if(r)for(t=0;t<i.length;t++)w.push(h.files[i[t]].url);if(w.length)W.data("my").locFiles=w;n.resolve()}return n.promise()}function et(){if(y.init!=a){z=W.find(">*").clone();try{F=J(h,y.init,W,y)}catch(t){rt(S(t)?t:t.message,t.stack);return W}}if(k(F)){F.then(function(){tt()},function(e,t){rt(e,t)})}else tt();if(!_){if(!W.my())return rt("Internal error initializing controls",""),W;W.data("my").initial=o(true,{},v);if(e.mobile)e.mobile.changePage(e.mobile.activePage)}}function tt(){function n(n){if(!_){e[n]=j(W.find(n),a);t-=1;if(t<.5)nt(e)}}var e={},t=Object.size(m);W.addClass(R);Object.each(m,function(e){if(_)return;var t=W.find(e),r=X(t,W,m[e],e);if(k(r)){r.then(n.fill(e)).fail(function(t,n){rt("Error building "+e+", "+t,n)})}else if(!_)n(e)})}function nt(e){var t,n,r;for(var i in m){if(_)return;t=m[i];r=W.find(i);if(r.size()){try{n=I(v,a,t,r);if(n==a&&e[i]!=a&&n!==undefined)I(v,e[i],t,r)}catch(s){H.con("Transient fail linking "+i+" of form $('.my-form-"+l+"')",s.message,s.stack)}try{if(n!=a)j(r,n);r.eq(0).trigger("check.my")}catch(s){rt("Error linking "+i,s.message,s.stack)}}}W.removeClass(R);z=null;M.resolve(v)}function rt(e,t){var n;_=true;H.con("Form "+f+" failed to initialize: "+e,t);W.removeClass(R);n=q(e,t);if(S(n)||x(n)&&n.jquery)W.html(n);else if(n===true)W.html(z);if(!g.silent){if(!W.my().ddata){W.removeData("my");W.removeClass("my-form");if(L){if(L.data("count")=="1"){try{L.remove()}catch(r){}}else L.data("count",L.data("count")-1)}if(O){try{O.remove()}catch(r){}}}M.reject("Form "+f+" failed to initialize: "+e,t)}else M.resolve(v)}var s,u,f,l,c,h={},p,v={},m,g,y,b,w=[],E,T,N,L,O,M=e.Deferred(),_=false,F,q=function(){},R="my-form-init",U="std",z="";if(S(t)){s=A(t);if(s){if(x(i)&&x(n)){s=o(s,n);u=i}else u=n;U="repo"}else{M.reject("No manifest with id "+t+" found in repo.");return M.promise()}}else{s=t;u=n}if(!s)return this;if(x(u)&&U!="repo")y=o(true,{},s);else y=s;var W=this.eq(0),V=W.my();if(x(V)&&V.id&&V.ui){H.con("jQuery.my is already bind.",W);W.my("ui",y.ui);W.my(d,y.data);return M.resolve(W.my(d)).promise()}g=y.params||{};if(!g.strict){g=o(true,{},g);K(g)}g=o(true,{},P.params,g);M.fail(function(){W.removeClass(N+" "+T)});e.extend(W,M.promise());if(x(u)){v=H.patch(u,y.data||{});y.data=v}else v=y.data||{};h.data=v;W.data("my",{data:v,params:g,promise:M.promise(),locktill:0});W.addClass(R);B(y,g).then(function(){$();Z().then(function(){Y();et()})}).fail(function(e){$();rt("Linker of ‘require’ property failed.",e)});return W},redraw:function(e,t){var n=this,r=n.my();if(r&&r.ui){r.ui.each(function(t){var i=n.find(t);z(i,e?a:undefined,r.params.recalcDepth);if(!e){if(i.is(".my-form"))i.my("redraw");if(i.is(".my-form-list"))i.trigger("redraw");else i.trigger("check.my")}});if(!t&&e)n.trigger(y)}return n},data:function(e,t){var n=this;if(x(e)){n.my().data=H.overlap(n.my().data,e);this.my("redraw",t)}return n.my().data},errors:function(){var t=e(this).my().errors,n={};for(var r in t){if(t[r]&&S(t[r]))n[r]=t[r];if(x(t[r])&&Object.keys(t[r]).length)n[r]=t[r]}return n},valid:function(){var t=e(this).my().errors,n=0;for(var r in t){if(t[r]&&S(t[r]))n++;else if(x(t[r])&&Object.keys(t[r]).length)n++}return!n},reset:function(){try{H.kickoff(this.my().data,this.my().initial);this.my("redraw")}catch(e){return false}return true},id:function(e,t){if(S(e))return A(e,t);else{var n=this.my();return n&&n.id?n.id:a}},remove:function(e){var t=this,n,r,i,s,o,u,f,l;if(!this.my())return a;if(this.my().root&&!this.my().ddata)t=this.my().root;i=t.my();o=i.data;f=i.cid;l=i.mid;t.unbind(".my");if(n=i.style){if(n.data("count")=="1"){try{n.remove()}catch(c){}}else n.data("count",n.data("count")-1)}if(r=i.localStyle){try{r.remove()}catch(c){}}if(window.URL&&(s=i.locFiles)&&s.length){for(var h=0;h<s.length;h++){try{URL.revokeObjectURL(s[h])}catch(c){}}}u=(i||{}).ui;if(u){u.each(function(e){var n=t.find(e),r;n.unbind(".my");try{r=F(n,P.destroy);if(C(r))r(n)}catch(i){}n.removeData("formlist").removeData("myval").removeData("my")})}if(e&&t.is(".my-form")){t.remove()}else if(t.data("formlist")&&t.is(".my-form")){var p=t.parents(".my-form-list").eq(0);t.remove();p.trigger("check")}else{t.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form")}t.removeClass("my-form-"+f+" my-manifest-"+l);return o},undo:function(e){var t=this,n=t.my(),r=n.params.history,i=Object.keys(r).sort(),s=1*(parseInt(e)||0),o;if(!i.length||s<0)return a;if(!n.params.errors||!n.params.errors.values().compact(true).length){if(Object.equal(r[i.last()],n.data))s+=1}else if(!Object.equal(n.data,n.lastCorrect))s+=1;o=W(s,n.params,true);if(o){H.kickoff(t.my().data,o);t.my("redraw")}return t.my().data},ui:function(e){var t=this,n=t.my(),r=[],i;if(!n)return a;var s=o(true,{},n.ui);if(!x(e))return n.ui;for(i in e)if(true||!s[i])r.push(i);n.ui=Q(H.overlap(n.ui,e));for(i=0;i<r.length;i++)X(t.find(r[i]),t,n.ui[r[i]],r[i]);for(i in e)t.find(i).eq(0).trigger("check");return n.ui},disabled:function(e){var t,n,r,i,s=this,o=s.my();if(!o)return undefined;if(e==a)return o.disabled;if(!!e){for(n in o.ui){t=s.find(n).eq(0);r=t.my();if(r)r.predisabled=r.disabled;U(true,t,":disabled")}s.addClass("my-disabled")}else{for(n in o.ui){t=s.find(n).eq(0);r=t.my();i=false;if(r&&r.predisabled)i=true;U(i,t,":disabled")}s.removeClass("my-disabled");s.my("redraw")}},find:function(t){var n=this,r=n.my();if(r&&r.root)n=r.root;return n.find(t)},manifest:function(e){return e=="json"?H.tojson(this.my().manifest):this.my().manifest},version:function(){return t},history:function(e,t){return W(e,this.my().params,t)},val:function(e){return j(this,e)},container:function(e){return F(e,P.containers)(e)},promise:function(e){if(C(e))this.my().promise.then(e);return this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var n=this.is(".my-form-list")?this:this.my().root||this,r=n.is(".my-form-list")?n:n.parent(".my-form-list"),i=(n.data("formlist")||{}).index,s,o=t,u;if(null==i)i=0;s=O(r.my().data,r.data("formlist").generator.bind);if(!x(o)){if(!x(r.data("formlist").generator.manifest)){if(r===n)throw"No data to insert, cannot guess when manifest is function.";o=Object.clone(n.my().manifest.data,true)}else o=Object.clone(r.data("formlist").generator.manifest.data,true)||{}}if("before"===e)u=i;else if("after"===e)u=i+1;else if(!isNaN(e)){u=(1*e).clamp(0,s.length)}else throw"Invalid position for insert";s.add(o,u);r.trigger("redraw")}};if(!e.my)e.my={};e.extend(e.my,{f:e.extend({},H),tojson:H.tojson,fromjson:H.fromjson,rules:P,cache:function(e,t){if(C(e))return A=e;else return A(e,t)},version:function(){return t}});e.my.chain=function(){function s(){if(n.length&&r){var e=n.shift(),t,i=function(){s.delay(e[1])}.once();try{t=e[0]()}catch(o){i()}if(k(t)){t.then(i,i);i.delay(e[1])}else i()}}var e=1,t=1e3,n=[],r=false,i=function(r,i,o){n.push([r,i||e,o||t]);s()};i.delay=function(t){if(!isNaN(t))e=(t-0).clamp(0,1e6);return e};i.timeout=function(e){if(!isNaN(e))t=(e-0).clamp(1,1e6);return t};i.start=function(){r=true;s()};i.stop=function(){r=false};return i}();e.fn.my=function(t){var n;if(t===undefined)return this.data("my");if(S(t)&&t.substr(0,1)=="{"){try{n=JSON.parse(t)}catch(r){}if(n)return Y.init.apply(this,[n].add(Array.prototype.slice.call(arguments,1)))}if(S(t)&&Y[t])return Y[t].apply(this,Array.prototype.slice.call(arguments,1));else if(S(t)&&A(t,"exist"))return Y.init.apply(this,arguments);else if(typeof t===p||!t)return Y.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.my")};return})(jQuery);(function(e){function w(e,n,r){if(h(n))return e+n;if(p(n)){r=t(true,r,n);return e}else if(l(n)&&n.length>1&&h(n[1])){var i=n[0],s="",o,f,c,d,v=1,m,g,y,w;while(v<n.length){if(h(n[v])){d=n[v].replace(/\s/g,"");c=d.split(/[\.#]/i);f=r.alias[c[0]]||c[0];o=d.substr(c[0].length);if(/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(d)){y=b.tmpl[f]||b.tmpl[""];g={style:"","class":"",txt:""};w="";var E=p(n[v+1]);if(E){v+=1;for(m in n[v])if(b.attnames[m]!=="")g[b.attnames[m]||m]=n[v][m]}if(!g.style&&!g["class"]&&r.styles[f])g.style=r.styles[f];if(!g.id&&o.to(1)=="#")g.id=o.from(1).split(".")[0];if(!g["class"]&&/\./.test(o))g["class"]=(o.to(1)=="#"?o.substr(g.id.length+1):o).split(".").compact(true).join(" ");for(m in g)w+=m+'="'+g[m]+'" ';if(E)for(m in n[v])if(b.attnames[m]==="")g[m]=n[v][m];g.ext=w;if(!g.txt&&b.txt[f])g.txt=b.txt[f](g);g._tag=f;s+=typeof y==a?y(g)||"":typeof y==u?y.assign(g):""}else s+=n[v]}v+=1}if(s){s="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&i?"padding-left:"+r.label+"; ":"")+'">'+(i?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+i+"</"+r.labelTag+">":"")+s+"</"+r.rowTag+">"}return e+s}return e}function E(e){var t=e;if(h(t)){t=t.split(/[\s,]/).compact(true)}if(l(t)){var n={};for(var r=0;r<t.length;r++){var i=t[r];if(p(i)){var s=Object.keys(i);if(s.length==1)n[s[0]]=i[s[0]]+"";else n[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else n[i]=i+""}t=n}if(p(t))return t;else return{}}function S(n,r){var i={};if(l(n)){t(true,i,b.params,r||{});return n.length?n.reduce(w.fill(undefined,undefined,i),""):""}else if(p(n)){e.extend(b,n)}else return""}var t=e.extend,n=function(e){return e!==null&&e!==undefined},r=null,i="object",s="data",o="array",u="string",a="function",f="change",l=Object.isArray,c=Object.isBoolean,h=Object.isString,p=Object.isObject,d=Object.isNumber,v=Object.isRegExp,m=Object.isFunction;var g='<input type="',y=" {ext} ";var b={tmpl:{num:g+'number" {ext}/>',inp:g+'text" {ext}/>',sli:g+'range" {ext}/>',dat:g+'date" {ext}/>',btn:g+'button" {ext}/>',div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!l(e.vals))return"";var n=t({style:"",css:""},e);n.txt=e.vals.reduce(function(e,t){return e+'<span class="my-shortcut" '+"onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," ");return'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(n)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=E(e.vals);return Object.keys(t).reduce(function(e,n){return e+'<option value="'+n+'">'+t[n]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}};var x={init:function(t,n){return e(this).html(S(t,n))}};if(!e.my)e.my={};e.my.formgen=S;e.fn.formgen=function(t){if(h(t)&&x[t])return x[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return x.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.formgen")}})(jQuery);(function(e){function v(i){var s=window,o=s.innerHeight||e(s).height(),u=s.innerWidth||e(s).width(),a=n.height(),f=i||r.width();n.removeClass("loading").css({left:(u-f-60)/2+"px",width:f*1+60+"px",display:"block"});t.css({width:u*2+"px",height:o*2+"px",display:"block"});if(a>o){n.height(o);r.css({"overflow-y":$.browser.webkit?"overlay":"scroll"})}else{r.css({"overflow-y":"none"})}n.animate({top:(a>=o?0:(o-a)/3.5)+"px"},parseFloat(n.css("top"))<o?300:0)}var t,n,r,i={},s="body",o=false,u,a=Object.isArray,f=Object.isBoolean,l=Object.isString,c=Object.isObject,h=Object.isNumber,p=Object.isRegExp,d=Object.isFunction;$(document).keydown(function(e){var t=e.keyCode;if(t===13||t===27){if(t==27&&o&&(!r.is(".my-form")||r.data("escapable")||Object.equal(r.data("my").initial,r.my("data")))){i.modal(true);return false}else if(t==13&&o&&r.is(".my-form")&&r.data("allowenter")){i.modal.delay(50);return false}}});i.modal=function(h,p,m){var g=p||function(){return false},y,b=false,w=false,E=true,S="",x,T=m||820,N=300;if($(s).find(">.my-modal").is(":visible")){o=true;if(f(h)||h===null||h===undefined){if(d(n.data("done")))g=n.data("done");else g=function(){return false};b=false;E=true;if(!h){if(!r.is(".my-form"))b=g(null,true);else{b=g(r.my("valid")?null:r.my("errors"),r.my("data"));if(!b)E=r.my("remove")}}else if(h===true&&u.state()!="rejected"){if(r.is(".my-form"))r.my("remove");g(null,null);u.reject("Cancelled")}if(!b){r.html("");n.css({display:"none"});(function(){if(!o)t.css({display:"none"})}).delay(5);$("body").css({overflow:"auto"});o=false;n.data("done",null);(function(){u.resolve(E)}).delay(0)}return}y=$.Deferred();g(null,null);y.reject("Locked");return y.promise()}u=$.Deferred();o=true;if(!n||!$(s).find(">.my-modal").size()){n=$('<div class="my-modal" style="display:none;"></div>').prependTo($(s))}n.html('<div class="my-modal-form"></div>');r=n.find(".my-modal-form");$('<div class="my-modal-close" title="Close">×</div>').prependTo(n).on("click",function(){i.modal(true)});if(!t||!$(s).find(">.my-modal-screen").size()){t=$('<div class="my-modal-screen" style="display:none;"></div>').prependTo($(s)).on("click",function(){if(!r.is(".my-form")||r.data("escapable"))i.modal(true)})}if(typeof h=="object"&&h.jquery){if(h.is("img")){S=h.attr("alt")||h.attr("title")||h.data("text");r.html(function(){var t=h,n=t[0].naturalWidth||t[0].width,r=t[0].naturalHeight||t[0].height,i=e(window).width()-90,s=e(window).height()-90,o;if(s<r)n=n*(s/r)|0,r=s;if(i<n)n=i,r=r*(i/n)|0;o='<img src = "'+t.attr("src")+'" class="db" style="max-width:'+n+"px;max-height:"+r+'px">';T=n<300?300:n;return o}()+(S?'<h4 class="mt10">'+S+"</h4>":""));r.find("img").on("click",function(){i.modal()});n.css({top:"3000px",display:"block"});N=n.height();w=1}}else if(c(h)&&h.manifest){E=h.data||{};g=d(h.done)?h.done:g;T=1*($.my.f.getref(l(h.manifest)?$.my.cache(h.manifest):h.manifest,"params.width")||h.width||T);n.css({top:"3000px",display:"block",height:"none"});r.data("my",null);w=1;r.my(h.manifest,E).then(function(){v.delay(20);u.notify("Ready")}).fail(function(e){u.reject(e);w=0;i.modal(true)});n.data("done",g);r.data("escapable",!!h.esc);r.data("allowenter",!!h.enter);r.bind("commit.my",function(){i.modal()}.debounce(50)).bind("cancel.my",function(){i.modal(true)}.debounce(50)).bind("layout.my",function(){v()})}else if(l(h)){r.html(h);n.css({top:"3000px",display:"block",width:"auto"});T=1*(n.width()||T);w=1}else if(h===true){$("body").css({overflow:"auto"});o=false;return u.reject("Cancelled").promise()}else{$("body").css({overflow:"auto"});o=false;return u.reject("Invalid data").promise()}if(w){v(T);x=r.find("img").filter(function(){return $(this).attr("src")!=""});if(x.size()){var C=function(){v(m);u.notify("Ready")}.after(x.size());x.each(function(){$(this).bind("load",C)})}else{u.notify("Ready")}$("body").css({overflow:"hidden"})}return u.promise()};i.modal.loading=function(e){$(s).find(">.my-modal").toggleClass("my-modal-loading",!!e)};i.modal.parent=function(e){if(!e||!$(e).size())return $(s);s=e};i.modal.visible=function(){return o};if(!e.my)e.my={};e.my.modal=i.modal})(jQuery);
