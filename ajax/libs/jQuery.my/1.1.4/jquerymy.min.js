/* jQuery.my 1.1.4
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */

!function(e){function t(){console.error.apply(console,arguments)}function r(e,t){return(t||"").split(".").reduce(function(e,t){return null!=e&&null!=e[t]?e[t]:void 0},e)}function n(e,t){var n,i;if(Y(t))return t;if(X(t)){if(n=r(e,t),null==n&&(n=Object.clone(E._src[t],!0)),null==n&&(n=r(E,t),Y(n)&&Y(n._self)?n=Object.clone(n._self,!0):Y(n)&&(n=Object.clone(n,!0))),null==n&&r(e,"params.cache")&&(i=r(e,"params.cache"),tt(i)?n=i(t):Y(i)&&(n=it(t,i)),Y(n)&&(Y(n._self)&&(n=Object.clone(n._self,!0)),Object.merge(n,{params:{cache:i}},!0))),null!=n&&Y(n))return i=i||r(e,"params.cache"),i&&Object.merge(n,{params:{cache:i}},!0),n;throw"Component "+t+" not found"}return tt(t)?t.apply(e,Array.prototype.slice.call(arguments,2)):null}function a(n,i){var a,s,l,c,u,d=i||E,f=n;if(!(Y(d)&&Y(f)&&Y(f.ui)&&X(f.id)))return"Invalid arguments.";d.hasOwnProperty("_src")||(d._src={}),l=f.id;try{f=Object.clone(n,!0)}catch(m){return"Can’t mount circular-referencing obj."}try{(!f.params||f.params&&!f.params.strict)&&w(f,!0)}catch(m){return"Invalid manifest, parse error."}if(a=o(f),X(a))return t(a),a;if(Object.merge(f,{params:{strict:!0}},!0),d._src[l]=f,c=st.mask(d,l)){if(c.params&&c.params.protect)return"Can’t mount on protected.";c._self&&delete c._self,e.extend(!0,d,st.unmask("",l))}return e.extend(!0,d,st.unmask(f,l)),s=Object.keys(d._src).filter(function(e){return e.startsWith(l+".")}),s.sort(),s.forEach(function(t){var r;(r=st.mask(d,t))&&(r._self&&delete r._self,e.extend(!0,d,st.unmask("",t))),e.extend(!0,d,st.unmask(d._src[t],t))}),u=r(d,l),M?u._self=d._src[l]:Object.defineProperty(u,"_self",{get:function(){return d._src[l]},set:function(){throw"Can not change repo."},enumerable:!1,configurable:!0}),u}function o(e){var t,r,n=[];if(Y(e.files)&&Object.size(e.files))for(t in e.files)if(r=e.files[t],Y(r)&&r.data&&!r.url)if(T)try{st.base642blob(r.data,function(e){r.blob=e,r.url=T.createObjectURL(r.blob)},r.content_type||r.mime),n.push(t)}catch(i){return"Invalid base64 data in files/"+t+"."}else r.url="data:"+(r.content_type||r.mime)+";base64,"+r.data,n.push(t);return n}function s(r,n){Y(n)&&n.channel&&n.message&&r.find(".my-listen-"+st.sdbmCode(n.channel)).each(function(){var r,i=e(this),a=i.data("my"),o=void 0;if(a&&a.ui.listen&&tt(a.ui.listen[n.channel])){r=a.ui.listen[n.channel];try{o=r.call(a.manifest||a.root.my().manifest,a.data,n.message,i)}catch(s){t("Listener failed",s.message,s.stack)}void 0!==o&&(null===o?i.trigger("check"):o&&i.trigger("recalc"))}})}function l(t,n){function i(t,r){var n;return X(t)?/[\/]/.test(t)?(n=R(!0,{},k,{ref:r,ajax:{url:t}}),V.test(r)&&(n.ajax.dataType="json")):t.length&&(n=R(!0,{},k,{ref:r,ajax:t})):Y(t)&&(n=R(!0,{},k,{ref:r,ajax:e.extend(!0,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username","headers"]))}),n.ajax.url||(n=null)),n}function a(){g.reject(w)}function o(){O+=1;var e=b[O];if(e)s(e).then(o).fail(a);else{var r=c(x),n=rt(Object.findAll(r,function(e,t){return!t}));n.length&&w.push((1===n.length?"Key "+n[0]+" is":"Keys "+n.join(", ")+" are")+" not present after all."),w.length?a():g.resolve(t)}}function s(r){function n(){c-=1,s?l.reject():.5>c&&l.resolve()}var i,a,o,s=!1,l=e.Deferred(),c=r.length;for(a=0;c>a;a++)i=r[a],o=X(i.ajax)?j.loader:at,o(i.ajax).then(function(e,r){V.test(r.ref)&&(null!=e?R(!0,t,st.unmask(e,r.ref.from(5))):(s=!0,w.push("Invalid data for ‘"+r.ref+"’ resource."))),n()}.fill(void 0,i)).fail(function(e,t){w.push("Failed to load ‘"+t.ref+"’ resource."),s=!0,n()}.fill(void 0,i));return l.promise()}function l(e){var n=!1;return V.test(e)?null!=r(t,e.from(5))&&(n=!0):null!=r(window,e)&&(n=!0),n}function c(e){for(var t in e)e[t]===!1&&(e[t]=l(t));return e}var u,d,f,m,h,p,y,v,g=e.Deferred(),b=[],x={},w=[],j=R(!0,{ajaxTimeout:1e4,loader:ot.params.loader},n||{}),k={ref:null,ajax:{type:"GET",async:!0,timeout:j.ajaxTimeout}};if(Y(t))if(G(t.require)){for(m=t.require,u=0;u<m.length;u++)if(h=m[u],X(h))x[h]=l(h);else if(Y(h)){v=[];for(d in h){if(p=null,h[d]===!0)x[d]=l(d);else if(X(h[d])||Y(h[d]))p=i(h[d],d);else if(G(h[d])){for(p=[],f=0;f<h[d].length;f++)(X(h[d][f])||Y(h[d][f]))&&(y=i(h[d][f],d),y&&p.push(y));p.length||(p=null)}p&&!(x[d]=l(d))&&v.add(p)}v.length&&b.push(v)}var O=-1;o()}else g.resolve(t);else g.reject(["Invalid manifest."]);return g.promise()}function c(e,t){var r,n,i=e.data("myval");return i||(n=u(e,ot.vals),tt(n)&&(r=n(e,P),void 0===r?e.data("myval",function(e,t){return P!=t&&n(e,t),e.val()}.fill(e,void 0)):e.data("myval",n.fill(e,void 0))),i=e.data("myval")),tt(i)?(r=i(),(r!==t&&(0==t||0==r)||r!=t||Y(t))&&(r=i(t)),r):P}function u(e,t){function r(e,t,o){for(var s in t)if(""!=s&&e.is(s)){a=a+(a?" ### ":"")+s;var l=t[s],c=$(l);if(!/^(nul|un|ob)/.test(c)&&o>i)return n=l,void(i=o);c==A&&r(e,l,o+1)}P!=t[""]&&typeof t[""]!=A&&o>i&&(n=t[""],i=o)}var n=P,i=0,a="";return r(e,t,1),n}function d(e,t,r,n){var i,a,o,s=[],l=r.bind,c=$(l);if(c==Q)return l.call(m(n).manifest,e,t,n);if(c===B||c===J){if(c===B&&!/\./.test(l))return t!=P?e[l]=t:void 0===e[l]&&(e[l]=P),e[l];for(c===B&&(s=l.split(".").each(function(e,t){this[t]=e+""})),c===J&&(s=l.slice(0).each(function(e,t){this[t]=e+""})),"this"===s[0]?(a=m(n).manifest,s.shift()):a=e,i=0;i<s.length;i++){if(i===s.length-1)return t!=P?a[s[i]]=t:void 0===a[s[i]]&&(a[s[i]]=P),a[s[i]];0==i?(o=a,a=a[s[0]]):(o=o[s[i-1]],a=a[s[i]]),void 0===a&&(a=o[s[i]]={})}}return P}function f(t,r,n,i){var a,o,s=n.check;if(s!=P){var l=m(i).params.messages,c=n.error,u=c||l.patternMismatch||l[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var d=i[0].validationMessage+"";if(""!==d)return d.substr(0,1).toUpperCase()+d.substr(1);o=i[0].validity;for(a in o)""===d&&"valid"!=a&&K(o[a])&&o[a]&&l[a]&&(d=l[a]);return d||c}switch($(s).to(1)){case"f":return h=s.call(m(i).manifest,t,r,i),null===h||void 0===h?"":h;case"r":return s.test(String(r))?"":u;case"a":return s.indexOf(r)>-1?"":u;case"s":return r==s?"":u;case"o":return s[r]?"":u;case"b":if(i.is(".my-form-list,.ui-sortable")){var f=i.data("listSrc")||i.data("my").listSrc||">*",h={};return i.find(f).filter("*:not(.ui-sortable-placeholder)").each(function(t){var r=e(this);r.data("my")&&!r.my("valid")&&(h[t]=r.my("errors"))}),h}return i.hasClass("my-form")&&s?i.my("valid")?"":i.my("errors"):""}return l.formError||"Error"}return""}function m(e){var t=e.my();return t?t.root?t.root.my():t:null}function h(t,r,n){var i=n.compact(),a=i.replace(/:disabled/g,""),o=a!==i,s="self:"===a.to(5);return s&&(a=a.replace(/^self:/g,"")),r.each(function(){var n=e(this),i=n.my(),l=!s&&i?i.container:n;l.toggleClass(a,!!t),o&&void 0!==i&&!!t!=!!i.disabled&&(n.my().disabled=!!t,i._disable||(n.my()._disable=u(r,ot.offon).fill(void 0,r)),i._disable(!!t))}),r}function p(e,r,n){var i,a,o,s,l,u,m,y,v,g,b,x=!1,w=!1,j=e,k=j.my(),O="";if(k){if(y=k.selector,v=k.root,v.hasClass("my-form-init"))return{};if(g=v.find(y),b=v.my().ui,x=e.hasClass("my-form"),w=e.hasClass("my-form-list"),x?(i=e,a=k.ddata,o=k.dui,s=k.dparams):(i=k.container,a=k.data,o=k.ui,s=k.params),o.bind!=P){if(l=U(r)?r:c(g,d(a,P,o,g)),P!=o.check){O="Unknown error";try{O=f(a,l,o,g)}catch(C){t("Error "+C.message+" in .check validatir for "+y,v,C.stack)}}var q=s.errorCss,z="ui-state-error";try{P!=r&&(l=c(g,d(a,r,o,g)))}catch(C){O=s.messages.formError||"Error"}if(""===O)x?k.derrors[y]="":k.errors[y]="",i.removeClass(q),i.attr("title")&&i.attr("title",""),x||w||s.effect(i.find(s.errorTip),!1,s.animate/2),j.removeClass(z),j.find(".ui-widget").removeClass(z);else{if(x)k.derrors[y]=O;else if(w)k.errors[y]=O;else{i.addClass(q),k.errors[y]=O;var D=i.find(s.errorTip).eq(0);D.size()?s.effect(D.addClass(q).html(O),!0,s.animate):i.attr("title",(O||"").stripTags())}j.is(".hasDatepicker")&&(j.is("input")?j.addClass(z):j.find(".ui-widget").addClass(z)),j.is(".ui-slider")&&j.addClass(z)}}var _=r==P?l:r;if(o.css)for(u in o.css)m=o.css[u],et(m)?h(m.test(_),g,u):tt(m)&&h(m.call(v.my().manifest,a,_,g),g,u);var N,S,T=o.recalc,M=[],E={};if(n&&o.recalc&&v.my()){for(b=v.my().ui,N=0;N<T.length;N++)T[N]&&X(T[N])&&(S=T[N].compact())&&b[S]&&(b[S].recalc?-1===M.indexOf(S)&&M.push(S):E[S]=!0);for(N=0;N<M.length;N++)E=R(!0,E,p(v.find(M[N]),P,n-1));if(r!==P){for(N in E)E[N]===!0&&N!=y&&(b[N].delay&&!b[N].recalc?b[N]._update(v.find(N),P,n-1):p(v.find(N),P,n-1));return{}}}return E||{}}}function y(e,t,r,n){var i,a,o,s,l,c,u,d,f,m=t;if(!Y(m)||isNaN(s=m.remember)||!Y(i=m.history))return P;if(Y(e)&&s){if(c=Object.clone(e,!0),u=Date.now(),o=rt(i).sort(),o.length&&(u-o.last()<m.historyDelay||Object.equal(i[o.last()],c)))return P;if(m.history[u]=c,o.push(u),o.length>=2*s){for(f={},a=s;2*s>a;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(W),m.history[o.last()]}if(!isNaN(e)||e===P){if(l=parseInt(e)||0,0>l)return P;if(o=rt(i).sort(),l>=o.length&&(l=o.length-1),d=Object.clone(m.history[o[o.length-l-1]],!0),r){for(f={},a=0;a<o.length-l-1;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(W),d}return n||m.form.trigger(W),P}function v(i,a,o,s){function l(){var t=null,a=k.manifest;if(tt(a)||Y(a)&&Y(a.ui)?y=a:X(a)&&(y=n(q,a.replace(V,""))),y&&X(k.bind)){var o=r(V.test(k.bind)?q:w.data,k.bind.replace(V,""));if(null===O&&(O=e.Deferred()),G(o)||k.list){i.addClass("my-form-list");var l="",u=">*";if(/^<.+>$/.test(k.list)?l=k.list:u=k.list||u,!l){var m=i.find(u);l="<div></div>",m.size()&&(l=e(l).append(m.eq(0).clone(!0)).html(),m.eq(0).remove())}i.data("formlist")||i.data("formlist",{}),i.data("formlist").generator={manifest:y,delay:(k.delay||j.delay||10)/1.3,template:l,selector:u,parent:q,bind:k.bind,hash:tt(k.hash)?k.hash.bind(q):d(k.hash),id:tt(k.id)?k.id.bind(q):d(k.id),ext:!(!k.id&&!k.hash),stamp:0},i.on("insert.my",function(t,r){t.stopPropagation();var n={what:void 0,where:0};null==r?n.where=1e6:Y(r)?Object.merge(n,r):(X(r)||Z(r))&&(n.where=r),e(t.target).my("insert",n.where,n.what)}),i.on("remove.my",function(t){t.stopPropagation(),e(t.target).my("remove")})}else try{t=i.my(n(q,y),Y(o)?o:void 0)}catch(h){c("$.my subform init of "+s+" failed: "+h.message,h.stack)}}nt(t)?t.then(f,function(e,t){c("Init of subform "+s+" failed with error: "+e,t)}):f()}function c(e,r){t(e,r),O&&O.reject(e,r)}function d(e){var t=$(e).to(3);return e?"str"===t?r.fill(void 0,e):"arr"===t?st.mask.fill(void 0,e):null:null}function f(){i.each(function(){var t,r,n=e(this),l=!1,c=n[0].nextSibling;if(r=c&&c.CodeMirror?c.CodeMirror:null,r&&n.addClass("my-codemirror"),t=k.events||u(n,ot.events),n.is(".my-form")?R(n.data("my"),{dui:k,root:a,selector:s,dparams:j,devents:t,ddata:w.data,container:j.container(n),derrors:w.errors}):(n.data("my",{events:t,selector:s,initial:h,previous:h,root:a,container:j.container(n),id:w.id,ui:k,data:w.data,params:j,errors:w.errors}),o._update=k.delay?p.debounce(k.delay):P,l=!0),l)if(n.cleditor&&n.parent().is(".cleditorMain")){var d=n.cleditor()[0];if(d&&d.$frame&&d.$frame[0]){n.addClass("my-cleditor"),R(n.data("my"),{container:j.container(n)});var f,m=function(e){n.val(e).trigger(W)},y=Number.random(1e5,1e6-1);e(d.$frame[0]).attr("id","cleditCool"+y),f=document.frames?document.frames["cleditCool"+y].document:e("#cleditCool"+y)[0].contentWindow.document;var x=e(f).find("body");e(f).bind("keyup.my",function(){m(e(this).find("body").html())}),n.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){m(x.html())}),e("body").on("click","div.cleditorPopup",function(){m(x.html())})}}else if(n.is("div.redactor_box textarea")){var O,C="my-redactor-9";try{O=n.getEditor(),C="my-redactor-8"}catch(q){O=n.redactor("getEditor")}O&&(n.addClass(C),O.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(n)))}else n.is(".ace_editor")?ace.edit(i[0]).on(W,function(e){e.trigger("ace")}.fill(n)):r&&r.on(W,function(e){e.trigger("codemirror")}.fill(n));n.my()._changed=g.debounce(v),n.my()._recalc=b.debounce(v),n.bind(t,function(e){e.type==W&&e.stopPropagation(),l&&(w.locktill=Date.now()+o.delay),n.my()._changed(n,a,o,j)}),/check(\.my)?/.test(t+"")||n.on("check.my",function(){return n.my()._changed(n,a,o,j,!0),!1}),n.on("recalc.my, redraw.my",function(e){e.stopPropagation(),n.my()._recalc(n,a,o,j)})}),O&&O.resolve()}var m,h,y,v,w=a.my(),j=(w||{}).params,k=o,O=null,C=0,q=w.manifest;return w?(v=o.delay,i.size()?(k.init!=P&&(m=x(q,k.init,i,w)),nt(m)?(C+=1,O=e.Deferred(),m.then(l,function(e,t){c("Init of "+s+" failed: "+e,t)})):l()):st.con("Not found "+s+" selector.",a),O):(t("Failed to find $root building "+s+" selector."),null)}function g(e,t,r,n,i){var a=e.data("my"),o=t.data("my");if(a&&!a.disabled){y(a.ddata||a.data,a.dparams||a.params);var s=t.find(a.selector);p(e,i?P:c(s,P),r.recalcDepth||n.recalcDepth),void 0===o.orphan&&a.root.parent().hasClass("ui-sortable")&&(o.orphan=!a.root.parent().hasClass("my-form-list")),o.orphan&&a.root.parent().trigger("check"),n.change&&n.change.call(e)}}function b(e,t,n,i){var a=e.my();if(a&&!a.disabled){var o=t.find(a.selector);o.is(".my-form")?o.my("redraw"):p(e,o.is(".my-form-list")?r(o.my().data,o.data("formlist").generator.bind):P,n.recalcDepth||i.recalcDepth)}}function x(e,t,n,i){var a;if(X(t)){if(a=r(e,t),void 0===a)return n.html(t.assign(i.data)),null}else a=t;if(tt(a))return a.apply(e,Array.prototype.slice.call(arguments,2));if(G(a))try{n.formgen(a)}catch(o){}return null}function w(e,t){var r,n=!t;for(r in e)e.hasOwnProperty(r)&&j(r,e,n)}function j(e,r,n){var i,a,o,s="";(n||!/^(data|files|require)$/.test(e))&&(i=r[e],s=$(i),/^(ob|ar)/.test(s)?w(i):"string"===s&&/^(function\s*\(|new\sRegExp)/.test(i)&&((a=i.match(/^function\s*\(([^\)]*)\)\s*\{([\s\S]*)\}[\s\n\r\t]*$/))&&3===a.length?(o=k(a[1],a[2]),"function"==typeof o?r[e]=o:t("Invalid function in XJSON, skipped",o.message,o.stack,i)):(a=i.match(/^new\sRegExp\s*\(\/([\s\S]+)\/([a-z]*)\)$/))&&3===a.length&&(o=O(a[1],a[2]),"function"==typeof o.test?r[e]=o:t("Invalid RegExp in XJSON, skipped",o.message,o.stack,i))))}function k(e,t){var r;try{r=new Function(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function O(e,t){var r;try{r=new RegExp(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function C(e,t,n){var i=Y(t)?t:null;return Object.each(e,function(t,r){var n=typeof r;/^str|^fu/.test(n)&&(e[t]={bind:r})}),Object.each(e,function(t,a){var o,s,l,c=[],u=[],d=/\s?[,;]\s?/;a.recalc&&(X(a.recalc)?c=a.recalc.split(d):G(a.recalc)&&(c=a.recalc),c=c.compact(!0).unique()),c.length&&(e[t].recalc=c),null==a.bind&&(a.bind=function(){});var f;if(a.listen&&(f=q(a.listen),a.listen=Object.size(f)?f:void 0),a.watch)for(X(a.watch)?u=a.watch.split(d):G(a.watch)&&(u=a.watch.slice(0)),u=u.compact(!0).unique(),l=0;l<u.length;l++)(o=e[u[l]])&&(s=o.recalc,s?X(s)?o.recalc+=","+t:G(s)&&-1==s.indexOf(t)&&o.recalc.push(t):o.recalc=[t]);null!==i&&["css","check","manifest","list","hash","id"].each(function(e){if(X(a[e])){var t=r(i,a[e].replace(V,""));null!=t&&(a[e]=t)}}),a.delay=isNaN(a.delay)?n.delay:a.delay-0}),e}function q(e){var t,r={},n=function(){return null};if(X(e))e.split(/[,\s]+/).compact(!0).unique().map(function(e){r[e]=n});else if(G(e))e.compact(!0).unique().map(function(e){r[e]=n});else if(Y(e))for(t in e)r[t]=tt(e[t])?e[t]:function(){return e[t]};return r}function z(e){var t=e,r={};if(X(t)&&(t=t.split(/[,\s]+/)),G(t)){for(t=t.compact(!0),i=0;i<t.length;i++)r[t[i]]=!0;return r}return Y(t)?e:null}function D(e,t){function r(i,a,o,s){var l,c,u,d,f=i;if(X(f)&&(/[\r\n]/.test(f)||f.split("}",3).length>2?f=st.css2json(f):o.push(a+(/\{/.test(f)?f:"{"+f+"}"))),G(f)&&f.length)for(l=0;l<f.length;l++)r(f[l],a,o,s);else if(Y(f))for(l in f)for(d=n(a,l),c=0;c<d.length;c++)r(f[l],d[c],o,s);else if(tt(f))try{u=f.call(t,e,t),r(u,a,s,s)}catch(m){}}function n(e,t){var r,n="",i=t+"";return(" "===i.to(1)||/^[a-z]/i.test(i))&&(n=" "),r=i.split(/\s*,\s*/).compact(!0),r.length||r.push(""),r.map(function(t){return e+n+t})}var i=[],a=[],o=t;return Y(o)&&Y(o.style)?(r(t.style,"",i,a),[i,a]):""}function _(){return{con:function(){try{console.log.apply(console,arguments)}catch(e){}},clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();return t&&t.data?t.data:e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,r){return e[t](r?"disable":"enable")},overlap:function(){function e(e,t,r){return void 0===r||null===r?t:Y(r)?Object.merge(t,r,!1):r}if(!arguments.length)return{};if(1===arguments.length)return arguments[0];for(var t=1;t<arguments.length;t++)Object.merge(arguments[0],arguments[t],!1,e);return arguments[0]},patch:function t(e,r){for(var n in r)r.hasOwnProperty(n)&&(Y(r[n])?e.hasOwnProperty(n)?t(e[n],r[n]):e[n]=Object.clone(r[n],!0):e.hasOwnProperty(n)||(e[n]=G(r[n])?r[n].clone(!0):r[n]));return e},kickoff:function(e,t){var r,n=t&&"object"==typeof t?Object.clone(t,!0):{};for(r in e)e.hasOwnProperty(r)&&(delete e[r],void 0!==n[r]&&(e[r]=n[r]))},sdbmCode:function(e){for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++)r=t.charCodeAt(n)+(r<<6)+(r<<16)-r;return(1e11+r).toString(36)},tojson:function(){function e(e){return 10>e?"0"+e:e}function t(e,i,a){var o,s,l,c,u=0,d=i||0,f=r;switch(a&&X(a)&&(u=String(a).length,f=String(a).repeat(10)),(typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e):"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\([^\)]*)([\n\t][^)]*)(\).*)/,"$1 $3$5").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===Q)return t(e.toJSON(),d+(a?1:0),a);if(o=[],G(e)){for(s=0;s<e.length;s+=1)o.push(t(e[s],d+(a?1:0),a)||"null");return"["+o.join(","+(a?"\n"+f.to(d*u+u):""))+"]"}for(l in e)X(l)&&(c=t(e[l],d+(a?1:0),a),c&&o.push((a?"\n"+f.to(d*u+u):"")+t(l,d+(a?1:0),a)+": "+c));return"{"+o.join(",")+(a?"\n"+f.to(d*u):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var r="	".repeat(10),n=JSON.stringify;return t.fill(void 0,0,void 0)}(),fromjson:function(e){var t=JSON.parse(e);return w(t),t},mask:function(e,t){function n(e,t){if(!Y(t))return{};var r={};for(var i in t)!Y(t[i])&&e.hasOwnProperty(i)?r[i]=Object.clone(e[i],!0):e.hasOwnProperty(i)&&(r[i]=Y(e[i])?n(e[i],t[i]):Object.clone(e[i],!0));return r}if(!Y(e))return null;var i,a=t;if(X(a))return r(e,a);if(G(a)){i=[];for(var o=0;o<a.length;o++)i[o]=X(a[o])?r(e,a[o])||null:null;return i}return Y(a)?n(e,a):void 0},unmask:function(e,t){function r(e,t,r){var n,i,a,o=Object.clone(t,!0),s=0;if(/\./.test(r))for(i=r.split(".").each(function(e,t){this[t]=String(e).compact()}),n=e;s<i.length;s++)s===i.length-1&&(n[i[s]]=o),0===s?(n=e[i[0]],a=e):(a=a[i[s-1]],n=n[i[s]]),void 0===n&&(n=a[i[s]]={});else null!=t&&(e[r]=o);return e}var n={};if(Y(e)&&Y(t))return st.mask(e,t);if(G(e)&&G(t)){for(var i=0;i<t.length;i++)null!=e[i]&&r(n,e[i],t[i]);return n}return X(t)?r({},e,t):null},getref:r,require:l,repo:function(){return E},restyles:function(){return I},unjson:function(e){return w(e),e},blob2base64:function(e,t,r){var n=new FileReader;n.onload=function(){t(r?n.result:n.result.split(",")[1])},n.readAsDataURL(e)},base642blob:function(e,t,r){for(var n,i=atob(e),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o),l=0;a>l;l++)s[l]=i.charCodeAt(l);return n=new Blob([s],{type:r||"application/octet-stream"}),tt(t)?void t(n):n},base64:function(t,r,n){var i=($(t),null),a=X(t)?t:e.my.tojson(t),o=X(n)?"data:"+n+";base64,":"";if(r){try{i=decodeURIComponent(escape(window.atob(a)))}catch(s){i=null}if(null!==i&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(i))try{i=e.my.fromjson(i)}catch(s){i=null}return i}return o+window.btoa((n===!0?"ï»¿":"")+unescape(encodeURIComponent(a)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(!0).reduce(function(e,t){var r,n,i,a=t.trim();return/^[^{]+\{[^\}]+\}$/.test(a)&&(r=a.to(-1).split("{"),n=" "+r[0].trim(),i=r[1].trim(),";"!=i.last()&&(i+=";"),e[n]||(e[n]=""),e[n]+=i),e},{});return t}}}var N,S="jQuery.my 1.1.4",T=window.URL||window.webkitURL,M=!document.addEventListener,E=r(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Global manifest cache"},I=r(e,"my.f.restyles")?e.my.f.restyles():{},R=e.extend,$=e.type,P=null,U=function(e){return null!==e&&void 0!==e},F="{yyyy}-{MM}-{dd}",L="{HH}:{mm}",A="object",H="data",J="array",B="string",Q="function",W="change",V=/^this\./,G=Object.isArray,K=Object.isBoolean,X=Object.isString,Y=Object.isObject,Z=Object.isNumber,et=Object.isRegExp,tt=Object.isFunction,rt=Object.keys,nt=function(e){return!!(null!=e&&(Y(e)||e.jquery)&&tt(e.then)&&tt(e.fail)&&tt(e.state))},it=function(e,t){var n,i;return X(e)?(n=e,i=r(Y(t)?t:E,n),"exist"===t?Y(i):i?Object.clone(i,!0):null):Y(e)?(i=a(e,t),Y(i)?i:null):void 0===e?E._src:null===e?Object.reject(E,/^_/):null},at=e.ajax,ot={vals:{".my-form":function(e,t){if(e&&e.my){var r=e.my(H);return Object.equal(r,t)?r:e.my(H,t,!0)}return t||P},".hasDatepicker":function(e,t){U(t)&&e.datepicker("setDate",""==t?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(F):""},".my-tags":function(e,t){return U(t)&&(X(t)||Z(t)?e.tags(H,[t+""]):G(t)&&e.tags(H,t)),e.tags(H)},".ui-draggable":function(e,t){if(U(t)&&Y(t)){var r={};isNaN(t.left)||(r.left=Number(t.left).ceil(2)+"px"),isNaN(t.top)||(r.top=Number(t.top).ceil(2)+"px"),(r.left||r.top)&&e.css(r)}var n=e.position();return{left:t&&!isNaN(t.left)?(1*t.left).ceil(2):n.left.ceil(2),top:t&&!isNaN(t.top)?(1*t.top).ceil(2):n.top.ceil(2)}},".my-form-list":function(t,r){function i(){var r,n,i=e(this),a=i.data("my");a&&(r=i.data("formlist"),n=r.index,r.hash=b(a.data,n)+"",r.oid=x!==b?x(a.data,n)+"":r.hash),t.trigger("check.my")}function a(e){e.data("my").locktill+j/1.3<z&&e.my("redraw")}var o,s,l,c,u,d,f="ui-sortable",m="."+f+"-placeholder",h=t.data("formlist")||{},p=h.generator||{},y=p.selector||">.my-form",v=p.template||"<div></div>",g=/\{/.test(v),b=p.hash||st.sdbmCode,x=p.id||st.sdbmCode,w=p.ext,j=p.delay||50,k=t.is("."+f),O=!!t.children(m).size(),C=[],q=[],z=Date.now(),D=t.find(k?t.sortable("option","items"):y);if(U(r)&&G(r)){if(O)return r;if(s=[],D.each(function(){var t=e(this),r=t.data("my");r&&s.push(r.data)}),c=!1,s.length===r.length)for(c=!0,o=0;o<s.length;o++)s[o]!==r[o]&&(c=!1);if((!c||w)&&(l=e.extend(!0,[],s,r),!Object.equal(s,l)||l.length!=r.length)){var _=[],N=[],S={},T={};for(q=[],o=0;o<r.length;o++)N[o]=x(r[o],o)+"",S[N[o]]=o,_[o]=(x!==b?b(r[o],o):N[o])+"";for(D.each(function(){var t=e(this),r=t.data("formlist")||{},n=r.oid;n&&S.hasOwnProperty(n)?T[n]=e(this):t.is(".my-form")?t.my("remove",!0):t.remove()}),o=0;o<r.length;o++)T[N[o]]?(u=T[N[o]].detach().appendTo(t),C.push(u.my("data")),_[o]!==(u.data("formlist")||{}).hash&&q.push(u)):(u=e(g?v.assign(r[o]):v).appendTo(t),u.data("formlist",{list:r[o],index:o,hash:_[o],oid:N[o]}),u.my(n(p.parent,p.manifest,r[o],o,r,t),r[o]).then(function(e){e.on("change.my",i.debounce(j/1.3))}.fill(u)),C.push(u.my("data")));if(q.length&&w){for(o=0;o<q.length;o++)a(q[o]);q=[]}return C}return s}if(D.size()){if(z-p.stamp>1.4*j||z-p.stamp>100||!p.stashed||p.stashed.length!==D.size()-(O?1:0)){O&&(d=t.find(">."+f+"-helper"));var M=0;for(D.each(function(t,r){var n,i,a,o=e(r),s=!1;O&&o.hasClass(f+"-helper")||(O&&o.hasClass(f+"-placeholder")&&(o=d),n=o.data("my"),i=o.data("formlist"),n&&i&&(C.push(n.data),M!=i.index&&(i.index=M,s=!0),w&&(a=b(n.data,M)+"",a!==i.hash&&(i.hash=a,s=!0)),M+=1,s&&q.push(o)))}),o=0;o<q.length;o++)a(q[o]);q=[],p.stamp=z,p.stashed=C}else C=p.stashed.slice(0);return C}return r||[]},".ui-sortable":function(t,r){var n,i=[],a="ui-sortable",o=">."+a+"-placeholder",s=t.find(t.sortable("option","items"));if(U(r)&&G(r)){var l={},c={},u=r.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(o).size())return u;s.each(function(){l[st.sdbmCode(st.extval(e(this)))]=e(this)});for(var d=u.length-1;d>=0;d--){var f=st.sdbmCode(u[d]);l[f]&&(l[f].prependTo(t).show(),c[f]=!0,-1==i.indexOf(u[d])&&i.push(u[d]))}i=i.reverse();for(d in l)c[d]||l[d].hide()}else{var m=t.find(o),h=t.eq(0);0!=m.size()?(h.my()[a]!=m.position().left+""+m.position().top?(s=s.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)"),n=t.find(t.sortable("option","items")).filter(".ui-sortable-helper"),s.each(function(){var t=e(this);i.push(st.extval(t.is(".ui-sortable-placeholder")?n:t))}),h.my()[a]=m.position().left+""+m.position().top,h.my()[a+"1"]=i):i=h.my()[a+"1"],i==P&&s.each(function(){i.push(st.extval(e(this)))})):(s=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)"),s.each(function(){i.push(st.extval(e(this)))}))}return i},"input[type=date]":function(e,t){if(U(t))return r=""!=t?Date.create(t).format(F):"",X(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(F):""},"input[type=time]":function(e,t){if(U(t))return r=""!=t?Date.create(t).format(L):"",X(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(L):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){U(t)&&e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){U(t)&&e.val(t).trigger("update")},"div.select2-container+input":function(e,t){return U(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val"))&&e.select2("val",G(t)?t:[t]),e.select2("val")},"":function(e,t){U(t)&&e.val(t+"")}},":radio":function(t,r){var n=-1;if(U(r)){t.each(function(t){var i=e(this).val();r+""==i+""&&(n=t)});var i=t.eq(0).checkboxradio;if(i&&t.each(function(t){var r=e(this);n!=t&&r.is(":checked")&&r.prop("checked",!1).checkboxradio("refresh")}),n>-1){var a=t.eq(n);a.is(":checked")||(a.prop("checked",!0),i&&a.checkboxradio("refresh"))}else i||t.each(function(){e(this).prop("checked",!1)})}if(-1==n)for(var o=0;o<t.size();o++)t.eq(o).is(":checked")&&(n=o);return-1!=n?t.eq(n).val():""},":checkbox":function(t,r){var n=r,i=[];if(U(n)){G(n)||(n=[r]);var a=!!t.eq(0).checkboxradio;t.each(function(){var t=e(this),r=t.val(),o=t.is(":checked");-1!=n.indexOf(r)?(i.push(r),o||t.prop("checked",!0)):o&&t.prop("checked",!1),a&&t.checkboxradio("refresh")})}else t.each(function(){var t=e(this);t.is(":checked")&&i.push(t.val())});return i}},select:{".ui-slider-switch":function(e,t){U(t)&&(e.val(t+""),e.slider("refresh"))},"div.select2-container+select":{"[multiple]":function(e,t){return U(t)&&e.select2("val",G(t)?t:[t]),e.select2("val")},"":function(e,t){return U(t)&&e.select2("val",t+""),e.select2("val")}},"[multiple]":function(e,t){U(t)&&(e.val(t,[]),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))},"":function(e,t){U(t)&&(e.val(t+""),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))}},textarea:{".my-cleditor":function(e,t){return U(t)&&e.val(t).cleditor()[0].updateFrame(),e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");return U(t)?(r?e.redactor("set",t):e.setCode(t,!1),t):r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){return U(t)?(e[0].nextSibling.CodeMirror.setValue(t),t):e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){U(t)&&e.val(t+"")}},"fieldset,form,section,footer,aside,.my-container":function(e,t){var r=Array.prototype.slice.call(e[0],0).sort(),n=t;return U(t)&&(X(t)&&(n=t.split(/[,\s]+/).compact(!0)),G(n)&&(n.sort(),n.join(" ")!==r.join(" ")&&(e.atrr("css",n.join(" ")),r=n))),r},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){return U(t)&&e.slider("option",e.slider("option","values")?"values":"value",st.clone(t)),st.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,r){if(U(r)){if(""!=r){var n=P;if(t.find(":radio").each(function(){n=(e(this).val()||e(this).button("option","label"))==r?e(this):n}),n)return n.attr("checked",!0),t.buttonset("refresh"),r}}else{var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}return t.find(":radio:checked").attr("checked",!1),t.buttonset("refresh"),""},".ace_editor":function(e,t){return U(t)&&ace.edit(e[0]).setValue(t),ace.edit(e[0]).getValue(t)},"":function(e,t){return U(t)&&e.html(t),e.html()}},"pre,code":function(e,t){return U(t)&&e.html(t),e.html()},img:function(e,t){return U(t)&&e.attr("src",t),e.attr("src")||""},"":function(e,t){return U(t)&&e.html(t),e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:N="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:N},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+("Micro"===navigator.appName.to(5)?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var r=t[0].parentNode,n=r.nodeName;return/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n)?e(r):t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){st.jquix(t,"selectable",e)},".ui-slider":function(e,t){st.jquix(t,"slider",e)},".ui-draggable":function(e,t){st.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){st.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){st.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){st.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")}),t.removeClass("my-form-list"),t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor(),e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea(),e.removeClass("my-codemirror")
}}}};ot.params={container:function(e){return u(e,ot.containers)(e)},change:P,recalcDepth:2,delay:0,strict:!1,restyle:-1,locale:N=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(ot.msg,function(e,t){return t[N]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,r){return t?e.fadeIn(r):void e.fadeOut(r)},remember:0,silent:!1,history:{},historyDelay:100,loader:function(t){var r=e.Deferred(),n=it(t+"");return n?r.resolve(n):r.reject(null),r.promise()},ajaxTimeout:1e4};var st=_(),lt={init:function(n,i,a){function l(e){var t,n,i,a,o,s,l={},c=!0,u=e.inherit;if(l=z(u),!Object.size(l))return null;if(a=ut.parents(".my-form").eq(0),!a.size())return null;if(o=a.data("my"),!o||!o.manifest)return null;i=o.manifest,n=i.expose,c=!n;for(t in l)(c||n[t])&&(s=r(i,t),null!=s&&(/\./.test(t)||X(l[t])?R(!0,$,st.unmask(s,X(l[t])?l[t]:t)):e[t]=s))}function u(){var e,r;for(var e in K)for(r in M[e].listen)K[e].addClass("my-listen-"+st.sdbmCode(r));W.radio&&ut.on("radio.my",function(e,r){var n,i;if(Y(r)&&r.channel&&r.message&&tt(W.radio[r.channel])){n=W.radio[r.channel];try{i=n.call(W,e,r)}catch(a){t("Radio handler for form "+N+"failed",a.message,a.stack)}void 0!==i&&(e.stopPropagation(),i&&s(ut,r))}})}function f(){E.strict||w($,!0),W=R(!0,W,Object.reject($,["data"])),M=C(R(!0,{},$.ui||{}),W,E),W.radio&&(W.radio=q(W.radio)),W.expose&&(W.expose=z(W.expose)),_=Number.random(268435456,4294967295).toString(16),O=$.id||"my"+_,N=st.sdbmCode(O),W.id=O,E.form=ut,$.params&&$.params.depth&&(E.recalcDepth=$.params.depth);for(U in W)tt(W[U])&&(W[U]=W[U].bind(W));$.error&&(X($.error)?rt=function(e,t){return $.error.assign(R({message:e+"",err:t+""},$))}:tt($.error)&&(rt=function(e,t){S=null;try{S=$.error(e,t)}catch(r){S=E.messages.initFailed}return S})),R(ut.data("my"),{id:O,cid:_,mid:N,errors:Object.extended(),ui:Object.extended(M),disabled:!1,manifest:W,locFiles:[],modals:{},radio:{}}),ut.addClass("my-form"),L="my-manifest-"+N,A="my-form-"+_,ut.addClass(A+" "+L)}function m(t){function r(e,t){return'<style id="'+t+'" data-count="0">.'+t+e.join(" \n."+t)+"\n</style>"}W.style&&(F=D(ut,W,L,A),F&&F[0].length&&!t&&(J=e("style#"+L),J.size()||(J=e(r(F[0],L)).appendTo(e("body"))),J.data("count",1*J.data("count")+1),ut.data("my").style=J),F&&F[1].length&&(B=e("style#"+A),B.size()?t&&(e(r(F[1],A)).replaceAll(B),B=e("style#"+A)):(B=e(r(F[1],A)).appendTo(e("body")),E.restyle>-1&&!I[_]&&(I[_]=function(){m(!0)}.debounce(E.restyle)),ut.data("my").restyle=m.fill(!0).debounce(0)),ut.data("my").localStyle=B))}function h(){var t,r,n=e.Deferred();if(r=o(W),X(r))b("Error decoding base64 to local Blob/URL",r),n.reject();else{if(T)for(t=0;t<r.length;t++)G.push(W.files[r[t]].url);G.length&&(ut.data("my").locFiles=G),n.resolve()}return n.promise()}function p(){if($.init!=P){ct=ut.find(">*").clone();try{Q=x(W,$.init,ut,$)}catch(t){return b(X(t)?t:t.message,t.stack),ut}}if(nt(Q)?Q.then(function(){y()},function(e,t){b(e,t)}):y(),!et){if(!ut.my())return b("Internal error initializing controls",""),ut;ut.data("my").initial=R(!0,{},V),e.mobile&&e.mobile.changePage(e.mobile.activePage)}}function y(){function e(e){et||(t[e]=c(ut.find(e),P),r-=1,.5>r&&g(t))}var t={},r=Object.size(M);ut.addClass(at),Object.each(M,function(t){if(!et){var r=ut.find(t),n=v(r,ut,M[t],t);nt(n)?n.then(e.fill(t)).fail(function(e,r){b("Error building "+t+", "+e,r)}):et||e(t)}})}function g(e){var t,r,n;for(var i in M){if(et)return;if(t=M[i],n=ut.find(i),n.size()){t.listen&&(K[i]=n.eq(0));try{r=d(V,P,t,n),r==P&&e[i]!=P&&void 0!==r&&d(V,e[i],t,n)}catch(a){st.con("Transient fail linking "+i+" of form $('.my-form-"+_+"')",a.message,a.stack)}try{r!=P&&c(n,r),n.eq(0).trigger("check.my")}catch(a){b("Error linking "+i,a.message,a.stack)}}}ut.removeClass(at),ct=null,Z.resolve(V)}function b(e,r){var n;if(et=!0,t("Form "+O+" failed to initialize",e,r),ut.removeClass(at),n=rt(e,r),X(n)||Y(n)&&n.jquery?ut.html(n):n===!0&&ut.html(ct),E.silent)Z.resolve(V);else{if(!ut.my().ddata){if(ut.removeData("my"),ut.removeClass("my-form"),J)if("1"==J.data("count"))try{J.remove()}catch(i){}else J.data("count",J.data("count")-1);if(B)try{delete I[_],B.remove()}catch(i){}}Z.reject("Form "+O+" failed to initialize: "+e,r)}}var j,k,O,_,N,S,M,E,$,U,F,L,A,J,B,Q,W={},V={},G=[],K={},Z=e.Deferred(),et=!1,rt=function(){},at="my-form-init",lt="std",ct="";if(X(n)){if(j=it(n),!j)return Z.reject("No manifest with id "+n+" found in repo."),Z.promise();Y(a)&&Y(i)?(j=R(j,i),k=a):k=i,lt="repo"}else j=n,k=i;if(!j)return this;$=Y(k)&&"repo"!=lt?R(!0,{},j):j;var ut=this.eq(0),dt=ut.my();return Y(dt)&&dt.id&&dt.ui?(st.con("jQuery.my is already bind.",ut),ut.my("ui",$.ui),ut.my(H,$.data),Z.resolve(ut.my(H)).promise()):(E=$.params||{},E.strict||(E=R(!0,{},E),w(E)),E=R(!0,{},ot.params,E),Z.fail(function(){ut.removeClass(A+" "+L)}),R(ut,Z.promise()),Y(k)?(V=st.patch(k,$.data||{}),$.data=V):V=$.data||{},W.data=V,ut.data("my",{data:V,params:E,promise:Z.promise(),locktill:0}),ut.addClass(at),$.inherit&&l($),st.require($,E).then(function(){f(),h().then(function(){m(),p()})}).fail(function(e){f(),b("Linker of ‘require’ property failed.",e)}),Z.then(u),ut)},redraw:function(e,t){var r=this,n=r.my();return n&&n.ui&&(n.ui.each(function(t){var i=r.find(t);p(i,e?P:void 0,n.params.recalcDepth),e||(i.is(".my-form")&&i.my("redraw"),i.trigger(i.is(".my-form-list")?"redraw":"check.my"))}),!t&&e&&r.trigger(W)),r},data:function(e,t){var r=this;return Y(e)&&(r.my().data=st.overlap(r.my().data,e),this.my("redraw",t)),r.my().data},errors:function(){var t=e(this).my().errors,r={};for(var n in t)t[n]&&X(t[n])&&(r[n]=t[n]),Y(t[n])&&rt(t[n]).length&&(r[n]=t[n]);return r},valid:function(){var t=e(this).my().errors,r=0;for(var n in t)t[n]&&X(t[n])?r++:Y(t[n])&&rt(t[n]).length&&r++;return!r},reset:function(){try{st.kickoff(this.my().data,this.my().initial),this.my("redraw")}catch(e){return!1}return!0},id:function(e,t){if(X(e))return it(e,t);var r=this.my();return r&&r.id?r.id:P},remove:function(e){var t,r,n,i,a,o,s,l,c=this;if(!this.my())return P;if(this.my().root&&!this.my().ddata&&(c=this.my().root),n=c.my(),a=n.data,s=n.cid,l=n.mid,c.unbind(".my"),Y(n)&&n.manifest&&tt(n.manifest.die))try{n.manifest.die.call(n.manifest,c,n.manifest)}catch(d){}if(t=n.style)if("1"==t.data("count"))try{t.remove()}catch(d){}else t.data("count",t.data("count")-1);if(r=n.localStyle)try{delete I[s],r.remove()}catch(d){}if(window.URL&&(i=n.locFiles)&&i.length)for(var f=0;f<i.length;f++)try{URL.revokeObjectURL(i[f])}catch(d){}if(o=(n||{}).ui,o&&o.each(function(e){var t,r,n,i=c.find(e);if((r=i.data("modal"))&&(r.cancel(),i.removeData("modal")),r=i.data("modals"))for(n in r)r[n]&&r[n].cancel();i.unbind(".my");try{t=u(i,ot.destroy),tt(t)&&t(i)}catch(a){}i.removeData("formlist").removeData("myval").removeData("my")}),e&&c.is(".my-form"))c.remove();else if(c.data("formlist")&&c.is(".my-form")){var m=c.parents(".my-form-list").eq(0);c.remove(),m.trigger("check")}else c.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form");return c.removeClass("my-form-"+s+" my-manifest-"+l),a},undo:function(e){var t,r=this,n=r.my(),i=n.params.history,a=rt(i).sort(),o=1*(parseInt(e)||0);return!a.length||0>o?P:(n.params.errors&&n.params.errors.values().compact(!0).length?Object.equal(n.data,n.lastCorrect)||(o+=1):Object.equal(i[a.last()],n.data)&&(o+=1),t=y(o,n.params,!0),t&&(st.kickoff(r.my().data,t),r.my("redraw")),r.my().data)},ui:function(e){var t,r=this,n=r.my(),i=[];if(!n)return P;R(!0,{},n.ui);if(!Y(e))return n.ui;for(t in e)i.push(t);for(n.ui=C(st.overlap(n.ui,e)),t=0;t<i.length;t++)v(r.find(i[t]),r,n.ui[i[t]],i[t]);for(t in e)r.find(t).eq(0).trigger("check");return n.ui},disabled:function(e){var t,r,n,i,a=this,o=a.my();if(!o)return void 0;if(e==P)return o.disabled;if(e){for(r in o.ui)t=a.find(r).eq(0),n=t.my(),n&&(n.predisabled=n.disabled),h(!0,t,":disabled");a.addClass("my-disabled")}else{for(r in o.ui)t=a.find(r).eq(0),n=t.my(),i=!1,n&&n.predisabled&&(i=!0),h(i,t,":disabled");a.removeClass("my-disabled"),a.my("redraw")}},find:function(e){var t=this,r=t.my();return r&&r.root&&(t=r.root),t.find(e)},radio:function(e,t){this.trigger("radio",X(e)?{channel:e,message:t}:e)},manifest:function(e){return"json"==e?st.tojson(this.my().manifest):this.my().manifest},version:function(){return S},history:function(e,t){return y(e,this.my().params,t)},val:function(e){return c(this,e)},container:function(e){return u(e,ot.containers)(e)},promise:function(e){return tt(e)&&this.my().promise.then(e),this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var n,i,a=this.is(".my-form-list")?this:this.my().root||this,o=a.is(".my-form-list")?a:a.parent(".my-form-list"),s=(a.data("formlist")||{}).index,l=t;if(null==s&&(s=0),n=r(o.my().data,o.data("formlist").generator.bind),!Y(l))if(Y(o.data("formlist").generator.manifest))l=Object.clone(o.data("formlist").generator.manifest.data,!0)||{};else{if(o===a)throw"No data to insert, cannot guess when manifest is function.";l=Object.clone(a.my().manifest.data,!0)}if("before"===e)i=s;else if("after"===e)i=s+1;else{if(isNaN(e))throw"Invalid position for insert";i=(1*e).clamp(0,n.length)}n.add(l,i),o.trigger("redraw")}};e.my||(e.my={}),e.extend(e.my,{f:e.extend({},st),tojson:st.tojson,fromjson:st.fromjson,radio:function(t,r){s(e(document),X(t)?{channel:t,message:r}:t)},rules:ot,cache:function(e,t){return tt(e)?it=e:it(e,t)},version:function(){return S},ajax:function(e){return tt(e)?at=e:at.apply(this,Array.prototype.slice.call(arguments))}}),e.my.chain=function(){function e(){if(n.length&&i){var t,r=n.shift(),a=function(){e.delay(r[1])}.once();try{t=r[0]()}catch(o){a()}nt(t)?(t.then(a,a),a.delay(r[1])):a()}}var t=1,r=1e3,n=[],i=!1,a=function(i,a,o){n.push([i,a||t,o||r]),e()};return a.delay=function(e){return isNaN(e)||(t=(e-0).clamp(0,1e6)),t},a.timeout=function(e){return isNaN(e)||(r=(e-0).clamp(1,1e6)),r},a.start=function(){i=!0,e()},a.stop=function(){i=!1},a}(),e.fn.my=function(t){var r;if(void 0===t)return this.data("my");if(X(t)&&"{"==t.substr(0,1)){try{r=JSON.parse(t)}catch(n){}if(r)return lt.init.apply(this,[r].add(Array.prototype.slice.call(arguments,1)))}return X(t)&&lt[t]?lt[t].apply(this,Array.prototype.slice.call(arguments,1)):X(t)&&it(t,"exist")?lt.init.apply(this,arguments):typeof t!==A&&t?void e.error("Method "+t+" does not exist on jQuery.my"):lt.init.apply(this,arguments)},e(window).off(".my").on("radio.my",function(t,r){t.stopPropagation(),s(e(document),r)}).on("resize.my",function(){for(var e in I)try{I[e]()}catch(t){}}.debounce(100))}(jQuery),function(e){function t(e,t,r){if(l(t))return e+t;if(c(t))return r=i(!0,r,t),e;if(s(t)&&t.length>1&&l(t[1])){for(var n,u,f,m,h,p,y,v,g=t[0],b="",x=1;x<t.length;){if(l(t[x]))if(m=t[x].replace(/\s/g,""),f=m.split(/[\.#]/i),u=r.alias[f[0]]||f[0],n=m.substr(f[0].length),/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(m)){y=d.tmpl[u]||d.tmpl[""],p={style:"","class":"",txt:""},v="";var w=c(t[x+1]);if(w){x+=1;for(h in t[x])""!==d.attnames[h]&&(p[d.attnames[h]||h]=t[x][h])}p.style||p["class"]||!r.styles[u]||(p.style=r.styles[u]),p.id||"#"!=n.to(1)||(p.id=n.from(1).split(".")[0]),!p["class"]&&/\./.test(n)&&(p["class"]=("#"==n.to(1)?n.substr(p.id.length+1):n).split(".").compact(!0).join(" "));for(h in p)v+=h+'="'+p[h]+'" ';if(w)for(h in t[x])""===d.attnames[h]&&(p[h]=t[x][h]);p.ext=v,!p.txt&&d.txt[u]&&(p.txt=d.txt[u](p)),p._tag=u,b+=typeof y==o?y(p)||"":typeof y==a?y.assign(p):""}else b+=t[x];x+=1}return b&&(b="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&g?"padding-left:"+r.label+"; ":"")+'">'+(g?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+g+"</"+r.labelTag+">":"")+b+"</"+r.rowTag+">"),e+b}return e}function r(e){var t=e;if(l(t)&&(t=t.split(/[\s,]/).compact(!0)),s(t)){for(var r={},n=0;n<t.length;n++){var i=t[n];if(c(i)){var a=Object.keys(i);1==a.length?r[a[0]]=i[a[0]]+"":r[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else r[i]=i+""}t=r}return c(t)?t:{}}function n(r,n){var a={};return s(r)?(i(!0,a,d.params,n||{}),r.length?r.reduce(t.fill(void 0,void 0,a),""):""):c(r)?void e.extend(d,r):""}var i=e.extend,a="string",o="function",s=Object.isArray,l=(Object.isBoolean,Object.isString),c=Object.isObject,u=(Object.isNumber,Object.isRegExp,Object.isFunction,'<input type="'),d={tmpl:{num:u+'number" {ext}/>',inp:u+'text" {ext}/>',sli:u+'range" {ext}/>',dat:u+'date" {ext}/>',btn:u+'button" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!s(e.vals))return"";var t=i({style:"",css:""},e);return t.txt=e.vals.reduce(function(e,t){return e+"<span class=\"my-shortcut\" onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," "),'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(t)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=r(e.vals);return Object.keys(t).reduce(function(e,r){return e+'<option value="'+r+'">'+t[r]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}},f={init:function(t,r){return e(this).html(n(t,r))}};e.my||(e.my={}),e.my.formgen=n,e.fn.formgen=function(t){return l(t)&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.formgen"):f.init.apply(this,arguments)}}(jQuery),function(e){function t(t,r,n,i){var a,s,l,d,f,m,h;if("object"==typeof r&&r.jquery)r.is("img")&&(m=r,f=r.attr("alt")||r.attr("title")||r.data("text")||"",s=m[0].naturalWidth||m[0].width,a=m[0].naturalHeight||m[0].height,1>a&&(a=1),1>s&&(s=1),d=e(window).width()-90,l=e(window).height()-90,a>l&&(s=s*(l/a)|0,a=l),s>d&&(s=d,a=a*(d/s)|0),h=300>s?300:s,o(t,{source:"image",manifest:{init:function(e){e.html(this.HTML),e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+s+"px;max-height:"+a+'px"><h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:m.attr("src"),text:f},esc:!0,screen:!0,width:i||h,focus:!1,global:!0,z:"1995"},n));else if(u(r)&&r.manifest)o(t,r,n);else{if(!c(r))return null;o(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:r,ui:{"div:eq(0)":function(){}}},data:{},esc:!0,focus:!1,width:i},n)}return t}var r,n={},i="body",a=!1,o=e.extend,s={},l=(Object.isArray,Object.isBoolean),c=Object.isString,u=Object.isObject,d=Object.isNumber,f=(Object.isRegExp,Object.isFunction);e(document).keydown(function(e){var t,r,n=e.keyCode;if(!1!==a&&(13===n||27===n)){if(r=a.data("modal"),t=r.form,27==n&&(r.esc||Object.equal(t.data("my").initial,t.my("data"))))return a.modal(!0),!1;if(13==n&&r.enter)return function(e){e.modal()}.fill(a).delay(50),!1}}),n.modal=function(r,n,o){var s,c={},u=e(i),d=u.find(">.my-modal-proxy"),m={global:!0,screen:!0,done:f(n)?n:void 0,z:"1995"};return l(r)||null==r?d.modal(r):(s=e.Deferred(),t(c,r,m,o)?a?s.reject("Locked").promise():(d.size()||(d=e('<div class="my-modal-proxy"></div>').prependTo(u),d.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})),d.modal(c)):s.reject("Invalid data").promise())},n.modal.loading=function(t){e(i).find(">.my-modal").toggleClass("my-modal-loading",!!t)},n.modal.parent=function(t){return t&&e(t).size()?void(i=t):e(i)},n.modal.parentBack=function(t){return t&&e(t).size()?void(r=t):e(r||i)},n.modal.visible=function(){return!!a},e.my||(e.my={}),e.my.modal=n.modal,e.fn.modal=function(n,m,h){function p(){var t,r,n=window,i=!!M.global,a=w.offset(),o=D.offset();M.pos={px:a.left,py:a.top,pw:w.outerWidth(),ph:w.outerHeight(),ox:o.left,oy:o.top,ow:D.outerWidth(),oh:D.outerHeight(),ww:r,wh:t};var s=1*(M.x.match(/\-?\d+(\.\d+)?/)||[0])[0],l=1*(M.y.match(/\-?\d+(\.\d+)?/)||[0])[0],c=M.x.has("left")?-1:M.x.has("right")?1:0,u=M.y.has("top")?-1:M.y.has("bottom")?1:0,f=M.pos.ox+M.pos.ow/2-M.pos.px,m=M.pos.oy+M.pos.oh/2-M.pos.py;if(i&&(M.pos.wh=t=n.innerHeight||e(n).height(),M.pos.ww=r=n.innerWidth||e(n).width(),f=r/2,m=t/2.5),s=M.x.has("%")?M.pos.ow/100*s:s,l=M.y.has("%")?M.pos.oh/100*l:l,M.pos.pix=f,M.pos.piy=m,f=f+c*(M.pos.ow/2)+s*(c>0?-1:1)-(M.width+_)*(c+1)/2,i?(m=(t-M.height-20)/3,10>m&&(m=10)):m=m+u*(M.pos.oh/2)+l*(u>0?-1:1)-(M.height||0)*(u+1)/2,f=f.round(1),m=m.round(1),M.pos.vx=f,M.pos.vy=m,M.bound!==!1&&!M.global){var h=(d(M.bound)?M.bound:0).clamp(-100,100);M.pos.pw-2*h<M.width+_?M.pos.vx=-(M.width+_-M.pos.pw)/2:M.pos.vx+M.width+_>M.pos.pw-h?M.pos.vx=M.pos.pw-h-M.width-_:M.pos.vx<h&&(M.pos.vx=h),M.pos.ph-2*h<M.height?(M.pos.vy=h,M.height=M.pos.ph-2*h):M.pos.vy+M.height>M.pos.ph-h?M.pos.vy=M.pos.ph-h-M.height:M.pos.vy<h&&(M.pos.vy=h)}}function y(t){if(t||(M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p()),b.css({width:M.width+_+"px",display:"block"}),M.global)b.css({left:"50%","margin-left":"-"+((M.width+_)/2).round(0)+"px"});else if(b.css({left:M.pos.vx+"px"}),M.nose){e("style#my-modal-style-"+M.cid).size()||b.append('<style id="my-modal-style-'+M.cid+'"></style>');var r="",n=e("style#my-modal-style-"+M.cid);("top"==M.nose||"bottom"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {left:"+(M.pos.ox-M.pos.px+M.pos.ow/2-M.pos.vx)+"px!important;}",n.text(r)),("left"==M.nose||"right"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {top:"+(M.pos.oy-M.pos.py+M.pos.oh/2-M.pos.vy)+"px!important;}",n.text(r))}M.screen?M.global?(j.css({top:0,left:0,width:2*M.pos.ww+"px",height:2*M.pos.wh+"px",display:"block",position:"fixed","z-index":M.z-1}),c(M.screen)&&j.css({background:M.screen?M.screen:"rgba(30,65,100,0.8)"})):j.css({top:0,left:0,position:"absolute",width:M.pos.pw+"px",height:M.pos.ph+"px",display:"block",background:c(M.screen)?M.screen:"rgba(40,80,120,0.5)","z-index":M.z-1}):j.size()&&j.hide(),M.height>M.pos.wh?(b.height(M.pos.wh-30),x.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})):x.css({"overflow-y":"none"}),b.animate({top:M.pos.vy+"px",opacity:"1"},M.animate)}function v(){try{x.my("remove")}catch(t){}w.data("modals")[M.cid]=null,x.parent().unbind(".my").remove(),j.off(".my"+M.cid),M.screen&&function(e){e&&a||j.hide()}.delay(50,M.global),M.global&&(a=!1,e("body").css({overflow:"auto"}))}function g(e){try{S(null,null)}catch(t){}(function(){q.reject(e)}).delay(0)}var b,x,w,j,k,O,C,q=e.Deferred(),z={},D=this,_=0,N=0,S=f(m)?m:function(){return!1},T=u(n)?n:{},M=D.data("modal");if(o(D,q.promise()),M){if(null==n||l(n)){if(x=M.form,j=M.bg,w=M.root,S=M.done,O=x.my("data"),C=!1,n){try{S(null,null)}catch(E){}v(),D.removeData("modal"),s[M.cid]&&s[M.cid].reject("Cancelled"),delete s[M.cid],M=null}else{try{C=S(x.my("valid")?null:x.my("errors"),O)}catch(E){}C||(v(),D.removeData("modal"),function(){s[M.cid]&&s[M.cid].resolve(O),delete s[M.cid],M=null}.delay(0))}return D}if(T)return g("Locked"),D}return D.is(":visible")?(T=t(z,n,{}))?T.global&&a?(g("Locked"),D):(M=o({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:D,manifest:{},data:{},global:!1,screen:!1,drag:!1,focus:!0,close:!0,silent:!0,esc:!1,enter:!1,bound:!1,nose:"",width:h||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},T,{promise:q.promise(),cid:Number.random(268435456,4294967295).toString(16)}),M.done=f(M.done)?M.done:S,c(M.align)&&M.align&&(M.x=(M.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0],M.y=(M.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]),M.width=1*(e.my.f.getref(c(M.manifest)?e.my.cache(M.manifest):M.manifest,"params.width")||M.width),M.type="DOM",D.hasClass("my-form")?(M.type="form",M.root=M.root||D):D.data("my")?(M.type="control",M.root=M.root||D.my().root):(M.root=M.root||D.parents(".my-form").eq(0),M.root.size()||(M.root=e(i))),M.global?(M.root=e(i),M.bgroot=e(r||i)):M.bgroot=M.root,w=M.root,w.data("modals")||w.data("modals",{}),p(),b=e('<div class="my-modal my-modal-'+(M.global?"fullscreen ":"overlay ")+M.css+(M.nose?" nose-"+M.nose:"")+'"></div>').prependTo(M.root),b.addClass("my-modal-"+M.cid),_=b.outerWidth(),N=b.outerHeight(),b.hide(),b.html('<div class="my-modal-form"></div>'),x=b.find(".my-modal-form"),M.close&&(k=e(c(M.close)?M.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(b).on("click.my",function(){D.modal(!0)}),k.css({"z-index":("+"===(M.z+"").to(1)?"+":"")+(1*M.z+1)})),j=M.bgroot.find(">.my-modal-screen"),M.screen&&(j.size()||(j=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(M.root)),M.esc&&j.on("click.my"+M.cid,function(){D.modal(!0)})),D.data("modal",M),M.silent&&b.on("change.my",function(){return!1}),b.css({display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),b.css(M.global?{position:"fixed",left:"50%",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto","margin-left":"-"+((M.width+_)/2).round(0)+"px"}:{position:"absolute",left:M.pos.vx+"px",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),x.my(M.manifest,M.data).then(function(){var t,r,n,i,l;if(o(M,{form:x,bg:j,cancel:function(){D.modal(!0)},commit:function(){D.modal()}}),b.data("modal",M),M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p(),b.css({top:M.pos.vy+"px"}),y(!0),w.data("modals")[M.cid]=M,s[M.cid]=q,x.bind("commit.my",function(){return M.commit.delay(50),!1}).bind("cancel.my",function(){return M.cancel.delay(50),!1}),b.bind("layout.my",function(){y()}.debounce(50)),M.global&&(a=D,e("body").css({overflow:"hidden"})),M.global||!M.esc&&!M.enter||x.bind("keydown.my",function(t){var r=t.keyCode;return 27==r&&M.esc?(M.cancel(),!1):13==r&&M.enter&&!e(t.target).is("textarea")?(M.commit.delay(50),!1):void 0}),M.focus===!0){i=!1,l=M.manifest.ui;for(n in l)i||(r=x.find(n),r.size()&&r.is("input, textarea")&&(i=!0,r.focus()))}else c(M.focus)&&x.find(M.focus).focus();if(t=x.find("img").filter(function(){return""!=e(this).attr("src")}),t.size()){var u=function(){"manifest"!==M.source&&b.css({width:"auto"}),y()}.after(t.size());t.each(function(){e(this).bind("load",u)})}M.drag&&e.fn.draggable&&(c(M.drag)?b.draggable({handle:M.drag}):b.draggable()),q.notify("Ready")}).fail(function(e){v(),D.data("modal",null),q.reject(e)}),D):(g("Invalid data"),D):(g("Object must be visible"),D)}}(jQuery);
