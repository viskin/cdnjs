!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery"),require("d3")):"function"==typeof define&&define.amd?define(["jQuery","d3"],e):"object"==typeof exports?exports.geo=e(require("jQuery"),require("d3")):t.geo=e(t.jQuery,t.d3)}(this,function(t,e){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="dist/built",e(0)}([function(t,e,i){/**
	 * GeoJS
	 * @copyright 2013-2016, Kitware, Inc.
	 * @license Apache-2.0
	 *
	 * Bundled with the following libraries:
	 *
	 * vgl
	 * @copyright 2014-2016, Kitware, Inc.
	 * @license Apache-2.0
	 *
	 * Proj4js
	 * @copyright 2014, Mike Adair, Richard Greenwood, Didier Richard, Stephen Irons, Olivier Terral and Calvin Metcalf
	 * @license MIT
	 *
	 * gl-matrix
	 * @copyright 2015, Brandon Jones, Colin MacKenzie IV
	 * @license MIT
	 *
	 * pnltri
	 * @copyright 2014, Jurgen Ahting
	 * @license MIT
	 */
var r=i(1);i(2),t.exports=r.extend({camera:i(3),choroplethFeature:i(126),clock:i(133),contourFeature:i(134),domRenderer:i(135),event:i(125),feature:i(127),featureLayer:i(137),fetchQueue:i(138),fileReader:i(139),geomFeature:i(140),graphFeature:i(141),imageTile:i(142),jsonReader:i(144),layer:i(130),lineFeature:i(145),map:i(146),mapInteractor:i(217),object:i(5),osmLayer:i(219),pathFeature:i(222),planeFeature:i(223),pointFeature:i(225),polygonFeature:i(224),quadFeature:i(227),renderer:i(136),sceneObject:i(128),tile:i(143),tileCache:i(221),tileLayer:i(220),timestamp:i(129),transform:i(147),vectorFeature:i(228),inherit:i(4),version:i(229),util:i(120),d3:i(230),gl:i(242),canvas:i(255),gui:i(259)},i(131))},function(e,i){e.exports=t},function(t,e){if(!window.requestAnimationFrame){var i=[];window.performance||(window.performance={now:function(){return(new Date).getTime()}}),window.requestAnimationFrame=function(t){"use strict";if(!i.length){var e=window.performance.now();window.setTimeout(function(){var t=i;i=[];for(var e=window.performance.now(),r=0;r<t.length;r+=1)t[r].call(window,e)},15-parseInt(e,10)%15)}i.push(t)}}Math.log2||(Math.log2=function(){return Math.log.apply(Math,arguments)/Math.LN2}),Math.sinh=Math.sinh||function(t){var e=Math.exp(t);return(e-1/e)/2}},function(t,e,i){!function(){"use strict";var e=i(4),r=i(5),n=i(120),o=i(8),a=i(32),s=function(t){if(!(this instanceof s))return new s(t);var e=i(125);return t=t||{},r.call(this,t),this._view=n.mat4AsArray(),this._proj=n.mat4AsArray(),this._projection=null,this._transform=n.mat4AsArray(),this._inverse=n.mat4AsArray(),this._bounds=null,this._display=null,this._world=null,this._viewport={width:1,height:1},this._createProj=function(){var t=this.constructor.bounds.near/this.constructor.bounds.far;"perspective"===this._projection?o.frustum(this._proj,this.constructor.bounds.left*t,this.constructor.bounds.right*t,this.constructor.bounds.bottom*t,this.constructor.bounds.top*t,-this.constructor.bounds.near,-this.constructor.bounds.far):"parallel"===this._projection&&o.ortho(this._proj,this.constructor.bounds.left,this.constructor.bounds.right,this.constructor.bounds.bottom,this.constructor.bounds.top,this.constructor.bounds.near,this.constructor.bounds.far)},this._update=function(){this._bounds=null,this._display=null,this._world=null,this._transform=s.combine(this._proj,this._view),o.invert(this._inverse,this._transform),this.geoTrigger(e.camera.view,{camera:this})},Object.defineProperty(this,"view",{get:function(){return this._view},set:function(t){o.copy(this._view,t),this._update()}}),Object.defineProperty(this,"bounds",{get:function(){return null===this._bounds&&(this._bounds=this._getBounds()),this._bounds},set:function(t){this._setBounds(t),this._update()}}),Object.defineProperty(this,"display",{get:function(){var t;return null===this._display&&(t=s.affine({x:1,y:1},{x:this.viewport.width/2,y:this.viewport.height/-2}),this._display=s.combine(t,this._transform)),this._display}}),Object.defineProperty(this,"world",{get:function(){return null===this._world&&(this._world=o.invert(n.mat4AsArray(),this.display)),this._world}}),Object.defineProperty(this,"projection",{get:function(){return this._projection},set:function(t){if(!this.constructor.projection[t])throw new Error("Unsupported projection type: "+t);t!==this._projection&&(this._projection=t,this._createProj(),this._update(),this.geoTrigger(e.camera.projection,{camera:this,projection:t}))}}),Object.defineProperty(this,"projectionMatrix",{get:function(){return this._proj}}),Object.defineProperty(this,"transform",{get:function(){return this._transform}}),Object.defineProperty(this,"inverse",{get:function(){return this._inverse}}),Object.defineProperty(this,"viewport",{get:function(){return{width:this._viewport.width,height:this._viewport.height}},set:function(t){if(!(t.width>0&&t.height>0))throw new Error("Invalid viewport dimensions");(t.width!==this._viewport.width||t.height!==this._viewport.height)&&(this._viewport.width&&this._viewport.height&&(this._scale([this._viewport.width/t.width,this._viewport.height/t.height,1]),this._translate([(t.width-this._viewport.width)/2,(t.height-this._viewport.height)/2,0])),this._viewport={width:t.width,height:t.height},this._update(),this.geoTrigger(e.camera.viewport,{camera:this,viewport:this.viewport}))}}),this._resetView=function(){return o.identity(this._view),this},this._translate=function(t){o.translate(this._view,this._view,t)},this._scale=function(t){o.scale(this._view,this._view,t)},this._worldToClip4=function(t){return s.applyTransform(this._transform,t)},this._clipToWorld4=function(t){return s.applyTransform(this._inverse,t)},this.applyProjection=function(t){var e;return"perspective"===this._projection?(e=1/(t[3]||1),t[0]=e*t[0],t[1]=e*t[1],t[2]=e*t[2],t[3]=e):t[3]=1,t},this.unapplyProjection=function(t){var e;return"perspective"===this._projection?(e=t[3]||1,t[0]=e*t[0],t[1]=e*t[1],t[2]=e*t[2],t[3]=e):t[3]=1,t},this.worldToDisplay4=function(t){return t[2]-=2,this._worldToClip4(t),t=this.applyProjection(t),t[0]=this._viewport.width*(1+t[0])/2,t[1]=this._viewport.height*(1-t[1])/2,t[2]=(1+t[2])/2,t},this.displayToWorld4=function(t){return t[0]=2*t[0]/this._viewport.width-1,t[1]=-2*t[1]/this._viewport.height+1,t[2]=2*t[2]-1,t=this.unapplyProjection(t),this._clipToWorld4(t),t[2]+=2,t},this.worldToDisplay=function(t){var e=0,i=1;return t=this.worldToDisplay4([t.x,t.y,e,i]),{x:t[0],y:t[1],z:t[2]}},this.displayToWorld=function(t){var e=1,i=2;return t=this.displayToWorld4([t.x,t.y,e,i]),{x:t[0],y:t[1]}},this._getBounds=function(){var t,e,i,r,n={};return t=this.displayToWorld({x:0,y:0}),e=this.displayToWorld({x:this._viewport.width,y:0}),i=this.displayToWorld({x:0,y:this._viewport.height}),r=this.displayToWorld({x:this._viewport.width,y:this._viewport.height}),n.left=Math.min(t.x,e.x,i.x,r.x),n.bottom=Math.min(t.y,e.y,i.y,r.y),n.right=Math.max(t.x,e.x,i.x,r.x),n.top=Math.max(t.y,e.y,i.y,r.y),n},this._setBounds=function(t){var e={width:t.right-t.left,height:t.top-t.bottom},i={x:(t.left+t.right)/2,y:(t.bottom+t.top)/2};return this._viewFromCenterSizeRotation(i,e,0),this},this._viewFromCenterSizeRotation=function(t,e,i){var r,o,a,s,u=n.vec3AsArray(),h=n.vec3AsArray();return this._resetView(),a=Math.abs(e.width),s=Math.abs(e.height),r=a/s,o=this._viewport.width/this._viewport.height,r>=o?(s=a/o,h[0]=2/a,h[1]=2/s):(a=s*o,h[0]=2/a,h[1]=2/s),h[2]=1,this._scale(h),i&&this._rotate(i),u[0]=-t.x,u[1]=-t.y,u[2]=0,this._translate(u),this},this.viewFromCenterSizeRotation=function(t,e,i){return this._viewFromCenterSizeRotation(t,e,i),this._update(),this},this.pan=function(t){(t.x||t.y||t.z)&&(this._translate([t.x,t.y,t.z||0]),this._update())},this.zoom=function(t){1!==t&&(o.scale(this._view,this._view,[t,t,t]),this._update())},this._rotate=function(t,e,i){if(t){i=i||[0,0,-1],e?void 0!==e.x&&(e=[e.x||0,e.y||0,e.z||0]):e=[0,0,0];var r=[-e[0],-e[1],-e[2]];o.translate(this._view,this._view,e),o.rotate(this._view,this._view,t,i),o.translate(this._view,this._view,r)}},this.css=function(t){var e;switch((t||"").toLowerCase()){case"display":case"":e=this.display;break;case"world":e=this.world;break;default:throw new Error("Unknown transform "+t)}return s.css(e)},this.ppMatrix=function(t,e){function i(t){var i=r[t],n=i.toExponential(e);return i>=0&&(n=" "+n),n}var r=t;return e=e||2,[[i(0),i(4),i(8),i(12)].join(" "),[i(1),i(5),i(9),i(13)].join(" "),[i(2),i(6),i(10),i(14)].join(" "),[i(3),i(7),i(11),i(15)].join(" ")].join("\n")},this.toString=function(){return this.ppMatrix(this._transform)},this.debug=function(){return["bounds",JSON.stringify(this.bounds),"view:",this.ppMatrix(this._view),"projection:",this.ppMatrix(this._proj),"transform:",this.ppMatrix(this._transform)].join("\n")},this.valueOf=function(){return this._transform},this._resetView(),this.projection=t.projection||"parallel",t.viewport&&(this.viewport=t.viewport),this._update(),this};s.projection={perspective:!0,parallel:!0},s.bounds={left:-1,right:1,top:1,bottom:-1,far:-2,near:-1},s.css=function(t){return"matrix3d("+[t[0].toFixed(20),t[1].toFixed(20),t[2].toFixed(20),t[3].toFixed(20),t[4].toFixed(20),t[5].toFixed(20),t[6].toFixed(20),t[7].toFixed(20),t[8].toFixed(20),t[9].toFixed(20),t[10].toFixed(20),t[11].toFixed(20),t[12].toFixed(20),t[13].toFixed(20),t[14].toFixed(20),t[15].toFixed(20)].join(",")+")"},s.affine=function(t,e,i){var r=n.mat4AsArray();return i&&o.translate(r,r,[i.x||0,i.y||0,i.z||0]),e&&o.scale(r,r,[e.x||1,e.y||1,e.z||1]),t&&o.translate(r,r,[t.x||0,t.y||0,t.z||0]),r},s.applyTransform=function(t,e){return a.transformMat4(e,e,t)},s.combine=function(t,e){return o.multiply(n.mat4AsArray(),t,e)},e(s,r),t.exports=s}()},function(t,e){function i(){return function(){}}t.exports=function(t,e){var r=i();r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,i){var r=i(6),n=i(4),o=function(){"use strict";if(!(this instanceof o))return new o;var t=this,e={},i=[],n=0;return this.onIdle=function(e){return n?i.push(e):e(),t},this.addPromise=function(e){function r(){n-=1,n||i.splice(0,i.length).forEach(function(t){t()})}return n+=1,e.then(r,r),t},this.geoOn=function(i,r){return Array.isArray(i)?(i.forEach(function(e){t.geoOn(e,r)}),t):(e.hasOwnProperty(i)||(e[i]=[]),e[i].push(r),t)},this.geoTrigger=function(i,r){return Array.isArray(i)?(i.forEach(function(e){t.geoTrigger(e,r)}),t):(r=r||{},r.event=i,e.hasOwnProperty(i)&&e[i].forEach(function(e){e.call(t,r)}),t)},this.geoOff=function(r,o){if(void 0===r&&(e={},i=[],n=0),Array.isArray(r))return r.forEach(function(e){t.geoOff(e,o)}),t;if(o){if(Array.isArray(o))return o.forEach(function(e){t.geoOff(r,e)}),t}else e[r]=[];return e.hasOwnProperty(r)&&(e[r]=e[r].filter(function(t){return t!==o})),t},this._exit=function(){t.geoOff()},r.object.call(this),this};n(o,r.object),t.exports=o},function(t,e,i){(function(e){t.exports=e.vgl=i(7)}).call(e,function(){return this}())},function(t,e,i){var r,n,o=i(8),a=i(32),s=i(58),u=i(91),h=i(1);!function(i,o){r=[],n=function(){return i.vgl=o()}.apply(e,r),!(void 0!==n&&(t.exports=n))}(this,function(){function t(t,e){"use strict";var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.uber=e.prototype,t.prototype.constructor=t}if("undefined"==typeof e)var e={};e.namespace=function(t){"use strict";var i,r=t.split("."),n=e;for("ogs"===r[0]&&(r=r.slice(1)),i=0;i<r.length;i+=1)"undefined"==typeof n[r[i]]&&(n[r[i]]={}),n=n[r[i]];return n};var i=e.namespace("gl");Object.size=function(t){"use strict";var e=0,i=null;for(i in t)t.hasOwnProperty(i)&&(e+=1);return e},i.GL={ACTIVE_ATTRIBUTES:35721,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB565:36194,RGB5_A1:32855,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0};var r=0;i.timestamp=function(){"use strict";if(!(this instanceof i.timestamp))return new i.timestamp;var t=0;this.modified=function(){r+=1,t=r},this.getMTime=function(){return t}},i.object=function(){"use strict";if(!(this instanceof i.object))return new i.object;var t=i.timestamp();return t.modified(),this.modified=function(){t.modified()},this.getMTime=function(){return t.getMTime()},this},i.event=function(){"use strict";return this instanceof i.event?(i.object.call(this),this):new i.event},t(i.event,i.object),i.event.keyPress="vgl.event.keyPress",i.event.mousePress="vgl.event.mousePress",i.event.mouseRelease="vgl.event.mouseRelease",i.event.contextMenu="vgl.event.contextMenu",i.event.configure="vgl.event.configure",i.event.enable="vgl.event.enable",i.event.mouseWheel="vgl.event.mouseWheel",i.event.keyRelease="vgl.event.keyRelease",i.event.middleButtonPress="vgl.event.middleButtonPress",i.event.startInteraction="vgl.event.startInteraction",i.event.enter="vgl.event.enter",i.event.rightButtonPress="vgl.event.rightButtonPress",i.event.middleButtonRelease="vgl.event.middleButtonRelease",i.event["char"]="vgl.event.char",i.event.disable="vgl.event.disable",i.event.endInteraction="vgl.event.endInteraction",i.event.mouseMove="vgl.event.mouseMove",i.event.mouseOut="vgl.event.mouseOut",i.event.expose="vgl.event.expose",i.event.timer="vgl.event.timer",i.event.leftButtonPress="vgl.event.leftButtonPress",i.event.leave="vgl.event.leave",i.event.rightButtonRelease="vgl.event.rightButtonRelease",i.event.leftButtonRelease="vgl.event.leftButtonRelease",i.event.click="vgl.event.click",i.event.dblClick="vgl.event.dblClick",i.boundingObject=function(){"use strict";if(!(this instanceof i.boundingObject))return new i.boundingObject;i.object.call(this);var t=[0,0,0,0,0,0],e=i.timestamp(),r=i.timestamp();return e.modified(),r.modified(),this.bounds=function(){return t},this.hasValidBounds=function(t){return t[0]===Number.MAX_VALUE||t[1]===-Number.MAX_VALUE||t[2]===Number.MAX_VALUE||t[3]===-Number.MAX_VALUE||t[4]===Number.MAX_VALUE||t[5]===-Number.MAX_VALUE?!1:!0},this.setBounds=function(i,r,n,o,a,s){return this.hasValidBounds([i,r,n,o,a,s])?(t[0]=i,t[1]=r,t[2]=n,t[3]=o,t[4]=a,t[5]=s,this.modified(),e.modified(),!0):void 0},this.resetBounds=function(){t[0]=Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=Number.MAX_VALUE,t[3]=-Number.MAX_VALUE,t[4]=Number.MAX_VALUE,t[5]=-Number.MAX_VALUE,this.modified()},this.computeBounds=function(){},this.computeBoundsTimestamp=function(){return e},this.boundsDirtyTimestamp=function(){return r},this.resetBounds(),this},i.boundingObject.ReferenceFrame={Relative:0,Absolute:1},t(i.boundingObject,i.object),i.node=function(){"use strict";if(!(this instanceof i.node))return new i.node;i.boundingObject.call(this);var t=null,e=null,r=!0,n=!1;return this.accept=function(t){t.visit(this)},this.material=function(){return e},this.setMaterial=function(t){return t!==e?(e=t,this.modified(),!0):!1},this.visible=function(){return r},this.setVisible=function(t){return t!==r?(r=t,this.modified(),!0):!1},this.parent=function(){return t},this.setParent=function(e){return e!==t?(null!==t&&t.removeChild(this),t=e,this.modified(),!0):!1},this.overlay=function(){return n},this.setOverlay=function(t){return n!==t?(n=t,this.modified(),!0):!1},this.ascend=function(t){t=t},this.traverse=function(t){t=t},this.boundsModified=function(){this.boundsDirtyTimestamp().modified(),null!==t&&t.boundsModified()},this},t(i.node,i.boundingObject),i.groupNode=function(){"use strict";if(!(this instanceof i.groupNode))return new i.groupNode;i.node.call(this);var t=[];return this.b_setVisible=this.setVisible,this.setVisible=function(e){var i;if(this.b_setVisible(e)!==!0)return!1;for(i=0;i<t.length;i+=1)t[i].setVisible(e);return!0},this.addChild=function(e){return e instanceof i.node&&-1===t.indexOf(e)?(e.setParent(this),t.push(e),this.boundsDirtyTimestamp().modified(),!0):!1},this.removeChild=function(e){if(e.parent()===this){var i=t.indexOf(e);return t.splice(i,1),this.boundsDirtyTimestamp().modified(),!0}},this.removeChildren=function(){var e;for(e=0;e<t.length;e+=1)this.removeChild(t[e]);this.modified()},this.children=function(){return t},this.hasChild=function(e){var i=0,r=!1;for(i=0;i<t.length;i+=1)if(t[i]===e){r=!0;break}return r},this.accept=function(t){t.visit(this)},this.traverse=function(t){switch(t.type()){case t.UpdateVisitor:this.traverseChildrenAndUpdateBounds(t);break;case t.CullVisitor:this.traverseChildren(t)}},this.traverseChildrenAndUpdateBounds=function(e){var i;if(this.m_parent&&this.boundsDirtyTimestamp().getMTime()>this.computeBoundsTimestamp().getMTime()&&this.m_parent.boundsDirtyTimestamp.modified(),this.computeBounds(),e.mode()===e.TraverseAllChildren)for(i=0;i<t.length();i+=1)t[i].accept(e),this.updateBounds(t[i]);this.computeBoundsTimestamp().modified()},this.traverseChildren=function(e){var r;if(e.mode()===i.vesVisitor.TraverseAllChildren)for(r=0;r<t.length();r+=1)t[r].accept(e)},this.computeBounds=function(){var e=0;if(!(this.computeBoundsTimestamp().getMTime()>this.boundsDirtyTimestamp().getMTime()))for(e=0;e<t.length;e+=1)this.updateBounds(t[e])},this.updateBounds=function(t){if(!t.overlay()){t.computeBounds();var e,i=this.bounds(),r=t.bounds(),n=0,o=0;for(e=0;3>e;e+=1)n=2*e,o=2*e+1,r[n]<i[n]&&(i[n]=r[n]),r[o]>i[o]&&(i[o]=r[o]);this.setBounds(i[0],i[1],i[2],i[3],i[4],i[5])}},this},t(i.groupNode,i.node),i.actor=function(){"use strict";if(!(this instanceof i.actor))return new i.actor;i.node.call(this);var t=this,e=o.create(),r=i.boundingObject.ReferenceFrame.Relative,n=null;return this.matrix=function(){return e},this.setMatrix=function(i){i!==e&&(e=i,t.modified())},this.referenceFrame=function(){return r},this.setReferenceFrame=function(e){return e!==r?(r=e,t.modified(),!0):!1},this.mapper=function(){return n},this.setMapper=function(e){e!==n&&(n=e,t.boundsModified())},this.accept=function(t){t=t},this.ascend=function(t){t=t},this.computeLocalToWorldMatrix=function(t,e){t=t,e=e},this.computeWorldToLocalMatrix=function(t,e){t=t,e=e},this.computeBounds=function(){if(null===n||void 0===n)return void t.resetBounds();var i,r,o,a,u=t.computeBoundsTimestamp();(t.boundsDirtyTimestamp().getMTime()>u.getMTime()||n.boundsDirtyTimestamp().getMTime()>u.getMTime())&&(n.computeBounds(),i=n.bounds(),r=[i[0],i[2],i[4]],o=[i[1],i[3],i[5]],s.transformMat4(r,r,e),s.transformMat4(o,o,e),a=[r[0]>o[0]?o[0]:r[0],r[0]>o[0]?r[0]:o[0],r[1]>o[1]?o[1]:r[1],r[1]>o[1]?r[1]:o[1],r[2]>o[2]?o[2]:r[2],r[2]>o[2]?r[2]:o[2]],t.setBounds(a[0],a[1],a[2],a[3],a[4],a[5]),u.modified())},t},t(i.actor,i.node),i.freezeObject=function(t){"use strict";var e=Object.freeze(t);return"undefined"==typeof e&&(e=function(t){return t}),e},i.defaultValue=function(t,e){"use strict";return"undefined"!=typeof t?t:e},i.defaultValue.EMPTY_OBJECT=i.freezeObject({}),i.graphicsObject=function(t){"use strict";if(t=t,!(this instanceof i.graphicsObject))return new i.graphicsObject;i.object.call(this);var e=this;return this._setup=function(t){return t=t,!1},this._cleanup=function(t){return t=t,!1},this.bind=function(t){return t=t,!1},this.undoBind=function(t){return t=t,!1},this.render=function(t){return t=t,!1},this.remove=function(t){e._cleanup(t)},e},t(i.graphicsObject,i.object),i.geojsonReader=function(){"use strict";return this instanceof i.geojsonReader?(this.readScalars=function(t,e,r,n){var o=null,a=null,s=null,u=null,h=null;"values"===this.m_scalarFormat&&4===t.length?(a=t[3],o=e.sourceData(i.vertexAttributeKeys.Scalar),o||(o=new i.sourceDataSf,this.m_scalarRange&&o.setScalarRange(this.m_scalarRange[0],this.m_scalarRange[1]),void 0!==r&&(o.data().length=r),e.addSource(o)),void 0===r?o.pushBack(a):o.insertAt(n,a)):"rgb"===this.m_scalarFormat&&6===t.length&&(o=e.sourceData(i.vertexAttributeKeys.Color),o||(o=new i.sourceDataC3fv,void 0!==r&&(o.length=3*r),e.addSource(o)),s=t[3],u=t[4],h=t[5],void 0===r?o.pushBack([s,u,h]):o.insertAt(n,[s,u,h]))},this.readPoint=function(t){var e=new i.geometryData,r=new i.points,n=new i.sourceDataP3fv,o=new Uint16Array(1),a=null,s=null,u=null,h=null;for(e.addSource(n),h=0;1>h;h+=1)o[h]=h,a=t[0],s=t[1],u=0,t.length>2&&(u=t[2]),n.pushBack([a,s,u]),this.readScalars(t,e);return r.setIndices(o),e.addPrimitive(r),e.setName("aPoint"),e},this.readMultiPoint=function(t){var e,r=new i.geometryData,n=new i.points,o=new i.sourceDataP3fv,a=new Uint16Array(t.length),s=0,u=t.length,h=null,l=null,c=null;for(o.data().length=3*u,e=0;e<t.length;e+=1)a[e]=e,h=t[e][0],l=t[e][1],c=0,t[e].length>2&&(c=t[e][2]),o.insertAt(s,[h,l,c]),this.readScalars(t[e],r,u,s),s+=1;return n.setIndices(a),r.addPrimitive(n),r.addSource(o),r.setName("manyPoints"),r},this.readLineString=function(t){var e=new i.geometryData,r=new i.lineStrip,n=new i.sourceDataP3fv,o=[],a=null,s=null,u=null,h=null;for(r.setIndicesPerPrimitive(t.length),a=0;a<t.length;a+=1)o.push(a),s=t[a][0],u=t[a][1],h=0,t[a].length>2&&(h=t[a][2]),n.pushBack([s,u,h]),this.readScalars(t[a],e);return r.setIndices(o),e.addPrimitive(r),e.addSource(n),e.setName("aLineString"),e},this.readMultiLineString=function(t){var e=new i.geometryData,r=new i.sourceDataP3fv,n=0,o=2*t.length,a=null,s=null,u=null,h=null,l=null,c=null,d=null,f=null;for(r.data().length=3*o,s=0;s<t.length;s+=1){for(c=[],d=new i.lineStrip,f=t[s].length,d.setIndicesPerPrimitive(f),a=0;f>a;a+=1)c.push(n),u=t[s][a][0],h=t[s][a][1],l=0,t[s][a].length>2&&(l=t[s][a][2]),r.insertAt(n,[u,h,l]),this.readScalars(t[s][a],e,2*o,n),n+=1;d.setIndices(c),e.addPrimitive(d)}return e.setName("aMultiLineString"),e.addSource(r),e},this.readPolygon=function(t){var e=new i.geometryData,r=new i.sourceDataP3fv,n=null,o=null,a=null,s=t[0].length,u=1,h=null,l=null,c=null;for(h=0;s>h;h+=1)n=t[0][h][0],o=t[0][h][1],a=0,t[0][h].length>2&&(a=t[0][h][2]),r.pushBack([n,o,a]),this.readScalars(t[0][h],e),h>1&&(l=new Uint16Array([0,u,h]),c=new i.triangles,c.setIndices(l),e.addPrimitive(c),u=h);return e.setName("POLY"),e.addSource(r),e},this.readMultiPolygon=function(t){var e=new i.geometryData,r=new i.sourceDataP3fv,n=0,o=t.length,a=0,s=3*o,u=new i.triangles,h=[],l=null,c=null,d=null,f=null,m=null,p=null,v=null,g=null,y=null,x=!1,_=0;for(r.data().length=3*o,c=0;o>c;c+=1)for(p=t[c][0].length,v=n,g=n+1,y=[!1,!1,!1],l=0;p>l;l+=1)d=t[c][0][l][0],f=t[c][0][l][1],m=0,t[c][0][l].length>2&&(m=t[c][0][l][2]),x=!1,d>180&&(x=!0,d-=360),0===l?y[0]=x:y[1+(l-1)%2]=x,r.insertAt(a,[d,f,m]),this.readScalars(t[c][0][l],e,s,a),a+=1,l>1&&(y[0]===y[1]&&y[1]===y[2]&&(h[3*_+0]=v,h[3*_+1]=g,h[3*_+2]=n,_+=1),g=n),n+=1;return u.setIndices(h),e.addPrimitive(u),e.setName("aMultiPoly"),e.addSource(r),e},this.readGJObjectInt=function(t){if(!t.hasOwnProperty("type"))return null;t.properties&&t.properties.ScalarFormat&&"values"===t.properties.ScalarFormat&&(this.m_scalarFormat="values",t.properties.ScalarRange&&(this.m_scalarRange=t.properties.ScalarRange)),t.properties&&t.properties.ScalarFormat&&"rgb"===t.properties.ScalarFormat&&(this.m_scalarFormat="rgb");var e,i=t.type,r=null,n=null,o=null;switch(i){case"Point":e=this.readPoint(t.coordinates);break;case"MultiPoint":e=this.readMultiPoint(t.coordinates);break;case"LineString":e=this.readLineString(t.coordinates);break;case"MultiLineString":e=this.readMultiLineString(t.coordinates);break;case"Polygon":e=this.readPolygon(t.coordinates);break;case"MultiPolygon":e=this.readMultiPolygon(t.coordinates);break;case"GeometryCollection":for(n=[],o=0;o<t.geometries.length;o+=1)r=this.readGJObject(t.geometries[o]),n.push(r);e=n;break;case"Feature":r=this.readGJObject(t.geometry),e=r;break;case"FeatureCollection":for(n=[],o=0;o<t.features.length;o+=1)r=this.readGJObject(t.features[o]),n.push(r);e=n;break;default:console.log("Don't understand type "+i),e=null}return e},this.readGJObject=function(t){var e;return e=this.readGJObjectInt(t)},this.linearizeGeoms=function(t,e){var i=null;if("[object Array]"===Object.prototype.toString.call(e))for(i=0;i<e.length;i+=1)this.linearizeGeoms(t,e[i]);else t.push(e)},this.readGeomObject=function(t){var e,i=[];return e=this.readGJObject(t),this.linearizeGeoms(i,e),i},this.getPrimitives=function(t){if(!t)return[];var e=JSON.parse(t),i=this.readGJObject(e),r=[];return this.m_scalarFormat="none",this.m_scalarRange=null,this.linearizeGeoms(r,i),{geoms:r,scalarFormat:this.m_scalarFormat,scalarRange:this.m_scalarRange}},this):new i.geojsonReader},i.data=function(){"use strict";return this instanceof i.data?void(this.type=function(){}):new i.data},i.data.raster=0,i.data.point=1,i.data.lineString=2,i.data.polygon=3,i.data.geometry=10,i.primitive=function(){"use strict";if(!(this instanceof i.primitive))return new i.primitive;var t=0,e=0,r=0,n=null;return this.indices=function(){return n},this.createIndices=function(t){t=t,n=new Uint16Array},this.numberOfIndices=function(){return n.length},this.sizeInBytes=function(){return n.length*Uint16Array.BYTES_PER_ELEMENT},this.primitiveType=function(){return e},this.setPrimitiveType=function(t){e=t},this.indicesPerPrimitive=function(){return t},this.setIndicesPerPrimitive=function(e){t=e},this.indicesValueType=function(){return r},this.setIndicesValueType=function(t){r=t},this.setIndices=function(t){n=new Uint16Array(t)},this},i.triangleStrip=function(){"use strict";return this instanceof i.triangleStrip?(i.primitive.call(this),this.setPrimitiveType(i.GL.TRIANGLE_STRIP),this.setIndicesValueType(i.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(3),this):new i.triangleStrip},t(i.triangleStrip,i.primitive),i.triangles=function(){"use strict";return this instanceof i.triangles?(i.primitive.call(this),this.setPrimitiveType(i.GL.TRIANGLES),this.setIndicesValueType(i.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(3),this):new i.triangles},t(i.triangles,i.primitive),i.lines=function(){"use strict";return this instanceof i.lines?(i.primitive.call(this),this.setPrimitiveType(i.GL.LINES),this.setIndicesValueType(i.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(2),this):new i.lines},t(i.lines,i.primitive),i.lineStrip=function(){"use strict";return this instanceof i.lineStrip?(i.primitive.call(this),this.setPrimitiveType(i.GL.LINE_STRIP),this.setIndicesValueType(i.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(2),this):new i.lineStrip},t(i.lineStrip,i.primitive),i.points=function(){"use strict";return this instanceof i.points?(i.primitive.call(this),this.setPrimitiveType(i.GL.POINTS),this.setIndicesValueType(i.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(1),this):new i.points},t(i.points,i.primitive),i.vertexDataP3f=function(){"use strict";return this instanceof i.vertexDataP3f?(this.m_position=[],this):new i.vertexDataP3f},i.vertexDataP3N3f=function(){"use strict";return this instanceof i.vertexDataP3N3f?(this.m_position=[],this.m_normal=[],this):new i.vertexDataP3N3f},i.vertexDataP3T3f=function(){"use strict";return this instanceof i.vertexDataP3T3f?(this.m_position=[],this.m_texCoordinate=[],this):new i.vertexDataP3T3f},i.sourceData=function(t){"use strict";if(!(this instanceof i.sourceData))return new i.sourceData(t);t=t||{};var e={},r=[],n=t.name||"Source "+(new Date).toISOString(),o=function(){this.m_numberOfComponents=0,this.m_dataType=0,this.m_dataTypeSize=0,this.m_normalized=!1,this.m_stride=0,this.m_offset=0};return this.data=function(){return r},this.getData=function(){
return this.data()},this.dataToFloat32Array=function(){return r instanceof Float32Array||(r=new Float32Array(r)),r},this.setData=function(t){return t instanceof Array||t instanceof Float32Array?void(r=t instanceof Float32Array?t:t.slice(0)):void console.log("[error] Requires array")},this.addAttribute=function(t,i,r,n,a,s,u){if(!e.hasOwnProperty(t)){var h=new o;h.m_dataType=i,h.m_dataTypeSize=r,h.m_offset=n,h.m_stride=a,h.m_numberOfComponents=s,h.m_normalized=u,e[t]=h}},this.sizeOfArray=function(){return Object.size(r)},this.lengthOfArray=function(){return r.length},this.sizeInBytes=function(){var t,e=0,i=this.keys();for(t=0;t<i.length();t+=1)e+=this.numberOfComponents(i[t])*this.sizeOfAttributeDataType(i[t]);return e*=this.sizeOfArray()},this.hasKey=function(t){return e.hasOwnProperty(t)},this.keys=function(){return Object.keys(e)},this.numberOfAttributes=function(){return Object.size(e)},this.attributeNumberOfComponents=function(t){return e.hasOwnProperty(t)?e[t].m_numberOfComponents:0},this.normalized=function(t){return e.hasOwnProperty(t)?e[t].m_normalized:!1},this.sizeOfAttributeDataType=function(t){return e.hasOwnProperty(t)?e[t].m_dataTypeSize:0},this.attributeDataType=function(t){return e.hasOwnProperty(t)?e[t].m_dataType:void 0},this.attributeOffset=function(t){return e.hasOwnProperty(t)?e[t].m_offset:0},this.attributeStride=function(t){return e.hasOwnProperty(t)?e[t].m_stride:0},this.pushBack=function(t){t=t},this.insert=function(t){var e;if(!r.length&&t.length&&t instanceof Float32Array)return void(r=t);if(r.slice||!r.length&&t.slice||(r=Array.prototype.slice.call(r)),t.length)if(!r.length&&t.slice)r=t.slice(0);else for(e=0;e<t.length;e+=1)r[r.length]=t[e];else r[r.length]=t},this.insertAt=function(t,e){var i;if(e.length)for(i=0;i<e.length;i+=1)r[t*e.length+i]=e[i];else r[t]=e},this.name=function(){return n},this.setName=function(t){n=t},this},i.sourceDataAnyfv=function(t,e,r){"use strict";return this instanceof i.sourceDataAnyfv?(i.sourceData.call(this,r),this.addAttribute(e,i.GL.FLOAT,4,0,4*t,t,!1),this.pushBack=function(t){this.insert(t)},this):new i.sourceDataAnyfv(t,e,r)},t(i.sourceDataAnyfv,i.sourceData),i.sourceDataP3T3f=function(t){"use strict";return this instanceof i.sourceDataP3T3f?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Position,i.GL.FLOAT,4,0,24,3,!1),this.addAttribute(i.vertexAttributeKeys.TextureCoordinate,i.GL.FLOAT,4,12,24,3,!1),this.pushBack=function(t){this.insert(t.m_position),this.insert(t.m_texCoordinate)},this):new i.sourceDataP3T3f(t)},t(i.sourceDataP3T3f,i.sourceData),i.sourceDataP3N3f=function(t){"use strict";return this instanceof i.sourceDataP3N3f?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Position,i.GL.FLOAT,4,0,24,3,!1),this.addAttribute(i.vertexAttributeKeys.Normal,i.GL.FLOAT,4,12,24,3,!1),this.pushBack=function(t){this.insert(t.m_position),this.insert(t.m_normal)},this):new i.sourceDataP3N3f(t)},t(i.sourceDataP3N3f,i.sourceData),i.sourceDataP3fv=function(t){"use strict";return this instanceof i.sourceDataP3fv?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Position,i.GL.FLOAT,4,0,12,3,!1),this.pushBack=function(t){this.insert(t)},this):new i.sourceDataP3fv(t)},t(i.sourceDataP3fv,i.sourceData),i.sourceDataT2fv=function(t){"use strict";return this instanceof i.sourceDataT2fv?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.TextureCoordinate,i.GL.FLOAT,4,0,8,2,!1),this.pushBack=function(t){this.insert(t)},this):new i.sourceDataT2fv(t)},t(i.sourceDataT2fv,i.sourceData),i.sourceDataC3fv=function(t){"use strict";return this instanceof i.sourceDataC3fv?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Color,i.GL.FLOAT,4,0,12,3,!1),this.pushBack=function(t){this.insert(t)},this):new i.sourceDataC3fv(t)},t(i.sourceDataC3fv,i.sourceData),i.sourceDataSf=function(t){"use strict";if(!(this instanceof i.sourceDataSf))return new i.sourceDataSf(t);var e=null,r=null,n=null,o=null;return i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Scalar,i.GL.FLOAT,4,0,4,1,!1),this.pushBack=function(t){(null===r||t>r)&&(r=t),(null===e||e>t)&&(e=t),this.data()[this.data().length]=t},this.insertAt=function(t,i){(null===r||i>r)&&(r=i),(null===e||e>i)&&(e=i),this.data()[t]=i},this.scalarRange=function(){return null===n||null===o?[e,r]:[n,o]},this.setScalarRange=function(t,e){n=t,o=e},this},t(i.sourceDataSf,i.sourceData),i.sourceDataDf=function(t){"use strict";return this instanceof i.sourceDataDf?(i.sourceData.call(this,t),this.addAttribute(i.vertexAttributeKeys.Scalar,i.GL.FLOAT,4,0,4,1,!1),this.pushBack=function(t){this.data()[this.data().length]=t},this.insertAt=function(t,e){this.data()[t]=e},this):new i.sourceDataDf(t)},t(i.sourceDataDf,i.sourceData),i.geometryData=function(){"use strict";if(!(this instanceof i.geometryData))return new i.geometryData;i.data.call(this);var t="",e=[],r=[],n=[0,0,0,0,0,0],o=i.timestamp(),a=i.timestamp();return this.type=function(){return i.data.geometry},this.name=function(){return t},this.setName=function(e){t=e},this.addSource=function(t,e){return void 0!==e&&t.setName(e),-1===r.indexOf(t)?(r.push(t),t.hasKey(i.vertexAttributeKeys.Position)&&a.modified(),!0):!1},this.source=function(t){return t<r.length?r[t]:0},this.sourceByName=function(t){for(var e=0;e<r.length;e+=1)if(r[e].name()===t)return r[e];return 0},this.numberOfSources=function(){return r.length},this.sourceData=function(t){var e;for(e=0;e<r.length;e+=1)if(r[e].hasKey(t))return r[e];return null},this.addPrimitive=function(t){return e.push(t),!0},this.primitive=function(t){return t<e.length?e[t]:null},this.numberOfPrimitives=function(){return e.length},this.bounds=function(){return a.getMTime()>o.getMTime()&&this.computeBounds(),n},this.boundsDirty=function(t){return t&&a.modified(),a.getMTime()>o.getMTime()},this.resetBounds=function(){n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0},this.setBounds=function(t,e,i,r,a,s){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n[4]=a,n[5]=s,o.modified(),!0},this.computeBounds=function(){if(a.getMTime()>o.getMTime()){var t,e,r,s,u,h,l=i.vertexAttributeKeys.Position,c=this.sourceData(l),d=c.data(),f=c.attributeNumberOfComponents(l),m=c.attributeStride(l),p=c.attributeOffset(l),v=c.sizeOfAttributeDataType(l),g=d.length,y=null;for(m/=v,p/=v,this.resetBounds(),t=0;f>t;t+=1){for(e=2*t,r=2*t+1,s=u=g?n[r]=d[p+t]:0,h=p+m+t;g>h;h+=m)y=d[h],y>s&&(s=y),u>y&&(u=y);n[e]=u,n[r]=s}o.modified()}},this.findClosestVertex=function(t){var e,r,n,o,a,s,u,h=i.vertexAttributeKeys.Position,l=this.sourceData(h),c=l.sizeOfAttributeDataType(h),d=l.attributeNumberOfComponents(h),f=l.data(),m=l.attributeStride(h)/c,p=l.attributeOffset(h)/c,v=Number.MAX_VALUE,g=null;for(3!==d&&console.log("[warning] Find closest vertex assumes threecomponent vertex "),t.z||(t={x:t.x,y:t.y,z:0}),e=p,u=0;e<f.length;e+=m,u+=1)r=[f[e],f[e+1],f[e+2]],n=r[0]-t.x,o=r[1]-t.y,a=r[2]-t.z,s=Math.sqrt(n*n+o*o+a*a),v>s&&(v=s,g=u);return g},this.getPosition=function(t){var e=i.vertexAttributeKeys.Position,r=this.sourceData(e),n=r.sizeOfAttributeDataType(e),o=r.attributeNumberOfComponents(e),a=r.data(),s=r.attributeStride(e)/n,u=r.attributeOffset(e)/n;return 3!==o&&console.log("[warning] getPosition assumes three component data"),[a[u+t*s],a[u+t*s+1],a[u+t*s+2]]},this.getScalar=function(t){var e,r,n,o,a,s=i.vertexAttributeKeys.Scalar,u=this.sourceData(s);return u?(e=u.attributeNumberOfComponents(s),r=u.sizeOfAttributeDataType(s),n=u.data(),o=u.attributeStride(s)/r,a=u.attributeOffset(s)/r,t*o+a>=n.length&&console.log("access out of bounds in getScalar"),n[t*o+a]):null},this},t(i.geometryData,i.data),i.mapper=function(t){"use strict";function e(t){if(s){t&&(d=t.m_context);var e,r,n,o,a,f,m,p=s.numberOfSources(),v=null;for(e=0;p>e;e+=1){for(v=d.createBuffer(),d.bindBuffer(i.GL.ARRAY_BUFFER,v),m=s.source(e).data(),m instanceof Float32Array||(m=new Float32Array(m)),d.bufferData(i.GL.ARRAY_BUFFER,m,l?i.GL.DYNAMIC_DRAW:i.GL.STATIC_DRAW),o=s.source(e).keys(),a=[],r=0;r<o.length;r+=1)a.push(o[r]);h[e]=a,u[e]=v}for(f=s.numberOfPrimitives(),n=0;f>n;n+=1)v=d.createBuffer(),d.bindBuffer(i.GL.ARRAY_BUFFER,v),d.bufferData(i.GL.ARRAY_BUFFER,s.primitive(n).indices(),i.GL.STATIC_DRAW),u[e]=v,e+=1;c.modified()}}function r(t){t=t,h={},u=[]}function n(t){f.deleteVertexBufferObjects(t),r(t),e(t),o=!1}if(!(this instanceof i.mapper))return new i.mapper(t);i.boundingObject.call(this),t=t||{};var o=!0,a=[0,1,1],s=null,u=[],h={},l=void 0===t.dynamicDraw?!1:t.dynamicDraw,c=i.timestamp(),d=null,f=this;return this.deleteVertexBufferObjects=function(t){var e,i=d;if(t&&(i=t.m_context),i)for(e=0;e<u.length;e+=1)i.deleteBuffer(u[e])},this.computeBounds=function(){if(null===s||"undefined"==typeof s)return void this.resetBounds();var t=this.computeBoundsTimestamp(),e=this.boundsDirtyTimestamp(),i=null;e.getMTime()>t.getMTime()&&(i=s.bounds(),this.setBounds(i[0],i[1],i[2],i[3],i[4],i[5]),t.modified())},this.color=function(){return a},this.setColor=function(t,e,i){a[0]=t,a[1]=e,a[2]=i,this.modified()},this.geometryData=function(){return s},this.setGeometryData=function(t){s!==t&&(s=t,this.modified(),this.boundsDirtyTimestamp().modified())},this.updateSourceBuffer=function(t,e,r){if(r&&(d=r.m_context),!d)return!1;for(var n=-1,o=0;o<s.numberOfSources();o+=1)if(s.source(o).name()===t){n=o;break}return 0>n||n>=u.length?!1:(e||(e=s.source(o).dataToFloat32Array()),d.bindBuffer(i.GL.ARRAY_BUFFER,u[n]),e instanceof Float32Array?d.bufferSubData(i.GL.ARRAY_BUFFER,0,e):d.bufferSubData(i.GL.ARRAY_BUFFER,0,new Float32Array(e)),!0)},this.getSourceBuffer=function(t){var e=s.sourceByName(t);return e?e.dataToFloat32Array():new Float32Array},this.render=function(t){(this.getMTime()>c.getMTime()||t.m_contextChanged)&&n(t),d=t.m_context,d.vertexAttrib3fv(i.vertexAttributeKeys.Color,this.color());var e,r=0,o=0,a=null,l=null;for(e in h)if(h.hasOwnProperty(e)){for(d.bindBuffer(i.GL.ARRAY_BUFFER,u[r]),o=0;o<h[e].length;o+=1)t.m_material.bindVertexData(t,h[e][o]);r+=1}for(a=s.numberOfPrimitives(),o=0;a>o;o+=1){switch(d.bindBuffer(i.GL.ARRAY_BUFFER,u[r]),r+=1,l=s.primitive(o),l.primitiveType()){case i.GL.POINTS:d.drawArrays(i.GL.POINTS,0,l.numberOfIndices());break;case i.GL.LINES:d.drawArrays(i.GL.LINES,0,l.numberOfIndices());break;case i.GL.LINE_STRIP:d.drawArrays(i.GL.LINE_STRIP,0,l.numberOfIndices());break;case i.GL.TRIANGLES:d.drawArrays(i.GL.TRIANGLES,0,l.numberOfIndices());break;case i.GL.TRIANGLE_STRIP:d.drawArrays(i.GL.TRIANGLE_STRIP,0,l.numberOfIndices())}d.bindBuffer(i.GL.ARRAY_BUFFER,null)}},this},t(i.mapper,i.boundingObject),i.groupMapper=function(){"use strict";if(!(this instanceof i.groupMapper))return new i.groupMapper;i.mapper.call(this);var t=i.timestamp(),e=[],r=[];return this.geometryData=function(t){return void 0!==t&&t<r.length?r[t]:r.length>0?r[0]:null},this.setGeometryData=function(t){(1!==r.length||r[0]!==t)&&(r=[],r.push(t),this.modified())},this.geometryDataArray=function(){return r},this.setGeometryDataArray=function(t){if(t instanceof Array){if(r!==t)return r=[],r=t,this.modified(),!0}else console.log("[error] Requies array of geometry data");return!1},this.computeBounds=function(){if(null===r||void 0===r)return void this.resetBounds();var t=this.computeBoundsTimestamp(),e=this.boundsDirtyTimestamp(),i=this.bounds(),n=null,o=null;if(e.getMTime()>t.getMTime()){for(o=0;o<r.length;o+=1)n=r[o].bounds(),i[0]>n[0]&&(i[0]=n[0]),i[1]<n[1]&&(i[1]=n[1]),i[2]>n[2]&&(i[2]=n[2]),i[3]<n[3]&&(i[3]=n[3]),i[4]>n[4]&&(i[4]=n[4]),i[5]<n[5]&&(i[5]=n[5]);this.modified(),t.modified()}},this.render=function(n){var o=null;if(this.getMTime()>t.getMTime()){for(o=0;o<r.length;o+=1)e.push(i.mapper()),e[o].setGeometryData(r[o]);t.modified()}for(o=0;o<e.length;o+=1)e[o].render(n)},this},t(i.groupMapper,i.mapper),i.materialAttributeType={Undefined:0,ShaderProgram:1,Texture:2,Blend:3,Depth:4},i.materialAttribute=function(t){"use strict";if(!(this instanceof i.materialAttribute))return new i.materialAttribute;i.graphicsObject.call(this);var e=this,r=t,n=!0;return this.type=function(){return r},this.enabled=function(){return n},this.bindVertexData=function(t,e){return t=t,e=e,!1},this.undoBindVertexData=function(t,e){return t=t,e=e,!1},e},t(i.materialAttribute,i.graphicsObject),i.blendFunction=function(t,e){"use strict";if(!(this instanceof i.blendFunction))return new i.blendFunction(t,e);var r=t,n=e;return this.apply=function(t){t.m_context.blendFuncSeparate(r,n,i.GL.ONE,i.GL.ONE_MINUS_SRC_ALPHA)},this},i.blend=function(){"use strict";if(!(this instanceof i.blend))return new i.blend;i.materialAttribute.call(this,i.materialAttributeType.Blend);var t=!1,e=i.blendFunction(i.GL.SRC_ALPHA,i.GL.ONE_MINUS_SRC_ALPHA);return this.bind=function(r){return t=r.m_context.isEnabled(i.GL.BLEND),this.enabled()?(r.m_context.enable(i.GL.BLEND),e.apply(r)):r.m_context.disable(i.GL.BLEND),!0},this.undoBind=function(e){return t?e.m_context.enable(i.GL.BLEND):e.m_context.disable(i.GL.BLEND),!0},this},t(i.blend,i.materialAttribute),i.material=function(){"use strict";if(!(this instanceof i.material))return new i.material;i.graphicsObject.call(this);var t=this,e=new i.shaderProgram,r=100,n={},o={};return this.binNumber=function(){return r},this.setBinNumber=function(e){r=e,t.modified()},this.exists=function(t){return t.type()===i.materialAttribute.Texture?n.hasOwnProperty(t):o.hasOwnProperty(t)},this.uniform=function(t){return e?e.uniform(t):null},this.attribute=function(t){return o.hasOwnProperty(t)?o[t]:n.hasOwnProperty(t)?n[t]:null},this.setAttribute=function(r){return r.type()===i.materialAttributeType.Texture&&n[r.textureUnit()]!==r?(n[r.textureUnit()]=r,t.modified(),!0):o[r.type()]===r?!1:(r.type()===i.materialAttributeType.ShaderProgram&&(e=r),o[r.type()]=r,t.modified(),!0)},this.addAttribute=function(r){return t.exists(r)?!1:r.type()===i.materialAttributeType.Texture?(n[r.textureUnit()]=r,t.modified(),!0):(r.type()===i.materialAttributeType.ShaderProgram&&(e=r),o[r.type()]=r,t.modified(),!0)},this.shaderProgram=function(){return e},this._setup=function(t){return t=t,!1},this._cleanup=function(t){for(var e in o)o.hasOwnProperty(e)&&o[e]._cleanup(t);for(e in n)n.hasOwnProperty(e)&&n[e]._cleanup(t)},this.bind=function(t){var i=null;e.bind(t);for(i in o)o.hasOwnProperty(i)&&o[i]!==e&&o[i].bind(t);for(i in n)n.hasOwnProperty(i)&&n[i].bind(t)},this.undoBind=function(t){var e=null;for(e in o)o.hasOwnProperty(e)&&o[e].undoBind(t);for(e in n)n.hasOwnProperty(e)&&n[e].undoBind(t)},this.bindVertexData=function(t,e){var i=null;for(i in o)o.hasOwnProperty(i)&&o[i].bindVertexData(t,e)},this.undoBindVertexData=function(t,e){var i=null;for(i in o)o.hasOwnProperty(i)&&o.undoBindVertexData(t,e)},t},i.material.RenderBin={Base:0,Default:100,Opaque:100,Transparent:1e3,Overlay:1e4},t(i.material,i.graphicsObject),i.renderState=function(){"use strict";this.m_context=null,this.m_modelViewMatrix=o.create(),this.m_normalMatrix=o.create(),this.m_projectionMatrix=null,this.m_material=null,this.m_mapper=null},i.renderer=function(t){"use strict";if(!(this instanceof i.renderer))return new i.renderer(t);i.graphicsObject.call(this),t=t||{};var e=this;return e.m_renderWindow=null,e.m_contextChanged=!1,e.m_sceneRoot=new i.groupNode,e.m_camera=new i.camera(t),e.m_nearClippingPlaneTolerance=null,e.m_x=0,e.m_y=0,e.m_width=0,e.m_height=0,e.m_resizable=!0,e.m_resetScene=!0,e.m_layer=0,e.m_renderPasses=null,e.m_resetClippingRange=!0,e.m_depthBits=null,e.m_camera.addChild(e.m_sceneRoot),this.width=function(){return e.m_width},this.height=function(){return e.m_height},this.layer=function(){return e.m_layer},this.setLayer=function(t){e.m_layer=t,e.modified()},this.isResizable=function(){return e.m_resizable},this.setResizable=function(t){e.m_resizable=t},this.renderWindow=function(){return e.m_renderWindow},this.setRenderWindow=function(t){e.m_renderWindow!==t&&(e.m_renderWindow&&e.m_renderWindow.removeRenderer(this),e.m_renderWindow=t,e.m_contextChanged=!0,e.modified())},this.backgroundColor=function(){return e.m_camera.clearColor()},this.setBackgroundColor=function(t,i,r,n){e.m_camera.setClearColor(t,i,r,n),e.modified()},this.sceneRoot=function(){return e.m_sceneRoot},this.camera=function(){return e.m_camera},this.render=function(){var t,r,n,a=null,s=[],u=o.create(),h=null;if(r=new i.renderState,r.m_renderer=e,r.m_context=e.renderWindow().context(),(!e.m_depthBits||e.m_contextChanged)&&(e.m_depthBits=r.m_context.getParameter(i.GL.DEPTH_BITS)),r.m_contextChanged=e.m_contextChanged,e.m_renderPasses)for(t=0;t<e.m_renderPasses.length;t+=1){if(e.m_renderPasses[t].render(r))return console.log("returning"),void e.m_renderPasses[t].remove(r);e.m_renderPasses[t].remove(r)}for(r.m_context.enable(i.GL.DEPTH_TEST),r.m_context.depthFunc(i.GL.LEQUAL),e.m_camera.clearMask()&i.GL.COLOR_BUFFER_BIT&&(h=e.m_camera.clearColor(),r.m_context.clearColor(h[0],h[1],h[2],h[3])),e.m_camera.clearMask()&i.GL.DEPTH_BUFFER_BIT&&r.m_context.clearDepth(e.m_camera.clearDepth()),r.m_context.clear(e.m_camera.clearMask()),r.m_context.viewport(e.m_x,e.m_y,e.m_width,e.m_height),n=e.m_sceneRoot.children(),n.length>0&&e.m_resetScene&&(e.resetCamera(),e.m_resetScene=!1),t=0;t<n.length;t+=1)a=n[t],a.computeBounds(),a.visible()&&a.material().binNumber()>=0&&s.push([a.material().binNumber(),a]);for(s.sort(function(t,e){return t[0]-e[0]}),t=0;t<s.length;t+=1){if(a=s[t][1],a.referenceFrame()===i.boundingObject.ReferenceFrame.Relative){var l=e.m_camera.viewMatrix();l instanceof Array&&(r.m_modelViewMatrix=new Array(16)),o.multiply(r.m_modelViewMatrix,l,a.matrix()),r.m_projectionMatrix=e.m_camera.projectionMatrix(),r.m_modelViewAlignment=e.m_camera.viewAlignment()}else r.m_modelViewMatrix=a.matrix(),r.m_modelViewAlignment=null,r.m_projectionMatrix=o.create(),o.ortho(r.m_projectionMatrix,0,e.m_width,0,e.m_height,-1,1);o.invert(u,r.m_modelViewMatrix),o.transpose(r.m_normalMatrix,u),r.m_material=a.material(),r.m_mapper=a.mapper(),r.m_material.bind(r),r.m_mapper.render(r),r.m_material.undoBind(r)}r.m_context.finish(),e.m_contextChanged=!1},this.resetCamera=function(){e.m_camera.computeBounds();var t=e.m_camera.directionOfProjection(),i=e.m_camera.bounds(),r=[(i[0]+i[1])/2,(i[2]+i[3])/2,(i[4]+i[5])/2],n=[i[1]-i[0],i[3]-i[2],i[5]-i[4]],o=0,a=e.m_camera.viewAspect(),u=e.m_camera.viewAngle(),h=null,l=null;o=n[0]>n[1]?n[0]>n[2]?n[0]/2:n[2]/2:n[1]>n[2]?n[1]/2:n[2]/2,u=a>=1?2*Math.atan(Math.tan(.5*u)/a):2*Math.atan(Math.tan(.5*u)*a),h=o/Math.sin(.5*u),l=e.m_camera.viewUpDirection(),Math.abs(s.dot(l,t))>.999&&e.m_camera.setViewUpDirection(-l[2],l[0],l[1]),e.m_camera.setFocalPoint(r[0],r[1],r[2]),e.m_camera.setPosition(r[0]+h*-t[0],r[1]+h*-t[1],r[2]+h*-t[2]),e.resetCameraClippingRange(i)},this.hasValidBounds=function(t){return t[0]===Number.MAX_VALUE||t[1]===-Number.MAX_VALUE||t[2]===Number.MAX_VALUE||t[3]===-Number.MAX_VALUE||t[4]===Number.MAX_VALUE||t[5]===-Number.MAX_VALUE?!1:!0},this.resetCameraClippingRange=function(t){if("undefined"==typeof t&&(e.m_camera.computeBounds(),t=e.m_camera.bounds()),e.hasValidBounds(t)){var i=e.m_camera.viewPlaneNormal(),r=e.m_camera.position(),n=-i[0],o=-i[1],a=-i[2],s=-(n*r[0]+o*r[1]+a*r[2]),h=u.create(),l=null,c=null,d=null,f=null;if(e.m_resetClippingRange){for(h[0]=n*t[0]+o*t[2]+a*t[4]+s,h[1]=1e-18,f=0;2>f;f+=1)for(d=0;2>d;d+=1)for(c=0;2>c;c+=1)l=n*t[c]+o*t[2+d]+a*t[4+f]+s,h[0]=l<h[0]?l:h[0],h[1]=l>h[1]?l:h[1];h[0]<0&&(h[0]=0),h[0]=.99*h[0]-.5*(h[1]-h[0]),h[1]=1.01*h[1]+.5*(h[1]-h[0]),h[0]=h[0]>=h[1]?.01*h[1]:h[0],e.m_nearClippingPlaneTolerance||(e.m_nearClippingPlaneTolerance=.01,e.m_depthBits&&e.m_depthBits>16&&(e.m_nearClippingPlaneTolerance=.001)),h[0]<e.m_nearClippingPlaneTolerance*h[1]&&(h[0]=e.m_nearClippingPlaneTolerance*h[1]),e.m_camera.setClippingRange(h[0],h[1])}}},this.resize=function(t,i){t&&i&&e.positionAndResize(e.m_x,e.m_y,t,i)},this.positionAndResize=function(t,i,r,n){var o;if(0>t||0>i||0>=r||0>=n)return void console.log("[error] Invalid position and resize values",t,i,r,n);if(e.m_resizable&&(e.m_width=r,e.m_height=n,e.m_camera.setViewAspect(r/n),e.m_camera.setParallelExtents({width:r,height:n}),e.modified()),e.m_renderPasses)for(o=0;o<e.m_renderPasses.length;o+=1)e.m_renderPasses[o].resize(r,n),e.m_renderPasses[o].renderer().positionAndResize(t,i,r,n)},this.addActor=function(t){return t instanceof i.actor?(e.m_sceneRoot.addChild(t),e.modified(),!0):!1},this.hasActor=function(t){return e.m_sceneRoot.hasChild(t)},this.addActors=function(t){var i=null;if(t instanceof Array){for(i=0;i<t.length;i+=1)e.m_sceneRoot.addChild(t[i]);e.modified()}},this.removeActor=function(t){return-1!==e.m_sceneRoot.children().indexOf(t)?(t.mapper()&&(t.mapper().deleteVertexBufferObjects(),t.mapper().modified()),e.m_sceneRoot.removeChild(t),e.modified(),!0):!1},this.removeActors=function(t){if(!(t instanceof Array))return!1;var i;for(i=0;i<t.length;i+=1)e.m_sceneRoot.removeChild(t[i]);return e.modified(),!0},this.removeAllActors=function(){return e.m_sceneRoot.removeChildren()},this.worldToDisplay=function(t,e,i,r,n){var s=o.create(),u=null,h=null,l=null,c=null,d=null;return o.multiply(s,i,e),d=a.create(),a.transformMat4(d,t,s),0!==d[3]&&(d[0]=d[0]/d[3],d[1]=d[1]/d[3],d[2]=d[2]/d[3],d[3]=1),u=(d[0]+1)/2*r,h=(1-d[1])/2*n,l=d[2],c=d[3],a.fromValues(u,h,l,c)},this.displayToWorld=function(t,e,i,r,n){var s=2*t[0]/r-1,u=-(2*t[1]/n)+1,h=t[2],l=o.create(),c=null;return o.multiply(l,i,e),o.invert(l,l),c=a.fromValues(s,u,h,1),a.transformMat4(c,c,l),0!==c[3]&&(c[0]=c[0]/c[3],c[1]=c[1]/c[3],c[2]=c[2]/c[3],c[3]=1),c},this.focusDisplayPoint=function(){var t=e.m_camera.focalPoint(),i=a.fromValues(t[0],t[1],t[2],1);return e.worldToDisplay(i,e.m_camera.viewMatrix(),e.m_camera.projectionMatrix(),e.m_width,e.m_height)},this.resetScene=function(){return e.m_resetScene},this.setResetScene=function(t){e.m_resetScene!==t&&(e.m_resetScene=t,e.modified())},this.resetClippingRange=function(){return e.m_resetClippingRange},this.setResetClippingRange=function(t){e.m_resetClippingRange!==t&&(e.m_resetClippingRange=t,e.modified())},this.addRenderPass=function(t){var i;if(e.m_renderPasses)for(i=0;i<e.m_renderPasses.length;i+=1)if(t===e.m_renderPasses[i])return;e.m_renderPasses=[],e.m_renderPasses.push(t)},this.removeRenderPass=function(t){t=t},this._cleanup=function(t){for(var i=e.m_sceneRoot.children(),r=0;r<i.length;r+=1){var n=i[r];n.material()._cleanup(t),n.mapper()._cleanup(t)}e.m_sceneRoot.removeChildren()},e},t(i.renderer,i.graphicsObject),i.renderWindow=function(t){"use strict";if(!(this instanceof i.renderWindow))return new i.renderWindow(t);i.graphicsObject.call(this);var e=this,r=0,n=0,o=400,s=400,u=t,h=null,l=[],c=null;return this.windowSize=function(){return[o,s]},this.setWindowSize=function(t,i){return o!==t||s!==i?(o=t,s=i,e.modified(),!0):!1},this.windowPosition=function(){return[r,n]},this.setWindowPosition=function(t,i){return r!==t||n!==i?(r=t,n=i,e.modified(),!0):!1},this.renderers=function(){return l},this.activeRenderer=function(){return h},this.addRenderer=function(t){return e.hasRenderer(t)===!1?(l.push(t),t.setRenderWindow(e),null===h&&(h=t),0!==t.layer()&&t.camera().setClearMask(i.GL.DepthBufferBit),e.modified(),!0):!1},this.removeRenderer=function(t){var i=l.indexOf(t);return-1!==i?(h===t&&(h=null),l.splice(i,1),e.modified(),!0):!1},this.getRenderer=function(t){return t<l.length?l[t]:(console.log("[WARNING] Out of index array"),null)},this.hasRenderer=function(t){var e;for(e=0;e<l.length;e+=1)if(t===l[e])return!0;return!1},this.resize=function(t,i){e.positionAndResize(r,n,t,i),e.modified()},this.positionAndResize=function(t,i,a,u){r=t,n=i,o=a,s=u;var h;for(h=0;h<l.length;h+=1)l[h].positionAndResize(r,n,o,s);e.modified()},this._setup=function(t){t=t,c=null;try{c=u.getContext("webgl")||u.getContext("experimental-webgl");var e;for(e=0;e<l.length;e+=1)(l[e].width()>o||0===l[e].width()||l[e].height()>s||0===l[e].height())&&l[e].resize(r,n,o,s);return!0}catch(i){}return c||console("[ERROR] Unable to initialize WebGL. Your browser may not support it."),!1},this.context=function(){return c},this._cleanup=function(t){var e;for(e=0;e<l.length;e+=1)l[e]._cleanup(t);i.clearCachedShaders(t?t.m_context:null)},this.render=function(){var t;for(l.sort(function(t,e){return t.layer()-e.layer()}),t=0;t<l.length;t+=1)l[t].render()},this.focusDisplayPoint=function(){return h.focusDisplayPoint()},this.displayToWorld=function(t,e,i,r){r=void 0===r?r=h:r;var n=r.camera();return i||(i=r.focusDisplayPoint()),r.displayToWorld(a.fromValues(t,e,i[2],1),n.viewMatrix(),n.projectionMatrix(),o,s)},this.worldToDisplay=function(t,e,i,r){r=void 0===r?r=h:r;var n=r.camera();return r.worldToDisplay(a.fromValues(t,e,i,1),n.viewMatrix(),n.projectionMatrix(),o,s)},e},t(i.renderWindow,i.graphicsObject),i.camera=function(t){"use strict";if(!(this instanceof i.camera))return new i.camera(t);i.groupNode.call(this),t=t||{};var e=30*Math.PI/180,r=a.fromValues(0,0,1,1),n=a.fromValues(0,0,0,1),u=s.fromValues(0,0,0),h=a.fromValues(0,1,0,0),l=a.fromValues(1,0,0,0),c=.01,d=1e4,f=1,m=a.fromValues(0,0,-1,0),p=a.fromValues(0,0,1,0),v=o.create(),g=o.create(),y=i.timestamp(),x=i.timestamp(),_=-1,M=1,b=1,w=-1,T={zoom:1,tilesize:256},A=!0,E=!0,P=!0,R=!1,S=[0,0,0,0],C=1,L=i.GL.COLOR_BUFFER_BIT|i.GL.DEPTH_BUFFER_BIT;return void 0!==t.parallelProjection&&(R=t.parallelProjection?!0:!1),this.viewAngle=function(){return e},this.setViewAngleDegrees=function(t){e=Math.PI*t/180,this.modified()},this.setViewAngle=function(t){P&&(e=t,this.modified())},this.position=function(){return r},this.setPosition=function(t,e,i){A&&(r=a.fromValues(t,e,i,1),this.modified())},this.focalPoint=function(){return n},this.setFocalPoint=function(t,e,i){E&&A&&(n=a.fromValues(t,e,i,1),this.modified())},this.viewUpDirection=function(){return h},this.setViewUpDirection=function(t,e,i){h=a.fromValues(t,e,i,0),this.modified()},this.centerOfRotation=function(){return u},this.setCenterOfRotation=function(t){u=t,this.modified()},this.clippingRange=function(){return[c,d]},this.setClippingRange=function(t,e){c=t,d=e,this.modified()},this.viewAspect=function(){return f},this.setViewAspect=function(t){f=t,this.modified()},this.enableScale=function(){return P},this.setEnableScale=function(t){return t!==P?(P=t,this.modified(),!0):P},this.enableRotation=function(){return E},this.setEnableRotation=function(t){return t!==E?(E=t,this.modified(),!0):E},this.enableTranslation=function(){return A},this.setEnableTranslation=function(t){return t!==A?(A=t,this.modified(),!0):A},this.isEnabledParallelProjection=function(){return R},this.enableParallelProjection=function(t){return t!==R?(R=t,this.modified(),!0):R},this.setEnableParallelProjection=function(t){return this.enableParallelProjection(t)},this.parallelProjection=function(){return{left:_,right:M,top:b,bottom:w}},this.setParallelProjection=function(t,e,i,r){_=t,M=e,b=i,w=r,this.modified()},this.parallelExtents=function(){return T},this.setParallelExtents=function(t){var e,i,r=["width","height","zoom","tilesize"],n=!1;for(e=0;e<r.length;e+=1)i=r[e],void 0!==t[i]&&t[i]!==T[i]&&(T[i]=t[i],n=!0);if(n&&T.width&&T.height&&void 0!==T.zoom&&T.tilesize){var o=this.unitsPerPixel(T.zoom,T.tilesize);M=o*T.width/2,_=-M,b=o*T.height/2,w=-b,this.modified()}},this.unitsPerPixel=function(t,e){return e=e||256,360*Math.pow(2,-t)/e},this.directionOfProjection=function(){return this.computeDirectionOfProjection(),m},this.viewPlaneNormal=function(){return this.computeViewPlaneNormal(),p},this.viewMatrix=function(){return this.computeViewMatrix()},this.setViewMatrix=function(t,e){e?v=t.slice():o.copy(v,t),y.modified()},this.projectionMatrix=function(){return this.computeProjectionMatrix()},this.setProjectionMatrix=function(t){o.copy(g,t),x.modified()},this.clearMask=function(){return L},this.setClearMask=function(t){L=t,this.modified()},this.clearColor=function(){return S},this.setClearColor=function(t,e,i,r){S[0]=t,S[1]=e,S[2]=i,S[3]=r,this.modified()},this.clearDepth=function(){return C},this.setClearDepth=function(t){C=t,this.modified()},this.computeDirectionOfProjection=function(){s.subtract(m,n,r),s.normalize(m,m),this.modified()},this.computeViewPlaneNormal=function(){p[0]=-m[0],p[1]=-m[1],p[2]=-m[2]},this.zoom=function(t,e){0!==t&&A&&(t*=s.distance(n,r),e?(r[0]=r[0]+t*e[0],r[1]=r[1]+t*e[1],r[2]=r[2]+t*e[2]):(e=m,r[0]=n[0]-t*e[0],r[1]=n[1]-t*e[1],r[2]=n[2]-t*e[2]),this.modified())},this.pan=function(t,e,i){A&&(r[0]+=t,r[1]+=e,r[2]+=i,n[0]+=t,n[1]+=e,n[2]+=i,this.modified())},this.computeOrthogonalAxes=function(){this.computeDirectionOfProjection(),s.cross(l,m,h),s.normalize(l,l),this.modified()},this.rotate=function(t,e){if(E){t=.5*t*(Math.PI/180),e=.5*e*(Math.PI/180);var i=o.create(),c=new s.create;o.identity(i),c[0]=-u[0],c[1]=-u[1],c[2]=-u[2],o.translate(i,i,u),o.rotate(i,i,t,h),o.rotate(i,i,e,l),o.translate(i,i,c),a.transformMat4(r,r,i),a.transformMat4(n,n,i),a.transformMat4(h,h,i),a.normalize(h,h),this.computeOrthogonalAxes(),this.modified()}},this.computeViewMatrix=function(){return y.getMTime()<this.getMTime()&&(o.lookAt(v,r,n,h),y.modified()),v},this.viewAlignment=function(){if(!R){var t=this.projectionMatrix();if(t[1]||t[2]||t[3]||t[4]||t[6]||t[7]||t[8]||t[9]||t[12]||t[13]||t[15])return null}var e=this.unitsPerPixel(T.zoom,T.tilesize);if(!T.width||!T.height||!e)return null;if(parseFloat(T.zoom.toFixed(6))!==parseFloat(T.zoom.toFixed(0)))return null;var i={roundx:e,roundy:e,dx:0,dy:0};return T.width%2&&(i.dx=.5*e),T.height%2&&(i.dy=.5*e),i},this.computeProjectionMatrix=function(){return x.getMTime()<this.getMTime()&&(R?o.ortho(g,_,M,w,b,c,d):o.perspective(g,e,f,c,d),x.modified()),g},this.zoomToHeight=function(t,r,n){return i.zoomToHeight(t,r,n,e)},this.computeDirectionOfProjection(),this},t(i.camera,i.groupNode),i.zoomToHeight=function(t,e,i,r){"use strict";r=r||30*Math.PI/180;var n=360*Math.pow(2,-t);return n/=2*Math.tan(r/2)*256/i},i.heightToZoom=function(t,e,i,r){"use strict";r=r||30*Math.PI/180,t*=2*Math.tan(r/2)*256/i;var n=-Math.log2(t/360);return n},i.interactorStyle=function(){"use strict";if(!(this instanceof i.interactorStyle))return new i.interactorStyle;i.object.call(this);var t=this,e=null;return this.viewer=function(){return e},this.setViewer=function(r){r!==e&&(e=r,h(e).on(i.event.mousePress,t.handleMouseDown),h(e).on(i.event.mouseRelease,t.handleMouseUp),h(e).on(i.event.mouseMove,t.handleMouseMove),h(e).on(i.event.mouseOut,t.handleMouseOut),h(e).on(i.event.mouseWheel,t.handleMouseWheel),h(e).on(i.event.keyPress,t.handleKeyPress),h(e).on(i.event.mouseContextMenu,t.handleContextMenu),h(e).on(i.event.click,t.handleClick),h(e).on(i.event.dblClick,t.handleDoubleClick),this.modified())},this.handleMouseDown=function(t){return t=t,!0},this.handleMouseUp=function(t){return t=t,!0},this.handleMouseMove=function(t){return t=t,!0},this.handleMouseOut=function(t){return t=t,!0},this.handleMouseWheel=function(t){return t=t,!0},this.handleClick=function(t){return t=t,!0},this.handleDoubleClick=function(t){return t=t,!0},this.handleKeyPress=function(t){return t=t,!0},this.handleContextMenu=function(t){return t=t,!0},this.reset=function(){return!0},this},t(i.interactorStyle,i.object),i.trackballInteractorStyle=function(){"use strict";if(!(this instanceof i.trackballInteractorStyle))return new i.trackballInteractorStyle;i.interactorStyle.call(this);var t,e=this,r=!1,n=!1,o=!1,s={x:0,y:0},u={x:0,y:0};return this.handleMouseMove=function(i){var h,l,c,d,f,m,p,v,g,y,x,_=e.viewer().renderWindow().windowSize()[0],M=e.viewer().renderWindow().windowSize()[1],b=e.viewer().renderWindow().activeRenderer(),w=b.camera(),T=e.viewer().relMouseCoords(i);return t=!1,s={x:0,y:0},T.x<0||T.x>_?(s.x=0,t=!0):s.x=T.x,T.y<0||T.y>M?(s.y=0,t=!0):s.y=T.y,t!==!0?(h=w.focalPoint(),c=a.fromValues(h[0],h[1],h[2],1),l=b.worldToDisplay(c,w.viewMatrix(),w.projectionMatrix(),_,M),d=a.fromValues(s.x,s.y,l[2],1),f=a.fromValues(u.x,u.y,l[2],1),m=b.displayToWorld(d,w.viewMatrix(),w.projectionMatrix(),_,M),p=b.displayToWorld(f,w.viewMatrix(),w.projectionMatrix(),_,M),v=m[0]-p[0],g=m[1]-p[1],y=m[2]-p[2],o&&(w.pan(-v,-g,-y),e.viewer().render()),r&&(w.rotate(u.x-s.x,u.y-s.y),
b.resetCameraClippingRange(),e.viewer().render()),n&&(x=2*(s.y-u.y)/M,x>0?w.zoom(1-Math.abs(x)):w.zoom(1+Math.abs(x)),b.resetCameraClippingRange(),e.viewer().render()),u.x=s.x,u.y=s.y,!1):void 0},this.handleMouseDown=function(t){var i;return 0===t.button&&(r=!0),1===t.button&&(o=!0),2===t.button&&(n=!0),i=e.viewer().relMouseCoords(t),i.x<0?u.x=0:u.x=i.x,i.y<0?u.y=0:u.y=i.y,!1},this.handleMouseUp=function(t){return 0===t.button&&(r=!1),1===t.button&&(o=!1),2===t.button&&(n=!1),!1},this.handleMouseWheel=function(t){var i=e.viewer().renderWindow().activeRenderer(),r=i.camera();return t.originalEvent.wheelDelta<0?r.zoom(.9):r.zoom(1.1),i.resetCameraClippingRange(),e.viewer().render(),!0},this},t(i.trackballInteractorStyle,i.interactorStyle),i.pvwInteractorStyle=function(){"use strict";function t(){n.resetCameraClippingRange(),M.viewer().render()}if(!(this instanceof i.pvwInteractorStyle))return new i.pvwInteractorStyle;i.trackballInteractorStyle.call(this);var e,r,n,o,s,u,h,l,c,d,f,m,p,v,g,y,x,_,M=this,b=!1,w=!1,T=!1,A={x:0,y:0};return this.handleMouseMove=function(i){var E=[],P=null,R=[],S=null;for(e=M.viewer().renderWindow().windowSize()[0],r=M.viewer().renderWindow().windowSize()[1],n=M.viewer().renderWindow().activeRenderer(),o=n.camera(),s=!1,u=M.viewer().relMouseCoords(i),h={x:0,y:0},E=M.viewer().renderWindow().renderers(),P=0;P<E.length;P+=1)n!==E[P]&&R.push(E[P].camera());if(u.x<0||u.x>e?(h.x=0,s=!0):h.x=u.x,u.y<0||u.y>r?(h.y=0,s=!0):h.y=u.y,s!==!0){if(l=o.focalPoint(),c=a.fromValues(l[0],l[1],l[2],1),d=n.worldToDisplay(c,o.viewMatrix(),o.projectionMatrix(),e,r),f=a.fromValues(h.x,h.y,d[2],1),m=a.fromValues(A.x,A.y,d[2],1),p=n.displayToWorld(f,o.viewMatrix(),o.projectionMatrix(),e,r),v=n.displayToWorld(m,o.viewMatrix(),o.projectionMatrix(),e,r),g=p[0]-v[0],y=p[1]-v[1],x=p[2]-v[2],T&&(o.pan(-g,-y,-x),t()),b){for(S=[A.x-h.x,A.y-h.y],o.rotate(S[0],S[1]),P=0;P<R.length;P+=1)R[P].rotate(S[0],S[1]);for(P=0;P<E.length;P+=1)E[P].resetCameraClippingRange();t()}return w&&(_=2*(h.y-A.y)/r,_>0?o.zoom(1-Math.abs(_)):o.zoom(1+Math.abs(_)),t()),A.x=h.x,A.y=h.y,!1}},this.handleMouseDown=function(t){return 0===t.button&&(b=!0),1===t.button&&(T=!0),2===t.button&&(w=!0),u=M.viewer().relMouseCoords(t),u.x<0?A.x=0:A.x=u.x,u.y<0?A.y=0:A.y=u.y,!1},this.handleMouseUp=function(t){return 0===t.button&&(b=!1),1===t.button&&(T=!1),2===t.button&&(w=!1),!1},this},t(i.pvwInteractorStyle,i.trackballInteractorStyle),i.viewer=function(t,e){"use strict";if(!(this instanceof i.viewer))return new i.viewer(t,e);i.object.call(this);var r=this,n=t,o=!0,a=null,s=i.renderer(e),u=i.renderWindow(n);return this.canvas=function(){return n},this.renderWindow=function(){return u},this.init=function(){null!==u?u._setup():console.log("[ERROR] No render window attached")},this.exit=function(t){null!==u?u._cleanup(t):console.log("[ERROR] No render window attached")},this.interactorStyle=function(){return a},this.setInteractorStyle=function(t){t!==a&&(a=t,a.setViewer(this),this.modified())},this.handleMouseDown=function(t){if(o===!0){var e=h.event.fix(t||window.event);2===t.button&&e.preventDefault(),e.state="down",e.type=i.event.mousePress,h(r).trigger(e)}return!0},this.handleMouseUp=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.state="up",e.type=i.event.mouseRelease,h(r).trigger(e)}return!0},this.handleMouseMove=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.mouseMove,h(r).trigger(e)}return!0},this.handleMouseWheel=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.mouseWheel,h(r).trigger(e)}return!0},this.handleMouseOut=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.mouseOut,h(r).trigger(e)}return!0},this.handleKeyPress=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.keyPress,h(r).trigger(e)}return!0},this.handleContextMenu=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.contextMenu,h(r).trigger(e)}return!1},this.handleClick=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.click,h(r).trigger(e)}return!1},this.handleDoubleClick=function(t){if(o===!0){var e=h.event.fix(t||window.event);e.preventDefault(),e.type=i.event.dblClick,h(r).trigger(e)}return!1},this.relMouseCoords=function(t){if(void 0===t.pageX||void 0===t.pageY)throw"Missing attributes pageX and pageY on the event";var e=0,i=0,r=0,o=0,a=n;do e+=a.offsetLeft-a.scrollLeft,i+=a.offsetTop-a.scrollTop,a=a.offsetParent;while(a);return r=t.pageX-e,o=t.pageY-i,{x:r,y:o}},this.render=function(){u.render()},this.bindEventHandlers=function(){h(n).on("mousedown",this.handleMouseDown),h(n).on("mouseup",this.handleMouseUp),h(n).on("mousemove",this.handleMouseMove),h(n).on("mousewheel",this.handleMouseWheel),h(n).on("contextmenu",this.handleContextMenu)},this.unbindEventHandlers=function(){h(n).off("mousedown",this.handleMouseDown),h(n).off("mouseup",this.handleMouseUp),h(n).off("mousemove",this.handleMouseMove),h(n).off("mousewheel",this.handleMouseWheel),h(n).off("contextmenu",this.handleContextMenu)},this._init=function(){this.bindEventHandlers(),u.addRenderer(s)},this._init(),this},t(i.viewer,i.object),i.shader=function(t){"use strict";if(!(this instanceof i.shader))return new i.shader(t);i.object.call(this);var e=[],r=t,n="";this._getContextEntry=function(t){var r,n,o=t.m_context;for(r=0;r<e.length;r+=1)if(e[r].context===o)return e[r];return n={context:o,compileTimestamp:i.timestamp()},e.push(n),n},this.removeContext=function(t){var i,r=t.m_context;for(i=0;i<e.length;i+=1)if(e[i].context===r)return void e.splice(i,1)},this.shaderHandle=function(t){var e=this._getContextEntry(t);return e.shaderHandle},this.shaderType=function(){return r},this.shaderSource=function(){return n},this.setShaderSource=function(t){n=t,this.modified()},this.compile=function(t){var e=this._getContextEntry(t);return this.getMTime()<e.compileTimestamp.getMTime()?e.shaderHandle:(t.m_context.deleteShader(e.shaderHandle),e.shaderHandle=t.m_context.createShader(r),t.m_context.shaderSource(e.shaderHandle,n),t.m_context.compileShader(e.shaderHandle),t.m_context.getShaderParameter(e.shaderHandle,i.GL.COMPILE_STATUS)?(e.compileTimestamp.modified(),e.shaderHandle):(console.log("[ERROR] An error occurred compiling the shaders: "+t.m_context.getShaderInfoLog(e.shaderHandle)),console.log(n),t.m_context.deleteShader(e.shaderHandle),null))},this.attachShader=function(t,e){t.m_context.attachShader(e,this.shaderHandle(t))}},t(i.shader,i.object),function(){"use strict";var t=[],e=10;i.getCachedShader=function(r,n,o){for(var a=0;a<t.length;a+=1)if(t[a].type===r&&t[a].context===n&&t[a].source===o)return a&&t.splice(0,0,t.splice(a,1)[0]),t[0].shader;var s=new i.shader(r);return s.setShaderSource(o),t.unshift({type:r,context:n,source:o,shader:s}),t.length>=e&&t.splice(e,t.length-e),s},i.clearCachedShaders=function(e){for(var i=t.length-1;i>=0;i-=1)(null===e||void 0===e||t[i].context===e)&&t.splice(i,1)}}();var n=function(){"use strict";var t=".",e=document.getElementsByTagName("script");if(e.length>0){var i=e.length-1,r=e[i];i=r.src.lastIndexOf("/"),t=r.src.substring(0,i)}return function(){return t}}();return i.shaderProgram=function(){"use strict";if(!(this instanceof i.shaderProgram))return new i.shaderProgram;i.materialAttribute.call(this,i.materialAttributeType.ShaderProgram);var t=this,e=0,r=i.timestamp(),o=i.timestamp(),a=[],s=[],u={},l={},c={};return this.loadFromFile=function(e,r){var n;h.ajax({url:r,type:"GET",async:!1,success:function(r){n=i.shader(e),n.setShaderSource(r),t.addShader(n)}})},this.loadShader=function(t,e){this.loadFromFile(t,n()+"/shaders/"+e)},this.queryUniformLocation=function(t,i){return t.m_context.getUniformLocation(e,i)},this.queryAttributeLocation=function(t,i){return t.m_context.getAttribLocation(e,i)},this.addShader=function(e){if(a.indexOf(e)>-1)return!1;var i;for(i=0;i<a.length;i+=1)a[i].shaderType()===e.shaderType()&&a.splice(a.indexOf(e),1);return a.push(e),t.modified(),!0},this.addUniform=function(e){return s.indexOf(e)>-1?!1:(s.push(e),void t.modified())},this.addVertexAttribute=function(e,i){u[i]=e,t.modified()},this.uniformLocation=function(t){return l[t]},this.attributeLocation=function(t){return c[t]},this.uniform=function(t){var e;for(e=0;e<s.length;e+=1)if(s[e].name()===t)return s[e];return null},this.updateUniforms=function(t){var e;for(e=0;e<s.length;e+=1)s[e].callGL(t,l[s[e].name()])},this.link=function(t){return t.m_context.linkProgram(e),t.m_context.getProgramParameter(e,i.GL.LINK_STATUS)?!0:(console.log("[ERROR] Unable to initialize the shader program."),!1)},this.use=function(t){t.m_context.useProgram(e)},this._setup=function(t){0===e&&(e=t.m_context.createProgram())},this._cleanup=function(e){t.deleteVertexAndFragment(e),t.deleteProgram(e)},this.deleteProgram=function(t){t.m_context.deleteProgram(e)},this.deleteVertexAndFragment=function(t){var e;for(e=0;e<a.length;e+=1)t.m_context.detachShader(a[e].shaderHandle(t)),t.m_context.deleteShader(a[e].shaderHandle(t)),a[e].removeContext(t)},this.compileAndLink=function(i){var n;if(!(r.getMTime()>=this.getMTime())){for(t._setup(i),n=0;n<a.length;n+=1)a[n].compile(i),a[n].attachShader(i,e);t.bindAttributes(i),t.link(i)||(console.log("[ERROR] Failed to link Program"),t._cleanup(i)),r.modified()}},this.bind=function(e){var i=0;for(o.getMTime()<t.getMTime()?(t.compileAndLink(e),t.use(e),t.bindUniforms(e),o.modified()):t.use(e),i=0;i<s.length;i+=1)s[i].update(e,t);t.updateUniforms(e)},this.undoBind=function(t){t.m_context.useProgram(null)},this.bindVertexData=function(t,e){u.hasOwnProperty(e)&&u[e].bindVertexData(t,e)},this.undoBindVertexData=function(t,e){u.hasOwnProperty(e)&&u[e].undoBindVertexData(t,e)},this.bindUniforms=function(t){var e;for(e=0;e<s.length;e+=1)l[s[e].name()]=this.queryUniformLocation(t,s[e].name())},this.bindAttributes=function(t){var i,r;for(i in u)u.hasOwnProperty(i)&&(r=u[i].name(),t.m_context.bindAttribLocation(e,i,r),c[r]=i)},t},t(i.shaderProgram,i.materialAttribute),i.texture=function(){"use strict";function t(t){switch(r.m_textureUnit){case 0:t.m_context.activeTexture(i.GL.TEXTURE0);break;case 1:t.m_context.activeTexture(i.GL.TEXTURE1);break;case 2:t.m_context.activeTexture(i.GL.TEXTURE2);break;case 3:t.m_context.activeTexture(i.GL.TEXTURE3);break;case 4:t.m_context.activeTexture(i.GL.TEXTURE4);break;case 5:t.m_context.activeTexture(i.GL.TEXTURE5);break;case 6:t.m_context.activeTexture(i.GL.TEXTURE6);break;case 7:t.m_context.activeTexture(i.GL.TEXTURE7);break;case 8:t.m_context.activeTexture(i.GL.TEXTURE8);break;case 9:t.m_context.activeTexture(i.GL.TEXTURE9);break;case 10:t.m_context.activeTexture(i.GL.TEXTURE10);break;case 11:t.m_context.activeTexture(i.GL.TEXTURE11);break;case 12:t.m_context.activeTexture(i.GL.TEXTURE12);break;case 13:t.m_context.activeTexture(i.GL.TEXTURE13);break;case 14:t.m_context.activeTexture(i.GL.TEXTURE14);break;case 15:t.m_context.activeTexture(i.GL.TEXTURE15);break;default:throw"[error] Texture unit "+r.m_textureUnit+" is not supported"}}if(!(this instanceof i.texture))return new i.texture;i.materialAttribute.call(this,i.materialAttributeType.Texture),this.m_width=0,this.m_height=0,this.m_depth=0,this.m_textureHandle=null,this.m_textureUnit=0,this.m_pixelFormat=i.GL.RGBA,this.m_pixelDataType=i.GL.UNSIGNED_BYTE,this.m_internalFormat=i.GL.RGBA,this.m_nearestPixel=!1,this.m_image=null;var e=i.timestamp(),r=this;return this.setup=function(r){t(r),r.m_context.deleteTexture(this.m_textureHandle),this.m_textureHandle=r.m_context.createTexture(),r.m_context.bindTexture(i.GL.TEXTURE_2D,this.m_textureHandle),r.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_MIN_FILTER,this.m_nearestPixel?i.GL.NEAREST:i.GL.LINEAR),r.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_MAG_FILTER,this.m_nearestPixel?i.GL.NEAREST:i.GL.LINEAR),r.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_WRAP_S,i.GL.CLAMP_TO_EDGE),r.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_WRAP_T,i.GL.CLAMP_TO_EDGE),null!==this.m_image?(r.m_context.pixelStorei(i.GL.UNPACK_ALIGNMENT,1),r.m_context.pixelStorei(i.GL.UNPACK_FLIP_Y_WEBGL,!0),this.updateDimensions(),this.computeInternalFormatUsingImage(),r.m_context.texImage2D(i.GL.TEXTURE_2D,0,this.m_internalFormat,this.m_pixelFormat,this.m_pixelDataType,this.m_image)):r.m_context.texImage2D(i.GL.TEXTURE_2D,0,this.m_internalFormat,this.m_width,this.m_height,0,this.m_pixelFormat,this.m_pixelDataType,null),r.m_context.bindTexture(i.GL.TEXTURE_2D,null),e.modified()},this.bind=function(r){this.getMTime()>e.getMTime()&&this.setup(r),t(r),r.m_context.bindTexture(i.GL.TEXTURE_2D,this.m_textureHandle)},this.undoBind=function(t){t.m_context.bindTexture(i.GL.TEXTURE_2D,null)},this.image=function(){return this.m_image},this.setImage=function(t){return null!==t?(this.m_image=t,this.updateDimensions(),this.modified(),!0):!1},this.nearestPixel=function(){return this.m_nearestPixel},this.setNearestPixel=function(t){return t=t?!0:!1,t!==this.m_nearestPixel?(this.m_nearestPixel=t,this.modified(),!0):!1},this.textureUnit=function(){return this.m_textureUnit},this.setTextureUnit=function(t){return this.m_textureUnit===t?!1:(this.m_textureUnit=t,this.modified(),!0)},this.width=function(){return this.m_width},this.setWidth=function(t){return r.m_width!==t?(r.m_width=t,r.modified(),!0):!1},this.height=function(){return r.m_height},this.setHeight=function(t){return r.m_height!==t?(r.m_height=t,r.modified(),!0):!1},this.depth=function(){return this.m_depth},this.setDepth=function(t){return null===this.m_image?!1:(this.m_depth=t,this.modified(),!0)},this.textureHandle=function(){return this.m_textureHandle},this.internalFormat=function(){return this.m_internalFormat},this.setInternalFormat=function(t){return this.m_internalFormat!==t?(this.m_internalFormat=t,this.modified(),!0):!1},this.pixelFormat=function(){return this.m_pixelFormat},this.setPixelFormat=function(t){return null===this.m_image?!1:(this.m_pixelFormat=t,this.modified(),!0)},this.pixelDataType=function(){return this.m_pixelDataType},this.setPixelDataType=function(t){return null===this.m_image?!1:(this.m_pixelDataType=t,this.modified(),!0)},this.computeInternalFormatUsingImage=function(){this.m_internalFormat=i.GL.RGBA,this.m_pixelFormat=i.GL.RGBA,this.m_pixelDataType=i.GL.UNSIGNED_BYTE},this.updateDimensions=function(){null!==this.m_image&&(this.m_width=this.m_image.width,this.m_height=this.m_image.height,this.m_depth=0)},this},t(i.texture,i.materialAttribute),i.lookupTable=function(){"use strict";if(!(this instanceof i.lookupTable))return new i.lookupTable;i.texture.call(this);var t=i.timestamp(),e=[0,0];return this.m_colorTable=[.07514311,.468049805,1,1,.247872569,.498782363,1,1,.339526309,.528909511,1,1,.409505078,.558608486,1,1,.468487184,.588057293,1,1,.520796675,.617435078,1,1,.568724526,.646924167,1,1,.613686735,.676713218,1,1,.656658579,.707001303,1,1,.698372844,.738002964,1,1,.739424025,.769954435,1,1,.780330104,.803121429,1,1,.821573924,.837809045,1,1,.863634967,.874374691,1,1,.907017747,.913245283,1,1,.936129275,.938743558,.983038586,1,.943467973,.943498599,.943398095,1,.990146732,.928791426,.917447482,1,1,.88332677,.861943246,1,1,.833985467,.803839606,1,1,.788626485,.750707739,1,1,.746206642,.701389973,1,1,.70590052,.654994046,1,1,.667019783,.610806959,1,1,.6289553,.568237474,1,1,.591130233,.526775617,1,1,.552955184,.485962266,1,1,.513776083,.445364274,1,1,.472800903,.404551679,1,1,.428977855,.363073592,1,1,.380759558,.320428137,1,.961891484,.313155629,.265499262,1,.916482116,.236630659,.209939162,1].map(function(t){return 255*t}),this.setup=function(e){0===this.textureUnit()?e.m_context.activeTexture(i.GL.TEXTURE0):1===this.textureUnit()&&e.m_context.activeTexture(i.GL.TEXTURE1),e.m_context.deleteTexture(this.m_textureHandle),this.m_textureHandle=e.m_context.createTexture(),e.m_context.bindTexture(i.GL.TEXTURE_2D,this.m_textureHandle),e.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_MIN_FILTER,i.GL.LINEAR),e.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_MAG_FILTER,i.GL.LINEAR),e.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_WRAP_S,i.GL.CLAMP_TO_EDGE),e.m_context.texParameteri(i.GL.TEXTURE_2D,i.GL.TEXTURE_WRAP_T,i.GL.CLAMP_TO_EDGE),e.m_context.pixelStorei(i.GL.UNPACK_ALIGNMENT,1),this.m_width=this.m_colorTable.length/4,this.m_height=1,this.m_depth=0,e.m_context.texImage2D(i.GL.TEXTURE_2D,0,i.GL.RGBA,this.m_width,this.m_height,this.m_depth,i.GL.RGBA,i.GL.UNSIGNED_BYTE,new Uint8Array(this.m_colorTable)),e.m_context.bindTexture(i.GL.TEXTURE_2D,null),t.modified()},this.colorTable=function(){return this.m_colorTable},this.setColorTable=function(t){return this.m_colorTable===t?!1:(this.m_colorTable=t,this.modified(),!0)},this.range=function(){return e},this.setRange=function(t){return e===t?!1:(e=t,this.modified(),!0)},this.updateRange=function(t){t instanceof Array||console.log("[error] Invalid data type for range. Requires array [min,max]"),t[0]<e[0]&&(e[0]=t[0],this.modified()),t[1]>e[1]&&(e[1]=t[1],this.modified())},this},t(i.lookupTable,i.texture),i.uniform=function(t,e){"use strict";if(!(this instanceof i.uniform))return new i.uniform;this.getTypeNumberOfComponents=function(t){switch(t){case i.GL.FLOAT:case i.GL.INT:case i.GL.BOOL:return 1;case i.GL.FLOAT_VEC2:case i.GL.INT_VEC2:case i.GL.BOOL_VEC2:return 2;case i.GL.FLOAT_VEC3:case i.GL.INT_VEC3:case i.GL.BOOL_VEC3:return 3;case i.GL.FLOAT_VEC4:case i.GL.INT_VEC4:case i.GL.BOOL_VEC4:return 4;case i.GL.FLOAT_MAT3:return 9;case i.GL.FLOAT_MAT4:return 16;default:return 0}};var r=t,n=e,o=[];return o.length=this.getTypeNumberOfComponents(r),this.name=function(){return n},this.type=function(){return r},this.get=function(){return o},this.set=function(t){var e=0;if(16===o.length)for(e=0;16>e;e+=1)o[e]=t[e];else if(9===o.length)for(e=0;9>e;e+=1)o[e]=t[e];else if(4===o.length)for(e=0;4>e;e+=1)o[e]=t[e];else if(3===o.length)for(e=0;3>e;e+=1)o[e]=t[e];else if(2===o.length)for(e=0;2>e;e+=1)o[e]=t[e];else o[0]=t},this.callGL=function(t,e){if(!(this.m_numberElements<1))switch(r){case i.GL.BOOL:case i.GL.INT:t.m_context.uniform1iv(e,o);break;case i.GL.FLOAT:t.m_context.uniform1fv(e,o);break;case i.GL.FLOAT_VEC2:t.m_context.uniform2fv(e,o);break;case i.GL.FLOAT_VEC3:t.m_context.uniform3fv(e,o);break;case i.GL.FLOAT_VEC4:t.m_context.uniform4fv(e,o);break;case i.GL.FLOAT_MAT3:t.m_context.uniformMatrix3fv(e,i.GL.FALSE,o);break;case i.GL.FLOAT_MAT4:t.m_context.uniformMatrix4fv(e,i.GL.FALSE,o)}},this.update=function(t,e){t=t,e=e},this},i.modelViewUniform=function(t){"use strict";return this instanceof i.modelViewUniform?(0===t.length&&(t="modelViewMatrix"),i.uniform.call(this,i.GL.FLOAT_MAT4,t),this.set(o.create()),this.update=function(t,e){e=e,this.set(t.m_modelViewMatrix)},this):new i.modelViewUniform(t)},t(i.modelViewUniform,i.uniform),i.modelViewOriginUniform=function(t,e){"use strict";if(!(this instanceof i.modelViewOriginUniform))return new i.modelViewOriginUniform(t,e);0===t.length&&(t="modelViewMatrix"),e=e||[0,0,0];var r=[e[0],e[1],e[2]||0];return i.uniform.call(this,i.GL.FLOAT_MAT4,t),this.set(o.create()),this.setOrigin=function(t){t=t||[0,0,0],r=[t[0],t[1],t[2]||0]},this.update=function(t,e){e=e;var i=o.create();if(o.translate(i,t.m_modelViewMatrix,r),t.m_modelViewAlignment){var n=t.m_modelViewAlignment;i[12]=Math.round(i[12]/n.roundx)*n.roundx+n.dx,i[13]=Math.round(i[13]/n.roundy)*n.roundy+n.dy}this.set(i)},this},t(i.modelViewOriginUniform,i.uniform),i.projectionUniform=function(t){"use strict";return this instanceof i.projectionUniform?(0===t.length&&(t="projectionMatrix"),i.uniform.call(this,i.GL.FLOAT_MAT4,t),this.set(o.create()),this.update=function(t,e){e=e,this.set(t.m_projectionMatrix)},this):new i.projectionUniform(t)},t(i.projectionUniform,i.uniform),i.floatUniform=function(t,e){"use strict";return this instanceof i.floatUniform?(0===t.length&&(t="floatUniform"),e=void 0===e?1:e,i.uniform.call(this,i.GL.FLOAT,t),void this.set(e)):new i.floatUniform(t,e)},t(i.floatUniform,i.uniform),i.normalMatrixUniform=function(t){"use strict";return this instanceof i.normalMatrixUniform?(0===t.length&&(t="normalMatrix"),i.uniform.call(this,i.GL.FLOAT_MAT4,t),this.set(o.create()),this.update=function(t,e){e=e,this.set(t.m_normalMatrix)},this):new i.normalMatrixUniform(t)},t(i.normalMatrixUniform,i.uniform),i.vertexAttributeKeys={Position:0,Normal:1,TextureCoordinate:2,Color:3,Scalar:4,CountAttributeIndex:5},i.vertexAttributeKeysIndexed={Zero:0,One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9},i.vertexAttribute=function(t){"use strict";if(!(this instanceof i.vertexAttribute))return new i.vertexAttribute(t);var e=t;this.name=function(){return e},this.bindVertexData=function(t,i){var r=t.m_mapper.geometryData(),n=r.sourceData(i),o=t.m_material.shaderProgram();t.m_context.vertexAttribPointer(o.attributeLocation(e),n.attributeNumberOfComponents(i),n.attributeDataType(i),n.normalized(i),n.attributeStride(i),n.attributeOffset(i)),t.m_context.enableVertexAttribArray(o.attributeLocation(e))},this.undoBindVertexData=function(t,i){i=i;var r=t.m_material.shaderProgram();t.m_context.disableVertexAttribArray(r.attributeLocation(e))}},i.source=function(){"use strict";return this instanceof i.source?(i.object.call(this),this.create=function(){},this):new i.source},t(i.source,i.object),i.planeSource=function(){"use strict";if(!(this instanceof i.planeSource))return new i.planeSource;i.source.call(this);var t=[0,0,0],e=[1,0,0],r=[0,1,0],n=[0,0,1],o=1,a=1,s=null;this.setOrigin=function(e,i,r){t[0]=e,t[1]=i,t[2]=r},this.setPoint1=function(t,i,r){e[0]=t,e[1]=i,e[2]=r},this.setPoint2=function(t,e,i){r[0]=t,r[1]=e,r[2]=i},this.create=function(){s=new i.geometryData;var u,h,l,c,d,f,m,p=[],v=[],g=[],y=[],x=[],_=0,M=0,b=0,w=0,T=[],A=[],E=[],P=[],R=[],S=null,C=null,L=null;for(p.length=3,v.length=2,g.length=3,y.length=3,x.length=3,u=0;3>u;u+=1)g[u]=e[u]-t[u],y[u]=r[u]-t[u];for(d=(o+1)*(a+1),f=o*a*2,T.length=3*d,A.length=3*d,P.length=2*d,R.length=d,l=0,u=0;a+1>u;u+=1)for(v[1]=u/a,h=0;o+1>h;h+=1){for(v[0]=h/o,c=0;3>c;c+=1)p[c]=t[c]+v[0]*g[c]+v[1]*y[c];T[_++]=p[0],T[_++]=p[1],T[_++]=p[2],E[b++]=1,E[b++]=1,E[b++]=1,A[M++]=n[0],A[M++]=n[1],A[M++]=n[2],P[w++]=v[0],P[w++]=v[1]}for(u=0;a>u;u+=1)for(h=0;o>h;h+=1)x[0]=h+u*(o+1),x[1]=x[0]+1,x[2]=x[0]+o+2,x[3]=x[0]+o+1;for(u=0;d>u;u+=1)R[u]=u;return S=new i.triangleStrip,S.setIndices(R),C=i.sourceDataP3fv(),C.pushBack(T),L=i.sourceDataC3fv(),L.pushBack(E),m=i.sourceDataT2fv(),m.pushBack(P),s.addSource(C),s.addSource(L),s.addSource(m),s.addPrimitive(S),s}},t(i.planeSource,i.source),i.pointSource=function(){"use strict";if(!(this instanceof i.pointSource))return new i.pointSource;i.source.call(this);var t=this,e=[],r=[],n=[],o=[],a=null;this.getPositions=function(){return e},this.setPositions=function(i){i instanceof Array?e=i:console.log("[ERROR] Invalid data type for positions. Array is required."),t.modified()},this.getColors=function(){return r},this.setColors=function(e){e instanceof Array?r=e:console.log("[ERROR] Invalid data type for colors. Array is required."),t.modified()},this.getSize=function(){return o},this.setSize=function(t){o=t,this.modified()},this.setTextureCoordinates=function(e){e instanceof Array?n=e:console.log("[ERROR] Invalid data type for texture coordinates. Array is required."),t.modified()},this.create=function(){if(a=new i.geometryData,e.length%3!==0)return void console.log("[ERROR] Invalid length of the points array");var t,s,u,h,l,c=e.length/3,d=0,f=[];for(f.length=c,d=0;c>d;d+=1)f[d]=d;if(l=i.sourceDataDf(),c!==o.length)for(d=0;c>d;d+=1)l.pushBack(o);else l.setData(o);return a.addSource(l),t=new i.points,t.setIndices(f),s=i.sourceDataP3fv(),s.pushBack(e),a.addSource(s),r.length>0&&r.length===e.length?(u=i.sourceDataC3fv(),u.pushBack(r),a.addSource(u)):r.length>0&&r.length!==e.length&&console.log("[ERROR] Number of colors are different than number of points"),n.length>0&&n.length===e.length?(h=i.sourceDataT2fv(),h.pushBack(n),a.addSource(h)):n.length>0&&n.length/2!==e.length/3&&console.log("[ERROR] Number of texture coordinates are different than number of points"),a.addPrimitive(t),a}},t(i.pointSource,i.source),i.lineSource=function(t,e){"use strict";if(!(this instanceof i.lineSource))return new i.lineSource;i.source.call(this);var r=t,n=e;this.setPositions=function(t){return t instanceof Array?(r=t,this.modified(),!0):(console.log("[ERROR] Invalid data type for positions. Array is required."),!1)},this.setColors=function(t){return t instanceof Array?(n=t,this.modified(),!0):(console.log("[ERROR] Invalid data type for colors. Array is required."),!1)},this.create=function(){if(!r)return void console.log("[error] Invalid positions");if(r.length%3!==0)return void console.log("[error] Line source requires 3d points");if(r.length%3!==0)return void console.log("[ERROR] Invalid length of the points array");var t,e,o,a,s=new i.geometryData,u=r.length/3,h=[];for(h.length=u,t=0;u>t;t+=1)h[t]=t;return e=new i.lines,e.setIndices(h),o=i.sourceDataP3fv(),o.pushBack(r),s.addSource(o),n&&n.length>0&&n.length===r.length?(a=i.sourceDataC3fv(),a.pushBack(n),s.addSource(a)):n&&n.length>0&&n.length!==r.length&&console.log("[error] Number of colors are different than number of points"),s.addPrimitive(e),s}},t(i.lineSource,i.source),i.utils=function(){"use strict";return this instanceof i.utils?(i.object.call(this),this):new i.utils},t(i.utils,i.object),i.utils.computePowerOfTwo=function(t,e){"use strict";for(e=e||1;t>e;)e*=2;return e},i.utils.createTextureVertexShader=function(t){"use strict";var e=["attribute vec3 vertexPosition;","attribute vec3 textureCoord;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iTextureCoord = textureCoord;","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createTextureFragmentShader=function(t){"use strict";var e=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyz, opacity);","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createRgbaTextureFragmentShader=function(t){"use strict";var e=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","  mediump vec4 color = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyzw);","  color.w *= opacity;","  gl_FragColor = color;","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createVertexShader=function(t){"use strict";var e=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createPointVertexShader=function(t){"use strict";var e=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","attribute float vertexSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize =  vertexSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createVertexShaderSolidColor=function(t){"use strict";var e=["attribute vec3 vertexPosition;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createVertexShaderColorMap=function(t,e,r){"use strict";e=e,r=r;var n=["attribute vec3 vertexPosition;","attribute float vertexScalar;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float lutMin;","uniform float lutMax;","varying mediump float iVertexScalar;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","iVertexScalar = (vertexScalar-lutMin)/(lutMax-lutMin);","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,n)},i.utils.createFragmentShader=function(t){"use strict";var e=["varying mediump vec3 iVertexColor;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(iVertexColor, opacity);","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createPhongVertexShader=function(t){"use strict";var e=["attribute highp vec3 vertexPosition;","attribute mediump vec3 vertexNormal;","attribute mediump vec3 vertexColor;","uniform highp mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 normalMatrix;","varying highp vec4 varPosition;","varying mediump vec3 varNormal;","varying mediump vec3 varVertexColor;","void main(void)","{","varPosition = modelViewMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * varPosition;","varNormal = vec3(normalMatrix * vec4(vertexNormal, 0.0));","varVertexColor = vertexColor;","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createPhongFragmentShader=function(t){"use strict";var e=["uniform mediump float opacity;","precision mediump float;","varying vec3 varNormal;","varying vec4 varPosition;","varying mediump vec3 varVertexColor;","const vec3 lightPos = vec3(0.0, 0.0,10000.0);","const vec3 ambientColor = vec3(0.01, 0.01, 0.01);","const vec3 specColor = vec3(0.0, 0.0, 0.0);","void main() {","vec3 normal = normalize(varNormal);","vec3 lightDir = normalize(lightPos);","vec3 reflectDir = -reflect(lightDir, normal);","vec3 viewDir = normalize(-varPosition.xyz);","float lambertian = max(dot(lightDir, normal), 0.0);","vec3 color = vec3(0.0);","if(lambertian > 0.0) {","  color = lambertian * varVertexColor;","}","gl_FragColor = vec4(color * opacity, 1.0 - opacity);","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createFragmentShaderSolidColor=function(t,e){"use strict";var r=["uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4("+e[0]+","+e[1]+","+e[2]+", opacity);","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,r)},i.utils.createFragmentShaderColorMap=function(t){"use strict";var e=["varying mediump float iVertexScalar;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iVertexScalar, 0.0)).xyz, opacity);","}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createPointSpritesVertexShader=function(t){"use strict";var e=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump vec2 pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float height;","varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","void main(void)","{","mediump float realPointSize = pointSize.y;","if (pointSize.x > pointSize.y) {","  realPointSize = pointSize.x;}","gl_PointSize = realPointSize ;","iVertexScalar = vertexPosition.z;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition.xy, height, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return i.getCachedShader(i.GL.VERTEX_SHADER,t,e)},i.utils.createPointSpritesFragmentShader=function(t){"use strict";
var e=["varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","uniform sampler2D opacityLookup;","uniform highp float lutMin;","uniform highp float lutMax;","uniform sampler2D scalarsToColors;","uniform int useScalarsToColors;","uniform int useVertexColors;","uniform mediump vec2 pointSize;","uniform mediump float vertexColorWeight;","void main(void) {","mediump vec2 realTexCoord;","if (pointSize.x > pointSize.y) {","  realTexCoord = vec2(1.0, pointSize.y/pointSize.x) * gl_PointCoord;","} else {","  realTexCoord = vec2(pointSize.x/pointSize.y, 1.0) * gl_PointCoord;","}","highp float texOpacity = texture2D(opacityLookup, realTexCoord).w;","if (useScalarsToColors == 1) {","  gl_FragColor = vec4(texture2D(scalarsToColors, vec2((iVertexScalar - lutMin)/(lutMax - lutMin), 0.0)).xyz, texOpacity);","} else if (useVertexColors == 1) {","  gl_FragColor = vec4(iVertexColor, texOpacity);","} else {","  gl_FragColor = vec4(texture2D(opacityLookup, realTexCoord).xyz, texOpacity);","}}"].join("\n");return i.getCachedShader(i.GL.FRAGMENT_SHADER,t,e)},i.utils.createTextureMaterial=function(t,e){"use strict";var r,n=new i.material,o=new i.blend,a=new i.shaderProgram,s=i.utils.createTextureVertexShader(i.GL),u=null,h=new i.vertexAttribute("vertexPosition"),l=new i.vertexAttribute("textureCoord"),c=new i.floatUniform("pointSize",5),d=new i.projectionUniform("projectionMatrix"),f=new i.uniform(i.GL.INT,"sampler2d"),m=null;return r=void 0!==e?new i.modelViewOriginUniform("modelViewMatrix",e):new i.modelViewUniform("modelViewMatrix"),f.set(0),a.addVertexAttribute(h,i.vertexAttributeKeys.Position),a.addVertexAttribute(l,i.vertexAttributeKeys.TextureCoordinate),a.addUniform(c),a.addUniform(r),a.addUniform(d),u=t?i.utils.createRgbaTextureFragmentShader(i.GL):i.utils.createTextureFragmentShader(i.GL),m=new i.floatUniform("opacity",1),a.addUniform(m),a.addShader(u),a.addShader(s),n.addAttribute(a),n.addAttribute(o),n},i.utils.createGeometryMaterial=function(){"use strict";var t=new i.material,e=new i.shaderProgram,r=5,n=1,o=i.utils.createVertexShader(i.GL),a=i.utils.createFragmentShader(i.GL),s=new i.vertexAttribute("vertexPosition"),u=new i.vertexAttribute("vertexColor"),h=new i.floatUniform("pointSize",r),l=new i.floatUniform("opacity",n),c=new i.modelViewUniform("modelViewMatrix"),d=new i.projectionUniform("projectionMatrix");return e.addVertexAttribute(s,i.vertexAttributeKeys.Position),e.addVertexAttribute(u,i.vertexAttributeKeys.Color),e.addUniform(h),e.addUniform(l),e.addUniform(c),e.addUniform(d),e.addShader(a),e.addShader(o),t.addAttribute(e),t},i.utils.createPointGeometryMaterial=function(t){"use strict";t=void 0===t?1:t;var e=new i.material,r=new i.blend,n=new i.shaderProgram,o=i.utils.createPointVertexShader(i.GL),a=i.utils.createFragmentShader(i.GL),s=new i.vertexAttribute("vertexPosition"),u=new i.vertexAttribute("vertexColor"),h=new i.vertexAttribute("vertexSize"),l=new i.floatUniform("opacity",t),c=new i.modelViewUniform("modelViewMatrix"),d=new i.projectionUniform("projectionMatrix");return n.addVertexAttribute(s,i.vertexAttributeKeys.Position),n.addVertexAttribute(u,i.vertexAttributeKeys.Color),n.addVertexAttribute(h,i.vertexAttributeKeys.Scalar),n.addUniform(l),n.addUniform(c),n.addUniform(d),n.addShader(a),n.addShader(o),e.addAttribute(n),e.addAttribute(r),e},i.utils.createPhongMaterial=function(){"use strict";var t=new i.material,e=new i.shaderProgram,r=i.utils.createPhongVertexShader(i.GL),n=i.utils.createPhongFragmentShader(i.GL),o=new i.vertexAttribute("vertexPosition"),a=new i.vertexAttribute("vertexNormal"),s=new i.vertexAttribute("vertexColor"),u=new i.floatUniform("opacity",1),h=new i.modelViewUniform("modelViewMatrix"),l=new i.normalMatrixUniform("normalMatrix"),c=new i.projectionUniform("projectionMatrix");return e.addVertexAttribute(o,i.vertexAttributeKeys.Position),e.addVertexAttribute(a,i.vertexAttributeKeys.Normal),e.addVertexAttribute(s,i.vertexAttributeKeys.Color),e.addUniform(u),e.addUniform(h),e.addUniform(c),e.addUniform(l),e.addShader(n),e.addShader(r),t.addAttribute(e),t},i.utils.createColorMaterial=function(){"use strict";var t=new i.material,e=new i.blend,r=new i.shaderProgram,n=i.utils.createVertexShader(i.GL),o=i.utils.createFragmentShader(i.GL),a=new i.vertexAttribute("vertexPosition"),s=new i.vertexAttribute("textureCoord"),u=new i.vertexAttribute("vertexColor"),h=new i.floatUniform("pointSize",5),l=new i.floatUniform("opacity",1),c=new i.modelViewUniform("modelViewMatrix"),d=new i.projectionUniform("projectionMatrix");return r.addVertexAttribute(a,i.vertexAttributeKeys.Position),r.addVertexAttribute(u,i.vertexAttributeKeys.Color),r.addVertexAttribute(s,i.vertexAttributeKeys.TextureCoordinate),r.addUniform(h),r.addUniform(l),r.addUniform(c),r.addUniform(d),r.addShader(o),r.addShader(n),t.addAttribute(r),t.addAttribute(e),t},i.utils.createColorMappedMaterial=function(t){"use strict";t||(t=new i.lookupTable);var e=t.range(),r=new i.material,n=new i.blend,o=new i.shaderProgram,a=i.utils.createVertexShaderColorMap(i.GL,e[0],e[1]),s=i.utils.createFragmentShaderColorMap(i.GL),u=new i.vertexAttribute("vertexPosition"),h=new i.vertexAttribute("vertexScalar"),l=new i.floatUniform("pointSize",5),c=new i.floatUniform("opacity",1),d=new i.floatUniform("lutMin",e[0]),f=new i.floatUniform("lutMax",e[1]),m=new i.modelViewUniform("modelViewMatrix"),p=new i.projectionUniform("projectionMatrix"),v=new i.uniform(i.GL.FLOAT,"sampler2d"),g=t;return v.set(0),o.addVertexAttribute(u,i.vertexAttributeKeys.Position),o.addVertexAttribute(h,i.vertexAttributeKeys.Scalar),o.addUniform(l),o.addUniform(c),o.addUniform(d),o.addUniform(f),o.addUniform(m),o.addUniform(p),o.addShader(s),o.addShader(a),r.addAttribute(o),r.addAttribute(n),r.addAttribute(g),r},i.utils.updateColorMappedMaterial=function(t,e){"use strict";if(!t)return void console.log("[warning] Invalid material. Nothing to update.");if(!e)return void console.log("[warning] Invalid lookup table. Nothing to update.");var i=t.shaderProgram().uniform("lutMin"),r=t.shaderProgram().uniform("lutMax");i.set(e.range()[0]),r.set(e.range()[1]),t.setAttribute(e)},i.utils.createSolidColorMaterial=function(t){"use strict";t||(t=[1,1,1]);var e=new i.material,r=new i.blend,n=new i.shaderProgram,o=i.utils.createVertexShaderSolidColor(i.GL),a=i.utils.createFragmentShaderSolidColor(i.GL,t),s=new i.vertexAttribute("vertexPosition"),u=new i.floatUniform("pointSize",5),h=new i.floatUniform("opacity",1),l=new i.modelViewUniform("modelViewMatrix"),c=new i.projectionUniform("projectionMatrix");return n.addVertexAttribute(s,i.vertexAttributeKeys.Position),n.addUniform(u),n.addUniform(h),n.addUniform(l),n.addUniform(c),n.addShader(a),n.addShader(o),e.addAttribute(n),e.addAttribute(r),e},i.utils.createPointSpritesMaterial=function(t,e){"use strict";var r=void 0===e?[0,1]:e.range(),n=new i.material,o=new i.blend,a=new i.shaderProgram,s=i.utils.createPointSpritesVertexShader(i.GL),u=i.utils.createPointSpritesFragmentShader(i.GL),h=new i.vertexAttribute("vertexPosition"),l=new i.vertexAttribute("vertexColor"),c=new i.floatUniform("height",0),d=new i.floatUniform("vertexColorWeight",0),f=new i.floatUniform("lutMin",r[0]),m=new i.floatUniform("lutMax",r[1]),p=new i.modelViewUniform("modelViewMatrix"),v=new i.projectionUniform("projectionMatrix"),g=new i.uniform(i.GL.INT,"opacityLookup"),y=new i.uniform(i.GL.INT,"scalarsToColors"),x=new i.uniform(i.GL.INT,"useScalarsToColors"),_=new i.uniform(i.GL.INT,"useVertexColors"),M=new i.uniform(i.GL.FLOAT_VEC2,"pointSize"),b=new i.texture;return g.set(0),y.set(1),x.set(0),_.set(0),M.set([1,1]),a.addVertexAttribute(h,i.vertexAttributeKeys.Position),a.addVertexAttribute(l,i.vertexAttributeKeys.Color),a.addUniform(c),a.addUniform(d),a.addUniform(p),a.addUniform(v),a.addUniform(g),a.addUniform(_),a.addUniform(x),a.addUniform(M),a.addShader(u),a.addShader(s),n.addAttribute(a),n.addAttribute(o),e&&(a.addUniform(y),x.set(1),a.addUniform(f),a.addUniform(m),e.setTextureUnit(1),n.addAttribute(e)),b.setImage(t),b.setTextureUnit(0),n.addAttribute(b),n},i.utils.createPlane=function(t,e,r,n,o,a,s,u,h){"use strict";var l=new i.mapper,c=new i.planeSource,d=i.utils.createGeometryMaterial(),f=new i.actor;return c.setOrigin(t,e,r),c.setPoint1(n,o,a),c.setPoint2(s,u,h),l.setGeometryData(c.create()),f.setMapper(l),f.setMaterial(d),f},i.utils.createTexturePlane=function(t,e,r,n,o,a,s,u,h,l){"use strict";var c=new i.mapper,d=new i.planeSource,f=i.utils.createTextureMaterial(l,[t,e,r]),m=new i.actor;return d.setPoint1(n-t,o-e,a-r),d.setPoint2(s-t,u-e,h-r),c.setGeometryData(d.create()),m.setMapper(c),m.setMaterial(f),m},i.utils.createPoints=function(t,e,r,n,o){"use strict";if(!t)return console.log("[ERROR] Cannot create points without positions"),null;o=void 0===o?1:o;var a=new i.mapper,s=new i.pointSource,u=i.utils.createPointGeometryMaterial(o),h=new i.actor;return s.setPositions(t),r&&s.setColors(r),n&&s.setTextureCoordinates(n),e?s.setSize(e):s.setSize(1),a.setGeometryData(s.create()),h.setMapper(a),h.setMaterial(u),h},i.utils.createPointSprites=function(t,e,r,n){"use strict";if(!t)return console.log("[ERROR] Point sprites requires an image"),null;if(!e)return console.log("[ERROR] Cannot create points without positions"),null;var o=new i.mapper,a=new i.pointSource,s=i.utils.createPointSpritesMaterial(t),u=new i.actor;return a.setPositions(e),r&&a.setColors(r),n&&a.setTextureCoordinates(n),o.setGeometryData(a.create()),u.setMapper(o),u.setMaterial(s),u},i.utils.createLines=function(t,e){"use strict";if(!t)return console.log("[ERROR] Cannot create points without positions"),null;var r=new i.mapper,n=new i.lineSource,o=i.utils.createGeometryMaterial(),a=new i.actor;return n.setPositions(t),e&&n.setColors(e),r.setGeometryData(n.create()),a.setMapper(r),a.setMaterial(o),a},i.utils.createColorLegend=function(t,e,r,n,o,a,s){"use strict";function u(t,e,r){if(!e)return void console.log("[error] Create labels requires positions (x,y,z) array");if(e.length%3!==0)return void console.log("[error] Create labels require positions array contain 3d points");if(!r)return void console.log("[error] Create labels requires Valid range");var n,o=null,a=i.utils.computePowerOfTwo(48),s=0,u=[],h=[],l=[],c=[],d=e[6]-e[0],f=4;for(h.length=3,l.length=3,c.length=3,n=0;2>n;n+=1)s=n*(e.length-3),h[0]=e[s]-d,h[1]=e[s+1]-2*d,h[2]=e[s+2],l[0]=e[s]+d,l[1]=h[1],l[2]=h[2],c[0]=h[0],c[1]=e[1],c[2]=h[2],o=i.utils.createTexturePlane(h[0],h[1],h[2],l[0],l[1],l[2],c[0],c[1],c[2],!0),o.setReferenceFrame(i.boundingObject.ReferenceFrame.Absolute),o.material().setBinNumber(i.material.RenderBin.Overlay),o.material().addAttribute(i.utils.create2DTexture(r[n].toFixed(2).toString(),12,null)),u.push(o);return h[0]=.5*(e[0]+e[e.length-3]-a),h[1]=e[1]+f,h[2]=e[2],l[0]=h[0]+a,l[1]=h[1],l[2]=h[2],c[0]=h[0],c[1]=h[1]+a,c[2]=h[2],o=i.utils.createTexturePlane(h[0],h[1],h[2],l[0],l[1],l[2],c[0],c[1],c[2],!0),o.setReferenceFrame(i.boundingObject.ReferenceFrame.Absolute),o.material().setBinNumber(i.material.RenderBin.Overlay),o.material().addAttribute(i.utils.create2DTexture(t,24,null)),u.push(o),u}function h(t,e,i,r,n,o,a,s,h,l,c,d,f,m,p){p=p;var v=h-o,g=null,y=v/d,x=[],_=[];for(g=0;d>=g;g+=1)x.push(o+y*g),x.push(a),x.push(s),x.push(o+y*g),x.push(a+m),x.push(s);return _=_.concat(u(t,x,e.range()))}if(!e)return console.log("[error] Invalid lookup table"),[];var l=r[0]+n,c=r[1],d=0,f=r[0],m=r[1]+o,p=0,v=[],g=null,y=null,x=i.groupNode();return g=i.utils.createTexturePlane(r[0],r[1],r[2],l,c,d,f,m,p,!0),y=g.material(),y.addAttribute(e),g.setMaterial(y),x.addChild(g),g.material().setBinNumber(i.material.RenderBin.Overlay),g.setReferenceFrame(i.boundingObject.ReferenceFrame.Absolute),v.push(g),v=v.concat(h(t,e,r[0],r[1],r[1],f,c,d,l,c,d,a,s,5,3))},i.utils.create2DTexture=function(t,e,r,n,o,a,s){"use strict";var u=document.getElementById("textRendering"),h=null,l=i.texture();return n=n||"sans-serif",o=o||"center",a=a||"bottom","undefined"==typeof s&&(s=!0),u||(u=document.createElement("canvas")),h=u.getContext("2d"),u.setAttribute("id","textRendering"),u.style.display="none",u.height=i.utils.computePowerOfTwo(8*e),u.width=u.height,h.fillStyle="rgba(0, 0, 0, 0)",h.fillRect(0,0,h.canvas.width,h.canvas.height),h.fillStyle="rgba(200, 85, 10, 1.0)",h.textAlign=o,h.textBaseline=a,h.font=4*e+"px "+n,s&&(h.font="bold "+h.font),h.fillText(t,u.width/2,u.height/2,u.width),l.setImage(u),l.updateDimensions(),l},i.picker=function(){"use strict";if(!(this instanceof i.picker))return new i.picker;i.object.call(this);var t=[];return this.getActors=function(){return t},this.pick=function(e,i,r){if(void 0===e)return 0;if(void 0===i)return 0;if(void 0===r)return 0;t=[];var n,o,s,u,h,l,c,d,f,m,p,v=r.camera(),g=r.width(),y=r.height(),x=v.focalPoint(),_=a.fromValues(x[0],x[1],x[2],1),M=r.worldToDisplay(_,v.viewMatrix(),v.projectionMatrix(),g,y),b=a.fromValues(e,i,M[2],1),w=r.displayToWorld(b,v.viewMatrix(),v.projectionMatrix(),g,y),T=v.position(),A=[];for(s=0;3>s;s+=1)A[s]=w[s]-T[s];for(n=r.sceneRoot().children(),o=0,s=0;s<n.length;s+=1)if(p=n[s],p.visible()===!0){if(u=p.bounds(),A[0]>=0?(h=(u[0]-T[0])/A[0],l=(u[1]-T[0])/A[0]):(h=(u[1]-T[0])/A[0],l=(u[0]-T[0])/A[0]),A[1]>=0?(c=(u[2]-T[1])/A[1],d=(u[3]-T[1])/A[1]):(c=(u[3]-T[1])/A[1],d=(u[2]-T[1])/A[1]),h>d||c>l)continue;if(c>h&&(h=c),l>d&&(l=d),A[2]>=0?(f=(u[4]-T[2])/A[2],m=(u[5]-T[2])/A[2]):(f=(u[5]-T[2])/A[2],m=(u[4]-T[2])/A[2]),h>m||f>l)continue;f>h&&(h=f),l>m&&(l=m),t[o]=p,o+=1}return o},this},t(i.picker,i.object),i.shapefileReader=function(){"use strict";if(!(this instanceof i.shapefileReader))return new i.shapefileReader;var t=this,e=0,r=1,n=5,o=3;return this.int8=function(t,e){return t.charCodeAt(e)},this.bint32=function(t,e){return((255&t.charCodeAt(e))<<24)+((255&t.charCodeAt(e+1))<<16)+((255&t.charCodeAt(e+2))<<8)+(255&t.charCodeAt(e+3))},this.lint32=function(t,e){return((255&t.charCodeAt(e+3))<<24)+((255&t.charCodeAt(e+2))<<16)+((255&t.charCodeAt(e+1))<<8)+(255&t.charCodeAt(e))},this.bint16=function(t,e){return((255&t.charCodeAt(e))<<8)+(255&t.charCodeAt(e+1))},this.lint16=function(t,e){return((255&t.charCodeAt(e+1))<<8)+(255&t.charCodeAt(e))},this.ldbl64=function(t,e){var i=255&t.charCodeAt(e),r=255&t.charCodeAt(e+1),n=255&t.charCodeAt(e+2),o=255&t.charCodeAt(e+3),a=255&t.charCodeAt(e+4),s=255&t.charCodeAt(e+5),u=255&t.charCodeAt(e+6),h=255&t.charCodeAt(e+7),l=1-2*(h>>7),c=((127&h)<<4)+((240&u)>>4)-1023,d=(15&u)*Math.pow(2,48)+s*Math.pow(2,40)+a*Math.pow(2,32)+o*Math.pow(2,24)+n*Math.pow(2,16)+r*Math.pow(2,8)+i;return l*(1+d*Math.pow(2,-52))*Math.pow(2,c)},this.lfloat32=function(t,e){var i=255&t.charCodeAt(e),r=255&t.charCodeAt(e+1),n=255&t.charCodeAt(e+2),o=255&t.charCodeAt(e+3),a=1-2*(o>>7),s=((127&o)<<1)+((254&n)>>7)-127,u=(127&n)*Math.pow(2,16)+r*Math.pow(2,8)+i;return a*(1+u*Math.pow(2,-23))*Math.pow(2,s)},this.str=function(t,e,i){for(var r=[],n=e;e+i>n;){var o=t[n];if(0===o.charCodeAt(0))break;r.push(o),n+=1}return r.join("")},this.readHeader=function(t){var e=this.bint32(t,0),i=this.bint32(t,24),r=this.lint32(t,28),n=this.lint32(t,32);return{code:e,length:i,version:r,shapetype:n}},this.loadShx=function(e){for(var i=[],r=function(r){return i.push(2*t.bint32(e,r)),r+8},n=100;n<e.length;)n=r(n);return i},this.Shapefile=function(t){var e=t.path;h.ajax({url:e+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(i){var r=this.loadShx(i);h.ajax({url:e+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(i){h.ajax({url:e+".dbf",mimeType:"text/plain; charset=x-user-defined",success:function(e){var n=this.loadShp(i,e,r,t);t.success(n)}})}})}})},this.localShapefile=function(e){var i=e.shx,r=e.shp,n=e.dbf,o=new FileReader;o.onloadend=function(){var i=t.loadShx(o.result),a=new FileReader;a.onloadend=function(){var r=a.result,o=new FileReader;o.onloadend=function(){var n=o.result,a=t.loadShp(r,n,i,e);e.success(a)},o.readAsBinaryString(n)},a.readAsBinaryString(r)},o.readAsBinaryString(i)},this.loadDBF=function(e){var i=function(i){var r=t.str(e,i,10),n=t.str(e,i+11,1),o=t.int8(e,i+16);return{name:r,type:n,length:o}},r=t.int8(e,0);if(4===r)throw"Level 7 dBASE not supported";for(var n=t.lint32(e,4),o=t.lint16(e,8),a=t.lint16(e,10),s=32,u=32,h=s,l=[];o-1>h;)l.push(i(h)),h+=u;for(var c=[],d=o;o+n*a>d;){var f=t.str(e,d,1);if("*"===f)d+=a;else{d+=1;for(var m={},p=0;p<l.length;p+=1){var v,g=l[p];"C"===g.type?v=t.str(e,d,g.length).trim():"N"===g.type&&(v=parseFloat(t.str(e,d,g.length))),d+=g.length,m[g.name]=v}c.push(m)}}return c},this.loadShp=function(i,a,s,u){u=u;var h,l=[],c=function(e,r,n){for(var o=[],a=n-1;a>=r;a-=1){var s=t.ldbl64(i,e+16*a),u=t.ldbl64(i,e+16*a+8);o.push([s,u])}return o},d=function(a){var s,u,h,d,f,m,p,v,g,y=a+8,x=t.lint32(i,y);if(x===e)console.log("NULL Shape");else if(x===r){var _=t.ldbl64(i,y+4),M=t.ldbl64(i,y+12);l.push({type:"Point",attr:{},geom:[[_,M]]})}else if(x===n){for(s=t.lint32(i,y+36),u=t.lint32(i,y+40),h=a+52,d=a+52+4*s,g=[],f=0;s>f;f+=1)m=t.lint32(i,h+4*f),p=s>f+1?t.lint32(i,h+4*(f+1)):u,v=c(d,m,p),g.push(v);l.push({type:"Polygon",attr:{},geom:[g]})}else{if(x!==o)throw"Not Implemented: "+x;for(s=t.lint32(i,y+36),u=t.lint32(i,y+40),h=a+52,d=a+52+4*s,g=[],f=0;s>f;f+=1)m=t.lint32(i,h+4*f),p=s>f+1?t.lint32(i,h+4*(f+1)):u,v=c(d,m,p),g.push(v);l.push({type:"Polyline",attr:{},geom:[g]})}},f=this.loadDBF(a);for(h=0;h<s.length;h+=1){var m=s[h];d(m)}var p=[];for(h=0;h<l.length;h+=1){var v=l[h];v.attr=f[h],p.push(v)}return p},this},i.vtkReader=function(){"use strict";if(!(this instanceof i.vtkReader))return new i.vtkReader;var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],e=[],r={},n=0,a=null,s=null,u=-1,h="",l=0,c=0,d=null,f=0;if(0===e.length)for(f=0;f<t.length;f+=1)e[t[f]]=f;return this.ntos=function(t){var e;return e=t.toString(16),1===e.length&&(e="0"+e),e="%"+e,unescape(e)},this.readReverseBase64=function(){var t;if(!h)return u;for(;;){if(l>=h.length)return u;if(t=h.charAt(l),l+=1,e[t])return e[t];if("A"===t)return 0}return u},this.decode64=function(t){var e="",i=new Array(4),r=!1;for(h=t,l=0;!r&&(i[0]=this.readReverseBase64())!==u&&(i[1]=this.readReverseBase64())!==u;)i[2]=this.readReverseBase64(),i[3]=this.readReverseBase64(),e+=this.ntos(i[0]<<2&255|i[1]>>4),i[2]!==u?(e+=this.ntos(i[1]<<4&255|i[2]>>2),i[3]!==u?e+=this.ntos(i[2]<<6&255|i[3]):r=!0):r=!0;return e},this.readNumber=function(t){var e=t[c++]+(t[c++]<<8)+(t[c++]<<16)+(t[c++]<<24);return e},this.readF3Array=function(t,e){var i,r=4*t*3,n=new Int8Array(r),o=null;for(i=0;r>i;i+=1)n[i]=e[c],c+=1;return o=new Float32Array(n.buffer)},this.readColorArray=function(t,e,i){var r,n=0,o=new Array(3*t);for(r=0;t>r;r+=1)o[n++]=e[c++]/255,o[n++]=e[c++]/255,o[n++]=e[c++]/255,c++;i.insert(o)},this.parseObject=function(t){var e,r,n,a,s,u,h,l,m,p,v,g=new i.geometryData,y=i.mapper(),x=[],_=null,M=null,b=null,w=null;for(M=atob(t.data),f=0;f<M.length;f+=1)x[f]=255&M.charCodeAt(f);if(c=0,e=this.readNumber(x),_=String.fromCharCode(x[c]),c+=1,g.setName(_),"L"===_)b=this.parseLineData(g,x),w=i.utils.createGeometryMaterial();else if("M"===_)b=this.parseMeshData(g,x),w=i.utils.createPhongMaterial();else if("P"===_)b=this.parsePointData(g,x),w=i.utils.createGeometryMaterial();else{if("C"===_){for(n=this.parseColorMapData(g,x,e),h=[],f=0;f<n.colors.length;f+=1)h.push(n.colors[f][1]),h.push(n.colors[f][2]),h.push(n.colors[f][3]),h.push(255*n.colors[f][0]);return u=new i.lookupTable,u.setColorTable(h),l=d.renderWindow().windowSize(),m=n.size[0]*l[0],p=n.size[1]*l[1],v=[n.position[0]*l[0],(1-n.position[1])*l[1],0],v[1]=v[1]-p,p=30,i.utils.createColorLegend(n.title,u,v,m,p,3,0)}console.log("Ignoring unrecognized encoded data type "+_)}return y.setGeometryData(g),t.hasTransparency&&(a=w.shaderProgram(),s=a.uniform("opacity"),console.log("opacity ",t.opacity),s.set(t.opacity),w.setBinNumber(1e3)),r=i.actor(),r.setMapper(y),r.setMaterial(w),r.setMatrix(o.transpose(o.create(),b)),[r]},this.parseLineData=function(t,e){var r,n,a,s,u,h,l,d,f=null,m=null,p=null,v=o.create(),g=null,y=0;for(n=this.readNumber(e),g=new Array(3*n),f=new i.sourceDataP3fv,a=this.readF3Array(n,e),d=0;n>d;d+=1)g[y++]=a[3*d],g[y++]=a[3*d+1],g[y++]=a[3*d+2];for(f.insert(g),t.addSource(f),m=new i.sourceDataC3fv,this.readColorArray(n,e,m),t.addSource(m),p=new i.lines,t.addPrimitive(p),r=this.readNumber(e),s=new Int8Array(2*r),d=0;2*r>d;d+=1)s[d]=e[c],c+=1;for(u=new Uint16Array(s.buffer),p.setIndices(u),p.setPrimitiveType(i.GL.LINES),h=64,s=new Int8Array(h),d=0;h>d;d+=1)s[d]=e[c],c+=1;return l=new Float32Array(s.buffer),o.copy(v,l),v},this.parseMeshData=function(t,e){var r,n,a,s,u,h,l,d,f,m=null,p=null,v=null,g=o.create(),y=null,x=null,_=0;for(n=this.readNumber(e),x=new Array(6*n),m=new i.sourceDataP3N3f,a=this.readF3Array(n,e),v=this.readF3Array(n,e),d=0;n>d;d+=1)x[_++]=a[3*d],x[_++]=a[3*d+1],x[_++]=a[3*d+2],x[_++]=v[3*d],x[_++]=v[3*d+1],x[_++]=v[3*d+2];for(m.insert(x),t.addSource(m),p=new i.sourceDataC3fv,this.readColorArray(n,e,p),t.addSource(p),s=[],y=new i.triangles,r=this.readNumber(e),s=new Int8Array(2*r),d=0;2*r>d;d+=1)s[d]=e[c],c+=1;for(u=new Uint16Array(s.buffer),y.setIndices(u),t.addPrimitive(y),h=64,s=new Int8Array(h),d=0;h>d;d+=1)s[d]=e[c],c+=1;return l=new Float32Array(s.buffer),o.copy(g,l),f=null,g},this.parsePointData=function(t,e){var r,n,a,s,u,h,l=o.create(),d=null,m=null,p=null,v=null,g=0;for(r=this.readNumber(e),v=new Array(3*r),d=new i.sourceDataP3fv,n=this.readF3Array(r,e),a=new Uint16Array(r),f=0;r>f;f+=1)a[f]=f,v[g++]=n[3*f],v[g++]=n[3*f+1],v[g++]=n[3*f+2];for(d.insert(v),t.addSource(d),m=new i.sourceDataC3fv,this.readColorArray(r,e,m),t.addSource(m),p=new i.points,p.setIndices(a),t.addPrimitive(p),u=64,s=new Int8Array(u),f=0;u>f;f+=1)s[f]=e[c],c+=1;return h=new Float32Array(s.buffer),o.copy(l,h),l},this.parseColorMapData=function(t,e,i){var r,n,o,a,s,u={};for(u.numOfColors=i,n=8,r=new Int8Array(n),a=0;n>a;a+=1)r[a]=e[c],c+=1;for(u.position=new Float32Array(r.buffer),n=8,r=new Int8Array(n),a=0;n>a;a+=1)r[a]=e[c],c+=1;for(u.size=new Float32Array(r.buffer),u.colors=[],s=0;s<u.numOfColors;s+=1){for(r=new Int8Array(4),a=0;4>a;a+=1)r[a]=e[c],c+=1;o=[new Float32Array(r.buffer)[0],e[c++],e[c++],e[c++]],u.colors[s]=o}for(u.orientation=e[c++],u.numOfLabels=e[c++],u.title="";c<e.length;)u.title+=String.fromCharCode(e[c++]);return u},this.parseSceneMetadata=function(t,e){var i,r,n,o=a.Renderers[e],u=t.camera();r=(o.size[0]-o.origin[0])*s.width,n=(o.size[1]-o.origin[1])*s.height,t.resize(r,n),u.setCenterOfRotation([o.LookAt[1],o.LookAt[2],o.LookAt[3]]),u.setViewAngleDegrees(o.LookAt[0]),u.setPosition(o.LookAt[7],o.LookAt[8],o.LookAt[9]),u.setFocalPoint(o.LookAt[1],o.LookAt[2],o.LookAt[3]),u.setViewUpDirection(o.LookAt[4],o.LookAt[5],o.LookAt[6]),0===e?(i=o.Background1,t.setBackgroundColor(i[0],i[1],i[2],1)):t.setResizable(!1),t.setLayer(e)},this.initScene=function(){var t,e;if(null===a)return d;for(e=a.Renderers.length-1;e>=0;e-=1)t=this.getRenderer(e),this.parseSceneMetadata(t,e);return d},this.createViewer=function(t){var e;return null===d&&(s=t,d=i.viewer(t),d.init(),d.renderWindow().removeRenderer(d.renderWindow().activeRenderer()),d.renderWindow().addRenderer(new i.depthPeelRenderer),r[0]=d.renderWindow().activeRenderer(),d.renderWindow().resize(t.width,t.height),e=i.pvwInteractorStyle(),d.setInteractorStyle(e)),d},this.deleteViewer=function(){r={},d=null},this.updateCanvas=function(t){return s=t,d.renderWindow().resize(t.width,t.height),d},this.numObjects=function(){return n},this.getRenderer=function(t){var e;return e=r[t],(null===e||"undefined"==typeof e)&&(e=new i.renderer,e.setResetScene(!1),e.setResetClippingRange(!1),d.renderWindow().addRenderer(e),0!==t&&e.camera().setClearMask(i.GL.DepthBufferBit),r[t]=e),e},this.setVtkScene=function(t){a=t},this},i.DataBuffers=function(t){"use strict";if(!(this instanceof i.DataBuffers))return new i.DataBuffers(t);var e,r={};e=t||0===t?t:256;var n=0,o=function(t,e,i,r){t||console.log("ack"),i||(i=0),r||(r=e.length);for(var n=0;r>n;n+=1)t[i+n]=e[n]},a=function(t){var i=e;for(t>2*i&&(i=t);t>i;)i*=2;e=i;for(var n in r)if(r.hasOwnProperty(n)){var a=new Float32Array(i*r[n].len),s=r[n].array;o(a,s),r[n].array=a,r[n].dirty=!0}};this.create=function(t,i){if(!i)throw"Length of buffer must be a positive integer";var n=new Float32Array(e*i);return r[t]={array:n,len:i,dirty:!1},r[t].array},this.alloc=function(t){n+t>=e&&a(n+t);var i=n;return n+=t,i},this.get=function(t){return r[t].array},this.write=function(t,e,i,n){o(r[t].array,e,i*r[t].len,n*r[t].len),r[t].dirty=!0},this.repeat=function(t,e,i,n){for(var a=0;n>a;a+=1)o(r[t].array,e,(i+a)*r[t].len,r[t].len);r[t].dirty=!0},this.count=function(){return n},this.data=function(t){return r[t].array}},i})},function(t,e,i){t.exports={create:i(9),clone:i(10),copy:i(11),identity:i(12),transpose:i(13),invert:i(14),adjoint:i(15),determinant:i(16),multiply:i(17),translate:i(18),scale:i(19),rotate:i(20),rotateX:i(21),rotateY:i(22),rotateZ:i(23),fromRotationTranslation:i(24),fromQuat:i(25),frustum:i(26),perspective:i(27),perspectiveFromFieldOfView:i(28),ortho:i(29),lookAt:i(30),str:i(31)}},function(t,e){function i(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}t.exports=i},function(t,e){function i(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}t.exports=i},function(t,e){function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}t.exports=i},function(t,e){function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}t.exports=i},function(t,e){function i(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=n,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],d=e[10],f=e[11],m=e[12],p=e[13],v=e[14],g=e[15],y=i*s-r*a,x=i*u-n*a,_=i*h-o*a,M=r*u-n*s,b=r*h-o*s,w=n*h-o*u,T=l*p-c*m,A=l*v-d*m,E=l*g-f*m,P=c*v-d*p,R=c*g-f*p,S=d*g-f*v,C=y*S-x*R+_*P+M*E-b*A+w*T;return C?(C=1/C,t[0]=(s*S-u*R+h*P)*C,t[1]=(n*R-r*S-o*P)*C,t[2]=(p*w-v*b+g*M)*C,t[3]=(d*b-c*w-f*M)*C,t[4]=(u*E-a*S-h*A)*C,t[5]=(i*S-n*E+o*A)*C,t[6]=(v*_-m*w-g*x)*C,t[7]=(l*w-d*_+f*x)*C,t[8]=(a*R-s*E+h*T)*C,t[9]=(r*E-i*R-o*T)*C,t[10]=(m*b-p*_+g*y)*C,t[11]=(c*_-l*b-f*y)*C,t[12]=(s*A-a*P-u*T)*C,t[13]=(i*P-r*A+n*T)*C,t[14]=(p*x-m*M-v*y)*C,t[15]=(l*M-c*x+d*y)*C,t):null}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],d=e[10],f=e[11],m=e[12],p=e[13],v=e[14],g=e[15];return t[0]=s*(d*g-f*v)-c*(u*g-h*v)+p*(u*f-h*d),t[1]=-(r*(d*g-f*v)-c*(n*g-o*v)+p*(n*f-o*d)),t[2]=r*(u*g-h*v)-s*(n*g-o*v)+p*(n*h-o*u),t[3]=-(r*(u*f-h*d)-s*(n*f-o*d)+c*(n*h-o*u)),t[4]=-(a*(d*g-f*v)-l*(u*g-h*v)+m*(u*f-h*d)),t[5]=i*(d*g-f*v)-l*(n*g-o*v)+m*(n*f-o*d),t[6]=-(i*(u*g-h*v)-a*(n*g-o*v)+m*(n*h-o*u)),t[7]=i*(u*f-h*d)-a*(n*f-o*d)+l*(n*h-o*u),t[8]=a*(c*g-f*p)-l*(s*g-h*p)+m*(s*f-h*c),t[9]=-(i*(c*g-f*p)-l*(r*g-o*p)+m*(r*f-o*c)),t[10]=i*(s*g-h*p)-a*(r*g-o*p)+m*(r*h-o*s),t[11]=-(i*(s*f-h*c)-a*(r*f-o*c)+l*(r*h-o*s)),t[12]=-(a*(c*v-d*p)-l*(s*v-u*p)+m*(s*d-u*c)),t[13]=i*(c*v-d*p)-l*(r*v-n*p)+m*(r*d-n*c),t[14]=-(i*(s*v-u*p)-a*(r*v-n*p)+m*(r*u-n*s)),t[15]=i*(s*d-u*c)-a*(r*d-n*c)+l*(r*u-n*s),t}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8],l=t[9],c=t[10],d=t[11],f=t[12],m=t[13],p=t[14],v=t[15],g=e*a-i*o,y=e*s-r*o,x=e*u-n*o,_=i*s-r*a,M=i*u-n*a,b=r*u-n*s,w=h*m-l*f,T=h*p-c*f,A=h*v-d*f,E=l*p-c*m,P=l*v-d*m,R=c*v-d*p;return g*R-y*P+x*E+_*A-M*T+b*w}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],d=e[9],f=e[10],m=e[11],p=e[12],v=e[13],g=e[14],y=e[15],x=i[0],_=i[1],M=i[2],b=i[3];return t[0]=x*r+_*s+M*c+b*p,t[1]=x*n+_*u+M*d+b*v,t[2]=x*o+_*h+M*f+b*g,t[3]=x*a+_*l+M*m+b*y,x=i[4],_=i[5],M=i[6],b=i[7],t[4]=x*r+_*s+M*c+b*p,t[5]=x*n+_*u+M*d+b*v,t[6]=x*o+_*h+M*f+b*g,t[7]=x*a+_*l+M*m+b*y,x=i[8],_=i[9],M=i[10],b=i[11],t[8]=x*r+_*s+M*c+b*p,t[9]=x*n+_*u+M*d+b*v,t[10]=x*o+_*h+M*f+b*g,t[11]=x*a+_*l+M*m+b*y,x=i[12],_=i[13],M=i[14],b=i[15],t[12]=x*r+_*s+M*c+b*p,t[13]=x*n+_*u+M*d+b*v,t[14]=x*o+_*h+M*f+b*g,t[15]=x*a+_*l+M*m+b*y,t}t.exports=i},function(t,e){function i(t,e,i){var r,n,o,a,s,u,h,l,c,d,f,m,p=i[0],v=i[1],g=i[2];return e===t?(t[12]=e[0]*p+e[4]*v+e[8]*g+e[12],t[13]=e[1]*p+e[5]*v+e[9]*g+e[13],t[14]=e[2]*p+e[6]*v+e[10]*g+e[14],t[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],d=e[9],f=e[10],m=e[11],t[0]=r,t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h,t[7]=l,t[8]=c,t[9]=d,t[10]=f,t[11]=m,t[12]=r*p+s*v+c*g+e[12],t[13]=n*p+u*v+d*g+e[13],t[14]=o*p+h*v+f*g+e[14],t[15]=a*p+l*v+m*g+e[15]),t}t.exports=i},function(t,e){function i(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}t.exports=i},function(t,e){function i(t,e,i,r){var n,o,a,s,u,h,l,c,d,f,m,p,v,g,y,x,_,M,b,w,T,A,E,P,R=r[0],S=r[1],C=r[2],L=Math.sqrt(R*R+S*S+C*C);return Math.abs(L)<1e-6?null:(L=1/L,R*=L,S*=L,C*=L,n=Math.sin(i),o=Math.cos(i),a=1-o,s=e[0],u=e[1],h=e[2],l=e[3],c=e[4],d=e[5],f=e[6],m=e[7],p=e[8],v=e[9],g=e[10],y=e[11],x=R*R*a+o,_=S*R*a+C*n,M=C*R*a-S*n,b=R*S*a-C*n,w=S*S*a+o,T=C*S*a+R*n,A=R*C*a+S*n,E=S*C*a-R*n,P=C*C*a+o,t[0]=s*x+c*_+p*M,t[1]=u*x+d*_+v*M,t[2]=h*x+f*_+g*M,t[3]=l*x+m*_+y*M,t[4]=s*b+c*w+p*T,t[5]=u*b+d*w+v*T,t[6]=h*b+f*w+g*T,t[7]=l*b+m*w+y*T,t[8]=s*A+c*E+p*P,t[9]=u*A+d*E+v*P,t[10]=h*A+f*E+g*P,t[11]=l*A+m*E+y*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}t.exports=i},function(t,e){function i(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+h*r,t[5]=a*n+l*r,t[6]=s*n+c*r,t[7]=u*n+d*r,t[8]=h*n-o*r,t[9]=l*n-a*r,t[10]=c*n-s*r,t[11]=d*n-u*r,t}t.exports=i},function(t,e){function i(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-h*r,t[1]=a*n-l*r,t[2]=s*n-c*r,t[3]=u*n-d*r,t[8]=o*r+h*n,t[9]=a*r+l*n,t[10]=s*r+c*n,t[11]=u*r+d*n,t}t.exports=i},function(t,e){function i(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],a=e[1],s=e[2],u=e[3],h=e[4],l=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+h*r,t[1]=a*n+l*r,t[2]=s*n+c*r,t[3]=u*n+d*r,t[4]=h*n-o*r,t[5]=l*n-a*r,t[6]=c*n-s*r,t[7]=d*n-u*r,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=r+r,u=n+n,h=o+o,l=r*s,c=r*u,d=r*h,f=n*u,m=n*h,p=o*h,v=a*s,g=a*u,y=a*h;return t[0]=1-(f+p),t[1]=c+y,t[2]=d-g,t[3]=0,t[4]=c-y,t[5]=1-(l+p),t[6]=m+v,t[7]=0,t[8]=d+g,t[9]=m-v,t[10]=1-(l+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=i+i,s=r+r,u=n+n,h=i*a,l=r*a,c=r*s,d=n*a,f=n*s,m=n*u,p=o*a,v=o*s,g=o*u;return t[0]=1-c-m,t[1]=l+g,t[2]=d-v,t[3]=0,t[4]=l-g,t[5]=1-h-m,t[6]=f+p,t[7]=0,t[8]=d+v,
t[9]=f-p,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}t.exports=i},function(t,e){function i(t,e,i,r,n,o,a){var s=1/(i-e),u=1/(n-r),h=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(n+r)*u,t[10]=(a+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*h,t[15]=0,t}t.exports=i},function(t,e){function i(t,e,i,r,n){var o=1/Math.tan(e/2),a=1/(r-n);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*a,t[15]=0,t}t.exports=i},function(t,e){function i(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),h=2/(n+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(n-o)*h*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}t.exports=i},function(t,e){function i(t,e,i,r,n,o,a){var s=1/(e-i),u=1/(r-n),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*u,t[14]=(a+o)*h,t[15]=1,t}t.exports=i},function(t,e,i){function r(t,e,i,r){var o,a,s,u,h,l,c,d,f,m,p=e[0],v=e[1],g=e[2],y=r[0],x=r[1],_=r[2],M=i[0],b=i[1],w=i[2];return Math.abs(p-M)<1e-6&&Math.abs(v-b)<1e-6&&Math.abs(g-w)<1e-6?n(t):(c=p-M,d=v-b,f=g-w,m=1/Math.sqrt(c*c+d*d+f*f),c*=m,d*=m,f*=m,o=x*f-_*d,a=_*c-y*f,s=y*d-x*c,m=Math.sqrt(o*o+a*a+s*s),m?(m=1/m,o*=m,a*=m,s*=m):(o=0,a=0,s=0),u=d*s-f*a,h=f*o-c*s,l=c*a-d*o,m=Math.sqrt(u*u+h*h+l*l),m?(m=1/m,u*=m,h*=m,l*=m):(u=0,h=0,l=0),t[0]=o,t[1]=u,t[2]=c,t[3]=0,t[4]=a,t[5]=h,t[6]=d,t[7]=0,t[8]=s,t[9]=l,t[10]=f,t[11]=0,t[12]=-(o*p+a*v+s*g),t[13]=-(u*p+h*v+l*g),t[14]=-(c*p+d*v+f*g),t[15]=1,t)}var n=i(12);t.exports=r},function(t,e){function i(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}t.exports=i},function(t,e,i){t.exports={create:i(33),clone:i(34),fromValues:i(35),copy:i(36),set:i(37),add:i(38),subtract:i(39),multiply:i(40),divide:i(41),min:i(42),max:i(43),scale:i(44),scaleAndAdd:i(45),distance:i(46),squaredDistance:i(47),length:i(48),squaredLength:i(49),negate:i(50),inverse:i(51),normalize:i(52),dot:i(53),lerp:i(54),random:i(55),transformMat4:i(56),transformQuat:i(57)}},function(t,e){function i(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}t.exports=i},function(t,e){function i(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}t.exports=i},function(t,e){function i(t,e,i,r){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}t.exports=i},function(t,e){function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}t.exports=i},function(t,e){function i(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}t.exports=i},function(t,e){function i(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+o*o)}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return i*i+r*r+n*n+o*o}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}t.exports=i},function(t,e){function i(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}t.exports=i},function(t,e){function i(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=i*i+r*r+n*n+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=o*a),t}t.exports=i},function(t,e){function i(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}t.exports=i},function(t,e){function i(t,e,i,r){var n=e[0],o=e[1],a=e[2],s=e[3];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=a+r*(i[2]-a),t[3]=s+r*(i[3]-s),t}t.exports=i},function(t,e,i){function r(t,e){return e=e||1,t[0]=Math.random(),t[1]=Math.random(),t[2]=Math.random(),t[3]=Math.random(),n(t,t),o(t,t,e),t}var n=i(52),o=i(44);t.exports=r},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*a,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[0],s=i[1],u=i[2],h=i[3],l=h*r+s*o-u*n,c=h*n+u*r-a*o,d=h*o+a*n-s*r,f=-a*r-s*n-u*o;return t[0]=l*h+f*-a+c*-u-d*-s,t[1]=c*h+f*-s+d*-a-l*-u,t[2]=d*h+f*-u+l*-s-c*-a,t[3]=e[3],t}t.exports=i},function(t,e,i){t.exports={create:i(59),clone:i(60),angle:i(61),fromValues:i(62),copy:i(65),set:i(66),add:i(67),subtract:i(68),multiply:i(69),divide:i(70),min:i(71),max:i(72),scale:i(73),scaleAndAdd:i(74),distance:i(75),squaredDistance:i(76),length:i(77),squaredLength:i(78),negate:i(79),inverse:i(80),normalize:i(63),dot:i(64),cross:i(81),lerp:i(82),random:i(83),transformMat4:i(84),transformMat3:i(85),transformQuat:i(86),rotateX:i(87),rotateY:i(88),rotateZ:i(89),forEach:i(90)}},function(t,e){function i(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}t.exports=i},function(t,e){function i(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}t.exports=i},function(t,e,i){function r(t,e){var i=n(t[0],t[1],t[2]),r=n(e[0],e[1],e[2]);o(i,i),o(r,r);var s=a(i,r);return s>1?0:Math.acos(s)}t.exports=r;var n=i(62),o=i(63),a=i(64)},function(t,e){function i(t,e,i){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}t.exports=i},function(t,e){function i(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}t.exports=i},function(t,e){function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}t.exports=i},function(t,e){function i(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}t.exports=i},function(t,e){function i(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}t.exports=i},function(t,e){function i(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}t.exports=i},function(t,e){function i(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[0],s=i[1],u=i[2];return t[0]=n*u-o*s,t[1]=o*a-r*u,t[2]=r*s-n*a,t}t.exports=i},function(t,e){function i(t,e,i,r){var n=e[0],o=e[1],a=e[2];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=a+r*(i[2]-a),t}t.exports=i},function(t,e){function i(t,e){e=e||1;var i=2*Math.random()*Math.PI,r=2*Math.random()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[3]*r+i[7]*n+i[11]*o+i[15];return a=a||1,t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/a,t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/a,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/a,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[0],s=i[1],u=i[2],h=i[3],l=h*r+s*o-u*n,c=h*n+u*r-a*o,d=h*o+a*n-s*r,f=-a*r-s*n-u*o;return t[0]=l*h+f*-a+c*-u-d*-s,t[1]=c*h+f*-s+d*-a-l*-u,t[2]=d*h+f*-u+l*-s-c*-a,t}t.exports=i},function(t,e){function i(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}t.exports=i},function(t,e){function i(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}t.exports=i},function(t,e){function i(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}t.exports=i},function(t,e,i){function r(t,e,i,r,o,a){var s,u;for(e||(e=3),i||(i=0),u=r?Math.min(r*e+i,t.length):t.length,s=i;u>s;s+=e)n[0]=t[s],n[1]=t[s+1],n[2]=t[s+2],o(n,n,a),t[s]=n[0],t[s+1]=n[1],t[s+2]=n[2];return t}t.exports=r;var n=i(59)()},function(t,e,i){t.exports={create:i(92),clone:i(93),fromValues:i(94),copy:i(95),set:i(96),add:i(97),subtract:i(98),multiply:i(99),divide:i(100),min:i(101),max:i(102),scale:i(103),scaleAndAdd:i(104),distance:i(105),squaredDistance:i(106),length:i(107),squaredLength:i(108),negate:i(109),normalize:i(110),dot:i(111),cross:i(112),lerp:i(113),random:i(114),transformMat2:i(115),transformMat2d:i(116),transformMat3:i(117),transformMat4:i(118),forEach:i(119)}},function(t,e){function i(){var t=new Float32Array(2);return t[0]=0,t[1]=0,t}t.exports=i},function(t,e){function i(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}t.exports=i},function(t,e){function i(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i}t.exports=i},function(t,e){function i(t,e){return t[0]=e[0],t[1]=e[1],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e,t[1]=i,t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}t.exports=i},function(t,e){function i(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1];return e*e+i*i}t.exports=i},function(t,e){function i(t,e){return t[0]=-e[0],t[1]=-e[1],t}t.exports=i},function(t,e){function i(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}t.exports=i},function(t,e){function i(t,e){return t[0]*e[0]+t[1]*e[1]}t.exports=i},function(t,e){function i(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}t.exports=i},function(t,e){function i(t,e,i,r){var n=e[0],o=e[1];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t}t.exports=i},function(t,e){function i(t,e){e=e||1;var i=2*Math.random()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}t.exports=i},function(t,e){function i(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}t.exports=i},function(t,e,i){function r(t,e,i,r,o,a){var s,u;for(e||(e=2),i||(i=0),u=r?Math.min(r*e+i,t.length):t.length,s=i;u>s;s+=e)n[0]=t[s],n[1]=t[s+1],o(n,n,a),t[s]=n[0],t[s+1]=n[1];return t}t.exports=r;var n=i(92)()},function(t,e,i){var r=i(1),n=i(121);r.extend(n,i(122)),n.DistanceGrid=i(123),n.ClusterGroup=i(124),t.exports=n},function(t,e,i){!function(){"use strict";function e(){var t;for(t=0;t<arguments.length;t+=1)if(isFinite(arguments[t]))return arguments[t]}var r,n=i(1),o={util:{}},a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s={},u=200,h=15;o.util={pointInPolygon:function(t,e,i){var r=!1,n=e.length;return 3>n?!1:(e.forEach(function(i,o){var a=(n+o-1)%n,s=e[o].y>t.y!=e[a].y>t.y&&t.x<(e[a].x-e[o].x)*(t.y-e[o].y)/(e[a].y-e[o].y)+e[o].x;s&&(r=!r)}),(i||[]).forEach(function(e){r=r&&!o.util.pointInPolygon(t,e)}),r)},isFunction:function(t){return"function"==typeof t},ensureFunction:function(t){return o.util.isFunction(t)?t:function(){return t}},randomString:function(t){var e,i,r;for(t=t||8,e="",i=0;t>i;i+=1)r=Math.floor(Math.random()*a.length),e+=a.substring(r,r+1);return e},convertColor:function(t){return void 0!==t.r&&void 0!==t.g&&void 0!==t.b?t:("string"==typeof t&&(o.util.cssColors.hasOwnProperty(t)?t=o.util.cssColors[t]:"#"===t.charAt(0)&&(t=parseInt(t.slice(1),16))),isFinite(t)&&(t={r:((16711680&t)>>16)/255,g:((65280&t)>>8)/255,b:(255&t)/255}),t)},normalizeCoordinates:function(t){return t=t||{},Array.isArray(t)?{x:t[0],y:t[1],z:t[2]||0}:{x:e(t.x,t.longitude,t.lng,t.lon,0),y:e(t.y,t.latitude,t.lat,0),z:e(t.z,t.elevation,t.elev,t.height,0)}},radiusEarth:6378137,lincomb:function(t,e,i,r){return e.x=t*(e.x||0)+i*(r.x||0),e.y=t*(e.y||0)+i*(r.y||0),e.z=t*(e.x||0)+i*(r.x||0),e},scale:function(t,e,i){return t.x=(t.x||0)*Math.pow(e.x||1,i),t.y=(t.y||0)*Math.pow(e.y||1,i),t.z=(t.z||0)*Math.pow(e.z||1,i),t},compareArrays:function(t,e){return t.length===e.length&&t.every(function(t,i){return t===e[i]})},vec3AsArray:function(){return[0,0,0]},mat4AsArray:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},getGeomBuffer:function(t,e,i){var r,n=t.sourceByName(e);return r=n.data(),r instanceof Float32Array&&r.length===i?r:(r=new Float32Array(i),n.setData(r),r)},timeReport:function(t){return n.each(s,function(t,e){e.count?(e.stddev=Math.sqrt(Math.abs((e.sum2-e.sum*e.sum/e.count)/e.count)),e.average=e.sum/e.count):(e.stddev=0,e.average=0)}),t?s[t]:s},timeFunctionStart:function(t,e){(!s[t]||e)&&(s[t]={count:0,sum:0,sum2:0,max:0,recent:[]}),s[t].start=window.performance.now()},timeFunctionStop:function(t){if(s[t]&&s[t].start){var e=window.performance.now()-s[t].start;s[t].start=null,s[t].sum+=e,s[t].sum2+=e*e,s[t].count+=1,s[t].max=Math.max(s[t].max,e),s[t].recent.push(e),s[t].recent.length>u&&s[t].recent.splice(0,s[t].recent.length-u)}},timeRequestAnimationFrame:function(t,e,i,n){(!s.requestAnimationFrame||e)&&(s.requestAnimationFrame={count:0,sum:0,sum2:0,max:0,above_threshold:0,recent:[],recentsub:[]}),i&&(h=i),n&&(u=n),t&&r?(window.requestAnimationFrame=r,r=null):t||r||(r=window.requestAnimationFrame,window.requestAnimationFrame=function(t){r.call(window,function(e){var i,r=s.requestAnimationFrame;r.timestamp!==e&&(r.timestamp=e,r.subcalls=r.subcalls||0,r.start={sum:r.sum,sum2:r.sum2,count:r.count,max:r.max,above_threshold:r.above_threshold},r.recent.push([0]),r.recentsub.push([]),r.recent.length>u&&(r.recent.splice(0,r.recent.length-u),r.recentsub.splice(0,r.recentsub.length-u))),r.subcalls+=1,t.apply(this,arguments);var n=window.performance.now()-e;r.sum=r.start.sum+n,r.sum2=r.start.sum2+n*n,r.count=r.start.count+1,r.max=Math.max(r.max,n),r.above_threshold=r.start.above_threshold+(n>=h?1:0),r.recent[r.recent.length-1]=n,i=r.recentsub[r.recent.length-1],i.push({total_duration:n,duration:n-(i.length?i[i.length-1].total_duration:0),callback:t.name||t})})})}},o.util.cssColors={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},t.exports=o.util}()},function(t,e){/**
	 * @file
	 * Based on the following jquery throttle / debounce plugin:
	 *
	 * jQuery throttle / debounce - v1.1 - 3/7/2010
	 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
	 *
	 * @copyright 2010 "Cowboy" Ben Alman
	 * Dual licensed under the MIT and GPL licenses.
	 * http://benalman.com/about/license/
	 *
	 * The implementation included here is modified to support a callback
	 * method that can accumulate values between actual invocations of
	 * the throttled method.
	 */
!function(e){"use strict";var i=function(t,e,i,r,n){function o(){function o(){s=+new Date,i.apply(h,c)}function u(){a=void 0}var h=this,l=+new Date-s,c=arguments;r.apply(h,c),n&&!a&&o(),void(a&&clearTimeout(a)),void 0===n&&l>t?o():e!==!0&&(a=setTimeout(n?u:o,void 0===n?t-l:t))}var a,s=0;return"boolean"!=typeof e&&(n=r,r=i,i=e,e=void 0),"function"!=typeof r&&(n=r,r=function(){}),o},r=function(t,e,r,n){return"boolean"!=typeof e&&(n=r,r=e,e=!1),n=n||function(){},i(t,!1,r,n,!!e)};t.exports={throttle:i,debounce:r}}(this)},function(t,e,i){/**
	 * @file
	 * Code taken from https://github.com/Leaflet/Leaflet.markercluster
	 * to support faster hierarchical clustering of features.
	 * @copyright 2012, David Leaver
	 */
!function(){"use strict";var e=i(1),r={};r.Util={stamp:function(t){return t._leaflet_id=t._leaflet_id||++r.Util.lastId,t._leaflet_id},lastId:0};var n=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}};n.prototype={addObject:function(t,e){var i=this._getCoord(e.x),n=this._getCoord(e.y),o=this._grid,a=o[n]=o[n]||{},s=a[i]=a[i]||[],u=r.Util.stamp(t);e.obj=t,this._objectPoint[u]=e,s.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,n,o=this._getCoord(e.x),a=this._getCoord(e.y),s=this._grid,u=s[a]=s[a]||{},h=u[o]=u[o]||[];for(delete this._objectPoint[r.Util.stamp(t)],i=0,n=h.length;n>i;i++)if(h[i]===t)return h.splice(i,1),1===n&&delete u[o],!0},eachObject:function(t,e){var i,r,n,o,a,s,u,h=this._grid;for(i in h){a=h[i];for(r in a)for(s=a[r],n=0,o=s.length;o>n;n++)u=t.call(e,s[n]),u&&(n--,o--)}},getNearObject:function(t){var e,i,n,o,a,s,u,h,l=this._getCoord(t.x),c=this._getCoord(t.y),d=this._objectPoint,f=this._sqCellSize,m=null;for(e=c-1;c+1>=e;e++)if(o=this._grid[e])for(i=l-1;l+1>=i;i++)if(a=o[i])for(n=0,s=a.length;s>n;n++)u=a[n],h=this._sqDist(d[r.Util.stamp(u)],t),f>h&&(f=h,m=u);return m},contents:function(){return e.map(this._objectPoint,function(t){return t})},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}},t.exports=n}()},function(t,e,i){!function(){"use strict";function e(t,e,i){this._group=t,this._zoom=e,this._points=[],this._clusters=[],this._count=0,this._parent=null,this._coord=null;var r=this;(i||[]).forEach(function(t){r._add(t)})}function r(t,r,o){var a=i(123);this._opts=n.extend({maxZoom:18,radius:.05},t),this._opts.width=this._opts.width||r||256,this._opts.height=this._opts.height||o||256,this._clusters={},this._points={};var s,u;for(s=this._opts.maxZoom;s>=0;s-=1)u=this._scaleAtLevel(s,this._opts.width,this._opts.height),this._clusters[s]=new a(u),this._points[s]=new a(u);this._topClusterLevel=new e(this,-1)}var n=i(1),o=i(6);e.prototype._add=function(t){var i=1;t instanceof e?(this._clusters.push(t),i=t._count):this._points.push(t),t._parent=this,this._increment(i)},e.prototype._increment=function(t){this._coord=null,this._count+=t,this._parent&&this._parent._increment(t)},e.prototype.count=function(){return this._count},e.prototype.each=function(t){var e;for(e=0;e<this._points.length;e+=1)t.call(this,this._points[e],this._zoom);for(e=0;e<this._clusters.length;e+=1)this._clusters[e].each.call(this._clusters[e],t)},e.prototype.coords=function(){var t,e={x:0,y:0};if(this._coord)return this._coord;for(t=0;t<this._points.length;t+=1)e.x+=this._points[t].x,e.y+=this._points[t].y;for(t=0;t<this._clusters.length;t+=1)e.x+=this._clusters[t].coords().x*this._clusters[t].count(),e.y+=this._clusters[t].coords().y*this._clusters[t].count();return{x:e.x/this.count(),y:e.y/this.count()}},r.prototype._scaleAtLevel=function(t,e,i){return o.zoomToHeight(t,e,i)/2*this._opts.radius},r.prototype.addPoint=function(t){var i,r,o,a,s,u;for(i=this._opts.maxZoom;i>=0;i-=1){if(r=this._clusters[i].getNearObject(t))return void r._add(t);if(r=this._points[i].getNearObject(t)){if(o=r._parent)for(u=o._points.length-1;u>=0;u-=1)if(o._points[u]===r){o._points.splice(u,1),o._increment(-1);break}for(o||n.noop(),a=new e(this,i,[r,t]),this._clusters[i].addObject(a,a.coords()),s=a,u=i-1;u>o._zoom;u-=1)s=new e(this,u,[s]),this._clusters[u].addObject(s,s.coords());for(o._add(s),u=i;u>=0&&this._points[u].removeObject(r,r);u-=1);return}this._points[i].addObject(t,t)}this._topClusterLevel._add(t)},r.prototype.points=function(t){return t=Math.min(Math.max(Math.floor(t),0),this._opts.maxZoom-1),this._points[Math.floor(t)].contents()},r.prototype.clusters=function(t){return t=Math.min(Math.max(Math.floor(t),0),this._opts.maxZoom-1),this._clusters[Math.floor(t)].contents()},t.exports=r}()},function(t,e){var i={};i.layerAdd="geo_layerAdd",i.layerRemove="geo_layerRemove",i.zoom="geo_zoom",i.rotate="geo_rotate",i.pan="geo_pan",i.resize="geo_resize",i.worldChanged="geo_worldChanged",i.draw="geo_draw",i.drawEnd="geo_drawEnd",i.mousemove="geo_mousemove",i.mouseclick="geo_mouseclick",i.brush="geo_brush",i.brushend="geo_brushend",i.brushstart="geo_brushstart",i.transitionstart="geo_transitionstart",i.transitionend="geo_transitionend",i.transitioncancel="geo_transitioncancel",i.parallelprojection="geo_parallelprojection",i.clock={play:"geo_clock_play",stop:"geo_clock_stop",pause:"geo_clock_pause",change:"geo_clock_change"},i.feature={mousemove:"geo_feature_mousemove",mouseover:"geo_feature_mouseover",mouseout:"geo_feature_mouseout",mouseon:"geo_feature_mouseon",mouseoff:"geo_feature_mouseoff",mouseclick:"geo_feature_mouseclick",brushend:"geo_feature_brushend",brush:"geo_feature_brush"},i.camera={},i.camera.view="geo_camera_view",i.camera.pan="geo_camera_pan",i.camera.zoom="geo_camera_zoom",i.camera.projection="geo_camera_projection",i.camera.viewport="geo_camera_viewport",t.exports=i},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);t=t||{},n.call(this,t);var e=i(1),r=i(120).ensureFunction,a=i(132),s=this,u=this._init,h=e.extend({},{colorRange:[{r:.07514311,g:.468049805,b:1},{r:.468487184,g:.588057293,b:1},{r:.656658579,g:.707001303,b:1},{r:.821573924,g:.837809045,b:1},{r:.943467973,g:.943498599,b:.943398095},{r:1,g:.788626485,b:.750707739},{r:1,g:.6289553,b:.568237474},{r:1,g:.472800903,b:.404551679},{r:.916482116,g:.236630659,b:.209939162}],scale:a.scale.quantize(),accessors:{geoId:function(t){return t.properties.GEO_ID},scalarId:function(t){return t.id},scalarValue:function(t){return t.value}}},t.choropleth);return this.scalar=function(t,e){var i,r;return void 0===t?s.choropleth.get("scalar")():(i=s.choropleth.get("accessors")().scalarId,r=s.choropleth.get("accessors")().scalarValue,h.scalar=t,h.scalarAggregator=e||a.mean,h.scalar._dictionary=t.reduce(function(t,e){var n,o;return n=i(e),o=r(e),t[n]=t[n]?t[n].push(o):[o],t},{}),s.dataTime().modified(),s)},this.choropleth=function(t,i){var r;return void 0===t?h:"string"==typeof t&&void 0===i?h[t]:(void 0===i?(r=e.extend({},h,t),h=r):h[t]=i,s.modified(),s)},this.choropleth.get=function(t){var e,i={};if(void 0===t){for(e in h)h.hasOwnProperty(e)&&(i[e]=s.choropleth.get(e));return i}return r(h[t])},this._addPolygonFeature=function(t,e){var i=s.layer().createFeature("polygon",{});return"Polygon"===t.geometry.type?i.data([{type:"Polygon",coordinates:t.geometry.coordinates}]):"MultiPolygon"===t.geometry.type&&i.data(t.geometry.coordinates.map(function(t){return{type:"Polygon",coordinates:t}})),i.polygon(function(t){return{outer:t.coordinates[0],inner:t.coordinates[1]}}).position(function(t){return{x:t[0],y:t[1]}}).style({fillColor:e}),i},this._featureToPolygons=function(t,e){return s._addPolygonFeature(t,e)},this._generateScale=function(t){var e=a.extent(s.scalar(),t||void 0);return s.choropleth().scale.domain(e).range(s.choropleth().colorRange),s},this.createChoropleth=function(){var t=s.choropleth,e=s.data(),i=s.scalar(),r=t.get("accessors")().scalarValue,n=t.get("accessors")().geoId;return s._generateScale(r),e.map(function(e){var r=n(e),o=i._dictionary[r],a=t().scalarAggregator(o),u=s.choropleth().scale(a);return s._featureToPolygons(e,u)})},this._init=function(t){u.call(s,t),h&&s.dataTime().modified()},this._init(t),this};r(o,n),t.exports=o},function(t,e,i){var r=i(1),n=i(4),o=i(128),a=i(129),s=i(125),u=function(t){"use strict";if(!(this instanceof u))return new u(t);o.call(this);var e=i(120);t=t||{};var n=this,h=this._exit,l=void 0===t.selectionAPI?!1:t.selectionAPI,c={},d=void 0===t.layer?null:t.layer,f=t.gcs,m=void 0===t.visible?!0:t.visible,p=void 0===t.bin?0:t.bin,v=void 0===t.renderer?null:t.renderer,g=a(),y=a(),x=a(),_=[];return this._bindMouseHandlers=function(){l&&(n._unbindMouseHandlers(),n.geoOn(s.mousemove,n._handleMousemove),n.geoOn(s.mouseclick,n._handleMouseclick),n.geoOn(s.brushend,n._handleBrushend),n.geoOn(s.brush,n._handleBrush))},this._unbindMouseHandlers=function(){n.geoOff(s.mousemove,n._handleMousemove),n.geoOff(s.mouseclick,n._handleMouseclick),n.geoOff(s.brushend,n._handleBrushend),n.geoOff(s.brush,n._handleBrush)},this.pointSearch=function(){return{index:[],found:[]}},this._handleMousemove=function(){var t=n.layer().map().interactor().mouse(),e=n.data(),i=n.pointSearch(t.geo),r=[],o=[],a=-1,h=-1;_.length&&(a=_[_.length-1]),r=i.index.filter(function(t){return _.indexOf(t)<0}),o=_.filter(function(t){return i.index.indexOf(t)<0}),u.eventID+=1,r.forEach(function(i,o){n.geoTrigger(s.feature.mouseover,{data:e[i],index:i,mouse:t,eventID:u.eventID,top:o===r.length-1},!0)}),u.eventID+=1,o.forEach(function(i,r){n.geoTrigger(s.feature.mouseout,{data:e[i],index:i,mouse:t,eventID:u.eventID,top:r===o.length-1},!0)}),u.eventID+=1,i.index.forEach(function(r,o){n.geoTrigger(s.feature.mousemove,{data:e[r],index:r,mouse:t,eventID:u.eventID,top:o===i.index.length-1},!0)}),_=i.index,_.length&&(h=_[_.length-1]),a!==h&&(-1!==a&&n.geoTrigger(s.feature.mouseoff,{data:e[a],index:a,mouse:t},!0),-1!==h&&n.geoTrigger(s.feature.mouseon,{data:e[h],index:h,mouse:t},!0))},this._handleMouseclick=function(){var t=n.layer().map().interactor().mouse(),e=n.data(),i=n.pointSearch(t.geo);u.eventID+=1,i.index.forEach(function(r,o){n.geoTrigger(s.feature.mouseclick,{data:e[r],index:r,mouse:t,eventID:u.eventID,top:o===i.index.length-1},!0)})},this._handleBrush=function(t){var e=n.boxSearch(t.gcs.lowerLeft,t.gcs.upperRight),i=n.data();u.eventID+=1,e.forEach(function(e,r){n.geoTrigger(s.feature.brush,{data:i[e],index:e,mouse:t.mouse,brush:t,eventID:u.eventID,top:r===r.length-1},!0)})},this._handleBrushend=function(t){var e=n.boxSearch(t.gcs.lowerLeft,t.gcs.upperRight),i=n.data();u.eventID+=1,e.forEach(function(e,r){n.geoTrigger(s.feature.brushend,{data:i[e],index:e,mouse:t.mouse,brush:t,eventID:u.eventID,top:r===r.length-1},!0)})},this.style=function(t,e){return void 0===t?c:"string"==typeof t&&void 0===e?c[t]:void 0===e?(c=r.extend({},c,t),n.modified(),n):(c[t]=e,n.modified(),n)},this.style.get=function(t){var i,r;if(void 0===t){var o,a={};for(o in c)c.hasOwnProperty(o)&&(a[o]=n.style.get(o));return a}return t.toLowerCase().match(/color$/)?e.isFunction(c[t])?(i=e.ensureFunction(c[t]),r=function(){return e.convertColor(i.apply(this,arguments))}):r=e.ensureFunction(e.convertColor(c[t])):r=e.ensureFunction(c[t]),r},this.layer=function(){return d},this.renderer=function(){return v},this.gcs=function(t){return void 0===t?void 0===f&&v?v.layer().map().ingcs():f:(f=t,n.modified(),n)},this.featureGcsToDisplay=function(t){var e=v.layer().map();return t=e.gcsToWorld(t,e.ingcs()),t=e.worldToDisplay(t),v.baseToLocal&&(t=v.baseToLocal(t)),t},this.visible=function(t){return void 0===t?m:(m=t,n.modified(),m?n._bindMouseHandlers():n._unbindMouseHandlers(),n)},this.bin=function(t){return void 0===t?p:(p=t,n.modified(),n)},this.dataTime=function(t){return void 0===t?g:(g=t,n.modified(),n)},this.buildTime=function(t){return void 0===t?y:(y=t,n.modified(),n)},this.updateTime=function(t){return void 0===t?x:(x=t,n.modified(),n)},this.data=function(t){return void 0===t?n.style("data")||[]:(n.style("data",t),n.dataTime().modified(),n.modified(),n)},this.selectionAPI=function(){return l},this._init=function(t){if(!d)throw"Feature requires a valid layer";c=r.extend({},{opacity:1},void 0===t.style?{}:t.style),n._bindMouseHandlers()},this._build=function(){},this._update=function(){},this._exit=function(){n._unbindMouseHandlers(),_=[],c={},t={},h()},this._init(t),this};u.eventID=0,u.create=function(t,e){"use strict";var r=e.type;if(!(t instanceof i(130)))return console.warn("Invalid layer"),null;if("object"!=typeof e)return console.warn("Invalid spec"),null;var n=t.createFeature(r);return n?(e=e||{},e.data=e.data||[],n.style(e)):(console.warn('Could not create feature type "'+r+'"'),null)},n(u,o),t.exports=u},function(t,e,i){var r=i(4),n=i(5),o=function(t){"use strict";if(!(this instanceof o))return new o;n.call(this,t);var e=this,i=null,r=[],a=this._exit,s=this.geoTrigger,u=this.addPromise,h=this.onIdle;return this.addPromise=function(t){i?i.addPromise(t):u(t)},this.onIdle=function(t){i?i.onIdle(t):h(t)},this.parent=function(t){return void 0===t?i:(i=t,e)},this.addChild=function(t){return Array.isArray(t)?(t.forEach(e.addChild),e):(t.parent(e),r.push(t),e)},this.removeChild=function(t){return Array.isArray(t)?(t.forEach(e.removeChild),e):(r=r.filter(function(e){return e!==t}),e)},this.children=function(){return r.slice()},this.draw=function(t){return e.children().forEach(function(e){e.draw(t)}),e},this.geoTrigger=function(t,n,o){var a;return n=n||{},a=n.geo||{},n.geo=a,a.stopPropagation?e:!o&&i&&a._triggeredBy!==i?(a._triggeredBy=e,i.geoTrigger(t,n),e):(s.call(e,t,n),a.stopPropagation?e:(r.forEach(function(i){i.geoTrigger&&(a._triggeredBy=e,i.geoTrigger(t,n))}),e))},this._exit=function(){e.children=[],delete e.parent,a()},this};r(o,n),t.exports=o},function(t,e,i){var r=i(6),n=i(4),o=function(){"use strict";return this instanceof o?void r.timestamp.call(this):new o};n(o,r.timestamp),t.exports=o},function(t,e,i){var r=i(4),n=i(128),o=i(127),a=i(131).checkRenderer,s=function(t){"use strict";if(!(this instanceof s))return new s(t);t=t||{},n.call(this,t);var e,r=i(1),o=i(129),u=i(131).createRenderer,h=i(120).newLayerId,l=i(125),c=i(3),d=this,f=this._exit,m=void 0===t.id?s.newLayerId():t.id,p="",v=void 0===t.map?null:t.map,g=null,y=null,x=null,_=!1,M=void 0===t.renderer?"vgl":t.renderer,b=o(),w=o(),T=void 0===t.sticky?!0:t.sticky,A=void 0===t.active?!0:t.active,E=void 0===t.opacity?1:t.opacity,P=t.attribution||null;if(M=a(M),!v)throw new Error("Layers must be initialized on a map.");return this.rendererName=function(){return M},this.zIndex=function(t){return void 0===t?e:(e=t,g.css("z-index",e),d)},this.moveUp=function(t){var e,i,r,n,o=null;for(void 0===t&&(t=1),n=1,0>t&&(n=-1,t=-t),e=d.map().layers().sort(function(t,e){return n*(t.zIndex()-e.zIndex())}),i=0;i<e.length;i+=1)if(null===o)e[i]===d&&(o=i);else{if(!(t>=i-o))break;r=d.zIndex(),d.zIndex(e[i].zIndex()),e[i].zIndex(r)}return d},this.moveDown=function(t){return void 0===t&&(t=1),d.moveUp(-t)},this.moveToTop=function(){return d.moveUp(d.map().children().length-1)},this.moveToBottom=function(){return d.moveDown(d.map().children().length-1)},this.sticky=function(){return T},this.active=function(){return A},this.node=function(){return g},this.id=function(t){return void 0===t?m:(m=h(),d.modified(),d)},this.name=function(t){return void 0===t?p:(p=t,d.modified(),d)},this.map=function(){return v},this.renderer=function(){return x},this.canvas=function(){return y},this.dataTime=function(){return b},this.updateTime=function(){return w},this.initialized=function(t){return void 0!==t?(_=t,d):_},this.toLocal=function(t){return d._toLocalMatrix&&c.applyTransform(d._toLocalMatrix,t),t},this.fromLocal=function(t){return d._fromLocalMatrix&&c.applyTransform(d._fromLocalMatrix,t),t},this.attribution=function(t){return void 0!==t?(P=t,d.map().updateAttribution(),d):P},this._init=function(e){if(_)return d;v.node().append(g);var i=r.extend({},t);return delete i.map,null===M?(x=null,y=g):y?x=u(M,d,y,i):(x=u(M,d,void 0,i),y=x.canvas()),d.active()||g.css("pointerEvents","none"),_=!0,e||(d.geoOn(l.resize,function(t){d._update({event:t})}),d.geoOn(l.pan,function(t){d._update({event:t})}),d.geoOn(l.rotate,function(t){d._update({event:t})}),d.geoOn(l.zoom,function(t){d._update({event:t})})),d},this._exit=function(){d.geoOff(),x&&x._exit(),g.off(),g.remove(),t={},y=null,x=null,f()},this._update=function(){},this.width=function(){return d.map().size().width},this.height=function(){return d.map().size().height},this.opacity=function(t){return void 0!==t?(E=t,g.css("opacity",E),d):E},void 0===t.zIndex&&(t.zIndex=v.children().length),e=t.zIndex,g=r(document.createElement("div")),g.attr("id",p),g.css("position","absolute"),g.css("width","100%"),g.css("height","100%"),d.opacity(E),d.zIndex(e),d};s.newLayerId=function(){"use strict";var t=1;return function(){var e=t;return t+=1,e}}(),s.create=function(t,e){"use strict";if(e=e||{},e.type="feature","feature"!==e.type)return console.warn("Unsupported layer type"),null;if(e.renderer=e.renderer||"vgl",e.renderer=a(e.renderer),!e.renderer)return console.warn("Invalid renderer"),null;var i=t.createLayer(e.type,e);return i?(e.features.forEach(function(t){t.data=t.data||e.data,t.feature=o.create(i,t)}),i):(console.warn("Unable to create a layer"),null)},r(s,n),t.exports=s},function(t,e,i){var r=i(1),n={dom:{}},o={},a={},s={},u={},h={},l={};l.registerFileReader=function(t,e){u[t]=e},l.createFileReader=function(t,e){return u.hasOwnProperty(t)?u[t](e):null},l.registerRenderer=function(t,e){a[t]=e},l.createRenderer=function(t,e,i,r){if(a.hasOwnProperty(t)){var n=a[t]({layer:e,canvas:i,options:r});return n._init(),n}return null},l.checkRenderer=function(t,e){if(null===t)return t;if(a.hasOwnProperty(t)){var i=a[t];if(!i.supported||i.supported())return t;if(!i.fallback||e)return!1;var r=l.checkRenderer(i.fallback(),!0);return r!==!1&&console.warn(t+" renderer is unavailable, using "+r+" renderer instead"),r}return!1},l.registerFeature=function(t,e,i){void 0===s&&(s={}),t in s||(s[t]={}),s[t][e]=i},l.createFeature=function(t,e,i,n){var o=i.api(),a={layer:e,renderer:i};if(o in s&&t in s[o]){void 0!==n&&r.extend(!0,a,n);var u=s[o][t](a);return e.gcs=function(){return e.map().gcs()},u}return null},l.registerLayerAdjustment=function(t,e,i){void 0===h&&(h={}),t in h||(h[t]={}),h[t][e]=i},l.adjustLayerForRenderer=function(t,e){var i=e.rendererName();i&&h&&h[i]&&h[i][t]&&h[i][t].apply(e)},l.registerLayer=function(t,e){o[t]=e},l.createLayer=function(t,e,i){var n={map:e,renderer:"vgl"},a=null;return t in o?(void 0!==i&&r.extend(!0,n,i),a=o[t](n),a._init(),a):null},l.registerWidget=function(t,e,i){t in n||(n[t]={}),n[t][e]=i},l.createWidget=function(t,e,i){var o={layer:e};if(t in n.dom)return void 0!==i&&r.extend(!0,o,i),n.dom[t](o);throw new Error("Cannot create unknown widget "+t)},t.exports=l},function(t,i){t.exports=e},function(t,e,i){var r=i(4),n=i(5),o=function(t){"use strict";if(!(this instanceof o))return new o(t);t=t||{},n.call(this,t);var e=i(125),r=this,a=new Date(0),s=null,u=null,h=null,l=null,c=Number.POSITIVE_INFINITY,d=0,f="stop",m=null,p=null;this.object=function(t){return void 0===t?p:(p=t,r)},this._attached=function(){return p instanceof n},this.now=function(t){var i=a;return void 0===t?a:(a=t,a!==i&&r._attached()&&r.object().geoTrigger(e.clock.change,{previous:i,current:a,clock:r}),r)},this.start=function(t){return void 0===t?s:(s=t,r)},this.end=function(t){return void 0===t?u:(u=t,r)},this.step=function(t){return void 0===t?h:(h=t,r)},this.loop=function(t){return void 0===t?c:(c=t,r)},this.state=function(t,e){return void 0===t?f:["stop","play","pause"].indexOf(t)<0?(console.log("WARNING: Ignored invalid state: "+t),r):("play"===t&&"stop"===f&&(d=0,r.now(r.start())),"play"===t&&"play"!==f&&(f=t,r._animate(e||1)),f=t,r)},this.framerate=function(t){return void 0===t?l:(l=t,r)},this.stepForward=function(){return r.state("pause"),r._setNextFrame(1),r},this.stepBackward=function(){return r.state("pause"),r._setNextFrame(-1),r},this._setNextFrame=function(t){var e=new Date(r.now().valueOf()+t*r.step());return e>=r.end()||e<=r.start()?r.loop()<=d?void r.state("stop"):(d+=1,void(t>=0?r.now(r.start()):r.now(r.end()))):void r.now(e)},this._animate=function(t){function i(){n===m&&(r._setNextFrame(t),"play"===r.state()?r.framerate()?window.setTimeout(i,1e3/r.framerate()):window.requestAnimationFrame(i):r._attached()&&r.object().geoTrigger(e.clock[r.state()],{current:r.now(),clock:r}))}var n={};m=n,r._attached()&&r.object().geoTrigger(e.clock.play,{current:r.now(),clock:r}),r.framerate()?window.setTimeout(i,1e3/r.framerate()):window.requestAnimationFrame(i)}};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);var e=i(1),r=i(120);t=t||{},n.call(this,t);var a=this,s={},u=this._init,h=this.data;return s=void 0===t.contour?function(t){return t}:t.contour,this.data=function(t){var e=h(t);return e},this.contour=function(t,i){if(void 0===t)return s;if("string"==typeof t&&void 0===i)return s[t];if(void 0===i){var r=e.extend({},{gridWidth:function(){return t.gridHeight?Math.floor(a.data().length/t.gridHeight):Math.floor(Math.sqrt(a.data().length))},gridHeight:function(){return t.gridWidth?Math.floor(a.data().length/t.gridWidth):Math.floor(Math.sqrt(a.data().length))},minColor:"black",minOpacity:0,maxColor:"black",maxOpacity:0,colorRange:[{r:.07514311,g:.468049805,b:1},{r:.468487184,g:.588057293,b:1},{r:.656658579,g:.707001303,b:1},{r:.821573924,g:.837809045,b:1},{r:.943467973,g:.943498599,b:.943398095},{r:1,g:.788626485,b:.750707739},{r:1,g:.6289553,b:.568237474},{r:1,g:.472800903,b:.404551679},{r:.916482116,g:.236630659,b:.209939162}]},s,t);s=r}else s[t]=i;return a.modified(),a},this.contour.get=function(t){if(void 0===t){var e,i={};for(e in s)s.hasOwnProperty(e)&&(i[e]=a.contour.get(e));return i}return r.ensureFunction(s[t])},this.position=function(t){return void 0===t?a.style("position"):(a.style("position",t),a.dataTime().modified(),a.modified(),a)},this.createContours=function(){var t,i,n,o,s,u,h,l,c,d,f,m,p,v,g,y,x,_=0,M={},b=a.contour,w=a.data(),T=a.position(),A=b.get("gridWidth")(),E=b.get("gridHeight")(),P=b.get("x0")(),R=b.get("y0")(),S=b.get("dx")(),C=b.get("dy")(),L=a.style.get("opacity"),I=b.get("opacityRange")(),O=b.get("rangeValues")(),D=a.style.get("value"),F=[],N=b.get("stepped")(),k=b.get("wrapLongitude")(),z=A,G={minValue:b.get("min")(),maxValue:b.get("max")(),stepped:void 0===N||N?!0:!1,wrapLongitude:void 0===k||k?!0:!1,colorMap:[],elements:[]};if(G.minColor=e.extend({a:b.get("minOpacity")()||0},r.convertColor(b.get("minColor")())),G.maxColor=e.extend({a:b.get("maxOpacity")()||0},r.convertColor(b.get("maxColor")())),b.get("colorRange")().forEach(function(t,i){G.colorMap.push(e.extend({a:I&&void 0!==I[i]?I[i]:1},r.convertColor(t)))}),A*E>w.length&&(E=Math.floor(w.length)/A),l=null===P||void 0===P||null===R||void 0===R||!S||!C,!l&&G.wrapLongitude&&(-180>P||P>180||-180>P+S*(A-1)||P+S*(A-1)>180)&&S>-180&&180>S){for(v=[],t=0;A>t;t+=1){for(y=P+t*S;-180>y;)y+=360;for(;y>180;)y-=360;t&&Math.abs(y-v[v.length-1])>180&&(y>v[v.length-1]?(v.push(y-360),v.push(v[v.length-2]+360)):(v.push(y+360),v.push(v[v.length-2]-360)),g=t),v.push(y)}if(A+=2,Math.abs(Math.abs(z*S)-360)<.01){for(A+=1,y=P+z*S;-180>y;)y+=360;for(;y>180;)y-=360;v.push(y)}}for(h=A*E,t=0;h>t;t+=1)void 0===g?u=parseFloat(D(w[t])):(n=Math.floor(t/A),x=t-n*A,x+=x>g?-2:0,x>=z&&(x-=z),x+=n*z,u=parseFloat(D(w[x]))),F[t]=isNaN(u)?null:u,null!==F[t]&&(M[t]=_,_+=1,void 0===d&&(d=f=F[t]),F[t]<d&&(d=F[t]),F[t]>f&&(f=F[t]));if(!_)return G;if(e.isNumeric(G.minValue)||(G.minValue=d),e.isNumeric(G.maxValue)||(G.maxValue=f),O&&O.length===G.colorMap.length+1||(O=null),O)for(s=1;s<O.length;s+=1)if(O[s]>O[s+1]){O=null;break}for(O&&(G.minValue=O[0],G.maxValue=O[O.length-1]),m=G.maxValue-G.minValue,m||(G.colorMap=G.colorMap.slice(0,1),m=1,O=null),G.rangeValues=O,G.factor=G.colorMap.length/m,n=o=0;E-1>n;n+=1,o+=1)for(t=0;A-1>t;t+=1,o+=1)null!==F[o]&&null!==F[o+1]&&null!==F[o+A]&&null!==F[o+A+1]&&t!==g&&(G.elements.push(M[o]),G.elements.push(M[o+1]),G.elements.push(M[o+A]),G.elements.push(M[o+A+1]),G.elements.push(M[o+A]),G.elements.push(M[o+1]));for(G.pos=new Array(3*_),G.value=new Array(_),G.opacity=new Array(_),n=t=i=0;h>n;n+=1)if(u=F[n],null!==u){if(c=w[n],l?(p=T(c),G.pos[i]=p.x,G.pos[i+1]=p.y,G.pos[i+2]=p.z||0):(void 0===g?G.pos[i]=P+S*(n%A):G.pos[i]=v[n%A],G.pos[i+1]=R+C*Math.floor(n/A),G.pos[i+2]=0),G.opacity[t]=L(c),O&&u>=G.minValue&&u<=G.maxValue){for(s=1;s<O.length;s+=1)if(u<=O[s]){G.value[t]=s-1+(u-O[s-1])/(O[s]-O[s-1]);break}}else G.value[t]=(u-G.minValue)*G.factor;t+=1,i+=3}return G},this._init=function(t){u.call(a,t);var i=e.extend({},{opacity:1,position:function(t){return{x:t.x,y:t.y,z:t.z}},value:function(t){return a.position()(t).z}},void 0===t.style?{}:t.style);a.style(i),s&&a.dataTime().modified()},this._init(t),this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(136),o=i(131).registerRenderer,a=function(t){"use strict";if(!(this instanceof a))return new a(t);n.call(this,t),t=t||{};var e=this;return this.api=function(){return"dom"},this._init=function(){var t=e.layer().node();!e.canvas()&&t&&t.length&&e.canvas(t[0])},this._init(t),this};r(a,n),o("dom",a),t.exports=a},function(t,e,i){var r=i(4),n=i(5),o=function(t){"use strict";if(!(this instanceof o))return new o(t);n.call(this),t=t||{};var e=this,i=void 0===t.layer?null:t.layer,r=void 0===t.canvas?null:t.canvas,a=!1;return this.layer=function(){return i},this.canvas=function(t){return void 0===t?r:(r=t,void e.modified())},this.map=function(){return i?i.map():null},this.baseLayer=function(){return e.map()?e.map().baseLayer():void 0},this.initialized=function(t){return void 0===t?a:(a=t,e)},this.api=function(){throw"Should be implemented by derivied classes"},this.reset=function(){return!0},this._init=function(){},this._resize=function(){},this._render=function(){},this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(130),o=i(125),a=i(131),s=function(t){"use strict";if(!(this instanceof s))return new s(t);n.call(this,t);var e=this,i=[],r=this._init,u=this._exit,h=this._update,l=this.draw;return this.createFeature=function(t,r){var n=a.createFeature(t,e,e.renderer(),r);return e.addChild(n),i.push(n),e.features(i),e.modified(),n},this.deleteFeature=function(t){var r;for(r=0;r<i.length;r+=1)i[r]===t&&(i[r]._exit(),e.dataTime().modified(),e.modified(),i.splice(r,1));return e.removeChild(t),e},this.features=function(t){return void 0===t?i:(i=t.slice(0),e.dataTime().modified(),e.modified(),e)},this._init=function(){return e.initialized()?e:(r.call(e,!0),e.geoOn(o.resize,function(t){e.renderer()?(e.renderer()._resize(t.x,t.y,t.width,t.height),e._update({event:t}),e.renderer()._render()):e._update({event:t})}),e.geoOn(o.pan,function(t){e._update({event:t}),e.renderer()&&e.renderer()._render()}),e.geoOn(o.rotate,function(t){e._update({event:t}),e.renderer()&&e.renderer()._render()}),e.geoOn(o.zoom,function(t){e._update({event:t}),e.renderer()&&e.renderer()._render()}),e)},this._update=function(t){var r;if(!i.length)return e;if(h.call(e,t),i&&0===i.length)return void console.log("[info] No valid data source found.");if(e.dataTime().getMTime()>e.updateTime().getMTime())for(r=0;r<i.length;r+=1)i[r].renderer(e.renderer());for(r=0;r<i.length;r+=1)i[r]._update();return e.updateTime().modified(),e},this._exit=function(){e.clear(),u()},this.draw=function(){return l(),e.renderer()&&e.renderer()._render(),e},this.clear=function(){var t;if(!i.length)return e;for(t=0;t<i.length;t+=1)i[t]._exit(),e.removeChild(i[t]);return e.dataTime().modified(),e.modified(),i=[],e},e};r(s,n),a.registerLayer("feature",s),t.exports=s},function(t,e,i){t.exports=function(){"use strict";var t=i(1),e=function(i){if(!(this instanceof e))return new e(i);i=i||{},this._size=i.size||6,this._track=i.track||600,this._needed=i.needed||null,this._batch=!1;var r=this,n=1;return Object.defineProperty(this,"size",{get:function(){return this._size},set:function(t){this._size=t,this.next_item()}}),Object.defineProperty(this,"length",{get:function(){return this._queue.length}}),Object.defineProperty(this,"processing",{get:function(){return this._processing}}),this.clear=function(){return this._queue=[],this._processing=0,this},this.add=function(e,i,n){if(e.__fetchQueue){var o=t.inArray(e,this._queue);if(o>=0)return this._queue.splice(o,1),this._addToQueue(e,n),e}var a=new t.Deferred,s=new t.Deferred;return a.then(function(){t.when(i.call(e)).always(s.resolve)},s.resolve),e.__fetchQueue=a,this._addToQueue(e,n),t.when(a,s).always(function(){r._processing>0&&(r._processing-=1),r.next_item()}).promise(e),r.next_item(),e},this._addToQueue=function(t,e){if(t.__fetchQueue._batch=this._batch,e)this._queue.push(t);else if(this._batch){for(var i=0;i<this._queue.length&&this._queue[i].__fetchQueue._batch===this._batch;i+=1);this._queue.splice(i,0,t)}else this._queue.unshift(t)},this.get=function(e){return t.inArray(e,this._queue)},this.remove=function(e){var i=t.inArray(e,this._queue);return i>=0?(this._queue.splice(i,1),!0):!1},this.batch=function(t){return void 0===t?this._batch:(t?(this._batch=n,n+=1):this._batch=!1,this)},this.next_item=function(){if(!r._innextitem){if(r._innextitem=!0,r._queue.length>r._track&&this._needed)for(var t=r._queue.length-1;t>=0;t-=1)if(!r._needed(r._queue[t])){var e=r._queue.splice(t,1)[0];r._processing+=1,e.__fetchQueue.reject(),delete e.__fetchQueue}for(;r._processing<r._size&&r._queue.length;){var i=r._queue.shift();if(i.__fetchQueue){r._processing+=1;var n=r._needed?r._needed(i):!0;n?i.__fetchQueue.resolve():i.__fetchQueue.reject(),delete i.__fetchQueue}}r._innextitem=!1}},this.clear(),this};return e}()},function(t,e,i){var r=i(4),n=i(137),o=i(5),a=function(t){"use strict";function e(t,e){var i=new FileReader;return e&&(i.onprogress=e),i.onloadend=function(){i.result||t(i.error),t(i.result)},i}if(!(this instanceof a))return new a(t);if(o.call(this),t=t||{},!(t.layer instanceof n))throw"fileReader must be given a feature layer";var i=t.layer;return this.layer=function(){return i},this.canRead=function(){return!1},this.read=function(t,e){e(!1)},this._getString=function(t,i,r){var n=e(i,r);n.readAsText(t)},this._getArrayBuffer=function(t,i,r){var n=e(i,r);n.readAsText(t)},this};r(a,o),t.exports=a},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);var e=i(1);return t=t||{},n.call(this,t),t.style=void 0===t.style?e.extend({},{color:[1,1,1],point_sprites:!1,point_sprites_image:null},t.style):t.style,this.style(t.style),this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);t=t||{},n.call(this,t);var e=i(1),r=i(120),a=i(131),s=this,u=this.draw,h=this.style,l=null,c=null,d=function(t){return t.children},f=[],m=this._init,p=this._exit;return this._init=function(t){m.call(s,t);var i=e.extend(!0,{},{nodes:{radius:5,fill:!0,fillColor:{r:1,g:0,b:0},strokeColor:{r:0,g:0,b:0}},links:{strokeColor:{r:0,g:0,b:0}},linkType:"path"},void 0===t.style?{}:t.style);s.style(i),s.nodes(function(t){return t})},this._build=function(){s.children().forEach(function(t){t._build()})},this._update=function(){s.children().forEach(function(t){t._update()})},this._exit=function(){return s.data([]),f.forEach(function(t){t._exit(),s.removeChild(t)}),f=[],c._exit(),s.removeChild(c),p(),s},this.style=function(t,e){var i=h.call(s,t,e);return i!==s?i:(c.style(t.nodes),f.forEach(function(e){e.style(t.links)}),s)},this.links=function(t){return void 0===t?d:(d=r.ensureFunction(t),s)},this.nodes=function(t){return void 0===t?l:(l=t,s.modified(),s)},this.nodeFeature=function(){return c},this.linkFeatures=function(){return f},this.draw=function(){var t,e=s.layer(),i=s.data(),r=0;return t=s.style(),c.data(i),c.style(t.nodes),i.forEach(function(i){(i.children||[]).forEach(function(n){var o;r+=1,f.length<r&&(o=a.createFeature(t.linkType,e,e.renderer()).style(t.links),s.addChild(o),f.push(o)),f[r-1].data([i,n])})}),f.splice(r,f.length-r).forEach(function(t){t._exit(),s.removeChild(t)}),u(),s},c=a.createFeature("point",this.layer(),this.layer().renderer()),s.addChild(c),t.nodes&&this.nodes(t.nodes),this._init(t),this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(143);t.exports=function(){"use strict";var t=function(e){if(!(this instanceof t))return new t(e);var r=i(1);return e.size=e.size||{x:256,y:256},this._image=null,this._cors=e.crossDomain||"anonymous",n.call(this,e),Object.defineProperty(this,"image",{get:function(){return this._image}}),this.fetch=function(){var t;return this._image||(this._image=new Image(this.size.x,this.size.y),this._url.indexOf(":")>=0&&this._url.indexOf("/")>=0&&this._url.indexOf(":")<this._url.indexOf("/")&&(this._image.crossOrigin=this._cors),
t=new r.Deferred,this._image.onload=t.resolve,this._image.onerror=t.reject,this._image.src=this._url,t.then(function(){this._fetched=!0}.bind(this)).promise(this)),this},this.fadeIn=function(t){var e=this.fetch(),i=new r.Deferred;return r(this._image).css("display","none"),e.then(function(){r(this._image).fadeIn(t,function(){i.resolve()})}.bind(this)),i.promise(this)},this};return r(t,n),t}()},function(t,e,i){t.exports=function(){"use strict";var t=i(1),e=function(i){return this instanceof e?(this._index=i.index,this._size=i.size,this._overlap=i.overlap||{x:0,y:0},this._wrap=i.wrap||{x:1,y:1},this._url=i.url,this._fetched=!1,this._queue=i.queue||null,Object.defineProperty(this,"index",{get:function(){return this._index}}),Object.defineProperty(this,"size",{get:function(){return this._size}}),Object.defineProperty(this,"overlap",{get:function(){return this._overlap}}),this.fetch=function(){return this._fetched||t.get(this._url).then(function(){this._fetched=!0}.bind(this)).promise(this),this},this.fetched=function(){return this._fetched},this.then=function(t,e){return this.fetched()||!this._queue||!this._queue.add||this.state&&"pending"!==this.state()?this.fetch():this._queue.add(this,this.fetch),this.then(t,e),this},this["catch"]=function(t){return this.then(void 0,t),this},this.toString=function(){return[this._index.level||0,this._index.y,this._index.x].join("_")},this.bounds=function(t,e){var i,r,n,o;return i=this.size.x*(this.index.x-t.x)-this.overlap.x-e.x,r=i+this.size.x+2*this.overlap.x,o=this.size.y*(this.index.y-t.y)-this.overlap.y-e.y,n=o+this.size.y+2*this.overlap.y,{left:i,right:r,bottom:n,top:o}},Object.defineProperty(this,"bottom",{get:function(){return this.size.y*(this.index.y+1)+this.overlap.y}}),Object.defineProperty(this,"top",{get:function(){return this.size.y*this.index.y-this.overlap.y}}),Object.defineProperty(this,"left",{get:function(){return this.size.x*this.index.x-this.overlap.x}}),Object.defineProperty(this,"right",{get:function(){return this.size.x*(this.index.x+1)+this.overlap.x}}),Object.defineProperty(this,"levelSize",{value:{width:Math.pow(2,this.index.level||0)*this.size.x,height:Math.pow(2,this.index.level||0)*this.size.y}}),void(this.fadeIn=function(e){return t.noop(e),this})):new e(i)};return e}()},function(t,e,i){var r=i(4),n=i(131).registerFileReader,o=i(139),a=function(t){"use strict";if(!(this instanceof a))return new a(t);var e=i(1),r=this,n=t.style||{};n=e.extend({strokeWidth:2,strokeColor:{r:0,g:0,b:0},strokeOpacity:1,fillColor:{r:1,g:0,b:0},fillOpacity:1},n),o.call(this,t),this.canRead=function(t){if(t instanceof File)return"application/json"===t.type||t.name.match(/\.json$/);if("string"==typeof t){try{JSON.parse(t)}catch(e){return!1}return!0}try{if(Array.isArray(r._featureArray(t)))return!0}catch(e){}return!1},this._readObject=function(t,i,n){function o(t){"string"!=typeof t&&i(!1);try{a=JSON.parse(t),i(a)}catch(r){a||e.ajax({type:"GET",url:t,dataType:"text"}).done(function(t){a=JSON.parse(t),i(a)}).fail(function(){i(!1)})}}var a;t instanceof File?r._getString(t,o,n):"string"==typeof t?o(t):i(t)},this._featureArray=function(t){if("FeatureCollection"===t.type)return t.features||[];if("GeometryCollection"===t.type)throw"GeometryCollection not yet implemented.";if(Array.isArray(t.coordinates))return t;throw"Unsupported collection type: "+t.type},this._featureType=function(t){var e=t.geometry||{};return"Point"===e.type||"MultiPoint"===e.type?"point":"LineString"===e.type?"line":"Polygon"===e.type?"polygon":"MultiPolygon"===e.type?"multipolygon":null},this._getCoordinates=function(t){var e,i=t.geometry||{},r=i.coordinates||[];return(2===r.length||3===r.length)&&isFinite(r[0])&&isFinite(r[1])?(isFinite(r[2])&&(e=r[2]),[{x:r[0],y:r[1],z:e}]):(Array.isArray(r[0][0])&&(r=r[0]),r.map(function(t){return{x:t[0],y:t[1],z:t[2]}}))},this._getStyle=function(t){return t.properties},this.read=function(t,e,i){function n(t){var i,n=[];i=r._featureArray(t),i.forEach(function(t){var e=r._featureType(t),i=r._getCoordinates(t),o=r._getStyle(t);e?"line"===e?(o.fill=o.fill||!1,n.push(r._addFeature(e,[i],o,t.properties))):"point"===e?(o.stroke=o.stroke||!1,n.push(r._addFeature(e,i,o,t.properties))):"polygon"===e?(o.fill=void 0===o.fill?!0:o.fill,o.fillOpacity=void 0===o.fillOpacity?.25:o.fillOpacity,n.push(r._addFeature(e,[[i]],o,t.properties))):"multipolygon"===e&&(o.fill=void 0===o.fill?!0:o.fill,o.fillOpacity=void 0===o.fillOpacity?.25:o.fillOpacity,i=t.geometry.coordinates.map(function(t){return[r._getCoordinates({geometry:{type:"Polygon",coordinates:t}})]}),n.push(r._addFeature("polygon",i,o,t.properties))):console.log("unsupported feature type: "+t.geometry.type)}),e&&e(n)}r._readObject(t,n,i)},this._buildData=function(t,e,i){return t.map(function(t){return{coordinates:t,properties:e,style:i}})},this._addFeature=function(t,i,o,a){var s=e.extend({},n,o),u=r.layer().createFeature(t).data(r._buildData(i,a,o)).style(s);return"line"===t?u.line(function(t){return t.coordinates}):"polygon"===t?u.position(function(t){return{x:t.x,y:t.y,z:t.z}}).polygon(function(t){return{outer:t.coordinates[0],inner:t.coordinates[1]}}):u.position(function(t){return t.coordinates}),u}};r(a,o),n("jsonReader",a),t.exports=a},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);var e=i(1);t=t||{},n.call(this,t);var r=this,a=this._init;return this.line=function(t){return void 0===t?r.style("line"):(r.style("line",t),r.dataTime().modified(),r.modified(),r)},this.position=function(t){return void 0===t?r.style("position"):(r.style("position",t),r.dataTime().modified(),r.modified(),r)},this.pointSearch=function(t){function e(t,e,r){var n,o=i(e,r);return 1>o?i(t,e):(n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/o,0>n?i(t,e):n>1?i(t,r):i(t,{x:e.x+n*(r.x-e.x),y:e.y+n*(r.y-e.y)}))}function i(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}var n,o,a,s,u,h=[],l=[];return n=r.data(),n&&n.length?(a=r.line(),s=r.style.get("strokeWidth"),u=r.position(),o=r.featureGcsToDisplay(t),n.forEach(function(t,i){var n=null;try{a(t,i).forEach(function(a,h){var l=u(a,h,t,i),c=r.featureGcsToDisplay(l),d=Math.ceil(s(l,h,t,i)/2)+2;if(d*=d,n&&e(o,c,n)<=d)throw"found";n=c})}catch(c){if("found"!==c)throw c;l.push(t),h.push(i)}}),{data:l,index:h}):{found:[],index:[]}},this.boxSearch=function(t,e,i){var n=r.position(),o=[],a=r.line();if(i=i||{},i.partial=i.partial||!1,i.partial)throw"Unimplemented query method.";return r.data().forEach(function(i,r){var s=!0;a(i,r).forEach(function(o,a){if(s){var u=n(o,a,i,r);u.x>=t.x&&u.x<=e.x&&u.y>=t.y&&u.y<=e.y||(s=!1)}}),s&&o.push(r)}),o},this._init=function(t){a.call(r,t);var i=e.extend({},{strokeWidth:1,strokeColor:{r:1,g:.8431372549,b:0},strokeStyle:"solid",strokeOpacity:1,line:function(t){return t},position:function(t){return t}},void 0===t.style?{}:t.style);void 0!==t.line&&(i.line=t.line),void 0!==t.position&&(i.position=t.position),r.style(i),r.dataTime().modified()},this._init(t),this};o.create=function(t,e){"use strict";return e.type="line",n.create(t,e)},r(o,n),t.exports=o},function(t,e,i){var r=i(1),n=i(6),o=i(4),a=i(128),s=function(t){"use strict";function e(t){var e,i,r=t.right-t.left,n=t.top-t.bottom,o=Math.abs(r/n),a=D/F;return o>a?(e=1,i=o/a):(i=1,e=a/o),{x:e,y:i}}function o(t,e){if(e){var i={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2},r={width:Math.abs(t.left-t.right),height:Math.abs(t.top-t.bottom)};t=u(i,r,e)}return t}function u(t,e,i){var r=e.width/2,n=e.height/2,o=Math.sin(i),a=Math.cos(i),s={},u={},h={},l={};return s.x=t.x+-r*a- -n*o,s.y=t.y+-r*o+-n*a,u.x=t.x+r*a- -n*o,u.y=t.y+r*o+-n*a,h.x=t.x+-r*a-n*o,h.y=t.y+-r*o+n*a,l.x=t.x+r*a-n*o,l.y=t.y+r*o+n*a,{left:Math.min(s.x,u.x,h.x,l.x),right:Math.max(s.x,u.x,h.x,l.x),bottom:Math.min(s.y,u.y,h.y,l.y),top:Math.max(s.y,u.y,h.y,l.y)}}function h(t,i){void 0===i&&(i=U),t=o(t,i);var r,n=e(t);return r=n.y>n.x?-Math.log2(Math.abs(t.right-t.left)*n.x/(D*v)):-Math.log2(Math.abs(t.top-t.bottom)*n.y/(F*v))}function l(){x?j.min=Math.max(j.origMin,h(Q)):j.min=j.origMin}function c(t,e){return t=Math.max(Math.min(j.max,t),j.min),H&&!e&&(t=Math.round(t),t<j.min&&(t=Math.ceil(j.min))),t}function d(t,e,i){if(!K)return 0;if(e||"function"!=typeof K||(t=K(t)),!i){var r=2*Math.PI;t=t%r+(t>=0?0:r),Math.min(Math.abs(t),Math.abs(t-r))<1e-5&&(t=0)}return t}function f(t,e){if(!g&&!y)return t;var i,n,o=Q;if(e){o=r.extend({},Q);var a,s,u=Math.abs(t.right-t.left),h=Math.abs(t.top-t.bottom),l=Math.abs(Math.sin(e)),c=Math.abs(Math.cos(e));if(t.width&&t.height)a=t.width,s=t.height;else if(Math.abs(l-c)<5e-4)if(D&&F){var d=Math.abs(D/F),f=Math.pow(1+Math.pow(d,2),.5);a=Math.max(u,h)/f,s=a*d}else a=u*c,s=h*l;else a=(c*u-l*h)/(c*c-l*l),s=(c*h-l*u)/(c*c-l*l);var m=u-Math.max(c*a,l*s),p=h-Math.max(c*s,l*a);o.left-=m,o.right+=m,o.top+=p,o.bottom-=p}return g&&(t.right-t.left>o.right-o.left?i=o.left-(t.right-t.left-(o.right-o.left))/2-t.left:t.left<o.left?i=o.left-t.left:t.right>o.right&&(i=o.right-t.right),i&&(t={left:t.left+=i,right:t.right+=i,top:t.top,bottom:t.bottom})),y&&(t.top-t.bottom>o.top-o.bottom?n=o.bottom-(t.top-t.bottom-(o.top-o.bottom))/2-t.bottom:t.top>o.top?n=o.top-t.top:t.bottom<o.bottom&&(n=o.bottom-t.bottom),n&&(t={top:t.top+=n,bottom:t.bottom+=n,left:t.left,right:t.right})),t}function m(t,e){if(Y.rotation=e||0,t.width&&t.height&&e){var i=(t.left+t.right)/2,r=(t.top+t.bottom)/2;Y.viewFromCenterSizeRotation({x:i,y:r},t,e)}else Y.bounds=t}function p(){S.resize(0,0,O.width(),O.height())}if(!(this instanceof s))return new s(t);if(t=t||{},void 0===t.node||null===t.node)return console.warn("map creation requires a node"),this;a.call(this,t);var v,g,y,x,_,M=i(3),b=i(147),w=i(120),T=i(131),A=i(125),E=i(217),P=i(133),R=i(218),S=this,C=this._exit,L=0,I=0,O=r(t.node),D=t.width||O.width()||512,F=t.height||O.height()||512,N=void 0===t.gcs?"EPSG:3857":t.gcs,k=void 0===t.ingcs?"EPSG:4326":t.ingcs,z={x:0,y:0},G=void 0===t.zoom?4:t.zoom,U=0,V=null,B=null,j={min:0,max:16,origMin:0},q=null,W=null,X=null,H=t.discreteZoom?!0:!1,K="function"==typeof t.allowRotation?t.allowRotation:void 0===t.allowRotation?!0:!!t.allowRotation,Q=t.maxBounds||{},Y=t.camera||M(),Z={x:1,y:1,z:1},J=((Q.left||0)+(Q.right||0))/2,$=((Q.bottom||0)+(Q.top||0))/2;return Q.left=b.transformCoordinates(k,N,[{x:void 0!==Q.left?Q.left:-180,y:$}])[0].x,Q.right=b.transformCoordinates(k,N,[{x:void 0!==Q.right?Q.right:180,y:$}])[0].x,Q.top=void 0!==Q.top?b.transformCoordinates(k,N,[{x:J,y:Q.top}])[0].y:Q.right,Q.bottom=void 0!==Q.bottom?b.transformCoordinates(k,N,[{x:J,y:Q.bottom}])[0].y:Q.left,v=t.unitsPerPixel||(Q.right-Q.left)/256,Y.viewport={width:D,height:F},t.center=w.normalizeCoordinates(t.center),t.autoResize=void 0===t.autoResize?!0:t.autoResize,g=void 0===t.clampBoundsX?!1:t.clampBoundsX,y=void 0===t.clampBoundsY?!0:t.clampBoundsY,x=void 0===t.clampZoom?!0:t.clampZoom,this.unitsPerPixel=function(t,e){return t=t||0,e?(v=Math.pow(2,t)*e,S.draw(),S):Math.pow(2,-t)*v},this.clampBoundsX=function(t){return void 0===t?g:(t!==g&&(g=!!t,S.pan({x:0,y:0})),S)},this.clampBoundsY=function(t){return void 0===t?y:(t!==y&&(y=!!t,S.pan({x:0,y:0})),S)},this.clampZoom=function(t){return void 0===t?x:(t!==x&&(x=!!t,l(),S.zoom(G)),S)},this.allowRotation=function(t){return void 0===t?K:("function"!=typeof t&&(t=!!t),t!==K&&(K=t,S.rotation(U)),S)},this.origin=function(){return r.extend({},_)},this.scale=function(){return r.extend({},Z)},this.camera=function(){return Y},this.gcs=function(t){if(void 0===t)return N;if(t!==N){var e=S.center(void 0,void 0);N=t,l();var i=c(G);i!==G&&S.zoom(i),S.center(e,void 0)}return S},this.ingcs=function(t){return void 0===t?k:(k=t,S)},this.node=function(){return O},this.zoom=function(t,e,i){if(void 0===t)return G;var r,n;if(t=c(t,i),t===G)return S;if(G=t,n=S.boundsFromZoomAndCenter(t,z,U,null,i),S.modified(),m(n,U),r={geo:{},zoomLevel:G,screenPosition:e?e.map:void 0},S.geoTrigger(A.zoom,r),e&&e.geo&&e.map){var o=S.gcsToDisplay(e.geo);S.pan({x:e.map.x-o.x,y:e.map.y-o.y},i)}else S.pan({x:0,y:0},i);return S},this.pan=function(t,e){var i,r;i={geo:{},screenDelta:t},r=S.unitsPerPixel(G);var n=Math.sin(U),o=Math.cos(U);Y.pan({x:(t.x*o- -t.y*n)*r,y:(t.x*n+-t.y*o)*r});var a=f(Y.bounds,U);if(a!==Y.bounds){var s=S.gcsToDisplay({x:Y.bounds.left,y:Y.bounds.top},null);a=S.boundsFromZoomAndCenter(G,{x:(a.left+a.right)/2,y:(a.top+a.bottom)/2},U,null,e),m(a,U);var u=S.gcsToDisplay({x:Y.bounds.left,y:Y.bounds.top},null);i.screenDelta.x+=u.x-s.x,i.screenDelta.y+=u.y-s.y}return z=Y.displayToWorld({x:D/2,y:F/2}),S.geoTrigger(A.pan,i),S.modified(),S},this.rotation=function(t,e,i){if(void 0===t)return U;if(t=d(t,i),t===U)return S;U=t;var r=S.boundsFromZoomAndCenter(G,z,U,null,i);S.modified(),m(r,U);var n={geo:{},rotation:U,screenPosition:e?e.map:void 0};if(S.geoTrigger(A.rotate,n),e&&e.geo&&e.map){var o=S.gcsToDisplay(e.geo);S.pan({x:e.map.x-o.x,y:e.map.y-o.y})}else S.pan({x:0,y:0});return l(),S.zoom(G,i),S},this.center=function(t,e,i){var n;return void 0===t?n=r.extend({},S.worldToGcs(z,e)):(z=r.extend({},S.gcsToWorld(t,e)),m(S.boundsFromZoomAndCenter(G,z,U,null,i),U),S.modified(),S.geoTrigger(A.pan,{geo:t,screenDelta:null}),S)},this.createLayer=function(t,e){e=e||{};var i=T.createLayer(t,S,e);return i&&(S.addChild(i),S.children().forEach(function(t){t instanceof R&&t.moveToTop()}),i._update(),S.modified(),S.geoTrigger(A.layerAdd,{type:A.layerAdd,target:S,layer:i})),i},this.deleteLayer=function(t){return null!==t&&void 0!==t&&(t._exit(),S.removeChild(t),S.modified(),S.geoTrigger(A.layerRemove,{type:A.layerRemove,target:S,layer:t})),t},this.size=function(t){return void 0===t?{width:D,height:F}:(S.resize(0,0,t.width,t.height),S)},this.rotatedSize=function(){if(!this.rotation())return{width:D,height:F};var t=u({x:0,y:0},{width:D,height:F},this.rotation());return{width:Math.abs(t.right-t.left),height:Math.abs(t.top-t.bottom)}},this.resize=function(t,e,i,r){var n=S.center();L=t,I=e,D=i,F=r,l();var o=c(G);return o!==G&&S.zoom(o),S.camera().viewport={width:i,height:r},S.center(n),S.geoTrigger(A.resize,{type:A.resize,target:S,x:L,y:I,width:i,height:r}),S.modified(),S},this.gcsToWorld=function(t,e){return e=null===e?N:void 0===e?k:e,e!==N&&(t=b.transformCoordinates(e,N,[t])[0]),b.affineForward({origin:_},[t])[0]},this.worldToGcs=function(t,e){return t=b.affineInverse({origin:_},[t])[0],e=null===e?N:void 0===e?k:e,e!==N&&(t=b.transformCoordinates(N,e,[t])[0]),t},this.gcsToDisplay=function(t,e){return t=S.gcsToWorld(t,e),S.worldToDisplay(t)},this.worldToDisplay=function(t){return Y.worldToDisplay(t)},this.displayToGcs=function(t,e){return t=S.displayToWorld(t),S.worldToGcs(t,e)},this.displayToWorld=function(t){return Y.displayToWorld(t)},this.draw=function(){var t,e=S.children();for(S.geoTrigger(A.draw,{type:A.draw,target:S}),S._update(),t=0;t<e.length;t+=1)e[t].draw();return S.geoTrigger(A.drawEnd,{type:A.drawEnd,target:S}),S},this.fileReader=function(t,e){var i,r;return e=e||{},t?(i=e.layer,i||(r=e.renderer,r||(r="d3"),i=S.createLayer("feature",{renderer:r})),e.layer=i,e.renderer=r,V=T.createFileReader(t,e),S):V},this._init=function(){if(void 0===O||null===O)throw"Map require DIV node";return O.css("position","relative"),S},this._update=function(t){var e,i=S.children();for(e=0;e<i.length;e+=1)i[e]._update(t);return S},this.exit=function(){var t,e=S.children();for(t=0;t<e.length;t+=1)e[t]._exit();S.interactor()&&(S.interactor().destroy(),S.interactor(null)),S.node().off(".geo"),S.node().empty(),r(window).off("resize",p),C()},this._init(t),this.node().on("dragover.geo",function(t){var e=t.originalEvent;S.fileReader()&&(e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy")}).on("drop.geo",function(t){function e(){S.draw()}var i,r,n=t.originalEvent,o=S.fileReader();if(o)for(n.stopPropagation(),n.preventDefault(),i=0;i<n.dataTransfer.files.length;i+=1)r=n.dataTransfer.files[i],o.canRead(r)&&o.read(r,e)}),this.interactor=function(t){return void 0===t?B:(B=t,B&&B.map(S),S)},this.clock=function(t){return void 0===t?X:(X=t,X&&X.object(S),S)},this.zoomRange=function(t,e){return void 0===t?r.extend({},j):(void 0!==t.max&&(j.max=t.max),void 0!==t.min&&(j.min=j.origMin=t.min),l(),e||S.zoom(G),S)},this.transition=function(t,e,i){function o(t,e,i){return t+(e-t)*i}function a(t,e){return function(i){var n=[];return r.each(t,function(r){n.push(o(t[r],e[r],i))}),n}}function s(t){return n.zoomToHeight(t+1,D,F)*f}function u(t){return n.heightToZoom(t/f,D,F)-1}function h(e){var i=q.done,r=W;if(q.cancel===!0)return S.geoTrigger(A.transitioncancel,t),i&&i({cancel:!0,source:q.cancelSource,transition:q}),q=null,void(W&&(r=W,W=null,S.transition(r,void 0,e)));if(q.start.time||(q.start.time=e,q.end.time=e+t.duration),q.time=e-q.start.time,e>=q.end.time||r)return r||(S.center(q.end.center,null),S.zoom(q.end.zoom,q.zoomOrigin),S.rotation(d(q.end.rotation))),S.geoTrigger(A.transitionend,t),i&&i({next:!!r}),q=null,void(W&&(r=W,W=null,S.transition(r,void 0,e)));var n=q.ease((e-q.start.time)/t.duration),o=q.interp(n);q.zCoord&&(o[2]=u(o[2])),c(o[2],!0)===G?S.center({x:o[0],y:o[1]},null,!0):(z=S.gcsToWorld({x:o[0],y:o[1]},null),S.zoom(o[2],q.zoomOrigin,!0)),S.rotation(o[3],void 0,!0),window.requestAnimationFrame(h)}if(void 0===t)return q;if(q){var l=r.extend(!0,{},q.end);return l.center&&N!==k&&(l.center=b.transformCoordinates(N,k,[l.center])[0]),W=r.extend({},l||{},W||{},t),S}var f=S.unitsPerPixel(0),m={center:S.center(void 0,null),zoom:S.zoom(),rotation:S.rotation(),duration:1e3,ease:function(t){return t},interp:a,done:null,zCoord:!0};return t.center&&(e=null===e?N:void 0===e?k:e,t=r.extend(!0,{},t),t.center=w.normalizeCoordinates(t.center),e!==N&&(t.center=b.transformCoordinates(e,N,[t.center])[0])),t=r.extend(!0,{},m,t),q={start:{center:S.center(void 0,null),zoom:S.zoom(),rotation:S.rotation()},end:{center:t.center,zoom:c(t.zoom),rotation:d(t.rotation,void 0,!0)},ease:t.ease,zCoord:t.zCoord,done:t.done,duration:t.duration,zoomOrigin:t.zoomOrigin},t.zCoord?q.interp=t.interp([q.start.center.x,q.start.center.y,s(q.start.zoom),q.start.rotation],[q.end.center.x,q.end.center.y,s(q.end.zoom),q.end.rotation]):q.interp=t.interp([q.start.center.x,q.start.center.y,q.start.zoom,q.start.rotation],[q.end.center.x,q.end.center.y,q.end.zoom,q.end.rotation]),S.geoTrigger(A.transitionstart,t),A.cancelNavigation?(q=null,S.geoTrigger(A.transitionend,t),S):(A.cancelAnimation?(t.duration=0,h(0)):i?h(i):window.requestAnimationFrame(h),S)},this.transitionCancel=function(t){return q&&(q.cancel!==!0||W)?(q.cancel=!0,q.cancelSource=t||q.cancelSource||"",W=null,!0):!1},this.bounds=function(t,e){var i;if(e=null===e?N:void 0===e?k:e,void 0!==t){if(e!==N){var r=b.transformCoordinates(e,N,[{x:t.left,y:t.top},{x:t.right,y:t.bottom}]);t={left:r[0].x,top:r[0].y,right:r[1].x,bottom:r[1].y}}t=f(t,U),i=S.zoomAndCenterFromBounds(t,U,null),S.zoom(i.zoom),S.center(i.center,null)}return S.boundsFromZoomAndCenter(G,z,U,e,!0)},this.maxBounds=function(t,e){if(e=null===e?N:void 0===e?k:e,void 0===t)return{left:b.transformCoordinates(N,e,[{x:Q.left,y:0}])[0].x,right:b.transformCoordinates(N,e,[{x:Q.right,y:0}])[0].x,bottom:b.transformCoordinates(N,e,[{x:0,y:Q.bottom}])[0].y,top:b.transformCoordinates(N,e,[{x:0,y:Q.top}])[0].y};var i=((t.left||0)+(t.right||0))/2,r=((t.bottom||0)+(t.top||0))/2;return void 0!==t.left&&(Q.left=b.transformCoordinates(e,N,[{x:t.left,y:r}])[0].x),void 0!==t.right&&(Q.right=b.transformCoordinates(e,N,[{x:t.right,y:r}])[0].x),void 0!==t.bottom&&(Q.bottom=b.transformCoordinates(e,N,[{x:i,y:t.bottom}])[0].y),void 0!==t.top&&(Q.top=b.transformCoordinates(e,N,[{x:i,y:t.top}])[0].y),l(),S.zoom(G),S.pan({x:0,y:0}),this},this.zoomAndCenterFromBounds=function(t,e,i){var r,n;if(i=null===i?N:void 0===i?k:i,i!==N){var o=b.transformCoordinates(i,N,[{x:t.left,y:t.top},{x:t.right,y:t.bottom}]);t={left:o[0].x,top:o[0].y,right:o[1].x,bottom:o[1].y}}if(t.left>=t.right||t.bottom>=t.top)throw new Error("Invalid bounds provided");return n=c(h(t,e)),t=f(t,e),r={x:(t.left+t.right)/2-_.x,y:(t.top+t.bottom)/2-_.y},i!==N&&(r=b.transformCoordinates(N,i,[r])[0]),{zoom:n,center:r}},this.boundsFromZoomAndCenter=function(t,e,i,r,n){var o,a,s,h,l,d;if(r=null===r?N:void 0===r?k:r,t=c(t,n),d=S.unitsPerPixel(t),e=S.gcsToWorld(e,r),o=D*d,a=F*d,s=o/2,h=a/2,i?(e.x+=_.x,e.y+=_.y,l=u(e,{width:o,height:a},i),l.width=o,l.height=a,l=f(l,i)):(l={left:e.x-s+_.x,right:e.x+s+_.x,bottom:e.y-h+_.y,top:e.y+h+_.y},l=f(l,0)),r!==N){var m=b.transformCoordinates(N,r,[[l.left,l.top],[l.right,l.bottom]]);l={left:m[0][0],top:m[0][1],right:m[1][0],bottom:m[1][1]}}return l.width=o,l.height=a,l},this.discreteZoom=function(t){return void 0===t?H:(t=t?!0:!1,H!==t&&(H=t,H&&S.zoom(Math.round(S.zoom())),S.interactor().options({discreteZoom:H})),S)},this.layers=this.children,this.updateAttribution=function(){S.node().find(".geo-attribution").remove();var t=r("<div/>").addClass("geo-attribution").css({position:"absolute",right:"0px",bottom:"0px","padding-right":"5px",cursor:"auto",font:'11px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif',"z-index":"1001",background:"rgba(255,255,255,0.7)",clear:"both",display:"block","pointer-events":"auto"}).on("mousedown",function(t){t.stopPropagation()});return S.children().forEach(function(e){var i=e.attribution();i&&r("<span/>").addClass("geo-attribution-layer").css({"padding-left":"5px"}).html(i).appendTo(t)}),t.appendTo(S.node()),S},_={x:0,y:0},this.zoomRange(t,!0),G=c(G),U=d(U),this.center(r.extend({},t.center||z),void 0),this.interactor(t.interactor||E({discreteZoom:H})),this.clock(t.clock||P()),t.autoResize&&r(window).resize(p),S.geoOn([A.layerAdd,A.layerRemove],S.updateAttribution),this};s.create=function(t){"use strict";var e=s(t),r=i(130);return e&&e.zoom?(t.data=t.data||[],t.layers=t.layers||[],t.layers.forEach(function(i){i.data=i.data||t.data,i.layer=r.create(e,i)}),e):(console.warn("Could not create map."),null)},o(s,a),t.exports=s},function(t,e,i){var r=function(t){"use strict";function e(){n=new s(u.source(),u.target())}if(!(this instanceof r))return new r(t);var n,o,a,s=i(148),u=this;this.source=function(t){return void 0===t?o||"EPSG:4326":(o=t,e(),u)},this.target=function(t){return void 0===t?a||"EPSG:3857":(a=t,e(),u)},this._forward=function(t){var e=n.forward(t);return e.z=t.z||0,e},this._inverse=function(t){var e=n.inverse(t);return e.z=t.z||0,e},this.forward=function(t){return Array.isArray(t)?t.map(u._forward):u._forward(t)},this.inverse=function(t){return Array.isArray(t)?t.map(u._inverse):u._inverse(t)},t=t||{};try{this.source(t.source)}catch(h){console.error("Can't use transform source: "+t.source),this.source("EPSG:4326")}try{this.target(t.target)}catch(h){console.error("Can't use transform target: "+t.target),this.target("EPSG:3857")}return this};r.transformCoordinates=function(t,e,i,n){"use strict";function o(){if(i[0]instanceof Array)if(2===i[0].length)l=function(t){return i[t][0]},c=function(t){return i[t][1]},f=function(t,e,i){m[t]=[e,i]};else{if(3!==i[0].length)throw"Invalid coordinates. Requires two or three components per array";l=function(t){return i[t][0]},c=function(t){return i[t][1]},d=function(t){return i[t][2]},f=function(t,e,i,r){m[t]=[e,i,r]}}else if(2===i.length)h=2,l=function(t){return i[t*h]},c=function(t){return i[t*h+1]},f=function(t,e,i){m[t]=e,m[t+1]=i};else if(3===i.length)h=3,l=function(t){return i[t*h]},c=function(t){return i[t*h+1]},d=function(t){return i[t*h+2]},f=function(t,e,i,r){m[t]=e,m[t+1]=i,m[t+2]=r};else{if(!n)throw"Invalid coordinates";if(2!==n&&3!==n)throw"Number of components should be two or three";h=n,l=function(t){return i[t]},c=function(t){return i[t+1]},2===n?f=function(t,e,i){m[t]=e,m[t+1]=i}:(d=function(t){return i[t+2]},f=function(t,e,i,r){m[t]=e,m[t+1]=i,m[t+2]=r})}}function a(){if(i[0]&&"x"in i[0]&&"y"in i[0])l=function(t){return i[t].x},c=function(t){return i[t].y},"z"in i[0]?(d=function(t){return i[t].z},f=function(t,e,i,r){m[s]={x:e,y:i,z:r}}):f=function(t,e,i){m[t]={x:e,y:i}};else{if(!(i&&"x"in i&&"y"in i))throw"Invalid coordinates";l=function(){return i.x},c=function(){return i.y},"z"in i?(d=function(){return i.z},f=function(t,e,i,r){m={x:e,y:i,z:r}}):f=function(t,e,i){m={x:e,y:i}}}}if(t===e)return i;var s,u,h,l,c,d,f,m,p,v=r({source:t,target:e});if(d=function(){return 0},i instanceof Array)m=[],m.length=i.length,u=i.length,i[0]instanceof Array||i[0]instanceof Object?(h=1,i[0]instanceof Array?o():i[0]instanceof Object&&a()):o();else if(i&&i instanceof Object){if(u=1,h=1,!(i&&"x"in i&&"y"in i))throw"Coordinates are not valid";a()}for(s=0;u>s;s+=h)p=v.forward({x:l(s),y:c(s),z:d(s)}),f(s,p.x,p.y,p.z);return m},r.affineForward=function(t,e){"use strict";var i,r=t.origin,n=t.scale||{x:1,y:1,z:1};for(i=0;i<e.length;i+=1)e[i].x=(e[i].x-r.x)*n.x,e[i].y=(e[i].y-r.y)*n.y,e[i].z=((e[i].z||0)-(r.z||0))*n.z;return e},r.affineInverse=function(t,e){"use strict";var i,r=t.origin,n=t.scale||{x:1,y:1,z:1};for(i=0;i<e.length;i+=1)e[i].x=e[i].x/n.x+r.x,e[i].y=e[i].y/n.y+r.y,e[i].z=(e[i].z||0)/n.z+(r.z||0);return e},t.exports=r},function(t,e,i){var r=i(149);r.defaultDatum="WGS84",r.Proj=i(150),r.WGS84=new r.Proj("WGS84"),r.Point=i(175),r.toPoint=i(174),r.defs=i(152),r.transform=i(171),r.mgrs=i(176),r.version=i(177).version,i(178)(r),t.exports=r},function(t,e,i){function r(t,e,i){var r;return Array.isArray(i)?(r=s(t,e,i),3===i.length?[r.x,r.y,r.z]:[r.x,r.y]):s(t,e,i)}function n(t){return t instanceof a?t:t.oProj?t.oProj:a(t)}function o(t,e,i){t=n(t);var o,a=!1;return"undefined"==typeof e?(e=t,t=u,a=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(i=e,e=t,t=u,a=!0),e=n(e),i?r(t,e,i):(o={forward:function(i){return r(t,e,i)},inverse:function(i){return r(e,t,i)}},a&&(o.oProj=e),o)}var a=i(150),s=i(171),u=a("WGS84");t.exports=o},function(t,e,i){function r(t,e){if(!(this instanceof r))return new r(t);e=e||function(t){if(t)throw t};var i=n(t);if("object"!=typeof i)return void e(t);var a=s(i),u=r.projections.get(a.projName);u?(o(this,a),o(this,u),this.init(),e(null,this)):e(t)}var n=i(151),o=i(158),a=i(159),s=i(167);r.projections=a,r.projections.start(),t.exports=r},function(t,e,i){function r(t){return"string"==typeof t}function n(t){return t in u}function o(t){var e=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return e.reduce(function(e,i){return e+1+t.indexOf(i)},0)}function a(t){return"+"===t[0]}function s(t){return r(t)?n(t)?u[t]:o(t)?h(t):a(t)?l(t):void 0:t}var u=i(152),h=i(157),l=i(154);t.exports=s},function(t,e,i){function r(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?r[t]=o(arguments[1]):r[t]=a(arguments[1]):r[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?r.apply(e,t):r(t)});if("string"==typeof t){if(t in r)return r[t]}else"EPSG"in t?r["EPSG:"+t.EPSG]=t:"ESRI"in t?r["ESRI:"+t.ESRI]=t:"IAU2000"in t?r["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var n=i(153),o=i(154),a=i(157);n(r),t.exports=r},function(t,e){t.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},function(t,e,i){var r=.017453292519943295,n=i(155),o=i(156);t.exports=function(t){var e={},i={};t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).forEach(function(t){var e=t.split("=");e.push(!0),i[e[0].toLowerCase()]=e[1]});var a,s,u,h={proj:"projName",datum:"datumCode",rf:function(t){e.rf=parseFloat(t)},lat_0:function(t){e.lat0=t*r},lat_1:function(t){e.lat1=t*r},lat_2:function(t){e.lat2=t*r},lat_ts:function(t){e.lat_ts=t*r},lon_0:function(t){e.long0=t*r},lon_1:function(t){e.long1=t*r},lon_2:function(t){e.long2=t*r},alpha:function(t){e.alpha=parseFloat(t)*r},lonc:function(t){e.longc=t*r},x_0:function(t){e.x0=parseFloat(t)},y_0:function(t){e.y0=parseFloat(t)},k_0:function(t){e.k0=parseFloat(t)},k:function(t){e.k0=parseFloat(t)},a:function(t){e.a=parseFloat(t)},b:function(t){e.b=parseFloat(t)},r_a:function(){e.R_A=!0},zone:function(t){e.zone=parseInt(t,10)},south:function(){e.utmSouth=!0},towgs84:function(t){e.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){e.to_meter=parseFloat(t)},units:function(t){e.units=t,o[t]&&(e.to_meter=o[t].to_meter)},from_greenwich:function(t){e.from_greenwich=t*r},pm:function(t){e.from_greenwich=(n[t]?n[t]:parseFloat(t))*r},nadgrids:function(t){"@null"===t?e.datumCode="none":e.nadgrids=t},axis:function(t){var i="ewnsud";3===t.length&&-1!==i.indexOf(t.substr(0,1))&&-1!==i.indexOf(t.substr(1,1))&&-1!==i.indexOf(t.substr(2,1))&&(e.axis=t)}};for(a in i)s=i[a],a in h?(u=h[a],"function"==typeof u?u(s):e[u]=s):e[a]=s;return"string"==typeof e.datumCode&&"WGS84"!==e.datumCode&&(e.datumCode=e.datumCode.toLowerCase()),e}},function(t,e){e.greenwich=0,e.lisbon=-9.131906111111,e.paris=2.337229166667,e.bogota=-74.080916666667,e.madrid=-3.687938888889,e.rome=12.452333333333,e.bern=7.439583333333,e.jakarta=106.807719444444,e.ferro=-17.666666666667,e.brussels=4.367975,e.stockholm=18.058277777778,e.athens=23.7163375,e.oslo=10.722916666667},function(t,e){e.ft={to_meter:.3048},e["us-ft"]={to_meter:1200/3937}},function(t,e,i){function r(t,e,i){t[e]=i.map(function(t){var e={};return n(t,e),e}).reduce(function(t,e){return h(t,e)},{})}function n(t,e){var i;return Array.isArray(t)?(i=t.shift(),"PARAMETER"===i&&(i=t.shift()),1===t.length?Array.isArray(t[0])?(e[i]={},n(t[0],e[i])):e[i]=t[0]:t.length?"TOWGS84"===i?e[i]=t:(e[i]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(i)>-1?(e[i]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[i].auth=t[2])):"SPHEROID"===i?(e[i]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[i].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(i)>-1?(t[0]=["name",t[0]],r(e,i,t)):t.every(function(t){return Array.isArray(t)})?r(e,i,t):n(t,e[i])):e[i]=!0,void 0):void(e[t]=!0)}function o(t,e){var i=e[0],r=e[1];!(i in t)&&r in t&&(t[i]=t[r],3===e.length&&(t[i]=e[2](t[i])))}function a(t){return t*u}function s(t){function e(e){var i=t.to_meter||1;return parseFloat(e,10)*i}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=parseFloat(t.UNIT.convert,10)*t.DATUM.SPHEROID.a):t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.GEOGCS.DATUM?t.datumCode=t.GEOGCS.DATUM.name.toLowerCase():t.datumCode=t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===t.datumCode||"new_zealand_1949"===t.datumCode)&&(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var i=function(e){return o(t,e)},r=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",a],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",a],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",a],["lat0","latitude_of_origin",a],["lat0","standard_parallel_1",a],["lat1","standard_parallel_1",a],["lat2","standard_parallel_2",a],["alpha","azimuth",a],["srsCode","name"]];
r.forEach(i),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=a(t.lat1>0?90:-90),t.lat_ts=t.lat1)}var u=.017453292519943295,h=i(158);t.exports=function(t,e){var i=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),r=i.shift(),o=i.shift();i.unshift(["name",o]),i.unshift(["type",r]),i.unshift("output");var a={};return n(i,a),s(a.output),h(e,a.output)}},function(t,e){t.exports=function(t,e){t=t||{};var i,r;if(!e)return t;for(r in e)i=e[r],void 0!==i&&(t[r]=i);return t}},function(t,e,i){function r(t,e){var i=a.length;return t.names?(a[i]=t,t.names.forEach(function(t){o[t.toLowerCase()]=i}),this):(console.log(e),!0)}var n=[i(160),i(166)],o={},a=[];e.add=r,e.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof o[e]&&a[o[e]]?a[o[e]]:void 0},e.start=function(){n.forEach(r)}},function(t,e,i){var r=i(161),n=Math.PI/2,o=1e-10,a=57.29577951308232,s=i(162),u=Math.PI/4,h=i(164),l=i(165);e.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},e.forward=function(t){var e=t.x,i=t.y;if(i*a>90&&-90>i*a&&e*a>180&&-180>e*a)return null;var r,l;if(Math.abs(Math.abs(i)-n)<=o)return null;if(this.sphere)r=this.x0+this.a*this.k0*s(e-this.long0),l=this.y0+this.a*this.k0*Math.log(Math.tan(u+.5*i));else{var c=Math.sin(i),d=h(this.e,i,c);r=this.x0+this.a*this.k0*s(e-this.long0),l=this.y0-this.a*this.k0*Math.log(d)}return t.x=r,t.y=l,t},e.inverse=function(t){var e,i,r=t.x-this.x0,o=t.y-this.y0;if(this.sphere)i=n-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var a=Math.exp(-o/(this.a*this.k0));if(i=l(this.e,a),-9999===i)return null}return e=s(this.long0+r/(this.a*this.k0)),t.x=e,t.y=i,t},e.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},function(t,e){t.exports=function(t,e,i){var r=t*e;return i/Math.sqrt(1-r*r)}},function(t,e,i){var r=2*Math.PI,n=3.14159265359,o=i(163);t.exports=function(t){return Math.abs(t)<=n?t:t-o(t)*r}},function(t,e){t.exports=function(t){return 0>t?-1:1}},function(t,e){var i=Math.PI/2;t.exports=function(t,e,r){var n=t*r,o=.5*t;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(i-e))/n}},function(t,e){var i=Math.PI/2;t.exports=function(t,e){for(var r,n,o=.5*t,a=i-2*Math.atan(e),s=0;15>=s;s++)if(r=t*Math.sin(a),n=i-2*Math.atan(e*Math.pow((1-r)/(1+r),o))-a,a+=n,Math.abs(n)<=1e-10)return a;return-9999}},function(t,e){function i(t){return t}e.init=function(){},e.forward=i,e.inverse=i,e.names=["longlat","identity"]},function(t,e,i){var r=i(168),n=i(169),o=i(158),a=i(170),s=1e-10,u=.16666666666666666,h=.04722222222222222,l=.022156084656084655;t.exports=function(t){if(t.datumCode&&"none"!==t.datumCode){var e=r[t.datumCode];e&&(t.datum_params=e.towgs84?e.towgs84.split(","):null,t.ellps=e.ellipse,t.datumName=e.datumName?e.datumName:t.datumCode)}if(!t.a){var i=n[t.ellps]?n[t.ellps]:n.WGS84;o(t,i)}return t.rf&&!t.b&&(t.b=(1-1/t.rf)*t.a),(0===t.rf||Math.abs(t.a-t.b)<s)&&(t.sphere=!0,t.b=t.a),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=(t.a2-t.b2)/t.a2,t.e=Math.sqrt(t.es),t.R_A&&(t.a*=1-t.es*(u+t.es*(h+t.es*l)),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=0),t.ep2=(t.a2-t.b2)/t.b2,t.k0||(t.k0=1),t.axis||(t.axis="enu"),t.datum||(t.datum=a(t)),t}},function(t,e){e.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},e.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},e.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},e.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},e.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},e.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},e.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},e.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},e.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},e.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},e.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},e.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},e.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},e.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},e.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},e.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},function(t,e){e.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},e.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},e.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},e.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},e.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},e.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},e.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},e.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},e.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},e.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},e.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},e.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},e.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},e.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},e.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},e.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},e.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},e.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},e.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},e.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},e.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},e.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},e.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},e.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},e.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},e.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},e.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},e.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},e.hough={a:6378270,rf:297,ellipseName:"Hough"},e.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},e.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},e.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},e.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},e.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},e.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},e.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},e.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},e.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},e.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},e.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},e.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},e.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},e.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},function(t,e){var i=Math.PI/2,r=1,n=2,o=3,a=4,s=5,u=484813681109536e-20,h=1.0026,l=.3826834323650898,c=function(t){return this instanceof c?(this.datum_type=a,void(t&&(t.datumCode&&"none"===t.datumCode&&(this.datum_type=s),t.datum_params&&(this.datum_params=t.datum_params.map(parseFloat),(0!==this.datum_params[0]||0!==this.datum_params[1]||0!==this.datum_params[2])&&(this.datum_type=r),this.datum_params.length>3&&(0!==this.datum_params[3]||0!==this.datum_params[4]||0!==this.datum_params[5]||0!==this.datum_params[6])&&(this.datum_type=n,this.datum_params[3]*=u,this.datum_params[4]*=u,this.datum_params[5]*=u,this.datum_params[6]=this.datum_params[6]/1e6+1)),this.datum_type=t.grids?o:this.datum_type,this.a=t.a,this.b=t.b,this.es=t.es,this.ep2=t.ep2,this.datum_type===o&&(this.grids=t.grids)))):new c(t)};c.prototype={compare_datums:function(t){return this.datum_type!==t.datum_type?!1:this.a!==t.a||Math.abs(this.es-t.es)>5e-11?!1:this.datum_type===r?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]:this.datum_type===n?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]&&this.datum_params[3]===t.datum_params[3]&&this.datum_params[4]===t.datum_params[4]&&this.datum_params[5]===t.datum_params[5]&&this.datum_params[6]===t.datum_params[6]:this.datum_type===o||t.datum_type===o?this.nadgrids===t.nadgrids:!0},geodetic_to_geocentric:function(t){var e,r,n,o,a,s,u,h=t.x,l=t.y,c=t.z?t.z:0,d=0;if(-i>l&&l>-1.001*i)l=-i;else if(l>i&&1.001*i>l)l=i;else if(-i>l||l>i)return null;return h>Math.PI&&(h-=2*Math.PI),a=Math.sin(l),u=Math.cos(l),s=a*a,o=this.a/Math.sqrt(1-this.es*s),e=(o+c)*u*Math.cos(h),r=(o+c)*u*Math.sin(h),n=(o*(1-this.es)+c)*a,t.x=e,t.y=r,t.z=n,d},geocentric_to_geodetic:function(t){var e,r,n,o,a,s,u,h,l,c,d,f,m,p,v,g,y,x=1e-12,_=x*x,M=30,b=t.x,w=t.y,T=t.z?t.z:0;if(m=!1,e=Math.sqrt(b*b+w*w),r=Math.sqrt(b*b+w*w+T*T),e/this.a<x){if(m=!0,v=0,r/this.a<x)return g=i,void(y=-this.b)}else v=Math.atan2(w,b);n=T/r,o=e/r,a=1/Math.sqrt(1-this.es*(2-this.es)*o*o),h=o*(1-this.es)*a,l=n*a,p=0;do p++,u=this.a/Math.sqrt(1-this.es*l*l),y=e*h+T*l-u*(1-this.es*l*l),s=this.es*u/(u+y),a=1/Math.sqrt(1-s*(2-s)*o*o),c=o*(1-s)*a,d=n*a,f=d*h-c*l,h=c,l=d;while(f*f>_&&M>p);return g=Math.atan(d/Math.abs(c)),t.x=v,t.y=g,t.z=y,t},geocentric_to_geodetic_noniter:function(t){var e,r,n,o,a,s,u,c,d,f,m,p,v,g,y,x,_,M=t.x,b=t.y,w=t.z?t.z:0;if(M=parseFloat(M),b=parseFloat(b),w=parseFloat(w),_=!1,0!==M)e=Math.atan2(b,M);else if(b>0)e=i;else if(0>b)e=-i;else if(_=!0,e=0,w>0)r=i;else{if(!(0>w))return r=i,void(n=-this.b);r=-i}return a=M*M+b*b,o=Math.sqrt(a),s=w*h,c=Math.sqrt(s*s+a),f=s/c,p=o/c,m=f*f*f,u=w+this.b*this.ep2*m,x=o-this.a*this.es*p*p*p,d=Math.sqrt(u*u+x*x),v=u/d,g=x/d,y=this.a/Math.sqrt(1-this.es*v*v),n=g>=l?o/g-y:-l>=g?o/-g-y:w/v+y*(this.es-1),_===!1&&(r=Math.atan(v/g)),t.x=e,t.y=r,t.z=n,t},geocentric_to_wgs84:function(t){if(this.datum_type===r)t.x+=this.datum_params[0],t.y+=this.datum_params[1],t.z+=this.datum_params[2];else if(this.datum_type===n){var e=this.datum_params[0],i=this.datum_params[1],o=this.datum_params[2],a=this.datum_params[3],s=this.datum_params[4],u=this.datum_params[5],h=this.datum_params[6],l=h*(t.x-u*t.y+s*t.z)+e,c=h*(u*t.x+t.y-a*t.z)+i,d=h*(-s*t.x+a*t.y+t.z)+o;t.x=l,t.y=c,t.z=d}},geocentric_from_wgs84:function(t){if(this.datum_type===r)t.x-=this.datum_params[0],t.y-=this.datum_params[1],t.z-=this.datum_params[2];else if(this.datum_type===n){var e=this.datum_params[0],i=this.datum_params[1],o=this.datum_params[2],a=this.datum_params[3],s=this.datum_params[4],u=this.datum_params[5],h=this.datum_params[6],l=(t.x-e)/h,c=(t.y-i)/h,d=(t.z-o)/h;t.x=l+u*c-s*d,t.y=-u*l+c+a*d,t.z=s*l-a*c+d}}},t.exports=c},function(t,e,i){var r=.017453292519943295,n=57.29577951308232,o=1,a=2,s=i(172),u=i(173),h=i(150),l=i(174);t.exports=function c(t,e,i){function d(t,e){return(t.datum.datum_type===o||t.datum.datum_type===a)&&"WGS84"!==e.datumCode}var f;return Array.isArray(i)&&(i=l(i)),t.datum&&e.datum&&(d(t,e)||d(e,t))&&(f=new h("WGS84"),c(t,f,i),t=f),"enu"!==t.axis&&u(t,!1,i),"longlat"===t.projName?(i.x*=r,i.y*=r):(t.to_meter&&(i.x*=t.to_meter,i.y*=t.to_meter),t.inverse(i)),t.from_greenwich&&(i.x+=t.from_greenwich),i=s(t.datum,e.datum,i),e.from_greenwich&&(i.x-=e.from_greenwich),"longlat"===e.projName?(i.x*=n,i.y*=n):(e.forward(i),e.to_meter&&(i.x/=e.to_meter,i.y/=e.to_meter)),"enu"!==e.axis&&u(e,!0,i),i}},function(t,e){var i=1,r=2,n=3,o=5,a=6378137,s=.006694379990141316;t.exports=function(t,e,u){function h(t){return t===i||t===r}var l,c,d;if(t.compare_datums(e))return u;if(t.datum_type===o||e.datum_type===o)return u;var f=t.a,m=t.es,p=e.a,v=e.es,g=t.datum_type;if(g===n)if(0===this.apply_gridshift(t,0,u))t.a=a,t.es=s;else{if(!t.datum_params)return t.a=f,t.es=t.es,u;for(l=1,c=0,d=t.datum_params.length;d>c;c++)l*=t.datum_params[c];if(0===l)return t.a=f,t.es=t.es,u;g=t.datum_params.length>3?r:i}return e.datum_type===n&&(e.a=a,e.es=s),(t.es!==e.es||t.a!==e.a||h(g)||h(e.datum_type))&&(t.geodetic_to_geocentric(u),h(t.datum_type)&&t.geocentric_to_wgs84(u),h(e.datum_type)&&e.geocentric_from_wgs84(u),e.geocentric_to_geodetic(u)),e.datum_type===n&&this.apply_gridshift(e,1,u),t.a=f,t.es=m,e.a=p,e.es=v,u}},function(t,e){t.exports=function(t,e,i){var r,n,o,a=i.x,s=i.y,u=i.z||0;for(o=0;3>o;o++)if(!e||2!==o||void 0!==i.z)switch(0===o?(r=a,n="x"):1===o?(r=s,n="y"):(r=u,n="z"),t.axis[o]){case"e":i[n]=r;break;case"w":i[n]=-r;break;case"n":i[n]=r;break;case"s":i[n]=-r;break;case"u":void 0!==i[n]&&(i.z=r);break;case"d":void 0!==i[n]&&(i.z=-r);break;default:return null}return i}},function(t,e){t.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},function(t,e,i){function r(t,e,i){if(!(this instanceof r))return new r(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var n=i(176);r.fromMGRS=function(t){return new r(n.toPoint(t))},r.prototype.toMGRS=function(t){return n.forward([this.x,this.y],t)},t.exports=r},function(t,e){function i(t){return t*(Math.PI/180)}function r(t){return 180*(t/Math.PI)}function n(t){var e,r,n,o,s,u,h,l,c,d=t.lat,f=t.lon,m=6378137,p=.00669438,v=.9996,g=i(d),y=i(f);c=Math.floor((f+180)/6)+1,180===f&&(c=60),d>=56&&64>d&&f>=3&&12>f&&(c=32),d>=72&&84>d&&(f>=0&&9>f?c=31:f>=9&&21>f?c=33:f>=21&&33>f?c=35:f>=33&&42>f&&(c=37)),e=6*(c-1)-180+3,l=i(e),r=p/(1-p),n=m/Math.sqrt(1-p*Math.sin(g)*Math.sin(g)),o=Math.tan(g)*Math.tan(g),s=r*Math.cos(g)*Math.cos(g),u=Math.cos(g)*(y-l),h=m*((1-p/4-3*p*p/64-5*p*p*p/256)*g-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*g)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*g)-35*p*p*p/3072*Math.sin(6*g));var x=v*n*(u+(1-o+s)*u*u*u/6+(5-18*o+o*o+72*s-58*r)*u*u*u*u*u/120)+5e5,_=v*(h+n*Math.tan(g)*(u*u/2+(5-o+9*s+4*s*s)*u*u*u*u/24+(61-58*o+o*o+600*s-330*r)*u*u*u*u*u*u/720));return 0>d&&(_+=1e7),{northing:Math.round(_),easting:Math.round(x),zoneNumber:c,zoneLetter:a(d)}}function o(t){var e=t.northing,i=t.easting,n=t.zoneLetter,a=t.zoneNumber;if(0>a||a>60)return null;var s,u,h,l,c,d,f,m,p,v,g=.9996,y=6378137,x=.00669438,_=(1-Math.sqrt(1-x))/(1+Math.sqrt(1-x)),M=i-5e5,b=e;"N">n&&(b-=1e7),m=6*(a-1)-180+3,s=x/(1-x),f=b/g,p=f/(y*(1-x/4-3*x*x/64-5*x*x*x/256)),v=p+(3*_/2-27*_*_*_/32)*Math.sin(2*p)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*p)+151*_*_*_/96*Math.sin(6*p),u=y/Math.sqrt(1-x*Math.sin(v)*Math.sin(v)),h=Math.tan(v)*Math.tan(v),l=s*Math.cos(v)*Math.cos(v),c=y*(1-x)/Math.pow(1-x*Math.sin(v)*Math.sin(v),1.5),d=M/(u*g);var w=v-u*Math.tan(v)/c*(d*d/2-(5+3*h+10*l-4*l*l-9*s)*d*d*d*d/24+(61+90*h+298*l+45*h*h-252*s-3*l*l)*d*d*d*d*d*d/720);w=r(w);var T=(d-(1+2*h+l)*d*d*d/6+(5-2*l+28*h-3*l*l+8*s+24*h*h)*d*d*d*d*d/120)/Math.cos(v);T=m+r(T);var A;if(t.accuracy){var E=o({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});A={top:E.lat,right:E.lon,bottom:w,left:T}}else A={lat:w,lon:T};return A}function a(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function s(t,e){var i="00000"+t.easting,r="00000"+t.northing;return t.zoneNumber+t.zoneLetter+u(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+r.substr(r.length-5,e)}function u(t,e,i){var r=h(i),n=Math.floor(t/1e5),o=Math.floor(e/1e5)%20;return l(n,o,r)}function h(t){var e=t%p;return 0===e&&(e=p),e}function l(t,e,i){var r=i-1,n=v.charCodeAt(r),o=g.charCodeAt(r),a=n+t-1,s=o+e,u=!1;a>b&&(a=a-b+y-1,u=!0),(a===x||x>n&&a>x||(a>x||x>n)&&u)&&a++,(a===_||_>n&&a>_||(a>_||_>n)&&u)&&(a++,a===x&&a++),a>b&&(a=a-b+y-1),s>M?(s=s-M+y-1,u=!0):u=!1,(s===x||x>o&&s>x||(s>x||x>o)&&u)&&s++,(s===_||_>o&&s>_||(s>_||_>o)&&u)&&(s++,s===x&&s++),s>M&&(s=s-M+y-1);var h=String.fromCharCode(a)+String.fromCharCode(s);return h}function c(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,r=null,n="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;n+=e,o++}var a=parseInt(n,10);if(0===o||o+3>i)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(o++);if("A">=s||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;r=t.substring(o,o+=2);for(var u=h(a),l=d(r.charAt(0),u),c=f(r.charAt(1),u);c<m(s);)c+=2e6;var p=i-o;if(p%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var v,g,y,x,_,M=p/2,b=0,w=0;return M>0&&(v=1e5/Math.pow(10,M),g=t.substring(o,o+M),b=parseFloat(g)*v,y=t.substring(o+M),w=parseFloat(y)*v),x=b+l,_=w+c,{easting:x,northing:_,zoneLetter:s,zoneNumber:a,accuracy:v}}function d(t,e){for(var i=v.charCodeAt(e-1),r=1e5,n=!1;i!==t.charCodeAt(0);){if(i++,i===x&&i++,i===_&&i++,i>b){if(n)throw"Bad character: "+t;i=y,n=!0}r+=1e5}return r}function f(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=g.charCodeAt(e-1),r=0,n=!1;i!==t.charCodeAt(0);){if(i++,i===x&&i++,i===_&&i++,i>M){if(n)throw"Bad character: "+t;i=y,n=!0}r+=1e5}return r}function m(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var p=6,v="AJSAJS",g="AFAFAF",y=65,x=73,_=79,M=86,b=90;e.forward=function(t,e){return e=e||5,s(n({lat:t[1],lon:t[0]}),e)},e.inverse=function(t){var e=o(c(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},e.toPoint=function(t){var e=o(c(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}},function(t,e){t.exports={_args:[["proj4@^2.3.14","/Users/jbeezley/git/geojs2"]],_from:"proj4@>=2.3.14 <3.0.0",_id:"proj4@2.3.14",_inCache:!0,_installable:!0,_location:"/proj4",_nodeVersion:"4.2.6",_npmOperationalInternal:{host:"packages-13-west.internal.npmjs.com",tmp:"tmp/proj4-2.3.14.tgz_1457689264880_0.9409773757215589"},_npmUser:{email:"andreas.hocevar@gmail.com",name:"ahocevar"},_npmVersion:"2.14.12",_phantomChildren:{},_requested:{name:"proj4",raw:"proj4@^2.3.14",rawSpec:"^2.3.14",scope:null,spec:">=2.3.14 <3.0.0",type:"range"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/proj4/-/proj4-2.3.14.tgz",_shasum:"928906144388980c914c5a357fc493aba59a747a",_shrinkwrap:null,_spec:"proj4@^2.3.14",_where:"/Users/jbeezley/git/geojs2",author:"",bugs:{url:"https://github.com/proj4js/proj4js/issues"},contributors:[{email:"madair@dmsolutions.ca",name:"Mike Adair"},{email:"rich@greenwoodmap.com",name:"Richard Greenwood"},{email:"calvin.metcalf@gmail.com",name:"Calvin Metcalf"},{name:"Richard Marsden",url:"http://www.winwaed.com"},{name:"T. Mittan"},{name:"D. Steinwand"},{name:"S. Nelson"}],dependencies:{mgrs:"~0.0.2"},description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",devDependencies:{browserify:"~12.0.1",chai:"~1.8.1",curl:"git://github.com/cujojs/curl.git",grunt:"~0.4.2","grunt-browserify":"~4.0.1","grunt-cli":"~0.1.13","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0","grunt-contrib-uglify":"~0.11.1","grunt-mocha-phantomjs":"~0.4.0",istanbul:"~0.2.4",mocha:"~1.17.1",tin:"~0.4.0"},directories:{doc:"docs",test:"test"},dist:{shasum:"928906144388980c914c5a357fc493aba59a747a",tarball:"http://registry.npmjs.org/proj4/-/proj4-2.3.14.tgz"},gitHead:"7619c8a63df1eae5bad0b9ad31ca1d87b0549243",homepage:"https://github.com/proj4js/proj4js#readme",jam:{include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"],main:"dist/proj4.js"},license:"MIT",main:"lib/index.js",maintainers:[{email:"calvin.metcalf@gmail.com",name:"cwmma"},{email:"andreas.hocevar@gmail.com",name:"ahocevar"}],name:"proj4",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},version:"2.3.14"}},function(t,e,i){var r=[i(179),i(186),i(187),i(190),i(191),i(192),i(193),i(194),i(195),i(199),i(201),i(202),i(203),i(205),i(206),i(207),i(208),i(209),i(213),i(214),i(215),i(216)];t.exports=function(t){r.forEach(function(e){t.Proj.projections.add(e)})}},function(t,e,i){var r=i(180),n=i(181),o=i(182),a=i(183),s=i(184),u=i(162),h=Math.PI/2,l=1e-10,c=i(163),d=i(185);e.init=function(){this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*s(this.e0,this.e1,this.e2,this.e3,this.lat0)},e.forward=function(t){var e,i,r,n=t.x,o=t.y,a=u(n-this.long0),h=Math.sin(o),l=Math.cos(o);if(this.sphere){var c=l*Math.sin(a);if(Math.abs(Math.abs(c)-1)<1e-10)return 93;i=.5*this.a*this.k0*Math.log((1+c)/(1-c)),e=Math.acos(l*Math.cos(a)/Math.sqrt(1-c*c)),0>o&&(e=-e),r=this.a*this.k0*(e-this.lat0)}else{var d=l*a,f=Math.pow(d,2),m=this.ep2*Math.pow(l,2),p=Math.tan(o),v=Math.pow(p,2);e=1-this.es*Math.pow(h,2);var g=this.a/Math.sqrt(e),y=this.a*s(this.e0,this.e1,this.e2,this.e3,o);i=this.k0*g*d*(1+f/6*(1-v+m+f/20*(5-18*v+Math.pow(v,2)+72*m-58*this.ep2)))+this.x0,r=this.k0*(y-this.ml0+g*p*(f*(.5+f/24*(5-v+9*m+4*Math.pow(m,2)+f/30*(61-58*v+Math.pow(v,2)+600*m-330*this.ep2)))))+this.y0}return t.x=i,t.y=r,t},e.inverse=function(t){var e,i,r,n,o,a,s=6;if(this.sphere){var f=Math.exp(t.x/(this.a*this.k0)),m=.5*(f-1/f),p=this.lat0+t.y/(this.a*this.k0),v=Math.cos(p);e=Math.sqrt((1-v*v)/(1+m*m)),o=d(e),0>p&&(o=-o),a=0===m&&0===v?this.long0:u(Math.atan2(m,v)+this.long0)}else{var g=t.x-this.x0,y=t.y-this.y0;for(e=(this.ml0+y/this.k0)/this.a,i=e,n=0;!0&&(r=(e+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=r,!(Math.abs(r)<=l));n++)if(n>=s)return 95;if(Math.abs(i)<h){var x=Math.sin(i),_=Math.cos(i),M=Math.tan(i),b=this.ep2*Math.pow(_,2),w=Math.pow(b,2),T=Math.pow(M,2),A=Math.pow(T,2);e=1-this.es*Math.pow(x,2);var E=this.a/Math.sqrt(e),P=E*(1-this.es)/e,R=g/(E*this.k0),S=Math.pow(R,2);o=i-E*M*S/P*(.5-S/24*(5+3*T+10*b-4*w-9*this.ep2-S/30*(61+90*T+298*b+45*A-252*this.ep2-3*w))),a=u(this.long0+R*(1-S/6*(1+2*T+b-S/20*(5-2*b+28*T-3*w+8*this.ep2+24*A)))/_)}else o=h*c(y),a=this.long0}return t.x=a,t.y=o,t},e.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},function(t,e){t.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},function(t,e){t.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},function(t,e){t.exports=function(t){return.05859375*t*t*(1+.75*t)}},function(t,e){t.exports=function(t){return t*t*t*(35/3072)}},function(t,e){t.exports=function(t,e,i,r,n){return t*n-e*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)}},function(t,e){t.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},function(t,e,i){var r=.017453292519943295,n=i(179);e.dependsOn="tmerc",e.init=function(){this.zone&&(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*r,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,n.init.apply(this),this.forward=n.forward,this.inverse=n.inverse)},e.names=["Universal Transverse Mercator System","utm"]},function(t,e,i){var r=i(188),n=i(162);e.init=function(){r.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},e.forward=function(t){var e,i,o,a;return t.x=n(t.x-this.long0),r.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),o=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*o),t.x=a*i*Math.sin(t.x),t.y=a*(this.cosc0*e-this.sinc0*i*o),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},e.inverse=function(t){var e,i,o,a,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=Math.sqrt(t.x*t.x+t.y*t.y)){var u=2*Math.atan2(s,this.R2);e=Math.sin(u),i=Math.cos(u),a=Math.asin(i*this.sinc0+t.y*e*this.cosc0/s),o=Math.atan2(t.x*e,s*this.cosc0*i-t.y*this.sinc0*e)}else a=this.phic0,o=0;return t.x=o,t.y=a,r.inverse.apply(this,[t]),t.x=n(t.x+this.long0),t},e.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},function(t,e,i){var r=Math.PI/4,n=i(189),o=Math.PI/2,a=20;e.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*n(this.e*t,this.ratexp))},e.forward=function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+r),this.C)*n(this.e*Math.sin(i),this.ratexp))-o,t.x=this.C*e,t},e.inverse=function(t){for(var e=1e-14,i=t.x/this.C,s=t.y,u=Math.pow(Math.tan(.5*s+r)/this.K,1/this.C),h=a;h>0&&(s=2*Math.atan(u*n(this.e*Math.sin(t.y),-.5*this.e))-o,!(Math.abs(s-t.y)<e));--h)t.y=s;return h?(t.x=i,t.y=s,t):null},e.names=["gauss"]},function(t,e){t.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},function(t,e,i){var r=Math.PI/2,n=1e-10,o=i(163),a=i(161),s=i(164),u=i(165),h=i(162);e.ssfn_=function(t,e,i){return e*=i,Math.tan(.5*(r+t))*Math.pow((1-e)/(1+e),.5*i)},e.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=n&&(this.k0=.5*(1+o(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=n&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=n&&(this.k0=.5*this.cons*a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/s(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=a(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},e.forward=function(t){var e,i,o,a,u,l,c=t.x,d=t.y,f=Math.sin(d),m=Math.cos(d),p=h(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=n&&Math.abs(d+this.lat0)<=n?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*f+this.coslat0*m*Math.cos(p)),t.x=this.a*e*m*Math.sin(p)+this.x0,t.y=this.a*e*(this.coslat0*f-this.sinlat0*m*Math.cos(p))+this.y0,t):(i=2*Math.atan(this.ssfn_(d,f,this.e))-r,a=Math.cos(i),o=Math.sin(i),Math.abs(this.coslat0)<=n?(u=s(this.e,d*this.con,this.con*f),l=2*this.a*this.k0*u/this.cons,t.x=this.x0+l*Math.sin(c-this.long0),t.y=this.y0-this.con*l*Math.cos(c-this.long0),t):(Math.abs(this.sinlat0)<n?(e=2*this.a*this.k0/(1+a*Math.cos(p)),t.y=e*o):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*a*Math.cos(p))),t.y=e*(this.cosX0*o-this.sinX0*a*Math.cos(p))+this.y0),t.x=e*a*Math.sin(p)+this.x0,t))},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,o,a,s,l=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var c=2*Math.atan(l/(.5*this.a*this.k0));return e=this.long0,i=this.lat0,n>=l?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(c)*this.sinlat0+t.y*Math.sin(c)*this.coslat0/l),e=h(Math.abs(this.coslat0)<n?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(c),l*this.coslat0*Math.cos(c)-t.y*this.sinlat0*Math.sin(c))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=n){if(n>=l)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,o=l*this.cons/(2*this.a*this.k0),i=this.con*u(this.e,o),e=this.con*h(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else a=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n>=l?s=this.X0:(s=Math.asin(Math.cos(a)*this.sinX0+t.y*Math.sin(a)*this.cosX0/l),e=h(this.long0+Math.atan2(t.x*Math.sin(a),l*this.cosX0*Math.cos(a)-t.y*this.sinX0*Math.sin(a)))),i=-1*u(this.e,Math.tan(.5*(r+s)));return t.x=e,t.y=i,t},e.names=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"]},function(t,e){e.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,r=this.rf,n=1/r,o=2*n-Math.pow(n,2),a=this.e=Math.sqrt(o);this.R=this.k0*i*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+a*e)/(1-a*e));this.K=s-this.alpha*u+this.alpha*a/2*h},e.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+i)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},e.inverse=function(t){for(var e=t.x-this.x0,i=t.y-this.y0,r=e/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),s=this.lambda0+a/this.alpha,u=0,h=o,l=-1e3,c=0;Math.abs(h-l)>1e-7;){if(++c>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),l=h,h=2*Math.atan(Math.exp(u))-Math.PI/2}return t.x=s,t.y=h,t},e.names=["somerc"]},function(t,e,i){var r=i(164),n=i(162),o=i(165),a=Math.PI/2,s=Math.PI/4,u=1e-10;e.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var o=r(this.e,this.lat0,t),a=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));1>a*a&&(a=1);var s,u;if(isNaN(this.longc)){var h=r(this.e,this.lat1,Math.sin(this.lat1)),l=r(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var c=Math.pow(h,this.bl),d=Math.pow(l,this.bl);s=this.el/c,u=.5*(s-1/s);var f=(this.el*this.el-d*c)/(this.el*this.el+d*c),m=(d-c)/(d+c),p=n(this.long1-this.long2);
this.long0=.5*(this.long1+this.long2)-Math.atan(f*Math.tan(.5*this.bl*p)/m)/this.bl,this.long0=n(this.long0);var v=n(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*v)/u),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else s=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=s*Math.pow(o,this.bl),u=.5*(s-1/s),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(u*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},e.forward=function(t){var e,i,o,h=t.x,l=t.y,c=n(h-this.long0);if(Math.abs(Math.abs(l)-a)<=u)o=l>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(s+o*this.gamma0*.5)),e=-1*o*a*this.al/this.bl;else{var d=r(this.e,l,Math.sin(l)),f=this.el/Math.pow(d,this.bl),m=.5*(f-1/f),p=.5*(f+1/f),v=Math.sin(this.bl*c),g=(m*Math.sin(this.gamma0)-v*Math.cos(this.gamma0))/p;i=Math.abs(Math.abs(g)-1)<=u?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,e=Math.abs(Math.cos(this.bl*c))<=u?this.al*this.bl*c:this.al*Math.atan2(m*Math.cos(this.gamma0)+v*Math.sin(this.gamma0),Math.cos(this.bl*c))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},e.inverse=function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var r=Math.exp(-1*this.bl*i/this.al),s=.5*(r-1/r),h=.5*(r+1/r),l=Math.sin(this.bl*e/this.al),c=(l*Math.cos(this.gamma0)+s*Math.sin(this.gamma0))/h,d=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),1/this.bl);return Math.abs(c-1)<u?(t.x=this.long0,t.y=a):Math.abs(c+1)<u?(t.x=this.long0,t.y=-1*a):(t.y=o(this.e,d),t.x=n(this.long0-Math.atan2(s*Math.cos(this.gamma0)-l*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},e.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},function(t,e,i){var r=1e-10,n=i(161),o=i(164),a=Math.PI/2,s=i(163),u=i(162),h=i(165);e.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<r)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),a=n(this.e,e,i),s=o(this.e,this.lat1,e),u=Math.sin(this.lat2),h=Math.cos(this.lat2),l=n(this.e,u,h),c=o(this.e,this.lat2,u),d=o(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>r?this.ns=Math.log(a/l)/Math.log(s/c):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=a/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(d,this.ns),this.title||(this.title="Lambert Conformal Conic")}},e.forward=function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=r&&(i=s(i)*(a-2*r));var n,h,l=Math.abs(Math.abs(i)-a);if(l>r)n=o(this.e,i,Math.sin(i)),h=this.a*this.f0*Math.pow(n,this.ns);else{if(l=i*this.ns,0>=l)return null;h=0}var c=this.ns*u(e-this.long0);return t.x=this.k0*(h*Math.sin(c))+this.x0,t.y=this.k0*(this.rh-h*Math.cos(c))+this.y0,t},e.inverse=function(t){var e,i,r,n,o,s=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+l*l),i=1):(e=-Math.sqrt(s*s+l*l),i=-1);var c=0;if(0!==e&&(c=Math.atan2(i*s,i*l)),0!==e||this.ns>0){if(i=1/this.ns,r=Math.pow(e/(this.a*this.f0),i),n=h(this.e,r),-9999===n)return null}else n=-a;return o=u(c/this.ns+this.long0),t.x=o,t.y=n,t},e.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},function(t,e,i){var r=i(162);e.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},e.forward=function(t){var e,i,n,o,a,s,u,h=t.x,l=t.y,c=r(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),n=-c*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),a=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(o)),s=this.n*a,u=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=u*Math.cos(s)/1,t.x=u*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},e.inverse=function(t){var e,i,r,n,o,a,s,u,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.atan2(t.y,t.x),n=o/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),i=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,u=0;var l=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(u=1),s=t.y,l+=1;while(0===u&&15>l);return l>=15?null:t},e.names=["Krovak","krovak"]},function(t,e,i){var r=i(184),n=i(180),o=i(181),a=i(182),s=i(183),u=i(196),h=i(162),l=i(197),c=i(198),d=Math.PI/2,f=1e-10;e.init=function(){this.sphere||(this.e0=n(this.es),this.e1=o(this.es),this.e2=a(this.es),this.e3=s(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0))},e.forward=function(t){var e,i,n=t.x,o=t.y;if(n=h(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var a=Math.sin(o),s=Math.cos(o),l=u(this.a,this.e,a),c=Math.tan(o)*Math.tan(o),d=n*Math.cos(o),f=d*d,m=this.es*s*s/(1-this.es),p=this.a*r(this.e0,this.e1,this.e2,this.e3,o);e=l*d*(1-f*c*(1/6-(8-c+8*m)*f/120)),i=p-this.ml0+l*a/s*f*(.5+(5-c+6*m)*f/24)}return t.x=e+this.x0,t.y=i+this.y0,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r=t.x/this.a,n=t.y/this.a;if(this.sphere){var o=n+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(o))}else{var a=this.ml0/this.a+n,s=c(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-d)<=f)return t.x=this.long0,t.y=d,0>n&&(t.y*=-1),t;var m=u(this.a,this.e,Math.sin(s)),p=m*m*m/this.a/this.a*(1-this.es),v=Math.pow(Math.tan(s),2),g=r*this.a/m,y=g*g;e=s-m*Math.tan(s)/p*g*g*(.5-(1+3*v)*g*g/24),i=g*(1-y*(v/3+(1+3*v)*v*y/15))/Math.cos(s)}return t.x=h(i+this.long0),t.y=l(e),t},e.names=["Cassini","Cassini_Soldner","cass"]},function(t,e){t.exports=function(t,e,i){var r=e*i;return t/Math.sqrt(1-r*r)}},function(t,e,i){var r=Math.PI/2,n=i(163);t.exports=function(t){return Math.abs(t)<r?t:t-n(t)*Math.PI}},function(t,e){t.exports=function(t,e,i,r,n){var o,a;o=t/e;for(var s=0;15>s;s++)if(a=(t-(e*o-i*Math.sin(2*o)+r*Math.sin(4*o)-n*Math.sin(6*o)))/(e-2*i*Math.cos(2*o)+4*r*Math.cos(4*o)-6*n*Math.cos(6*o)),o+=a,Math.abs(a)<=1e-10)return o;return NaN}},function(t,e,i){var r=Math.PI/2,n=Math.PI/4,o=1e-10,a=i(200),s=i(162);e.S_POLE=1,e.N_POLE=2,e.EQUIT=3,e.OBLIQ=4,e.init=function(){var t=Math.abs(this.lat0);if(Math.abs(t-r)<o?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<o?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=a(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=a(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},e.forward=function(t){var e,i,u,h,l,c,d,f,m,p,v=t.x,g=t.y;if(v=s(v-this.long0),this.sphere){if(l=Math.sin(g),p=Math.cos(g),u=Math.cos(v),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+p*u:1+this.sinph0*l+this.cosph0*p*u,o>=i)return null;i=Math.sqrt(2/i),e=i*p*Math.sin(v),i*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*p*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(g+this.phi0)<o)return null;i=n-.5*g,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(v),i*=u}}else{switch(d=0,f=0,m=0,u=Math.cos(v),h=Math.sin(v),l=Math.sin(g),c=a(this.e,l),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=c/this.qp,f=Math.sqrt(1-d*d)),this.mode){case this.OBLIQ:m=1+this.sinb1*d+this.cosb1*f*u;break;case this.EQUIT:m=1+f*u;break;case this.N_POLE:m=r+g,c=this.qp-c;break;case this.S_POLE:m=g-r,c=this.qp+c}if(Math.abs(m)<o)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),i=this.mode===this.OBLIQ?this.ymf*m*(this.cosb1*d-this.sinb1*f*u):(m=Math.sqrt(2/(1+f*u)))*d*this.ymf,e=this.xmf*m*f*h;break;case this.N_POLE:case this.S_POLE:c>=0?(e=(m=Math.sqrt(c))*h,i=u*(this.mode===this.S_POLE?m:-m)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,a,u,h,l,c=t.x/this.a,d=t.y/this.a;if(this.sphere){var f,m=0,p=0;if(f=Math.sqrt(c*c+d*d),i=.5*f,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(p=Math.sin(i),m=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(f)<=o?0:Math.asin(d*p/f),c*=p,d=m*f;break;case this.OBLIQ:i=Math.abs(f)<=o?this.phi0:Math.asin(m*this.sinph0+d*p*this.cosph0/f),c*=p*this.cosph0,d=(m-Math.sin(i)*this.sinph0)*f;break;case this.N_POLE:d=-d,i=r-i;break;case this.S_POLE:i-=r}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,d):0}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,d*=this.dd,h=Math.sqrt(c*c+d*d),o>h)return t.x=0,t.y=this.phi0,t;a=2*Math.asin(.5*h/this.rq),n=Math.cos(a),c*=a=Math.sin(a),this.mode===this.OBLIQ?(l=n*this.sinb1+d*a*this.cosb1/h,u=this.qp*l,d=h*this.cosb1*n-d*this.sinb1*a):(l=d*a/h,u=this.qp*l,d=h*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),u=c*c+d*d,!u)return t.x=0,t.y=this.phi0,t;l=1-u/this.qp,this.mode===this.S_POLE&&(l=-l)}e=Math.atan2(c,d),i=this.authlat(Math.asin(l),this.apa)}return t.x=s(this.long0+e),t.y=i,t},e.P00=.3333333333333333,e.P01=.17222222222222222,e.P02=.10257936507936508,e.P10=.06388888888888888,e.P11=.0664021164021164,e.P20=.016415012942191543,e.authset=function(t){var e,i=[];return i[0]=t*this.P00,e=t*t,i[0]+=e*this.P01,i[1]=e*this.P10,e*=t,i[0]+=e*this.P02,i[1]+=e*this.P11,i[2]=e*this.P20,i},e.authlat=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)},e.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},function(t,e){t.exports=function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}},function(t,e,i){var r=1e-10,n=i(161),o=i(200),a=i(162),s=i(185);e.init=function(){Math.abs(this.lat1+this.lat2)<r||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=n(this.e3,this.sin_po,this.cos_po),this.qs1=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=n(this.e3,this.sin_po,this.cos_po),this.qs2=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=o(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>r?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},e.forward=function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=o(this.e3,this.sin_phi,this.cos_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,s=this.ns0*a(e-this.long0),u=n*Math.sin(s)+this.x0,h=this.rh-n*Math.cos(s)+this.y0;return t.x=u,t.y=h,t},e.inverse=function(t){var e,i,r,n,o,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),n=0,0!==e&&(n=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,s=this.phi1z(this.e3,i)),o=a(n/this.ns0+this.long0),t.x=o,t.y=s,t},e.phi1z=function(t,e){var i,n,o,a,u,h=s(.5*e);if(r>t)return h;for(var l=t*t,c=1;25>=c;c++)if(i=Math.sin(h),n=Math.cos(h),o=t*i,a=1-o*o,u=.5*a*a/n*(e/(1-l)-i/a+.5/t*Math.log((1-o)/(1+o))),h+=u,Math.abs(u)<=1e-7)return h;return null},e.names=["Albers_Conic_Equal_Area","Albers","aea"]},function(t,e,i){var r=i(162),n=1e-10,o=i(185);e.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},e.forward=function(t){var e,i,o,a,s,u,h,l,c=t.x,d=t.y;return o=r(c-this.long0),e=Math.sin(d),i=Math.cos(d),a=Math.cos(o),u=this.sin_p14*e+this.cos_p14*i*a,s=1,u>0||Math.abs(u)<=n?(h=this.x0+this.a*s*i*Math.sin(o)/u,l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*i*a)/u):(h=this.x0+this.infinity_dist*i*Math.sin(o),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*a)),t.x=h,t.y=l,t},e.inverse=function(t){var e,i,n,a,s,u;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(a=Math.atan2(e,this.rc),i=Math.sin(a),n=Math.cos(a),u=o(n*this.sin_p14+t.y*i*this.cos_p14/e),s=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),s=r(this.long0+s)):(u=this.phic0,s=0),t.x=s,t.y=u,t},e.names=["gnom"]},function(t,e,i){var r=i(162),n=i(200),o=i(161),a=i(204);e.init=function(){this.sphere||(this.k0=o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},e.forward=function(t){var e,i,o=t.x,a=t.y,s=r(o-this.long0);if(this.sphere)e=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var u=n(this.e,Math.sin(a));e=this.x0+this.a*this.k0*s,i=this.y0+this.a*u*.5/this.k0}return t.x=e,t.y=i,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=r(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=a(this.e,2*t.y*this.k0/this.a),e=r(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},e.names=["cea"]},function(t,e){var i=Math.PI/2;t.exports=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return 0>e?-1*i:i;for(var n,o,a,s,u=Math.asin(.5*e),h=0;30>h;h++)if(o=Math.sin(u),a=Math.cos(u),s=t*o,n=Math.pow(1-s*s,2)/(2*a)*(e/(1-t*t)-o/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),u+=n,Math.abs(n)<=1e-10)return u;return NaN}},function(t,e,i){var r=i(162),n=i(197);e.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},e.forward=function(t){var e=t.x,i=t.y,o=r(e-this.long0),a=n(i-this.lat0);return t.x=this.x0+this.a*o*this.rc,t.y=this.y0+this.a*a,t},e.inverse=function(t){var e=t.x,i=t.y;return t.x=r(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=n(this.lat0+(i-this.y0)/this.a),t},e.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},function(t,e,i){var r=i(180),n=i(181),o=i(182),a=i(183),s=i(162),u=i(197),h=i(184),l=1e-10,c=i(196),d=20;e.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*h(this.e0,this.e1,this.e2,this.e3,this.lat0)},e.forward=function(t){var e,i,r,n=t.x,o=t.y,a=s(n-this.long0);if(r=a*Math.sin(o),this.sphere)Math.abs(o)<=l?(e=this.a*a,i=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(o),i=this.a*(u(o-this.lat0)+(1-Math.cos(r))/Math.tan(o)));else if(Math.abs(o)<=l)e=this.a*a,i=-1*this.ml0;else{var d=c(this.a,this.e,Math.sin(o))/Math.tan(o);e=d*Math.sin(r),i=this.a*h(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+d*(1-Math.cos(r))}return t.x=e+this.x0,t.y=i+this.y0,t},e.inverse=function(t){var e,i,r,n,o,a,u,c,f;if(r=t.x-this.x0,n=t.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=l)e=s(r/this.a+this.long0),i=0;else{a=this.lat0+n/this.a,u=r*r/this.a/this.a+a*a,c=a;var m;for(o=d;o;--o)if(m=Math.tan(c),f=-1*(a*(c*m+1)-c-.5*(c*c+u)*m)/((c-a)/m-1),c+=f,Math.abs(f)<=l){i=c;break}e=s(this.long0+Math.asin(r*Math.tan(c)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=l)i=0,e=s(this.long0+r/this.a);else{a=(this.ml0+n)/this.a,u=r*r/this.a/this.a+a*a,c=a;var p,v,g,y,x;for(o=d;o;--o)if(x=this.e*Math.sin(c),p=Math.sqrt(1-x*x)*Math.tan(c),v=this.a*h(this.e0,this.e1,this.e2,this.e3,c),g=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),y=v/this.a,f=(a*(p*y+1)-y-.5*p*(y*y+u))/(this.es*Math.sin(2*c)*(y*y+u-2*a*y)/(4*p)+(a-y)*(p*g-2/Math.sin(2*c))-g),c-=f,Math.abs(f)<=l){i=c;break}p=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=s(this.long0+Math.asin(r*p/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},e.names=["Polyconic","poly"]},function(t,e){var i=484813681109536e-20;e.iterations=1,e.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},e.forward=function(t){var e,r=t.x,n=t.y,o=n-this.lat0,a=r-this.long0,s=o/i*1e-5,u=a,h=1,l=0;for(e=1;10>=e;e++)h*=s,l+=this.A[e]*h;var c,d,f=l,m=u,p=1,v=0,g=0,y=0;for(e=1;6>=e;e++)c=p*f-v*m,d=v*f+p*m,p=c,v=d,g=g+this.B_re[e]*p-this.B_im[e]*v,y=y+this.B_im[e]*p+this.B_re[e]*v;return t.x=y*this.a+this.x0,t.y=g*this.a+this.y0,t},e.inverse=function(t){var e,r,n,o=t.x,a=t.y,s=o-this.x0,u=a-this.y0,h=u/this.a,l=s/this.a,c=1,d=0,f=0,m=0;for(e=1;6>=e;e++)r=c*h-d*l,n=d*h+c*l,c=r,d=n,f=f+this.C_re[e]*c-this.C_im[e]*d,m=m+this.C_im[e]*c+this.C_re[e]*d;for(var p=0;p<this.iterations;p++){var v,g,y=f,x=m,_=h,M=l;for(e=2;6>=e;e++)v=y*f-x*m,g=x*f+y*m,y=v,x=g,_+=(e-1)*(this.B_re[e]*y-this.B_im[e]*x),M+=(e-1)*(this.B_im[e]*y+this.B_re[e]*x);y=1,x=0;var b=this.B_re[1],w=this.B_im[1];for(e=2;6>=e;e++)v=y*f-x*m,g=x*f+y*m,y=v,x=g,b+=e*(this.B_re[e]*y-this.B_im[e]*x),w+=e*(this.B_im[e]*y+this.B_re[e]*x);var T=b*b+w*w;f=(_*b+M*w)/T,m=(M*b-_*w)/T}var A=f,E=m,P=1,R=0;for(e=1;9>=e;e++)P*=A,R+=this.D[e]*P;var S=this.lat0+R*i*1e5,C=this.long0+E;return t.x=C,t.y=S,t},e.names=["New_Zealand_Map_Grid","nzmg"]},function(t,e,i){var r=i(162);e.init=function(){},e.forward=function(t){var e=t.x,i=t.y,n=r(e-this.long0),o=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=o,t.y=a,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=r(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},e.names=["Miller_Cylindrical","mill"]},function(t,e,i){var r=i(162),n=i(197),o=i(210),a=20,s=i(211),u=i(212),h=Math.PI/2,l=1e-10,c=i(185);e.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=o(this.es)},e.forward=function(t){var e,i,n=t.x,o=t.y;if(n=r(n-this.long0),this.sphere){if(this.m)for(var u=this.n*Math.sin(o),h=a;h;--h){var c=(this.m*o+Math.sin(o)-u)/(this.m+Math.cos(o));if(o-=c,Math.abs(c)<l)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*n*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var d=Math.sin(o),f=Math.cos(o);i=this.a*s(o,d,f,this.en),e=this.a*n*f/Math.sqrt(1-this.es*d*d)}return t.x=e,t.y=i,t},e.inverse=function(t){var e,i,o,a;return t.x-=this.x0,o=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,o/=this.C_x*(this.m+Math.cos(e)),this.m?e=c((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=c(Math.sin(e)/this.n)),o=r(o+this.long0),e=n(e)):(e=u(t.y/this.a,this.es,this.en),a=Math.abs(e),h>a?(a=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*a*a)/(this.a*Math.cos(e)),o=r(i)):h>a-l&&(o=this.long0)),t.x=o,t.y=e,t},e.names=["Sinusoidal","sinu"]},function(t,e){var i=1,r=.25,n=.046875,o=.01953125,a=.01068115234375,s=.75,u=.46875,h=.013020833333333334,l=.007120768229166667,c=.3645833333333333,d=.005696614583333333,f=.3076171875;t.exports=function(t){var e=[];e[0]=i-t*(r+t*(n+t*(o+t*a))),e[1]=t*(s-t*(n+t*(o+t*a)));var m=t*t;return e[2]=m*(u-t*(h+t*l)),m*=t,e[3]=m*(c-t*d),e[4]=m*t*f,e}},function(t,e){t.exports=function(t,e,i,r){return i*=e,e*=e,r[0]*t-i*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}},function(t,e,i){var r=i(211),n=1e-10,o=20;t.exports=function(t,e,i){for(var a=1/(1-e),s=t,u=o;u;--u){var h=Math.sin(s),l=1-e*h*h;if(l=(r(s,h,Math.cos(s),i)-t)*(l*Math.sqrt(l))*a,s-=l,Math.abs(l)<n)return s}return s}},function(t,e,i){var r=i(162),n=1e-10;e.init=function(){},e.forward=function(t){for(var e=t.x,i=t.y,o=r(e-this.long0),a=i,s=Math.PI*Math.sin(i),u=0;!0;u++){var h=-(a+Math.sin(a)-s)/(1+Math.cos(a));if(a+=h,Math.abs(h)<n)break}a/=2,Math.PI/2-Math.abs(i)<n&&(o=0);var l=.900316316158*this.a*o*Math.cos(a)+this.x0,c=1.4142135623731*this.a*Math.sin(a)+this.y0;return t.x=l,t.y=c,t},e.inverse=function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=r(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return t.x=n,t.y=o,t},e.names=["Mollweide","moll"]},function(t,e,i){var r=i(180),n=i(181),o=i(182),a=i(183),s=i(161),u=i(184),h=i(162),l=i(197),c=i(198),d=1e-10;e.init=function(){Math.abs(this.lat1+this.lat2)<d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=s(this.e,this.sinphi,this.cosphi),this.ml1=u(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=s(this.e,this.sinphi,this.cosphi),this.ml2=u(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=u(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},e.forward=function(t){var e,i=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else{var n=u(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-n)}var o=this.ns*h(i-this.long0),a=this.x0+e*Math.sin(o),s=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=s,t},e.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,r,n;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==i&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return n=h(this.long0+o/this.ns),r=l(this.g-i/this.a),t.x=n,t.y=r,t;var a=this.g-i/this.a;return r=c(a,this.e0,this.e1,this.e2,this.e3),n=h(this.long0+o/this.ns),t.x=n,t.y=r,t},e.names=["Equidistant_Conic","eqdc"]},function(t,e,i){var r=i(162),n=Math.PI/2,o=1e-10,a=i(185);e.init=function(){this.R=this.a},e.forward=function(t){var e,i,s=t.x,u=t.y,h=r(s-this.long0);Math.abs(u)<=o&&(e=this.x0+this.R*h,i=this.y0);var l=a(2*Math.abs(u/Math.PI));(Math.abs(h)<=o||Math.abs(Math.abs(u)-n)<=o)&&(e=this.x0,i=u>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var c=.5*Math.abs(Math.PI/h-h/Math.PI),d=c*c,f=Math.sin(l),m=Math.cos(l),p=m/(f+m-1),v=p*p,g=p*(2/f-1),y=g*g,x=Math.PI*this.R*(c*(p-y)+Math.sqrt(d*(p-y)*(p-y)-(y+d)*(v-y)))/(y+d);0>h&&(x=-x),e=this.x0+x;var _=d+p;return x=Math.PI*this.R*(g*_-c*Math.sqrt((y+d)*(d+1)-_*_))/(y+d),i=u>=0?this.y0+x:this.y0-x,t.x=e,t.y=i,t},e.inverse=function(t){var e,i,n,a,s,u,h,l,c,d,f,m,p;return t.x-=this.x0,t.y-=this.y0,f=Math.PI*this.R,n=t.x/f,a=t.y/f,s=n*n+a*a,u=-Math.abs(a)*(1+s),h=u-2*a*a+n*n,l=-2*u+1+2*a*a+s*s,p=a*a/l+(2*h*h*h/l/l/l-9*u*h/l/l)/27,c=(u-h*h/3/l)/l,d=2*Math.sqrt(-c/3),f=3*p/c/d,Math.abs(f)>1&&(f=f>=0?1:-1),m=Math.acos(f)/3,i=t.y>=0?(-d*Math.cos(m+Math.PI/3)-h/3/l)*Math.PI:-(-d*Math.cos(m+Math.PI/3)-h/3/l)*Math.PI,e=Math.abs(n)<o?this.long0:r(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(n*n-a*a)+s*s))/2/n),t.x=e,t.y=i,t},e.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},function(t,e,i){var r=i(162),n=Math.PI/2,o=1e-10,a=i(184),s=i(180),u=i(181),h=i(182),l=i(183),c=i(196),d=i(185),f=i(198);e.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},e.forward=function(t){var e,i,d,f,m,p,v,g,y,x,_,M,b,w,T,A,E,P,R,S,C,L,I,O=t.x,D=t.y,F=Math.sin(t.y),N=Math.cos(t.y),k=r(O-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o?(t.x=this.x0+this.a*(n-D)*Math.sin(k),t.y=this.y0-this.a*(n-D)*Math.cos(k),t):Math.abs(this.sin_p12+1)<=o?(t.x=this.x0+this.a*(n+D)*Math.sin(k),t.y=this.y0+this.a*(n+D)*Math.cos(k),t):(P=this.sin_p12*F+this.cos_p12*N*Math.cos(k),A=Math.acos(P),E=A/Math.sin(A),t.x=this.x0+this.a*E*N*Math.sin(k),t.y=this.y0+this.a*E*(this.cos_p12*F-this.sin_p12*N*Math.cos(k)),t):(e=s(this.es),i=u(this.es),d=h(this.es),f=l(this.es),Math.abs(this.sin_p12-1)<=o?(m=this.a*a(e,i,d,f,n),p=this.a*a(e,i,d,f,D),t.x=this.x0+(m-p)*Math.sin(k),t.y=this.y0-(m-p)*Math.cos(k),t):Math.abs(this.sin_p12+1)<=o?(m=this.a*a(e,i,d,f,n),p=this.a*a(e,i,d,f,D),t.x=this.x0+(m+p)*Math.sin(k),t.y=this.y0+(m+p)*Math.cos(k),t):(v=F/N,g=c(this.a,this.e,this.sin_p12),y=c(this.a,this.e,F),x=Math.atan((1-this.es)*v+this.es*g*this.sin_p12/(y*N)),_=Math.atan2(Math.sin(k),this.cos_p12*Math.tan(x)-this.sin_p12*Math.cos(k)),R=0===_?Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.abs(Math.abs(_)-Math.PI)<=o?-Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.asin(Math.sin(k)*Math.cos(x)/Math.sin(_)),M=this.e*this.sin_p12/Math.sqrt(1-this.es),b=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),w=M*b,T=b*b,S=R*R,C=S*R,L=C*R,I=L*R,A=g*R*(1-S*T*(1-T)/6+C/8*w*(1-2*T)+L/120*(T*(4-7*T)-3*M*M*(1-7*T))-I/48*w),t.x=this.x0+A*Math.sin(_),t.y=this.y0+A*Math.cos(_),t))},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,m,p,v,g,y,x,_,M,b,w,T,A,E,P,R,S,C,L,I,O,D;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*n*this.a)return;return i=e/this.a,m=Math.sin(i),p=Math.cos(i),v=this.long0,Math.abs(e)<=o?g=this.lat0:(g=d(p*this.sin_p12+t.y*m*this.cos_p12/e),y=Math.abs(this.lat0)-n,v=r(Math.abs(y)<=o?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*m,e*this.cos_p12*p-t.y*this.sin_p12*m))),t.x=v,t.y=g,t}return x=s(this.es),_=u(this.es),M=h(this.es),b=l(this.es),Math.abs(this.sin_p12-1)<=o?(w=this.a*a(x,_,M,b,n),e=Math.sqrt(t.x*t.x+t.y*t.y),T=w-e,g=f(T/this.a,x,_,M,b),v=r(this.long0+Math.atan2(t.x,-1*t.y)),t.x=v,t.y=g,t):Math.abs(this.sin_p12+1)<=o?(w=this.a*a(x,_,M,b,n),e=Math.sqrt(t.x*t.x+t.y*t.y),T=e-w,g=f(T/this.a,x,_,M,b),v=r(this.long0+Math.atan2(t.x,t.y)),t.x=v,t.y=g,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),P=Math.atan2(t.x,t.y),A=c(this.a,this.e,this.sin_p12),R=Math.cos(P),S=this.e*this.cos_p12*R,C=-S*S/(1-this.es),L=3*this.es*(1-C)*this.sin_p12*this.cos_p12*R/(1-this.es),I=e/A,O=I-C*(1+C)*Math.pow(I,3)/6-L*(1+3*C)*Math.pow(I,4)/24,D=1-C*O*O/2-I*O*O*O/6,E=Math.asin(this.sin_p12*Math.cos(O)+this.cos_p12*Math.sin(O)*R),v=r(this.long0+Math.asin(Math.sin(P)*Math.sin(O)/Math.cos(E))),g=Math.atan((1-this.es*D*this.sin_p12/Math.sin(E))*Math.tan(E)/(1-this.es)),t.x=v,t.y=g,t)},e.names=["Azimuthal_Equidistant","aeqd"]},function(t,e,i){var r=i(4),n=i(5),o=function(t){"use strict";function e(t,e){return("wheel"===t||l.buttons[t])&&!!l.modifiers.alt==!!e.alt&&!!l.modifiers.meta==!!e.meta&&!!l.modifiers.shift==!!e.shift&&!!l.modifiers.ctrl==!!e.ctrl}function r(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)}function a(t,e){e=0>=e?30:e;var i=s(),n=r(t),o=t.x/n,a=t.y/n;return n*=Math.exp(-x.momentum.drag*e),r(i)*e+n<x.momentum.minSpeed?null:(n>0?(o*=n,a*=n):(o=0,a=0),{x:o-i.x*e,y:a-i.y*e})}function s(){var t,e,i,r;if(!x.spring.enabled)return{x:0,y:0};var n=_.map().maxBounds(void 0,null),o=_.map().gcsToDisplay({x:n.left,y:n.top},null),a=_.map().gcsToDisplay({x:n.right,y:n.bottom},null),s=x.spring.springConstant,u=_.map().node().width(),h=_.map().node().height();return t=s*Math.max(0,o.x),e=s*Math.max(0,u-a.x),i=s*Math.max(0,o.y)/2,r=s*Math.max(0,h-a.y)/2,{x:t-e,y:i-r}}function u(){function t(t,e){var a,s=_.map();i=e,o+=t,void 0===n&&(r=n=s.zoom()),n+=t,s&&Math.abs(o)>=1&&x.discreteZoom&&!x.zoomAnimation.enabled&&(a=Math.round(o+s.zoom()),o=o+s.zoom()-a,s.zoom(a,i))}function e(){var t,e=_.map();e&&(x.zoomAnimation.enabled?(t=n,x.discreteZoom&&(t=Math.round(t),t===r&&n!==r&&(t=r+(n>r?1:-1))),e.transitionCancel("debounced_zoom.zoom"),e.transition({zoom:t,zoomOrigin:i,duration:x.zoomAnimation.duration,ease:x.zoomAnimation.ease,done:function(t){t=t||{},t.next||t.cancel&&!((""+t.source).search(/\.zoom$/)<0)||(n=void 0),x.discreteZoom&&t.cancel&&t.transition&&t.transition.end&&(""+t.source).search(/\.zoom$/)<0&&e.zoom(t.transition.end.zoom,t.transition.end.zoomOrigin)}})):(t=o+e.zoom(),x.discreteZoom&&(t=Math.round(t)),e.zoom(t,i))),o=0}var i,r,n,o=0,a=400;return x.discreteZoom!==!0&&x.discreteZoom>0&&(a=x.discreteZoom),(x.discreteZoom===!0||x.discreteZoom>0)&&!x.zoomAnimation.enabled?y(a,!1,e,t):function(i,r){(i||void 0!==n)&&(t(i,r),e(i,r))}}function h(){function t(t){var e,i;w||(r!==f&&(r={kind:"wheel",scroll:{x:0,y:0}},f=r),t.preventDefault(),t.deltaFactor=1,1===t.originalEvent.deltaMode?t.deltaFactor=40:2===t.originalEvent.deltaMode&&(t.deltaFactor=p(window).height()),e=t.originalEvent.deltaX||0,i=t.originalEvent.deltaY||0,e=e*x.wheelScaleX*t.deltaFactor/120,i=i*x.wheelScaleY*t.deltaFactor/120,r.scroll.x+=e,r.scroll.y+=i)}function i(t){var i,n;if(r===f){if(_._getMouseModifiers(t),x.panWheelEnabled&&e("wheel",x.panWheelModifiers)?n="pan":x.zoomWheelEnabled&&e("wheel",x.zoomWheelModifiers)?n="zoom":x.rotateWheelEnabled&&e("wheel",x.rotateWheelModifiers)&&(n="rotate"),n){var o=_.map().transitionCancel("wheel."+n);switch(o|=_.cancel("momentum",!0),o&&(l.geo=_.map().displayToGcs(l.map)),n){case"pan":_.map().pan({x:f.scroll.x,y:f.scroll.y});break;case"zoom":i=-f.scroll.y,A(i,l);break;case"rotate":_.map().rotation(_.map().rotation()+f.scroll.y*x.rotateWheelScale,l)}}f={}}}var r={};return x.throttle>0?g(x.throttle,!1,i,t):function(e){
t(e),i(e)}}if(!(this instanceof o))return new o(t);n.call(this);var l,c,d,f,m,p=i(1),v=i(125),g=i(120).throttle,y=i(120).debounce,x=t||{},_=this,M=null,b=null,w=!1,T=!1,A=function(){};return x=p.extend(!0,{},{throttle:30,discreteZoom:!1,panMoveButton:"left",panMoveModifiers:{},zoomMoveButton:"right",zoomMoveModifiers:{},rotateMoveButton:"left",rotateMoveModifiers:{ctrl:!0},panWheelEnabled:!1,panWheelModifiers:{},zoomWheelEnabled:!0,zoomWheelModifiers:{},rotateWheelEnabled:!0,rotateWheelModifiers:{ctrl:!0},wheelScaleX:1,wheelScaleY:1,zoomScale:1,rotateWheelScale:6*Math.PI/180,selectionButton:"left",selectionModifiers:{shift:!0},momentum:{enabled:!0,maxSpeed:2.5,minSpeed:.01,stopTime:250,drag:.01,actions:["pan","zoom"]},spring:{enabled:!1,springConstant:5e-5},click:{enabled:!0,buttons:{left:!0,right:!0,middle:!0},duration:0,cancelOnMove:!0},zoomAnimation:{enabled:!0,duration:500,ease:function(t){return(2-t)*t}}},x),l={page:{x:0,y:0},map:{x:0,y:0},buttons:{left:!1,right:!1,middle:!1},modifiers:{alt:!1,ctrl:!1,shift:!1,meta:!1},time:new Date,deltaTime:1,velocity:{x:0,y:0}},c={},d={},f={},this._connectEvents=function(){return x.map?(_._disconnectEvents(),m=p(x.map.node()),_._handleMouseWheel=h(),A=u(),m.on("wheel.geojs",_._handleMouseWheel),m.on("mousemove.geojs",_._handleMouseMove),m.on("mousedown.geojs",_._handleMouseDown),m.on("mouseup.geojs",_._handleMouseUp),m.on("dragstart",function(){return!1}),("right"===x.panMoveButton||"right"===x.zoomMoveButton||"right"===x.rotateMoveButton||"right"===x.selectionButton)&&m.on("contextmenu.geojs",function(){return!1}),_):_},this._disconnectEvents=function(){return m&&(m.off(".geojs"),m=null),_._handleMouseWheel=function(){},A=function(){},_},this.map=function(t){return void 0!==t?(x.map=t,_._connectEvents(),_):x.map},this.options=function(t){return void 0===t?p.extend({},x):(p.extend(x,t),this._connectEvents(),_)},this._getMousePosition=function(t){var e,i,r=m.offset();i=(new Date).valueOf(),e=i-l.time,l.time=i,l.deltaTime=e,l.velocity={x:(t.pageX-l.page.x)/e,y:(t.pageY-l.page.y)/e},l.page={x:t.pageX,y:t.pageY},l.map={x:t.pageX-r.left,y:t.pageY-r.top};try{l.geo=_.map().displayToGcs(l.map)}catch(n){l.geo=null}},this._getMouseButton=function(t){1===t.which?l.buttons.left="mouseup"!==t.type:3===t.which?l.buttons.right="mouseup"!==t.type:2===t.which&&(l.buttons.middle="mouseup"!==t.type)},this._getMouseModifiers=function(t){l.modifiers.alt=t.altKey,l.modifiers.ctrl=t.ctrlKey,l.modifiers.meta=t.metaKey,l.modifiers.shift=t.shiftKey},this._getSelection=function(){var t=d.origin,e=_.mouse(),i=_.map(),r={},n={};return r.upperLeft={x:Math.min(t.map.x,e.map.x),y:Math.min(t.map.y,e.map.y)},r.lowerRight={x:Math.max(t.map.x,e.map.x),y:Math.max(t.map.y,e.map.y)},r.upperRight={x:r.lowerRight.x,y:r.upperLeft.y},r.lowerLeft={x:r.upperLeft.x,y:r.lowerRight.y},n.upperLeft=i.displayToGcs(r.upperLeft),n.lowerRight=i.displayToGcs(r.lowerRight),n.upperRight=i.displayToGcs(r.upperRight),n.lowerLeft=i.displayToGcs(r.lowerLeft),b.origin([r.lowerLeft.x,r.lowerLeft.y,0]),b.upperLeft([r.upperLeft.x,r.upperLeft.y,0]),b.lowerRight([r.lowerRight.x,r.lowerRight.y,0]),b.draw(),{display:r,gcs:n,mouse:e,origin:p.extend({},d.origin)}},this.cancel=function(t,e){var i;return i=t?d.action===t:!!d.action,i&&(e||(f={}),d={}),i},this._handleMouseDown=function(t){var i=null;w||(_._getMousePosition(t),_._getMouseButton(t),_._getMouseModifiers(t),!x.click.enabled||l.buttons.left&&!x.click.buttons.left||l.buttons.right&&!x.click.buttons.right||l.buttons.middle&&!x.click.buttons.middle||(T=!0,x.click.duration>0&&window.setTimeout(function(){T=!1},x.click.duration)),e(x.panMoveButton,x.panMoveModifiers)?i="pan":e(x.zoomMoveButton,x.zoomMoveModifiers)?i="zoom":e(x.rotateMoveButton,x.rotateMoveModifiers)?i="rotate":e(x.selectionButton,x.selectionModifiers)&&(i="select"),_.map().transitionCancel("_handleMouseDown."+i),_.cancel("momentum"),l.velocity={x:0,y:0},i&&(f={kind:"move"},d={action:i,origin:p.extend(!0,{},l),delta:{x:0,y:0}},"select"===i&&(M&&(M.clear(),_.map().deleteLayer(M),M=null),M=_.map().createLayer("feature",{renderer:"d3"}),b=M.createFeature("plane"),b.style({screenCoordinates:!0,fillOpacity:function(){return.25}}),_.map().geoTrigger(v.brushstart,_._getSelection())),x.throttle>0?p(document).on("mousemove.geojs",g(x.throttle,_._handleMouseMoveDocument)):p(document).on("mousemove.geojs",_._handleMouseMoveDocument),p(document).on("mouseup.geojs",_._handleMouseUpDocument)))},this._handleMouseMove=function(t){w||d.action||(x.click.cancelOnMove&&(T=!1),_._getMousePosition(t),_._getMouseButton(t),_._getMouseModifiers(t),T||_.map().geoTrigger(v.mousemove,_.mouse()))},this._handleMouseMoveDocument=function(t){var e,i,r;if(_.map()&&!w&&"move"===f.kind&&(_._getMousePosition(t),_._getMouseButton(t),_._getMouseModifiers(t),x.click.cancelOnMove&&(T=!1),!T)){if(!d.action)return void console.log("WARNING: Invalid state in mapInteractor.");if(e=l.map.x-d.origin.map.x-d.delta.x,i=l.map.y-d.origin.map.y-d.delta.y,d.delta.x+=e,d.delta.y+=i,"pan"===d.action)_.map().pan({x:e,y:i});else if("zoom"===d.action)A(-i*x.zoomScale/120,d);else if("rotate"===d.action){var n,o;void 0===d.origin.rotation&&(n=d.origin.map.x-_.map().size().width/2,o=d.origin.map.y-_.map().size().height/2,d.origin.rotation=_.map().rotation()-Math.atan2(o,n)),n=l.map.x-_.map().size().width/2,o=l.map.y-_.map().size().height/2,_.map().rotation(d.origin.rotation+Math.atan2(o,n))}else"select"===d.action&&(r=_._getSelection(),_.map().geoTrigger(v.brush,r));t.preventDefault()}},this._handleMouseUpDocument=function(t){var e,i;if(!w&&(f={},T=!1,_._getMouseButton(t),_._getMouseModifiers(t),p(document).off(".geojs"),l.buttons.right&&t.preventDefault(),"select"===d.action&&(e=_._getSelection(),M.clear(),_.map().deleteLayer(M),M=null,b=null,_.map().geoTrigger(v.brushend,e)),i=d.action,d={},x.momentum.enabled&&p.inArray(i,x.momentum.actions)>=0)){var r=(new Date).valueOf(),n=r-l.time+l.deltaTime;r-l.time<x.momentum.stopTime?(l.velocity.x=l.velocity.x*l.deltaTime/n,l.velocity.y=l.velocity.y*l.deltaTime/n,l.deltaTime=n):l.velocity.x=l.velocity.y=0,_.springBack(!0,i)}},this._handleMouseUp=function(t){w||T&&_._handleMouseClick(t)},this._handleMouseClick=function(t){_._getMouseButton(t),_._getMouseModifiers(t),_.cancel("pan"),p(document).off(".geojs"),T=!1,_.map().geoTrigger(v.mouseclick,_.mouse())},this._handleMouseWheel=function(){},this.springBack=function(t,e){"momentum"!==d.action&&(t||(l.velocity={x:0,y:0}),d.origAction=e,d.action="momentum",d.origin=_.mouse(),d.start=new Date,d.handler=function(){var t,e,i,n;if(n=Math.min(l.deltaTime,30),"momentum"===d.action&&_.map()&&!_.map().transition()){if(i=d.start.valueOf(),d.start=new Date,t=a(l.velocity,d.start-i),!t)return void(d={});switch(e=r(t),e>x.momentum.maxSpeed&&(e=x.momentum.maxSpeed/e,t.x=t.x*e,t.y=t.y*e),isFinite(t.x)&&isFinite(t.y)||(t.x=0,t.y=0),l.velocity.x=t.x,l.velocity.y=t.y,d.origAction){case"zoom":var o=l.velocity.y*n;A(-o*x.zoomScale/120,d);break;default:_.map().pan({x:l.velocity.x*n,y:l.velocity.y*n})}d.handler&&window.requestAnimationFrame(d.handler)}},d.handler&&window.requestAnimationFrame(d.handler))},this._handleDoubleClick=function(){},this.destroy=function(){_._disconnectEvents(),_.map(null)},this.mouse=function(){return p.extend(!0,{},l)},this.keyboard=function(){return p.extend(!0,{},c)},this.state=function(){return p.extend(!0,{},d)},this.pause=function(t){return void 0===t?w:(w=!!t,_)},this.simulateEvent=function(t,e){var i,r,n,o;return _.map()?(r=e.page||{},e.map&&(n=m.offset(),r.x=e.map.x+n.left,r.y=e.map.y+n.top),"left"===e.button?o=1:"right"===e.button?o=3:"middle"===e.button&&(o=2),e.modifiers=e.modifiers||[],e.wheelDelta=e.wheelDelta||{},i=p.Event(t,{pageX:r.x,pageY:r.y,which:o,altKey:e.modifiers.indexOf("alt")>=0,ctrlKey:e.modifiers.indexOf("ctrl")>=0,metaKey:e.modifiers.indexOf("meta")>=0,shiftKey:e.modifiers.indexOf("shift")>=0,originalEvent:{deltaX:e.wheelDelta.x,deltaY:e.wheelDelta.y,deltaMode:e.wheelMode,preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}}}),void m.trigger(i)):_},this._connectEvents(),this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(131).registerLayer,o=i(130),a=function(t){"use strict";var e=i(131).createWidget;if(t.renderer="dom",t.sticky=!1,!(this instanceof a))return new a(t);o.call(this,t);var r=this,n=this._exit;this.createWidget=function(t,i){var n=e(t,r,i);return i&&"parent"in i||r.addChild(n),n._init(i),r.modified(),n},this.deleteWidget=function(t){return t._exit(),r.removeChild(t),r.modified(),r},this._exit=function(){r.children().forEach(function(t){r.deleteWidget(t)}),n()}};r(a,o),n("ui",a),t.exports=a},function(t,e,i){t.exports=function(){"use strict";var t=i(1),e=i(4),r=i(220),n=i(131),o=function(t){var e=i(142);return this instanceof o?(void 0!==t.mapOpacity&&void 0===t.opacity&&(t.opacity=t.mapOpacity),r.call(this,t),this.mapOpacity=this.opacity,void(this._getTile=function(t,i){var r=i||t;return e({index:t,size:{x:this._options.tileWidth,y:this._options.tileHeight},queue:this._queue,url:this._options.url(r.x,r.y,r.level||0,this._options.subdomains)})}.bind(this))):new o(t)};return o.defaults=t.extend({},r.defaults,{minLevel:0,maxLevel:18,tileOverlap:0,tileWidth:256,tileHeight:256,tileOffset:function(t){var e=256*Math.pow(2,t-1);return{x:e,y:e}},wrapX:!0,wrapY:!1,url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Tile data &copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),e(o,r),n.registerLayer("osm",o),o}()},function(t,e,i){t.exports=function(){"use strict";function t(t,e){return(t%e+e)%e}function e(e,i,r){return r[t(e+i,r.length)]}function r(t){return function(i,r,n,o){return t.replace("{s}",e(i,r,o)).replace("{z}",n).replace("{x}",i).replace("{y}",r)}}var n=i(4),o=i(137),a=function(e){var n=i(1),s=i(125),u=i(147),h=i(221),l=i(138),c=i(131).adjustLayerForRenderer,d=i(143);if(!(this instanceof a))return new a(e);if(o.call(this,e),e=n.extend(!0,{},this.constructor.defaults,e||{}),e.cacheSize||(e.cacheSize=e.keepLower?600:200),"string"===n.type(e.subdomains)&&(e.subdomains=e.subdomains.split("")),e.baseUrl){var f=e.baseUrl;f&&"/"!==f.charAt(f.length-1)&&(f+="/"),e.url=f+"{z}/{x}/{y}."+(e.imageFormat||"png")}e.originalUrl=e.url,"string"===n.type(e.url)&&(e.url=r(e.url));var m,p=this._init,v=this._exit,g=[];this._options=n.extend(!0,{},e),this.attribution(e.attribution),this._activeTiles={},this._tileTree={},this._cache=h({size:e.cacheSize}),this._queue=l({size:6,track:e.cacheSize,needed:function(t){return t===this.cache.get(t.toString(),!0)}.bind(this)});var y={};return Object.defineProperty(this,"options",{get:function(){return n.extend({},this._options)}}),Object.defineProperty(this,"cache",{get:function(){return this._cache}}),Object.defineProperty(this,"activeTiles",{get:function(){return n.extend({},this._activeTiles)}}),this.tilesAtZoom=function(t){var e=Math.pow(2,t);return{x:e,y:e}},this.isValid=function(t){return this._options.minLevel<=t.level&&t.level<=this._options.maxLevel&&(this._options.wrapX||0<=t.x&&t.x<=this.tilesAtZoom(t.level).x-1)&&(this._options.wrapY||0<=t.y&&t.y<=this.tilesAtZoom(t.level).y-1)?!0:!1},this._origin=function(t){var e,i,r=this.toLevel(this.toLocal(this.map().origin()),t),n=this._options;return e={x:Math.floor(r.x/n.tileWidth),y:Math.floor(r.y/n.tileHeight)},i={x:r.x-n.tileWidth*e.x,y:r.y-n.tileHeight*e.y},{index:e,offset:i}},this._tileBounds=function(t){var e=this._origin(t.index.level);return t.bounds(e.index,e.offset)},this.tileAtPoint=function(t,e){var i=this._origin(e),r=this.map();t=this.displayToLevel(r.gcsToDisplay(t,null),e),isNaN(t.x)&&(t.x=0),isNaN(t.y)&&(t.y=0);var n=this._tileOffset(e);n&&(t.x+=n.x,t.y+=n.y);var o={x:Math.floor(i.index.x+(i.offset.x+t.x)/this._options.tileWidth),y:Math.floor(i.index.y+(i.offset.y+t.y)/this._options.tileHeight)};return o},this.gcsTileBounds=function(t,e){var i=t.index?t:d({index:t,size:{x:this._options.tileWidth,y:this._options.tileHeight},url:""}),r=this._tileOffset(i.index.level),n=i.bounds({x:0,y:0},r),o=this.map(),a=o.unitsPerPixel(i.index.level),s=[{x:n.left*a,y:this._topDown()*n.top*a},{x:n.right*a,y:this._topDown()*n.bottom*a}];return e=null===e?o.gcs():void 0===e?o.ingcs():e,e!==o.gcs()&&(s=u.transformCoordinates(e,o.gcs(),s)),{left:s[0].x,top:s[0].y,right:s[1].x,bottom:s[1].y}},this._getTile=function(t,e){var i=e||t;return d({index:t,size:{x:this._options.tileWidth,y:this._options.tileHeight},queue:this._queue,url:this._options.url(i.x,i.y,i.level||0,this._options.subdomains)})},this._getTileCached=function(t,e,i){var r=this.cache.get(this._tileHash(t));return null===r&&(r=this._getTile(t,e),this.cache.add(r,this.remove.bind(this),i)),r},this._tileHash=function(t){return[t.level||0,t.y,t.x].join("_")},this._getTileRange=function(t,e){var i=[this.tileAtPoint({x:e.left,y:e.top},t),this.tileAtPoint({x:e.right,y:e.top},t),this.tileAtPoint({x:e.left,y:e.bottom},t),this.tileAtPoint({x:e.right,y:e.bottom},t)];return{start:{x:Math.min(i[0].x,i[1].x,i[2].x,i[3].x),y:Math.min(i[0].y,i[1].y,i[2].y,i[3].y)},end:{x:Math.max(i[0].x,i[1].x,i[2].x,i[3].x),y:Math.max(i[0].y,i[1].y,i[2].y,i[3].y)}}},this._getTiles=function(e,i,r,o){var a,s,u,h,l,c,d,f,m,p,v,y=[],x=!1,_=this._options.keepLower?this._options.minLevel:e;for(_>e&&(e=_),v=_;e>=v&&(d=this._getTileRange(v,i),l=d.start,c=d.end,h=this.tilesAtZoom(v),this._options.wrapX||(l.x=Math.min(Math.max(l.x,0),h.x-1),c.x=Math.min(Math.max(c.x,0),h.x-1),v===_&&this._options.keepLower&&(l.x=0,c.x=h.x-1)),this._options.wrapY||(l.y=Math.min(Math.max(l.y,0),h.y-1),c.y=Math.min(Math.max(c.y,0),h.y-1),v===_&&this._options.keepLower&&(l.y=0,c.y=h.y-1)),!(this._options.gcs&&this._options.gcs!==this.map().gcs()&&v!==_&&(c.x+1-l.x)*(c.y+1-l.y)>this.map().size().width*this.map().size().height/this._options.tileWidth/this._options.tileHeight*16));v+=1)for(a=l.x;a<=c.x;a+=1)for(s=l.y;s<=c.y;s+=1)u={level:v,x:a,y:s},f={level:v,x:a,y:s},this._options.wrapX&&(f.x=t(f.x,h.x)),this._options.wrapY&&(f.y=t(f.y,h.y)),this.isValid(f)&&(o&&y.length<g.length&&(p=g[y.length],x=x||u.level!==p.level||u.x!==p.x||u.y!==p.y),y.push({index:u,source:f}));if(o){if(!x&&y.length===g.length)return;g.splice(0,g.length),n.each(y,function(t,e){g.push(e.index)})}if(r){m={x:(l.x+c.x)/2,y:(l.y+c.y)/2,level:e,bottomLevel:e};for(var M=Math.max(c.x-l.x,c.y-l.y)+1;M>=1;M/=2)m.bottomLevel-=1;y.sort(this._loadMetric(m)),this._queue&&this._queue.batch(!0)}for(this.cache.size<y.length&&(console.log("Increasing cache size to "+y.length),this.cache.size=y.length),a=0;a<y.length;a+=1)y[a]=this._getTileCached(y[a].index,y[a].source,!0);return this.cache.purge(this.remove.bind(this)),y},this.prefetch=function(t,e){var i;return i=this._getTiles(t,e,!0),n.when.apply(n,i.map(function(t){return t.fetch()}))},this._loadMetric=function(t){return function(e,i){var r,n,o,a,s,u,h;return e=e.index||e,i=i.index||i,e.level!==i.level?t.bottomLevel&&e.level>=t.bottomLevel!=i.level>=t.bottomLevel?e.level>=t.bottomLevel?-1:1:e.level-i.level:(h=Math.pow(2,e.level-t.level),s=(t.x+.5)*h-.5,u=(t.y+.5)*h-.5,o=e.x-s,a=e.y-u,r=o*o+a*a,o=i.x-s,a=i.y-u,n=o*o+a*a,r-n)}},this.fromLevel=function(t,e){var i=Math.pow(2,-e);return{x:t.x*i,y:t.y*i}},this.toLevel=function(t,e){var i=Math.pow(2,e);return{x:t.x*i,y:t.y*i}},this.drawTile=function(t){var e=t.toString();this._activeTiles.hasOwnProperty(e)?this._moveToTop(t):this._drawTile(t),this._activeTiles[e]=t},this._drawTile=function(t){if(null!==this.renderer())throw new Error("This draw method is not valid on renderer managed layers.");var e=n(this._getSubLayer(t.index.level)),i=this._tileBounds(t),r=this._options.animationDuration,o=n('<div class="geo-tile-container"/>').attr("tile-reference",t.toString());o.append(t.image),o.css({position:"absolute",left:i.left-parseInt(e.attr("offsetx")||0,10)+"px",top:i.top-parseInt(e.attr("offsety")||0,10)+"px"}),r>0&&t.fadeIn(r),e.append(o),t["catch"](function(){console.warn("Could not load tile at "+t.toString()),this._remove(t)}.bind(this))},this.remove=function(t){var e=t.toString(),i=this._activeTiles[e];return i instanceof d&&this._remove(i),delete this._activeTiles[e],i},this._remove=function(t){t.image&&(t.image.parentElement?n(t.image.parentElement).remove():console.log("No parent element to remove "+t.toString(),t),n(t.image).remove())},this._moveToTop=function(t){n.noop(t)},this._getViewBounds=function(){var t=this.map(),e=t.zoom(),i=this._options.tileRounding(e),r=Math.pow(2,e-i),n=t.size(),o=this.displayToLevel({x:0,y:0}),a=this.displayToLevel({x:n.width,y:0}),s=this.displayToLevel({x:0,y:n.height}),u=this.displayToLevel({x:n.width,y:n.height});return{level:i,scale:r,left:Math.min(o.x,a.x,s.x,u.x),right:Math.max(o.x,a.x,s.x,u.x),top:Math.min(o.y,a.y,s.y,u.y),bottom:Math.max(o.y,a.y,s.y,u.y)}},this._purge=function(t,e,i){var r,n;if(!this._updating){i||(i=this._getViewBounds());for(n in this._activeTiles)r=this._activeTiles[n],this._canPurge(r,i,t,e)&&this.remove(r);return this}},this.clear=function(){var t,e=[];for(t in this._activeTiles)e.push(this.remove(t));return this._tileTree={},g=[],e},this.reset=function(){this.clear(),this._cache.clear()},this.toLocal=function(t,e){var i=this.map(),r=i.unitsPerPixel(void 0===e?i.zoom():e);return{x:t.x/r,y:this._topDown()*t.y/r}},this.fromLocal=function(t,e){var i=this.map(),r=i.unitsPerPixel(void 0===e?i.zoom():e);return{x:t.x*r,y:this._topDown()*t.y*r}},this._topDown=function(){return this._options.topDown?1:-1},this._getSubLayer=function(t){if(this.canvas()){var e=this.canvas().find("div[data-tile-layer="+t.toFixed()+"]").get(0);return e||(e=n('<div class=geo-tile-layer data-tile-layer="'+t.toFixed()+'"/>').css({"transform-origin":"0px 0px","line-height":0,"font-size":0}).get(0),this.canvas().append(e)),e}},this._updateSubLayers=function(t,e){var i=this.canvas(),r=parseInt(i.attr("lastlevel"),10),o=parseInt(i.attr("lastoffsetx")||0,10),a=parseInt(i.attr("lastoffsety")||0,10);if(r===t&&Math.abs(o-e.left)<65536&&Math.abs(a-e.top)<65536)return{x:o,y:a};var s=this.map(),u=this._tileOffset(t),h=parseInt((e.left+e.right-s.size().width)/2+u.x,10),l=parseInt((e.top+e.bottom-s.size().height)/2+u.y,10);return i.find(".geo-tile-layer").each(function(e,i){var r=n(i),o=parseInt(r.data("tileLayer"),10);r.css("transform","scale("+Math.pow(2,t-o)+")");var a=parseInt(h/Math.pow(2,t-o),10),s=parseInt(l/Math.pow(2,t-o),10),u=a-parseInt(r.attr("offsetx")||0,10),c=s-parseInt(r.attr("offsety")||0,10);r.attr({offsetx:a,offsety:s}),r.find(".geo-tile-container").each(function(t,e){n(e).css({left:parseInt(n(e).css("left"),10)-u+"px",top:parseInt(n(e).css("top"),10)-c+"px"})})}),i.attr({lastoffsetx:h,lastoffsety:l,lastlevel:t}),{x:h,y:l}},this._update=function(t){if(!t||!t.event||t.event.event!==s.zoom&&t.event.event!==s.rotate){var e,i=this.map(),r=i.bounds(void 0,null);if(this._updateSubLayers){var o=i.zoom(),a=this._options.tileRounding(o),u=this._getViewBounds(),h=this._updateSubLayers(a,u)||{x:0,y:0},l=this._tileOffset(a);if(null===this.renderer()){var c=Math.pow(2,o-a),d=i.rotation(),f=-l.x+-(u.left+u.right)/2+h.x,p=-l.y+-(u.bottom+u.top)/2+h.y,v=(f+i.size().width/2)*c,g=(p+i.size().height/2)*c;this.canvas().css({"transform-origin":""+-f+"px "+-p+"px"});var y="translate("+v+"px,"+g+"px)scale("+c+")";d&&(y+="rotate("+180*d/Math.PI+"deg)"),this.canvas().css("transform",y)}this.canvas().attr({scale:Math.pow(2,o-a),dx:-l.x+-(u.left+u.right)/2,dy:-l.y+-(u.bottom+u.top)/2,offsetx:h.x,offsety:h.y,rotation:i.rotation()})}e=this._getTiles(a,r,!0,!0),void 0!==e&&(this._tileTree={},e.forEach(function(t){if(t.fetched())this.drawTile(t),this._setTileTree(t);else if(t._queued){var e=this._queue?this._queue.get(t):-1;e>=0&&this._queue.add(t)}else t.then(function(){if(!m&&t===this.cache.get(t.toString())){var e=i.zoom(),r=this._options.tileRounding(e),n=this._getViewBounds();if(this._canPurge(t,n,r))return void this.remove(t);this.drawTile(t),this._setTileTree(t)}}.bind(this)),this.addPromise(t),t._queued=!0}.bind(this)),n.when.apply(n,e).done(function(){var t=this.map(),e=t.zoom(),i=this._options.tileRounding(e);this._purge(i,!0)}.bind(this)))}},this._setTileTree=function(t){if(!this._options.keepLower){var e=t.index;this._tileTree[e.level]=this._tileTree[e.level]||{},this._tileTree[e.level][e.x]=this._tileTree[e.level][e.x]||{},this._tileTree[e.level][e.x][e.y]=t}},this._getTileTree=function(t){return((this._tileTree[t.level]||{})[t.x]||{})[t.y]||null},this._isCovered=function(t){var e=t.index.level,i=t.index.x,r=t.index.y,n=[];return(n=this._getTileTree({level:e-1,x:Math.floor(i/2),y:Math.floor(r/2)}))?[n]:(n=[this._getTileTree({level:e+1,x:2*i,y:2*r}),this._getTileTree({level:e+1,x:2*i+1,y:2*r}),this._getTileTree({level:e+1,x:2*i,y:2*r+1}),this._getTileTree({level:e+1,x:2*i+1,y:2*r+1})],n.every(function(t){return null!==t})?n:null)},this._outOfBounds=function(t,e){var i=this._tileOffset(t.index.level),r=1;return t.index.level!==e.level&&(r=Math.pow(2,(e.level||0)-(t.index.level||0))),(t.bottom-i.y)*r<e.top||(t.left-i.x)*r>e.right||(t.top-i.y)*r>e.bottom||(t.right-i.x)*r<e.left},this._canPurge=function(t,e,i,r){if(this._options.keepLower){if(i=i||0,i<t.index.level&&t.index.level!==this._options.minLevel)return!0;if(t.index.level===this._options.minLevel&&!this._options.wrapX&&!this._options.wrapY)return!1}else if((r||this._isCovered(t))&&i!==t.index.level)return!0;return e?this._outOfBounds(t,e):!1},this.displayToLevel=function(t,e){var i=this.map(),r=i.zoom(),n=this._options.tileRounding(r),o=i.unitsPerPixel(void 0===e?n:e);if(void 0===t){var a=i.size();t={x:a.width/2,y:a.height/2}}var s=i.displayToGcs(t,this._options.gcs||null),u={x:s.x/o,y:this._topDown()*s.y/o};return u},this.url=function(t){return void 0===t?this._options.originalUrl:t===this._options.originalUrl?this:(this._options.originalUrl=t,"string"===n.type(t)&&(t=r(t)),this._options.url=t,this.reset(),this.map().draw(),this)},this.subdomains=function(t){return void 0===t?this._options.subdomains:(t&&("string"===n.type(t)&&(t=t.indexOf(",")>=0?t.split(","):t.split("")),this._options.subdomains=t,this.reset(),this.map().draw()),this)},this._tileOffset=function(t){return void 0===y[t]&&(y[t]=this._options.tileOffset(t)),y[t]},this._init=function(){var t;if(p.apply(this,arguments),null===this.renderer())for(t=0;t<=this._options.maxLevel;t+=1)this._getSubLayer(t);return this},this._exit=function(){return this.reset(),v.apply(this,arguments),m=!0,this},c("tile",this),this};return a.defaults={minLevel:0,maxLevel:18,tileOverlap:0,tileWidth:256,tileHeight:256,wrapX:!0,wrapY:!1,url:null,subdomains:"abc",tileOffset:function(t){return{x:0,y:0}},topDown:!1,keepLower:!0,tileRounding:Math.round,attribution:"",animationDuration:0},n(a,o),a}()},function(t,e){t.exports=function(){"use strict";var t=function(e){return this instanceof t?(e=e||{},this._size=e.size||64,Object.defineProperty(this,"size",{get:function(){return this._size},set:function(t){for(;this._atime.length>t;)this.remove(this._atime[this._atime.length-1]);this._size=t}}),Object.defineProperty(this,"length",{get:function(){return this._atime.length}}),this._access=function(t){return this._atime.indexOf(t)},this.remove=function(t){var e="string"==typeof t?t:t.toString();return e in this._cache?(this._atime.splice(this._access(e),1),delete this._cache[e],!0):!1},this.clear=function(){return this._cache={},this._atime=[],this},this.get=function(t,e){return t="string"==typeof t?t:t.toString(),t in this._cache?(e||(this._atime.splice(this._access(t),1),this._atime.unshift(t)),this._cache[t]):null},this.add=function(t,e,i){this.remove(t);var r=t.toString();this._cache[r]=t,this._atime.unshift(r),i||this.purge(e)},this.purge=function(t){for(var e;this._atime.length>this.size;){e=this._atime.pop();var i=this._cache[e];t&&t(i),delete this._cache[e]}},this.clear(),this):new t(e)};return t}()},function(t,e,i){var r=i(1),n=i(4),o=i(127),a=function(t){"use strict";if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var e=this,i=void 0===t.position?[]:t.position,n=this._init;return this.position=function(t){return void 0===t?i:(i=t,e.dataTime().modified(),e.modified(),e)},this._init=function(t){n.call(e,t);var o=r.extend({},{strokeWidth:function(){return 1},strokeColor:function(){return{r:1,g:1,b:1}}},void 0===t.style?{}:t.style);e.style(o),i&&e.dataTime().modified()},this._init(t),this};n(a,o),t.exports=a},function(t,e,i){var r=i(4),n=i(224),o=function(t){"use strict";if(!(this instanceof o))return new o(t);t=t||{},t.ul=void 0===t.ul?[0,1,0]:t.ul,t.lr=void 0===t.lr?[1,0,0]:t.lr,t.depth=void 0===t.depth?0:t.depth,n.call(this,t);var e=this,i=[t.ul.x,t.lr.y,t.depth],r=[t.ul.x,t.ul.y,t.depth],a=[t.lr.x,t.lr.y,t.depth],s=t.depth,u=void 0===t.drawOnAsyncResourceLoad?!0:!1,h=this._init;return this.origin=function(t){if(void 0===t)return i;if(t instanceof Array){if(t.length>3||t.length<2)throw"Origin point requires point in 2 or 3 dimension";i=t.slice(0),2===i.length&&(i[2]=s)}return e.dataTime().modified(),e.modified(),e},this.upperLeft=function(t){if(void 0===t)return r;if(t instanceof Array){if(t.length>3||t.length<2)throw"Upper left point requires point in 2 or 3 dimension";r=t.slice(0),2===r.length&&(r[2]=s)}return e.dataTime().modified(),e.modified(),e},this.lowerRight=function(t){if(void 0===t)return a;if(t instanceof Array){if(t.length>3||t.length<2)throw"Lower right point requires point in 2 or 3 dimension";a=t.slice(0),2===a.length&&(a[2]=s),e.dataTime().modified()}return e.dataTime().modified(),e.modified(),e},this.drawOnAsyncResourceLoad=function(t){return void 0===t?u:(u=t,e)},this._init=function(t){var i=null;h.call(e,t),i=e.style(),void 0===i.image&&(i.image=null),e.style(i)},this._init(t),this};r(o,n),t.exports=o},function(t,e,i){var r=i(1),n=i(4),o=i(127),a=function(t){"use strict";function e(){var t=h.position(),e=h.polygon();d=h.data().map(function(i,r){var n,o,a=e(i);return n=(a.outer||[]).map(function(e,n){return t.call(h,e,n,i,r)}),o=(a.inner||[]).map(function(e){return(e||[]).map(function(e,n){return t.call(h,e,n,i,r)})}),{outer:n,inner:o}})}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var n,s,u=i(120),h=this,l=this._init,c=this.data,d={outer:[],inner:[]};return s=void 0===t.polygon?function(t){return t}:t.polygon,n=void 0===t.position?function(t){return t}:t.position,this.data=function(t){var i=c(t);return void 0!==t&&e(),i},this.polygon=function(t){return void 0===t?s:(s=t,h.dataTime().modified(),h.modified(),e(),h)},this.position=function(t){return void 0===t?n:(n=t,h.dataTime().modified(),h.modified(),e(),h)},this.pointSearch=function(t){var e=[],i=[],r=h.data();return d.forEach(function(n,o){var a=u.pointInPolygon(t,n.outer,n.inner);a&&(i.push(o),e.push(r[o]))}),{index:i,found:e}},this._init=function(t){l.call(h,t);var e=r.extend({},{fillColor:{r:0,g:.5,b:.5},fillOpacity:1},void 0===t.style?{}:t.style);h.style(e),n&&h.dataTime().modified()},this._init(t),this};n(a,o),t.exports=a},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);t=t||{},n.call(this,t);var e=i(1),r=i(129),a=i(124),s=i(125),u=i(120),h=i(226),l=this,c=this._init,d=null,f=r(),m=this.data,p=0,v=t.clustering,g=null,y=[],x=null,_=!1;return this.clustering=function(t){return void 0===t?v:(v&&!t?(g=null,v=!1,m(y),y=null):!v&&t&&(v=!0,l._clusterData()),l)},this._clusterData=function(){if(v){var t=v===!0?{radius:.01}:v,e=l.position();g=new a(t,l.layer().width(),l.layer().height()),y.forEach(function(t,i){var r=u.normalizeCoordinates(e(t,i));r.index=i,g.addPoint(r)}),x=null,l._handleZoom(l.layer().map().zoom())}},this._handleZoom=function(t){var e=Math.floor(t);if(v&&e!==x){x=e;var i=g.points(e).map(function(t){return y[t.index]});g.clusters(e).forEach(function(t){t.__cluster=!0,t.__data=[],t.obj.each(function(e){t.__data.push(y[e.index])}),i.push(t)}),_=!0,l.data(i),l.layer().map().draw()}},this.position=function(t){return void 0===t?l.style("position"):(t=u.ensureFunction(t),l.style("position",function(e,i){return e.__cluster?e:t(e,i)}),l.dataTime().modified(),l.modified(),l)},this._updateRangeTree=function(){if(!(f.getMTime()>=l.dataTime().getMTime())){var t,e,i=l.style.get("radius"),r=l.style.get("stroke"),n=l.style.get("strokeWidth");e=l.position(),p=0,t=l.data().map(function(t,o){var a=e(t);return a.idx=o,p=Math.max(p,i(t,o)+(r(t,o)?n(t,o):0)),a}),d=new h.RangeTree(t),f.modified()}},this.pointSearch=function(t){var e,i,r,n,o,a,s,u=[],c=[],f=[],m=l.style.get("stroke"),v=l.style.get("strokeWidth"),g=l.style.get("radius");return l.selectionAPI()?(r=l.data(),r&&r.length?(o=l.layer().map(),a=o.gcsToDisplay(t),s=[o.displayToGcs({x:a.x-p,y:a.y-p}),o.displayToGcs({x:a.x+p,y:a.y-p}),o.displayToGcs({x:a.x-p,y:a.y+p}),o.displayToGcs({x:a.x+p,y:a.y+p})],e={x:Math.min(s[0].x,s[1].x,s[2].x,s[3].x),y:Math.min(s[0].y,s[1].y,s[2].y,s[3].y)},i={x:Math.max(s[0].x,s[1].x,s[2].x,s[3].x),y:Math.max(s[0].y,s[1].y,s[2].y,s[3].y)},n=new h.Box(h.vect(e.x,e.y),h.vect(i.x,i.y)),l._updateRangeTree(),d.search(n).forEach(function(t){u.push(t.idx)}),u.forEach(function(t){var e,i,n,s,u=r[t],h=l.position()(u,t);n=g(r[t],t),n+=m(r[t],t)?v(r[t],t):0,s=n*n,h=o.gcsToDisplay(h),e=h.x-a.x,i=h.y-a.y,s>=e*e+i*i&&(c.push(u),f.push(t))}),{data:c,index:f}):{found:[],index:[]}):[]},this.boxSearch=function(t,e){var i=l.position(),r=[];return l.data().forEach(function(n,o){var a=i(n);a.x>=t.x&&a.x<=e.x&&a.y>=t.y&&a.y<=e.y&&r.push(o)}),r},this.data=function(t){return void 0===t?m():(v&&!_?(y=t,l._clusterData()):m(t),_=!1,l)},this._boundingBox=function(t){var e,i;return e=l.position()(t),e=l.layer().map().gcsToDisplay(e),i=l.style().radius(t),{min:{x:e.x-i,y:e.y-i},max:{x:e.x+i,y:e.y+i}}},this._init=function(t){c.call(l,t);var i=e.extend({},{radius:5,stroke:!0,strokeColor:{r:.851,g:.604,b:0},strokeWidth:1.25,strokeOpacity:1,fillColor:{r:1,g:.839,b:.439},fill:!0,fillOpacity:.8,sprites:!1,sprites_image:null,position:function(t){return t}},void 0===t.style?{}:t.style);void 0!==t.position&&(i.position=t.position),l.style(i),l.dataTime().modified(),l.geoOn(s.zoom,function(t){l._handleZoom(t.zoomLevel)})},l};o.create=function(t,e,i){"use strict";return i.type="point",n.create(t,i)},r(o,n),t.exports=o},function(t,e){/**
	 * @license
	 * Includes several support classes adapted from wigglemaps.
	 *
	 * https://github.com/dotskapes/wigglemaps
	 *
	 * Copyright 2013 Preston and Krejci (dotSkapes Virtual Lab)
	 *
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *   http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
!function(){"use strict";function e(t,e){return new a(t,e)}var i=function(t,e,n,o){this.data=t[o],this.left=null,this.right=null,e!==o&&(this.left=new i(t,e,o-1,parseInt((e+(o-1))/2,10))),n!==o&&(this.right=new i(t,o+1,n,parseInt((n+(o+1))/2,10))),this.elem=t,this.start=e,this.end=n,this.subtree=null,this.search=r},r=function(t,e){var i=this,r=function(t){return t.x_in(i.elem[i.start])&&t.x_in(i.elem[i.end])},n=function(t,e,r){return t.y_in(i.subtree[e])&&t.y_in(i.subtree[r])},o=function(t,e,r,a,s){if(n(e,r,a))for(var u=r;a>=u;u++)t.push(i.subtree[u]);else e.y_in(i.subtree[s])&&t.push(i.subtree[s]),e.y_left(i.subtree[s])?s!==a&&o(t,e,s+1,a,parseInt((a+(s+1))/2,10)):e.x_right(i.subtree[s])?s!==r&&o(t,e,r,s-1,parseInt((r+(s-1))/2,10)):(s!==a&&o(t,e,s+1,a,parseInt((a+(s+1))/2,10)),s!==r&&o(t,e,r,s-1,parseInt((r+(s-1))/2,10)))};return r(e)?(this.subtree||(this.subtree=this.elem.slice(this.start,this.end+1),this.subtree.sort(function(t,e){return t.y-e.y})),void o(t,e,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2,10))):(e.contains(this.data)&&t.push(this.data),void(e.x_left(this.data)?this.right&&this.right.search(t,e):e.x_right(this.data)?this.left&&this.left.search(t,e):(this.left&&this.left.search(t,e),this.right&&this.right.search(t,e))))},n=function(t){t.sort(function(t,e){return t.x-e.x}),t.length>0?this.root=new i(t,0,t.length-1,parseInt((t.length-1)/2,10)):this.root=null,this.search=function(t){if(!this.root)return[];var e=t.clone(),i=[];return this.root.search(i,e),i}},o=function(t,i){this.min=t.clone(),this.max=i.clone(),this.contains=function(e){return t.x<=e.x&&i.x>=e.x&&t.y<=e.y&&i.y>=e.y},this.x_in=function(e){return t.x<=e.x&&i.x>=e.x},this.x_left=function(e){return t.x>=e.x},this.x_right=function(t){return i.x<=t.x},this.y_in=function(e){return t.y<=e.y&&i.y>=e.y},this.y_left=function(e){return t.y>=e.y},this.y_right=function(t){return i.y<=t.y},this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)},this.height=function(){return this.max.y-this.min.y},this.width=function(){return this.max.x-this.min.x},this.vertex=function(t){switch(t){case 0:return this.min.clone();case 1:return new e(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new e(this.min.x,this.max.y);default:throw"Index out of bounds: "+t}},this.intersects=function(t){for(var i=0;4>i;i++)for(var r=0;4>r;r++)if(e.intersects(this.vertex(i),this.vertex((i+1)%4),t.vertex(r),t.vertex((r+1)%4)))return!0;return this.contains(t.min)&&this.contains(t.max)&&this.contains(new e(t.min.x,t.max.y))&&this.contains(new e(t.max.x,t.min.y))?!0:t.contains(this.min)&&t.contains(this.max)&&t.contains(new e(this.min.x,this.max.y))&&t.contains(new e(this.max.x,this.min.y))?!0:!1},this.union=function(t){this.min.x=Math.min(this.min.x,t.min.x),this.min.y=Math.min(this.min.y,t.min.y),this.max.x=Math.max(this.max.x,t.max.x),this.max.y=Math.max(this.max.y,t.max.y)},this.centroid=function(){return new e((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)},this.clone=function(){return new o(t,i)}},a=function(t,e){this.x=t,this.y=e,this.add=function(t){return this.x+=t.x,this.y+=t.y,this},this.sub=function(t){return this.x-=t.x,this.y-=t.y,this},this.scale=function(t){return this.x*=t,this.y*=t,this},this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.normalize=function(){var t=this.length();return 0===t?this:(this.x/=t,this.y/=t,this)},this.div=function(t){return this.x/=t.x,this.y/=t.y,this},this.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},this.zero=function(t){return t=t||0,this.length()<=t},this.dot=function(t){return this.x*t.x+this.y*t.y},this.cross=function(t){return this.x*t.y-this.y*t.x},this.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return xp=e*this.x-i*this.y,yp=i*this.x+e*this.y,this.x=xp,this.y=yp,this},this.clone=function(){return new a(this.x,this.y)},this.array=function(){return[this.x,this.y]}};e.scale=function(t,e){return t.clone().scale(e)},e.add=function(t,e){return t.clone().add(e)},e.sub=function(t,e){return t.clone().sub(e)},e.dist=function(t,e){return t.clone().sub(e).length()},e.dir=function(t,e){return t.clone().sub(e).normalize()},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e){return t.x*e.y-t.y*e.x},e.left=function(t,i,r,n){n||(n=0);var o=e.sub(i,t),a=e.sub(r,t);return e.cross(o,a)>=-n},e.intersects=function(t,i,r,n,o){return o||(o=0),e.left(t,i,r,o)!=e.left(t,i,n,o)&&e.left(r,n,i,o)!=e.left(r,n,t,o)},e.intersect2dt=function(t,e,i,r){var n=t.x*(r.y-i.y)+e.x*(i.y-r.y)+r.x*(e.y-t.y)+i.x*(t.y-e.y);if(0===n)return 1/0;var o=(t.x*(r.y-i.y)+i.x*(t.y-r.y)+r.x*(i.y-t.y),-(t.x*(i.y-e.y)+e.x*(t.y-i.y)+i.x*(e.y-t.y))),a=o/n;return a},e.intersect2dpos=function(t,i,r,n){var o=t.x*(n.y-r.y)+i.x*(r.y-n.y)+n.x*(i.y-t.y)+r.x*(t.y-i.y);if(0===o)return 1/0;var a=t.x*(n.y-r.y)+r.x*(t.y-n.y)+n.x*(r.y-t.y),s=a/o,u=e.sub(i,t);return u.scale(s),e.add(t,u)},e.rotate=function(t,i){var r=Math.cos(i),n=Math.sin(i);xp=r*t.x-n*t.y,yp=n*t.x+r*t.y;var o=new e(xp,yp);return o},e.normalize=function(t){return t.clone().normalize()},t.exports={Box:o,vect:e,RangeTree:n}}()},function(t,e,i){var r=i(1),n=i(4),o=i(127),a=function(t){"use strict";var e=i(147),n=i(120);if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var s,u,h=this,l=this._init,c=[];return this._objectListStart=function(t){r.each(t,function(t,e){e.used=!1})},this._objectListGet=function(t,e){for(var i=0;i<t.length;i+=1)if(t[i].entry===e)return t[i].used=!0,t[i].value},this._objectListAdd=function(t,e,i){t.push({entry:e,value:i,used:!0})},this._objectListEnd=function(t){for(var e=t.length-1;e>=0;e-=1)t[e].used||t.splice(e,1)},this.pointSearch=function(t){var i,o=[],a=[],s=h.data(),l=[{},{},{},{}],c=[{},{},{},{}],d=h.layer().map(),f=[0,1,2,0],m=[1,2,3,1];return t=e.transformCoordinates(d.ingcs(),d.gcs(),[t])[0],u||this._generateQuads(),r.each([u.clrQuads,u.imgQuads],function(e,r){r.forEach(function(e,r){for(i=0;i<f.length;i+=1)l[i].x=e.pos[3*f[i]],l[i].y=e.pos[3*f[i]+1],l[i].z=e.pos[3*f[i]+2],c[i].x=e.pos[3*m[i]],c[i].y=e.pos[3*m[i]+1],c[i].z=e.pos[3*m[i]+2];(n.pointInPolygon(t,l)||n.pointInPolygon(t,c))&&(a.push(e.idx),o.push(s[e.idx]))})}),{index:a,found:o}},this.position=function(t){return void 0===t?h.style("position"):(h.style("position",n.ensureFunction(t)),h.dataTime().modified(),h.modified(),h)},this._positionToQuad=function(t,i,n,o){var a=t.call(h,n,o);if(a.ll&&a.ur||a.ul&&a.lr){var s=h.gcs(),u=h.layer().map().gcs(),l={};return r.each(["ll","lr","ul","ur"],function(t,r){void 0!==a[r]&&(l[r]={},void 0===a[r].x?l[r]=[a[r][0],a[r][1],a[r][2]]:l[r]=[a[r].x,a[r].y,a[r].z],void 0===l[r][2]&&(l[r][2]=i.call(h,n,o)),s!==u&&(l[r]=e.transformCoordinates(s,u,l[r])))}),l.ll=l.ll||[l.ul[0],l.lr[1],(l.ul[2]+l.lr[2])/2],l.lr=l.lr||[l.ur[0],l.ll[1],(l.ur[2]+l.ll[2])/2],l.ur=l.ur||[l.lr[0],l.ul[1],(l.lr[2]+l.ul[2])/2],l.ul=l.ul||[l.ll[0],l.ur[1],(l.ll[2]+l.ur[2])/2],l}},this._generateQuads=function(){var t,e,i=h.position(),o=n.ensureFunction(h.style("image")),a=n.ensureFunction(h.style("color")),l=n.ensureFunction(h.style("depth")),d=n.ensureFunction(h.style("opacity")),f=n.ensureFunction(h.style("drawOnAsyncResourceLoaded")),m=n.ensureFunction(h.style("previewColor")),p=n.ensureFunction(h.style("previewImage")),v=h.data(),g=[],y=[],x=[0,0,0];return h._objectListStart(c),r.each(v,function(u,v){if(v._cachedQuad)return e=v._cachedQuad.diag2,(void 0===t||v._cachedQuad.diag2&&v._cachedQuad.diag2<t)&&(x=v._cachedQuad.ll,t=v._cachedQuad.diag2),v._cachedQuad.clrquad&&g.push(v._cachedQuad.clrquad),void(v._cachedQuad.imgquad&&y.push(v._cachedQuad.imgquad));var _,M,b,w,T,A,E,P,R,S={};if(T=h._positionToQuad(i,l,v,u),E=d.call(h,v,u),void 0!==T&&E){if(e=Math.pow(T.ll[0]-T.ur[0],2)+Math.pow(T.ll[1]-T.ur[1],2)+Math.pow(T.ll[2]-T.ur[0],2)+Math.pow(T.lr[0]-T.ur[0],2)+Math.pow(T.lr[1]-T.ur[1],2)+Math.pow(T.lr[2]-T.ur[0],2),S.diag2=e,S.ll=T.ll,(void 0===t||e&&t>e)&&(x=T.ll,t=e),T=[T.ll[0],T.ll[1],T.ll[2],T.lr[0],T.lr[1],T.lr[2],T.ul[0],T.ul[1],T.ul[2],T.ur[0],T.ur[1],T.ur[2]],A=o.call(h,v,u)){if(b=h._objectListGet(c,A),void 0===b&&(A instanceof Image?b=A:(b=new Image,b.src=A),h._objectListAdd(c,A,b)),_={idx:u,pos:T,opacity:E},b.complete&&b.naturalWidth&&b.naturalHeight)_.image=b;else if(P=void 0,R=p.call(h,v,u),R&&R instanceof Image&&R.complete&&R.naturalWidth&&R.naturalHeight?_.image=R:(P=m.call(h,v,u),null===P&&(P=void 0),void 0!==P&&(_.color=n.convertColor(P),g.push(_),S.keep=!1)),M=f.call(h,v,u))w=b.onload,b.onload=function(){return void 0!==P&&r.inArray(_,g)>=0&&g.splice(r.inArray(_,g),1),_.image=b,h.dataTime().modified(),h.modified(),h._update(),h.layer().draw(),w?w.apply(this,arguments):void 0};else if(void 0===P&&!_.image)return;y.push(_),S.imgquad=_}else _={idx:u,pos:T,opacity:E,color:n.convertColor(a.call(h,v,u))},g.push(_),S.clrquad=_;s!==!1&&S.keep!==!1&&(v._cachedQuad=S)}}),h._objectListEnd(c),u={clrQuads:g,imgQuads:y,origin:x}},this._init=function(t){t=t||{},l.call(h,t),s=t.cacheQuads!==!1;var e=r.extend({},{color:{r:1,g:1,b:1},opacity:1,depth:0,drawOnAsyncResourceLoaded:!0,previewColor:null,previewImage:null,image:function(t){return t.image},position:function(t){return t}},void 0===t.style?{}:t.style);void 0!==t.position&&(e.position=n.ensureFunction(t.position)),h.style(e),h.dataTime().modified()},h};a.create=function(t,e){"use strict";return e=e||{},e.type="quad",o.create(t,e)},n(a,o),t.exports=a},function(t,e,i){var r=i(4),n=i(127),o=function(t){"use strict";if(!(this instanceof o))return new o(t);var e=i(1);t=t||{},n.call(this,t);var r=this,a=this._init,s=this.style;this.origin=function(t){return void 0===t?s("origin"):(s("origin",t),r.dataTime().modified(),r.modified(),r)},this.delta=function(t){return void 0===t?s("delta"):(s("delta",t),r.dataTime().modified(),r.modified(),r)},this._init=function(t){a.call(r,t);var i=e.extend({},{strokeColor:"black",strokeWidth:2,strokeOpacity:1,originStyle:"none",endStyle:"arrow",origin:{x:0,y:0,z:0},delta:function(t){return t},scale:null},void 0===t.style?{}:t.style);void 0!==t.origin&&(i.origin=t.origin),r.style(i),r.dataTime().modified()}};r(o,n),t.exports=o},function(t,e,i){t.exports="0.9.0"},function(t,e,i){var r=i(125);r.d3={rescale:i(231)},t.exports={graphFeature:i(232),lineFeature:i(233),object:i(234),pathFeature:i(236),planeFeature:i(237),pointFeature:i(238),renderer:i(239),tileLayer:i(240),uniqueID:i(235),vectorFeature:i(241)}},function(t,e){t.exports="geo_d3_rescale"},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(141),a=function(t){"use strict";var e=this;return this instanceof a?(o.call(this,t),this.select=function(){var t=e.renderer(),i={},r=e.nodeFeature(),n=e.linkFeatures();return i.nodes=t.select(r._d3id()),i.links=n.map(function(e){return t.select(e._d3id())}),i},this):new a(t)};r(a,o),n("d3","graph",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(145),a=function(t){"use strict";if(!(this instanceof a))return new a(t);var e=i(132),r=i(234),n=i(129),s=i(120);t=t||{},o.call(this,t),r.call(this);var u=this,h=this._init,l=n(),c=this._update;return this._init=function(t){return h.call(u,t),u},this._build=function(){var t=u.data()||[],i=u.style(),r=u.renderer(),n=u.position(),o=e.svg.line().x(function(t){return u.featureGcsToDisplay(t).x}).y(function(t){return u.featureGcsToDisplay(t).y});return c.call(u),i.fill=function(){return!1},t.forEach(function(t,e){function a(i){return s.isFunction(i)?function(){return i(c[0],0,t,e)}:i}var h,l,c=u.line()(t,e),d={};for(l in i)i.hasOwnProperty(l)&&(d[l]=a(i[l]));h={data:[c.map(function(i,r){return n(i,r,t,e)})],append:"path",attributes:{d:o},id:u._d3id()+e,classes:["d3LineFeature","d3SubLine-"+e],style:d},r._drawFeatures(h)}),l.modified(),u.updateTime().modified(),u},this._update=function(){return c.call(u),u.getMTime()>=l.getMTime()&&u._build(),u},this._init(t),this};r(a,o),n("d3","line",a),t.exports=a},function(t,e,i){var r=i(4),n=i(128),o=function(t){"use strict";var e=i(5),r=i(235);if(!(this instanceof e))return new o(t);n.call(this);var a="d3-"+r(),s=this._exit,u=this,h=this.draw;return this._d3id=function(){return a},this.select=function(){return u.renderer().select(u._d3id())},this.draw=function(){return u._update(),h(),u},this._exit=function(){u.renderer()._removeFeature(u._d3id()),s()},this};r(o,n),t.exports=o},function(t,e){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",r=8,n=function(){var t,e=[];for(e.length=r,t=0;r>t;t+=1)e[t]=i.charAt(Math.floor(Math.random()*i.length));return e.join("")};t.exports=n},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(222),a=function(t){"use strict";if(!(this instanceof a))return new a(t);var e=i(1),r=i(132),n=i(234),s=i(129);t=t||{},o.call(this,t),n.call(this);var u=this,h=this._init,l=s(),c=this._update,d={};return d.style={},this._init=function(t){return h.call(u,t),u},this._build=function(){var t,i,n=u.data()||[],o=u.style();return c.call(u),i=function(t){var e={source:t.source,target:t.target};return r.svg.diagonal()(e)},t=[],n.forEach(function(e,i){var r,o;i<n.length-1&&(r=e,o=n[i+1],t.push({source:u.featureGcsToDisplay(r),target:u.featureGcsToDisplay(o)}))}),d.data=t,d.attributes={d:i},d.id=u._d3id(),d.append="path",d.classes=["d3PathFeature"],d.style=e.extend({fill:function(){return!1},fillColor:function(){return{r:0,g:0,b:0}}},o),u.renderer()._drawFeatures(d),l.modified(),u.updateTime().modified(),u},this._update=function(){return c.call(u),u.dataTime().getMTime()>=l.getMTime()&&u._build(),u},this._init(t),this};r(a,o),n("d3","path",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(223),a=function(t){"use strict";function e(t){return Array.isArray(t)?{x:t[0],y:t[1]}:t}if(!(this instanceof a))return new a(t);var r=i(234),n=i(129);o.call(this,t),r.call(this);var s=this,u={},h=this._update,l=this._init,c=n();return this._build=function(){var t=e(s.upperLeft()),i=e(s.lowerRight()),r=s.renderer(),n=s.style();return delete n.fill_color,delete n.color,delete n.opacity,u.id=s._d3id(),u.style=n,u.attributes={x:t.x,y:t.y,width:Math.abs(i.x-t.x),height:Math.abs(i.y-t.y),reference:n.reference},n.image?(u.append="image",u.attributes["xlink:href"]=n.image):u.append="rect",u.data=[0],u.classes=["d3PlaneFeature"],n.parentId&&(u.parentId=n.parentId),r._drawFeatures(u),c.modified(),s},this._update=function(){return h.call(s),s.dataTime().getMTime()>=c.getMTime()&&s._build(),s},this._init=function(t){return l.call(s,t||{}),s.style({stroke:function(){return!1},fill:function(){return!0},fillColor:function(){return{r:.3,g:.3,b:.3}},fillOpacity:function(){return.5}}),s},this._init(),this};r(a,o),n("d3","plane",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(225),a=function(t){"use strict";if(!(this instanceof a))return new a(t);var e=i(234),r=i(129);t=t||{},o.call(this,t),e.call(this);var n=this,s=this._init,u=this._update,h=r(),l={};return this._init=function(t){return s.call(n,t),n},this._build=function(){var t=n.data(),e=n.style.get(),i=n.renderer(),r=n.position();return u.call(n),t||(t=[]),l.id=n._d3id(),l.data=t,l.append="circle",l.attributes={r:i._convertScale(e.radius),cx:function(t){return n.featureGcsToDisplay(r(t)).x},cy:function(t){return n.featureGcsToDisplay(r(t)).y}},l.style=e,l.classes=["d3PointFeature"],n.renderer()._drawFeatures(l),h.modified(),n.updateTime().modified(),n},this._update=function(){return u.call(n),n.getMTime()>=h.getMTime()&&n._build(),n},this._init(t),this};r(a,o),n("d3","point",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerRenderer,o=i(136),a=function(t){"use strict";function e(t,e){var i;for(i in e)e.hasOwnProperty(i)&&t.attr(i,e[i])}function r(t,e){function i(){return e.fill.apply(m,arguments)?null:"none"}function r(){return e.stroke.apply(m,arguments)?null:"none"}var n,o,a;for(n in e)e.hasOwnProperty(n)&&(a=null,o=null,"strokeColor"===n?(o="stroke",a=m._convertColor(e[n],e.stroke)):"stroke"===n&&e[n]&&!e.hasOwnProperty("strokeColor")?(o="stroke",a=r):"strokeWidth"===n?(o="stroke-width",a=m._convertScale(e[n])):"strokeOpacity"===n?(o="stroke-opacity",a=e[n]):"fillColor"===n?(o="fill",a=m._convertColor(e[n],e.fill)):"fill"!==n||e.hasOwnProperty("fillColor")?"fillOpacity"===n&&(o="fill-opacity",a=e[n]):(o="fill",a=i),o&&t.style(o,a))}function n(t){return t?w.select(".group-"+t):w.select(".group-"+m._d3id())}function s(){var t=m.layer(),e=t.map(),i=e.size().width,r=e.size().height;if(y=i,x=r,!y||!x)throw"Map layer has size 0";_=Math.pow(i*i+r*r,.5),g={upperLeft:e.displayToGcs({x:0,y:0},null),lowerRight:e.displayToGcs({x:i,y:r},null),center:e.displayToGcs({x:i/2,y:r/2},null)}}var u=i(132),h=i(234),l=i(120),c=i(125),d=i(231);if(!(this instanceof a))return new a(t);o.call(this,t);var f=this._exit;h.call(this,t),t=t||{};var m=this,p=null,v={},g=null,y=null,x=null,_=null,M=1,b={dx:0,dy:0,rx:0,ry:0,rotation:0},w=null,T=null;return this._convertColor=function(t,e){return t=l.ensureFunction(t),e=e||function(){return!0},function(){var i="none";return e.apply(m,arguments)&&(i=t.apply(m,arguments),i.hasOwnProperty("r")&&i.hasOwnProperty("g")&&i.hasOwnProperty("b")&&(i=u.rgb(255*i.r,255*i.g,255*i.b))),i}},this._convertPosition=function(t){return t=l.ensureFunction(t),function(){return m.layer().map().worldToDisplay(t.apply(m,arguments))}},this._convertScale=function(t){return t=l.ensureFunction(t),function(){return t.apply(m,arguments)/M}},this._setTransform=function(){if(g||s(),p){var t,e,i,r,o,a,u=m.layer(),h=u.map(),l=h.gcsToDisplay(g.upperLeft,null),c=h.gcsToDisplay(g.lowerRight,null),d=h.gcsToDisplay(g.center,null),f=n(),v=m.canvas();null!==v.attr("scale")?(i=parseFloat(v.attr("scale")||1),o=parseFloat(v.attr("dx")||0)+parseFloat(v.attr("offsetx")||0),a=parseFloat(v.attr("dy")||0)+parseFloat(v.attr("offsety")||0),r=parseFloat(v.attr("rotation")||0),t=i*o+h.size().width/2,e=i*a+h.size().height/2):(i=Math.sqrt(Math.pow(c.y-l.y,2)+Math.pow(c.x-l.x,2))/_,r=h.rotation(),o=-y/2,a=-x/2,t=i*o+d.x,e=i*a+d.y);var w="matrix("+[i,0,0,i,t,e].join()+")";r&&(w+=" rotate("+[180*r/Math.PI,-o,-a].join()+")"),f.attr("transform",w),M=i,b.dx=t,b.dy=e,b.rx=o,b.ry=a,b.rotation=r}},this.baseToLocal=function(t){if(t={x:(t.x-b.dx)/M,y:(t.y-b.dy)/M},b.rotation){var e=Math.sin(-b.rotation),i=Math.cos(-b.rotation),r=t.x+b.rx,n=t.y+b.ry;t={x:r*i-n*e-b.rx,y:r*e+n*i-b.ry}}return t},this.localToBase=function(t){if(b.rotation){var e=Math.sin(b.rotation),i=Math.cos(b.rotation),r=t.x+b.rx,n=t.y+b.ry;t={x:r*i-n*e-b.rx,y:r*e+n*i-b.ry}}return t={x:t.x*M+b.dx,y:t.y*M+b.dy}},this._init=function(t){if(!m.canvas()){var e;t.widget=t.widget||!1,w="d3Parent"in t?u.select(t.d3Parent).append("svg"):u.select(m.layer().node().get(0)).append("svg"),T=w.append("defs");var i=T.append("filter").attr("id","geo-highlight").attr("x","-100%").attr("y","-100%").attr("width","300%").attr("height","300%");i.append("feMorphology").attr("operator","dilate").attr("radius",2).attr("in","SourceAlpha").attr("result","dilateOut"),i.append("feGaussianBlur").attr("stdDeviation",5).attr("in","dilateOut").attr("result","blurOut"),i.append("feColorMatrix").attr("type","matrix").attr("values","-1 0 0 0 1  0 -1 0 0 1  0 0 -1 0 1  0 0 0 1 0").attr("in","blurOut").attr("result","invertOut"),i.append("feBlend").attr("in","SourceGraphic").attr("in2","invertOut").attr("mode","normal"),t.widget||(e=w.append("g")),i=T.append("filter").attr("id","geo-blur").attr("x","-100%").attr("y","-100%").attr("width","300%").attr("height","300%"),i.append("feGaussianBlur").attr("stdDeviation",20).attr("in","SourceGraphic"),p=m.layer().sticky(),w.attr("class",m._d3id()),w.attr("width",m.layer().node().width()),w.attr("height",m.layer().node().height()),t.widget?m.canvas(w):(e.attr("class","group-"+m._d3id()),m.canvas(e))}m._setTransform()},this.api=function(){return"d3"},this.scaleFactor=function(){return M},this._resize=function(t,e,i,r){g||s(),w.attr("width",i),w.attr("height",r),m._setTransform(),m.layer().geoTrigger(c.d3Rescale,{scale:M},!0)},this._update=function(){},this._exit=function(){v={},m.canvas().remove(),w.remove(),w=void 0,T.remove(),T=void 0,f()},this._definitions=function(){return T},this._drawFeatures=function(t){return v[t.id]={data:t.data,index:t.dataIndex,style:t.style,attributes:t.attributes,classes:t.classes,append:t.append,parentId:t.parentId},m.__render(t.id,t.parentId)},this.__render=function(t,i){var n;if(void 0===t){for(n in v)v.hasOwnProperty(n)&&m.__render(n);return m}var o=v[t].data,a=v[t].index,s=v[t].style,u=v[t].attributes,h=v[t].classes,l=v[t].append,c=m.select(t,i).data(o,a);return c.enter().append(l),c.exit().remove(),e(c,u),c.attr("class",h.concat([t]).join(" ")),r(c,s),m},this.select=function(t,e){return n(e).selectAll("."+t)},this._removeFeature=function(t){return m.select(t).remove(),delete v[t],m},this.draw=function(){},this.layer().geoOn(c.pan,m._setTransform),this.layer().geoOn(c.rotate,m._setTransform),this.layer().geoOn(c.zoom,function(){m._setTransform(),m.__render(),m.layer().geoTrigger(d,{scale:M},!0)}),this.layer().geoOn(c.resize,function(t){m._resize(t.x,t.y,t.width,t.height)}),this._init(t),this};r(a,o),n("d3",a),function(){"use strict";a.supported=function(){return!!i.m[132]},a.fallback=function(){return null}}(),t.exports=a},function(t,e,i){var r=i(131).registerLayerAdjustment,n=function(){"use strict";var t=this,e=this._update,r=this._init,n=i(1),o=i(235);this._drawTile=function(e){var i=t._tileBounds(e),r=t._getSubLayer(e.index.level),n=parseInt(r.attr("offsetx")||0,10),o=parseInt(r.attr("offsety")||0,10);e.feature=t.createFeature("plane",{drawOnAsyncResourceLoad:!0}).origin([i.left-n,i.top-o]).upperLeft([i.left-n,i.top-o]).lowerRight([i.right-n,i.bottom-o]).style({image:e._url,opacity:1,reference:e.toString(),parentId:r.attr("data-tile-layer-id")}),e.feature.geoTrigger=void 0,e.feature._update(),t.draw()},this._getSubLayer=function(e){var i=t.canvas().select('g[data-tile-layer="'+e.toFixed()+'"]');if(i.empty()){i=t.canvas().append("g");var r=o();i.classed("group-"+r,!0),i.classed("geo-tile-layer",!0),i.attr("data-tile-layer",e.toFixed()),i.attr("data-tile-layer-id",r)}return i},this._updateSubLayers=function(e,i){var r=t.canvas(),o=parseInt(r.attr("lastlevel"),10),a=parseInt(r.attr("lastoffsetx")||0,10),s=parseInt(r.attr("lastoffsety")||0,10);if(o===e&&Math.abs(a-i.left)<65536&&Math.abs(s-i.top)<65536)return{x:a,y:s};var u=this._tileOffset(e),h=parseInt(i.left,10)+u.x,l=parseInt(i.top,10)+u.y,c=t.cache._cache;return n.each(r.selectAll(".geo-tile-layer")[0],function(i,r){var o=parseInt(n(r).attr("data-tile-layer"),10),a=Math.pow(2,e-o);r=t._getSubLayer(o),r.attr("transform","matrix("+[a,0,0,a,0,0].join()+")");var s=parseInt(h/Math.pow(2,e-o),10),u=parseInt(l/Math.pow(2,e-o),10),d=s-parseInt(r.attr("offsetx")||0,10),f=u-parseInt(r.attr("offsety")||0,10);r.attr({offsetx:s,offsety:u}),n.each(c,function(t,e){if(e._index.level===o&&e.feature){var i=e.feature,r=i.origin(),n=i.upperLeft(),a=i.lowerRight();i.origin([r[0]-d,r[1]-f,r[2]]),i.upperLeft([n[0]-d,n[1]-f,n[2]]),i.lowerRight([a[0]-d,a[1]-f,a[2]]),i._update()}})}),r.attr({lastoffsetx:h,lastoffsety:l,lastlevel:e}),{x:h,y:l}},this._init=function(){var e;for(r.apply(t,arguments),e=0;e<=t._options.maxLevel;e+=1)t._getSubLayer(e)},this._update=function(){e.apply(t,arguments),t.renderer()._setTransform()},this._remove=function(e){e.feature&&(t.deleteFeature(e.feature),e.feature=null),e.image&&n(e.image).remove()}};r("d3","tile",n),t.exports=n},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(228),a=function(t){"use strict";function e(t,e,i){return h._d3id()+"_marker_"+e+"_"+i}function r(t,i,r,n,o){var a={arrow:{attrs:{"class":"geo-vector-arrow geo-vector-marker",viewBox:"0 0 10 10",refX:"1",refY:"5",markerHeight:"5",markerWidth:"5",orient:"auto"},path:"M 0 0 L 10 5 L 0 10 z"},point:{attrs:{"class":"geo-vector-point geo-vector-marker",viewBox:"0 0 12 12",refX:"6",refY:"6",markerHeight:"8",markerWidth:"8",orient:"auto"},path:"M 6 3 A 3 3 0 1 1 5.99999 3 Z"},bar:{attrs:{"class":"geo-vector-bar geo-vector-marker",viewBox:"0 0 10 10",refX:"0",refY:"5",markerHeight:"6",markerWidth:"6",orient:"auto"},path:"M 0 0 L 2 0 L 2 10 L 0 10 z"},wedge:{attrs:{"class":"geo-vector-wedge geo-vector-marker",viewBox:"0 0 10 10",refX:"10",refY:"5",markerHeight:"5",markerWidth:"5",orient:"auto"},path:"M 0 0 L 1 0 L 10 5 L 1 10 L 0 10 L 9 5 L 0 0"}},s=h.renderer()._definitions().selectAll("g.marker-group#"+h._d3id()).data(t.length?[1]:[]);s.enter().append("g").attr("id",h._d3id).attr("class","marker-group"),s.exit().remove();var l=t.reduce(function(t,e,i){var r=a[o(e,i)],s=a[n(e,i)];return r&&t.push({data:e,dataIndex:i,head:!0}),s&&t.push({data:e,dataIndex:i,head:!1}),t},[]),c=s.selectAll("marker.geo-vector-marker").data(l);c.enter().append("marker").append("path");var d=h.renderer();c.each(function(t){var e=u.select(this),i=t.head?a[o(t.data,t.dataIndex)]:a[n(t.data,t.dataIndex)];Object.keys(i.attrs).map(function(t){e.attr(t,i.attrs[t])})}).attr("id",function(t){return e(t.data,t.dataIndex,t.head?"head":"tail")}).style("stroke",function(t){return d._convertColor(i)(t.data,t.dataIndex)}).style("fill",function(t){return d._convertColor(i)(t.data,t.dataIndex)}).style("opacity",function(t){return r(t.data,t.dataIndex)}).select("path").attr("d",function(t){return t.head?a[o(t.data,t.dataIndex)].path:a[n(t.data,t.dataIndex)].path}),c.exit().remove()}if(!(this instanceof a))return new a(t);var n=i(234),s=i(129),u=i(132);t=t||{},o.call(this,t),n.call(this);var h=this,l=this._init,c=this._exit,d=this._update,f=s(),m={};return this._init=function(t){return l.call(h,t),h},this._build=function(){function t(){return l/o.scaleFactor()}var i=h.data(),n=h.style.get(),o=h.renderer(),a=h.origin(),s=h.delta(),u=[],l=h.style("scale"),c=Number.NEGATIVE_INFINITY;return d.call(h),i||(i=[]),u=i.map(function(t,e){var i=h.featureGcsToDisplay(a(t,e)),r=s(t,e);return c=Math.max(c,r.x*r.x+r.y*r.y),{x1:i.x,y1:i.y,dx:r.x,dy:-r.y}}),c=Math.sqrt(c),l||(l=75/c),m.id=h._d3id(),m.data=i,m.append="line",m.attributes={x1:function(t,e){return u[e].x1},y1:function(t,e){return u[e].y1},x2:function(e,i){return u[i].x1+t()*u[i].dx},y2:function(e,i){return u[i].y1+t()*u[i].dy},"marker-start":function(t,i){return"url(#"+e(t,i,"tail")+")"},"marker-end":function(t,i){return"url(#"+e(t,i,"head")+")"}},m.style={stroke:function(){return!0},strokeColor:n.strokeColor,strokeWidth:n.strokeWidth,strokeOpacity:n.strokeOpacity,originStyle:n.originStyle,endStyle:n.endStyle},m.classes=["d3VectorFeature"],r(i,n.strokeColor,n.strokeOpacity,n.originStyle,n.endStyle),h.renderer()._drawFeatures(m),f.modified(),h.updateTime().modified(),h},this._update=function(){return d.call(h),h.getMTime()>=f.getMTime()?h._build():r(m.data,m.style.strokeColor,m.style.strokeOpacity,m.style.originStyle,m.style.endStyle),h},this._exit=function(){c.call(h),m={},r([],null,null,null,null)},this._init(t),this};r(a,o),n("d3","vector",a),t.exports=a},function(t,e,i){t.exports={choroplethFeature:i(243),contourFeature:i(244),ellipsoid:i(245),geomFeature:i(246),lineFeature:i(247),planeFeature:i(248),pointFeature:i(249),polygonFeature:i(250),quadFeature:i(252),tileLayer:i(253),vglRenderer:i(254)}},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(126),a=function(t){"use strict";function e(){return i.createChoropleth()}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var i=this,r=null,n=this._exit,s=this._init,u=this._update;return this._init=function(t){s.call(i,t)},this._build=function(){return i.buildTime().modified(),r=e()},this._update=function(){u.call(i),(i.dataTime().getMTime()>=i.buildTime().getMTime()||i.updateTime().getMTime()<=i.getMTime())&&(i._wipePolygons(),i._build()),i.updateTime().modified()},this._wipePolygons=function(){r&&r.map(function(t){return t._exit()}),r=null},this._exit=function(){i._wipePolygons(),n()},this._init(t),this};r(a,o),n("vgl","choropleth",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(134),a=function(t){"use strict";function e(){var t=["#ifdef GL_ES","  precision highp float;","#endif","attribute vec3 pos;","attribute float value;","attribute float opacity;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying float valueVar;","varying float opacityVar;","void main(void)","{","  vec4 scrPos = projectionMatrix * modelViewMatrix * vec4(pos.xy, 0, 1);","  if (scrPos.w != 0.0) {","    scrPos = scrPos / scrPos.w;","  }","  valueVar = value;","  opacityVar = opacity;","  gl_Position = scrPos;","}"].join("\n"),e=new s.shader(s.GL.VERTEX_SHADER);return e.setShaderSource(t),e}function r(){var t=["#ifdef GL_ES","  precision highp float;","#endif","uniform vec4 minColor;","uniform vec4 maxColor;","uniform float steps;","uniform bool stepped;","uniform sampler2D sampler2d;","varying float valueVar;","varying float opacityVar;","void main () {","  vec4 clr;","  if (valueVar < 0.0) {","    clr = minColor;","  } else if (valueVar > steps) {","    clr = maxColor;","  } else {","    float step;","    if (stepped) {","      step = floor(valueVar) + 0.5;","      if (step > steps) {","        step = steps - 0.5;","      }","    } else {","      step = valueVar;","    }","    clr = texture2D(sampler2d, vec2(step / steps, 0.0));","  }","  gl_FragColor = vec4(clr.rgb, clr.a * opacityVar);","}"].join("\n"),e=new s.shader(s.GL.FRAGMENT_SHADER);return e.setShaderSource(t),e}function n(){var t,e,i,r,n,o,a,s,c=l.createContours(),d=c.elements.length,f=[],p=m.geometryData();for(g.set([c.minColor.r,c.minColor.g,c.minColor.b,c.minColor.a]),y.set([c.maxColor.r,c.maxColor.g,c.maxColor.b,c.maxColor.a]),x.set(c.colorMap.length),_.set(c.stepped),t=0;t<c.colorMap.length;t+=1)f.push(255*c.colorMap[t].r),f.push(255*c.colorMap[t].g),f.push(255*c.colorMap[t].b),f.push(255*c.colorMap[t].a);for(v.setColorTable(f),c.pos=u.transformCoordinates(l.gcs(),l.layer().map().gcs(),c.pos,3),n=h.getGeomBuffer(p,"pos",3*d),o=h.getGeomBuffer(p,"opacity",d),a=h.getGeomBuffer(p,"value",d),t=e=0;d>t;t+=1,e+=3)i=c.elements[t],r=3*i,n[e]=c.pos[r],n[e+1]=c.pos[r+1],n[e+2]=c.pos[r+2],o[t]=c.opacity[i],a[t]=c.value[i];s=p.primitive(0).indices(),s instanceof Uint16Array&&s.length===d||(s=new Uint16Array(d),p.primitive(0).setIndices(s)),p.boundsDirty(!0),m.modified(),m.boundsDirtyTimestamp().modified()}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var s=i(6),u=i(147),h=i(120),l=this,c=this._exit,d=7,f=null,m=null,p=null,v=null,g=null,y=null,x=null,_=null,M=void 0===t.dynamicDraw?!1:t.dynamicDraw,b=this._init,w=this._update;return this._init=function(t){var i=s.blend(),n=s.shaderProgram(),o=s.material(),a=s.lookupTable(),u=s.geometryData(),h=new s.modelViewUniform("modelViewMatrix"),c=new s.projectionUniform("projectionMatrix"),w=new s.uniform(s.GL.INT,"sampler2d"),T=e(),A=r(),E=s.vertexAttribute("pos"),P=s.vertexAttribute("value"),R=s.vertexAttribute("opacity"),S=s.sourceDataP3fv({name:"pos"}),C=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.One,{name:"value"}),L=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.Two,{name:"opacity"}),I=new s.triangles;b.call(l,t),m=s.mapper({dynamicDraw:M}),n.addVertexAttribute(E,s.vertexAttributeKeys.Position),n.addVertexAttribute(P,s.vertexAttributeKeysIndexed.One),n.addVertexAttribute(R,s.vertexAttributeKeysIndexed.Two),n.addUniform(h),n.addUniform(c),g=new s.uniform(s.GL.FLOAT_VEC4,"minColor"),n.addUniform(g),y=new s.uniform(s.GL.FLOAT_VEC4,"maxColor"),n.addUniform(y),x=new s.uniform(s.GL.FLOAT,"steps"),n.addUniform(x),_=new s.uniform(s.GL.BOOL,"stepped"),n.addUniform(_),n.addShader(A),n.addShader(T),n.addUniform(w),a.setTextureUnit(d),w.set(d),p=o,p.addAttribute(n),p.addAttribute(i),v=a,p.addAttribute(v),f=s.actor(),f.setMaterial(p),f.setMapper(m),u.addSource(S),u.addSource(C),u.addSource(L),u.addPrimitive(I),m.setGeometryData(u)},this._build=function(){f&&l.renderer().contextRenderer().removeActor(f),n(),l.renderer().contextRenderer().addActor(f),l.buildTime().modified()},this._update=function(){w.call(l),(l.dataTime().getMTime()>=l.buildTime().getMTime()||l.updateTime().getMTime()<=l.getMTime())&&l._build(),
f.setVisible(l.visible()),f.material().setBinNumber(l.bin()),l.updateTime().modified()},this._exit=function(){l.renderer().contextRenderer().removeActor(f),c()},this._init(t),this};r(a,o),n("vgl","contour",a),t.exports=a},function(t,e,i){var r=function(t,e,n){"use strict";if(!(this instanceof r))return new r(t,e,n);var o=i(6),a=i(120),s=i(58);if(t=o.defaultValue(t,0),e=o.defaultValue(e,0),n=o.defaultValue(n,0),0>t||0>e||0>n)return console.log("[error] Al radii components must be greater than zero");var u=this,h=[t,e,n],l=[t*t,e*e,n*n],c=Math.min(t,e,n),d=Math.max(t,e,n);return this.radii=function(){return h},this.radiiSquared=function(){return l},this.maximumRadius=function(){return d},this.minimumRadius=function(){return c},this.computeGeodeticSurfaceNormal=function(t,e){if("undefined"==typeof t||"undefined"==typeof e)throw"[error] Valid latitude and longitude is required";var i=Math.cos(t),r=a.vec3AsArray();return r[0]=i*Math.cos(e),r[1]=i*Math.sin(e),r[2]=Math.sin(t),s.normalize(r,r),r},this.transformPoint=function(t,e,i){t*=Math.PI/180,e*=Math.PI/180;var r=u.computeGeodeticSurfaceNormal(t,e),n=a.vec3AsArray(),o=Math.sqrt(s.dot(r,n)),h=a.vec3AsArray();return s.multiply(n,l,r),s.scale(n,n,1/o),s.scale(r,r,i),s.add(h,r,n),h},this.transformGeometry=function(t){if(!t)throw"[error] Failed to transform to cartesian. Invalid geometry.";var e=t.sourceData(o.vertexAttributeKeys.Position),i=e.data(),r=e.attributeNumberOfComponents(o.vertexAttributeKeys.Position),n=e.attributeStride(o.vertexAttributeKeys.Position),h=e.attributeOffset(o.vertexAttributeKeys.Position),c=e.sizeOfAttributeDataType(o.vertexAttributeKeys.Position),d=null,f=i.length*(1/r),m=null,p=null,v=0,g=a.vec3AsArray(),y=a.vec3AsArray();if(n/=c,h/=c,3!==r)throw"[error] Requires positions with three components";for(v=0;f>v;v+=1)d=v*n+h,i[d]=i[d]*(Math.PI/180),i[d+1]=i[d+1]*(Math.PI/180),p=u.computeGeodeticSurfaceNormal(i[d+1],i[d]),s.multiply(g,l,p),m=Math.sqrt(s.dot(p,g)),s.scale(g,g,1/m),s.scale(p,p,i[d+2]),s.add(y,p,g),i[d]=y[0],i[d+1]=y[1],i[d+2]=y[2]},u};t.exports=r},function(t,e,i){var r=i(4),n=i(140),o=function(t){"use strict";if(!(this instanceof o))return new o(t);var e=i(6);t=t||{},n.call(this,t);var r=this,a=t.geom||null,s=e.actor(),u=e.mapper(),h=null,l=null,c=t.color||[1,1,1],d=null,f=0;return this._build=function(){var t=r.style();null!==a&&(l=a.sourceData(e.vertexAttributeKeys.Scalar),c=a.sourceData(e.vertexAttributeKeys.Color),u.setGeometryData(a)),r.setMapper(u),void 0!==t.point_sprites&&t.point_sprites&&void 0!==t.point_sprites_image&&null!==t.point_sprites_image&&1===f&&a.primitive(0).primitiveType()===e.GL.POINTS?h=e.utils.createPointSpritesMaterial(t.point_sprites_image):l?c instanceof e.lookupTable?(c.updateRange(l.scalarRange()),h=e.utils.createColorMappedMaterial(c)):(c=e.lookupTable(),c.updateRange(l.scalarRange()),h=e.utils.createColorMappedMaterial(c)):h=c?e.utils.createColorMaterial():e.utils.createSolidColorMaterial(),s.setMaterial(h)},this._update=function(){d&&d.getMTime()<r.getMTime()?c instanceof e.lookupTable&&e.utils.updateColorMappedMaterial(r.material(),r.style.color):(d=e.timestamp(),d.modified())},this.geometry=function(t){return void 0===t?a:(a=t,r.modified(),r)},this};r(o,n),t.exports=o},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(145),a=function(t){"use strict";function e(){var t=["#ifdef GL_ES","  precision highp float;","#endif","attribute vec3 pos;","attribute vec3 prev;","attribute vec3 next;","attribute float offset;","attribute vec3 strokeColor;","attribute float strokeOpacity;","attribute float strokeWidth;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float pixelWidth;","uniform float aspect;","varying vec3 strokeColorVar;","varying float strokeWidthVar;","varying float strokeOpacityVar;","void main(void)","{","  if (strokeOpacity < 0.0) {","    gl_Position = vec4(2, 2, 0, 1);","    return;","  }","  const float PI = 3.14159265358979323846264;","  vec4 worldPos = projectionMatrix * modelViewMatrix * vec4(pos.xyz, 1);","  if (worldPos.w != 0.0) {","    worldPos = worldPos/worldPos.w;","  }","  vec4 worldNext = projectionMatrix * modelViewMatrix * vec4(next.xyz, 1);","  if (worldNext.w != 0.0) {","    worldNext = worldNext/worldNext.w;","  }","  vec4 worldPrev = projectionMatrix* modelViewMatrix * vec4(prev.xyz, 1);","  if (worldPrev.w != 0.0) {","    worldPrev = worldPrev/worldPrev.w;","  }","  strokeColorVar = strokeColor;","  strokeWidthVar = strokeWidth;","  strokeOpacityVar = strokeOpacity;","  vec2 deltaNext = worldNext.xy - worldPos.xy;","  vec2 deltaPrev = worldPos.xy - worldPrev.xy;","  float angleNext = 0.0, anglePrev = 0.0;","  if (deltaNext.xy != vec2(0.0, 0.0))","    angleNext = atan(deltaNext.y / aspect, deltaNext.x);","  if (deltaPrev.xy == vec2(0.0, 0.0)) anglePrev = angleNext;","  else  anglePrev = atan(deltaPrev.y / aspect, deltaPrev.x);","  if (deltaNext.xy == vec2(0.0, 0.0)) angleNext = anglePrev;","  float angle = (anglePrev + angleNext) / 2.0;","  float cosAngle = cos(anglePrev - angle);","  if (cosAngle < 0.1) { cosAngle = sign(cosAngle) * 1.0; angle = 0.0; }","  float distance = (offset * strokeWidth * pixelWidth) /","                    cosAngle;","  worldPos.x += distance * sin(angle);","  worldPos.y -= distance * cos(angle) * aspect;","  gl_Position = worldPos;","}"].join("\n"),e=new s.shader(s.GL.VERTEX_SHADER);return e.setShaderSource(t),e}function r(){var t=["#ifdef GL_ES","  precision highp float;","#endif","varying vec3 strokeColorVar;","varying float strokeWidthVar;","varying float strokeOpacityVar;","void main () {","  gl_FragColor = vec4 (strokeColorVar, strokeOpacityVar);","}"].join("\n"),e=new s.shader(s.GL.FRAGMENT_SHADER);return e.setShaderSource(t),e}function n(){var t,e,i,r,n,o,a,s,c,d,m,p,v,g,y,x,_,M,b,w,T=l.data(),A=0,E=[{},{}],P=[],R=l.position(),S=l.style.get("strokeWidth"),C=l.style.get("strokeColor"),L=l.style.get("strokeOpacity"),I=l.featureVertices(),O=f.geometryData();for(t=0;t<T.length;t+=1)for(o=l.line()(T[t],t),A+=o.length-1,e=0;e<o.length;e+=1)c=R(o[e],e,o,t),P.push(c.x),P.push(c.y),P.push(c.z||0);for(P=u.transformCoordinates(l.gcs(),l.layer().map().gcs(),P,3),n=A*I.length,m=h.getGeomBuffer(O,"pos",3*n),p=h.getGeomBuffer(O,"next",3*n),v=h.getGeomBuffer(O,"prev",3*n),g=h.getGeomBuffer(O,"offset",n),x=h.getGeomBuffer(O,"strokeWidth",n),_=h.getGeomBuffer(O,"strokeColor",3*n),M=h.getGeomBuffer(O,"strokeOpacity",n),y=O.primitive(0).indices(),y instanceof Uint16Array&&y.length===n||(y=new Uint16Array(n),O.primitive(0).setIndices(y)),t=d=b=w=0;t<T.length;t+=1)for(o=l.line()(T[t],t),e=0;e<o.length;e+=1,d+=3)if(a=o[e],e&&(s=E[0],E[0]=E[1],E[1]=s),E[1].pos=d,E[1].prev=d-(e?3:0),E[1].next=d+(e+1<o.length?3:0),E[1].strokeWidth=S(a,e,o,t),E[1].strokeColor=C(a,e,o,t),E[1].strokeOpacity=L(a,e,o,t),e)for(i=0;i<I.length;i+=1,b+=1,w+=3)r=E[I[i][0]],m[w]=P[r.pos],m[w+1]=P[r.pos+1],m[w+2]=P[r.pos+2],v[w]=P[r.prev],v[w+1]=P[r.prev+1],v[w+2]=P[r.prev+2],p[w]=P[r.next],p[w+1]=P[r.next+1],p[w+2]=P[r.next+2],g[b]=I[i][1],x[b]=r.strokeWidth,_[w]=r.strokeColor.r,_[w+1]=r.strokeColor.g,_[w+2]=r.strokeColor.b,M[b]=r.strokeOpacity;O.boundsDirty(!0),f.modified(),f.boundsDirtyTimestamp().modified()}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var s=i(6),u=i(147),h=i(120),l=this,c=this._exit,d=null,f=null,m=null,p=null,v=null,g=void 0===t.dynamicDraw?!1:t.dynamicDraw,y=this._init,x=this._update;return this.featureVertices=function(){return[[0,1],[1,-1],[0,-1],[0,1],[1,1],[1,-1]]},this.verticesPerFeature=function(){return l.featureVertices().length},this._init=function(t){var i=s.shaderProgram(),n=e(),o=r(),a=s.vertexAttribute("pos"),u=s.vertexAttribute("prev"),h=s.vertexAttribute("next"),c=s.vertexAttribute("offset"),x=s.vertexAttribute("strokeWidth"),_=s.vertexAttribute("strokeColor"),M=s.vertexAttribute("strokeOpacity"),b=new s.modelViewUniform("modelViewMatrix"),w=new s.projectionUniform("projectionMatrix"),T=s.geometryData(),A=s.sourceDataP3fv({name:"pos"}),E=s.sourceDataAnyfv(3,s.vertexAttributeKeysIndexed.Four,{name:"prev"}),P=s.sourceDataAnyfv(3,s.vertexAttributeKeysIndexed.Five,{name:"next"}),R=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.Six,{name:"offset"}),S=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.One,{name:"strokeWidth"}),C=s.sourceDataAnyfv(3,s.vertexAttributeKeysIndexed.Two,{name:"strokeColor"}),L=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.Three,{name:"strokeOpacity"}),I=s.triangles();p=new s.floatUniform("pixelWidth",1/l.renderer().width()),v=new s.floatUniform("aspect",l.renderer().width()/l.renderer().height()),y.call(l,t),m=s.material(),f=s.mapper({dynamicDraw:g}),i.addVertexAttribute(a,s.vertexAttributeKeys.Position),i.addVertexAttribute(x,s.vertexAttributeKeysIndexed.One),i.addVertexAttribute(_,s.vertexAttributeKeysIndexed.Two),i.addVertexAttribute(M,s.vertexAttributeKeysIndexed.Three),i.addVertexAttribute(u,s.vertexAttributeKeysIndexed.Four),i.addVertexAttribute(h,s.vertexAttributeKeysIndexed.Five),i.addVertexAttribute(c,s.vertexAttributeKeysIndexed.Six),i.addUniform(b),i.addUniform(w),i.addUniform(p),i.addUniform(v),i.addShader(o),i.addShader(n),m.addAttribute(i),m.addAttribute(s.blend()),d=s.actor(),d.setMaterial(m),d.setMapper(f),T.addSource(A),T.addSource(E),T.addSource(P),T.addSource(S),T.addSource(C),T.addSource(L),T.addSource(R),T.addPrimitive(I),f.setGeometryData(T)},this.actors=function(){return d?[d]:[]},this._build=function(){d&&l.renderer().contextRenderer().removeActor(d),n(),l.renderer().contextRenderer().addActor(d),l.buildTime().modified()},this._update=function(){x.call(l),(l.dataTime().getMTime()>=l.buildTime().getMTime()||l.updateTime().getMTime()<=l.getMTime())&&l._build(),p.set(1/l.renderer().width()),v.set(l.renderer().width()/l.renderer().height()),d.setVisible(l.visible()),d.material().setBinNumber(l.bin()),l.updateTime().modified()},this._exit=function(){l.renderer().contextRenderer().removeActor(d),c()},this._init(t),this};r(a,o),n("vgl","line",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(223),a=function(t){"use strict";if(!(this instanceof a))return new a(t);o.call(this,t);var e=i(147),r=i(6),n=this,s=this._exit,u=null,h=void 0===t.onload?null:t.onload;return this.coords=function(){return[n.origin(),n.upperLeft(),n.lowerRight()]},this._build=function(){var t=n.origin(),i=n.upperLeft(),o=n.lowerRight(),a=n.style().image,s=null,l=null,c=n.gcs(),d=n.layer().map().gcs();c!==d&&(t=e.transformCoordinates(c,d,t),i=e.transformCoordinates(c,d,i),o=e.transformCoordinates(c,d,o)),n.buildTime().modified(),u&&n.renderer().contextRenderer().removeActor(u),a&&a instanceof Image?s=a:a&&(s=new Image,s.src=a),s?(u=r.utils.createTexturePlane(t[0],t[1],t[2],o[0],o[1],o[2],i[0],i[1],i[2],!0),u.material().shaderProgram().uniform("opacity").set(void 0!==n.style().opacity?n.style().opacity:1),l=r.texture(),n.visible(!1),n.renderer().contextRenderer().addActor(u),s.complete&&s.naturalWidth&&s.naturalHeight?(l.setImage(s),u.material().addAttribute(l),n.visible(!0),h&&h.call(n)):s.onload=function(){l.setImage(s),u.material().addAttribute(l),n.visible(!0),h&&h.call(n),n.drawOnAsyncResourceLoad()&&(n._update(),n.layer().draw())}):(u=r.utils.createPlane(t[0],t[1],t[2],i[0],i[1],i[2],o[0],o[1],o[2]),u.material().shaderProgram().uniform("opacity").set(void 0!==n.style().opacity?n.style().opacity:1),n.renderer().contextRenderer().addActor(u))},this._update=function(){n.buildTime().getMTime()<=n.dataTime().getMTime()&&n._build(),n.updateTime().getMTime()<=n.getMTime()&&(u.setVisible(n.visible()),u.material().setBinNumber(n.bin()),u.material().shaderProgram().uniform("opacity").set(void 0!==n.style().opacity?n.style().opacity:1)),n.updateTime().modified()},this._exit=function(){n.renderer().contextRenderer().removeActor(u),s()},this};r(a,o),n("vgl","plane",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(225),a=function(t){"use strict";function e(){var t=new u.shader(u.GL.VERTEX_SHADER);return t.setShaderSource(M),t}function r(){var t=new u.shader(u.GL.FRAGMENT_SHADER);return t.setShaderSource(b),t}function n(t,e,i,r){var n;switch(y){case"triangle":n=[t,e-2*r,t-i*Math.sqrt(3),e+r,t+i*Math.sqrt(3),e+r];break;case"sprite":n=[t,e];break;default:n=[t-i,e+r,t-i,e-r,t+i,e+r,t-i,e-r,t+i,e-r,t+i,e+r]}return n}function s(){var t,e,i,r,o,a,s,u,d,f,p,v,g,x,_,M,b,w,T,A,E,P,R,S,C,L,I,O,D,F,N,k,z,G,U,V,B,j=c.data().length,q=n(0,0,1,1),W=new Array(3*j),X=c.verticesPerFeature(),H=c.data(),K=m.geometryData();for(o=c.position(),f=c.style.get("radius"),g=c.style.get("stroke"),M=c.style.get("strokeWidth"),T=c.style.get("strokeOpacity"),P=c.style.get("strokeColor"),C=c.style.get("fill"),O=c.style.get("fillOpacity"),N=c.style.get("fillColor"),t=V=0;j>t;t+=1,V+=3)r=o(H[t]),W[V]=r.x,W[V+1]=r.y,W[V+2]=r.z||0,B=B||W[V+2];if(W=h.transformCoordinates(c.gcs(),c.layer().map().gcs(),W,3),!B&&c.gcs()!==c.layer().map().gcs())for(t=V=0;j>t;t+=1,V+=3)W[V+2]=0;for(i=l.getGeomBuffer(K,"pos",X*j*3),"sprite"!==y&&(a=l.getGeomBuffer(K,"unit",X*j*2)),u=l.getGeomBuffer(K,"rad",X*j),p=l.getGeomBuffer(K,"stroke",X*j),x=l.getGeomBuffer(K,"strokeWidth",X*j),b=l.getGeomBuffer(K,"strokeOpacity",X*j),A=l.getGeomBuffer(K,"strokeColor",X*j*3),R=l.getGeomBuffer(K,"fill",X*j),L=l.getGeomBuffer(K,"fillOpacity",X*j),D=l.getGeomBuffer(K,"fillColor",X*j*3),s=K.primitive(0).indices(),s instanceof Uint16Array&&s.length===X*j||(s=new Uint16Array(X*j),K.primitive(0).setIndices(s)),t=z=G=U=V=0;j>t;t+=1,V+=3){if(k=H[t],"sprite"!==y)for(e=0;e<q.length;e+=1,U+=1)a[U]=q[e];for(d=f(k),v=g(k)?1:0,_=M(k),w=T(k),E=P(k),S=C(k)?1:0,I=O(k),F=N(k),e=0;X>e;e+=1,z+=1,G+=3)i[G]=W[V],i[G+1]=W[V+1],i[G+2]=W[V+2],u[z]=d,p[z]=v,x[z]=_,b[z]=w,A[G]=E.r,A[G+1]=E.g,A[G+2]=E.b,R[z]=S,L[z]=I,D[G]=F.r,D[G+1]=F.g,D[G+2]=F.b}K.boundsDirty(!0),m.modified(),m.boundsDirtyTimestamp().modified()}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var u=i(6),h=i(147),l=i(120),c=this,d=this._exit,f=null,m=null,p=null,v=null,g=void 0===t.dynamicDraw?!1:t.dynamicDraw,y="sprite",x=this._init,_=this._update,M=null,b=null;return("triangle"===t.primitiveShape||"square"===t.primitiveShape||"sprite"===t.primitiveShape)&&(y=t.primitiveShape),M=["#ifdef GL_ES","  precision highp float;","#endif","attribute vec3 pos;","attribute float rad;","attribute vec3 fillColor;","attribute vec3 strokeColor;","attribute float fillOpacity;","attribute float strokeWidth;","attribute float strokeOpacity;","attribute float fill;","attribute float stroke;","uniform float pixelWidth;","uniform float aspect;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying float radiusVar;","varying float strokeWidthVar;","varying float fillVar;","varying float strokeVar;"],"sprite"!==y&&(M=M.concat(["attribute vec2 unit;","varying vec3 unitVar;"])),M.push.apply(M,["void main(void)","{","  strokeWidthVar = strokeWidth;","  // No stroke or fill implies nothing to draw","  if (stroke < 1.0 || strokeWidth <= 0.0 || strokeOpacity <= 0.0) {","    strokeVar = 0.0;","    strokeWidthVar = 0.0;","  }","  else","    strokeVar = 1.0;","  if (fill < 1.0 || rad <= 0.0 || fillOpacity <= 0.0)","    fillVar = 0.0;","  else","    fillVar = 1.0;","  if (fillVar == 0.0 && strokeVar == 0.0) {","    gl_Position = vec4(2, 2, 0, 1);","    return;","  }","  fillColorVar = vec4 (fillColor, fillOpacity);","  strokeColorVar = vec4 (strokeColor, strokeOpacity);","  radiusVar = rad;"]),"sprite"===y?M.push.apply(M,["  gl_Position = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;","  gl_PointSize = 2.0 * (rad + strokeWidthVar); ","}"]):M.push.apply(M,["  unitVar = vec3 (unit, 1.0);","  vec4 p = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;","  if (p.w != 0.0) {","    p = p / p.w;","  }","  p += (rad + strokeWidthVar) * ","       vec4 (unit.x * pixelWidth, unit.y * pixelWidth * aspect, 0.0, 1.0);","  gl_Position = vec4(p.xyz, 1.0);","}"]),M=M.join("\n"),b=["#ifdef GL_ES","  precision highp float;","#endif","uniform float aspect;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying float radiusVar;","varying float strokeWidthVar;","varying float fillVar;","varying float strokeVar;"],"sprite"!==y&&b.push("varying vec3 unitVar;"),b.push.apply(b,["void main () {","  vec4 strokeColor, fillColor;","  float endStep;","  // No stroke or fill implies nothing to draw","  if (fillVar == 0.0 && strokeVar == 0.0)","    discard;"]),"sprite"===y?b.push("  float rad = 2.0 * length (gl_PointCoord - vec2(0.5));"):b.push("  float rad = length (unitVar.xy);"),b.push.apply(b,["  if (rad > 1.0)","    discard;","  // If there is no stroke, the fill region should transition to nothing","  if (strokeVar == 0.0) {","    strokeColor = vec4 (fillColorVar.rgb, 0.0);","    endStep = 1.0;","  } else {","    strokeColor = strokeColorVar;","    endStep = radiusVar / (radiusVar + strokeWidthVar);","  }","  // Likewise, if there is no fill, the stroke should transition to nothing","  if (fillVar == 0.0)","    fillColor = vec4 (strokeColor.rgb, 0.0);","  else","    fillColor = fillColorVar;","  // Distance to antialias over","  float antialiasDist = 3.0 / (2.0 * radiusVar);","  if (rad < endStep) {","    float step = smoothstep (endStep - antialiasDist, endStep, rad);","    gl_FragColor = mix (fillColor, strokeColor, step);","  } else {","    float step = smoothstep (1.0 - antialiasDist, 1.0, rad);","    gl_FragColor = mix (strokeColor, vec4 (strokeColor.rgb, 0.0), step);","  }","}"]),b=b.join("\n"),this.actors=function(){return f?[f]:[]},this.verticesPerFeature=function(){var t=n(0,0,1,1);return t.length/2},this._init=function(){var i=u.shaderProgram(),n=e(),o=r(),a=u.vertexAttribute("pos"),s=u.vertexAttribute("unit"),h=u.vertexAttribute("rad"),l=u.vertexAttribute("strokeWidth"),d=u.vertexAttribute("fillColor"),_=u.vertexAttribute("fill"),M=u.vertexAttribute("strokeColor"),b=u.vertexAttribute("stroke"),w=u.vertexAttribute("fillOpacity"),T=u.vertexAttribute("strokeOpacity"),A=new u.modelViewUniform("modelViewMatrix"),E=new u.projectionUniform("projectionMatrix"),P=u.material(),R=u.blend(),S=u.geometryData(),C=u.sourceDataP3fv({name:"pos"}),L=u.sourceDataAnyfv(2,u.vertexAttributeKeysIndexed.One,{name:"unit"}),I=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Two,{name:"rad"}),O=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Three,{name:"strokeWidth"}),D=u.sourceDataAnyfv(3,u.vertexAttributeKeysIndexed.Four,{name:"fillColor"}),F=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Five,{name:"fill"}),N=u.sourceDataAnyfv(3,u.vertexAttributeKeysIndexed.Six,{name:"strokeColor"}),k=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Seven,{name:"stroke"}),z=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Eight,{name:"fillOpacity"}),G=u.sourceDataAnyfv(1,u.vertexAttributeKeysIndexed.Nine,{name:"strokeOpacity"}),U=new u.triangles;"sprite"===y&&(U=new u.points),p=new u.floatUniform("pixelWidth",2/c.renderer().width()),v=new u.floatUniform("aspect",c.renderer().width()/c.renderer().height()),x.call(c,t),m=u.mapper({dynamicDraw:g}),i.addVertexAttribute(a,u.vertexAttributeKeys.Position),"sprite"!==y&&i.addVertexAttribute(s,u.vertexAttributeKeysIndexed.One),i.addVertexAttribute(h,u.vertexAttributeKeysIndexed.Two),i.addVertexAttribute(l,u.vertexAttributeKeysIndexed.Three),i.addVertexAttribute(d,u.vertexAttributeKeysIndexed.Four),i.addVertexAttribute(_,u.vertexAttributeKeysIndexed.Five),i.addVertexAttribute(M,u.vertexAttributeKeysIndexed.Six),i.addVertexAttribute(b,u.vertexAttributeKeysIndexed.Seven),i.addVertexAttribute(w,u.vertexAttributeKeysIndexed.Eight),i.addVertexAttribute(T,u.vertexAttributeKeysIndexed.Nine),i.addUniform(p),i.addUniform(v),i.addUniform(A),i.addUniform(E),i.addShader(o),i.addShader(n),P.addAttribute(i),P.addAttribute(R),f=u.actor(),f.setMaterial(P),f.setMapper(m),S.addSource(C),S.addSource(L),S.addSource(I),S.addSource(O),S.addSource(D),S.addSource(F),S.addSource(N),S.addSource(k),S.addSource(z),S.addSource(G),S.addPrimitive(U),m.setGeometryData(S)},this._build=function(){f&&c.renderer().contextRenderer().removeActor(f),s(),c.renderer().contextRenderer().addActor(f),c.renderer().contextRenderer().render(),c.buildTime().modified()},this._update=function(){_.call(c),(c.dataTime().getMTime()>=c.buildTime().getMTime()||c.updateTime().getMTime()<c.getMTime())&&c._build(),p.set(2/c.renderer().width()),v.set(c.renderer().width()/c.renderer().height()),f.setVisible(c.visible()),f.material().setBinNumber(c.bin()),c.updateTime().modified()},this._exit=function(){c.renderer().contextRenderer().removeActor(f),d()},c._init(),this};r(a,o),n("vgl","point",a),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(224),a=function(t){"use strict";function e(){var t=["attribute vec3 pos;","attribute vec3 fillColor;","attribute float fillOpacity;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float pixelWidth;","varying vec3 fillColorVar;","varying float fillOpacityVar;","void main(void)","{","  vec4 clipPos = projectionMatrix * modelViewMatrix * vec4(pos.xyz, 1);","  if (clipPos.w != 0.0) {","    clipPos = clipPos/clipPos.w;","  }","  fillColorVar = fillColor;","  fillOpacityVar = fillOpacity;","  gl_Position = clipPos;","}"].join("\n"),e=new s.shader(s.GL.VERTEX_SHADER);return e.setShaderSource(t),e}function r(){var t=["#ifdef GL_ES","  precision highp float;","#endif","varying vec3 fillColorVar;","varying float fillOpacityVar;","void main () {","  gl_FragColor = vec4 (fillColorVar, fillOpacityVar);","}"].join("\n"),e=new s.shader(s.GL.FRAGMENT_SHADER);return e.setShaderSource(t),e}function n(){var t=null,e=null,i=null,r=0,n=0,o=[],a=[],c=[],d=[],m=[],p=null,v=null,g=null,y=null,x=s.DataBuffers(1024),_=s.sourceDataP3fv(),M=s.sourceDataAnyfv(3,s.vertexAttributeKeysIndexed.Two),b=s.sourceDataAnyfv(1,s.vertexAttributeKeysIndexed.Three),w=s.triangles(),T=s.geometryData(),A=null,E=null,P=null,R=0,S=null,C=0,L=null,I=new u,O=null,D=null,F=null;for(p=l.position(),v=l.style.get("fillColor"),y=l.style.get("fillOpacity"),l.data().forEach(function(e){for(A=l.polygon()(e,r),g=A.outer||[],E=A.inner||[],n=0,P=[],R=0,S=g.length-1,P[0]=[],C=0,g.forEach(function(t){R!==S&&(L=p(t,n,e,r),P[0].push({x:L.x,y:L.y,i:a.length}),F=v(t,n,e,r),a.push([F.r,F.g,F.b]),c.push(y(t,n,e,r)),n+=1),R+=1}),n=0,E.forEach(function(t){P[C+1]=[],t.forEach(function(t){L=p(t,n,e,r),P[C+1].push({x:L.x,y:L.y,i:a.length}),F=v(t,n,e,r),a.push([F.r,F.g,F.b]),c.push(y(t,n,e,r)),n+=1}),C+=1}),O=I.triangulate_polygon(P),D=[],O.forEach(function(t){Array.prototype.push.apply(D,t)}),t=1;t<P.length;t+=1)P[0]=P[0].concat(P[t]);D.forEach(function(t){var e=P[0][t];o.push([e.x,e.y,e.z||0]),d.push(a[e.i]),m.push(c[e.i])}),r+=1}),o=h.transformCoordinates(l.gcs(),l.layer().map().gcs(),o,3),x.create("pos",3),x.create("indices",1),x.create("fillColor",3),x.create("fillOpacity",1),e=o.length,i=x.alloc(e),t=0;e>t;t+=1)x.write("pos",o[t],i+t,1),x.write("indices",[t],i+t,1),x.write("fillColor",d[t],i+t,1),x.write("fillOpacity",[m[t]],i+t,1);_.pushBack(x.get("pos")),T.addSource(_),M.pushBack(x.get("fillColor")),T.addSource(M),b.pushBack(x.get("fillOpacity")),T.addSource(b),w.setIndices(x.get("indices")),T.addPrimitive(w),f.setGeometryData(T)}if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var s=i(6),u=i(251).Triangulator,h=i(147),l=this,c=this._exit,d=s.actor(),f=s.mapper(),m=s.material(),p=this._init,v=this._update;return this._init=function(t){var i=s.blend(),n=s.shaderProgram(),o=s.vertexAttribute("pos"),a=s.vertexAttribute("fillColor"),u=s.vertexAttribute("fillOpacity"),h=new s.modelViewUniform("modelViewMatrix"),c=new s.projectionUniform("projectionMatrix"),v=e(),g=r();p.call(l,t),n.addVertexAttribute(o,s.vertexAttributeKeys.Position),n.addVertexAttribute(a,s.vertexAttributeKeysIndexed.Two),n.addVertexAttribute(u,s.vertexAttributeKeysIndexed.Three),n.addUniform(h),n.addUniform(c),n.addShader(g),n.addShader(v),m.addAttribute(n),m.addAttribute(i),d.setMapper(f),d.setMaterial(m)},this._build=function(){d&&l.renderer().contextRenderer().removeActor(d),n(),l.renderer().contextRenderer().addActor(d),l.buildTime().modified()},this._update=function(){v.call(l),(l.dataTime().getMTime()>=l.buildTime().getMTime()||l.updateTime().getMTime()<=l.getMTime())&&l._build(),d.setVisible(l.visible()),d.material().setBinNumber(l.bin()),l.updateTime().modified()},this._exit=function(){l.renderer().contextRenderer().removeActor(d),c()},this._init(t),this};r(a,o),n("vgl","polygon",a),t.exports=a},function(t,e,i){var r={REVISION:"2.1.1"};r.Math={random:Math.random,array_shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(r.Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},compare_pts_yx:function(t,e){var i=t.y-e.y;if(i<r.Math.EPSILON_N)return-1;if(i>r.Math.EPSILON_P)return 1;var n=t.x-e.x;return n<r.Math.EPSILON_N?-1:n>r.Math.EPSILON_P?1:0},ptsCrossProd:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)}},r.Math.EPSILON_P=Math.pow(2,-43),r.Math.EPSILON_N=-r.Math.EPSILON_P,r.PolygonData=function(t){if(this.vertices=[],this.segments=[],this.diagonals=[],this.idNextPolyChain=0,this.PolyLeftArr=[],this.monoSubPolyChains=[],this.triangles=[],t)for(var e=0,i=t.length;i>e;e++)this.addPolygonChain(t[e])},r.PolygonData.prototype={constructor:r.PolygonData,nbVertices:function(){return this.vertices.length},getSegments:function(){return this.segments},getFirstSegment:function(){return this.segments[0]},getMonoSubPolys:function(){return this.monoSubPolyChains},getTriangles:function(){return this.triangles.concat()},nbPolyChains:function(){return this.idNextPolyChain},get_PolyLeftArr:function(){return this.PolyLeftArr.concat()},set_PolyLeft_wrong:function(t){this.PolyLeftArr[t]=!1},isClockWise:function(t){var e=t,i=0;do i+=(e.vFrom.x-e.vTo.x)*(e.vFrom.y+e.vTo.y),e=e.snext;while(e!=t);return 0>i},appendVertexEntry:function(t,e){var i={id:this.vertices.length,x:t,y:e};return this.vertices.push(i),i},createSegmentEntry:function(t,e){return{chainId:this.idNextPolyChain,vFrom:t,vTo:e,upward:1==r.Math.compare_pts_yx(e,t),sprev:null,snext:null,rootFrom:null,rootTo:null,is_inserted:!1,trLeft:null,trRight:null,mprev:null,mnext:null,marked:!1}},appendSegmentEntry:function(t){return this.segments.push(t),t},appendDiagonalsEntry:function(t){return this.diagonals.push(t),t},addVertexChain:function(t){function e(t,e){return Math.abs(t.x-e.x)<r.Math.EPSILON_P&&Math.abs(t.y-e.y)<r.Math.EPSILON_P}function i(t,e,i){if(Math.abs(r.Math.ptsCrossProd(e,t,i))>r.Math.EPSILON_P)return!1;var n,o,a;return Math.abs(t.y-e.y)<r.Math.EPSILON_P?(o=e.x,t.x<i.x?(n=t.x,a=i.x):(n=i.x,a=t.x)):(o=e.y,t.y<i.y?(n=t.y,a=i.y):(n=i.y,a=t.y)),n-o<r.Math.EPSILON_P&&o-a<r.Math.EPSILON_P}for(var n,o,a,s=[],u=0;u<t.length;u++)n=this.appendVertexEntry(t[u].x,t[u].y),o=!0,a=s.length-1,a>=0&&(e(n,s[a])?o=!1:a>0&&i(s[a-1],s[a],n)&&s.pop()),o&&s.push(n);return a=s.length-1,a>0&&e(s[a],s[0])&&(s.pop(),a--),a>1&&(i(s[a-1],s[a],s[0])&&(s.pop(),a--),a>1&&i(s[a],s[0],s[1])&&s.shift()),s},addPolygonChain:function(t){var e=this.addVertexChain(t);if(e.length<3)return console.log("Polygon has < 3 vertices!",e),0;for(var i,r,n,o=this.segments.length,a=0;a<e.length-1;a++)i=this.createSegmentEntry(e[a],e[a+1]),n?(i.sprev=n,n.snext=i):r=i,n=i,this.appendSegmentEntry(i);return i=this.createSegmentEntry(e[e.length-1],e[0]),i.sprev=n,n.snext=i,this.appendSegmentEntry(i),r.sprev=i,i.snext=r,this.PolyLeftArr[this.idNextPolyChain++]=!0,this.segments.length-o},create_mono_chains:function(){for(var t,e,i,r,n=0,o=this.segments.length;o>n;n++)t=this.segments[n],this.PolyLeftArr[t.chainId]?(e=t.vTo,t.mprev=t.sprev,t.mnext=t.snext):(e=t.vFrom,t=t.snext,t.mprev=t.snext,t.mnext=t.sprev),(r=t.vFrom.lastInDiag)&&(r.mnext=t,t.mprev=r,t.vFrom.lastInDiag=null),(i=e.firstOutDiag)&&(i.mprev=t,t.mnext=i,e.firstOutDiag=null)},unique_monotone_chains_max:function(){function t(t){var e,i,n,o=t;for(i=n=t.vFrom,t.marked=!0,t=t.mnext;e=t.vFrom;){if(t.marked){if(e==i)break;return console.log("ERR unique_monotone: segment in two chains",i,t),null}t.marked=!0,1==r.Math.compare_pts_yx(e,n)&&(n=e,o=t),t=t.mnext}return o}var e,i;this.monoSubPolyChains=[];for(var n=0,o=this.segments.length;o>n;n++)e=this.segments[n],e.marked||(i=t(e),i&&this.monoSubPolyChains.push(i));return this.monoSubPolyChains},clearTriangles:function(){this.triangles=[]},addTriangle:function(t,e,i){this.triangles.push([t.id,e.id,i.id])}},r.EarClipTriangulator=function(t){this.polyData=t},r.EarClipTriangulator.prototype={constructor:r.EarClipTriangulator,triangulate_polygon_no_holes:function(){function t(t){var e=t.mprev.vFrom.x,i=t.mprev.vFrom.y,n=t.vFrom.x,o=t.vFrom.y,a=t.mnext.vFrom.x,s=t.mnext.vFrom.y,u=a-n,h=s-o,l=e-a,c=i-s,d=n-e,f=o-i;if(r.Math.EPSILON_P>d*h-u*f)return!1;for(var m=t.mprev.mprev,p=t.mnext;p!=m;){p=p.mnext;var v=p.vFrom.x,g=p.vFrom.y,y=v-e,x=g-i;if(0!==y||0!==x){var _=v-n,M=g-o;if(0!==_||0!==M){var b=v-a,w=g-s;if((0!==b||0!==w)&&u*M-h*_>=r.Math.EPSILON_N&&d*x-f*y>=r.Math.EPSILON_N&&l*w-c*b>=r.Math.EPSILON_N)return!1}}}return!0}var e=this.polyData,i=e.getFirstSegment(),n=i;if(e.isClockWise(i)){do n.mprev=n.snext,n.mnext=n.sprev,n=n.sprev;while(n!=i);e.set_PolyLeft_wrong(0)}else do n.mprev=n.sprev,n.mnext=n.snext,n=n.snext;while(n!=i);for(var o=i,a=o;o.mnext!=o.mprev;)if(t(o))this.polyData.addTriangle(o.mprev.vFrom,o.vFrom,o.mnext.vFrom),o.mprev.mnext=o.mnext,o.mnext.mprev=o.mprev,o=o.mnext,a=o;else if(o=o.mnext,o==a)return!1;return!0}},r.Trapezoid=function(t,e,i,r){this.vHigh=t?t:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.vLow=e?e:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.lseg=i,this.rseg=r,this.depth=-1,this.monoDone=!1},r.Trapezoid.prototype={constructor:r.Trapezoid,clone:function(){var t=new r.Trapezoid(this.vHigh,this.vLow,this.lseg,this.rseg);return t.uL=this.uL,t.uR=this.uR,t.dL=this.dL,t.dR=this.dR,t.sink=this.sink,t},splitOffLower:function(t){var e=this.clone();return this.vLow=e.vHigh=t,this.dL=e,e.uL=this,this.dR=e.uR=null,e.dL&&(e.dL.uL=e),e.dR&&(e.dR.uR=e),e}},r.QsNode=function(t){this.trap=t,t.sink=this},r.QsNode.prototype={constructor:r.QsNode},r.QueryStructure=function(t){var e=new r.Trapezoid(null,null,null,null);if(this.trapArray=[],this.appendTrapEntry(e),this.root=new r.QsNode(e),t)for(var i=t.getSegments(),n=0;n<i.length;n++)i[n].rootFrom=i[n].rootTo=this.root,i[n].is_inserted=!1},r.QueryStructure.prototype={constructor:r.QueryStructure,getRoot:function(){return this.root},appendTrapEntry:function(t){t.trapID=this.trapArray.length,this.trapArray.push(t)},cloneTrap:function(t){var e=t.clone();return this.appendTrapEntry(e),e},splitNodeAtPoint:function(t,e,i){var n=t.trap;if(n.vHigh==e)return t;if(n.vLow==e)return t;var o=n.splitOffLower(e);return this.appendTrapEntry(o),t.yval=e,t.trap=null,t.right=new r.QsNode(n),t.left=new r.QsNode(o),i?n.sink:o.sink},fpEqual:function(t,e){return Math.abs(t-e)<r.Math.EPSILON_P},is_left_of:function(t,e,i){var n,o=t.vFrom.x-e.x,a=t.vTo.x-e.x,s=this.fpEqual(t.vFrom.y,e.y);if(this.fpEqual(t.vTo.y,e.y)){if(s)return 0;n=a}else{if(!s)return t.upward?r.Math.ptsCrossProd(t.vFrom,t.vTo,e):r.Math.ptsCrossProd(t.vTo,t.vFrom,e);n=o}return Math.abs(n)<r.Math.EPSILON_P?0:n},segNodes:function(t){this.ptNode(t,!0),this.ptNode(t,!1)},ptNode:function(t,e){var i,n,o;e?(i=t.vFrom,n=t.vTo,o=t.rootFrom):(i=t.vTo,n=t.vFrom,o=t.rootTo);for(var a,s;o;)if(o.yval)o=-1==r.Math.compare_pts_yx(i==o.yval?n:i,o.yval)?o.left:o.right;else{if(!o.seg)return o.trap||console.log("ptNode: unknown type",o),e?t.rootFrom=o:t.rootTo=o,o;if(i==o.seg.vFrom||i==o.seg.vTo){if(this.fpEqual(i.y,n.y)){this.fpEqual(o.seg.vFrom.y,o.seg.vTo.y)?i==o.seg.vFrom?(s=t.upward?n.x>=o.seg.vTo.x:n.x<o.seg.vTo.x,o=(s?t.sprev.upward:o.seg.snext.upward)?o.right:o.left):(s=t.upward?n.x<o.seg.vFrom.x:n.x>=o.seg.vFrom.x,o=(s?t.snext.upward:o.seg.sprev.upward)?o.left:o.right):o=n.x<i.x?o.left:o.right;continue}a=this.is_left_of(o.seg,n,!1),0===a&&(i==o.seg.vFrom?(s=t.upward?n.y>=o.seg.vTo.y:n.y<o.seg.vTo.y,
a=s?this.is_left_of(o.seg,t.sprev.vFrom,!1):-this.is_left_of(o.seg,o.seg.snext.vTo,!1)):(s=t.upward?n.y<o.seg.vFrom.y:n.y>=o.seg.vFrom.y,a=s?this.is_left_of(o.seg,t.snext.vTo,!1):-this.is_left_of(o.seg,o.seg.sprev.vFrom,!1)))}else if(a=this.is_left_of(o.seg,i,!0),0===a&&(a=this.is_left_of(o.seg,n,!1),0===a)){var u=e?t.sprev.vFrom:t.snext.vTo;a=this.is_left_of(o.seg,u,!1)}if(a>0)o=o.left;else{if(!(0>a))return o;o=o.right}}},add_segment:function(t){function e(){var t=M.uL||M.uR;t.dL&&t.dR?M==t.dL?(v.uL=null,t.dL=p):(p.uR=null,t.dR=v):(v.uL=null,v.uR=t,t.dR=v)}function i(){M.usave?(M.uleft?(v.uL=M.uR,v.uR=M.usave,v.uL.dL=v,v.uR.dR=v):(p.uR=M.uL,p.uL=M.usave,p.uL.dL=p,p.uR.dR=p),p.usave=v.usave=null):M.vHigh==m.vHigh?(v.uR.dR=v,p.uR=v.uL=null):v==M?(v.uL=v.uR,v.uR=null,v.uL.dL=v):(p.uR=p.uL,p.uL=null)}function n(t){M.vLow==_.vLow?(h?M.dL?(t.uL=p,p.dL=t,v.dR=null):(t.uR=v,p.dL=null,v.dR=t):(t.uL=p,t.uR=v,p.dL=v.dR=t),p.dR=v.dL=null):(t.uL&&t.uR&&(t.uL==M?(t.usave=t.uR,t.uleft=!0):(t.usave=t.uL,t.uleft=!1)),t.uL=p,t.uR=v,p.dR=v.dL=t,p.dL=v.dR=null)}function o(){var e;if(M.vLow==_.vLow&&h)M.dL.uL=p,M.dR.uR=v,p.dL=M.dL,v.dR=M.dR,p.dR=v.dL=null,e=null;else{M.dL.uL=p,M.dR.uR=v;var i,r=a.is_left_of(t,M.vLow,!0);if(r>0)i=!0;else if(0>r)i=!1;else{var n=M.dL.rseg,o=n.upward,s=o?n.vFrom:n.vTo;r=a.is_left_of(t,s,!1),r>0?i=!0:0>r?i=!1:(n=o?n.snext:n.sprev,s=o?n.vTo:n.vFrom,r=a.is_left_of(t,s,!1),i=r>0?!0:!1)}i?(e=M.dR,M.dR.uL=p,p.dL=M.dL,v.dR=null):(e=M.dL,M.dL.uR=v,v.dR=M.dR,p.dL=null),p.dR=v.dL=e}return e}var a=this;this.segNodes(t);var s,u,h,l,c,d;if(t.upward?(s=t.vFrom,l=t.vTo,u=t.rootFrom,c=t.rootTo,h=t.sprev.is_inserted,d=t.snext.is_inserted):(s=t.vTo,l=t.vFrom,u=t.rootTo,c=t.rootFrom,h=t.snext.is_inserted,d=t.sprev.is_inserted),!d){var f=this.splitNodeAtPoint(c,l,!1);c==u&&(u=f),c=f}var m=c.trap;if(!m.uL&&!m.uR)return void console.log("ERR add_segment: missing trFirst.uX: ",m);if(m.vHigh!=l)return void console.log("ERR add_segment: trFirstHigh != segHigh: ",m);h||(u=this.splitNodeAtPoint(u,s,!0));for(var p,v,g,y,x,_=u.trap,M=m,b=this.trapArray.length+2;M;){if(--b<0)return void console.log("ERR add_segment: infinite loop",M,t,this);if(!M.dL&&!M.dR)return void console.log("ERR add_segment: missing successors",M,t,this);var w=M.sink;w.seg=t,w.trap=null,y&&y.rseg==M.rseg?(p=M,v=y,v.vLow=M.vLow,w.left=new r.QsNode(p),w.right=y.sink):g&&g.lseg==M.lseg?(v=M,p=g,p.vLow=M.vLow,w.left=g.sink,w.right=new r.QsNode(v)):(p=M,v=this.cloneTrap(M),w.left=new r.QsNode(p),w.right=new r.QsNode(v)),M.uL&&M.uR?i():e(),M.dL&&M.dR?x=o():(x=M.dL?M.dL:M.dR,n(x)),p.rseg&&(p.rseg.trLeft=v),v.lseg&&(v.lseg.trRight=p),p.rseg=v.lseg=t,t.trLeft=p,t.trRight=v,M.vLow!=_.vLow?(g=p,y=v,M=x):M=null}t.is_inserted=!0},assignDepths:function(t){var e,i,r=[this.trapArray[0]],n=[],o=0;do{for(var a=o%2==1;e=r.pop();)-1==e.depth&&(e.depth=o,e.uL&&r.push(e.uL),e.uR&&r.push(e.uR),e.dL&&r.push(e.dL),e.dR&&r.push(e.dR),(i=e.lseg)&&-1==i.trLeft.depth&&n.push(i.trLeft),(i=e.rseg)&&(-1==i.trRight.depth&&n.push(i.trRight),i.upward!=a&&t.set_PolyLeft_wrong(i.chainId)));r=n,n=[],o++}while(r.length>0)},create_visibility_map:function(t){var e,i,r=0,n=1,o=2,a=3,s=4,u=5,h=6,l=7,c=t.nbVertices(),d=new Array(c);for(e=0;c>e;e++)d[e]=new Array(l+1);var f=new Array(c);for(e=0,i=this.trapArray.length;i>e;e++){var m=this.trapArray[e],p=m.uL?m.uR?u:l:m.uR?s:h,v=m.dL?m.dR?n:r:m.dR?a:o;if(m.depth%2==1){if(p==u||v==n||p==l&&v==a||p==s&&v==r){var g=t.appendDiagonalsEntry({vFrom:m.vLow,vTo:m.vHigh,mprev:null,mnext:null,marked:!1}),y=t.appendDiagonalsEntry({vFrom:m.vHigh,vTo:m.vLow,revDiag:g,mprev:null,mnext:null,marked:!1});g.revDiag=y,d[m.vLow.id][v]=g,d[m.vHigh.id][p]=y}}else null!==m.vHigh.id&&(f[m.vHigh.id]=p),null!==m.vLow.id&&(f[m.vLow.id]=v)}var x,_,M,b,w;for(e=0;c>e;e++)if(_=d[e],M=f[e],null!=M){i=M,w=null;do i++>l&&(i=r),(x=_[i])&&(w?(x.mprev=w,w.mnext=x):(b=x.vFrom,b.firstOutDiag=x),w=x.revDiag);while(i!=M);w&&(b.lastInDiag=w)}}},r.Trapezoider=function(t){this.polyData=t,this.queryStructure=new r.QueryStructure(this.polyData)},r.Trapezoider.prototype={constructor:r.Trapezoider,optimise_randomlist:function(t){var e=0,i=this.polyData.nbPolyChains();if(1!=i)for(var r=new Array(i),n=t.concat(),o=0;o<n.length;o++){var a=n[o].chainId;r[a]?t[i++]=n[o]:(t[e++]=n[o],r[a]=!0)}},trapezoide_polygon:function(){var t=this.polyData.getSegments().concat();r.Math.array_shuffle(t),this.optimise_randomlist(t);for(var e,i=t.length,n=this.queryStructure,o=0,a=i;i>o;){a=Math.log(a)/Math.LN2;for(var s=a>1?Math.floor(i/a):i;s>o;o++)n.add_segment(t[o]);for(e=o;i>e;e++)this.queryStructure.segNodes(t[e])}for(n.assignDepths(this.polyData),e=0;i>e;e++)t[e].trLeft=t[e].trRight=null},create_visibility_map:function(){return this.queryStructure.create_visibility_map(this.polyData)}},r.MonoSplitter=function(t){this.polyData=t,this.trapezoider=null},r.MonoSplitter.prototype={constructor:r.MonoSplitter,monotonate_trapezoids:function(){this.trapezoider=new r.Trapezoider(this.polyData),this.trapezoider.trapezoide_polygon(),this.trapezoider.create_visibility_map(),this.polyData.create_mono_chains(),this.polyData.unique_monotone_chains_max()}},r.MonoTriangulator=function(t){this.polyData=t},r.MonoTriangulator.prototype={constructor:r.MonoTriangulator,triangulate_all_polygons:function(){var t=this.polyData.getMonoSubPolys();this.polyData.clearTriangles();for(var e=0;e<t.length;e++){var i=t[e],r=i.mprev,n=i.mnext;n.mnext==r?this.polyData.addTriangle(i.vFrom,n.vFrom,r.vFrom):this.triangulate_monotone_polygon(i)}},triangulate_monotone_polygon:function(t){function e(){for(console.log("ERR uni-y-monotone: only concave angles left",a);s>1;)s--,i.polyData.addTriangle(a[s-1],a[s],a[s+1])}var i=this,n=t.mnext,o=t.vFrom,a=[n.vFrom],s=0;n=n.mnext;var u=n.vFrom;if(u!=o){for(;u!=o||s>1;)if(s>0){var h=r.Math.ptsCrossProd(a[s],u,a[s-1]);Math.abs(h)<=r.Math.EPSILON_P&&(u==o||r.Math.compare_pts_yx(a[s],u)==r.Math.compare_pts_yx(a[s],a[s-1]))&&(h=1),h>0?(this.polyData.addTriangle(a[s-1],a[s],u),s--):(a[++s]=u,u==o?e():(n=n.mnext,u=n.vFrom))}else a[++s]=u,n=n.mnext,u=n.vFrom;this.polyData.addTriangle(a[s-1],a[s],u)}}},r.Triangulator=function(){this.lastPolyData=null},r.Triangulator.prototype={constructor:r.Triangulator,clear_lastData:function(){this.lastPolyData=null},get_PolyLeftArr:function(){return this.lastPolyData?this.lastPolyData.get_PolyLeftArr():null},triangulate_polygon:function(t,e){function i(){return e?!1:1==o.nbPolyChains()}if(this.clear_lastData(),!t||0===t.length)return[];var n,o=new r.PolygonData(t),a=i();if(a&&(n=new r.EarClipTriangulator(o),a=n.triangulate_polygon_no_holes()),!a){var s=new r.MonoSplitter(o);s.monotonate_trapezoids(),n=new r.MonoTriangulator(o),n.triangulate_all_polygons()}return this.lastPolyData=o,o.getTriangles()}},"undefined"!=typeof t&&t.exports&&(e=t.exports=r),e.PNLTRI=r},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(227),a=function(t){"use strict";function e(t){var e=t.m_context,i=!1;d.imgQuads.length&&((!h||h.length<12*d.imgQuads.length||!x.imgQuadsPosition)&&(x.imgQuadsPosition&&e.deleteBuffer(x.imgQuadsPosition),x.imgQuadsPosition=e.createBuffer(),h=new Float32Array(12*Math.max(128,2*d.imgQuads.length)),i=!0),f.each(d.imgQuads,function(t,e){for(var i=0;12>i;i+=1)h[12*t+i]=e.pos[i]-d.origin[i%3]}),e.bindBuffer(m.GL.ARRAY_BUFFER,x.imgQuadsPosition),i?e.bufferData(m.GL.ARRAY_BUFFER,h,m.GL.DYNAMIC_DRAW):e.bufferSubData(m.GL.ARRAY_BUFFER,0,h)),_.modified()}function r(t){var e=t.m_context,i=!1;d.clrQuads.length&&((!l||l.length<12*d.clrQuads.length||!x.clrQuadsPosition)&&(x.imgQuadsPosition&&e.deleteBuffer(x.clrQuadsPosition),x.clrQuadsPosition=e.createBuffer(),l=new Float32Array(12*Math.max(128,2*d.clrQuads.length)),i=!0),f.each(d.clrQuads,function(t,e){for(var i=0;12>i;i+=1)l[12*t+i]=e.pos[i]-d.origin[i%3]}),e.bindBuffer(m.GL.ARRAY_BUFFER,x.clrQuadsPosition),i?e.bufferData(m.GL.ARRAY_BUFFER,l,m.GL.DYNAMIC_DRAW):e.bufferSubData(m.GL.ARRAY_BUFFER,0,l)),M.modified()}if(!(this instanceof a))return new a(t);o.call(this,t);var n,s,u,h,l,c,d,f=i(1),m=i(6),p=this,v=this._exit,g=this._init,y=this._update,x={},_=m.timestamp(),M=m.timestamp(),b=["attribute vec3 vertexPosition;","attribute vec3 textureCoord;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying highp vec3 iTextureCoord;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","  iTextureCoord = textureCoord;","}"].join("\n"),w=["attribute vec3 vertexPosition;","uniform vec3 vertexColor;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","  iVertexColor = vertexColor;","}"].join("\n");return this._build=function(){var t,e,i,r,o;p.position()&&(d=this._generateQuads(),d.imgQuads.length&&!s&&(p.visible(!1),t=new m.mapper({dynamicDraw:!0}),s=new m.actor,s.setMapper(t),e=new m.material,i=new m.shaderProgram,i.addVertexAttribute(new m.vertexAttribute("vertexPosition"),m.vertexAttributeKeys.Position),i.addVertexAttribute(new m.vertexAttribute("textureCoord"),m.vertexAttributeKeys.TextureCoordinate),n=new m.modelViewOriginUniform("modelViewMatrix",d.origin),i.addUniform(n),i.addUniform(new m.projectionUniform("projectionMatrix")),i.addUniform(new m.floatUniform("opacity",1)),i.addShader(m.getCachedShader(m.GL.VERTEX_SHADER,m.GL,b)),i.addShader(m.utils.createRgbaTextureFragmentShader(m.GL)),e.addAttribute(i),e.addAttribute(new m.blend),o=new m.geometryData,h=void 0,r=new m.sourceDataT2fv,r.pushBack([0,0,1,0,0,1,1,1]),o.addSource(r),t.setGeometryData(o),s.setMaterial(e),t.s_render=t.render,t.render=p._renderImageQuads,p.renderer().contextRenderer().addActor(s),p.visible(!0)),d.clrQuads.length&&!u&&(p.visible(!1),t=new m.mapper({dynamicDraw:!0}),u=new m.actor,u.setMapper(t),e=new m.material,i=new m.shaderProgram,i.addVertexAttribute(new m.vertexAttribute("vertexPosition"),m.vertexAttributeKeys.Position),c=new m.modelViewOriginUniform("modelViewMatrix",d.origin),i.addUniform(c),i.addUniform(new m.projectionUniform("projectionMatrix")),i.addUniform(new m.floatUniform("opacity",1)),i.addUniform(new m.uniform(m.GL.FLOAT_VEC3,"vertexColor")),i.addShader(m.getCachedShader(m.GL.VERTEX_SHADER,m.GL,w)),i.addShader(m.utils.createFragmentShader(m.GL)),e.addAttribute(i),e.addAttribute(new m.blend),o=new m.geometryData,l=void 0,t.setGeometryData(o),u.setMaterial(e),t.s_render=t.render,t.render=p._renderColorQuads,p.renderer().contextRenderer().addActor(u),p.visible(!0)),n&&n.setOrigin(d.origin),c&&c.setOrigin(d.origin),p.buildTime().modified())},this._updateTextures=function(){var t;f.each(d.imgQuads,function(e,i){i.image&&(i.image._texture?i.texture=i.image._texture:(t=new m.texture,t.setImage(i.image),i.texture=i.image._texture=t))})},this._renderColorQuads=function(t){if(d.clrQuads.length){var e=this;(e.getMTime()>M.getMTime()||p.dataTime().getMTime()>M.getMTime()||t.m_contextChanged||!l||12*d.clrQuads.length>l.length)&&r(t),e.s_render(t);var i,n=t.m_context,o=1;n.bindBuffer(m.GL.ARRAY_BUFFER,x.clrQuadsPosition),f.each(d.clrQuads,function(e,r){r.opacity!==o&&(o=r.opacity,n.uniform1fv(t.m_material.shaderProgram().uniformLocation("opacity"),new Float32Array([o]))),i&&i.r===r.color.r&&i.g===r.color.g&&i.b===r.color.b||(i=r.color,n.uniform3fv(t.m_material.shaderProgram().uniformLocation("vertexColor"),new Float32Array([i.r,i.g,i.b]))),n.bindBuffer(m.GL.ARRAY_BUFFER,x.clrQuadsPosition),n.vertexAttribPointer(m.vertexAttributeKeys.Position,3,m.GL.FLOAT,!1,12,12*e*4),n.enableVertexAttribArray(m.vertexAttributeKeys.Position),n.drawArrays(m.GL.TRIANGLE_STRIP,0,4)}),n.bindBuffer(m.GL.ARRAY_BUFFER,null)}},this._renderImageQuads=function(t){if(d.imgQuads.length){var i=this;(i.getMTime()>_.getMTime()||p.dataTime().getMTime()>_.getMTime()||t.m_contextChanged||!h||12*d.imgQuads.length>h.length)&&e(t),i.s_render(t);var r=t.m_context,n=1;p._updateTextures(),r.bindBuffer(m.GL.ARRAY_BUFFER,x.imgQuadsPosition),f.each(d.imgQuads,function(e,i){i.image&&(i.texture.bind(t),i.opacity!==n&&(n=i.opacity,r.uniform1fv(t.m_material.shaderProgram().uniformLocation("opacity"),new Float32Array([n]))),r.bindBuffer(m.GL.ARRAY_BUFFER,x.imgQuadsPosition),r.vertexAttribPointer(m.vertexAttributeKeys.Position,3,m.GL.FLOAT,!1,12,12*e*4),r.enableVertexAttribArray(m.vertexAttributeKeys.Position),r.drawArrays(m.GL.TRIANGLE_STRIP,0,4),i.texture.undoBind(t))}),r.bindBuffer(m.GL.ARRAY_BUFFER,null)}},this._update=function(){y.call(p),(p.buildTime().getMTime()<=p.dataTime().getMTime()||p.updateTime().getMTime()<p.getMTime())&&p._build(),u&&(u.setVisible(p.visible()),u.material().setBinNumber(p.bin())),s&&(s.setVisible(p.visible()),s.material().setBinNumber(p.bin())),p.updateTime().modified()},this._init=function(){g.call(p,t)},this._exit=function(){s&&(p.renderer().contextRenderer().removeActor(s),s=null),u&&(p.renderer().contextRenderer().removeActor(u),u=null),v.call(p)},p._init(t),this};r(a,o),n("vgl","quad",a),t.exports=a},function(t,e,i){var r=i(131).registerLayerAdjustment,n=function(){"use strict";var t,e=this,i=this._init,r=this._exit,n=0,o=[];this._drawTile=function(i){if(t){var r=this._tileBounds(i),a=i.index.level||0,s=this._tileOffset(a),u={};u.ul=this.fromLocal(this.fromLevel({x:r.left-s.x,y:r.top-s.y},a),0),u.ll=this.fromLocal(this.fromLevel({x:r.left-s.x,y:r.bottom-s.y},a),0),u.ur=this.fromLocal(this.fromLevel({x:r.right-s.x,y:r.top-s.y},a),0),u.lr=this.fromLocal(this.fromLevel({x:r.right-s.x,y:r.bottom-s.y},a),0),u.ul.z=u.ll.z=u.ur.z=u.lr.z=1e-5*a,n+=1,u.id=n,i.quadId=u.id,u.image=i.image,o.push(u),t.data(o),t._update(),e.draw()}},this._remove=function(i){if(void 0!==i.quadId&&t){for(var r=0;r<o.length;r+=1)if(o[r].id===i.quadId){o.splice(r,1);break}t.data(o),t._update(),e.draw()}},this._exit=function(){e.deleteFeature(t),t=null,o=[],r.apply(e,arguments)},this._init=function(){i.apply(e,arguments),t=this.createFeature("quad",{previewColor:e._options.previewColor,previewImage:e._options.previewImage}),t.geoTrigger=void 0,t.gcs(e._options.gcs||e.map().gcs()),t.data(o),t._update()},this._getSubLayer=function(){},this._updateSubLayer=void 0};r("vgl","tile",n),t.exports=n},function(t,e,i){var r=i(4),n=i(131).registerRenderer,o=i(136),a=function(t){"use strict";if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var e,r=i(1),n=i(6),s=i(8),u=i(120),h=i(125),l=this,c=null,d=null,f=0,m=0,p=null,v=this._init,g=this._exit;return this.width=function(){return f},this.height=function(){return m},this.contextRenderer=function(){return c},this.api=function(){return"vgl"},this._init=function(){if(l.initialized())return l;v.call(l);var e=r(document.createElement("canvas"));e.attr("class","webgl-canvas"),r(l.layer().node().get(0)).append(e),d=n.viewer(e.get(0),t.options),d.init(),c=d.renderWindow().activeRenderer(),c.setResetScene(!1),d.renderWindow().renderers().length>0&&c.setLayer(d.renderWindow().renderers().length),l.canvas(e);var i=l.layer().map(),o=i.size();return l._resize(0,0,o.width,o.height),l},this._resize=function(t,e,i,r){var n=d.renderWindow();return f=i,m=r,l.canvas().attr("width",i),l.canvas().attr("height",r),n.positionAndResize(t,e,i,r),l._updateRendererCamera(),l._render(),l},this._render=function(){return null===p&&(p=window.requestAnimationFrame(this._renderFrame)),l},this._renderFrame=function(){p=null,d.render()},this._exit=function(){l.canvas().remove(),d.exit(),g()},this._updateRendererCamera=function(){var t=d.renderWindow(),i=l.layer().map(),r=i.camera(),n=i.rotation()||0,o=r.view,a=r.projectionMatrix;a[15]&&(a=s.scale(u.mat4AsArray(),a,[1,1,-1])),a=s.translate(u.mat4AsArray(),a,[0,0,r.constructor.bounds.far]);var h=Math.PI/2,c=n%h,f=Math.min(Math.abs(c),Math.abs(c-h))<1e-5;t.renderers().forEach(function(t){var n=t.camera();u.compareArrays(o,n.viewMatrix())&&u.compareArrays(a,n.projectionMatrix())&&e===i.zoom()||(e=i.zoom(),n.setViewMatrix(o,!0),n.setProjectionMatrix(a),a[1]||a[2]||a[3]||a[4]||a[6]||a[7]||a[8]||a[9]||a[11]||1!==a[15]||!f||parseFloat(e.toFixed(6))!==parseFloat(e.toFixed(0))?n.viewAlignment=function(){return null}:n.viewAlignment=function(){var t={roundx:2/r.viewport.width,roundy:2/r.viewport.height};return t.dx=r.viewport.width%2?.5*t.roundx:0,t.dy=r.viewport.height%2?.5*t.roundy:0,t})})},l.layer().geoOn(h.pan,function(t){l._updateRendererCamera()}),l.layer().geoOn(h.zoom,function(t){l._updateRendererCamera()}),l.layer().geoOn(h.rotate,function(t){l._updateRendererCamera()}),l.layer().geoOn(h.parallelprojection,function(t){var e,i=l.contextRenderer(),r=l.layer();t.geo&&t.geo._triggeredBy!==r&&(i&&i.camera()||console.log("Parallel projection event triggered on unconnected VGL renderer."),e=i.camera(),e.setEnableParallelProjection(t.parallelProjection),l._updateRendererCamera())}),this};r(a,o),n("vgl",a),function(){"use strict";var t;a.supported=function(){if(void 0===t){var e,i,r;try{e=document.createElement("canvas"),i=e.getContext("webgl")||e.getContext("experimental-webgl"),r=i.getSupportedExtensions(),t=!0}catch(n){console.error("No webGL support"),t=!1}e=void 0,i=void 0,r=void 0}return t},a.fallback=function(){return null}}(),t.exports=a},function(t,e,i){t.exports={canvasRenderer:i(256),quadFeature:i(257),tileLayer:i(258)}},function(t,e,i){var r=i(4),n=i(131).registerRenderer,o=i(136),a=function(t){"use strict";var e=i(1);if(!(this instanceof a))return new a(t);t=t||{},o.call(this,t);var r=this,n=null,s=this._init,u=this._exit;return this.api=function(){return"canvas"},this._init=function(){if(r.initialized())return r;s.call(r);var t=e(document.createElement("canvas"));r.context2d=t[0].getContext("2d"),t.attr("class","canvas-canvas"),e(r.layer().node().get(0)).append(t),r.canvas(t);var i=r.layer().map(),n=i.size();return r._resize(0,0,n.width,n.height),r},this._resize=function(t,e,i,n){return r.canvas().attr("width",i),r.canvas().attr("height",n),r._render(),r},this._render=function(){return null===n&&(n=window.requestAnimationFrame(function(){n=null;var t=r.layer(),e=t.map(),i=e.camera(),o=i._viewport;r.context2d.setTransform(1,0,0,1,0,0),r.context2d.clearRect(0,0,o.width,o.height);for(var a=t.features(),s=0;s<a.length;s+=1)a[s]._renderOnCanvas(r.context2d,e)})),r},this._exit=function(){r.canvas().remove(),u()},this};r(a,o),n("canvas",a),function(){"use strict";var t;a.supported=function(){if(void 0===t){var e;try{e=document.createElement("canvas"),t=!(!e.getContext||!e.getContext("2d"))}catch(i){t=!1}e=void 0}return t},a.fallback=function(){return null}}(),t.exports=a},function(t,e,i){var r=i(4),n=i(131).registerFeature,o=i(227),a=function(t){"use strict";if(!(this instanceof a))return new a(t);o.call(this,t);var e,r=i(1),n=this,s=this._exit,u=this._init,h=this._update;return this._build=function(){n.position()&&(e=this._generateQuads(),e.imgQuads&&e.imgQuads.sort(function(t,e){return t.pos[2]-e.pos[2]}),n.buildTime().modified())},this._renderColorQuads=function(t){},this._renderImageQuads=function(t,i){if(e.imgQuads.length){var n=t.globalAlpha,o=n;r.each(e.imgQuads,function(e,r){if(r.image){var n=r.image.width,a=r.image.height,s=i.gcsToDisplay({x:r.pos[0],y:r.pos[1]},null),u=i.gcsToDisplay({x:r.pos[9],y:r.pos[10]},null),h=i.gcsToDisplay({x:r.pos[6],y:r.pos[7]},null);t.setTransform((u.x-h.x)/n,(u.y-h.y)/a,(s.x-h.x)/n,(s.y-h.y)/a,h.x,h.y),r.opacity!==o&&(o=r.opacity,t.globalAlpha=o),t.drawImage(r.image,0,0)}}),o!==n&&(t.globalAlpha=n)}},this._renderOnCanvas=function(t,e){this._renderImageQuads(t,e),this._renderColorQuads(t,e)},this._update=function(){h.call(n),(n.buildTime().getMTime()<=n.dataTime().getMTime()||n.updateTime().getMTime()<n.getMTime())&&n._build(),n.updateTime().modified()},this._init=function(){u.call(n,t)},this._exit=function(){s.call(n)},n._init(t),this};r(a,o),n("canvas","quad",a),t.exports=a},function(t,e,i){var r=i(131).registerLayerAdjustment,n=function(){"use strict";var t,e=this,i=this._init,r=this._exit,n=0,o=[];this._drawTile=function(i){if(t){var r=this._tileBounds(i),a=i.index.level||0,s=this._tileOffset(a),u={};u.ul=this.fromLocal(this.fromLevel({x:r.left-s.x,y:r.top-s.y},a),0),u.ll=this.fromLocal(this.fromLevel({x:r.left-s.x,y:r.bottom-s.y},a),0),u.ur=this.fromLocal(this.fromLevel({x:r.right-s.x,y:r.top-s.y},a),0),u.lr=this.fromLocal(this.fromLevel({x:r.right-s.x,y:r.bottom-s.y},a),0),u.ul.z=u.ll.z=u.ur.z=u.lr.z=1e-5*a,n+=1,u.id=n,i.quadId=u.id,u.image=i.image,o.push(u),t.data(o),t._update(),e.draw()}},this._remove=function(i){if(void 0!==i.quadId&&t){for(var r=0;r<o.length;r+=1)if(o[r].id===i.quadId){o.splice(r,1);break}t.data(o),t._update(),e.draw()}},this._exit=function(){e.deleteFeature(t),t=null,o=[],r.apply(e,arguments)},this._init=function(){i.apply(e,arguments),t=this.createFeature("quad",{previewColor:e._options.previewColor,previewImage:e._options.previewImage}),t.geoTrigger=void 0,t.gcs(e._options.gcs||e.map().gcs()),t.data(o),t._update()},this._getSubLayer=function(){},this._updateSubLayer=void 0};r("canvas","tile",n),t.exports=n},function(t,e,i){t.exports={domWidget:i(260),legendWidget:i(262),sliderWidget:i(264),svgWidget:i(263),uiLayer:i(218),widget:i(261)}},function(t,e,i){var r=i(261),n=i(4),o=i(131).registerWidget,a=function(t){"use strict";if(!(this instanceof a))return new a(t);r.call(this,t);var e=this,i="div";return this._init=function(){t.hasOwnProperty("parent")&&t.parent.addChild(e),e._createCanvas(),e._appendChild(),e.canvas().addEventListener("mousedown",function(t){t.stopPropagation()}),e.reposition()},this._createCanvas=function(){e.canvas(document.createElement(t.el||i))},this};n(a,r),o("dom","dom",a),t.exports=a},function(t,e,i){var r=i(4),n=i(128),o=function(t){"use strict";if(!(this instanceof o))return new o(t);n.call(this,t);var e=i(125),r=i(131).createFeature,a=this,s=this._exit,u=t.layer,h=null;if(t.position=void 0===t.position?{left:0,top:0}:t.position,void 0!==t.parent&&!(t.parent instanceof o))throw"Parent must be of type geo.gui.widget";this._init=function(){a.modified()},this._exit=function(){a.children().forEach(function(t){a._deleteFeature(t)}),a.layer().geoOff(e.pan,a.repositionEvent),a.parentCanvas().removeChild(a.canvas()),s()},this._createFeature=function(t,e){var i=r(t,a,a.renderer(),e);return a.addChild(i),a.modified(),i},this._deleteFeature=function(t){return a.removeChild(t),t._exit(),a},this.layer=function(){return u},this._createCanvas=function(){throw"Must be defined in derived classes"},this.canvas=function(t){return void 0===t?h:void(h=t)},this._appendChild=function(){a.parentCanvas().appendChild(a.canvas())},this.parentCanvas=function(){return void 0===a.parent?a.layer().canvas():a.parent().canvas()},this.position=function(e){if(void 0!==e)return t.position=e,this.reposition(),this;var i;return t&&t.hasOwnProperty("position")&&t.position.hasOwnProperty("x")&&t.position.hasOwnProperty("y")?(i=a.layer().map().gcsToDisplay(t.position),{left:i.x,top:i.y}):t.position},this.reposition=function(t){t=t||a.position(),a.canvas().style.position="absolute";for(var e in t)t.hasOwnProperty(e)&&(a.canvas().style[e]=t[e]+"px")},this.repositionEvent=function(){return a.reposition()},this.isInViewport=function(){var t=a.position(),e=a.layer();return t.left>=0&&t.top>=0&&t.left<=e.width()&&t.top<=e.height()},t&&t.hasOwnProperty("position")&&t.position.hasOwnProperty("x")&&t.position.hasOwnProperty("y")&&this.layer().geoOn(e.pan,a.repositionEvent)};r(o,n),t.exports=o},function(t,e,i){var r=i(263),n=i(4),o=i(131).registerWidget,a=function(t){"use strict";if(!(this instanceof a))return new a(t);r.call(this,t);var e=i(132),n=i(125),o=this,s=[],u=null,h=null,l=null,c=20,d=12,f=this._createCanvas,m=this._appendChild;this.categories=function(t){return void 0===t?s.slice():(s=t.slice().map(function(t){return"line"===t.type&&(t.style.fill=!1,t.style.stroke=!0),t}),o.draw(),o)},this.size=function(){var t,i=1,r=e.select(o.canvas()).append("text").style("opacity",1e-6);return s.forEach(function(t){r.text(t.name),i=Math.max(i,r.node().getBBox().width)}),r.remove(),t=c*(s.length+1),{width:i+50,height:t}},this.draw=function(){function t(t){t.style("fill",function(t){return t.style.fill||void 0===t.style.fill?t.style.fillColor:"none"}).style("fill-opacity",function(t){return void 0===t.style.fillOpacity?1:t.style.fillOpacity}).style("stroke",function(t){return t.style.stroke||void 0===t.style.stroke?t.style.strokeColor:"none"}).style("stroke-opacity",function(t){return void 0===t.style.strokeOpacity?1:t.style.strokeOpacity}).style("stroke-width",function(t){return void 0===t.style.strokeWidth?1.5:t.style.strokeWidth})}o._init(),l.attr("height",o.size().height+2*d).style("display",null);var e=o._scale(),i=h.selectAll("g.geo-label").data(s,function(t){return t.name}),r=i.enter().append("g").attr("class","geo-label").attr("transform",function(t,i){return"translate(0,"+e.y(i)+")"});return t(r.filter(function(t){return"point"!==t.type&&"line"!==t.type}).append("rect").attr("x",0).attr("y",-6).attr("rx",5).attr("ry",5).attr("width",40).attr("height",12)),t(r.filter(function(t){return"point"===t.type}).append("circle").attr("cx",20).attr("cy",0).attr("r",6)),t(r.filter(function(t){return"line"===t.type}).append("line").attr("x1",0).attr("y1",0).attr("x2",40).attr("y2",0)),r.append("text").attr("x","50px").attr("y",0).attr("dy","0.3em").text(function(t){return t.name}),o.reposition(),o},this._scale=function(){return{x:e.scale.linear().domain([0,1]).range([0,o.size().width]),y:e.scale.linear().domain([0,s.length-1]).range([d/2,o.size().height-d/2])}},this._init=function(){u||(f(),m());var t=o.size().width+2*d+4,i=o.size().height+2*d+4;u&&u.remove(),e.select(o.canvas()).attr("width",t).attr("height",i),u=e.select(o.canvas()).append("g"),h=u.append("g").attr("transform","translate("+[d+2,d+2]+")"),l=h.append("rect").attr("x",-d).attr("y",-d).attr("width",t-4).attr("height",i-4).attr("rx",3).attr("ry",3).style({stroke:"black","stroke-width":"1.5px",fill:"white","fill-opacity":.75,display:"none"}),h.on("mousedown",function(){e.event.stopPropagation()}),h.on("mouseover",function(){l.transition().duration(250).style("fill-opacity",1)}),h.on("mouseout",function(){l.transition().duration(250).style("fill-opacity",.75)}),o.reposition()},this.geoOn(n.resize,function(){o.draw()})};n(a,r),o("dom","legend",a),t.exports=a},function(t,e,i){var r=i(260),n=i(4),o=i(131).registerWidget,a=function(t){"use strict";if(!(this instanceof a))return new a(t);r.call(this,t);var e=i(239),n=this,o=null;return this._init=function(t){var e;t.hasOwnProperty("parent")&&(t.parent.addChild(n),e=t.parent.canvas()),n._createCanvas(e),n.canvas().addEventListener("mousedown",function(t){t.stopPropagation()}),n.reposition()},this._createCanvas=function(t){var i={layer:n.layer(),widget:!0};t&&(i.d3Parent=t),o=e(i),n.canvas(o.canvas()[0][0])},this};n(a,r),o("dom","svg",a),t.exports=a},function(t,e,i){var r=i(263),n=i(4),o=i(131).registerWidget,a=function(t){"use strict";function e(t,e,i,r,n){var o=e.append("g"),a=n/1024;return o.append("g").append("g").attr("transform","translate("+i+","+r+") scale("+a+") translate(-512,-512)").append("path").attr("d",t).attr("class","geo-glyphicon"),o}if(!(this instanceof a))return new a(t);r.call(this,t);var n,o,s,u,h,l,c,d,f,m=i(132),p=i(125),v=this,g=this._exit,y=this._createCanvas,x=this._appendChild,_=20,M=100,b=10,w=100;l="M512 81.92c-237.568 0-430.080 192.614-430.080 430.080 0 237.568 192.563 430.080 430.080 430.080s430.080-192.563 430.080-430.080c0-237.517-192.563-430.080-430.080-430.080zM564.326 564.326v206.182h-104.653v-206.182h-206.234v-104.653h206.182v-206.234h104.704v206.182h206.182v104.704h-206.182z",c="M512 81.92c-237.568 0-430.080 192.614-430.080 430.080 0 237.568 192.563 430.080 430.080 430.080s430.080-192.563 430.080-430.080c0-237.517-192.563-430.080-430.080-430.080zM770.56 459.674v104.704h-517.12v-104.704h517.12z",f={white:"#f4f4f4",black:"#505050"},this._init=function(){function t(t,e){var i=o.invert(m.mouse(v.layer().node()[0])[1]),r=g.zoomRange();i=(1-i)*(r.max-r.min)+r.min,e?g.transition({zoom:i,ease:m.ease("cubic-in-out"),duration:500,done:v._update()}):(g.zoom(i),v._update()),t.stopPropagation()}y(),x(),v.reposition();var i=m.select(v.canvas()),r=40,a=40+_,g=v.layer().map();n=m.scale.linear().domain([-4,4]).range([r,r+_]),o=m.scale.linear().domain([0,1]).range([a,a+M]),i=i.append("g").classed("geo-ui-slider",!0),d=i,s=i.append("g"),s.append("circle").datum({fill:"white",stroke:null}).classed("geo-zoom-in",!0).attr("cx",n(0)).attr("cy",o(0)-_+2).attr("r",_/2).style({cursor:"pointer"}).on("click",function(){var t=g.zoom();g.transition({zoom:t+1,ease:m.ease("cubic-in-out"),duration:500})}).on("mousedown",function(){m.event.stopPropagation()}),e(l,s,n(0),o(0)-_+2,_+5).style("cursor","pointer").style("pointer-events","none").select("path").datum({fill:"black",stroke:null}),u=i.append("g"),u.append("circle").datum({fill:"white",stroke:null}).classed("geo-zoom-out",!0).attr("cx",n(0)).attr("cy",o(1)+_-2).attr("r",_/2).style({cursor:"pointer"}).on("click",function(){var t=g.zoom();g.transition({zoom:t-1,ease:m.ease("cubic-in-out"),duration:500})}).on("mousedown",function(){m.event.stopPropagation()}),e(c,u,n(0),o(1)+_-2,_+5).style("cursor","pointer").style("pointer-events","none").select("path").datum({fill:"black",stroke:null}),i.append("rect").datum({fill:"white",stroke:"black"}).classed("geo-zoom-track",!0).attr("x",n(0)-_/6).attr("y",o(0)).attr("rx",_/10).attr("ry",_/10).attr("width",_/3).attr("height",M).style({cursor:"pointer"}).on("click",function(){t(m.event,!0)}),h=i.append("rect").datum({fill:"black",stroke:null}).classed("geo-zoom-nub",!0).attr("x",n(-4)).attr("y",o(.5)-b/2).attr("rx",3).attr("ry",3).attr("width",_).attr("height",b).style({cursor:"pointer"}).on("mousedown",function(){m.select(document).on("mousemove.geo.slider",function(){t(m.event)}),m.select(document).on("mouseup.geo.slider",function(){t(m.event),m.select(document).on(".geo.slider",null)}),m.event.stopPropagation()});var T=function(){m.select(this).attr("filter","url(#geo-highlight)"),d.selectAll("rect,path,circle").transition().duration(w).style("fill",function(t){return t.fill||null}).style("stroke",function(t){return t.stroke||null})},A=function(){m.select(this).attr("filter",null),d.selectAll("circle,rect,path").transition().duration(w).style("fill",function(t){return f[t.fill]||null}).style("stroke",function(t){return f[t.stroke]||null})};d.selectAll("*").on("mouseover",T).on("mouseout",A),v.layer().geoOn(p.zoom,function(){v._update()}),A(),v._update()},this._exit=function(){d.remove(),v.layer().geoOff(p.zoom),g()},this._update=function(t){var e=v.layer().map(),i=e.zoomRange(),r=e.zoom(),n=m.scale.linear();t=t||{},r=t.value||r,n.domain([i.min,i.max]).range([1,0]).clamp(!0),h.attr("y",o(n(r))-b/2)}};n(a,r),o("dom","slider",a),t.exports=a}])});