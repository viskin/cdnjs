(function(a,b){a.widget("ui.rangeSlider",{options:{bounds:{min:0,max:100},defaultValues:{min:20,max:50},wheelMode:null,wheelSpeed:4,arrows:true,valueLabels:"show",formatter:null,durationIn:0,durationOut:400,delayOut:200},_values:null,bar:null,leftHandle:null,rightHandle:null,innerBar:null,container:null,arrows:null,labels:null,changing:{min:false,max:false},changed:{min:false,max:false},lastWheel:0,lastScroll:0,scrollCount:0,_create:function(){this._values=this.options.defaultValues;this.labels={left:null,right:null,leftDisplayed:true,rightDisplayed:true};this.arrows={left:null,right:null};this.changing={min:false,max:false};this.changed={min:false,max:false};this.leftHandle=a("<div class='ui-rangeSlider-handle  ui-rangeSlider-leftHandle' />").draggable({axis:"x",containment:"parent",drag:a.proxy(this._handleMoved,this),stop:a.proxy(this._handleStop,this)}).css("position","absolute");this.rightHandle=a("<div class='ui-rangeSlider-handle ui-rangeSlider-rightHandle' />").draggable({axis:"x",containment:"parent",drag:a.proxy(this._handleMoved,this),stop:a.proxy(this._handleStop,this)}).css("position","absolute");this.innerBar=a("<div class='ui-rangeSlider-innerBar' />").css("position","absolute").css("top",0).css("left",0);this.container=a("<div class='ui-rangeSlider-container' />").css("position","absolute");this.bar=a("<div class='ui-rangeSlider-bar' />").draggable({axis:"x",drag:a.proxy(this._barMoved,this),stop:a.proxy(this._barStop,this),containment:this.container}).css("position","absolute").bind("mousewheel",a.proxy(this._wheelOnBar,this));this.arrows.left=a("<div class='ui-rangeSlider-arrow ui-rangeSlider-leftArrow' />").css("position","absolute").css("left",0).bind("mousedown",a.proxy(this._startScrollLeft,this));this.arrows.right=a("<div class='ui-rangeSlider-arrow ui-rangeSlider-rightArrow' />").css("position","absolute").css("right",0).bind("mousedown",a.proxy(this._startScrollRight,this));a(document).bind("mouseup",a.proxy(this._stopScroll,this));this.container.append(this.innerBar).append(this.bar).append(this.leftHandle).append(this.rightHandle);this.element.append(this.container).append(this.arrows.left).append(this.arrows.right).addClass("ui-rangeSlider").bind("mousewheel",a.proxy(this._wheelOnContainer,this));if(this.element.css("position")!="absolute"){this.element.css("position","relative")}if(!this.options.arrows){this.arrows.left.css("display","none");this.arrows.right.css("display","none");this.element.addClass("ui-rangeSlider-noArrow")}else{this.element.addClass("ui-rangeSlider-withArrows")}if(this.options.valueLabels!="hide"){this._createLabels()}else{this._destroyLabels()}a(window).resize(a.proxy(this.resize,this));this.option(this.options);setTimeout(a.proxy(this.resize,this),1);setTimeout(a.proxy(this._initValues,this),1)},_initWidth:function(){this.container.css("width",this.element.width()-this.container.outerWidth(true)+this.container.width());this.innerBar.css("width",this.container.width()-this.innerBar.outerWidth(true)+this.innerBar.width())},_initValues:function(){this.values(this.options.defaultValues.min,this.options.defaultValues.max)},_setOption:function(c,d){if(c=="defaultValues"){if((typeof d.min!="undefined")&&(typeof d.max!="undefined")&&parseFloat(d.min)===d.min&&parseFloat(d.max)===d.max){this.options.defaultValues=d}}else{if(c=="wheelMode"&&(d=="zoom"||d=="scroll"||d===null)){this.options.wheelMode=d}else{if(c=="wheelSpeed"&&!isNaN(parseFloat(d))&&Math.abs(parseFloat(d))<=100){this.options.wheelSpeed=parseFloat(d)}else{if(c=="arrows"&&(d===true||d===false)&&d!=this.options.arrows){if(d){this.element.removeClass("ui-rangeSlider-noArrow").addClass("ui-rangeSlider-withArrows");this.arrows.left.css("display","block");this.arrows.right.css("display","block")}else{this.element.addClass("ui-rangeSlider-noArrow").removeClass("ui-rangeSlider-withArrows");this.arrows.left.css("display","none");this.arrows.right.css("display","none")}this.options.arrows=d;this._initWidth();this._position()}else{if(c=="valueLabels"&&(d=="hide"||d=="show"||d=="change")){this.options.valueLabels=d;if(d!="hide"){this._createLabels()}else{this._destroyLabels()}}else{if(c=="formatter"&&d!==null&&typeof d=="function"){this.options.formatter=d;this._position()}else{if(c=="bounds"&&(typeof d.min!="undefined")&&(typeof d.max!="undefined")&&parseFloat(d.min)===d.min&&parseFloat(d.max)===d.max&&d.min<d.max){this.options.bounds=d;this.values(this._values.min,this._values.max)}}}}}}}},_getPosition:function(d,c){return(d-this.options.bounds.min)*(this.container.innerWidth()-c.outerWidth(true))/(this.options.bounds.max-this.options.bounds.min)+(c==this.rightHandle?c.outerWidth(true):0)},_getValue:function(c,d){if(d==this.rightHandle){c=c-d.outerWidth()}return c*(this.options.bounds.max-this.options.bounds.min)/(this.container.innerWidth()-d.outerWidth(true))+this.options.bounds.min},_privateValues:function(d,c){this._setValues(d,c);this._position();return this._values},_trigger:function(c){this.element.trigger(c,{label:this.element,values:this.values()})},_position:function(){var c=this._getPosition(this._values.min,this.leftHandle);var d=this._getPosition(this._values.max,this.rightHandle);this._positionHandles();this.bar.css("left",c).css("width",d-c+this.bar.width()-this.bar.outerWidth(true))},_positionHandles:function(){var d=this._getPosition(this._values.min,this.leftHandle);var c=this._getPosition(this._values.max,this.rightHandle)-this.rightHandle.outerWidth(true);this.leftHandle.css("left",d);this.rightHandle.css("left",c);this._positionLabels()},_barMoved:function(d,e){var f=e.position.left;var c=f+this.bar.outerWidth(true);this._setValues(this._getValue(f,this.leftHandle),this._getValue(c,this.rightHandle));this._positionHandles()},_barStop:function(c,d){this._position();this._prepareFiringChanged()},_switchHandles:function(){var c=this.leftHandle;this.leftHandle=this.rightHandle;this.rightHandle=c;this.leftHandle.removeClass("ui-rangeSlider-rightHandle").addClass("ui-rangeSlider-leftHandle");this.rightHandle.addClass("ui-rangeSlider-rightHandle").removeClass("ui-rangeSlider-leftHandle")},_handleMoved:function(f,g){var e=this._values.min;var c=this._values.max;if(g.helper[0]==this.leftHandle[0]){e=this._getValue(g.position.left,this.leftHandle)}else{if(g.helper[0]==this.rightHandle[0]){c=this._getValue(g.position.left+g.helper.outerWidth(true),this.rightHandle)}else{return}}if(e>c){this._switchHandles();var d=e;e=c;c=d}this._privateValues(e,c)},_handleStop:function(c,d){this._position();this._prepareFiringChanged()},_changing:function(e,c){this._trigger("valuesChanging");var d=false;if(e&&!this.changing.min){this._trigger("minValueChanging");this.changing.min=true;d=true}if(c&&!this.changing.max){this._trigger("maxValueChanging");this.changing.max=true;d=true}if(d){this._showLabels()}},_prepareFiringChanged:function(){this.lastWheel=Math.random();var c=this.lastWheel;setTimeout(a.proxy(function(){this._fireChanged(c)},this),200)},_fireChanged:function(c){if(this.lastWheel==c&&!this.bar.hasClass("ui-draggable-dragging")&&!this.leftHandle.hasClass("ui-draggable-dragging")&&!this.rightHandle.hasClass("ui-draggable-dragging")){var d=false;if(this.changing.min){this.changing.min=false;this._trigger("minValueChanged");d=true}if(this.changing.max){this.changing.max=false;this._trigger("maxValueChanged");d=true}if(d){this._trigger("valuesChanged")}this._hideLabels()}},_setValuesHandles:function(d,c){this._setValues(d,c);this._positionHandles()},_setValues:function(f,c){var d=this._values;var g=Math.abs(c-f);if(g>=this.options.bounds.max-this.options.bounds.min){this._values.min=this.options.bounds.min;this._values.max=this.options.bounds.max}else{var e={min:Math.min(c,f),max:Math.max(f,c)};if(e.min<this.options.bounds.min){e.min=this.options.bounds.min;e.max=e.min+g}else{if(e.max>this.options.bounds.max){e.max=this.options.bounds.max;e.min=e.max-g}}this._values=e}this._changing(d.min!=this._values.min,d.max!=this._values.max);this._prepareFiringChanged()},_startScrollLeft:function(c,d){this.lastScroll=Math.random();this.scrollCount=0;this._continueScrollingRight(-1,this.lastScroll)},_startScrollRight:function(c,d){this.lastScroll=Math.random();this.scrollCount=0;this._continueScrollingRight(1,this.lastScroll)},_continueScrollingRight:function(e,d){if(d==this.lastScroll){var c=Math.min(Math.floor(this.scrollCount/5)+1,4)/4;this.scrollRight(e*c);this.scrollCount++;setTimeout(a.proxy(function(){this._continueScrollingRight(e,d)},this),50)}},_stopScroll:function(c,d){this.lastScroll=Math.random()},_wheelOnBar:function(e,f,d,c){if(this.options.wheelMode=="zoom"){this.zoomIn(-c);return false}},_wheelOnContainer:function(e,f,d,c){if(this.options.wheelMode=="scroll"){this.scrollRight(-c);return false}},_createLabel:function(c,d){if(c===null){c=a("<div class='ui-rangeSlider-label'/>").addClass(d).css("position","absolute");this.element.append(c);this._positionLabels()}return c},_destroyLabel:function(c){if(c!==null){c.remove();c=null}return c},_createLabels:function(){this.labels.left=this._createLabel(this.labels.left,"ui-rangeSlider-leftLabel");this.labels.right=this._createLabel(this.labels.right,"ui-rangeSlider-rightLabel");if(this.options.valueLabels=="change"){this.labels.left.css("display","none");this.labels.right.css("display","none");this.labels.leftDisplayed=false;this.labels.rightDisplayed=false}else{this.labels.leftDisplayed=true;this.labels.rightDisplayed=true;this.labels.left.css("display","block");this.labels.right.css("display","block");this._position()}},_destroyLabels:function(){this.labels.left=this._destroyLabel(this.labels.left);this.labels.right=this._destroyLabel(this.labels.right)},_positionLabel:function(e,c){var d=this.leftHandle.offset().top-e.outerHeight(true);var g=e.offsetParent();var f=c-g.offset().left;d=d-g.offset().top;e.css("left",f).css("top",d)},_positionLabels:function(){if(this.labels.left!==null&&this.labels.right!==null){this.labels.left.text(this._format(this._values.min));this.labels.right.text(this._format(this._values.max));var g=this.labels.leftDisplayed?this.labels.left.outerWidth(true):0;var i=this.labels.rightDisplayed?this.labels.right.outerWidth(true):0;var e=0;var h=a(window).width()-i;var c=Math.max(e,this.leftHandle.offset().left+this.leftHandle.outerWidth(true)/2-g/2);var d=Math.min(h,this.rightHandle.offset().left+this.rightHandle.outerWidth(true)/2-i/2);if(c+g>=d){var f=c+g-d;c=Math.max(e,c-f/2);d=Math.min(h,c+g);c=Math.max(e,d-g)}if(this.labels.leftDisplayed){this._positionLabel(this.labels.left,c)}if(this.labels.rightDisplayed){this._positionLabel(this.labels.right,d)}}},_format:function(c){if(typeof this.options.formatter!="undefined"&&this.options.formatter!==null){return this.options.formatter(c)}else{return this._defaultFormat(c)}},_defaultFormat:function(c){return Math.round(c)},_showLabels:function(){if(this.options.valueLabels=="change"&&!this.privateChange){if(this.changing.min&&!this.labels.leftDisplayed){this.labels.left.stop(true,true).fadeIn(this.options.durationIn);this.labels.leftDisplayed=true}if(this.changing.max&&!this.labels.rightDisplayed){this.labels.rightDisplayed=true;this.labels.right.stop(true,true).fadeIn(this.options.durationIn)}}},_hideLabels:function(){if(this.options.valueLabels=="change"&&this.labels.left!==null&&this.labels.right!==null){this.labels.leftDisplayed=false;this.labels.rightDisplayed=false;this.labels.left.stop(true,true).delay(this.options.delayOut).fadeOut(this.options.durationOut);this.labels.right.stop(true,true).delay(this.options.delayOut).fadeOut(this.options.durationOut)}},values:function(d,c){if(typeof d!="undefined"&&typeof c!="undefined"){this.internalChange=false;this._privateValues(d,c);this.internalChange=true}return this._values},min:function(c){return this.values(c,this._values.max).min},max:function(c){return this.values(this._values.min,c).max},zoomIn:function(f){var e=this._values.max-this._values.min;var d=this._values.min+f*this.options.wheelSpeed*e/200;var c=this._values.max-f*this.options.wheelSpeed*e/200;this._privateValues(d,c)},zoomOut:function(c){this.zoomIn(-c)},scrollLeft:function(c){if(typeof c=="undefined"){c=1}this.scrollRight(-c)},scrollRight:function(f){if(typeof f=="undefined"){f=1}var e=this._values.max-this._values.min;var d=this._values.min+f*this.options.wheelSpeed*e/100;var c=this._values.max+f*this.options.wheelSpeed*e/100;this._privateValues(d,c)},resize:function(){this._initWidth();this._position()},destroy:function(){this.element.removeClass("ui-rangeSlider-withArrows").removeClass("ui-rangeSlider-noArrow");this.bar.detach();this.leftHandle.detach();this.rightHandle.detach();this.innerBar.detach();this.container.detach();this.arrows.left.detach();this.arrows.right.detach();this.element.removeClass("ui-rangeSlider");this._destroyLabels();delete this.options;a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);