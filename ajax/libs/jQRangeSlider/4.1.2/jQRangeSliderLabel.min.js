(function(b,c){b.widget("ui.rangeSliderLabel",{options:{handle:null,formatter:false,handleType:"rangeSliderHandle",show:"show",durationIn:0,durationOut:500,delayOut:500,isLeft:false},cache:null,_positionner:null,_valueContainer:null,_innerElement:null,_create:function(){this.options.isLeft=this._handle("option","isLeft");this.element.addClass("ui-rangeSlider-label").css("position","absolute").css("display","block");this._valueContainer=b("<div class='ui-rangeSlider-label-value' />").appendTo(this.element);this._innerElement=b("<div class='ui-rangeSlider-label-inner' />").appendTo(this.element);this._toggleClass();this.options.handle.bind("moving",b.proxy(this._onMoving,this)).bind("update",b.proxy(this._onUpdate,this)).bind("switch",b.proxy(this._onSwitch,this));if(this.options.show!=="show"){this.element.hide()}},_handle:function(){var d=Array.prototype.slice.apply(arguments);return this.options.handle[this.options.handleType].apply(this.options.handle,d)},_setOption:function(d,e){if(d==="show"){this._updateShowOption(e)}else{if(d==="durationIn"||d==="durationOut"||d==="delayOut"){this._updateDurations(d,e)}}},_updateShowOption:function(d){this.options.show=d;if(this.options.show!=="show"){this.element.hide()}else{this.element.show();this._display(this.options.handle[this.options.handleType]("value"));this._positionner.PositionLabels()}this._positionner.options.show=this.options.show},_updateDurations:function(d,e){if(parseInt(e)!==e){return}this._positionner.options[d]=e;this.options[d]=e},_display:function(d){if(this.options.formatter==false){this._displayText(Math.round(d))}else{this._displayText(this.options.formatter(d))}},_displayText:function(d){this._valueContainer.text(d)},_toggleClass:function(){this.element.toggleClass("ui-rangeSlider-leftLabel",this.options.isLeft).toggleClass("ui-rangeSlider-rightLabel",!this.options.isLeft)},_onMoving:function(d,e){this._display(e.value)},_onUpdate:function(d,e){if(this.options.show==="show"){this._display(e.value)}},_onSwitch:function(d,e){this.options.isLeft=e;this._toggleClass();this._positionner.PositionLabels()},pair:function(d){if(this._positionner!=null){return}this._positionner=new a(this.element,d,this.widgetName,{show:this.options.show,durationIn:this.options.durationIn,durationOut:this.options.durationOut,delayOut:this.options.delayOut});d[this.widgetName]("positionner",this._positionner)},positionner:function(d){if(typeof d!=="undefined"){this._positionner=d}return this._positionner},update:function(){this._display(this._handle("value"));this._positionner.PositionLabels()}});function a(g,f,e,d){this.label1=g;this.label2=f;this.type=e;this.options=d;this.handle1=this.label1[this.type]("option","handle");this.handle2=this.label2[this.type]("option","handle");this.cache=null;this.left=g;this.right=f;this.moving=false;this.Init=function(){this.BindHandle(this.handle1);this.BindHandle(this.handle2);if(this.options.show==="show"){setTimeout(b.proxy(this.PositionLabels,this),1)}};this.Cache=function(){this.cache={};this.cache.label1={};this.cache.label2={};this.cache.handle1={};this.cache.handle2={};this.CacheElement(this.label1,this.cache.label1);this.CacheElement(this.label2,this.cache.label2);this.CacheElement(this.handle1,this.cache.handle1);this.CacheElement(this.handle2,this.cache.handle2)};this.CacheIfNecessary=function(){if(this.cache===null){this.Cache()}else{this.CacheWidth(this.label1,this.cache.label1);this.CacheWidth(this.label2,this.cache.label2);this.CacheHeight(this.label1,this.cache.label1);this.CacheHeight(this.label2,this.cache.label2)}};this.CacheElement=function(i,h){this.CacheWidth(i,h);this.CacheHeight(i,h);h.offset=i.offset();h.margin={left:this.ParsePixels("marginLeft",i),right:this.ParsePixels("marginRight",i)};h.border={left:this.ParsePixels("borderLeftWidth",i),right:this.ParsePixels("borderRightWidth",i)};h.outerWidth=h.width+h.margin.left+h.margin.right+h.border.left+h.border.right};this.CacheWidth=function(i,h){h.width=i.width();h.outerWidth=i.outerWidth()};this.CacheHeight=function(i,h){h.outerHeightMargin=i.outerHeight(true)},this.ParsePixels=function(h,i){return parseInt(i.css(h),10)||0};this.BindHandle=function(h){h.bind("moving update",b.proxy(this.onHandleMoving,this));h.bind("stop",b.proxy(this.onHandleStop,this))};this.PositionLabels=function(){this.CacheIfNecessary();var h=this.GetRawPosition(this.cache.label1,this.cache.handle1),i=this.GetRawPosition(this.cache.label2,this.cache.handle2);this.ConstraintPositions(h,i);this.label1.offset({left:h.left});this.label2.offset({left:i.left})};this.ConstraintPositions=function(i,h){if(i.center<h.center&&i.outerRight>h.outerLeft){i=this.getLeftPosition(i,h);h=this.getRightPosition(i,h)}else{if(i.center>h.center&&h.outerRight>i.outerLeft){h=this.getLeftPosition(h,i);i=this.getRightPosition(h,i)}}};this.getLeftPosition=function(k,j){var h=(j.center+k.center)/2,i=h-k.cache.outerWidth-k.cache.margin.right+k.cache.border.left;k.left=i;return k};this.getRightPosition=function(j,i){var h=(i.center+j.center)/2;i.left=h+i.cache.margin.left+i.cache.border.left;return i};this.ShowIfNecessary=function(){if(this.options.show==="show"||this.moving){return}this.label1.stop().fadeIn(this.options.durationIn||0);this.label2.stop().fadeIn(this.options.durationIn||0);this.moving=true},this.HideIfNeeded=function(h){if(this.moving===true){this.label1.stop().delay(this.options.delayOut||0).fadeOut(this.options.durationOut||0);this.label2.stop().delay(this.options.delayOut||0).fadeOut(this.options.durationOut||0);this.moving=false}},this.onHandleMoving=function(h,i){this.CacheIfNecessary();this.ShowIfNecessary();this.UpdateHandlePosition(i);this.PositionLabels()};this.onHandleStop=function(h,i){this.HideIfNeeded()},this.UpdateHandlePosition=function(h){if(h.element[0]==this.handle1[0]){this.UpdatePosition(h,this.cache.handle1)}else{this.UpdatePosition(h,this.cache.handle2)}};this.UpdatePosition=function(i,h){h.offset=i.offset};this.GetRawPosition=function(l,m){var h=m.offset.left+m.outerWidth/2,j=h-l.outerWidth/2,n=j+l.outerWidth-l.border.left-l.border.right,i=j-l.margin.left-l.border.left,k=m.offset.top-l.outerHeightMargin;return{left:j,outerLeft:i,top:k,right:n,outerRight:i+l.outerWidth+l.margin.left+l.margin.right,cache:l,center:h}};this.Init()}})(jQuery);