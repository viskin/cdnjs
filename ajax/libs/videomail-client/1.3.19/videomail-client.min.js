require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function Foo(){}try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};arr.constructor=Foo;return arr.foo()===42&&arr.constructor===Foo&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);return new Buffer(arg)}this.length=0;this.parent=undefined;if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"&&object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=Buffer._augment(new Uint8Array(length))}else{that.length=length;that._isBuffer=true}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;var i=0;var len=Math.min(x,y);while(i<len){if(a[i]!==b[i])break;++i}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{target._set(this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":3,ieee754:4,"is-array":5}],3:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],5:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],6:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],7:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],8:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],9:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){currentQueue[queueIndex].run()}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],10:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":11}],11:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":13,"./_stream_writable":15,"core-util-is":16,inherits:7,"process-nextick-args":17}],12:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":14,"core-util-is":16,inherits:7}],13:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var util=require("core-util-is");util.inherits=require("inherits");var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else{return state.length}}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":11,_process:9,buffer:2,"core-util-is":16,events:6,inherits:7,isarray:8,"process-nextick-args":17,"string_decoder/":24,util:1}],14:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":11,"core-util-is":16,inherits:7}],15:[function(require,module,exports){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use "+"_writableState.getBuffer() instead.")})}catch(_){}})();function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){processNextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var buffer=[];var cbs=[];while(entry){cbs.push(entry.callback);buffer.push(entry);entry=entry.next}state.pendingcb++;state.lastBufferedRequest=null;doWrite(stream,state,true,state.length,buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}})}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){
var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true}},{"./_stream_duplex":11,buffer:2,"core-util-is":16,events:6,inherits:7,"process-nextick-args":17,"util-deprecate":18}],16:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:2}],17:[function(require,module,exports){(function(process){"use strict";module.exports=nextTick;function nextTick(fn){var args=new Array(arguments.length-1);var i=0;while(i<arguments.length){args[i++]=arguments[i]}process.nextTick(function afterTick(){fn.apply(null,args)})}}).call(this,require("_process"))},{_process:9}],18:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){if(!global.localStorage)return false;var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],19:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":12}],20:[function(require,module,exports){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":11,"./lib/_stream_passthrough.js":12,"./lib/_stream_readable.js":13,"./lib/_stream_transform.js":14,"./lib/_stream_writable.js":15}],21:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":14}],22:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":15}],23:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:6,inherits:7,"readable-stream/duplex.js":10,"readable-stream/passthrough.js":19,"readable-stream/readable.js":20,"readable-stream/transform.js":21,"readable-stream/writable.js":22}],24:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:2}],25:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],26:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":25,_process:9,inherits:7}],27:[function(require,module,exports){var toBuffer=require("typedarray-to-buffer"),isBrowser=typeof document!=="undefined"&&typeof document.createElement==="function",verifiedImageType;module.exports=function(canvas,options){var self=this,quality;options=options?options:{};options.image=options.image?options.image:{};options.image.types=options.image.types?options.image.types:[];if(options.image.types.length>2)throw new Error("Too many image types are specified!");else if(options.image.types.length<1){options.image.types=isBrowser?["webp","jpeg"]:["png"]}if(!options.image.quality)options.image.quality=.5;quality=parseFloat(options.image.quality);function composeImageType(index){var imageType;if(options.image.types[index])imageType="image/"+options.image.types[index];return imageType}function isMatch(uri,imageType){var match=uri&&uri.match(imageType);match&&options.debug&&options.debug("Image type %s verified",imageType);return match}function getTestCanvas(){var testCanvas;if(isBrowser){testCanvas=document.createElement("canvas");testCanvas.width=testCanvas.height=1}else testCanvas=canvas;return testCanvas}function canvasSupportsImageTypeAsync(imageType,cb){try{getTestCanvas().toDataURL(imageType,function(err,uri){if(err)cb(err);else cb(null,isMatch(uri,imageType))})}catch(exc){cb(null,false)}}function canvasSupportsImageTypeSync(imageType){var match;try{var testCanvas=getTestCanvas(),uri=testCanvas.toDataURL&&testCanvas.toDataURL(imageType);match=isMatch(uri,imageType)}catch(exc){options.debug&&options.logger.debug("Failed to call toDataURL() on canvas for image type %s",imageType)}return match}function verifyImageTypeAsync(imageType,cb){canvasSupportsImageTypeAsync(imageType,function(err,match){if(err)cb(err);else{if(match)cb(null,imageType);else{imageType=composeImageType(1);canvasSupportsImageTypeAsync(imageType,function(err,match){if(err)cb(err);else cb(null,match?imageType:null)})}}})}function verifyImageTypeSync(imageType){if(!canvasSupportsImageTypeSync(imageType)){if(options.image.types[1]){imageType=composeImageType(1);if(!canvasSupportsImageTypeSync(imageType))imageType=null}else imageType=null}!imageType&&options.debug&&options.logger.debug("Unable to verify image type");return imageType}function verifyImageType(cb){var imageType=composeImageType(0);if(cb){verifyImageTypeAsync(imageType,cb)}else{return verifyImageTypeSync(imageType)}}function uriToBuffer(uri){var uri=uri.split(",")[1],bytes;if(typeof atob==="function")bytes=atob(uri);else if(typeof self.constructor.atob==="function")bytes=self.constructor.atob(uri);else throw new Error("atob function is missing");var arr=new Uint8Array(bytes.length);for(var i=0,l=bytes.length;i<l;i++){arr[i]=bytes.charCodeAt(i)}return toBuffer(arr)}function toBufferSync(){var imageType=self.getImageType(),buffer;if(imageType){var uri=canvas.toDataURL(imageType,quality);buffer=uriToBuffer(uri)}return buffer}function toBufferAsync(cb){self.getImageType(function(err,imageType){if(err)cb(err);else if(!imageType)cb();else canvas.toDataURL(imageType,function(err,uri){if(err)cb(err);else cb(null,uriToBuffer(uri))})})}this.toBuffer=function(cb){if(cb)toBufferAsync(cb);else return toBufferSync()};this.getImageType=function(cb){if(cb){if(!verifiedImageType||!isBrowser)verifyImageType(function(err,newVerifiedImageType){if(err)cb(err);else{verifiedImageType=newVerifiedImageType;cb(null,verifiedImageType)}});else cb(null,verifiedImageType)}else{if(!verifiedImageType||!isBrowser)verifiedImageType=verifyImageType();return verifiedImageType}}}},{"typedarray-to-buffer":47}],28:[function(require,module,exports){(function(factory){"use strict";factory(function(){var toString=Object.prototype.toString;return function(){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}var name=getName(args);var target=getTarget(args);var properties=getProps(args);function ErrorCtor(message,obj){attachProps(this,properties);attachProps(this,obj);this.message=message||this.message;if(message instanceof Error){this.message=message.message;this.stack=message.stack}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}function Err(){this.constructor=ErrorCtor}Err.prototype=target["prototype"];ErrorCtor.prototype=new Err;ErrorCtor.prototype.name=""+name||"CustomError";return ErrorCtor};function getName(args){if(args.length===0)return"";return isError(args[0])?args[1]||"":args[0]}function getTarget(args){if(args.length===0)return Error;return isError(args[0])?args[0]:Error}function getProps(args){if(args.length===0)return null;return isError(args[0])?args[2]:args[1]}function inheritedKeys(obj){var ret=[];for(var key in obj){ret.push(key)}return ret}function isError(obj){return typeof obj==="function"}function isObject(obj){return obj&&typeof obj==="object"&&toString.call(obj)==="[object Object]"}function attachProps(context,target){if(isObject(target)){var keys=inheritedKeys(target);for(var i=0,l=keys.length;i<l;++i){context[keys[i]]=clone(target[keys[i]])}}}function clone(target){if(target==null||typeof target!=="object")return target;var cloned=target.constructor?target.constructor():Object.create(null);for(var attr in target){if(target.hasOwnProperty(attr)){cloned[attr]=target[attr]}}return cloned}})})(function(createErrorLib){if(typeof define==="function"&&define.amd){define(createErrorLib)}else if(typeof exports==="object"){module.exports=createErrorLib()}else{var root=this;var lastcreateError=root.createError;var createError=root.createError=createErrorLib();createError.noConflict=function(){root.createError=lastcreateError;return createError}}})},{}],29:[function(require,module,exports){if(typeof self!=="undefined"&&"document"in self){if(!("classList"in document.createElement("_"))){(function(view){if(!("Element"in view))return;var classListProp="classList",protoProp="prototype",elemCtrProto=view.Element[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(item){var i=0,len=this.length;for(;i<len;i++){if(i in this&&this[i]===item){return i}}return-1},DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message},checkTokenAndGetIndex=function(classList,token){if(token===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(token)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character")}return arrIndexOf.call(classList,token)},ClassList=function(elem){var trimmedClasses=strTrim.call(elem.getAttribute("class")||""),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;for(;i<len;i++){this.push(classes[i])}this._updateClassName=function(){elem.setAttribute("class",this.toString())}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};DOMEx[protoProp]=Error[protoProp];classListProto.item=function(i){return this[i]||null};classListProto.contains=function(token){token+="";return checkTokenAndGetIndex(this,token)!==-1};classListProto.add=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true}}while(++i<l);if(updated){this._updateClassName()}};classListProto.remove=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false,index;do{token=tokens[i]+"";index=checkTokenAndGetIndex(this,token);while(index!==-1){this.splice(index,1);updated=true;index=checkTokenAndGetIndex(this,token)}}while(++i<l);if(updated){this._updateClassName()}};classListProto.toggle=function(token,force){token+="";var result=this.contains(token),method=result?force!==true&&"remove":force!==false&&"add";if(method){this[method](token)}if(force===true||force===false){return force}else{return!result}};classListProto.toString=function(){return this.join(" ")};if(objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:true,configurable:true};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){if(ex.number===-2146823252){classListPropDesc.enumerable=false;objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}}}else if(objCtr[protoProp].__defineGetter__){elemCtrProto.__defineGetter__(classListProp,classListGetter)}})(self)}else{(function(){"use strict";var testElement=document.createElement("_");testElement.classList.add("c1","c2");if(!testElement.classList.contains("c2")){var createMethod=function(method){var original=DOMTokenList.prototype[method];DOMTokenList.prototype[method]=function(token){var i,len=arguments.length;for(i=0;i<len;i++){token=arguments[i];original.call(this,token)}}};createMethod("add");createMethod("remove")}testElement.classList.toggle("c3",false);if(testElement.classList.contains("c3")){var _toggle=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(token,force){if(1 in arguments&&!this.contains(token)===!force){return force}else{return _toggle.call(this,token)}}}testElement=null})()}}},{}],30:[function(require,module,exports){var util=require("util"),events=require("events"),EventEmitter=events.EventEmitter;module.exports=function(){var Despot=function(){if(arguments.callee._singletonInstance){return arguments.callee._singletonInstance}arguments.callee._singletonInstance=this;EventEmitter.call(this)};util.inherits(Despot,EventEmitter);return new Despot}()},{events:6,util:26}],31:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.returnExports=factory()}})(this,function(){var $Array=Array;var ArrayPrototype=$Array.prototype;var $Object=Object;var ObjectPrototype=$Object.prototype;var FunctionPrototype=Function.prototype;var $String=String;var StringPrototype=$String.prototype;var $Number=Number;var NumberPrototype=$Number.prototype;var array_slice=ArrayPrototype.slice;var array_splice=ArrayPrototype.splice;var array_push=ArrayPrototype.push;var array_unshift=ArrayPrototype.unshift;var array_concat=ArrayPrototype.concat;var call=FunctionPrototype.call;var max=Math.max;var min=Math.min;var to_string=ObjectPrototype.toString;var hasToStringTag=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var isCallable;var fnToStr=Function.prototype.toString,tryFunctionObject=function tryFunctionObject(value){try{fnToStr.call(value);return true}catch(e){return false}},fnClass="[object Function]",genClass="[object GeneratorFunction]";isCallable=function isCallable(value){if(typeof value!=="function"){return false}if(hasToStringTag){return tryFunctionObject(value)}var strClass=to_string.call(value);return strClass===fnClass||strClass===genClass};var isRegex;var regexExec=RegExp.prototype.exec,tryRegexExec=function tryRegexExec(value){try{regexExec.call(value);return true}catch(e){return false}},regexClass="[object RegExp]";isRegex=function isRegex(value){if(typeof value!=="object"){return false}return hasToStringTag?tryRegexExec(value):to_string.call(value)===regexClass};var isString;var strValue=String.prototype.valueOf,tryStringObject=function tryStringObject(value){try{strValue.call(value);return true}catch(e){return false}},stringClass="[object String]";isString=function isString(value){if(typeof value==="string"){return true}if(typeof value!=="object"){return false}return hasToStringTag?tryStringObject(value):to_string.call(value)===stringClass};var defineProperties=function(has){var supportsDescriptors=$Object.defineProperty&&function(){try{var obj={};$Object.defineProperty(obj,"x",{enumerable:false,value:obj});for(var _ in obj){return false}return obj.x===obj}catch(e){return false}}();var defineProperty;if(supportsDescriptors){defineProperty=function(object,name,method,forceAssign){if(!forceAssign&&name in object){return}$Object.defineProperty(object,name,{configurable:true,enumerable:false,writable:true,value:method})}}else{defineProperty=function(object,name,method,forceAssign){if(!forceAssign&&name in object){return}object[name]=method}}return function defineProperties(object,map,forceAssign){for(var name in map){if(has.call(map,name)){defineProperty(object,name,map[name],forceAssign)}}}}(ObjectPrototype.hasOwnProperty);var isPrimitive=function isPrimitive(input){var type=typeof input;return input===null||type!=="object"&&type!=="function"};var ES={ToInteger:function ToInteger(num){var n=+num;if(n!==n){n=0}else if(n!==0&&n!==1/0&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n))}return n},ToPrimitive:function ToPrimitive(input){var val,valueOf,toStr;if(isPrimitive(input)){return input}valueOf=input.valueOf;if(isCallable(valueOf)){val=valueOf.call(input);if(isPrimitive(val)){return val}}toStr=input.toString;if(isCallable(toStr)){val=toStr.call(input);if(isPrimitive(val)){return val}}throw new TypeError},ToObject:function(o){if(o==null){throw new TypeError("can't convert "+o+" to object")}return $Object(o)},ToUint32:function ToUint32(x){return x>>>0}};var Empty=function Empty(){};defineProperties(FunctionPrototype,{bind:function bind(that){var target=this;if(!isCallable(target)){throw new TypeError("Function.prototype.bind called on incompatible "+target)}var args=array_slice.call(arguments,1);var bound;var binder=function(){if(this instanceof bound){var result=target.apply(this,array_concat.call(args,array_slice.call(arguments)));if($Object(result)===result){return result}return this}else{return target.apply(that,array_concat.call(args,array_slice.call(arguments)))}};var boundLength=max(0,target.length-args.length);var boundArgs=[];for(var i=0;i<boundLength;i++){
array_push.call(boundArgs,"$"+i)}bound=Function("binder","return function ("+boundArgs.join(",")+"){ return binder.apply(this, arguments); }")(binder);if(target.prototype){Empty.prototype=target.prototype;bound.prototype=new Empty;Empty.prototype=null}return bound}});var owns=call.bind(ObjectPrototype.hasOwnProperty);var toStr=call.bind(ObjectPrototype.toString);var strSlice=call.bind(StringPrototype.slice);var strSplit=call.bind(StringPrototype.split);var isArray=$Array.isArray||function isArray(obj){return toStr(obj)==="[object Array]"};var hasUnshiftReturnValueBug=[].unshift(0)!==1;defineProperties(ArrayPrototype,{unshift:function(){array_unshift.apply(this,arguments);return this.length}},hasUnshiftReturnValueBug);defineProperties($Array,{isArray:isArray});var boxedString=$Object("a");var splitString=boxedString[0]!=="a"||!(0 in boxedString);var properlyBoxesContext=function properlyBoxed(method){var properlyBoxesNonStrict=true;var properlyBoxesStrict=true;if(method){method.call("foo",function(_,__,context){if(typeof context!=="object"){properlyBoxesNonStrict=false}});method.call([1],function(){"use strict";properlyBoxesStrict=typeof this==="string"},"x")}return!!method&&properlyBoxesNonStrict&&properlyBoxesStrict};defineProperties(ArrayPrototype,{forEach:function forEach(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var i=-1;var length=self.length>>>0;var T;if(arguments.length>1){T=arguments[1]}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++i<length){if(i in self){if(typeof T!=="undefined"){callbackfn.call(T,self[i],i,object)}else{callbackfn(self[i],i,object)}}}}},!properlyBoxesContext(ArrayPrototype.forEach));defineProperties(ArrayPrototype,{map:function map(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;var result=$Array(length);var T;if(arguments.length>1){T=arguments[1]}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.map callback must be a function")}for(var i=0;i<length;i++){if(i in self){if(typeof T!=="undefined"){result[i]=callbackfn.call(T,self[i],i,object)}else{result[i]=callbackfn(self[i],i,object)}}}return result}},!properlyBoxesContext(ArrayPrototype.map));defineProperties(ArrayPrototype,{filter:function filter(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;var result=[];var value;var T;if(arguments.length>1){T=arguments[1]}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var i=0;i<length;i++){if(i in self){value=self[i];if(typeof T==="undefined"?callbackfn(value,i,object):callbackfn.call(T,value,i,object)){array_push.call(result,value)}}}return result}},!properlyBoxesContext(ArrayPrototype.filter));defineProperties(ArrayPrototype,{every:function every(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;var T;if(arguments.length>1){T=arguments[1]}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.every callback must be a function")}for(var i=0;i<length;i++){if(i in self&&!(typeof T==="undefined"?callbackfn(self[i],i,object):callbackfn.call(T,self[i],i,object))){return false}}return true}},!properlyBoxesContext(ArrayPrototype.every));defineProperties(ArrayPrototype,{some:function some(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;var T;if(arguments.length>1){T=arguments[1]}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.some callback must be a function")}for(var i=0;i<length;i++){if(i in self&&(typeof T==="undefined"?callbackfn(self[i],i,object):callbackfn.call(T,self[i],i,object))){return true}}return false}},!properlyBoxesContext(ArrayPrototype.some));var reduceCoercesToObject=false;if(ArrayPrototype.reduce){reduceCoercesToObject=typeof ArrayPrototype.reduce.call("es5",function(_,__,___,list){return list})==="object"}defineProperties(ArrayPrototype,{reduce:function reduce(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(length===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var result;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i++];break}if(++i>=length){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<length;i++){if(i in self){result=callbackfn(result,self[i],i,object)}}return result}},!reduceCoercesToObject);var reduceRightCoercesToObject=false;if(ArrayPrototype.reduceRight){reduceRightCoercesToObject=typeof ArrayPrototype.reduceRight.call("es5",function(_,__,___,list){return list})==="object"}defineProperties(ArrayPrototype,{reduceRight:function reduceRight(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=self.length>>>0;if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(length===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var result;var i=length-1;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i--];break}if(--i<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(i<0){return result}do{if(i in self){result=callbackfn(result,self[i],i,object)}}while(i--);return result}},!reduceRightCoercesToObject);var hasFirefox2IndexOfBug=ArrayPrototype.indexOf&&[0,1].indexOf(1,2)!==-1;defineProperties(ArrayPrototype,{indexOf:function indexOf(searchElement){var self=splitString&&isString(this)?strSplit(this,""):ES.ToObject(this);var length=self.length>>>0;if(length===0){return-1}var i=0;if(arguments.length>1){i=ES.ToInteger(arguments[1])}i=i>=0?i:max(0,length+i);for(;i<length;i++){if(i in self&&self[i]===searchElement){return i}}return-1}},hasFirefox2IndexOfBug);var hasFirefox2LastIndexOfBug=ArrayPrototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;defineProperties(ArrayPrototype,{lastIndexOf:function lastIndexOf(searchElement){var self=splitString&&isString(this)?strSplit(this,""):ES.ToObject(this);var length=self.length>>>0;if(length===0){return-1}var i=length-1;if(arguments.length>1){i=min(i,ES.ToInteger(arguments[1]))}i=i>=0?i:length-Math.abs(i);for(;i>=0;i--){if(i in self&&searchElement===self[i]){return i}}return-1}},hasFirefox2LastIndexOfBug);var spliceNoopReturnsEmptyArray=function(){var a=[1,2];var result=a.splice();return a.length===2&&isArray(result)&&result.length===0}();defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){if(arguments.length===0){return[]}else{return array_splice.apply(this,arguments)}}},!spliceNoopReturnsEmptyArray);var spliceWorksWithEmptyObject=function(){var obj={};ArrayPrototype.splice.call(obj,0,0,1);return obj.length===1}();defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){if(arguments.length===0){return[]}var args=arguments;this.length=max(ES.ToInteger(this.length),0);if(arguments.length>0&&typeof deleteCount!=="number"){args=array_slice.call(arguments);if(args.length<2){array_push.call(args,this.length-start)}else{args[1]=ES.ToInteger(deleteCount)}}return array_splice.apply(this,args)}},!spliceWorksWithEmptyObject);var spliceWorksWithLargeSparseArrays=function(){var arr=new $Array(1e5);arr[8]="x";arr.splice(1,1);return arr.indexOf("x")===7}();var spliceWorksWithSmallSparseArrays=function(){var n=256;var arr=[];arr[n]="a";arr.splice(n+1,0,"b");return arr[n]==="a"}();defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){var O=ES.ToObject(this);var A=[];var len=ES.ToUint32(O.length);var relativeStart=ES.ToInteger(start);var actualStart=relativeStart<0?max(len+relativeStart,0):min(relativeStart,len);var actualDeleteCount=min(max(ES.ToInteger(deleteCount),0),len-actualStart);var k=0;var from;while(k<actualDeleteCount){from=$String(actualStart+k);if(owns(O,from)){A[k]=O[from]}k+=1}var items=array_slice.call(arguments,2);var itemCount=items.length;var to;if(itemCount<actualDeleteCount){k=actualStart;while(k<len-actualDeleteCount){from=$String(k+actualDeleteCount);to=$String(k+itemCount);if(owns(O,from)){O[to]=O[from]}else{delete O[to]}k+=1}k=len;while(k>len-actualDeleteCount+itemCount){delete O[k-1];k-=1}}else if(itemCount>actualDeleteCount){k=len-actualDeleteCount;while(k>actualStart){from=$String(k+actualDeleteCount-1);to=$String(k+itemCount-1);if(owns(O,from)){O[to]=O[from]}else{delete O[to]}k-=1}}k=actualStart;for(var i=0;i<items.length;++i){O[k]=items[i];k+=1}O.length=len-actualDeleteCount+itemCount;return A}},!spliceWorksWithLargeSparseArrays||!spliceWorksWithSmallSparseArrays);var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString");var hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype");var hasStringEnumBug=!owns("x","0");var equalsConstructorPrototype=function(o){var ctor=o.constructor;return ctor&&ctor.prototype===o};var blacklistedKeys={$window:true,$console:true,$parent:true,$self:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true};var hasAutomationEqualityBug=function(){if(typeof window==="undefined"){return false}for(var k in window){if(!blacklistedKeys["$"+k]&&owns(window,k)&&window[k]!==null&&typeof window[k]==="object"){try{equalsConstructorPrototype(window[k])}catch(e){return true}}}return false}();var equalsConstructorPrototypeIfNotBuggy=function(object){if(typeof window==="undefined"||!hasAutomationEqualityBug){return equalsConstructorPrototype(object)}try{return equalsConstructorPrototype(object)}catch(e){return false}};var dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var dontEnumsLength=dontEnums.length;var isArguments=function isArguments(value){var str=toStr(value);var isArgs=str==="[object Arguments]";if(!isArgs){isArgs=!isArray(value)&&value!==null&&typeof value==="object"&&typeof value.length==="number"&&value.length>=0&&isCallable(value.callee)}return isArgs};defineProperties($Object,{keys:function keys(object){var isFn=isCallable(object);var isArgs=isArguments(object);var isObject=object!==null&&typeof object==="object";var isStr=isObject&&isString(object);if(!isObject&&!isFn&&!isArgs){throw new TypeError("Object.keys called on a non-object")}var theKeys=[];var skipProto=hasProtoEnumBug&&isFn;if(isStr&&hasStringEnumBug||isArgs){for(var i=0;i<object.length;++i){array_push.call(theKeys,$String(i))}}if(!isArgs){for(var name in object){if(!(skipProto&&name==="prototype")&&owns(object,name)){array_push.call(theKeys,$String(name))}}}if(hasDontEnumBug){var skipConstructor=equalsConstructorPrototypeIfNotBuggy(object);for(var j=0;j<dontEnumsLength;j++){var dontEnum=dontEnums[j];if(!(skipConstructor&&dontEnum==="constructor")&&owns(object,dontEnum)){array_push.call(theKeys,dontEnum)}}}return theKeys}});var keysWorksWithArguments=$Object.keys&&function(){return $Object.keys(arguments).length===2}(1,2);var originalKeys=$Object.keys;defineProperties($Object,{keys:function keys(object){if(isArguments(object)){return originalKeys(array_slice.call(object))}else{return originalKeys(object)}}},!keysWorksWithArguments);var negativeDate=-621987552e5;var negativeYearString="-000001";var hasNegativeDateBug=Date.prototype.toISOString&&new Date(negativeDate).toISOString().indexOf(negativeYearString)===-1;var hasSafari51DateBug=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";defineProperties(Date.prototype,{toISOString:function toISOString(){var result,length,value,year,month;if(!isFinite(this)){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}year=this.getUTCFullYear();month=this.getUTCMonth();year+=Math.floor(month/12);month=(month%12+12)%12;result=[month+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];year=(year<0?"-":year>9999?"+":"")+strSlice("00000"+Math.abs(year),0<=year&&year<=9999?-4:-6);length=result.length;while(length--){value=result[length];if(value<10){result[length]="0"+value}}return year+"-"+array_slice.call(result,0,2).join("-")+"T"+array_slice.call(result,2).join(":")+"."+strSlice("000"+this.getUTCMilliseconds(),-3)+"Z"}},hasNegativeDateBug||hasSafari51DateBug);var dateToJSONIsSupported=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(negativeDate).toJSON().indexOf(negativeYearString)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(e){return false}}();if(!dateToJSONIsSupported){Date.prototype.toJSON=function toJSON(key){var O=$Object(this);var tv=ES.ToPrimitive(O);if(typeof tv==="number"&&!isFinite(tv)){return null}var toISO=O.toISOString;if(!isCallable(toISO)){throw new TypeError("toISOString property is not callable")}return toISO.call(O)}}var supportsExtendedYears=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var acceptsInvalidDates=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var doesNotParseY2KNewYear=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(!Date.parse||doesNotParseY2KNewYear||acceptsInvalidDates||!supportsExtendedYears){Date=function(NativeDate){var DateShim=function Date(Y,M,D,h,m,s,ms){var length=arguments.length;var date;if(this instanceof NativeDate){date=length===1&&$String(Y)===Y?new NativeDate(DateShim.parse(Y)):length>=7?new NativeDate(Y,M,D,h,m,s,ms):length>=6?new NativeDate(Y,M,D,h,m,s):length>=5?new NativeDate(Y,M,D,h,m):length>=4?new NativeDate(Y,M,D,h):length>=3?new NativeDate(Y,M,D):length>=2?new NativeDate(Y,M):length>=1?new NativeDate(Y):new NativeDate}else{date=NativeDate.apply(this,arguments)}defineProperties(date,{constructor:DateShim},true);return date};var isoDateExpression=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var months=[0,31,59,90,120,151,181,212,243,273,304,334,365];var dayFromMonth=function dayFromMonth(year,month){var t=month>1?1:0;return months[month]+Math.floor((year-1969+t)/4)-Math.floor((year-1901+t)/100)+Math.floor((year-1601+t)/400)+365*(year-1970)};var toUTC=function toUTC(t){return $Number(new NativeDate(1970,0,1,0,0,0,t))};for(var key in NativeDate){if(owns(NativeDate,key)){DateShim[key]=NativeDate[key]}}defineProperties(DateShim,{now:NativeDate.now,UTC:NativeDate.UTC},true);DateShim.prototype=NativeDate.prototype;defineProperties(DateShim.prototype,{constructor:DateShim},true);var parseShim=function parse(string){var match=isoDateExpression.exec(string);if(match){var year=$Number(match[1]),month=$Number(match[2]||1)-1,day=$Number(match[3]||1)-1,hour=$Number(match[4]||0),minute=$Number(match[5]||0),second=$Number(match[6]||0),millisecond=Math.floor($Number(match[7]||0)*1e3),isLocalTime=Boolean(match[4]&&!match[8]),signOffset=match[9]==="-"?1:-1,hourOffset=$Number(match[10]||0),minuteOffset=$Number(match[11]||0),result;if(hour<(minute>0||second>0||millisecond>0?24:25)&&minute<60&&second<60&&millisecond<1e3&&month>-1&&month<12&&hourOffset<24&&minuteOffset<60&&day>-1&&day<dayFromMonth(year,month+1)-dayFromMonth(year,month)){result=((dayFromMonth(year,month)+day)*24+hour+hourOffset*signOffset)*60;result=((result+minute+minuteOffset*signOffset)*60+second)*1e3+millisecond;if(isLocalTime){result=toUTC(result)}if(-864e13<=result&&result<=864e13){return result}}return NaN}return NativeDate.parse.apply(this,arguments)};defineProperties(DateShim,{parse:parseShim});return DateShim}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var hasToFixedBugs=NumberPrototype.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");var toFixedHelpers={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(n,c){var i=-1;var c2=c;while(++i<toFixedHelpers.size){c2+=n*toFixedHelpers.data[i];toFixedHelpers.data[i]=c2%toFixedHelpers.base;c2=Math.floor(c2/toFixedHelpers.base)}},divide:function divide(n){var i=toFixedHelpers.size,c=0;while(--i>=0){c+=toFixedHelpers.data[i];toFixedHelpers.data[i]=Math.floor(c/n);c=c%n*toFixedHelpers.base}},numToString:function numToString(){var i=toFixedHelpers.size;var s="";while(--i>=0){if(s!==""||i===0||toFixedHelpers.data[i]!==0){var t=$String(toFixedHelpers.data[i]);if(s===""){s=t}else{s+=strSlice("0000000",0,7-t.length)+t}}}return s},pow:function pow(x,n,acc){return n===0?acc:n%2===1?pow(x,n-1,acc*x):pow(x*x,n/2,acc)},log:function log(x){var n=0;var x2=x;while(x2>=4096){n+=12;x2/=4096}while(x2>=2){n+=1;x2/=2}return n}};defineProperties(NumberPrototype,{toFixed:function toFixed(fractionDigits){var f,x,s,m,e,z,j,k;f=$Number(fractionDigits);f=f!==f?0:Math.floor(f);if(f<0||f>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}x=$Number(this);if(x!==x){return"NaN"}if(x<=-1e21||x>=1e21){return $String(x)}s="";if(x<0){s="-";x=-x}m="0";if(x>1e-21){e=toFixedHelpers.log(x*toFixedHelpers.pow(2,69,1))-69;z=e<0?x*toFixedHelpers.pow(2,-e,1):x/toFixedHelpers.pow(2,e,1);z*=4503599627370496;e=52-e;if(e>0){toFixedHelpers.multiply(0,z);j=f;while(j>=7){toFixedHelpers.multiply(1e7,0);j-=7}toFixedHelpers.multiply(toFixedHelpers.pow(10,j,1),0);j=e-1;while(j>=23){toFixedHelpers.divide(1<<23);j-=23}toFixedHelpers.divide(1<<j);toFixedHelpers.multiply(1,1);toFixedHelpers.divide(2);m=toFixedHelpers.numToString()}else{toFixedHelpers.multiply(0,z);toFixedHelpers.multiply(1<<-e,0);m=toFixedHelpers.numToString()+strSlice("0.00000000000000000000",2,2+f)}}if(f>0){k=m.length;if(k<=f){m=s+strSlice("0.0000000000000000000",0,f-k+2)+m}else{m=s+strSlice(m,0,k-f)+"."+strSlice(m,k-f)}}else{m=s+m}return m}},hasToFixedBugs);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var compliantExecNpcg=typeof/()??/.exec("")[1]==="undefined";StringPrototype.split=function(separator,limit){var string=this;if(typeof separator==="undefined"&&limit===0){return[]}if(!isRegex(separator)){return strSplit(this,separator,limit)}var output=[];var flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":""),lastLastIndex=0,separator2,match,lastIndex,lastLength;var separatorCopy=new RegExp(separator.source,flags+"g");string+="";if(!compliantExecNpcg){separator2=new RegExp("^"+separatorCopy.source+"$(?!\\s)",flags)}var splitLimit=typeof limit==="undefined"?-1>>>0:ES.ToUint32(limit);match=separatorCopy.exec(string);while(match){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){array_push.call(output,strSlice(string,lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(typeof arguments[i]==="undefined"){match[i]=void 0}}})}if(match.length>1&&match.index<string.length){array_push.apply(output,array_slice.call(match,1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=splitLimit){break}}if(separatorCopy.lastIndex===match.index){separatorCopy.lastIndex++}match=separatorCopy.exec(string)}if(lastLastIndex===string.length){if(lastLength||!separatorCopy.test("")){array_push.call(output,"")}}else{array_push.call(output,strSlice(string,lastLastIndex))}return output.length>splitLimit?strSlice(output,0,splitLimit):output}})()}else if("0".split(void 0,0).length){StringPrototype.split=function split(separator,limit){if(typeof separator==="undefined"&&limit===0){return[]}return strSplit(this,separator,limit)}}var str_replace=StringPrototype.replace;var replaceReportsGroupsCorrectly=function(){var groups=[];"x".replace(/x(.)?/g,function(match,group){array_push.call(groups,group)});return groups.length===1&&typeof groups[0]==="undefined"}();if(!replaceReportsGroupsCorrectly){StringPrototype.replace=function replace(searchValue,replaceValue){var isFn=isCallable(replaceValue);var hasCapturingGroups=isRegex(searchValue)&&/\)[*?]/.test(searchValue.source);if(!isFn||!hasCapturingGroups){return str_replace.call(this,searchValue,replaceValue)}else{var wrappedReplaceValue=function(match){var length=arguments.length;var originalLastIndex=searchValue.lastIndex;searchValue.lastIndex=0;var args=searchValue.exec(match)||[];searchValue.lastIndex=originalLastIndex;array_push.call(args,arguments[length-2],arguments[length-1]);return replaceValue.apply(this,args)};return str_replace.call(this,searchValue,wrappedReplaceValue)}}}var string_substr=StringPrototype.substr;var hasNegativeSubstrBug="".substr&&"0b".substr(-1)!=="b";defineProperties(StringPrototype,{substr:function substr(start,length){var normalizedStart=start;if(start<0){normalizedStart=max(this.length+start,0)}return string_substr.call(this,normalizedStart,length)}},hasNegativeSubstrBug);var ws="	\n\f\r   ᠎    "+"         　\u2028"+"\u2029\ufeff";var zeroWidth="​";var wsRegexChars="["+ws+"]";var trimBeginRegexp=new RegExp("^"+wsRegexChars+wsRegexChars+"*");var trimEndRegexp=new RegExp(wsRegexChars+wsRegexChars+"*$");var hasTrimWhitespaceBug=StringPrototype.trim&&(ws.trim()||!zeroWidth.trim());defineProperties(StringPrototype,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return $String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}},hasTrimWhitespaceBug);if(parseInt(ws+"08")!==8||parseInt(ws+"0x16")!==22){parseInt=function(origParseInt){var hexRegex=/^0[xX]/;return function parseInt(str,radix){var string=$String(str).trim();var defaultedRadix=$Number(radix)||(hexRegex.test(string)?16:10);return origParseInt(string,defaultedRadix)}}(parseInt)}})},{}],32:[function(require,module,exports){(function(global){"use strict";(function(global){var bit=/b$/;var si={bits:["B","kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","kB","MB","GB","TB","PB","EB","ZB","YB"]};var filesize=function(arg){var descriptor=arguments[1]===undefined?{}:arguments[1];var result=[];var skip=false;var val=0;var e=undefined,base=undefined,bits=undefined,ceil=undefined,neg=undefined,num=undefined,output=undefined,round=undefined,unix=undefined,spacer=undefined,suffixes=undefined;if(isNaN(arg)){throw new Error("Invalid arguments")}bits=descriptor.bits===true;unix=descriptor.unix===true;base=descriptor.base!==undefined?descriptor.base:2;round=descriptor.round!==undefined?descriptor.round:unix?1:2;spacer=descriptor.spacer!==undefined?descriptor.spacer:unix?"":" ";suffixes=descriptor.suffixes!==undefined?descriptor.suffixes:{};output=descriptor.output!==undefined?descriptor.output:"string";e=descriptor.exponent!==undefined?descriptor.exponent:-1;num=Number(arg);neg=num<0;ceil=base>2?1e3:1024;if(neg){num=-num}if(num===0){result[0]=0;if(unix){result[1]=""}else{result[1]="B"}}else{if(e===-1||isNaN(e)){e=Math.floor(Math.log(num)/Math.log(ceil))}if(e>8){val=val*(1e3*(e-8));e=8}if(base===2){val=num/Math.pow(2,e*10)}else{val=num/Math.pow(1e3,e)}if(bits){val=val*8;if(val>ceil){val=val/ceil;e++}}result[0]=Number(val.toFixed(e>0?round:0));result[1]=si[bits?"bits":"bytes"][e];if(!skip&&unix){if(bits&&bit.test(result[1])){result[1]=result[1].toLowerCase()}result[1]=result[1].charAt(0);if(result[1]==="B"){result[0]=Math.floor(result[0]);result[1]=""}else if(!bits&&result[1]==="k"){result[1]="K"}}}if(neg){result[0]=-result[0]}result[1]=suffixes[result[1]]||result[1];if(output==="array"){return result}if(output==="exponent"){return e}if(output==="object"){return{value:result[0],suffix:result[1]}}return result.join(spacer)};if(typeof exports!=="undefined"){module.exports=filesize}else if(typeof define==="function"){define(function(){return filesize})}else{global.filesize=filesize}})(typeof global!=="undefined"?global:window)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],33:[function(require,module,exports){(function(global){var UNITS={y:315576e5,mo:26298e5,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1};var languages={ar:{y:function(c){return c===1?"سنة":"سنوات"},mo:function(c){return c===1?"شهر":"أشهر"},w:function(c){return c===1?"أسبوع":"أسابيع"},d:function(c){return c===1?"يوم":"أيام"},h:function(c){return c===1?"ساعة":"ساعات"},m:function(c){return c===1?"دقيقة":"دقائق"},s:function(c){return c===1?"ثانية":"ثواني"},ms:function(c){return c===1?"جزء من الثانية":"أجزاء من الثانية"},decimal:","},ca:{y:function(c){return"any"+(c!==1?"s":"")},mo:function(c){return"mes"+(c!==1?"os":"")},w:function(c){return"setman"+(c!==1?"es":"a")},d:function(c){return"di"+(c!==1?"es":"a")},h:function(c){return"hor"+(c!==1?"es":"a")},m:function(c){return"minut"+(c!==1?"s":"")},s:function(c){return"segon"+(c!==1?"s":"")},ms:function(c){return"milisegon"+(c!==1?"s":"")},decimal:","},da:{y:"år",mo:function(c){return"måned"+(c!==1?"er":"")},w:function(c){return"uge"+(c!==1?"r":"")},d:function(c){return"dag"+(c!==1?"e":"")},h:function(c){return"time"+(c!==1?"r":"")},m:function(c){return"minut"+(c!==1?"ter":"")},s:function(c){return"sekund"+(c!==1?"er":"")},ms:function(c){return"millisekund"+(c!==1?"er":"")},decimal:","},de:{y:function(c){return"Jahr"+(c!==1?"e":"")},mo:function(c){return"Monat"+(c!==1?"e":"")},w:function(c){return"Woche"+(c!==1?"n":"")},d:function(c){return"Tag"+(c!==1?"e":"")},h:function(c){return"Stunde"+(c!==1?"n":"")},m:function(c){return"Minute"+(c!==1?"n":"")},s:function(c){return"Sekunde"+(c!==1?"n":"")},ms:function(c){return"Millisekunde"+(c!==1?"n":"")},decimal:","},en:{y:function(c){return"year"+(c!==1?"s":"")},mo:function(c){return"month"+(c!==1?"s":"")},w:function(c){return"week"+(c!==1?"s":"")},d:function(c){return"day"+(c!==1?"s":"")},h:function(c){return"hour"+(c!==1?"s":"")},m:function(c){return"minute"+(c!==1?"s":"")},s:function(c){return"second"+(c!==1?"s":"")},ms:function(c){return"millisecond"+(c!==1?"s":"")},decimal:"."},es:{y:function(c){return"año"+(c!==1?"s":"")},mo:function(c){return"mes"+(c!==1?"es":"")},w:function(c){return"semana"+(c!==1?"s":"")},d:function(c){return"día"+(c!==1?"s":"")},h:function(c){return"hora"+(c!==1?"s":"")},m:function(c){return"minuto"+(c!==1?"s":"")},s:function(c){return"segundo"+(c!==1?"s":"")},ms:function(c){return"milisegundo"+(c!==1?"s":"")},decimal:","},fr:{y:function(c){return"an"+(c!==1?"s":"")},mo:"mois",w:function(c){return"semaine"+(c!==1?"s":"")},d:function(c){return"jour"+(c!==1?"s":"")},h:function(c){return"heure"+(c!==1?"s":"")},m:function(c){return"minute"+(c!==1?"s":"")},s:function(c){return"seconde"+(c!==1?"s":"")},ms:function(c){return"milliseconde"+(c!==1?"s":"")},decimal:","},gr:{y:function(c){return c===1?"χρόνος":"χρόνια"},mo:function(c){return c===1?"μήνας":"μήνες"},w:function(c){return c===1?"εβδομάδα":"εβδομάδες"},d:function(c){return c===1?"μέρα":"μέρες"},h:function(c){return c===1?"ώρα":"ώρες"},m:function(c){return c===1?"λεπτό":"λεπτά"},s:function(c){return c===1?"δευτερόλεπτο":"δευτερόλεπτα"},ms:function(c){return c===1?"χιλιοστό του δευτερολέπτου":"χιλιοστά του δευτερολέπτου"},decimal:","},hu:{y:"év",mo:"hónap",w:"hét",d:"nap",h:"óra",m:"perc",s:"másodperc",ms:"ezredmásodperc",decimal:","},it:{y:function(c){return"ann"+(c!==1?"i":"o")},mo:function(c){return"mes"+(c!==1?"i":"e")},w:function(c){return"settiman"+(c!==1?"e":"a")},d:function(c){return"giorn"+(c!==1?"i":"o")},h:function(c){return"or"+(c!==1?"e":"a")},m:function(c){return"minut"+(c!==1?"i":"o")},s:function(c){return"second"+(c!==1?"i":"o")},ms:function(c){return"millisecond"+(c!==1?"i":"o")},decimal:","},ja:{y:"年",mo:"月",w:"週",d:"日",h:"時間",m:"分",s:"秒",ms:"ミリ秒",decimal:"."},ko:{y:"년",mo:"개월",w:"주일",d:"일",h:"시간",m:"분",s:"초",ms:"밀리 초",decimal:"."},nl:{y:"jaar",mo:function(c){return c===1?"maand":"maanden"},w:function(c){return c===1?"week":"weken"},d:function(c){return c===1?"dag":"dagen"},h:"uur",m:function(c){return c===1?"minuut":"minuten"},s:function(c){return c===1?"seconde":"seconden"},ms:function(c){return c===1?"milliseconde":"milliseconden"},decimal:","},no:{y:"år",mo:function(c){return"måned"+(c!==1?"er":"")},w:function(c){return"uke"+(c!==1?"r":"")},d:function(c){return"dag"+(c!==1?"er":"")},h:function(c){return"time"+(c!==1?"r":"")},m:function(c){return"minutt"+(c!==1?"er":"")},s:function(c){return"sekund"+(c!==1?"er":"")},ms:function(c){return"millisekund"+(c!==1?"er":"")},decimal:","},pl:{y:function(c){return["rok","roku","lata","lat"][getPolishForm(c)]},mo:function(c){return["miesiąc","miesiąca","miesiące","miesięcy"][getPolishForm(c)]},w:function(c){return["tydzień","tygodnia","tygodnie","tygodni"][getPolishForm(c)]},d:function(c){return["dzień","dnia","dni","dni"][getPolishForm(c)]},h:function(c){return["godzina","godziny","godziny","godzin"][getPolishForm(c)]},m:function(c){return["minuta","minuty","minuty","minut"][getPolishForm(c)]},s:function(c){return["sekunda","sekundy","sekundy","sekund"][getPolishForm(c)]},ms:function(c){return["milisekunda","milisekundy","milisekundy","milisekund"][getPolishForm(c)]},decimal:","},pt:{y:function(c){return"ano"+(c!==1?"s":"")},mo:function(c){return c!==1?"meses":"mês"},w:function(c){return"semana"+(c!==1?"s":"")},d:function(c){return"dia"+(c!==1?"s":"")},h:function(c){return"hora"+(c!==1?"s":"")},m:function(c){return"minuto"+(c!==1?"s":"")},s:function(c){return"segundo"+(c!==1?"s":"")},ms:function(c){return"milissegundo"+(c!==1?"s":"")},decimal:","},ru:{y:function(c){return["лет","год","года"][getSlavicForm(c)]},mo:function(c){return["месяцев","месяц","месяца"][getSlavicForm(c)]},w:function(c){return["недель","неделя","недели"][getSlavicForm(c)]},d:function(c){return["дней","день","дня"][getSlavicForm(c)]},h:function(c){return["часов","час","часа"][getSlavicForm(c)]},m:function(c){return["минут","минута","минуты"][getSlavicForm(c)]},s:function(c){return["секунд","секунда","секунды"][getSlavicForm(c)]},ms:function(c){return["миллисекунд","миллисекунда","миллисекунды"][getSlavicForm(c)]},decimal:","},uk:{y:function(c){return["років","рік","роки"][getSlavicForm(c)]},mo:function(c){return["місяців","місяць","місяці"][getSlavicForm(c)]},w:function(c){return["неділь","неділя","неділі"][getSlavicForm(c)]},d:function(c){return["днів","день","дні"][getSlavicForm(c)]},h:function(c){return["годин","година","години"][getSlavicForm(c)]},m:function(c){return["хвилин","хвилина","хвилини"][getSlavicForm(c)]},s:function(c){return["секунд","секунда","секунди"][getSlavicForm(c)]},ms:function(c){return["мілісекунд","мілісекунда","мілісекунди"][getSlavicForm(c)]},decimal:","},sv:{y:"år",mo:function(c){return"månad"+(c!==1?"er":"")},w:function(c){return"veck"+(c!==1?"or":"a")},d:function(c){return"dag"+(c!==1?"ar":"")},h:function(c){return"timm"+(c!==1?"ar":"e")},m:function(c){return"minut"+(c!==1?"er":"")},s:function(c){return"sekund"+(c!==1?"er":"")},ms:function(c){return"millisekund"+(c!==1?"er":"")},decimal:","},tr:{y:"yıl",mo:"ay",w:"hafta",d:"gün",h:"saat",m:"dakika",s:"saniye",ms:"milisaniye",decimal:","},zh_CN:{y:"年",mo:"个月",w:"周",d:"天",h:"小时",m:"分钟",s:"秒",ms:"毫秒",decimal:"."},zh_TW:{y:"年",mo:"個月",w:"周",d:"天",h:"小時",m:"分鐘",s:"秒",ms:"毫秒",decimal:"."}};function humanizer(passedOptions){var result=function humanizer(ms,humanizerOptions){var options=extend({},result,humanizerOptions||{});return doHumanization(ms,options)};return extend(result,{language:"en",delimiter:", ",spacer:" ",units:["y","mo","w","d","h","m","s"],languages:{},round:false},passedOptions)}var defaultHumanizer=humanizer({});function humanizeDuration(){return defaultHumanizer.apply(defaultHumanizer,arguments);
}function doHumanization(ms,options){ms=Math.abs(ms);var dictionary=options.languages[options.language]||languages[options.language];if(!dictionary){throw new Error("No language "+dictionary+".")}var result=[];var unitName,unitMS,unitCount;for(var i=0,len=options.units.length;i<len;i++){unitName=options.units[i];unitMS=UNITS[unitName];if(i+1===len){unitCount=ms/unitMS;if(options.round){unitCount=Math.round(unitCount)}}else{unitCount=Math.floor(ms/unitMS)}if(unitCount){result.push(render(unitCount,unitName,dictionary,options))}if(options.largest&&options.largest<=result.length){break}ms-=unitCount*unitMS}if(result.length){return result.join(options.delimiter)}else{return render(0,options.units[options.units.length-1],dictionary,options)}}function render(count,type,dictionary,options){var decimal;if(options.decimal===void 0){decimal=dictionary.decimal}else{decimal=options.decimal}var countStr=count.toString().replace(".",decimal);var dictionaryValue=dictionary[type];var word;if(typeof dictionaryValue==="function"){word=dictionaryValue(count)}else{word=dictionaryValue}return countStr+options.spacer+word}function extend(destination){var source;for(var i=1;i<arguments.length;i++){source=arguments[i];for(var prop in source){if(source.hasOwnProperty(prop)){destination[prop]=source[prop]}}}return destination}function getPolishForm(c){if(c===1){return 0}else if(Math.floor(c)!==c){return 1}else if(c%10>=2&&c%10<=4&&!(c%100>10&&c%100<20)){return 2}else{return 3}}function getSlavicForm(c){if(Math.floor(c)!==c){return 2}else if(c===0||c>=5&&c<=20||c%10>=5&&c%10<=9||c%10===0){return 0}else if(c===1||c%10===1){return 1}else if(c>1){return 2}else{return 0}}function getSupportedLanguages(){var result=[];for(var language in languages){if(languages.hasOwnProperty(language)){result.push(language)}}return result}humanizeDuration.humanizer=humanizer;humanizeDuration.getSupportedLanguages=getSupportedLanguages;if(typeof define==="function"&&define.amd){define(function(){return humanizeDuration})}else if(typeof module!=="undefined"&&module.exports){module.exports=humanizeDuration}else{global.humanizeDuration=humanizeDuration}})(this)},{}],34:[function(require,module,exports){var split=require("browser-split");var ClassList=require("class-list");require("html-element");function context(){var cleanupFuncs=[];function h(){var args=[].slice.call(arguments),e=null;function item(l){var r;function parseClass(string){var m=split(string,/([\.#]?[a-zA-Z0-9_:-]+)/);if(/^\.|#/.test(m[1]))e=document.createElement("div");forEach(m,function(v){var s=v.substring(1,v.length);if(!v)return;if(!e)e=document.createElement(v);else if(v[0]===".")ClassList(e).add(s);else if(v[0]==="#")e.setAttribute("id",s)})}if(l==null);else if("string"===typeof l){if(!e)parseClass(l);else e.appendChild(r=document.createTextNode(l))}else if("number"===typeof l||"boolean"===typeof l||l instanceof Date||l instanceof RegExp){e.appendChild(r=document.createTextNode(l.toString()))}else if(isArray(l))forEach(l,item);else if(isNode(l))e.appendChild(r=l);else if(l instanceof Text)e.appendChild(r=l);else if("object"===typeof l){for(var k in l){if("function"===typeof l[k]){if(/^on\w+/.test(k)){(function(k,l){if(e.addEventListener){e.addEventListener(k.substring(2),l[k],false);cleanupFuncs.push(function(){e.removeEventListener(k.substring(2),l[k],false)})}else{e.attachEvent(k,l[k]);cleanupFuncs.push(function(){e.detachEvent(k,l[k])})}})(k,l)}else{e[k]=l[k]();cleanupFuncs.push(l[k](function(v){e[k]=v}))}}else if(k==="style"){if("string"===typeof l[k]){e.style.cssText=l[k]}else{for(var s in l[k])(function(s,v){if("function"===typeof v){e.style.setProperty(s,v());cleanupFuncs.push(v(function(val){e.style.setProperty(s,val)}))}else e.style.setProperty(s,l[k][s])})(s,l[k][s])}}else if(k.substr(0,5)==="data-"){e.setAttribute(k,l[k])}else{e[k]=l[k]}}}else if("function"===typeof l){var v=l();e.appendChild(r=isNode(v)?v:document.createTextNode(v));cleanupFuncs.push(l(function(v){if(isNode(v)&&r.parentElement)r.parentElement.replaceChild(v,r),r=v;else r.textContent=v}))}return r}while(args.length)item(args.shift());return e}h.cleanup=function(){for(var i=0;i<cleanupFuncs.length;i++){cleanupFuncs[i]()}cleanupFuncs.length=0};return h}var h=module.exports=context();h.context=context;function isNode(el){return el&&el.nodeName&&el.nodeType}function isText(el){return el&&el.nodeName==="#text"&&el.nodeType==3}function forEach(arr,fn){if(arr.forEach)return arr.forEach(fn);for(var i=0;i<arr.length;i++)fn(arr[i],i)}function isArray(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{"browser-split":35,"class-list":36,"html-element":1}],35:[function(require,module,exports){module.exports=function split(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef,self;self=function(str,separator,limit){if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit)}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0,separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+="";if(!compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)}limit=limit===undef?-1>>>0:limit>>>0;while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef}}})}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break}}if(separator.lastIndex===match.index){separator.lastIndex++}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("")}}else{output.push(str.slice(lastLastIndex))}return output.length>limit?output.slice(0,limit):output};return self}()},{}],36:[function(require,module,exports){var indexof=require("indexof");module.exports=ClassList;function ClassList(elem){var cl=elem.classList;if(cl){return cl}var classList={add:add,remove:remove,contains:contains,toggle:toggle,toString:$toString,length:0,item:item};return classList;function add(token){var list=getTokens();if(indexof(list,token)>-1){return}list.push(token);setTokens(list)}function remove(token){var list=getTokens(),index=indexof(list,token);if(index===-1){return}list.splice(index,1);setTokens(list)}function contains(token){return indexof(getTokens(),token)>-1}function toggle(token){if(contains(token)){remove(token);return false}else{add(token);return true}}function $toString(){return elem.className}function item(index){var tokens=getTokens();return tokens[index]||null}function getTokens(){var className=elem.className;return filter(className.split(" "),isTruthy)}function setTokens(list){var length=list.length;elem.className=list.join(" ");classList.length=length;for(var i=0;i<list.length;i++){classList[i]=list[i]}delete list[length]}}function filter(arr,fn){var ret=[];for(var i=0;i<arr.length;i++){if(fn(arr[i]))ret.push(arr[i])}return ret}function isTruthy(value){return!!value}},{indexof:37}],37:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],38:[function(require,module,exports){var inserted={};module.exports=function(css,options){if(inserted[css])return;inserted[css]=true;var elem=document.createElement("style");elem.setAttribute("type","text/css");if("textContent"in elem){elem.textContent=css}else{elem.styleSheet.cssText=css}var head=document.getElementsByTagName("head")[0];if(options&&options.prepend){head.insertBefore(elem,head.childNodes[0])}else{head.appendChild(elem)}}},{}],39:[function(require,module,exports){"use strict";var keyMirror=function(obj){var ret={};var key;if(!(obj instanceof Object&&!Array.isArray(obj))){throw new Error("keyMirror(...): Argument must be an object.")}for(key in obj){if(!obj.hasOwnProperty(key)){continue}ret[key]=key}return ret};module.exports=keyMirror},{}],40:[function(require,module,exports){module.exports=exports=function(host){var donors=slice(arguments,1);donors.forEach(function(donor){Object.keys(donor).forEach(function(key){host[key]=donor[key]})});return host};exports.selective=function(keys,host){var donors=slice(arguments,1);donors.forEach(function(donor){keys.forEach(function(key){host[key]=donor[key]})});return host};exports.recursive=function(host){var donors=slice(arguments,1);donors.forEach(function(donor){Object.keys(donor).forEach(recurser(host,donor))});return host};exports.selective.recursive=function(keys,host){var donors=slice(arguments,1);donors.forEach(function(donor){keys.forEach(recurser(host,donor))});return host};function slice(arr,i){return Array.prototype.slice.call(arr,i)}function isObj(value){return!!(typeof value==="object"&&value)}function getType(value){return Object.prototype.toString.call(value).slice(8,-1).toLowerCase()}function recurser(host,donor){return function(key){if(isObj(donor[key])){if(isObj(host[key])){exports.recursive(host[key],donor[key])}else{var base=Array.isArray(donor[key])?[]:{};host[key]=exports.recursive(base,donor[key])}}else{host[key]=donor[key]}}}},{}],41:[function(require,module,exports){exports.pause=function(ee,ms){if(ee.paused)return;ee.paused=true;if(typeof ee._bufferedEvents==="undefined"){ee._bufferedEvents=[]}ee._oldEmit=ee.emit;ee.emit=function(){ee._bufferedEvents.push(arguments)};if(ms){setTimeout(function(){exports.resume(ee)},ms)}};exports.resume=function(ee,ms){if(!ee.paused)return;ee.paused=false;ee.emit=ee._oldEmit;for(var i=ee._bufferedEvents.length-1;i>=0;i--){ee.emit.apply(ee,ee._bufferedEvents.pop())}if(ms){setTimeout(function(){exports.pause(ee)},ms)}};exports.createGroup=function(){var timers=[];var paused=false;var done=false;return{add:function(id){if(typeof id.emit==="undefined"){id.onDone(function(){timers.splice(timers.indexOf(id),1);if(timers.length===0){done=true}})}timers.push(id);return id},setTimeout:function(fn,ms){return this.add(exports.setTimeout(fn,ms))},setInterval:function(fn,ms){return this.add(exports.setInterval(fn,ms))},pause:function(resumeIn){for(var i=0;i<timers.length;i++){var id=timers[i];if(typeof id.emit==="function"){exports.pause(id,resumeIn)}else{id.pause(resumeIn)}}paused=true},resume:function(pauseIn){for(var i=0;i<timers.length;i++){var id=timers[i];if(typeof id.emit==="function"){exports.resume(id,pauseIn)}else{id.resume(pauseIn)}}paused=false},clear:function(){for(var i=timers.length-1;i>=0;i--){if(typeof timers[i].clear==="function"){timers[i].clear()}}},isPaused:function(){return paused},isDone:function(){return done},timers:function(){return timers}}};var timer=function(type,clear,fn,ms){if(typeof fn!=="function"){var tmp=fn;fn=ms;ms=tmp}var done=false;var countdownStart=Date.now();var nextTime=ms;var paused;var finished;var resumed;var wrapper=function(){countdownStart=Date.now();nextTime=ms;fn.apply();if(type===setTimeout){done=true;if(typeof finished==="function"){finished.apply()}}else if(resumed){resumed=false;id=setInterval(wrapper,ms)}};var id=type(wrapper,ms);return{pause:function(resumeIn){if(done||paused)return;clear(id);paused=true;if(resumeIn){setTimeout(this.resume,resumeIn)}return nextTime-=Date.now()-countdownStart},resume:function(pauseIn){if(done||!paused)return;paused=false;resumed=true;countdownStart=Date.now();if(pauseIn){setTimeout(this.pause,pauseIn)}id=setTimeout(wrapper,nextTime)},next:function(){return nextTime-(paused?0:Date.now()-countdownStart)},clear:function(){if(done)return;if(resumed){clearTimeout(id)}else{clear(id)}done=true;if(typeof finished==="function"){finished.apply()}},isPaused:function(){return paused},isDone:function(){return done},onDone:function(fn){finished=fn}}};exports.setTimeout=function(fn,ms){return timer(setTimeout,clearTimeout,fn,ms)};exports.setInterval=function(fn,ms){return timer(setInterval,clearInterval,fn,ms)}},{}],42:[function(require,module,exports){"use strict";var readystate=module.exports=require("./readystate"),win=new Function("return this")(),complete="complete",root=true,doc=win.document,html=doc.documentElement;if(complete===doc.readyState){return readystate.change(complete)}var modern=!!doc.addEventListener,prefix=modern?"":"on",on=modern?"addEventListener":"attachEvent",off=modern?"removeEventListener":"detachEvent";if(!modern&&"function"===typeof html.doScroll){try{root=!win.frameElement}catch(e){}if(root)(function polling(){try{html.doScroll("left")}catch(e){return setTimeout(polling,50)}readystate.change("interactive")})()}function change(evt){evt=evt||win.event;if("readystatechange"===evt.type){readystate.change(doc.readyState);if(complete!==doc.readyState)return}if("load"===evt.type)readystate.change("complete");else readystate.change("interactive");(evt.type==="load"?win:doc)[off](evt.type,change,false)}doc[on](prefix+"DOMContentLoaded",change,false);doc[on](prefix+"readystatechange",change,false);win[on](prefix+"load",change,false)},{"./readystate":43}],43:[function(require,module,exports){"use strict";function generate(state){return function proxy(fn,context){var rs=this;if(rs.is(state)){setTimeout(function(){fn.call(context,rs.readyState)},0)}else{if(!rs._events[state])rs._events[state]=[];rs._events[state].push({fn:fn,context:context})}return rs}}function RS(){this.readyState=RS.UNKNOWN;this._events={}}RS.states="ALL,UNKNOWN,LOADING,INTERACTIVE,COMPLETE".split(",");for(var s=0,state;s<RS.states.length;s++){state=RS.states[s];RS[state]=RS.prototype[state]=s;RS.prototype[state.toLowerCase()]=generate(state)}RS.prototype.change=function change(state){state=this.clean(state,true);var j,name,i=0,listener,rs=this,previously=rs.readyState;if(previously>=state)return rs;rs.readyState=state;for(;i<RS.states.length;i++){if(i>state)break;name=RS.states[i];if(name in rs._events){for(j=0;j<rs._events[name].length;j++){listener=rs._events[name][j];listener.fn.call(listener.context||rs,previously)}delete rs._events[name]}}return rs};RS.prototype.is=function is(state){return this.readyState>=this.clean(state,true)};RS.prototype.clean=function transform(state,nr){var type=typeof state;if(nr)return"number"!==type?+RS[state.toUpperCase()]||0:state;return("number"===type?RS.states[state]:state).toUpperCase()};module.exports=new RS},{}],44:[function(require,module,exports){var Emitter=require("emitter");var reduce=require("reduce");var root="undefined"==typeof window?this||self:window;function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}request.getXHR=function(){if(root.XMLHttpRequest&&(!root.location||"file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false};var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.req.method!="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType==="undefined"?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text?this.text:this.xhr.response):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse&&str&&(str.length||str instanceof Object)?parse(str):null};Response.prototype.setStatusProperties=function(status){if(status===1223){status=204}var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var url=req.url;var msg="cannot "+method+" "+url+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.url=url;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var err=null;var res=null;try{res=new Response(self)}catch(e){err=new Error("Parser is unable to parse the response");err.parse=true;err.original=e;return self.callback(err)}self.emit("response",res);if(err){return self.callback(err,res)}if(res.status>=200&&res.status<300){return self.callback(err,res)}var new_err=new Error(res.statusText||"Unsuccessful HTTP response");new_err.original=err;new_err.response=res;new_err.status=res.status;self.callback(err||new_err,res)})}Emitter(Request.prototype);Request.prototype.use=function(fn){fn(this);return this};Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.unset=function(field){delete this._header[field.toLowerCase()];delete this.header[field];return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.field=function(name,val){if(!this._formData)this._formData=new root.FormData;this._formData.append(name,val);return this};Request.prototype.attach=function(field,file,filename){if(!this._formData)this._formData=new root.FormData;this._formData.append(field,file,filename);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj||isHost(data))return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;this.clearTimeout();fn(err,res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=request.getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._formData||this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;var status;try{status=xhr.status}catch(e){status=0}if(0==status){if(self.timedout)return self.timeoutError();if(self.aborted)return;return self.crossDomainError()}self.emit("end")};var handleProgress=function(e){if(e.total>0){e.percent=e.loaded/e.total*100}self.emit("progress",e)};if(this.hasListeners("progress")){xhr.onprogress=handleProgress}try{if(xhr.upload&&this.hasListeners("progress")){xhr.upload.onprogress=handleProgress}}catch(e){}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.timedout=true;self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var serialize=request.serialize[this.getHeader("Content-Type")];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}this.emit("request",this);xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request},{emitter:45,reduce:46}],45:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],46:[function(require,module,exports){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}},{}],47:[function(require,module,exports){(function(Buffer){var isTypedArray=require("is-typedarray").strict;module.exports=function(arr){var constructor=Buffer.TYPED_ARRAY_SUPPORT?Buffer._augment:function(arr){return new Buffer(arr)};if(arr instanceof Uint8Array){return constructor(arr)}else if(arr instanceof ArrayBuffer){return constructor(new Uint8Array(arr))}else if(isTypedArray(arr)){return constructor(new Uint8Array(arr.buffer,arr.byteOffset,arr.byteLength))}else{return new Buffer(arr)}}}).call(this,require("buffer").Buffer)},{buffer:2,"is-typedarray":48}],48:[function(require,module,exports){module.exports=isTypedArray;isTypedArray.strict=isStrictTypedArray;isTypedArray.loose=isLooseTypedArray;var toString=Object.prototype.toString;var names={"[object Int8Array]":true,"[object Int16Array]":true,"[object Int32Array]":true,"[object Uint8Array]":true,"[object Uint8ClampedArray]":true,"[object Uint16Array]":true,"[object Uint32Array]":true,"[object Float32Array]":true,"[object Float64Array]":true};function isTypedArray(arr){return isStrictTypedArray(arr)||isLooseTypedArray(arr)}function isStrictTypedArray(arr){return arr instanceof Int8Array||arr instanceof Int16Array||arr instanceof Int32Array||arr instanceof Uint8Array||arr instanceof Uint8ClampedArray||arr instanceof Uint16Array||arr instanceof Uint32Array||arr instanceof Float32Array||arr instanceof Float64Array}function isLooseTypedArray(arr){return names[toString.call(arr)]}},{}],49:[function(require,module,exports){(function(window,undefined){"use strict";var LIBVERSION="0.7.9",EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",STR_TYPE="string",MAJOR="major",MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",ARCHITECTURE="architecture",CONSOLE="console",MOBILE="mobile",TABLET="tablet",SMARTTV="smarttv",WEARABLE="wearable",EMBEDDED="embedded";var util={extend:function(regexes,extensions){for(var i in extensions){if("browser cpu device engine os".indexOf(i)!==-1&&extensions[i].length%2===0){regexes[i]=extensions[i].concat(regexes[i])}}return regexes},has:function(str1,str2){if(typeof str1==="string"){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1}else{return false}},lowerize:function(str){return str.toLowerCase()},major:function(version){return typeof version===STR_TYPE?version.split(".")[0]:undefined}};var mapper={rgx:function(){var result,i=0,j,k,p,q,matches,match,args=arguments;while(i<args.length&&!matches){var regex=args[i],props=args[i+1];if(typeof result===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof q===OBJ_TYPE){result[q[0]]=undefined}else{result[q]=undefined}}}j=k=0;while(j<regex.length&&!matches){matches=regex[j++].exec(this.getUA());if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof q===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof q[1]==FUNC_TYPE){result[q[0]]=q[1].call(this,match)}else{result[q[0]]=q[1]}}else if(q.length==3){if(typeof q[1]===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined}}else if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined}}else{result[q]=match?match:undefined}}}}i+=2}return result},str:function(str,map){for(var i in map){if(typeof map[i]===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return i===UNKNOWN?undefined:i}}}else if(util.has(map[i],str)){return i===UNKNOWN?undefined:i}}return str}};var maps={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}};var regexes={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[NAME,VERSION],[/\s(opr)\/([\w\.]+)/i],[[NAME,"Opera"],VERSION],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium)\/([\w\.-]+)/i],[NAME,VERSION],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION],[/(edge)\/((\d+)?[\w\.]+)/i],[NAME,VERSION],[/(yabrowser)\/([\w\.]+)/i],[[NAME,"Yandex"],VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[NAME,/_/g," "],VERSION],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[NAME,VERSION],[/(dolfin)\/([\w\.]+)/i],[[NAME,"Dolphin"],VERSION],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[NAME,"Chrome"],VERSION],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[VERSION,[NAME,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[VERSION,[NAME,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,[NAME,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(navigator|netscape)\/([\w\.-]+)/i],[[NAME,"Netscape"],VERSION],[/fxios\/([\w\.-]+)/i],[VERSION,[NAME,"Firefox"]],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[NAME,VERSION]],
cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[ARCHITECTURE,"amd64"]],[/(ia32(?=;))/i],[[ARCHITECTURE,util.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[ARCHITECTURE,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[ARCHITECTURE,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[ARCHITECTURE,/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[[ARCHITECTURE,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[ARCHITECTURE,util.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/applecoremedia\/[\w\.]+ \((ipad)/],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(apple\s{0,1}tv)/i],[[MODEL,"Apple TV"],[VENDOR,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[MODEL,mapper.str,maps.device.amazon.model],[VENDOR,"Amazon"],[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\(bb10;\s(\w+)/i],[MODEL,[VENDOR,"BlackBerry"],[TYPE,MOBILE]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[MODEL,[VENDOR,"Asus"],[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Tablet"],[TYPE,TABLET]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Phone"],[TYPE,MOBILE]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/android.+;\s(shield)\sbuild/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,CONSOLE]],[/(playstation\s[3portablevi]+)/i],[MODEL,[VENDOR,"Sony"],[TYPE,CONSOLE]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/(nexus\s9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,CONSOLE]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,"Microsoft"],[TYPE,MOBILE]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,MOBILE]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(samsung);smarttv/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/\(dtv[\);].+(aquos)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,SMARTTV]],[/sie-(\w+)*/i],[MODEL,[VENDOR,"Siemens"],[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/(lg) netcast\.tv/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[MODEL,[VENDOR,"LG"],[TYPE,MOBILE]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[MODEL,[VENDOR,"Lenovo"],[TYPE,TABLET]],[/linux;.+((jolla));/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/((pebble))app\/[\d\.]+\s/i],[VENDOR,MODEL,[TYPE,WEARABLE]],[/android.+;\s(glass)\s\d/i],[MODEL,[VENDOR,"Google"],[TYPE,WEARABLE]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,MOBILE]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[TYPE,util.lowerize],VENDOR,MODEL]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[VERSION,[NAME,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[NAME,VERSION],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/\((series40);/i],[NAME],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[NAME,"Mac OS"],[VERSION,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring,extensions){if(!(this instanceof UAParser)){return new UAParser(uastring,extensions).getResult()}var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:EMPTY);var rgxmap=extensions?util.extend(regexes,extensions):regexes;this.getBrowser=function(){var browser=mapper.rgx.apply(this,rgxmap.browser);browser.major=util.major(browser.version);return browser};this.getCPU=function(){return mapper.rgx.apply(this,rgxmap.cpu)};this.getDevice=function(){return mapper.rgx.apply(this,rgxmap.device)};this.getEngine=function(){return mapper.rgx.apply(this,rgxmap.engine)};this.getOS=function(){return mapper.rgx.apply(this,rgxmap.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return ua};this.setUA=function(uastring){ua=uastring;return this};this.setUA(ua);return this};UAParser.VERSION=LIBVERSION;UAParser.BROWSER={NAME:NAME,MAJOR:MAJOR,VERSION:VERSION};UAParser.CPU={ARCHITECTURE:ARCHITECTURE};UAParser.DEVICE={MODEL:MODEL,VENDOR:VENDOR,TYPE:TYPE,CONSOLE:CONSOLE,MOBILE:MOBILE,SMARTTV:SMARTTV,TABLET:TABLET,WEARABLE:WEARABLE,EMBEDDED:EMBEDDED};UAParser.ENGINE={NAME:NAME,VERSION:VERSION};UAParser.OS={NAME:NAME,VERSION:VERSION};if(typeof exports!==UNDEF_TYPE){if(typeof module!==UNDEF_TYPE&&module.exports){exports=module.exports=UAParser}exports.UAParser=UAParser}else{if(typeof define===FUNC_TYPE&&define.amd){define(function(){return UAParser})}else{window.UAParser=UAParser}}var $=window.jQuery||window.Zepto;if(typeof $!==UNDEF_TYPE){var parser=new UAParser;$.ua=parser.getResult();$.ua.get=function(){return parser.getUA()};$.ua.set=function(uastring){parser.setUA(uastring);var result=parser.getResult();for(var prop in result){$.ua[prop]=result[prop]}}}})(typeof window==="object"?window:this)},{}],50:[function(require,module,exports){(function(process,Buffer){var stream=require("readable-stream");var eos=require("end-of-stream");var util=require("util");var SIGNAL_FLUSH=new Buffer([0]);var onuncork=function(self,fn){if(self._corked)self.once("uncork",fn);else fn()};var destroyer=function(self,end){return function(err){if(err)self.destroy(err.message==="premature close"?null:err);else if(end&&!self._ended)self.end()}};var end=function(ws,fn){if(!ws)return fn();if(ws._writableState&&ws._writableState.finished)return fn();if(ws._writableState)return ws.end(fn);ws.end();fn()};var toStreams2=function(rs){return new stream.Readable({objectMode:true,highWaterMark:16}).wrap(rs)};var Duplexify=function(writable,readable,opts){if(!(this instanceof Duplexify))return new Duplexify(writable,readable,opts);stream.Duplex.call(this,opts);this._writable=null;this._readable=null;this._readable2=null;this._forwardDestroy=!opts||opts.destroy!==false;this._forwardEnd=!opts||opts.end!==false;this._corked=1;this._ondrain=null;this._drained=false;this._forwarding=false;this._unwrite=null;this._unread=null;this._ended=false;this.destroyed=false;if(writable)this.setWritable(writable);if(readable)this.setReadable(readable)};util.inherits(Duplexify,stream.Duplex);Duplexify.obj=function(writable,readable,opts){if(!opts)opts={};opts.objectMode=true;opts.highWaterMark=16;return new Duplexify(writable,readable,opts)};Duplexify.prototype.cork=function(){if(++this._corked===1)this.emit("cork")};Duplexify.prototype.uncork=function(){if(this._corked&&--this._corked===0)this.emit("uncork")};Duplexify.prototype.setWritable=function(writable){if(this._unwrite)this._unwrite();if(this.destroyed){if(writable&&writable.destroy)writable.destroy();return}if(writable===null||writable===false){this.end();return}var self=this;var unend=eos(writable,{writable:true,readable:false},destroyer(this,this._forwardEnd));var ondrain=function(){var ondrain=self._ondrain;self._ondrain=null;if(ondrain)ondrain()};var clear=function(){self._writable.removeListener("drain",ondrain);unend()};if(this._unwrite)process.nextTick(ondrain);this._writable=writable;this._writable.on("drain",ondrain);this._unwrite=clear;this.uncork()};Duplexify.prototype.setReadable=function(readable){if(this._unread)this._unread();if(this.destroyed){if(readable&&readable.destroy)readable.destroy();return}if(readable===null||readable===false){this.push(null);this.resume();return}var self=this;var unend=eos(readable,{writable:false,readable:true},destroyer(this));var onreadable=function(){self._forward()};var onend=function(){self.push(null)};var clear=function(){self._readable2.removeListener("readable",onreadable);self._readable2.removeListener("end",onend);unend()};this._drained=true;this._readable=readable;this._readable2=readable._readableState?readable:toStreams2(readable);this._readable2.on("readable",onreadable);this._readable2.on("end",onend);this._unread=clear;this._forward()};Duplexify.prototype._read=function(){this._drained=true;this._forward()};Duplexify.prototype._forward=function(){if(this._forwarding||!this._readable2||!this._drained)return;this._forwarding=true;var data;var state=this._readable2._readableState;while((data=this._readable2.read(state.buffer.length?state.buffer[0].length:state.length))!==null){this._drained=this.push(data)}this._forwarding=false};Duplexify.prototype.destroy=function(err){if(this.destroyed)return;this.destroyed=true;var self=this;process.nextTick(function(){self._destroy(err)})};Duplexify.prototype._destroy=function(err){if(err){var ondrain=this._ondrain;this._ondrain=null;if(ondrain)ondrain(err);else this.emit("error",err)}if(this._forwardDestroy){if(this._readable&&this._readable.destroy)this._readable.destroy();if(this._writable&&this._writable.destroy)this._writable.destroy()}this.emit("close")};Duplexify.prototype._write=function(data,enc,cb){if(this.destroyed)return cb();if(this._corked)return onuncork(this,this._write.bind(this,data,enc,cb));if(data===SIGNAL_FLUSH)return this._finish(cb);if(!this._writable)return cb();if(this._writable.write(data)===false)this._ondrain=cb;else cb()};Duplexify.prototype._finish=function(cb){var self=this;this.emit("preend");onuncork(this,function(){end(self._forwardEnd&&self._writable,function(){if(self._writableState.prefinished===false)self._writableState.prefinished=true;self.emit("prefinish");onuncork(self,cb)})})};Duplexify.prototype.end=function(data,enc,cb){if(typeof data==="function")return this.end(null,null,data);if(typeof enc==="function")return this.end(data,null,enc);this._ended=true;if(data)this.write(data);if(!this._writableState.ending)this.write(SIGNAL_FLUSH);return stream.Writable.prototype.end.call(this,cb)};module.exports=Duplexify}).call(this,require("_process"),require("buffer").Buffer)},{_process:9,buffer:2,"end-of-stream":51,"readable-stream":64,util:26}],51:[function(require,module,exports){var once=require("once");var noop=function(){};var isRequest=function(stream){return stream.setHeader&&typeof stream.abort==="function"};var eos=function(stream,opts,callback){if(typeof opts==="function")return eos(stream,null,opts);if(!opts)opts={};callback=once(callback||noop);var ws=stream._writableState;var rs=stream._readableState;var readable=opts.readable||opts.readable!==false&&stream.readable;var writable=opts.writable||opts.writable!==false&&stream.writable;var onlegacyfinish=function(){if(!stream.writable)onfinish()};var onfinish=function(){writable=false;if(!readable)callback()};var onend=function(){readable=false;if(!writable)callback()};var onclose=function(){if(readable&&!(rs&&rs.ended))return callback(new Error("premature close"));if(writable&&!(ws&&ws.ended))return callback(new Error("premature close"))};var onrequest=function(){stream.req.on("finish",onfinish)};if(isRequest(stream)){stream.on("complete",onfinish);stream.on("abort",onclose);if(stream.req)onrequest();else stream.on("request",onrequest)}else if(writable&&!ws){stream.on("end",onlegacyfinish);stream.on("close",onlegacyfinish)}stream.on("end",onend);stream.on("finish",onfinish);if(opts.error!==false)stream.on("error",callback);stream.on("close",onclose);return function(){stream.removeListener("complete",onfinish);stream.removeListener("abort",onclose);stream.removeListener("request",onrequest);if(stream.req)stream.req.removeListener("finish",onfinish);stream.removeListener("end",onlegacyfinish);stream.removeListener("close",onlegacyfinish);stream.removeListener("finish",onfinish);stream.removeListener("end",onend);stream.removeListener("error",callback);stream.removeListener("close",onclose)}};module.exports=eos},{once:53}],52:[function(require,module,exports){module.exports=wrappy;function wrappy(fn,cb){if(fn&&cb)return wrappy(fn)(cb);if(typeof fn!=="function")throw new TypeError("need wrapper function");Object.keys(fn).forEach(function(k){wrapper[k]=fn[k]});return wrapper;function wrapper(){var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}var ret=fn.apply(this,args);var cb=args[args.length-1];if(typeof ret==="function"&&ret!==cb){Object.keys(cb).forEach(function(k){ret[k]=cb[k]})}return ret}}},{}],53:[function(require,module,exports){var wrappy=require("wrappy");module.exports=wrappy(once);once.proto=once(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:true})});function once(fn){var f=function(){if(f.called)return f.value;f.called=true;return f.value=fn.apply(this,arguments)};f.called=false;return f}},{wrappy:52}],54:[function(require,module,exports){arguments[4][11][0].apply(exports,arguments)},{"./_stream_readable":56,"./_stream_writable":58,"core-util-is":59,dup:11,inherits:65,"process-nextick-args":61}],55:[function(require,module,exports){arguments[4][12][0].apply(exports,arguments)},{"./_stream_transform":57,"core-util-is":59,dup:12,inherits:65}],56:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var util=require("core-util-is");util.inherits=require("inherits");var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else{return state.length}}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":54,_process:9,buffer:2,"core-util-is":59,events:6,inherits:65,isarray:60,"process-nextick-args":61,"string_decoder/":62,util:1}],57:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./_stream_duplex":54,"core-util-is":59,dup:14,inherits:65}],58:[function(require,module,exports){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use "+"_writableState.getBuffer() instead.")})}catch(_){}})();function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."));
};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){processNextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var buffer=[];var cbs=[];while(entry){cbs.push(entry.callback);buffer.push(entry);entry=entry.next}state.pendingcb++;state.lastBufferedRequest=null;doWrite(stream,state,true,state.length,buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}})}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true}},{"./_stream_duplex":54,buffer:2,"core-util-is":59,events:6,inherits:65,"process-nextick-args":61,"util-deprecate":63}],59:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:2}],60:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],61:[function(require,module,exports){(function(process){"use strict";module.exports=nextTick;function nextTick(fn){var args=new Array(arguments.length-1);var i=0;while(i<arguments.length){args[i++]=arguments[i]}process.nextTick(function afterTick(){fn.apply(null,args)})}}).call(this,require("_process"))},{_process:9}],62:[function(require,module,exports){arguments[4][24][0].apply(exports,arguments)},{buffer:2,dup:24}],63:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){if(!global.localStorage)return false;var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],64:[function(require,module,exports){arguments[4][20][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":54,"./lib/_stream_passthrough.js":55,"./lib/_stream_readable.js":56,"./lib/_stream_transform.js":57,"./lib/_stream_writable.js":58,dup:20}],65:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{dup:7}],66:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":67,"./_stream_writable":69,_process:9,"core-util-is":70,inherits:65}],67:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:9,buffer:2,"core-util-is":70,events:6,inherits:65,isarray:71,stream:23,"string_decoder/":72}],68:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":66,"core-util-is":70,inherits:65}],69:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":66,_process:9,buffer:2,"core-util-is":70,inherits:65,stream:23}],70:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:2}],71:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],72:[function(require,module,exports){arguments[4][24][0].apply(exports,arguments)},{buffer:2,dup:24}],73:[function(require,module,exports){arguments[4][21][0].apply(exports,arguments)},{"./lib/_stream_transform.js":68,dup:21}],74:[function(require,module,exports){(function(process){var Transform=require("readable-stream/transform"),inherits=require("util").inherits,xtend=require("xtend");
function DestroyableTransform(opts){Transform.call(this,opts);this._destroyed=false}inherits(DestroyableTransform,Transform);DestroyableTransform.prototype.destroy=function(err){if(this._destroyed)return;this._destroyed=true;var self=this;process.nextTick(function(){if(err)self.emit("error",err);self.emit("close")})};function noop(chunk,enc,callback){callback(null,chunk)}function through2(construct){return function(options,transform,flush){if(typeof options=="function"){flush=transform;transform=options;options={}}if(typeof transform!="function")transform=noop;if(typeof flush!="function")flush=null;return construct(options,transform,flush)}}module.exports=through2(function(options,transform,flush){var t2=new DestroyableTransform(options);t2._transform=transform;if(flush)t2._flush=flush;return t2});module.exports.ctor=through2(function(options,transform,flush){function Through2(override){if(!(this instanceof Through2))return new Through2(override);this.options=xtend(options,override);DestroyableTransform.call(this,this.options)}inherits(Through2,DestroyableTransform);Through2.prototype._transform=transform;if(flush)Through2.prototype._flush=flush;return Through2});module.exports.obj=through2(function(options,transform,flush){var t2=new DestroyableTransform(xtend({objectMode:true,highWaterMark:16},options));t2._transform=transform;if(flush)t2._flush=flush;return t2})}).call(this,require("_process"))},{_process:9,"readable-stream/transform":73,util:26,xtend:76}],75:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],76:[function(require,module,exports){module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key]}}}return target}},{}],77:[function(require,module,exports){(function(process,Buffer){var through=require("through2");var duplexify=require("duplexify");var WS=require("ws");module.exports=WebSocketStream;function WebSocketStream(target,protocols){var stream,socket;var socketWrite=process.title==="browser"?socketWriteBrowser:socketWriteNode;var proxy=through(socketWrite,socketEnd);if(typeof target==="object"){socket=target}else{socket=new WS(target,protocols);socket.binaryType="arraybuffer"}if(socket.readyState===1){stream=proxy}else{stream=duplexify();socket.addEventListener("open",onready)}stream.socket=socket;socket.addEventListener("close",onclose);socket.addEventListener("error",onerror);socket.addEventListener("message",onmessage);proxy.on("close",destroy);function socketWriteNode(chunk,enc,next){socket.send(chunk,next)}function socketWriteBrowser(chunk,enc,next){try{socket.send(chunk)}catch(err){return next(err)}next()}function socketEnd(done){socket.close();done()}function onready(){stream.setReadable(proxy);stream.setWritable(proxy);stream.emit("connect")}function onclose(){stream.end();stream.destroy()}function onerror(err){stream.destroy(err)}function onmessage(event){var data=event.data;if(data instanceof ArrayBuffer)data=new Buffer(new Uint8Array(data));proxy.push(data)}function destroy(){socket.close()}return stream}}).call(this,require("_process"),require("buffer").Buffer)},{_process:9,buffer:2,duplexify:50,through2:74,ws:75}],78:[function(require,module,exports){module.exports='@-webkit-keyframes blink{0%,100%,35%{opacity:.9}50%,85%{opacity:.1}}@keyframes blink{0%,100%,35%{opacity:.9}50%,85%{opacity:.1}}.videomail .visuals{position:relative}.videomail .replay,.videomail .userMedia{width:100%!important}.videomail .countdown,.videomail .paused,.videomail .recordNote,.videomail .recordTimer{margin:0}.videomail .countdown,.videomail .paused,.videomail .recordNote,.videomail .recordTimer,.videomail noscript{position:absolute;font-weight:700}.videomail .countdown,.videomail .paused,.videomail noscript{width:100%;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%)}.videomail .countdown,.videomail .paused{opacity:.75;text-align:center;font-size:480%;text-shadow:0 0 2px #fff}.videomail .recordNote,.videomail .recordTimer{right:.7em;background:rgba(10,10,10,.8);padding:.4em .4em .3em;-webkit-transition:all 1s ease;transition:all 1s ease;color:#00d814}.videomail .recordNote.near,.videomail .recordTimer.near{color:#eb9369}.videomail .recordNote.nigh,.videomail .recordTimer.nigh{color:#ea4b2a}.videomail .recordTimer{top:.7em}.videomail .recordNote{top:3.6em}.videomail .recordNote:before{content:"REC";-webkit-animation:blink 1s infinite;animation:blink 1s infinite}.videomail .notifier{overflow:hidden;box-sizing:border-box;height:100%}.videomail .hide{display:none}'},{}],79:[function(require,module,exports){var merge=require("merge-recursive"),readystate=require("readystate"),util=require("util"),defaultOptions=require("./options"),Constants=require("./constants"),Events=require("./events"),CollectLogger=require("./util/collectLogger"),EventEmitter=require("./util/eventEmitter"),Container=require("./wrappers/container"),Replay=require("./wrappers/visuals/replay"),Browser=require("./util/browser"),Resource=require("./resource"),collectLogger,browser;function adjustOptions(options){var localOptions=merge.recursive(defaultOptions,options||{});collectLogger=collectLogger||new CollectLogger(localOptions);localOptions.logger=collectLogger;localOptions.debug=localOptions.logger.debug;return localOptions}function getBrowser(localOptions){if(!browser)browser=new Browser(localOptions);return browser}var VideomailClient=function(options){var localOptions=adjustOptions(options),container=new Container(localOptions),replay;EventEmitter.call(this,localOptions,"VideomailClient");this.events=Events;function build(containerId,cb){function buildForm(){if(!container.isBuilt())container.build(containerId);cb&&cb()}readystate.interactive(buildForm)}this.show=function(containerId){build.call(this,containerId,container.show)};this.replay=function(parentElement,videomail){if(typeof parentElement==="string")parentElement=document.getElementById(parentElement);container.hide();replay=new Replay(parentElement,localOptions);replay.build();replay.setVideomail(videomail)};this.startOver=function(){replay&&replay.hide();container.startOver()};this.unload=function(e){container.unload(e)};this.hide=function(){container.hide()};this.get=function(key,cb){new Resource(localOptions).get(key,cb)};this.canRecord=function(){return getBrowser(localOptions).canRecord()};this.isDirty=function(){return container.isDirty()};build()};util.inherits(VideomailClient,EventEmitter);Object.keys(Constants.public).forEach(function(name){VideomailClient[name]=Constants.public[name]});module.exports=VideomailClient},{"./constants":80,"./events":81,"./options":82,"./resource":83,"./util/browser":85,"./util/collectLogger":86,"./util/eventEmitter":87,"./wrappers/container":95,"./wrappers/visuals/replay":105,"merge-recursive":40,readystate:42,util:26}],80:[function(require,module,exports){module.exports={SITE_NAME_LABEL:"x-videomail-site-name","public":{ENC_TYPE_APP_JSON:"application/json",ENC_TYPE_FORM:"application/x-www-form-urlencoded"}}},{}],81:[function(require,module,exports){var keymirror=require("keymirror");module.exports=keymirror({FORM_READY:null,USER_MEDIA_READY:null,CONNECTED:null,COUNTDOWN:null,RECORDING:null,STOPPING:null,PROGRESS:null,BEGIN_AUDIO_ENCODING:null,BEGIN_VIDEO_ENCODING:null,RESETTING:null,PAUSED:null,RESUMING:null,PREVIEW:null,PREVIEW_SHOWN:null,REPLAY_SHOWN:null,INVALID:null,VALIDATING:null,VALID:null,SUBMITTING:null,SUBMITTED:null,ERROR:null,BLOCKING:null,FIRST_FRAME_SENT:null,HIDE:null,NOTIFYING:null})},{keymirror:39}],82:[function(require,module,exports){module.exports={logger:null,logStackSize:20,verbose:false,baseUrl:"https://videomail.io",socketUrl:"wss://videomail.io",siteName:"videomail-client-demo",cache:true,insertCss:true,enablePause:true,enableAutoPause:true,enableSpace:true,disableSubmit:false,enableAutoValidation:true,enctype:"application/json",selectors:{containerId:"videomail",replayClass:"replay",userMediaClass:"userMedia",visualsClass:"visuals",buttonClass:null,buttonsClass:"buttons",recordButtonClass:"record",pauseButtonClass:"pause",resumeButtonClass:"resume",stopButtonClass:"stop",backButtonClass:"back",submitButtonClass:"submit",subjectInputName:"subject",fromInputName:"from",toInputName:"to",bodyInputName:"body",keyInputName:"videomail_key",parentKeyInputName:"videomail_parent_key",aliasInputName:"videomail_alias",formId:null,submitButtonId:null},audio:{enabled:false},video:{fps:15,limitSeconds:30,countdown:3,width:320,height:240},image:{quality:.35,types:["webp","jpeg"]},text:{paused:"Paused",processing:"Processing",limitReached:"Limit reached"},notifier:{entertain:false,entertainClass:"bg",entertainLimit:6,entertainInterval:15e3},timeouts:{userMedia:5e3,connection:1e4},displayErrors:true,forceFlash:false,fakeUaString:null}},{}],83:[function(require,module,exports){var superagent=require("superagent"),Constants=require("./constants");module.exports=function(options){var cache={};function packError(err,res){if(res&&res.body&&res.body.error){err=res.body.error;if(!err.message&&res.text)err.message=res.text}return err}function fetch(identifier,cb){superagent.get("/videomail/"+identifier+"/snapshot").set("Accept","application/json").set(Constants.SITE_NAME_LABEL,options.siteName).timeout(options.timeouts.connection).end(function(err,res){err=packError(err,res);if(err)cb(err);else{var videomail=res.body;if(options.cache)cache[identifier]=videomail;cb(null,videomail)}})}this.get=function(identifier,cb){if(options.cache&&cache[identifier])cb(null,cache[identifier]);else fetch(identifier,cb)};this.post=function(videomail,cb){var queryParams={};queryParams[Constants.SITE_NAME_LABEL]=options.siteName;superagent.post(options.baseUrl+"/videomail/").query(queryParams).send(videomail).timeout(options.timeout).end(function(err,res){err=packError(err,res);if(err)cb(err);else{if(options.cache)cache[videomail.alias]=res.body.videomail;cb(null,res.body.videomail,res.body)}})};this.form=function(formData,url,cb){var formType;switch(options.enctype){case Constants.public.ENC_TYPE_APP_JSON:formType="json";break;case Constants.public.ENC_TYPE_FORM:formType="form";break;default:cb(new Error("Invalid enctype given: "+options.enctype))}if(formType){superagent.post(url).type(formType).send(formData).timeout(options.timeout).end(function(err,res){err=packError(err,res);if(err)cb(err);else{cb(null,res)}})}}}},{"./constants":80,superagent:44}],84:[function(require,module,exports){var AudioSample=require("./items/audioSample");module.exports=function(userMedia){var scriptProcessor;function getAudioContext(){if(!window.audioContext){var AudioContext=window.AudioContext||window.webkitAudioContext;window.audioContext=new AudioContext}return window.audioContext}function onAudioProcess(e,cb){if(!userMedia.isRecording()||userMedia.isPaused())return;var float32Array=e.inputBuffer.getChannelData(0);cb(new AudioSample(float32Array))}this.attach=function(localMediaStream,cb){var audioInput=getAudioContext().createMediaStreamSource(localMediaStream),volume=getAudioContext().createGain();volume.gain.value=.9;var bufferSize=2048,channels=1;scriptProcessor=getAudioContext().createScriptProcessor(bufferSize,channels,channels);scriptProcessor.onaudioprocess=function(e){onAudioProcess(e,cb)};audioInput.connect(scriptProcessor);scriptProcessor.connect(getAudioContext().destination);audioInput.connect(volume);volume.connect(scriptProcessor)};this.stop=function(){if(scriptProcessor)scriptProcessor.onaudioprocess=undefined};this.getSampleRate=function(){if(getAudioContext())return getAudioContext().sampleRate;else return-1}}},{"./items/audioSample":89}],85:[function(require,module,exports){var UAParser=require("ua-parser-js"),VideomailError=require("./videomailError");module.exports=function(options){options=options||{};var firefoxDownload="http://www.mozilla.org/firefox/update/",chromeDownload="http://www.google.com/chrome/",chromiumDownload="http://www.chromium.org/getting-involved/download-chromium",browseHappyLink="http://browsehappy.com",ua=options.fakeUaString||typeof window!=="undefined"&&window.navigator.userAgent,uaParser=new UAParser(ua).getResult(),isIOS=uaParser.os.name==="iOS",isChrome=uaParser.browser.name==="Chrome",isChromium=uaParser.browser.name==="Chromium",firefox=uaParser.browser.name==="Firefox",isIE=/IE/.test(uaParser.browser.name),isSafari=/Safari/.test(uaParser.browser.name),isOpera=/Opera/.test(uaParser.browser.name),isAndroid=/Android/.test(uaParser.os.name),chromeBased=isChrome||isChromium,okBrowser=chromeBased||firefox||isAndroid||isOpera,videoType;function getRecommendation(){var warning;if(firefox)warning='Probably you need to <a href="'+firefoxDownload+'" target="_blank">'+"upgrade Firefox</a> to fix this.";else if(isChrome)warning='Probably you need to <a href="'+chromeDownload+'" target="_blank">'+"upgrade Chrome</a> to fix this.";else if(isChromium)warning='<a href="'+chromiumDownload+'" target="_blank">'+"Upgrade Chromium</a> to fix this.";else if(isIE)warning="Forget Internet Explorer!<br/>Better pick"+' <a href="'+firefoxDownload+'" target="_blank">Firefox</a>'+' or <a href="'+chromeDownload+'" target="_blank">Chrome</a>.';else if(isSafari)warning="Safari has no webcam support yet.<br/>Better pick"+' <a href="'+firefoxDownload+'" target="_blank">Firefox</a>'+' or <a href="'+chromeDownload+'" target="_blank">Chrome</a>.';return warning}function getUserMediaWarning(){var warning;if(isIOS)warning='<a href="http://caniuse.com/stream" target="_blank">'+"iOS devices are unable to access video streams."+"</a> One day they will hopefully. Depends on Apple &hellip;";else warning=getRecommendation();if(!warning)warning='<a href="http://caniuse.com/stream" target="_blank">Switch</a> '+"or "+getBrowseHappyLink();return warning}function getBrowseHappyLink(){return'<a href="'+browseHappyLink+'" target="_blank">Upgrade browser</a>'}function getPlaybackWarning(){var warning=getRecommendation();if(!warning)warning=getBrowseHappyLink();return warning}function canPlayType(video,type){var canPlayType;if(video&&video.canPlayType)canPlayType=video.canPlayType("video/"+type);return canPlayType}this.canRecord=function(){var getUserMediaType=typeof navigator!=="undefined"&&typeof navigator.getUserMedia_;return getUserMediaType!=="undefined"&&getUserMediaType=="function"};this.checkRecordingCapabilities=function(){var err;if(!okBrowser||!this.canRecord()){var message;if(!okBrowser)message="Browser has no webcam support";else message="Browser has no getUserMedia support";err=VideomailError.create({message:message},getUserMediaWarning(),options)}return err};this.checkPlaybackCapabilities=function(video){var err,message;if(!video)message="No HTML5 support for video tag!";else if(!this.getVideoType(video))message="No H264 nor webm support found.";if(message)err=VideomailError.create(message,getPlaybackWarning(),options);return err};this.checkBufferTypes=function(){var err;if(typeof window==="undefined"||typeof window.atob==="undefined")err=VideomailError.create("atob is not supported",options);else if(typeof window.ArrayBuffer==="undefined")err=VideomailError.create("ArrayBuffers are not supported",options);else if(typeof window.Uint8Array==="undefined")err=VideomailError.create("Uint8Arrays are not supported",options);return err};this.getVideoType=function(video){if(!videoType){if(canPlayType(video,"mp4")&&!chromeBased)videoType="mp4";else if(canPlayType(video,"webm"))videoType="webm"}return videoType};this.getNoAccessIssue=function(){var message="Cannot access webcam!",explanation;if(this.isChromeBased())explanation="Click on the allow button to grant access to your webcam.";else if(this.isFirefox())explanation="Please share your webcam under Firefox.";else explanation="Your operating system does not let your browser access your webcam.";return VideomailError.create(message,explanation,options)};this.isChromeBased=function(){return chromeBased};this.isFirefox=function(){return firefox}}},{"./videomailError":93,"ua-parser-js":49}],86:[function(require,module,exports){var util=require("util");module.exports=function(localOptions){localOptions=localOptions||{};var logger=localOptions.logger||console,stack=[];function lifo(level,parameters){var line=util.format.apply(util,parameters);if(stack.length>localOptions.logStackSize)stack.pop();stack.push("["+level+"] "+line);return line}this.debug=function(){if(localOptions.verbose){logger.groupCollapsed(lifo("debug",arguments));logger.trace("Trace");logger.groupEnd()}};this.error=function(){logger.error(lifo("error",arguments))};this.warn=function(){logger.warn(lifo("warn",arguments))};this.getLines=function(){return stack}}},{util:26}],87:[function(require,module,exports){var despot=require("despot"),VideomailError=require("./videomailError"),Events=require("./../events");module.exports=function(options,name){this.emit=function(event){var args=Array.prototype.slice.call(arguments,0);if(!event)throw VideomailError.create("You cannot emit without an event.");if(event===Events.ERROR){var err=args[1];err=VideomailError.create(err,options);args[1]=err}if(options.debug)if(event!="removeListener"&&event!="newListener"){var moreArguments;if(args[1])moreArguments=args.slice(1);if(moreArguments)options.debug("%s emits: %s",name,event,moreArguments);else options.debug("%s emits: %s",name,event)}return despot.emit.apply(despot,args)};this.on=function(eventName,cb){return despot.on(eventName,cb)};this.once=function(eventName,cb){return despot.once(eventName,cb)};this.listeners=function(eventName){return despot.listeners(eventName)};this.removeAllListeners=function(){despot.removeAllListeners()}}},{"./../events":81,"./videomailError":93,despot:30}],88:[function(require,module,exports){var filesize=require("filesize"),humanizeDuration=require("humanize-duration");module.exports={filesize:function(bytes,round){return filesize(bytes,{round:round})},toTime:function(t){return humanizeDuration(t)}}},{filesize:32,"humanize-duration":33}],89:[function(require,module,exports){var toBuffer=require("typedarray-to-buffer");module.exports=function(float32Array){if(float32Array.constructor!==Float32Array)throw new Error("The parameter is not a Float32Array");this.toBuffer=function(){var l=float32Array.length,arr=new Int16Array(l),amplify=1;for(var i=0;i<l;i++){arr[i]=Math.max(-1,Math.min(1,amplify*float32Array[i]))*32767}return toBuffer(arr)}}},{"typedarray-to-buffer":47}],90:[function(require,module,exports){var SEPARATOR="<br/>- ";function arrayToString(array){if(array.length>0){var lines=[];array.forEach(function(element){lines.push(element.toString())});return SEPARATOR+lines.join(SEPARATOR)}}function objectToString(object){var propertyNames=Object.getOwnPropertyNames(object);if(propertyNames.length>0){var lines=[];propertyNames.forEach(function(name){lines.push(object[name].toString())});return SEPARATOR+lines.join(SEPARATOR)}}module.exports=function(anything){if(typeof anything==="string")return anything;else if(Array.isArray(anything)){return arrayToString(anything)}else if(typeof anything==="object")return objectToString(anything)}},{}],91:[function(require,module,exports){module.exports=function(window,navigator){require("es5-shim");require("cross-class-list");navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.AudioContext=window.AudioContext||window.webkitAudioContext;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame;window.XMLHttpRequest=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(e0){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e1){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e2){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e3){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e4){}};var method,noop=function(){},methods=["debug","groupCollapsed","groupEnd","error","exception","info","log","trace","warn"],length=methods.length,console=window.console=window.console||{};while(length--){method=methods[length];if(!console[method])console[method]=noop}if(typeof Object.create!="function"){Object.create=function(){var Object=function(){};return function(prototype){Object.prototype=prototype;var result={};Object.prototype=null;return result}}()}if(!Object.keys){Object.keys=function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=="object"&&(typeof obj!=="function"||obj===null)){throw new TypeError("Object.keys called on non-object")}var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop))result.push(prop)}if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i]))result.push(dontEnums[i])}}return result}}()}}},{"cross-class-list":29,"es5-shim":31}],92:[function(require,module,exports){var h=require("hyperscript"),AudioRecorder=require("./audioRecorder"),VideomailError=require("./videomailError"),Events=require("./../events");module.exports=function(rawVisualUserMedia,options){var self=this,paused=false,record=false,audioRecorder;if(options.audio.enabled)audioRecorder=new AudioRecorder(this);function attachMediaStream(stream){if(typeof rawVisualUserMedia.srcObject!=="undefined")rawVisualUserMedia.srcObject=stream;else if(typeof rawVisualUserMedia.src!=="undefined"){var URL=window.URL||window.webkitURL;rawVisualUserMedia.src=URL.createObjectURL(stream)||stream}else console.error("Error attaching stream to element.")}function setVisualStream(localMediaStream){if(localMediaStream)attachMediaStream(localMediaStream);else{rawVisualUserMedia.srcObject=null;rawVisualUserMedia.removeAttribute("src")}}function getVisualStream(){return rawVisualUserMedia.mozSrcObject?rawVisualUserMedia.mozSrcObject:rawVisualUserMedia.srcObject}function hasEnded(){var visualStream=getVisualStream();return visualStream&&visualStream.ended}function hasInvalidDimensions(){if(rawVisualUserMedia.videoWidth&&rawVisualUserMedia.height){if(rawVisualUserMedia.videoWidth<3||rawVisualUserMedia.height<3){return true}}}this.init=function(localMediaStream,videoCallback,audioCallback,endedEarlyCallback){function onPlay(){try{options.debug("UserMedia emits: play");rawVisualUserMedia.removeEventListener&&rawVisualUserMedia.removeEventListener("play",onPlay);localMediaStream.removeEventListener&&localMediaStream.removeEventListener("ended",onPlay);if(hasEnded()||hasInvalidDimensions())endedEarlyCallback(VideomailError.create("Already busy","Probably another browser window is using your webcam?",options));else videoCallback()}catch(exc){self.emit(Events.ERROR,exc)}}try{var videoTrack,videoTracks;if(localMediaStream.getVideoTracks){videoTracks=localMediaStream.getVideoTracks();videoTrack=videoTracks[0]}if(!videoTrack)options.debug("UserMedia: detected (but no video tracks exist");else{var description;if(videoTrack.label&&videoTrack.label.length>0)description=videoTracks.label;else description=videoTrack.kind;options.debug("UserMedia: detected",description?description:"")}setVisualStream(localMediaStream);if(audioRecorder&&audioCallback)audioRecorder.attach(localMediaStream,audioCallback);rawVisualUserMedia.addEventListener("play",onPlay);rawVisualUserMedia.play()}catch(exc){self.emit(Events.ERROR,exc)}};this.isReady=function(){return!!rawVisualUserMedia.src};this.stop=function(){try{var visualStream=getVisualStream();if(visualStream){visualStream.stop&&visualStream.stop();setVisualStream(null)}paused=record=false;audioRecorder&&audioRecorder.stop()}catch(exc){self.emit(Events.ERROR,exc)}};this.createCanvas=function(){return h("canvas",{width:rawVisualUserMedia.width||rawVisualUserMedia.clientWidth,height:rawVisualUserMedia.height||rawVisualUserMedia.clientHeight})};this.getRawVisuals=function(){return rawVisualUserMedia};this.pause=function(){paused=true};this.isPaused=function(){return paused};this.resume=function(){paused=false};this.record=function(){record=true};this.isRecording=function(){return record};this.getAudioSampleRate=function(){if(audioRecorder)return audioRecorder.getSampleRate();else return-1}}},{"./../events":81,"./audioRecorder":84,"./videomailError":93,hyperscript:34}],93:[function(require,module,exports){var createError=require("create-error"),pretty=require("./pretty"),VIDEOMAIL_ERR_NAME="Videomail Error";var VideomailError=createError(Error,VIDEOMAIL_ERR_NAME,{explanation:undefined,logLines:undefined});VideomailError.PERMISSION_DENIED="PERMISSION_DENIED";VideomailError.NOT_CONNECTED="Not connected";VideomailError.STARTING_FAILED="Starting video failed";VideomailError.create=function(err,explanation,options){if(err&&err.name===VIDEOMAIL_ERR_NAME)return err;if(!options&&explanation){options=explanation;explanation=undefined}options=options||{};var Browser=require("./browser"),browser=new Browser(options),errType,message,stack;if(typeof err=="object"){if(err.code==1&&err.PERMISSION_DENIED==1)errType=VideomailError.PERMISSION_DENIED;else if(err.message===VideomailError.STARTING_FAILED)errType=err.message;else if(err.name)errType=err.name;else if(err.type==="error"&&err.target.bufferedAmount===0)errType=VideomailError.NOT_CONNECTED;if(err.stack)stack=err.stack}else if(err===VideomailError.NOT_CONNECTED)errType=VideomailError.NOT_CONNECTED;else errType=err;switch(errType){case"NO_DEVICES_FOUND":message="No webcam found";explanation="Your browser cannot find a webcam attached to your machine.";break;case VideomailError.PERMISSION_DENIED:case"PermissionDeniedError":message="Permission denied!";if(browser.isChromeBased()||browser.isFirefox())explanation="Permission to access your webcam has been denied. "+"This can have two reasons:<br/>"+"a) you blocked access to webcam; or<br/>"+"b) your webcam is already in use.";break;case"HARDWARE_UNAVAILABLE":message="Webcam is unavailable!";explanation="Maybe it is already busy in another window?";if(browser.isChromeBased())explanation+=" Or you have to allow access above?";break;case VideomailError.NOT_CONNECTED:message="Unable to transfer data";explanation="Unable to maintain a binary websocket to the server. Either the server or "+"your connection is down. Trying to reconnect every two seconds …";break;case"NO_VIDEO_FEED":message="No video feed found!";explanation="Your webcam is already used in another browser.";break;case VideomailError.STARTING_FAILED:message="Starting video failed";explanation="Most likely this happens when the webam is already active in another browser.";break;case"DevicesNotFoundError":message="Webcam is unavailable";explanation="Looks like another program has control over your webcam? Close it and come back.";break;default:if(typeof err==="string")message=err;else{if(err&&err.message)message=err.message.toString();if(err&&err.explanation)explanation=err.explanation.toString();if(err&&err.details){var details=pretty(err.details);if(!explanation)explanation=details;else explanation+=";<br/>"+details}}break}var logLines=null;if(options.logger&&options.logger.getLines)logLines=options.logger.getLines();if(stack){message=new Error(message);message.stack=stack}return new VideomailError(message,{explanation:explanation,logLines:logLines})};module.exports=VideomailError},{"./browser":85,"./pretty":90,"create-error":28}],94:[function(require,module,exports){var util=require("util"),h=require("hyperscript"),Events=require("./../events"),EventEmitter=require("./../util/eventEmitter");var Buttons=function(container,options){EventEmitter.call(this,options,"Buttons");var self=this,buttonsElement,recordButton,pauseButton,resumeButton,stopButton,backButton,submitButton,built;function hide(element){element.classList.add("hide")}function show(element){element.classList.remove("hide")}function adjustButton(buttonElement,show,type){buttonElement.disabled=true;buttonElement.type=type||"button";!show&&hide(buttonElement);return buttonElement}function replaceClickHandler(buttonElement,clickHandler){var wrappedClickHandler=function(e){e&&e.preventDefault();clickHandler()};buttonElement.onclick=wrappedClickHandler}function makeButton(buttonClass,text,clickHandler,show,id,type){var buttonElement;if(id)buttonElement=document.getElementById(id);else buttonElement=buttonsElement.querySelector("."+buttonClass);if(!buttonElement){if(options.selectors.buttonClass)buttonClass+="."+options.selectors.buttonClass;buttonElement=h("button."+buttonClass);buttonElement=adjustButton(buttonElement,show,type);buttonElement.innerHTML=text;if(submitButton)buttonsElement.insertBefore(buttonElement,submitButton);else buttonsElement.appendChild(buttonElement)}else buttonElement=adjustButton(buttonElement,show,type);if(clickHandler)replaceClickHandler(buttonElement,clickHandler);return buttonElement}function buildButtons(){if(!options.disableSubmit){if(!submitButton)submitButton=makeButton(options.selectors.submitButtonClass,"Submit",null,true,options.selectors.submitButtonId,"submit");else submitButton.disabled=true;if(!container.hasForm()&&submitButton)replaceClickHandler(submitButton,submit)}recordButton=makeButton(options.selectors.recordButtonClass,"Record",container.record,false);if(options.enablePause)pauseButton=makeButton(options.selectors.pauseButtonClass,"Pause",container.pause,false);if(options.enablePause)resumeButton=makeButton(options.selectors.resumeButtonClass,"Resume",container.resume,false);stopButton=makeButton(options.selectors.stopButtonClass,"Stop",container.stop,false);backButton=makeButton(options.selectors.backButtonClass,"Back",back,false)}function onFormReady(){stopButton.disabled=true;if(options.enablePause)show(stopButton);if(options.enablePause){if(pauseButton.disabled)show(recordButton);else{stopButton.disabled=false;show(resumeButton)}}else show(recordButton)}function onReady(){onFormReady();hide(backButton);recordButton.disabled=false;if(submitButton)submitButton.disabled=true}function onResetting(){if(submitButton)submitButton.disabled=true;self.reset()}function onPreview(){hide(recordButton);hide(stopButton);show(backButton);backButton.disabled=false}this.enableSubmit=function(){if(submitButton)submitButton.disabled=false};function onPaused(){pauseButton&&hide(pauseButton);show(resumeButton);resumeButton.disabled=false;hide(recordButton);show(stopButton)}function onFirstFrameSent(){hide(recordButton);if(pauseButton){show(pauseButton);pauseButton.disabled=false}stopButton.disabled=false;show(stopButton)}function onRecording(framesCount){if(framesCount>1)onFirstFrameSent();else recordButton.disabled=true}function onResuming(){hide(resumeButton);hide(recordButton);if(pauseButton){pauseButton.disabled=false;show(pauseButton)}}function onStopping(){stopButton.disabled=true;pauseButton&&hide(pauseButton);resumeButton&&hide(resumeButton)}function onCountdown(){recordButton.disabled=true}function onSubmitting(){submitButton.disabled=true;backButton.disabled=true}function onSubmitted(){stopButton.disabled=true;if(options.enablePause)show(stopButton);hide(backButton);recordButton.disabled=true;show(recordButton);
submitButton.disabled=true}function onInvalid(){if(submitButton)submitButton.disabled=true}function onValid(){if(submitButton)submitButton.disabled=false}function onHidden(){hide(recordButton);hide(stopButton);hide(backButton);hide(resumeButton)}function back(){backButton.disabled=true;container.beginWaiting();container.back()}function submit(){container.submit()}function initEvents(){self.on(Events.USER_MEDIA_READY,function(){onReady()}).on(Events.PREVIEW,function(){onPreview()}).on(Events.PAUSED,function(){onPaused()}).on(Events.RECORDING,function(framesCount){onRecording(framesCount)}).on(Events.FIRST_FRAME_SENT,function(){onFirstFrameSent()}).on(Events.RESUMING,function(){onResuming()}).on(Events.STOPPING,function(){onStopping()}).on(Events.COUNTDOWN,function(){onCountdown()}).on(Events.SUBMITTING,function(){onSubmitting()}).on(Events.RESETTING,function(){onResetting()}).on(Events.INVALID,function(){onInvalid()}).on(Events.VALID,function(){onValid()}).on(Events.SUBMITTED,function(){onSubmitted()}).on(Events.HIDE,function(){onHidden()}).on(Events.FORM_READY,function(){onFormReady()})}this.reset=function(){options.debug("Buttons: reset()");if(pauseButton)pauseButton.disabled=true;if(resumeButton)resumeButton.disabled=true;recordButton.disabled=stopButton.disabled=backButton.disabled=true};this.isBackButtonEnabled=function(){return!backButton.disabled};this.isRecordButtonEnabled=function(){return!recordButton.disabled};this.setSubmitButton=function(newSubmitButton){submitButton=newSubmitButton};this.build=function(){buttonsElement=container.querySelector("."+options.selectors.buttonsClass);if(!buttonsElement){buttonsElement=h("div."+options.selectors.buttonsClass);container.appendChild(buttonsElement)}buildButtons();!built&&initEvents();built=true};this.unload=function(){built=false};this.hide=function(){hide(buttonsElement)};this.show=function(){show(buttonsElement)}};util.inherits(Buttons,EventEmitter);module.exports=Buttons},{"./../events":81,"./../util/eventEmitter":87,hyperscript:34,util:26}],95:[function(require,module,exports){var insertCss=require("insert-css"),util=require("util"),Visuals=require("./visuals"),Buttons=require("./buttons"),Form=require("./form"),Resource=require("./../resource"),Events=require("./../events"),EventEmitter=require("./../util/eventEmitter"),css=require("./../assets/css/main.min.css.js");var Container=function(options){EventEmitter.call(this,options,"Container");var self=this,visuals=new Visuals(this,options),buttons=new Buttons(this,options),resource=new Resource(options),htmlElement=document.querySelector("html"),hasError=false,submitted=false,containerElement,built,form;function prependDefaultCss(){insertCss(css,{prepend:true})}function getFormElement(){var formElement;if(containerElement.tagName==="FORM")formElement=containerElement;else if(options.selectors.formId)formElement=document.getElementById(options.selectors.formId);return formElement}function buildForm(){var formElement=getFormElement();if(formElement){form=new Form(self,formElement,options);var submitButton=form.getSubmitButton();submitButton&&buttons.setSubmitButton(submitButton);form.build()}}function buildChildren(){if(!containerElement.classList)self.emit(Events.ERROR,new Error("Sorry, your browser is too old!"));else{containerElement.classList.add("videomail");buttons.build();visuals.build()}}function processError(err){hasError=true;if(err.stack)options.logger.error(err.stack);else options.logger.error(err);if(options.displayErrors)visuals.block(err);else visuals.reset()}function initEvents(){window.addEventListener("beforeunload",function(e){self.unload(e)});if(options.enablePause&&options.enableAutoPause)window.addEventListener("blur",function(e){self.isRecording()&&self.pause(e)});if(options.enableSpace)window.addEventListener("keypress",function(e){var tagName=e.target.tagName;if(tagName!=="INPUT"&&tagName!=="TEXTAREA"){var code=e.keyCode?e.keyCode:e.which;if(code==32){e.preventDefault();if(options.enablePause)visuals.pauseOrResume();else visuals.recordOrStop()}}});self.on(Events.ERROR,function(err){processError(err);unloadButKeepEventListeners(err)})}function unloadButKeepEventListeners(e){visuals.unload(e);buttons.unload();self.endWaiting()}function hideMySelf(){containerElement.classList.add("hide")}function submitVideomail(formData,cb){var FORM_FIELDS={subject:options.selectors.subjectInputName,from:options.selectors.fromInputName,to:options.selectors.toInputName,body:options.selectors.bodyInputName,key:options.selectors.keyInputName,parentKey:options.selectors.parentKeyInputName},videomailFormData={};Object.keys(FORM_FIELDS).forEach(function(key){if(formData.hasOwnProperty(FORM_FIELDS[key]))videomailFormData[key]=formData[FORM_FIELDS[key]]});videomailFormData.avgFps=visuals.getAvgFps();if(options.audio.enabled)videomailFormData.sampleRate=visuals.getAudioSampleRate();resource.post(videomailFormData,cb)}function submitForm(formData,videomailResponse,url,cb){delete formData.avgFps;formData[options.selectors.aliasInputName]=videomailResponse.videomail.alias;resource.form(formData,url,cb)}function finalizeSubmissions(err,videomail,response,formResponse){self.endWaiting();if(err)self.emit(Events.ERROR,err);else{submitted=true;if(formResponse&&formResponse.body)Object.keys(formResponse.body).forEach(function(key){response[key]=formResponse.body[key]});self.emit(Events.SUBMITTED,videomail,response);if(formResponse&&formResponse.type==="text/html"&&formResponse.text){document.body.innerHTML=formResponse.text}}}this.areVisualsHidden=function(){return visuals.isHidden()};this.hasElement=function(){return!!containerElement};this.build=function(containerId){try{containerId=containerId||options.selectors.containerId;containerElement=document.getElementById(containerId);if(containerElement){options.insertCss&&prependDefaultCss();!built&&initEvents();buildForm();buildChildren();if(!hasError)built=true}}catch(exc){self.emit(Events.ERROR,exc)}};this.querySelector=function(selector){return containerElement.querySelector(selector)};this.beginWaiting=function(){htmlElement.classList&&htmlElement.classList.add("wait")};this.endWaiting=function(){htmlElement.classList&&htmlElement.classList.remove("wait")};this.appendChild=function(child){containerElement.appendChild(child)};this.insertBefore=function(child,reference){containerElement.insertBefore(child,reference)};this.unload=function(e){try{unloadButKeepEventListeners(e);this.removeAllListeners();built=submitted=false}catch(exc){self.emit(Events.ERROR,exc)}};this.show=function(){if(containerElement){containerElement.classList.remove("hide");visuals.show();buttons.show();if(!hasError){if(self.isReplayShown())self.emit(Events.PREVIEW);else self.emit(Events.FORM_READY)}}};this.hide=function(){hasError=false;if(this.isRecording())this.pause();visuals.hide();if(submitted){buttons.hide();hideMySelf()}};this.isNotifying=function(){return visuals.isNotifying()};this.isPaused=function(){return visuals.isPaused()};this.pause=function(){visuals.pause()};this.startOver=function(){try{submitted=false;visuals.back(this.show)}catch(exc){self.emit(Events.ERROR,exc)}};this.validate=function(force){var valid;if(force||!this.isNotifying()){this.emit(Events.VALIDATING);var visualsValid=visuals.validate()&&buttons.isBackButtonEnabled(),whyInvalid;if(form){valid=form.validate();if(valid){if(!this.areVisualsHidden()&&!visualsValid){if(this.isReady()||this.isRecording()||this.isPaused()||this.isCountingDown())valid=false;if(!valid)whyInvalid="requiresRecord"}}else whyInvalid="badFormData"}else valid=visualsValid;if(valid)this.emit(Events.VALID);else this.emit(Events.INVALID,whyInvalid)}return valid};this.disableForm=function(buttonsToo){form&&form.disable(buttonsToo)};this.enableForm=function(buttonsToo){form&&form.enable(buttonsToo)};this.hasForm=function(){return!!form};this.isReady=function(){return buttons.isRecordButtonEnabled()};this.submitAll=function(formData,method,url){this.beginWaiting();this.disableForm(true);this.emit(Events.SUBMITTING);submitVideomail(formData,function(err,videomail,videomailResponse){if(!err&&method&&method.toUpperCase()=="POST"){if(!url||url==="")url=document.baseURI;submitForm(formData,videomailResponse,url,function(err,formResponse){finalizeSubmissions(err,videomail,videomailResponse,formResponse)})}else finalizeSubmissions(err,videomail,videomailResponse)})};this.isBuilt=function(){return built};this.isReplayShown=function(){return visuals.isReplayShown()};this.isDirty=function(){var isDirty=false;if(!!form){if(visuals.isRecorderUnloaded())isDirty=false;else if(this.isReplayShown()||this.isPaused())isDirty=true}return isDirty};this.isCountingDown=visuals.isCountingDown.bind(visuals);this.isRecording=visuals.isRecording.bind(visuals);this.record=visuals.record.bind(visuals);this.resume=visuals.resume.bind(visuals);this.stop=visuals.stop.bind(visuals);this.back=visuals.back.bind(visuals)};util.inherits(Container,EventEmitter);module.exports=Container},{"./../assets/css/main.min.css.js":78,"./../events":81,"./../resource":83,"./../util/eventEmitter":87,"./buttons":94,"./form":96,"./visuals":97,"insert-css":38,util:26}],96:[function(require,module,exports){var h=require("hyperscript"),util=require("util"),Events=require("./../events"),EventEmitter=require("./../util/eventEmitter"),VideomailError=require("./../util/videomailError");var Form=function(container,formElement,options){EventEmitter.call(this,options,"Form");var self=this,keyInput;function getData(){var limit=formElement.elements.length,data={};for(var i=0;i<limit;i++){if(formElement.elements[i].name)data[formElement.elements[i].name]=formElement.elements[i].value}return data}function isNotButton(element){return element.tagName!=="BUTTON"&&element.type!=="submit"}function setDisabled(disabled,buttonsToo){var limit=formElement.elements.length;for(var i=0;i<limit;i++){if(buttonsToo||!buttonsToo&&isNotButton(formElement.elements[i]))formElement.elements[i].disabled=disabled}}this.disable=function(buttonsToo){setDisabled(true,buttonsToo)};this.enable=function(buttonsToo){setDisabled(false,buttonsToo)};this.build=function(){if(options.enableAutoValidation){var textElements=formElement.querySelectorAll("input, textarea");for(var i=0,len=textElements.length;i<len;i++){textElements[i].addEventListener("input",function(){container.validate()})}var selectElements=formElement.querySelectorAll("select");for(var i=0,len=selectElements.length;i<len;i++){selectElements[i].addEventListener("change",function(){container.validate()})}}keyInput=formElement.querySelector('input[name="'+options.selectors.keyInputName+'"]');if(!keyInput){keyInput=h("input",{name:options.selectors.keyInputName,type:"hidden"});formElement.appendChild(keyInput)}this.on(Events.PREVIEW,function(videomailKey){if(!videomailKey&&!keyInput.value)self.emit(Events.ERROR,VideomailError.create("Videomail key for preview is missing!"));else if(videomailKey)keyInput.value=videomailKey});formElement.addEventListener("submit",function(e){if(!container.areVisualsHidden()){e.preventDefault();if(container.hasElement()){container.submitAll(getData(),formElement.getAttribute("method"),formElement.getAttribute("action"))}}})};this.validate=function(){return formElement.checkValidity()};this.getSubmitButton=function(){return formElement.querySelector("[type='submit']")}};util.inherits(Form,EventEmitter);module.exports=Form},{"./../events":81,"./../util/eventEmitter":87,"./../util/videomailError":93,hyperscript:34,util:26}],97:[function(require,module,exports){var util=require("util"),h=require("hyperscript"),Replay=require("./visuals/replay"),Recorder=require("./visuals/recorder"),Notifier=require("./visuals/notifier"),RecorderInsides=require("./visuals/inside/recorderInsides"),EventEmitter=require("./../util/eventEmitter"),Events=require("./../events");var Visuals=function(container,options){EventEmitter.call(this,options,"Visuals");var self=this,replay=new Replay(this,options),recorder=new Recorder(this,replay,options),recorderInsides=new RecorderInsides(this,options),notifier=new Notifier(this,options),debug=options.debug,visualsElement,built;function buildNoScriptTag(){var noScriptElement=container.querySelector("noscript");if(!noScriptElement){noScriptElement=h("noscript");noScriptElement.innerHTML="Please enable Javascript";visualsElement.appendChild(noScriptElement)}}function buildChildren(){debug("Visuals: buildChildren()");buildNoScriptTag();notifier.build();recorderInsides.build();replay.build()}function initEvents(){self.on(Events.USER_MEDIA_READY,function(){built=true;self.endWaiting();container.enableForm(false)}).on(Events.PREVIEW,function(){self.endWaiting()}).on(Events.BLOCKING,function(){container.disableForm(true)}).on(Events.PREVIEW_SHOWN,function(){container.validate(true)})}function isRecordable(){return!self.isNotifying()&&!replay.isShown()&&!this.isCountingDown()}this.isCountingDown=function(){return recorderInsides.isCountingDown()};this.build=function(){visualsElement=container.querySelector("."+options.selectors.visualsClass);if(!visualsElement){visualsElement=h("div."+options.selectors.visualsClass);var buttonsElement=container.querySelector("."+options.selectors.buttonsClass);if(buttonsElement)container.insertBefore(visualsElement,buttonsElement);else container.appendChild(visualsElement)}visualsElement.classList.add("visuals");visualsElement.classList.add("hide");if(!visualsElement.style.width&&options.video.width)visualsElement.style.width=options.video.width+"px";if(!visualsElement.style.height&&options.video.height)visualsElement.style.height=options.video.height+"px";!built&&initEvents();buildChildren();built=true};this.querySelector=function(selector){return visualsElement.querySelector(selector)};this.appendChild=function(child){visualsElement.appendChild(child)};this.removeChild=function(child){visualsElement.removeChild(child)};this.reset=function(){this.endWaiting();recorder.reset()};this.beginWaiting=function(){container.beginWaiting()};this.endWaiting=function(){container.endWaiting()};this.stop=function(limitReached){recorder.stop(limitReached);recorderInsides.hidePause()};this.back=function(cb){replay.hide();notifier.hide();recorder.back(cb)};this.unload=function(e){recorder.unload(e);recorderInsides.unload(e);replay.unload(e);built=false};this.isNotifying=function(){return notifier.isVisible()};this.isReplayShown=function(){return replay.isShown()};this.pause=function(){recorder.pause();recorderInsides.showPause()};this.resume=function(){recorder.resume();recorderInsides.hidePause()};this.pauseOrResume=function(){if(isRecordable.call(this)){if(this.isRecording())this.pause();else if(recorder.isPaused())this.resume();else if(recorder.isReady())this.record()}};this.recordOrStop=function(){if(isRecordable()){if(this.isRecording())this.stop();else if(recorder.isReady())this.record()}};this.record=function(){if(options.video.countdown){this.emit(Events.COUNTDOWN);recorderInsides.startCountdown(recorder.record.bind(recorder))}else recorder.record()};this.getRecorder=function(){return recorder};this.getReplay=function(){return replay};this.validate=function(){return recorder.validate()&&this.isReplayShown()};this.getAvgFps=function(){return recorder.getAvgFps()};this.getAudioSampleRate=function(){return recorder.getAudioSampleRate()};this.isPaused=function(){return recorder.isPaused()};this.block=function(err){notifier.block(err)};this.hide=function(){if(visualsElement){visualsElement.classList.add("hide");this.emit(Events.HIDE)}};this.isHidden=function(){if(!built)return true;else return visualsElement.classList.contains("hide")};this.show=function(){if(!this.isReplayShown())recorder.build();visualsElement.classList.remove("hide")};this.isRecorderUnloaded=function(){return recorder.isUnloaded()};this.isReplayShown=replay.isShown.bind(replay);this.hideReplay=replay.hide.bind(replay);this.hideRecorder=recorder.hide.bind(recorder);this.isRecording=recorder.isRecording.bind(recorder)};util.inherits(Visuals,EventEmitter);module.exports=Visuals},{"./../events":81,"./../util/eventEmitter":87,"./visuals/inside/recorderInsides":102,"./visuals/notifier":103,"./visuals/recorder":104,"./visuals/replay":105,hyperscript:34,util:26}],98:[function(require,module,exports){var h=require("hyperscript");module.exports=function(visuals,options){var self=this,countdownElement,intervalId,countdown;function fire(cb){self.unload();self.hide();cb()}function countBackward(cb){countdown--;if(countdown<1)fire(cb);else countdownElement.innerHTML=countdown}this.start=function(cb){countdownElement.innerHTML=countdown=options.video.countdown;this.show();intervalId=setInterval(countBackward.bind(this,cb),1e3)};this.build=function(){countdownElement=visuals.querySelector(".countdown");if(!countdownElement){countdownElement=h("p.countdown");this.hide();visuals.appendChild(countdownElement)}else this.hide()};this.show=function(){countdownElement.classList.remove("hide")};this.isCountingDown=function(){return!!intervalId};this.unload=function(){clearInterval(intervalId);intervalId=null};this.hide=function(){countdownElement.classList.add("hide");this.unload()}}},{hyperscript:34}],99:[function(require,module,exports){var h=require("hyperscript"),VideomailError=require("./../../../../util/videomailError");module.exports=function(visuals,options){if(!options.text.paused)throw VideomailError.create("Paused text cannot be empty",options);var pausedElement;this.build=function(){pausedElement=visuals.querySelector(".paused");if(!pausedElement){pausedElement=h("p.paused");this.hide();pausedElement.innerHTML=options.text.paused;visuals.appendChild(pausedElement)}else{this.hide();pausedElement.innerHTML=options.text.paused}};this.hide=function(){pausedElement.classList.add("hide")};this.show=function(){pausedElement.classList.remove("hide")}}},{"./../../../../util/videomailError":93,hyperscript:34}],100:[function(require,module,exports){var h=require("hyperscript");module.exports=function(visuals){var recordNoteElement;this.build=function(){recordNoteElement=visuals.querySelector(".recordNote");if(!recordNoteElement){recordNoteElement=h("p.recordNote");this.hide();visuals.appendChild(recordNoteElement)}else this.hide()};this.stop=function(){this.hide();recordNoteElement.classList.remove("near");recordNoteElement.classList.remove("nigh")};this.setNear=function(){recordNoteElement.classList.add("near")};this.setNigh=function(){recordNoteElement.classList.add("nigh")};this.hide=function(){recordNoteElement.classList.add("hide")};this.show=function(){recordNoteElement.classList.remove("hide")}}},{hyperscript:34}],101:[function(require,module,exports){var pauseable=require("pauseable"),h=require("hyperscript");module.exports=function(visuals,recordNote,options){var recordTimerElement,nearComputed=false,endNighComputed=false,timer,countdown;function pad(n){return n<10?"0"+n:n}function thresholdReached(secs,threshold){return secs>=options.video.limitSeconds*threshold}function isNear(secs){if(!nearComputed&&thresholdReached(secs,.6)){nearComputed=true;return true}else return false}function endIsNigh(secs){if(!endNighComputed&&thresholdReached(secs,.8)){endNighComputed=true;return true}else return false}function setNear(){recordTimerElement.classList.add("near")}function setNigh(){recordTimerElement.classList.add("nigh")}function update(cb){timer&&timer.clear();var mins=parseInt(countdown/60,10),secs=countdown-mins*60;if(!nearComputed||!endNighComputed){var remainingSeconds=options.video.limitSeconds-countdown;if(isNear(remainingSeconds)){recordNote.setNear();setNear();options.debug("End is near, "+countdown+" seconds to go")}else if(endIsNigh(remainingSeconds)){recordNote.setNigh();setNigh();options.debug("End is nigh, "+countdown+" seconds to go")}}recordTimerElement.innerHTML=mins+":"+pad(secs);timer=pauseable.setTimeout(function(){countdown--;if(countdown<0)cb(true);else update(cb)},980)}function hide(){recordTimerElement.classList.add("hide")}function show(){recordTimerElement.classList.remove("near");recordTimerElement.classList.remove("nigh");recordTimerElement.classList.remove("hide")}this.start=function(cb){countdown=options.video.limitSeconds-1;nearComputed=endNighComputed=false;show();recordNote.show();update(cb)};this.pause=function(){timer&&timer.pause();recordNote.hide()};this.resume=function(){timer.resume();recordNote.show()};this.stop=function(){options.debug("Stopping record timer ...");hide();timer&&timer.clear();recordNote.stop()};this.build=function(){recordTimerElement=visuals.querySelector(".recordTimer");if(!recordTimerElement){recordTimerElement=h("p.recordTimer");hide();visuals.appendChild(recordTimerElement)}else hide()}}},{hyperscript:34,pauseable:41}],102:[function(require,module,exports){var util=require("util"),Events=require("./../../../events"),EventEmitter=require("./../../../util/eventEmitter"),Countdown=require("./recorder/countdown"),PausedNote=require("./recorder/pausedNote"),RecordNote=require("./recorder/recordNote"),RecordTimer=require("./recorder/recordTimer");var RecorderInsides=function(visuals,options){EventEmitter.call(this,options,"RecorderInsides");var self=this,recordNote=new RecordNote(visuals),recordTimer=new RecordTimer(visuals,recordNote,options),countdown,pausedNote,built;if(options.video.countdown)countdown=new Countdown(visuals,options);if(options.enablePause)pausedNote=new PausedNote(visuals,options);function startRecording(cb){recordTimer.start(cb)}function resumeRecording(){recordTimer.resume()}function stopRecording(){recordTimer.stop()}function pauseRecording(){recordTimer.pause()}function onResetting(){self.hidePause();self.hideCountdown();recordTimer.stop()}function initEvents(){self.on(Events.RECORDING,function(){startRecording(function(limitReached){visuals.stop(limitReached)})}).on(Events.RESUMING,function(){resumeRecording()}).on(Events.STOPPING,function(){stopRecording()}).on(Events.PAUSED,function(){pauseRecording()}).on(Events.RESETTING,onResetting).on(Events.HIDE,function(){self.hideCountdown()})}this.build=function(){countdown&&countdown.build();pausedNote&&pausedNote.build();recordNote.build();recordTimer.build();!built&&initEvents();built=true};this.unload=function(){countdown&&countdown.unload();built=false};this.showPause=function(){pausedNote&&pausedNote.show()};this.hidePause=function(){pausedNote&&pausedNote.hide()};this.hideCountdown=function(){countdown&&countdown.hide()};this.startCountdown=function(cb){countdown&&countdown.start(cb)};this.isCountingDown=function(){return countdown&&countdown.isCountingDown()}};util.inherits(RecorderInsides,EventEmitter);module.exports=RecorderInsides},{"./../../../events":81,"./../../../util/eventEmitter":87,"./recorder/countdown":98,"./recorder/pausedNote":99,"./recorder/recordNote":100,"./recorder/recordTimer":101,util:26}],103:[function(require,module,exports){var util=require("util"),h=require("hyperscript"),EventEmitter=require("./../../util/eventEmitter"),Events=require("./../../events");var Notifier=function(visuals,options){EventEmitter.call(this,options,"Notifier");var self=this,debug=options.debug,notifyElement,messageElement,explanationElement,entertainTimeoutId,built;function onStopping(limitReached){var lead="";visuals.beginWaiting();if(limitReached){debug("Limit reached");lead+=options.text.limitReached+".<br/>"}lead+=options.text.processing+" …";self.notify(lead,null,{processing:true,entertain:options.notifier.entertain})}function onProgress(frameProgress,sampleProgress){var overallProgress;if(options.audio.enabled){overallProgress="Video: "+frameProgress;if(sampleProgress)overallProgress+=", Audio: "+sampleProgress}else overallProgress=frameProgress;self.setExplanation(overallProgress)}function initEvents(){debug("Notifier: initEvents()");self.on(Events.USER_MEDIA_READY,function(){self.hide()}).on(Events.PREVIEW,function(){self.hide()}).on(Events.STOPPING,function(limitReached){onStopping(limitReached)}).on(Events.PROGRESS,function(frameProgress,sampleProgress){onProgress(frameProgress,sampleProgress)})}function show(){if(notifyElement)notifyElement.classList.remove("hide")}function runEntertainment(){if(options.notifier.entertain){var randomBackgroundClass=Math.floor(Math.random()*options.notifier.entertainLimit+1);notifyElement.className="notifier entertain "+options.notifier.entertainClass+randomBackgroundClass;entertainTimeoutId=setTimeout(runEntertainment,options.notifier.entertainInterval)}else cancelEntertainment()}function cancelEntertainment(){if(notifyElement)notifyElement.className="notifier";clearInterval(entertainTimeoutId)}function setMessage(message,messageOptions){var blocking=messageOptions.blocking?messageOptions.blocking:false;if(messageElement)messageElement.innerHTML=(blocking?"&#x2639; ":"")+message;else options.logger.warn("Unable to show following because messageElement is empty:",message)}this.block=function(err){var message=err.message?err.message.toString():err.toString(),explanation=err.explanation?err.explanation.toString():null;if(!message)options.debug("Weird empty message generated for error",err);self.notify(message,explanation,{blocking:true})};this.setExplanation=function(explanation){if(!explanationElement){explanationElement=h("p");if(notifyElement)notifyElement.appendChild(explanationElement);else options.logger.warn("Unable to show explanation because notifyElement is empty:",explanation)}explanationElement.innerHTML=explanation};this.build=function(){notifyElement=visuals.querySelector(".notifier");if(!notifyElement){notifyElement=h(".notifier");this.hide();visuals.appendChild(notifyElement)}else this.hide();if(!notifyElement.width&&options.video.width)notifyElement.width=options.video.width;if(!notifyElement.height&&options.video.height)notifyElement.height=options.video.height;!built&&initEvents();built=true};this.hide=function(){cancelEntertainment();if(notifyElement){notifyElement.classList.add("hide");notifyElement.classList.remove("blocking")}if(messageElement)messageElement.innerHTML=null;if(explanationElement)explanationElement.innerHTML=null};this.isVisible=function(){if(!built)return false;else return notifyElement&&!notifyElement.classList.contains("hide")};this.notify=function(message,explanation,notifyOptions){var processing=notifyOptions.processing?notifyOptions.processing:false,entertain=notifyOptions.entertain?notifyOptions.entertain:false,blocking=notifyOptions.blocking?notifyOptions.blocking:false;if(!messageElement&&notifyElement){messageElement=h("h2");if(explanationElement)notifyElement.insertBefore(messageElement,explanationElement);else notifyElement.appendChild(messageElement)}if(blocking){notifyElement&&notifyElement.classList.add("blocking");this.emit(Events.BLOCKING,notifyOptions)}else this.emit(Events.NOTIFYING,notifyOptions);visuals.hideReplay();visuals.hideRecorder();setMessage(message,notifyOptions);explanation&&this.setExplanation(explanation);if(entertain)runEntertainment();else cancelEntertainment();show();!processing&&visuals.endWaiting()}};util.inherits(Notifier,EventEmitter);module.exports=Notifier},{"./../../events":81,"./../../util/eventEmitter":87,hyperscript:34,util:26}],104:[function(require,module,exports){(function(Buffer){var websocket=require("websocket-stream"),Frame=require("canvas-to-buffer"),util=require("util"),h=require("hyperscript"),Events=require("./../../events"),Constants=require("./../../constants"),EventEmitter=require("./../../util/eventEmitter"),Browser=require("./../../util/browser"),Humanize=require("./../../util/humanize"),UserMedia=require("./../../util/userMedia"),VideomailError=require("./../../util/videomailError");var Recorder=function(visuals,replay,options){EventEmitter.call(this,options,"Recorder");if(!options.video.fps)throw VideomailError.create("FPS must be defined",options);if(!options.video.width)throw VideomailError.create("Video width is too small",options);if(!options.video.height)throw VideomailError.create("Video height is too small",options);var self=this,browser=new Browser(options),wantedInterval=1e3/options.video.fps,debug=options.debug,samplesCount=0,framesCount=0,recorderElement,userMedia,lastAnimationTimestamp,userMediaTimeout,retryTimeout,intervalSum,bytesSum,framesCount,frameProgress,sampleProgress,canvas,ctx,rafId,userMediaLoaded,userMediaLoading,avgFps,submitting,unloaded,stopTime,stream,connected,blocking,built,key;function onAudioSample(audioSample){samplesCount++;writeStream(audioSample.toBuffer())}function onUserMediaReady(){try{debug("Recorder: onUserMediaReady()");blocking=unloaded=submitting=false;userMediaLoaded=true;show();self.emit(Events.USER_MEDIA_READY)}catch(exc){self.emit(Events.ERROR,exc)}}function clearRetryTimeout(){debug("Recorder: clearRetryTimeout()");retryTimeout&&clearTimeout(retryTimeout);retryTimeout=null}function clearUserMediaTimeout(){if(userMediaTimeout){debug("Recorder: clearUserMediaTimeout()");userMediaTimeout&&clearTimeout(userMediaTimeout);userMediaTimeout=null}}function userMediaErrorCallback(err){userMediaLoading=false;clearUserMediaTimeout();var errorListeners=self.listeners(Events.ERROR);if(errorListeners.length){self.emit(Events.ERROR,err);retryTimeout=setTimeout(initSocket,options.timeouts.userMedia)}else{debug("Recorder: no error listeners attached but throwing error",err);throw err}}function showUserMedia(){return!isHidden()||blocking}function loadGenuineUserMedia(){navigator.getUserMedia_({video:true,audio:options.audio.enabled},function(localStream){userMediaLoading=false;if(showUserMedia()){try{clearUserMediaTimeout();userMedia.init(localStream,onUserMediaReady.bind(self),onAudioSample.bind(self),function(err){self.emit(Events.ERROR,err)})}catch(exc){self.emit(Events.ERROR,exc)}}},userMediaErrorCallback)}function loadFlashWebcam(){debug("Recorder: loadFlashWebcam()");visuals.removeChild(recorderElement);recorderElement=h("object."+options.selectors.userMediaClass,{classid:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",type:"application/x-shockwave-flash",data:"jscam_canvas_only.swf",width:recorderElement.width,height:recorderElement.height,classList:recorderElement.classList},h("param",{name:"movie",value:"scam_canvas_only.swf"}),h("param",{name:"FlashVars",value:"mode='callback'&amp;quality='"+options.image.quality+"'"}),h("param",{name:"allowScriptAccess",value:"always"}));visuals.appendChild(recorderElement);function register(run){if(recorderElement.capture!==undefined){userMediaLoading=false;if(showUserMedia()){clearUserMediaTimeout()}}else if(run<1)userMediaErrorCallback(new Error("Flash movie not yet registered"));else setTimeout(register,1e3*(4-run),--run)}register(3)}function useFlash(){return options.forceFlash||!navigator.getUserMedia_}function loadUserMedia(){if(userMediaLoaded){debug("Recorder: skipping loadUserMedia() because it is already loaded");onUserMediaReady();return false}else if(userMediaLoading){debug("Recorder: skipping loadUserMedia() because it is already asking for permission");return false}debug("Recorder: loadUserMedia()");try{userMediaTimeout=setTimeout(function(){if(!self.isReady())self.emit(Events.ERROR,browser.getNoAccessIssue())},options.timeouts.userMedia);userMediaLoading=true;if(useFlash())loadFlashWebcam();else loadGenuineUserMedia()}catch(exc){userMediaLoading=false;var errorListeners=self.listeners(Events.ERROR);if(errorListeners.length)self.emit(Events.ERROR,exc);else{debug("Recorder: no error listeners attached but throwing exception",exc);throw exc}}}function isHidden(){return!recorderElement||recorderElement.classList.contains("hide")}function preview(args){key=args.key;if(args.mp4)replay.setMp4Source(args.mp4+Constants.SITE_NAME_LABEL+"/"+options.siteName);if(args.webm)replay.setWebMSource(args.webm+Constants.SITE_NAME_LABEL+"/"+options.siteName);self.hide();self.emit(Events.PREVIEW,key);if(options.debug){var waitingTime=Date.now()-stopTime;debug("While recording, %s have been transferred and waiting time was %s",Humanize.filesize(bytesSum,2),Humanize.toTime(waitingTime))}}function updateFrameProgress(args){
frameProgress=(args.frame/framesCount*100).toFixed(2)+"%";updateOverallProgress()}function updateSampleProgress(args){sampleProgress=(args.sample/samplesCount*100).toFixed(2)+"%";updateOverallProgress()}function updateOverallProgress(){self.emit(Events.PROGRESS,frameProgress,sampleProgress)}function executeCommand(data){try{var command=JSON.parse(data.toString()),result;debug("Server commanded: %s",command.command,command.args?", "+JSON.stringify(command.args):"",result?"= "+result:"");switch(command.command){case"ready":if(!userMediaTimeout)loadUserMedia();break;case"preview":preview(command.args);break;case"error":this.emit(Events.ERROR,VideomailError.create("Oh no, server error!",command.args.err.toString()||"(No explanation given)",options));break;case"confirmFrame":result=updateFrameProgress(command.args);break;case"confirmSample":result=updateSampleProgress(command.args);break;case"beginAudioEncoding":this.emit(Events.BEGIN_AUDIO_ENCODING);break;case"beginVideoEncoding":this.emit(Events.BEGIN_VIDEO_ENCODING);break;default:this.emit(Events.ERROR,"Unknown server command: "+command.command);break}}catch(exc){self.emit(Events.ERROR,exc)}}function writeStream(buffer){if(stream){if(stream.destroyed)self.emit(Events.ERROR,VideomailError.create("Already disconnected.","Sorry, the connection to the server has been destroyed. Please reload.",options));else stream.write(buffer)}}function writeCommand(command,args,cb){if(!connected){debug("Reconnecting for the command",command,"…");initSocket(function(){writeCommand(command,args);cb&&cb()})}else if(stream){debug("$ %s",command,args?JSON.stringify(args):"");var command={command:command,args:args};writeStream(new Buffer(JSON.stringify(command)));cb&&cb()}}function isNotifying(){return visuals.isNotifying()}function initSocket(cb){if(!connected){debug("Recorder: initialising web socket to %s",options.socketUrl);stream=websocket(options.socketUrl+"?"+encodeURIComponent(Constants.SITE_NAME_LABEL)+"="+encodeURIComponent(options.siteName));stream.on("close",function(err){debug("x Stream has closed");connected=false;if(!err&&self.isPaused())err=VideomailError.create("Pause is too long.","Sorry, please try again and keep the pause under 60 seconds.",options);if(err)self.emit(Events.ERROR,err?err:"Unhandled websocket error")});stream.on("connect",function(){if(!connected){connected=true;unloaded=false;self.emit(Events.CONNECTED);cb&&cb()}});stream.on("data",function(data){executeCommand.call(self,data)});stream.on("error",function(err){connected=false;self.emit(Events.ERROR,err)})}}function disconnect(){if(connected){debug("Recorder: disconnect()");if(submitting)connected=false;else if(stream){stream.end();stream=undefined}}}function cancelAnimationFrame(){rafId&&window.cancelAnimationFrame&&window.cancelAnimationFrame(rafId);rafId=null}this.getAvgFps=function(){return avgFps};this.getAudioSampleRate=function(){return userMedia.getAudioSampleRate()};this.stop=function(limitReached){debug("stop()");this.emit(Events.STOPPING,limitReached);stopTime=Date.now();avgFps=1e3/(intervalSum/framesCount);var args={framesCount:framesCount,videoType:replay.getVideoType(),avgFps:avgFps,limitReached:limitReached};if(options.audio.enabled){args.samplesCount=samplesCount;args.sampleRate=userMedia.getAudioSampleRate()}writeCommand("stop",args);this.reset()};this.back=function(cb){show();this.reset();writeCommand("back",null,cb)};this.unload=function(e){if(!unloaded){var cause;if(e)cause=e.name||e.statusText||e.toString();debug("Recorder: unload()"+(cause?", cause: "+cause:""));this.reset();clearUserMediaTimeout();disconnect();unloaded=true;built=false}};this.reset=function(){if(!unloaded){debug("Recorder: reset()");this.emit(Events.RESETTING);cancelAnimationFrame();replay.reset();userMedia&&userMedia.stop();samplesCount=framesCount=0;userMediaLoaded=key=canvas=ctx=sampleProgress=frameProgress=null}};this.validate=function(){return connected&&framesCount>0&&canvas===null};this.isReady=function(){return userMedia.isReady()};this.pause=function(e){debug("pause()",e?e:"<button press>");userMedia.pause();this.emit(Events.PAUSED)};this.isPaused=function(){return userMedia&&userMedia.isPaused()};this.resume=function(){debug("Recorder: resume()");this.emit(Events.RESUMING);lastAnimationTimestamp=Date.now();userMedia.resume()};this.record=function(){if(unloaded)return false;if(!connected){debug("Recorder: reconnecting before recording ...");initSocket(function(){self.once(Events.USER_MEDIA_READY,self.record)});return false}debug("Recorder: record()");self.emit(Events.RECORDING,framesCount);canvas=userMedia.createCanvas();ctx=canvas.getContext("2d");avgFps=null;bytesSum=intervalSum=0;lastAnimationTimestamp=Date.now();var intervalThreshold=wantedInterval*.85,frame=new Frame(canvas,options),interval,now,buffer;function calcInterval(now){return now-lastAnimationTimestamp}function draw(){try{rafId=window.requestAnimationFrame(draw);if(!self.isPaused()){now=Date.now();interval=calcInterval(now);if(interval>intervalThreshold){lastAnimationTimestamp=now-interval%intervalThreshold;intervalSum+=interval;ctx&&ctx.drawImage(userMedia.getRawVisuals(),0,0,canvas.width,canvas.height);buffer=frame.toBuffer();if(stream){framesCount++;writeStream(buffer);bytesSum+=buffer.length;if(framesCount===1)self.emit(Events.FIRST_FRAME_SENT)}}}}catch(exc){self.emit(Events.ERROR,exc)}}userMedia.record();rafId=window.requestAnimationFrame(draw)};function buildElement(){recorderElement=h("video."+options.selectors.userMediaClass);visuals.appendChild(recorderElement)}function show(){recorderElement.classList.remove("hide")}function initEvents(){self.on(Events.SUBMITTING,function(){submitting=true});self.on(Events.SUBMITTED,function(){submitting=false;self.unload()});self.on(Events.BLOCKING,function(){blocking=true;clearUserMediaTimeout()});self.on(Events.HIDE,function(){self.hide()})}this.build=function(){var err=browser.checkRecordingCapabilities();if(!err)err=browser.checkBufferTypes();if(err)this.emit(Events.ERROR,err);else{recorderElement=visuals.querySelector("video."+options.selectors.userMediaClass);if(!recorderElement)buildElement();if(!recorderElement.width&&options.video.width)recorderElement.width=options.video.width;if(!recorderElement.height&&options.video.height)recorderElement.height=options.video.height;if(options.audio.enabled){recorderElement.muted=true}userMedia=new UserMedia(recorderElement,options);show();if(!built){initEvents();if(!connected)initSocket();else loadUserMedia()}else loadUserMedia();built=true}};this.isPaused=function(){return userMedia&&userMedia.isPaused()};this.isRecording=function(){return!!rafId&&!this.isPaused()&&!isNotifying()};this.hide=function(){if(!isHidden()){recorderElement&&recorderElement.classList.add("hide");clearUserMediaTimeout();clearRetryTimeout()}};this.isUnloaded=function(){return unloaded}};util.inherits(Recorder,EventEmitter);module.exports=Recorder}).call(this,require("buffer").Buffer)},{"./../../constants":80,"./../../events":81,"./../../util/browser":85,"./../../util/eventEmitter":87,"./../../util/humanize":88,"./../../util/userMedia":92,"./../../util/videomailError":93,buffer:2,"canvas-to-buffer":27,hyperscript:34,util:26,"websocket-stream":77}],105:[function(require,module,exports){var util=require("util"),h=require("hyperscript"),Events=require("./../../events"),Browser=require("./../../util/browser"),EventEmitter=require("./../../util/eventEmitter");var Replay=function(parentElement,options){EventEmitter.call(this,options,"Replay");var self=this,browser=new Browser(options),built,replayElement,videomail;function buildElement(){replayElement=h("video."+options.selectors.replayClass,{autoplay:false,controls:"controls"});self.hide();parentElement.appendChild(replayElement)}function isStandalone(){return parentElement.constructor.name==="HTMLDivElement"}function copyAttributes(newVideomail){var attributeContainer;Object.keys(newVideomail).forEach(function(attribute){attributeContainer=parentElement.querySelector("."+attribute);if(attributeContainer)attributeContainer.innerHTML=newVideomail[attribute]})}this.setVideomail=function(newVideomail){videomail=newVideomail;if(videomail.webm)this.setWebMSource(videomail.webm);if(videomail.mp4)this.setMp4Source(videomail.mp4);copyAttributes(newVideomail);this.show()};this.show=function(){replayElement.classList.remove("hide");if(parentElement.classList)parentElement.classList.remove("hide");setTimeout(function(){replayElement.load()},40);if(!isStandalone())if(!videomail)this.emit(Events.PREVIEW_SHOWN);else this.emit(Events.REPLAY_SHOWN)};this.build=function(){replayElement=parentElement.querySelector("video."+options.selectors.replayClass);if(!replayElement)buildElement();else this.hide();if(!replayElement.width&&options.video.width)replayElement.width=options.video.width;if(!replayElement.height&&options.video.height)replayElement.height=options.video.height;if(!replayElement.controls)replayElement.controls=true;if(!built){if(!isStandalone()){this.on(Events.PREVIEW,function(){self.show()})}replayElement.onclick=function(e){e.preventDefault();if(this.paused)this.play();else self.pause()}}browser.checkPlaybackCapabilities(replayElement);built=true};this.unload=function(){built=false};this.getVideoSource=function(type){var sources=replayElement.getElementsByTagName("source"),l=sources.length,type="video/"+type,source;if(l){var i;for(i=0;i<l&&!source;i++){if(sources[i].getAttribute("type")===type)source=sources[i]}}return source};function setVideoSource(type,src){var source=self.getVideoSource(type);if(!source){if(src){var source=h("source",{src:src,type:"video/"+type});replayElement.appendChild(source)}}else{if(src)source.setAttribute("src",src);else replayElement.removeChild(source)}}this.setMp4Source=function(src){setVideoSource("mp4",src)};this.setWebMSource=function(src){setVideoSource("webm",src)};this.getVideoType=function(){return browser.getVideoType(replayElement)};this.pause=function(){replayElement&&replayElement.pause&&replayElement.pause()};this.reset=function(){this.pause();this.setMp4Source(null);this.setWebMSource(null)};this.hide=function(){if(isStandalone())parentElement.classList.add("hide");else replayElement.classList.add("hide")};this.isShown=function(){return!replayElement.classList.contains("hide")}};util.inherits(Replay,EventEmitter);module.exports=Replay},{"./../../events":81,"./../../util/browser":85,"./../../util/eventEmitter":87,hyperscript:34,util:26}],"videomail-client":[function(require,module,exports){var Client=require("./client"),standardize=require("./util/standardize");(function(navigator){standardize(this,navigator)})(navigator);module.exports=Client},{"./client":79,"./util/standardize":91}]},{},["videomail-client"]);