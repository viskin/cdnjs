(function(){var d=Array.prototype.slice;function ah(aB){if(Array.isArray(aB)){for(var aD=0,aC=Array(aB.length);aD<aB.length;aD++){aC[aD]=aB[aD]}return aC}else{return Array.from(aB)}}var w={toString:function(){return"Bacon"}};w.version="0.7.81";var G=(typeof global!=="undefined"&&global!==null?global:this).Error;var au=function(){};var az=function(aC,aB){return aB};var M=function(aB,aC){return aB};var ab=function(aB){return aB.slice(0)};var i=function(aB,aC){if(!aC){throw new G(aB)}};var K=function(aB){if((aB!=null?aB._isObservable:void 0)&&!(aB!=null?aB._isProperty:void 0)){throw new G("Observable is not a Property : "+aB)}};var Y=function(aB){if(!(aB!=null?aB._isEventStream:void 0)){throw new G("not an EventStream : "+aB)}};var t=function(aB){if(!(aB!=null?aB._isObservable:void 0)){throw new G("not an Observable : "+aB)}};var ao=function(aB){return i("not a function : "+aB,I.isFunction(aB))};var a=function(aB){return aB instanceof Array};var ad=function(aB){return aB&&aB._isObservable};var S=function(aB){if(!a(aB)){throw new G("not an array : "+aB)}};var aa=function(aB){return i("no arguments supported",aB.length===0)};var U=function(aB){if(typeof aB==="string"){throw new G("not a string : "+aB)}};var P=function(aD){var aC=arguments.length;for(var aB=1;1<aC?aB<aC:aB>aC;1<aC?aB++:aB--){for(var aE in arguments[aB]){aD[aE]=arguments[aB][aE]}}return aD};var m=function(aF,aD){var aC={}.hasOwnProperty;var aE=function(){};aE.prototype=aD.prototype;aF.prototype=new aE();for(var aB in aD){if(aC.call(aD,aB)){aF[aB]=aD[aB]}}return aF};var I={indexOf:function(){if(Array.prototype.indexOf){return function(aC,aB){return aC.indexOf(aB)}}else{return function(aC,aB){for(var aD=0,aE;aD<aC.length;aD++){aE=aC[aD];if(aB===aE){return aD}}return -1}}}(),indexWhere:function(aB,aD){for(var aC=0,aE;aC<aB.length;aC++){aE=aB[aC];if(aD(aE)){return aC}}return -1},head:function(aB){return aB[0]},always:function(aB){return function(){return aB}},negate:function(aB){return function(aC){return !aB(aC)}},empty:function(aB){return aB.length===0},tail:function(aB){return aB.slice(1,aB.length)},filter:function(aF,aD){var aC=[];for(var aE=0,aB;aE<aD.length;aE++){aB=aD[aE];if(aF(aB)){aC.push(aB)}}return aC},map:function(aC,aB){return function(){var aE=[];for(var aF=0,aD;aF<aB.length;aF++){aD=aB[aF];aE.push(aC(aD))}return aE}()},each:function(aB,aE){for(var aC in aB){if(Object.prototype.hasOwnProperty.call(aB,aC)){var aD=aB[aC];aE(aC,aD)}}},toArray:function(aB){return a(aB)?aB:[aB]},contains:function(aC,aB){return I.indexOf(aC,aB)!==-1},id:function(aB){return aB},last:function(aB){return aB[aB.length-1]},all:function(aC){var aE=arguments.length<=1||arguments[1]===undefined?I.id:arguments[1];for(var aD=0,aB;aD<aC.length;aD++){aB=aC[aD];if(!aE(aB)){return false}}return true},any:function(aC){var aE=arguments.length<=1||arguments[1]===undefined?I.id:arguments[1];for(var aD=0,aB;aD<aC.length;aD++){aB=aC[aD];if(aE(aB)){return true}}return false},without:function(aB,aC){return I.filter(function(aD){return aD!==aB},aC)},remove:function(aB,aC){var aD=I.indexOf(aC,aB);if(aD>=0){return aC.splice(aD,1)}},fold:function(aD,aC,aF){for(var aE=0,aB;aE<aD.length;aE++){aB=aD[aE];aC=aF(aC,aB)}return aC},flatMap:function(aC,aB){return I.fold(aB,[],function(aE,aD){return aE.concat(aC(aD))})},cached:function(aC){var aB=j;return function(){if(typeof aB!=="undefined"&&aB!==null?aB._isNone:undefined){aB=aC();aC=undefined}return aB}},bind:function(aB,aC){return function(){return aB.apply(aC,arguments)}},isFunction:function(aB){return typeof aB==="function"},toString:function(aF){var aD,aB,aE;var aC={}.hasOwnProperty;try{aA++;if(aF==null){return"undefined"}else{if(I.isFunction(aF)){return"function"}else{if(a(aF)){if(aA>5){return"[..]"}return"["+I.map(I.toString,aF).toString()+"]"}else{if((aF!=null?aF.toString:void 0)!=null&&aF.toString!==Object.prototype.toString){return aF.toString()}else{if(typeof aF==="object"){if(aA>5){return"{..}"}aD=function(){var aG=[];for(aB in aF){if(!aC.call(aF,aB)){continue}aE=function(){var aH;try{return aF[aB]}catch(aH){return aH}}();aG.push(I.toString(aB)+":"+I.toString(aE))}return aG}();return"{"+aD+"}"}else{return aF}}}}}}finally{aA--}}};var aA=0;w._=I;var aj=w.UpdateBarrier=function(){var aB;var aE=[];var aG={};var aP=[];var aC=0;var aI={};var aF=function(aQ){if(aB){return aP.push(aQ)}else{return aQ()}};var aH=function(aS,aQ){if(aB){var aR=aG[aS.id];if(!(typeof aR!=="undefined"&&aR!==null)){aR=aG[aS.id]=[aQ];return aE.push(aS)}else{return aR.push(aQ)}}else{return aQ()}};var aL=function(){while(aE.length>0){aN(0)}aI={}};var aN=function(aR){var aV=aE[aR];var aQ=aV.id;var aU=aG[aQ];aE.splice(aR,1);delete aG[aQ];if(aE.length>0){aO(aV)}for(var aS=0,aT;aS<aU.length;aS++){aT=aU[aS];aT()}};var aO=function(aU){if(aI[aU.id]){return}var aT=aU.internalDeps();for(var aR=0,aS;aR<aT.length;aR++){aS=aT[aR];if(aG[aS.id]){var aQ=I.indexOf(aE,aS);aN(aQ)}else{aO(aS)}}aI[aU.id]=true};var aK=function(aT,aS,aU,aR){if(aB){return aU.apply(aS,aR)}else{aB=aT;try{var aQ=aU.apply(aS,aR);aL()}finally{aB=undefined;while(aC<aP.length){var aV=aP[aC];aC++;aV()}aC=0;aP=[]}return aQ}};var aD=function(){return aB?aB.id:undefined};var aJ=function(aV,aU){var aS=false;var aQ=false;var aT=function(){aQ=true;return aQ};var aR=function(){aS=true;return aT()};aT=aV.dispatcher.subscribe(function(aW){return aF(function(){if(!aS){var aX=aU(aW);if(aX===w.noMore){return aR()}}})});if(aQ){aT()}return aR};var aM=function(){return aE.length>0};return{whenDoneWith:aH,hasWaiters:aM,inTransaction:aK,currentEventId:aD,wrappedSubscribe:aJ,afterTransaction:aF}}();function aq(aD,aC){var aB=arguments.length<=2||arguments[2]===undefined?false:arguments[2];this.obs=aD;this.sync=aC;this.lazy=aB;this.queue=[]}P(aq.prototype,{_isSource:true,subscribe:function(aB){return this.obs.dispatcher.subscribe(aB)},toString:function(){return this.obs.toString()},markEnded:function(){this.ended=true;return true},consume:function(){if(this.lazy){return{value:I.always(this.queue[0])}}else{return this.queue[0]}},push:function(aB){this.queue=[aB];return[aB]},mayHave:function(){return true},hasAtLeast:function(){return this.queue.length},flatten:true});function J(){aq.apply(this,arguments)}m(J,aq);P(J.prototype,{consume:function(){return this.queue.shift()},push:function(aB){return this.queue.push(aB)},mayHave:function(aB){return !this.ended||this.queue.length>=aB},hasAtLeast:function(aB){return this.queue.length>=aB},flatten:false});function an(aB){aq.call(this,aB,true)}m(an,aq);P(an.prototype,{consume:function(){var aB=this.queue;this.queue=[];return{value:function(){return aB}}},push:function(aB){return this.queue.push(aB.value())},hasAtLeast:function(){return true}});aq.isTrigger=function(aB){if(aB!=null?aB._isSource:void 0){return aB.sync}else{return aB!=null?aB._isEventStream:void 0}};aq.fromObservable=function(aB){if(aB!=null?aB._isSource:void 0){return aB}else{if(aB!=null?aB._isProperty:void 0){return new aq(aB,false)}else{return new J(aB,true)}}};function y(aC,aD,aB){this.context=aC;this.method=aD;this.args=aB}P(y.prototype,{_isDesc:true,deps:function(){if(!this.cached){this.cached=b([this.context].concat(this.args))}return this.cached},toString:function(){return I.toString(this.context)+"."+I.toString(this.method)+"("+I.map(I.toString,this.args)+")"}});var g=function(aD,aG){var aF=aD||aG;if(aF&&aF._isDesc){return aD||aG}else{for(var aB=arguments.length,aC=Array(aB>2?aB-2:0),aE=2;aE<aB;aE++){aC[aE-2]=arguments[aE]}return new y(aD,aG,aC)}};var X=function(aB,aC){aC.desc=aB;return aC};var b=function(aB){if(a(aB)){return I.flatMap(b,aB)}else{if(ad(aB)){return[aB]}else{if(typeof aB!=="undefined"&&aB!==null?aB._isSource:undefined){return[aB.obs]}else{return[]}}}};w.Desc=y;w.Desc.empty=new w.Desc("","",[]);var k=function(aB){return function(aH){for(var aC=arguments.length,aF=Array(aC>1?aC-1:0),aE=1;aE<aC;aE++){aF[aE-1]=arguments[aE]}if(typeof aH==="object"&&aF.length){var aG=aH;var aD=aF[0];aH=function(){return aG[aD].apply(aG,arguments)};aF=aF.slice(1)}return aB.apply(undefined,[aH].concat(ah(aF)))}};var H=function(aB){aB=Array.prototype.slice.call(aB);return f.apply(undefined,ah(aB))};var Z=function(aC,aB){return function(){for(var aF=arguments.length,aE=Array(aF),aD=0;aD<aF;aD++){aE[aD]=arguments[aD]}return aC.apply(undefined,ah(aB.concat(aE)))}};var N=function(aB){return function(aC){return function(aE){if(!(typeof aE!=="undefined"&&aE!==null)){return}else{var aD=aE[aC];if(I.isFunction(aD)){return aD.apply(aE,aB)}else{return aD}}}}};var Q=function(aD,aB){var aE=aD.slice(1).split(".");var aC=I.map(N(aB),aE);return function(aH){for(var aF=0,aG;aF<aC.length;aF++){aG=aC[aF];aH=aG(aH)}return aH}};var ay=function(aB){return typeof aB==="string"&&aB.length>1&&aB.charAt(0)==="."};var f=k(function(aD){for(var aE=arguments.length,aC=Array(aE>1?aE-1:0),aB=1;aB<aE;aB++){aC[aB-1]=arguments[aB]}if(I.isFunction(aD)){if(aC.length){return Z(aD,aC)}else{return aD}}else{if(ay(aD)){return Q(aD,aC)}else{return I.always(aD)}}});var W=function(aC,aB){return f.apply(undefined,[aC].concat(ah(aB)))};var F=function(aF,aD,aB,aE){if(typeof aD!=="undefined"&&aD!==null?aD._isProperty:undefined){var aC=aD.sampledBy(aF,function(aH,aG){return[aH,aG]});return aE.call(aC,function(aH){var aI=aH[0];var aG=aH[1];return aI}).map(function(aI){var aH=aI[0];var aG=aI[1];return aG})}else{aD=W(aD,aB);return aE.call(aF,aD)}};var u=function(aC){if(I.isFunction(aC)){return aC}else{if(ay(aC)){var aB=aw(aC);return function(aE,aD){return aE[aB](aD)}}else{throw new G("not a function or a field key: "+aC)}}};var aw=function(aB){return aB.slice(1)};function E(aB){this.value=aB}P(E.prototype,{_isSome:true,getOrElse:function(){return this.value},get:function(){return this.value},filter:function(aB){if(aB(this.value)){return new E(this.value)}else{return j}},map:function(aB){return new E(aB(this.value))},forEach:function(aB){return aB(this.value)},isDefined:true,toArray:function(){return[this.value]},inspect:function(){return"Some("+this.value+")"},toString:function(){return this.inspect()}});var j={_isNone:true,getOrElse:function(aB){return aB},filter:function(){return j},map:function(){return j},forEach:function(){},isDefined:false,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};var T=function(aB){if((typeof aB!=="undefined"&&aB!==null?aB._isSome:undefined)||(typeof aB!=="undefined"&&aB!==null?aB._isNone:undefined)){return aB}else{return new E(aB)}};w.noMore="<no-more>";w.more="<more>";var n=0;function B(){this.id=++n}B.prototype._isEvent=true;B.prototype.isEvent=function(){return true};B.prototype.isEnd=function(){return false};B.prototype.isInitial=function(){return false};B.prototype.isNext=function(){return false};B.prototype.isError=function(){return false};B.prototype.hasValue=function(){return false};B.prototype.filter=function(){return true};B.prototype.inspect=function(){return this.toString()};B.prototype.log=function(){return this.toString()};function ae(aC,aB){if(!(this instanceof ae)){return new ae(aC,aB)}B.call(this);if(!aB&&I.isFunction(aC)||(aC!=null?aC._isNext:void 0)){this.valueF=aC;this.valueInternal=void 0}else{this.valueF=void 0;this.valueInternal=aC}}m(ae,B);ae.prototype.isNext=function(){return true};ae.prototype.hasValue=function(){return true};ae.prototype.value=function(){var aB;if((aB=this.valueF)!=null?aB._isNext:void 0){this.valueInternal=this.valueF.value();this.valueF=void 0}else{if(this.valueF){this.valueInternal=this.valueF();this.valueF=void 0}}return this.valueInternal};ae.prototype.fmap=function(aD){var aB,aC;if(this.valueInternal){aC=this.valueInternal;return this.apply(function(){return aD(aC)})}else{aB=this;return this.apply(function(){return aD(aB.value())})}};ae.prototype.apply=function(aB){return new ae(aB)};ae.prototype.filter=function(aB){return aB(this.value())};ae.prototype.toString=function(){return I.toString(this.value())};ae.prototype.log=function(){return this.value()};ae.prototype._isNext=true;function ag(aC,aB){if(!(this instanceof ag)){return new ag(aC,aB)}ae.call(this,aC,aB)}m(ag,ae);ag.prototype._isInitial=true;ag.prototype.isInitial=function(){return true};ag.prototype.isNext=function(){return false};ag.prototype.apply=function(aB){return new ag(aB)};ag.prototype.toNext=function(){return new ae(this)};function C(){if(!(this instanceof C)){return new C()}B.call(this)}m(C,B);C.prototype.isEnd=function(){return true};C.prototype.fmap=function(){return this};C.prototype.apply=function(){return this};C.prototype.toString=function(){return"<end>"};function af(aB){if(!(this instanceof af)){return new af(aB)}this.error=aB;B.call(this)}m(af,B);af.prototype.isError=function(){return true};af.prototype.fmap=function(){return this};af.prototype.apply=function(){return this};af.prototype.toString=function(){return"<error> "+I.toString(this.error)};w.Event=B;w.Initial=ag;w.Next=ae;w.End=C;w.Error=af;var D=function(aB){return new ag(aB,true)};var al=function(aB){return new ae(aB,true)};var O=function(){return new C()};var c=function(aB){if(aB&&aB._isEvent){return aB}else{return al(aB)}};var s=0;var h=function(){};function r(aB){this.desc=aB;this.id=++s;this.initialDesc=this.desc}P(r.prototype,{_isObservable:true,subscribe:function(aB){return aj.wrappedSubscribe(this,aB)},subscribeInternal:function(aB){return this.dispatcher.subscribe(aB)},onValue:function(){var aB=H(arguments);return this.subscribe(function(aC){if(aC.hasValue()){return aB(aC.value())}})},onValues:function(aB){return this.onValue(function(aC){return aB.apply(undefined,ah(aC))})},onError:function(){var aB=H(arguments);return this.subscribe(function(aC){if(aC.isError()){return aB(aC.error)}})},onEnd:function(){var aB=H(arguments);return this.subscribe(function(aC){if(aC.isEnd()){return aB()}})},name:function(aB){this._name=aB;return this},withDescription:function(){this.desc=g.apply(undefined,arguments);return this},toString:function(){if(this._name){return this._name}else{return this.desc.toString()}},internalDeps:function(){return this.initialDesc.deps()}});r.prototype.assign=r.prototype.onValue;r.prototype.forEach=r.prototype.onValue;r.prototype.inspect=r.prototype.toString;w.Observable=r;function at(){var aC=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.unsubscribe=I.bind(this.unsubscribe,this);this.unsubscribed=false;this.subscriptions=[];this.starting=[];for(var aB=0,aD;aB<aC.length;aB++){aD=aC[aB];this.add(aD)}}P(at.prototype,{add:function(aE){var aD=this;if(this.unsubscribed){return}var aF=false;var aC=au;this.starting.push(aE);var aB=function(){if(aD.unsubscribed){return}aF=true;aD.remove(aC);return I.remove(aE,aD.starting)};aC=aE(this.unsubscribe,aB);if(!(this.unsubscribed||aF)){this.subscriptions.push(aC)}else{aC()}I.remove(aE,this.starting);return aC},remove:function(aB){if(this.unsubscribed){return}if(I.remove(aB,this.subscriptions)!==undefined){return aB()}},unsubscribe:function(){if(this.unsubscribed){return}this.unsubscribed=true;var aC=this.subscriptions;for(var aB=0;aB<aC.length;aB++){aC[aB]()}this.subscriptions=[];this.starting=[];return[]},count:function(){if(this.unsubscribed){return 0}return this.subscriptions.length+this.starting.length},empty:function(){return this.count()===0}});w.CompositeUnsubscribe=at;function A(aB,aC){this._subscribe=aB;this._handleEvent=aC;this.subscribe=I.bind(this.subscribe,this);this.handleEvent=I.bind(this.handleEvent,this);this.pushing=false;this.ended=false;this.prevError=undefined;this.unsubSrc=undefined;this.subscriptions=[];this.queue=[]}A.prototype.hasSubscribers=function(){return this.subscriptions.length>0};A.prototype.removeSub=function(aB){this.subscriptions=I.without(aB,this.subscriptions);return this.subscriptions};A.prototype.push=function(aB){if(aB.isEnd()){this.ended=true}return aj.inTransaction(aB,this,this.pushIt,[aB])};A.prototype.pushToSubscriptions=function(aH){try{var aE=this.subscriptions;var aB=aE.length;for(var aD=0;aD<aB;aD++){var aG=aE[aD];var aF=aG.sink(aH);if(aF===w.noMore||aH.isEnd()){this.removeSub(aG)}}return true}catch(aC){this.pushing=false;this.queue=[];throw aC}};A.prototype.pushIt=function(aB){if(!this.pushing){if(aB===this.prevError){return}if(aB.isError()){this.prevError=aB}this.pushing=true;this.pushToSubscriptions(aB);this.pushing=false;while(this.queue.length){aB=this.queue.shift();this.push(aB)}if(this.hasSubscribers()){return w.more}else{this.unsubscribeFromSource();return w.noMore}}else{this.queue.push(aB);return w.more}};A.prototype.handleEvent=function(aB){if(this._handleEvent){return this._handleEvent(aB)}else{return this.push(aB)}};A.prototype.unsubscribeFromSource=function(){if(this.unsubSrc){this.unsubSrc()}this.unsubSrc=undefined};A.prototype.subscribe=function(aC){var aB;if(this.ended){aC(O());return au}else{aB={sink:aC};this.subscriptions.push(aB);if(this.subscriptions.length===1){this.unsubSrc=this._subscribe(this.handleEvent)}return function(aD){return function(){aD.removeSub(aB);if(!aD.hasSubscribers()){return aD.unsubscribeFromSource()}}}(this)}};w.Dispatcher=A;function l(aD,aB,aC){if(!(this instanceof l)){return new l(aD,aB,aC)}if(I.isFunction(aD)){aC=aB;aB=aD;aD=y.empty}r.call(this,aD);this.dispatcher=new A(aB,aC);h(this)}m(l,r);P(l.prototype,{_isEventStream:true,toProperty:function(aB){var aD=arguments.length===0?j:T(function(){return aB});var aC=this.dispatcher;var aE=new w.Desc(this,"toProperty",[aB]);return new ak(aE,function(aK){var aJ=false;var aH=false;var aG=au;var aI=w.more;var aF=function(){if(!aJ){return aD.forEach(function(aL){aJ=true;aI=aK(new ag(aL));if(aI===w.noMore){aG();aG=au;return au}})}};aG=aC.subscribe(function(aL){if(aL.hasValue()){if(aL.isInitial()&&!aH){aD=new E(function(){return aL.value()});return w.more}else{if(!aL.isInitial()){aF()}aJ=true;aD=new E(aL);return aK(aL)}}else{if(aL.isEnd()){aI=aF()}if(aI!==w.noMore){return aK(aL)}}});aH=true;aF();return aG})},toEventStream:function(){return this},withHandler:function(aB){return new l(new w.Desc(this,"withHandler",[aB]),this.dispatcher.subscribe,aB)}});w.EventStream=l;w.never=function(){return new l(g(w,"never"),function(aB){aB(O());return au})};w.when=function(){if(arguments.length===0){return w.never()}var aN=arguments.length;var aR="when: expecting arguments in the form (Observable+,function)+";var aB=[];var aG=[];var aM=0;var aC=[];while(aM<aN){aC[aM]=arguments[aM];aC[aM+1]=arguments[aM+1];var aH=I.toArray(arguments[aM]);var aP=ac(arguments[aM+1]);var aI={f:aP,ixs:[]};var aQ=false;for(var aL=0,aJ;aL<aH.length;aL++){aJ=aH[aL];var aF=I.indexOf(aB,aJ);if(!aQ){aQ=aq.isTrigger(aJ)}if(aF<0){aB.push(aJ);aF=aB.length-1}for(var aK=0,aE;aK<aI.ixs.length;aK++){aE=aI.ixs[aK];if(aE.index===aF){aE.count++}}aI.ixs.push({index:aF,count:1})}if(aH.length>0){aG.push(aI)}aM=aM+2}if(!aB.length){return w.never()}aB=I.map(aq.fromObservable,aB);var aD=I.any(aB,function(aT){return aT.flatten})&&ai(I.map(function(aT){return aT.obs},aB));var aO=new w.Desc(w,"when",aC);var aS=new l(aO,function(a0){var aY=[];var aT=false;var aV=function(a3){for(var a2=0,a1;a2<a3.ixs.length;a2++){a1=a3.ixs[a2];if(!aB[a1.index].hasAtLeast(a1.count)){return false}}return true};var aX=function(a1){return !a1.sync||a1.ended};var aZ=function(a3){for(var a2=0,a1;a2<a3.ixs.length;a2++){a1=a3.ixs[a2];if(!aB[a1.index].mayHave(a1.count)){return true}}};var aW=function(a1){return !a1.source.flatten};var aU=function(a1){return function(a3){var a5=function(){return aj.whenDoneWith(aS,a2)};var a4=function(){if(aY.length>0){var a8=w.more;var a6=aY.pop();for(var a9=0,ba;a9<aG.length;a9++){ba=aG[a9];if(aV(ba)){var a7=function(){var bb=[];for(var bd=0,bc;bd<ba.ixs.length;bd++){bc=ba.ixs[bd];bb.push(aB[bc.index].consume())}return bb}();a8=a0(a6.e.apply(function(){var bb;var bc=function(){var bd=[];for(var be=0,bf;be<a7.length;be++){bf=a7[be];bd.push(bf.value())}return bd}();return(bb=ba).f.apply(bb,ah(bc))}));if(aY.length){aY=I.filter(aW,aY)}if(a8===w.noMore){return a8}else{return a4()}}}}else{return w.more}};var a2=function(){var a6=a4();if(aT){if(I.all(aB,aX)||I.all(aG,aZ)){a6=w.noMore;a0(O())}}if(a6===w.noMore){a3()}return a6};return a1.subscribe(function(a7){if(a7.isEnd()){aT=true;a1.markEnded();a5()}else{if(a7.isError()){var a6=a0(a7)}else{a1.push(a7);if(a1.sync){aY.push({source:a1,e:a7});if(aD||aj.hasWaiters()){a5()}else{a2()}}}}if(a6===w.noMore){a3()}return a6||w.more})}};return new w.CompositeUnsubscribe(function(){var a1=[];for(var a3=0,a2;a3<aB.length;a3++){a2=aB[a3];a1.push(aU(a2))}return a1}()).unsubscribe});return aS};var ai=function(aD){var aC=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var aB=function(aF){if(I.contains(aC,aF)){return true}else{var aE=aF.internalDeps();if(aE.length){aC.push(aF);return I.any(aE,aB)}else{aC.push(aF);return false}}};return I.any(aD,aB)};var ac=function(aB){if(I.isFunction(aB)){return aB}else{return I.always(aB)}};w.groupSimultaneous=function(){for(var aD=arguments.length,aE=Array(aD),aB=0;aB<aD;aB++){aE[aB]=arguments[aB]}if(aE.length===1&&a(aE[0])){aE=aE[0]}var aC=function(){var aF=[];for(var aG=0,aH;aG<aE.length;aG++){aH=aE[aG];aF.push(new an(aH))}return aF}();return X(new w.Desc(w,"groupSimultaneous",aE),w.when(aC,function(){for(var aG=arguments.length,aF=Array(aG),aH=0;aH<aG;aH++){aF[aH]=arguments[aH]}return aF}))};function x(aD,aB,aC){A.call(this,aB,aC);this.property=aD;this.subscribe=I.bind(this.subscribe,this);this.current=j;this.currentValueRootId=undefined;this.propertyEnded=false}m(x,A);P(x.prototype,{push:function(aB){if(aB.isEnd()){this.propertyEnded=true}if(aB.hasValue()){this.current=new E(aB);this.currentValueRootId=aj.currentEventId()}return A.prototype.push.call(this,aB)},maybeSubSource:function(aC,aB){if(aB===w.noMore){return au}else{if(this.propertyEnded){aC(O());return au}else{return A.prototype.subscribe.call(this,aC)}}},subscribe:function(aE){var aC=this;var aD=false;var aB=w.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var aG=aj.currentEventId();var aF=this.currentValueRootId;if(!this.propertyEnded&&aF&&aG&&aG!==aF){aj.whenDoneWith(this.property,function(){if(aC.currentValueRootId===aF){return aE(D(aC.current.get().value()))}});return this.maybeSubSource(aE,aB)}else{aj.inTransaction(undefined,this,function(){aB=aE(D(this.current.get().value()));return aB},[]);return this.maybeSubSource(aE,aB)}}else{return this.maybeSubSource(aE,aB)}}});function ak(aD,aB,aC){r.call(this,aD);this.dispatcher=new x(this,aB,aC);h(this)}m(ak,r);P(ak.prototype,{_isProperty:true,changes:function(){var aB=this;return new l(new w.Desc(this,"changes",[]),function(aC){return aB.dispatcher.subscribe(function(aD){if(!aD.isInitial()){return aC(aD)}})})},withHandler:function(aB){return new ak(new w.Desc(this,"withHandler",[aB]),this.dispatcher.subscribe,aB)},toProperty:function(){return this},toEventStream:function(){var aB=this;return new l(new w.Desc(this,"toEventStream",[]),function(aC){return aB.dispatcher.subscribe(function(aD){if(aD.isInitial()){aD=aD.toNext()}return aC(aD)})})}});w.Property=ak;w.constant=function(aB){return new ak(new w.Desc(w,"constant",[aB]),function(aC){aC(D(aB));aC(O());return au})};w.fromBinder=function(aB){var aC=arguments.length<=1||arguments[1]===undefined?I.id:arguments[1];var aD=new w.Desc(w,"fromBinder",[aB,aC]);return new l(aD,function(aH){var aG=false;var aI=false;var aF=function(){if(!aG){if(typeof aE!=="undefined"&&aE!==null){aE();return aG=true}else{return aI=true}}};var aE=aB(function(){var aO;for(var aN=arguments.length,aJ=Array(aN),aQ=0;aQ<aN;aQ++){aJ[aQ]=arguments[aQ]}var aP=aC.apply(this,aJ);if(!(a(aP)&&((aO=I.last(aP))!=null?aO._isEvent:undefined))){aP=[aP]}var aL=w.more;for(var aK=0,aM;aK<aP.length;aK++){aM=aP[aK];aL=aH(aM=c(aM));if(aL===w.noMore||aM.isEnd()){aF();return aL}}return aL});if(aI){aF()}return aF})};w.Observable.prototype.map=function(aE){for(var aC=arguments.length,aB=Array(aC>1?aC-1:0),aD=1;aD<aC;aD++){aB[aD-1]=arguments[aD]}return F(this,aE,aB,function(aF){return X(new w.Desc(this,"map",[aF]),this.withHandler(function(aG){return this.push(aG.fmap(aF))}))})};var am=function(aB){if(a(aB[0])){return aB[0]}else{return Array.prototype.slice.call(aB)}};var e=function(aB){if(I.isFunction(aB[0])){return[am(Array.prototype.slice.call(aB,1)),aB[0]]}else{return[am(Array.prototype.slice.call(aB,0,aB.length-1)),I.last(aB)]}};w.combineAsArray=function(){var aE=am(arguments);for(var aC=0,aD;aC<aE.length;aC++){aD=aE[aC];if(!ad(aD)){aE[aC]=w.constant(aD)}}if(aE.length){var aB=function(){var aF=[];for(var aG=0,aH;aG<aE.length;aG++){aH=aE[aG];aF.push(new aq(aH,true))}return aF}();return X(new w.Desc(w,"combineAsArray",aE),w.when(aB,function(){for(var aG=arguments.length,aF=Array(aG),aH=0;aH<aG;aH++){aF[aH]=arguments[aH]}return aF}).toProperty())}else{return w.constant([])}};w.onValues=function(){for(var aB=arguments.length,aD=Array(aB),aC=0;aC<aB;aC++){aD[aC]=arguments[aC]}return w.combineAsArray(aD.slice(0,aD.length-1)).onValues(aD[aD.length-1])};w.combineWith=function(){var aB=e(arguments);var aE=aB[0];var aC=aB[1];var aD=new w.Desc(w,"combineWith",[aC].concat(ah(aE)));return X(aD,w.combineAsArray(aE).map(function(aF){return aC.apply(undefined,ah(aF))}))};w.Observable.prototype.combine=function(aB,aD){var aC=u(aD);var aE=new w.Desc(this,"combine",[aB,aD]);return X(aE,w.combineAsArray(this,aB).map(function(aF){return aC(aF[0],aF[1])}))};w.Observable.prototype.withStateMachine=function(aB,aD){var aC=aB;var aE=new w.Desc(this,"withStateMachine",[aB,aD]);return X(aE,this.withHandler(function(aJ){var aI=aD(aC,aJ);var aK=aI[0];var aL=aI[1];aC=aK;var aH=w.more;for(var aG=0,aF;aG<aL.length;aG++){aF=aL[aG];aH=this.push(aF);if(aH===w.noMore){return aH}}return aH}))};var q=function(aC,aB){return aC===aB};var ap=function(aB){return typeof aB!=="undefined"&&aB!==null?aB._isNone:false};w.Observable.prototype.skipDuplicates=function(){var aB=arguments.length<=0||arguments[0]===undefined?q:arguments[0];var aC=new w.Desc(this,"skipDuplicates",[]);return X(aC,this.withStateMachine(j,function(aE,aD){if(!aD.hasValue()){return[aE,[aD]]}else{if(aD.isInitial()||ap(aE)||!aB(aE.get(),aD.value())){return[new E(aD.value()),[aD]]}else{return[aE,[]]}}}))};w.Observable.prototype.awaiting=function(aB){var aC=new w.Desc(this,"awaiting",[aB]);return X(aC,w.groupSimultaneous(this,aB).map(function(aD){return aD[1].length===0}).toProperty(false).skipDuplicates())};w.Observable.prototype.not=function(){return X(new w.Desc(this,"not",[]),this.map(function(aB){return !aB}))};w.Property.prototype.and=function(aB){return X(new w.Desc(this,"and",[aB]),this.combine(aB,function(aC,aD){return aC&&aD}))};w.Property.prototype.or=function(aB){return X(new w.Desc(this,"or",[aB]),this.combine(aB,function(aC,aD){return aC||aD}))};w.scheduler={setTimeout:function(aB,aC){return setTimeout(aB,aC)},setInterval:function(aC,aB){return setInterval(aC,aB)},clearInterval:function(aB){return clearInterval(aB)},clearTimeout:function(aB){return clearTimeout(aB)},now:function(){return new Date().getTime()}};w.EventStream.prototype.bufferWithTime=function(aB){return X(new w.Desc(this,"bufferWithTime",[aB]),this.bufferWithTimeOrCount(aB,Number.MAX_VALUE))};w.EventStream.prototype.bufferWithCount=function(aB){return X(new w.Desc(this,"bufferWithCount",[aB]),this.bufferWithTimeOrCount(undefined,aB))};w.EventStream.prototype.bufferWithTimeOrCount=function(aB,aC){var aE=function(aF){if(aF.values.length===aC){return aF.flush()}else{if(aB!==undefined){return aF.schedule()}}};var aD=new w.Desc(this,"bufferWithTimeOrCount",[aB,aC]);return X(aD,this.buffer(aB,aE,aE))};w.EventStream.prototype.buffer=function(aD){var aF=arguments.length<=1||arguments[1]===undefined?au:arguments[1];var aC=arguments.length<=2||arguments[2]===undefined?au:arguments[2];var aB={scheduled:null,end:undefined,values:[],flush:function(){if(this.scheduled){w.scheduler.clearTimeout(this.scheduled);this.scheduled=null}if(this.values.length>0){var aI=this.values;this.values=[];var aH=this.push(al(aI));if(this.end!=null){return this.push(this.end)}else{if(aH!==w.noMore){return aC(this)}}}else{if(this.end!=null){return this.push(this.end)}}},schedule:function(){var aH=this;if(!this.scheduled){return this.scheduled=aD(function(){return aH.flush()})}}};var aE=w.more;if(!I.isFunction(aD)){var aG=aD;aD=function(aH){return w.scheduler.setTimeout(aH,aG)}}return X(new w.Desc(this,"buffer",[]),this.withHandler(function(aI){var aH=this;aB.push=function(aJ){return aH.push(aJ)};if(aI.isError()){aE=this.push(aI)}else{if(aI.isEnd()){aB.end=aI;if(!aB.scheduled){aB.flush()}}else{aB.values.push(aI.value());aF(aB)}}return aE}))};w.Observable.prototype.filter=function(aD){for(var aC=arguments.length,aB=Array(aC>1?aC-1:0),aE=1;aE<aC;aE++){aB[aE-1]=arguments[aE]}return F(this,aD,aB,function(aF){return X(new w.Desc(this,"filter",[aF]),this.withHandler(function(aG){if(aG.filter(aF)){return this.push(aG)}else{return w.more}}))})};w.once=function(aB){return new l(new y(w,"once",[aB]),function(aC){aC(c(aB));aC(O());return au})};w.EventStream.prototype.concat=function(aB){var aC=this;return new l(new w.Desc(aC,"concat",[aB]),function(aE){var aD=au;var aF=aC.dispatcher.subscribe(function(aG){if(aG.isEnd()){aD=aB.dispatcher.subscribe(aE);return aD}else{return aE(aG)}});return function(){return aF(),aD()}})};w.Observable.prototype.flatMap=function(){return ar(this,V(arguments))};w.Observable.prototype.flatMapFirst=function(){return ar(this,V(arguments),true)};var V=function(aB){if(aB.length===1&&ad(aB[0])){return I.always(aB[0])}else{return H(aB)}};var R=function(aB){if(ad(aB)){return aB}else{return w.once(aB)}};var ar=function(aD,aH,aE,aC){var aG=[aD];var aF=[];var aI=new w.Desc(aD,"flatMap"+(aE?"First":""),[aH]);var aB=new l(aI,function(aL){var aO=new at();var aJ=[];var aK=function(aP){var aQ=R(aH(aP.value()));aF.push(aQ);return aO.add(function(aS,aR){return aQ.dispatcher.subscribe(function(aU){if(aU.isEnd()){I.remove(aQ,aF);aN();aM(aR);return w.noMore}else{if(typeof aU!=="undefined"&&aU!==null?aU._isInitial:undefined){aU=aU.toNext()}var aT=aL(aU);if(aT===w.noMore){aS()}return aT}})})};var aN=function(){var aP=aJ.shift();if(aP){return aK(aP)}};var aM=function(aP){aP();if(aO.empty()){return aL(O())}};aO.add(function(aQ,aP){return aD.dispatcher.subscribe(function(aR){if(aR.isEnd()){return aM(aP)}else{if(aR.isError()){return aL(aR)}else{if(aE&&aO.count()>1){return w.more}else{if(aO.unsubscribed){return w.noMore}if(aC&&aO.count()>aC){return aJ.push(aR)}else{return aK(aR)}}}}})});return aO.unsubscribe});aB.internalDeps=function(){if(aF.length){return aG.concat(aF)}else{return aG}};return aB};w.Observable.prototype.flatMapWithConcurrencyLimit=function(aB){for(var aC=arguments.length,aD=Array(aC>1?aC-1:0),aE=1;aE<aC;aE++){aD[aE-1]=arguments[aE]}var aF=new w.Desc(this,"flatMapWithConcurrencyLimit",[aB].concat(aD));return X(aF,ar(this,V(aD),false,aB))};w.Observable.prototype.flatMapConcat=function(){var aB=new w.Desc(this,"flatMapConcat",Array.prototype.slice.call(arguments,0));return X(aB,this.flatMapWithConcurrencyLimit.apply(this,[1].concat(d.call(arguments))))};w.later=function(aB,aC){return X(new w.Desc(w,"later",[aB,aC]),w.fromBinder(function(aE){var aD=function(){return aE([aC,O()])};var aF=w.scheduler.setTimeout(aD,aB);return function(){return w.scheduler.clearTimeout(aF)}}))};w.Observable.prototype.bufferingThrottle=function(aB){var aC=new w.Desc(this,"bufferingThrottle",[aB]);return X(aC,this.flatMapConcat(function(aD){return w.once(aD).concat(w.later(aB).filter(false))}))};w.Property.prototype.bufferingThrottle=function(){return w.Observable.prototype.bufferingThrottle.apply(this,arguments).toProperty()};function p(){if(!(this instanceof p)){return new p()}this.unsubAll=I.bind(this.unsubAll,this);this.subscribeAll=I.bind(this.subscribeAll,this);this.guardedSink=I.bind(this.guardedSink,this);this.sink=undefined;this.subscriptions=[];this.ended=false;l.call(this,new w.Desc(w,"Bus",[]),this.subscribeAll)}m(p,l);P(p.prototype,{unsubAll:function(){var aD=this.subscriptions;for(var aB=0,aC;aB<aD.length;aB++){aC=aD[aB];if(typeof aC.unsub==="function"){aC.unsub()}}},subscribeAll:function(aC){if(this.ended){aC(O())}else{this.sink=aC;var aE=ab(this.subscriptions);for(var aB=0,aD;aB<aE.length;aB++){aD=aE[aB];this.subscribeInput(aD)}}return this.unsubAll},guardedSink:function(aC){var aB=this;return function(aD){if(aD.isEnd()){aB.unsubscribeInput(aC);return w.noMore}else{return aB.sink(aD)}}},subscribeInput:function(aB){aB.unsub=aB.input.dispatcher.subscribe(this.guardedSink(aB.input));return aB.unsub},unsubscribeInput:function(aB){var aE=this.subscriptions;for(var aC=0,aD;aC<aE.length;aC++){aD=aE[aC];if(aD.input===aB){if(typeof aD.unsub==="function"){aD.unsub()}this.subscriptions.splice(aC,1);return}}},plug:function(aB){var aD=this;if(this.ended){return}var aC={input:aB};this.subscriptions.push(aC);if(typeof this.sink!=="undefined"){this.subscribeInput(aC)}return function(){return aD.unsubscribeInput(aB)}},end:function(){this.ended=true;this.unsubAll();if(typeof this.sink==="function"){return this.sink(O())}},push:function(aB){if(!this.ended&&typeof this.sink==="function"){return this.sink(al(aB))}},error:function(aB){if(typeof this.sink==="function"){return this.sink(new af(aB))}}});w.Bus=p;var av=function(aC,aB){return k(function(aG){var aH=Z(aB,[function(aI,aJ){return aG.apply(undefined,ah(aI).concat([aJ]))}]);for(var aD=arguments.length,aE=Array(aD>1?aD-1:0),aF=1;aF<aD;aF++){aE[aF-1]=arguments[aF]}return X(new w.Desc(w,aC,[aG].concat(aE)),w.combineAsArray(aE).flatMap(aH))})};w.fromCallback=av("fromCallback",function(aE){for(var aB=arguments.length,aC=Array(aB>1?aB-1:0),aD=1;aD<aB;aD++){aC[aD-1]=arguments[aD]}return w.fromBinder(function(aF){W(aE,aC)(aF);return au},function(aF){return[aF,O()]})});w.fromNodeCallback=av("fromNodeCallback",function(aD){for(var aE=arguments.length,aB=Array(aE>1?aE-1:0),aC=1;aC<aE;aC++){aB[aC-1]=arguments[aC]}return w.fromBinder(function(aF){W(aD,aB)(aF);return au},function(aF,aG){if(aF){return[new af(aF),O()]}return[aG,O()]})});w.combineTemplate=function(aK){function aG(aN){return aN[aN.length-1]}function aF(aN,aO,aP){aG(aN)[aO]=aP;return aP}function aE(aO,aN){return function(aQ,aP){return aF(aQ,aO,aP[aN])}}function aC(aN,aO){return function(aP){return aF(aP,aN,aO)}}function aI(aN){return a(aN)?[]:{}}function aH(aN,aO){return function(aP){var aQ=aI(aO);aF(aP,aN,aQ);return aP.push(aQ)}}function aL(aN,aO){if(ad(aO)){aM.push(aO);return aB.push(aE(aN,aM.length-1))}else{if(aO&&(aO.constructor==Object||aO.constructor==Array)){var aP=function(aQ){return aQ.pop()};aB.push(aH(aN,aO));aJ(aO);return aB.push(aP)}else{return aB.push(aC(aN,aO))}}}function aD(aP){var aN=aI(aK);var aO=[aN];for(var aQ=0,aR;aQ<aB.length;aQ++){aR=aB[aQ];aR(aO,aP)}return aN}function aJ(aN){return I.each(aN,aL)}var aB=[];var aM=[];aJ(aK);return X(new w.Desc(w,"combineTemplate",[aK]),w.combineAsArray(aM).map(aD))};var v=function(aC,aD){var aB=new l(g(aC,"justInitValue"),function(aG){var aF=undefined;var aE=aC.dispatcher.subscribe(function(aH){if(!aH.isEnd()){aF=aH}return w.noMore});aj.whenDoneWith(aB,function(){if(typeof aF!=="undefined"&&aF!==null){aG(aF)}return aG(O())});return aE});return aB.concat(aD).toProperty()};w.Observable.prototype.mapEnd=function(){var aB=H(arguments);return X(new w.Desc(this,"mapEnd",[aB]),this.withHandler(function(aC){if(aC.isEnd()){this.push(al(aB(aC)));this.push(O());return w.noMore}else{return this.push(aC)}}))};w.Observable.prototype.skipErrors=function(){return X(new w.Desc(this,"skipErrors",[]),this.withHandler(function(aB){if(aB.isError()){return w.more}else{return this.push(aB)}}))};w.EventStream.prototype.takeUntil=function(aB){var aC={};return X(new w.Desc(this,"takeUntil",[aB]),w.groupSimultaneous(this.mapEnd(aC),aB.skipErrors()).withHandler(function(aH){if(!aH.hasValue()){return this.push(aH)}else{var aD=aH.value();var aJ=aD[0];var aG=aD[1];if(aG.length){return this.push(O())}else{var aF=w.more;for(var aE=0,aI;aE<aJ.length;aE++){aI=aJ[aE];if(aI===aC){aF=this.push(O())}else{aF=this.push(al(aI))}}return aF}}}))};w.Property.prototype.takeUntil=function(aC){var aB=this.changes().takeUntil(aC);return X(new w.Desc(this,"takeUntil",[aC]),v(this,aB))};w.Observable.prototype.flatMapLatest=function(){var aB=V(arguments);var aC=this.toEventStream();return X(new w.Desc(this,"flatMapLatest",[aB]),aC.flatMap(function(aD){return R(aB(aD)).takeUntil(aC)}))};w.Property.prototype.delayChanges=function(aC,aB){return X(aC,v(this,aB(this.changes())))};w.EventStream.prototype.delay=function(aB){return X(new w.Desc(this,"delay",[aB]),this.flatMap(function(aC){return w.later(aB,aC)}))};w.Property.prototype.delay=function(aB){return this.delayChanges(new w.Desc(this,"delay",[aB]),function(aC){return aC.delay(aB)})};w.EventStream.prototype.debounce=function(aB){return X(new w.Desc(this,"debounce",[aB]),this.flatMapLatest(function(aC){return w.later(aB,aC)}))};w.Property.prototype.debounce=function(aB){return this.delayChanges(new w.Desc(this,"debounce",[aB]),function(aC){return aC.debounce(aB)})};w.EventStream.prototype.debounceImmediate=function(aB){return X(new w.Desc(this,"debounceImmediate",[aB]),this.flatMapFirst(function(aC){return w.once(aC).concat(w.later(aB).filter(false))}))};w.Observable.prototype.decode=function(aB){return X(new w.Desc(this,"decode",[aB]),this.combine(w.combineTemplate(aB),function(aD,aC){return aC[aD]}))};w.Observable.prototype.scan=function(aC,aE){var aF=this;var aH;aE=u(aE);var aD=T(aC);var aG=false;var aB=function(aM){var aL=false;var aJ=au;var aK=w.more;var aI=function(){if(!aL){return aD.forEach(function(aN){aL=aG=true;aK=aM(new ag(function(){return aN}));if(aK===w.noMore){aJ();aJ=au;return aJ}})}};aJ=aF.dispatcher.subscribe(function(aP){if(aP.hasValue()){if(aG&&aP.isInitial()){return w.more}else{if(!aP.isInitial()){aI()}aL=aG=true;var aO=aD.getOrElse(undefined);var aN=aE(aO,aP.value());aD=new E(aN);return aM(aP.apply(function(){return aN}))}}else{if(aP.isEnd()){aK=aI()}if(aK!==w.noMore){return aM(aP)}}});aj.whenDoneWith(aH,aI);return aJ};aH=new ak(new w.Desc(this,"scan",[aC,aE]),aB);return aH};w.Observable.prototype.diff=function(aC,aB){aB=u(aB);return X(new w.Desc(this,"diff",[aC,aB]),this.scan([aC],function(aD,aE){return[aE,aB(aD[0],aE)]}).filter(function(aD){return aD.length===2}).map(function(aD){return aD[1]}))};w.Observable.prototype.doAction=function(){var aB=H(arguments);return X(new w.Desc(this,"doAction",[aB]),this.withHandler(function(aC){if(aC.hasValue()){aB(aC.value())}return this.push(aC)}))};w.Observable.prototype.doEnd=function(){var aB=H(arguments);return X(new w.Desc(this,"doEnd",[aB]),this.withHandler(function(aC){if(aC.isEnd()){aB()}return this.push(aC)}))};w.Observable.prototype.doError=function(){var aB=H(arguments);return X(new w.Desc(this,"doError",[aB]),this.withHandler(function(aC){if(aC.isError()){aB(aC.error)}return this.push(aC)}))};w.Observable.prototype.doLog=function(){for(var aD=arguments.length,aC=Array(aD),aB=0;aB<aD;aB++){aC[aB]=arguments[aB]}return X(new w.Desc(this,"doLog",aC),this.withHandler(function(aE){if(typeof console!=="undefined"&&console!==null&&typeof console.log==="function"){console.log.apply(console,aC.concat([aE.log()]))}return this.push(aE)}))};w.Observable.prototype.endOnError=function(aD){if(!(typeof aD!=="undefined"&&aD!==null)){aD=true}for(var aE=arguments.length,aC=Array(aE>1?aE-1:0),aB=1;aB<aE;aB++){aC[aB-1]=arguments[aB]}return F(this,aD,aC,function(aF){return X(new w.Desc(this,"endOnError",[]),this.withHandler(function(aG){if(aG.isError()&&aF(aG.error)){this.push(aG);return this.push(O())}else{return this.push(aG)}}))})};r.prototype.errors=function(){return X(new w.Desc(this,"errors",[]),this.filter(function(){return false}))};w.Observable.prototype.take=function(aB){if(aB<=0){return w.never()}return X(new w.Desc(this,"take",[aB]),this.withHandler(function(aC){if(!aC.hasValue()){return this.push(aC)}else{aB--;if(aB>0){return this.push(aC)}else{if(aB===0){this.push(aC)}this.push(O());return w.noMore}}}))};w.Observable.prototype.first=function(){return X(new w.Desc(this,"first",[]),this.take(1))};w.Observable.prototype.mapError=function(){var aB=H(arguments);return X(new w.Desc(this,"mapError",[aB]),this.withHandler(function(aC){if(aC.isError()){return this.push(al(aB(aC.error)))}else{return this.push(aC)}}))};w.Observable.prototype.flatMapError=function(aB){var aC=new w.Desc(this,"flatMapError",[aB]);return X(aC,this.mapError(function(aD){return new af(aD)}).flatMap(function(aD){if(aD instanceof af){return aB(aD.error)}else{return w.once(aD)}}))};w.EventStream.prototype.sampledBy=function(aB,aC){return X(new w.Desc(this,"sampledBy",[aB,aC]),this.toProperty().sampledBy(aB,aC))};w.Property.prototype.sampledBy=function(aD,aG){var aC=false;if(typeof aG!=="undefined"&&aG!==null){aG=u(aG)}else{aC=true;aG=function(aI){return aI.value()}}var aF=new aq(this,false,aC);var aE=new aq(aD,true,aC);var aH=w.when([aF,aE],aG);var aB=aD._isProperty?aH.toProperty():aH;return X(new w.Desc(this,"sampledBy",[aD,aG]),aB)};w.Property.prototype.sample=function(aB){return X(new w.Desc(this,"sample",[aB]),this.sampledBy(w.interval(aB,{})))};w.Observable.prototype.map=function(aE){if(aE&&aE._isProperty){return aE.sampledBy(this,M)}else{for(var aD=arguments.length,aC=Array(aD>1?aD-1:0),aB=1;aB<aD;aB++){aC[aB-1]=arguments[aB]}return F(this,aE,aC,function(aF){return X(new w.Desc(this,"map",[aF]),this.withHandler(function(aG){return this.push(aG.fmap(aF))}))})}};w.Observable.prototype.fold=function(aB,aC){return X(new w.Desc(this,"fold",[aB,aC]),this.scan(aB,aC).sampledBy(this.filter(false).mapEnd().toProperty()))};r.prototype.reduce=r.prototype.fold;var z=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];var o=function(aF){var aG;for(var aD=0;aD<z.length;aD++){aG=z[aD];var aE=[aF[aG[0]],aF[aG[1]]];if(aE[0]&&aE[1]){return aE}}for(var aB=0;aB<z.length;aB++){aG=z[aB];var aC=aF[aG[0]];if(aC){return[aC,function(){}]}}throw new af("No suitable event methods in "+aF)};w.fromEventTarget=function(aG,aB,aF){var aD=o(aG);var aE=aD[0];var aC=aD[1];var aH=new w.Desc(w,"fromEvent",[aG,aB]);return X(aH,w.fromBinder(function(aI){aE.call(aG,aB,aI);return function(){return aC.call(aG,aB,aI)}},aF))};w.fromEvent=w.fromEventTarget;w.fromPoll=function(aB,aD){var aC=new w.Desc(w,"fromPoll",[aB,aD]);return X(aC,w.fromBinder(function(aE){var aF=w.scheduler.setInterval(aE,aB);return function(){return w.scheduler.clearInterval(aF)}},aD))};function L(aB){return[aB,O()]}w.fromPromise=function(aC,aD){var aB=arguments.length<=2||arguments[2]===undefined?L:arguments[2];return X(new w.Desc(w,"fromPromise",[aC]),w.fromBinder(function(aF){var aE=aC.then(aF,function(aG){return aF(new af(aG))});if(aE&&typeof aE.done==="function"){aE.done()}if(aD){return function(){if(typeof aC.abort==="function"){return aC.abort()}}}else{return function(){}}},aB))};w.Observable.prototype.groupBy=function(aC){var aB=arguments.length<=1||arguments[1]===undefined?w._.id:arguments[1];var aE={};var aD=this;return aD.filter(function(aF){return !aE[aC(aF)]}).map(function(aF){var aH=aC(aF);var aJ=aD.filter(function(aK){return aC(aK)===aH});var aI=w.once(aF).concat(aJ);var aG=aB(aI,aF).withHandler(function(aK){this.push(aK);if(aK.isEnd()){return delete aE[aH]}});aE[aH]=aG;return aG})};w.fromArray=function(aB){if(!aB.length){return X(new w.Desc(w,"fromArray",aB),w.never())}else{var aC=0;return new l(new w.Desc(w,"fromArray",[aB]),function(aI){var aG=false;var aH=w.more;var aD=false;var aE=false;var aF=function(){aE=true;if(aD){return}aD=true;while(aE){aE=false;if(aH!==w.noMore&&!aG){var aJ=aB[aC++];aH=aI(c(aJ));if(aH!==w.noMore){if(aC===aB.length){aI(O())}else{aj.afterTransaction(aF)}}}}aD=false;return aD};aF();return function(){aG=true;return aG}})}};w.EventStream.prototype.holdWhen=function(aE){var aC=false;var aB=[];var aD=this;return new l(new w.Desc(this,"holdWhen",[aE]),function(aG){var aI=new at();var aH=false;var aF=function(aJ){if(typeof aJ==="function"){aJ()}if(aI.empty()&&aH){return aG(O())}};aI.add(function(aK,aJ){return aE.subscribeInternal(function(aL){if(aL.hasValue()){aC=aL.value();if(!aC){var aM=aB;aB=[];return function(){var aN=[];for(var aO=0,aP;aO<aM.length;aO++){aP=aM[aO];aN.push(aG(al(aP)))}return aN}()}}else{if(aL.isEnd()){return aF(aJ)}else{return aG(aL)}}})});aI.add(function(aK,aJ){return aD.subscribeInternal(function(aL){if(aC&&aL.hasValue()){return aB.push(aL.value())}else{if(aL.isEnd()&&aB.length){return aF(aJ)}else{return aG(aL)}}})});aH=true;aF();return aI.unsubscribe})};w.interval=function(aB){var aC=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return X(new w.Desc(w,"interval",[aB,aC]),w.fromPoll(aB,function(){return al(aC)}))};w.$={};w.$.asEventStream=function(aC,aB,aD){var aE=this;if(I.isFunction(aB)){aD=aB;aB=undefined}return X(new w.Desc(this.selector||this,"asEventStream",[aC]),w.fromBinder(function(aF){aE.on(aC,aB,aF);return function(){return aE.off(aC,aB,aF)}},aD))};if(typeof jQuery!=="undefined"&&jQuery){jQuery.fn.asEventStream=w.$.asEventStream}if(typeof Zepto!=="undefined"&&Zepto){Zepto.fn.asEventStream=w.$.asEventStream}w.Observable.prototype.last=function(){var aB;return X(new w.Desc(this,"last",[]),this.withHandler(function(aC){if(aC.isEnd()){if(aB){this.push(aB)}this.push(O());return w.noMore}else{aB=aC}}))};w.Observable.prototype.log=function(){for(var aD=arguments.length,aC=Array(aD),aB=0;aB<aD;aB++){aC[aB]=arguments[aB]}this.subscribe(function(aE){if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,aC.concat([aE.log()]))}});return this};w.EventStream.prototype.merge=function(aB){var aC=this;return X(new w.Desc(aC,"merge",[aB]),w.mergeAll(this,aB))};w.mergeAll=function(){var aB=am(arguments);if(aB.length){return new l(new w.Desc(w,"mergeAll",aB),function(aF){var aD=0;var aE=function(aG){return function(aH){return aG.dispatcher.subscribe(function(aJ){if(aJ.isEnd()){aD++;if(aD===aB.length){return aF(O())}else{return w.more}}else{var aI=aF(aJ);if(aI===w.noMore){aH()}return aI}})}};var aC=I.map(aE,aB);return new w.CompositeUnsubscribe(aC).unsubscribe})}else{return w.never()}};w.repeatedly=function(aD,aB){var aC=0;return X(new w.Desc(w,"repeatedly",[aD,aB]),w.fromPoll(aD,function(){return aB[aC++%aB.length]}))};w.repeat=function(aC){var aB=0;return w.fromBinder(function(aH){var aD=false;var aG=w.more;var aF=function(){};function aE(aJ){if(aJ.isEnd()){if(!aD){return aD=true}else{return aI()}}else{return aG=aH(aJ)}}function aI(){var aJ;aD=true;while(aD&&aG!==w.noMore){aJ=aC(aB++);aD=false;if(aJ){aF=aJ.subscribeInternal(aE)}else{aH(O())}}return aD=true}aI();return function(){return aF()}})};w.retry=function(aE){if(!I.isFunction(aE.source)){throw new G("'source' option has to be a function")}var aF=aE.source;var aB=aE.retries||0;var aI=aE.maxRetries||aB;var aD=aE.delay||function(){return 0};var aG=aE.isRetryable||function(){return true};var aH=false;var aC=null;return X(new w.Desc(w,"retry",[aE]),w.repeat(function(){function aL(){return aF().endOnError().withHandler(function(aM){if(aM.isError()){aC=aM;if(!(aG(aC.error)&&aB>0)){aH=true;return this.push(aM)}}else{if(aM.hasValue()){aC=null;aH=true}return this.push(aM)}})}if(aH){return null}else{if(aC){var aJ={error:aC.error,retriesDone:aI-aB};var aK=w.later(aD(aJ)).filter(false);aB=aB-1;return aK.concat(w.once().flatMap(aL))}else{return aL()}}}))};w.sequentially=function(aD,aB){var aC=0;return X(new w.Desc(w,"sequentially",[aD,aB]),w.fromPoll(aD,function(){var aE=aB[aC++];if(aC<aB.length){return aE}else{if(aC===aB.length){return[aE,O()]}else{return O()}}}))};w.Observable.prototype.skip=function(aB){return X(new w.Desc(this,"skip",[aB]),this.withHandler(function(aC){if(!aC.hasValue()){return this.push(aC)}else{if(aB>0){aB--;return w.more}else{return this.push(aC)}}}))};w.EventStream.prototype.skipUntil=function(aC){var aB=aC.take(1).map(true).toProperty(false);return X(new w.Desc(this,"skipUntil",[aC]),this.filter(aB))};w.EventStream.prototype.skipWhile=function(aF){var aD=false;for(var aE=arguments.length,aC=Array(aE>1?aE-1:0),aB=1;aB<aE;aB++){aC[aB-1]=arguments[aB]}return F(this,aF,aC,function(aG){return X(new w.Desc(this,"skipWhile",[aG]),this.withHandler(function(aH){if(aD||!aH.hasValue()||!aG(aH.value())){if(aH.hasValue()){aD=true}return this.push(aH)}else{return w.more}}))})};w.Observable.prototype.slidingWindow=function(aC){var aB=arguments.length<=1||arguments[1]===undefined?0:arguments[1];return X(new w.Desc(this,"slidingWindow",[aC,aB]),this.scan([],function(aD,aE){return aD.concat([aE]).slice(-aC)}).filter(function(aD){return aD.length>=aB}))};var ax=[];var h=function(aB){if(ax.length){if(!h.running){try{h.running=true;ax.forEach(function(aC){aC(aB)})}finally{delete h.running}}}};w.spy=function(aB){return ax.push(aB)};w.Property.prototype.startWith=function(aB){return X(new w.Desc(this,"startWith",[aB]),this.scan(aB,function(aD,aC){return aC}))};w.EventStream.prototype.startWith=function(aB){return X(new w.Desc(this,"startWith",[aB]),w.once(aB).concat(this))};w.Observable.prototype.takeWhile=function(aD){for(var aC=arguments.length,aB=Array(aC>1?aC-1:0),aE=1;aE<aC;aE++){aB[aE-1]=arguments[aE]}return F(this,aD,aB,function(aF){return X(new w.Desc(this,"takeWhile",[aF]),this.withHandler(function(aG){if(aG.filter(aF)){return this.push(aG)}else{this.push(O());return w.noMore}}))})};w.EventStream.prototype.throttle=function(aB){return X(new w.Desc(this,"throttle",[aB]),this.bufferWithTime(aB).map(function(aC){return aC[aC.length-1]}))};w.Property.prototype.throttle=function(aB){return this.delayChanges(new w.Desc(this,"throttle",[aB]),function(aC){return aC.throttle(aB)})};r.prototype.firstToPromise=function(aB){var aC=this;if(typeof aB!=="function"){if(typeof Promise==="function"){aB=Promise}else{throw new G("There isn't default Promise, use shim or parameter")}}return new aB(function(aE,aD){return aC.subscribe(function(aF){if(aF.hasValue()){aE(aF.value())}if(aF.isError()){aD(aF.error)}return w.noMore})})};r.prototype.toPromise=function(aB){return this.last().firstToPromise(aB)};w["try"]=function(aB){return function(aC){try{return w.once(aB(aC))}catch(aD){return new w.Error(aD)}}};w.update=function(aC){function aB(aH){return function(){for(var aJ=arguments.length,aI=Array(aJ),aK=0;aK<aJ;aK++){aI[aK]=arguments[aK]}return function(aL){return aH.apply(undefined,ah([aL].concat(aI)))}}}for(var aE=arguments.length,aF=Array(aE>1?aE-1:0),aG=1;aG<aE;aG++){aF[aG-1]=arguments[aG]}var aD=aF.length-1;while(aD>0){if(!(aF[aD] instanceof Function)){aF[aD]=I.always(aF[aD])}aF[aD]=aB(aF[aD]);aD=aD-2}return X(new w.Desc(w,"update",[aC].concat(aF)),w.when.apply(w,aF).scan(aC,function(aH,aI){return aI(aH)}))};w.zipAsArray=function(){for(var aB=arguments.length,aC=Array(aB),aD=0;aD<aB;aD++){aC[aD]=arguments[aD]}var aE=am(aC);return X(new w.Desc(w,"zipAsArray",aE),w.zipWith(aE,function(){for(var aF=arguments.length,aG=Array(aF),aH=0;aH<aF;aH++){aG[aH]=arguments[aH]}return aG}))};w.zipWith=function(){for(var aB=arguments.length,aC=Array(aB),aD=0;aD<aB;aD++){aC[aD]=arguments[aD]}var aG=e(aC);var aF=aG[0];var aE=aG[1];aF=I.map(function(aH){return aH.toEventStream()},aF);return X(new w.Desc(w,"zipWith",[aE].concat(aF)),w.when(aF,aE))};w.Observable.prototype.zip=function(aB,aC){return X(new w.Desc(this,"zip",[aB]),w.zipWith([this,aB],aC||Array))};if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return w});if(typeof this!=="undefined"&&this!==null){this.Bacon=w}}else{if(typeof module!=="undefined"&&module!==null&&module.exports!=null){module.exports=w;w.Bacon=w}else{this.Bacon=w}}}.call(this));