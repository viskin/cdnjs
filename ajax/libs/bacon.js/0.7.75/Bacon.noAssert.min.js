(function(){var u,an,o,at,J,x,y,B,af,z,k,F,ah,ae,i,q,ak,w,D,ap,aj,I,v,am,d,h,S,Y,ao,aa,s,K,U,ab,ac,ai,E,f,O,n,A,b,p,ar,M,r,C,a,ax,ad,ay,av,W,H,e,R,V,al,au,Z,az,G,g,l,t,c,Q,aw,T,N,L,X,j,ag={}.hasOwnProperty,P=function(aD,aB){for(var aA in aB){if(ag.call(aB,aA)){aD[aA]=aB[aA]}}function aC(){this.constructor=aD}aC.prototype=aB.prototype;aD.prototype=new aC();aD.__super__=aB.prototype;return aD},m=[].slice,aq=function(aA,aB){return function(){return aA.apply(aB,arguments)}};u={toString:function(){return"Bacon"}};u.version="0.7.75";F=(typeof global!=="undefined"&&global!==null?global:this).Error;au=function(){};ay=function(aB,aA){return aA};M=function(aA,aB){return aA};ab=function(aA){return aA.slice(0)};a=function(aA){return aA instanceof Array};ad=function(aA){return aA instanceof q};I={indexOf:Array.prototype.indexOf?function(aB,aA){return aB.indexOf(aA)}:function(aD,aA){var aE,aC,aB,aF;for(aE=aC=0,aB=aD.length;aC<aB;aE=++aC){aF=aD[aE];if(aA===aF){return aE}}return -1},indexWhere:function(aC,aE){var aD,aB,aA,aF;for(aD=aB=0,aA=aC.length;aB<aA;aD=++aB){aF=aC[aD];if(aE(aF)){return aD}}return -1},head:function(aA){return aA[0]},always:function(aA){return function(){return aA}},negate:function(aA){return function(aB){return !aA(aB)}},empty:function(aA){return aA.length===0},tail:function(aA){return aA.slice(1,aA.length)},filter:function(aF,aE){var aD,aC,aB,aA;aD=[];for(aC=0,aB=aE.length;aC<aB;aC++){aA=aE[aC];if(aF(aA)){aD.push(aA)}}return aD},map:function(aF,aD){var aC,aB,aE,aA;aE=[];for(aC=0,aB=aD.length;aC<aB;aC++){aA=aD[aC];aE.push(aF(aA))}return aE},each:function(aA,aD){var aB,aC;for(aB in aA){if(!ag.call(aA,aB)){continue}aC=aA[aB];aD(aB,aC)}return void 0},toArray:function(aA){if(a(aA)){return aA}else{return[aA]}},contains:function(aB,aA){return I.indexOf(aB,aA)!==-1},id:function(aA){return aA},last:function(aA){return aA[aA.length-1]},all:function(aD,aE){var aC,aB,aA;if(aE==null){aE=I.id}for(aC=0,aB=aD.length;aC<aB;aC++){aA=aD[aC];if(!aE(aA)){return false}}return true},any:function(aD,aE){var aC,aB,aA;if(aE==null){aE=I.id}for(aC=0,aB=aD.length;aC<aB;aC++){aA=aD[aC];if(aE(aA)){return true}}return false},without:function(aA,aB){return I.filter(function(aC){return aC!==aA},aB)},remove:function(aA,aB){var aC;aC=I.indexOf(aB,aA);if(aC>=0){return aB.splice(aC,1)}},fold:function(aE,aB,aF){var aD,aC,aA;for(aD=0,aC=aE.length;aD<aC;aD++){aA=aE[aD];aB=aF(aB,aA)}return aB},flatMap:function(aB,aA){return I.fold(aA,[],function(aD,aC){return aD.concat(aB(aC))})},cached:function(aB){var aA;aA=i;return function(){if(aA===i){aA=aB();aB=void 0}return aA}},isFunction:function(aA){return typeof aA==="function"},toString:function(aE){var aB,aC,aA,aD;try{az++;if(aE==null){return"undefined"}else{if(I.isFunction(aE)){return"function"}else{if(a(aE)){if(az>5){return"[..]"}return"["+I.map(I.toString,aE).toString()+"]"}else{if((aE!=null?aE.toString:void 0)!=null&&aE.toString!==Object.prototype.toString){return aE.toString()}else{if(typeof aE==="object"){if(az>5){return"{..}"}aC=function(){var aF;aF=[];for(aA in aE){if(!ag.call(aE,aA)){continue}aD=function(){try{return aE[aA]}catch(aG){aB=aG;return aB}}();aF.push(I.toString(aA)+":"+I.toString(aD))}return aF}();return"{"+aC+"}"}else{return aE}}}}}}finally{az--}}};az=0;u._=I;aj=u.UpdateBarrier=function(){var aF,aM,aB,aC,aJ,aN,aK,aL,aI,aA,aD,aE,aG,aH;aA=void 0;aD=[];aE={};aM=[];aB=0;aF=function(aO){if(aA){return aM.push(aO)}else{return aO()}};aG=function(aQ,aO){var aP;if(aA){aP=aE[aQ.id];if(aP==null){aP=aE[aQ.id]=[aO];return aD.push(aQ)}else{return aP.push(aO)}}else{return aO()}};aJ=function(){while(aD.length>0){aK(0)}return void 0};aK=function(aR){var aS,aQ,aP,aU,aO,aT;aU=aD[aR];aO=aU.id;aT=aE[aO];aD.splice(aR,1);delete aE[aO];aN(aU);for(aQ=0,aP=aT.length;aQ<aP;aQ++){aS=aT[aQ];aS()}return void 0};aN=function(aT){var aR,aS,aQ,aP,aO;aS=aT.internalDeps();for(aP=0,aO=aS.length;aP<aO;aP++){aR=aS[aP];aN(aR);if(aE[aR.id]){aQ=I.indexOf(aD,aR);aK(aQ)}}return void 0};aI=function(aR,aQ,aS,aP){var aT,aO;if(aA){return aS.apply(aQ,aP)}else{aA=aR;try{aO=aS.apply(aQ,aP);aJ()}finally{aA=void 0;while(aB<aM.length){aT=aM[aB];aB++;aT()}aB=0;aM=[]}return aO}};aC=function(){if(aA){return aA.id}else{return void 0}};aH=function(aT,aS){var aR,aO,aQ,aP;aP=false;aO=false;aR=function(){return aO=true};aQ=function(){aP=true;return aR()};aR=aT.dispatcher.subscribe(function(aU){return aF(function(){var aV;if(!aP){aV=aS(aU);if(aV===u.noMore){return aQ()}}})});if(aO){aR()}return aQ};aL=function(){return aD.length>0};return{whenDoneWith:aG,hasWaiters:aL,inTransaction:aI,currentEventId:aC,wrappedSubscribe:aH,afterTransaction:aF}}();ap=function(){function aA(aB,aD,aC){this.obs=aB;this.sync=aD;this.lazy=aC!=null?aC:false;this.queue=[]}aA.prototype.subscribe=function(aB){return this.obs.dispatcher.subscribe(aB)};aA.prototype.toString=function(){return this.obs.toString()};aA.prototype.markEnded=function(){return this.ended=true};aA.prototype.consume=function(){if(this.lazy){return{value:I.always(this.queue[0])}}else{return this.queue[0]}};aA.prototype.push=function(aB){return this.queue=[aB]};aA.prototype.mayHave=function(){return true};aA.prototype.hasAtLeast=function(){return this.queue.length};aA.prototype.flatten=true;return aA}();J=function(aA){P(aB,aA);function aB(){return aB.__super__.constructor.apply(this,arguments)}aB.prototype.consume=function(){return this.queue.shift()};aB.prototype.push=function(aC){return this.queue.push(aC)};aB.prototype.mayHave=function(aC){return !this.ended||this.queue.length>=aC};aB.prototype.hasAtLeast=function(aC){return this.queue.length>=aC};aB.prototype.flatten=false;return aB}(ap);an=function(aA){P(aB,aA);function aB(aC){aB.__super__.constructor.call(this,aC,true)}aB.prototype.consume=function(){var aC;aC=this.queue;this.queue=[];return{value:function(){return aC}}};aB.prototype.push=function(aC){return this.queue.push(aC.value())};aB.prototype.hasAtLeast=function(){return true};return aB}(ap);ap.isTrigger=function(aA){if(aA instanceof ap){return aA.sync}else{return aA instanceof k}};ap.fromObservable=function(aA){if(aA instanceof ap){return aA}else{if(aA instanceof ak){return new ap(aA,false)}else{return new J(aA,true)}}};x=function(){function aA(aD,aB,aC){this.context=aD;this.method=aB;this.args=aC}aA.prototype.deps=function(){return this.cached||(this.cached=b([this.context].concat(this.args)))};aA.prototype.toString=function(){return I.toString(this.context)+"."+I.toString(this.method)+"("+I.map(I.toString,this.args)+")"};return aA}();f=function(){var aA,aB,aC;aB=arguments[0],aC=arguments[1],aA=3<=arguments.length?m.call(arguments,2):[];if((aB||aC) instanceof x){return aB||aC}else{return new x(aB,aC,aA)}};X=function(aA,aB){aB.desc=aA;return aB};b=function(aA){if(a(aA)){return I.flatMap(b,aA)}else{if(ad(aA)){return[aA]}else{if(aA instanceof ap){return[aA.obs]}else{return[]}}}};u.Desc=x;u.Desc.empty=new u.Desc("","",[]);j=function(aA){return function(){var aC,aD,aE,aB;aE=arguments[0],aC=2<=arguments.length?m.call(arguments,1):[];if(typeof aE==="object"&&aC.length){aD=aE;aB=aC[0];aE=function(){return aD[aB].apply(aD,arguments)};aC=aC.slice(1)}return aA.apply(null,[aE].concat(m.call(aC)))}};H=function(aA){aA=Array.prototype.slice.call(aA);return e.apply(null,aA)};Z=function(aB,aA){return function(){var aC;aC=1<=arguments.length?m.call(arguments,0):[];return aB.apply(null,aA.concat(aC))}};N=function(aA){return function(aB){return function(aD){var aC;if(aD==null){return void 0}else{aC=aD[aB];if(I.isFunction(aC)){return aC.apply(aD,aA)}else{return aC}}}}};Q=function(aC,aA){var aB,aD;aD=aC.slice(1).split(".");aB=I.map(N(aA),aD);return function(aG){var aF,aE;for(aF=0,aE=aB.length;aF<aE;aF++){aC=aB[aF];aG=aC(aG)}return aG}};ax=function(aA){return typeof aA==="string"&&aA.length>1&&aA.charAt(0)==="."};e=j(function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];if(I.isFunction(aB)){if(aA.length){return Z(aB,aA)}else{return aB}}else{if(ax(aB)){return Q(aB,aA)}else{return I.always(aB)}}});W=function(aB,aA){return e.apply(null,[aB].concat(m.call(aA)))};E=function(aE,aC,aA,aD){var aB;if(aC instanceof ak){aB=aC.sampledBy(aE,function(aG,aF){return[aG,aF]});return aD.call(aB,function(aF){var aH,aG;aH=aF[0],aG=aF[1];return aH}).map(function(aF){var aH,aG;aH=aF[0],aG=aF[1];return aG})}else{aC=W(aC,aA);return aD.call(aE,aC)}};t=function(aB){var aA;if(I.isFunction(aB)){return aB}else{if(ax(aB)){aA=aw(aB);return function(aD,aC){return aD[aA](aC)}}else{throw new F("not a function or a field key: "+aB)}}};aw=function(aA){return aA.slice(1)};D=function(){function aA(aB){this.value=aB}aA.prototype.getOrElse=function(){return this.value};aA.prototype.get=function(){return this.value};aA.prototype.filter=function(aB){if(aB(this.value)){return new aA(this.value)}else{return i}};aA.prototype.map=function(aB){return new aA(aB(this.value))};aA.prototype.forEach=function(aB){return aB(this.value)};aA.prototype.isDefined=true;aA.prototype.toArray=function(){return[this.value]};aA.prototype.inspect=function(){return"Some("+this.value+")"};aA.prototype.toString=function(){return this.inspect()};return aA}();i={getOrElse:function(aA){return aA},filter:function(){return i},map:function(){return i},forEach:function(){},isDefined:false,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};T=function(aA){if(aA instanceof D||aA===i){return aA}else{return new D(aA)}};u.noMore=["<no-more>"];u.more=["<more>"];n=0;z=function(){function aA(){this.id=++n}aA.prototype.isEvent=function(){return true};aA.prototype.isEnd=function(){return false};aA.prototype.isInitial=function(){return false};aA.prototype.isNext=function(){return false};aA.prototype.isError=function(){return false};aA.prototype.hasValue=function(){return false};aA.prototype.filter=function(){return true};aA.prototype.inspect=function(){return this.toString()};aA.prototype.log=function(){return this.toString()};return aA}();ae=function(aB){P(aA,aB);function aA(aD,aC){if(!(this instanceof aA)){return new aA(aD,aC)}aA.__super__.constructor.call(this);if(!aC&&I.isFunction(aD)||aD instanceof aA){this.valueF=aD;this.valueInternal=void 0}else{this.valueF=void 0;this.valueInternal=aD}}aA.prototype.isNext=function(){return true};aA.prototype.hasValue=function(){return true};aA.prototype.value=function(){if(this.valueF instanceof aA){this.valueInternal=this.valueF.value();this.valueF=void 0}else{if(this.valueF){this.valueInternal=this.valueF();this.valueF=void 0}}return this.valueInternal};aA.prototype.fmap=function(aE){var aC,aD;if(this.valueInternal){aD=this.valueInternal;return this.apply(function(){return aE(aD)})}else{aC=this;return this.apply(function(){return aE(aC.value())})}};aA.prototype.apply=function(aC){return new aA(aC)};aA.prototype.filter=function(aC){return aC(this.value())};aA.prototype.toString=function(){return I.toString(this.value())};aA.prototype.log=function(){return this.value()};return aA}(z);ah=function(aB){P(aA,aB);function aA(aD,aC){if(!(this instanceof aA)){return new aA(aD,aC)}aA.__super__.constructor.call(this,aD,aC)}aA.prototype.isInitial=function(){return true};aA.prototype.isNext=function(){return false};aA.prototype.apply=function(aC){return new aA(aC)};aA.prototype.toNext=function(){return new ae(this)};return aA}(ae);B=function(aA){P(aB,aA);function aB(){if(!(this instanceof aB)){return new aB()}}aB.prototype.isEnd=function(){return true};aB.prototype.fmap=function(){return this};aB.prototype.apply=function(){return this};aB.prototype.toString=function(){return"<end>"};return aB}(z);af=function(aA){P(aB,aA);function aB(aC){if(!(this instanceof aB)){return new aB(aC)}this.error=aC}aB.prototype.isError=function(){return true};aB.prototype.fmap=function(){return this};aB.prototype.apply=function(){return this};aB.prototype.toString=function(){return"<error> "+I.toString(this.error)};return aB}(z);u.Event=z;u.Initial=ah;u.Next=ae;u.End=B;u.Error=af;C=function(aA){return new ah(aA,true)};al=function(aA){return new ae(aA,true)};O=function(){return new B()};c=function(aA){if(aA instanceof z){return aA}else{return al(aA)}};r=0;g=function(){};q=function(){function aA(aB){this.desc=aB;this.id=++r;this.initialDesc=this.desc}aA.prototype.subscribe=function(aB){return aj.wrappedSubscribe(this,aB)};aA.prototype.subscribeInternal=function(aB){return this.dispatcher.subscribe(aB)};aA.prototype.onValue=function(){var aB;aB=H(arguments);return this.subscribe(function(aC){if(aC.hasValue()){return aB(aC.value())}})};aA.prototype.onValues=function(aB){return this.onValue(function(aC){return aB.apply(null,aC)})};aA.prototype.onError=function(){var aB;aB=H(arguments);return this.subscribe(function(aC){if(aC.isError()){return aB(aC.error)}})};aA.prototype.onEnd=function(){var aB;aB=H(arguments);return this.subscribe(function(aC){if(aC.isEnd()){return aB()}})};aA.prototype.name=function(aB){this._name=aB;return this};aA.prototype.withDescription=function(){this.desc=f.apply(null,arguments);return this};aA.prototype.toString=function(){if(this._name){return this._name}else{return this.desc.toString()}};aA.prototype.internalDeps=function(){return this.initialDesc.deps()};return aA}();q.prototype.assign=q.prototype.onValue;q.prototype.forEach=q.prototype.onValue;q.prototype.inspect=q.prototype.toString;u.Observable=q;at=function(){function aA(aD){var aC,aB,aE;if(aD==null){aD=[]}this.unsubscribe=aq(this.unsubscribe,this);this.unsubscribed=false;this.subscriptions=[];this.starting=[];for(aC=0,aB=aD.length;aC<aB;aC++){aE=aD[aC];this.add(aE)}}aA.prototype.add=function(aD){var aE,aC,aB;if(this.unsubscribed){return}aE=false;aC=au;this.starting.push(aD);aB=function(aF){return function(){if(aF.unsubscribed){return}aE=true;aF.remove(aC);return I.remove(aD,aF.starting)}}(this);aC=aD(this.unsubscribe,aB);if(!(this.unsubscribed||aE)){this.subscriptions.push(aC)}else{aC()}I.remove(aD,this.starting);return aC};aA.prototype.remove=function(aB){if(this.unsubscribed){return}if(I.remove(aB,this.subscriptions)!==void 0){return aB()}};aA.prototype.unsubscribe=function(){var aC,aB,aE,aD;if(this.unsubscribed){return}this.unsubscribed=true;aE=this.subscriptions;for(aC=0,aB=aE.length;aC<aB;aC++){aD=aE[aC];aD()}this.subscriptions=[];return this.starting=[]};aA.prototype.count=function(){if(this.unsubscribed){return 0}return this.subscriptions.length+this.starting.length};aA.prototype.empty=function(){return this.count()===0};return aA}();u.CompositeUnsubscribe=at;y=function(){aA.prototype.pushing=false;aA.prototype.ended=false;aA.prototype.prevError=void 0;aA.prototype.unsubSrc=void 0;function aA(aB,aC){this._subscribe=aB;this._handleEvent=aC;this.subscribe=aq(this.subscribe,this);this.handleEvent=aq(this.handleEvent,this);this.subscriptions=[];this.queue=[]}aA.prototype.hasSubscribers=function(){return this.subscriptions.length>0};aA.prototype.removeSub=function(aB){return this.subscriptions=I.without(aB,this.subscriptions)};aA.prototype.push=function(aB){if(aB.isEnd()){this.ended=true}return aj.inTransaction(aB,this,this.pushIt,[aB])};aA.prototype.pushToSubscriptions=function(aG){var aH,aC,aB,aF,aE,aD;try{aD=this.subscriptions;for(aC=0,aB=aD.length;aC<aB;aC++){aE=aD[aC];aF=aE.sink(aG);if(aF===u.noMore||aG.isEnd()){this.removeSub(aE)}}return true}catch(aI){aH=aI;this.pushing=false;this.queue=[];throw aH}};aA.prototype.pushIt=function(aB){if(!this.pushing){if(aB===this.prevError){return}if(aB.isError()){this.prevError=aB}this.pushing=true;this.pushToSubscriptions(aB);this.pushing=false;while(this.queue.length){aB=this.queue.shift();this.push(aB)}if(this.hasSubscribers()){return u.more}else{this.unsubscribeFromSource();return u.noMore}}else{this.queue.push(aB);return u.more}};aA.prototype.handleEvent=function(aB){if(this._handleEvent){return this._handleEvent(aB)}else{return this.push(aB)}};aA.prototype.unsubscribeFromSource=function(){if(this.unsubSrc){this.unsubSrc()}return this.unsubSrc=void 0};aA.prototype.subscribe=function(aC){var aB;if(this.ended){aC(O());return au}else{aB={sink:aC};this.subscriptions.push(aB);if(this.subscriptions.length===1){this.unsubSrc=this._subscribe(this.handleEvent)}return function(aD){return function(){aD.removeSub(aB);if(!aD.hasSubscribers()){return aD.unsubscribeFromSource()}}}(this)}};return aA}();u.Dispatcher=y;k=function(aB){P(aA,aB);function aA(aE,aC,aD){if(!(this instanceof aA)){return new aA(aE,aC,aD)}if(I.isFunction(aE)){aD=aC;aC=aE;aE=x.empty}aA.__super__.constructor.call(this,aE);this.dispatcher=new y(aC,aD);g(this)}aA.prototype.toProperty=function(aC){var aD,aE;aE=arguments.length===0?i:T(function(){return aC});aD=this.dispatcher;return new ak(new u.Desc(this,"toProperty",[aC]),function(aJ){var aI,aH,aG,aF;aI=false;aF=au;aH=u.more;aG=function(){if(!aI){return aE.forEach(function(aK){aI=true;aH=aJ(new ah(aK));if(aH===u.noMore){aF();return aF=au}})}};aF=aD.subscribe(function(aK){if(aK.hasValue()){if(aI&&aK.isInitial()){return u.more}else{if(!aK.isInitial()){aG()}aI=true;aE=new D(aK);return aJ(aK)}}else{if(aK.isEnd()){aH=aG()}if(aH!==u.noMore){return aJ(aK)}}});aG();return aF})};aA.prototype.toEventStream=function(){return this};aA.prototype.withHandler=function(aC){return new aA(new u.Desc(this,"withHandler",[aC]),this.dispatcher.subscribe,aC)};return aA}(q);u.EventStream=k;u.never=function(){return new k(f(u,"never"),function(aA){aA(O());return au})};u.when=function(){var aQ,aO,aF,aD,aN,aM,aP,aH,aG,aC,aK,aJ,aI,aB,aE,aT,aL,aA,aR,aS;if(arguments.length===0){return u.never()}aP=arguments.length;aS="when: expecting arguments in the form (Observable+,function)+";aA=[];aI=[];aO=0;aB=[];while(aO<aP){aB[aO]=arguments[aO];aB[aO+1]=arguments[aO+1];aJ=I.toArray(arguments[aO]);aQ=ac(arguments[aO+1]);aK={f:aQ,ixs:[]};aR=false;for(aN=0,aH=aJ.length;aN<aH;aN++){aL=aJ[aN];aF=I.indexOf(aA,aL);if(!aR){aR=ap.isTrigger(aL)}if(aF<0){aA.push(aL);aF=aA.length-1}aE=aK.ixs;for(aM=0,aG=aE.length;aM<aG;aM++){aD=aE[aM];if(aD.index===aF){aD.count++}}aK.ixs.push({index:aF,count:1})}if(aJ.length>0){aI.push(aK)}aO=aO+2}if(!aA.length){return u.never()}aA=I.map(ap.fromObservable,aA);aC=I.any(aA,function(aU){return aU.flatten})&&ai(I.map(function(aU){return aU.obs},aA));return aT=new k(new u.Desc(u,"when",aB),function(a1){var a0,aZ,aU,aW,aY,aV,aX;aX=[];aU=false;aW=function(a5){var a3,a2,a4;a4=a5.ixs;for(a3=0,a2=a4.length;a3<a2;a3++){aO=a4[a3];if(!aA[aO.index].hasAtLeast(aO.count)){return false}}return true};aZ=function(a2){return !a2.sync||a2.ended};a0=function(a5){var a3,a2,a4;a4=a5.ixs;for(a3=0,a2=a4.length;a3<a2;a3++){aO=a4[a3];if(!aA[aO.index].mayHave(aO.count)){return true}}};aY=function(a2){return !a2.source.flatten};aV=function(a2){return function(a4){var a3,a6,a5;a6=function(){return aj.whenDoneWith(aT,a3)};a5=function(){var ba,a8,a7,bc,bb,a9;if(aX.length>0){bb=u.more;a9=aX.pop();for(a8=0,a7=aI.length;a8<a7;a8++){bc=aI[a8];if(aW(bc)){ba=function(){var be,bd,bf,bg;bf=bc.ixs;bg=[];for(bd=0,be=bf.length;bd<be;bd++){aO=bf[bd];bg.push(aA[aO.index].consume())}return bg}();bb=a1(a9.e.apply(function(){var be,bd;bd=function(){var bg,bf,bh;bh=[];for(bf=0,bg=ba.length;bf<bg;bf++){be=ba[bf];bh.push(be.value())}return bh}();return bc.f.apply(bc,bd)}));if(aX.length){aX=I.filter(aY,aX)}if(bb===u.noMore){return bb}else{return a5()}}}}else{return u.more}};a3=function(){var a7;a7=a5();if(aU){if(I.all(aA,aZ)||I.all(aI,a0)){a7=u.noMore;a1(O())}}if(a7===u.noMore){a4()}return a7};return a2.subscribe(function(a8){var a7;if(a8.isEnd()){aU=true;a2.markEnded();a6()}else{if(a8.isError()){a7=a1(a8)}else{a2.push(a8);if(a2.sync){aX.push({source:a2,e:a8});if(aC||aj.hasWaiters()){a6()}else{a3()}}}}if(a7===u.noMore){a4()}return a7||u.more})}};return new u.CompositeUnsubscribe(function(){var a3,a2,a4;a4=[];for(a3=0,a2=aA.length;a3<a2;a3++){aL=aA[a3];a4.push(aV(aL))}return a4}()).unsubscribe})};ai=function(aC,aB){var aA;if(aB==null){aB=[]}aA=function(aE){var aD;if(I.contains(aB,aE)){return true}else{aD=aE.internalDeps();if(aD.length){aB.push(aE);return I.any(aD,aA)}else{aB.push(aE);return false}}};return I.any(aC,aA)};ac=function(aA){if(I.isFunction(aA)){return aA}else{return I.always(aA)}};u.groupSimultaneous=function(){var aB,aA,aC;aC=1<=arguments.length?m.call(arguments,0):[];if(aC.length===1&&a(aC[0])){aC=aC[0]}aA=function(){var aE,aD,aF;aF=[];for(aE=0,aD=aC.length;aE<aD;aE++){aB=aC[aE];aF.push(new an(aB))}return aF}();return X(new u.Desc(u,"groupSimultaneous",aC),u.when(aA,function(){var aD;aD=1<=arguments.length?m.call(arguments,0):[];return aD}))};w=function(aA){P(aB,aA);function aB(aE,aC,aD){this.property=aE;this.subscribe=aq(this.subscribe,this);aB.__super__.constructor.call(this,aC,aD);this.current=i;this.currentValueRootId=void 0;this.propertyEnded=false}aB.prototype.push=function(aC){if(aC.isEnd()){this.propertyEnded=true}if(aC.hasValue()){this.current=new D(aC);this.currentValueRootId=aj.currentEventId()}return aB.__super__.push.call(this,aC)};aB.prototype.maybeSubSource=function(aD,aC){if(aC===u.noMore){return au}else{if(this.propertyEnded){aD(O());return au}else{return y.prototype.subscribe.call(this,aD)}}};aB.prototype.subscribe=function(aE){var aG,aD,aC,aF;aD=false;aC=u.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){aG=aj.currentEventId();aF=this.currentValueRootId;if(!this.propertyEnded&&aF&&aG&&aG!==aF){aj.whenDoneWith(this.property,function(aH){return function(){if(aH.currentValueRootId===aF){return aE(C(aH.current.get().value()))}}}(this));return this.maybeSubSource(aE,aC)}else{aj.inTransaction(void 0,this,function(){return aC=aE(C(this.current.get().value()))},[]);return this.maybeSubSource(aE,aC)}}else{return this.maybeSubSource(aE,aC)}};return aB}(y);ak=function(aA){P(aB,aA);function aB(aE,aC,aD){aB.__super__.constructor.call(this,aE);this.dispatcher=new w(this,aC,aD);g(this)}aB.prototype.changes=function(){return new k(new u.Desc(this,"changes",[]),function(aC){return function(aD){return aC.dispatcher.subscribe(function(aE){if(!aE.isInitial()){return aD(aE)}})}}(this))};aB.prototype.withHandler=function(aC){return new aB(new u.Desc(this,"withHandler",[aC]),this.dispatcher.subscribe,aC)};aB.prototype.toProperty=function(){return this};aB.prototype.toEventStream=function(){return new k(new u.Desc(this,"toEventStream",[]),function(aC){return function(aD){return aC.dispatcher.subscribe(function(aE){if(aE.isInitial()){aE=aE.toNext()}return aD(aE)})}}(this))};return aB}(q);u.Property=ak;u.constant=function(aA){return new ak(new u.Desc(u,"constant",[aA]),function(aB){aB(C(aA));aB(O());return au})};u.fromBinder=function(aA,aB){if(aB==null){aB=I.id}return new k(new u.Desc(u,"fromBinder",[aA,aB]),function(aF){var aG,aD,aC,aE;aE=false;aG=false;aD=function(){if(!aE){if(typeof aC!=="undefined"&&aC!==null){aC();return aE=true}else{return aG=true}}};aC=aA(function(){var aJ,aL,aI,aH,aK,aM;aJ=1<=arguments.length?m.call(arguments,0):[];aM=aB.apply(this,aJ);if(!(a(aM)&&I.last(aM) instanceof z)){aM=[aM]}aK=u.more;for(aI=0,aH=aM.length;aI<aH;aI++){aL=aM[aI];aK=aF(aL=c(aL));if(aK===u.noMore||aL.isEnd()){aD();return aK}}return aK});if(aG){aD()}return aD})};u.Observable.prototype.map=function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];return E(this,aB,aA,function(aC){return X(new u.Desc(this,"map",[aC]),this.withHandler(function(aD){return this.push(aD.fmap(aC))}))})};am=function(aA){if(a(aA[0])){return aA[0]}else{return Array.prototype.slice.call(aA)}};d=function(aA){if(I.isFunction(aA[0])){return[am(Array.prototype.slice.call(aA,1)),aA[0]]}else{return[am(Array.prototype.slice.call(aA,0,aA.length-1)),I.last(aA)]}};u.combineAsArray=function(){var aD,aC,aB,aE,aA,aF,aG;aG=am(arguments);for(aD=aC=0,aB=aG.length;aC<aB;aD=++aC){aF=aG[aD];if(!ad(aF)){aG[aD]=u.constant(aF)}}if(aG.length){aA=function(){var aI,aH,aJ;aJ=[];for(aI=0,aH=aG.length;aI<aH;aI++){aE=aG[aI];aJ.push(new ap(aE,true))}return aJ}();return X(new u.Desc(u,"combineAsArray",aG),u.when(aA,function(){var aH;aH=1<=arguments.length?m.call(arguments,0):[];return aH}).toProperty())}else{return u.constant([])}};u.onValues=function(){var aB,aA,aC;aC=2<=arguments.length?m.call(arguments,0,aA=arguments.length-1):(aA=0,[]),aB=arguments[aA++];return u.combineAsArray(aC).onValues(aB)};u.combineWith=function(){var aB,aA,aC;aA=d(arguments),aC=aA[0],aB=aA[1];return X(new u.Desc(u,"combineWith",[aB].concat(m.call(aC))),u.combineAsArray(aC).map(function(aD){return aB.apply(null,aD)}))};u.Observable.prototype.combine=function(aA,aC){var aB;aB=t(aC);return X(new u.Desc(this,"combine",[aA,aC]),u.combineAsArray(this,aA).map(function(aD){return aB(aD[0],aD[1])}))};u.Observable.prototype.withStateMachine=function(aA,aC){var aB;aB=aA;return X(new u.Desc(this,"withStateMachine",[aA,aC]),this.withHandler(function(aI){var aH,aF,aE,aJ,aD,aK,aG;aH=aC(aB,aI);aJ=aH[0],aK=aH[1];aB=aJ;aG=u.more;for(aF=0,aE=aK.length;aF<aE;aF++){aD=aK[aF];aG=this.push(aD);if(aG===u.noMore){return aG}}return aG}))};u.Observable.prototype.skipDuplicates=function(aA){if(aA==null){aA=function(aC,aB){return aC===aB}}return X(new u.Desc(this,"skipDuplicates",[]),this.withStateMachine(i,function(aC,aB){if(!aB.hasValue()){return[aC,[aB]]}else{if(aB.isInitial()||aC===i||!aA(aC.get(),aB.value())){return[new D(aB.value()),[aB]]}else{return[aC,[]]}}}))};u.Observable.prototype.awaiting=function(aA){return X(new u.Desc(this,"awaiting",[aA]),u.groupSimultaneous(this,aA).map(function(aB){var aC,aD;aC=aB[0],aD=aB[1];return aD.length===0}).toProperty(false).skipDuplicates())};u.Observable.prototype.not=function(){return X(new u.Desc(this,"not",[]),this.map(function(aA){return !aA}))};u.Property.prototype.and=function(aA){return X(new u.Desc(this,"and",[aA]),this.combine(aA,function(aB,aC){return aB&&aC}))};u.Property.prototype.or=function(aA){return X(new u.Desc(this,"or",[aA]),this.combine(aA,function(aB,aC){return aB||aC}))};u.scheduler={setTimeout:function(aA,aB){return setTimeout(aA,aB)},setInterval:function(aB,aA){return setInterval(aB,aA)},clearInterval:function(aA){return clearInterval(aA)},clearTimeout:function(aA){return clearTimeout(aA)},now:function(){return new Date().getTime()}};u.EventStream.prototype.bufferWithTime=function(aA){return X(new u.Desc(this,"bufferWithTime",[aA]),this.bufferWithTimeOrCount(aA,Number.MAX_VALUE))};u.EventStream.prototype.bufferWithCount=function(aA){return X(new u.Desc(this,"bufferWithCount",[aA]),this.bufferWithTimeOrCount(void 0,aA))};u.EventStream.prototype.bufferWithTimeOrCount=function(aA,aB){var aC;aC=function(aD){if(aD.values.length===aB){return aD.flush()}else{if(aA!==void 0){return aD.schedule()}}};return X(new u.Desc(this,"bufferWithTimeOrCount",[aA,aB]),this.buffer(aA,aC,aC))};u.EventStream.prototype.buffer=function(aC,aE,aB){var aA,aF,aD;if(aE==null){aE=au}if(aB==null){aB=au}aA={scheduled:null,end:void 0,values:[],flush:function(){var aH,aG;if(this.scheduled){u.scheduler.clearTimeout(this.scheduled);this.scheduled=null}if(this.values.length>0){aG=this.values;this.values=[];aH=this.push(al(aG));if(this.end!=null){return this.push(this.end)}else{if(aH!==u.noMore){return aB(this)}}}else{if(this.end!=null){return this.push(this.end)}}},schedule:function(){if(!this.scheduled){return this.scheduled=aC(function(aG){return function(){return aG.flush()}}(this))}}};aD=u.more;if(!I.isFunction(aC)){aF=aC;aC=function(aG){return u.scheduler.setTimeout(aG,aF)}}return X(new u.Desc(this,"buffer",[]),this.withHandler(function(aG){aA.push=function(aH){return function(aI){return aH.push(aI)}}(this);if(aG.isError()){aD=this.push(aG)}else{if(aG.isEnd()){aA.end=aG;if(!aA.scheduled){aA.flush()}}else{aA.values.push(aG.value());aE(aA)}}return aD}))};u.Observable.prototype.filter=function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];return E(this,aB,aA,function(aC){return X(new u.Desc(this,"filter",[aC]),this.withHandler(function(aD){if(aD.filter(aC)){return this.push(aD)}else{return u.more}}))})};u.once=function(aA){return new k(new x(u,"once",[aA]),function(aB){aB(c(aA));aB(O());return au})};u.EventStream.prototype.concat=function(aA){var aB;aB=this;return new k(new u.Desc(aB,"concat",[aA]),function(aD){var aE,aC;aC=au;aE=aB.dispatcher.subscribe(function(aF){if(aF.isEnd()){return aC=aA.dispatcher.subscribe(aD)}else{return aD(aF)}});return function(){aE();return aC()}})};u.Observable.prototype.flatMap=function(){return ar(this,V(arguments))};u.Observable.prototype.flatMapFirst=function(){return ar(this,V(arguments),true)};ar=function(aC,aG,aD,aB){var aF,aA,aE;aE=[aC];aF=[];aA=new k(new u.Desc(aC,"flatMap"+(aD?"First":""),[aG]),function(aJ){var aL,aK,aM,aH,aI;aM=new at();aH=[];aI=function(aN){var aO;aO=R(aG(aN.value()));aF.push(aO);return aM.add(function(aQ,aP){return aO.dispatcher.subscribe(function(aS){var aR;if(aS.isEnd()){I.remove(aO,aF);aK();aL(aP);return u.noMore}else{if(aS instanceof ah){aS=aS.toNext()}aR=aJ(aS);if(aR===u.noMore){aQ()}return aR}})})};aK=function(){var aN;aN=aH.shift();if(aN){return aI(aN)}};aL=function(aN){aN();if(aM.empty()){return aJ(O())}};aM.add(function(aO,aN){return aC.dispatcher.subscribe(function(aP){if(aP.isEnd()){return aL(aN)}else{if(aP.isError()){return aJ(aP)}else{if(aD&&aM.count()>1){return u.more}else{if(aM.unsubscribed){return u.noMore}if(aB&&aM.count()>aB){return aH.push(aP)}else{return aI(aP)}}}}})});return aM.unsubscribe});aA.internalDeps=function(){if(aF.length){return aE.concat(aF)}else{return aE}};return aA};V=function(aA){if(aA.length===1&&ad(aA[0])){return I.always(aA[0])}else{return H(aA)}};R=function(aA){if(ad(aA)){return aA}else{return u.once(aA)}};u.Observable.prototype.flatMapWithConcurrencyLimit=function(){var aB,aA;aA=arguments[0],aB=2<=arguments.length?m.call(arguments,1):[];return X(new u.Desc(this,"flatMapWithConcurrencyLimit",[aA].concat(m.call(aB))),ar(this,V(aB),false,aA))};u.Observable.prototype.flatMapConcat=function(){return X(new u.Desc(this,"flatMapConcat",Array.prototype.slice.call(arguments,0)),this.flatMapWithConcurrencyLimit.apply(this,[1].concat(m.call(arguments))))};u.later=function(aA,aB){return X(new u.Desc(u,"later",[aA,aB]),u.fromBinder(function(aD){var aE,aC;aC=function(){return aD([aB,O()])};aE=u.scheduler.setTimeout(aC,aA);return function(){return u.scheduler.clearTimeout(aE)}}))};u.Observable.prototype.bufferingThrottle=function(aA){return X(new u.Desc(this,"bufferingThrottle",[aA]),this.flatMapConcat(function(aB){return u.once(aB).concat(u.later(aA).filter(false))}))};u.Property.prototype.bufferingThrottle=function(){return u.Observable.prototype.bufferingThrottle.apply(this,arguments).toProperty()};o=function(aA){P(aB,aA);function aB(){this.guardedSink=aq(this.guardedSink,this);this.subscribeAll=aq(this.subscribeAll,this);this.unsubAll=aq(this.unsubAll,this);if(!(this instanceof aB)){return new aB()}this.sink=void 0;this.subscriptions=[];this.ended=false;aB.__super__.constructor.call(this,new u.Desc(u,"Bus",[]),this.subscribeAll)}aB.prototype.unsubAll=function(){var aD,aC,aF,aE;aF=this.subscriptions;for(aD=0,aC=aF.length;aD<aC;aD++){aE=aF[aD];if(typeof aE.unsub==="function"){aE.unsub()}}return void 0};aB.prototype.subscribeAll=function(aE){var aD,aC,aG,aF;if(this.ended){aE(O())}else{this.sink=aE;aG=ab(this.subscriptions);for(aD=0,aC=aG.length;aD<aC;aD++){aF=aG[aD];this.subscribeInput(aF)}}return this.unsubAll};aB.prototype.guardedSink=function(aC){return function(aD){return function(aE){if(aE.isEnd()){aD.unsubscribeInput(aC);return u.noMore}else{return aD.sink(aE)}}}(this)};aB.prototype.subscribeInput=function(aC){return aC.unsub=aC.input.dispatcher.subscribe(this.guardedSink(aC.input))};aB.prototype.unsubscribeInput=function(aC){var aF,aE,aD,aH,aG;aH=this.subscriptions;for(aF=aE=0,aD=aH.length;aE<aD;aF=++aE){aG=aH[aF];if(aG.input===aC){if(typeof aG.unsub==="function"){aG.unsub()}this.subscriptions.splice(aF,1);return}}};aB.prototype.plug=function(aC){var aD;if(this.ended){return}aD={input:aC};this.subscriptions.push(aD);if(this.sink!=null){this.subscribeInput(aD)}return function(aE){return function(){return aE.unsubscribeInput(aC)}}(this)};aB.prototype.end=function(){this.ended=true;this.unsubAll();return typeof this.sink==="function"?this.sink(O()):void 0};aB.prototype.push=function(aC){if(!this.ended){return typeof this.sink==="function"?this.sink(al(aC)):void 0}};aB.prototype.error=function(aC){return typeof this.sink==="function"?this.sink(new af(aC)):void 0};return aB}(k);u.Bus=o;av=function(aB,aA){return j(function(){var aC,aD,aE;aD=arguments[0],aC=2<=arguments.length?m.call(arguments,1):[];aE=Z(aA,[function(aF,aG){return aD.apply(null,m.call(aF).concat([aG]))}]);return X(new u.Desc(u,aB,[aD].concat(m.call(aC))),u.combineAsArray(aC).flatMap(aE))})};u.fromCallback=av("fromCallback",function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];return u.fromBinder(function(aC){W(aB,aA)(aC);return au},function(aC){return[aC,O()]})});u.fromNodeCallback=av("fromNodeCallback",function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];return u.fromBinder(function(aC){W(aB,aA)(aC);return au},function(aC,aD){if(aC){return[new af(aC),O()]}return[aD,O()]})});u.combineTemplate=function(aI){var aC,aD,aK,aJ,aB,aG,aA,aH,aF,aE,aL;aA=[];aL=[];aG=function(aM){return aM[aM.length-1]};aE=function(aM,aN,aO){return aG(aM)[aN]=aO};aC=function(aN,aM){return function(aP,aO){return aE(aP,aN,aO[aM])}};aB=function(aM,aN){return function(aO){return aE(aO,aM,aN)}};aH=function(aM){if(a(aM)){return[]}else{return{}}};aF=function(aM,aN){return function(aO){var aP;aP=aH(aN);aE(aO,aM,aP);return aO.push(aP)}};aK=function(aM,aN){var aO;if(ad(aN)){aL.push(aN);return aA.push(aC(aM,aL.length-1))}else{if(aN===Object(aN)&&typeof aN!=="function"&&!(aN instanceof RegExp)&&!(aN instanceof Date)){aO=function(aP){return aP.pop()};aA.push(aF(aM,aN));aJ(aN);return aA.push(aO)}else{return aA.push(aB(aM,aN))}}};aJ=function(aM){return I.each(aM,aK)};aJ(aI);aD=function(aO){var aN,aR,aQ,aP,aM;aM=aH(aI);aN=[aM];for(aQ=0,aP=aA.length;aQ<aP;aQ++){aR=aA[aQ];aR(aN,aO)}return aM};return X(new u.Desc(u,"combineTemplate",[aI]),u.combineAsArray(aL).map(aD))};v=function(aB,aC){var aA;aA=new k(f(aB,"justInitValue"),function(aF){var aD,aE;aE=void 0;aD=aB.dispatcher.subscribe(function(aG){if(!aG.isEnd()){aE=aG}return u.noMore});aj.whenDoneWith(aA,function(){if(aE!=null){aF(aE)}return aF(O())});return aD});return aA.concat(aC).toProperty()};u.Observable.prototype.mapEnd=function(){var aA;aA=H(arguments);return X(new u.Desc(this,"mapEnd",[aA]),this.withHandler(function(aB){if(aB.isEnd()){this.push(al(aA(aB)));this.push(O());return u.noMore}else{return this.push(aB)}}))};u.Observable.prototype.skipErrors=function(){return X(new u.Desc(this,"skipErrors",[]),this.withHandler(function(aA){if(aA.isError()){return u.more}else{return this.push(aA)}}))};u.EventStream.prototype.takeUntil=function(aA){var aB;aB={};return X(new u.Desc(this,"takeUntil",[aA]),u.groupSimultaneous(this.mapEnd(aB),aA.skipErrors()).withHandler(function(aG){var aI,aD,aC,aF,aE,aH;if(!aG.hasValue()){return this.push(aG)}else{aF=aG.value(),aI=aF[0],aA=aF[1];if(aA.length){return this.push(O())}else{aE=u.more;for(aD=0,aC=aI.length;aD<aC;aD++){aH=aI[aD];if(aH===aB){aE=this.push(O())}else{aE=this.push(al(aH))}}return aE}}}))};u.Property.prototype.takeUntil=function(aB){var aA;aA=this.changes().takeUntil(aB);return X(new u.Desc(this,"takeUntil",[aB]),v(this,aA))};u.Observable.prototype.flatMapLatest=function(){var aA,aB;aA=V(arguments);aB=this.toEventStream();return X(new u.Desc(this,"flatMapLatest",[aA]),aB.flatMap(function(aC){return R(aA(aC)).takeUntil(aB)}))};u.Property.prototype.delayChanges=function(aB,aA){return X(aB,v(this,aA(this.changes())))};u.EventStream.prototype.delay=function(aA){return X(new u.Desc(this,"delay",[aA]),this.flatMap(function(aB){return u.later(aA,aB)}))};u.Property.prototype.delay=function(aA){return this.delayChanges(new u.Desc(this,"delay",[aA]),function(aB){return aB.delay(aA)})};u.EventStream.prototype.debounce=function(aA){return X(new u.Desc(this,"debounce",[aA]),this.flatMapLatest(function(aB){return u.later(aA,aB)}))};u.Property.prototype.debounce=function(aA){return this.delayChanges(new u.Desc(this,"debounce",[aA]),function(aB){return aB.debounce(aA)})};u.EventStream.prototype.debounceImmediate=function(aA){return X(new u.Desc(this,"debounceImmediate",[aA]),this.flatMapFirst(function(aB){return u.once(aB).concat(u.later(aA).filter(false))}))};u.Observable.prototype.decode=function(aA){return X(new u.Desc(this,"decode",[aA]),this.combine(u.combineTemplate(aA),function(aC,aB){return aB[aC]}))};u.Observable.prototype.scan=function(aB,aD){var aC,aE,aF,aA;aD=t(aD);aC=T(aB);aE=false;aA=function(aG){return function(aL){var aK,aJ,aI,aH;aK=false;aH=au;aJ=u.more;aI=function(){if(!aK){return aC.forEach(function(aM){aK=aE=true;aJ=aL(new ah(function(){return aM}));if(aJ===u.noMore){aH();return aH=au}})}};aH=aG.dispatcher.subscribe(function(aO){var aM,aN;if(aO.hasValue()){if(aE&&aO.isInitial()){return u.more}else{if(!aO.isInitial()){aI()}aK=aE=true;aN=aC.getOrElse(void 0);aM=aD(aN,aO.value());aC=new D(aM);return aL(aO.apply(function(){return aM}))}}else{if(aO.isEnd()){aJ=aI()}if(aJ!==u.noMore){return aL(aO)}}});aj.whenDoneWith(aF,aI);return aH}}(this);return aF=new ak(new u.Desc(this,"scan",[aB,aD]),aA)};u.Observable.prototype.diff=function(aB,aA){aA=t(aA);return X(new u.Desc(this,"diff",[aB,aA]),this.scan([aB],function(aC,aD){return[aD,aA(aC[0],aD)]}).filter(function(aC){return aC.length===2}).map(function(aC){return aC[1]}))};u.Observable.prototype.doAction=function(){var aA;aA=H(arguments);return X(new u.Desc(this,"doAction",[aA]),this.withHandler(function(aB){if(aB.hasValue()){aA(aB.value())}return this.push(aB)}))};u.Observable.prototype.doError=function(){var aA;aA=H(arguments);return X(new u.Desc(this,"doError",[aA]),this.withHandler(function(aB){if(aB.isError()){aA(aB.error)}return this.push(aB)}))};u.Observable.prototype.doLog=function(){var aA;aA=1<=arguments.length?m.call(arguments,0):[];return X(new u.Desc(this,"doLog",aA),this.withHandler(function(aB){if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log.apply(console,m.call(aA).concat([aB.log()]))}}return this.push(aB)}))};u.Observable.prototype.endOnError=function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];if(aB==null){aB=true}return E(this,aB,aA,function(aC){return X(new u.Desc(this,"endOnError",[]),this.withHandler(function(aD){if(aD.isError()&&aC(aD.error)){this.push(aD);return this.push(O())}else{return this.push(aD)}}))})};q.prototype.errors=function(){return X(new u.Desc(this,"errors",[]),this.filter(function(){return false}))};u.Observable.prototype.mapError=function(){var aA;aA=H(arguments);return X(new u.Desc(this,"mapError",[aA]),this.withHandler(function(aB){if(aB.isError()){return this.push(al(aA(aB.error)))}else{return this.push(aB)}}))};u.Observable.prototype.flatMapError=function(aA){return X(new u.Desc(this,"flatMapError",[aA]),this.mapError(function(aB){return new af(aB)}).flatMap(function(aB){if(aB instanceof af){return aA(aB.error)}else{return u.once(aB)}}))};u.EventStream.prototype.sampledBy=function(aA,aB){return X(new u.Desc(this,"sampledBy",[aA,aB]),this.toProperty().sampledBy(aA,aB))};u.Property.prototype.sampledBy=function(aC,aF){var aB,aA,aD,aG,aE;if(aF!=null){aF=t(aF)}else{aB=true;aF=function(aH){return aH.value()}}aE=new ap(this,false,aB);aD=new ap(aC,true,aB);aG=u.when([aE,aD],aF);aA=aC instanceof ak?aG.toProperty():aG;return X(new u.Desc(this,"sampledBy",[aC,aF]),aA)};u.Property.prototype.sample=function(aA){return X(new u.Desc(this,"sample",[aA]),this.sampledBy(u.interval(aA,{})))};u.Observable.prototype.map=function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];if(aB instanceof ak){return aB.sampledBy(this,M)}else{return E(this,aB,aA,function(aC){return X(new u.Desc(this,"map",[aC]),this.withHandler(function(aD){return this.push(aD.fmap(aC))}))})}};u.Observable.prototype.fold=function(aA,aB){return X(new u.Desc(this,"fold",[aA,aB]),this.scan(aA,aB).sampledBy(this.filter(false).mapEnd().toProperty()))};q.prototype.reduce=q.prototype.fold;A=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];p=function(aG){var aE,aD,aB,aC,aA,aF,aH;for(aD=0,aC=A.length;aD<aC;aD++){aH=A[aD];aF=[aG[aH[0]],aG[aH[1]]];if(aF[0]&&aF[1]){return aF}}for(aB=0,aA=A.length;aB<aA;aB++){aH=A[aB];aE=aG[aH[0]];if(aE){return[aE,function(){}]}}throw new af("No suitable event methods in "+aG)};u.fromEventTarget=function(aF,aA,aD){var aE,aC,aB;aE=p(aF),aC=aE[0],aB=aE[1];return X(new u.Desc(u,"fromEvent",[aF,aA]),u.fromBinder(function(aG){aC.call(aF,aA,aG);return function(){return aB.call(aF,aA,aG)}},aD))};u.fromEvent=u.fromEventTarget;u.fromPoll=function(aA,aB){return X(new u.Desc(u,"fromPoll",[aA,aB]),u.fromBinder(function(aC){var aD;aD=u.scheduler.setInterval(aC,aA);return function(){return u.scheduler.clearInterval(aD)}},aB))};L=function(aA){return[aA,O()]};u.fromPromise=function(aB,aC,aA){if(aA==null){aA=L}return X(new u.Desc(u,"fromPromise",[aB]),u.fromBinder(function(aD){var aE;if((aE=aB.then(aD,function(aF){return aD(new af(aF))}))!=null){if(typeof aE.done==="function"){aE.done()}}return function(){if(aC){return typeof aB.abort==="function"?aB.abort():void 0}}},aA))};u.Observable.prototype.groupBy=function(aB,aA){var aC,aD;if(aA==null){aA=u._.id}aD={};aC=this;return aC.filter(function(aE){return !aD[aB(aE)]}).map(function(aE){var aH,aG,aF,aI;aG=aB(aE);aI=aC.filter(function(aJ){return aB(aJ)===aG});aH=u.once(aE).concat(aI);aF=aA(aH,aE).withHandler(function(aJ){this.push(aJ);if(aJ.isEnd()){return delete aD[aG]}});return aD[aG]=aF})};u.fromArray=function(aA){var aB;if(!aA.length){return X(new u.Desc(u,"fromArray",aA),u.never())}else{aB=0;return new k(new u.Desc(u,"fromArray",[aA]),function(aH){var aF,aD,aC,aG,aE;aE=false;aG=u.more;aC=false;aD=false;aF=function(){var aI;aD=true;if(aC){return}aC=true;while(aD){aD=false;if(aG!==u.noMore&&!aE){aI=aA[aB++];aG=aH(c(aI));if(aG!==u.noMore){if(aB===aA.length){aH(O())}else{aj.afterTransaction(aF)}}}}return aC=false};aF();return function(){return aE=true}})}};u.EventStream.prototype.holdWhen=function(aD){var aA,aB,aC;aB=false;aA=[];aC=this;return new k(new u.Desc(this,"holdWhen",[aD]),function(aF){var aH,aE,aG;aH=new at();aG=false;aE=function(aI){if(typeof aI==="function"){aI()}if(aH.empty()&&aG){return aF(O())}};aH.add(function(aJ,aI){return aD.subscribeInternal(function(aN){var aL,aK,aM,aP,aO;if(aN.hasValue()){aB=aN.value();if(!aB){aP=aA;aA=[];aM=[];for(aL=0,aK=aP.length;aL<aK;aL++){aO=aP[aL];aM.push(aF(al(aO)))}return aM}}else{if(aN.isEnd()){return aE(aI)}else{return aF(aN)}}})});aH.add(function(aJ,aI){return aC.subscribeInternal(function(aK){if(aB&&aK.hasValue()){return aA.push(aK.value())}else{if(aK.isEnd()&&aA.length){return aE(aI)}else{return aF(aK)}}})});aG=true;aE();return aH.unsubscribe})};u.interval=function(aA,aB){if(aB==null){aB={}}return X(new u.Desc(u,"interval",[aA,aB]),u.fromPoll(aA,function(){return al(aB)}))};u.$={};u.$.asEventStream=function(aB,aA,aC){var aD;if(I.isFunction(aA)){aD=[aA,void 0],aC=aD[0],aA=aD[1]}return X(new u.Desc(this.selector||this,"asEventStream",[aB]),u.fromBinder(function(aE){return function(aF){aE.on(aB,aA,aF);return function(){return aE.off(aB,aA,aF)}}}(this),aC))};if((G=typeof jQuery!=="undefined"&&jQuery!==null?jQuery:typeof Zepto!=="undefined"&&Zepto!==null?Zepto:void 0)!=null){G.fn.asEventStream=u.$.asEventStream}u.Observable.prototype.log=function(){var aA;aA=1<=arguments.length?m.call(arguments,0):[];this.subscribe(function(aB){return typeof console!=="undefined"&&console!==null?typeof console.log==="function"?console.log.apply(console,m.call(aA).concat([aB.log()])):void 0:void 0});return this};u.EventStream.prototype.merge=function(aA){var aB;aB=this;return X(new u.Desc(aB,"merge",[aA]),u.mergeAll(this,aA))};u.mergeAll=function(){var aA;aA=am(arguments);if(aA.length){return new k(new u.Desc(u,"mergeAll",aA),function(aE){var aC,aB,aD;aC=0;aD=function(aF){return function(aG){return aF.dispatcher.subscribe(function(aI){var aH;if(aI.isEnd()){aC++;if(aC===aA.length){return aE(O())}else{return u.more}}else{aH=aE(aI);if(aH===u.noMore){aG()}return aH}})}};aB=I.map(aD,aA);return new u.CompositeUnsubscribe(aB).unsubscribe})}else{return u.never()}};u.repeatedly=function(aC,aA){var aB;aB=0;return X(new u.Desc(u,"repeatedly",[aC,aA]),u.fromPoll(aC,function(){return aA[aB++%aA.length]}))};u.repeat=function(aB){var aA;aA=0;return u.fromBinder(function(aG){var aC,aD,aF,aH,aE;aC=false;aF=u.more;aE=function(){};aD=function(aI){if(aI.isEnd()){if(!aC){return aC=true}else{return aH()}}else{return aF=aG(aI)}};aH=function(){var aI;aC=true;while(aC&&aF!==u.noMore){aI=aB(aA++);aC=false;if(aI){aE=aI.subscribeInternal(aD)}else{aG(O())}}return aC=true};aH();return function(){return aE()}})};u.retry=function(aD){var aC,aB,aH,aF,aG,aA,aE;if(!I.isFunction(aD.source)){throw new F("'source' option has to be a function")}aE=aD.source;aA=aD.retries||0;aG=aD.maxRetries||aA;aC=aD.delay||function(){return 0};aF=aD.isRetryable||function(){return true};aH=false;aB=null;return X(new u.Desc(u,"retry",[aD]),u.repeat(function(){var aI,aJ,aK;if(aH){return null}else{aK=function(){return aE().endOnError().withHandler(function(aL){if(aL.isError()){aB=aL;if(!(aF(aB.error)&&aA>0)){aH=true;return this.push(aL)}}else{if(aL.hasValue()){aB=null;aH=true}return this.push(aL)}})};if(aB){aI={error:aB.error,retriesDone:aG-aA};aJ=u.later(aC(aI)).filter(false);aA=aA-1;return aJ.concat(u.once().flatMap(aK))}else{return aK()}}}))};u.sequentially=function(aC,aA){var aB;aB=0;return X(new u.Desc(u,"sequentially",[aC,aA]),u.fromPoll(aC,function(){var aD;aD=aA[aB++];if(aB<aA.length){return aD}else{if(aB===aA.length){return[aD,O()]}else{return O()}}}))};u.Observable.prototype.skip=function(aA){return X(new u.Desc(this,"skip",[aA]),this.withHandler(function(aB){if(!aB.hasValue()){return this.push(aB)}else{if(aA>0){aA--;return u.more}else{return this.push(aB)}}}))};u.Observable.prototype.take=function(aA){if(aA<=0){return u.never()}return X(new u.Desc(this,"take",[aA]),this.withHandler(function(aB){if(!aB.hasValue()){return this.push(aB)}else{aA--;if(aA>0){return this.push(aB)}else{if(aA===0){this.push(aB)}this.push(O());return u.noMore}}}))};u.EventStream.prototype.skipUntil=function(aB){var aA;aA=aB.take(1).map(true).toProperty(false);return X(new u.Desc(this,"skipUntil",[aB]),this.filter(aA))};u.EventStream.prototype.skipWhile=function(){var aA,aC,aB;aC=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];aB=false;return E(this,aC,aA,function(aD){return X(new u.Desc(this,"skipWhile",[aD]),this.withHandler(function(aE){if(aB||!aE.hasValue()||!aD(aE.value())){if(aE.hasValue()){aB=true}return this.push(aE)}else{return u.more}}))})};u.Observable.prototype.slidingWindow=function(aB,aA){if(aA==null){aA=0}return X(new u.Desc(this,"slidingWindow",[aB,aA]),this.scan([],function(aC,aD){return aC.concat([aD]).slice(-aB)}).filter(function(aC){return aC.length>=aA}))};u.spy=function(aA){return l.push(aA)};l=[];g=function(aD){var aB,aA,aC;if(l.length){if(!g.running){try{g.running=true;for(aB=0,aA=l.length;aB<aA;aB++){aC=l[aB];aC(aD)}}finally{delete g.running}}}return void 0};u.Property.prototype.startWith=function(aA){return X(new u.Desc(this,"startWith",[aA]),this.scan(aA,function(aC,aB){return aB}))};u.EventStream.prototype.startWith=function(aA){return X(new u.Desc(this,"startWith",[aA]),u.once(aA).concat(this))};u.Observable.prototype.takeWhile=function(){var aA,aB;aB=arguments[0],aA=2<=arguments.length?m.call(arguments,1):[];return E(this,aB,aA,function(aC){return X(new u.Desc(this,"takeWhile",[aC]),this.withHandler(function(aD){if(aD.filter(aC)){return this.push(aD)}else{this.push(O());return u.noMore}}))})};u["try"]=function(aA){return function(aB){var aC;try{return u.once(aA(aB))}catch(aD){aC=aD;return new u.Error(aC)}}};u.update=function(){var aC,aB,aA,aD;aB=arguments[0],aD=2<=arguments.length?m.call(arguments,1):[];aA=function(aE){return function(){var aF;aF=1<=arguments.length?m.call(arguments,0):[];return function(aG){return aE.apply(null,[aG].concat(aF))}}};aC=aD.length-1;while(aC>0){if(!(aD[aC] instanceof Function)){aD[aC]=function(aE){return function(){return aE}}(aD[aC])}aD[aC]=aA(aD[aC]);aC=aC-2}return X(new u.Desc(u,"update",[aB].concat(m.call(aD))),u.when.apply(u,aD).scan(aB,function(aE,aF){return aF(aE)}))};u.zipAsArray=function(){var aA;aA=am(arguments);return X(new u.Desc(u,"zipAsArray",aA),u.zipWith(aA,function(){var aB;aB=1<=arguments.length?m.call(arguments,0):[];return aB}))};u.zipWith=function(){var aB,aA,aC;aA=d(arguments),aC=aA[0],aB=aA[1];aC=I.map(function(aD){return aD.toEventStream()},aC);return X(new u.Desc(u,"zipWith",[aB].concat(m.call(aC))),u.when(aC,aB))};u.Observable.prototype.zip=function(aA,aB){if(aB==null){aB=Array}return X(new u.Desc(this,"zip",[aA]),u.zipWith([this,aA],aB))};u.Observable.prototype.first=function(){return X(new u.Desc(this,"first",[]),this.take(1))};u.Observable.prototype.last=function(){var aA;return X(new u.Desc(this,"last",[]),this.withHandler(function(aB){if(aB.isEnd()){if(aA){this.push(aA)}this.push(O());return u.noMore}else{aA=aB}}))};u.EventStream.prototype.throttle=function(aA){return X(new u.Desc(this,"throttle",[aA]),this.bufferWithTime(aA).map(function(aB){return aB[aB.length-1]}))};u.Property.prototype.throttle=function(aA){return this.delayChanges(new u.Desc(this,"throttle",[aA]),function(aB){return aB.throttle(aA)})};q.prototype.firstToPromise=function(aA){var aB=this;if(typeof aA!=="function"){if(typeof Promise==="function"){aA=Promise}else{throw new F("There isn't default Promise, use shim or parameter")}}return new aA(function(aD,aC){return aB.subscribe(function(aE){if(aE.hasValue()){aD(aE.value())}if(aE.isError()){aC(aE.error)}return u.noMore})})};q.prototype.toPromise=function(aA){return this.last().firstToPromise(aA)};if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return u});if(typeof this!=="undefined"&&this!==null){this.Bacon=u}}else{if(typeof module!=="undefined"&&module!==null&&module.exports!=null){module.exports=u;u.Bacon=u}else{this.Bacon=u}}}.call(this));