!function(root,factory){"function"==typeof define&&define.amd?define([],function(){return factory()}):"object"==typeof exports?module.exports=factory():root.whatInput=factory()}(this,function(){function bufferInput(event){clearTimeout(timer),setInput(event),buffer=!0,timer=setTimeout(function(){buffer=!1},1e3)}function immediateInput(event){buffer||setInput(event)}function setInput(event){var eventKey=key(event),eventTarget=target(event),value=inputMap[event.type];"pointer"===value&&(value=pointerType(event)),currentInput!==value&&(!formTyping&&currentInput&&"keyboard"===value&&"tab"!==keyMap[eventKey]&&formInputs.indexOf(eventTarget.nodeName.toLowerCase())>=0||(currentInput=value,body.setAttribute("data-whatinput",currentInput),-1===inputTypes.indexOf(currentInput)&&inputTypes.push(currentInput))),"keyboard"===value&&logKeys(eventKey)}function key(event){return event.keyCode?event.keyCode:event.which}function target(event){return event.target||event.srcElement}function pointerType(event){return"number"==typeof event.pointerType?pointerMap[event.pointerType]:event.pointerType}function logKeys(eventKey){-1===activeKeys.indexOf(keyMap[eventKey])&&keyMap[eventKey]&&activeKeys.push(keyMap[eventKey])}function unLogKeys(event){var eventKey=key(event),arrayPos=activeKeys.indexOf(keyMap[eventKey]);-1!==arrayPos&&activeKeys.splice(arrayPos,1)}var timer,activeKeys=[],body=document.body,buffer=!1,currentInput=null,formInputs=["input","select","textarea"],formTyping=body.hasAttribute("data-whatinput-formtyping"),inputMap={keydown:"keyboard",mousedown:"mouse",mouseenter:"mouse",touchstart:"touch",pointerdown:"pointer",MSPointerDown:"pointer"},inputTypes=[],keyMap={9:"tab",13:"enter",16:"shift",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},pointerMap={2:"touch",3:"touch",4:"mouse"};return function(){var mouseEvent="mousedown";window.PointerEvent?mouseEvent="pointerdown":window.MSPointerEvent&&(mouseEvent="MSPointerDown"),body.addEventListener(mouseEvent,immediateInput),body.addEventListener("mouseenter",immediateInput),"ontouchstart"in document.documentElement&&body.addEventListener("touchstart",bufferInput),body.addEventListener("keydown",immediateInput),body.addEventListener("keyup",unLogKeys)}(),{ask:function(){return currentInput},keys:function(){return activeKeys},types:function(){return inputTypes},set:setInput}});