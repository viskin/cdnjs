(function(b){function a(d,c){var e=this;this.$el=d.hide();this.options=c;this.$parent=b('<div class="ms-parent"></div>');this.$choice=b('<div class="ms-choice"><span class="placeholder">'+c.placeholder+"</span><div></div></div>");this.$drop=b('<div class="ms-drop"></div>');this.$el.after(this.$parent);this.$parent.append(this.$choice);this.$parent.append(this.$drop);if(this.$el.prop("disabled")){this.$choice.addClass("disabled")}this.$choice.css("width",d.width()+"px").find("span").css("width",(d.width()-20)+"px");this.$drop.css({width:d.width()+"px"});b("body").click(function(f){if(b(f.target)[0]===e.$choice[0]||b(f.target).parents(".ms-choice")[0]===e.$choice[0]){return}if(b(f.target)[0]===e.$drop[0]||b(f.target).parents(".ms-drop")[0]!==e.$drop[0]){e.close()}});if(this.options.isopen){this.open()}}a.prototype={constructor:a,init:function(){var d=this,c=["<ul>"];if(this.options.selectAll){c.push("<li>","<label>",'<input type="checkbox" name="selectAll" /> ',"["+this.options.selectAllText+"]","</label>","</li>")}b.each(this.$el.children(),function(e,f){c.push(d.optionToHtml(e,f))});c.push("</ul>");this.$drop.html(c.join(""));this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px");this.$selectAll=this.$drop.find('input[name="selectAll"]');this.$selectGroups=this.$drop.find("label.optgroup");this.$selectItems=this.$drop.find('input[name="selectItem"]');this.events()},optionToHtml:function(e,h,l){var g=this,d=b(h),f=[],n=this.options.multiple;if(d.is("option")){var k=d.val(),m=d.text();f.push("<li"+(n?' class="multiple"':"")+">","<label>",'<input type="checkbox" name="selectItem" value="'+k+'"'+(l?' data-group="'+l+'"':"")+"/> ",m,"</label>","</li>")}else{if(!l&&d.is("optgroup")){var c="group_"+e,j=d.attr("label");f.push("<li>",'<label class="optgroup" data-group="'+c+'">',j,"</label>","</li>");b.each(d.children(),function(o,p){f.push(g.optionToHtml(o,p,c))})}}return f.join("")},events:function(){var d=this,c=function(){d.$selectAll.prop("checked",d.$selectItems.length===d.$selectItems.filter(":checked").length)};this.$choice.on("click",function(){d[d.options.isopen?"close":"open"]()});this.$selectAll.on("click",function(){d.$selectItems.prop("checked",b(this).prop("checked"));d.update()});this.$selectGroups.on("click",function(){var f=b(this).attr("data-group"),e=d.$selectItems.filter('[data-group="'+f+'"]');e.prop("checked",e.length!==e.filter(":checked").length);c();d.update()});this.$selectItems.on("click",function(){c();d.update()})},open:function(){if(this.$choice.hasClass("disabled")){return}this.options.isopen=true;this.$choice.find(">div").addClass("open");this.$drop.show()},close:function(){this.options.isopen=false;this.$choice.find(">div").removeClass("open");this.$drop.hide()},update:function(){var d=this.getSelects("text"),c=this.$choice.find(">span");if(d.length){c.removeClass("placeholder").html(d.join(","))}else{c.addClass("placeholder").html(this.options.placeholder)}},getSelects:function(d){var c=[];this.$selectItems.filter(":checked").each(function(){c.push(d==="text"?b(this).parent().text():b(this).val())});return c},setSelects:function(c){var d=this;this.$selectItems.prop("checked",false);b.each(c,function(e,f){d.$selectItems.filter('[value="'+f+'"]').prop("checked",true)});this.$selectAll.prop("checked",d.$selectItems.length===this.$selectItems.filter(":checked").length);this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")}};b.fn.multipleSelect=function(){var e=arguments[0],d=arguments,f,c=["getSelects","setSelects","enable","disable"];this.each(function(){var i=b(this),h=i.data("multipleSelect"),g=b.extend({},b.fn.multipleSelect.defaults,typeof e==="object"&&e);if(!h){h=new a(i,g);i.data("multipleSelect",h)}if(typeof e==="string"){if(b.inArray(e,c)<0){throw"Unknown method: "+e}f=h[e](d[1])}else{h.init()}});return f?f:this};b.fn.multipleSelect.defaults={isopen:false,placeholder:"",selectAll:true,selectAllText:"Select all",multiple:false,multipleWidth:80}})(jQuery);