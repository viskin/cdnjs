Backbone.tabletopSync=function(method,model,options,error){if(typeof options=="function"){options={success:options,error:error}}var resp;var tabletopOptions=model.tabletop||model.collection.tabletop;var instance=tabletopOptions.instance;if(typeof instance=="undefined"){instance=Tabletop.init({key:tabletopOptions.key,wanted:[tabletopOptions.sheet],wait:true});tabletopOptions.instance=instance}else{instance.addWanted(tabletopOptions.sheet)}if(typeof tabletopOptions.sheet=="undefined"){return}var sheet=instance.sheets(tabletopOptions.sheet);if(typeof sheet==="undefined"){if(typeof instance.foundSheetNames!=="undefined"&&_.indexOf(instance.foundSheetNames,tabletopOptions.sheet)===-1){throw"Can't seem to find sheet "+tabletopOptions.sheet}instance.fetch(function(){Backbone.tabletopSync(method,model,options,error)});return}switch(method){case"read":if(model.id){resp=_.find(sheet.all(),function(item){return model.id==item[model.idAttribute]},this)}else{resp=sheet.all()}break;default:throw"Backbone.tabletopSync is read-only"}if(resp){options.success(resp)}else{options.error("Record not found")}};