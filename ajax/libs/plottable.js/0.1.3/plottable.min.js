var Utils;!function(t){function e(t,e,i){return Math.min(e,i)<=t&&t<=Math.max(e,i)}function i(t){return t.node().getBBox()}t.inRange=e,t.getBBox=i}(Utils||(Utils={}));var Component=function(){function t(){this.registeredInteractions=[],this.boxes=[],this.clipPathEnabled=!1,this.rowWeightVal=0,this.colWeightVal=0,this.rowMinimumVal=0,this.colMinimumVal=0,this.cssClasses=["component"],this.xAlignProportion=0,this.yAlignProportion=0}return t.prototype.anchor=function(t){var e=this;if(t.node().childNodes.length>0)throw new Error("Can't anchor to a non-empty element");return this.element=t,this.clipPathEnabled&&this.generateClipPath(),this.cssClasses.forEach(function(t){e.element.classed(t,!0)}),this.cssClasses=null,this.hitBox=this.addBox("hit-box"),this.addBox("bounding-box"),this.hitBox.style("fill","#ffffff").style("opacity",0),this.registeredInteractions.forEach(function(t){return t.anchor(e.hitBox)}),this},t.prototype.xAlign=function(t){if("LEFT"===t)this.xAlignProportion=0;else if("CENTER"===t)this.xAlignProportion=.5;else{if("RIGHT"!==t)throw new Error("Unsupported alignment");this.xAlignProportion=1}return this},t.prototype.yAlign=function(t){if("TOP"===t)this.yAlignProportion=0;else if("CENTER"===t)this.yAlignProportion=.5;else{if("BOTTOM"!==t)throw new Error("Unsupported alignment");this.yAlignProportion=1}return this},t.prototype.computeLayout=function(t,e,i,n){var r=this;if(null==t||null==e||null==i||null==n){if(null==this.element)throw new Error("anchor must be called before computeLayout");if("svg"!==this.element.node().nodeName)throw new Error("null arguments cannot be passed to computeLayout() on a non-root (non-<svg>) node");t=0,e=0,i=parseFloat(this.element.attr("width")),n=parseFloat(this.element.attr("height"))}return 0===this.rowWeight()&&0!==this.rowMinimum()&&(e+=(n-this.rowMinimum())*this.yAlignProportion,n=this.rowMinimum()),0===this.colWeight()&&0!==this.colMinimum()&&(t+=(i-this.colMinimum())*this.xAlignProportion,i=this.colMinimum()),this.xOffset=t,this.yOffset=e,this.availableWidth=i,this.availableHeight=n,this.element.attr("transform","translate("+this.xOffset+","+this.yOffset+")"),this.boxes.forEach(function(t){return t.attr("width",r.availableWidth).attr("height",r.availableHeight)}),this},t.prototype.render=function(){return this},t.prototype.addBox=function(t,e){if(null==this.element)throw new Error("Adding boxes before anchoring is currently disallowed");var e=null==e?this.element:e,i=e.append("rect");return null!=t&&i.classed(t,!0),this.boxes.push(i),null!=this.availableWidth&&null!=this.availableHeight&&i.attr("width",this.availableWidth).attr("height",this.availableHeight),i},t.prototype.generateClipPath=function(){var e=t.clipPathId++;this.element.attr("clip-path","url(#clipPath"+e+")");var i=this.element.append("clipPath").attr("id","clipPath"+e);this.addBox("clip-rect",i)},t.prototype.registerInteraction=function(t){this.registeredInteractions.push(t),null!=this.element&&t.anchor(this.hitBox)},t.prototype.classed=function(t,e){if(null==e)return null==this.element?-1!==this.cssClasses.indexOf(t):this.element.classed(t);if(null==this.element){var i=this.cssClasses.indexOf(t);e&&-1===i?this.cssClasses.push(t):e||-1===i||this.cssClasses.splice(i,1)}else this.element.classed(t,e);return this},t.prototype.rowWeight=function(t){return null!=t?(this.rowWeightVal=t,this):this.rowWeightVal},t.prototype.colWeight=function(t){return null!=t?(this.colWeightVal=t,this):this.colWeightVal},t.prototype.rowMinimum=function(t){return null!=t?(this.rowMinimumVal=t,this):this.rowMinimumVal},t.prototype.colMinimum=function(t){return null!=t?(this.colMinimumVal=t,this):this.colMinimumVal},t.clipPathId=0,t}(),__extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},Scale=function(){function t(t){this.broadcasterCallbacks=[],this.scale=t}return t.prototype.public=function(t){return this.scale(t)},t.prototype.domain=function(t){var e=this;return null!=t?(this.scale.domain(t),this.broadcasterCallbacks.forEach(function(t){return t(e)}),this):this.scale.domain()},t.prototype.range=function(t){return null!=t?(this.scale.range(t),this):this.scale.range()},t.prototype.copy=function(){return new t(this.scale.copy())},t.prototype.registerListener=function(t){return this.broadcasterCallbacks.push(t),this},t}(),QuantitiveScale=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.invert=function(t){return this.scale.invert(t)},e.prototype.ticks=function(t){return this.scale.ticks(t)},e.prototype.copy=function(){return new e(this.scale.copy())},e.prototype.widenDomain=function(t){var e=this.domain(),i=[Math.min(t[0],e[0]),Math.max(t[1],e[1])];return this.domain(i),this},e}(Scale),LinearScale=function(t){function e(e){t.call(this,null==e?d3.scale.linear():e),this.domain([1/0,-1/0])}return __extends(e,t),e.prototype.copy=function(){return new e(this.scale.copy())},e}(QuantitiveScale),Interaction=function(){function t(t){this.componentToListenTo=t}return t.prototype.anchor=function(t){this.hitBox=t},t.prototype.registerWithComponent=function(){this.componentToListenTo.registerInteraction(this)},t}(),PanZoomInteraction=function(t){function e(e,i,n,r){var o=this;t.call(this,e),this.xScale=n,this.yScale=r,this.zoom=d3.behavior.zoom(),this.zoom.x(this.xScale.scale),this.zoom.y(this.yScale.scale),this.zoom.on("zoom",function(){return o.rerenderZoomed()}),this.registerWithComponent()}return __extends(e,t),e.prototype.anchor=function(e){t.prototype.anchor.call(this,e),this.zoom(e)},e.prototype.rerenderZoomed=function(){var t=this.xScale.scale.domain(),e=this.yScale.scale.domain();this.xScale.domain(t),this.yScale.domain(e)},e}(Interaction),AreaInteraction=function(t){function e(e){var i=this;t.call(this,e),this.dragInitialized=!1,this.origin=[0,0],this.location=[0,0],this.dragBehavior=d3.behavior.drag(),this.dragBehavior.on("dragstart",function(){return i.dragstart()}),this.dragBehavior.on("drag",function(){return i.drag()}),this.dragBehavior.on("dragend",function(){return i.dragend()}),this.registerWithComponent()}return __extends(e,t),e.prototype.callback=function(t){return this.callbackToCall=t,this},e.prototype.dragstart=function(){this.clearBox();var t=parseFloat(this.hitBox.attr("width")),e=parseFloat(this.hitBox.attr("height")),i=function(t,e){return function(i){return Math.min(Math.max(i,t),e)}};this.constrainX=i(0,t),this.constrainY=i(0,e)},e.prototype.drag=function(){this.dragInitialized||(this.origin=[d3.event.x,d3.event.y],this.dragInitialized=!0),this.location=[this.constrainX(d3.event.x),this.constrainY(d3.event.y)];var t=Math.abs(this.origin[0]-this.location[0]),e=Math.abs(this.origin[1]-this.location[1]),i=Math.min(this.origin[0],this.location[0]),n=Math.min(this.origin[1],this.location[1]);this.dragBox.attr("x",i).attr("y",n).attr("height",e).attr("width",t)},e.prototype.dragend=function(){if(this.dragInitialized&&(this.dragInitialized=!1,null!=this.callbackToCall)){var t=Math.min(this.origin[0],this.location[0]),e=Math.max(this.origin[0],this.location[0]),i=Math.min(this.origin[1],this.location[1]),n=Math.max(this.origin[1],this.location[1]),r={xMin:t,xMax:e,yMin:i,yMax:n};this.callbackToCall(r)}},e.prototype.clearBox=function(){return this.dragBox.attr("height",0).attr("width",0),this},e.prototype.anchor=function(i){t.prototype.anchor.call(this,i);var n=e.CLASS_DRAG_BOX,r=this.componentToListenTo.element;return this.dragBox=r.append("rect").classed(n,!0).attr("x",0).attr("y",0),i.call(this.dragBehavior),this},e.CLASS_DRAG_BOX="drag-box",e}(Interaction),ZoomCallbackGenerator=function(){function t(){this.xScaleMappings=[],this.yScaleMappings=[]}return t.prototype.addXScale=function(t,e){return null==e&&(e=t),this.xScaleMappings.push([t,e]),this},t.prototype.addYScale=function(t,e){return null==e&&(e=t),this.yScaleMappings.push([t,e]),this},t.prototype.updateScale=function(t,e,i,n){var r=t.domain(),o=[t.invert(i),t.invert(n)],s=o[0]<o[1]==r[0]<r[1];s||o.reverse(),e.domain(o)},t.prototype.getCallback=function(){var t=this;return function(e){t.xScaleMappings.forEach(function(i){t.updateScale(i[0],i[1],e.xMin,e.xMax)}),t.yScaleMappings.forEach(function(i){t.updateScale(i[0],i[1],e.yMin,e.yMax)})}},t}(),Label=function(t){function e(i,n){if("undefined"==typeof i&&(i=""),"undefined"==typeof n&&(n="horizontal"),t.call(this),this.xAlignment="CENTER",this.yAlignment="CENTER",this.classed(e.CSS_CLASS,!0),this.text=i,"horizontal"!==n&&"vertical-left"!==n&&"vertical-right"!==n)throw new Error(n+" is not a valid orientation for LabelComponent");this.orientation=n}return __extends(e,t),e.prototype.anchor=function(e){return t.prototype.anchor.call(this,e),this.textElement=this.element.append("text"),this.setText(this.text),this},e.prototype.setText=function(t){this.text=t,this.textElement.text(t),this.measureAndSetTextSize(),"horizontal"===this.orientation?this.rowMinimum(this.textHeight):this.colMinimum(this.textHeight)},e.prototype.measureAndSetTextSize=function(){var t=Utils.getBBox(this.textElement);this.textHeight=t.height,this.textLength=t.width},e.prototype.truncateTextToLength=function(t){if(!(this.textLength<=t)){this.textElement.text(this.text+"...");var e=this.textElement.node(),i=e.getSubStringLength(e.textContent.length-3,3);if(i>t)return this.textElement.text(""),void this.measureAndSetTextSize();for(var n=this.text.length,r=1;n>r;r++){var o=e.getSubStringLength(0,r);if(o+i>t)return this.textElement.text(this.text.substr(0,r-1).trim()+"..."),void this.measureAndSetTextSize()}}},e.prototype.computeLayout=function(e,i,n,r){t.prototype.computeLayout.call(this,e,i,n,r),this.textElement.attr("dy",0);var o=Utils.getBBox(this.textElement);this.textElement.attr("dy",-o.y);var s=0,a=0;if("horizontal"===this.orientation)switch(this.truncateTextToLength(this.availableWidth),this.xAlignment){case"LEFT":break;case"CENTER":s=(this.availableWidth-this.textLength)/2;break;case"RIGHT":s=this.availableWidth-this.textLength;break;default:throw new Error(this.xAlignment+" is not a supported alignment")}else{switch(this.truncateTextToLength(this.availableHeight),this.yAlignment){case"TOP":break;case"CENTER":s=(this.availableHeight-this.textLength)/2;break;case"BOTTOM":s=this.availableHeight-this.textLength;break;default:throw new Error(this.yAlignment+" is not a supported alignment")}"vertical-right"===this.orientation?(this.textElement.attr("transform","rotate(90)"),a=-this.textHeight):(this.textElement.attr("transform","rotate(-90)"),s=-s-this.textLength)}return this.textElement.attr("x",s),this.textElement.attr("y",a),this},e.CSS_CLASS="label",e}(Component),TitleLabel=function(t){function e(i,n){t.call(this,i,n),this.classed(e.CSS_CLASS,!0)}return __extends(e,t),e.CSS_CLASS="title-label",e}(Label),AxisLabel=function(t){function e(i,n){t.call(this,i,n),this.classed(e.CSS_CLASS,!0)}return __extends(e,t),e.CSS_CLASS="axis-label",e}(Label),Renderer=function(t){function e(i){"undefined"==typeof i&&(i={seriesName:"",data:[]}),t.call(this),t.prototype.rowWeight.call(this,1),t.prototype.colWeight.call(this,1),this.clipPathEnabled=!0,this.dataset=i,this.classed(e.CSS_CLASS,!0)}return __extends(e,t),e.prototype.data=function(t){return this.renderArea.classed(this.dataset.seriesName,!1),this.dataset=t,this.renderArea.classed(t.seriesName,!0),this},e.prototype.anchor=function(e){return t.prototype.anchor.call(this,e),this.renderArea=e.append("g").classed("render-area",!0).classed(this.dataset.seriesName,!0),this},e.CSS_CLASS="renderer",e}(Component),XYRenderer=function(t){function e(i,n,r,o,s){var a=this;t.call(this,i),this.classed(e.CSS_CLASS),this.xAccessor=null!=o?o:e.defaultXAccessor,this.yAccessor=null!=s?s:e.defaultYAccessor,this.xScale=n,this.yScale=r;var h=i.data,c=d3.extent(h,this.xAccessor);this.xScale.widenDomain(c);var l=d3.extent(h,this.yAccessor);this.yScale.widenDomain(l),this.xScale.registerListener(function(){return a.rescale()}),this.yScale.registerListener(function(){return a.rescale()})}return __extends(e,t),e.prototype.computeLayout=function(e,i,n,r){return t.prototype.computeLayout.call(this,e,i,n,r),this.xScale.range([0,this.availableWidth]),this.yScale.range([this.availableHeight,0]),this},e.prototype.invertXYSelectionArea=function(t){var e=this.xScale.invert(t.xMin),i=this.xScale.invert(t.xMax),n=this.yScale.invert(t.yMin),r=this.yScale.invert(t.yMax),o={xMin:e,xMax:i,yMin:n,yMax:r};return o},e.prototype.getSelectionFromArea=function(t){var e=this,i=function(i){var n=e.xAccessor(i),r=e.yAccessor(i);return Utils.inRange(n,t.xMin,t.xMax)&&Utils.inRange(r,t.yMin,t.yMax)};return this.dataSelection.filter(i)},e.prototype.getDataIndicesFromArea=function(t){var e=this,i=function(i){var n=e.xAccessor(i),r=e.yAccessor(i);return Utils.inRange(n,t.xMin,t.xMax)&&Utils.inRange(r,t.yMin,t.yMax)},n=[];return this.dataset.data.forEach(function(t,e){i(t)&&n.push(e)}),n},e.prototype.rescale=function(){null!=this.element&&this.render()},e.CSS_CLASS="xy-renderer",e.defaultXAccessor=function(t){return t.x},e.defaultYAccessor=function(t){return t.y},e}(Renderer),LineRenderer=function(t){function e(i,n,r,o,s){t.call(this,i,n,r,o,s),this.classed(e.CSS_CLASS,!0)}return __extends(e,t),e.prototype.anchor=function(e){return t.prototype.anchor.call(this,e),this.path=this.renderArea.append("path"),this},e.prototype.render=function(){var e=this;return t.prototype.render.call(this),this.line=d3.svg.line().x(function(t){return e.xScale.scale(e.xAccessor(t))}).y(function(t){return e.yScale.scale(e.yAccessor(t))}),this.dataSelection=this.path.classed("line",!0).classed(this.dataset.seriesName,!0).datum(this.dataset.data),this.path.attr("d",this.line),this},e.CSS_CLASS="line-renderer",e}(XYRenderer),CircleRenderer=function(t){function e(i,n,r,o,s,a){"undefined"==typeof a&&(a=3),t.call(this,i,n,r,o,s),this.classed(e.CSS_CLASS,!0),this.size=a}return __extends(e,t),e.prototype.render=function(){var e=this;return t.prototype.render.call(this),this.dataSelection=this.renderArea.selectAll("circle").data(this.dataset.data),this.dataSelection.enter().append("circle"),this.dataSelection.attr("cx",function(t){return e.xScale.scale(e.xAccessor(t))}).attr("cy",function(t){return e.yScale.scale(e.yAccessor(t))}).attr("r",this.size),this.dataSelection.exit().remove(),this},e.CSS_CLASS="circle-renderer",e}(XYRenderer),BarRenderer=function(t){function e(i,n,r,o,s,a){t.call(this,i,n,r,o,a),this.barPaddingPx=1,this.classed(e.CSS_CLASS,!0);var h=this.yScale.domain();if(!Utils.inRange(0,h[0],h[1])){var c=0,l=h[1];this.yScale.widenDomain([c,l])}this.x2Accessor=null!=s?s:e.defaultX2Accessor;var u=d3.extent(i.data,this.x2Accessor);this.xScale.widenDomain(u)}return __extends(e,t),e.prototype.render=function(){var e=this;t.prototype.render.call(this);var i=this.yScale.range(),n=Math.max(i[0],i[1]);return this.dataSelection=this.renderArea.selectAll("rect").data(this.dataset.data),this.dataSelection.enter().append("rect"),this.dataSelection.attr("x",function(t){return e.xScale.scale(e.xAccessor(t))+e.barPaddingPx}).attr("y",function(t){return e.yScale.scale(e.yAccessor(t))}).attr("width",function(t){return e.xScale.scale(e.x2Accessor(t))-e.xScale.scale(e.xAccessor(t))-2*e.barPaddingPx}).attr("height",function(t){return n-e.yScale.scale(e.yAccessor(t))}),this.dataSelection.exit().remove(),this},e.CSS_CLASS="bar-renderer",e.defaultX2Accessor=function(t){return t.x2},e}(XYRenderer),Table=function(t){function e(i,n,r){"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1),t.call(this),this.rowPadding=0,this.colPadding=0,this.classed(e.CSS_CLASS,!0);var o=function(t){return null==t?new Component:t};i=i.map(function(t){return t.map(o)}),this.rows=i,this.cols=d3.transpose(i),this.nRows=this.rows.length,this.nCols=this.cols.length,t.prototype.rowWeight.call(this,n).colWeight(r)}return __extends(e,t),e.prototype.anchor=function(e){var i=this;return t.prototype.anchor.call(this,e),this.rows.forEach(function(t){t.forEach(function(t){t.anchor(i.element.append("g"))})}),this},e.prototype.computeLayout=function(i,n,r,o){var s=this;t.prototype.computeLayout.call(this,i,n,r,o);var a=this.availableWidth-this.colMinimum(),h=this.availableHeight-this.rowMinimum();if(0>a||0>h)throw new Error("InsufficientSpaceError");var c=e.rowProportionalSpace(this.rows,h),l=e.colProportionalSpace(this.cols,a),u=function(t){return t[0]+t[1]},p=d3.zip(c,this.rowMinimums).map(u),d=d3.zip(l,this.colMinimums).map(u),f=0;return this.rows.forEach(function(t,e){var i=0;t.forEach(function(t,n){t.computeLayout(i,f,d[n],p[e]),i+=d[n]+s.colPadding}),f+=p[e]+s.rowPadding}),this},e.rowProportionalSpace=function(t,i){return e.calculateProportionalSpace(t,i,function(t){return t.rowWeight()})},e.colProportionalSpace=function(t,i){return e.calculateProportionalSpace(t,i,function(t){return t.colWeight()})},e.calculateProportionalSpace=function(t,e,i){var n=t.map(function(t){return d3.max(t,i)}),r=d3.sum(n);if(0===r){var o=t.length;return n.map(function(){return e/o})}return n.map(function(t){return e*t/r})},e.prototype.render=function(){return this.rows.forEach(function(t){t.forEach(function(t){t.render()})}),this},e.prototype.rowMinimum=function(t){if(null!=t)throw new Error("Row minimum cannot be directly set on Table");return this.rowMinimums=this.rows.map(function(t){return d3.max(t,function(t){return t.rowMinimum()})}),d3.sum(this.rowMinimums)+this.rowPadding*(this.rows.length-1)},e.prototype.colMinimum=function(t){if(null!=t)throw new Error("Col minimum cannot be directly set on Table");return this.colMinimums=this.cols.map(function(t){return d3.max(t,function(t){return t.colMinimum()})}),d3.sum(this.colMinimums)+this.colPadding*(this.cols.length-1)},e.prototype.padding=function(t,e){return this.rowPadding=t,this.colPadding=e,this},e.CSS_CLASS="table",e}(Component),ScaleDomainCoordinator=function(){function t(t){var e=this;this.scales=t,this.rescaleInProgress=!1,this.scales.forEach(function(t){return t.registerListener(function(t){return e.rescale(t)})})}return t.prototype.rescale=function(t){if(!this.rescaleInProgress){this.rescaleInProgress=!0;var e=t.domain();this.scales.forEach(function(t){return t.domain(e)}),this.rescaleInProgress=!1}},t}(),Axis=function(t){function e(i,n,r){var o=this;t.call(this),this.scale=i,this.orientation=n,this.formatter=r,this.classed(e.CSS_CLASS,!0),this.clipPathEnabled=!0,this.isXAligned="bottom"===this.orientation||"top"===this.orientation,this.d3axis=d3.svg.axis().scale(this.scale.scale).orient(this.orientation),null==this.formatter&&(this.formatter=d3.format(".3s")),this.d3axis.tickFormat(this.formatter),this.cachedScale=1,this.cachedTranslate=0,this.scale.registerListener(function(){return o.rescale()})}return __extends(e,t),e.axisXTransform=function(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})},e.axisYTransform=function(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})},e.prototype.anchor=function(e){return t.prototype.anchor.call(this,e),this.axisElement=this.element.append("g").classed("axis",!0),this},e.prototype.transformString=function(t){var e=this.isXAligned?""+t:"0,"+t;return"translate("+e+")"},e.prototype.render=function(){"left"===this.orientation&&this.axisElement.attr("transform","translate("+e.yWidth+", 0)"),"top"===this.orientation&&this.axisElement.attr("transform","translate(0,"+e.xHeight+")");var t,i=this.scale.domain(),n=Math.abs(i[1]-i[0]),r=+d3.min(i),o=+d3.max(i),s=i[0]<i[1];if(t="number"==typeof i[0]?s?[r-n,o+n]:[o+n,r-n]:s?[new Date(r-n),new Date(o+n)]:[new Date(o+n),new Date(r-n)],null!=this.scale.ticks){var a=this.scale,h=10,c=a.ticks(h),l=a.domain(),u=l[1]-l[0],p=function(t){return Math.abs(t/u/h)<1e-4?0:t};c=c.map(p),this.d3axis.tickValues(c)}this.axisElement.call(this.d3axis);var d=this.axisElement.node().getBBox();return(d.height>this.availableHeight||d.width>this.availableWidth)&&this.axisElement.classed("error",!0),this},e.prototype.rescale=function(){return null!=this.element?this.render():null},e.prototype.zoom=function(){return this.render()},e.CSS_CLASS="axis",e.yWidth=50,e.xHeight=30,e}(Component),XAxis=function(t){function e(e,i,n){"undefined"==typeof n&&(n=null),t.call(this,e,i,n),t.prototype.rowMinimum.call(this,Axis.xHeight)}return __extends(e,t),e}(Axis),YAxis=function(t){function e(e,i,n){"undefined"==typeof n&&(n=null),t.call(this,e,i,n),t.prototype.colMinimum.call(this,Axis.yWidth)}return __extends(e,t),e}(Axis),ComponentGroup=function(t){function e(e){t.call(this),this.components=e}return __extends(e,t),e.prototype.anchor=function(e){var i=this;return t.prototype.anchor.call(this,e),this.components.forEach(function(t){return t.anchor(i.element.append("g"))}),this},e.prototype.computeLayout=function(e,i,n,r){var o=this;return t.prototype.computeLayout.call(this,e,i,n,r),this.components.forEach(function(t){t.computeLayout(o.xOffset,o.yOffset,o.availableWidth,o.availableHeight)}),this},e.prototype.render=function(){return t.prototype.render.call(this),this.components.forEach(function(t){return t.render()}),this},e}(Component);