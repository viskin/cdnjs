/*! JointJS v0.9.3 - JavaScript diagramming library  2015-07-23 


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(a,b){if(typeof define==="function"&&define.amd){define("g",[],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.g=b()}}}(this,function(){var f=Math;var m=f.abs;var d=f.cos;var a=f.sin;var w=f.sqrt;var u=f.min;var x=f.max;var g=f.atan;var e=f.atan2;var l=f.acos;var r=f.round;var q=f.floor;var o=f.PI;var b=f.random;var s=function(y){return(180*y/o)%360};var h=function(y,z){z=z||false;y=z?y:(y%360);return y*o/180};var n=function(z,y){return y*Math.round(z/y)};var k=function(y){return(y%360)+(y<0?360:0)};function p(z,B){if(!(this instanceof p)){return new p(z,B)}var A;if(B===undefined&&Object(z)!==z){A=z.split(z.indexOf("@")===-1?" ":"@");this.x=parseInt(A[0],10);this.y=parseInt(A[1],10)}else{if(Object(z)===z){this.x=z.x;this.y=z.y}else{this.x=z;this.y=B}}}p.prototype={toString:function(){return this.x+"@"+this.y},adhereToRect:function(y){if(y.containsPoint(this)){return this}this.x=u(x(this.x,y.x),y.x+y.width);this.y=u(x(this.y,y.y),y.y+y.height);return this},theta:function(C){C=p(C);var D=-(C.y-this.y);var A=C.x-this.x;var B=10;var z=(D.toFixed(B)==0&&A.toFixed(B)==0)?0:e(D,A);if(z<0){z=2*o+z}return 180*z/o},distance:function(y){return i(this,y).length()},manhattanDistance:function(y){return m(y.x-this.x)+m(y.y-this.y)},offset:function(z,y){this.x+=z||0;this.y+=y||0;return this},magnitude:function(){return w((this.x*this.x)+(this.y*this.y))||0.01},update:function(z,A){this.x=z||0;this.y=A||0;return this},round:function(y){this.x=y?this.x.toFixed(y):r(this.x);this.y=y?this.y.toFixed(y):r(this.y);return this},normalize:function(y){var z=(y||1)/this.magnitude();this.x=z*this.x;this.y=z*this.y;return this},difference:function(y){return p(this.x-y.x,this.y-y.y)},bearing:function(y){return i(this,y).bearing()},toPolar:function(A){A=(A&&p(A))||p(0,0);var z=this.x;var B=this.y;this.x=w((z-A.x)*(z-A.x)+(B-A.y)*(B-A.y));this.y=h(A.theta(p(z,B)));return this},rotate:function(A,z){z=(z+360)%360;this.toPolar(A);this.y+=h(z);var y=p.fromPolar(this.x,this.y,A);this.x=y.x;this.y=y.y;return this},move:function(z,A){var y=h(p(z).theta(this));return this.offset(d(y)*A,-a(y)*A)},changeInAngle:function(z,y,A){return p(this).offset(-z,-y).theta(A)-this.theta(A)},equals:function(y){return this.x===y.x&&this.y===y.y},snapToGrid:function(z,y){this.x=n(this.x,z);this.y=n(this.y,y||z);return this},reflection:function(y){return p(y).move(this,this.distance(y))}};p.fromPolar=function(B,D,C){C=(C&&p(C))||p(0,0);var z=m(B*d(D));var E=m(B*a(D));var A=k(s(D));if(A<90){E=-E}else{if(A<180){z=-z;E=-E}else{if(A<270){z=-z}}}return p(C.x+z,C.y+E)};p.random=function(z,y,B,A){return p(q(b()*(y-z+1)+z),q(b()*(A-B+1)+B))};function i(z,y){if(!(this instanceof i)){return new i(z,y)}this.start=p(z);this.end=p(y)}i.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return w(this.squaredLength())},squaredLength:function(){var z=this.start.x;var B=this.start.y;var y=this.end.x;var A=this.end.y;return(z-=y)*z+(B-=A)*B},midpoint:function(){return p((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(y){var E=p(this.end.x-this.start.x,this.end.y-this.start.y);var B=p(y.end.x-y.start.x,y.end.y-y.start.y);var z=(E.x*B.y)-(E.y*B.x);var A=p(y.start.x-this.start.x,y.start.y-this.start.y);var D=(A.x*B.y)-(A.y*B.x);var C=(A.x*E.y)-(A.y*E.x);if(z===0||D*z<0||C*z<0){return null}if(z>0){if(D>z||C>z){return null}}else{if(D<z||C<z){return null}}return p(this.start.x+(D*E.x/z),this.start.y+(D*E.y/z))},bearing:function(){var B=h(this.start.y);var A=h(this.end.y);var F=this.start.x;var D=this.end.x;var z=h(D-F);var H=a(z)*d(A);var I=d(B)*a(A)-a(B)*d(A)*d(z);var C=s(e(H,I));var G=["NE","E","SE","S","SW","W","NW","N"];var E=C-22.5;if(E<0){E+=360}E=parseInt(E/45);return G[E]},pointAt:function(A){var z=(1-A)*this.start.x+A*this.end.x;var B=(1-A)*this.start.y+A*this.end.y;return p(z,B)},pointOffset:function(y){return((this.end.x-this.start.x)*(y.y-this.start.y)-(this.end.y-this.start.y)*(y.x-this.start.x))/2}};function c(z,C,A,B){if(!(this instanceof c)){return new c(z,C,A,B)}if(C===undefined){C=z.y;A=z.width;B=z.height;z=z.x}this.x=z;this.y=C;this.width=A;this.height=B}c.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},origin:function(){return p(this.x,this.y)},corner:function(){return p(this.x+this.width,this.y+this.height)},topRight:function(){return p(this.x+this.width,this.y)},bottomLeft:function(){return p(this.x,this.y+this.height)},center:function(){return p(this.x+this.width/2,this.y+this.height/2)},intersect:function(A){var z=this.origin();var C=this.corner();var y=A.origin();var B=A.corner();if(B.x<=z.x||B.y<=z.y||y.x>=C.x||y.y>=C.y){return false}return true},sideNearestToPoint:function(E){E=p(E);var z=E.x-this.x;var D=(this.x+this.width)-E.x;var B=E.y-this.y;var y=(this.y+this.height)-E.y;var C=z;var A="left";if(D<C){C=D;A="right"}if(B<C){C=B;A="top"}if(y<C){C=y;A="bottom"}return A},containsPoint:function(y){y=p(y);if(y.x>=this.x&&y.x<=this.x+this.width&&y.y>=this.y&&y.y<=this.y+this.height){return true}return false},containsRect:function(z){var G=c(z).normalize();var C=G.width;var J=G.height;var B=G.x;var A=G.y;var I=this.width;var D=this.height;if((I|D|C|J)<0){return false}var F=this.x;var E=this.y;if(B<F||A<E){return false}I+=F;C+=B;if(C<=B){if(I>=F||C>I){return false}}else{if(I>=F&&C>I){return false}}D+=E;J+=A;if(J<=A){if(D>=E||J>D){return false}}else{if(D>=E&&J>D){return false}}return true},pointNearestToPoint:function(z){z=p(z);if(this.containsPoint(z)){var y=this.sideNearestToPoint(z);switch(y){case"right":return p(this.x+this.width,z.y);case"left":return p(this.x,z.y);case"bottom":return p(z.x,this.y+this.height);case"top":return p(z.x,this.y)}}return z.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(D,E){D=p(D);var z=p(this.x+this.width/2,this.y+this.height/2);var y;if(E){D.rotate(z,E)}var C=[i(this.origin(),this.topRight()),i(this.topRight(),this.corner()),i(this.corner(),this.bottomLeft()),i(this.bottomLeft(),this.origin())];var A=i(z,D);for(var B=C.length-1;B>=0;--B){var F=C[B].intersection(A);if(F!==null){y=F;break}}if(y&&E){y.rotate(z,-E)}return y},moveAndExpand:function(y){this.x+=y.x||0;this.y+=y.y||0;this.width+=y.width||0;this.height+=y.height||0;return this},round:function(y){this.x=y?this.x.toFixed(y):r(this.x);this.y=y?this.y.toFixed(y):r(this.y);this.width=y?this.width.toFixed(y):r(this.width);this.height=y?this.height.toFixed(y):r(this.height);return this},normalize:function(){var B=this.x;var A=this.y;var y=this.width;var z=this.height;if(this.width<0){B=this.x+this.width;y=-this.width}if(this.height<0){A=this.y+this.height;z=-this.height}this.x=B;this.y=A;this.width=y;this.height=z;return this},bbox:function(D){var B=h(D||0);var z=m(a(B));var A=m(d(B));var y=this.width*A+this.height*z;var C=this.width*z+this.height*A;return c(this.x+(this.width-y)/2,this.y+(this.height-C)/2,y,C)}};function t(A,z,y){if(!(this instanceof t)){return new t(A,z,y)}A=p(A);this.x=A.x;this.y=A.y;this.a=z;this.b=y}t.prototype={toString:function(){return p(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return c(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},intersectionWithLineFromCenterToPoint:function(A,C){A=p(A);if(C){A.rotate(p(this.x,this.y),C)}var I=A.x-this.x;var G=A.y-this.y;var J;if(I===0){J=this.bbox().pointNearestToPoint(A);if(C){return J.rotate(p(this.x,this.y),-C)}return J}var B=G/I;var H=B*B;var z=this.a*this.a;var F=this.b*this.b;var E=w(1/((1/z)+(H/F)));E=I<0?-E:E;var D=B*E;J=p(this.x+E,this.y+D);if(C){return J.rotate(p(this.x,this.y),-C)}return J}};var j={curveThroughPoints:function(A){var y=this.getCurveControlPoints(A);var B=["M",A[0].x,A[0].y];for(var z=0;z<y[0].length;z++){B.push("C",y[0][z].x,y[0][z].y,y[1][z].x,y[1][z].y,A[z+1].x,A[z+1].y)}return B},getCurveControlPoints:function(C){var A=[];var G=[];var F=C.length-1;var B;if(F==1){A[0]=p((2*C[0].x+C[1].x)/3,(2*C[0].y+C[1].y)/3);G[0]=p(2*A[0].x-C[0].x,2*A[0].y-C[0].y);return[A,G]}var E=[];for(B=1;B<F-1;B++){E[B]=4*C[B].x+2*C[B+1].x}E[0]=C[0].x+2*C[1].x;E[F-1]=(8*C[F-1].x+C[F].x)/2;var z=this.getFirstControlPoints(E);for(B=1;B<F-1;++B){E[B]=4*C[B].y+2*C[B+1].y}E[0]=C[0].y+2*C[1].y;E[F-1]=(8*C[F-1].y+C[F].y)/2;var D=this.getFirstControlPoints(E);for(B=0;B<F;B++){A.push(p(z[B],D[B]));if(B<F-1){G.push(p(2*C[B+1].x-z[B+1],2*C[B+1].y-D[B+1]))}else{G.push(p((C[F].x+z[F-1])/2,(C[F].y+D[F-1])/2))}}return[A,G]},getFirstControlPoints:function(D){var C=D.length;var z=[];var B=[];var y=2;z[0]=D[0]/y;for(var A=1;A<C;A++){B[A]=1/y;y=(A<C-1?4:3.5)-B[A];z[A]=(D[A]-z[A-1])/y}for(A=1;A<C;A++){z[C-A-1]-=B[C-A]*z[C-A]}return z},getInversionSolver:function(E,D,B,A){var C=arguments;function y(G,F){var I=C[G];var H=C[F];return function(L){var K=(G%3?3:1)*(F%3?3:1);var J=L.x*(I.y-H.y)+L.y*(H.x-I.x)+I.x*H.y-I.y*H.x;return K*J}}return function z(K){var G=3*y(2,3)(D);var H=y(1,3)(E)/G;var F=-y(2,3)(E)/G;var J=H*y(3,1)(K)+F*(y(3,0)(K)+y(2,1)(K))+y(2,0)(K);var I=H*y(3,0)(K)+F*y(2,0)(K)+y(1,0)(K);return I/(I-J)}},getCurveDivider:function(C,B,A,z){return function y(F){var E=i(C,B).pointAt(F);var D=i(B,A).pointAt(F);var J=i(A,z).pointAt(F);var I=i(E,D).pointAt(F);var H=i(D,J).pointAt(F);var G=i(I,H).pointAt(F);return[{p0:C,p1:E,p2:I,p3:G},{p0:G,p1:H,p2:J,p3:z}]}}};var v={linear:function(B,y,A){var z=B[1]-B[0];var C=y[1]-y[0];return(((A-B[0])/z)*C+y[0])||0}};return{toDeg:s,toRad:h,snapToGrid:n,normalizeAngle:k,point:p,line:i,rect:c,ellipse:t,bezier:j,scale:v}}));