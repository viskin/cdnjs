/*! JointJS v0.9.3 - JavaScript diagramming library  2015-07-23 


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(a,b){if(typeof define==="function"&&define.amd){define("V",["g"],function(d){return b(d)})}else{if(typeof exports==="object"){var c=require("./geometry");module.exports=b(c)}else{var c=a.g;a.Vectorizer=a.V=b(c)}}}(this,function(y){var i=typeof window==="object"&&!!(window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));if(!i){return function(){}}var z={xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var a="1.1";var m=0;function p(){var g=++m+"";return"v-"+g}function n(g){return Object(g)===Object(g)}function s(g){return Object.prototype.toString.call(g)=="[object Array]"}function c(A){var g='<svg xmlns="'+z.xmlns+'" xmlns:xlink="'+z.xlink+'" version="'+a+'">'+(A||"")+"</svg>";var B=new DOMParser();B.async=false;return B.parseFromString(g,"text/xml").documentElement}function v(B,H,C){var D,E;if(!B){return undefined}if(typeof B==="object"){return new e(B)}H=H||{};if(B.toLowerCase()==="svg"){return new e(c())}else{if(B[0]==="<"){var I=c(B);if(I.childNodes.length>1){var F=[];for(D=0,E=I.childNodes.length;D<E;D++){var g=I.childNodes[D];F.push(new e(document.importNode(g,true)))}return F}return new e(document.importNode(I.firstChild,true))}}B=document.createElementNS(z.xmlns,B);for(var G in H){x(B,G,H[G])}if(Object.prototype.toString.call(C)!="[object Array]"){C=[C]}for(D=0,E=(C[0]&&C.length)||0;D<E;D++){var A=C[D];B.appendChild(A instanceof e?A.node:A)}return new e(B)}function x(B,A,C){if(A.indexOf(":")>-1){var g=A.split(":");B.setAttributeNS(z[g[0]],g[1],C)}else{if(A==="id"){B.id=C}else{B.setAttribute(A,C)}}}function j(g){var A,D,B;if(g){var E=/[ ,]+/;var H=g.match(/translate\((.*)\)/);if(H){A=H[1].split(E)}var F=g.match(/rotate\((.*)\)/);if(F){D=F[1].split(E)}var C=g.match(/scale\((.*)\)/);if(C){B=C[1].split(E)}}var G=(B&&B[0])?parseFloat(B[0]):1;return{translate:{tx:(A&&A[0])?parseInt(A[0],10):0,ty:(A&&A[1])?parseInt(A[1],10):0},rotate:{angle:(D&&D[0])?parseInt(D[0],10):0,cx:(D&&D[1])?parseInt(D[1],10):undefined,cy:(D&&D[2])?parseInt(D[2],10):undefined},scale:{sx:G,sy:(B&&B[1])?parseFloat(B[1]):G}}}function o(C,g){var B=g.x*C.a+g.y*C.c+0;var A=g.x*C.b+g.y*C.d+0;return{x:B,y:A}}function l(g){var D=o(g,{x:0,y:1});var B=o(g,{x:1,y:0});var C=((180/Math.PI)*Math.atan2(D.y,D.x)-90);var A=((180/Math.PI)*Math.atan2(B.y,B.x));return{translateX:g.e,translateY:g.f,scaleX:Math.sqrt(g.a*g.a+g.b*g.b),scaleY:Math.sqrt(g.c*g.c+g.d*g.d),skewX:C,skewY:A,rotation:C}}function e(g){if(g instanceof e){g=g.node}this.node=g;if(!this.node.id){this.node.id=p()}}e.prototype={translate:function(B,g,F){F=F||{};g=g||0;var A=this.attr("transform")||"";var C=j(A);if(typeof B==="undefined"){return C.translate}A=A.replace(/translate\([^\)]*\)/g,"").trim();var G=F.absolute?B:C.translate.tx+B;var E=F.absolute?g:C.translate.ty+g;var D="translate("+G+","+E+")";this.attr("transform",(D+" "+A).trim());return this},rotate:function(D,E,C,g){g=g||{};var B=this.attr("transform")||"";var A=j(B);if(typeof D==="undefined"){return A.rotate}B=B.replace(/rotate\([^\)]*\)/g,"").trim();D%=360;var G=g.absolute?D:A.rotate.angle+D;var H=(E!==undefined&&C!==undefined)?","+E+","+C:"";var F="rotate("+G+H+")";this.attr("transform",(B+" "+F).trim());return this},scale:function(D,B){B=(typeof B==="undefined")?D:B;var g=this.attr("transform")||"";var A=j(g);if(typeof D==="undefined"){return A.scale}g=g.replace(/scale\([^\)]*\)/g,"").trim();var C="scale("+D+","+B+")";this.attr("transform",(g+" "+C).trim());return this},bbox:function(B,D){if(!this.node.ownerSVGElement){return{x:0,y:0,width:0,height:0}}var A;try{A=this.node.getBBox();A={x:A.x|0,y:A.y|0,width:A.width|0,height:A.height|0}}catch(C){A={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(B){return A}var g=this.node.getTransformToElement(D||this.node.ownerSVGElement);return f.transformRect(A,g)},text:function(P,B){B=B||{};var A=P.split("\n");var R=0;var H;var I=this.attr("y");if(!I){this.attr("y","0.8em")}this.attr("display",P?null:"none");this.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");this.node.textContent="";var O=this.node;if(B.textPath){var g=this.find("defs");if(g.length===0){g=v("defs");this.append(g)}var S=Object(B.textPath)===B.textPath?B.textPath.d:B.textPath;if(S){var N=v("path",{d:S});g.append(N)}var M=v("textPath");if(!B.textPath["xlink:href"]&&N){M.attr("xlink:href","#"+N.node.id)}if(Object(B.textPath)===B.textPath){M.attr(B.textPath)}this.append(M);O=M.node}var G=0;for(var R=0;R<A.length;R++){var J=A[R];var E=B.lineHeight||"1em";if(B.lineHeight==="auto"){E="1.5em"}var L=f("tspan",{dy:(R==0?"0em":E),x:this.attr("x")||0});L.addClass("v-line");if(J){if(B.annotations){var K=0;var C=f.annotateString(A[R],s(B.annotations)?B.annotations:[B.annotations],{offset:-G,includeAnnotationIndices:B.includeAnnotationIndices});for(var Q=0;Q<C.length;Q++){var F=C[Q];if(n(F)){var D=parseInt(F.attrs["font-size"],10);if(D&&D>K){K=D}H=f("tspan",F.attrs);if(B.includeAnnotationIndices){H.attr("annotations",F.annotations)}if(F.attrs["class"]){H.addClass(F.attrs["class"])}H.node.textContent=F.t}else{H=document.createTextNode(F||" ")}L.append(H)}if(B.lineHeight==="auto"&&K&&R!==0){L.attr("dy",(K*1.2)+"px")}}else{L.node.textContent=J}}else{L.addClass("v-empty-line");L.node.textContent=" "}f(O).append(L);G+=J.length+1}return this},attr:function(B,E){if(typeof B==="undefined"){var g=this.node.attributes;var A={};for(var D=0;D<g.length;D++){A[g[D].nodeName]=g[D].nodeValue}return A}if(typeof B==="string"&&typeof E==="undefined"){return this.node.getAttribute(B)}if(typeof B==="object"){for(var C in B){if(B.hasOwnProperty(C)){x(this.node,C,B[C])}}}else{x(this.node,B,E)}return this},remove:function(){if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}},append:function(C){var B=C;if(Object.prototype.toString.call(C)!=="[object Array]"){B=[C]}for(var A=0,g=B.length;A<g;A++){C=B[A];this.node.appendChild(C instanceof e?C.node:C)}return this},prepend:function(g){this.node.insertBefore(g instanceof e?g.node:g,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:f(this.node.ownerSVGElement)},defs:function(){var g=this.svg().node.getElementsByTagName("defs");return(g&&g.length)?f(g[0]):undefined},clone:function(){var g=f(this.node.cloneNode(true));g.node.id=p();return g},findOne:function(g){var A=this.node.querySelector(g);return A?f(A):undefined},find:function(A){var B=this.node.querySelectorAll(A);for(var C=0,g=B.length;C<g;C++){B[C]=f(B[C])}return B},index:function(){var g=0;var A=this.node.previousSibling;while(A){if(A.nodeType===1){g++}A=A.previousSibling}return g},findParentByClass:function(A,g){g=g||this.node.ownerSVGElement;var B=this.node.parentNode;while(B&&B!==g){if(f(B).hasClass(A)){return f(B)}B=B.parentNode}return null},toLocalPoint:function(A,F){var B=this.svg().node;var E=B.createSVGPoint();E.x=A;E.y=F;try{var D=E.matrixTransform(B.getScreenCTM().inverse());var g=this.node.getTransformToElement(B).inverse()}catch(C){return E}return D.matrixTransform(g)},translateCenterToPoint:function(A){var B=this.bbox();var g=y.rect(B).center();this.translate(A.x-g.x,A.y-g.y)},translateAndAutoOrient:function(H,D,I){var M=this.scale();this.attr("transform","");this.scale(M.sx,M.sy);var G=this.svg().node;var K=this.bbox(false,I);var F=G.createSVGTransform();F.setTranslate(-K.x-K.width/2,-K.y-K.height/2);var B=G.createSVGTransform();var C=y.point(H).changeInAngle(H.x-D.x,H.y-D.y,D);B.setRotate(C,0,0);var J=G.createSVGTransform();var L=y.point(H).move(D,K.width/2);J.setTranslate(H.x+(H.x-L.x),H.y+(H.y-L.y));var E=this.node.getTransformToElement(I);var A=G.createSVGTransform();A.setMatrix(J.matrix.multiply(B.matrix.multiply(F.matrix.multiply(E))));var g=l(A.matrix);this.translate(g.translateX,g.translateY);this.rotate(g.rotation);return this},animateAlongPath:function(J,K){var F=f("animateMotion",J);var D=f("mpath",{"xlink:href":"#"+f(K).node.id});F.append(D);this.append(F);try{F.node.beginElement()}catch(I){if(document.documentElement.getAttribute("smiling")==="fake"){var B=F.node;B.animators=[];var A=B.getAttribute("id");if(A){id2anim[A]=B}var G=getTargets(B);for(var C=0,E=G.length;C<E;C++){var H=G[C];var g=new Animator(B,H,C);animators.push(g);B.animators[C]=g;g.register()}}}},hasClass:function(g){return new RegExp("(\\s|^)"+g+"(\\s|$)").test(this.node.getAttribute("class"))},addClass:function(A){if(!this.hasClass(A)){var g=this.node.getAttribute("class")||"";this.node.setAttribute("class",(g+" "+A).trim())}return this},removeClass:function(g){if(this.hasClass(g)){var A=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+g+"(\\s|$)","g"),"$2");this.node.setAttribute("class",A)}return this},toggleClass:function(B,g){var A=typeof g==="undefined"?this.hasClass(B):!g;if(A){this.removeClass(B)}else{this.addClass(B)}return this},sample:function(g){g=g||1;var D=this.node;var C=D.getTotalLength();var A=[];var E=0;var B;while(E<C){B=D.getPointAtLength(E);A.push({x:B.x,y:B.y,distance:E});E+=g}return A},convertToPath:function(){var g=v("path");g.attr(this.attr());var A=this.convertToPathData();if(A){g.attr("d",A)}return g},convertToPathData:function(){var g=this.node.tagName.toUpperCase();switch(g){case"PATH":return this.attr("d");case"LINE":return k(this.node);case"POLYGON":return w(this.node);case"POLYLINE":return r(this.node);case"ELLIPSE":return q(this.node);case"CIRCLE":return u(this.node);case"RECT":return b(this.node)}throw new Error(g+" cannot be converted to PATH.")},findIntersection:function(E,V){var M=this.svg().node;V=V||M;var g=y.rect(this.bbox(false,V));var T=g.center();var G=g.intersectionWithLineFromCenterToPoint(E);if(!G){return undefined}var C=this.node.localName.toUpperCase();if(C==="RECT"){var S=y.rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height")));var R=this.node.getTransformToElement(V);var F=f.decomposeMatrix(R);var H=M.createSVGTransform();H.setRotate(-F.rotation,T.x,T.y);var B=f.transformRect(S,H.matrix.multiply(R));G=y.rect(B).intersectionWithLineFromCenterToPoint(E,F.rotation)}else{if(C==="PATH"||C==="POLYGON"||C==="POLYLINE"||C==="CIRCLE"||C==="ELLIPSE"){var I=(C==="PATH")?this:this.convertToPath();var K=I.sample();var J=Infinity;var L=[];for(var O=0,Q=K.length;O<Q;O++){var P=K[O];var N=f.createSVGPoint(P.x,P.y);N=N.matrixTransform(this.node.getTransformToElement(V));P=y.point(N);var A=P.distance(T);var U=P.distance(E)*1.1;var D=A+U;if(D<J){J=D;L=[{sample:P,refDistance:U}]}else{if(D<J+1){L.push({sample:P,refDistance:U})}}}L.sort(function(X,W){return X.refDistance-W.refDistance});G=L[0].sample}}return G}};function k(g){g=v(g);var A=["M",g.attr("x1"),g.attr("y1"),"L",g.attr("x2"),g.attr("y2")].join(" ");return A}function w(A){A=v(A);var B=A.node.points;var D=[];var C;for(var g=0;g<B.length;g++){C=B[g];D.push(g===0?"M":"L",C.x,C.y)}D.push("Z");return D.join(" ")}function r(g){g=v(g);var B=g.node.points;var D=[];var C;for(var A=0;A<B.length;A++){C=B[A];D.push(A===0?"M":"L",C.x,C.y)}return D.join(" ")}var d=0.5522847498307935;function u(B){B=v(B);var g=parseFloat(B.attr("cx"))||0;var E=parseFloat(B.attr("cy"))||0;var A=parseFloat(B.attr("r"));var D=A*d;var C=["M",g,E-A,"C",g+D,E-A,g+A,E-D,g+A,E,"C",g+A,E+D,g+D,E+A,g,E+A,"C",g-D,E+A,g-A,E+D,g-A,E,"C",g-A,E-D,g-D,E-A,g,E-A,"Z"].join(" ");return C}function q(C){C=v(C);var g=parseFloat(C.attr("cx"))||0;var G=parseFloat(C.attr("cy"))||0;var E=parseFloat(C.attr("rx"));var D=parseFloat(C.attr("ry"))||E;var B=E*d;var A=D*d;var F=["M",g,G-D,"C",g+B,G-D,g+E,G-A,g+E,G,"C",g+E,G+A,g+B,G+D,g,G+D,"C",g-B,G+D,g-E,G+A,g-E,G,"C",g-E,G-A,g-B,G-D,g,G-D,"Z"].join(" ");return F}function b(G){G=v(G);var H=parseFloat(G.attr("x"))||0;var F=parseFloat(G.attr("y"))||0;var C=parseFloat(G.attr("width"))||0;var J=parseFloat(G.attr("height"))||0;var B=parseFloat(G.attr("rx"))||0;var A=parseFloat(G.attr("ry"))||0;var I=y.rect(H,F,C,J);var D;if(!B&&!A){D=["M",I.origin().x,I.origin().y,"H",I.corner().x,"V",I.corner().y,"H",I.origin().x,"V",I.origin().y,"Z"].join(" ")}else{var g=H+C;var E=F+J;D=["M",H+B,F,"L",g-B,F,"Q",g,F,g,F+A,"L",g,F+J-A,"Q",g,E,g-B,E,"L",H+B,E,"Q",H,E,H,E-B,"L",H,F+A,"Q",H,F,H+B,F,"Z"].join(" ")}return D}function h(D){var C=D.rx||D["top-rx"]||0;var B=D.rx||D["bottom-rx"]||0;var A=D.ry||D["top-ry"]||0;var g=D.ry||D["bottom-ry"]||0;return["M",D.x,D.y+A,"v",D.height-A-g,"a",B,g,0,0,0,B,g,"h",D.width-2*B,"a",B,g,0,0,0,B,-g,"v",-(D.height-g-A),"a",C,A,0,0,0,-C,-A,"h",-(D.width-2*C),"a",C,A,0,0,0,-C,A].join(" ")}var f=v;f.isVElement=function(g){return g instanceof e};f.decomposeMatrix=l;f.rectToPath=h;var t=f("svg").node;f.createSVGMatrix=function(g){var B=t.createSVGMatrix();for(var A in g){B[A]=g[A]}return B};f.createSVGTransform=function(){return t.createSVGTransform()};f.createSVGPoint=function(g,B){var A=t.createSVGPoint();A.x=g;A.y=B;return A};f.transformRect=function(A,J){var C=t.createSVGPoint();C.x=A.x;C.y=A.y;var I=C.matrixTransform(J);C.x=A.x+A.width;C.y=A.y;var G=C.matrixTransform(J);C.x=A.x+A.width;C.y=A.y+A.height;var F=C.matrixTransform(J);C.x=A.x;C.y=A.y+A.height;var D=C.matrixTransform(J);var H=Math.min(I.x,G.x,F.x,D.x);var B=Math.max(I.x,G.x,F.x,D.x);var E=Math.min(I.y,G.y,F.y,D.y);var g=Math.max(I.y,G.y,F.y,D.y);return{x:H,y:E,width:B-H,height:g-E}};f.styleToObject=function(g){var A={};var D=g.split(";");for(var B=0;B<D.length;B++){var C=D[B];var E=C.split("=");A[E[0].trim()]=E[1].trim()}return A};f.createSlicePathData=function(J,H,I,B){var E=2*Math.PI-0.000001;var D=J;var C=H;var A=I;var g=B;var N=(g<A&&(N=A,A=g,g=N),g-A);var K=N<Math.PI?"0":"1";var G=Math.cos(A);var M=Math.sin(A);var F=Math.cos(g);var L=Math.sin(g);return(N>=E)?(D?"M0,"+C+"A"+C+","+C+" 0 1,1 0,"+(-C)+"A"+C+","+C+" 0 1,1 0,"+C+"M0,"+D+"A"+D+","+D+" 0 1,0 0,"+(-D)+"A"+D+","+D+" 0 1,0 0,"+D+"Z":"M0,"+C+"A"+C+","+C+" 0 1,1 0,"+(-C)+"A"+C+","+C+" 0 1,1 0,"+C+"Z"):(D?"M"+C*G+","+C*M+"A"+C+","+C+" 0 "+K+",1 "+C*F+","+C*L+"L"+D*F+","+D*L+"A"+D+","+D+" 0 "+K+",0 "+D*G+","+D*M+"Z":"M"+C*G+","+C*M+"A"+C+","+C+" 0 "+K+",1 "+C*F+","+C*L+"L0,0Z")};f.mergeAttrs=function(B,A){for(var g in A){if(g==="class"){B[g]=B[g]?B[g]+" "+A[g]:A[g]}else{if(g==="style"){if(n(B[g])&&n(A[g])){B[g]=f.mergeAttrs(B[g],A[g])}else{if(n(B[g])){B[g]=f.mergeAttrs(B[g],f.styleToObject(A[g]))}else{if(n(A[g])){B[g]=f.mergeAttrs(f.styleToObject(B[g]),A[g])}else{B[g]=f.mergeAttrs(f.styleToObject(B[g]),f.styleToObject(A[g]))}}}}else{B[g]=A[g]}}}return B};f.annotateString=function(L,H,A){H=H||[];A=A||{};offset=A.offset||0;var J=[];var G;var I=[];var K;var C;for(var F=0;F<L.length;F++){K=I[F]=L[F];for(var E=0;E<H.length;E++){var B=H[E];var g=B.start+offset;var D=B.end+offset;if(F>=g&&F<D){if(n(K)){K.attrs=f.mergeAttrs(f.mergeAttrs({},K.attrs),B.attrs)}else{K=I[F]={t:L[F],attrs:B.attrs}}if(A.includeAnnotationIndices){(K.annotations||(K.annotations=[])).push(E)}}}C=I[F-1];if(!C){G=K}else{if(n(K)&&n(C)){if(JSON.stringify(K.attrs)===JSON.stringify(C.attrs)){G.t+=K.t}else{J.push(G);G=K}}else{if(n(K)){J.push(G);G=K}else{if(n(C)){J.push(G);G=K}else{G=(G||"")+K}}}}}if(G){J.push(G)}return J};f.findAnnotationsAtIndex=function(B,g){if(!B){return[]}var A=[];B.forEach(function(C){if(C.start<g&&g<=C.end){A.push(C)}});return A};f.findAnnotationsBetweenIndexes=function(B,C,g){if(!B){return[]}var A=[];B.forEach(function(D){if((C>=D.start&&C<D.end)||(g>D.start&&g<=D.end)||(D.start>=C&&D.end<g)){A.push(D)}});return A};f.shiftAnnotations=function(A,g,B){if(!A){return A}A.forEach(function(C){if(C.start>=g){C.start+=B;C.end+=B}});return A};return f}));