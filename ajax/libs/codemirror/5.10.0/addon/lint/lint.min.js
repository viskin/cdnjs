(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(o){var b="CodeMirror-lint-markers";function e(w,v){var u=document.createElement("div");u.className="CodeMirror-lint-tooltip";u.appendChild(v.cloneNode(true));document.body.appendChild(u);function t(x){if(!u.parentNode){return o.off(document,"mousemove",t)}u.style.top=Math.max(0,x.clientY-u.offsetHeight-5)+"px";u.style.left=(x.clientX+5)+"px"}o.on(document,"mousemove",t);t(w);if(u.style.opacity!=null){u.style.opacity=1}return u}function j(t){if(t.parentNode){t.parentNode.removeChild(t)}}function h(t){if(!t.parentNode){return}if(t.style.opacity==null){j(t)}t.style.opacity=0;setTimeout(function(){j(t)},600)}function s(x,v,u){var w=e(x,v);function t(){o.off(u,"mouseout",t);if(w){h(w);w=null}}var y=setInterval(function(){if(w){for(var z=u;;z=z.parentNode){if(z&&z.nodeType==11){z=z.host}if(z==document.body){return}if(!z){t();break}}}if(!w){return clearInterval(y)}},400);o.on(u,"mouseout",t)}function m(t,v,u){this.marked=[];this.options=v;this.timeout=null;this.hasGutter=u;this.onMouseOver=function(w){n(t,w)};this.waitingFor=0}function a(u,t){if(t instanceof Function){return{getAnnotations:t}}if(!t||t===true){t={}}return t}function d(t){var v=t.state.lint;if(v.hasGutter){t.clearGutter(b)}for(var u=0;u<v.marked.length;++u){v.marked[u].clear()}v.marked.length=0}function r(y,w,t,x){var u=document.createElement("div"),v=u;u.className="CodeMirror-lint-marker-"+w;if(t){v=u.appendChild(document.createElement("div"));v.className="CodeMirror-lint-marker-multiple"}if(x!=false){o.on(v,"mouseover",function(z){s(z,y,v)})}return u}function f(u,t){if(u=="error"){return u}else{return t}}function g(x){var u=[];for(var v=0;v<x.length;++v){var w=x[v],t=w.from.line;(u[t]||(u[t]=[])).push(w)}return u}function c(v){var t=v.severity;if(!t){t="error"}var u=document.createElement("div");u.className="CodeMirror-lint-message-"+t;u.appendChild(document.createTextNode(v.message));return u}function k(t,y,u){var v=t.state.lint;var x=++v.waitingFor;function w(){x=-1;t.off("change",w)}t.on("change",w);y(t.getValue(),function(A,z){t.off("change",w);if(v.waitingFor!=x){return}if(z&&A instanceof o){A=z}l(t,A)},u,t)}function q(t){var w=t.state.lint,v=w.options;var u=v.options||v;var x=v.getAnnotations||t.getHelper(o.Pos(0,0),"lint");if(!x){return}if(v.async||x.async){k(t,x,u)}else{l(t,x(t.getValue(),u,t))}}function l(A,z){d(A);var u=A.state.lint,C=u.options;var y=g(z);for(var D=0;D<y.length;++D){var w=y[D];if(!w){continue}var E=null;var v=u.hasGutter&&document.createDocumentFragment();for(var x=0;x<w.length;++x){var t=w[x];var B=t.severity;if(!B){B="error"}E=f(E,B);if(C.formatAnnotation){t=C.formatAnnotation(t)}if(u.hasGutter){v.appendChild(c(t))}if(t.to){u.marked.push(A.markText(t.from,t.to,{className:"CodeMirror-lint-mark-"+B,__annotation:t}))}}if(u.hasGutter){A.setGutterMarker(D,b,r(v,E,w.length>1,u.options.tooltips))}}if(C.onUpdateLinting){C.onUpdateLinting(z,y,A)}}function p(t){var u=t.state.lint;if(!u){return}clearTimeout(u.timeout);u.timeout=setTimeout(function(){q(t)},u.options.delay||500)}function i(t,v){var u=v.target||v.srcElement;s(v,c(t),u)}function n(D,w){var z=w.target||w.srcElement;if(!/\bCodeMirror-lint-mark-/.test(z.className)){return}var v=z.getBoundingClientRect(),C=(v.left+v.right)/2,B=(v.top+v.bottom)/2;var A=D.findMarksAt(D.coordsChar({left:C,top:B},"client"));for(var u=0;u<A.length;++u){var t=A[u].__annotation;if(t){return i(t,w)}}}o.defineOption("lint",false,function(t,z,u){if(u&&u!=o.Init){d(t);if(t.state.lint.options.lintOnChange!==false){t.off("change",p)}o.off(t.getWrapperElement(),"mouseover",t.state.lint.onMouseOver);clearTimeout(t.state.lint.timeout);delete t.state.lint}if(z){var v=t.getOption("gutters"),x=false;for(var w=0;w<v.length;++w){if(v[w]==b){x=true}}var y=t.state.lint=new m(t,a(t,z),x);if(y.options.lintOnChange!==false){t.on("change",p)}if(y.options.tooltips!=false){o.on(t.getWrapperElement(),"mouseover",y.onMouseOver)}q(t)}});o.defineExtension("performLint",function(){if(this.state.lint){q(this)}})});