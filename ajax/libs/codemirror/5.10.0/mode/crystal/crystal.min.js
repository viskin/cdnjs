(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("crystal",function(z){function t(C,B){return new RegExp((B?"":"^")+"(?:"+C.join("|")+")"+(B?"$":"\\b"))}function p(D,C,B){B.tokenize.push(D);return D(C,B)}var s=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var i=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var u=/^(?:\[\][?=]?)/;var o=/^(?:\.(?:\.{2})?|->|[?:])/;var l=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var m=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var h=t(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","ifdef","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","sizeof","struct","super","then","type","typeof","union","unless","until","when","while","with","yield","__DIR__","__FILE__","__LINE__"]);var d=t(["true","false","nil","self"]);var k=["def","fun","macro","class","module","struct","lib","enum","union","if","unless","case","while","until","begin","then","do","for","ifdef"];var c=t(k);var q=["end","else","elsif","rescue","ensure"];var b=t(q);var e=["\\)","\\}","\\]"];var n=new RegExp("^(?:"+e.join("|")+")$");var j={def:g,fun:g,macro:w,"class":y,module:y,struct:y,lib:y,"enum":y,union:y};var f={"[":"]","{":"}","(":")","<":">"};function A(F,D){if(F.eatSpace()){return null}if(D.lastToken!="\\"&&F.match("{%",false)){return p(x("%","%"),F,D)}if(D.lastToken!="\\"&&F.match("{{",false)){return p(x("{","}"),F,D)}if(F.peek()=="#"){F.skipToEnd();return"comment"}var B;if(F.match(l)){F.eat(/[?!]/);B=F.current();if(F.eat(":")){return"atom"}else{if(D.lastToken=="."){return"property"}else{if(h.test(B)){if(D.lastToken!="abstract"&&c.test(B)){if(!(B=="fun"&&D.blocks.indexOf("lib")>=0)){D.blocks.push(B);D.currentIndent+=1}}else{if(b.test(B)){D.blocks.pop();D.currentIndent-=1}}if(j.hasOwnProperty(B)){D.tokenize.push(j[B])}return"keyword"}else{if(d.test(B)){return"atom"}}}}return"variable"}if(F.eat("@")){if(F.peek()=="["){return p(r("[","]","meta"),F,D)}F.eat("@");F.match(l)||F.match(m);return"variable-2"}if(F.eat("$")){F.eat(/[0-9]+|\?/)||F.match(l)||F.match(m);return"variable-3"}if(F.match(m)){return"tag"}if(F.eat(":")){if(F.eat('"')){return p(v('"',"atom",false),F,D)}else{if(F.match(l)||F.match(m)||F.match(s)||F.match(i)||F.match(u)){return"atom"}}F.eat(":");return"operator"}if(F.eat('"')){return p(v('"',"string",true),F,D)}if(F.peek()=="%"){var C="string";var G=true;var E;if(F.match("%r")){C="string-2";E=F.next()}else{if(F.match("%w")){G=false;E=F.next()}else{if(E=F.match(/^%([^\w\s=])/)){E=E[1]}else{if(F.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}}}if(f.hasOwnProperty(E)){E=f[E]}return p(v(E,C,G),F,D)}if(F.eat("'")){F.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);F.eat("'");return"atom"}if(F.eat("0")){if(F.eat("x")){F.match(/^[0-9a-fA-F]+/)}else{if(F.eat("o")){F.match(/^[0-7]+/)}else{if(F.eat("b")){F.match(/^[01]+/)}}}return"number"}if(F.eat(/\d/)){F.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(F.match(s)){F.eat("=");return"operator"}if(F.match(i)||F.match(o)){return"operator"}if(B=F.match(/[({[]/,false)){B=B[0];return p(r(B,f[B],null),F,D)}if(F.eat("\\")){F.next();return"meta"}F.next();return null}function r(E,C,D,B){return function(H,G){if(!B&&H.match(E)){G.tokenize[G.tokenize.length-1]=r(E,C,D,true);G.currentIndent+=1;return D}var F=A(H,G);if(H.current()===C){G.tokenize.pop();G.currentIndent-=1;F=D}return F}}function x(D,C,B){return function(F,E){if(!B&&F.match("{"+D)){E.currentIndent+=1;E.tokenize[E.tokenize.length-1]=x(D,C,true);return"meta"}if(F.match(C+"}")){E.currentIndent-=1;E.tokenize.pop();return"meta"}return A(F,E)}}function w(D,C){if(D.eatSpace()){return null}var B;if(B=D.match(l)){if(B=="def"){return"keyword"}D.eat(/[?!]/)}C.tokenize.pop();return"def"}function g(C,B){if(C.eatSpace()){return null}if(C.match(l)){C.eat(/[!?]/)}else{C.match(s)||C.match(i)||C.match(u)}B.tokenize.pop();return"def"}function y(C,B){if(C.eatSpace()){return null}C.match(m);B.tokenize.pop();return"def"}function v(B,C,D){return function(H,F){var G=false;while(H.peek()){if(!G){if(H.match("{%",false)){F.tokenize.push(x("%","%"));return C}if(H.match("{{",false)){F.tokenize.push(x("{","}"));return C}if(D&&H.match("#{",false)){F.tokenize.push(r("#{","}","meta"));return C}var E=H.next();if(E==B){F.tokenize.pop();return C}G=E=="\\"}else{H.next();G=false}}return C}}return{startState:function(){return{tokenize:[A],currentIndent:0,lastToken:null,blocks:[]}},token:function(E,D){var C=D.tokenize[D.tokenize.length-1](E,D);var B=E.current();if(C&&C!="comment"){D.lastToken=B}return C},indent:function(C,B){B=B.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(b.test(B)||n.test(B)){return z.indentUnit*(C.currentIndent-1)}return z.indentUnit*C.currentIndent},fold:"indent",electricInput:t(e.concat(q),true),lineComment:"#"}});a.defineMIME("text/x-crystal","crystal")});