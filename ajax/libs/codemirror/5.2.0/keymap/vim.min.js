(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a)}else{a(CodeMirror)}}})(function(b){var a=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var c=b.Pos;var d=function(){function aW(bC){bC.setOption("disableInput",true);bC.setOption("showCursorWhenSelecting",false);b.signal(bC,"vim-mode-change",{mode:"normal"});bC.on("cursorActivity",aa);G(bC);b.on(bC.getInputField(),"paste",U(bC))}function aS(bC){bC.setOption("disableInput",false);bC.off("cursorActivity",aa);b.off(bC.getInputField(),"paste",U(bC));bC.state.vim=null}function h(bC,bD){if(this==b.keyMap.vim){b.rmClass(bC.getWrapperElement(),"cm-fat-cursor")}if(!bD||bD.attach!=s){aS(bC,false)}}function s(bC,bD){if(this==b.keyMap.vim){b.addClass(bC.getWrapperElement(),"cm-fat-cursor")}if(!bD||bD.attach!=s){aW(bC)}}b.defineOption("vimMode",false,function(bC,bE,bD){if(bE&&bC.getOption("keyMap")!="vim"){bC.setOption("keyMap","vim")}else{if(!bE&&bD!=b.Init&&/^vim/.test(bC.getOption("keyMap"))){bC.setOption("keyMap","default")}}});function a4(bE,bD){if(!bD){return undefined}var bC=L(bE);if(!bC){return false}var bF=b.Vim.findKey(bD,bC);if(typeof bF=="function"){b.signal(bD,"vim-keypress",bC)}return bF}var aB={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var aV={Enter:"CR",Backspace:"BS",Delete:"Del"};function L(bE){if(bE.charAt(0)=="'"){return bE.charAt(1)}var bH=bE.split("-");if(/-$/.test(bE)){bH.splice(-2,2,"-")}var bC=bH[bH.length-1];if(bH.length==1&&bH[0].length==1){return false}else{if(bH.length==2&&bH[0]=="Shift"&&bC.length==1){return false}}var bG=false;for(var bD=0;bD<bH.length;bD++){var bF=bH[bD];if(bF in aB){bH[bD]=aB[bF]}else{bG=true}if(bF in aV){bH[bD]=aV[bF]}}if(!bG){return false}if(A(bC)){bH[bH.length-1]=bC.toLowerCase()}return"<"+bH.join("-")+">"}function U(bC){var bD=bC.state.vim;if(!bD.onPasteFn){bD.onPasteFn=function(){if(!bD.insertMode){bC.setCursor(D(bC.getCursor(),0,1));p.enterInsertMode(bC,{},bD)}}}return bD.onPasteFn}var a0=/[\d]/;var ao=[b.isWordChar,function(bC){return bC&&!b.isWordChar(bC)&&!/\s/.test(bC)}],bw=[function(bC){return/\S/.test(bC)}];function ar(bF,bD){var bE=[];for(var bC=bF;bC<bF+bD;bC++){bE.push(String.fromCharCode(bC))}return bE}var ah=ar(65,26);var am=ar(97,26);var V=ar(48,10);var aG=[].concat(ah,am,V,["<",">"]);var k=[].concat(ah,am,V,["-",'"',".",":","/"]);function f(bC,bD){return bD>=bC.firstLine()&&bD<=bC.lastLine()}function E(bC){return(/^[a-z]$/).test(bC)}function N(bC){return"()[]{}".indexOf(bC)!=-1}function ag(bC){return a0.test(bC)}function A(bC){return(/^[A-Z]$/).test(bC)}function T(bC){return(/^\s*$/).test(bC)}function J(bE,bC){for(var bD=0;bD<bC.length;bD++){if(bC[bD]==bE){return true}}return false}var au={};function aL(bE,bD,bG,bC,bH){if(bD===undefined&&!bH){throw Error("defaultValue is required unless callback is provided")}if(!bG){bG="string"}au[bE]={type:bG,defaultValue:bD,callback:bH};if(bC){for(var bF=0;bF<bC.length;bF++){au[bC[bF]]=au[bE]}}if(bD){aJ(bE,bD)}}function aJ(bE,bH,bC,bD){var bG=au[bE];bD=bD||{};var bF=bD.scope;if(!bG){throw Error("Unknown option: "+bE)}if(bG.type=="boolean"){if(bH&&bH!==true){throw Error("Invalid argument: "+bE+"="+bH)}else{if(bH!==false){bH=true}}}if(bG.callback){if(bF!=="local"){bG.callback(bH,undefined)}if(bF!=="global"&&bC){bG.callback(bH,bC)}}else{if(bF!=="local"){bG.value=bG.type=="boolean"?!!bH:bH}if(bF!=="global"&&bC){bC.state.vim.options[bE]={value:bH}}}}function n(bE,bC,bD){var bH=au[bE];bD=bD||{};var bG=bD.scope;if(!bH){throw Error("Unknown option: "+bE)}if(bH.callback){var bF=bC&&bH.callback(undefined,bC);if(bG!=="global"&&bF!==undefined){return bF}if(bG!=="local"){return bH.callback()}return}else{var bF=(bG!=="global")&&(bC&&bC.state.vim.options[bE]);return(bF||(bG!=="local")&&bH||{}).value}}aL("filetype",undefined,"string",["ft"],function(bD,bC){if(bC===undefined){return}if(bD===undefined){var bE=bC.getMode().name;return bE=="null"?"":bE}else{var bE=bD==""?"null":bD;bC.setOption("mode",bE)}});var ap=function(){var bG=100;var bI=-1;var bF=0;var bE=0;var bD=new Array(bG);function bH(bJ,bL,bM){var bN=bI%bG;var bO=bD[bN];function bK(bR){var bQ=++bI%bG;var bS=bD[bQ];if(bS){bS.clear()}bD[bQ]=bJ.setBookmark(bR)}if(bO){var bP=bO.find();if(bP&&!bz(bP,bL)){bK(bL)}}else{bK(bL)}bK(bM);bF=bI;bE=bI-bG+1;if(bE<0){bE=0}}function bC(bJ,bN){bI+=bN;if(bI>bF){bI=bF}else{if(bI<bE){bI=bE}}var bO=bD[(bG+bI)%bG];if(bO&&!bO.find()){var bM=bN>0?1:-1;var bL;var bK=bJ.getCursor();do{bI+=bM;bO=bD[(bG+bI)%bG];if(bO&&(bL=bO.find())&&!bz(bK,bL)){break}}while(bI<bF&&bI>bE)}return bO}return{cachedCursor:undefined,add:bH,move:bC}};var i=function(bC){if(bC){return{changes:bC.changes,expectCursorActivityForChange:bC.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function ay(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=i()}ay.prototype={exitMacroRecordMode:function(){var bC=q.macroModeState;if(bC.onRecordingDone){bC.onRecordingDone()}bC.onRecordingDone=undefined;bC.isRecording=false},enterMacroRecordMode:function(bC,bE){var bD=q.registerController.getRegister(bE);if(bD){bD.clear();this.latestRegister=bE;if(bC.openDialog){this.onRecordingDone=bC.openDialog("(recording)["+bE+"]",null,{bottom:true})}this.isRecording=true}}};function G(bC){if(!bC.state.vim){bC.state.vim={inputState:new aC(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return bC.state.vim}var q;function z(){q={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:ap(),macroModeState:new ay,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new ai({}),searchHistoryController:new a5({}),exCommandHistoryController:new a5({})};for(var bC in au){var bD=au[bC];bD.value=bD.defaultValue}}var bx;var aP={buildKeyMap:function(){},getRegisterController:function(){return q.registerController},resetVimGlobalState_:z,getVimGlobalState_:function(){return q},maybeInitVimState_:G,suppressErrorLogging:false,InsertModeKey:bl,map:function(bD,bE,bC){l.map(bD,bE,bC)},setOption:aJ,getOption:n,defineOption:aL,defineEx:function(bC,bE,bD){if(bC.indexOf(bE)!==0){throw new Error('(Vim.defineEx) "'+bE+'" is not a prefix of "'+bC+'", command not registered')}a6[bC]=bD;l.commandMap_[bE]={name:bC,shortName:bE,type:"api"}},handleKey:function(bC,bE,bD){var bF=this.findKey(bC,bE,bD);if(typeof bF==="function"){return bF()}},findKey:function(bI,bJ,bH){var bF=G(bI);function bK(){var bM=q.macroModeState;if(bM.isRecording){if(bJ=="q"){bM.exitMacroRecordMode();j(bI);return true}if(bH!="mapping"){I(bM,bJ)}}}function bL(){if(bJ=="<Esc>"){j(bI);if(bF.visualMode){aT(bI)}else{if(bF.insertMode){v(bI)}}return true}}function bC(bN){var bM;while(bN){bM=(/<\w+-.+?>|<\w+>|./).exec(bN);bJ=bM[0];bN=bN.substring(bM.index+bJ.length);b.Vim.handleKey(bI,bJ,"mapping")}}function bG(){if(bL()){return true}var bO=bF.inputState.keyBuffer=bF.inputState.keyBuffer+bJ;var bP=bJ.length==1;var bM=bc.matchCommand(bO,a,bF.inputState,"insert");while(bO.length>1&&bM.type!="full"){var bO=bF.inputState.keyBuffer=bO.slice(1);var bQ=bc.matchCommand(bO,a,bF.inputState,"insert");if(bQ.type!="none"){bM=bQ}}if(bM.type=="none"){j(bI);return false}else{if(bM.type=="partial"){if(bx){window.clearTimeout(bx)}bx=window.setTimeout(function(){if(bF.insertMode&&bF.inputState.keyBuffer){j(bI)}},n("insertModeEscKeysTimeout"));return !bP}}if(bx){window.clearTimeout(bx)}if(bP){var bN=bI.getCursor();bI.replaceRange("",D(bN,0,-(bO.length-1)),bN,"+input")}j(bI);return bM.command}function bE(){if(bK()||bL()){return true}var bO=bF.inputState.keyBuffer=bF.inputState.keyBuffer+bJ;if(/^[1-9]\d*$/.test(bO)){return true}var bP=/^(\d*)(.*)$/.exec(bO);if(!bP){j(bI);return false}var bN=bF.visualMode?"visual":"normal";var bM=bc.matchCommand(bP[2]||bP[1],a,bF.inputState,bN);if(bM.type=="none"){j(bI);return false}else{if(bM.type=="partial"){return true}}bF.inputState.keyBuffer="";var bP=/^(\d*)(.*)$/.exec(bO);if(bP[1]&&bP[1]!="0"){bF.inputState.pushRepeatDigit(bP[1])}return bM.command}var bD;if(bF.insertMode){bD=bG()}else{bD=bE()}if(bD===false){return undefined}else{if(bD===true){return function(){}}else{return function(){return bI.operation(function(){bI.curOp.isVimOp=true;try{if(bD.type=="keyToKey"){bC(bD.toKeys)}else{bc.processCommand(bI,bF,bD)}}catch(bM){bI.state.vim=undefined;G(bI);if(!b.Vim.suppressErrorLogging){console.log(bM)}throw bM}return true})}}}},handleEx:function(bC,bD){l.processCommand(bC,bD)},defineMotion:aq,defineAction:bq,defineOperator:bj,mapCommand:az,_mapCommand:o,exitVisualMode:aT,exitInsertMode:v};function aC(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}aC.prototype.pushRepeatDigit=function(bC){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(bC)}else{this.motionRepeat=this.motionRepeat.concat(bC)}};aC.prototype.getRepeat=function(){var bC=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){bC=1;if(this.prefixRepeat.length>0){bC*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){bC*=parseInt(this.motionRepeat.join(""),10)}}return bC};function j(bC,bD){bC.state.vim.inputState=new aC();b.signal(bC,"vim-command-done",bD)}function bp(bE,bD,bC){this.clear();this.keyBuffer=[bE||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!bD;this.blockwise=!!bC}bp.prototype={setText:function(bE,bD,bC){this.keyBuffer=[bE||""];this.linewise=!!bD;this.blockwise=!!bC},pushText:function(bD,bC){if(bC){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(bD)},pushInsertModeChanges:function(bC){this.insertModeChanges.push(i(bC))},pushSearchQuery:function(bC){this.searchQueries.push(bC)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function ai(bC){this.registers=bC;this.unnamedRegister=bC['"']=new bp();bC["."]=new bp();bC[":"]=new bp();bC["/"]=new bp()}ai.prototype={pushText:function(bG,bD,bI,bH,bE){if(bH&&bI.charAt(0)=="\n"){bI=bI.slice(1)+"\n"}if(bH&&bI.charAt(bI.length-1)!=="\n"){bI+="\n"}var bF=this.isValidRegister(bG)?this.getRegister(bG):null;if(!bF){switch(bD){case"yank":this.registers["0"]=new bp(bI,bH,bE);break;case"delete":case"change":if(bI.indexOf("\n")==-1){this.registers["-"]=new bp(bI,bH)}else{this.shiftNumericRegisters_();this.registers["1"]=new bp(bI,bH)}break}this.unnamedRegister.setText(bI,bH,bE);return}var bC=A(bG);if(bC){bF.pushText(bI,bH)}else{bF.setText(bI,bH,bE)}this.unnamedRegister.setText(bF.toString(),bH)},getRegister:function(bC){if(!this.isValidRegister(bC)){return this.unnamedRegister}bC=bC.toLowerCase();if(!this.registers[bC]){this.registers[bC]=new bp()}return this.registers[bC]},isValidRegister:function(bC){return bC&&J(bC,k)},shiftNumericRegisters_:function(){for(var bC=9;bC>=2;bC--){this.registers[bC]=this.getRegister(""+(bC-1))}}};function a5(){this.historyBuffer=[];this.iterator;this.initialPrefix=null}a5.prototype={nextMatch:function(bD,bC){var bI=this.historyBuffer;var bF=bC?-1:1;if(this.initialPrefix===null){this.initialPrefix=bD}for(var bH=this.iterator+bF;bC?bH>=0:bH<bI.length;bH+=bF){var bG=bI[bH];for(var bE=0;bE<=bG.length;bE++){if(this.initialPrefix==bG.substring(0,bE)){this.iterator=bH;return bG}}}if(bH>=bI.length){this.iterator=bI.length;return this.initialPrefix}if(bH<0){return bD}},pushInput:function(bC){var bD=this.historyBuffer.indexOf(bC);if(bD>-1){this.historyBuffer.splice(bD,1)}if(bC.length){this.historyBuffer.push(bC)}},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var bc={matchCommand:function(bH,bJ,bC,bF){var bI=bm(bH,bJ,bF,bC);if(!bI.full&&!bI.partial){return{type:"none"}}else{if(!bI.full&&bI.partial){return{type:"partial"}}}var bG;for(var bE=0;bE<bI.full.length;bE++){var bD=bI.full[bE];if(!bG){bG=bD}}if(bG.keys.slice(-11)=="<character>"){bC.selectedCharacter=Q(bH)}return{type:"full",command:bG}},processCommand:function(bC,bD,bE){bD.inputState.repeatOverride=bE.repeatOverride;switch(bE.type){case"motion":this.processMotion(bC,bD,bE);break;case"operator":this.processOperator(bC,bD,bE);break;case"operatorMotion":this.processOperatorMotion(bC,bD,bE);break;case"action":this.processAction(bC,bD,bE);break;case"search":this.processSearch(bC,bD,bE);break;case"ex":case"keyToEx":this.processEx(bC,bD,bE);break;default:break}},processMotion:function(bC,bD,bE){bD.inputState.motion=bE.motion;bD.inputState.motionArgs=bk(bE.motionArgs);this.evalInput(bC,bD)},processOperator:function(bD,bE,bF){var bC=bE.inputState;if(bC.operator){if(bC.operator==bF.operator){bC.motion="expandToLine";bC.motionArgs={linewise:true};this.evalInput(bD,bE);return}else{j(bD)}}bC.operator=bF.operator;bC.operatorArgs=bk(bF.operatorArgs);if(bE.visualMode){this.evalInput(bD,bE)}},processOperatorMotion:function(bC,bF,bG){var bE=bF.visualMode;var bD=bk(bG.operatorMotionArgs);if(bD){if(bE&&bD.visualLine){bF.visualLine=true}}this.processOperator(bC,bF,bG);if(!bE){this.processMotion(bC,bF,bG)}},processAction:function(bD,bF,bI){var bC=bF.inputState;var bH=bC.getRepeat();var bG=!!bH;var bE=bk(bI.actionArgs)||{};if(bC.selectedCharacter){bE.selectedCharacter=bC.selectedCharacter}if(bI.operator){this.processOperator(bD,bF,bI)}if(bI.motion){this.processMotion(bD,bF,bI)}if(bI.motion||bI.operator){this.evalInput(bD,bF)}bE.repeat=bH||1;bE.repeatIsExplicit=bG;bE.registerName=bC.registerName;j(bD);bF.lastMotion=null;if(bI.isEdit){this.recordLastEdit(bF,bC,bI)}p[bI.action](bD,bE,bF)},processSearch:function(bR,bK,bJ){if(!bR.getSearchCursor){return}var bM=bJ.searchArgs.forward;var bH=bJ.searchArgs.wholeWordOnly;aI(bR).setReversed(!bM);var bN=(bM)?"/":"?";var bP=aI(bR).getQuery();var bE=bR.getScrollInfo();function bI(bU,bS,bT){q.searchHistoryController.pushInput(bU);q.searchHistoryController.reset();try{by(bR,bU,bS,bT)}catch(bV){bn(bR,"Invalid regex: "+bU);j(bR);return}bc.processMotion(bR,bK,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:bJ.searchArgs.toJumplist}})}function bQ(bS){bR.scrollTo(bE.left,bE.top);bI(bS,true,true);var bT=q.macroModeState;if(bT.isRecording){O(bT,bS)}}function bG(bW,bV,bX){var bU=b.keyName(bW),bS;if(bU=="Up"||bU=="Down"){bS=bU=="Up"?true:false;bV=q.searchHistoryController.nextMatch(bV,bS)||"";bX(bV)}else{if(bU!="Left"&&bU!="Right"&&bU!="Ctrl"&&bU!="Alt"&&bU!="Shift"){q.searchHistoryController.reset()}}var bT;try{bT=by(bR,bV,true,true)}catch(bW){}if(bT){bR.scrollIntoView(bA(bR,!bM,bT),30)}else{aM(bR);bR.scrollTo(bE.left,bE.top)}}function bD(bU,bT,bV){var bS=b.keyName(bU);if(bS=="Esc"||bS=="Ctrl-C"||bS=="Ctrl-["||(bS=="Backspace"&&bT=="")){q.searchHistoryController.pushInput(bT);q.searchHistoryController.reset();by(bR,bP);aM(bR);bR.scrollTo(bE.left,bE.top);b.e_stop(bU);j(bR);bV();bR.focus()}else{if(bS=="Ctrl-U"){b.e_stop(bU);bV("")}}}switch(bJ.searchArgs.querySrc){case"prompt":var bL=q.macroModeState;if(bL.isPlaying){var bO=bL.replaySearchQueries.shift();bI(bO,true,false)}else{a2(bR,{onClose:bQ,prefix:bN,desc:P,onKeyUp:bG,onKeyDown:bD})}break;case"wordUnderCursor":var bF=aF(bR,false,true,false,true);var bC=true;if(!bF){bF=aF(bR,false,true,false,false);bC=false}if(!bF){return}var bO=bR.getLine(bF.start.line).substring(bF.start.ch,bF.end.ch);if(bC&&bH){bO="\\b"+bO+"\\b"}else{bO=g(bO)}q.jumpList.cachedCursor=bR.getCursor();bR.setCursor(bF.start);bI(bO,true,false);break}},processEx:function(bC,bD,bG){function bF(bH){q.exCommandHistoryController.pushInput(bH);q.exCommandHistoryController.reset();l.processCommand(bC,bH)}function bE(bK,bI,bL){var bJ=b.keyName(bK),bH;if(bJ=="Esc"||bJ=="Ctrl-C"||bJ=="Ctrl-["||(bJ=="Backspace"&&bI=="")){q.exCommandHistoryController.pushInput(bI);q.exCommandHistoryController.reset();b.e_stop(bK);j(bC);bL();bC.focus()}if(bJ=="Up"||bJ=="Down"){bH=bJ=="Up"?true:false;bI=q.exCommandHistoryController.nextMatch(bI,bH)||"";bL(bI)}else{if(bJ=="Ctrl-U"){b.e_stop(bK);bL("")}else{if(bJ!="Left"&&bJ!="Right"&&bJ!="Ctrl"&&bJ!="Alt"&&bJ!="Shift"){q.exCommandHistoryController.reset()}}}}if(bG.type=="keyToEx"){l.processCommand(bC,bG.exArgs.input)}else{if(bD.visualMode){a2(bC,{onClose:bF,prefix:":",value:"'<,'>",onKeyDown:bE})}else{a2(bC,{onClose:bF,prefix:":",onKeyDown:bE})}}},evalInput:function(bK,bW){var bP=bW.inputState;var bT=bP.motion;var bQ=bP.motionArgs||{};var bL=bP.operator;var b6=bP.operatorArgs||{};var bR=bP.registerName;var bX=bW.sel;var b7=C(bW.visualMode?Z(bK,bX.head):bK.getCursor("head"));var bI=C(bW.visualMode?Z(bK,bX.anchor):bK.getCursor("anchor"));var bF=C(b7);var bE=C(bI);var bV,bO;var bM;if(bL){this.recordLastEdit(bW,bP)}if(bP.repeatOverride!==undefined){bM=bP.repeatOverride}else{bM=bP.getRepeat()}if(bM>0&&bQ.explicitRepeat){bQ.repeatIsExplicit=true}else{if(bQ.noRepeat||(!bQ.explicitRepeat&&bM===0)){bM=1;bQ.repeatIsExplicit=false}}if(bP.selectedCharacter){bQ.selectedCharacter=b6.selectedCharacter=bP.selectedCharacter}bQ.repeat=bM;j(bK);if(bT){var bU=a3[bT](bK,b7,bQ,bW);bW.lastMotion=a3[bT];if(!bU){return}if(bQ.toJumplist){var b5=q.jumpList;var bN=b5.cachedCursor;if(bN){bg(bK,bN,bU);delete b5.cachedCursor}else{bg(bK,b7,bU)}}if(bU instanceof Array){bO=bU[0];bV=bU[1]}else{bV=bU}if(!bV){bV=C(b7)}if(bW.visualMode){if(!(bW.visualBlock&&bV.ch===Infinity)){bV=Z(bK,bV,bW.visualBlock)}if(bO){bO=Z(bK,bO,true)}bO=bO||bE;bX.anchor=bO;bX.head=bV;M(bK);aR(bK,bW,"<",aO(bO,bV)?bO:bV);aR(bK,bW,">",aO(bO,bV)?bV:bO)}else{if(!bL){bV=Z(bK,bV);bK.setCursor(bV.line,bV.ch)}}}if(bL){if(b6.lastSel){bO=bE;var bC=b6.lastSel;var b2=Math.abs(bC.head.line-bC.anchor.line);var b4=Math.abs(bC.head.ch-bC.anchor.ch);if(bC.visualLine){bV=c(bE.line+b2,bE.ch)}else{if(bC.visualBlock){bV=c(bE.line+b2,bE.ch+b4)}else{if(bC.head.line==bC.anchor.line){bV=c(bE.line,bE.ch+b4)}else{bV=c(bE.line+b2,bE.ch)}}}bW.visualMode=true;bW.visualLine=bC.visualLine;bW.visualBlock=bC.visualBlock;bX=bW.sel={anchor:bO,head:bV};M(bK)}else{if(bW.visualMode){b6.lastSel={anchor:C(bX.anchor),head:C(bX.head),visualBlock:bW.visualBlock,visualLine:bW.visualLine}}}var bJ,bY,bG,bS;var bH;if(bW.visualMode){bJ=aw(bX.head,bX.anchor);bY=ba(bX.head,bX.anchor);bG=bW.visualLine||b6.linewise;bS=bW.visualBlock?"block":bG?"line":"char";bH=bB(bK,{anchor:bJ,head:bY},bS);if(bG){var bD=bH.ranges;if(bS=="block"){for(var bZ=0;bZ<bD.length;bZ++){bD[bZ].head.ch=aX(bK,bD[bZ].head.line)}}else{if(bS=="line"){bD[0].head=c(bD[0].head.line+1,0)}}}}else{bJ=C(bO||bE);bY=C(bV||bF);if(aO(bY,bJ)){var b3=bJ;bJ=bY;bY=b3}bG=bQ.linewise||b6.linewise;if(bG){be(bK,bJ,bY)}else{if(bQ.forward){al(bK,bJ,bY)}}bS="char";var b1=!bQ.inclusive||bG;bH=bB(bK,{anchor:bJ,head:bY},bS,b1)}bK.setSelections(bH.ranges,bH.primary);bW.lastMotion=null;b6.repeat=bM;b6.registerName=bR;b6.linewise=bG;var b0=K[bL](bK,b6,bH.ranges,bE,bV);if(bW.visualMode){aT(bK,b0!=null)}if(b0){bK.setCursor(b0)}}},recordLastEdit:function(bD,bC,bE){var bF=q.macroModeState;if(bF.isPlaying){return}bD.lastEditInputState=bC;bD.lastEditActionCommand=bE;bF.lastInsertModeChanges.changes=[];bF.lastInsertModeChanges.expectCursorActivityForChange=false}};var a3={moveToTopLine:function(bC,bE,bF){var bD=bd(bC).top+bF.repeat-1;return c(bD,a1(bC.getLine(bD)))},moveToMiddleLine:function(bC){var bE=bd(bC);var bD=Math.floor((bE.top+bE.bottom)*0.5);return c(bD,a1(bC.getLine(bD)))},moveToBottomLine:function(bC,bE,bF){var bD=bd(bC).bottom-bF.repeat+1;return c(bD,a1(bC.getLine(bD)))},expandToLine:function(bE,bD,bC){var bF=bD;return c(bF.line+bC.repeat-1,Infinity)},findNext:function(bC,bD,bE){var bH=aI(bC);var bG=bH.getQuery();if(!bG){return}var bF=!bE.forward;bF=(bH.isReversed())?!bF:bF;aK(bC,bG);return bA(bC,bF,bG,bE.repeat)},goToMark:function(bC,bE,bF,bD){var bH=bD.marks[bF.selectedCharacter];if(bH){var bG=bH.find();return bF.linewise?{line:bG.line,ch:a1(bC.getLine(bG.line))}:bG}return null},moveToOtherHighlightedEnd:function(bC,bE,bF,bD){if(bD.visualBlock&&bF.sameLine){var bG=bD.sel;return[Z(bC,c(bG.anchor.line,bG.head.ch)),Z(bC,c(bG.head.line,bG.anchor.ch))]}else{return([bD.sel.head,bD.sel.anchor])}},jumpToMark:function(bK,bJ,bF,bG){var bE=bJ;for(var bH=0;bH<bF.repeat;bH++){var bM=bE;for(var bL in bG.marks){if(!E(bL)){continue}var bD=bG.marks[bL].find();var bC=(bF.forward)?aO(bD,bM):aO(bM,bD);if(bC){continue}if(bF.linewise&&(bD.line==bM.line)){continue}var bI=bz(bM,bE);var bN=(bF.forward)?av(bM,bD,bE):av(bE,bD,bM);if(bI||bN){bE=bD}}}if(bF.linewise){bE=c(bE.line,a1(bK.getLine(bE.line)))}return bE},moveByCharacters:function(bF,bD,bC){var bH=bD;var bG=bC.repeat;var bE=bC.forward?bH.ch+bG:bH.ch-bG;return c(bH.line,bE)},moveByLines:function(bI,bH,bD,bE){var bK=bH;var bF=bK.ch;switch(bE.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bF=bE.lastHPos;break;default:bE.lastHPos=bF}var bC=bD.repeat+(bD.repeatOffset||0);var bL=bD.forward?bK.line+bC:bK.line-bC;var bG=bI.firstLine();var bJ=bI.lastLine();if((bL<bG&&bK.line==bG)||(bL>bJ&&bK.line==bJ)){return}if(bD.toFirstChar){bF=a1(bI.getLine(bL));bE.lastHPos=bF}bE.lastHSPos=bI.charCoords(c(bL,bF),"div").left;return c(bL,bF)},moveByDisplayLines:function(bK,bJ,bE,bF){var bL=bJ;switch(bF.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bF.lastHSPos=bK.charCoords(bL,"div").left}var bC=bE.repeat;var bI=bK.findPosV(bL,(bE.forward?bC:-bC),"line",bF.lastHSPos);if(bI.hitSide){if(bE.forward){var bD=bK.charCoords(bI,"div");var bG={top:bD.top+8,left:bF.lastHSPos};var bI=bK.coordsChar(bG,"div")}else{var bH=bK.charCoords(c(bK.firstLine(),0),"div");bH.left=bF.lastHSPos;bI=bK.coordsChar(bH,"div")}}bF.lastHPos=bI.ch;return bI},moveByPage:function(bD,bF,bE){var bC=bF;var bG=bE.repeat;return bD.findPosV(bC,(bE.forward?bG:-bG),"page")},moveByParagraph:function(bC,bF,bE){var bD=bE.forward?1:-1;return bo(bC,bF,bE.repeat,bD)},moveByScroll:function(bI,bF,bD,bE){var bJ=bI.getScrollInfo();var bK=null;var bC=bD.repeat;if(!bC){bC=bJ.clientHeight/(2*bI.defaultTextHeight())}var bH=bI.charCoords(bF,"local");bD.repeat=bC;var bK=a3.moveByDisplayLines(bI,bF,bD,bE);if(!bK){return null}var bG=bI.charCoords(bK,"local");bI.scrollTo(null,bJ.top+bG.top-bH.top);return bK},moveByWords:function(bC,bE,bD){return aD(bC,bE,bD.repeat,!!bD.forward,!!bD.wordEnd,!!bD.bigWord)},moveTillCharacter:function(bD,bE,bF){var bH=bF.repeat;var bG=bs(bD,bH,bF.forward,bF.selectedCharacter);var bC=bF.forward?-1:1;aE(bC,bF);if(!bG){return null}bG.ch+=bC;return bG},moveToCharacter:function(bC,bE,bD){var bF=bD.repeat;aE(0,bD);return bs(bC,bF,bD.forward,bD.selectedCharacter)||bE},moveToSymbol:function(bC,bE,bD){var bF=bD.repeat;return bt(bC,bF,bD.forward,bD.selectedCharacter)||bE},moveToColumn:function(bC,bF,bE,bD){var bG=bE.repeat;bD.lastHPos=bG-1;bD.lastHSPos=bC.charCoords(bF,"div").left;return aj(bC,bG)},moveToEol:function(bC,bH,bG,bF){var bI=bH;bF.lastHPos=Infinity;var bE=c(bI.line+bG.repeat-1,Infinity);var bD=bC.clipPos(bE);bD.ch--;bF.lastHSPos=bC.charCoords(bD,"div").left;return bE},moveToFirstNonWhiteSpaceCharacter:function(bC,bD){var bE=bD;return c(bE.line,a1(bC.getLine(bE.line)))},moveToMatchedSymbol:function(bI,bG){var bJ=bG;var bK=bJ.line;var bC=bJ.ch;var bH=bI.getLine(bK);var bF;do{bF=bH.charAt(bC++);if(bF&&N(bF)){var bD=bI.getTokenTypeAt(c(bK,bC));if(bD!=="string"&&bD!=="comment"){break}}}while(bF);if(bF){var bE=bI.findMatchingBracket(c(bK,bC));return bE.to}else{return bJ}},moveToStartOfLine:function(bD,bC){return c(bC.line,0)},moveToLineOrEdgeOfDocument:function(bC,bD,bE){var bF=bE.forward?bC.lastLine():bC.firstLine();if(bE.repeatIsExplicit){bF=bE.repeat-bC.getOption("firstLineNumber")}return c(bF,a1(bC.getLine(bF)))},textObjectManipulation:function(bK,bI,bE,bF){var bC={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var bL={"'":true,'"':true};var bH=bE.selectedCharacter;if(bH=="b"){bH="("}else{if(bH=="B"){bH="{"}}var bJ=!bE.textObjectInner;var bG;if(bC[bH]){bG=m(bK,bI,bH,bJ)}else{if(bL[bH]){bG=aQ(bK,bI,bH,bJ)}else{if(bH==="W"){bG=aF(bK,bJ,true,true)}else{if(bH==="w"){bG=aF(bK,bJ,true,false)}else{if(bH==="p"){bG=bo(bK,bI,bE.repeat,0,bJ);bE.linewise=true;if(bF.visualMode){if(!bF.visualLine){bF.visualLine=true}}else{var bD=bF.inputState.operatorArgs;if(bD){bD.linewise=true}bG.end.line--}}else{return null}}}}}if(!bK.state.vim.visualMode){return[bG.start,bG.end]}else{return t(bK,bG.start,bG.end)}},repeatLastCharacterSearch:function(bE,bH,bG){var bD=q.lastChararacterSearch;var bJ=bG.repeat;var bF=bG.forward===bD.forward;var bC=(bD.increment?1:0)*(bF?-1:1);bE.moveH(-bC,"char");bG.inclusive=bF?true:false;var bI=bs(bE,bJ,bF,bD.selectedCharacter);if(!bI){bE.moveH(bC,"char");return bH}bI.ch+=bC;return bI}};function aq(bC,bD){a3[bC]=bD}function y(bF,bE){var bC=[];for(var bD=0;bD<bE;bD++){bC.push(bF)}return bC}var K={change:function(bM,bK,bE){var bJ,bN;var bG=bM.state.vim;q.macroModeState.lastInsertModeChanges.inVisualBlock=bG.visualBlock;if(!bG.visualMode){var bH=bE[0].anchor,bL=bE[0].head;bN=bM.getRange(bH,bL);var bC=bG.lastEditInputState||{};if(bC.motion=="moveByWords"&&!T(bN)){var bI=(/\s+$/).exec(bN);if(bI&&bC.motionArgs&&bC.motionArgs.forward){bL=D(bL,0,-bI[0].length);bN=bN.slice(0,-bI[0].length)}}var bD=bL.line-1==bM.lastLine();bM.replaceRange("",bH,bL);if(bK.linewise&&!bD){b.commands.newlineAndIndent(bM);bH.ch=null}bJ=bH}else{bN=bM.getSelection();var bF=y("",bE.length);bM.replaceSelections(bF);bJ=aw(bE[0].head,bE[0].anchor)}q.registerController.pushText(bK.registerName,"change",bN,bK.linewise,bE.length>1);p.enterInsertMode(bM,{head:bJ},bM.state.vim)},"delete":function(bJ,bH,bC){var bG,bK;var bE=bJ.state.vim;if(!bE.visualBlock){var bF=bC[0].anchor,bI=bC[0].head;if(bH.linewise&&bI.line!=bJ.firstLine()&&bF.line==bJ.lastLine()&&bF.line==bI.line-1){if(bF.line==bJ.firstLine()){bF.ch=0}else{bF=c(bF.line-1,aX(bJ,bF.line-1))}}bK=bJ.getRange(bF,bI);bJ.replaceRange("",bF,bI);bG=bF;if(bH.linewise){bG=a3.moveToFirstNonWhiteSpaceCharacter(bJ,bF)}}else{bK=bJ.getSelection();var bD=y("",bC.length);bJ.replaceSelections(bD);bG=bC[0].anchor}q.registerController.pushText(bH.registerName,"delete",bK,bH.linewise,bE.visualBlock);return Z(bJ,bG)},indent:function(bJ,bI,bC){var bG=bJ.state.vim;var bK=bC[0].anchor.line;var bE=bG.visualBlock?bC[bC.length-1].anchor.line:bC[0].head.line;var bD=(bG.visualMode)?bI.repeat:1;if(bI.linewise){bE--}for(var bH=bK;bH<=bE;bH++){for(var bF=0;bF<bD;bF++){bJ.indentLine(bH,bI.indentRight)}}return a3.moveToFirstNonWhiteSpaceCharacter(bJ,bC[0].anchor)},changeCase:function(bN,bM,bC,bJ,bG){var bD=bN.getSelections();var bE=[];var bF=bM.toLower;for(var bH=0;bH<bD.length;bH++){var bK=bD[bH];var bO="";if(bF===true){bO=bK.toLowerCase()}else{if(bF===false){bO=bK.toUpperCase()}else{for(var bI=0;bI<bK.length;bI++){var bL=bK.charAt(bI);bO+=A(bL)?bL.toLowerCase():bL.toUpperCase()}}}bE.push(bO)}bN.replaceSelections(bE);if(bM.shouldMoveCursor){return bG}else{if(!bN.state.vim.visualMode&&bM.linewise&&bC[0].anchor.line+1==bC[0].head.line){return a3.moveToFirstNonWhiteSpaceCharacter(bN,bJ)}else{if(bM.linewise){return bJ}else{return aw(bC[0].anchor,bC[0].head)}}}},yank:function(bC,bH,bD,bF){var bE=bC.state.vim;var bI=bC.getSelection();var bG=bE.visualMode?aw(bE.sel.anchor,bE.sel.head,bD[0].head,bD[0].anchor):bF;q.registerController.pushText(bH.registerName,"yank",bI,bH.linewise,bE.visualBlock);return bG}};function bj(bC,bD){K[bC]=bD}var p={jumpListWalk:function(bC,bE,bF){if(bF.visualMode){return}var bH=bE.repeat;var bG=bE.forward;var bD=q.jumpList;var bJ=bD.move(bC,bG?bH:-bH);var bI=bJ?bJ.find():undefined;bI=bI?bI:bC.getCursor();bC.setCursor(bI)},scroll:function(bK,bE,bG){if(bG.visualMode){return}var bC=bE.repeat||1;var bJ=bK.defaultTextHeight();var bI=bK.getScrollInfo().top;var bL=bJ*bC;var bH=bE.forward?bI+bL:bI-bL;var bM=C(bK.getCursor());var bF=bK.charCoords(bM,"local");if(bE.forward){if(bH>bF.top){bM.line+=(bH-bF.top)/bJ;bM.line=Math.ceil(bM.line);bK.setCursor(bM);bF=bK.charCoords(bM,"local");bK.scrollTo(null,bF.top)}else{bK.scrollTo(null,bH)}}else{var bD=bH+bK.getScrollInfo().clientHeight;if(bD<bF.bottom){bM.line-=(bF.bottom-bD)/bJ;bM.line=Math.floor(bM.line);bK.setCursor(bM);bF=bK.charCoords(bM,"local");bK.scrollTo(null,bF.bottom-bK.getScrollInfo().clientHeight)}else{bK.scrollTo(null,bH)}}},scrollToCursor:function(bD,bE){var bH=bD.getCursor().line;var bF=bD.charCoords(c(bH,0),"local");var bC=bD.getScrollInfo().clientHeight;var bI=bF.top;var bG=bF.bottom-bI;switch(bE.position){case"center":bI=bI-(bC/2)+bG;break;case"bottom":bI=bI-bC+bG*1.4;break;case"top":bI=bI+bG*0.4;break}bD.scrollTo(null,bI)},replayMacro:function(bC,bD,bE){var bF=bD.selectedCharacter;var bG=bD.repeat;var bH=q.macroModeState;if(bF=="@"){bF=bH.latestRegister}while(bG--){H(bC,bE,bH,bF)}},enterMacroRecordMode:function(bC,bD){var bF=q.macroModeState;var bE=bD.selectedCharacter;bF.enterMacroRecordMode(bC,bE)},enterInsertMode:function(bD,bE,bF){if(bD.getOption("readOnly")){return}bF.insertMode=true;bF.insertModeRepeat=bE&&bE.repeat||1;var bH=(bE)?bE.insertAt:null;var bI=bF.sel;var bG=bE.head||bD.getCursor("head");var bC=bD.listSelections().length;if(bH=="eol"){bG=c(bG.line,aX(bD,bG.line))}else{if(bH=="charAfter"){bG=D(bG,0,1)}else{if(bH=="firstNonBlank"){bG=a3.moveToFirstNonWhiteSpaceCharacter(bD,bG)}else{if(bH=="startOfSelectedArea"){if(!bF.visualBlock){if(bI.head.line<bI.anchor.line){bG=bI.head}else{bG=c(bI.anchor.line,0)}}else{bG=c(Math.min(bI.head.line,bI.anchor.line),Math.min(bI.head.ch,bI.anchor.ch));bC=Math.abs(bI.head.line-bI.anchor.line)+1}}else{if(bH=="endOfSelectedArea"){if(!bF.visualBlock){if(bI.head.line>=bI.anchor.line){bG=D(bI.head,0,1)}else{bG=c(bI.anchor.line,0)}}else{bG=c(Math.min(bI.head.line,bI.anchor.line),Math.max(bI.head.ch+1,bI.anchor.ch));bC=Math.abs(bI.head.line-bI.anchor.line)+1}}else{if(bH=="inplace"){if(bF.visualMode){return}}}}}}}bD.setOption("keyMap","vim-insert");bD.setOption("disableInput",false);if(bE&&bE.replace){bD.toggleOverwrite(true);bD.setOption("keyMap","vim-replace");b.signal(bD,"vim-mode-change",{mode:"replace"})}else{bD.setOption("keyMap","vim-insert");b.signal(bD,"vim-mode-change",{mode:"insert"})}if(!q.macroModeState.isPlaying){bD.on("change",bi);b.on(bD.getInputField(),"keydown",W)}if(bF.visualMode){aT(bD)}aU(bD,bG,bC)},toggleVisualMode:function(bC,bD,bE){var bH=bD.repeat;var bF=bC.getCursor();var bG;if(!bE.visualMode){bE.visualMode=true;bE.visualLine=!!bD.linewise;bE.visualBlock=!!bD.blockwise;bG=Z(bC,c(bF.line,bF.ch+bH-1),true);bE.sel={anchor:bF,head:bG};b.signal(bC,"vim-mode-change",{mode:"visual",subMode:bE.visualLine?"linewise":bE.visualBlock?"blockwise":""});M(bC);aR(bC,bE,"<",aw(bF,bG));aR(bC,bE,">",ba(bF,bG))}else{if(bE.visualLine^bD.linewise||bE.visualBlock^bD.blockwise){bE.visualLine=!!bD.linewise;bE.visualBlock=!!bD.blockwise;b.signal(bC,"vim-mode-change",{mode:"visual",subMode:bE.visualLine?"linewise":bE.visualBlock?"blockwise":""});M(bC)}else{aT(bC)}}},reselectLastSelection:function(bC,bH,bE){var bD=bE.lastSelection;if(bE.visualMode){bh(bC,bE)}if(bD){var bF=bD.anchorMark.find();var bG=bD.headMark.find();if(!bF||!bG){return}bE.sel={anchor:bF,head:bG};bE.visualMode=true;bE.visualLine=bD.visualLine;bE.visualBlock=bD.visualBlock;M(bC);aR(bC,bE,"<",aw(bF,bG));aR(bC,bE,">",ba(bF,bG));b.signal(bC,"vim-mode-change",{mode:"visual",subMode:bE.visualLine?"linewise":bE.visualBlock?"blockwise":""})}},joinLines:function(bJ,bD,bF){var bI,bL;if(bF.visualMode){bI=bJ.getCursor("anchor");bL=bJ.getCursor("head");if(aO(bL,bI)){var bH=bL;bL=bI;bI=bH}bL.ch=aX(bJ,bL.line)-1}else{var bC=Math.max(bD.repeat,2);bI=bJ.getCursor();bL=Z(bJ,c(bI.line+bC-1,Infinity))}var bE=0;for(var bG=bI.line;bG<bL.line;bG++){bE=aX(bJ,bI.line);var bH=c(bI.line+1,aX(bJ,bI.line+1));var bM=bJ.getRange(bI,bH);bM=bM.replace(/\n\s*/g," ");bJ.replaceRange(bM,bI,bH)}var bK=c(bI.line,bE);if(bF.visualMode){aT(bJ,false)}bJ.setCursor(bK)},newLineAndEnterInsertMode:function(bC,bD,bE){bE.insertMode=true;var bF=C(bC.getCursor());if(bF.line===bC.firstLine()&&!bD.after){bC.replaceRange("\n",c(bC.firstLine(),0));bC.setCursor(bC.firstLine(),0)}else{bF.line=(bD.after)?bF.line:bF.line-1;bF.ch=aX(bC,bF.line);bC.setCursor(bF);var bG=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bG(bC)}this.enterInsertMode(bC,{repeat:bD.repeat},bE)},paste:function(bQ,bP,bY){var bJ=C(bQ.getCursor());var bD=q.registerController.getRegister(bP.registerName);var bT=bD.toString();if(!bT){return}if(bP.matchIndent){var bV=bQ.getOption("tabSize");var bK=function(b5){var b4=(b5.split("\t").length-1);var b3=(b5.split(" ").length-1);return b4*bV+b3*1};var b0=bQ.getLine(bQ.getCursor().line);var bS=bK(b0.match(/^\s*/)[0]);var bC=bT.replace(/\n$/,"");var bH=bT!==bC;var bN=bK(bT.match(/^\s*/)[0]);var bT=bC.replace(/^\s*/gm,function(b3){var b4=bS+(bK(b3)-bN);if(b4<0){return""}else{if(bQ.getOption("indentWithTabs")){var b5=Math.floor(b4/bV);return Array(b5+1).join("\t")}else{return Array(b4+1).join(" ")}}});bT+=bH?"\n":""}if(bP.repeat>1){var bT=Array(bP.repeat+1).join(bT)}var bM=bD.linewise;var bO=bD.blockwise;if(bM){if(bY.visualMode){bT=bY.visualLine?bT.slice(0,-1):"\n"+bT.slice(0,bT.length-1)+"\n"}else{if(bP.after){bT="\n"+bT.slice(0,bT.length-1);bJ.ch=aX(bQ,bJ.line)}else{bJ.ch=0}}}else{if(bO){bT=bT.split("\n");for(var bZ=0;bZ<bT.length;bZ++){bT[bZ]=(bT[bZ]=="")?" ":bT[bZ]}}bJ.ch+=bP.after?1:0}var bG;var bU;if(bY.visualMode){bY.lastPastedText=bT;var bF;var b2=a7(bQ,bY);var bW=b2[0];var bE=b2[1];var bX=bQ.getSelection();var bL=bQ.listSelections();var bI=new Array(bL.length).join("1").split("1");if(bY.lastSelection){bF=bY.lastSelection.headMark.find()}q.registerController.unnamedRegister.setText(bX);if(bO){bQ.replaceSelections(bI);bE=c(bW.line+bT.length-1,bW.ch);bQ.setCursor(bW);F(bQ,bE);bQ.replaceSelections(bT);bG=bW}else{if(bY.visualBlock){bQ.replaceSelections(bI);bQ.setCursor(bW);bQ.replaceRange(bT,bW,bW);bG=bW}else{bQ.replaceRange(bT,bW,bE);bG=bQ.posFromIndex(bQ.indexFromPos(bW)+bT.length-1)}}if(bF){bY.lastSelection.headMark=bQ.setBookmark(bF)}if(bM){bG.ch=0}}else{if(bO){bQ.setCursor(bJ);for(var bZ=0;bZ<bT.length;bZ++){var bR=bJ.line+bZ;if(bR>bQ.lastLine()){bQ.replaceRange("\n",c(bR,0))}var b1=aX(bQ,bR);if(b1<bJ.ch){aY(bQ,bR,bJ.ch)}}bQ.setCursor(bJ);F(bQ,c(bJ.line+bT.length-1,bJ.ch));bQ.replaceSelections(bT);bG=bJ}else{bQ.replaceRange(bT,bJ);if(bM&&bP.after){bG=c(bJ.line+1,a1(bQ.getLine(bJ.line+1)))}else{if(bM&&!bP.after){bG=c(bJ.line,a1(bQ.getLine(bJ.line)))}else{if(!bM&&bP.after){bU=bQ.indexFromPos(bJ);bG=bQ.posFromIndex(bU+bT.length-1)}else{bU=bQ.indexFromPos(bJ);bG=bQ.posFromIndex(bU+bT.length)}}}}}if(bY.visualMode){aT(bQ,false)}bQ.setCursor(bG)},undo:function(bC,bD){bC.operation(function(){ax(bC,b.commands.undo,bD.repeat)();bC.setCursor(bC.getCursor("anchor"))})},redo:function(bC,bD){ax(bC,b.commands.redo,bD.repeat)()},setRegister:function(bE,bC,bD){bD.inputState.registerName=bC.selectedCharacter},setMark:function(bC,bD,bE){var bF=bD.selectedCharacter;aR(bC,bE,bF,bC.getCursor())},replace:function(bK,bE,bG){var bF=bE.selectedCharacter;var bJ=bK.getCursor();var bI;var bL;var bD=bK.listSelections();if(bG.visualMode){bJ=bK.getCursor("start");bL=bK.getCursor("end")}else{var bM=bK.getLine(bJ.line);bI=bJ.ch+bE.repeat;if(bI>bM.length){bI=bM.length}bL=c(bJ.line,bI)}if(bF=="\n"){if(!bG.visualMode){bK.replaceRange("",bJ,bL)}(b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent)(bK)}else{var bC=bK.getRange(bJ,bL);bC=bC.replace(/[^\n]/g,bF);if(bG.visualBlock){var bH=new Array(bK.getOption("tabSize")+1).join(" ");bC=bK.getSelection();bC=bC.replace(/\t/g,bH).replace(/[^\n]/g,bF).split("\n");bK.replaceSelections(bC)}else{bK.replaceRange(bC,bJ,bL)}if(bG.visualMode){bJ=aO(bD[0].anchor,bD[0].head)?bD[0].anchor:bD[0].head;bK.setCursor(bJ);aT(bK,false)}else{bK.setCursor(D(bL,0,-1))}}},incrementNumberToken:function(bM,bD){var bN=bM.getCursor();var bI=bM.getLine(bN.line);var bP=/-?\d+/g;var bH;var bC;var bG;var bO;var bE;while((bH=bP.exec(bI))!==null){bE=bH[0];bC=bH.index;bG=bC+bE.length;if(bN.ch<bG){break}}if(!bD.backtrack&&(bG<=bN.ch)){return}if(bE){var bL=bD.increase?1:-1;var bF=parseInt(bE)+(bL*bD.repeat);var bK=c(bN.line,bC);var bJ=c(bN.line,bG);bO=bF.toString();bM.replaceRange(bO,bK,bJ)}else{return}bM.setCursor(c(bN.line,bC+bO.length-1))},repeatLastEdit:function(bD,bE,bF){var bC=bF.lastEditInputState;if(!bC){return}var bG=bE.repeat;if(bG&&bE.repeatIsExplicit){bF.lastEditInputState.repeatOverride=bG}else{bG=bF.lastEditInputState.repeatOverride||bG}x(bD,bF,bG,false)},exitInsertMode:v};function bq(bC,bD){p[bC]=bD}function Z(bD,bH,bF){var bE=Math.min(Math.max(bD.firstLine(),bH.line),bD.lastLine());var bC=aX(bD,bE)-1;bC=(bF)?bC+1:bC;var bG=Math.min(Math.max(0,bH.ch),bC);return c(bE,bG)}function bk(bD){var bC={};for(var bE in bD){if(bD.hasOwnProperty(bE)){bC[bE]=bD[bE]}}return bC}function D(bD,bC,bE){if(typeof bC==="object"){bE=bC.ch;bC=bC.line}return c(bD.line+bC,bD.ch+bE)}function bf(bC,bD){return{line:bD.line-bC.line,ch:bD.line-bC.line}}function bm(bK,bI,bC,bG){var bF,bJ=[],bH=[];for(var bE=0;bE<bI.length;bE++){var bD=bI[bE];if(bC=="insert"&&bD.context!="insert"||bD.context&&bD.context!=bC||bG.operator&&bD.type=="action"||!(bF=R(bK,bD.keys))){continue}if(bF=="partial"){bJ.push(bD)}if(bF=="full"){bH.push(bD)}}return{partial:bJ.length&&bJ,full:bH.length&&bH}}function R(bF,bC){if(bC.slice(-11)=="<character>"){var bD=bC.length-11;var bG=bF.slice(0,bD);var bE=bC.slice(0,bD);return bG==bE&&bF.length>bD?"full":bE.indexOf(bG)==0?"partial":false}else{return bF==bC?"full":bC.indexOf(bF)==0?"partial":false}}function Q(bE){var bD=/^.*(<[\w\-]+>)$/.exec(bE);var bC=bD?bD[1]:bE.slice(-1);if(bC.length>1){switch(bC){case"<CR>":bC="\n";break;case"<Space>":bC=" ";break;default:break}}return bC}function ax(bC,bD,bE){return function(){for(var bF=0;bF<bE;bF++){bD(bC)}}}function C(bC){return c(bC.line,bC.ch)}function bz(bD,bC){return bD.ch==bC.ch&&bD.line==bC.line}function aO(bD,bC){if(bD.line<bC.line){return true}if(bD.line==bC.line&&bD.ch<bC.ch){return true}return false}function aw(bD,bC){if(arguments.length>2){bC=aw.apply(undefined,Array.prototype.slice.call(arguments,1))}return aO(bD,bC)?bD:bC}function ba(bD,bC){if(arguments.length>2){bC=ba.apply(undefined,Array.prototype.slice.call(arguments,1))}return aO(bD,bC)?bC:bD}function av(bF,bE,bD){var bG=aO(bF,bE);var bC=aO(bE,bD);return bG&&bC}function aX(bC,bD){return bC.getLine(bD).length}function a9(bC){if(bC.trim){return bC.trim()}return bC.replace(/^\s+|\s+$/g,"")}function g(bC){return bC.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function aY(bC,bG,bF){var bE=aX(bC,bG);var bD=new Array(bF-bE+1).join(" ");bC.setCursor(c(bG,bE));bC.replaceRange(bD,bC.getCursor())}function F(bK,bD){var bF=[],bE=bK.listSelections();var bG=C(bK.clipPos(bD));var bV=!bz(bD,bG);var bI=bK.getCursor("head");var bU=u(bE,bI);var bL=bz(bE[bU].head,bE[bU].anchor);var bT=bE.length-1;var bJ=bT-bU>bU?bT:0;var bH=bE[bJ].anchor;var bQ=Math.min(bH.line,bG.line);var bC=Math.max(bH.line,bG.line);var bM=bH.ch,bN=bG.ch;var bS=bE[bJ].head.ch-bM;var bP=bN-bM;if(bS>0&&bP<=0){bM++;if(!bV){bN--}}else{if(bS<0&&bP>=0){bM--;if(!bL){bN++}}else{if(bS<0&&bP==-1){bM--;bN++}}}for(var bO=bQ;bO<=bC;bO++){var bR={anchor:new c(bO,bM),head:new c(bO,bN)};bF.push(bR)}bU=bG.line==bC?bF.length-1:0;bK.setSelections(bF);bD.ch=bN;bH.ch=bM;return bH}function aU(bD,bF,bC){var bH=[];for(var bE=0;bE<bC;bE++){var bG=D(bF,bE,0);bH.push({anchor:bG,head:bG})}bD.setSelections(bH,0)}function u(bD,bH,bC){for(var bE=0;bE<bD.length;bE++){var bF=bC!="head"&&bz(bD[bE].anchor,bH);var bG=bC!="anchor"&&bz(bD[bE].head,bH);if(bF||bG){return bE}}return -1}function a7(bD,bF){var bE=bF.lastSelection;var bC=function(){var bI=bD.listSelections();var bL=bI[0];var bH=bI[bI.length-1];var bJ=aO(bL.anchor,bL.head)?bL.anchor:bL.head;var bK=aO(bH.anchor,bH.head)?bH.head:bH.anchor;return[bJ,bK]};var bG=function(){var bR=bD.getCursor();var bS=bD.getCursor();var bM=bE.visualBlock;if(bM){var bJ=bM.width;var bT=bM.height;bS=c(bR.line+bT,bR.ch+bJ);var bK=[];for(var bN=bR.line;bN<bS.line;bN++){var bO=c(bN,bR.ch);var bQ=c(bN,bS.ch);var bP={anchor:bO,head:bQ};bK.push(bP)}bD.setSelections(bK)}else{var bI=bE.anchorMark.find();var bL=bE.headMark.find();var bU=bL.line-bI.line;var bH=bL.ch-bI.ch;bS={line:bS.line+bU,ch:bU?bS.ch:bH+bS.ch};if(bE.visualLine){bR=c(bR.line,0);bS=c(bS.line,aX(bD,bS.line))}bD.setSelection(bR,bS)}return[bR,bS]};if(!bF.visualMode){return bG()}else{return bC()}}function bh(bC,bD){var bE=bD.sel.anchor;var bF=bD.sel.head;if(bD.lastPastedText){bF=bC.posFromIndex(bC.indexFromPos(bE)+bD.lastPastedText.length);bD.lastPastedText=null}bD.lastSelection={anchorMark:bC.setBookmark(bE),headMark:bC.setBookmark(bF),anchor:C(bE),head:C(bF),visualMode:bD.visualMode,visualLine:bD.visualLine,visualBlock:bD.visualBlock}}function t(bC,bI,bD){var bH=bC.state.vim.sel;var bG=bH.head;var bE=bH.anchor;var bF;if(aO(bD,bI)){bF=bD;bD=bI;bI=bF}if(aO(bG,bE)){bG=aw(bI,bG);bE=ba(bE,bD)}else{bE=aw(bI,bE);bG=ba(bG,bD);bG=D(bG,0,-1);if(bG.ch==-1&&bG.line!=bC.firstLine()){bG=c(bG.line-1,aX(bC,bG.line-1))}}return[bE,bG]}function M(bC,bF,bG){var bD=bC.state.vim;bF=bF||bD.sel;var bG=bG||bD.visualLine?"line":bD.visualBlock?"block":"char";var bE=bB(bC,bF,bG);bC.setSelections(bE.ranges,bE.primary);ac(bC)}function bB(bQ,bF,bL,bE){var bN=C(bF.head);var bK=C(bF.anchor);if(bL=="char"){var bO=!bE&&!aO(bF.head,bF.anchor)?1:0;var bG=aO(bF.head,bF.anchor)?1:0;bN=D(bF.head,0,bO);bK=D(bF.anchor,0,bG);return{ranges:[{anchor:bK,head:bN}],primary:0}}else{if(bL=="line"){if(!aO(bF.head,bF.anchor)){bK.ch=0;var bP=bQ.lastLine();if(bN.line>bP){bN.line=bP}bN.ch=aX(bQ,bN.line)}else{bN.ch=0;bK.ch=aX(bQ,bK.line)}return{ranges:[{anchor:bK,head:bN}],primary:0}}else{if(bL=="block"){var bM=Math.min(bK.line,bN.line),bI=Math.min(bK.ch,bN.ch),bC=Math.max(bK.line,bN.line),bR=Math.max(bK.ch,bN.ch)+1;var bS=bC-bM+1;var bH=bN.line==bM?0:bS-1;var bD=[];for(var bJ=0;bJ<bS;bJ++){bD.push({anchor:c(bM+bJ,bI),head:c(bM+bJ,bR)})}return{ranges:bD,primary:bH}}}}}function e(bC){var bD=bC.getCursor("head");if(bC.getSelection().length==1){bD=aw(bD,bC.getCursor("anchor"))}return bD}function aT(bC,bE){var bD=bC.state.vim;if(bE!==false){bC.setCursor(Z(bC,bD.sel.head))}bh(bC,bD);bD.visualMode=false;bD.visualLine=false;bD.visualBlock=false;b.signal(bC,"vim-mode-change",{mode:"normal"});if(bD.fakeCursor){bD.fakeCursor.clear()}}function al(bD,bC,bH){var bG=bD.getRange(bC,bH);if(/\n\s*$/.test(bG)){var bF=bG.split("\n");bF.pop();var bE;for(var bE=bF.pop();bF.length>0&&bE&&T(bE);bE=bF.pop()){bH.line--;bH.ch=0}if(bE){bH.line--;bH.ch=aX(bD,bH.line)}else{bH.ch=0}}}function be(bD,bC,bE){bC.ch=0;bE.ch=0;bE.line++}function a1(bD){if(!bD){return 0}var bC=bD.search(/\S/);return bC==-1?bD.length:bC}function aF(bI,bH,bE,bG,bN){var bK=e(bI);var bO=bI.getLine(bK.line);var bJ=bK.ch;var bF=bN?ao[0]:bw[0];while(!bF(bO.charAt(bJ))){bJ++;if(bJ>=bO.length){return null}}if(bG){bF=bw[0]}else{bF=ao[0];if(!bF(bO.charAt(bJ))){bF=ao[1]}}var bD=bJ,bC=bJ;while(bF(bO.charAt(bD))&&bD<bO.length){bD++}while(bF(bO.charAt(bC))&&bC>=0){bC--}bC++;if(bH){var bL=bD;while(/\s/.test(bO.charAt(bD))&&bD<bO.length){bD++}if(bL==bD){var bM=bC;while(/\s/.test(bO.charAt(bC-1))&&bC>0){bC--}if(!bC){bC=bM}}}return{start:c(bK.line,bC),end:c(bK.line,bD)}}function bg(bC,bD,bE){if(!bz(bD,bE)){q.jumpList.add(bC,bD,bE)}}function aE(bC,bD){q.lastChararacterSearch.increment=bC;q.lastChararacterSearch.forward=bD.forward;q.lastChararacterSearch.selectedCharacter=bD.selectedCharacter}var S={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var aZ={bracket:{isComplete:function(bC){if(bC.nextCh===bC.symb){bC.depth++;if(bC.depth>=1){return true}}else{if(bC.nextCh===bC.reverseSymb){bC.depth--}}return false}},section:{init:function(bC){bC.curMoveThrough=true;bC.symb=(bC.forward?"]":"[")===bC.symb?"{":"}"},isComplete:function(bC){return bC.index===0&&bC.nextCh===bC.symb}},comment:{isComplete:function(bD){var bC=bD.lastCh==="*"&&bD.nextCh==="/";bD.lastCh=bD.nextCh;return bC}},method:{init:function(bC){bC.symb=(bC.symb==="m"?"{":"}");bC.reverseSymb=bC.symb==="{"?"}":"{"},isComplete:function(bC){if(bC.nextCh===bC.symb){return true}return false}},preprocess:{init:function(bC){bC.index=0},isComplete:function(bD){if(bD.nextCh==="#"){var bC=bD.lineText.match(/#(\w+)/)[1];if(bC==="endif"){if(bD.forward&&bD.depth===0){return true}bD.depth++}else{if(bC==="if"){if(!bD.forward&&bD.depth===0){return true}bD.depth--}}if(bC==="else"&&bD.depth===0){return true}}return false}}};function bt(bL,bD,bG,bE){var bO=C(bL.getCursor());var bM=bG?1:-1;var bF=bG?bL.lineCount():-1;var bK=bO.ch;var bQ=bO.line;var bJ=bL.getLine(bQ);var bC={lineText:bJ,nextCh:bJ.charAt(bK),lastCh:null,index:bK,symb:bE,reverseSymb:(bG?{")":"(","}":"{"}:{"(":")","{":"}"})[bE],forward:bG,depth:0,curMoveThrough:false};var bH=S[bE];if(!bH){return bO}var bP=aZ[bH].init;var bN=aZ[bH].isComplete;if(bP){bP(bC)}while(bQ!==bF&&bD){bC.index+=bM;bC.nextCh=bC.lineText.charAt(bC.index);if(!bC.nextCh){bQ+=bM;bC.lineText=bL.getLine(bQ)||"";if(bM>0){bC.index=0}else{var bI=bC.lineText.length;bC.index=(bI>0)?(bI-1):0}bC.nextCh=bC.lineText.charAt(bC.index)}if(bN(bC)){bO.line=bQ;bO.ch=bC.index;bD--}}if(bC.nextCh||bC.curMoveThrough){return c(bQ,bC.index)}return bO}function bv(bM,bN,bF,bK,bL){var bG=bN.line;var bJ=bN.ch;var bQ=bM.getLine(bG);var bD=bF?1:-1;var bH=bK?bw:ao;if(bL&&bQ==""){bG+=bD;bQ=bM.getLine(bG);if(!f(bM,bG)){return null}bJ=(bF)?0:bQ.length}while(true){if(bL&&bQ==""){return{from:0,to:0,line:bG}}var bI=(bD>0)?bQ.length:-1;var bP=bI,bO=bI;while(bJ!=bI){var bC=false;for(var bE=0;bE<bH.length&&!bC;++bE){if(bH[bE](bQ.charAt(bJ))){bP=bJ;while(bJ!=bI&&bH[bE](bQ.charAt(bJ))){bJ+=bD}bO=bJ;bC=bP!=bO;if(bP==bN.ch&&bG==bN.line&&bO==bP+bD){continue}else{return{from:Math.min(bP,bO+1),to:Math.max(bP,bO),line:bG}}}}if(!bC){bJ+=bD}}bG+=bD;if(!f(bM,bG)){return null}bQ=bM.getLine(bG);bJ=(bD>0)?0:bQ.length}throw new Error("The impossible happened.")}function aD(bM,bO,bD,bH,bQ,bK){var bI=C(bO);var bJ=[];if(bH&&!bQ||!bH&&bQ){bD++}var bL=!(bH&&bQ);for(var bF=0;bF<bD;bF++){var bC=bv(bM,bO,bH,bK,bL);if(!bC){var bE=aX(bM,bM.lastLine());bJ.push(bH?{line:bM.lastLine(),from:bE,to:bE}:{line:0,from:0,to:0});break}bJ.push(bC);bO=c(bC.line,bH?(bC.to-1):bC.from)}var bG=bJ.length!=bD;var bN=bJ[0];var bP=bJ.pop();if(bH&&!bQ){if(!bG&&(bN.from!=bI.ch||bN.line!=bI.line)){bP=bJ.pop()}return c(bP.line,bP.from)}else{if(bH&&bQ){return c(bP.line,bP.to-1)}else{if(!bH&&bQ){if(!bG&&(bN.to!=bI.ch||bN.line!=bI.line)){bP=bJ.pop()}return c(bP.line,bP.to)}else{return c(bP.line,bP.from)}}}}function bs(bH,bD,bF,bG){var bJ=bH.getCursor();var bC=bJ.ch;var bI;for(var bE=0;bE<bD;bE++){var bK=bH.getLine(bJ.line);bI=bb(bC,bK,bG,bF,true);if(bI==-1){return null}bC=bI}return c(bH.getCursor().line,bI)}function aj(bC,bE){var bD=bC.getCursor().line;return Z(bC,c(bD,bE-1))}function aR(bC,bD,bE,bF){if(!J(bE,aG)){return}if(bD.marks[bE]){bD.marks[bE].clear()}bD.marks[bE]=bC.setBookmark(bF)}function bb(bH,bD,bG,bE,bF){var bC;if(bE){bC=bD.indexOf(bG,bH+1);if(bC!=-1&&!bF){bC-=1}}else{bC=bD.lastIndexOf(bG,bH-1);if(bC!=-1&&!bF){bC+=1}}return bC}function bo(bQ,bN,bD,bE,bP){var bR=bN.line;var bI=bQ.firstLine();var bO=bQ.lastLine();var bC,bF,bL=bR;function bK(bS){return !bQ.getLine(bS)}function bM(bT,bS,bU){if(bU){return bK(bT)!=bK(bT+bS)}return !bK(bT)&&bK(bT+bS)}if(bE){while(bI<=bL&&bL<=bO&&bD>0){if(bM(bL,bE)){bD--}bL+=bE}return new c(bL,0)}var bH=bQ.state.vim;if(bH.visualLine&&bM(bR,1,true)){var bJ=bH.sel.anchor;if(bM(bJ.line,-1,true)){if(!bP||bJ.line!=bR){bR+=1}}}var bG=bK(bR);for(bL=bR;bL<=bO&&bD;bL++){if(bM(bL,1,true)){if(!bP||bK(bL)!=bG){bD--}}}bF=new c(bL,0);if(bL>bO&&!bG){bG=true}else{bP=false}for(bL=bR;bL>bI;bL--){if(!bP||bK(bL)==bG||bL==bR){if(bM(bL,-1,true)){break}}}bC=new c(bL,0);return{start:bC,end:bF}}function m(bM,bK,bE,bL){var bN=bK,bD,bG;var bJ=({"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/})[bE];var bF=({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"})[bE];var bC=bM.getLine(bN.line).charAt(bN.ch);var bH=bC===bF?1:0;bD=bM.scanForBracket(c(bN.line,bN.ch+bH),-1,null,{bracketRegex:bJ});bG=bM.scanForBracket(c(bN.line,bN.ch+bH),1,null,{bracketRegex:bJ});if(!bD||!bG){return{start:bN,end:bN}}bD=bD.pos;bG=bG.pos;if((bD.line==bG.line&&bD.ch>bG.ch)||(bD.line>bG.line)){var bI=bD;bD=bG;bG=bI}if(bL){bG.ch+=1}else{bD.ch+=1}return{start:bD,end:bG}}function aQ(bL,bJ,bE,bK){var bM=C(bJ);var bN=bL.getLine(bM.line);var bI=bN.split("");var bD,bF,bG,bH;var bC=bI.indexOf(bE);if(bM.ch<bC){bM.ch=bC}else{if(bC<bM.ch&&bI[bM.ch]==bE){bF=bM.ch;--bM.ch}}if(bI[bM.ch]==bE&&!bF){bD=bM.ch+1}else{for(bG=bM.ch;bG>-1&&!bD;bG--){if(bI[bG]==bE){bD=bG+1}}}if(bD&&!bF){for(bG=bD,bH=bI.length;bG<bH&&!bF;bG++){if(bI[bG]==bE){bF=bG}}}if(!bD||!bF){return{start:bM,end:bM}}if(bK){--bD;++bF}return{start:c(bM.line,bD),end:c(bM.line,bF)}}aL("pcre",true,"boolean");function ad(){}ad.prototype={getQuery:function(){return q.query},setQuery:function(bC){q.query=bC},getOverlay:function(){return this.searchOverlay},setOverlay:function(bC){this.searchOverlay=bC},isReversed:function(){return q.isReversed},setReversed:function(bC){q.isReversed=bC},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(bC){this.annotate=bC}};function aI(bC){var bD=bC.state.vim;return bD.searchState_||(bD.searchState_=new ad())}function ab(bC,bF,bG,bD,bE){if(bC.openDialog){bC.openDialog(bF,bD,{bottom:true,value:bE.value,onKeyDown:bE.onKeyDown,onKeyUp:bE.onKeyUp,selectValueOnOpen:false})}else{bD(prompt(bG,""))}}function w(bE){var bD=ak(bE)||[];if(!bD.length){return[]}var bF=[];if(bD[0]!==0){return}for(var bC=0;bC<bD.length;bC++){if(typeof bD[bC]=="number"){bF.push(bE.substring(bD[bC]+1,bD[bC+1]))}}return bF}function ak(bF){var bD=false;var bE=[];for(var bC=0;bC<bF.length;bC++){var bG=bF.charAt(bC);if(!bD&&bG=="/"){bE.push(bC)}bD=!bD&&(bG=="\\")}return bE}function br(bJ){var bK="|(){";var bG="}";var bH=false;var bD=[];for(var bE=-1;bE<bJ.length;bE++){var bI=bJ.charAt(bE)||"";var bC=bJ.charAt(bE+1)||"";var bF=(bC&&bK.indexOf(bC)!=-1);if(bH){if(bI!=="\\"||!bF){bD.push(bI)}bH=false}else{if(bI==="\\"){bH=true;if(bC&&bG.indexOf(bC)!=-1){bF=true}if(!bF||bC==="\\"){bD.push(bI)}}else{bD.push(bI);if(bF&&bC!=="\\"){bD.push("\\")}}}}return bD.join("")}function bu(bF){var bE=false;var bC=[];for(var bD=-1;bD<bF.length;bD++){var bH=bF.charAt(bD)||"";var bG=bF.charAt(bD+1)||"";if(bE){bC.push(bH);bE=false}else{if(bH==="\\"){bE=true;if((ag(bG)||bG==="$")){bC.push("$")}else{if(bG!=="/"&&bG!=="\\"){bC.push("\\")}}}else{if(bH==="$"){bC.push("$")}bC.push(bH);if(bG==="/"){bC.push("\\")}}}}return bC.join("")}function af(bE){var bD=new b.StringStream(bE);var bC=[];while(!bD.eol()){while(bD.peek()&&bD.peek()!="\\"){bC.push(bD.next())}if(bD.match("\\/",true)){bC.push("/")}else{if(bD.match("\\\\",true)){bC.push("\\")}else{bC.push(bD.next())}}}return bC.join("")}function aA(bG,bE,bJ){var bI=q.registerController.getRegister("/");bI.setText(bG);if(bG instanceof RegExp){return bG}var bH=ak(bG);var bK;var bD;if(!bH.length){bK=bG}else{bK=bG.substring(0,bH[0]);var bC=bG.substring(bH[0]);bD=(bC.indexOf("i")!=-1)}if(!bK){return null}if(!n("pcre")){bK=br(bK)}if(bJ){bE=(/^[^A-Z]*$/).test(bK)}var bF=new RegExp(bK,(bE||bD)?"i":undefined);return bF}function bn(bC,bD){if(bC.openNotification){bC.openNotification('<span style="color: red">'+bD+"</span>",{bottom:true,duration:5000})}else{alert(bD)}}function aH(bD,bE){var bC="";if(bD){bC+='<span style="font-family: monospace">'+bD+"</span>"}bC+='<input type="text"/> <span style="color: #888">';if(bE){bC+='<span style="color: #888">';bC+=bE;bC+="</span>"}return bC}var P="(Javascript regexp)";function a2(bD,bE){var bF=(bE.prefix||"")+" "+(bE.desc||"");var bC=aH(bE.prefix,bE.desc);ab(bD,bC,bF,bE.onClose,bE)}function X(bD,bC){if(bD instanceof RegExp&&bC instanceof RegExp){var bF=["global","multiline","ignoreCase","source"];for(var bE=0;bE<bF.length;bE++){var bG=bF[bE];if(bD[bG]!==bC[bG]){return false}}return true}return false}function by(bC,bH,bD,bE){if(!bH){return}var bG=aI(bC);var bF=aA(bH,!!bD,!!bE);if(!bF){return}aK(bC,bF);if(X(bF,bG.getQuery())){return bF}bG.setQuery(bF);return bF}function aN(bD){if(bD.source.charAt(0)=="^"){var bC=true}return{token:function(bF){if(bC&&!bF.sol()){bF.skipToEnd();return}var bE=bF.match(bD,false);if(bE){if(bE[0].length==0){bF.next();return"searching"}if(!bF.sol()){bF.backUp(1);if(!bD.exec(bF.next()+bE[0])){bF.next();return null}}bF.match(bD);return"searching"}while(!bF.eol()){bF.next();if(bF.match(bD,false)){break}}},query:bD}}function aK(bC,bF){var bE=aI(bC);var bD=bE.getOverlay();if(!bD||bF!=bD.query){if(bD){bC.removeOverlay(bD)}bD=aN(bF);bC.addOverlay(bD);if(bC.showMatchesOnScrollbar){if(bE.getScrollbarAnnotate()){bE.getScrollbarAnnotate().clear()}bE.setScrollbarAnnotate(bC.showMatchesOnScrollbar(bF))}bE.setOverlay(bD)}}function bA(bC,bD,bF,bE){if(bE===undefined){bE=1}return bC.operation(function(){var bJ=bC.getCursor();var bI=bC.getSearchCursor(bF,bJ);for(var bG=0;bG<bE;bG++){var bH=bI.find(bD);if(bG==0&&bH&&bz(bI.from(),bJ)){bH=bI.find(bD)}if(!bH){bI=bC.getSearchCursor(bF,(bD)?c(bC.lastLine()):c(bC.firstLine(),0));if(!bI.find(bD)){return}}}return bI.from()})}function aM(bC){var bD=aI(bC);bC.removeOverlay(aI(bC).getOverlay());bD.setOverlay(null);if(bD.getScrollbarAnnotate()){bD.getScrollbarAnnotate().clear();bD.setScrollbarAnnotate(null)}}function ae(bE,bD,bC){if(typeof bE!="number"){bE=bE.line}if(bD instanceof Array){return J(bE,bD)}else{if(bC){return(bE>=bD&&bE<=bC)}else{return bE==bD}}}function bd(bC){var bF=bC.getScrollInfo();var bE=6;var bI=10;var bH=bC.coordsChar({left:0,top:bE+bF.top},"local");var bD=bF.clientHeight-bI+bF.top;var bG=bC.coordsChar({left:0,top:bD},"local");return{top:bH.line,bottom:bG.line}}var B=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var Y=function(){this.buildCommandMap_()};Y.prototype={processCommand:function(bC,bD,bF){var bE=this;bC.operation(function(){bC.curOp.isVimOp=true;bE._processCommand(bC,bD,bF)})},_processCommand:function(bN,bM,bD){var bH=bN.state.vim;var bE=q.registerController.getRegister(":");var bK=bE.toString();if(bH.visualMode){aT(bN)}var bC=new b.StringStream(bM);bE.setText(bM);var bG=bD||{};bG.input=bM;try{this.parseInput_(bN,bC,bG)}catch(bL){bn(bN,bL);throw bL}var bF;var bJ;if(!bG.commandName){if(bG.line!==undefined){bJ="move"}}else{bF=this.matchCommand_(bG.commandName);if(bF){bJ=bF.name;if(bF.excludeFromCommandHistory){bE.setText(bK)}this.parseCommandArgs_(bC,bG,bF);if(bF.type=="exToKey"){for(var bI=0;bI<bF.toKeys.length;bI++){b.Vim.handleKey(bN,bF.toKeys[bI],"mapping")}return}else{if(bF.type=="exToEx"){this.processCommand(bN,bF.toInput);return}}}}if(!bJ){bn(bN,'Not an editor command ":'+bM+'"');return}try{a6[bJ](bN,bG);if((!bF||!bF.possiblyAsync)&&bG.callback){bG.callback()}}catch(bL){bn(bN,bL);throw bL}},parseInput_:function(bD,bE,bC){bE.eatWhile(":");if(bE.eat("%")){bC.line=bD.firstLine();bC.lineEnd=bD.lastLine()}else{bC.line=this.parseLineSpec_(bD,bE);if(bC.line!==undefined&&bE.eat(",")){bC.lineEnd=this.parseLineSpec_(bD,bE)}}var bF=bE.match(/^(\w+)/);if(bF){bC.commandName=bF[1]}else{bC.commandName=bE.match(/.*/)[0]}return bC},parseLineSpec_:function(bC,bD){var bE=bD.match(/^(\d+)/);if(bE){return parseInt(bE[1],10)-1}switch(bD.next()){case".":return bC.getCursor().line;case"$":return bC.lastLine();case"'":var bF=bC.state.vim.marks[bD.next()];if(bF&&bF.find()){return bF.find().line}throw new Error("Mark not set");default:bD.backUp(1);return undefined}},parseCommandArgs_:function(bD,bG,bF){if(bD.eol()){return}bG.argString=bD.match(/.*/)[0];var bE=bF.argDelimiter||/\s+/;var bC=a9(bG.argString).split(bE);if(bC.length&&bC[0]){bG.args=bC}},matchCommand_:function(bD){for(var bC=bD.length;bC>0;bC--){var bE=bD.substring(0,bC);if(this.commandMap_[bE]){var bF=this.commandMap_[bE];if(bF.name.indexOf(bD)===0){return bF}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var bD=0;bD<B.length;bD++){var bE=B[bD];var bC=bE.shortName||bE.name;this.commandMap_[bC]=bE}},map:function(bD,bG,bC){if(bD!=":"&&bD.charAt(0)==":"){if(bC){throw Error("Mode not supported for ex mappings")}var bF=bD.substring(1);if(bG!=":"&&bG.charAt(0)==":"){this.commandMap_[bF]={name:bF,type:"exToEx",toInput:bG.substring(1),user:true}}else{this.commandMap_[bF]={name:bF,type:"exToKey",toKeys:bG,user:true}}}else{if(bG!=":"&&bG.charAt(0)==":"){var bE={keys:bD,type:"keyToEx",exArgs:{input:bG.substring(1)},user:true};if(bC){bE.context=bC}a.unshift(bE)}else{var bE={keys:bD,type:"keyToKey",toKeys:bG,user:true};if(bC){bE.context=bC}a.unshift(bE)}}},unmap:function(bD,bC){if(bD!=":"&&bD.charAt(0)==":"){if(bC){throw Error("Mode not supported for ex mappings")}var bF=bD.substring(1);if(this.commandMap_[bF]&&this.commandMap_[bF].user){delete this.commandMap_[bF];return}}else{var bG=bD;for(var bE=0;bE<a.length;bE++){if(bG==a[bE].keys&&a[bE].context===bC&&a[bE].user){a.splice(bE,1);return}}}throw Error("No such mapping.")}};var a6={colorscheme:function(bC,bD){if(!bD.args||bD.args.length<1){bn(bC,bC.getOption("theme"));return}bC.setOption("theme",bD.args[0])},map:function(bC,bF,bD){var bE=bF.args;if(!bE||bE.length<2){if(bC){bn(bC,"Invalid mapping: "+bF.input)}return}l.map(bE[0],bE[1],bD)},imap:function(bC,bD){this.map(bC,bD,"insert")},nmap:function(bC,bD){this.map(bC,bD,"normal")},vmap:function(bC,bD){this.map(bC,bD,"visual")},unmap:function(bC,bF,bD){var bE=bF.args;if(!bE||bE.length<1){if(bC){bn(bC,"No such mapping: "+bF.input)}return}l.unmap(bE[0],bD)},move:function(bC,bD){bc.processCommand(bC,bC.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:bD.line+1})},set:function(bL,bH){var bF=bH.args;var bI=bH.setCfg||{};if(!bF||bF.length<1){if(bL){bn(bL,"Invalid mapping: "+bH.input)}return}var bJ=bF[0].split("=");var bD=bJ[0];var bK=bJ[1];var bG=false;if(bD.charAt(bD.length-1)=="?"){if(bK){throw Error("Trailing characters: "+bH.argString)}bD=bD.substring(0,bD.length-1);bG=true}if(bK===undefined&&bD.substring(0,2)=="no"){bD=bD.substring(2);bK=false}var bE=au[bD]&&au[bD].type=="boolean";if(bE&&bK==undefined){bK=true}if(!bE&&bK===undefined||bG){var bC=n(bD,bL,bI);if(bC===true||bC===false){bn(bL," "+(bC?"":"no")+bD)}else{bn(bL,"  "+bD+"="+bC)}}else{aJ(bD,bK,bL,bI)}},setlocal:function(bC,bD){bD.setCfg={scope:"local"};this.set(bC,bD)},setglobal:function(bC,bD){bD.setCfg={scope:"global"};this.set(bC,bD)},registers:function(bH,bD){var bJ=bD.args;var bG=q.registerController.registers;var bE="----------Registers----------<br><br>";if(!bJ){for(var bC in bG){var bK=bG[bC].toString();if(bK.length){bE+='"'+bC+"    "+bK+"<br>"}}}else{var bC;bJ=bJ.join("");for(var bF=0;bF<bJ.length;bF++){bC=bJ.charAt(bF);if(!q.registerController.isValidRegister(bC)){continue}var bI=bG[bC]||new bp();bE+='"'+bC+"    "+bI.toString()+"<br>"}}bn(bH,bE)},sort:function(bL,bV){var bM,bF,bD,bE;function bG(){if(bV.argString){var bZ=new b.StringStream(bV.argString);if(bZ.eat("!")){bM=true}if(bZ.eol()){return}if(!bZ.eatSpace()){return"Invalid arguments"}var b1=bZ.match(/[a-z]+/);if(b1){b1=b1[0];bF=b1.indexOf("i")!=-1;bD=b1.indexOf("u")!=-1;var bY=b1.indexOf("d")!=-1&&1;var b0=b1.indexOf("x")!=-1&&1;var bX=b1.indexOf("o")!=-1&&1;if(bY+b0+bX>1){return"Invalid arguments"}bE=bY&&"decimal"||b0&&"hex"||bX&&"octal"}if(bZ.eatSpace()&&bZ.match(/\/.*\//)){"patterns not supported"}}}var bH=bG();if(bH){bn(bL,bH+": "+bV.argString);return}var bQ=bV.line||bL.firstLine();var bU=bV.lineEnd||bV.line||bL.lastLine();if(bQ==bU){return}var bK=c(bQ,0);var bS=c(bU,aX(bL,bU));var bP=bL.getRange(bK,bS).split("\n");var bI=(bE=="decimal")?/(-?)([\d]+)/:(bE=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(bE=="octal")?/([0-7]+)/:null;var bJ=(bE=="decimal")?10:(bE=="hex")?16:(bE=="octal")?8:null;var bN=[],bR=[];if(bE){for(var bT=0;bT<bP.length;bT++){if(bI.exec(bP[bT])){bN.push(bP[bT])}else{bR.push(bP[bT])}}}else{bR=bP}function bW(bY,bX){if(bM){var bZ;bZ=bY;bY=bX;bX=bZ}if(bF){bY=bY.toLowerCase();bX=bX.toLowerCase()}var b1=bE&&bI.exec(bY);var b0=bE&&bI.exec(bX);if(!b1){return bY<bX?-1:1}b1=parseInt((b1[1]+b1[2]).toLowerCase(),bJ);b0=parseInt((b0[1]+b0[2]).toLowerCase(),bJ);return b1-b0}bN.sort(bW);bR.sort(bW);bP=(!bM)?bR.concat(bN):bN.concat(bR);if(bD){var bO=bP;var bC;bP=[];for(var bT=0;bT<bO.length;bT++){if(bO[bT]!=bC){bP.push(bO[bT])}bC=bO[bT]}}bL.replaceRange(bP.join("\n"),bK,bS)},global:function(bP,bG){var bD=bG.argString;if(!bD){bn(bP,"Regular Expression missing from global");return}var bJ=(bG.line!==undefined)?bG.line:bP.firstLine();var bH=bG.lineEnd||bG.line||bP.lastLine();var bO=w(bD);var bR=bD,bF;if(bO.length){bR=bO[0];bF=bO.slice(1,bO.length).join("/")}if(bR){try{by(bP,bR,true,true)}catch(bM){bn(bP,"Invalid regex: "+bR);return}}var bN=aI(bP).getQuery();var bC=[],bL="";for(var bI=bJ;bI<=bH;bI++){var bE=bN.test(bP.getLine(bI));if(bE){bC.push(bI+1);bL+=bP.getLine(bI)+"<br>"}}if(!bF){bn(bP,bL);return}var bK=0;var bQ=function(){if(bK<bC.length){var bS=bC[bK]+bF;l.processCommand(bP,bS,{callback:bQ})}bK++};bQ()},substitute:function(bJ,bR){if(!bJ.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var bS=bR.argString;var bM=bS?w(bS):[];var bK,bL="",bC,bD,bH;var bI=false;var bO=false;if(bM.length){bK=bM[0];bL=bM[1];if(bL!==undefined){if(n("pcre")){bL=af(bL)}else{bL=bu(bL)}q.lastSubstituteReplacePart=bL}bC=bM[2]?bM[2].split(" "):[]}else{if(bS&&bS.length){bn(bJ,"Substitutions should be of the form :s/pattern/replace/");return}}if(bC){bD=bC[0];bH=parseInt(bC[1]);if(bD){if(bD.indexOf("c")!=-1){bI=true;bD.replace("c","")}if(bD.indexOf("g")!=-1){bO=true;bD.replace("g","")}bK=bK+"/"+bD}}if(bK){try{by(bJ,bK,true,true)}catch(bQ){bn(bJ,"Invalid regex: "+bK);return}}bL=bL||q.lastSubstituteReplacePart;if(bL===undefined){bn(bJ,"No previous substitute regular expression");return}var bF=aI(bJ);var bG=bF.getQuery();var bN=(bR.line!==undefined)?bR.line:bJ.getCursor().line;var bP=bR.lineEnd||bN;if(bH){bN=bP;bP=bN+bH-1}var bT=Z(bJ,c(bN,0));var bE=bJ.getSearchCursor(bG,bT);a8(bJ,bI,bO,bN,bP,bE,bG,bL,bR.callback)},redo:b.commands.redo,undo:b.commands.undo,write:function(bC){if(b.commands.save){b.commands.save(bC)}else{bC.save()}},nohlsearch:function(bC){aM(bC)},delmarks:function(bM,bH){if(!bH.argString||!a9(bH.argString)){bn(bM,"Argument required");return}var bC=bM.state.vim;var bN=new b.StringStream(a9(bH.argString));while(!bN.eol()){bN.eatSpace();var bK=bN.pos;if(!bN.match(/[a-zA-Z]/,false)){bn(bM,"Invalid argument: "+bH.argString.substring(bK));return}var bE=bN.next();if(bN.match("-",true)){if(!bN.match(/[a-zA-Z]/,false)){bn(bM,"Invalid argument: "+bH.argString.substring(bK));return}var bF=bE;var bJ=bN.next();if(E(bF)&&E(bJ)||A(bF)&&A(bJ)){var bD=bF.charCodeAt(0);var bL=bJ.charCodeAt(0);if(bD>=bL){bn(bM,"Invalid argument: "+bH.argString.substring(bK));return}for(var bI=0;bI<=bL-bD;bI++){var bG=String.fromCharCode(bD+bI);delete bC.marks[bG]}}else{bn(bM,"Invalid argument: "+bF+"-");return}}else{delete bC.marks[bE]}}}};var l=new Y();function a8(bQ,bD,bF,bL,bJ,bE,bN,bH,bR){bQ.state.vim.exMode=true;var bI=false;var bP=bE.from();function bM(){bQ.operation(function(){while(!bI){bG();bK()}bO()})}function bG(){var bT=bQ.getRange(bE.from(),bE.to());var bS=bT.replace(bN,bH);bE.replace(bS)}function bK(){var bS;while(bS=bE.findNext()&&ae(bE.from(),bL,bJ)){if(!bF&&bP&&bE.from().line==bP.line){continue}bQ.scrollIntoView(bE.from(),30);bQ.setSelection(bE.from(),bE.to());bP=bE.from();bI=false;return}bI=true}function bO(bT){if(bT){bT()}bQ.focus();if(bP){bQ.setCursor(bP);var bS=bQ.state.vim;bS.exMode=false;bS.lastHPos=bS.lastHSPos=bP.ch}if(bR){bR()}}function bC(bV,bS,bW){b.e_stop(bV);var bT=b.keyName(bV);switch(bT){case"Y":bG();bK();break;case"N":bK();break;case"A":var bU=bR;bR=undefined;bQ.operation(bM);bR=bU;break;case"L":bG();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bO(bW);break}if(bI){bO(bW)}return true}bK();if(bI){bn(bQ,"No matches for "+bN.source);return}if(!bD){bM();if(bR){bR()}return}a2(bQ,{prefix:"replace with <strong>"+bH+"</strong> (y/n/a/q/l)",onKeyDown:bC})}b.keyMap.vim={attach:s,detach:h,call:a4};function v(bK){var bD=bK.state.vim;var bF=q.macroModeState;var bI=q.registerController.getRegister(".");var bC=bF.isPlaying;var bG=bF.lastInsertModeChanges;var bL=[];if(!bC){var bH=bG.inVisualBlock?bD.lastSelection.visualBlock.height:1;var bJ=bG.changes;var bL=[];var bE=0;while(bE<bJ.length){bL.push(bJ[bE]);if(bJ[bE] instanceof bl){bE++}else{bE+=bH}}bG.changes=bL;bK.off("change",bi);b.off(bK.getInputField(),"keydown",W)}if(!bC&&bD.insertModeRepeat>1){x(bK,bD,bD.insertModeRepeat-1,true);bD.lastEditInputState.repeatOverride=bD.insertModeRepeat}delete bD.insertModeRepeat;bD.insertMode=false;bK.setCursor(bK.getCursor().line,bK.getCursor().ch-1);bK.setOption("keyMap","vim");bK.setOption("disableInput",true);bK.toggleOverwrite(false);bI.setText(bG.changes.join(""));b.signal(bK,"vim-mode-change",{mode:"normal"});if(bF.isRecording){an(bF)}}function o(bC){a.push(bC)}function az(bH,bG,bE,bD,bC){var bI={keys:bH,type:bG};bI[bG]=bE;bI[bG+"Args"]=bD;for(var bF in bC){bI[bF]=bC[bF]}o(bI)}aL("insertModeEscKeysTimeout",200,"number");b.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(bC){var bD=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bD(bC)},fallthrough:["default"],attach:s,detach:h,call:a4};b.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:s,detach:h,call:a4};function H(bK,bE,bF,bC){var bM=q.registerController.getRegister(bC);var bD=bM.keyBuffer;var bI=0;bF.isPlaying=true;bF.replaySearchQueries=bM.searchQueries.slice(0);for(var bG=0;bG<bD.length;bG++){var bN=bD[bG];var bH,bL;while(bN){bH=(/<\w+-.+?>|<\w+>|./).exec(bN);bL=bH[0];bN=bN.substring(bH.index+bL.length);b.Vim.handleKey(bK,bL,"macro");if(bE.insertMode){var bJ=bM.insertModeChanges[bI++].changes;q.macroModeState.lastInsertModeChanges.changes=bJ;at(bK,bJ,1);v(bK)}}}bF.isPlaying=false}function I(bF,bC){if(bF.isPlaying){return}var bE=bF.latestRegister;var bD=q.registerController.getRegister(bE);if(bD){bD.pushText(bC)}}function an(bE){if(bE.isPlaying){return}var bD=bE.latestRegister;var bC=q.registerController.getRegister(bD);if(bC){bC.pushInsertModeChanges(bE.lastInsertModeChanges)}}function O(bF,bE){if(bF.isPlaying){return}var bD=bF.latestRegister;var bC=q.registerController.getRegister(bD);if(bC){bC.pushSearchQuery(bE)}}function bi(bD,bC){var bF=q.macroModeState;var bE=bF.lastInsertModeChanges;if(!bF.isPlaying){while(bC){bE.expectCursorActivityForChange=true;if(bC.origin=="+input"||bC.origin=="paste"||bC.origin===undefined){var bG=bC.text.join("\n");bE.changes.push(bG)}bC=bC.next}}}function aa(bC){var bD=bC.state.vim;if(bD.insertMode){var bF=q.macroModeState;if(bF.isPlaying){return}var bE=bF.lastInsertModeChanges;if(bE.expectCursorActivityForChange){bE.expectCursorActivityForChange=false}else{bE.changes=[]}}else{if(!bC.curOp.isVimOp){r(bC,bD)}}if(bD.visualMode){ac(bC)}}function ac(bC){var bD=bC.state.vim;var bF=Z(bC,C(bD.sel.head));var bE=D(bF,0,1);if(bD.fakeCursor){bD.fakeCursor.clear()}bD.fakeCursor=bC.markText(bF,bE,{className:"cm-animate-fat-cursor"})}function r(bC,bD){var bE=bC.getCursor("anchor");var bF=bC.getCursor("head");if(bD.visualMode&&!bC.somethingSelected()){aT(bC,false)}else{if(!bD.visualMode&&!bD.insertMode&&bC.somethingSelected()){bD.visualMode=true;bD.visualLine=false;b.signal(bC,"vim-mode-change",{mode:"visual"})}}if(bD.visualMode){var bG=!aO(bF,bE)?-1:0;var bH=aO(bF,bE)?-1:0;bF=D(bF,0,bG);bE=D(bE,0,bH);bD.sel={anchor:bE,head:bF};aR(bC,bD,"<",aw(bF,bE));aR(bC,bD,">",ba(bF,bE))}else{if(!bD.insertMode){bD.lastHPos=bC.getCursor().ch}}}function bl(bC){this.keyName=bC}function W(bG){var bF=q.macroModeState;var bE=bF.lastInsertModeChanges;var bD=b.keyName(bG);if(!bD){return}function bC(){bE.changes.push(new bl(bD));return true}if(bD.indexOf("Delete")!=-1||bD.indexOf("Backspace")!=-1){b.lookupKey(bD,"vim-insert",bC)}}function x(bK,bF,bD,bC){var bH=q.macroModeState;bH.isPlaying=true;var bL=!!bF.lastEditActionCommand;var bI=bF.inputState;function bE(){if(bL){bc.processAction(bK,bF,bF.lastEditActionCommand)}else{bc.evalInput(bK,bF)}}function bJ(bN){if(bH.lastInsertModeChanges.changes.length>0){bN=!bF.lastEditActionCommand?1:bN;var bM=bH.lastInsertModeChanges;at(bK,bM.changes,bN)}}bF.inputState=bF.lastEditInputState;if(bL&&bF.lastEditActionCommand.interlaceInsertRepeat){for(var bG=0;bG<bD;bG++){bE();bJ(1)}}else{if(!bC){bE()}bJ(bD)}bF.inputState=bI;if(bF.insertMode&&!bC){v(bK)}bH.isPlaying=false}function at(bN,bM,bD){function bJ(bP){if(typeof bP=="string"){b.commands[bP](bN)}else{bP(bN)}return true}var bL=bN.getCursor("head");var bC=q.macroModeState.lastInsertModeChanges.inVisualBlock;if(bC){var bH=bN.state.vim;var bE=bH.lastSelection;var bG=bf(bE.anchor,bE.head);aU(bN,bL,bG.line+1);bD=bN.listSelections().length;bN.setCursor(bL)}for(var bI=0;bI<bD;bI++){if(bC){bN.setCursor(D(bL,bI,0))}for(var bF=0;bF<bM.length;bF++){var bK=bM[bF];if(bK instanceof bl){b.lookupKey(bK.keyName,"vim-insert",bJ)}else{var bO=bN.getCursor();bN.replaceRange(bK,bO,bO)}}}if(bC){bN.setCursor(D(bL,0,1))}}z();return aP};b.Vim=d()});