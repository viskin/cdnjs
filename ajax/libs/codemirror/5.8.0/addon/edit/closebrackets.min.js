(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(f){var e={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var o=f.Pos;f.defineOption("autoCloseBrackets",false,function(i,s,r){if(r&&r!=f.Init){i.removeKeyMap(k);i.state.closeBrackets=null}if(s){i.state.closeBrackets=s;i.addKeyMap(k)}});function a(r,i){if(i=="pairs"&&typeof r=="string"){return r}if(typeof r=="object"&&r[i]!=null){return r[i]}return e[i]}var l=e.pairs+"`";var k={Backspace:d,Enter:b};for(var j=0;j<l.length;j++){k["'"+l.charAt(j)+"'"]=q(l.charAt(j))}function q(i){return function(r){return p(r,i)}}function n(i){var s=i.state.closeBrackets;if(!s){return null}var r=i.getModeAt(i.getCursor());return r.closeBrackets||s}function d(r){var t=n(r);if(!t||r.getOption("disableInput")){return f.Pass}var w=a(t,"pairs");var s=r.listSelections();for(var u=0;u<s.length;u++){if(!s[u].empty()){return f.Pass}var v=h(r,s[u].head);if(!v||w.indexOf(v)%2!=0){return f.Pass}}for(var u=s.length-1;u>=0;u--){var x=s[u].head;r.replaceRange("",o(x.line,x.ch-1),o(x.line,x.ch+1))}}function b(r){var t=n(r);var v=t&&a(t,"explode");if(!v||r.getOption("disableInput")){return f.Pass}var s=r.listSelections();for(var u=0;u<s.length;u++){if(!s[u].empty()){return f.Pass}var w=h(r,s[u].head);if(!w||v.indexOf(w)%2!=0){return f.Pass}}r.operation(function(){r.replaceSelection("\n\n",null);r.execCommand("goCharLeft");s=r.listSelections();for(var y=0;y<s.length;y++){var x=s[y].head.line;r.indentLine(x,null,true);r.indentLine(x+1,null,true)}})}function g(r){var i=f.cmpPos(r.anchor,r.head)>0;return{anchor:new o(r.anchor.line,r.anchor.ch+(i?-1:1)),head:new o(r.head.line,r.head.ch+(i?1:-1))}}function p(E,r){var z=n(E);if(!z||E.getOption("disableInput")){return f.Pass}var t=a(z,"pairs");var C=t.indexOf(r);if(C==-1){return f.Pass}var H=a(z,"triples");var D=t.charAt(C+1)==r;var s=E.listSelections();var u=C%2==0;var A,y;for(var w=0;w<s.length;w++){var x=s[w],G=x.head,B;var y=E.getRange(G,o(G.line,G.ch+1));if(u&&!x.empty()){B="surround"}else{if((D||!u)&&y==r){if(H.indexOf(r)>=0&&E.getRange(G,o(G.line,G.ch+3))==r+r+r){B="skipThree"}else{B="skip"}}else{if(D&&G.ch>1&&H.indexOf(r)>=0&&E.getRange(o(G.line,G.ch-2),G)==r+r&&(G.ch<=2||E.getRange(o(G.line,G.ch-3),o(G.line,G.ch-2))!=r)){B="addFour"}else{if(D){if(!f.isWordChar(y)&&m(E,G,r)){B="both"}else{return f.Pass}}else{if(u&&(E.getLine(G.line).length==G.ch||c(y,t)||/\s/.test(y))){B="both"}else{return f.Pass}}}}}if(!A){A=B}else{if(A!=B){return f.Pass}}}var v=C%2?t.charAt(C-1):r;var F=C%2?r:t.charAt(C+1);E.operation(function(){if(A=="skip"){E.execCommand("goCharRight")}else{if(A=="skipThree"){for(var J=0;J<3;J++){E.execCommand("goCharRight")}}else{if(A=="surround"){var I=E.getSelections();for(var J=0;J<I.length;J++){I[J]=v+I[J]+F}E.replaceSelections(I,"around");I=E.listSelections().slice();for(var J=0;J<I.length;J++){I[J]=g(I[J])}E.setSelections(I)}else{if(A=="both"){E.replaceSelection(v+F,null);E.triggerElectric(v+F);E.execCommand("goCharLeft")}else{if(A=="addFour"){E.replaceSelection(v+v+v+v,"before");E.execCommand("goCharRight")}}}}}})}function c(i,r){var s=r.lastIndexOf(i);return s>-1&&s%2==1}function h(i,s){var r=i.getRange(o(s.line,s.ch-1),o(s.line,s.ch+1));return r.length==2?r:null}function m(i,w,u){var r=i.getLine(w.line);var t=i.getTokenAt(w);if(/\bstring2?\b/.test(t.type)){return false}var v=new f.StringStream(r.slice(0,w.ch)+u+r.slice(w.ch),4);v.pos=v.start=t.start;for(;;){var s=i.getMode().token(v,t.state);if(v.pos>=w.ch+1){return/\bstring2?\b/.test(s)}v.start=v.pos}}});