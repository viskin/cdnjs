(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../../mode/sql/sql"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../../mode/sql/sql"],a)}else{a(CodeMirror)}}})(function(n){var f;var p;var h;var i={QUERY_DIV:";",ALIAS_KEYWORD:"AS"};var m=n.Pos;function b(t){var u=t.doc.modeOption;if(u==="sql"){u="text/x-sql"}return n.resolveMode(u).keywords}function a(t){return typeof t=="string"?t:t.text}function g(v,u){if(!v.slice){return v[u]}for(var t=v.length-1;t>=0;t--){if(a(v[t])==u){return v[t]}}}function e(u){var t={};for(var v in u){if(u.hasOwnProperty(v)){t[v]=u[v]}}return t}function c(u,w){var t=u.length;var v=a(w).substr(0,t);return u.toUpperCase()===v.toUpperCase()}function d(t,v,w,u){for(var x in w){if(!w.hasOwnProperty(x)){continue}if(w.slice){x=w[x]}if(c(v,x)){t.push(u(x))}}}function j(t){if(t.charAt(0)=="."){t=t.substr(1)}return t.replace(/`/g,"")}function o(u){var t=a(u).split(".");for(var v=0;v<t.length;v++){t[v]="`"+t[v]+"`"}var w=t.join(".");if(typeof u=="string"){return w}u=e(u);u.text=w;return u}function r(D,w,F,B){var C=false;var x=[];var t=w.start;var G=true;while(G){G=(w.string.charAt(0)==".");C=C||(w.string.charAt(0)=="`");t=w.start;x.unshift(j(w.string));w=B.getTokenAt(m(D.line,w.start));if(w.string=="."){G=true;w=B.getTokenAt(m(D.line,w.start))}}var A=x.join(".");d(F,A,f,function(H){return C?o(H):H});d(F,A,p,function(H){return C?o(H):H});A=x.pop();var E=x.join(".");var z=false;var y=E;if(!g(f,E)){var u=E;E=k(E,B);if(E!==u){z=true}}var v=g(f,E);if(v&&v.columns){v=v.columns}if(v){d(F,A,v,function(H){var I=E;if(z==true){I=y}if(typeof H=="string"){H=I+"."+H}else{H=e(H);H.text=I+"."+H.text}return C?o(H):H})}return t}function s(u,w){if(!u){return}var t=/[,;]/g;var x=u.split(" ");for(var v=0;v<x.length;v++){w(x[v]?x[v].replace(t,""):"")}}function q(t){return t.line+t.ch/Math.pow(10,6)}function l(t){return m(Math.floor(t),+t.toString().split(".").pop())}function k(y,z){var H=z.doc;var u=H.getValue();var t=y.toUpperCase();var A="";var I="";var x=[];var G={start:m(0,0),end:m(z.lastLine(),z.getLineHandle(z.lastLine()).length)};var w=u.indexOf(i.QUERY_DIV);while(w!=-1){x.push(H.posFromIndex(w));w=u.indexOf(i.QUERY_DIV,w+1)}x.unshift(m(0,0));x.push(m(z.lastLine(),z.getLineHandle(z.lastLine()).text.length));var E=0;var B=q(z.getCursor());for(var v=0;v<x.length;v++){var F=q(x[v]);if(B>E&&B<=F){G={start:l(E),end:l(F)};break}E=F}var C=H.getRange(G.start,G.end,false);for(var v=0;v<C.length;v++){var D=C[v];s(D,function(K){var J=K.toUpperCase();if(J===t&&g(f,A)){I=A}if(J!==i.ALIAS_KEYWORD){A=K}});if(I){break}}return I}n.registerHelper("hint","sql",function(x,B){f=(B&&B.tables)||{};var u=B&&B.defaultTable;var y=B&&B.disableKeywords;p=u&&g(f,u);h=h||b(x);if(u&&!p){p=k(u,x)}p=p||[];if(p.columns){p=p.columns}var z=x.getCursor();var C=[];var v=x.getTokenAt(z),t,w,A;if(v.end>z.ch){v.end=z.ch;v.string=v.string.slice(0,z.ch-v.start)}if(v.string.match(/^[.`\w@]\w*$/)){A=v.string;t=v.start;w=v.end}else{t=w=z.ch;A=""}if(A.charAt(0)=="."||A.charAt(0)=="`"){t=r(z,v,C,x)}else{d(C,A,f,function(D){return D});d(C,A,p,function(D){return D});if(!y){d(C,A,h,function(D){return D.toUpperCase()})}}return{list:C,from:m(z.line,t),to:m(z.line,w)}})});