(function(t,n,e,r){"use strict";function i(t,n){return"object"!=typeof n&&(n=n()),Object.keys(n).forEach(function(e){t[e]=n[e]}),t}function o(t){return{from:function(n){return t.prototype=Object.create(n.prototype),t.prototype.constructor=t,{extend:function(e){i(t.prototype,"object"!=typeof e?e(n.prototype):e)}}}}}function c(t,n){return n(t)}function s(n){function h(){e&&xt.on("versionchange",function(n){xt.close(),n.newVersion&&t.location.reload(!0)})}function p(t){this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function g(t,n,e,r){if(0==t){Object.keys(ht).forEach(function(t){M(n,t,ht[t].primKey,ht[t].indexes)});var i=xt._createTransaction(wt,dt,ht);i.idbtrans=n,i.idbtrans.onerror=T(e,["populating database"]),i.on("error").subscribe(e),q.newPSD(function(){q.PSD.trans=i;try{xt.on("populate").fire(i)}catch(t){r.onerror=n.onerror=function(t){t.preventDefault()};try{n.abort()}catch(o){}n.db.close(),e(t)}})}else{var o=[],s=lt.filter(function(n){return n._cfg.version===t})[0];if(!s)throw new ft("Dexie specification of currently installed DB version is missing");ht=xt._dbSchema=s._cfg.dbschema;var a=!1,u=lt.filter(function(n){return n._cfg.version>t});u.forEach(function(t){var n=ht,r=t._cfg.dbschema;ht=xt._dbSchema=r;var i=C(n,r);i.add.forEach(function(t){o.push(function(n,e){M(n,t[0],t[1].primKey,t[1].indexes),e()})}),i.change.forEach(function(t){if(t.recreate)throw new ft("Not yet support for changing primary key");o.push(function(n,e){var r=n.objectStore(t.name);t.add.forEach(function(t){W(r,t)}),t.change.forEach(function(t){r.deleteIndex(t.name),W(r,t)}),t.del.forEach(function(t){r.deleteIndex(t)}),e()})}),t._cfg.contentUpgrade&&o.push(function(n,i){a=!0;var o=xt._createTransaction(wt,[].slice.call(n.db.objectStoreNames,0),r);o.idbtrans=n;var s=0;o._promise=c(o._promise,function(t){return function(n,e,r){function o(t){return function(){t.apply(this,arguments),0==--s&&i()}}return++s,t.call(this,n,function(t,n,r){arguments[0]=o(t),arguments[1]=o(n),e.apply(this,arguments)},r)}}),n.onerror=T(e,["running upgrader function for version",t._cfg.version]),o.on("error").subscribe(e),t._cfg.contentUpgrade(o),0===s&&i()}),a&&it()||o.push(function(t,n){U(r,t),n()})});var f=function(){try{o.length?o.shift()(n,f):R(ht,n)}catch(t){r.onerror=n.onerror=function(t){t.preventDefault()},n.abort(),n.db.close(),e(t)}};f()}}function C(t,n){var e={del:[],add:[],change:[]};for(var r in t)n[r]||e.del.push(r);for(var r in n){var i=t[r],o=n[r];if(i){var c={name:r,def:n[r],recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!=o.primKey.src)c.recreate=!0,e.change.push(c);else{var s=i.indexes.reduce(function(t,n){return t[n.name]=n,t},{}),a=o.indexes.reduce(function(t,n){return t[n.name]=n,t},{});for(var u in s)a[u]||c.del.push(u);for(var u in a){var f=s[u],h=a[u];f?f.src!=h.src&&c.change.push(h):c.add.push(h)}(c.recreate||c.del.length>0||c.add.length>0||c.change.length>0)&&e.change.push(c)}}else e.add.push([r,o])}return e}function M(t,n,e,r){var i=t.db.createObjectStore(n,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return r.forEach(function(t){W(i,t)}),i}function R(t,n){Object.keys(t).forEach(function(e){n.db.objectStoreNames.contains(e)||M(n,e,t[e].primKey,t[e].indexes)})}function U(t,n){for(var e=0;e<n.db.objectStoreNames.length;++e){var i=n.db.objectStoreNames[e];null!==t[i]&&t[i]!==r||n.db.deleteObjectStore(i)}}function W(t,n){t.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function L(t,n){return q.reject(A(new ft("Table "+n[0]+" not part of transaction. Original Scope Function Source: "+s.Promise.PSD.trans.scopeFunc.toString())))}function J(t,n,e,r){this.name=t,this.schema=e,this.hook=pt[t]?pt[t].hook:m(null,{creating:[l,a],reading:[f,u],updating:[d,a],deleting:[v,a]}),this._tpf=n,this._collClass=r||Y}function V(t,n,e,r){J.call(this,t,n,e,r||z)}function H(t,n,e,r){function i(t,n,e,r){return o._promise(t,e,r)}var o=this;this.db=xt,this.mode=t,this.storeNames=n,this.idbtrans=null,this.on=m(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=e,r&&(this.parent=r),this._tpf=i,this.tables=Object.create(yt);for(var c=n.length-1;-1!==c;--c){var s=n[c],a=xt._tableFactory(t,e[s],i);this.tables[s]=a,this[s]||(this[s]=a)}}function G(t,n,e){this._ctx={table:t,index:":id"===n?null:n,collClass:t._collClass,or:e}}function Y(t,n){var e=t._ctx;this._ctx={table:e.table,index:e.index,isPrimKey:!e.index||e.table.schema.primKey.keyPath&&e.index===e.table.schema.primKey.keyPath,range:n,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:1/0,error:null,or:e.or}}function z(){Y.apply(this,arguments)}function Q(t,n){return t._cfg.version-n._cfg.version}function X(t,n,e,r,i,o){e.forEach(function(e){var c=xt._tableFactory(r,i[e],n);t.forEach(function(t){t[e]||(o?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return q.PSD&&q.PSD.trans?q.PSD.trans.tables[e]:c}}):t[e]=c)})})}function Z(t){t.forEach(function(t){for(var n in t)t[n]instanceof J&&delete t[n]})}function $(t,n,e,r,i,o){var c=q.PSD;o=o||u,t.onerror||(t.onerror=T(i)),n?t.onsuccess=x(function(c){var s=t.result;if(s){var a=function(){s["continue"]()};n(s,function(t){a=t},r,i)&&e(o(s.value),s,function(t){a=t}),a()}else r()},i,c):t.onsuccess=x(function(n){var i=t.result;if(i){var c=function(){i["continue"]()};e(o(i.value),i,function(t){c=t}),c()}else r()},i,c)}function tt(t){var n=[];return t.split(",").forEach(function(t){t=t.trim();var e=t.replace("&","").replace("++","").replace("*",""),r=0!==e.indexOf("[")?e:t.substring(t.indexOf("[")+1,t.indexOf("]")).split("+");n.push(new B(e,r||null,-1!=t.indexOf("&"),-1!=t.indexOf("*"),-1!=t.indexOf("++"),Array.isArray(r),-1!=r.indexOf(".")))}),n}function nt(t,n){return n>t?-1:t>n?1:0}function et(t,n){return n>t?1:t>n?-1:0}function rt(t,n){return t?n?function(){return t.apply(this,arguments)&&n.apply(this,arguments)}:t:n}function it(){return navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0}function ot(){if(xt.verno=vt.version/10,xt._dbSchema=ht={},dt=[].slice.call(vt.objectStoreNames,0),0!=dt.length){var t=vt.transaction(dt,"readonly");dt.forEach(function(n){for(var e=t.objectStore(n),r=new B(e.keyPath,e.keyPath||"",!1,!1,!!e.autoIncrement,!1,e.keyPath&&-1!=e.keyPath.indexOf(".")),i=[],o=0;o<e.indexNames.length;++o){var c=e.index(e.indexNames[o]),s=new B(c.name,c.keyPath,!!c.unique,!!c.multiEntry,!1,"string"!=typeof c.keyPath,-1!=c.keyPath.indexOf("."));i.push(s)}ht[n]=new N(n,r,i,{})}),X([pt],xt._transPromiseFactory,Object.keys(ht),wt,ht)}}var ct=s.dependencies,st=ct.indexedDB,at=ct.IDBKeyRange,ut=(ct.IDBTransaction,ct.DOMError,ct.TypeError),ft=ct.Error,ht=this._dbSchema={},lt=[],dt=[],pt={},yt={},vt=null,bt=!0,mt=null,gt=!1,_t="readonly",wt="readwrite",xt=this,Pt=[],kt=!1;this.version=function(t){if(vt)throw new ft("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=lt.filter(function(n){return n._cfg.version==t})[0];return n?n:(n=new p(t),lt.push(n),lt.sort(Q),n)},i(p.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?i(this._cfg.storesSource,t):t;var n={};lt.forEach(function(t){i(n,t._cfg.storesSource)});var e=this._cfg.dbschema={};return this._parseStoresSpec(n,e),ht=xt._dbSchema=e,Z([pt,xt,yt]),X([yt],L,Object.keys(e),wt,e),X([pt,xt,this._cfg.tables],xt._transPromiseFactory,Object.keys(e),wt,e,!0),dt=Object.keys(e),this},upgrade:function(t){var n=this;return w(function(){t(xt._createTransaction(wt,Object.keys(n._cfg.dbschema),n._cfg.dbschema))}),this._cfg.contentUpgrade=t,this},_parseStoresSpec:function(t,n){Object.keys(t).forEach(function(e){if(null!==t[e]){var r={},i=tt(t[e]),o=i.shift();if(o.multi)throw new ft("Primary key cannot be multi-valued");o.keyPath&&o.auto&&k(r,o.keyPath,0),i.forEach(function(t){if(t.auto)throw new ft("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new ft("Index must have a name and cannot be an empty string");k(r,t.keyPath,t.compound?t.keyPath.map(function(){return""}):"")}),n[e]=new N(e,o,i,r)}})}}),this._allTables=pt,this._tableFactory=function(t,n,e){return t===_t?new J(n.name,e,n,Y):new V(n.name,e,n)},this._createTransaction=function(t,n,e,r){return new H(t,n,e,r)},this._transPromiseFactory=function(t,n,e){if(!bt||q.PSD&&q.PSD.letThrough){var r=xt._createTransaction(t,n,ht);return r._promise(t,function(t,n){e(function(n){r.complete(function(){t(n)})},n,r)})}var i=new q(function(r,o){Pt.push({resume:function(){var c=xt._transPromiseFactory(t,n,e);i.onuncatched=c.onuncatched,c.then(r,o)}})});return i},this._whenReady=function(t){return new q(!bt||q.PSD&&q.PSD.letThrough?t:function(n,e){w(function(){new q(function(){t(n,e)})}),Pt.push({resume:function(){t(n,e)}})})},this.verno=0,this.open=function(){return new q(function(t,e){function r(t){gt=!1,mt=t,bt=!1,e(mt),Pt.forEach(function(t){t.resume()}),Pt=[]}if(vt||gt)throw new ft("Database already opened or being opened");try{if(mt=null,gt=!0,0==lt.length&&(kt=!0),!st)throw new ft("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");var i=!1,o=kt?st.open(n):st.open(n,10*xt.verno);o.onerror=T(r,["opening database",n]),o.onblocked=function(t){xt.on("blocked").fire(t)},o.onupgradeneeded=function(t){if(kt&&!xt._allowEmptyDB){o.onerror=function(t){t.preventDefault()},o.transaction.abort(),o.result.close();var e=st.deleteDatabase(n);e.onsuccess=e.onerror=function(){r(new ft("Database '"+n+"' doesnt exist"))}}else 0==t.oldVersion&&(i=!0),o.transaction.onerror=T(r),g(t.oldVersion/10,o.transaction,r,o)},o.onsuccess=function(e){gt=!1,vt=o.result,kt&&ot(),vt.onversionchange=xt.on("versionchange").fire,I(function(t){return-1===t.indexOf(n)?t.push(n):void 0}),q.newPSD(function(){function n(){bt=!1,Pt.forEach(function(t){t.resume()}),Pt=[],t()}q.PSD.letThrough=!0;try{var e=xt.on.ready.fire();e&&"function"==typeof e.then?e.then(n,function(t){vt.close(),vt=null,r(t)}):_(n)}catch(i){r(i)}})}}catch(c){r(c)}})},this.close=function(){vt&&(vt.close(),vt=null,bt=!0,mt=null)},this["delete"]=function(){var t=arguments;return new q(function(e,r){function i(){xt.close();var t=st.deleteDatabase(n);t.onsuccess=function(){I(function(t){var e=t.indexOf(n);return e>=0?t.splice(e,1):void 0}),e()},t.onerror=T(r,["deleting",n]),t.onblocked=function(){xt.on("blocked").fire()}}if(t.length>0)throw new ft("Arguments not allowed in db.delete()");gt?Pt.push({resume:i}):i()})},this.backendDB=function(){return vt},this.isOpen=function(){return null!==vt},this.hasFailed=function(){return null!==mt},this.name=n,Object.defineProperty(this,"tables",{get:function(){return Object.keys(pt).map(function(t){return pt[t]})}}),this.on=m(this,"error","populate","blocked",{ready:[b,a],versionchange:[y,a]}),this.on.ready.subscribe=c(this.on.ready.subscribe,function(t){return function(n,e){function r(){return e||xt.on.ready.unsubscribe(r),n.apply(this,arguments)}t.call(this,r),xt.isOpen()&&(bt?Pt.push({resume:r}):r())}}),w(function(){xt.on("populate").fire(xt._createTransaction(wt,dt,ht)),xt.on("error").fire(new ft)}),this.transaction=function(t,n,e){function r(n,r){var o=null;try{if(a)throw a;o=xt._createTransaction(t,u,ht,i);var s=u.map(function(t){return o.tables[t]});s.push(o);var f,h=0;q.newPSD(function(){q.PSD.trans=o,o.scopeFunc=e,i&&(o.idbtrans=i.idbtrans,o._promise=c(o._promise,function(t){return function(n,e,r){function i(t){return function(n){var e=t(n);return 0==--h&&o.active&&(o.active=!1,o.on.complete.fire()),e}}return++h,t.call(this,n,function(t,n,r){return e(i(t),i(n),r)},r)}})),o.complete(function(){n(f)}),o.error(function(t){o.idbtrans.onerror=K,o.abort(),i&&(i.active=!1,i.on.error.fire(t));var n=r(t);i||n||xt.on.error.fire(t)}),f=e.apply(o,s)}),(!o.idbtrans||i&&0===h)&&o._nop()}catch(l){o&&o.idbtrans&&(o.idbtrans.onerror=K),o&&o.abort(),i&&i.on.error.fire(l),_(function(){r(l)||xt.on("error").fire(l)})}}n=[].slice.call(arguments,1,arguments.length-1),e=arguments[arguments.length-1];var i=q.PSD&&q.PSD.trans;-1!==t.indexOf("!")&&(i=null);var o=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");var s=Array.isArray(n[0])?n.reduce(function(t,n){return t.concat(n)}):n,a=null,u=s.map(function(t){return"string"==typeof t?t:(t instanceof J||(a=a||new ut("Invalid type. Arguments following mode must be instances of Table or String")),t.name)});return"r"==t||t==_t?t=_t:"rw"==t||t==wt?t=wt:a=new ft("Invalid transaction mode: "+t),i&&(a||(i.db!=xt&&(o?i=null:a=new ft("Current transaction bound to different database instance")),i&&i.mode===_t&&t===wt&&(o?i=null:a=a||new ft("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),i&&u.forEach(function(t){i.tables.hasOwnProperty(t)||(o?i=null:a=a||new ft("Table "+t+" not included in parent transaction. Parent Transaction function: "+i.scopeFunc.toString()))}))),i?i._promise(t,r,"lock"):xt._whenReady(r)},this.table=function(t){if(!kt&&!pt.hasOwnProperty(t))throw new ft("Table does not exist");return pt[t]},i(J.prototype,function(){function t(){throw new ft("Current Transaction is READONLY")}return{_trans:function(t,n,e){return this._tpf(t,[this.name],n,e)},_idbstore:function(t,n,e){var r=this;return this._tpf(t,[this.name],function(t,e,i){n(t,e,i.idbtrans.objectStore(r.name),i)},e)},get:function(t,n){var e=this;return w(function(){n(e.schema.instanceTemplate)}),this._idbstore(_t,function(n,r,i){var o=i.get(t);o.onerror=T(r,["getting",t,"from",e.name]),o.onsuccess=function(){n(e.hook.reading.fire(o.result))}}).then(n)},where:function(t){return new G(this,t)},count:function(t){return this.toCollection().count(t)},offset:function(t){return this.toCollection().offset(t)},limit:function(t){return this.toCollection().limit(t)},reverse:function(){return this.toCollection().reverse()},filter:function(t){return this.toCollection().and(t)},each:function(t){var n=this;return w(function(){t(n.schema.instanceTemplate)}),this._idbstore(_t,function(e,r,i){var o=i.openCursor();o.onerror=T(r,["calling","Table.each()","on",n.name]),$(o,null,t,e,r,n.hook.reading.fire)})},toArray:function(t){var n=this;return w(function(){t([n.schema.instanceTemplate])}),this._idbstore(_t,function(t,e,r){var i=[],o=r.openCursor();o.onerror=T(e,["calling","Table.toArray()","on",n.name]),$(o,null,function(t){i.push(t)},function(){t(i)},e,n.hook.reading.fire)}).then(t)},orderBy:function(t){return new this._collClass(new G(this,t))},toCollection:function(){return new this._collClass(new G(this))},mapToClass:function(t,n){this.schema.mappedClass=t;var e=Object.create(t.prototype);this.schema.primKey.keyPath&&(k(e,this.schema.primKey.keyPath,this.schema.primKey.auto?0:""),D(t.prototype,this.schema.primKey.keyPath)),n&&E(e,n),this.schema.instanceTemplate=e;var r=Object.setPrototypeOf?function(n){return n?(Object.setPrototypeOf(n,t.prototype),n):n}:function(n){if(!n)return n;var e=Object.create(t.prototype);for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t},defineClass:function(t){return this.mapToClass(s.defineClass(t),t)},add:t,put:t,"delete":t,clear:t,update:t}}),o(V).from(J).extend(function(){return{add:function(t,n){var e=this,i=this.hook.creating.fire;return this._idbstore(wt,function(o,c,s,u){var f={};if(i!==a){var h=n||(s.keyPath?P(t,s.keyPath):r),l=i.call(f,h,t,u);h===r&&l!==r&&(s.keyPath?k(t,s.keyPath,l):n=l)}var d=n?s.add(t,n):s.add(t);d.onerror=T(function(t){return f.onerror&&f.onerror(t),c(t)},["adding",t,"into",e.name]),d.onsuccess=function(n){var e=s.keyPath;e&&k(t,e,n.target.result),f.onsuccess&&f.onsuccess(n.target.result),o(d.result)}})},put:function(t,n){var e=this,i=this.hook.creating.fire,o=this.hook.updating.fire;return i!==a||o!==a?this._trans(wt,function(i,o,c){var s=n||e.schema.primKey.keyPath&&P(t,e.schema.primKey.keyPath);s===r?c.tables[e.name].add(t).then(i,o):(c._lock(),t=O(t),c.tables[e.name].where(":id").equals(s).modify(function(n){this.value=t}).then(function(r){return 0===r?c.tables[e.name].add(t,n):s})["finally"](function(){c._unlock()}).then(i,o))}):this._idbstore(wt,function(r,i,o){var c=n?o.put(t,n):o.put(t);c.onerror=T(i,["putting",t,"into",e.name]),c.onsuccess=function(n){var e=o.keyPath;e&&k(t,e,n.target.result),r(c.result)}})},"delete":function(t){return this.hook.deleting.subscribers.length?this.where(":id").equals(t)["delete"]():this._idbstore(wt,function(n,e,r){var i=r["delete"](t);i.onerror=T(e,["deleting",t,"from",r.name]),i.onsuccess=function(t){n(i.result)}})},clear:function(){return this.hook.deleting.subscribers.length?void this.toCollection()["delete"]():this._idbstore(wt,function(t,n,e){var r=e.clear();r.onerror=T(n,["clearing",e.name]),r.onsuccess=function(n){t(r.result)}})},update:function(t,n){if("object"!=typeof n||Array.isArray(n))throw new ft("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof t||Array.isArray(t))return this.where(":id").equals(t).modify(n);Object.keys(n).forEach(function(e){k(t,e,n[e])});var e=P(t,this.schema.primKey.keyPath);return e===r&&q.reject(new ft("Object does not contain its primary key")),this.where(":id").equals(e).modify(n)}}}),i(H.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&q.PSD&&(q.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(q.PSD&&(q.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{t()}catch(n){}}return this},_locked:function(){return this._reculock&&(!q.PSD||q.PSD.lockOwnerFor!==this)},_nop:function(t){this.tables[this.storeNames[0]].get(0).then(t)},_promise:function(t,n,e){var r=this;return q.newPSD(function(){var i;return r._locked()?i=new q(function(i,o){r._blockedFuncs.push(function(){r._promise(t,n,e).then(i,o)})}):(i=r.active?new q(function(i,o){if(!r.idbtrans&&t){if(!vt)throw new ft(mt?"Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+mt:"Database not open");var c=r.idbtrans=vt.transaction(r.storeNames,r.mode);c.onerror=function(t){r.on("error").fire(t&&t.target.error),t.preventDefault(),r.abort()},c.onabort=function(t){r.active=!1,r.on("abort").fire(t)},c.oncomplete=function(t){r.active=!1,r.on("complete").fire(t)}}e&&r._lock();try{n(i,o,r)}catch(a){s.spawn(function(){r.on("error").fire(a)}),r.abort(),o(a)}}):q.reject(A(new ft("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&e&&i["finally"](function(){r._unlock()})),i.onuncatched=function(t){s.spawn(function(){r.on("error").fire(t)}),r.abort()},i})},complete:function(t){return this.on("complete",t)},error:function(t){return this.on("error",t)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new ft("Transaction Aborted"))}catch(t){}},table:function(t){if(!this.tables.hasOwnProperty(t))throw new ft("Table "+t+" not in transaction");return this.tables[t]}}),i(G.prototype,function(){function t(t,n){try{throw n}catch(e){t._ctx.error=e}return t}function n(t){return Array.prototype.slice.call(Array.isArray(t[0])?t[0]:t,0).sort(nt)}function e(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function r(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function i(t,n,e,r,i,o){for(var c=Math.min(t.length,r.length),s=-1,a=0;c>a;++a){var u=n[a];if(u!==r[a])return i(t[a],e[a])<0?t.substr(0,a)+e[a]+e.substr(a+1):i(t[a],r[a])<0?t.substr(0,a)+r[a]+e.substr(a+1):s>=0?t.substr(0,s)+n[s]+e.substr(s+1):null;i(t[a],u)<0&&(s=a)}return c<r.length&&"next"===o?t+e.substr(t.length):c<t.length&&"prev"===o?t.substr(0,e.length):0>s?null:t.substr(0,s)+r[s]+e.substr(s+1)}function o(t,n,o){function c(t){s=e(t),a=r(t),u="next"===t?nt:et,f=s(o),h=a(o),l=t}var s,a,u,f,h,l;c("next"),t._ondirectionchange=function(t){c(t)},t._addAlgorithm(function(t,e,r){var o=t.key;if("string"!=typeof o)return!1;var c=a(o);if(n(c,h))return e(function(){t["continue"]()}),!0;var s=i(o,c,f,h,u,l);return e(s?function(){t["continue"](s)}:r),!1})}return{between:function(t,n,e,r){return e=e!==!1,r=r===!0,t>n||t==n&&(e||r)&&(!e||!r)?new this._ctx.collClass(this,at.only(t)).limit(0):new this._ctx.collClass(this,at.bound(t,n,!e,!r))},equals:function(t){return new this._ctx.collClass(this,at.only(t))},above:function(t){return new this._ctx.collClass(this,at.lowerBound(t,!0))},aboveOrEqual:function(t){return new this._ctx.collClass(this,at.lowerBound(t))},below:function(t){return new this._ctx.collClass(this,at.upperBound(t,!0))},belowOrEqual:function(t){return new this._ctx.collClass(this,at.upperBound(t))},startsWith:function(n){return"string"!=typeof n?t(new this._ctx.collClass(this),new ut("String expected")):this.between(n,n+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(n){if("string"!=typeof n)return t(new this._ctx.collClass(this),new ut("String expected"));if(""===n)return this.startsWith(n);var e=new this._ctx.collClass(this,at.bound(n.toUpperCase(),n.toLowerCase()+String.fromCharCode(65535)));return o(e,function(t,n){return 0===t.indexOf(n)},n),e._ondirectionchange=function(){t(e,new ft("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},e},equalsIgnoreCase:function(n){if("string"!=typeof n)return t(new this._ctx.collClass(this),new ut("String expected"));var e=new this._ctx.collClass(this,at.bound(n.toUpperCase(),n.toLowerCase()));return o(e,function(t,n){return t===n},n),e},anyOf:function(t){var e=n(arguments);if(0===e.length)return new this._ctx.collClass(this,at.only("")).limit(0);var r=new this._ctx.collClass(this,at.bound(e[0],e[e.length-1])),i=nt;r._ondirectionchange=function(t){i="next"===t?nt:et,e.sort(i)};var o=0;return r._addAlgorithm(function(t,n,r){for(var c=t.key;i(c,e[o])>0;)if(++o,o===e.length)return n(r),!1;return c===e[o]?(n(function(){t["continue"]()}),!0):(n(function(){t["continue"](e[o])}),!1)}),r}}}),i(Y.prototype,function(){function t(t,n){t.filter=rt(t.filter,n)}function n(t,n){t.isMatch=rt(t.isMatch,n)}function e(t,n){return t.isPrimKey?n:n.index(t.index)}function r(t,n){return e(t,n)[t.op](t.range||null,t.dir+t.unique)}function i(t,n,e,i,o){t.or?!function(){function c(){2===++f&&e()}function s(t,e,r){if(!a||a(e,r,c,i)){var o=e.primaryKey.toString();u.hasOwnProperty(o)||(u[o]=!0,n(t,e,r))}}var a=t.filter,u={},f=(t.table.schema.primKey.keyPath,0);t.or._iterate(s,c,i,o),$(r(t,o),t.algorithm,s,c,i,t.table.hook.reading.fire)}():$(r(t,o),rt(t.algorithm,t.filter),n,e,i,t.table.hook.reading.fire)}function o(t){return t.table.schema.instanceTemplate}return{_read:function(t,n){var e=this._ctx;return e.error?e.table._trans(null,function(t,n){n(e.error)}):e.table._idbstore(_t,t).then(n)},_write:function(t){var n=this._ctx;return n.error?n.table._trans(null,function(t,e){e(n.error)}):n.table._idbstore(wt,t,"locked")},_addAlgorithm:function(t){var n=this._ctx;n.algorithm=rt(n.algorithm,t)},_iterate:function(t,n,e,r){return i(this._ctx,t,n,e,r)},each:function(t){var n=this._ctx;return w(function(){t(o(n))}),this._read(function(e,r,o){i(n,t,e,r,o)})},count:function(t){w(function(){t(0)});var n=this,r=this._ctx;if(r.filter||r.algorithm||r.or){var o=0;return this._read(function(t,n,e){i(r,function(){return++o,!1},function(){t(o)},n,e)},t)}return this._read(function(t,i,o){var c=e(r,o),s=r.range?c.count(r.range):c.count();s.onerror=T(i,["calling","count()","on",n.name]),s.onsuccess=function(n){t(Math.min(n.target.result,Math.max(0,r.limit-r.offset)))}},t)},sortBy:function(t,n){function e(t,n){return n?e(t[c[n]],n-1):t[s]}function r(t,n){var r=e(t,a),i=e(n,a);return i>r?-u:r>i?u:0}var i=this._ctx;w(function(){n([o(i)])});var c=t.split(".").reverse(),s=c[0],a=c.length-1,u="next"===this._ctx.dir?1:-1;return this.toArray(function(t){return t.sort(r)}).then(n)},toArray:function(t){var n=this._ctx;return w(function(){t([o(n)])}),this._read(function(t,e,r){var o=[];i(n,function(t){o.push(t)},function(){t(o)},e,r)},t)},offset:function(n){var e=this._ctx;return 0>=n?this:(e.offset+=n,e.or||e.algorithm||e.filter?t(e,function(t,e,r){return--n<0}):t(e,function(t,e,r){return 0===n?!0:1===n?(--n,!1):(e(function(){t.advance(n),n=0}),!1)}),this)},limit:function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),t(this._ctx,function(t,e,r){return--n<=0&&e(r),n>=0}),this},until:function(n,e){var r=this._ctx;return w(function(){n(o(r))}),t(this._ctx,function(t,r,i){return n(t.value)?(r(i),e):!0}),this},first:function(t){var n=this;return w(function(){t(o(n._ctx))}),this.limit(1).toArray(function(t){return t[0]}).then(t)},last:function(t){return this.reverse().first(t)},and:function(e){var r=this;return w(function(){e(o(r._ctx))}),t(this._ctx,function(t){return e(t.value)}),n(this._ctx,e),this},or:function(t){return new G(this._ctx.table,t,this)},reverse:function(){return this._ctx.dir="prev"==this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(t){var n=this,e=this._ctx;return w(function(){t(o(n._ctx)[n._ctx.index])}),e.isPrimKey||(e.op="openKeyCursor"),this.each(function(n,e){t(e.key,e)})},eachUniqueKey:function(t){return this._ctx.unique="unique",this.eachKey(t)},keys:function(t){w(function(){t([o(e)[n._ctx.index]])});var n=this,e=this._ctx;e.isPrimKey||(e.op="openKeyCursor");var r=[];return this.each(function(t,n){r.push(n.key)}).then(function(){return r}).then(t)},uniqueKeys:function(t){return this._ctx.unique="unique",this.keys(t)},firstKey:function(t){return this.limit(1).keys(function(t){return t[0]}).then(t)},lastKey:function(t){return this.reverse().firstKey(t)},distinct:function(){var n={};return t(this._ctx,function(t){var e=t.primaryKey.toString(),r=n.hasOwnProperty(e);return n[e]=!0,!r}),this}}}),o(z).from(Y).extend({modify:function(t){var n=this,e=this._ctx,r=e.table.hook,o=r.updating.fire,c=r.deleting.fire;return w(function(){"function"==typeof t&&t.call({value:e.table.schema.instanceTemplate},e.table.schema.instanceTemplate)}),this._write(function(r,s,u,f){function h(t,n,r){D=n.primaryKey;var i={primKey:n.primaryKey,value:t};if(p.call(i,t)!==!1){var o=!i.hasOwnProperty("value"),c=o?n["delete"]():n.update(i.value);++m,c.onerror=T(function(t){return w.push(t),x.push(i.primKey),i.onerror&&i.onerror(t),!0},o?["deleting",t,"from",e.table.name]:["modifying",t,"on",e.table.name]),c.onsuccess=function(t){i.onsuccess&&i.onsuccess(i.value),++g,d()}}}function l(t){return t&&(w.push(t),x.push(D)),s(new F("Error modifying one or more objects",w,g,x))}function d(){_&&g+w.length===m&&(w.length>0?l():r(g))}var p;if("function"==typeof t)p=o===a&&c===a?t:function(n){var e=O(n);if(t.call(this,n)===!1)return!1;if(this.hasOwnProperty("value")){var r=j(e,this.value),i=o.call(this,r,this.primKey,e,f);i&&(n=this.value,Object.keys(i).forEach(function(t){k(n,t,i[t])}))}else c.call(this,this.primKey,n,f)};else if(o===a){var y=Object.keys(t),v=y.length;p=function(n){for(var e=!1,r=0;v>r;++r){var i=y[r],o=t[i];P(n,i)!==o&&(k(n,i,o),e=!0)}return e}}else{var b=t;t=S(b),p=function(n){var e=!1,r=o.call(this,t,this.primKey,O(n),f);return r&&i(t,r),Object.keys(t).forEach(function(r){var i=t[r];P(n,r)!==i&&(k(n,r,t[r]),e=!0)}),r&&(t=S(b)),e}}var m=0,g=0,_=!1,w=[],x=[],D=null;n._iterate(h,function(){_=!0,d()},l,u)})},"delete":function(){return this.modify(function(){delete this.value})}}),i(this,{Collection:Y,Table:J,Transaction:H,Version:p,WhereClause:G,WriteableCollection:z,WriteableTable:V}),h(),s.addons.forEach(function(t){t(xt)})}function a(){}function u(t){return t}function f(t,n){return t===u?n:function(e){return n(t(e))}}function h(t,n){return function(){t.apply(this,arguments),n.apply(this,arguments)}}function l(t,n){return t===a?n:function(){var e=t.apply(this,arguments);e!==r&&(arguments[0]=e);var i=this.onsuccess,o=this.onerror;delete this.onsuccess,delete this.onerror;var c=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?h(i,this.onsuccess):i),o&&(this.onerror=this.onerror?h(o,this.onerror):o),c!==r?c:e}}function d(t,n){return t===a?n:function(){var e=t.apply(this,arguments);e!==r&&i(arguments[0],e);var o=this.onsuccess,c=this.onerror;delete this.onsuccess,delete this.onerror;var s=n.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?h(o,this.onsuccess):o),c&&(this.onerror=this.onerror?h(c,this.onerror):c),e===r?s===r?r:s:s===r?e:i(e,s)}}function p(t,n){return t===a?n:function(){return t.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function y(t,n){return t===a?n:function(){return n.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function v(t,n){return t===a?n:function(){t.apply(this,arguments),n.apply(this,arguments)}}function b(t,n){return t===a?n:function(){var e=t.apply(this,arguments);if(e&&"function"==typeof e.then){var r=this,i=arguments;return e.then(function(){return n.apply(r,i)})}return n.apply(this,arguments)}}function m(n,e){function r(t,n,e){if(Array.isArray(t))return o(t);if("object"==typeof t)return i(t);n||(n=p),e||(e=a);var r={subscribers:[],fire:e,subscribe:function(t){r.subscribers.push(t),r.fire=n(r.fire,t)},unsubscribe:function(t){r.subscribers=r.subscribers.filter(function(n){return n!==t}),r.fire=r.subscribers.reduce(n,e)}};return s[t]=u[t]=r,r}function i(n){Object.keys(n).forEach(function(e){var i=n[e];if(Array.isArray(i))r(e,n[e][0],n[e][1]);else{if("asap"!==i)throw new Error("Invalid event config");var o=r(e,null,function(){var n=arguments;o.subscribers.forEach(function(e){_(function(){e.apply(t,n)})})});o.subscribe=function(t){-1===o.subscribers.indexOf(t)&&o.subscribers.push(t)},o.unsubscribe=function(t){var n=o.subscribers.indexOf(t);-1!==n&&o.subscribers.splice(n,1)}}})}function o(t){function n(){return e?!1:void(e=!0)}var e=!1;t.forEach(function(t){r(t).subscribe(n)})}var c=arguments,s={},u=function(t,e){if(e){var r=[].slice.call(arguments,1),i=s[t];return i.subscribe.apply(i,r),n}return"string"==typeof t?s[t]:void 0};u.addEventType=r;for(var f=1,h=c.length;h>f;++f)r(c[f]);return u}function g(t){if(!t)throw new Error("Assertion failed")}function _(n){t.setImmediate?setImmediate(n):setTimeout(n,0)}function w(t){var n=setTimeout(t,1e3);clearTimeout(n)}function x(t,n,e){return function(){var r=q.PSD;q.PSD=e;try{t.apply(this,arguments)}catch(i){n(i)}finally{q.PSD=r}}}function P(t,n){if(t.hasOwnProperty(n))return t[n];if(!n)return t;if("string"!=typeof n){for(var e=[],i=0,o=n.length;o>i;++i){var c=P(t,n[i]);e.push(c)}return e}var s=n.indexOf(".");if(-1!==s){var a=t[n.substr(0,s)];return a===r?r:P(a,n.substr(s+1))}return r}function k(t,n,e){if(t&&n!==r)if(Array.isArray(n)){g(Array.isArray(e));for(var i=0,o=n.length;o>i;++i)k(t,n[i],e[i])}else{var c=n.indexOf(".");if(-1!==c){var s=n.substr(0,c),a=n.substr(c+1);if(""===a)e===r?delete t[s]:t[s]=e;else{var u=t[s];u||(u=t[s]={}),k(u,a,e)}}else e===r?delete t[n]:t[n]=e}}function D(t,n){k(t,n,r)}function S(t){var n={};for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function O(t){if(!t||"object"!=typeof t)return t;var n;if(Array.isArray(t)){n=[];for(var e=0,r=t.length;r>e;++e)n.push(O(t[e]))}else if(t instanceof Date)n=new Date,n.setTime(t.getTime());else{n=t.constructor?Object.create(t.constructor.prototype):{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=O(t[i]))}return n}function j(t,n){var e={};for(var i in t)t.hasOwnProperty(i)&&(n.hasOwnProperty(i)?t[i]!==n[i]&&JSON.stringify(t[i])!=JSON.stringify(n[i])&&(e[i]=n[i]):e[i]=r);for(var i in n)n.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(e[i]=n[i]);return e}function C(t){if("function"==typeof t)return new t;if(Array.isArray(t))return[C(t[0])];if(t&&"object"==typeof t){var n={};return E(n,t),n}return t}function E(t,n){Object.keys(n).forEach(function(e){var r=C(n[e]);t[e]=r})}function T(t,n){return function(e){var r=e&&e.target.error||new Error;
if(n){var i=" occured when "+n.map(function(t){switch(typeof t){case"function":return t();case"string":return t;default:return JSON.stringify(t)}}).join(" ");r.name?r.toString=function(){return r.name+i+(r.message?". "+r.message:"")}:r+=i}return t(r),e.stopPropagation(),e.preventDefault(),!1}}function A(t){try{throw t}catch(n){return n}}function K(t){t.preventDefault()}function I(t){var n;try{n=JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]")}catch(e){n=[]}t(n)&&localStorage.setItem("Dexie.DatabaseNames",JSON.stringify(n))}function B(t,n,e,r,i,o,c){this.name=t,this.keyPath=n,this.unique=e,this.multi=r,this.auto=i,this.compound=o,this.dotted=c,this.src=(e?"&":"")+(r?"*":"")+(i?"++":"")+n}function N(t,n,e,r){this.name=t,this.primKey=n||new B,this.indexes=e||[new B],this.instanceTemplate=r,this.mappedClass=null}function F(t,n,e,r){this.name="ModifyError",this.failures=n,this.failedKeys=r,this.successCount=e,this.message=n.join("\n")}var q=function(){function t(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var e=this,o=!0;this._PSD=t.PSD;try{s(this,n,function(t){o?a(r,e,t):r(e,t)},function(t){return o?(a(i,e,t),!1):i(e,t)})}finally{o=!1}}function n(t){var n=this;if(null===this._state)return void this._deferreds.push(t);var r=n._state?t.onFulfilled:t.onRejected;if(null===r)return(n._state?t.resolve:t.reject)(n._value);var i;try{i=r(n._value),n._state||i&&"function"==typeof i.then&&i._state===!1||e(n)}catch(o){var c=t.reject(o);if(!c&&n.onuncatched)try{n.onuncatched(o)}catch(o){}return}t.resolve(i)}function e(t){t._catched=!0,t._parent&&e(t._parent)}function r(n,e){var c=t.PSD;t.PSD=n._PSD;try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then)return void s(n,function(t,n){e.then(t,n)},function(t){r(n,t)},function(t){i(n,t)});n._state=!0,n._value=e,o.call(n)}catch(a){i(a)}finally{t.PSD=c}}function i(n,e){var r=t.PSD;if(t.PSD=n._PSD,n._state=!1,n._value=e,o.call(n),!n._catched&&n.onuncatched)try{n.onuncatched(n._value)}catch(i){}return t.PSD=r,n._catched}function o(){for(var t=0,e=this._deferreds.length;e>t;t++)n.call(this,this._deferreds[t]);this._deferreds=[]}function c(t,n,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof n?n:null,this.resolve=e,this.reject=r}function s(t,n,e,r){var i=!1;try{n(function(t){i||(i=!0,e(t))},function(n){return i?t._catched:(i=!0,r(n))})}catch(o){if(i)return;return r(o)}}var a="undefined"==typeof setImmediate?function(t,n,e,r){var i=arguments;setTimeout(function(){t.apply(this,[].slice.call(i,1))},0)}:function(t,n,e,r){setImmediate.apply(this,arguments)};return t.all=function(){var n=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new t(function(t,e){function r(o,c){try{if(c&&("object"==typeof c||"function"==typeof c)){var s=c.then;if("function"==typeof s)return void s.call(c,function(t){r(o,t)},e)}n[o]=c,0===--i&&t(n)}catch(a){e(a)}}if(0===n.length)return t([]);for(var i=n.length,o=0;o<n.length;o++)r(o,n[o])})},t.prototype.then=function(e,r){var i=this,o=new t(function(t,o){n.call(i,new c(e,r,t,o))});return o._PSD=this._PSD,o.onuncatched=this.onuncatched,o._parent=this,o},t.prototype["catch"]=function(n){if(1===arguments.length)return this.then(null,n);var e=arguments[0],r=arguments[1];return"function"==typeof e?this.then(null,function(n){return n instanceof e?r(n):t.reject(n)}):this.then(null,function(n){return n&&n.name===e?r(n):t.reject(n)})},t.prototype["finally"]=function(n){return this.then(function(t){return n(),t},function(e){return n(),t.reject(e)})},t.prototype.onuncatched=null,t.resolve=function(n){var e=new t(function(){});return e._state=!0,e._value=n,e},t.reject=function(n){var e=new t(function(){});return e._state=!1,e._value=n,e},t.race=function(n){return new t(function(t,e){n.map(function(n){n.then(t,e)})})},t.PSD=null,t.newPSD=function(n){var e=t.PSD;t.PSD=e?Object.create(e):{};try{return n()}finally{t.PSD=e}},t}();o(F).from(Error),s["delete"]=function(t){var n=new s(t),e=n["delete"]();return e.onblocked=function(t){return n.on("blocked",t),this},e},s.getDatabaseNames=function(t){return new q(function(t,n){if("webkitGetDatabaseNames"in indexedDB||"getDatabaseNames"in indexedDB){var e="getDatabaseNames"in indexedDB?indexedDB.getDatabaseNames():indexedDB.webkitGetDatabaseNames();e.onsuccess=function(n){t([].slice.call(n.target.result,0))},e.onerror=T(n)}else I(t)}).then(t)},s.defineClass=function(t){function n(t){t&&i(this,t)}return E(n.prototype,t),n},s.spawn=function(t){return q.newPSD(function(){return q.PSD.trans=null,t()})},s.vip=function(t){return q.newPSD(function(){return q.PSD.letThrough=!0,t()})},Object.defineProperty(s,"currentTransaction",{get:function(){return q.PSD&&q.PSD.trans||null}}),s.Promise=q,s.derive=o,s.extend=i,s.override=c,s.events=m,s.getByKeyPath=P,s.setByKeyPath=k,s.delByKeyPath=D,s.shallowClone=S,s.deepClone=O,s.addons=[],s.fakeAutoComplete=w,s.asap=_,s.ModifyError=F,s.MultiModifyError=F,s.IndexSpec=B,s.TableSchema=N,s.dependencies={indexedDB:t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB,IDBKeyRange:t.IDBKeyRange||t.webkitIDBKeyRange,IDBTransaction:t.IDBTransaction||t.webkitIDBTransaction,Error:t.Error||String,SyntaxError:t.SyntaxError||String,TypeError:t.TypeError||String,DOMError:t.DOMError||String},s.version=1.01,n("Dexie",s)}).apply(this,"undefined"==typeof module||"undefined"!=typeof window&&this==window?[window,function(t,n){window[t]=n},!0]:[global,function(t,n){module.exports=n},!1]);
//# sourceMappingURL=1.0.0/Dexie.min.js.map