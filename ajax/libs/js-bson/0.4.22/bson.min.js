var bson=function(){var pkgmap={},global={},nativeRequire=typeof require!="undefined"&&require,lib,ties,main,async;function exports(){return main()}exports.main=exports;exports.module=module;exports.packages=pkgmap;exports.pkg=pkg;exports.require=function require(uri){return pkgmap.main.index.require(uri)};ties={};aliases={};return exports;function join(){return normalize(Array.prototype.join.call(arguments,"/"))}function normalize(path){var ret=[],parts=path.split("/"),cur,prev;var i=0,l=parts.length-1;for(;i<=l;i++){cur=parts[i];if(cur==="."&&prev!==undefined)continue;if(cur===".."&&ret.length&&prev!==".."&&prev!=="."&&prev!==undefined){ret.pop();prev=ret.slice(-1)[0]}else{if(prev===".")ret.pop();ret.push(cur);prev=cur}}return ret.join("/")}function dirname(path){return path&&path.substr(0,path.lastIndexOf("/"))||"."}function findModule(workingModule,uri){var moduleId=join(dirname(workingModule.id),/\.\/$/.test(uri)?uri+"index":uri).replace(/\.js$/,""),moduleIndexId=join(moduleId,"index"),pkg=workingModule.pkg,module;var i=pkg.modules.length,id;while(i-- >0){id=pkg.modules[i].id;if(id==moduleId||id==moduleIndexId){module=pkg.modules[i];break}}return module}function newRequire(callingModule){function require(uri){var module,pkg;if(/^\./.test(uri)){module=findModule(callingModule,uri)}else if(ties&&ties.hasOwnProperty(uri)){return ties[uri]}else if(aliases&&aliases.hasOwnProperty(uri)){return require(aliases[uri])}else{pkg=pkgmap[uri];if(!pkg&&nativeRequire){try{pkg=nativeRequire(uri)}catch(nativeRequireError){}if(pkg)return pkg}if(!pkg){throw new Error('Cannot find module "'+uri+'" @[module: '+callingModule.id+" package: "+callingModule.pkg.name+"]")}module=pkg.index}if(!module){throw new Error('Cannot find module "'+uri+'" @[module: '+callingModule.id+" package: "+callingModule.pkg.name+"]")}module.parent=callingModule;return module.call()}return require}function module(parent,id,wrapper){var mod={pkg:parent,id:id,wrapper:wrapper},cached=false;mod.exports={};mod.require=newRequire(mod);mod.call=function(){if(cached){return mod.exports}cached=true;global.require=mod.require;mod.wrapper(mod,mod.exports,global,global.require);return mod.exports};if(parent.mainModuleId==mod.id){parent.index=mod;parent.parents.length===0&&(main=mod.call)}parent.modules.push(mod)}function pkg(){var wrapper=arguments[arguments.length-1],parents=Array.prototype.slice.call(arguments,0,arguments.length-1),ctx=wrapper(parents);pkgmap[ctx.name]=ctx;arguments.length==1&&(pkgmap.main=ctx);return function(modules){var id;for(id in modules){module(ctx,id,modules[id])}}}}(this);bson.pkg(function(parents){return{name:"bson",mainModuleId:"bson",modules:[],parents:parents}})({binary:function(module,exports,global,require,undefined){if(typeof window==="undefined"){var Buffer=require("buffer").Buffer}var BSON_BINARY_SUBTYPE_DEFAULT=0;var writeStringToArray=function(data){var buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(data.length)):new Array(data.length);for(var i=0;i<data.length;i++){buffer[i]=data.charCodeAt(i)}return buffer};var convertArraytoUtf8BinaryString=function(byteArray,startIndex,endIndex){var result="";for(var i=startIndex;i<endIndex;i++){result=result+String.fromCharCode(byteArray[i])}return result};function Binary(buffer,subType){if(!(this instanceof Binary))return new Binary(buffer,subType);this._bsontype="Binary";if(buffer instanceof Number){this.sub_type=buffer;this.position=0}else{this.sub_type=subType==null?BSON_BINARY_SUBTYPE_DEFAULT:subType;this.position=0}if(buffer!=null&&!(buffer instanceof Number)){if(typeof buffer=="string"){if(typeof Buffer!="undefined"){this.buffer=new Buffer(buffer)}else if(typeof Uint8Array!="undefined"||Object.prototype.toString.call(buffer)=="[object Array]"){this.buffer=writeStringToArray(buffer)}else{throw new Error("only String, Buffer, Uint8Array or Array accepted")}}else{this.buffer=buffer}this.position=buffer.length}else{if(typeof Buffer!="undefined"){this.buffer=new Buffer(Binary.BUFFER_SIZE)}else if(typeof Uint8Array!="undefined"){this.buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE))}else{this.buffer=new Array(Binary.BUFFER_SIZE)}this.position=0}}Binary.prototype.put=function put(byte_value){if(byte_value["length"]!=null&&typeof byte_value!="number"&&byte_value.length!=1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof byte_value!="number"&&byte_value<0||byte_value>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var decoded_byte=null;if(typeof byte_value=="string"){decoded_byte=byte_value.charCodeAt(0)}else if(byte_value["length"]!=null){decoded_byte=byte_value[0]}else{decoded_byte=byte_value}if(this.buffer.length>this.position){this.buffer[this.position++]=decoded_byte}else{if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){var buffer=new Buffer(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(buffer,0,0,this.buffer.length);this.buffer=buffer;this.buffer[this.position++]=decoded_byte}else{var buffer=null;if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE+this.buffer.length))}else{buffer=new Array(Binary.BUFFER_SIZE+this.buffer.length)}for(var i=0;i<this.buffer.length;i++){buffer[i]=this.buffer[i]}this.buffer=buffer;this.buffer[this.position++]=decoded_byte}}};Binary.prototype.write=function write(string,offset){offset=typeof offset=="number"?offset:this.position;if(this.buffer.length<offset+string.length){var buffer=null;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){buffer=new Buffer(this.buffer.length+string.length);this.buffer.copy(buffer,0,0,this.buffer.length)}else if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){buffer=new Uint8Array(new ArrayBuffer(this.buffer.length+string.length));for(var i=0;i<this.position;i++){buffer[i]=this.buffer[i]}}this.buffer=buffer}if(typeof Buffer!="undefined"&&Buffer.isBuffer(string)&&Buffer.isBuffer(this.buffer)){string.copy(this.buffer,offset,0,string.length);this.position=offset+string.length>this.position?offset+string.length:this.position}else if(typeof Buffer!="undefined"&&typeof string=="string"&&Buffer.isBuffer(this.buffer)){this.buffer.write(string,"binary",offset);this.position=offset+string.length>this.position?offset+string.length:this.position}else if(Object.prototype.toString.call(string)=="[object Uint8Array]"||Object.prototype.toString.call(string)=="[object Array]"&&typeof string!="string"){for(var i=0;i<string.length;i++){this.buffer[offset++]=string[i]}this.position=offset>this.position?offset:this.position}else if(typeof string=="string"){for(var i=0;i<string.length;i++){this.buffer[offset++]=string.charCodeAt(i)}this.position=offset>this.position?offset:this.position}};Binary.prototype.read=function read(position,length){length=length&&length>0?length:this.position;if(this.buffer["slice"]){return this.buffer.slice(position,position+length)}else{var buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(length)):new Array(length);for(var i=0;i<length;i++){buffer[i]=this.buffer[position++]}}return buffer};Binary.prototype.value=function value(asRaw){asRaw=asRaw==null?false:asRaw;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){return asRaw?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)}else{if(asRaw){if(this.buffer["slice"]!=null){return this.buffer.slice(0,this.position)}else{var newBuffer=Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position);for(var i=0;i<this.position;i++){newBuffer[i]=this.buffer[i]}return newBuffer}}else{return convertArraytoUtf8BinaryString(this.buffer,0,this.position)}}};Binary.prototype.length=function length(){return this.position};Binary.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""};Binary.prototype.toString=function(format){return this.buffer!=null?this.buffer.slice(0,this.position).toString(format):""};Binary.BUFFER_SIZE=256;Binary.SUBTYPE_DEFAULT=0;Binary.SUBTYPE_FUNCTION=1;Binary.SUBTYPE_BYTE_ARRAY=2;Binary.SUBTYPE_UUID_OLD=3;Binary.SUBTYPE_UUID=4;Binary.SUBTYPE_MD5=5;Binary.SUBTYPE_USER_DEFINED=128;exports.Binary=Binary},binary_parser:function(module,exports,global,require,undefined){var chr=String.fromCharCode;var maxBits=[];for(var i=0;i<64;i++){maxBits[i]=Math.pow(2,i)}function BinaryParser(bigEndian,allowExceptions){if(!(this instanceof BinaryParser))return new BinaryParser(bigEndian,allowExceptions);this.bigEndian=bigEndian;this.allowExceptions=allowExceptions}BinaryParser.warn=function warn(msg){if(this.allowExceptions){throw new Error(msg)}return 1};BinaryParser.decodeFloat=function decodeFloat(data,precisionBits,exponentBits){var b=new this.Buffer(this.bigEndian,data);b.checkBuffer(precisionBits+exponentBits+1);var bias=maxBits[exponentBits-1]-1,signal=b.readBits(precisionBits+exponentBits,1),exponent=b.readBits(precisionBits,exponentBits),significand=0,divisor=2,curByte=b.buffer.length+(-precisionBits>>3)-1;do{for(var byteValue=b.buffer[++curByte],startBit=precisionBits%8||8,mask=1<<startBit;mask>>=1;byteValue&mask&&(significand+=1/divisor),divisor*=2);}while(precisionBits-=startBit);return exponent==(bias<<1)+1?significand?NaN:signal?-Infinity:+Infinity:(1+signal*-2)*(exponent||significand?!exponent?Math.pow(2,-bias+1)*significand:Math.pow(2,exponent-bias)*(1+significand):0)};BinaryParser.decodeInt=function decodeInt(data,bits,signed,forceBigEndian){var b=new this.Buffer(this.bigEndian||forceBigEndian,data),x=b.readBits(0,bits),max=maxBits[bits];return signed&&x>=max/2?x-max:x};BinaryParser.encodeFloat=function encodeFloat(data,precisionBits,exponentBits){var bias=maxBits[exponentBits-1]-1,minExp=-bias+1,maxExp=bias,minUnnormExp=minExp-precisionBits,n=parseFloat(data),status=isNaN(n)||n==-Infinity||n==+Infinity?n:0,exp=0,len=2*bias+1+precisionBits+3,bin=new Array(len),signal=(n=status!==0?0:n)<0,intPart=Math.floor(n=Math.abs(n)),floatPart=n-intPart,lastBit,rounded,result,i,j;for(i=len;i;bin[--i]=0);for(i=bias+2;intPart&&i;bin[--i]=intPart%2,intPart=Math.floor(intPart/2));for(i=bias+1;floatPart>0&&i;(bin[++i]=((floatPart*=2)>=1)-0)&&--floatPart);for(i=-1;++i<len&&!bin[i];);if(bin[(lastBit=precisionBits-1+(i=(exp=bias+1-i)>=minExp&&exp<=maxExp?i+1:bias+1-(exp=minExp-1)))+1]){if(!(rounded=bin[lastBit])){for(j=lastBit+2;!rounded&&j<len;rounded=bin[j++]);}for(j=lastBit+1;rounded&&--j>=0;(bin[j]=!bin[j]-0)&&(rounded=0));}for(i=i-2<0?-1:i-3;++i<len&&!bin[i];);if((exp=bias+1-i)>=minExp&&exp<=maxExp){++i}else if(exp<minExp){exp!=bias+1-len&&exp<minUnnormExp&&this.warn("encodeFloat::float underflow");i=bias+1-(exp=minExp-1)}if(intPart||status!==0){this.warn(intPart?"encodeFloat::float overflow":"encodeFloat::"+status);exp=maxExp+1;i=bias+2;if(status==-Infinity){signal=1}else if(isNaN(status)){bin[i]=1}}for(n=Math.abs(exp+bias),j=exponentBits+1,result="";--j;result=n%2+result,n=n>>=1);for(n=0,j=0,i=(result=(signal?"1":"0")+result+bin.slice(i,i+precisionBits).join("")).length,r=[];i;j=(j+1)%8){n+=(1<<j)*result.charAt(--i);if(j==7){r[r.length]=String.fromCharCode(n);n=0}}r[r.length]=n?String.fromCharCode(n):"";return(this.bigEndian?r.reverse():r).join("")};BinaryParser.encodeInt=function encodeInt(data,bits,signed,forceBigEndian){var max=maxBits[bits];if(data>=max||data<-(max/2)){this.warn("encodeInt::overflow");data=0}if(data<0){data+=max}for(var r=[];data;r[r.length]=String.fromCharCode(data%256),data=Math.floor(data/256));for(bits=-(-bits>>3)-r.length;bits--;r[r.length]="\x00");return(this.bigEndian||forceBigEndian?r.reverse():r).join("")};BinaryParser.toSmall=function(data){return this.decodeInt(data,8,true)};BinaryParser.fromSmall=function(data){return this.encodeInt(data,8,true)};BinaryParser.toByte=function(data){return this.decodeInt(data,8,false)};BinaryParser.fromByte=function(data){return this.encodeInt(data,8,false)};BinaryParser.toShort=function(data){return this.decodeInt(data,16,true)};BinaryParser.fromShort=function(data){return this.encodeInt(data,16,true)};BinaryParser.toWord=function(data){return this.decodeInt(data,16,false)};BinaryParser.fromWord=function(data){return this.encodeInt(data,16,false)};BinaryParser.toInt=function(data){return this.decodeInt(data,32,true)};BinaryParser.fromInt=function(data){return this.encodeInt(data,32,true)};BinaryParser.toLong=function(data){return this.decodeInt(data,64,true)};BinaryParser.fromLong=function(data){return this.encodeInt(data,64,true)};BinaryParser.toDWord=function(data){return this.decodeInt(data,32,false)};BinaryParser.fromDWord=function(data){return this.encodeInt(data,32,false)};BinaryParser.toQWord=function(data){return this.decodeInt(data,64,true)};BinaryParser.fromQWord=function(data){return this.encodeInt(data,64,true)};BinaryParser.toFloat=function(data){return this.decodeFloat(data,23,8)};BinaryParser.fromFloat=function(data){return this.encodeFloat(data,23,8)};BinaryParser.toDouble=function(data){return this.decodeFloat(data,52,11)};BinaryParser.fromDouble=function(data){return this.encodeFloat(data,52,11)};BinaryParser.encode_int32=function encode_int32(number,asArray){var a,b,c,d,unsigned;unsigned=number<0?number+4294967296:number;a=Math.floor(unsigned/16777215);unsigned&=16777215;b=Math.floor(unsigned/65535);unsigned&=65535;c=Math.floor(unsigned/255);unsigned&=255;d=Math.floor(unsigned);return asArray?[chr(a),chr(b),chr(c),chr(d)]:chr(a)+chr(b)+chr(c)+chr(d)};BinaryParser.encode_int64=function encode_int64(number){var a,b,c,d,e,f,g,h,unsigned;unsigned=number<0?number+0x10000000000000000:number;a=Math.floor(unsigned/72057594037927940);unsigned&=72057594037927940;b=Math.floor(unsigned/0xffffffffffff);unsigned&=0xffffffffffff;c=Math.floor(unsigned/0xffffffffff);unsigned&=0xffffffffff;d=Math.floor(unsigned/4294967295);unsigned&=4294967295;e=Math.floor(unsigned/16777215);unsigned&=16777215;f=Math.floor(unsigned/65535);unsigned&=65535;g=Math.floor(unsigned/255);unsigned&=255;h=Math.floor(unsigned);return chr(a)+chr(b)+chr(c)+chr(d)+chr(e)+chr(f)+chr(g)+chr(h)};BinaryParser.decode_utf8=function decode_utf8(binaryStr){var len=binaryStr.length,decoded="",i=0,c=0,c1=0,c2=0,c3;while(i<len){c=binaryStr.charCodeAt(i);if(c<128){decoded+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=binaryStr.charCodeAt(i+1);decoded+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=binaryStr.charCodeAt(i+1);c3=binaryStr.charCodeAt(i+2);decoded+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return decoded};BinaryParser.encode_cstring=function encode_cstring(s){return unescape(encodeURIComponent(s))+BinaryParser.fromByte(0)};BinaryParser.encode_utf8=function encode_utf8(s){var a="",c;for(var n=0,len=s.length;n<len;n++){c=s.charCodeAt(n);if(c<128){a+=String.fromCharCode(c)}else if(c>127&&c<2048){a+=String.fromCharCode(c>>6|192);a+=String.fromCharCode(c&63|128)}else{a+=String.fromCharCode(c>>12|224);a+=String.fromCharCode(c>>6&63|128);a+=String.fromCharCode(c&63|128)}}return a};BinaryParser.hprint=function hprint(s){var number;for(var i=0,len=s.length;i<len;i++){if(s.charCodeAt(i)<32){number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(16):s.charCodeAt(i).toString(16);process.stdout.write(number+" ")}else{number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(16):s.charCodeAt(i).toString(16);process.stdout.write(number+" ")}}process.stdout.write("\n\n")};BinaryParser.ilprint=function hprint(s){var number;for(var i=0,len=s.length;i<len;i++){if(s.charCodeAt(i)<32){number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(10):s.charCodeAt(i).toString(10);require("util").debug(number+" : ")}else{number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(10):s.charCodeAt(i).toString(10);require("util").debug(number+" : "+s.charAt(i))}}};BinaryParser.hlprint=function hprint(s){var number;for(var i=0,len=s.length;i<len;i++){if(s.charCodeAt(i)<32){number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(16):s.charCodeAt(i).toString(16);require("util").debug(number+" : ")}else{number=s.charCodeAt(i)<=15?"0"+s.charCodeAt(i).toString(16):s.charCodeAt(i).toString(16);require("util").debug(number+" : "+s.charAt(i))}}};function BinaryParserBuffer(bigEndian,buffer){this.bigEndian=bigEndian||0;this.buffer=[];this.setBuffer(buffer)}BinaryParserBuffer.prototype.setBuffer=function setBuffer(data){var l,i,b;if(data){i=l=data.length;b=this.buffer=new Array(l);for(;i;b[l-i]=data.charCodeAt(--i));this.bigEndian&&b.reverse()}};BinaryParserBuffer.prototype.hasNeededBits=function hasNeededBits(neededBits){return this.buffer.length>=-(-neededBits>>3)};BinaryParserBuffer.prototype.checkBuffer=function checkBuffer(neededBits){if(!this.hasNeededBits(neededBits)){throw new Error("checkBuffer::missing bytes")}};BinaryParserBuffer.prototype.readBits=function readBits(start,length){function shl(a,b){for(;b--;a=((a%=2147483647+1)&1073741824)==1073741824?a*2:(a-1073741824)*2+2147483647+1);return a}if(start<0||length<=0){return 0}this.checkBuffer(start+length);var offsetLeft,offsetRight=start%8,curByte=this.buffer.length-(start>>3)-1,lastByte=this.buffer.length+(-(start+length)>>3),diff=curByte-lastByte,sum=(this.buffer[curByte]>>offsetRight&(1<<(diff?8-offsetRight:length))-1)+(diff&&(offsetLeft=(start+length)%8)?(this.buffer[lastByte++]&(1<<offsetLeft)-1)<<(diff--<<3)-offsetRight:0);for(;diff;sum+=shl(this.buffer[lastByte++],(diff--<<3)-offsetRight));return sum};BinaryParser.Buffer=BinaryParserBuffer;exports.BinaryParser=BinaryParser},bson:function(module,exports,global,require,undefined){var Long=require("./long").Long,Double=require("./double").Double,Timestamp=require("./timestamp").Timestamp,ObjectID=require("./objectid").ObjectID,Symbol=require("./symbol").Symbol,Code=require("./code").Code,MinKey=require("./min_key").MinKey,MaxKey=require("./max_key").MaxKey,DBRef=require("./db_ref").DBRef,Binary=require("./binary").Binary,BinaryParser=require("./binary_parser").BinaryParser,writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754;var isDate=function isDate(d){return typeof d==="object"&&Object.prototype.toString.call(d)==="[object Date]"};function BSON(){}BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992);var JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.calculateObjectSize=function calculateObjectSize(object,serializeFunctions){var totalLength=4+1;if(Array.isArray(object)){for(var i=0;i<object.length;i++){totalLength+=calculateElement(i.toString(),object[i],serializeFunctions)}}else{if(object.toBSON){object=object.toBSON()}for(var key in object){totalLength+=calculateElement(key,object[key],serializeFunctions)}}return totalLength};function calculateElement(name,value,serializeFunctions){var isBuffer=typeof Buffer!=="undefined";switch(typeof value){case"string":return 1+(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1+4+(!isBuffer?numberOfBytes(value):Buffer.byteLength(value,"utf8"))+1;case"number":if(Math.floor(value)===value&&value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){if(value>=BSON.BSON_INT32_MIN&&value<=BSON.BSON_INT32_MAX){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(4+1)}else{return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(8+1)}}else{return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(8+1)}case"undefined":return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1;case"boolean":return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(1+1);case"object":if(value==null||value instanceof MinKey||value instanceof MaxKey||value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1}else if(value instanceof ObjectID||value["_bsontype"]=="ObjectID"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(12+1)}else if(value instanceof Date||isDate(value)){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(8+1)}else if(typeof Buffer!=="undefined"&&Buffer.isBuffer(value)){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(1+4+1)+value.length}else if(value instanceof Long||value instanceof Double||value instanceof Timestamp||value["_bsontype"]=="Long"||value["_bsontype"]=="Double"||value["_bsontype"]=="Timestamp"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(8+1)}else if(value instanceof Code||value["_bsontype"]=="Code"){if(value.scope!=null&&Object.keys(value.scope).length>0){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+4+4+(!isBuffer?numberOfBytes(value.code.toString()):Buffer.byteLength(value.code.toString(),"utf8"))+1+BSON.calculateObjectSize(value.scope,serializeFunctions)}else{return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+4+(!isBuffer?numberOfBytes(value.code.toString()):Buffer.byteLength(value.code.toString(),"utf8"))+1}}else if(value instanceof Binary||value["_bsontype"]=="Binary"){if(value.sub_type==Binary.SUBTYPE_BYTE_ARRAY){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(value.position+1+4+1+4)}else{return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+(value.position+1+4+1)}}else if(value instanceof Symbol||value["_bsontype"]=="Symbol"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+((!isBuffer?numberOfBytes(value.value):Buffer.byteLength(value.value,"utf8"))+4+1+1)}else if(value instanceof DBRef||value["_bsontype"]=="DBRef"){var ordered_values={$ref:value.namespace,$id:value.oid};if(null!=value.db){ordered_values["$db"]=value.db}return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+BSON.calculateObjectSize(ordered_values,serializeFunctions)}else if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+(!isBuffer?numberOfBytes(value.source):Buffer.byteLength(value.source,"utf8"))+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1}else{return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+BSON.calculateObjectSize(value,serializeFunctions)+1}case"function":if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"||String.call(value)=="[object RegExp]"){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+(!isBuffer?numberOfBytes(value.source):Buffer.byteLength(value.source,"utf8"))+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1}else{if(serializeFunctions&&value.scope!=null&&Object.keys(value.scope).length>0){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+4+4+(!isBuffer?numberOfBytes(value.toString()):Buffer.byteLength(value.toString(),"utf8"))+1+BSON.calculateObjectSize(value.scope,serializeFunctions)}else if(serializeFunctions){return(name!=null?(!isBuffer?numberOfBytes(name):Buffer.byteLength(name,"utf8"))+1:0)+1+4+(!isBuffer?numberOfBytes(value.toString()):Buffer.byteLength(value.toString(),"utf8"))+1}}}return 0}BSON.serializeWithBufferAndIndex=function serializeWithBufferAndIndex(object,checkKeys,buffer,index,serializeFunctions){serializeFunctions=serializeFunctions==null?false:serializeFunctions;var size=buffer.length;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;return serializeObject(object,checkKeys,buffer,index,serializeFunctions)-1};var serializeObject=function(object,checkKeys,buffer,index,serializeFunctions){if(Array.isArray(object)){for(var i=0;i<object.length;i++){index=packElement(i.toString(),object[i],checkKeys,buffer,index,serializeFunctions)}}else{if(object.toBSON){object=object.toBSON()}for(var key in object){if(key!="$db"&&key!="$ref"&&key!="$id"){BSON.checkKey(key,!checkKeys)}index=packElement(key,object[key],checkKeys,buffer,index,serializeFunctions)}}buffer[index++]=0;return index};var stringToBytes=function(str){var ch,st,re=[];for(var i=0;i<str.length;i++){ch=str.charCodeAt(i);st=[];do{st.push(ch&255);ch=ch>>8}while(ch);re=re.concat(st.reverse())}return re};var numberOfBytes=function(str){var ch,st,re=0;for(var i=0;i<str.length;i++){ch=str.charCodeAt(i);st=[];do{st.push(ch&255);ch=ch>>8}while(ch);re=re+st.length}return re};var writeToTypedArray=function(buffer,string,index){var bytes=stringToBytes(string);for(var i=0;i<bytes.length;i++){buffer[index+i]=bytes[i]}return bytes.length};var supportsBuffer=typeof Buffer!="undefined";var packElement=function(name,value,checkKeys,buffer,index,serializeFunctions){var startIndex=index;switch(typeof value){case"string":buffer[index++]=BSON.BSON_DATA_STRING;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var size=supportsBuffer?Buffer.byteLength(value)+1:numberOfBytes(value)+1;buffer[index+3]=size>>24&255;buffer[index+2]=size>>16&255;buffer[index+1]=size>>8&255;buffer[index]=size&255;index=index+4;supportsBuffer?buffer.write(value,index,"utf8"):writeToTypedArray(buffer,value,index);index=index+size-1;buffer[index++]=0;return index;case"number":if(Math.floor(value)===value&&value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){if(value>=BSON.BSON_INT32_MIN&&value<=BSON.BSON_INT32_MAX){buffer[index++]=BSON.BSON_DATA_INT;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;buffer[index++]=value&255;buffer[index++]=value>>8&255;buffer[index++]=value>>16&255;buffer[index++]=value>>24&255}else if(value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8}else{buffer[index++]=BSON.BSON_DATA_LONG;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var longVal=Long.fromNumber(value);var lowBits=longVal.getLowBits();var highBits=longVal.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255}}else{buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8}return index;case"undefined":buffer[index++]=BSON.BSON_DATA_NULL;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;return index;case"boolean":buffer[index++]=BSON.BSON_DATA_BOOLEAN;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;buffer[index++]=value?1:0;return index;case"object":if(value===null||value instanceof MinKey||value instanceof MaxKey||value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){if(value===null){buffer[index++]=BSON.BSON_DATA_NULL}else if(value instanceof MinKey){buffer[index++]=BSON.BSON_DATA_MIN_KEY}else{buffer[index++]=BSON.BSON_DATA_MAX_KEY}var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;return index}else if(value instanceof ObjectID||value["_bsontype"]=="ObjectID"){buffer[index++]=BSON.BSON_DATA_OID;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;supportsBuffer?buffer.write(value.id,index,"binary"):writeToTypedArray(buffer,value.id,index);index=index+12;return index}else if(value instanceof Date||isDate(value)){buffer[index++]=BSON.BSON_DATA_DATE;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var dateInMilis=Long.fromNumber(value.getTime());var lowBits=dateInMilis.getLowBits();var highBits=dateInMilis.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255;return index}else if(typeof Buffer!=="undefined"&&Buffer.isBuffer(value)){buffer[index++]=BSON.BSON_DATA_BINARY;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var size=value.length;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer[index++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT;value.copy(buffer,index,0,size);index=index+size;return index}else if(value instanceof Long||value instanceof Timestamp||value["_bsontype"]=="Long"||value["_bsontype"]=="Timestamp"){buffer[index++]=value instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var lowBits=value.getLowBits();var highBits=value.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255;return index}else if(value instanceof Double||value["_bsontype"]=="Double"){buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8;return index}else if(value instanceof Code||value["_bsontype"]=="Code"){if(value.scope!=null&&Object.keys(value.scope).length>0){buffer[index++]=BSON.BSON_DATA_CODE_W_SCOPE;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var scopeSize=BSON.calculateObjectSize(value.scope,serializeFunctions);var functionString=value.code.toString();var codeSize=supportsBuffer?Buffer.byteLength(functionString)+1:numberOfBytes(functionString)+1;
var totalSize=4+codeSize+scopeSize+4;buffer[index++]=totalSize&255;buffer[index++]=totalSize>>8&255;buffer[index++]=totalSize>>16&255;buffer[index++]=totalSize>>24&255;buffer[index++]=codeSize&255;buffer[index++]=codeSize>>8&255;buffer[index++]=codeSize>>16&255;buffer[index++]=codeSize>>24&255;supportsBuffer?buffer.write(functionString,index,"utf8"):writeToTypedArray(buffer,functionString,index);index=index+codeSize-1;buffer[index++]=0;var scopeObjectBuffer=supportsBuffer?new Buffer(scopeSize):new Uint8Array(new ArrayBuffer(scopeSize));serializeObject(value.scope,checkKeys,scopeObjectBuffer,0,serializeFunctions);var scopeDocSize=scopeSize;buffer[index++]=scopeDocSize&255;buffer[index++]=scopeDocSize>>8&255;buffer[index++]=scopeDocSize>>16&255;buffer[index++]=scopeDocSize>>24&255;supportsBuffer?scopeObjectBuffer.copy(buffer,index,0,scopeSize):buffer.set(scopeObjectBuffer,index);index=index+scopeDocSize-5;buffer[index++]=0;return index}else{buffer[index++]=BSON.BSON_DATA_CODE;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var functionString=value.code.toString();var size=supportsBuffer?Buffer.byteLength(functionString)+1:numberOfBytes(functionString)+1;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;supportsBuffer?buffer.write(functionString,index,"utf8"):writeToTypedArray(buffer,functionString,index);index=index+size-1;buffer[index++]=0;return index}}else if(value instanceof Binary||value["_bsontype"]=="Binary"){buffer[index++]=BSON.BSON_DATA_BINARY;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var data=value.value(true);var size=value.position;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer[index++]=value.sub_type;if(value.sub_type==Binary.SUBTYPE_BYTE_ARRAY){buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255}supportsBuffer?data.copy(buffer,index,0,value.position):buffer.set(data,index);index=index+value.position;return index}else if(value instanceof Symbol||value["_bsontype"]=="Symbol"){buffer[index++]=BSON.BSON_DATA_SYMBOL;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var size=supportsBuffer?Buffer.byteLength(value.value)+1:numberOfBytes(value.value)+1;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer.write(value.value,index,"utf8");index=index+size-1;buffer[index++]=0;return index}else if(value instanceof DBRef||value["_bsontype"]=="DBRef"){buffer[index++]=BSON.BSON_DATA_OBJECT;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var ordered_values={$ref:value.namespace,$id:value.oid};if(null!=value.db){ordered_values["$db"]=value.db}var size=BSON.calculateObjectSize(ordered_values,serializeFunctions);var endIndex=BSON.serializeWithBufferAndIndex(ordered_values,checkKeys,buffer,index,serializeFunctions);buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer[endIndex++]=0;return endIndex}else if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"){buffer[index++]=BSON.BSON_DATA_REGEXP;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;supportsBuffer?buffer.write(value.source,index,"utf8"):writeToTypedArray(buffer,value.source,index);index=index+(supportsBuffer?Buffer.byteLength(value.source):numberOfBytes(value.source));buffer[index++]=0;if(value.global)buffer[index++]=115;if(value.ignoreCase)buffer[index++]=105;if(value.multiline)buffer[index++]=109;buffer[index++]=0;return index}else{buffer[index++]=Array.isArray(value)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var endIndex=serializeObject(value,checkKeys,buffer,index+4,serializeFunctions);var size=endIndex-index;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;return endIndex}case"function":if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"||String.call(value)=="[object RegExp]"){buffer[index++]=BSON.BSON_DATA_REGEXP;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;buffer.write(value.source,index,"utf8");index=index+(supportsBuffer?Buffer.byteLength(value.source):numberOfBytes(value.source));buffer[index++]=0;if(value.global)buffer[index++]=115;if(value.ignoreCase)buffer[index++]=105;if(value.multiline)buffer[index++]=109;buffer[index++]=0;return index}else{if(serializeFunctions&&value.scope!=null&&Object.keys(value.scope).length>0){buffer[index++]=BSON.BSON_DATA_CODE_W_SCOPE;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var scopeSize=BSON.calculateObjectSize(value.scope,serializeFunctions);var functionString=value.toString();var codeSize=supportsBuffer?Buffer.byteLength(functionString)+1:numberOfBytes(functionString)+1;var totalSize=4+codeSize+scopeSize;buffer[index++]=totalSize&255;buffer[index++]=totalSize>>8&255;buffer[index++]=totalSize>>16&255;buffer[index++]=totalSize>>24&255;buffer[index++]=codeSize&255;buffer[index++]=codeSize>>8&255;buffer[index++]=codeSize>>16&255;buffer[index++]=codeSize>>24&255;supportsBuffer?buffer.write(functionString,index,"utf8"):writeToTypedArray(buffer,functionString,index);index=index+codeSize-1;buffer[index++]=0;var scopeObjectBuffer=new Buffer(scopeSize);serializeObject(value.scope,checkKeys,scopeObjectBuffer,0,serializeFunctions);var scopeDocSize=scopeSize-4;buffer[index++]=scopeDocSize&255;buffer[index++]=scopeDocSize>>8&255;buffer[index++]=scopeDocSize>>16&255;buffer[index++]=scopeDocSize>>24&255;scopeObjectBuffer.copy(buffer,index,0,scopeSize);index=index+scopeDocSize-5;buffer[index++]=0;return index}else if(serializeFunctions){buffer[index++]=BSON.BSON_DATA_CODE;var numberOfWrittenBytes=supportsBuffer?buffer.write(name,index,"utf8"):writeToTypedArray(buffer,name,index);index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var functionString=value.toString();var size=supportsBuffer?Buffer.byteLength(functionString)+1:numberOfBytes(functionString)+1;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;supportsBuffer?buffer.write(functionString,index,"utf8"):writeToTypedArray(buffer,functionString,index);index=index+size-1;buffer[index++]=0;return index}}}return index};BSON.serialize=function(object,checkKeys,asBuffer,serializeFunctions){if(object==null||typeof object!="object"||Array.isArray(object))throw new Error("Only javascript objects supported");var buffer=null;var size=BSON.calculateObjectSize(object,serializeFunctions);if(buffer=typeof Buffer!="undefined"){buffer=new Buffer(size);asBuffer=true}else if(typeof Uint8Array!="undefined"){buffer=new Uint8Array(new ArrayBuffer(size))}else{buffer=new Array(size)}BSON.serializeWithBufferAndIndex(object,checkKeys,buffer,0,serializeFunctions);return buffer};var functionCache=BSON.functionCache={};var table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];var crc32=function(string,start,end){var crc=0;var x=0;var y=0;crc=crc^-1;for(var i=start,iTop=end;i<iTop;i++){y=(crc^string[i])&255;x=table[y];crc=crc>>>8^x}return crc^-1};BSON.deserializeStream=function(data,startIndex,numberOfDocuments,documents,docStartIndex,options){options=options!=null?options:{};var index=startIndex;for(var i=0;i<numberOfDocuments;i++){var size=data[index]|data[index+1]<<8|data[index+2]<<16|data[index+3]<<24;options["index"]=index;documents[docStartIndex+i]=BSON.deserialize(data,options);index=index+size}return index};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;if(functionCache[hash]==null){eval("value = "+functionString);functionCache[hash]=value}return functionCache[hash].bind(object)};var isolateEval=function(functionString){var value=null;eval("value = "+functionString);return value};var convertUint8ArrayToUtf8String=function(byteArray,startIndex,endIndex){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(byteArray,startIndex,endIndex))};var convertArraytoUtf8BinaryString=function(byteArray,startIndex,endIndex){var result="";for(var i=startIndex;i<endIndex;i++){result=result+String.fromCharCode(byteArray[i])}return result};BSON.deserialize=function(buffer,options,isArray){options=options==null?{}:options;var evalFunctions=options["evalFunctions"]==null?false:options["evalFunctions"];var cacheFunctions=options["cacheFunctions"]==null?false:options["cacheFunctions"];var cacheFunctionsCrc32=options["cacheFunctionsCrc32"]==null?false:options["cacheFunctionsCrc32"];var promoteLongs=options["promoteLongs"]||true;if(buffer.length<5)throw new Error("corrupt bson message < 5 bytes long");var index=typeof options["index"]=="number"?options["index"]:0;var readCStyleString=function(){var i=index;while(buffer[i]!==0){i++}var string=supportsBuffer&&Buffer.isBuffer(buffer)?buffer.toString("utf8",index,i):convertUint8ArrayToUtf8String(buffer,index,i);index=i+1;return string};var object=isArray?[]:{};var size=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(size<5||size>buffer.length)throw new Error("corrupt bson message");while(true){var elementType=buffer[index++];if(elementType==0)break;var name=readCStyleString();switch(elementType){case BSON.BSON_DATA_OID:var string=supportsBuffer&&Buffer.isBuffer(buffer)?buffer.toString("binary",index,index+12):convertArraytoUtf8BinaryString(buffer,index,index+12);object[name]=new ObjectID(string);index=index+12;break;case BSON.BSON_DATA_STRING:var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=supportsBuffer&&Buffer.isBuffer(buffer)?buffer.toString("utf8",index,index+stringSize-1):convertUint8ArrayToUtf8String(buffer,index,index+stringSize-1);index=index+stringSize;break;case BSON.BSON_DATA_INT:object[name]=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;break;case BSON.BSON_DATA_NUMBER:object[name]=readIEEE754(buffer,index,"little",52,8);index=index+8;break;case BSON.BSON_DATA_DATE:var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=new Date(new Long(lowBits,highBits).toNumber());break;case BSON.BSON_DATA_BOOLEAN:object[name]=buffer[index++]==1;break;case BSON.BSON_DATA_NULL:object[name]=null;break;case BSON.BSON_DATA_BINARY:var binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var subType=buffer[index++];if(buffer["slice"]!=null){if(subType==Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24}object[name]=new Binary(buffer.slice(index,index+binarySize),subType)}else{var _buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(binarySize)):new Array(binarySize);if(subType==Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24}for(var i=0;i<binarySize;i++){_buffer[i]=buffer[index+i]}object[name]=new Binary(_buffer,subType)}index=index+binarySize;break;case BSON.BSON_DATA_ARRAY:options["index"]=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;object[name]=BSON.deserialize(buffer,options,true);index=index+objectSize;break;case BSON.BSON_DATA_OBJECT:options["index"]=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;object[name]=BSON.deserialize(buffer,options,false);index=index+objectSize;break;case BSON.BSON_DATA_REGEXP:var source=readCStyleString();var regExpOptions=readCStyleString();var optionsArray=new Array(regExpOptions.length);for(var i=0;i<regExpOptions.length;i++){switch(regExpOptions[i]){case"m":optionsArray[i]="m";break;case"s":optionsArray[i]="g";break;case"i":optionsArray[i]="i";break}}object[name]=new RegExp(source,optionsArray.join(""));break;case BSON.BSON_DATA_LONG:var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var long=new Long(lowBits,highBits);if(promoteLongs){object[name]=long.lessThanOrEqual(JS_INT_MAX_LONG)&&long.greaterThanOrEqual(JS_INT_MIN_LONG)?long.toNumber():long}else{object[name]=long}break;case BSON.BSON_DATA_SYMBOL:var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=new Symbol(buffer.toString("utf8",index,index+stringSize-1));index=index+stringSize;break;case BSON.BSON_DATA_TIMESTAMP:var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=new Timestamp(lowBits,highBits);break;case BSON.BSON_DATA_MIN_KEY:object[name]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:object[name]=new MaxKey;break;case BSON.BSON_DATA_CODE:var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var functionString=supportsBuffer&&Buffer.isBuffer(buffer)?buffer.toString("utf8",index,index+stringSize-1):convertUint8ArrayToUtf8String(buffer,index,index+stringSize-1);if(evalFunctions){var value=null;if(cacheFunctions){var hash=cacheFunctionsCrc32?crc32(functionString):functionString;object[name]=isolateEvalWithHash(functionCache,hash,functionString,object)}else{object[name]=isolateEval(functionString)}}else{object[name]=new Code(functionString,{})}index=index+stringSize;break;case BSON.BSON_DATA_CODE_W_SCOPE:var totalSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var functionString=supportsBuffer&&Buffer.isBuffer(buffer)?buffer.toString("utf8",index,index+stringSize-1):convertUint8ArrayToUtf8String(buffer,index,index+stringSize-1);index=index+stringSize;options["index"]=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;var scopeObject=BSON.deserialize(buffer,options,false);index=index+objectSize;if(evalFunctions){var value=null;if(cacheFunctions){var hash=cacheFunctionsCrc32?crc32(functionString):functionString;object[name]=isolateEvalWithHash(functionCache,hash,functionString,object)}else{object[name]=isolateEval(functionString)}object[name].scope=scopeObject}else{object[name]=new Code(functionString,scopeObject)}break}}if(object["$id"]!=null)object=new DBRef(object["$ref"],object["$id"],object["$db"]);return object};BSON.checkKey=function checkKey(key,dollarsAndDotsOk){if(!key.length)return;if(!!~key.indexOf("\x00")){throw Error("key "+key+" must not contain null bytes")}if(!dollarsAndDotsOk){if("$"==key[0]){throw Error("key "+key+" must not start with '$'")}else if(!!~key.indexOf(".")){throw Error("key "+key+" must not contain '.'")}}};BSON.prototype.deserialize=function(data,options){return BSON.deserialize(data,options)};BSON.prototype.deserializeStream=function(data,startIndex,numberOfDocuments,documents,docStartIndex,options){return BSON.deserializeStream(data,startIndex,numberOfDocuments,documents,docStartIndex,options)};BSON.prototype.serialize=function(object,checkKeys,asBuffer,serializeFunctions){return BSON.serialize(object,checkKeys,asBuffer,serializeFunctions)};BSON.prototype.calculateObjectSize=function(object,serializeFunctions){return BSON.calculateObjectSize(object,serializeFunctions)};BSON.prototype.serializeWithBufferAndIndex=function(object,checkKeys,buffer,startIndex,serializeFunctions){return BSON.serializeWithBufferAndIndex(object,checkKeys,buffer,startIndex,serializeFunctions)};exports.Code=Code;exports.Symbol=Symbol;exports.BSON=BSON;exports.DBRef=DBRef;exports.Binary=Binary;exports.ObjectID=ObjectID;exports.Long=Long;exports.Timestamp=Timestamp;exports.Double=Double;exports.MinKey=MinKey;exports.MaxKey=MaxKey},code:function(module,exports,global,require,undefined){function Code(code,scope){if(!(this instanceof Code))return new Code(code,scope);this._bsontype="Code";this.code=code;this.scope=scope==null?{}:scope}Code.prototype.toJSON=function(){return{scope:this.scope,code:this.code}};exports.Code=Code},db_ref:function(module,exports,global,require,undefined){function DBRef(namespace,oid,db){if(!(this instanceof DBRef))return new DBRef(namespace,oid,db);this._bsontype="DBRef";this.namespace=namespace;this.oid=oid;this.db=db}DBRef.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:this.db==null?"":this.db}};exports.DBRef=DBRef},"double":function(module,exports,global,require,undefined){function Double(value){if(!(this instanceof Double))return new Double(value);this._bsontype="Double";this.value=value}Double.prototype.valueOf=function(){return this.value};Double.prototype.toJSON=function(){return this.value};exports.Double=Double},float_parser:function(module,exports,global,require,undefined){var readIEEE754=function(buffer,offset,endian,mLen,nBytes){var e,m,bBE=endian==="big",eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=bBE?0:nBytes-1,d=bBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};var writeIEEE754=function(buffer,value,offset,endian,mLen,nBytes){var e,m,c,bBE=endian==="big",eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=bBE?nBytes-1:0,d=bBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128};exports.readIEEE754=readIEEE754;exports.writeIEEE754=writeIEEE754},index:function(module,exports,global,require,undefined){try{exports.BSONPure=require("./bson");exports.BSONNative=require("../../ext")}catch(err){}["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long"].forEach(function(path){var module=require("./"+path);for(var i in module){exports[i]=module[i]}});exports.native=function(){var classes={};["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","../../ext"].forEach(function(path){var module=require("./"+path);for(var i in module){classes[i]=module[i]}});return classes};exports.pure=function(){var classes={};["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","././bson"].forEach(function(path){var module=require("./"+path);for(var i in module){classes[i]=module[i]}});return classes}},"long":function(module,exports,global,require,undefined){function Long(low,high){if(!(this instanceof Long))return new Long(low,high);this._bsontype="Long";this.low_=low|0;this.high_=high|0}Long.prototype.toInt=function(){return this.low_};Long.prototype.toNumber=function(){return this.high_*Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Long.prototype.toJSON=function(){return this.toString()};Long.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){var radixLong=Long.fromNumber(radix);var div=this.div(radixLong);var rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=Long.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}};Long.prototype.getHighBits=function(){return this.high_};Long.prototype.getLowBits=function(){return this.low_};Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Long.TWO_PWR_32_DBL_+this.low_};Long.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}};Long.prototype.isZero=function(){return this.high_==0&&this.low_==0};Long.prototype.isNegative=function(){return this.high_<0};Long.prototype.isOdd=function(){return(this.low_&1)==1};Long.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_};Long.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_};Long.prototype.lessThan=function(other){return this.compare(other)<0};Long.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0};Long.prototype.greaterThan=function(other){return this.compare(other)>0};Long.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0};Long.prototype.compare=function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}};Long.prototype.negate=function(){if(this.equals(Long.MIN_VALUE)){return Long.MIN_VALUE}else{return this.not().add(Long.ONE)}};Long.prototype.add=function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32)};Long.prototype.subtract=function(other){return this.add(other.negate())};Long.prototype.multiply=function(other){if(this.isZero()){return Long.ZERO}else if(other.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){return other.isOdd()?Long.MIN_VALUE:Long.ZERO}else if(other.equals(Long.MIN_VALUE)){return this.isOdd()?Long.MIN_VALUE:Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(Long.TWO_PWR_24_)&&other.lessThan(Long.TWO_PWR_24_)){return Long.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32)};Long.prototype.div=function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){if(other.equals(Long.ONE)||other.equals(Long.NEG_ONE)){return Long.MIN_VALUE}else if(other.equals(Long.MIN_VALUE)){return Long.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(Long.ZERO)){return other.isNegative()?Long.ONE:Long.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(Long.MIN_VALUE)){return Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=Long.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=Long.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=Long.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=Long.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res};Long.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))};Long.prototype.not=function(){return Long.fromBits(~this.low_,~this.high_)};Long.prototype.and=function(other){return Long.fromBits(this.low_&other.low_,this.high_&other.high_)};Long.prototype.or=function(other){return Long.fromBits(this.low_|other.low_,this.high_|other.high_)};Long.prototype.xor=function(other){return Long.fromBits(this.low_^other.low_,this.high_^other.high_)};Long.prototype.shiftLeft=function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return Long.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return Long.fromBits(0,low<<numBits-32)}}};Long.prototype.shiftRight=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return Long.fromBits(high>>numBits-32,high>=0?0:-1)}}};Long.prototype.shiftRightUnsigned=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return Long.fromBits(high,0)}else{return Long.fromBits(high>>>numBits-32,0)}}};Long.fromInt=function(value){if(-128<=value&&value<128){var cachedObj=Long.INT_CACHE_[value];if(cachedObj){return cachedObj}}var obj=new Long(value|0,value<0?-1:0);if(-128<=value&&value<128){Long.INT_CACHE_[value]=obj}return obj};Long.fromNumber=function(value){if(isNaN(value)||!isFinite(value)){return Long.ZERO}else if(value<=-Long.TWO_PWR_63_DBL_){return Long.MIN_VALUE}else if(value+1>=Long.TWO_PWR_63_DBL_){return Long.MAX_VALUE}else if(value<0){return Long.fromNumber(-value).negate()}else{return new Long(value%Long.TWO_PWR_32_DBL_|0,value/Long.TWO_PWR_32_DBL_|0)}};Long.fromBits=function(lowBits,highBits){return new Long(lowBits,highBits)};Long.fromString=function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return Long.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=Long.fromNumber(Math.pow(radix,8));var result=Long.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(Long.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(Long.fromNumber(value))}}return result};Long.INT_CACHE_={};Long.TWO_PWR_16_DBL_=1<<16;Long.TWO_PWR_24_DBL_=1<<24;Long.TWO_PWR_32_DBL_=Long.TWO_PWR_16_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_31_DBL_=Long.TWO_PWR_32_DBL_/2;Long.TWO_PWR_48_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_64_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_32_DBL_;Long.TWO_PWR_63_DBL_=Long.TWO_PWR_64_DBL_/2;Long.ZERO=Long.fromInt(0);Long.ONE=Long.fromInt(1);Long.NEG_ONE=Long.fromInt(-1);Long.MAX_VALUE=Long.fromBits(4294967295|0,2147483647|0);Long.MIN_VALUE=Long.fromBits(0,2147483648|0);Long.TWO_PWR_24_=Long.fromInt(1<<24);exports.Long=Long},
max_key:function(module,exports,global,require,undefined){function MaxKey(){if(!(this instanceof MaxKey))return new MaxKey;this._bsontype="MaxKey"}exports.MaxKey=MaxKey},min_key:function(module,exports,global,require,undefined){function MinKey(){if(!(this instanceof MinKey))return new MinKey;this._bsontype="MinKey"}exports.MinKey=MinKey},objectid:function(module,exports,global,require,undefined){var BinaryParser=require("./binary_parser").BinaryParser;var MACHINE_ID=parseInt(Math.random()*16777215,10);var checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$");var ObjectID=function ObjectID(id,_hex){if(!(this instanceof ObjectID))return new ObjectID(id,_hex);this._bsontype="ObjectID";var __id=null;if(id!=null&&"number"!=typeof id&&(id.length!=12&&id.length!=24))throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(id==null||typeof id=="number"){this.id=this.generate(id)}else if(id!=null&&id.length===12){this.id=id}else if(checkForHexRegExp.test(id)){return ObjectID.createFromHexString(id)}else{throw new Error("Value passed in is not a valid 24 character hex string")}if(ObjectID.cacheHexString)this.__id=this.toHexString()};var ObjectId=ObjectID;var hexTable=[];for(var i=0;i<256;i++){hexTable[i]=(i<=15?"0":"")+i.toString(16)}ObjectID.prototype.toHexString=function(){if(ObjectID.cacheHexString&&this.__id)return this.__id;var hexString="";for(var i=0;i<this.id.length;i++){hexString+=hexTable[this.id.charCodeAt(i)]}if(ObjectID.cacheHexString)this.__id=hexString;return hexString};ObjectID.prototype.get_inc=function(){return ObjectID.index=(ObjectID.index+1)%16777215};ObjectID.prototype.getInc=function(){return this.get_inc()};ObjectID.prototype.generate=function(time){if("number"==typeof time){var time4Bytes=BinaryParser.encodeInt(time,32,true,true);var machine3Bytes=BinaryParser.encodeInt(MACHINE_ID,24,false);var pid2Bytes=BinaryParser.fromShort(typeof process==="undefined"?Math.floor(Math.random()*1e5):process.pid);var index3Bytes=BinaryParser.encodeInt(this.get_inc(),24,false,true)}else{var unixTime=parseInt(Date.now()/1e3,10);var time4Bytes=BinaryParser.encodeInt(unixTime,32,true,true);var machine3Bytes=BinaryParser.encodeInt(MACHINE_ID,24,false);var pid2Bytes=BinaryParser.fromShort(typeof process==="undefined"?Math.floor(Math.random()*1e5):process.pid);var index3Bytes=BinaryParser.encodeInt(this.get_inc(),24,false,true)}return time4Bytes+machine3Bytes+pid2Bytes+index3Bytes};ObjectID.prototype.toString=function(){return this.toHexString()};ObjectID.prototype.inspect=ObjectID.prototype.toString;ObjectID.prototype.toJSON=function(){return this.toHexString()};ObjectID.prototype.equals=function equals(otherID){var id=otherID instanceof ObjectID||otherID.toHexString?otherID.id:ObjectID.createFromHexString(otherID).id;return this.id===id};ObjectID.prototype.getTimestamp=function(){var timestamp=new Date;timestamp.setTime(Math.floor(BinaryParser.decodeInt(this.id.substring(0,4),32,true,true))*1e3);return timestamp};ObjectID.index=parseInt(Math.random()*16777215,10);ObjectID.createPk=function createPk(){return new ObjectID};ObjectID.createFromTime=function createFromTime(time){var id=BinaryParser.encodeInt(time,32,true,true)+BinaryParser.encodeInt(0,64,true,true);return new ObjectID(id)};ObjectID.createFromHexString=function createFromHexString(hexString){if(typeof hexString==="undefined"||hexString!=null&&hexString.length!=24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var len=hexString.length;if(len>12*2){throw new Error("Id cannot be longer than 12 bytes")}var result="",string,number;for(var index=0;index<len;index+=2){string=hexString.substr(index,2);number=parseInt(string,16);result+=BinaryParser.fromByte(number)}return new ObjectID(result,hexString)};Object.defineProperty(ObjectID.prototype,"generationTime",{enumerable:true,get:function(){return Math.floor(BinaryParser.decodeInt(this.id.substring(0,4),32,true,true))},set:function(value){var value=BinaryParser.encodeInt(value,32,true,true);this.id=value+this.id.substr(4);this.toHexString()}});exports.ObjectID=ObjectID;exports.ObjectId=ObjectID},symbol:function(module,exports,global,require,undefined){function Symbol(value){if(!(this instanceof Symbol))return new Symbol(value);this._bsontype="Symbol";this.value=value}Symbol.prototype.valueOf=function(){return this.value};Symbol.prototype.toString=function(){return this.value};Symbol.prototype.inspect=function(){return this.value};Symbol.prototype.toJSON=function(){return this.value};exports.Symbol=Symbol},timestamp:function(module,exports,global,require,undefined){function Timestamp(low,high){if(!(this instanceof Timestamp))return new Timestamp(low,high);this._bsontype="Timestamp";this.low_=low|0;this.high_=high|0}Timestamp.prototype.toInt=function(){return this.low_};Timestamp.prototype.toNumber=function(){return this.high_*Timestamp.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Timestamp.prototype.toJSON=function(){return this.toString()};Timestamp.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){var radixTimestamp=Timestamp.fromNumber(radix);var div=this.div(radixTimestamp);var rem=div.multiply(radixTimestamp).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=Timestamp.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}};Timestamp.prototype.getHighBits=function(){return this.high_};Timestamp.prototype.getLowBits=function(){return this.low_};Timestamp.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Timestamp.TWO_PWR_32_DBL_+this.low_};Timestamp.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}};Timestamp.prototype.isZero=function(){return this.high_==0&&this.low_==0};Timestamp.prototype.isNegative=function(){return this.high_<0};Timestamp.prototype.isOdd=function(){return(this.low_&1)==1};Timestamp.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_};Timestamp.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_};Timestamp.prototype.lessThan=function(other){return this.compare(other)<0};Timestamp.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0};Timestamp.prototype.greaterThan=function(other){return this.compare(other)>0};Timestamp.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0};Timestamp.prototype.compare=function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}};Timestamp.prototype.negate=function(){if(this.equals(Timestamp.MIN_VALUE)){return Timestamp.MIN_VALUE}else{return this.not().add(Timestamp.ONE)}};Timestamp.prototype.add=function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Timestamp.fromBits(c16<<16|c00,c48<<16|c32)};Timestamp.prototype.subtract=function(other){return this.add(other.negate())};Timestamp.prototype.multiply=function(other){if(this.isZero()){return Timestamp.ZERO}else if(other.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){return other.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}else if(other.equals(Timestamp.MIN_VALUE)){return this.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(Timestamp.TWO_PWR_24_)&&other.lessThan(Timestamp.TWO_PWR_24_)){return Timestamp.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Timestamp.fromBits(c16<<16|c00,c48<<16|c32)};Timestamp.prototype.div=function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){if(other.equals(Timestamp.ONE)||other.equals(Timestamp.NEG_ONE)){return Timestamp.MIN_VALUE}else if(other.equals(Timestamp.MIN_VALUE)){return Timestamp.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(Timestamp.ZERO)){return other.isNegative()?Timestamp.ONE:Timestamp.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(Timestamp.MIN_VALUE)){return Timestamp.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=Timestamp.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=Timestamp.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=Timestamp.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=Timestamp.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res};Timestamp.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))};Timestamp.prototype.not=function(){return Timestamp.fromBits(~this.low_,~this.high_)};Timestamp.prototype.and=function(other){return Timestamp.fromBits(this.low_&other.low_,this.high_&other.high_)};Timestamp.prototype.or=function(other){return Timestamp.fromBits(this.low_|other.low_,this.high_|other.high_)};Timestamp.prototype.xor=function(other){return Timestamp.fromBits(this.low_^other.low_,this.high_^other.high_)};Timestamp.prototype.shiftLeft=function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return Timestamp.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return Timestamp.fromBits(0,low<<numBits-32)}}};Timestamp.prototype.shiftRight=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Timestamp.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return Timestamp.fromBits(high>>numBits-32,high>=0?0:-1)}}};Timestamp.prototype.shiftRightUnsigned=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Timestamp.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return Timestamp.fromBits(high,0)}else{return Timestamp.fromBits(high>>>numBits-32,0)}}};Timestamp.fromInt=function(value){if(-128<=value&&value<128){var cachedObj=Timestamp.INT_CACHE_[value];if(cachedObj){return cachedObj}}var obj=new Timestamp(value|0,value<0?-1:0);if(-128<=value&&value<128){Timestamp.INT_CACHE_[value]=obj}return obj};Timestamp.fromNumber=function(value){if(isNaN(value)||!isFinite(value)){return Timestamp.ZERO}else if(value<=-Timestamp.TWO_PWR_63_DBL_){return Timestamp.MIN_VALUE}else if(value+1>=Timestamp.TWO_PWR_63_DBL_){return Timestamp.MAX_VALUE}else if(value<0){return Timestamp.fromNumber(-value).negate()}else{return new Timestamp(value%Timestamp.TWO_PWR_32_DBL_|0,value/Timestamp.TWO_PWR_32_DBL_|0)}};Timestamp.fromBits=function(lowBits,highBits){return new Timestamp(lowBits,highBits)};Timestamp.fromString=function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return Timestamp.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=Timestamp.fromNumber(Math.pow(radix,8));var result=Timestamp.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Timestamp.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(Timestamp.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(Timestamp.fromNumber(value))}}return result};Timestamp.INT_CACHE_={};Timestamp.TWO_PWR_16_DBL_=1<<16;Timestamp.TWO_PWR_24_DBL_=1<<24;Timestamp.TWO_PWR_32_DBL_=Timestamp.TWO_PWR_16_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_31_DBL_=Timestamp.TWO_PWR_32_DBL_/2;Timestamp.TWO_PWR_48_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_64_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_32_DBL_;Timestamp.TWO_PWR_63_DBL_=Timestamp.TWO_PWR_64_DBL_/2;Timestamp.ZERO=Timestamp.fromInt(0);Timestamp.ONE=Timestamp.fromInt(1);Timestamp.NEG_ONE=Timestamp.fromInt(-1);Timestamp.MAX_VALUE=Timestamp.fromBits(4294967295|0,2147483647|0);Timestamp.MIN_VALUE=Timestamp.fromBits(0,2147483648|0);Timestamp.TWO_PWR_24_=Timestamp.fromInt(1<<24);exports.Timestamp=Timestamp}});if(typeof module!="undefined"&&module.exports){module.exports=bson;if(!module.parent){bson()}}if(typeof window!="undefined"&&typeof require=="undefined"){window.require=bson.require}
