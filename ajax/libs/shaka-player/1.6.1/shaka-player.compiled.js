(function(){var g={};
(function(window){var k,aa=this;function p(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function q(a,b){function c(){}c.prototype=b.prototype;a.cc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.bc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}p("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ca(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ca.prototype.clone=function(){var a=new ca;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function da(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function ea(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}p("shaka.player.VideoTrack.compare",ea);function fa(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}p("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function r(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=r.prototype.destroy;return c}r.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function w(a,b){return b.bind(a)};function ga(a){return Object.keys(a).map(function(b){return a[b]})}function ha(a,b){var c=ia(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function ja(a,b){return ia(a,b,"string")}function ia(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}
function ka(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function la(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function ma(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};var na={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function pa(a){return String.fromCharCode.apply(null,a)}p("shaka.util.Uint8ArrayUtils.toString",pa);function qa(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}p("shaka.util.Uint8ArrayUtils.fromString",qa);p("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(pa(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function ra(a){return qa(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
p("shaka.util.Uint8ArrayUtils.fromBase64",ra);p("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function sa(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}p("shaka.util.Uint8ArrayUtils.toHex",sa);function ta(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function ua(a){this.b=a;this.a=new va(a);wa||(wa=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var wa;
function x(a){var b;b=xa(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=xa(a);a:{for(d=0;d<wa.length;d++)if(ta(c,wa[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);y(a.a,c);return new ya(b,d)}function xa(a){var b=za(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=za(a.a);return d}function ya(a,b){this.id=a;this.a=b}
function Aa(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};function z(){this.a={}}z.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};z.prototype.set=function(a,b){this.a[a]=b};z.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function Ba(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function Ca(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function Da(a){var b=[],c;for(c in a.a)b.push(c);return b};function Ea(){return Date.now()+Ga}var Ga=0;function Ha(){};function Ia(){this.h=this.a="";this.i=!1;this.u=this.l=null;this.v=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}
function Ja(a){var b=new Ia;if(!a)return b;var c=ja(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=ja(a,"licenseServerUrl");if(null!=d)b.h=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=ia(a,"withCredentials","boolean");null!=c&&(b.i=c);c=ka(a,"licensePostProcessor",Function);null!=c&&(b.l=c);c=ka(a,"licensePreProcessor",Function);null!=c&&(b.u=c);c=ia(a,"distinctiveIdentifierRequired","boolean");null!=
c&&(b.g=c);c=ia(a,"persistentStateRequired","boolean");null!=c&&(b.v=c);c=ja(a,"audioRobustness");null!=c&&(b.f=c);c=ja(a,"videoRobustness");null!=c&&(b.j=c);c=ka(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=ka(a,"initData",Object)){a=ka(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=ja(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function Ka(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=ma(c,La)}function La(a,b){return a.initDataType==b.initDataType&&ta(a.initData,b.initData)};function Ma(a){this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}Ma.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function Na(a){return a.b/(1-Math.pow(a.c,a.a))};function A(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function B(a){return new CustomEvent("error",{detail:a,bubbles:!0})};function Oa(a,b,c){Pa(b);Pa(c);return c==b||a>=Qa&&c==b.split("-")[0]||a>=Ra&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Qa=1,Ra=2;function Pa(a){a=a.toLowerCase().split("-");var b=Sa[a[0]];b&&(a[0]=b);return a.join("-")}
var Sa={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function D(a){this.ya=new z;this.v=a}p("shaka.util.FakeEventTarget",D);D.prototype.addEventListener=function(a,b,c){c||this.ya.push(a,b)};D.prototype.removeEventListener=function(a,b,c){c||Ca(this.ya,a,b)};
D.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return Ta(this,
a)};function Ta(a,b){b.currentTarget=a;for(var c=a.ya.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.v&&b.bubbles&&Ta(a.v,b);return b.defaultPrevented};function Ua(){D.call(this,null);this.a=new Ma(3);this.c=new Ma(10);this.b=0}q(Ua,D);p("shaka.util.EWMABandwidthEstimator",Ua);Ua.prototype.sample=function(a,b){if(!(65536>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(A({type:"bandwidth"}));this.b=Date.now()}};Ua.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(Na(this.a),Na(this.c))};Ua.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};
Ua.prototype.supportsCaching=function(){return!1};function va(a){var b=Va;this.b=a;this.c=b==Wa;this.a=0}var Va=0,Wa=1;function Xa(a){return a.a<a.b.byteLength}function za(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function E(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ya(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Za(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function y(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function $a(){this.g=new r;this.f=!1;this.a=null;this.b=[];this.c=null}function ab(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}$a.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});bb(this,void 0)};$a.prototype.end=function(){this.b.splice(1)};
function bb(a,b){var c=a.b[0](b),d;c?(d=c[0],a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(w(a,function(a){this.a?(this.b=[],this.c=null,cb(this)):(this.b.shift(),this.b.length?bb(this,a):(this.g.resolve(a),this.c=null))})).catch(w(a,function(a){this.b=[];this.c=null;this.a?cb(this):this.g.reject(a)}))}function cb(a){var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function F(){this.a=new z}F.prototype.destroy=function(){db(this);this.a=null};function G(a,b,c,d){b=new eb(b,c,d);a.a.push(c,b)}F.prototype.sa=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.sa(),Ca(this.a,b,e))}};function db(a){for(var b=Ba(a.a),c=0;c<b.length;++c)b[c].sa();a.a.a={}}function eb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
eb.prototype.sa=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function fb(a,b){D.call(this,b);this.a=null;this.h=a}q(fb,D);
function gb(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new r,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=w(a,function(a){this.a=a.target.result;hb(this,"group_store",{keyPath:"group_id"});hb(this,"stream_index_store",{keyPath:"stream_id"});a=hb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=w(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function ib(a){a.a&&(a.a.close(),a.a=null)}function hb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function jb(a){return kb(a,"content_store")}function lb(a){return kb(a,"stream_index_store")}function mb(a){return kb(a,"group_store")}
function kb(a,b){return a.a.transaction([b],a.h).objectStore(b)}function nb(a,b){var c=new r,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function ob(){fb.call(this,"readonly",null)}q(ob,fb);function pb(a){var b=new r,c=[],d=mb(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function qb(a,b){return nb(mb(a),b).then(w(a,function(a){a.session_ids=ma(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):rb(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function rb(a,b){return nb(lb(a),b)}function sb(a,b,c){return nb(jb(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function tb(a,b,c){MediaSource.isTypeSupported(b);b=a.addSourceBuffer(b);this.v=a;this.c=b;this.l=c;this.i=new F;this.g=null;this.b=[];this.w=0;this.f=this.a=null;this.u=0;G(this.i,this.c,"updateend",this.B.bind(this))}var ub=1/60;tb.prototype.destroy=function(){vb(this).catch(function(){});this.f&&this.f.destroy();this.a=this.f=null;this.g&&(ib(this.g),this.g=null);this.b=null;this.i.destroy();this.v=this.c=this.i=null};
function wb(a,b){for(var c=a.c.buffered,d=0;d<c.length;++d){var e=c.start(d)-ub,f=c.end(d)+ub;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function xb(a,b,c,d){if(a.a)return a=Error("Cannot fetch ("+a.j+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new $a;c!=a.c.timestampOffset&&(a.c.timestampOffset=c);"idb"!=b.url.b[0].P||a.g||(a.g=new ob,ab(a.a,function(){return[gb(this.g)]}.bind(a)));d&&ab(a.a,function(){return[yb(this,d),this.h.bind(this)]}.bind(a));ab(a.a,function(){var a=b.a?b.a-b.b:1,c=new zb;c.a=3;c.h=1E3*a;c.c=1E3*this.u;c.i=this.g;return[Ab(b.url,c,this.l),H.prototype.g.bind(b.url)]}.bind(a));
ab(a.a,w(a,function(a){this.l.getBandwidth();return[yb(this,a),this.h.bind(this)]}));var e=0==a.c.buffered.length&&0==a.b.length,f=null;ab(a.a,function(){if(0==this.c.buffered.length){var a=Error("Failed to buffer segment ("+this.j+").");a.type="stream";return[Promise.reject(a)]}e&&(a=b.b,f=this.c.buffered.start(0)-a);a=Bb(this.b,b.b);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return Cb(a).then(function(){return Promise.resolve(f)}.bind(a))}
function Db(a){if(a.a)return a=Error("Cannot clear ("+a.j+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new $a;ab(a.a,function(){var a;a:if(0==this.c.buffered.length)a=Promise.resolve();else{try{this.c.remove(0,Number.POSITIVE_INFINITY)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.f=new r}return[a,this.h.bind(this)]}.bind(a));return Cb(a)}
function Eb(a,b){if(a.a){var c=Error("Cannot clearAfter ("+a.j+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new $a;ab(a.a,function(){return[Fb(this,b),this.h.bind(this)]}.bind(a));return Cb(a)}function vb(a){a.a?(a=a.a,a.a?a=a.a:a.f?(a.c&&a.c(),a.a=new r,a=a.a):(a.f=!0,a=Promise.resolve())):a=Promise.resolve();return a}function Cb(a){a.a.start();return a.a.g.then(w(a,function(){this.a=null})).catch(w(a,function(a){this.a=null;return Promise.reject(a)}))}
function yb(a,b){try{a.c.appendBuffer(b)}catch(c){return Promise.reject(c)}a.f=new r;return a.f}function Fb(a,b){if(0==a.c.buffered.length)return Promise.resolve();var c=Bb(a.b,b);if(-1==c||c==a.b.length-1)return Promise.resolve();try{a.c.remove(a.b[c+1].b,Number.POSITIVE_INFINITY)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.f=new r;return a.f}tb.prototype.h=function(){"open"==this.v.readyState&&this.c.abort()};tb.prototype.B=function(){this.f.resolve();this.f=null};function Gb(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}Gb("error");Gb("warn");Gb("info");Gb("log");Gb("debug");function I(){this.fontSize="100%";this.fontColor=Hb;this.fontOpacity=Ib;this.backgroundColor=Kb;this.backgroundOpacity=Ib;this.fontEdge=Lb}p("shaka.player.TextStyle",I);I.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}}};I.prototype.load=I.prototype.a;I.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};
I.prototype.store=I.prototype.b;function Mb(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+Nb(a.fontColor,a.fontOpacity));b.push("background-color: "+Nb(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(Nb(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function Nb(a,b){return"rgba("+a.concat(b).join(",")+")"}var Hb=[255,255,255],Kb=[0,0,0];
I.StandardColors={WHITE:Hb,BLACK:Kb,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var Ib=1;I.StandardOpacities={OPAQUE:Ib,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var Lb=[];
I.EdgeStyles={NONE:Lb,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function Ob(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new va(new DataView(a.buffer));try{for(;Xa(a);){var b=a.a,c=E(a),d=E(a);1==c?c=Ya(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)y(a,c-(a.a-b));else{var e=za(a);if(1<e)y(a,c-(a.a-b));else{y(a,3);var f=sa(Za(a)),g=[];if(0<e)for(var h=E(a),l=0;l<h;++l){var m=sa(Za(a));g.push(m)}var n=E(a);y(a,n);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&y(a,c-(a.a-b))}}}}catch(t){}};function Pb(a){Qb[a]={na:Rb(),end:NaN}}function Sb(a){if(a=Qb[a])a.end=Rb()}function Tb(a){return(a=Qb[a])&&a.end?a.end-a.na:NaN}var Rb=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,Qb={};function J(a){this.c=[];this.b=[];this.ba=Ub;if(a)try{a(this.W.bind(this),this.a.bind(this))}catch(b){this.a(b)}}var Ub=0;function Vb(){window.Promise||(window.Promise=J,window.Promise.resolve=Wb,window.Promise.reject=Xb,window.Promise.all=Yb,window.Promise.race=Zb,$b=window.setImmediate?function(a){window.setImmediate(a)}:function(a){window.setTimeout(a,0)})}p("shaka.polyfill.Promise.install",Vb);function Wb(a){var b=new J;b.W(a);return b}function Xb(a){var b=new J;b.a(a);return b}
function Yb(a){function b(a,b,c){a.ba==Ub&&(e[b]=c,d++,d==e.length&&a.W(e))}var c=new J;if(!a.length)return c.W([]),c;for(var d=0,e=Array(a.length),f=c.a.bind(c),g=0;g<a.length;++g)a[g].then?a[g].then(b.bind(null,c,g),f):b(c,g,a[g]);return c}function Zb(a){for(var b=new J,c=b.W.bind(b),d=b.a.bind(b),e=0;e<a.length;++e)a[e].then?a[e].then(c,d):c(a[e]);return b}
J.prototype.then=function(a,b){var c=new J;switch(this.ba){case 1:ac(this,c,a);break;case 2:ac(this,c,b);break;case Ub:this.c.push({Ia:c,Ba:a}),this.b.push({Ia:c,Ba:b})}return c};J.prototype.then=J.prototype.then;J.prototype.catch=function(a){return this.then(void 0,a)};J.prototype["catch"]=J.prototype.catch;J.prototype.W=function(a){if(this.ba==Ub){this.wa=a;this.ba=1;for(a=0;a<this.c.length;++a)ac(this,this.c[a].Ia,this.c[a].Ba);this.c=[];this.b=[]}};
J.prototype.a=function(a){if(this.ba==Ub){this.wa=a;this.ba=2;for(a=0;a<this.b.length;++a)ac(this,this.b[a].Ia,this.b[a].Ba);this.c=[];this.b=[]}};function ac(a,b,c){$b(function(){if(c&&"function"==typeof c){try{var a=c(this.wa)}catch(e){b.a(e);return}a instanceof J?a==b?b.a(new TypeError("Chaining cycle detected")):a.then(b.W.bind(b),b.a.bind(b)):b.W(a)}else 1==this.ba?b.W(this.wa):b.a(this.wa)}.bind(a))}function $b(){};function bc(a,b){try{var c=new cc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function cc(a,b){this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];if(l.contentType){var g=!0,m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.audioCapabilities.push(l),c=!0)}}if(e.videoCapabilities)for(h=
0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}
cc.prototype.createMediaKeys=function(){var a=new dc(this.keySystem);return Promise.resolve(a)};cc.prototype.getConfiguration=function(){return this.a};function ec(a){var b=this.mediaKeys;b&&b!=a&&fc(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?fc(a,this):Promise.resolve()}function dc(a){this.a=new MSMediaKeys(a);this.b=new F}dc.prototype.createSession=function(a){if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new gc(this.a)};
dc.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};function fc(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}db(a.b);if(!b)return Promise.resolve();G(a.b,b,"msneedkey",hc);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function gc(a){D.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new F;this.sessionId="";this.expiration=NaN;this.closed=new r;this.keyStatuses=new ic}q(gc,D);k=gc.prototype;k.generateRequest=function(a,b){this.a=new r;try{this.c=this.g.createSession("video/mp4",b),G(this.f,this.c,"mskeymessage",this.Db.bind(this)),G(this.f,this.c,"mskeyadded",this.Bb.bind(this)),G(this.f,this.c,"mskeyerror",this.Cb.bind(this)),jc(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};
k.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))};k.update=function(a){this.b=new r;try{this.c.update(a)}catch(b){this.b.reject(b)}return this.b};k.close=function(){try{this.c.close(),this.closed.resolve(),db(this.f)}catch(a){this.closed.reject(a)}return this.closed};k.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function hc(a){var b=a.initData;if(b){var c=new Ob(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=ma(d,kc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=A({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function kc(a,b){return ta(a,b)}
k.Db=function(a){this.a&&(this.a.resolve(),this.a=null);a=A({type:"message",messageType:void 0==this.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};k.Bb=function(){this.a?(this.a.resolve(),this.a=null):this.b&&(jc(this,"usable"),this.b.resolve(),this.b=null)};
k.Cb=function(){var a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:jc(this,"output-not-allowed");default:jc(this,"internal-error")}};function jc(a,b){a.keyStatuses.Ma(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}function lc(a){this.b=a;this.a=0}
lc.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function ic(){this.size=0;this.a=void 0}var mc;k=ic.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};k.entries=function(){var a=mc,b=[];this.a&&b.push([a,this.a]);return new lc(b)};k.forEach=function(a){this.a&&a(this.a,mc)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=mc;return this.a&&ta(new Uint8Array(a),b)?!0:!1};
k.keys=function(){var a=mc,b=[];this.a&&b.push(a);return new lc(b)};k.values=function(){var a=[];this.a&&a.push(this.a);return new lc(a)};function nc(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=oc)}p("shaka.polyfill.CustomEvent.install",nc);function oc(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function pc(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=qc)}p("shaka.polyfill.VideoPlaybackQuality.install",pc);function qc(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function sc(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
tc);document.addEventListener("webkitfullscreenerror",tc);document.addEventListener("mozfullscreenchange",tc);document.addEventListener("mozfullscreenerror",tc);document.addEventListener("MSFullscreenChange",tc);document.addEventListener("MSFullscreenError",tc)}p("shaka.polyfill.Fullscreen.install",sc);function tc(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function uc(){return Promise.reject(Error("The key system specified is not supported."))}function vc(a){return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function wc(){throw new TypeError("Illegal constructor.");}wc.prototype.createSession=function(){};wc.prototype.setServerCertificate=function(){};function xc(){throw new TypeError("Illegal constructor.");}xc.prototype.getConfiguration=function(){};xc.prototype.createMediaKeys=function(){};function yc(a,b){try{var c=new zc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function Ac(a){var b=this.mediaKeys;b&&b!=a&&Bc(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&Bc(a,this);return Promise.resolve()}
function zc(a,b){this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var n=g.audioCapabilities[m];
n.contentType&&(l=!0,e.canPlayType(n.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(n),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)n=g.videoCapabilities[m],n.contentType&&(l=!0,e.canPlayType(n.contentType,this.a)&&(h.videoCapabilities.push(n),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=h;return}}c=
"Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}zc.prototype.createMediaKeys=function(){var a=new Cc(this.a);return Promise.resolve(a)};zc.prototype.getConfiguration=function(){return this.b};function Cc(a){this.g=a;this.b=null;this.a=new F;this.c=[];this.f={}}
function Bc(a,b){a.b=b;db(a.a);b&&(G(a.a,b,"webkitneedkey",a.Rb.bind(a)),G(a.a,b,"webkitkeymessage",a.Qb.bind(a)),G(a.a,b,"webkitkeyadded",a.Ob.bind(a)),G(a.a,b,"webkitkeyerror",a.Pb.bind(a)))}k=Cc.prototype;k.createSession=function(a){var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new Dc(a,this.g,b);this.c.push(b);return b};
k.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};k.Rb=function(a){a=A({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};k.Qb=function(a){var b=Ec(this,a.sessionId);b&&(a=A({type:"message",messageType:void 0==b.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message}),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a))};
k.Ob=function(a){if(a=Ec(this,a.sessionId))Fc(a,"usable"),a.a&&a.a.resolve(),a.a=null};
k.Pb=function(a){var b=Ec(this,a.sessionId);if(b){var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Fc(b,"output-restricted"):1==c?Fc(b,"expired"):Fc(b,"internal-error"))}};
function Ec(a,b){var c=a.f[b];return c?c:(c=a.c.shift())?(c.sessionId=b,a.f[b]=c):null}function Dc(a,b,c){D.call(this,null);this.f=a;this.h=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new r;this.keyStatuses=new Gc}q(Dc,D);
function Hc(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.g)if(c)d=qa("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=qa("PERSISTENT|"+pa(e))}else d=new Uint8Array(b)}catch(f){return Promise.reject(f)}a.b=new r;try{a.f.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,d)}catch(a){this.b.reject(a),
this.b=null}}.bind(a),10)}return a.b}k=Dc.prototype;k.Qa=function(a,b){if(this.a)this.a.then(this.Qa.bind(this,a,b)).catch(this.Qa.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=pa(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=ra(d.keys[0].k),d=ra(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.f.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function Fc(a,b){a.keyStatuses.Ma(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}k.generateRequest=function(a,b){return Hc(this,b,null)};k.load=function(a){return"persistent-license"==this.g?Hc(this,null,a):Promise.reject(Error("Not a persistent session."))};k.update=function(a){var b=new r;this.Qa(b,a);return b};
k.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};k.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};function Ic(a){this.b=a;this.a=0}
Ic.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function Gc(){this.size=0;this.a=void 0}var Jc;k=Gc.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};k.entries=function(){var a=Jc,b=[];this.a&&b.push([a,this.a]);return new Ic(b)};k.forEach=function(a){this.a&&a(this.a,Jc)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=Jc;return this.a&&ta(new Uint8Array(a),b)?!0:!1};
k.keys=function(){var a=Jc,b=[];this.a&&b.push(a);return new Ic(b)};k.values=function(){var a=[];this.a&&a.push(this.a);return new Ic(a)};function Kc(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(Jc=new Uint8Array([0]),Navigator.prototype.requestMediaKeySystemAccess=yc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ac,window.MediaKeys=Cc,window.MediaKeySystemAccess=zc):window.MSMediaKeys?(mc=new Uint8Array([0]),delete HTMLMediaElement.prototype.mediaKeys,
HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=ec,window.MediaKeys=dc,window.MediaKeySystemAccess=cc,Navigator.prototype.requestMediaKeySystemAccess=bc):(Navigator.prototype.requestMediaKeySystemAccess=uc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=vc,window.MediaKeys=wc,window.MediaKeySystemAccess=xc))}p("shaka.polyfill.MediaKeys.install",Kc);p("shaka.polyfill.installAll",function(){nc();sc();pc();Vb();Kc()});var Lc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function K(a){var b;a instanceof K?(Mc(this,a.P),this.ca=a.ca,this.S=a.S,Nc(this,a.ia),this.O=a.O,Oc(this,a.a.clone()),this.aa=a.aa):a&&(b=String(a).match(Lc))?(Mc(this,b[1]||"",!0),this.ca=Pc(b[2]||""),this.S=Pc(b[3]||"",!0),Nc(this,b[4]),this.O=Pc(b[5]||"",!0),Oc(this,b[6]||"",!0),this.aa=Pc(b[7]||"")):this.a=new Qc(null)}k=K.prototype;k.P="";k.ca="";k.S="";k.ia=null;k.O="";k.aa="";
k.toString=function(){var a=[],b=this.P;b&&a.push(Rc(b,Sc,!0),":");if(b=this.S){a.push("//");var c=this.ca;c&&a.push(Rc(c,Sc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.ia;null!=b&&a.push(":",String(b))}if(b=this.O)this.S&&"/"!=b.charAt(0)&&a.push("/"),a.push(Rc(b,"/"==b.charAt(0)?Tc:Uc,!0));(b=this.a.toString())&&a.push("?",b);(b=this.aa)&&a.push("#",Rc(b,Vc));return a.join("")};
k.resolve=function(a){var b=this.clone();"data"===b.P&&(b=new K);var c=!!a.P;c?Mc(b,a.P):c=!!a.ca;c?b.ca=a.ca:c=!!a.S;c?b.S=a.S:c=null!=a.ia;var d=a.O;if(c)Nc(b,a.ia);else if(c=!!a.O){if("/"!=d.charAt(0))if(this.S&&!this.O)d="/"+d;else{var e=b.O.lastIndexOf("/");-1!=e&&(d=b.O.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==h?((1<f.length||
1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.O=d:c=""!==a.a.toString();c?Oc(b,a.a.clone()):c=!!a.aa;c&&(b.aa=a.aa);return b};k.clone=function(){return new K(this)};function Mc(a,b,c){a.P=c?Pc(b,!0):b;a.P&&(a.P=a.P.replace(/:$/,""))}function Nc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.ia=b}else a.ia=null}function Oc(a,b,c){b instanceof Qc?a.a=b:(c||(b=Rc(b,Wc)),a.a=new Qc(b))}
function Pc(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Rc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,Xc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Xc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Sc=/[#\/\?@]/g,Uc=/[\#\?:]/g,Tc=/[\#\?]/g,Wc=/[\#\?@]/g,Vc=/#/g;function Qc(a){this.b=a||null}Qc.prototype.a=null;Qc.prototype.c=null;
function Yc(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";Yc(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Qc.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};Qc.prototype.clone=function(){var a=new Qc;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function Zc(a,b){this.url=a;this.b=b||new zb;this.g=this.i=this.h=0;this.a=null;this.c=new r;this.f=null}function zb(){this.body=null;this.a=1;this.h=1E3;this.c=0;this.method="GET";this.f="arraybuffer";this.b={};this.g=this.j=!1;this.i=null}function $c(a){ad(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function ad(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}k=Zc.prototype;
k.rb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.f&&(b=qa(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);$c(this);return b}if(0==this.url.lastIndexOf("idb:",0))return bd(this);this.h++;this.i=Date.now();this.g||
(this.g=this.b.h);this.a=new XMLHttpRequest;a=this.url;if(this.f&&!this.f.supportsCaching()||this.b.g)a=new K(a),Yc(a.a,"_",Date.now()),a=a.toString();this.a.open(this.b.method,a,!0);this.a.responseType=this.b.f;this.a.timeout=this.b.c;this.a.withCredentials=this.b.j;this.a.onload=this.zb.bind(this);this.b.g&&(this.a.onreadystatechange=this.Gb.bind(this));this.a.onerror=this.Xb.bind(this);this.a.ontimeout=this.Lb.bind(this);for(b in this.b.b)this.a.setRequestHeader(b,this.b.b[b]);this.a.send(this.b.body);
return this.c};function bd(a){var b=a.url.split("/");return sb(a.b.i,parseInt(b[2],10),parseInt(b[3],10)).then(w(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);$c(this);return a})).catch(w(a,function(a){$c(this);return Promise.reject(a)}))}function cd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.ac=a.a;return b}
k.zb=function(a){this.f&&this.f.sample(Date.now()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),$c(this)):this.h<this.b.a?dd(this):(a=cd(this,"HTTP error.","net"),this.c.reject(a),$c(this))};k.Gb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Ga=a-Date.now())}};k.Xb=function(){var a=cd(this,"Network failure.","net");this.c.reject(a);$c(this)};
k.Lb=function(){if(this.h<this.b.a)dd(this);else{var a=cd(this,"Request timed out.","net");this.c.reject(a);$c(this)}};function dd(a){ad(a);window.setTimeout(a.rb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function H(a,b,c,d){this.b=b;this.f=c||0;this.h=null!=d?d:null;this.c=this.a=null;this.i=a}function ed(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function Ab(a,b,c){if(a.a)return a.a;b=b||new zb;if(a.f||a.h)b.b.Range="bytes="+(a.f+"-"+(null!=a.h?a.h:""));a.a=fd(a,0,b,c);return a.a}H.prototype.g=function(){if(this.c){this.a=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){a.a.abort();var b=cd(a,"Request aborted.","aborted");a.c.reject(b);$c(a)}this.c=null}};
function fd(a,b,c,d){var e=a.b[b].toString();a.i&&(e=a.i(e,c.b)||e);a.c=new Zc(e,c);d&&(a.c.f=d);e=a.c.rb().then(w(a,function(a){this.c=this.a=null;return Promise.resolve(a.response)}));return e=e.catch(w(a,function(a){if(this.a&&b+1<this.b.length)return this.a=fd(this,b+1,c,d);this.a=this.c=null;return Promise.reject(a)}))}H.prototype.clone=function(){return new H(this.i,this.b.map(function(a){return a.clone()}),this.f,this.h)};H.prototype.toString=function(){return this.b[0].toString()};function gd(a,b){this.a=a;this.b=b||null}gd.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null);this.b=null};gd.prototype.create=function(){return this.a?Ab(this.a):Promise.resolve(this.b)};function hd(a,b,c){this.b=a;this.a=b;this.url=c}function id(a,b,c){return new hd(b,c,a.url)}function Bb(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.b&&(null==d.a||b<d.a))return c}return-1}function jd(a,b){return a.map(function(a){return id(a,a.b+b,null!=a.a?a.a+b:null)})};function kd(){}
kd.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new va(a),h=E(g);if(1936286840!=E(g))e=null;else{1==h&&(h=Ya(g));var l=za(g);y(g,3);y(g,4);var m=E(g);if(0==m)e=null;else{var n,t;0==l?(n=E(g),t=E(g)):(n=Ya(g),t=Ya(g));y(g,2);var C=g.b.getUint16(g.a,g.c);g.a+=2;a=n;b=b+h+t;for(h=0;h<C;h++){var u=E(g);t=(u&2147483648)>>>31;var l=u&2147483647,v=E(g);E(g);if(1==t){e=null;break a}var oa=new H(d,c,b,b+l-1);f.push(new hd(a/m,(a+v)/m,oa));a+=v;b+=l}e=f}}}}catch(Jb){if(!(Jb instanceof RangeError))throw Jb;
}return e};function ld(){}
ld.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new ua(b);if(440786851!=x(g).id)f=null;else{var h=x(g);if(408125543!=h.id)f=null;else{var l=h.a.byteOffset,m;var n=new ua(h.a);for(b=null;Xa(n.a);){var t=x(n);if(357149030==t.id){b=t;break}}if(b){for(var C=new ua(b.a),n=1E6;Xa(C.a);){var u=x(C);if(2807729==u.id){n=Aa(u);break}}m=n/1E9}else m=null;f=m?{Tb:l,Yb:m}:null}}if(f){var v=x(new ua(a));if(475249515!=v.id)e=null;else{var oa=f.Tb,Jb=f.Yb;a=[];var Ud=new ua(v.a);for(f=v=-1;Xa(Ud.a);){var Vd=
x(Ud);if(187==Vd.id){var Fa;var Wd=new ua(Vd.a),Xd=x(Wd);if(179!=Xd.id)Fa=null;else{var qf=Aa(Xd),Yd=x(Wd);if(183!=Yd.id)Fa=null;else{for(var Zd=new ua(Yd.a),l=0;Xa(Zd.a);){var $d=x(Zd);if(241==$d.id){l=Aa($d);break}}Fa={$b:qf,Sb:l}}}if(Fa){var ae=Jb*Fa.$b,be=oa+Fa.Sb;if(0<=v){var rc=new H(d,c,f,be-1);a.push(new hd(v,ae,rc))}v=ae;f=be}}}0<=v&&(rc=new H(d,c,f,null),a.push(new hd(v,null,rc)));e=a}}else e=null}catch(ce){if(!(ce instanceof RangeError))throw ce;}return e};function L(a){this.o=a;this.i=0}L.prototype.destroy=function(){this.o=null};k=L.prototype;k.length=function(){return this.o.length};function M(a){if(0==a.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.o[0]}k.A=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]};
k.get=function(a){if(0>a||a>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[a]};k.la=function(a){a=Bb(this.o,a);return 0<=a?this.o[a]:null};k.Ha=function(a){md(this,a);return!0};
function md(a,b){a.i!=b.i&&(b=new L(jd(b.o,a.i-b.i)));if(0==a.length())a.o=b.o.slice(0);else if(0!=b.length()&&null!=a.A().a&&!(null!=b.A().a&&b.A().a<a.A().a)){if(a.A().a<=M(b).b)var c=id(a.A(),a.A().b,M(b).b),c=a.o.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.o.length&&!(a.o[d].a>=M(b).b);++d);a.o[d].b<M(b).b?(c=id(a.o[d],a.o[d].b,M(b).b),c=a.o.slice(0,d).concat([c])):(M(a).b>M(b).b||M(b),c=a.o.slice(0,d))}a.o=c.concat(b.o)}}
k.ka=function(a){var b=a-this.i;if(0==b)return 0;this.o=jd(this.o,b);this.i=a;return b};k.Ea=function(){return 0<this.length()?{start:M(this).b,end:this.A().a}:{start:0,end:0}};function nd(a){this.b=a;this.a=null}nd.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};nd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new hd(0,null,this.b);this.a=new L([a]);return Promise.resolve(this.a)};function od(a){this.b=a;this.a=null}od.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};od.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new hd(c.start_time,c.end_time,new H(null,[new K(c.url)],c.start_byte,null)))}this.b=null;this.a=new L(a);return Promise.resolve(this.a)};function pd(){this.C=qd++;this.id=this.D=this.H=null;this.c=0;this.height=this.width=this.bandwidth=null;this.b=this.a="";this.f=[];this.N=!1;this.J=!0}var qd=0;pd.prototype.destroy=function(){this.H&&(this.H.destroy(),this.H=null);this.D&&(this.D.destroy(),this.D=null)};function rd(a){var b=a.a||"";a.b&&(b+='; codecs="'+a.b+'"');return b}function sd(){this.C=td++;this.id=null;this.contentType=this.lang="";this.b=!1;this.m=[];this.a=[]}var td=0;
sd.prototype.destroy=function(){for(var a=0;a<this.m.length;++a)this.m[a].destroy();this.a=this.m=null};function ud(a){for(var b=[],c=0;c<a.a.length;++c){var d=new vd;d.id=a.C;d.a=a.a[c];d.contentType=a.contentType;d.b=a.m.length?rd(a.m[0]):"";b.push(d)}return b}function wd(){this.id=null;this.start=0;this.b=null;this.a=[]}wd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function xd(){this.b=!1;this.h=this.g=this.f=null;this.c=0;this.a=[]}
xd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function vd(){this.id=0;this.a=null;this.b=this.contentType=""};function yd(a,b){D.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new r;this.a=null}q(yd,D);yd.prototype.G=function(){};yd.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.v=this.b=this.f=this.h=this.a=this.c=null};k=yd.prototype;k.oa=function(){return this.f};k.cb=function(){return this.h};k.sb=function(){return this.c};k.Ga=function(){return!0};
k.ra=function(a){a.H.create().then(w(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=M(b).url.b[0].toString();var d=this.Da();this.a&&(this.va(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.va(d);b=A({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};k.kb=function(){};
k.lb=function(){return!0};k.va=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};k.Da=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function zd(a,b,c,d,e){D.call(this,a);this.c=b;this.a=new tb(c,d,e);this.w=this.I=this.b=null;this.K=!1;this.g=null;this.l=!1;this.i=null;this.u=!1;this.h=new r;this.j=this.f=!1;this.B=0;this.L=15;this.F=!1}q(zd,D);zd.prototype.G=function(a){null!=a.initialStreamBufferSize&&(this.B=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.L=Number(a.streamBufferSize));null!=a.segmentRequestTimeout&&(this.a.u=Number(a.segmentRequestTimeout))};
zd.prototype.destroy=function(){Ad(this);this.h.destroy();this.b=this.h=null;this.a.destroy();this.v=this.c=this.a=null};k=zd.prototype;k.oa=function(){return this.b};k.cb=function(){return this.I};k.sb=function(a){this.f||a.then(function(){this.f=!0;this.g||Bd(this,0)}.bind(this)).catch(function(){});return this.h};k.Ga=function(){return this.j};
k.ra=function(a,b,c){if(a!=this.b){var d=[a.H.create(),a.D.create()];Promise.all(d).then(w(this,function(d){if(this.c){var f=this.b;this.b=a;this.I=d[0];this.w=d[1];this.K=!0;this.l||(f?b&&Cd(this,!0,c):Bd(this,0))}})).catch(w(this,function(a){"aborted"!=a.type&&(this.f?(a=B(a),this.dispatchEvent(a)):this.h.reject(a))}))}};k.kb=function(){return Cd(this,!1)};
function Cd(a,b,c){a.b&&!a.l&&(a.l=!0,Ad(a),vb(a.a).then(w(a,function(){var a=this.c.currentTime;if(!b&&0<wb(this.a,a)&&0<=Bb(this.a.b,a))return Promise.resolve();if(c)return Eb(this.a,this.c.currentTime+c);this.F=!0;return Db(this.a)})).then(w(a,function(){this.l=!1;Bd(this,0)})).catch(w(a,function(a){this.l=!1;this.f?(a=B(a),this.dispatchEvent(a)):this.h.reject(a)})))}k.lb=function(a){return 0<wb(this.a,a)&&0<=Bb(this.a.b,a)};k.va=function(){};k.Da=function(){return!0};
k.Nb=function(){if(this.u&&!this.f)this.g=null;else{var a;if(a=this.f&&!this.j)a=1<this.a.c.buffered.length?!0:!1;if(a)Cd(this,!0);else{this.g=null;a=this.b;var b=this.I,c=this.c.currentTime;wb(this.a,this.u?c:c+(this.i||0))>=(this.u?Math.max(this.B,this.L):this.B)?(Dd(this),Bd(this,1E3/(Math.abs(this.c.playbackRate)||1))):(b=Ed(this,c,b))?(b=xb(this.a,b,a.c,this.w),this.w=null,this.K&&(this.K=!1,Fd(this,a)),this.j=!1,b.then(w(this,function(a){null==this.i&&(this.i=a);this.F&&0<wb(this.a,c)&&(this.F=
!1,this.c.currentTime+=.001);Bd(this,0)})).catch(w(this,function(a){if("aborted"!=a.type){var b=[0,404,410];"net"==a.type&&-1!=b.indexOf(a.ac.status)&&this.b&&Bd(this,5E3);a=B(a);this.dispatchEvent(a)}}))):(Dd(this),this.f&&!this.j&&(this.j=!0,Gd(this)),Bd(this,1E3))}}};function Ed(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.a?c.la(a.a):null:c.la(b)||(c.length()?c.A():null)}
function Dd(a){if(!a.u&&null!=a.i){a.u=!0;var b=a.a,c=a.i,d=c-b.w;0!=d&&(b.b=jd(b.b,d),b.w=c);a.h.resolve(a.i)}}function Fd(a,b){var c;c=b.a.split("/")[0];c=A({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function Gd(a){var b=A({type:"ended"});a.dispatchEvent(b)}function Bd(a,b){a.g=window.setTimeout(a.Nb.bind(a),b)}function Ad(a){null!=a.g&&(window.clearTimeout(a.g),a.g=null)};function Hd(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function Id(a,b){var c=new Jd(b);a.streamHistory.push(new Kd(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function Jd(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function Kd(a){this.timestamp=Ea()/1E3;this.value=a};function Ld(a,b,c,d,e,f){this.b=new H(null,[new K(a)]);this.a=new zb;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.c=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.b[g]=a[g]}function Md(a){return Ab(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function Nd(a,b,c){D.call(this,a);this.h=b;this.b=c;this.a=this.i=null;this.l=new F;this.c=[];this.f=[];this.u=0;this.g=new r;this.j=null;this.w=0}q(Nd,D);Nd.prototype.destroy=function(){this.v=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.c=this.a=this.i=null;this.g.destroy();this.g=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.h=this.b=null};
Nd.prototype.initialize=function(){for(var a=new z,b=this.b.bb(),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Od(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.g?"required":"optional",persistentState:h.v||this.b.ha()?"required":"optional",sessionTypes:[this.b.ha()?"persistent-license":"temporary"]},
c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",g in h)){d=!0;h[g]||(h[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.j);h[g].push({contentType:f.b,robustness:l})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.b.Ka(a),this.g.resolve(),Promise.resolve();l=new r;c=Pd(this,c,l);c=c.then(this.tb.bind(this,b,a));c=c.then(this.Ub.bind(this));l.reject(null);return c};
function Qd(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.g.reject(a)}.bind(a),b));return a.g}function Rd(a){return Promise.all(a.f.map(function(a){return a.remove()}))}
function Pd(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.b.ha()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}k=Nd.prototype;
k.tb=function(a,b,c){if(!this.h)return Sd();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var l=e[h+"Capabilities"];if(l&&l.length){for(var l=l[0],m=[],n={},t=0;t<a.length;++t){var C=a[t];if(C.a.a==d&&C.b==l.contentType&&!(C.id in n)){m.push(C);n[C.id]=!0;var u;if(this.a){u=this.a;var C=C.a,v=new Ia;v.a=u.a;v.h=u.h;v.i=u.i;v.l=u.l;v.u=u.u;v.g=u.g;v.v=u.v;v.f=u.f;v.j=u.j;v.c=u.c?new Uint8Array(u.c.buffer):null;Ka(v,u.b);Ka(v,
C.b);u=v}else u=C.a;this.a=u}}b.set(h,m)}}}this.b.Ka(b);return c.createMediaKeys()};
k.Ub=function(a){if(!this.h)return Sd();this.i=a;return this.h.setMediaKeys(this.i).then(w(this,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():Sd()})).then(w(this,function(){if(!this.h)return Sd();if(0<this.b.ua().length)Td(this);else{for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.eb({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&G(this.l,this.h,"encrypted",this.eb.bind(this))}}))};
function Sd(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
k.eb=function(a){for(var b=new Uint8Array(a.initData),c=0;c<this.c.length;++c)if(ta(b,this.c[c].data))return;try{var d=de(this)}catch(e){b=B(e);this.dispatchEvent(b);this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.c.push({data:b,La:d});a.catch(w(this,function(a){if(this.h){for(var b=0;b<this.c.length;++b)if(this.c[b].La==d){this.c.splice(b,1);break}b=B(a);this.dispatchEvent(b);this.g.reject(a)}}));this.f.push(d)};
function Td(a){for(var b=a.b.ua(),c=0;c<b.length;++c){var d=de(a),e=d.load(b[c]);a.f.push(d);e.then(w(a,function(){this.u++;this.u>=this.f.length&&this.g.resolve()})).catch(w(a,function(a){a=B(a);this.dispatchEvent(a)}))}}
function de(a){var b=null;if(a.b.ha())try{b=a.i.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.i.createSession();G(a.l,b,"message",a.Jb.bind(a));G(a.l,b,"keystatuseschange",a.yb.bind(a));return b}k.Jb=function(a){ee(this,a.target,this.a,a.message)};
k.yb=function(a){a=a.target;for(var b=a.keyStatuses,c={},d=b.keys(),e=d.next();!e.done;e=d.next()){var f=sa(new Uint8Array(e.value)),e=b.get(e.value);c[f]=e}if(a.expiration<Date.now()){for(b=0;b<this.c.length;++b)if(this.c[b].La==a){this.c.splice(b,1);break}a.close();this.f.splice(this.f.indexOf(a),1)}this.b.fb(c)};
function ee(a,b,c,d){d=fe(c,d);Md(new Ld(d.url,d.body,d.method,c.i,d.headers,a.w)).then(w(a,function(a){c.l&&(a=c.l(a));return b.update(a)})).then(w(a,function(){var a=A({type:"sessionReady",detail:b});this.dispatchEvent(a);this.u++;this.u>=this.f.length&&this.g.resolve()})).catch(w(a,function(a){a.La=b;a=B(a);this.dispatchEvent(a)}))}
function fe(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.u)return c;a.u(c);c.url=ja(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=ja(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=ka(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function N(a){D.call(this,null);this.a=a;this.b=null;this.f=new F;this.i=this.j=null;this.F=0;this.w=null;this.h=!1;this.g=new Hd;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new ca};this.l=1;this.G=null}q(N,D);p("shaka.player.Player",N);N.version="v1.6.1";
N.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};function Od(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}N.isTypeSupported=Od;
N.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+Mb(a)+" }",0)};N.prototype.destroy=function(){return this.u().then(w(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};N.prototype.destroy=N.prototype.destroy;
N.prototype.u=function(){if(!this.b)return Promise.resolve();this.h&&ge(this);this.a.pause();db(this.f);he(this);ie(this);this.j&&(this.j.destroy(),this.j=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new Hd;return a};N.prototype.unload=N.prototype.u;
N.prototype.ea=function(a){var b=this.u();this.a.autoplay&&(Pb("load"),G(this.f,this.a,"timeupdate",this.xb.bind(this)));a.T(this.c);a.pb(this.G);this.G=null;b=b.then(w(this,function(){return a.X()}));b.catch(w(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(w(this,function(){if(!this.a)return je();this.b=a;G(this.f,this.b,"seekrangechanged",this.Hb.bind(this));this.j=new Nd(this,this.a,this.b);return this.j.initialize()})).then(w(this,function(){if(!this.a)return je();G(this.f,
this.a,"error",this.Vb.bind(this));G(this.f,this.a,"playing",this.Fb.bind(this));G(this.f,this.a,"pause",this.Eb.bind(this));return this.b.Wa(this,this.a)})).then(w(this,function(){if(!this.a)return je();ke(this)})).catch(w(this,function(a){if(!this.a)return je();if("destroy"!=a.type){var b=B(a);this.dispatchEvent(b)}return this.u().then(function(){return Promise.reject(a)})}))};N.prototype.load=N.prototype.ea;
function je(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}k=N.prototype;k.xb=function(){Sb("load");this.g.playbackLatency=Tb("load")/1E3;this.f.sa(this.a,"timeupdate")};k.Vb=function(){if(this.a.error){var a=this.a.error.code;a!=MediaError.MEDIA_ERR_ABORTED&&(a=Error(le[a]||"Unknown playback error."),a.type="playback",a=B(a),this.dispatchEvent(a))}};
k.Fb=function(){Pb("playing");!this.i&&0>this.l&&(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),this.l));this.h&&ge(this)};k.Eb=function(){Sb("playing");var a=Tb("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}ie(this)};k.Hb=function(a){this.F=a.start};
k.qb=function(){if(!this.a.paused){Sb("playing");var a=Tb("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;Pb("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};N.prototype.getStats=N.prototype.qb;N.prototype.da=function(){return this.b?this.b.ma():[]};N.prototype.getVideoTracks=N.prototype.da;N.prototype.Y=function(){return this.b?this.b.pa():[]};
N.prototype.getAudioTracks=N.prototype.Y;N.prototype.$=function(){return this.b?this.b.Oa():[]};N.prototype.getTextTracks=N.prototype.$;N.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};N.prototype.selectVideoTrack=N.prototype.selectVideoTrack;N.prototype.M=function(a,b){return this.b?this.b.nb(a,void 0==b?!0:b):!1};N.prototype.selectAudioTrack=N.prototype.M;N.prototype.fa=function(a){return this.b?this.b.ob(a,!1):!1};
N.prototype.selectTextTrack=N.prototype.fa;N.prototype.V=function(a){this.b&&this.b.Na(a)};N.prototype.enableTextTrack=N.prototype.V;N.prototype.T=function(a){ie(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),a));this.l=a};N.prototype.setPlaybackRate=N.prototype.T;N.prototype.K=function(){return this.l};N.prototype.getPlaybackRate=N.prototype.K;N.prototype.R=function(a){this.G=a};N.prototype.setPlaybackStartTime=N.prototype.R;
N.prototype.I=function(){return this.b?this.b.mb():!1};N.prototype.isLive=N.prototype.I;
N.prototype.U=function(a){if(a){var b=ia(a,"enableAdaptation","boolean");null!=b&&(this.c.enableAdaptation=b);b=ha(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=ha(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=ha(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=ha(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=ha(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=ja(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);a=ka(a,"restrictions",ca);null!=a&&(this.c.restrictions=a.clone());this.b&&this.b.T(this.c)}};N.prototype.configure=N.prototype.U;N.prototype.Z=function(){return this.c};N.prototype.getConfiguration=N.prototype.Z;function ie(a){a.i&&(window.clearTimeout(a.i),a.i=null)}function ke(a){he(a);a.w=window.setTimeout(a.L.bind(a),100)}function he(a){a.w&&(window.clearTimeout(a.w),a.w=null)}
N.prototype.B=function(a,b,c){this.i=null;var d=(Date.now()-b)/1E3*c;this.a.currentTime<this.F+(this.I()?1:.05)?this.a.pause():(d=Math.max(this.F,a+d),this.a.currentTime=d,this.i=window.setTimeout(this.B.bind(this,a,b,c),250))};function ge(a){Sb("buffering");var b=a.g;b.bufferingTime+=Tb("buffering")/1E3;a.h=!1;a.dispatchEvent(A({type:"bufferingEnd"}))}
N.prototype.L=function(){ke(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.ab(),b||a>c)ge(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(Ea()/1E3),Pb("buffering"),this.dispatchEvent(A({type:"bufferingStart"})))}};
var le={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function me(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.m.length;++g)Od(rd(f.m[g]))||(f.m.splice(g,1),--g);0==e.m.length&&(c.a.splice(d,1),--d)}}function ne(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].m.sort(oe)}function oe(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function pe(a){this.a=a}pe.prototype.destroy=function(){this.a.destroy();this.a=null};pe.prototype.update=function(a){var b=qe(a),c=qe(this.a);return Promise.all([b,c]).then(w(this,function(b){var c=b[0];b=b[1];var f=this.a.a;me(f);ne(f);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;f=[];re(a,this.a,c,b,f);c=a.a;me(c);ne(c);return Promise.resolve(f)}))};
function qe(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.m}).reduce(b,[]);a=c.map(function(a){return a.H.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].C]=a[f];return Promise.resolve(b)})}
function re(a,b,c,d,e){var f=new z;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new z;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=Da(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(se(l[0],h[0],c,d,e),l[0].b=h[0].b)}}
function se(a,b,c,d,e){var f=new z;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new z;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=Da(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&te(l[0],h[0],c,d,e)}}
function te(a,b,c,d,e){var f=new z;a.m.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new z;b.m.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=Da(f),l=0;l<h.length;++l){var m=h[l];b[m]=m;var n=f.get(m);1<n.length||((m=g.get(m))&&0!=m.length?1==m.length&&(ue(n[0],m[0],c,d),n[0].D=m[0].D,m[0].D=null,n[0].c=m[0].c):(e.push(n[0]),a.m.splice(a.m.indexOf(n[0]),1)))}h=Da(g);for(l=0;l<h.length;++l)m=h[l],b[m]||(b[m]=m,m=g.get(m),a.m.push(m[0]))}
function ue(a,b,c,d){a=c[a.C];b=d[b.C];a.length();a.Ha(b)&&a.length()};function O(){this.a=this.b=null;this.f=new F;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}p("shaka.media.SimpleAbrManager",O);O.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};O.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
O.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,G(this.f,this.b,"bandwidth",this.v.bind(this)),G(this.f,this.a,"adaptation",this.j.bind(this)),G(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};O.prototype.enable=function(a){this.i=a};O.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=ve(this);return a?a.id:null};O.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
O.prototype.v=function(){Date.now()<this.c||this.h()};O.prototype.h=function(){if(this.i){var a=ve(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};O.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function ve(a){var b=a.a.ma();if(0==b.length)return null;b.sort(ea);var c;a:{c=a.a.pa();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function we(a,b,c){D.call(this,null);this.f=a;this.c=b;this.b=Ja(c);this.a=null}q(we,D);p("shaka.player.HttpVideoSource",we);we.prototype.T=function(){};we.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.v=this.b=null};k=we.prototype;k.Wa=function(a,b){this.v=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};k.X=function(){return Promise.resolve()};
k.ma=function(){return[]};k.pa=function(){return[]};k.Oa=function(){return[]};k.ab=function(){return 5};k.bb=function(){var a=new vd;a.a=this.b;return[a]};k.Ka=function(){};we.prototype.selectVideoTrack=function(){return!1};k=we.prototype;k.nb=function(){return!1};k.ob=function(){return!1};k.Na=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};k.pb=function(){};k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return!1};
k.fb=function(a){for(var b in a){var c=a[b],d=na[c]||null;if(d){var e=la(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=B(d);this.dispatchEvent(c)}}};function P(a,b,c){D.call(this,null);this.a=a;this.Z=b;this.i=new F;this.g=new MediaSource;this.f=null;this.da=0;this.b=new z;this.I=c;this.I.initialize(b,this);this.L=!1;this.K="en";this.fa=!1;this.U=null;this.B=new r;this.h=new ca;this.F=null;this.Va=1;this.c={};this.ea=new r;this.Ta=0;this.Ua=15;this.w=null;this.Ra=this.Sa=!1;this.u={};this.$=this.Y=this.V=null;this.G={}}q(P,D);p("shaka.player.StreamVideoSource",P);
P.prototype.T=function(a){null!=a.streamBufferSize&&(this.G.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.G.segmentRequestTimeout=a.segmentRequestTimeout);xe(this);null!=a.enableAdaptation&&this.I.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.da=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.Ua=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.K=Pa(String(a.preferredLanguage)));null!=a.restrictions&&(this.h=a.restrictions,
this.L&&ye(this))};P.prototype.destroy=function(){this.B.destroy();this.ea.destroy();this.ea=this.B=null;this.Y&&(window.clearTimeout(this.Y),this.Y=null);this.V&&(window.clearTimeout(this.V),this.V=null);this.u=null;this.i.destroy();this.i=null;ga(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.I.destroy();this.v=this.h=this.U=this.f=this.g=this.Z=this.I=null};k=P.prototype;
k.Wa=function(a,b){if(!this.L){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.v=a;this.f=b;this.U=a.qb();G(this.i,this.g,"sourceopen",this.Ab.bind(this));G(this.i,this.Z,"bandwidth",this.Wb.bind(this));this.a.b&&(G(this.i,a,"bufferingStart",this.wb.bind(this)),G(this.i,a,"bufferingEnd",this.vb.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.B,c])};
k.X=function(){if(this.L){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.a;me(a);ne(a);if(0==this.a.a.length||0==this.a.a[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.L=!0;this.G.initialStreamBufferSize=this.a.c;xe(this);ye(this);
return Promise.resolve()};k.ib=function(a){var b=Date.now(),c=this.V=null,d=this.a.g;(a?this.gb():this.hb(d)).then(w(this,function(a){c=new pe(a);return c.update(this.a)})).then(w(this,function(a){c.destroy();c=null;for(var d=0;d<a.length;++d)ze(this,a[d]);this.G.initialStreamBufferSize=this.a.c;xe(this);ye(this);0==Object.keys(this.c).length?Ae(this):Be(this,(Date.now()-b)/1E3)})).catch(w(this,function(a){c&&(c.destroy(),c=null);"aborted"!=a.type&&(a=B(a),this.dispatchEvent(a),this.a&&Be(this,0))}))};
k.hb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};k.gb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function Be(a,b){if(null!=a.a.f){var c=Math.max(a.a.f,3),c=Math.max(c-b,0);a.V=window.setTimeout(a.ib.bind(a,!1),1E3*c)}}
function ze(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.oa()==b){var e=a.b.get(b.a.split("/")[0]).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.N&&a.J});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=B(c);a.dispatchEvent(c);return}a.u[c].Pa==b&&delete a.u[c];d.ra(e[0],!0);b.destroy()}b.destroy()}
k.ma=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.m.length;++f){var g=e.m[f];if(g.N&&g.J){var h=g.C,g=new da(h,g.bandwidth,g.width,g.height);h==a&&(g.active=!0);b.push(g)}}return b};P.prototype.getVideoTracks=P.prototype.ma;
P.prototype.pa=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.m.length;++g){var h=e.m[g];if(h.N&&h.J){var l=h.C,h=new fa(l,h.bandwidth,f);l==a&&(h.active=!0);b.push(h)}}return b};P.prototype.getAudioTracks=P.prototype.pa;
P.prototype.Oa=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.oa():null,b=b?b.C:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.m.length;++h){var l=f.m[h].C,m=new ba(l,g);l==b&&(m.active=!0,m.enabled=a.Da());c.push(m)}return c};P.prototype.getTextTracks=P.prototype.Oa;P.prototype.ab=function(){return Number(this.G.initialStreamBufferSize)};
P.prototype.bb=function(){var a;if(this.L){a=this.a.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,ud(a.a[c]));a=b}else a=[];return a};
P.prototype.Ka=function(a){if(this.L){for(var b={},c=this.a.a[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.C]=e}this.b.a={};c=Da(a);for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],h=0;h<f.length;++h){var l=f[h];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(h=0;h<f.length;++h)g=f[h].id,this.b.push(e,b[g])}this.fa=!0;if(a=this.b.get("audio"))Ce(this,a),this.b.set("audio",a),a=a[0].lang||this.K,Oa(2,
this.K,a)&&(this.fa=!1);if(a=this.b.get("text"))Ce(this,a),this.b.set("text",a),a=a[0].lang||this.K,Oa(2,this.K,a)||(this.fa=!1)}};P.prototype.selectVideoTrack=function(a,b,c){return De(this,"video",a,b,c)};k=P.prototype;k.nb=function(a,b){return De(this,"audio",a,b)};k.ob=function(a,b){return De(this,"text",a,b)};k.Na=function(a){var b=this.c.text;b&&b.va(a)};k.pb=function(a){this.$=a};
function ye(a){if(a.h){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.m.length;++g){var h=f.m[g],l=h.J;h.J=!0;a.h.maxWidth&&h.width>a.h.maxWidth&&(h.J=!1);a.h.maxHeight&&h.height>a.h.maxHeight&&(h.J=!1);a.h.minHeight&&h.height<a.h.minHeight&&(h.J=!1);a.h.maxBandwidth&&h.bandwidth>a.h.maxBandwidth&&(h.J=!1);a.h.minBandwidth&&h.bandwidth<a.h.minBandwidth&&(h.J=!1);l!=h.J&&(b=!0)}}0!=Ba(a.b).length&&b&&(Ee(a),0<a.ma().length||
(b=Error("The application has restricted all video tracks!"),b.type="app",b=B(b),a.dispatchEvent(b)))}}k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return this.a?this.a.b:!1};
k.fb=function(a){for(var b,c=!1,d=new z,e=Ba(this.b),f=0;f<e.length;++f)for(var g=e[f],h=0;h<g.m.length;++h){var l=g.m[h];l.f.forEach(function(a){d.push(a,l)})}for(b in a)if(e=na[a[b]]||null,g=d.get(b))for(f=0;f<g.length;++f)l=g[f],h=l.N,l.N=!e,h!=l.N&&(c=!0);else la(b);c&&(Ee(this),b=this.pa(),a=this.ma(),b=this.b.a.hasOwnProperty("audio")&&0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":
"video tracks.")),a.type="drm",a=B(a),this.dispatchEvent(a))};function Ee(a){var b=A({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function De(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b)||!a.c[b])return!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var h=f[g],l=0;l<h.m.length;++l){var m=h.m[l];if(m.C==c){if(!m.N||!m.J)return!1;if("text"!=b&&!a.Ra)return c=a.u[b],a.u[b]={Pa:m,Xa:null!=c&&c.Xa||d,Ya:null!=c&&c.Ya||e},!0;Id(a.U,m);a.c[b].ra(m,d,e);return!0}}return!1}
function Ce(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Oa(c,a.K,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}k.Ab=function(){this.i.sa(this.g,"sourceopen");Ae(this).then(w(this,function(){this.B&&this.B.resolve()})).catch(w(this,function(a){this.B&&this.B.reject(a)}))};
function Ae(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=Fe(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=ga(f).map(function(a){return a.H.create()});return Promise.all(b).then(w(a,function(a){if(!a.every(function(a){return a.length()}))return a=
Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=Ge(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!He(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.I.start();Ie(this,f,a);return Promise.resolve()})).catch(w(a,function(a){if("aborted"!=a.type)return Object.keys(this.c),this.a.b?(Ea()<this.a.h?(a=Math.max(this.a.h-Date.now()/1E3,3),this.V=window.setTimeout(this.ib.bind(this,
!0),1E3*a)):Be(this,0),Promise.resolve()):Promise.reject(a)}))}function Fe(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.I.getInitialVideoTrackId();if(null==g)continue;f=e.m.filter(function(a){return a.C==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType){f=e.m.filter(function(a){return a.N&&a.J});if(0==f.length)continue;f=e.m[Math.floor(f.length/2)]}else 0<e.m.length&&(f=e.m[0]);c[e.contentType]=f}return c}
function He(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new yd(a,a.f):Je(a,e);if(!e)return ga(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.c=c;return!0}function Je(a,b){var c=new zd(a,a.f,a.g,rd(b),a.Z);c.G(a.G);return c}
function Ie(a,b,c){a.Va=a.f.playbackRate;a.f.playbackRate=0;Ke(a,c);var d;a.$&&a.$<=c.end&&a.$>=c.start?d=a.$:a.a.b?(d=c.end,a.Sa=!0):d=c.start;G(a.i,a.f,"seeking",a.Ib.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.F=d);Le(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.sb(a.ea));G(a.i,d,"ended",a.Kb.bind(a));var f=b[e];Id(a.U,f);d.ra(f,!1)}Promise.all(c).then(a.ub.bind(a)).catch(w(a,function(a){"destroy"!=a.type&&(a=B(a),this.dispatchEvent(a))}));a.Na(a.fa)}
k.ub=function(a){Ha(a&&a.length==Object.keys(this.c).length);for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);a=Me(this);for(d=0;d<a.length;++d)a[d].ka(c);Ne(this,a,c);d=Ba(this.b).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.H.create()];a.D&&b.push(a.D.create());return Promise.all(b)});Promise.all(d).then(w(this,function(a){for(var b=0;b<a.length;++b)a[b][0].ka(c);this.Ra=
!0;for(var d in this.u)a=this.u[d],b=this.c[d],Id(this.U,a.Pa),b.ra(a.Pa,a.Xa,a.Ya);this.u={}})).catch(w(this,function(a){"aborted"!=a.type&&(a=B(a),this.dispatchEvent(a))}))};function Ne(a,b,c){if(b=Ge(a,b))Ke(a,b),Le(a,b.start,b.end);0!=c&&(c=a.f.currentTime+c,a.f.currentTime=c,a.F=c);a.Sa&&b&&(a.f.currentTime=b.end);a.f.playbackRate=a.Va;a.a.b&&null!=a.a.f&&Be(a,0);Oe(a);a.ea.resolve()}
function Ke(a,b){if(a.a.b)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}k.Mb=function(){this.Y=null;Oe(this);var a=Ge(this,Me(this));a&&(this.a.b&&this.Ta!=a.A&&(this.Ta=a.A,null!=this.w&&(window.clearTimeout(this.w),this.w=null)),Le(this,a.start,a.end),this.f.paused||Pe(this,this.f.currentTime,a.start,a.end))};
function Le(a,b,c){b=A({type:"seekrangechanged",bubbles:!0,start:b,end:c});a.dispatchEvent(b)}k.Ib=function(){var a=this.f.currentTime;if(null!=this.F){if(a>=this.F-.01&&a<=this.F+.01){this.F=null;return}this.F=null}var b=Ge(this,Me(this));if(b){var c=b.end;(b=Pe(this,a,b.start,c))||(a<=c+.01?b=!1:(this.f.currentTime=c,b=!0));if(!b)for(var d in this.c)this.c[d].kb()}};
function Pe(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.b){b=.5;for(var e in a.c)if(!a.c[e].lb(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}k.Kb=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].Ga())return;this.$a()}};k.wb=function(){ga(this.c).every(function(a){return a.Ga()})&&(this.w=window.setTimeout(this.$a.bind(this),1E3*this.Ua))};k.vb=function(){null!=this.w&&(window.clearTimeout(this.w),this.w=null)};
k.Wb=function(){var a=this.U,b=this.Z.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new Kd(b))};k.$a=function(){this.w=null;this.g.endOfStream()};function Me(a){return ga(a.c).map(function(a){return a.cb()}).filter(function(a){return null!=a})}
function Ge(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].Ea(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].A().a))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.b)d=(d.start||0)+d.b;else return null;a.a.b&&(d=Math.max(d-a.a.c,c));return c>d?null:{start:c,end:d,A:e}}function Oe(a){a.a.b&&(a.Y=window.setTimeout(a.Mb.bind(a),1E3))}function xe(a){for(var b in a.c)a.c[b].G(a.G)};function Qe(a,b){fb.call(this,"readwrite",b);this.j=a;this.b=0}q(Qe,fb);
function Re(a,b,c,d,e){for(var f=[],g=[],h=0,l=0,m=[],n=b.map(function(a){return a.H.create()}),n=Promise.all(n),t=b.map(function(a){return a.D.create()}),t=Promise.all(t),n=Promise.all([n,t]).then(function(a){f=a[0];g=a[1];h=f.reduce(function(a,b){return a+b.length()},0)}),t=0;t<b.length;++t)n=n.then(function(a){return Se(this,b[a],f[a],g[a],h,l)}.bind(a,t)),n=n.then(function(a,b){l+=f[a].length();m.push(b)}.bind(a,t));return n.then(w(a,function(){return Te(mb(this))})).then(w(a,function(a){var b=
new r;c=ma(c);var f={group_id:a,stream_ids:m,session_ids:c,duration:d,key_system:e.a,license_server:e.h,with_credentials:e.i,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.j},g=mb(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function Ue(a,b){return nb(mb(a),b).then(w(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(Ve(this,a.stream_ids[e]));a=mb(this);d.push(a.delete(b));return Promise.all(d)}))}
function Se(a,b,c,d,e,f){var g=[Te(lb(a)),Te(jb(a).index("stream"))],g=Promise.all(g).then(w(a,function(a){return{qa:Math.max(a[0],a[1]),ja:new ArrayBuffer(0),Ja:0,o:[],Ca:null,Zb:e,jb:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function Te(a){var b=new r,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
Qe.prototype.g=function(a,b,c){var d=new r;a={stream_id:c.qa,mime_type:a.a,codecs:a.b,init_segment:b,references:c.o};var e=lb(this).put(a);e.onsuccess=function(){d.resolve(c.qa)};e.onerror=function(){d.reject(e.error)};return d};Qe.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(w(this,function(a){Ve(this,b.qa);return Promise.reject(a)}))};
Qe.prototype.c=function(a,b,c,d){var e=new r;0==b.ja.byteLength&&(b.Ca=a);b.ja=We(b.ja,d);b.jb++;var f=A({type:"progress",detail:b.jb/b.Zb*100,bubbles:!0});if(1048576<=b.ja.byteLength||c){c={stream_id:b.qa,segment_id:b.Ja,content:b.ja};var g=jb(this).put(c);b.o.push({start_time:b.Ca.b,start_byte:b.Ca.url.f,end_time:a.a,url:"idb://"+b.qa+"/"+b.Ja});b.Ja++;b.ja=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=w(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function We(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}Qe.prototype.i=function(a){var b=new zb;b.c=1E3*this.b;return Ab(a.url,b,this.j)};
function Ve(a,b){var c=new r,d=lb(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=jb(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function Q(a,b,c,d){L.call(this,a);this.g=b;this.w=c;this.f=d;this.h=this.g.b||this.g.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.l=this.c=null;Xe(this)}q(Q,L);Q.prototype.destroy=function(){this.w=this.g=null;L.prototype.destroy.call(this)};Q.prototype.la=function(a){Ye(this,Ea()/1E3);return L.prototype.la.call(this,a)};Q.prototype.Ha=function(a){if(!(a instanceof Q))return!1;md(this,a);this.h=Math.max(this.h,a.h);null==this.c?(this.f=a.f,Xe(this)):Ze(this);return!0};
function Xe(a){Ze(a);if(0!=a.length()){a.length();var b=null!=a.A().a?a.A().a:a.A().b;if(a.g.c>a.f)a.c=b;else{var c=a.f-(a.g.c+a.w.start);0>c?a.c=b:c<Math.max(a.A().b,a.A().a||0)?(a.A(),a.c=b):a.c=c}a.l=a.A().b;a.a=M(a).b}}Q.prototype.ka=function(a){a=L.prototype.ka.call(this,a);Math.min.apply(null,this.o.filter(function(a){return null!=a.a}).map(function(a){return a.a-a.b}));null!=this.c&&(this.l+=a,this.a+=a,this.c+=a);return a};Q.prototype.Ea=function(){return $e(this,Ea()/1E3)};
function $e(a,b){Ye(a,b);if(null==a.c||null==a.l||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.h&&(c=a.h);var d=b-a.f,e=a.c+d;null!=a.g.f&&(e=e-a.a-a.g.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);d=a.l+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.A().a?Math.min(d,a.A().a):d:a.a;d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}
function Ye(a,b){Ze(a);if(null!=a.g.f)if(null==a.c)a.length();else{for(var c=a.c+(b-a.f),d=0,e=0;e<a.o.length;++e){var f=null;e<a.o.length-1?f=a.o[e+1].a:(f=a.o[e],f=null!=f.a?f.a+(f.a-f.b):null);if(null!=f&&f<c-a.g.f)++d;else break}0<d&&a.o.splice(0,d)}}function Ze(a){if(a.h){for(var b=0,c=a.o.length-1;0<=c;--c)if(a.o[c].b>a.h)++b;else break;0<b&&a.o.splice(-b)}};function af(a,b,c,d,e,f,g){this.g=a;this.i=b;this.f=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}af.prototype.destroy=function(){this.h=this.i=this.g=null;this.a.g();this.a=null;this.c&&(this.c.g(),this.c=null);this.b=null};
af.prototype.create=function(){if(this.b)return this.b;var a=[Ab(this.a)];"webm"==this.f&&a.push(Ab(this.c));return this.b=Promise.all(a).then(w(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.f?(d=new kd,d=d.parse(new DataView(c),this.a.f,this.a.b,this.h)):"webm"==this.f&&(d=new ld,d=d.parse(new DataView(c),new DataView(a),this.a.b,this.h));if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
var e;"dynamic"==this.g.type?e=new Q(d,this.g,this.i,this.j):e=new L(d);return Promise.resolve(e)}))};function bf(a,b,c,d,e){this.b=a;this.c=b;this.f=c;this.h=d;this.a=null;this.g=e}bf.prototype.destroy=function(){this.g=this.f=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
bf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.f.a,b=cf(a.f,a.a||1,this.c.a||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=e/a.a,g=b[d].end/a.a,e=df(this.g,this.f,d+a.c,e);if(!e)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var h=(a.j||0)/a.a;c.push(new hd(f-h,g-h,e))}"dynamic"==this.b.type?this.a=new Q(c,this.b,this.c,this.h):this.a=new L(c);return Promise.resolve(this.a)};function ef(){this.id=this.url=null;this.type="static";this.b=this.j=this.s=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}function ff(){this.g=this.f=this.c=this.s=this.a=this.start=this.id=null;this.b=[]}function gf(){this.i=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.c=!1;this.h=this.g=this.f=this.s=null;this.j=[];this.a=[]}function hf(){this.value=null}function jf(){this.contentType=this.lang=this.id=null}
function kf(){this.a=this.b=this.g=this.s=this.h=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function lf(){this.b=this.a=this.c=this.f=null}function mf(){this.parsedPssh=this.psshBox=null}function nf(){this.url=null}function of(){this.url=null}function pf(){this.s=null;this.g=1;this.c=this.b=this.a=this.f=null}pf.prototype.clone=function(){var a=new pf;a.s=rf(this.s);a.g=this.g;a.f=this.f;a.a=R(this.a);a.b=R(this.b);a.c=R(this.c);return a};
function sf(){this.a=this.url=null}sf.prototype.clone=function(){var a=new sf;a.url=rf(this.url);a.a=R(this.a);return a};function tf(){this.a=this.url=null}tf.prototype.clone=function(){var a=new tf;a.url=rf(this.url);a.a=R(this.a);return a};function uf(){this.s=null;this.f=1;this.b=this.g=null;this.i=1;this.h=null;this.a=[];this.c=null}uf.prototype.clone=function(){var a=new uf;a.s=rf(this.s);a.f=this.f;a.g=this.g;a.b=this.b;a.i=this.i;a.h=R(this.h);a.a=rf(this.a)||[];a.c=R(this.c);return a};
function vf(){this.a=this.b=null}vf.prototype.clone=function(){var a=new vf;a.b=rf(this.b);a.a=R(this.a);return a};function wf(){this.a=1;this.b=this.j=null;this.c=1;this.v=!1;this.f=this.h=this.g=this.i=null}wf.prototype.clone=function(){var a=new wf;a.a=this.a;a.j=this.j;a.b=this.b;a.c=this.c;a.v=this.v;a.i=this.i;a.g=this.g;a.h=this.h;a.f=R(this.f);return a};function xf(){this.a=[]}xf.prototype.clone=function(){var a=new xf;a.a=rf(this.a)||[];return a};function yf(){this.c=this.a=this.b=null}
yf.prototype.clone=function(){var a=new yf;a.b=this.b;a.a=this.a;a.c=this.c;return a};function zf(a,b){this.na=a;this.end=b}zf.prototype.clone=function(){return new zf(this.na,this.end)};ef.TAG_NAME="MPD";ff.TAG_NAME="Period";gf.TAG_NAME="AdaptationSet";hf.TAG_NAME="Role";jf.TAG_NAME="ContentComponent";kf.TAG_NAME="Representation";lf.TAG_NAME="ContentProtection";mf.TAG_NAME="cenc:pssh";nf.TAG_NAME="BaseURL";of.TAG_NAME="Location";pf.TAG_NAME="SegmentBase";sf.TAG_NAME="RepresentationIndex";
tf.TAG_NAME="Initialization";uf.TAG_NAME="SegmentList";vf.TAG_NAME="SegmentURL";wf.TAG_NAME="SegmentTemplate";xf.TAG_NAME="SegmentTimeline";yf.TAG_NAME="S";
ef.prototype.parse=function(a,b){this.url=a.s;this.id=S(b,"id",T);this.type=S(b,"type",T)||"static";this.b=S(b,"mediaPresentationDuration",Af);this.h=S(b,"minBufferTime",Af,this.h);this.g=S(b,"minimumUpdatePeriod",Af,this.g);this.c=S(b,"availabilityStartTime",Bf,this.c);this.f=S(b,"timeShiftBufferDepth",Af,this.f);this.i=S(b,"suggestedPresentationDelay",Af,this.i);var c=a.s,d=U(this,b,nf);this.s=Cf(c,d);if(d=V(this,b,of))this.j=Df(c,d.url);this.a=U(this,b,ff)};
ff.prototype.parse=function(a,b){this.id=S(b,"id",T);this.start=S(b,"start",Af);this.a=S(b,"duration",Af);var c=U(this,b,nf);this.s=Cf(a.s,c);this.c=V(this,b,pf);this.f=V(this,b,uf);this.g=V(this,b,wf);this.b=U(this,b,gf);Ef(this)};function Ef(a){for(var b=[],c=0;c<a.b.length;++c){var d=a.b[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.b.length;++c)if(d=a.b[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
gf.prototype.parse=function(a,b){var c=V(this,b,jf)||{},d=V(this,b,hf);this.id=S(b,"id",T);this.group=S(b,"group",W);this.lang=S(b,"lang",T,c.lang);this.contentType=S(b,"contentType",T,c.contentType);this.width=S(b,"width",X);this.height=S(b,"height",X);this.b=S(b,"mimeType",T);this.i=S(b,"codecs",T);this.c=d&&"main"==d.value;this.lang&&(this.lang=Pa(this.lang));c=U(this,b,nf);this.s=Cf(a.s,c);this.j=U(this,b,lf);!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]);this.f=a.c?Ff(this,
b,a.c):V(this,b,pf);this.g=a.f?Ff(this,b,a.f):V(this,b,uf);this.h=a.g?Ff(this,b,a.g):V(this,b,wf);this.a=U(this,b,kf);!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))};hf.prototype.parse=function(a,b){this.value=S(b,"value",T)};jf.prototype.parse=function(a,b){this.id=S(b,"id",T);this.lang=S(b,"lang",T);this.contentType=S(b,"contentType",T);this.lang&&(this.lang=Pa(this.lang))};
kf.prototype.parse=function(a,b){this.id=S(b,"id",T);this.bandwidth=S(b,"bandwidth",X);this.width=S(b,"width",X,a.width);this.height=S(b,"height",X,a.height);this.f=S(b,"mimeType",T,a.b);this.h=S(b,"codecs",T,a.i);this.lang=a.lang;var c=U(this,b,nf);this.s=Cf(a.s,c);this.c=U(this,b,lf);this.g=a.f?Ff(this,b,a.f):V(this,b,pf);this.b=a.g?Ff(this,b,a.g):V(this,b,uf);this.a=a.h?Ff(this,b,a.h):V(this,b,wf);this.c=this.c.concat(a.j)};
lf.prototype.parse=function(a,b){this.f=b;this.c=S(b,"schemeIdUri",T);var c=S(b,"cenc:default_KID",T);c&&(this.b=c.replace(/[-]/g,""));this.a=V(this,b,mf)};mf.prototype.parse=function(a,b){var c=Gf(b);if(c){this.psshBox=ra(c);try{this.parsedPssh=new Ob(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};nf.prototype.parse=function(a,b){this.url=Gf(b)};of.prototype.parse=function(a,b){this.url=Gf(b)};
pf.prototype.parse=function(a,b){this.s=a.s||this.s;this.g=S(b,"timescale",X,this.g);this.f=S(b,"presentationTimeOffset",W,this.f);this.a=S(b,"indexRange",Hf,this.a);this.b=V(this,b,sf)||this.b;this.c=V(this,b,tf)||this.c};sf.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=Df(a.s,c);this.a=S(b,"range",Hf,R(a.a))};tf.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=Df(a.s,c);this.a=S(b,"range",Hf)};
uf.prototype.parse=function(a,b){this.s=a.s||this.s;this.f=S(b,"timescale",X,this.f);this.g=S(b,"presentationTimeOffset",W,this.g);this.b=S(b,"duration",X,this.b);var c=S(b,"startNumber",W,this.i);null!=c&&(this.i=0<c?c:1);this.h=V(this,b,tf)||this.h;this.a=(c=U(this,b,vf))&&0<c.length?c:this.a;this.c=V(this,b,xf)||this.c};vf.prototype.parse=function(a,b){var c=S(b,"media",T);this.b=Df(a.s,c);this.a=S(b,"mediaRange",Hf)};
wf.prototype.parse=function(a,b){this.a=S(b,"timescale",X,this.a);this.j=S(b,"presentationTimeOffset",W,this.j);this.b=S(b,"duration",X,this.b);var c=S(b,"startNumber",W,this.c);null!=c&&(0<c?this.c=c:(this.c=1,this.v=!0));this.i=S(b,"media",T,this.i);this.g=S(b,"index",T,this.g);this.h=S(b,"initialization",T,this.h);this.f=V(this,b,xf)||this.f};xf.prototype.parse=function(a,b){this.a=U(this,b,yf)};yf.prototype.parse=function(a,b){this.b=S(b,"t",W);this.a=S(b,"d",W);this.c=S(b,"r",If)};
function Cf(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new K(e)):(e=Df(a.slice(0,1),e),c.push(e[0]))}return c}function Df(a,b){if(!b)return a;var c=new K(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Ff(a,b,c){var d=R(c);(b=Jf(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function V(a,b,c){var d=null;if(b=Jf(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Jf(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function U(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Gf(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function rf(a){return a?a.map(function(a){return a.clone()}):null}function R(a){return a?a.clone():null}
function S(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function Bf(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Af(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=W(b[1]);c&&(a+=31536E3*c);(c=W(b[2]))&&(a+=2592E3*c);(c=W(b[3]))&&(a+=86400*c);(c=W(b[4]))&&(a+=3600*c);(c=W(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Hf(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=W(b[1]);if(null==a)return null;b=W(b[2]);return null==b?null:new zf(a,b)}function If(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function X(a){a=window.parseInt(a,10);return 0<a?a:null}function W(a){a=window.parseInt(a,10);return 0<=a?a:null}function T(a){return a};function Kf(a,b,c,d){for(var e=b.a,f=[],g=0;g<d;++g){var h=g+c,l=(h-1)*e.b,m=l/e.a,n=(l+e.b)/e.a,h=df(a,b,e.v?h-1:h,l);if(!h)return null;f.push(new hd(m,n,h))}return f}function df(a,b,c,d){if(!b.a)return null;var e=b.a.i;if(!e)return b.s?new H(a,b.s,0,null):null;c=Lf(e,b.id,c,b.bandwidth,d);if(!c)return null;b=ed(b.s,c);return new H(a,b,0,null)}
function Lf(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new K(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function cf(a,b,c){var d=0;b*=c;a=a.a;c=[];for(var e=0;e<a.length&&a[e].a;++e){var f=a[e].b,f=null!=f?f:d,g=a[e].c||0;0>g&&(g=a[e].a,g=e+1===a.length?Math.ceil((a[0].b+b-f)/g)-1:Math.ceil((a[e+1].b-f)/g)-1);0<c.length&&f!=d&&(c[c.length-1].end=f);for(var h=0;h<=g;++h)d=f+a[e].a,c.push({start:f,end:d}),f=d}return c};function Mf(a,b){this.a=new zb;this.a.f="text";this.a.a=3;this.a.c=1E3*(null!=b?b:0);this.a.g=!0;this.b=a}function Nf(a){var b=a.b;return Ab(b,a.a).then(function(a){var d;d=b.b;d=(a=(new DOMParser).parseFromString(a,"text/xml"))?V({s:d},a,ef):null;if(d)return Promise.resolve(d);d=Error("MPD parse failure.");d.type="dash";return Promise.reject(d)})};function Of(a,b,c,d,e){this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}Of.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
Of.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.b,b=[];a.c&&(b=cf(a.c,a.f||1,this.b.a||0));var c=0;a.b&&a.i?c=(a.i-1)*a.b:0<b.length&&(c=b[0].start-(a.g||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length));for(var e=[],f=0;f<d;++f){var g=a.a[f],h=c/a.f,l=null,m=null;a.b?(l=c+a.b,m=l/a.f):0<b.length?(l=b[f].end-(a.g||0),m=l/a.f):(m=h+this.b.a,l=m*a.f);var c=l,l=0,n=null;g.a&&(l=g.a.na,n=g.a.end);e.push(new hd(h,m,new H(this.f,
g.b,l,n)))}"dynamic"==this.c.type?this.a=new Q(e,this.c,this.b,this.h):this.a=new L(e);return Promise.resolve(this.a)};function Pf(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var l=a.i||0,m=a.f||0;h=c.a;h=h.b/h.a;var n=d-(a.c+b.start);0>n?h=null:(m=n-2*h-m,0>m&&(m=0),m=Math.ceil(m/h)*h,n-=h,0>n?h=null:(l=Math.floor(n/h)*h-l,0>l&&(l=0),l=Math.floor(l/h)*h,h={Za:m/h+1,current:(l>=m?l:m)/h+1}))}h&&(f=h.Za,g=h.current-h.Za+1);f=Kf(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;Q.call(this,f,a,b,d);this.u=c;this.v=this.b=0<this.length()?a.c+b.start+this.A().a:null;this.j=
h?h.current+1:null;this.B=e}q(Pf,Q);Pf.prototype.destroy=function(){this.B=this.u=null;Q.prototype.destroy.call(this)};Pf.prototype.la=function(a){var b=Ea()/1E3;Qf(this,b);Ye(this,b);return L.prototype.la.call(this,a)};Pf.prototype.Ha=function(a){if(null!=this.b||!(a instanceof Pf)||null==a.b)return!1;this.b=a.b;this.v=a.v;this.j=a.j;this.f=a.f;this.h=a.h;md(this,a);Qf(this,Ea()/1E3);Xe(this);return!0};
Pf.prototype.ka=function(a){a=Q.prototype.ka.call(this,a);null!=this.b&&(this.b+=a,this.v+=a);return a};Pf.prototype.Ea=function(){var a=Ea()/1E3;Qf(this,a);return $e(this,a)};function Qf(a,b){if(null!=a.b&&null!=a.v&&null!=a.j){var c=a.u.a,c=c.b/c.a,d=Math.floor((a.v+(b-a.f)-a.b)/c);if(0!=d){var e=Kf(a.B,a.u,a.j,d);Array.prototype.push.apply(a.o,jd(e,a.i));a.b+=d*c;a.j+=d}}};function Rf(a,b,c,d,e){this.f=a;this.b=b;this.c=c;this.h=d;this.a=null;this.g=e}Rf.prototype.destroy=function(){this.g=this.c=this.b=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
Rf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new Pf(this.f,this.b,this.c,this.h,this.g)}catch(a){return Promise.reject(a)}else{var b;b=this.c.a;var c=Math.ceil(this.b.a/(b.b/b.a));b.c>c?b=null:(b=Kf(this.g,this.c,b.c,c-(b.c-1)))?(0<b.length&&(c=b[b.length-1],b[b.length-1]=id(c,c.b,this.b.a)),b=new L(b)):b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function Sf(a){this.a=a}
function Tf(a,b,c){for(var d=Ea()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.b.length;++g){var h=f.b[g];if("text"!=h.contentType)for(var l=0;l<h.a.length;++l){var m=h.a[l],n=0,n=n+(m.g?1:0),n=n+(m.b?1:0),n=n+(m.a?1:0);0==n?(h.a.splice(l,1),--l):1!=n&&(m.g?(m.b=null,m.a=null):m.b&&(m.a=null))}}Uf(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.b.length;++g){l=h=f.b[g];m=null;for(n=0;n<l.a.length;++n){var t=l.a[n].f||"";m?t!=m&&(l.a.splice(n,1),--n):m=t}0==h.a.length&&(f.b.splice(g,1),--g)}"dynamic"==
b.type&&null==b.c&&(b.c=d);e=new xd;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new H(c,b.j||b.url),e.h=b.c);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=Vf(a,b,g,d,c);e.a.push(g)}return e}
function Uf(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(h.start)&&(g.a=h.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.b)||(e=a.a[a.a.length-1],d?a.b=c:b(e.start)&&b(e.a)?a.b=e.start+e.a:"dynamic"!=a.type&&
(a.b=c))}}function Vf(a,b,c,d,e){var f=new wd;f.id=c.id;f.start=c.start;f.b=c.a;var g=new z;c.b.forEach(function(a){g.push(a.contentType||"",a)});for(var h=Da(g),l=0;l<h.length;++l){var m=new z;g.get(h[l]).forEach(function(a){m.push(a.group,a)});for(var n=Da(m),t=0;t<n.length;++t){var C=new z;m.get(n[t]).forEach(function(a){C.push(a.lang,a)});for(var u=Da(C),v=0;v<u.length;++v){var oa=C.get(u[v]),oa=Wf(a,b,c,oa,d,e);f.a.push(oa)}}}return f}
function Wf(a,b,c,d,e,f){Ha(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new sd,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.c});for(var h={},l=0;l<d.length;++l)for(var m=d[l],n=0;n<m.a.length;++n){var t=m.a[n],C=Xf(a,t),u=g.a.slice(0);
Yf(C,u);0==u.length&&0<g.a.length||!(t=Zf(b,c,t,e,f))||(g.m.push(t),g.a=u,h[t.C]=m)}if(g.a.some(function(a){return""==a.a}))return g.m.forEach(function(a){a.N=!0}),g;a=$f(d);for(l=0;l<g.m.length;++l)t=g.m[l],m=h[t.C],m==a&&(t.N=!0);return g}function $f(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}
function Yf(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.h==g.h&&f.i==g.i&&f.g==g.g&&f.v==g.v&&f.f==g.f&&f.j==g.j&&ta(f.c,g.c)){d=!0;Ka(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}function Xf(a,b){var c=[];if(0==b.c.length)c.push(new Ia);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,ag(a,b.c[d]));return c}
function ag(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.c||"",b.f);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f=Ja(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&Ka(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function Zf(a,b,c,d,e){if(!c.s||0===c.s.length)return null;var f=null,g=1,h=0;if(c.g)f=c.f.split("/")[1],"mp4"!=f&&"webm"!=f?f=null:(g=c.g,"webm"!=f||g.c?g.a||g.b&&g.b.a?(h=g.b,h||(h=new sf,h.url=c.s,h.a=g.a?g.a.clone():null),h=bg(h,e),g=g.c?bg(g.c,e):null,a=new af(a,b,f,h,g,d,e),b=new gd(g),d=new pd,d.H=a,d.D=b,f=d):f=null:f=null),g=c.g.g,h=c.g.f;else if(c.b)f=c.b,!f.b&&!f.c&&1<f.a.length?f=null:f.b||b.a||f.c||1!=f.a.length?f.c&&0===f.c.a.length?f=null:(f=f.h?bg(f.h,e):null,a=new Of(a,b,c,d,e),b=
new gd(f),d=new pd,d.H=a,d.D=b,f=d):f=null,g=c.b.f,h=c.b.g;else if(c.a){a:if(f=c.a,g=0+(f.g?1:0),g+=f.f?1:0,g+=f.b?1:0,0==g?g=!1:(1!=g&&(f.g?(f.f=null,f.b=null):f.f&&(f.b=null)),g=!0),g){g=null;if(f.h&&(g=(f=c.a.h)?cg(c,f,tf):null,!g)){f=null;break a}f=g?bg(g,e):null;g=c.a;g.g?(g=c.f.split("/")[1],"mp4"!=g&&"webm"!=g?a=null:"webm"!=g||f?df(e,c,1,0)?(h=(h=c.a.g)?cg(c,h,sf):null)?(h=bg(h,e),a=new af(a,b,g,h,f,d,e)):a=null:a=null:a=null):a=g.i?g.f?new bf(a,b,c,d,e):g.b?"dynamic"!=a.type&&null==b.a?null:
new Rf(a,b,c,d,e):null:null;a?(b=new gd(f),d=new pd,d.H=a,d.D=b,f=d):f=null}else f=null;g=c.a.a;h=c.a.j}else"text"==c.f.split("/")[0]&&(f=new pd,f.H=new nd(new H(e,c.s)));if(!f)return null;f.id=c.id;h&&(f.c=-1*h/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.f||"";f.b=c.h||"";for(a=0;a<c.c.length;++a)b=c.c[a],b.b&&f.f.push(b.b);return f}function cg(a,b,c){b=Lf(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=ed(a.s,b);return c}
function bg(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.na,e=a.a.end);return new H(b,c,d,e)};function Y(a,b,c){b||(b=new Ua);c||(c=new O);P.call(this,null,b,c);this.R=a;this.M=[];this.timeoutMs=3E4;this.l={};this.j=this.ga=null}q(Y,P);p("shaka.player.OfflineVideoSource",Y);Y.prototype.T=function(a){null!=a.licenseRequestTimeout&&(this.l.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.l.segmentRequestTimeout=a.segmentRequestTimeout);P.prototype.T.call(this,a)};
p("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new ob,b=gb(a).then(function(){return pb(a)});b.then(function(){ib(a)}).catch(function(){ib(a)});return b});
Y.prototype.xa=function(a,b,c,d){var e,f=null,g={},h=[];a=new H(this.ga,[new K(a)]);return Nf(new Mf(a,this.da)).then(w(this,function(a){this.a=Tf(new Sf(c),a,this.ga);if(this.a.b)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.T({preferredLanguage:b});return P.prototype.X.call(this)})).then(w(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new Nd(null,a,this);null!=this.l.licenseRequestTimeout&&(e.w=Number(this.l.licenseRequestTimeout));
G(this.i,e,"sessionReady",this.ta.bind(this));G(this.i,e,"error",function(a){f=a});return e.initialize()})).then(w(this,function(){for(var a=Ba(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.m.length;++e){var f=c.m[e];g[f.C]=f}return d()})).then(w(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)h.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];h=h.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?!1:!0});a=h.map(function(a){return a.D.create()});
return Promise.all(a)})).then(w(this,function(a){for(var b=h,c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(rd(b[d]))}catch(e){}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(w(this,function(){return Qd(e,this.timeoutMs)})).then(w(this,function(){return f?Promise.reject(f):dg(this,h,e.a,this.a.a[0].b)})).then(w(this,function(a){this.R=a;return f?
(eg(this),Promise.reject(f)):Promise.resolve(a)}))};p("shaka.player.OfflineVideoSource.prototype.store",Y.prototype.xa);Y.prototype.Aa=function(a){this.ga=a};Y.prototype.setNetworkCallback=Y.prototype.Aa;Y.prototype.ta=function(a){this.M.push(a.detail.sessionId)};
function dg(a,b,c,d){var e=new Qe(a.Z,a);null!=a.l.segmentRequestTimeout&&(e.b=Number(a.l.segmentRequestTimeout));return gb(e).then(w(a,function(){return Re(e,b,this.M,d,c)})).then(function(a){ib(e);return Promise.resolve(a)}).catch(function(a){ib(e);return Promise.reject(a)})}
Y.prototype.X=function(){var a=new ob,b,c;return gb(a).then(w(this,function(){return qb(a,this.R)})).then(w(this,function(d){var e=[];this.M=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(rb(a,d.stream_ids[f]));return Promise.all(e)})).then(w(this,
function(a){var e=b,f=c,g=new xd;g.c=5;for(var h=new wd,l=0;l<a.length;++l){var m=a[l],n=new pd,t=new od(m.references),C=new gd(null,m.init_segment);n.H=t;n.D=C;n.a=m.mime_type;n.b=m.codecs;n.N=!0;this.j&&(null!=this.j.licenseServerUrl&&(f.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(f.withCredentials=this.j.withCredentials),f.licensePostProcessor=this.j.licensePostProcessor,f.licensePreProcessor=this.j.licensePreProcessor,f.serverCertificate=this.j.serverCertificate);
m=Ja(f);t=new sd;t.m.push(n);t.a.push(m);t.contentType=n.a.split("/")[0];h.a.push(t);h.b=e}g.a.push(h);this.a=g;return P.prototype.X.call(this)})).then(function(){ib(a);return Promise.resolve()}).catch(function(b){ib(a);return Promise.reject(b)})};
Y.prototype.za=function(a,b){a&&(this.j={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return fg(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(w(this,function(){return eg(this)})).then(function(){return Promise.resolve(c)})};Y.prototype.deleteGroup=Y.prototype.za;Y.prototype.ua=function(){return this.M};
Y.prototype.ha=function(){return!0};function eg(a){var b=new Qe(null,null);return gb(b).then(w(a,function(){return Ue(b,this.R)})).then(function(){ib(b);return Promise.resolve()}).catch(function(a){ib(b);return Promise.reject(a)})}
function fg(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new Nd(null,b,a);null!=a.l.licenseRequestTimeout&&(c.w=Number(a.l.licenseRequestTimeout));return a.X().then(function(){return c.initialize()}).then(w(a,function(){return Qd(c,this.timeoutMs)})).then(function(){return Rd(c)}).then(w(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(w(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};function Z(a,b,c,d){c||(c=new Ua);d||(d=new O);P.call(this,null,c,d);this.za=a;this.l=null;this.M=b;this.R=[];this.ga=[];this.ta=[];this.j=null}q(Z,P);p("shaka.player.DashVideoSource",Z);Z.prototype.Aa=function(a,b,c){this.R.push(a);this.ga.push(b||"");this.ta.push(c||"")};Z.prototype.addExternalCaptions=Z.prototype.Aa;Z.prototype.xa=function(a){this.j=a};Z.prototype.setNetworkCallback=Z.prototype.xa;Z.prototype.destroy=function(){this.l=this.j=this.M=null;P.prototype.destroy.call(this)};
Z.prototype.X=function(){var a=new H(this.j,[new K(this.za)]);return Nf(new Mf(a,this.da)).then(w(this,function(a){this.l=a;for(var c=0;c<this.R.length;c++){var d=a,e=this.R[c],f=this.ga[c],g=this.ta[c];if(0!==d.a.length){var h=new gf;h.contentType="text";h.lang=f||"en";h.c=!0;f=new kf;f.bandwidth=0;f.f=g||"text/vtt";f.s=[new K(e)];h.a.push(f);d.a[0].b.push(h);Ef(d.a[0])}}this.a=Tf(new Sf(this.M),a,this.j);return P.prototype.X.call(this)}))};
Z.prototype.hb=function(a){return Nf(new Mf(a,this.da)).then(w(this,function(a){this.l=a;a=Tf(new Sf(this.M),a,this.j);return Promise.resolve(a)}))};Z.prototype.gb=function(){var a=Tf(new Sf(this.M),this.l,this.j);return Promise.resolve(a)};}.bind(g,this))();
if (typeof(module)!="undefined"&&module.exports)module.exports=g.shaka;
else if (typeof(define)!="undefined" && define.amd)define(function(){return g.shaka});
else this.shaka=g.shaka;
})();

