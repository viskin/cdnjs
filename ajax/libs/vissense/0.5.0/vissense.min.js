/*! { "name": "vissense", "version": "0.5.0", "homepage": "https://vissense.github.io/vissense","copyright": "(c) 2015 tbk" } */
!function(a,b,c){"use strict";var d=a[b],e=c(a,a.document);a[b]=e,a[b].noConflict=function(){return a[b]=d,e}}(this,"VisSense",function(a,b,c){"use strict";function d(a,b){return function(){var d=arguments;return g(function(){a.apply(c,d)},b||0)}}function e(a,b){var c=q;return function(){var d=this,e=arguments;c(),c=g(function(){a.apply(d,e)},b)}}function f(a,b){var d=p(b),e=p(a);return d||e?d&&e?(j(Object.keys(b),function(d){a[d]===c&&(a[d]=b[d])}),a):d?b:a:b}function g(a,b){var c=setTimeout(function(){a()},b||0);return function(){clearTimeout(c)}}function h(a,b){return function(){return(o(a)?a():a)?b():c}}function i(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length,g=o(c);++d<f;){var h=e[d];a[h]=g?c(a[h],b[h],h,a,b):b[h]}return a}function j(a,b,d){for(var e=0,f=a.length;f>e;e++){var g=b.call(d,a[e],e,a);if(g!==c)return g}}function k(a){return a}function l(a){return a!==c}function m(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"===Object.prototype.toString.call(a)||!1}function n(a){return a&&1===a.nodeType||!1}function o(a){return"function"==typeof a||!1}function p(a){var b=typeof a;return"function"===b||a&&"object"===b||!1}function q(){}function r(){return(new Date).getTime()}function s(a){var b,d=!1;return function(){return d||(b=a.apply(c,arguments),d=!0),b}}function t(){return{height:a.innerHeight,width:a.innerWidth}}function u(b){return a.getComputedStyle(b,null)}function v(a,b){return a.getPropertyValue(b)}function w(a,b){b||(b=u(a));var c=v(b,"display");if("none"===c)return!1;var d=v(b,"visibility");if("hidden"===d||"collapse"===d)return!1;var e=a.parentNode;return n(e)?w(e):!0}function x(a){if(a===b)return!0;if(!a||!a.parentNode)return!1;var c=u(a);return w(a,c)}function y(a,b){return!a||a.width<=0||a.height<=0?!1:a.bottom>0&&a.right>0&&a.top<b.height&&a.left<b.width}function z(a){var b=a.getBoundingClientRect(),c=t();if(!y(b,c)||!x(a))return 0;var d=0,e=0;return b.top>=0?d=Math.min(b.height,c.height-b.top):b.bottom>0&&(d=Math.min(c.height,b.bottom)),b.left>=0?e=Math.min(b.width,c.width-b.left):b.right>0&&(e=Math.min(c.width,b.right)),Math.round(d*e/(b.height*b.width)*1e3)/1e3}function A(){return!E.isHidden()}function B(a,b){if(!(this instanceof B))return new B(a,b);if(!n(a))throw new Error("not an element node");this._element=a,this._config=f(b,{fullyvisible:1,hidden:0,percentageHook:z,visibilityHooks:[]}),this._config.visibilityHooks.push(function(){return A()})}function C(a,b){var c=a.state(),d=c.percentage;return b&&d===b.percentage&&b.percentage===b.previous.percentage?b:c.hidden?B.VisState.hidden(d,b):c.fullyvisible?B.VisState.fullyvisible(d,b):B.VisState.visible(d,b)}function D(a,b){this._visobj=a,this._state={},this._started=!1,this._pubsub=new F,this._events=["start","stop","update","hidden","visible","fullyvisible","percentagechange","visibilitychange"];var c=f(b,{strategy:[new D.Strategy.PollingStrategy,new D.Strategy.EventStrategy],async:!1});this._strategy=new D.Strategy.CompositeStrategy(c.strategy),this._strategy.init(this),this._pubsub.on("update",function(a){var b=a._state.percentage,c=a._state.previous.percentage;b!==c&&a._pubsub.publish("percentagechange",[a,b,c])}),this._pubsub.on("update",function(a){a._state.code!==a._state.previous.code&&a._pubsub.publish("visibilitychange",[a])}),this._pubsub.on("visibilitychange",function(a){a._state.visible&&!a._state.previous.visible&&a._pubsub.publish("visible",[a])}),this._pubsub.on("visibilitychange",function(a){a._state.fullyvisible&&a._pubsub.publish("fullyvisible",[a])}),this._pubsub.on("visibilitychange",function(a){a._state.hidden&&a._pubsub.publish("hidden",[a])}),j(this._events,function(a){o(c[a])&&this.on(a,c[a])},this)}var E=function(a,b){var c=function(a,b){return{property:a,event:b}},d="visibilitychange",e=[c("webkitHidden","webkit"+d),c("msHidden","ms"+d),c("mozHidden","moz"+d),c("hidden",d)],f=j(e,function(c){return a[c.property]!==b?{isHidden:function(){return!!a[c.property]||!1},onVisibilityChange:function(b){return a.addEventListener(c.event,b,!1),function(){a.removeEventListener(c.event,b,!1)}}}:void 0});return f||{isHidden:function(){return!1},onVisibilityChange:function(){return q}}}(b),F=function(a){function b(a){this._cache={},this._onAnyCache=[],this._config=f(a,{async:!1,anyTopicName:"*"})}var c=function(a,b,c){j(b,function(a){a(c)})};return b.prototype.on=function(b,c){if(!o(c))return q;var e=function(b){return c.apply(a,b||[])},f=this._config.async?d(e):e,g=function(a,b,c){return function(){var c=b.indexOf(a);return c>-1?(b.splice(c,1),!0):!1}};return b===this._config.anyTopicName?(this._onAnyCache.push(f),g(f,this._onAnyCache,"*")):(this._cache[b]||(this._cache[b]=[]),this._cache[b].push(f),g(f,this._cache[b],b))},b.prototype.publish=function(a,b){var e=(this._cache[a]||[]).concat(a===this._config.anyTopicName?[]:this._onAnyCache),f=this._config.async?d(c):c;return f(a,e,b||[])},b}();B.prototype.state=function(){var a=j(this._config.visibilityHooks,function(a){return a(this._element)?void 0:B.VisState.hidden(0)},this);return a||function(a,b){var c=b.percentageHook(a);return c<=b.hidden?B.VisState.hidden(c):c>=b.fullyvisible?B.VisState.fullyvisible(c):B.VisState.visible(c)}(this._element,this._config)},B.prototype.percentage=function(){return this.state().percentage},B.prototype.element=function(){return this._element},B.prototype.isFullyVisible=function(){return this.state().fullyvisible},B.prototype.isVisible=function(){return this.state().visible},B.prototype.isHidden=function(){return this.state().hidden},B.fn=B.prototype,B.of=function(a,b){return new B(a,b)};var G={HIDDEN:[0,"hidden"],VISIBLE:[1,"visible"],FULLY_VISIBLE:[2,"fullyvisible"]};return B.VisState=function(){function a(a,b,c){return c&&delete c.previous,{code:a[0],state:a[1],percentage:b,previous:c||{},fullyvisible:a[0]===G.FULLY_VISIBLE[0],visible:a[0]===G.VISIBLE[0]||a[0]===G.FULLY_VISIBLE[0],hidden:a[0]===G.HIDDEN[0]}}return{hidden:function(b,c){return a(G.HIDDEN,b,c)},visible:function(b,c){return a(G.VISIBLE,b,c)},fullyvisible:function(b,c){return a(G.FULLY_VISIBLE,b,c)}}}(),D.prototype.visobj=function(){return this._visobj},D.prototype.state=function(){return this._state},D.prototype.start=function(a){if(this._started)return this;var b=f(a,{async:!1});return this._cancelAsyncStart&&this._cancelAsyncStart(),b.async?this.startAsync():(this.update(),this._pubsub.publish("start",[this]),this._strategy.start(this),this._started=!0,this)},D.prototype.startAsync=function(a){this._cancelAsyncStart&&this._cancelAsyncStart();var b=this,c=g(function(){b.start(i(f(a,{}),{async:!1}))});return this._cancelAsyncStart=function(){c(),b._cancelAsyncStart=null},this},D.prototype.stop=function(){this._cancelAsyncStart&&this._cancelAsyncStart(),this._started&&(this._strategy.stop(this),this._pubsub.publish("stop",[this])),this._started=!1},D.prototype.update=function(){this._state=C(this._visobj,this._state),this._pubsub.publish("update",[this])},D.prototype.on=function(a,b){return this._pubsub.on(a,b)},D.Strategy=function(){},D.Strategy.prototype.init=q,D.Strategy.prototype.start=q,D.Strategy.prototype.stop=q,D.Strategy.CompositeStrategy=function(a){this._strategies=m(a)?a:[a]},D.Strategy.CompositeStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.CompositeStrategy.prototype.init=function(a){j(this._strategies,function(b){o(b.init)&&b.init(a)})},D.Strategy.CompositeStrategy.prototype.start=function(a){j(this._strategies,function(b){o(b.start)&&b.start(a)})},D.Strategy.CompositeStrategy.prototype.stop=function(a){j(this._strategies,function(b){o(b.stop)&&b.stop(a)})},D.Strategy.PollingStrategy=function(a){this._config=f(a,{interval:1e3}),this._started=!1},D.Strategy.PollingStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.PollingStrategy.prototype.start=function(a){return this._started||(this._clearInterval=function(b){var c=setInterval(function(){a.update()},b);return function(){clearInterval(c)}}(this._config.interval),this._started=!0),this._started},D.Strategy.PollingStrategy.prototype.stop=function(){return this._started?(this._clearInterval(),this._started=!1,!0):!1},D.Strategy.EventStrategy=function(a){this._config=f(a,{debounce:50}),this._started=!1},D.Strategy.EventStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.EventStrategy.prototype.start=function(a){return this._started||(this._removeEventListeners=function(b){var c=e(function(){a.update()},b.debounce),d=E.onVisibilityChange(c);return addEventListener("scroll",c,!1),addEventListener("resize",c,!1),addEventListener("touchmove",c,!1),function(){removeEventListener("touchmove",c,!1),removeEventListener("resize",c,!1),removeEventListener("scroll",c,!1),d()}}(this._config),this._started=!0),this._started},D.Strategy.EventStrategy.prototype.stop=function(){return this._started?(this._removeEventListeners(),this._started=!1,!0):!1},B.VisMon=D,B.PubSub=F,B.fn.monitor=function(a){return new D(this,a)},B.Utils={async:d,debounce:e,defaults:f,defer:g,extend:i,forEach:j,fireIf:h,identity:k,isArray:m,isDefined:l,isElement:n,isFunction:o,isObject:p,isPageVisible:A,isVisibleByStyling:x,noop:q,now:r,once:s,percentage:z,VisibilityApi:E,_viewport:t,_isInViewport:y,_isDisplayed:w,_computedStyle:u,_styleProperty:v},B});