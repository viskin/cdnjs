/*! { "name": "vissense", "version": "0.1.0", "copyright": "(c) 2014 tbk" } */
!function(a,b,c,d){"use strict";function e(b){var c=b&&b.ownerDocument;return c?c.defaultView||c.parentWindow:a}function f(a,b){return function(){return(m(a)?a():a)?b():d}}function g(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length;++d<f;){var g=e[d];a[g]=c?c(a[g],b[g],g,a,b):b[g]}return a}function h(){}function i(a){return a}function j(){return(new Date).getTime()}function k(b){return a.setTimeout(function(){b()},0)}function l(a){return a===Object(a)}function m(a){return"function"==typeof a}function n(a,b){if(!l(a))return b;for(var c=Object.keys(b),d=0,e=c.length;e>d;d++){var f=c[d];void 0===a[f]&&(a[f]=b[f])}return a}function o(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function p(a){var b=a.getBoundingClientRect();return b.height===d||b.width===d?g({height:a.clientHeight,width:a.clientWidth},b):b}function q(b){var c=b?e(b):a;return c.innerWidth===d?{height:c.document.documentElement.clientHeight,width:c.document.documentElement.clientWidth}:{height:c.innerHeight,width:c.innerWidth}}function r(a){if(!a.offsetParent){var b=s(a,"position");if("fixed"!==b)return!1}return!0}function s(a,b,c){if(a.style!==d){var f=c||e(a),g=f.getComputedStyle(a,null);return g&&g.getPropertyValue(b)}}function t(a){var b=s(a,"display",e(a));if("none"===b)return!1;var c=s(a,"visibility",e(a));return"hidden"===c||"collapse"===c?!1:a.parentNode&&a.parentNode.style?t(a.parentNode):!0}function u(a){if(a===e(a).document)return!0;if(!a||!a.parentNode)return!1;if(!r(a))return!1;var b=t(a);return b!==!0?!1:!0}function v(a,b){return!a||a.width<=0||a.height<=0?!1:a.bottom>0&&a.right>0&&a.top<b.height&&a.left<b.width}function w(a){if(!y())return 0;var c=p(a),d=q(a);if(!v(c,d)||!u(a))return 0;var e=0,f=0;return c.top>=0?e=b.min(c.height,d.height-c.top):c.bottom>0&&(e=b.min(d.height,c.bottom)),c.left>=0?f=b.min(c.width,d.width-c.left):c.right>0&&(f=b.min(d.width,c.right)),e*f/(c.height*c.width)}function x(){return!!G}function y(){return G?!c.hidden():!0}function z(a){G&&c.change(a)}function A(a,b){if(!(this instanceof A))return new A(a,b);if(!a||1!==a.nodeType)throw new Error("not an element node");this._element=a,this._config=n(b,{fullyvisible:1,hidden:0})}function B(a,b){var c=a.state(),d=c.percentage;return b&&d===b.percentage()&&!b.hasPercentageChanged()?b:c.hidden?A.VisState.hidden(d,b):c.fullyvisible?A.VisState.fullyvisible(d,b):A.VisState.visible(d,b)}function C(b,c){for(var d=Object.keys(b),e=0,f=d.length;f>e;e++)b[e].call(c||a)}function D(a,b){var c=this,d=n(b,{strategy:new D.Strategy.NoopStrategy});c._visobj=a,c._lastListenerId=-1,c._status=null,c._listeners={},c._strategy=d.strategy,c._events=["update","hidden","visible","fullyvisible","percentagechange","visibilitychange"];for(var e=0,f=c._events.length;f>e;e++)d[c._events[e]]&&c.on(c._events[e],d[c._events[e]])}function E(a,b,c){this._state=a,this._percentage=b,this._prev=c}function F(a,b,c){return c&&(delete c._prev,c.prev=h),new E(a,b,c)}var G=c&&c.change&&c.isSupported&&c.isSupported();a.VisSenseUtils=g({},{fireIf:f,noop:h,identity:i,isObject:l,isFunction:m,defaults:n,extend:g,now:j,defer:k,debounce:o,isPageVisibilityAPIAvailable:x,isPageVisible:y,onPageVisibilityChange:z,percentage:w,isVisibleByStyling:u,_window:e,_viewport:q,_isInViewport:v,_getBoundingClientRect:p,_isDisplayed:t,_findEffectiveStyleProperty:s}),A.prototype.state=function(){var a=this.percentage();return{percentage:a,hidden:a<=this._config.hidden,visible:a>this._config.hidden,fullyvisible:a>=this._config.fullyvisible}},A.prototype.percentage=function(){return w(this._element)},A.prototype.isFullyVisible=function(){return this.state().fullyvisible},A.prototype.isVisible=function(){return this.state().visible},A.prototype.isHidden=function(){return this.state().hidden},A.prototype.fireIfFullyVisible=function(a){var b=this;return f(function(){return b.isFullyVisible()},a)},A.prototype.fireIfVisible=function(a){var b=this;return f(function(){return b.isVisible()},a)},A.prototype.fireIfHidden=function(a){var b=this;return f(function(){return b.isHidden()},a)},A.fn=A.prototype,A.version="0.1.0",A.of=function(a,b){return new A(a,b)},a.VisSense=A,D.prototype.visobj=function(){return this._visobj},D.prototype.status=function(){return this._status},D.prototype.start=function(){return this._strategy.start(this),this},D.prototype.stop=function(){return this._strategy.stop(this)},D.prototype.use=function(a){this._strategy.stop(),this._strategy=a,this._strategy.start(this)},D.prototype.onUpdate=function(a){return this._lastListenerId+=1,this._listeners[this._lastListenerId]=a,this._lastListenerId},D.prototype.update=function(){this._status=B(this._visobj,this._status),C(this._listeners,this)},D.prototype.fireIfVisibilityChanged=function(a){var b=this;return f(function(){return b._status.hasVisibilityChanged()},a)},D.prototype.fireIfPercentageChanged=function(a){var b=this;return f(function(){return b._status.hasPercentageChanged()},a)},D.prototype.onVisibilityChange=function(a){return this.onUpdate(this.fireIfVisibilityChanged(a))},D.prototype.onPercentageChange=function(a){var b=this;return this.onUpdate(this.fireIfPercentageChanged(function(){var c=b.status(),d=c.prev();a(c.percentage(),d&&d.percentage(),b)}))},D.prototype.onVisible=function(a){var b=this,c=f(function(){return b._status.isVisible()},a),d=b.fireIfVisibilityChanged(f(function(){return!b._status.prev()||b._status.wasHidden()},c));return b.onUpdate(d)},D.prototype.onFullyVisible=function(a){var b=this,c=f(function(){return b._status.isFullyVisible()},a),d=b.fireIfVisibilityChanged(c);return b.onUpdate(d)},D.prototype.onHidden=function(a){var b=this,c=f(function(){return b._status.isHidden()},a),d=b.fireIfVisibilityChanged(c);return b.onUpdate(d)},D.prototype.on=function(a,b){var c=this;switch(a){case"update":return c.onUpdate(b);case"hidden":return c.onHidden(b);case"visible":return c.onVisible(b);case"fullyvisible":return c.onFullyVisible(b);case"percentagechange":return c.onPercentageChange(b);case"visibilitychange":return c.onVisibilityChange(b)}return-1},A.VisMon=D,A.fn.monitor=function(a){return new D(this,a)};var H={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2};E.prototype.isVisible=function(){return this._state===H.VISIBLE||this.isFullyVisible()},E.prototype.isFullyVisible=function(){return this._state===H.FULLY_VISIBLE},E.prototype.isHidden=function(){return this._state===H.HIDDEN},E.prototype.state=function(){return this._state},E.prototype.wasVisible=function(){return!!this._prev&&this._prev.isVisible()},E.prototype.wasFullyVisible=function(){return!!this._prev&&this._prev.isFullyVisible()},E.prototype.wasHidden=function(){return!!this._prev&&this._prev.isHidden()},E.prototype.hasVisibilityChanged=function(){return!this._prev||this._state!==this._prev._state},E.prototype.prev=function(){return this._prev},E.prototype.hasPercentageChanged=function(){return!this._prev||this._percentage!==this._prev._percentage},E.prototype.percentage=function(){return this._percentage},A.VisState={hidden:function(a,b){return F(H.HIDDEN,a,b||null)},visible:function(a,b){return F(H.VISIBLE,a,b||null)},fullyvisible:function(a,b){return F(H.FULLY_VISIBLE,a,b||null)}},D.Strategy=function(){},D.Strategy.prototype.start=function(){throw new Error("Strategy#start needs to be overridden.")},D.Strategy.prototype.stop=function(){throw new Error("Strategy#stop needs to be overridden.")},D.Strategy.NoopStrategy=function(){},D.Strategy.NoopStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.NoopStrategy.prototype.start=function(a){a.update()},D.Strategy.NoopStrategy.prototype.stop=function(){},D.Strategy.PollingStrategy=function(a){this._config=n(a,{interval:1e3}),this._started=!1},D.Strategy.PollingStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.PollingStrategy.prototype.start=function(a){var b=this;return f(!b._started,function(){b.stop(),b._update=function(){a.update()},addEventListener("visibilitychange",b._update),function c(){a.update(),b._timer=setTimeout(c,b._config.interval)}(),b._started=!0})(),b._started},D.Strategy.PollingStrategy.prototype.stop=function(){var a=this;return a._started?(clearTimeout(a._timer),removeEventListener("visibilitychange",a._update),a._started=!1,!0):!1},D.Strategy.EventStrategy=function(a){this._config=n(a,{debounce:30}),this._started=!1},D.Strategy.EventStrategy.prototype=Object.create(D.Strategy.prototype),D.Strategy.EventStrategy.prototype.start=function(a){var b=this;return f(!b._started,function(){b.stop(),b._update=o(function(){a.update()},b._config.debounce),addEventListener("visibilitychange",b._update),addEventListener("scroll",b._update),addEventListener("resize",b._update),b._update(),b._started=!0})(),this._started},D.Strategy.EventStrategy.prototype.stop=function(){var a=this;return a._started?(removeEventListener("resize",a._update),removeEventListener("scroll",a._update),removeEventListener("visibilitychange",a._update),a._started=!1,!0):!1}}(window,Math,window.Visibility||null,void 0);
//# sourceMappingURL=vissense.min.js.map