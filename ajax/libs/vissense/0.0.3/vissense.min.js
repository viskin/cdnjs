/*! vissense - v0.0.2 - 2014-07-12
* Copyright (c) 2014 tbk;*/
!function(a,b){"use strict";var c=function(){var b=[],c=function(){return b.push(arguments),b.length-1};return{add:function(b,d,e,f){if(b.addEventListener)return b.addEventListener(d,e,!!f),c(b,d,e,!!f);if(b.attachEvent){var g="DOMContentLoaded"===d?"readystatechange":d;return b.attachEvent("on"+g,function(){e.call(b,a.event)}),c(b,g,e)}return-1},remove:function(a){var c=b[a];return c&&c[0]&&c[1]&&c[2]&&(c[0].removeEventListener?c[0].removeEventListener(c[1],c[2],c[3]):c[0].detachEvent&&c[0].detachEvent("on"+c[1],c[2]),b[a]=null),c},_removeAll:function(){for(var a=b.length-1;a>=0;a--)this.remove(a)}}}(),d=function(a){var c;return b.createEvent?(c=b.createEvent("HTMLEvents"),c.initEvent(a,!0,!0)):(c=b.createEventObject(),c.eventType=a),c.eventName=a,c},e=function(a,c){return b.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)};c.add(a,"unload",function(){c._removeAll()}),a.Happenings={version:"0.0.1",addEvent:c.add,removeEvent:c.remove,createEvent:d,dispatchEvent:e}}(window,window.document),!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.brwsrfyMetrics=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./node_modules/metrics/metrics"),e=a("./node_modules/metrics/reporting/report");c.Histogram=d.Histogram,c.Meter=d.Meter,c.Counter=d.Counter,c.Timer=d.Timer,c.Report=e},{"./node_modules/metrics/metrics":6,"./node_modules/metrics/reporting/report":9}],2:[function(a,b){var c=(a("./utils"),b.exports=function(a){this.content=[],this.scoreFunction=a});c.prototype={clone:function(){var a=new c(this.scoreFunction);return a.content=JSON.parse(JSON.stringify(this.content)),a},push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},peek:function(){return this.content[0]},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){for(var b=this.content.length,c=0;b>c;c++)if(this.content[c]==a){var d=this.content.pop();return c!=b-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.bubbleUp(c):this.sinkDown(c)),!0}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null;if(b>f){var h=this.content[f],i=this.scoreFunction(h);d>i&&(g=f)}if(b>e){var j=this.content[e],k=this.scoreFunction(j);(null==g?d:i)>k&&(g=e)}if(null==g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}}},{"./utils":3}],3:[function(a,b,c){c.mixin=function(){var a=function(b,c,d){for(var e in c)c.hasOwnProperty(e)&&(!d||"object"!=typeof c[e]||null===c[e]||c[e]instanceof Array?b[e]=c[e]:("undefined"==typeof b[e]&&(b[e]={}),a(b[e],c[e],d)))};return function(){var b,c,d=Array.prototype.slice.apply(arguments),e=!1;d.length>2&&"boolean"==typeof d[d.length-1]&&(e=d.pop()),b=d.shift(),c=d;for(var f=0,g=c.length;g>f;f++)a(b,c[f],e);return b}}()},{}],4:[function(a,b){var c=Math.pow(2,32),d=b.exports=function(){this.count=0,this.type="counter"};d.prototype.inc=function(a){a||(a=1),this.count+=a,this.count>c&&(this.count-=c+1)},d.prototype.dec=function(a){a||(a=1),this.count-=a,this.count<0&&(this.count=0)},d.prototype.clear=function(){this.count=0},d.prototype.printObj=function(){return{type:"counter",count:this.count}}},{}],5:[function(a,b){var c=a("../stats/exponentially_decaying_sample"),d=a("../stats/uniform_sample"),e=[.001,.01,.05,.1,.25,.5,.75,.9,.95,.98,.99,.999],f=b.exports=function(a){this.sample=a||new c(1028,.015),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0,this.type="histogram"};f.prototype.clear=function(){this.sample.clear(),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0},f.prototype.update=function(a,b){this.count++,this.sample.update(a,b),this.max=null===this.max?a:a>this.max?a:this.max,this.min=null===this.min?a:a<this.min?a:this.min,this.sum=null===this.sum?a:this.sum+a,this.updateVariance(a)},f.prototype.updateVariance=function(a){var b=this.varianceM,c=this.varianceS;1==this.count?this.varianceM=a:(this.varianceM=b+(a-b)/this.count,this.varianceS=c+(a-b)*(a-this.varianceM))},f.prototype.percentiles=function(a){a||(a=e);for(var b,c,d,f,g=this.sample.getValues().map(function(a){return parseFloat(a)}).sort(function(a,b){return a-b}),h={},i=0;i<a.length;i++)c=a[i]*(g.length+1),b=a[i],1>c?h[b]=g[0]:c>=g.length?h[b]=g[g.length-1]:(d=g[Math.floor(c)-1],f=g[Math.ceil(c)-1],h[b]=d+(c-Math.floor(c))*(f-d));return h},f.prototype.variance=function(){return this.count<1?null:this.varianceS/(this.count-1)},f.prototype.mean=function(){return 0==this.count?null:this.varianceM},f.prototype.stdDev=function(){return this.count<1?null:Math.sqrt(this.variance())},f.prototype.values=function(){return this.sample.getValues()},f.prototype.printObj=function(){var a=this.percentiles();return{type:"histogram",min:this.min,max:this.max,sum:this.sum,variance:this.variance(),mean:this.mean(),std_dev:this.stdDev(),count:this.count,median:a[.5],p75:a[.75],p95:a[.95],p99:a[.99],p999:a[.999]}},b.exports.createExponentialDecayHistogram=function(a,b){return new f(new c(a||1028,b||.015))},b.exports.createUniformHistogram=function(a){return new f(new d(a||1028))},b.exports.DEFAULT_PERCENTILES=e},{"../stats/exponentially_decaying_sample":10,"../stats/uniform_sample":13}],6:[function(a,b,c){c.Counter=a("./counter"),c.Histogram=a("./histogram"),c.Meter=a("./meter"),c.Timer=a("./timer")},{"./counter":4,"./histogram":5,"./meter":7,"./timer":8}],7:[function(a,b){var c=a("../stats/exponentially_weighted_moving_average.js"),d=b.exports=function(){this.m1Rate=c.createM1EWMA(),this.m5Rate=c.createM5EWMA(),this.m15Rate=c.createM15EWMA(),this.count=0,this.startTime=(new Date).getTime(),this.type="meter"};d.prototype.mark=function(a){a||(a=1),this.count+=a,this.m1Rate.update(a),this.m5Rate.update(a),this.m15Rate.update(a)},d.prototype.rates=function(){return{1:this.oneMinuteRate(),5:this.fiveMinuteRate(),15:this.fifteenMinuteRate(),mean:this.meanRate()}},d.prototype.fifteenMinuteRate=function(){return this.m15Rate.rate()},d.prototype.fiveMinuteRate=function(){return this.m5Rate.rate()},d.prototype.oneMinuteRate=function(){return this.m1Rate.rate()},d.prototype.meanRate=function(){return this.count/((new Date).getTime()-this.startTime)*1e3},d.prototype.printObj=function(){return{type:"meter",count:this.count,m1:this.oneMinuteRate(),m5:this.fiveMinuteRate(),m15:this.fifteenMinuteRate(),mean:this.meanRate(),unit:"seconds"}},d.prototype.tick=function(){this.m1Rate.tick(),this.m5Rate.tick(),this.m15Rate.tick()}},{"../stats/exponentially_weighted_moving_average.js":11}],8:[function(a,b){var c=a("./meter");Histogram=a("./histogram"),ExponentiallyDecayingSample=a("../stats/exponentially_decaying_sample");var d=b.exports=function(){this.meter=new c,this.histogram=new Histogram(new ExponentiallyDecayingSample(1028,.015)),this.clear(),this.type="timer"};d.prototype.update=function(a){this.histogram.update(a),this.meter.mark()},d.prototype.clear=function(){return this.histogram.clear()},d.prototype.count=function(){return this.histogram.count},d.prototype.min=function(){return this.histogram.min},d.prototype.max=function(){return this.histogram.max},d.prototype.mean=function(){return this.histogram.mean()},d.prototype.stdDev=function(){return this.histogram.stdDev()},d.prototype.percentiles=function(a){return this.histogram.percentiles(a)},d.prototype.values=function(){return this.histogram.values()},d.prototype.oneMinuteRate=function(){return this.meter.oneMinuteRate()},d.prototype.fiveMinuteRate=function(){return this.meter.fiveMinuteRate()},d.prototype.fifteenMinuteRate=function(){return this.meter.fifteenMinuteRate()},d.prototype.meanRate=function(){return this.meter.meanRate()},d.prototype.tick=function(){this.meter.tick()},d.prototype.printObj=function(){return{type:"timer",duration:this.histogram.printObj(),rate:this.meter.printObj()}}},{"../stats/exponentially_decaying_sample":10,"./histogram":5,"./meter":7}],9:[function(a,b){var c=function(a){var b=a.split("."),c=b.pop(),d=b.join(".");return{ns:d,name:c}},d=b.exports=function(a){this.trackedMetrics=a||{}};d.prototype.addMetric=function(a,b){var d=c(a);this.trackedMetrics[d.ns]||(this.trackedMetrics[d.ns]={}),this.trackedMetrics[d.ns][d.name]||(this.trackedMetrics[d.ns][d.name]=b)},d.prototype.getMetric=function(a){var b=c(a);if(this.trackedMetrics[b.ns])return this.trackedMetrics[b.ns][b.name]},d.prototype.summary=function(){var a={};for(namespace in this.trackedMetrics){a[namespace]={};for(name in this.trackedMetrics[namespace])a[namespace][name]=this.trackedMetrics[namespace][name].printObj()}return a}},{}],10:[function(a,b){var c=a("./sample"),d=a("../lib/binary_heap"),e=36e5,f=b.exports=function(a,b){this.limit=a,this.alpha=b,this.clear()};f.prototype=new c,f.prototype.getValues=function(){for(var a=[],b=this.values.clone();elt=b.pop();)a.push(elt.val);return a},f.prototype.size=function(){return this.values.size()},f.prototype.newHeap=function(){return new d(function(a){return a.priority})},f.prototype.now=function(){return(new Date).getTime()},f.prototype.tick=function(){return this.now()/1e3},f.prototype.clear=function(){this.values=this.newHeap(),this.count=0,this.startTime=this.tick(),this.nextScaleTime=this.now()+e},f.prototype.update=function(a,b){void 0==b?b=this.tick():b/=1e3;var c=this.weight(b-this.startTime)/Math.random(),d={val:a,priority:c};if(this.count<this.limit)this.count+=1,this.values.push(d);else{var e=this.values.peek();e.priority<c&&(this.values.push(d),this.values.pop())}this.now()>this.nextScaleTime&&this.rescale(this.now(),this.nextScaleTime)},f.prototype.weight=function(a){return Math.exp(this.alpha*a)},f.prototype.rescale=function(a){this.nextScaleTime=this.now()+e;var b=this.values.content,c=[],d=this.startTime;this.startTime=a&&a/1e3||this.tick();for(var f=0;f<b.length;f++)c.push({val:b[f].val,priority:b[f].priority*Math.exp(-this.alpha*(this.startTime-d))});this.values.content=c}},{"../lib/binary_heap":2,"./sample":12}],11:[function(a,b){var c=1-Math.exp(-5/60),d=1-Math.exp(-5/60/5),e=1-Math.exp(-5/60/15),f=EWMA=b.exports=function(a,b){var c=this;this.alpha=a,this.interval=b||5e3,this.initialized=!1,this.currentRate=0,this.uncounted=0,b&&(this.tickInterval=setInterval(function(){c.tick()},b),this.tickInterval.unref&&"[object Function]"==={}.toString.call(this.tickInterval.unref)&&this.tickInterval.unref())};f.prototype.update=function(a){this.uncounted+=a||1},f.prototype.tick=function(){var a=this.uncounted/this.interval;this.uncounted=0,this.initialized?this.currentRate+=this.alpha*(a-this.currentRate):(this.currentRate=a,this.initialized=!0)},f.prototype.rate=function(){return 1e3*this.currentRate},f.prototype.stop=function(){clearInterval(this.tickInterval)},b.exports.createM1EWMA=function(){return new EWMA(c,5e3)},b.exports.createM5EWMA=function(){return new EWMA(d,5e3)},b.exports.createM15EWMA=function(){return new EWMA(e,5e3)}},{}],12:[function(a,b){var c=b.exports=function(){this.values=[],this.count=0},c=b.exports=function(){};c.prototype.init=function(){this.clear()},c.prototype.update=function(a){this.values.push(a)},c.prototype.clear=function(){this.values=[],this.count=0},c.prototype.size=function(){return this.values.length},c.prototype.print=function(){console.log(this.values)},c.prototype.getValues=function(){return this.values}},{}],13:[function(a,b){var c=(a("../lib/utils"),a("./sample")),d=b.exports=function(a){this.limit=a,this.count=0,this.init()};d.prototype=new c,d.prototype.update=function(a){if(this.count++,this.size()<this.limit)this.values.push(a);else{var b=parseInt(Math.random()*this.count);b<this.limit&&(this.values[b]=a)}}},{"../lib/utils":3,"./sample":12}]},{},[1])(1)}),!function(a){"use strict";!function(a){Date.now||(Date.now=function(){return(new Date).getTime()}),a.performance||(a.performance=a.performance||{},a.performance.now=a.performance.now||a.performance.mozNow||a.performance.msNow||a.performance.oNow||a.performance.webkitNow||Date.now)}(a);var b=function(){function a(b){return this instanceof a?((+b!==b||0>b)&&(b=0),void(this._$={i:b})):new a(b)}var b=Math.pow(2,32),c=function(a){return+a!==a?1:+a};return a.MAX_VALUE=b,a.prototype.inc=function(a){return this.set(this.get()+c(a)),this.get()},a.prototype.dec=function(a){return this.inc(-1*c(a))},a.prototype.clear=function(){var a=this._$.i;return this._$.i=0,a},a.prototype.get=function(){return this._$.i},a.prototype.set=function(a){return this._$.i=c(a),this._$.i<0?this._$.i=0:this._$.i>b&&(this._$.i-=b),this.get()},a}(),c=function(){function b(a){return this instanceof b?(this._config=a||{},this._config.performance=this._config.performance!==!1,void(this._$={ts:0,te:0,r:!1})):new b(a)}var c=function(b){return b?a.performance.now():Date.now()},d=function(a,b){return+a===a?+a:b};return b.prototype._orNow=function(a){return d(a,c(this._config.performance))},b.prototype.startIf=function(a,b){return a&&(this._$.r=!0,this._$.ts=this._orNow(b),this._$.te=null),this},b.prototype.start=function(a){return this.startIf(!this._$.r,a)},b.prototype.forceStart=function(a){return this.startIf(!0,a)},b.prototype.restart=function(a){return this.forceStart(a)},b.prototype.stop=function(a){return this.stopIf(!0,a)},b.prototype.stopIf=function(a,b){return this._$.r&&a&&(this._$.te=this._orNow(b),this._$.r=!1),this},b.prototype.interim=function(a){return this._$.r?this._orNow(a)-this._$.ts:0},b.prototype.time=b.prototype.interim,b.prototype.get=function(a){return this._$.te?this._$.te-this._$.ts:this.time(a)},b.prototype.running=function(){return this._$.r},b.prototype.getAndRestartIf=function(a,b){var c=this.get(b);return a&&this.restart(b),c},b}();a.CountOnMe={version:"0.1.0",counter:b,stopwatch:c}}(window),function(a){"use strict";var b=-1,c={onVisible:function(a){var b=c.isSupported();if(!b||!c.hidden())return a(),b;var d=c.change(function(){c.hidden()||(c.unbind(d),a())});return d},change:function(a){if(!c.isSupported())return!1;b+=1;var d=b;return c._callbacks[d]=a,c._listen(),d},unbind:function(a){delete c._callbacks[a]},afterPrerendering:function(a){var b=c.isSupported(),d="prerender";if(!b||d!=c.state())return a(),b;var e=c.change(function(b,f){d!=f&&(c.unbind(e),a())});return e},hidden:function(){return!(!c._doc.hidden&&!c._doc.webkitHidden)},state:function(){return c._doc.visibilityState||c._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!c._doc.visibilityState&&!c._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(a){var b=c.state();for(var d in c._callbacks)c._callbacks[d].call(c._doc,a,b)},_listen:function(){if(!c._init){var a="visibilitychange";c._doc.webkitVisibilityState&&(a="webkit"+a);var b=function(){c._change.apply(c,arguments)};c._doc.addEventListener?c._doc.addEventListener(a,b):c._doc.attachEvent(a,b),c._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=c:a.Visibility=c}(this),function(){"use strict";Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}())}.call(this,this),function(a,b){"use strict";function c(a){var b=a.ownerDocument;return"defaultView"in b?b.defaultView:b.parentWindow}function d(a,c){return function(){return a()?c():b}}a.VisSenseUtils={_window:c,fireIf:d}}.call(this,this),function(a,b){"use strict";function c(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length;++d<f;){var g=e[d];a[g]=c?c(a[g],b[g],g,a,b):b[g]}return a}function d(){}function e(a){return a}function f(){return(new Date).getTime()}function g(b){return a.setTimeout(function(){b()},0)}function h(a){return a===Object(a)}function i(a,b){if(!h(a))return a;for(var c in Object.keys(b))void 0===a[c]&&(a[c]=b[c]);return a}b=c(b,{noop:d,identity:e,isObject:h,defaults:i,extend:c,now:f,defer:g})}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(){return!!g}function e(){return g?!c.hidden():!0}function f(a){g&&c.change(a)}var g=!!c&&!!c.change&&!!c.isSupported&&c.isSupported();b.isPageVisibilityAPIAvailable=d,b.isPageVisible=e,b.onPageVisibilityChange=f}.call(this,this,this.VisSenseUtils,this.Visibility),function(a,b,c){"use strict";function d(a){if(!a.offsetParent){var b=f(a,"position");if("fixed"!==b)return!1}return!0}function e(a){var d=b._window(a);if("undefined"==typeof a.style)return c;if(d.getComputedStyle)return d.getComputedStyle(a,null);if(a.currentStyle)return a.currentStyle;throw new Error("cannot determine effective stylesheet in this browser")}function f(a,b){var d=e(a);if(!d)return c;var g=d[b];return"inherit"===g&&a.parentNode.style?f(a.parentNode,b):g}function g(a){var b=f(a,"display");return"none"===b?!1:a.parentNode.style?g(a.parentNode):!0}function h(a){if(a===b._window(a).document)return!0;if(!a||!a.parentNode)return!1;if(!d(a))return!1;var c=g(a);if(c!==!0)return!1;var e=f(a,"opacity");if(.01>+e)return!1;var h=f(a,"visibility");return"hidden"===h||"collapse"===h?!1:!0}b._isDisplayed=g,b._findEffectiveStyle=e,b.isVisibleByStyling=h}.call(this,this,this.VisSenseUtils),function(a,b){"use strict";function c(a){var b=a.getBoundingClientRect();return"undefined"==typeof b.height||"undefined"==typeof b.width?{top:b.top,bottom:b.bottom,left:b.left,right:b.right,height:a.clientHeight,width:a.clientWidth}:b}function d(a){var c=b._window(a);return{height:c.innerHeight||c.document.documentElement.clientHeight,width:c.innerWidth||c.document.documentElement.clientWidth}}function e(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.top>=0&&b.left>=0&&b.bottom<e.height&&b.right<e.width}function f(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.bottom>0&&b.right>0&&b.top<e.height&&b.left<e.width}b.viewport=d,b.isFullyInViewport=e,b.isInViewport=f,b._getBoundingClientRect=c}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a){if(!c.isInViewport(a)||!c.isVisibleByStyling(a)||!c.isPageVisible())return 0;var d=c._getBoundingClientRect(a);if(!d||d.height<=0||d.width<=0)return 0;var e=0,f=0,g=c.viewport(a);d.top>=0?e=b.min(d.height,g.height-d.top):d.top<0&&d.bottom>0&&(e=b.min(g.height,d.bottom)),d.left>=0?f=b.min(d.width,g.width-d.left):d.left<0&&d.right>0&&(f=b.min(g.width,d.right));var h=e*f/(d.height*d.width);return b.max(h,0)}function e(a){return c.isPageVisible()&&c.isFullyInViewport(a)&&c.isVisibleByStyling(a)}function f(a){return c.isPageVisible()&&c.isInViewport(a)&&c.isVisibleByStyling(a)}function g(a){return!f(a)}c.percentage=d,c.isFullyVisible=e,c.isVisible=f,c.isHidden=g}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c){"use strict";var d=function(a,d){function e(){for(var a=4,b=d.createElement("div");b.innerHTML="<!--[if gt IE "+a+"]><i></i><![endif]-->",b.getElementsByTagName("i")[0];)a++;return a>4?a:c}function f(){try{return 11===d.createDocumentFragment().nodeType}catch(a){}return!1}function g(){try{return!!b._findEffectiveStyle(d.getElementsByTagName("body")[0])}catch(a){}return!1}var h={};return h.MinIEVersion=7,h.PageVisibilityAPIAvailable=b.isPageVisibilityAPIAvailable(),h.IEVersion=e(),h.DOMPresent=f(),h.CanReadStyle=g(),h.BrowserSupported=h.IEVersion>=h.MinIEVersion,h.compatible=h.DOMPresent&&h.CanReadStyle&&h.BrowserSupported,h}(a,a.document);b.support=function(){return d}}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);if(!a||1!==a.nodeType)throw new Error("InvalidArgument: not an element node");this._element=a,this._config=b||{}}d.prototype.percentage=function(){return c.percentage(this._element)},d.prototype.isFullyVisible=function(){return c.isFullyVisible(this._element)},d.prototype.isVisible=function(){return c.isVisible(this._element)},d.prototype.isHidden=function(){return c.isHidden(this._element)},d.prototype.fireIfFullyVisible=function(a){var b=this;return c.fireIf(function(){return b.isFullyVisible()},a)},d.prototype.fireIfVisible=function(a){var b=this;return c.fireIf(function(){return b.isVisible()},a)},d.prototype.fireIfHidden=function(a){var b=this;return c.fireIf(function(){return b.isHidden()},a)},d.prototype.getFullyVisibleThreshold=c.noop,d.fn=d.prototype,a.VisSense=d}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c){"use strict";function d(a,b,c){this._$$state=a,this._$$percentage=b,this._$$prev=c}function e(a,b,e){return e&&(e.prev=c.noop),new d(a,b,e)}var f={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2};d.prototype.isVisible=function(){return this._$$state===f.VISIBLE||this.isFullyVisible()},d.prototype.isFullyVisible=function(){return this._$$state===f.FULLY_VISIBLE},d.prototype.isHidden=function(){return this._$$state===f.HIDDEN},d.prototype.state=function(){return this._$$state},d.prototype.wasVisible=function(){return!!this._$$prev&&this._$$prev.isVisible()},d.prototype.wasFullyVisible=function(){return!!this._$$prev&&this._$$prev.isFullyVisible()},d.prototype.wasHidden=function(){return!!this._$$prev&&this._$$prev.isHidden()},d.prototype.hasVisibilityChanged=function(){return!this._$$prev||this._$$state!==this._$$prev._$$state},d.prototype.prev=function(){return this._$$prev},d.prototype.hasPercentageChanged=function(){return!this._$$prev||this._$$percentage!==this._$$prev._$$percentage},d.prototype.percentage=function(){return this._$$percentage},c.VisState={hidden:function(a,b){return e(f.HIDDEN,a,b||null)},visible:function(a,b){return e(f.VISIBLE,a,b||null)},fullyvisible:function(a,b){return e(f.FULLY_VISIBLE,a,b||null)}}}.call(this,this,this.VisSense,this.VisSenseUtils),function(a,b,c){"use strict";function d(a,b){var d=a.percentage();if(b&&d===b.percentage()&&!b.hasPercentageChanged())return b;if(a.isHidden())return c.VisState.hidden(d,b);if(a.isFullyVisible())return c.VisState.fullyvisible(d,b);if(a.isVisible())return c.VisState.visible(d,b);throw new Error("IllegalState")}function e(b,c){for(var d in b)b.hasOwnProperty(d)&&b[d].call(c||a)}function f(a){var b=this;b._$$visobj=a,b._$$lastListenerId=-1,b._$$status=null,b._$$listeners={}}f.prototype.visobj=function(){return this._$$visobj},f.prototype.status=function(){return this._$$status},f.prototype.percentage=function(){return this._$$status.percentage()},f.prototype.prev=function(){return this._$$status.prev()},f.prototype._bind=function(a){return this._$$lastListenerId+=1,this._$$listeners[this._$$lastListenerId]=a,this._$$lastListenerId},f.prototype.off=function(a){return delete this._$$listeners[a],!0},f.prototype.update=function(){this._$$status=d(this._$$visobj,this._$$status),e(this._$$listeners,this)},f.prototype.fireIfVisibilityChanged=function(a){var b=this;return c.fireIf(function(){return b.status().hasVisibilityChanged()},a)},f.prototype.fireIfPercentageChanged=function(a){var b=this;return c.fireIf(function(){return b.status().hasPercentageChanged()},a)},f.prototype.onVisibilityChange=function(a){return this._bind(this.fireIfVisibilityChanged(a))},f.prototype.onPercentageChange=function(a){var b=this;return this._bind(this.fireIfPercentageChanged(function(){var c=b.status().prev();a(b.percentage(),c&&c.percentage())}))},f.prototype.onVisible=function(a){var b=this,d=c.fireIf(function(){return b.status().isVisible()},a),e=b.fireIfVisibilityChanged(c.fireIf(function(){return!b.status().prev()||b.status().wasHidden()},d));return b._bind(e)},f.prototype.onFullyVisible=function(a){var b=this,d=c.fireIf(function(){return b.status().isFullyVisible()},a),e=b.fireIfVisibilityChanged(d);return b._bind(e)},f.prototype.onHidden=function(a){var b=this,d=c.fireIf(function(){return b.status().isHidden()},a),e=b.fireIfVisibilityChanged(d);return b._bind(e)},f.prototype.on=function(a,b){var c={hidden:this.onHidden,visible:this.onVisible,fullyvisible:this.onFullyVisible,percentagechange:this.onPercentageChange,visibilitychange:this.onVisibilityChange};if(!c[a])throw new Error('VisMon: Event "'+a+'" is not supported');return c[a](b)},b.fn.monitor=function(a){var b=a||{};return b.detached?new f(this,b):this._$$monitor?this._$$monitor:(this._$$monitor=new f(this,b),this._$$monitor)}}.call(this,this,this.VisSense,this.VisSenseUtils),!function(a){"use strict";function b(a){clearInterval(a.id),clearTimeout(a.delay),delete a.id,delete a.delay}function c(a,b,c,d){var e=function(){a.last[c]=Date.now(),a.callback()};if(a.last=a.last||{},d){var f=Date.now(),g=f-a.last[c];b>g?a.delay=setTimeout(function(){e(),a.id=setInterval(e,b)},b-g):(setTimeout(function(){e()},0),a.id=setInterval(e,b))}else a.id=setInterval(e,b)}function d(a){return this instanceof d?(this._$$initialized=!1,this._$$state=null,this._$$lastTimerId=-1,this._$$timers={},this._$$config=a||{},void(this._$$config.reinitializeOn=this._$$config.reinitializeOn||{})):new d(a)}var e="0.0.11";Date.now||(Date.now=function(){return(new Date).getTime()}),d.prototype.state=function(){return this._$$state},d.prototype.update=function(a){this._$$state=a,this._cancelAndReinitialize()},d.prototype.every=function(a,b,c){this._$$lastTimerId+=1;var d=this._$$lastTimerId,e=b;return parseFloat(b)===b&&(e={"*":parseFloat(b)}),this._$$timers[d]={callback:a,intervals:e},this._run(d,!!c),d},d.prototype.stop=function(a){return this._$$timers[a]?(b(this._$$timers[a]),delete this._$$timers[a],!0):!1},d.prototype.stopAll=function(){for(var a in this._$$timers)this._$$timers.hasOwnProperty(a)&&b(this._$$timers[a]);this._$$timers={}},d.prototype._run=function(a,b){var d=this._$$timers[a],e=+d.intervals[this._$$state]||+d.intervals["*"];e>0&&c(d,e,this._$$state,!!b)},d.prototype._cancelAndReinitialize=function(){var a=!!this._$$config.reinitializeOn[this._$$state];for(var c in this._$$timers)this._$$timers.hasOwnProperty(c)&&(b(this._$$timers[c]),this._run(c,a))},a.Again=d,a.Again.version=e,a.Again.create=a.Again}(window),function(a,b,c,d){"use strict";function e(a,c){var d=this;d._$$vismon=a,d._config=c||{},d._config.reinitializeImmediatelyOnHidden=!0,d._config.checkIntervalVisible=100,d._config.checkIntervalHidden=100,d._$$again=b.create({reinitializeOn:{hidden:!1,visible:!0}}),d.start(d._config.checkIntervalVisible,d._config.checkIntervalHidden)}e.prototype.start=function(a,b){return this._$$started?!1:(function(c){c._config.checkIntervalVisible=a||c._config.checkIntervalVisible,c._config.checkIntervalHidden=b||c._config.checkIntervalHidden;var e=function(){c._$$vismon.update()},f=function(){var a=!!c._$$vismon.status().prev(),b=c._$$vismon.status().isHidden(),d=c._$$vismon.status().wasHidden();b===d&&a||c._$$again.update(b?"hidden":"visible")};c._$$vismon.onHidden(f),c._$$vismon.onVisible(f),d.onPageVisibilityChange(e),e(),d.defer(function(){f(),d.defer(e)}),c.every(c._config.checkIntervalVisible,c._config.checkIntervalHidden,e,!0)}(this),!0)},e.prototype.vismon=function(){return this._$$vismon},e.prototype.every=function(a,b,c,d){c||(c=b,b=0);var e=this;return this._$$again.every(function(){c(e._$$vismon)},{visible:a,hidden:b},d)},e.prototype.stop=function(a){return this._$$again.stop(a)},e.prototype.destroy=function(){return this._$$again.stopAll()},c.fn.timer=function(a){var b=a||{};return b.detached?new e(this.monitor({detached:!0}),b):this._$$timer?this._$$timer:(this._$$timer=new e(this.monitor(),b),this._$$timer)}}(this,this.Again,this.VisSense,this.VisSenseUtils),function(a,b,c,d,e){"use strict";function f(a,b){a>0&&b(a)}function g(a,b){function g(){if(m.updatePercentageOnPageHidden||c.isPageVisible()){var b=a.vismon().status().percentage();n.getMetric("percentage").update(b)}}function h(){var b=a.vismon().status().state();n.getMetric("visibility.changes").update(b)}function j(a){var b=a.status();f(r.get(),function(a){n.getMetric("time.duration").set(a)}),f(q.running()?q.stop().get():-1,function(a){n.getMetric("time.hidden").inc(a)}),f(o.running()?o.stop().get():-1,function(a){n.getMetric("time.visible").inc(a),n.getMetric("time.relativeVisible").inc(a*b.percentage())}),f(p.running()?p.stop().get():-1,function(a){n.getMetric("time.fullyvisible").inc(a)}),o.startIf(b.isVisible()),p.startIf(b.isFullyVisible()),q.startIf(b.isHidden())}var k=this,l=!1,m=i(b),n=new e.Report,o=d.stopwatch(),p=d.stopwatch(),q=d.stopwatch(),r=d.stopwatch().start();n.addMetric("time.visible",new d.counter),n.addMetric("time.fullyvisible",new d.counter),n.addMetric("time.hidden",new d.counter),n.addMetric("time.relativeVisible",new d.counter),n.addMetric("time.duration",new d.counter),n.addMetric("visibility.changes",new e.Timer),n.addMetric("percentage",new e.Timer),g(),h(),a.vismon().onPercentageChange(function(){l||(g(),j(a.vismon()))}),a.vismon().onVisibilityChange(function(){!l&&c.isPageVisible()&&h()}),a.every(m.visibleUpdateInterval,m.hiddenUpdateInterval,function(){!l&&c.isPageVisible()&&(g(),j(a.vismon()))}),k.getMetric=function(a){return n.getMetric(a)},k.summary=function(){return n.summary()},k.stopped=function(){return l},k.stop=function(){return g(),j(a.vismon()),a.destroy(),l=!0}}var h={visibleUpdateInterval:200,hiddenUpdateInterval:200,updatePercentageOnPageHidden:!1},i=function(a){if(a&&(a.visibleUpdateInterval<1||a.hiddenUpdateInterval<1))throw new Error("InvalidArgument: update interval needs to be positive.");return c.defaults(a,h)};b.fn.metrics=function(a){var b=a||{};return b.detached?new g(this.timer({detached:!0}),b):this._$$metrics?this._$$metrics:(this._$$metrics=new g(this.timer(),b),this._$$metrics)}}.call(this,this,this.VisSense,this.VisSenseUtils,this.CountOnMe,this.brwsrfyMetrics),function(a,b,c){"use strict";b.fn.onPercentageTimeTestPassed=function(a,b,d){var e=this,f=e.timer(),g=0,h=null,i=b>100?100:b,j=f.every(i,i,function(e){e.percentage()<a?h=null:(h=h||c.now(),g=c.now()-h,g>=b&&(d(),c.defer(function(){f.stop(j)})))},!0)}}(this,this.VisSense,this.VisSenseUtils),function(a,b){"use strict";b.fn.on50_1TestPassed=function(a){this.onPercentageTimeTestPassed(.5,1e3,a)}}(this,this.VisSense),function(a,b,c,d){"use strict";function e(){var c=b.newNetwork({url:"http://localhost:9000/vissense"});d.addEvent(a,"load",function(){{var b=a.navigator.userAgent;({osver:"undefined"!=typeof a.device?a.device.version:b.substr(b.indexOf("; ")+2,b.length).replace(")",";").split(";")[0]||"unknown"})}c.send("load","POST")}),d.addEvent(a,"beforeunload",function(){c.send("beforeunload","POST")})}function f(a,b){return new e(null,b||{})}b.newNetwork=function(a){var b=a.url+"?cacheBuster="+c.now(),d={send:function(c,d){function e(){return 4===f.readyState?200!==f.status?!1:void console.log("vissense report sent: "+f.responseText):void 0}var f=new XMLHttpRequest;f.open(d||"POST",b,!0),f.setRequestHeader("X-VisSense-Api-Key",a.apiKey),f.setRequestHeader("Content-Type","application/json"),f.onerror=function(){},f.onreadystatechange=e,f.send(JSON.stringify(c))}};return d},b.fn.client=function(a){return this._$$client?this._$$client:(this._$$client=f(this,a),this._$$client)
},b.client=f,b.client(null)}.call(this,window,window.VisSense,window.VisSenseUtils,window.Happenings);