/*! { "name": "vissense", "version": "0.3.0", "homepage": "https://vissense.github.io/vissense","copyright": "(c) 2015 tbk" } */
!function(a,b){"use strict";a.VisSense=b(a,a.document)}(this,function(a,b,c){"use strict";function d(a,b){var c=p;return function(){var d=this,e=arguments;c(),c=f(function(){a.apply(d,e)},b)}}function e(a,b){var d=o(b),e=o(a);if(!d&&!e)return b;if(!d||!e)return d?b:a;for(var f=Object.keys(b),g=0,h=f.length;h>g;g++){var i=f[g];a[i]===c&&(a[i]=b[i])}return a}function f(a,b){var c=setTimeout(function(){a()},b||0);return function(){clearTimeout(c)}}function g(a,b){return function(){var d=arguments;return f(function(){a.apply(c,d)},b||0)}}function h(a,b){return function(){return(n(a)?a():a)?b():c}}function i(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length,g=n(c);++d<f;){var h=e[d];a[h]=g?c(a[h],b[h],h,a,b):b[h]}return a}function j(a){return a}function k(a){return a!==c}function l(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"===Object.prototype.toString.call(a)||!1}function m(a){return a&&1===a.nodeType||!1}function n(a){return"function"==typeof a||!1}function o(a){var b=typeof a;return"function"===b||a&&"object"===b||!1}function p(){}function q(){return(new Date).getTime()}function r(){return{height:a.innerHeight,width:a.innerWidth}}function s(b){return a.getComputedStyle(b,null)}function t(a,b){return a.getPropertyValue(b)}function u(a,b){b||(b=s(a));var c=t(b,"display");if("none"===c)return!1;var d=t(b,"visibility");return"hidden"===d||"collapse"===d?!1:a.parentNode&&a.parentNode.style?u(a.parentNode,s(a)):!0}function v(a){if(a===b)return!0;if(!a||!a.parentNode)return!1;var c=s(a),d=u(a,c);return d!==!0?!1:!0}function w(a,b){return!a||a.width<=0||a.height<=0?!1:a.bottom>0&&a.right>0&&a.top<b.height&&a.left<b.width}function x(a){var b=a.getBoundingClientRect(),c=r();if(!w(b,c)||!v(a))return 0;var d=0,e=0;return b.top>=0?d=Math.min(b.height,c.height-b.top):b.bottom>0&&(d=Math.min(c.height,b.bottom)),b.left>=0?e=Math.min(b.width,c.width-b.left):b.right>0&&(e=Math.min(c.width,b.right)),Math.round(d*e/(b.height*b.width)*1e3)/1e3}function y(){return C?!b[C[0]]:!0}function z(a,b){if(!(this instanceof z))return new z(a,b);if(!m(a))throw new Error("not an element node");this._element=a,this._config=e(b,{fullyvisible:1,hidden:0,percentageHook:x,visibilityHooks:[]}),this._config.visibilityHooks.push(function(){return y()})}function A(a,b){var c=a.state(),d=c.percentage;return b&&d===b.percentage&&b.percentage===b.previous.percentage?b:c.hidden?z.VisState.hidden(d,b):c.fullyvisible?z.VisState.fullyvisible(d,b):z.VisState.visible(d,b)}function B(a,b){this._visobj=a,this._state={},this._pubsub=new D,this._events=["update","hidden","visible","fullyvisible","percentagechange","visibilitychange"];var c=e(b,{strategy:[new B.Strategy.PollingStrategy,new B.Strategy.EventStrategy],async:!1});this._setStrategy(c.strategy),this._pubsub.on("update",function(a){a._state.code!==a._state.previous.code&&a._pubsub.publish("visibilitychange",[a])}),this._pubsub.on("update",function(a){var b=a._state.percentage,c=a._state.previous.percentage;b!==c&&a._pubsub.publish("percentagechange",[b,c,a])}),this._pubsub.on("visibilitychange",function(a){a._state.visible&&!a._state.previous.visible&&a._pubsub.publish("visible",[a])}),this._pubsub.on("visibilitychange",function(a){a._state.fullyvisible&&a._pubsub.publish("fullyvisible",[a])}),this._pubsub.on("visibilitychange",function(a){a._state.hidden&&a._pubsub.publish("hidden",[a])});for(var d=0,f=this._events.length;f>d;d++)c[this._events[d]]&&this.on(this._events[d],c[this._events[d]])}var C=function(a){for(var c="visibilitychange",d=[["hidden",c],["mozHidden","moz"+c],["webkitHidden","webkit"+c],["msHidden","ms"+c]],e=0,f=d.length;f>e;e++)if(b[d[e][0]]!==a)return d[e]}(),D=function(a){function b(a){this._cache={},this._config=e(a,{async:!1})}return b.prototype.on=function(b,c){if(!n(c))return p;this._cache[b]||(this._cache[b]=[]);var d=function(b){return c.apply(a,b||[])},e=this._config.async?g(d):d;this._cache[b].push(e);var f=this;return function(){var a=f._cache[b].indexOf(e);return a>-1?(f._cache[b].splice(a,1),!0):!1}},b.prototype.publish=function(b,c){var d=this._cache[b],e=function(b,c){for(var d=b?b.length:0,e=0;d>e;e++)b[e](c||[]);return a};return this._config.async?g(e)(d,c):e(d,c)},b}();z.prototype.state=function(){for(var a=0,b=this._config.visibilityHooks.length;b>a;a++)if(!this._config.visibilityHooks[a](this._element))return z.VisState.hidden(0);var c=this._config.percentageHook(this._element);return c<=this._config.hidden?z.VisState.hidden(c):c>=this._config.fullyvisible?z.VisState.fullyvisible(c):z.VisState.visible(c)},z.prototype.percentage=function(){return this.state().percentage},z.prototype.isFullyVisible=function(){return this.state().fullyvisible},z.prototype.isVisible=function(){return this.state().visible},z.prototype.isHidden=function(){return this.state().hidden},z.fn=z.prototype,z.of=function(a,b){return new z(a,b)};var E={HIDDEN:[0,"hidden"],VISIBLE:[1,"visible"],FULLY_VISIBLE:[2,"fullyvisible"]};return z.VisState=function(){function a(a,b,c){return c&&delete c.previous,{code:a[0],state:a[1],percentage:b,previous:c||{},fullyvisible:a[0]===E.FULLY_VISIBLE[0],visible:a[0]===E.VISIBLE[0]||a[0]===E.FULLY_VISIBLE[0],hidden:a[0]===E.HIDDEN[0]}}return{hidden:function(b,c){return a(E.HIDDEN,b,c)},visible:function(b,c){return a(E.VISIBLE,b,c)},fullyvisible:function(b,c){return a(E.FULLY_VISIBLE,b,c)}}}(),B.prototype._setStrategy=function(a){this._strategy=new B.Strategy.CompositeStrategy(a)},B.prototype.visobj=function(){return this._visobj},B.prototype.state=function(){return this._state},B.prototype.start=function(a){var b=e(a,{async:!1});if(this._cancelAsyncStart&&this._cancelAsyncStart(),b.async)return this.startAsync();var c=function(a,b){return a.update(),b.start(a),a};return c(this,this._strategy)},B.prototype.startAsync=function(a){this._cancelAsyncStart&&this._cancelAsyncStart();var b=this,c=f(function(){b.start(i(e(a,{}),{async:!1}))});return this._cancelAsyncStart=function(){c(),b._cancelAsyncStart=null},this},B.prototype.stop=function(){return this._cancelAsyncStart?this._cancelAsyncStart():this._strategy.stop(this),c},B.prototype.use=function(a){return this.stop(),this._setStrategy(a),this.start()},B.prototype.update=function(){this._state=A(this._visobj,this._state),this._pubsub.publish("update",[this])},B.prototype.onUpdate=function(a){return this._pubsub.on("update",a)},B.prototype.onVisibilityChange=function(a){return this._pubsub.on("visibilitychange",a)},B.prototype.onPercentageChange=function(a){return this._pubsub.on("percentagechange",a)},B.prototype.onVisible=function(a){return this._pubsub.on("visible",a)},B.prototype.onFullyVisible=function(a){return this._pubsub.on("fullyvisible",a)},B.prototype.onHidden=function(a){return this._pubsub.on("hidden",a)},B.prototype.on=function(a,b){var c=this;switch(a){case"update":return c.onUpdate(b);case"hidden":return c.onHidden(b);case"visible":return c.onVisible(b);case"fullyvisible":return c.onFullyVisible(b);case"percentagechange":return c.onPercentageChange(b);case"visibilitychange":return c.onVisibilityChange(b)}return this._pubsub.on(a,b)},B.Strategy=function(){},B.Strategy.prototype.start=function(){throw new Error("Strategy#start needs to be overridden.")},B.Strategy.prototype.stop=function(){throw new Error("Strategy#stop needs to be overridden.")},B.Strategy.CompositeStrategy=function(a){this._strategies=l(a)?a:[a]},B.Strategy.CompositeStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.CompositeStrategy.prototype.start=function(a){for(var b=0,c=this._strategies.length;c>b;b++)this._strategies[b].start(a)},B.Strategy.CompositeStrategy.prototype.stop=function(a){for(var b=0,c=this._strategies.length;c>b;b++)this._strategies[b].stop(a)},B.Strategy.PollingStrategy=function(a){this._config=e(a,{interval:1e3}),this._started=!1},B.Strategy.PollingStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.PollingStrategy.prototype.start=function(a){return this._started||(this._clearInterval=function(b){var c=setInterval(function(){a.update()},b);return function(){clearInterval(c)}}(this._config.interval),this._started=!0),this._started},B.Strategy.PollingStrategy.prototype.stop=function(){return this._started?(this._clearInterval(),this._started=!1,!0):!1},B.Strategy.EventStrategy=function(a){this._config=e(a,{debounce:50}),this._started=!1},B.Strategy.EventStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.EventStrategy.prototype.start=function(a){if(!this._started){var b=this;this._removeEventListeners=function(){var c=d(function(){a.update()},b._config.debounce);return C&&addEventListener(C[1],c),addEventListener("scroll",c),addEventListener("resize",c),function(){removeEventListener("resize",c),removeEventListener("scroll",c),C&&removeEventListener(C[1],c)}}(),this._started=!0}return this._started},B.Strategy.EventStrategy.prototype.stop=function(){return this._started?(this._removeEventListeners(),this._started=!1,!0):!1},z.VisMon=B,z.PubSub=D,z.fn.monitor=function(a){return new B(this,a)},z.Utils={async:g,debounce:d,defaults:e,defer:f,extend:i,fireIf:h,identity:j,isArray:l,isDefined:k,isElement:m,isFunction:n,isObject:o,isPageVisible:y,isVisibleByStyling:v,noop:p,now:q,percentage:x,_viewport:r,_isInViewport:w,_isDisplayed:u,_computedStyle:s,_styleProperty:t},z});