/*!
 * crosstab JavaScript Library v0.2.0
 * https://github.com/tejacques/crosstab
 *
 * License: Apache 2.0 https://github.com/tejacques/crosstab/blob/master/LICENSE
 */
;(function(a){a(function(g,H,f){var I=navigator.userAgent||navigator.vendor||window.opera;window.isMobile=(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(I)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(I.substr(0,4)));var z;try{z=window.localStorage}catch(M){}var w=false;function v(){var e="crosstab not supported";var N=[];if(!z){N.push("localStorage not availabe")}if(!window.addEventListener){N.push("addEventListener not available")}if(window.isMobile){N.push("mobile browser")}if(w){N.push("frozen tab environment detected")}if(N.length>0){e+=": "+N.join(", ")}throw new Error(e)}var n={keys:{MESSAGE_KEY:"crosstab.MESSAGE_KEY",TABS_KEY:"crosstab.TABS_KEY",MASTER_TAB:"MASTER_TAB",SUPPORTED_KEY:"crosstab.SUPPORTED",FROZEN_TAB_ENVIRONMENT:"crosstab.FROZEN_TAB_ENVIRONMENT"}};n.forEachObj=function(e,O){for(var N in e){if(e.hasOwnProperty(N)){O.call(e,e[N],N)}}};n.forEachArr=function(e,O){for(var N=0;N<e.length;N++){O.call(e,e[N],N)}};n.forEach=function(e,N){if(Object.prototype.toString.call(e)==="[object Array]"){n.forEachArr(e,N)}else{n.forEachObj(e,N)}};n.map=function(e,O){var N=[];n.forEach(e,function(P){N.push(O(P))});return N};n.filter=function(e,O){var P=Object.prototype.toString.call(e)==="[object Array]";var N=P?[]:{};if(P){n.forEachArr(e,function(R,Q){if(O(R,Q)){N.push(R)}})}else{n.forEachObj(e,function(R,Q){if(O(R,Q)){N[Q]=R}})}return N};n.now=function(){return(new Date()).getTime()};n.tabs=D();n.eventTypes={becomeMaster:"becomeMaster",tabUpdated:"tabUpdated",tabClosed:"tabClosed",tabPromoted:"tabPromoted"};n.createEventHandler=function(){var O={};var N=function(V,W,U){U=U||W;var T=P(V);T[U]=W;return U};var S=function(U,T){if(O[U]&&O[U][T]){delete O[U][T];return true}return false};var R=function(T){if(T){if(O[T]){delete O[T]}}else{O={}}};var e=function(V){var U=Array.prototype.slice.call(arguments,1);var T=P(V);n.forEach(T,function(W){if(typeof(W)==="function"){W.apply(this,U)}})};var Q=function(V,W,U){var T=P(V);while(!U||T[U]){U=n.generateId()}N(V,function(){S(V,U);var X=Array.prototype.slice.call(arguments);W.apply(this,X)},U);return U};var P=function(U){var T=O[U]=O[U]||{};return T};return{addListener:N,on:N,off:S,once:Q,emit:e,listeners:P,removeListener:S,removeAllListeners:R}};var s=n.createEventHandler();n.events={addListener:s.addListener,on:s.on,off:s.off,once:s.once,emit:s.emit,listeners:s.listeners,removeListener:s.removeListener,removeAllListeners:s.removeAllListeners};function E(O){var Q;try{Q=O.newValue?JSON.parse(O.newValue):{}}catch(P){Q={}}if(!Q.id||Q.id===L.id){return}if(O.key===n.keys.MESSAGE_KEY){var N=Q.data;if(!N.destination||N.destination===L.id){s.emit(N.event,N)}}}function h(e,O){var N={id:L.id,data:O,timestamp:n.now()};z.setItem(e,JSON.stringify(N))}function l(e){var N=d(e);return N.data}function d(N){var e=z?z.getItem(N):null;var O=e?JSON.parse(e):{};return O}function i(){var e=0;n.forEach(n.tabs,function(O,N){if(N!==n.keys.MASTER_TAB){e++}});if(e===1){n.tabs={};k()}else{q(n.eventTypes.tabClosed,L.id)}}function K(){return n.tabs[n.keys.MASTER_TAB]}function b(e){n.tabs[n.keys.MASTER_TAB]=e}function y(){delete n.tabs[n.keys.MASTER_TAB]}function p(){return K().id===L.id}function C(){var e=null;n.forEach(n.tabs,function(N){if(!e||N.id<e){e=N.id}});if(e===L.id){q(n.eventTypes.tabPromoted,L.id)}else{b({id:e,lastUpdated:n.now()})}}s.addListener(n.eventTypes.tabClosed,function(e){var N=e.data;if(n.tabs[N]){delete n.tabs[N]}if(!K()||K().id===N){if(K()){y()}C()}else{if(K().id===L.id){k()}}});s.addListener(n.eventTypes.tabUpdated,function(N){var e=N.data;n.tabs[e.id]=e;if(!K()){C()}if(K().id===e.id){b(e)}if(K().id===L.id){k()}});s.addListener(n.eventTypes.tabPromoted,function(e){var O=e.data;var N=e.timestamp;b({id:O,lastUpdated:N});if(L.id===O){k();n.events.emit(n.eventTypes.becomeMaster)}});function r(e,N,P){P=P||"0";var O=(e.toString());if(O.length>=N){return O}return new Array(N-O.length+1).join(P)+O}n.generateId=function(){return n.now().toString()+r((Math.random()*2147483647)|0,10)};function q(O,P,e){if(!L.supported){v()}var N={event:O,data:P,destination:e,origin:L.id,timestamp:n.now()};if(N.destination!==N.origin){h(n.keys.MESSAGE_KEY,N)}if(!N.destination||N.destination===N.origin){s.emit(O,N)}}function F(e,N){q(e,N,K().id)}var x=false;n.events.once("setupComplete",function(){x=true});var L=function(e){if(x){e()}else{n.events.once("setupComplete",e)}};L.id=n.generateId();L.supported=!!z&&window.addEventListener&&!window.isMobile;L.util=n;L.broadcast=q;L.broadcastMaster=F;L.on=n.events.on;L.once=n.events.once;if(!x&&L.supported){var J=d(n.keys.SUPPORTED_KEY);var m=J.data;if(m===false||m===true){L.supported=m;n.events.emit("setupComplete")}}if(!x&&L.supported){var B=d(n.keys.FROZEN_TAB_ENVIRONMENT);var G=B.data;if(G===true){t();n.events.emit("setupComplete")}}function t(){L.supported=false;w=true;h(n.keys.FROZEN_TAB_ENVIRONMENT,true);h(n.keys.SUPPORTED_KEY,false)}var u=3*1000;var j=5*1000;var o=100;function D(){var e=l(n.keys.TABS_KEY);n.tabs=e||n.tabs||{};return n.tabs}function k(){h(n.keys.TABS_KEY,n.tabs)}function A(){var O=n.now();var P={id:L.id,lastUpdated:O};q(n.eventTypes.tabUpdated,P);function V(W){return O-W.lastUpdated<j}function S(X,W){return W!==n.keys.MASTER_TAB&&!V(X)}var e=n.filter(n.tabs,S);n.forEach(e,function(W){q(n.eventTypes.tabClosed,W.id)});if(!x){var T=L.util.tabs[L.util.keys.MASTER_TAB];if(T&&T.id!==P.id){var U;var N;L.util.events.once("PONG",function(){if(!x){clearTimeout(U);h(n.keys.SUPPORTED_KEY,true);h(n.keys.FROZEN_TAB_ENVIRONMENT,false);n.events.emit("setupComplete")}});N=n.now();var R=function(W){var X=n.now()-N;if(!x){if(W<=0&&X>o){t();n.events.emit("setupComplete")}else{U=setTimeout(function(){R(W-1)},5)}}};var Q=5;U=setTimeout(function(){R(5)},o-5*Q);L.broadcastMaster("PING")}else{if(T&&T.id===P.id){n.events.emit("setupComplete")}}}}function c(){if(!L.stopKeepalive){A();window.setTimeout(c,u)}}if(!L.supported){L.broadcast=v}else{window.addEventListener("storage",E,false);window.addEventListener("beforeunload",i,false);n.events.on("PING",function(e){if(!e.destination||e.destination!==L.id){return}if(n.now()-e.timestamp<o){L.broadcast("PONG",null,e.origin)}});c()}f.exports=L;
/*!
 * UMD/AMD/Global context Module Loader wrapper
 * based off https://gist.github.com/wilsonpage/8598603
 *
 * This wrapper will try to use a module loader with the
 * following priority:
 *
 *  1.) AMD
 *  2.) CommonJS
 *  3.) Context Variable (window in the browser)
 */
})})(typeof define=="function"&&define.amd?define:(function(a,b){return typeof module=="object"?function(c){c(require,exports,module)}:function(e){var d={exports:{}};var c=function(f){return b[f]};e(c,d.exports,d);b[a]=d.exports}})("crosstab",this));