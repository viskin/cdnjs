!function(e,n){"use strict";function t(){this.config=p,this.facebook=function(e){n.extend(d.facebook,e)},this.google=function(e){n.extend(d.google,e)},this.linkedin=function(e){n.extend(d.linkedin,e)},this.twitter=function(e){n.extend(d.twitter,e)},this.oauth2=function(e){d[e.name]=d[e.name]||{},d[e.name].type="2.0",n.extend(d[e.name],e)},this.oauth1=function(e){d[e.name]=d[e.name]||{},d[e.name].type="1.0",n.extend(d[e.name],e)},this.setProvider=function(e){n.extend(d[e.name],e)},this.addProvider=function(e){d[e.name]={},n.extend(d[e.name],e)},this.getProvider=function(e){return d[e]},this.$get=function(e,n,t,o,r){var i={};return i.authenticate=function(n){var i=e.defer(),u="1.0"===d[n].type?t:o;return u.open(d[n]).then(function(e){r.parseUser(e.token,i)}),i.promise},i.login=function(e){r.login(e)},i.signup=function(e){r.signup(e)},i.logout=function(){r.logout()},i.isAuthenticated=function(){r.isAuthenticated()},i}}function o(e,n,t,o,r){var i={};return i.parseUser=function(e,n){var i=JSON.parse(t.atob(e.split(".")[1]));t.localStorage.jwtToken=e,o[p.user]=i.user,r.path(p.loginRedirect),n.resolve(i.user)},i.login=function(t){var o=e.defer();return n.post(p.loginUrl,t).success(function(e){i.parseUser(e.token,o)}).error(function(e){o.reject(e)}),o.promise},i.signup=function(e){n.post(p.signupUrl,e).then(function(){r.path(p.signupRedirect)})},i.logout=function(){delete o[p.user],delete t.localStorage.jwtToken,r.path(p.logoutRedirect)},i.isAuthenticated=function(){return Boolean(o.currentUser)},i}function r(e,t,o){var r=null,i=null,u={};return u.popupWindow=r,u.open=function(n,t){var i=e.defer(),a=u.stringifyOptions(u.prepareOptions(t));return r=o.open(n,"Satellizer",a),r.focus(),u.postMessageHandler(i),u.pollPopup(i),i.promise},u.pollPopup=function(e){i=t(function(){r.closed&&(t.cancel(i),e.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(n){n.origin===o.location.origin&&e.resolve(n.data)},!1)},u.prepareOptions=function(e){e=e||{};var t=e.width||500,r=e.height||500,i={width:t,height:r,left:o.screenX+(o.outerWidth-t)/2,top:o.screenY+(o.outerHeight-r)/2.5};return n.extend(i,e)},u.stringifyOptions=function(e){var t=[];return n.forEach(e,function(e,n){t.push(n+"="+e)}),t.join(",")},u}function i(e,t,o,r){var i={url:null,name:null,popupOptions:null},u={};return u.open=function(t){n.extend(i,t);var r=e.defer();return o.open(i.url).then(function(e){u.exchangeForToken(e).then(function(e){r.resolve(e.data)})}),r.promise},u.exchangeForToken=function(e){return e=r.buildQueryString(e),t.get(i.url+"?"+e)},u}function u(e,t,o,r){var i={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(t){n.extend(i,t);var o=e.defer(),a=u.buildUrl();return r.open(a,i.popupOptions).then(function(e){u.exchangeForToken(e).then(function(e){o.resolve(e.data)})}),o.promise},u.exchangeForToken=function(e){return t.post(i.url,{code:e.code,clientId:i.clientId,redirectUri:i.redirectUri})},u.buildUrl=function(){var e=i.authorizationEndpoint,n=u.buildQueryString();return[e,n].join("?")},u.buildQueryString=function(){var e=[],t=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return n.forEach(t,function(t){n.forEach(i[t],function(n){var t=o.camelCase(n),r=i[t];e.push([n,encodeURIComponent(r)])})}),e.map(function(e){return e.join("=")}).join("&")},u}function a(e){e.interceptors.push(function(e,n,t){return{request:function(e){return n.localStorage.jwtToken&&(e.headers.Authorization="Bearer "+n.localStorage.jwtToken),e},responseError:function(o){return(401===o.status||403===o.status)&&(delete n.localStorage.jwtToken,t.path("/login")),e.reject(o)}}})}function c(e){e.run()}function l(e,n,t,o){return{run:function(){var r=n.localStorage.jwtToken;if(r){var i=JSON.parse(n.atob(r.split(".")[1]));e.currentUser=i.user}var u=n.location.search.substring(1),a=Object.keys(t.search()).length?t.search():o.parseQueryString(u);n.opener&&n.opener.location.origin===n.location.origin&&(a.oauth_token&&a.oauth_verifier?n.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&n.opener.postMessage({code:a.code},"*"),n.close())}}}function s(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,n,t,o){return o?t.toUpperCase():t})},this.parseQueryString=function(e){var t,o,r={};return n.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),t=decodeURIComponent(o[0]),r[t]=n.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),r},this.buildQueryString=function(e){var t=[];for(var o in e){var r=o,i=e[r];t.push(n.isObject(i)?this.buildQueryString(i,r):r+"="+encodeURIComponent(i))}return t.join("&")}}n.module("Satellizer",[]).provider("$auth",t).factory("RunBlock",l).factory("Local",o).factory("Oauth2",u).factory("Oauth1",i).factory("Popup",r).service("Utils",s).config(a).run(c);var p={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},d={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{url:"/auth/twitter",type:"1.0"}};o.$inject=["$q","$http","$window","$rootScope","$location"],r.$inject=["$q","$interval","$window"],i.$inject=["$q","$http","Popup","Utils"],u.$inject=["$q","$http","Utils","Popup"],a.$inject=["$httpProvider"],c.$inject=["RunBlock"],l.$inject=["$rootScope","$window","$location","Utils"]}(window,window.angular);