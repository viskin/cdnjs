!function(t,e){"use strict";var n={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},o={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:t.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:t.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:t.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:t.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}};e.module("Satellizer",[]).provider("$auth",function(){this.config=n,this.providers=o,this.facebook=function(t){e.extend(o.facebook,t)},this.google=function(t){e.extend(o.google,t)},this.linkedin=function(t){e.extend(o.linkedin,t)},this.github=function(t){e.extend(o.github,t)},this.twitter=function(t){e.extend(o.twitter,t)},this.oauthBase=function(t){o[t.name]=o[t.name]||{},e.extend(o[t.name],t)},this.oauth1=function(t){this.oauthBase(t),o[t.name].type="1.0"},this.oauth2=function(t){this.oauthBase(t),o[t.name].type="2.0"},this.$get=["$q","Oauth1","Oauth2","Local",function(t,e,n,i){var r={};return r.authenticate=function(r){var u=t.defer(),a="1.0"===o[r].type?e:n;return a.open(o[r]).then(function(t){i.parseUser(t.token,u)}).catch(function(t){u.reject(t)}),u.promise},r.login=function(t){return i.login(t)},r.signup=function(t){i.signup(t)},r.logout=function(){i.logout()},r.isAuthenticated=function(){i.isAuthenticated()},r}]}).factory("Local",["$q","$http","$rootScope","$location",function(e,o,i,r){var u={};return u.parseUser=function(e,o){var u=JSON.parse(t.atob(e.split(".")[1]));localStorage.setItem("jwtToken",e),i[n.user]=u.user,r.path(n.loginRedirect),o.resolve(u.user)},u.login=function(t){var i=e.defer();return o.post(n.loginUrl,t).then(function(t){u.parseUser(t.data.token,i)}).catch(function(t){i.reject(t)}),i.promise},u.signup=function(t){var i=e.defer();return o.post(n.signupUrl,t).then(function(){r.path(n.signupRedirect),i.resolve()}).catch(function(t){i.reject(t)}),i.promise},u.logout=function(){delete i[n.user],localStorage.removeItem("jwtToken"),r.path(n.logoutRedirect)},u.isAuthenticated=function(){return Boolean(i.currentUser)},u}]).factory("Oauth2",["$q","$http","Utils","Popup",function(t,n,o,i){var r={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(n){e.extend(r,n);var o=t.defer(),a=u.buildUrl();return i.open(a,r.popupOptions).then(function(t){u.exchangeForToken(t).then(function(t){o.resolve(t.data)}).catch(function(t){o.reject(t)})}),o.promise},u.exchangeForToken=function(t){return n.post(r.url,{code:t.code,clientId:r.clientId,redirectUri:r.redirectUri})},u.buildUrl=function(){var t=r.authorizationEndpoint,e=u.buildQueryString();return[t,e].join("?")},u.buildQueryString=function(){var t=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return e.forEach(n,function(n){e.forEach(r[n],function(e){var n=o.camelCase(e),i=r[n];t.push([e,encodeURIComponent(i)])})}),t.map(function(t){return t.join("=")}).join("&")},u}]).factory("Oauth1",["$q","$http","Popup",function(t,n,o){var i={url:null,name:null,popupOptions:null},r={};return r.open=function(n){e.extend(i,n);var u=t.defer();return o.open(i.url).then(function(t){r.exchangeForToken(t).then(function(t){u.resolve(t.data)})}),u.promise},r.exchangeForToken=function(t){return t=r.buildQueryString(t),n.get(i.url+"?"+t)},r.buildQueryString=function(t){var n=[];return e.forEach(t,function(t,e){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),n.join("&")},r}]).factory("Popup",["$q","$interval","$window",function(t,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(e,n){var r=t.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(e,"Satellizer",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(t){r=n(function(){i.closed&&(n.cancel(r),t.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(t){o.addEventListener("message",function(e){e.origin===o.location.origin&&t.resolve(e.data)},!1)},u.prepareOptions=function(t){var n=t.width||500,i=t.height||500;return e.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},t)},u.stringifyOptions=function(t){var n=[];return e.forEach(t,function(t,e){n.push(e+"="+t)}),n.join(",")},u}]).factory("RunBlock",["$rootScope","$window","$location","Utils",function(t,e,n,o){return{run:function(){var i=e.localStorage.jwtToken;if(i){var r=JSON.parse(e.atob(i.split(".")[1]));t.currentUser=r.user}var u=e.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);e.opener&&e.opener.location.origin===e.location.origin&&(a.oauth_token&&a.oauth_verifier?e.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&e.opener.postMessage({code:a.code},"*"),e.close())}}}]).service("Utils",function(){this.camelCase=function(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(t){var n,o,i={};return e.forEach((t||"").split("&"),function(t){t&&(o=t.split("="),n=decodeURIComponent(o[0]),i[n]=e.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}).config(["$httpProvider",function(t){t.interceptors.push(["$q","$window","$location",function(t,e,n){return{request:function(t){return e.localStorage.jwtToken&&(t.headers.Authorization="Bearer "+e.localStorage.jwtToken),t},responseError:function(o){return(401===o.status||403===o.status)&&(delete e.localStorage.jwtToken,n.path("/login")),t.reject(o)}}}])}]).run(["RunBlock",function(t){t.run()}])}(window,window.angular);