(function(){var f={};var a,e;a=this;if(a!=null){e=a.upb}f.noConflict=function(){a.upb=e;return f};function c(g){var h=false;return function(){if(h){throw new Error("Callback was already called.")}h=true;g.apply(a,arguments)}}function d(i,g,h){h=h||"0";i=i+"";return i.length>=g?i:new Array(g-i.length+1).join(h)+i}function b(g,j){var h=g.length;while(h--){if(g[h]===j){return true}}return false}f.validCommands=["20","activate","21","deactivate","22","goto","23","fadeStart","24","fadeStop","25","blink","26","indicate","27","toggle","30","reportState","31","storeState","80","ackResponse","85","setupTimeReport","86","deviceStateReport","87","deviceStatusReport","8F","deviceSignatureReport","90","registerValuesReport","91","RAMvaluesReport","92","rawDataReport","93","heartbeatReport"];f.defaultCommand={source:255,sendx:1,sendTime:1,ackPulse:false,idPulse:false,ackMsg:false,powerlineRepeater:0};f.generateChecksum=function(h){var g=parseInt(h.hex.ctrlWord.fullByte1.slice(0,2),16);g+=parseInt(h.hex.ctrlWord.fullByte2.slice(0,2),16);g+=parseInt(h.hex.network.slice(0,2),16);g+=parseInt(h.hex.id.slice(0,2),16);g+=parseInt(h.hex.source.slice(0,2),16);g+=parseInt(h.hex.msg.slice(0,2),16);if(h.hex.level){g+=parseInt(h.hex.level.slice(0,2),16)}if(h.hex.rate){g+=parseInt(h.hex.rate.slice(0,2),16)}if(h.hex.blinkRate){g+=parseInt(h.hex.blinkRate.slice(0,2),16)}if(h.hex.toggleCount){g+=parseInt(h.hex.toggleCount.slice(0,2),16)}if(h.hex.toggleRate){g+=parseInt(h.hex.toggleRate.slice(0,2),16)}if(h.hex.channel){g+=parseInt(h.hex.channel.slice(0,2),16)}g=parseInt((~g+1>>>0)).toString(16);g=g.substr(g.length-2);return g};f.generate=function(h,g){if(!h.network){g(null,new Error("No network id specified!"))}if(!h.id){g(null,new Error("No link or device id specified!"))}if(!h.type){g(null,new Error("No id type specified!"))}if(!h.cmd){g(null,new Error("No command specified!"))}if(!b(f.validCommands,(String(h.cmd)))||h.cmd=="1"){g(null,new Error("Invalid command specified! Please us the correct command name or number."))}if(h.powerlineRepeater&&!(h.powerlineRepeater==1||h.powerlineRepeater==2||h.powerlineRepeater==4||h.powerlineRepeater=="false")){g(null,new Error("Power line repeater argument only accepts 1, 2, 4, or false!"))}if(h.level>100||h.level<0){g(null,new Error("Level can only be values 0 through 100! Inequality: -1 < L < 101 where variable 'L' is level."))}if(h.sendTime&&h.sendTime>h.sendx){g(null,new Error("Number of time sent (sendTime) cannot be greater than total number of times sent (sendx)!"))}if(!h.source){h.source=255}h.ctrlWord={};h.ctrlWord.byte1=0;h.ctrlWord.byte2=0;h.words=7;h.ctrlWord.byte3=0;h.ctrlWord.byte4=0;h.hex={};h.hex.network=parseInt(h.network).toString(16);h.hex.id=parseInt(h.id).toString(16);h.hex.source=parseInt(h.source).toString(16);if(h.cmd==20||h.cmd=="activate"){h.cmd="activate";h.msg=20}else{if(h.cmd==21||h.cmd=="deactivate"){h.msg=21;h.cmd="deactivate"}else{if(h.cmd==22||h.cmd=="goto"){h.msg=22;h.cmd="goto"}else{if(h.cmd==23||h.cmd=="fadeStart"){h.msg=23;h.cmd="fadeStart"}else{if(h.cmd==24||h.cmd=="fadeStop"){h.msg=24;h.cmd="fadeStop"}else{if(h.cmd==25||h.cmd=="blink"){h.msg=25;h.cmd="blink"}else{if(h.cmd==26||h.cmd=="indicate"){h.msg=26;h.cmd="indicate"}else{if(h.cmd==27||h.cmd=="toggle"){h.msg=27;h.cmd="toggle"}else{if(h.cmd==30||h.cmd=="reportState"){h.msg=30;h.cmd="reportState"}else{if(h.cmd==31||h.cmd=="storeState"){h.msg=31;h.cmd="storeState"}else{if(h.cmd==80||h.cmd=="ackResponse"){h.msg=80;h.cmd="ackResponse"}else{if(h.cmd==85||h.cmd=="setupTimeReport"){h.msg=85;h.cmd="setupTimeReport"}else{if(h.cmd==86||h.cmd=="deviceStateReport"){h.msg=86;h.cmd="deviceStateReport"}else{if(h.cmd==87||h.cmd=="deviceStatusReport"){h.msg=87;h.cmd="deviceStatusReport"}else{if(h.cmd=="8F"||h.cmd=="deviceSignatureReport"){h.msg="8F";h.cmd="deviceSignatureReport"}else{if(h.cmd==90||h.cmd=="registerValuesReport"){h.msg=90;h.cmd="registerValuesReport"}else{if(h.cmd==91||h.cmd=="RAMvaluesReport"){h.msg=91;h.cmd="RAMvaluesReport"}else{if(h.cmd==92||h.cmd=="rawDataReport"){h.msg=92;h.cmd="rawDataReport"}else{if(h.cmd==93||h.cmd=="heartbeatReport"){h.msg=93;h.cmd="heartbeatReport"}}}}}}}}}}}}}}}}}}}h.hex.msg=parseInt(h.msg,16).toString(16);if((h.cmd=="goto"||h.cmd=="fadeStart"||h.cmd=="deviceStateReport")&&!h.level){g(null,new Error("No level specified! A level must be specified with goto, fadeStart, and deviceStateReport."))}if(h.cmd=="blink"&&!h.blinkRate){g(null,new Error("No blink rate specified!"))}if(h.cmd=="toggle"&&!h.toggleCount){g(null,new Error("No toggle count specified!"))}if(h.level&&(h.cmd=="goto"||h.cmd=="fadeStart"||h.cmd=="fadeStop"||h.cmd=="indicate")){h.words++;h.hex.level=parseInt(h.level).toString(16)}if(h.rate&&h.level&&(h.cmd=="goto"||h.cmd=="fadeStart"||h.cmd=="indicate")){h.words++;h.hex.rate=parseInt(h.rate).toString(16)}if(h.cmd=="blink"){h.words++;h.hex.blinkRate=parseInt(h.blinkRate).toString(16)}if(h.cmd=="toggle"){h.words++;h.hex.toggleCount=parseInt(h.toggleCount).toString(16)}if(h.toggleRate&&h.cmd=="toggle"){h.words++;h.hex.toggleRate=parseInt(h.toggleRate).toString(16)}if(h.channel&&h.type=="device"&&h.rate&&(h.cmd=="goto"||h.cmd=="fadeStart"||h.cmd=="blink"||h.cmd=="toggle"||h.cmd=="indicate")){h.words++;h.hex.channel=parseInt(h.channel).toString(16)}if(h.type=="link"){h.ctrlWord.byte1+=8}if(h.powerlineRepeater==1){h.ctrlWord.byte1+=2}else{if(h.powerlineRepeater==2){h.ctrlWord.byte1+=4}else{if(h.powerlineRepeater==4){h.ctrlWord.byte1+=6}}}h.ctrlWord.byte2=h.words;if(h.ackPulse==true){h.ctrlWord.byte3+=1}if(h.idPulse==true){h.ctrlWord.byte3+=2}if(h.ackMsg==true){h.ctrlWord.byte3+=4}if(h.sendx==2){h.ctrlWord.byte4+=4}else{if(h.sendx==3){h.ctrlWord.byte4+=8}else{if(h.sendx==4){h.ctrlWord.byte4+=12}}}if(h.sendTime==2){h.ctrlWord.byte4+=1}else{if(h.sendTime==3){h.ctrlWord.byte4+=2}else{if(h.sendTime==4){h.ctrlWord.byte4+=3}}}h.hex.ctrlWord={};h.hex.ctrlWord.byte1=parseInt(h.ctrlWord.byte1).toString(16);h.hex.ctrlWord.byte2=parseInt(h.words).toString(16);h.hex.ctrlWord.byte3=parseInt(h.ctrlWord.byte3).toString(16);h.hex.ctrlWord.byte4=parseInt(h.ctrlWord.byte4).toString(16);h.hex.ctrlWord.fullByte1=h.hex.ctrlWord.byte1+h.hex.ctrlWord.byte2;h.hex.ctrlWord.fullByte2=h.hex.ctrlWord.byte3+h.hex.ctrlWord.byte4;h.generated=h.hex.ctrlWord.fullByte1;h.generated+=h.hex.ctrlWord.fullByte2;h.generated+=d(h.hex.network,2,0);h.generated+=d(h.hex.id,2,0);h.generated+=d(h.hex.source,2,0);h.generated+=d(h.msg,2,0);if(h.hex.level){h.generated+=d(h.hex.level,2,0)}if(h.hex.rate){h.generated+=d(h.hex.rate,2,0)}if(h.hex.blinkRate){h.generated+=d(h.hex.blinkRate,2,0)}if(h.hex.toggleCount){h.generated+=d(h.hex.toggleCount,2,0)}if(h.hex.toggleRate){h.generated+=d(h.hex.toggleRate,2,0)}if(h.hex.channel){h.generated+=d(h.hex.channel,2,0)}h.checksum=f.generateChecksum(h);h.generated+=d(h.checksum,2,0);h.generated=h.generated.toUpperCase();g(h,null)};f.decode=function(h,g){command=f.defaultCommand;command.hex={};command.generated=h.toUpperCase();command.hex.ctrlWord={};command.hex.ctrlWord.fullByte1=command.generated.substring(0,2).toString(16);command.hex.ctrlWord.fullByte2=command.generated.substring(2,4).toString(16);command.hex.ctrlWord.byte1=command.generated.substring(0,1).toString(16);command.hex.ctrlWord.byte2=command.generated.substring(1,2).toString(16);command.hex.ctrlWord.byte3=command.generated.substring(2,3).toString(16);command.hex.ctrlWord.byte4=command.generated.substring(3,4).toString(16);command.ctrlWord={};command.ctrlWord.byte1=parseInt(command.hex.ctrlWord.byte1,16);command.ctrlWord.byte2=parseInt(command.hex.ctrlWord.byte2,16);command.ctrlWord.byte3=parseInt(command.hex.ctrlWord.byte3,16);command.ctrlWord.byte4=parseInt(command.hex.ctrlWord.byte4,16);if(command.ctrlWord.byte1>=8){command.type="link";command.powerlineRepeater=command.ctrlWord.byte1-8}else{command.type="device";command.powerlineRepeater=command.ctrlWord.byte1}if(command.powerlineRepeater==0){command.powerlineRepeater=0}else{if(command.powerlineRepeater==2){command.powerlineRepeater=1}else{if(command.powerlineRepeater==4){command.powerlineRepeater=2}else{if(command.powerlineRepeater==6){command.powerlineRepeater=4}else{g(null,new Error("Invalid command! Powerline repeater argument can only be 1, 2, or 4 which translates into 2, 4, or 6."))}}}}command.words=command.ctrlWord.byte2;if(command.generated.length/2!=command.words){g(null,new Error("Invalid command! Word count doesn't add up.'"))}if(command.ctrlWord.byte3==1){command.ackPulse=true}if(command.ctrlWord.byte3==2){command.idPulse=true}if(command.ctrlWord.byte3==3){command.ackPulse=true;command.idPulse=true}if(command.ctrlWord.byte3==4){command.ackMsg=true}if(command.ctrlWord.byte3==5){command.ackPulse=true;command.ackMsg=true}if(command.ctrlWord.byte3==6){command.idPulse=true;command.ackMsg=true}if(command.ctrlWord.byte3==7){command.ackPulse=true;command.idPulse=true;command.ackMsg=true}if(command.ctrlWord.byte3>7){g(null,new Error("Invalid command! Any number greater than seven cannot be an Acknowledge Pulse, ID Pulse, or Acknowledge Message."))}if(command.ctrlWord.byte4==0){command.sendx=1;command.sendTime=1}else{if(command.ctrlWord.byte4==4){command.sendx=2;command.sendTime=1}else{if(command.ctrlWord.byte4==5){command.sendx=2;command.sendTime=2}else{if(command.ctrlWord.byte4==8){command.sendx=3;command.sendTime=1}else{if(command.ctrlWord.byte4==9){command.sendx=3;command.sendTime=2}else{if(command.ctrlWord.byte4==10){command.sendx=3;command.sendTime=3}else{if(command.ctrlWord.byte4==12){command.sendx=4;command.sendTime=1}else{if(command.ctrlWord.byte4==12){command.sendx=4;command.sendTime=2}else{if(command.ctrlWord.byte4==13){command.sendx=4;command.sendTime=3}else{if(command.ctrlWord.byte4==14){command.sendx=4;command.sendTime=4}else{g(null,new Error("Invalid command! Send time is greater than total sent times."))}}}}}}}}}}command.hex.network=command.generated.substring(4,6).toString(16);command.network=parseInt(command.hex.network,16);command.hex.id=command.generated.substring(6,8).toString(16);command.id=parseInt(command.hex.id,16);command.hex.source=command.generated.substring(8,10).toString(16);command.source=parseInt(command.hex.source,16);command.msg=command.generated.substring(10,12).toString(16);if(command.msg==20){command.cmd="activate"}else{if(command.msg==21){command.cmd="deactivate"}else{if(command.msg==22){command.cmd="goto"}else{if(command.msg==23){command.cmd="fadeStart"}else{if(command.msg==24){command.cmd="fadeStop"}else{if(command.msg==25){command.cmd="blink"}else{if(command.msg==26){command.cmd="indicate"}else{if(command.msg==27){command.cmd="toggle"}else{if(command.msg==30){command.cmd="reportState"}else{if(command.msg==31){command.cmd="storeState"}else{if(command.msg==80){command.cmd="ackResponse"}else{if(command.msg==85){command.cmd="setupTimeReport"}else{if(command.msg==86){command.cmd="deviceStateReport"}else{if(command.msg==87){command.cmd="deviceStatusReport"}else{if(command.msg=="8F"){command.cmd="deviceSignatureReport"}else{if(command.msg==90){command.cmd="registerValuesReport"}else{if(command.msg==91){command.cmd="RAMvaluesReport"}else{if(command.msg==92){command.cmd="rawDataReport"}else{if(command.msg==93){command.cmd="heartbeatReport"}else{calbackFinal(null,"An unknown command was specified!")}}}}}}}}}}}}}}}}}}}command.hex.msg=parseInt(command.msg,16).toString(16);command.checksum=command.generated.slice(-2).toString(16);if(command.words>7&&command.checksum!=String(command.generated.substring(12,14))&&(command.cmd=="goto"||command.cmd=="fadeStart"||command.cmd=="fadeStop"||command.cmd=="deviceStateReport"||command.cmd=="indicate")){command.hex.level=command.generated.substring(12,14).toString(16);command.level=parseInt(command.hex.level,16)}if(command.words>8&&command.checksum!=String(command.generated.substring(12,14))&&command.level&&(command.cmd=="goto"||command.cmd=="fadeStart"||command.cmd=="indicate")){command.hex.rate=command.generated.substring(14,16).toString(16);command.rate=parseInt(command.hex.rate,16)}if(command.words>7&&command.cmd=="blink"){command.hex.blinkRate=command.generated.substring(12,14).toString(16);command.blinkRate=parseInt(command.hex.blinkRate,16)}if(command.words>7&&command.cmd=="toggle"){command.hex.toggleCount=command.generated.substring(12,14).toString(16);command.toggleCount=parseInt(command.hex.toggleCount,16)}if(command.words>8&&command.cmd=="toggle"){command.hex.toggleRate=command.generated.substring(14,16).toString(16);command.toggleRate=parseInt(command.hex.toggleRate,16)}if(command.words>9&&command.checksum!=String(command.generated.substring(12,14))&&command.rate&&command.type=="device"&&(command.cmd=="goto"||command.cmd=="fadeStart"||command.cmd=="toggle"||command.cmd=="indicate")){command.hex.channel=command.generated.substring(16,18).toString(16);command.channel=parseInt(command.hex.channel,16)}if(command.words>8&&command.checksum!=String(command.generated.substring(14,16))&&command.blinkRate&&command.type=="device"&&command.cmd=="blink"){command.hex.channel=command.generated.substring(16,18).toString(16);command.channel=parseInt(command.hex.channel,16)}if((command.cmd=="goto"||command.cmd=="fadeStart")&&!command.level){g(null,new Error("Invalid command! No level specified. A level must be specified with goto and fadeStart."))}if(command.cmd=="blink"&&!command.blinkRate){g(null,new Error("No blink rate specified. Blink rate must be specified with the blink command."))}if(command.cmd=="toggle"&&!command.toggleCount){g(null,new Error("Invalid command! No toggle count specified. Toggle count must be specified with the toggle command."))}g(command,null)};if(typeof module!=="undefined"&&module.exports){module.exports=f}else{if(typeof define!=="undefined"&&define.amd){define([],function(){return f})}else{a.upb=f}}}());