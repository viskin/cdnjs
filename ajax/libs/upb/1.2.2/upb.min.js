(function(){var e={};var a,d;a=this;if(a!=null){d=a.upb}e.noConflict=function(){a.upb=d;return e};function c(h,f,g){g=g||"0";h=h+"";return h.length>=f?h:new Array(f-h.length+1).join(g)+h}function b(f,h){var g=f.length;while(g--){if(f[g]===h){return true}}return false}e.validCommands=["20","activate","21","deactivate","22","goto","23","fadeStart","24","fadeStop","25","blink","26","indicate","27","toggle","30","reportState","31","storeState","80","ackResponse","85","setupTimeReport","86","deviceStateReport","87","deviceStatusReport","8F","deviceSignatureReport","90","registerValuesReport","91","RAMvaluesReport","92","rawDataReport","93","heartbeatReport"];e.defaultCommand={source:255,sendx:1,sendTime:1,ackPulse:false,idPulse:false,ackMsg:false,powerlineRepeater:0};e.generateChecksum=function(g){var f=parseInt(g.hex.ctrlWord.byte1.slice(0,2),16);f+=parseInt(g.hex.ctrlWord.byte2.slice(0,2),16);f+=parseInt(g.hex.network.slice(0,2),16);f+=parseInt(g.hex.id.slice(0,2),16);f+=parseInt(g.hex.source.slice(0,2),16);f+=parseInt(g.hex.msg.slice(0,2),16);if(g.hex.level){f+=parseInt(g.hex.level.slice(0,2),16)}if(g.hex.rate){f+=parseInt(g.hex.rate.slice(0,2),16)}if(g.hex.blinkRate){f+=parseInt(g.hex.blinkRate.slice(0,2),16)}if(g.hex.toggleCount){f+=parseInt(g.hex.toggleCount.slice(0,2),16)}if(g.hex.toggleRate){f+=parseInt(g.hex.toggleRate.slice(0,2),16)}if(g.hex.channel){f+=parseInt(g.hex.channel.slice(0,2),16)}f=parseInt((~f+1>>>0)).toString(16);f=f.substr(f.length-2);return f};e.generate=function(g,f){if(!g.network){f(null,new Error("No network id specified!"))}if(!g.id){f(null,new Error("No link or device id specified!"))}if(!g.type){f(null,new Error("No id type specified!"))}if(!g.cmd){f(null,new Error("No command specified!"))}if(!b(e.validCommands,(String(g.cmd)))||g.cmd==="1"){f(null,new Error("Invalid command specified! Please us the correct command name or number."))}if(g.powerlineRepeater===0){g.powerlineRepeater=false}if(g.powerlineRepeater===true||g.powerlineRepeater==="true"){g.powerlineRepeater=1}if(g.powerlineRepeater&&!(g.powerlineRepeater===1||g.powerlineRepeater===2||g.powerlineRepeater===4||g.powerlineRepeater===false||g.powerlineRepeater===0)){f(null,new Error("Power line repeater argument only accepts 1, 2, 4, or false!"))}if(g.level>100||g.level<0){f(null,new Error("Level can only be values 0 through 100! Inequality: -1 < L < 101 where variable 'L' is level."))}if(g.sendTime&&g.sendTime>g.sendx){f(null,new Error("Number of time sent (sendTime) cannot be greater than total number of times sent (sendx)!"))}if(!g.source){g.source=255}g.ctrlWord={};g.ctrlWord.nibble1=0;g.ctrlWord.nibble2=0;g.words=7;g.ctrlWord.nibble3=0;g.ctrlWord.nibble4=0;g.hex={};g.hex.network=parseInt(g.network).toString(16);g.hex.id=parseInt(g.id).toString(16);g.hex.source=parseInt(g.source).toString(16);if(g.cmd===20||g.cmd==="20"||g.cmd=="activate"){g.cmd="activate";g.msg=20}else{if(g.cmd===21||g.cmd==="21"||g.cmd=="deactivate"){g.msg=21;g.cmd="deactivate"}else{if(g.cmd===22||g.cmd==="22"||g.cmd=="goto"){g.msg=22;g.cmd="goto"}else{if(g.cmd===23||g.cmd==="23"||g.cmd=="fadeStart"){g.msg=23;g.cmd="fadeStart"}else{if(g.cmd===24||g.cmd==="24"||g.cmd=="fadeStop"){g.msg=24;g.cmd="fadeStop"}else{if(g.cmd===25||g.cmd==="25"||g.cmd=="blink"){g.msg=25;g.cmd="blink"}else{if(g.cmd===26||g.cmd==="26"||g.cmd=="indicate"){g.msg=26;g.cmd="indicate"}else{if(g.cmd===27||g.cmd==="27"||g.cmd=="toggle"){g.msg=27;g.cmd="toggle"}else{if(g.cmd===30||g.cmd==="30"||g.cmd=="reportState"){g.msg=30;g.cmd="reportState"}else{if(g.cmd===31||g.cmd==="31"||g.cmd=="storeState"){g.msg=31;g.cmd="storeState"}else{if(g.cmd===80||g.cmd==="80"||g.cmd=="ackResponse"){g.msg=80;g.cmd="ackResponse"}else{if(g.cmd===85||g.cmd==="85"||g.cmd=="setupTimeReport"){g.msg=85;g.cmd="setupTimeReport"}else{if(g.cmd===86||g.cmd==="86"||g.cmd=="deviceStateReport"){g.msg=86;g.cmd="deviceStateReport"}else{if(g.cmd===87||g.cmd==="87"||g.cmd=="deviceStatusReport"){g.msg=87;g.cmd="deviceStatusReport"}else{if(g.cmd==="8F"||g.cmd=="deviceSignatureReport"){g.msg="8F";g.cmd="deviceSignatureReport"}else{if(g.cmd===90||g.cmd==="90"||g.cmd=="registerValuesReport"){g.msg=90;g.cmd="registerValuesReport"}else{if(g.cmd===91||g.cmd==="91"||g.cmd=="RAMvaluesReport"){g.msg=91;g.cmd="RAMvaluesReport"}else{if(g.cmd===92||g.cmd==="92"||g.cmd=="rawDataReport"){g.msg=92;g.cmd="rawDataReport"}else{if(g.cmd===93||g.cmd==="93"||g.cmd=="heartbeatReport"){g.msg=93;g.cmd="heartbeatReport"}}}}}}}}}}}}}}}}}}}g.hex.msg=parseInt(g.msg,16).toString(16);if((g.cmd==="goto"||g.cmd==="fadeStart"||g.cmd==="deviceStateReport")&&!g.level){f(null,new Error("No level specified! A level must be specified with goto, fadeStart, and deviceStateReport."))}if(g.cmd==="blink"&&!g.blinkRate){f(null,new Error("No blink rate specified!"))}if(g.cmd==="toggle"&&!g.toggleCount){f(null,new Error("No toggle count specified!"))}if(g.level&&(g.cmd==="goto"||g.cmd==="fadeStart"||g.cmd==="fadeStop"||g.cmd==="indicate")){g.words++;g.hex.level=parseInt(g.level).toString(16)}if(g.rate&&g.level&&(g.cmd==="goto"||g.cmd==="fadeStart"||g.cmd==="indicate")){g.words++;g.hex.rate=parseInt(g.rate).toString(16)}if(g.cmd==="blink"){g.words++;g.hex.blinkRate=parseInt(g.blinkRate).toString(16)}if(g.cmd==="toggle"){g.words++;g.hex.toggleCount=parseInt(g.toggleCount).toString(16)}if(g.toggleRate&&g.cmd==="toggle"){g.words++;g.hex.toggleRate=parseInt(g.toggleRate).toString(16)}if(g.channel&&g.type==="device"&&g.rate&&(g.cmd==="goto"||g.cmd==="fadeStart"||g.cmd==="blink"||g.cmd==="toggle"||g.cmd==="indicate")){g.words++;g.hex.channel=parseInt(g.channel).toString(16)}if(g.type==="link"){g.ctrlWord.nibble1+=8}if(g.powerlineRepeater===1){g.ctrlWord.nibble1+=2}else{if(g.powerlineRepeater===2){g.ctrlWord.nibble1+=4}else{if(g.powerlineRepeater===4){g.ctrlWord.nibble1+=6}}}g.ctrlWord.nibble2=g.words;if(g.ackPulse===true){g.ctrlWord.nibble3+=1}if(g.idPulse===true){g.ctrlWord.nibble3+=2}if(g.ackMsg===true){g.ctrlWord.nibble3+=4}if(g.sendx===2){g.ctrlWord.nibble4+=4}else{if(g.sendx===3){g.ctrlWord.nibble4+=8}else{if(g.sendx===4){g.ctrlWord.nibble4+=12}}}if(g.sendTime===2){g.ctrlWord.nibble4+=1}else{if(g.sendTime===3){g.ctrlWord.nibble4+=2}else{if(g.sendTime===4){g.ctrlWord.nibble4+=3}}}g.hex.ctrlWord={};g.hex.ctrlWord.nibble1=parseInt(g.ctrlWord.nibble1).toString(16);g.hex.ctrlWord.nibble2=parseInt(g.words).toString(16);g.hex.ctrlWord.nibble3=parseInt(g.ctrlWord.nibble3).toString(16);g.hex.ctrlWord.nibble4=parseInt(g.ctrlWord.nibble4).toString(16);g.hex.ctrlWord.byte1=g.hex.ctrlWord.nibble1+g.hex.ctrlWord.nibble2;g.hex.ctrlWord.byte2=g.hex.ctrlWord.nibble3+g.hex.ctrlWord.nibble4;g.generated=g.hex.ctrlWord.byte1;g.generated+=g.hex.ctrlWord.byte2;g.generated+=c(g.hex.network,2,0);g.generated+=c(g.hex.id,2,0);g.generated+=c(g.hex.source,2,0);g.generated+=c(g.msg,2,0);if(g.hex.level){g.generated+=c(g.hex.level,2,0)}if(g.hex.rate){g.generated+=c(g.hex.rate,2,0)}if(g.hex.blinkRate){g.generated+=c(g.hex.blinkRate,2,0)}if(g.hex.toggleCount){g.generated+=c(g.hex.toggleCount,2,0)}if(g.hex.toggleRate){g.generated+=c(g.hex.toggleRate,2,0)}if(g.hex.channel){g.generated+=c(g.hex.channel,2,0)}g.checksum=e.generateChecksum(g);g.generated+=c(g.checksum,2,0);g.generated=g.generated.toUpperCase();f(g,null)};e.decode=function(g,f){var h=e.defaultCommand;h.hex={};h.generated=g.toUpperCase();h.hex.ctrlWord={};h.hex.ctrlWord.byte1=h.generated.substring(0,2).toString(16);h.hex.ctrlWord.byte2=h.generated.substring(2,4).toString(16);h.hex.ctrlWord.nibble1=h.generated.substring(0,1).toString(16);h.hex.ctrlWord.nibble2=h.generated.substring(1,2).toString(16);h.hex.ctrlWord.nibble3=h.generated.substring(2,3).toString(16);h.hex.ctrlWord.nibble4=h.generated.substring(3,4).toString(16);h.ctrlWord={};h.ctrlWord.nibble1=parseInt(h.hex.ctrlWord.nibble1,16);h.ctrlWord.nibble2=parseInt(h.hex.ctrlWord.nibble2,16);h.ctrlWord.nibble3=parseInt(h.hex.ctrlWord.nibble3,16);h.ctrlWord.nibble4=parseInt(h.hex.ctrlWord.nibble4,16);if(h.ctrlWord.nibble1>=8){h.type="link";h.powerlineRepeater=h.ctrlWord.nibble1-8}else{h.type="device";h.powerlineRepeater=h.ctrlWord.nibble1}if(h.powerlineRepeater===false||h.powerlineRepeater===0){h.powerlineRepeater=0}else{if(h.powerlineRepeater===2){h.powerlineRepeater=1}else{if(h.powerlineRepeater===4){h.powerlineRepeater=2}else{if(h.powerlineRepeater===6){h.powerlineRepeater=4}else{f(null,new Error("Invalid command! Powerline repeater argument can only be 1, 2, or 4 which translates into 2, 4, or 6."))}}}}h.words=h.ctrlWord.nibble2;if(h.generated.length/2!==h.words){f(null,new Error("Invalid command! Word count doesn't add up.'"))}if(h.ctrlWord.nibble3===1){h.ackPulse=true}if(h.ctrlWord.nibble3===2){h.idPulse=true}if(h.ctrlWord.nibble3==3){h.ackPulse=true;h.idPulse=true}if(h.ctrlWord.nibble3===4){h.ackMsg=true}if(h.ctrlWord.nibble3===5){h.ackPulse=true;h.ackMsg=true}if(h.ctrlWord.nibble3===6){h.idPulse=true;h.ackMsg=true}if(h.ctrlWord.nibble3===7){h.ackPulse=true;h.idPulse=true;h.ackMsg=true}if(h.ctrlWord.nibble3>7){f(null,new Error("Invalid command! Any number greater than seven cannot be an Acknowledge Pulse, ID Pulse, or Acknowledge Message."))}if(h.ctrlWord.nibble4===0){h.sendx=1;h.sendTime=1}else{if(h.ctrlWord.nibble4===4){h.sendx=2;h.sendTime=1}else{if(h.ctrlWord.nibble4===5){h.sendx=2;h.sendTime=2}else{if(h.ctrlWord.nibble4===8){h.sendx=3;h.sendTime=1}else{if(h.ctrlWord.nibble4===9){h.sendx=3;h.sendTime=2}else{if(h.ctrlWord.nibble4===10){h.sendx=3;h.sendTime=3}else{if(h.ctrlWord.nibble4===12){h.sendx=4;h.sendTime=1}else{if(h.ctrlWord.nibble4===12){h.sendx=4;h.sendTime=2}else{if(h.ctrlWord.nibble4===13){h.sendx=4;h.sendTime=3}else{if(h.ctrlWord.nibble4===14){h.sendx=4;h.sendTime=4}else{f(null,new Error("Invalid command! Send time is greater than total sent times."))}}}}}}}}}}h.hex.network=h.generated.substring(4,6).toString(16);h.network=parseInt(h.hex.network,16);h.hex.id=h.generated.substring(6,8).toString(16);h.id=parseInt(h.hex.id,16);h.hex.source=h.generated.substring(8,10).toString(16);h.source=parseInt(h.hex.source,16);h.msg=h.generated.substring(10,12).toString(16);if(h.msg==20){h.cmd="activate"}else{if(h.msg===21){h.cmd="deactivate"}else{if(h.msg===22){h.cmd="goto"}else{if(h.msg===23){h.cmd="fadeStart"}else{if(h.msg===24){h.cmd="fadeStop"}else{if(h.msg===25){h.cmd="blink"}else{if(h.msg===26){h.cmd="indicate"}else{if(h.msg===27){h.cmd="toggle"}else{if(h.msg===30){h.cmd="reportState"}else{if(h.msg===31){h.cmd="storeState"}else{if(h.msg===80){h.cmd="ackResponse"}else{if(h.msg===85){h.cmd="setupTimeReport"}else{if(h.msg===86){h.cmd="deviceStateReport"}else{if(h.msg===87){h.cmd="deviceStatusReport"}else{if(h.msg==="8F"){h.cmd="deviceSignatureReport"}else{if(h.msg===90){h.cmd="registerValuesReport"}else{if(h.msg===91){h.cmd="RAMvaluesReport"}else{if(h.msg===92){h.cmd="rawDataReport"}else{if(h.msg===93){h.cmd="heartbeatReport"}else{calbackFinal(null,"An unknown command was specified!")}}}}}}}}}}}}}}}}}}}h.hex.msg=parseInt(h.msg,16).toString(16);h.checksum=h.generated.slice(-2).toString(16);if(h.words>7&&h.checksum!==String(h.generated.substring(12,14))&&(h.cmd==="goto"||h.cmd==="fadeStart"||h.cmd==="fadeStop"||h.cmd==="deviceStateReport"||h.cmd==="indicate")){h.hex.level=h.generated.substring(12,14).toString(16);h.level=parseInt(h.hex.level,16)}if(h.words>8&&h.checksum!==String(h.generated.substring(12,14))&&h.level&&(h.cmd==="goto"||h.cmd==="fadeStart"||h.cmd==="indicate")){h.hex.rate=h.generated.substring(14,16).toString(16);h.rate=parseInt(h.hex.rate,16)}if(h.words>7&&h.cmd==="blink"){h.hex.blinkRate=h.generated.substring(12,14).toString(16);h.blinkRate=parseInt(h.hex.blinkRate,16)}if(h.words>7&&h.cmd==="toggle"){h.hex.toggleCount=h.generated.substring(12,14).toString(16);h.toggleCount=parseInt(h.hex.toggleCount,16)}if(h.words>8&&h.cmd==="toggle"){h.hex.toggleRate=h.generated.substring(14,16).toString(16);h.toggleRate=parseInt(h.hex.toggleRate,16)}if(h.words>9&&h.checksum!==String(h.generated.substring(12,14))&&h.rate&&h.type==="device"&&(h.cmd==="goto"||h.cmd==="fadeStart"||h.cmd==="toggle"||h.cmd==="indicate")){h.hex.channel=h.generated.substring(16,18).toString(16);h.channel=parseInt(h.hex.channel,16)}if(h.words>8&&h.checksum!==String(h.generated.substring(14,16))&&h.blinkRate&&h.type==="device"&&h.cmd==="blink"){h.hex.channel=h.generated.substring(16,18).toString(16);h.channel=parseInt(h.hex.channel,16)}if((h.cmd==="goto"||h.cmd==="fadeStart")&&!h.level){f(null,new Error("Invalid command! No level specified. A level must be specified with goto and fadeStart."))}if(h.cmd==="blink"&&!h.blinkRate){f(null,new Error("No blink rate specified. Blink rate must be specified with the blink command."))}if(h.cmd==="toggle"&&!h.toggleCount){f(null,new Error("Invalid command! No toggle count specified. Toggle count must be specified with the toggle command."))}f(h,null)};if(typeof module!=="undefined"&&module.exports){module.exports=e}else{if(typeof define!=="undefined"&&define.amd){define([],function(){return e})}else{a.upb=e}}}());