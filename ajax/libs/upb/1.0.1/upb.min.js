function pad(c,a,b){b=b||"0";c=c+"";return c.length>=a?c:new Array(a-c.length+1).join(b)+c}function pad2(b,a){b=String(b);if(b.length<1){return a+""+a}else{if(b.length<2){return a+""+b}else{return b}}}var validCommands=["20","activate","21","deactivate","22","goto","23","fadeStart","24","fadeStop","25","blink","27","toggle"];exports.validCommands=validCommands;var defaultCommand={source:255,sendx:1,ackPulse:false,idPulse:false,ackMsg:false,powerlineRepeater:false,sendTime:1};exports.defaultCommand=defaultCommand;function checksum(a){a.checksum=parseInt(a.hex.ctrlWord.fullByte1.slice(0,2),16);a.checksum+=parseInt(a.hex.ctrlWord.fullByte2.slice(0,2),16);a.checksum+=parseInt(a.hex.network.slice(0,2),16);a.checksum+=parseInt(a.hex.id.slice(0,2),16);a.checksum+=parseInt(a.hex.source.slice(0,2),16);a.checksum+=parseInt(a.hex.msg.slice(0,2),16);if(a.hex.level){a.checksum+=parseInt(a.hex.level.slice(0,2),16)}if(a.hex.rate){a.checksum+=parseInt(a.hex.rate.slice(0,2),16)}if(a.hex.blinkRate){a.checksum+=parseInt(a.hex.blinkRate.slice(0,2),16)}if(a.hex.toggleCount){a.checksum+=parseInt(a.hex.toggleCount.slice(0,2),16)}if(a.hex.toggleRate){a.checksum+=parseInt(a.hex.toggleRate.slice(0,2),16)}if(a.hex.channel){a.checksum+=parseInt(a.hex.channel.slice(0,2),16)}a.checksum=parseInt((~a.checksum+1>>>0)).toString(16);a.checksum=a.checksum.substr(a.checksum.length-2);return a.checksum}exports.checksum=checksum;function generate(b,a){if(!b.network){a(null,"No network id specified!")}if(!b.id){a(null,"No link or device id specified!")}if(!b.type){a(null,"No id type specified!")}if(!b.cmd){a(null,"No command specified!")}if(!validCommands.contains(b.cmd)){if(!Object.keys(validCommands).contains(b.cmd)){a(null,"Invalid command specified! Please us the correct command name or number.")}}if(b.powerlineRepeater&&!(b.powerlineRepeater==1||b.powerlineRepeater==2||b.powerlineRepeater==4||b.powerlineRepeater=="false")){a(null,"Power line repeater argument only accepts 1, 2, 4, or false!")}if(b.level>100||b.level<0){a(null,"Level can only be values 0 through 100! Inequality: -1 < L < 101 where variable 'L' is level.")}if(b.sendTime&&b.sendTime>b.sendx){a(null,"Number of time sent (sendTime) cannot be greater than total number of times sent (sendx)!")}b.ctrlWord={};b.ctrlWord.byte1=0;b.ctrlWord.byte2=0;b.words=7;b.ctrlWord.byte3=0;b.ctrlWord.byte4=0;b.hex={};b.hex.network=parseInt(b.network).toString(16);b.hex.id=parseInt(b.id).toString(16);b.hex.source=parseInt(b.source).toString(16);if(b.cmd=="activate"||b.cmd==20){b.msg=20;b.cmd="activate"}if(b.cmd=="deactivate"||b.cmd==21){b.msg=21;b.cmd="deactivate"}if(b.cmd=="goto"||b.cmd==22){b.msg=22;b.cmd="goto"}if(b.cmd=="fadeStart"||b.cmd==23){b.msg=23;b.cmd="fadeStart"}if(b.cmd=="fadeStop"||b.cmd==24){b.msg=24;b.cmd="fadeStop"}if(b.cmd=="blink"||b.cmd==25){b.msg=25;b.cmd="blink"}if(b.cmd=="toggle"||b.cmd==27){b.msg=27;b.cmd="toggle"}b.hex.msg=parseInt(b.msg,16).toString(16);if((b.cmd=="goto"||b.cmd=="fadeStart")&&!b.level){a(null,"No level specified! A level must be specified with goto and fadeStart.")}if(b.cmd=="blink"&&!b.blinkRate){a(null,"No blink rate specified!")}if(b.cmd=="toggle"&&!b.toggleCount){a(null,"No toggle count specified!")}if(b.level&&(b.cmd=="goto"||b.cmd=="fadeStart"||b.cmd=="fadeStop"||b.cmd=="toggle")){b.words++;b.hex.level=parseInt(b.level).toString(16)}if(b.rate&&(b.cmd=="goto"||b.cmd=="fadeStart"||b.cmd=="toggle")){b.words++;b.hex.rate=parseInt(b.rate).toString(16)}if(b.cmd=="blink"){b.words++;b.hex.blinkRate=parseInt(b.blinkRate).toString(16)}if(b.cmd=="toggle"){b.words++;b.hex.toggleCount=parseInt(b.toggleCount).toString(16)}if(b.toggleRate&&b.cmd=="toggle"){b.words++;b.hex.toggleRate=parseInt(b.toggleRate).toString(16)}if(b.channel&&b.type=="device"&&(b.cmd=="goto"||b.cmd=="fadeStart"||b.cmd=="blink"||b.cmd=="toggle")){b.words++;b.hex.cannel=parseInt(b.channel).toString(16)}if(b.type=="link"){b.ctrlWord.byte1+=8}if(b.powerlineRepeater==1){b.ctrlWord.byte1+=2}else{if(b.powerlineRepeater==2){b.ctrlWord.byte1+=4}else{if(b.powerlineRepeater==4){b.ctrlWord.byte1+=6}}}b.ctrlWord.byte2=b.words;if(b.ackPulse==true){b.ctrlWord.byte3+=1}if(b.idPulse==true){b.ctrlWord.byte3+=2}if(b.ackMsg==true){b.ctrlWord.byte3+=4}if(b.sendx==2){b.ctrlWord.byte4+=4}else{if(b.sendx==3){b.ctrlWord.byte4+=8}else{if(b.sendx==4){b.ctrlWord.byte4+=12}}}if(b.sendTime==2){b.ctrlWord.byte4+=1}else{if(b.sendTime==3){b.ctrlWord.byte4+=2}else{if(b.sendTime==4){b.ctrlWord.byte4+=3}}}b.hex.ctrlWord={};b.hex.ctrlWord.byte1=parseInt(b.ctrlWord.byte1).toString(16);b.hex.ctrlWord.byte2=parseInt(b.words).toString(16);b.hex.ctrlWord.byte3=parseInt(b.ctrlWord.byte3).toString(16);b.hex.ctrlWord.byte4=parseInt(b.ctrlWord.byte4).toString(16);b.hex.ctrlWord.fullByte1=b.hex.ctrlWord.byte1+b.hex.ctrlWord.byte2;b.hex.ctrlWord.fullByte2=b.hex.ctrlWord.byte3+b.hex.ctrlWord.byte4;b.generated=b.hex.ctrlWord.fullByte1;b.generated+=b.hex.ctrlWord.fullByte2;b.generated+=pad(b.hex.network,2,0);b.generated+=pad(b.hex.id,2,0);b.generated+=pad(b.hex.source,2,0);b.generated+=pad(b.msg,2,0);if(b.hex.level){b.generated+=pad(b.hex.level,2,0)}if(b.hex.rate){b.generated+=pad(b.hex.rate,2,0)}if(b.hex.blinkRate){b.generated+=pad(b.hex.blinkRate,2,0)}if(b.hex.toggleCount){b.generated+=pad(b.hex.toggleCount,2,0)}if(b.hex.toggleRate){b.generated+=pad(b.hex.toggleRate,2,0)}if(b.hex.channel){b.generated+=pad(b.hex.channel,2,0)}b.checksum=checksum(b);b.generated+=pad(b.checksum,2,0);b.generated=b.generated.toUpperCase();a(b,null)}exports.generate=generate;function decode(b,a){command={};command.generated=b;a(command,"This feature has not been implemented yet!")}exports.decode=decode;