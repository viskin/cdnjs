(function(a){if(typeof define!=="undefined"&&define.amd){define(["jquery"],a)}else{if(typeof module!=="undefined"&&module.exports){var b=require("jquery");module.exports=a($)}else{window.scrollMonitor=a($)}}})(function(e){var y={};var q=e(window);var w=e(document);var d=[];var v="visibilityChange";var u="enterViewport";var t="fullyEnterViewport";var i="exitViewport";var f="partiallyExitViewport";var r="locationChange";var h="stateChange";var j=[v,u,t,i,f,r,h];var x={top:0,bottom:0};y.viewportTop;y.viewportBottom;y.documentHeight;y.viewportHeight=q.height();var p;var m;var a;function n(){y.viewportTop=q.scrollTop();y.viewportBottom=y.viewportTop+y.viewportHeight;y.documentHeight=w.height();if(y.documentHeight!==p){a=d.length;while(a--){d[a].recalculateLocation()}p=y.documentHeight}}function l(){y.viewportHeight=q.height();n();k()}var b;function o(){clearTimeout(b);b=setTimeout(l,100)}var c;function k(){c=d.length;while(c--){d[c].update()}c=d.length;while(c--){d[c].triggerCallbacks()}}function g(G,B){var J=this;this.watchItem=G;if(!B){this.offsets=x}else{if(B===+B){this.offsets={top:B,bottom:B}}else{this.offsets=e.extend({},B,x)}}this.callbacks={};j.forEach(function(K){J.callbacks[K]=[]});this.locked=false;var E;var H;var I;var F;var A;var z;function D(K){if(K.length===0){return}A=K.length;while(A--){z=K[A];z.callback.call(J,m);if(z.isOne){K.splice(A,1)}}}this.triggerCallbacks=function C(){if(this.isInViewport&&!E){D(this.callbacks[u])}if(this.isFullyInViewport&&!H){D(this.callbacks[t])}if(this.isAboveViewport!==I&&this.isBelowViewport!==F){D(this.callbacks[v]);if(!H&&!this.isFullyInViewport){D(this.callbacks[t]);D(this.callbacks[f])}if(!E&&!this.isInViewport){D(this.callbacks[u]);D(this.callbacks[i])}}if(!this.isFullyInViewport&&H){D(this.callbacks[f])}if(!this.isInViewport&&E){D(this.callbacks[i])}if(this.isInViewport!==E){D(this.callbacks[v])}switch(true){case E!==this.isInViewport:case H!==this.isFullyInViewport:case I!==this.isAboveViewport:case F!==this.isBelowViewport:D(this.callbacks[h])}E=this.isInViewport;H=this.isFullyInViewport;I=this.isAboveViewport;F=this.isBelowViewport};this.recalculateLocation=function(){if(this.locked){return}var N=this.top;var M=this.bottom;if(this.watchItem.nodeName){var K=this.watchItem.style.display;if(K==="none"){this.watchItem.style.display=""}var L=e(this.watchItem).offset();this.top=L.top;this.bottom=L.top+this.watchItem.offsetHeight;if(K==="none"){this.watchItem.style.display=K}}else{if(this.watchItem===+this.watchItem){if(this.watchItem>0){this.top=this.bottom=this.watchItem}else{this.top=this.bottom=y.documentHeight-this.watchItem}}else{this.top=this.watchItem.top;this.bottom=this.watchItem.bottom}}this.top-=this.offsets.top;this.bottom+=this.offsets.bottom;this.height=this.bottom-this.top;if((N!==undefined||M!==undefined)&&(this.top!==N||this.bottom!==M)){D(this.callbacks[r])}};this.recalculateLocation();this.update();E=this.isInViewport;H=this.isFullyInViewport;I=this.isAboveViewport;F=this.isBelowViewport}g.prototype={on:function(z,B,A){switch(true){case z===v&&!this.isInViewport&&this.isAboveViewport:case z===u&&this.isInViewport:case z===t&&this.isFullyInViewport:case z===i&&this.isAboveViewport&&!this.isInViewport:case z===f&&this.isAboveViewport:B();if(A){return}}if(this.callbacks[z]){this.callbacks[z].push({callback:B,isOne:A})}else{throw new Error("Tried to add a scroll monitor listener of type "+z+". Your options are: "+j.join(", "))}},off:function(B,C){if(this.callbacks[B]){for(var z=0,A;A=this.callbacks[B][z];z++){if(A.callback===C){this.callbacks[B].splice(z,1);break}}}else{throw new Error("Tried to remove a scroll monitor listener of type "+B+". Your options are: "+j.join(", "))}},one:function(z,A){this.on(z,A,true)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<y.viewportTop;this.isBelowViewport=this.bottom>y.viewportBottom;this.isInViewport=(this.top<=y.viewportBottom&&this.bottom>=y.viewportTop);this.isFullyInViewport=(this.top>=y.viewportTop&&this.bottom<=y.viewportBottom)||(this.isAboveViewport&&this.isBelowViewport)},destroy:function(){var A=d.indexOf(this),z=this;d.splice(A,1);j.forEach(function(B){z.callbacks[B].length=0})},lock:function(){this.locked=true},unlock:function(){this.locked=false}};j.forEach(function(z){g.prototype[z]=function(B,A){this.on.call(this,z,B,A)}});n();function s(z){m=z;n();k()}q.on("scroll",s);q.on("resize",o);y.beget=y.create=function(A,B){if(typeof A==="string"){A=e(A)[0]}if(A instanceof e){A=A[0]}var z=new g(A,B);d.push(z);z.update();return z};y.update=function(){m=null;n();k()};y.recalculateLocations=function(){y.documentHeight=0;y.update()};return y});