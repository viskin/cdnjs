(function(a){if(typeof define!=="undefined"&&define.amd){define(["jquery"],a)}else{if(typeof module!=="undefined"&&module.exports){var b=require("jquery");module.exports=a(b)}else{window.scrollMonitor=a(jQuery)}}})(function(g){var E={};var u=g(window);var C=g(document);var f=[];var B="visibilityChange";var z="enterViewport";var x="fullyEnterViewport";var m="exitViewport";var h="partiallyExitViewport";var v="locationChange";var l="stateChange";var n=[B,z,x,m,h,v,l];var D={top:0,bottom:0};E.viewportTop;E.viewportBottom;E.documentHeight;E.viewportHeight=u.height();var t;var q;var a;function r(){E.viewportTop=u.scrollTop();E.viewportBottom=E.viewportTop+E.viewportHeight;E.documentHeight=C.height();if(E.documentHeight!==t){a=f.length;while(a--){f[a].recalculateLocation()}t=E.documentHeight}}function p(){E.viewportHeight=u.height();r();o()}var b;function s(){clearTimeout(b);b=setTimeout(p,100)}var e;function o(){e=f.length;while(e--){f[e].update()}e=f.length;while(e--){f[e].triggerCallbacks()}}function k(O,H){var R=this;this.watchItem=O;if(!H){this.offsets=D}else{if(H===+H){this.offsets={top:H,bottom:H}}else{this.offsets=g.extend({},D,H)}}this.callbacks={};for(var M=0,L=n.length;M<L;M++){R.callbacks[n[M]]=[]}this.locked=false;var K;var P;var Q;var N;var G;var F;function J(i){if(i.length===0){return}G=i.length;while(G--){F=i[G];F.callback.call(R,q);if(F.isOne){i.splice(G,1)}}}this.triggerCallbacks=function I(){if(this.isInViewport&&!K){J(this.callbacks[z])}if(this.isFullyInViewport&&!P){J(this.callbacks[x])}if(this.isAboveViewport!==Q&&this.isBelowViewport!==N){J(this.callbacks[B]);if(!P&&!this.isFullyInViewport){J(this.callbacks[x]);J(this.callbacks[h])}if(!K&&!this.isInViewport){J(this.callbacks[z]);J(this.callbacks[m])}}if(!this.isFullyInViewport&&P){J(this.callbacks[h])}if(!this.isInViewport&&K){J(this.callbacks[m])}if(this.isInViewport!==K){J(this.callbacks[B])}switch(true){case K!==this.isInViewport:case P!==this.isFullyInViewport:case Q!==this.isAboveViewport:case N!==this.isBelowViewport:J(this.callbacks[l])}K=this.isInViewport;P=this.isFullyInViewport;Q=this.isAboveViewport;N=this.isBelowViewport};this.recalculateLocation=function(){if(this.locked){return}var T=this.top;var S=this.bottom;if(this.watchItem.nodeName){var i=this.watchItem.style.display;if(i==="none"){this.watchItem.style.display=""}var j=g(this.watchItem).offset();this.top=j.top;this.bottom=j.top+this.watchItem.offsetHeight;if(i==="none"){this.watchItem.style.display=i}}else{if(this.watchItem===+this.watchItem){if(this.watchItem>0){this.top=this.bottom=this.watchItem}else{this.top=this.bottom=E.documentHeight-this.watchItem}}else{this.top=this.watchItem.top;this.bottom=this.watchItem.bottom}}this.top-=this.offsets.top;this.bottom+=this.offsets.bottom;this.height=this.bottom-this.top;if((T!==undefined||S!==undefined)&&(this.top!==T||this.bottom!==S)){J(this.callbacks[v])}};this.recalculateLocation();this.update();K=this.isInViewport;P=this.isFullyInViewport;Q=this.isAboveViewport;N=this.isBelowViewport}k.prototype={on:function(i,F,j){switch(true){case i===B&&!this.isInViewport&&this.isAboveViewport:case i===z&&this.isInViewport:case i===x&&this.isFullyInViewport:case i===m&&this.isAboveViewport&&!this.isInViewport:case i===h&&this.isAboveViewport:F();if(j){return}}if(this.callbacks[i]){this.callbacks[i].push({callback:F,isOne:j})}else{throw new Error("Tried to add a scroll monitor listener of type "+i+". Your options are: "+n.join(", "))}},off:function(G,H){if(this.callbacks[G]){for(var j=0,F;F=this.callbacks[G][j];j++){if(F.callback===H){this.callbacks[G].splice(j,1);break}}}else{throw new Error("Tried to remove a scroll monitor listener of type "+G+". Your options are: "+n.join(", "))}},one:function(i,j){this.on(i,j,true)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<E.viewportTop;this.isBelowViewport=this.bottom>E.viewportBottom;this.isInViewport=(this.top<=E.viewportBottom&&this.bottom>=E.viewportTop);this.isFullyInViewport=(this.top>=E.viewportTop&&this.bottom<=E.viewportBottom)||(this.isAboveViewport&&this.isBelowViewport)},destroy:function(){var H=f.indexOf(this),F=this;f.splice(H,1);for(var I=0,G=n.length;I<G;I++){F.callbacks[n[I]].length=0}},lock:function(){this.locked=true},unlock:function(){this.locked=false}};var d=function(i){return function(F,j){this.on.call(this,i,F,j)}};for(var A=0,y=n.length;A<y;A++){var c=n[A];k.prototype[c]=d(c)}r();function w(i){q=i;r();o()}u.on("scroll",w);u.on("resize",s);E.beget=E.create=function(j,F){if(typeof j==="string"){j=g(j)[0]}if(j instanceof g){j=j[0]}var i=new k(j,F);f.push(i);i.update();return i};E.update=function(){q=null;r();o()};E.recalculateLocations=function(){E.documentHeight=0;E.update()};return E});