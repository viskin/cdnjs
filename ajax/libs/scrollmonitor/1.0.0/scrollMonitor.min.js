(function(a){if(typeof define!=="undefined"&&define.amd){define(["jquery"],a)}else{if(typeof module!=="undefined"&&module.exports){var b=require("jquery");module.exports=a($)}else{window.scrollMonitor=a($)}}})(function(e){var x={};var q=e(window);var w=e(document);var d=[];var v="visibilityChange";var u="enterViewport";var t="fullyEnterViewport";var i="exitViewport";var f="partiallyExitViewport";var r="locationChange";var h="stateChange";var j=[v,u,t,i,f,r,h];x.viewportTop;x.viewportBottom;x.documentHeight;x.viewportHeight=q.height();var p;var m;var a;function n(){x.viewportTop=q.scrollTop();x.viewportBottom=x.viewportTop+x.viewportHeight;x.documentHeight=w.height();if(x.documentHeight!==p){a=d.length;while(a--){d[a].recalculateLocation()}p=x.documentHeight}}function l(){x.viewportHeight=q.height();n();k()}var b;function o(){clearTimeout(b);b=setTimeout(l,100)}var c;function k(){c=d.length;while(c--){d[c].update()}c=d.length;while(c--){d[c].triggerCallbacks()}}function g(F,A){var I=this;this.watchItem=F;if(!A){this.offsets={top:0,bottom:0}}else{if(A===+A){this.offsets={top:A,bottom:A}}else{this.offsets=A}}this.callbacks={};j.forEach(function(J){I.callbacks[J]=[]});this.locked=false;var D=this.isInViewport;var G=this.isFullyInViewport;var H=this.isAboveViewport;var E=this.isBelowViewport;var z;var y;function C(J){if(J.length===0){return}z=J.length;while(z--){y=J[z];y.callback.call(I,m);if(y.isOne){J.splice(z,1)}}}this.triggerCallbacks=function B(){if(this.isInViewport&&!D){C(this.callbacks[u])}if(this.isFullyInViewport&&!G){C(this.callbacks[t])}if(this.isAboveViewport!==H&&this.isBelowViewport!==E){C(this.callbacks[v]);if(!G&&!this.isFullyInViewport){C(this.callbacks[t]);C(this.callbacks[f])}if(!D&&!this.isInViewport){C(this.callbacks[u]);C(this.callbacks[i])}}if(!this.isFullyInViewport&&G){C(this.callbacks[f])}if(!this.isInViewport&&D){C(this.callbacks[i])}if(this.isInViewport!==D){C(this.callbacks[v])}switch(true){case D!==this.isInViewport:case G!==this.isFullyInViewport:case H!==this.isAboveViewport:case E!==this.isBelowViewport:C(this.callbacks[h])}D=this.isInViewport;G=this.isFullyInViewport;H=this.isAboveViewport;E=this.isBelowViewport};this.recalculateLocation=function(){if(this.locked){return}var M=this.top;var L=this.bottom;if(this.watchItem.nodeName){var J=this.watchItem.style.display;if(J==="none"){this.watchItem.style.display=""}var K=e(this.watchItem).offset();this.top=K.top;this.bottom=K.top+this.watchItem.offsetHeight;if(J==="none"){this.watchItem.style.display=J}}else{if(this.watchItem===+this.watchItem){if(this.watchItem>0){this.top=this.bottom=this.watchItem}else{this.top=this.bottom=x.documentHeight-this.watchItem}}else{this.top=this.watchItem.top;this.bottom=this.watchItem.bottom}}this.top-=this.offsets.top;this.bottom+=this.offsets.bottom;this.height=this.bottom-this.top;if((M!==undefined||L!==undefined)&&(this.top!==M||this.bottom!==L)){C(this.callbacks[r])}};this.recalculateLocation();this.update()}g.prototype={on:function(y,A,z){switch(true){case y===v&&!this.isInViewport&&this.isAboveViewport:case y===u&&this.isInViewport:case y===t&&this.isFullyInViewport:case y===i&&this.isAboveViewport&&!this.isInViewport:case y===f&&this.isAboveViewport:A();if(z){return}}if(this.callbacks[y]){this.callbacks[y].push({callback:A,isOne:z})}else{throw new Error("Tried to add a scroll monitor listener of type "+y+". Your options are: "+j.join(", "))}},off:function(A,B){if(this.callbacks[A]){for(var y=0,z;z=this.callbacks[A][y];y++){if(z.callback===B){this.callbacks[A].splice(y,1);break}}}else{throw new Error("Tried to remove a scroll monitor listener of type "+A+". Your options are: "+j.join(", "))}},one:function(y,z){this.on(y,z,true)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<x.viewportTop;this.isBelowViewport=this.bottom>x.viewportBottom;this.isInViewport=(this.top<=x.viewportBottom&&this.bottom>=x.viewportTop);this.isFullyInViewport=(this.top>=x.viewportTop&&this.bottom<=x.viewportBottom)||(this.isAboveViewport&&this.isBelowViewport)},destroy:function(){var z=d.indexOf(this),y=this;d.splice(z,1);j.forEach(function(A){y.callbacks[A].length=0})},lock:function(){this.locked=true},unlock:function(){this.locked=false}};j.forEach(function(y){g.prototype[y]=function(A,z){this.on.call(this,y,A,z)}});n();function s(y){m=y;n();k()}q.on("scroll",s);q.on("resize",o);x.beget=function(z,A){if(typeof z==="string"){z=e(z)[0]}if(z instanceof jQuery){z=z[0]}var y=new g(z,A);d.push(y);y.update();return y};x.update=function(){m=null;n();k()};x.recalculateLocations=function(){x.documentHeight=0;x.update()};return x});