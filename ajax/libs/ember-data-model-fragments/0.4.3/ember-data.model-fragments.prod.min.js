/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2015 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.4.3
 */
(function(){var G=Ember;var aS=DS;var aU=DS.JSONAPISerializer;var f=DS.JSONSerializer;var aC=DS.InternalModel;var aG=DS.RootState;var af=DS.Model;var P=DS.Snapshot;var am=DS.Store;var au=DS.Transform;var aB=G.get;var w=Object.create||G.create;var aw=aG.loaded.saved.didSetProperty;var ae=aG.loaded.updated.uncommitted.propertyWasReset;var at=function(aZ){var e=aZ._owner;var a0=aZ._name;if(e){aI(e,a0,aZ)}};var i={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:aw,propertyWasReset:G.K,becomeDirty:G.K,rolledBack:G.K,empty:{isEmpty:true,loadedData:function(e){e.transitionTo("loaded.created")},pushedData:function(e){e.transitionTo("loaded.saved")}},loaded:{pushedData:function(e){e.transitionTo("saved")},saved:{setup:function(aZ){var e=aZ._owner;var a0=aZ._name;if(!e._internalModel._fragments[a0]){return}if(!aB(e,a0+".hasDirtyAttributes")){ah(e,a0,aZ)}},pushedData:G.K,didCommit:G.K,becomeDirty:function(e){e.transitionTo("updated")}},created:{isDirty:true,setup:at,didCommit:function(e){e.transitionTo("saved")}},updated:{isDirty:true,setup:at,propertyWasReset:ae,didCommit:function(e){e.transitionTo("saved")},rolledBack:function(e){e.transitionTo("saved")}}}};function O(e,aZ){for(var a0 in aZ){e[a0]=aZ[a0]}return e}function L(aZ,a0,e){aZ=O(a0?w(a0):{},aZ);aZ.parentState=a0;aZ.stateName=e;for(var a1 in aZ){if(!aZ.hasOwnProperty(a1)||a1==="parentState"||a1==="stateName"){continue}if(typeof aZ[a1]==="object"){aZ[a1]=L(aZ[a1],aZ,e+"."+a1)}}return aZ}i=L(i,null,"root");var aq=i;function aI(e,a0,aZ){if(!aB(e,"isDeleted")){e._internalModel._attributes[a0]=aZ;e.send("becomeDirty")}}function ah(e,aZ){delete e._internalModel._attributes[aZ];if(!aB(e,"isNew")){e.send("propertyWasReset",aZ)}}var y=G.get;var aH=G.set;var aW=G.computed;var v=G.copy;var D=G.makeArray;var aM=G.ArrayProxy.extend(G.Copyable,{owner:null,name:null,init:function(){this._super();this._pendingData=undefined;aH(this,"_originalState",[])},content:aW(function(){return G.A()}),copy:function(){return this.map(v)},setupData:function(a0){if(this._pendingData===a0){return}this._pendingData=a0;var e=this._normalizeData(D(a0));var aZ=y(this,"content");aH(this,"_originalState",e);aZ.replace(0,y(aZ,"length"),e);this._pendingData=undefined},_normalizeData:function(e){return e},_createSnapshot:function(){return this.toArray()},_flushChangedAttributes:function(){},_adapterDidCommit:function(e){if(e){this.setupData(e)}else{aH(this,"_originalState",this.toArray())}},isDirty:aW("hasDirtyAttributes",function(){return this.get("hasDirtyAttributes")}),hasDirtyAttributes:aW("[]","_originalState",function(){return G.compare(this.toArray(),y(this,"_originalState"))!==0}),rollback:function(){this.rollbackAttributes()},rollbackAttributes:function(){this.setObjects(y(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var e=y(this,"owner");var aZ=y(this,"name");if(y(this,"hasDirtyAttributes")){aI(e,aZ,this)}else{ah(e,aZ)}},toStringExtension:function(){return"owner("+y(this,"owner.id")+")"}});var aL=aM;var aY=Object.keys||Ember.keys;var aO=Object.create||Ember.create;am.reopen({createFragment:function(e,a2){var a1=this.modelFor(e);Ember.assert("The '"+a1+"' model must be a subclass of MF.Fragment",J.detect(a1));var aZ=new aC(a1,null,this,this.container);aZ.currentState=aq.empty;aZ._name=null;aZ._owner=null;aZ.loadedData();var a0=aZ.getRecord();if(a2){a0.setProperties(a2)}a0._isFragment=true;return a0}});af.reopen({changedAttributes:function(){var aZ=this._super();var e=t(this);aY(e._fragments).forEach(function(a0){if(a0 in e._attributes){aZ[a0]=true}},this);return aZ}});function aK(a1,e,aZ){var a0=a1[e];a1[e]=function(){var a2=a0.apply(this,arguments);return aZ.call(this,a2,arguments)}}var T=aC.prototype;aK(T,"createSnapshot",function av(e){var aZ=e._attributes;aY(aZ).forEach(function(a1){var a0=aZ[a1];if(a0&&typeof a0._createSnapshot==="function"){aZ[a1]=a0._createSnapshot()}});return e});aK(T,"rollbackAttributes",function u(){for(var e in this._fragments){if(this._fragments[e]){this._fragments[e].rollbackAttributes()}}});aK(T,"flushChangedAttributes",function ax(){var e;for(var aZ in this._fragments){if(e=this._fragments[aZ]){e._flushChangedAttributes()}}});aK(T,"adapterDidCommit",function aA(a2,a0){var e=(a0[0]&&a0[0].attributes)||aO(null);var aZ;for(var a1 in this._fragments){if(aZ=this._fragments[a1]){aZ._adapterDidCommit(e[a1])}}});f.reopen({transformFor:function(e){if(e.indexOf("-mf-")===0){return m(this.container,this.store,e)}return this._super.apply(this,arguments)}});function m(a1,a7,a2){var aZ=a1._registry||a1.registry||a1;var a5="transform:"+a2;var a4=a2.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/);var a6=a4[1];var a3=a4[2];var e=a4[3];if(!aZ.has(a5)){var a0=a1.lookupFactory("transform:"+a6);aZ.register(a5,a0.extend({store:a7,type:a3,polymorphicTypeProp:e}))}return a1.lookup(a5)}var o=G.get;var aX=Object.create||G.create;var N=G.copy;var B=af.extend(G.Comparable,G.Copyable,{compare:function(e,aZ){return e===aZ?0:1},copy:function(){var aZ=this.constructor;var e=aX(null);aZ.eachAttribute(function(a0){e[a0]=N(o(this,a0))},this);return this.store.createFragment(aZ.modelName,e)},_flushChangedAttributes:function(){t(this).flushChangedAttributes()},_adapterDidCommit:function(e){t(this).adapterDidCommit({attributes:e||aX(null)})},toStringExtension:function(){return"owner("+o(t(this)._owner,"id")+")"}}).reopenClass({fragmentOwnerProperties:G.computed(function(){var e=[];this.eachComputedProperty(function(aZ,a0){if(a0.isFragmentOwner){e.push(aZ)}});return e}).readOnly()});function z(aZ,e,a2){if(!e.polymorphic||!a2){return aZ}var a1=e.typeKey||"type";var a0=a2[a1];return a0||aZ}function t(e){var aZ=e._internalModel;if(!aZ._fragments){aZ._fragments=aX(null)}return aZ}function E(a0,e,a1){var aZ=t(a0);aZ._owner=e;aZ._name=a1;o(a0.constructor,"fragmentOwnerProperties").forEach(function(a2){a0.notifyPropertyChange(a2)});return a0}var J=B;function aF(e,aZ){if(aZ instanceof e){return true}else{if(Ember.MODEL_FACTORY_INJECTIONS){return aZ instanceof e.superclass}}return false}var b=aF;function W(aZ,a0,e){return aZ.map?aZ.map(a0,e):d.call(aZ,a0,e)}var aj=W;function d(aZ){if(this===void 0||this===null||typeof aZ!=="function"){throw new TypeError()}var a3=Object(this);var e=a3.length>>>0;var a2=new Array(e);var a1=arguments[1];for(var a0=0;a0<e;a0++){if(a0 in a3){a2[a0]=aZ.call(a1,a3[a0],a0,a3)}}return a2}var I=G.get;var F=G.computed;var S=G.typeOf;function q(a2,a3,aZ){var a0=I(a2,"owner");var a4=I(a0,"store");var e=I(a2,"type");var a6=I(a2,"options");var a5=I(a2,"name");var a1;return aj(aZ,function(ba,a8){if(ba._isFragment){a1=ba;var a7=t(a1)._owner;if(!a7){E(a1,a0,a5)}}else{a1=a3[a8];if(!a1){var a9=z(e,a6,ba);a1=a4.createFragment(a9);E(a1,a0,a5)}t(a1).setupData({attributes:ba})}return a1})}var ai=aL.extend({type:null,options:null,_normalizeData:function(aZ){var e=I(this,"content");return q(this,e,aZ)},_createSnapshot:function(){return this.map(function(e){return e._createSnapshot()})},_flushChangedAttributes:function(){this.map(function(e){e._flushChangedAttributes()})},_adapterDidCommit:function(e){this._super(e);this.forEach(function(a0,aZ){a0._adapterDidCommit(e&&e[aZ])})},hasDirtyAttributes:F("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super();this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(aZ,a0,a3){var a1=I(this,"content");var a2=a1.slice(aZ,aZ+a0);var e=q(this,a2,a3);if(e.length<a2.length){a2.slice(e.length).forEach(function(a4){E(a4,null,null)})}return a1.replace(aZ,a0,e)},addFragment:function(e){return this.addObject(e)},removeFragment:function(e){return this.removeObject(e)},createFragment:function(a2){var e=I(this,"owner");var aZ=I(e,"store");var a1=I(this,"type");var a0=aZ.createFragment(a1,a2);return this.pushObject(a0)}});var aV=ai;var al=window.Ember;var l=al.computed;var k;try{al.computed({set:function(){},get:function(){}});k=true}catch(ac){k=false}var n=function(){var a2=[];var aZ=arguments[arguments.length-1];if(typeof aZ==="function"||k){return l.apply(this,arguments)}for(var a0=0,e=arguments.length-1;a0<e;a0++){a2.push(arguments[a0])}var a1;if(aZ.set){a1=function(a3,a4){if(arguments.length>1){return aZ.set.call(this,a3,a4)}else{return aZ.get.call(this,a3)}}}else{a1=function(a3){return aZ.get.call(this,a3)}}a2.push(a1);return l.apply(this,a2)};var r=G.get;var aT=G.isArray;var g=G.typeOf;var az=G.copy;var aJ=G.computed;function c(aZ,a0,e){var a1="-mf-"+aZ;if(a0){a1+="$"+a0}if(e&&e.polymorphic){a1+="$"+(e.typeKey||"type")}return a1}function H(a1,a0){a0=a0||{};var a2=c("fragment",a1,a0);function aZ(a6,a4,a8){var a5=t(a4);var a9=U(a5,a8,a0,"object");var a7=a5._fragments[a8];var a3=z(a1,a0,a9);if(!a7&&b(a6.modelFor(a3),a9)){a7=a9}else{if(a9&&a9!==a7){a7||(a7=A(a6,a3,a4,a8));a5._data[a8]=a7;t(a7).setupData({attributes:a9})}else{a7=a9}}return a7}function e(a4,a8,a7,a9){var a6=a4.store;var a5=t(a4);if(a7&&a7!==a9){E(a7,null,null)}if(a9){if(g(a9)==="object"){if(!a7){var a3=z(a1,a0,a9);a7=A(a6,a3,a4,a8)}a7.setProperties(a9)}else{a7=E(a9,a4,a8)}}else{a7=null}if(a5._data[a8]!==a7){aI(a4,a8,a7)}else{ah(a4,a8)}return a7}return j(a2,a0,aZ,e)}function ao(e,aZ){aZ||(aZ={});var a1=c("fragment-array",e,aZ);return R(a1,aZ,function a0(a2,a3){return aV.create({type:e,options:aZ,name:a3,owner:a2})})}function aN(a0,aZ){if(typeof a0==="object"){aZ=a0;a0=undefined}else{aZ||(aZ={})}var a1=c("array",a0);return R(a1,aZ,function e(a2,a3){return aL.create({options:aZ,name:a3,owner:a2})})}function j(a1,a0,aZ,e){a0=a0||{};var a2={type:a1,isAttribute:true,isFragment:true,options:a0};return n({get:function(a5){var a3=t(this);var a4=aZ(this.store,this,a5);return a3._fragments[a5]=a4},set:function(a5,a6){var a3=t(this);var a4=aZ(this.store,this,a5);a4=e(this,a5,a4,a6);return a3._fragments[a5]=a4}}).meta(a2)}function R(a2,a1,aZ){function a0(a6,a4,a7){var a5=t(a4);var a8=U(a5,a7,a1,"array");var a3=a5._fragments[a7]||null;if(a8 instanceof aL&&!a3){a3=a8}else{if(a8&&a8!==a3){a3||(a3=aZ(a4,a7));a5._data[a7]=a3;a3.setupData(a8)}else{a3=a8}}return a3}function e(a4,a6,a3,a7){var a5=t(a4);if(aT(a7)){a3||(a3=aZ(a4,a6));a3.setObjects(a7)}else{if(a7===null){a3=null}else{}}if(a5._data[a6]!==a3||r(a3,"hasDirtyAttributes")){aI(a4,a6,a3)}else{ah(a4,a6)}return a3}return j(a2,a1,a0,e)}function ap(){return aJ(function(){return t(this)._owner}).meta({isFragmentOwner:true}).readOnly()}function V(e,aZ,a0){var a1;G.warn("The default value of fragment array properties will change from `null` to an empty array in v1.0. This warning can be silenced by explicitly setting a default value with the option `{ defaultValue: null }`",a0!=="array"||"defaultValue" in aZ);if(typeof aZ.defaultValue==="function"){a1=aZ.defaultValue()}else{if("defaultValue" in aZ){a1=aZ.defaultValue}else{return null}}return az(a1,true)}function A(aZ,a1,e,a0){return E(aZ.createFragment(a1),e,a0)}function U(e,a0,aZ,a1){if(a0 in e._data){return e._data[a0]}else{return V(e,aZ,a1)}}var ar=G.get;var ag=G.makeArray;var p=G.computed;var ab=au.extend({store:null,type:null,deserialize:function ay(aZ){if(aZ==null){return null}var e=ar(this,"transform");aZ=ag(aZ);if(!e){return aZ}return aj(aZ,e.deserialize,e)},serialize:function aD(aZ){if(aZ==null){return null}var e=ar(this,"transform");aZ=aZ.toArray?aZ.toArray():aZ;if(!e){return aZ}return aj(aZ,e.serialize,e)},transform:p("type",function(){var aZ=this.get("type");if(!aZ){return null}var e=ar(this,"store").container.lookup("transform:"+aZ);return e})});var Z=ab;var M=G.get;var Y=au.extend({store:null,type:null,polymorphicTypeProp:null,deserialize:function aR(e){if(e==null){return null}return this.deserializeSingle(e)},serialize:function K(aZ){if(!aZ){return null}var e=this.store;var a0=e.serializerFor(aZ.modelName);return a0.serialize(aZ)},modelNameFor:function h(a0){var aZ=M(this,"type");var e=M(this,"polymorphicTypeProp");if(a0&&e&&a0[e]){aZ=a0[e]}return aZ},deserializeSingle:function aQ(a2){var aZ=this.store;var e=this.modelNameFor(a2);var a0=aZ.serializerFor(e);var a4=M(a0,"isNewSerializerAPI");var a1=aZ.modelFor(e);var a3=a0.normalize(a1,a2);if(a4){return M(a3,"data.attributes")}else{return a3}}});var aP=Y;var an=aP.extend({deserialize:function aa(e){if(e==null){return null}return aj(e,function(aZ){return this.deserializeSingle(aZ)},this)},serialize:function s(aZ){if(!aZ){return null}var e=this.store;return aj(aZ,function(a0){var a1=e.serializerFor(a0.modelName);return a1.serialize(a0)})}});var X=an;var a=[{name:"fragmentTransform",before:"store",initialize:function(e,aZ){if(!aZ){aZ=e}aZ.register("transform:fragment",aP);aZ.register("transform:fragment-array",X);aZ.register("transform:array",Z)}}];var C=a;aS.ModelFragment=J;aS.FragmentArray=aV;aS.FragmentTransform=aP;aS.FragmentArrayTransform=X;aS.ArrayTransform=Z;aS.hasOneFragment=function ad(e,aZ){return H(e,aZ)};aS.hasManyFragments=function x(e,aZ){if(G.typeOf(e)!=="string"){return aN(null,aZ)}return ao(e,aZ)};aS.fragmentOwner=function ak(){return ap()};var aE=G.Namespace.create({VERSION:"0.4.3",Fragment:J,FragmentArray:aV,FragmentTransform:aP,FragmentArrayTransform:X,ArrayTransform:Z,fragment:H,fragmentArray:ao,array:aN,fragmentOwner:ap});G.onLoad("Ember.Application",function(e){C.forEach(e.initializer,e)});if(G.libraries){G.libraries.register("Model Fragments",aE.VERSION)}G.lookup.MF=aE;var Q=aE}).call(this);