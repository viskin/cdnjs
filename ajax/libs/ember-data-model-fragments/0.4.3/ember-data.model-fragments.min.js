(function(){"use strict";var t=Ember;var r=DS;var e=DS.JSONAPISerializer;var n=DS.JSONSerializer;var a=DS.InternalModel;var i=DS.RootState;var o=DS.Model;var s=DS.Snapshot;var u=DS.Store;var f=DS.Transform;var l=t.get;var c=Object.create||t.create;var m=i.loaded.saved.didSetProperty;var v=i.loaded.updated.uncommitted.propertyWasReset;var h=function(t){var r=t._owner;var e=t._name;if(r){_(r,e,t)}};var p={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:m,propertyWasReset:t.K,becomeDirty:t.K,rolledBack:t.K,empty:{isEmpty:true,loadedData:function(t){t.transitionTo("loaded.created")},pushedData:function(t){t.transitionTo("loaded.saved")}},loaded:{pushedData:function(t){t.transitionTo("saved")},saved:{setup:function(t){var r=t._owner;var e=t._name;if(!r._internalModel._fragments[e]){return}if(!l(r,e+".hasDirtyAttributes")){b(r,e,t)}},pushedData:t.K,didCommit:t.K,becomeDirty:function(t){t.transitionTo("updated")}},created:{isDirty:true,setup:h,didCommit:function(t){t.transitionTo("saved")}},updated:{isDirty:true,setup:h,propertyWasReset:v,didCommit:function(t){t.transitionTo("saved")},rolledBack:function(t){t.transitionTo("saved")}}}};function d(t,r){for(var e in r){t[e]=r[e]}return t}function g(t,r,e){t=d(r?c(r):{},t);t.parentState=r;t.stateName=e;for(var n in t){if(!t.hasOwnProperty(n)||n==="parentState"||n==="stateName"){continue}if(typeof t[n]==="object"){t[n]=g(t[n],t,e+"."+n)}}return t}p=g(p,null,"root");var y=p;function _(t,r,e){if(!l(t,"isDeleted")){t._internalModel._attributes[r]=e;t.send("becomeDirty")}}function b(t,r){delete t._internalModel._attributes[r];if(!l(t,"isNew")){t.send("propertyWasReset",r)}}var D=t.get;var A=t.set;var S=t.computed;var F=t.copy;var w=t.makeArray;var O=t.ArrayProxy.extend(t.Copyable,{owner:null,name:null,init:function(){this._super();this._pendingData=undefined;A(this,"_originalState",[])},content:S(function(){return t.A()}),copy:function(){return this.map(F)},setupData:function(t){if(this._pendingData===t){return}this._pendingData=t;var r=this._normalizeData(w(t));var e=D(this,"content");A(this,"_originalState",r);e.replace(0,D(e,"length"),r);this._pendingData=undefined},_normalizeData:function(t){return t},_createSnapshot:function(){return this.toArray()},_flushChangedAttributes:function(){},_adapterDidCommit:function(t){if(t){this.setupData(t)}else{A(this,"_originalState",this.toArray())}},isDirty:S("hasDirtyAttributes",function(){return this.get("hasDirtyAttributes")}),hasDirtyAttributes:S("[]","_originalState",function(){return t.compare(this.toArray(),D(this,"_originalState"))!==0}),rollback:function(){this.rollbackAttributes()},rollbackAttributes:function(){this.setObjects(D(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var t=D(this,"owner");var r=D(this,"name");if(D(this,"hasDirtyAttributes")){_(t,r,this)}else{b(t,r)}},toStringExtension:function(){return"owner("+D(this,"owner.id")+")"}});var z=O;var C=Object.keys||Ember.keys;var T=Object.create||Ember.create;u.reopen({createFragment:function(t,r){var e=this.modelFor(t);Ember.assert("The '"+e+"' model must be a subclass of MF.Fragment",K.detect(e));var n=new a(e,null,this,this.container);n.currentState=y.empty;n._name=null;n._owner=null;n.loadedData();var i=n.getRecord();if(r){i.setProperties(r)}i._isFragment=true;return i}});o.reopen({changedAttributes:function(){var t=this._super();var r=V(this);C(r._fragments).forEach(function(e){if(e in r._attributes){t[e]=true}},this);return t}});function E(t,r,e){var n=t[r];t[r]=function(){var t=n.apply(this,arguments);return e.call(this,t,arguments)}}var k=a.prototype;E(k,"createSnapshot",function Nt(t){var r=t._attributes;C(r).forEach(function(t){var e=r[t];if(e&&typeof e._createSnapshot==="function"){r[t]=e._createSnapshot()}});return t});E(k,"rollbackAttributes",function Pt(){for(var t in this._fragments){if(this._fragments[t]){this._fragments[t].rollbackAttributes()}}});E(k,"flushChangedAttributes",function jt(){var t;for(var r in this._fragments){if(t=this._fragments[r]){t._flushChangedAttributes()}}});E(k,"adapterDidCommit",function xt(t,r){var e=r[0]&&r[0].attributes||T(null);var n;for(var a in this._fragments){if(n=this._fragments[a]){n._adapterDidCommit(e[a])}}});n.reopen({transformFor:function(t){if(t.indexOf("-mf-")===0){return N(this.container,this.store,t)}return this._super.apply(this,arguments)}});function N(t,r,e){var n=t._registry||t.registry||t;var a="transform:"+e;var i=e.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/);var o=i[1];var s=i[2];var u=i[3];if(!n.has(a)){var f=t.lookupFactory("transform:"+o);n.register(a,f.extend({store:r,type:s,polymorphicTypeProp:u}))}return t.lookup(a)}var P=t.get;var j=Object.create||t.create;var x=t.copy;var M=o.extend(t.Comparable,t.Copyable,{compare:function(t,r){return t===r?0:1},copy:function(){var t=this.constructor;var r=j(null);t.eachAttribute(function(t){r[t]=x(P(this,t))},this);return this.store.createFragment(t.modelName,r)},_flushChangedAttributes:function(){V(this).flushChangedAttributes()},_adapterDidCommit:function(t){V(this).adapterDidCommit({attributes:t||j(null)})},toStringExtension:function(){return"owner("+P(V(this)._owner,"id")+")"}}).reopenClass({fragmentOwnerProperties:t.computed(function(){var t=[];this.eachComputedProperty(function(r,e){if(e.isFragmentOwner){t.push(r)}});return t}).readOnly()});function R(t,r,e){if(!r.polymorphic||!e){return t}var n=r.typeKey||"type";var a=e[n];return a||t}function V(t){var r=t._internalModel;if(!r._fragments){r._fragments=j(null)}return r}function I(t,r,e){var n=V(t);n._owner=r;n._name=e;P(t.constructor,"fragmentOwnerProperties").forEach(function(r){t.notifyPropertyChange(r)});return t}var K=M;function $(t,r){if(r instanceof t){return true}else if(Ember.MODEL_FACTORY_INJECTIONS){return r instanceof t.superclass}return false}var L=$;function W(t,r,e){return t.map?t.map(r,e):B.call(t,r,e)}var J=W;function B(t){if(this===void 0||this===null||typeof t!=="function"){throw new TypeError}var r=Object(this);var e=r.length>>>0;var n=new Array(e);var a=arguments[1];for(var i=0;i<e;i++){if(i in r){n[i]=t.call(a,r[i],i,r)}}return n}var Y=t.get;var q=t.computed;var G=t.typeOf;function H(t,r,e){var n=Y(t,"owner");var a=Y(n,"store");var i=Y(t,"type");var o=Y(t,"options");var s=Y(t,"name");var u;return J(e,function(t,e){if(t._isFragment){u=t;var f=V(u)._owner;if(!f){I(u,n,s)}}else{u=r[e];if(!u){var l=R(i,o,t);u=a.createFragment(l);I(u,n,s)}V(u).setupData({attributes:t})}return u})}var Q=z.extend({type:null,options:null,_normalizeData:function(t){var r=Y(this,"content");return H(this,r,t)},_createSnapshot:function(){return this.map(function(t){return t._createSnapshot()})},_flushChangedAttributes:function(){this.map(function(t){t._flushChangedAttributes()})},_adapterDidCommit:function(t){this._super(t);this.forEach(function(r,e){r._adapterDidCommit(t&&t[e])})},hasDirtyAttributes:q("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super();this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(t,r,e){var n=Y(this,"content");var a=n.slice(t,t+r);var i=H(this,a,e);if(i.length<a.length){a.slice(i.length).forEach(function(t){I(t,null,null)})}return n.replace(t,r,i)},addFragment:function(t){return this.addObject(t)},removeFragment:function(t){return this.removeObject(t)},createFragment:function(t){var r=Y(this,"owner");var e=Y(r,"store");var n=Y(this,"type");var a=e.createFragment(n,t);return this.pushObject(a)}});var U=Q;var X=window.Ember;var Z=X.computed;var tt;try{X.computed({set:function(){},get:function(){}});tt=true}catch(rt){tt=false}var et=function(){var t=[];var r=arguments[arguments.length-1];if(typeof r==="function"||tt){return Z.apply(this,arguments)}for(var e=0,n=arguments.length-1;e<n;e++){t.push(arguments[e])}var a;if(r.set){a=function(t,e){if(arguments.length>1){return r.set.call(this,t,e)}else{return r.get.call(this,t)}}}else{a=function(t){return r.get.call(this,t)}}t.push(a);return Z.apply(this,t)};var nt=t.get;var at=t.isArray;var it=t.typeOf;var ot=t.copy;var st=t.computed;function ut(t,r,e){var n="-mf-"+t;if(r){n+="$"+r}if(e&&e.polymorphic){n+="$"+(e.typeKey||"type")}return n}function ft(t,r){r=r||{};var e=ut("fragment",t,r);function n(e,n,a){var i=V(n);var o=gt(i,a,r,"object");var s=i._fragments[a];var u=R(t,r,o);if(!s&&L(e.modelFor(u),o)){s=o}else if(o&&o!==s){s||(s=dt(e,u,n,a));i._data[a]=s;V(s).setupData({attributes:o})}else{s=o}return s}function a(e,n,a,i){var o=e.store;var s=V(e);if(a&&a!==i){I(a,null,null)}if(i){if(it(i)==="object"){if(!a){var u=R(t,r,i);a=dt(o,u,e,n)}a.setProperties(i)}else{a=I(i,e,n)}}else{a=null}if(s._data[n]!==a){_(e,n,a)}else{b(e,n)}return a}return mt(e,r,n,a)}function lt(t,r){r||(r={});var e=ut("fragment-array",t,r);return vt(e,r,function n(e,a){return U.create({type:t,options:r,name:a,owner:e})})}function ct(t,r){if(typeof t==="object"){r=t;t=undefined}else{r||(r={})}var e=ut("array",t);return vt(e,r,function n(t,e){return z.create({options:r,name:e,owner:t})})}function mt(t,r,e,n){r=r||{};var a={type:t,isAttribute:true,isFragment:true,options:r};return et({get:function(t){var r=V(this);var n=e(this.store,this,t);return r._fragments[t]=n},set:function(t,r){var a=V(this);var i=e(this.store,this,t);i=n(this,t,i,r);return a._fragments[t]=i}}).meta(a)}function vt(t,r,e){function n(t,n,a){var i=V(n);var o=gt(i,a,r,"array");var s=i._fragments[a]||null;if(o instanceof z&&!s){s=o}else if(o&&o!==s){s||(s=e(n,a));i._data[a]=s;s.setupData(o)}else{s=o}return s}function a(t,r,n,a){var i=V(t);if(at(a)){n||(n=e(t,r));n.setObjects(a)}else if(a===null){n=null}else{}if(i._data[r]!==n||nt(n,"hasDirtyAttributes")){_(t,r,n)}else{b(t,r)}return n}return mt(t,r,n,a)}function ht(){return st(function(){return V(this)._owner}).meta({isFragmentOwner:true}).readOnly()}function pt(r,e,n){var a;t.warn("The default value of fragment array properties will change from `null` to an empty array in v1.0. "+"This warning can be silenced by explicitly setting a default value with the option `{ defaultValue: null }`",n!=="array"||"defaultValue"in e);if(typeof e.defaultValue==="function"){a=e.defaultValue()}else if("defaultValue"in e){a=e.defaultValue}else{return null}return ot(a,true)}function dt(t,r,e,n){return I(t.createFragment(r),e,n)}function gt(t,r,e,n){if(r in t._data){return t._data[r]}else{return pt(t,e,n)}}var yt=t.get;var _t=t.makeArray;var bt=t.computed;var Dt=f.extend({store:null,type:null,deserialize:function Mt(t){if(t==null){return null}var r=yt(this,"transform");t=_t(t);if(!r){return t}return J(t,r.deserialize,r)},serialize:function Rt(t){if(t==null){return null}var r=yt(this,"transform");t=t.toArray?t.toArray():t;if(!r){return t}return J(t,r.serialize,r)},transform:bt("type",function(){var t=this.get("type");if(!t){return null}var r=yt(this,"store").container.lookup("transform:"+t);return r})});var At=Dt;var St=t.get;var Ft=f.extend({store:null,type:null,polymorphicTypeProp:null,deserialize:function Vt(t){if(t==null){return null}return this.deserializeSingle(t)},serialize:function It(t){if(!t){return null}var r=this.store;var e=r.serializerFor(t.modelName);return e.serialize(t)},modelNameFor:function Kt(t){var r=St(this,"type");var e=St(this,"polymorphicTypeProp");if(t&&e&&t[e]){r=t[e]}return r},deserializeSingle:function $t(t){var r=this.store;var e=this.modelNameFor(t);var n=r.serializerFor(e);var a=St(n,"isNewSerializerAPI");var i=r.modelFor(e);var o=n.normalize(i,t);if(a){return St(o,"data.attributes")}else{return o}}});var wt=Ft;var Ot=wt.extend({deserialize:function Lt(t){if(t==null){return null}return J(t,function(t){return this.deserializeSingle(t)},this)},serialize:function Wt(t){if(!t){return null}var r=this.store;return J(t,function(t){var e=r.serializerFor(t.modelName);return e.serialize(t)})}});var zt=Ot;var Ct=[{name:"fragmentTransform",before:"store",initialize:function(t,r){if(!r){r=t}r.register("transform:fragment",wt);r.register("transform:fragment-array",zt);r.register("transform:array",At)}}];var Tt=Ct;r.ModelFragment=K;r.FragmentArray=U;r.FragmentTransform=wt;r.FragmentArrayTransform=zt;r.ArrayTransform=At;r.hasOneFragment=function Jt(t,r){return ft(t,r)};r.hasManyFragments=function Bt(r,e){if(t.typeOf(r)!=="string"){return ct(null,e)}return lt(r,e)};r.fragmentOwner=function Yt(){return ht()};var Et=t.Namespace.create({VERSION:"0.4.3",Fragment:K,FragmentArray:U,FragmentTransform:wt,FragmentArrayTransform:zt,ArrayTransform:At,fragment:ft,fragmentArray:lt,array:ct,fragmentOwner:ht});t.onLoad("Ember.Application",function(t){Tt.forEach(t.initializer,t)});if(t.libraries){t.libraries.register("Model Fragments",Et.VERSION)}t.lookup.MF=Et;var kt=Et}).call(this);