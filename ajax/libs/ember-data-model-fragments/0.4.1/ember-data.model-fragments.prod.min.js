/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2015 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.4.1
 */
(function(){var x=Ember;var aB=DS;var aC=DS.JSONAPISerializer;var d=DS.JSONSerializer;var an=DS.InternalModel;var aq=DS.RootState;var U=DS.Model;var F=DS.Snapshot;var aa=DS.Store;var af=DS.Transform;var am=x.get;var q=Object.create||x.create;var ai=aq.loaded.saved.didSetProperty;var T=aq.loaded.updated.uncommitted.propertyWasReset;var ae=function(aJ){var e=aJ._owner;var aK=aJ._name;if(e){at(e,aK,aJ)}};var g={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:ai,propertyWasReset:x.K,becomeDirty:x.K,rolledBack:x.K,empty:{isEmpty:true,loadedData:function(e){e.transitionTo("loaded.created")},pushedData:function(e){e.transitionTo("loaded.saved")}},loaded:{pushedData:function(e){e.transitionTo("saved")},saved:{setup:function(aJ){var e=aJ._owner;var aK=aJ._name;if(!e._internalModel._fragments[aK]||aJ._isInitializing){return}if(!am(e,aK+".hasDirtyAttributes")){W(e,aK,aJ)}},pushedData:x.K,didCommit:x.K,becomeDirty:function(e){e.transitionTo("updated")}},created:{isDirty:true,setup:ae,didCommit:function(e){e.transitionTo("saved")}},updated:{isDirty:true,setup:ae,propertyWasReset:T,didCommit:function(e){e.transitionTo("saved")},rolledBack:function(e){e.transitionTo("saved")}}}};function D(e,aJ){for(var aK in aJ){e[aK]=aJ[aK]}return e}function B(aJ,aK,e){aJ=D(aK?q(aK):{},aJ);aJ.parentState=aK;aJ.stateName=e;for(var aL in aJ){if(!aJ.hasOwnProperty(aL)||aL==="parentState"||aL==="stateName"){continue}if(typeof aJ[aL]==="object"){aJ[aL]=B(aJ[aL],aJ,e+"."+aL)}}return aJ}g=B(g,null,"root");var ad=g;function at(e,aK,aJ){if(!am(e,"isDeleted")){e._internalModel._attributes[aK]=aJ;e.send("becomeDirty")}}function W(e,aJ){delete e._internalModel._attributes[aJ];if(!am(e,"isNew")){e.send("propertyWasReset",aJ)}}var s=x.get;var ar=x.set;var aH=x.computed;var p=x.copy;var ax=x.ArrayProxy.extend(x.Copyable,{owner:null,name:null,init:function(){this._super();this._pendingData=undefined;ar(this,"_originalState",[])},content:aH(function(){return x.A()}),copy:function(){return this.map(p)},setupData:function(aJ){if(this._pendingData===aJ){return}this._pendingData=aJ;var e=this._processData(aJ);ar(this,"_originalState",e);this.replaceContent(0,s(this,"content.length"),e);this._pendingData=undefined},_processData:function(e){return x.makeArray(e)},_createSnapshot:function(){return this.toArray()},_adapterDidCommit:function(e){if(e){this.setupData(e)}else{ar(this,"_originalState",this.toArray())}},isDirty:aH("hasDirtyAttributes",function(){return this.get("hasDirtyAttributes")}),hasDirtyAttributes:aH("[]","_originalState",function(){return x.compare(this.toArray(),s(this,"_originalState"))!==0}),rollback:function(){this.rollbackAttributes()},rollbackAttributes:function(){this.setObjects(s(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var e=s(this,"owner");var aJ=s(this,"name");if(s(this,"hasDirtyAttributes")){at(e,aJ,this)}else{W(e,aJ)}},toStringExtension:function(){return"owner("+s(this,"owner.id")+")"}});var aw=ax;var aI=Object.keys||Ember.keys;aa.reopen({createFragment:function(e,aM){var aL=this.modelFor(e);Ember.assert("The '"+aL+"' model must be a subclass of DS.ModelFragment",w.detect(aL));var aJ=new an(aL,null,this,this.container);aJ.currentState=ad.empty;aJ._name=null;aJ._owner=null;aJ.loadedData();var aK=aJ.getRecord();if(aM){aK.setProperties(aM)}return aK}});U.reopen({changedAttributes:function(){var aJ=this._super();var e=au(this);aI(e._fragments).forEach(function(aK){if(aK in e._attributes){aJ[aK]=true}},this);return aJ}});function av(aL,e,aJ){var aK=aL[e];aL[e]=function(){var aM=aK.apply(this,arguments);return aJ.call(this,aM,arguments)}}var J=an.prototype;av(J,"createSnapshot",function ah(e){var aJ=e._attributes;aI(aJ).forEach(function(aL){var aK=aJ[aL];if(aK&&typeof aK._createSnapshot==="function"){aJ[aL]=aK._createSnapshot()}});return e});av(J,"rollbackAttributes",function o(){for(var e in this._fragments){if(this._fragments[e]){this._fragments[e].rollbackAttributes()}}});av(J,"adapterDidCommit",function z(aM,aK){var e=(aK[0]&&aK[0].attributes)||{};var aJ;for(var aL in this._fragments){if(aJ=this._fragments[aL]){aJ._adapterDidCommit(e[aL])}}});d.reopen({transformFor:function(e){if(e.indexOf("-mf-")===0){return k(this.container,this.store,e)}return this._super.apply(this,arguments)}});function k(aL,aR,aM){var aJ=aL._registry||aL;var aP="transform:"+aM;var aO=aM.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/);var aN=aO[1];var aQ=aO[2];var e=aO[3];if(!aJ.has(aP)){var aK=aL.lookupFactory("transform:"+aN);aJ.register(aP,aK.extend({store:aR,modelName:aQ,polymorphicTypeProp:e}))}return aL.lookup(aP)}var ag=x.get;var aF=Object.create||x.create;var u=x.copy;var aj=U.extend(x.Comparable,x.Copyable,{compare:function(e,aJ){return e===aJ?0:1},copy:function(){var aJ=this.constructor;var e={};aJ.eachAttribute(function(aK){e[aK]=u(ag(this,aK))},this);return this.store.createFragment(aJ.modelName,e)},_adapterDidCommit:function(e){au(this).setupData({attributes:e||{}})},toStringExtension:function(){return"owner("+ag(au(this)._owner,"id")+")"}});function ak(aJ,e,aM){if(!e.polymorphic||!aM){return aJ}var aL=e.typeKey||"type";var aK=aM[aL];return aK||aJ}function au(e){var aJ=e._internalModel;if(!aJ._fragments){aJ._fragments=aF(null)}return aJ}function aD(aK,e,aL){var aJ=au(aK);aJ._owner=e;aJ._name=aL;return aK}var w=aj;function L(aJ,aK,e){return aJ.map?aJ.map(aK,e):c.call(aJ,aK,e)}var Y=L;function c(aJ){if(this===void 0||this===null||typeof aJ!=="function"){throw new TypeError()}var aN=Object(this);var e=aN.length>>>0;var aM=new Array(e);var aL=arguments[1];for(var aK=0;aK<e;aK++){if(aK in aN){aM[aK]=aJ.call(aL,aN[aK],aK,aN)}}return aM}var y=x.get;var v=x.computed;var X=aw.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},_processData:function(aP){var e=y(this,"owner");var aJ=y(e,"store");var aM=y(this,"type");var aL=y(this,"options");var aN=y(this,"name");var aO=y(this,"content");this._isInitializing=true;var aK=Y(x.makeArray(aP),function(aT,aR){var aQ=aO[aR];if(!aQ){var aS=ak(aM,aL,aT);aQ=aJ.createFragment(aS);aD(aQ,e,aN)}au(aQ).setupData({attributes:aT});return aQ});this._isInitializing=false;return aK},_createSnapshot:function(){return this.map(function(e){return e._createSnapshot()})},_adapterDidCommit:function(e){this._super(e);if(!e){this.forEach(function(aJ){aJ._adapterDidCommit()})}},hasDirtyAttributes:v("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super();this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(aJ,aN,e){var aM=this;var aK=y(this,"owner");var aL=y(this,"name");if(e){e.forEach(function(aP){var aO=au(aP)._owner;if(!aO){aD(aP,aK,aL)}})}return y(this,"content").replace(aJ,aN,e)},addFragment:function(e){return this.addObject(e)},removeFragment:function(e){return this.removeObject(e)},createFragment:function(aM){var e=y(this,"owner");var aJ=y(e,"store");var aL=y(this,"type");var aK=aJ.createFragment(aL,aM);return this.pushObject(aK)}});var aE=X;var Z=window.Ember;var j=Z.computed;var i;try{Z.computed({set:function(){},get:function(){}});i=true}catch(R){i=false}var l=function(){var aM=[];var aJ=arguments[arguments.length-1];if(typeof aJ==="function"||i){return j.apply(this,arguments)}for(var aK=0,e=arguments.length-1;aK<e;aK++){aM.push(arguments[aK])}var aL;if(aJ.set){aL=function(aN,aO){if(arguments.length>1){return aJ.set.call(this,aN,aO)}else{return aJ.get.call(this,aN)}}}else{aL=function(aN){return aJ.get.call(this,aN)}}aM.push(aL);return j.apply(this,aM)};var m=x.get;function b(aK,e,aJ){var aL="-mf-"+aK;if(e){aL+="$"+e}if(aJ&&aJ.polymorphic){aL+="$"+(aJ.typeKey||"type")}return aL}function P(aL,aK){aK=aK||{};var aM=b("fragment",aL,aK);function aJ(aQ,aO,aS){var aP=au(aO);var aT=aP._data[aS]||K(aP,aK,"object");var aR=aP._fragments[aS];var aN=ak(aL,aK,aT);if(!aR&&aG(aQ.modelFor(aN),aT)){aR=aT}else{if(aT&&aT!==aR){aR||(aR=aD(aQ.createFragment(aN),aO,aS));aP._data[aS]=aR;au(aR).setupData({attributes:aT})}else{aR=aT}}return aR}function e(aN,aQ,aP,aR){var aO=au(aN);aP=aR?aD(aR,aN,aQ):null;if(aO._data[aQ]!==aP){at(aN,aQ,aP)}else{W(aN,aQ)}return aP}return h(aM,aK,aJ,e)}function aG(aJ,e){if(e instanceof aJ){return true}else{if(x.MODEL_FACTORY_INJECTIONS){return e instanceof aJ.superclass}}return false}function H(e,aJ){aJ||(aJ={});if(x.typeOf(e)!=="string"){return r(aJ)}var aL=b("fragment-array",e,aJ);return I(aL,aJ,function aK(aM,aN){return aE.create({type:e,options:aJ,name:aN,owner:aM})})}function r(aJ){aJ||(aJ={});var aK=b("array");return I(aK,aJ,function e(aL,aM){return aw.create({options:aJ,name:aM,owner:aL})})}function h(aL,aK,aJ,e){aK=aK||{};var aM={type:aL,isAttribute:true,isFragment:true,options:aK};return l({get:function(aP){var aN=au(this);var aO=aJ(this.store,this,aP);return aN._fragments[aP]=aO},set:function(aP,aQ){var aN=au(this);var aO=aJ(this.store,this,aP);aO=e(this,aP,aO,aQ);return aN._fragments[aP]=aO}}).meta(aM)}function I(aM,aL,aJ){function aK(aQ,aO,aR){var aP=au(aO);var aS=aP._data[aR]||K(aP,aL,"array");var aN=aP._fragments[aR]||null;if(aS instanceof aw&&!aN){aN=aS}else{if(aS&&aS!==aN){aN||(aN=aJ(aO,aR));aP._data[aR]=aN;aN.setupData(aS)}else{aN=aS}}return aN}function e(aO,aQ,aN,aR){var aP=au(aO);if(x.isArray(aR)){aN||(aN=aJ(aO,aQ));aN.setObjects(aR)}else{if(aR===null){aN=null}else{}}if(aP._data[aQ]!==aN||m(aN,"hasDirtyAttributes")){at(aO,aQ,aN)}else{W(aO,aQ)}return aN}return h(aM,aL,aK,e)}function ac(){return x.computed(function(){return au(this)._owner}).readOnly()}function K(e,aJ,aK){var aL;x.warn("The default value of fragment array properties will change from `null` to an empty array in v1.0. This warning can be silenced by explicitly setting a default value with the option `{ defaultValue: null }`",aK!=="array"||aJ.defaultValue!==undefined);if(typeof aJ.defaultValue==="function"){aL=aJ.defaultValue()}else{if(aJ.defaultValue){aL=aJ.defaultValue}else{return null}}return x.copy(aL,true)}var V=x.makeArray;var S=af.extend({deserialize:function al(e){return e==null?null:V(e)},serialize:function ao(e){return e&&e.toArray?e.toArray():e}});var N=S;var C=x.get;var O=af.extend({store:null,modelName:null,polymorphicTypeProp:null,deserialize:function aA(e){if(e==null){return null}return this.deserializeSingle(e)},serialize:function A(aJ){if(!aJ){return null}var e=this.store;var aK=e.serializerFor(aJ.modelName);return aK.serialize(aJ)},modelNameFor:function f(aK){var aJ=C(this,"modelName");var e=C(this,"polymorphicTypeProp");if(aK&&e&&aK[e]){aJ=aK[e]}return aJ},deserializeSingle:function az(aM){var aJ=this.store;var e=this.modelNameFor(aM);var aK=aJ.serializerFor(e);var aO=C(aK,"isNewSerializerAPI");var aL=aJ.modelFor(e);var aN=aK.normalize(aL,aM);if(aO){return C(aN,"data.attributes")}else{return aN}}});var ay=O;var ab=ay.extend({deserialize:function Q(e){if(e==null){return null}return Y(e,function(aJ){return this.deserializeSingle(aJ)},this)},serialize:function n(aJ){if(!aJ){return null}var e=this.store;return Y(aJ,function(aK){var aL=e.serializerFor(aK.modelName);return aL.serialize(aK)})}});var M=ab;var a=[{name:"fragmentTransform",before:"store",initialize:function(e,aJ){aJ.register("transform:fragment",ay);aJ.register("transform:fragment-array",M);aJ.register("transform:array",N)}}];var t=a;function E(e){e.ModelFragment=w;e.FragmentArray=aE;e.FragmentTransform=ay;e.FragmentArrayTransform=M;e.ArrayTransform=N;e.hasOneFragment=P;e.hasManyFragments=H;e.fragmentOwner=ac}var ap=x.Namespace.create({VERSION:"0.4.1"});E(ap);E(aB);x.onLoad("Ember.Application",function(e){t.forEach(e.initializer,e)});if(x.libraries){x.libraries.register("Model Fragments",ap.VERSION)}var G=ap}).call(this);