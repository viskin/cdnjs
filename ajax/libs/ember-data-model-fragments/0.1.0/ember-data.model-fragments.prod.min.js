/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.1.0
 */
(function(){var d,a,c,b;(function(){var f={},e={};d=function(g,h,i){f[g]={deps:h,callback:i}};b=c=a=function(g){if(e[g]){return e[g]}e[g]={};if(!f[g]){throw new Error("Could not find module "+g)}var n=f[g],r=n.deps,q=n.callback,k=[],j;for(var m=0,h=r.length;m<h;m++){if(r[m]==="exports"){k.push(j={})}else{k.push(a(p(r[m])))}}var o=q.apply(this,k);return e[g]=j||o;function p(x){if(x.charAt(0)!=="."){return x}var w=x.split("/");var t=g.split("/").slice(0,-1);for(var v=0,s=w.length;v<s;v++){var u=w[v];if(u===".."){t.pop()}else{if(u==="."){continue}else{t.push(u)}}}return t.join("/")}}})();d("fragments/array/fragment",["./primitive","exports"],function(j,h){var f=j["default"];var e=Ember.get;var i=Ember.EnumerableUtils.map;var g=f.extend({type:null,setupData:function(p){var k=e(this,"owner");var l=e(k,"store");var n=e(this,"type");var m=e(this,"name");var o=e(this,"content");p=i(Ember.makeArray(p),function(s,r){var q=o[r];if(!q){q=l.buildFragment(n);q.setProperties({_owner:k,_name:m})}q.setupData(s);return q});this._super(p)},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty"),rollback:function(){this._super();this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(l,r,k){var n=e(this,"owner");var o=e(n,"store");var q=e(this,"type");var p=e(this,"name");var m=this.originalState;if(k){k.forEach(function(t){var s=e(t,"_owner");if(!s){t.setProperties({_owner:n,_name:p})}})}return e(this,"content").replace(l,r,k)},addFragment:function(k){return e(this,"content").addObject(k)},removeFragment:function(k){return e(this,"content").removeObject(k)},createFragment:function(o){var k=e(this,"owner");var l=e(k,"store");var n=e(this,"type");var m=l.createFragment(n,o);return this.pushObject(m)}});h["default"]=g});d("fragments/array/primitive",["exports"],function(g){var f=Ember.get;var h=Array.prototype.splice;var e=Ember.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();this.originalState=[]},content:function(){return Ember.A()}.property(),setupData:function(j){var i=f(this,"content");j=this.originalState=Ember.makeArray(j);h.apply(i,[0,i.length].concat(j))},isDirty:function(){return Ember.compare(this.toArray(),this.originalState)!==0}.property("[]"),rollback:function(){this.setObjects(this.originalState)},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var i=f(this,"owner");var j=f(this,"name");if(this.get("isDirty")){i.fragmentDidDirty(j,this)}else{i.fragmentDidReset(j,this)}},toStringExtension:function(){return"owner("+f(this,"owner.id")+")"}});g["default"]=e});d("fragments/attributes",["./array/primitive","./array/fragment","exports"],function(l,n,m){var i=l["default"];var k=n["default"];var f=Ember.get;function g(p,o){o=o||{};var q={type:"fragment",isAttribute:true,isFragment:true,options:o};return Ember.computed(function(s,u){var t=this._data[s]||j(this,o,"array");var r=this._fragments[s];if(t&&t!==r){if(!r){r=this.store.buildFragment(p);r.setProperties({_owner:this,_name:s})}r.setupData(t);this._data[s]=r}if(arguments.length>1){r=u;if(this._data[s]!==r){this.fragmentDidDirty(s,r)}else{this.fragmentDidReset(s,r)}}return this._fragments[s]=r}).property("data").meta(q)}function h(p,o){if(Ember.typeOf(p)!=="string"){o=p;p=null}o=o||{};var q={type:"fragment",isAttribute:true,isFragment:true,options:o,kind:"hasMany"};return Ember.computed(function(u,w){var t=this;var v=this._data[u]||j(this,o,"array");var s=this._fragments[u]||null;function r(){var x=p?k:i;return x.create({type:p,name:u,owner:t})}if(v&&v!==s){s||(s=r());s.setupData(v);this._data[u]=s}if(arguments.length>1){if(Ember.isArray(w)){s||(s=r());s.setObjects(w)}else{if(w===null){s=null}else{}}if(this._data[u]!==s||f(s,"isDirty")){this.fragmentDidDirty(u,s)}else{this.fragmentDidReset(u,s)}}return this._fragments[u]=s}).property("data").meta(q)}function e(){return Ember.computed.alias("_owner").readOnly()}function j(o,p,q){var r;if(typeof p.defaultValue==="function"){r=p.defaultValue()}else{if(p.defaultValue){r=p.defaultValue}else{return null}}return Ember.copy(r,true)}m.hasOneFragment=g;m.hasManyFragments=h;m.fragmentOwner=e});d("fragments/model",["../store","../model","./states","exports"],function(m,q,g,p){var k=m["default"];var i=q["default"];var n=g["default"];var h=Ember.get;k.reopen({buildFragment:function(r){r=this.modelFor(r);return r.create({store:this})},createFragment:function(t,s){var r=this.buildFragment(t);if(s){r.setProperties(s)}r.send("loadedData");return r}});i.reopen({_setup:function(){this._super();this._fragments={}},updateFragmentData:Ember.beforeObserver("data",function(r){var s;for(var t in r._fragments){s=r._fragments[t];if(s&&s!==r._data[t]){s.setupData(r._data[t]);r._data[t]=s}}}),rollback:function(){this._super();this.rollbackFragments()},rollbackFragments:function(){var r;for(var s in this._fragments){r=this._fragments[s]=this._data[s];r.rollback()}},fragmentDidDirty:function(s,r){if(!h(this,"isDeleted")){this._attributes[s]=r;this.send("becomeDirty")}},fragmentDidReset:function(s,r){delete this._attributes[s];if(!h(this,"isNew")){this.send("propertyWasReset",s)}}});var l=Ember.Object.extend(Ember.Comparable,Ember.Copyable,{_name:null,_owner:null,currentState:n.empty,setupData:function(v){var r=h(this,"store");var s=h(this,"name");var u=r.modelFor(this.constructor);var t=r.serializerFor(u);this._attributes={};this._data=t.normalize(u,v,s);this.send("pushedData");this.notifyPropertyChange("data")},rollback:function(){this._attributes={};this.rollbackFragments();this.send("rolledBack");this.notifyPropertyChange("data")},compare:function(r,s){return r===s?0:1},copy:function(){var r=h(this,"store");var s=r.modelFor(this.constructor);var t={};Ember.merge(t,this._data);Ember.merge(t,this._attributes);return this.store.createFragment(s,t)},toStringExtension:function(){return"owner("+h(this,"_owner.id")+")"},init:function(){this._super();this._setup()}});i.proto();var f=["_setup","_unhandledEvent","send","transitionTo","data","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"];var o=f.reduce(function(s,r){s[r]=i.prototype[r]||Ember.meta(i.prototype).descs[r];return s},{});l.reopen(o,{eachRelationship:Ember.K,updateRecordArraysLater:Ember.K});var j=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"];var e=j.reduce(function(s,r){s[r]=i[r]||Ember.meta(i).descs[r];return s},{});l.reopenClass(e,{eachRelationship:Ember.K});p["default"]=l});d("fragments/states",["../states","exports"],function(j,n){var g=j["default"];var h=Ember.get;var k=g.loaded.saved.didSetProperty;var f=g.loaded.updated.uncommitted.propertyWasReset;var e=function(p){var o=h(p,"_owner");var q=h(p,"_name");if(o){o.fragmentDidDirty(q,p)}};var l={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:k,propertyWasReset:Ember.K,becomeDirty:Ember.K,rolledBack:Ember.K,empty:{isEmpty:true,loadedData:function(o){o.transitionTo("loaded.created")},pushedData:function(o){o.transitionTo("loaded.saved")}},loaded:{pushedData:function(o){o.transitionTo("saved")},saved:{setup:function(p){var o=h(p,"_owner");var q=h(p,"_name");if(!o._fragments[q]){return}if(!h(o,q+".isDirty")){o.fragmentDidReset(q,p)}},pushedData:Ember.K,becomeDirty:function(o){o.transitionTo("updated")}},created:{isDirty:true,setup:e},updated:{isDirty:true,setup:e,propertyWasReset:f,rolledBack:function(o){o.transitionTo("saved")}}}};function m(o,p){for(var q in p){o[q]=p[q]}return o}function i(p,q,o){p=m(q?Ember.create(q):{},p);p.parentState=q;p.stateName=o;for(var r in p){if(!p.hasOwnProperty(r)||r==="parentState"||r==="stateName"){continue}if(typeof p[r]==="object"){p[r]=i(p[r],p,o+"."+r)}}return p}l=i(l,null,"root");n["default"]=l});d("fragments/transform",["../transform","exports"],function(h,g){var f=h["default"];var e=f.extend({deserialize:function(i){return i},serialize:function(i){return i?i.serialize():null}});g["default"]=e});d("initializers",["./fragments/transform","exports"],function(h,g){var e=h["default"];var f=[{name:"fragmentTransform",before:"store",initialize:function(i,j){j.register("transform:fragment",e)}}];g["default"]=f});d("main",["./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(n,p,f,i,k,o){var m=n["default"];var j=p["default"];var q=f["default"];var h=i.hasOneFragment;var g=i.hasManyFragments;var e=i.fragmentOwner;var l=k["default"];DS.ModelFragment=m;DS.FragmentArray=j;DS.FragmentTransform=q;DS.hasOneFragment=h;DS.hasManyFragments=g;DS.fragmentOwner=e;Ember.onLoad("Ember.Application",function(r){l.forEach(r.initializer,r)});if(Ember.libraries){Ember.libraries.register("Model Fragments","0.1.0")}o["default"]=DS});d("model",["exports"],function(e){e["default"]=DS.Model});d("states",["exports"],function(e){e["default"]=DS.RootState});d("store",["exports"],function(e){e["default"]=DS.Store});d("transform",["exports"],function(e){e["default"]=DS.Transform});a("main")["default"]}());