/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.2.3
 */
(function(){var d,a,c,b;(function(){var f={},e={};d=function(g,h,i){f[g]={deps:h,callback:i}};b=c=a=function(g){if(e[g]){return e[g]}e[g]={};if(!f[g]){throw new Error("Could not find module "+g)}var n=f[g],r=n.deps,q=n.callback,k=[],j;for(var m=0,h=r.length;m<h;m++){if(r[m]==="exports"){k.push(j={})}else{k.push(a(p(r[m])))}}var o=q.apply(this,k);return e[g]=j||o;function p(x){if(x.charAt(0)!=="."){return x}var w=x.split("/");var t=g.split("/").slice(0,-1);for(var v=0,s=w.length;v<s;v++){var u=w[v];if(u===".."){t.pop()}else{if(u==="."){continue}else{t.push(u)}}}return t.join("/")}}})();d("core-model",["ember","./model","exports"],function(l,h,j){var f=l["default"];var k=h["default"];k.proto();var g=["_setup","_unhandledEvent","send","transitionTo","data","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","changedAttributes","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"].reduce(function(n,m){n[m]=k.prototype[m]||f.meta(k.prototype).descs[m];return n},{});var i=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"].reduce(function(n,m){n[m]=k[m]||f.meta(k).descs[m];return n},{});var e=f.Object.extend(g,{eachRelationship:f.K,updateRecordArraysLater:f.K});e.reopenClass(i,{eachRelationship:f.K});j["default"]=e});d("ember",["exports"],function(e){e["default"]=Ember});d("fragments/array/fragment",["ember","./stateful","../model","exports"],function(j,n,g,l){var k=j["default"];var f=n["default"];var m=g.getActualFragmentType;var h=k.get;var e=k.EnumerableUtils.map;var i=f.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},setupData:function(u){var o=h(this,"owner");var p=h(o,"store");var r=h(this,"type");var q=h(this,"options");var s=h(this,"name");var t=h(this,"content");this._isInitializing=true;u=e(k.makeArray(u),function(y,w){var v=t[w];if(!v){var x=m(r,q,y);v=p.buildFragment(x);v.setProperties({_owner:o,_name:s})}v.setupData(y);return v});this._isInitializing=false;this._super(u)},adapterDidCommit:function(){this._super();this.invoke("adapterDidCommit")},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty","_originalState"),rollback:function(){this._super();this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(p,v,o){var r=h(this,"owner");var s=h(r,"store");var u=h(this,"type");var t=h(this,"name");var q=this.originalState;if(o){o.forEach(function(x){var w=h(x,"_owner");if(!w){x.setProperties({_owner:r,_name:t})}})}return h(this,"content").replace(p,v,o)},addFragment:function(o){return this.addObject(o)},removeFragment:function(o){return this.removeObject(o)},createFragment:function(s){var o=h(this,"owner");var p=h(o,"store");var r=h(this,"type");var q=p.createFragment(r,s);return this.pushObject(q)}});l["default"]=i});d("fragments/array/stateful",["ember","exports"],function(i,h){var e=i["default"];var g=e.get;var k=e.set;var j=Array.prototype.splice;var f=e.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();k(this,"_originalState",[])},content:function(){return e.A()}.property(),setupData:function(m){var l=g(this,"content");m=e.makeArray(m);k(this,"_originalState",m);this.replaceContent(0,g(this,"content.length"),m)},adapterDidCommit:function(){k(this,"_originalState",this.toArray())},isDirty:function(){return e.compare(this.toArray(),g(this,"_originalState"))!==0}.property("[]","_originalState"),rollback:function(){this.setObjects(g(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var l=g(this,"owner");var m=g(this,"name");if(this.get("isDirty")){l.fragmentDidDirty(m,this)}else{l.fragmentDidReset(m,this)}},toStringExtension:function(){return"owner("+g(this,"owner.id")+")"}});h["default"]=f});d("fragments/attributes",["ember","./array/stateful","./array/fragment","./model","exports"],function(n,r,g,l,q){var o=n["default"];var e=r["default"];var m=g["default"];var p=l.getActualFragmentType;var h=o.get;function j(t,s){s=s||{};var u={type:"fragment",isAttribute:true,isFragment:true,options:s};return o.computed(function(y,B){var v=this;var A=this._data[y]||k(this,s,"object");var x=this._fragments[y];var z=p(t,s,A);function w(C){return C.setProperties({_owner:v,_name:y})}if(A&&A!==x){x||(x=w(this.store.buildFragment(z)));x.setupData(A);this._data[y]=x}else{x=A}if(arguments.length>1){x=B?w(B):null;if(this._data[y]!==x){this.fragmentDidDirty(y,x)}else{this.fragmentDidReset(y,x)}}return this._fragments[y]=x}).property("data").meta(u)}function i(t,s){if(o.typeOf(t)!=="string"){s=t;t=null}s=s||{};var u={type:"fragment",isAttribute:true,isFragment:true,options:s,kind:"hasMany"};return o.computed(function(y,A){var x=this;var z=this._data[y]||k(this,s,"array");var w=this._fragments[y]||null;function v(){var B=t?m:e;return B.create({type:t,options:s,name:y,owner:x})}if(z&&z!==w){w||(w=v());w.setupData(z);this._data[y]=w}else{w=z}if(arguments.length>1){if(o.isArray(A)){w||(w=v());w.setObjects(A)}else{if(A===null){w=null}else{}}if(this._data[y]!==w||h(w,"isDirty")){this.fragmentDidDirty(y,w)}else{this.fragmentDidReset(y,w)}}return this._fragments[y]=w}).property("data").meta(u)}function f(){return o.computed.alias("_owner").readOnly()}function k(s,t,u){var v;if(typeof t.defaultValue==="function"){v=t.defaultValue()}else{if(t.defaultValue){v=t.defaultValue}else{return null}}return o.copy(v,true)}q.hasOneFragment=j;q.hasManyFragments=i;q.fragmentOwner=f});d("fragments/ext",["../store","../model","exports"],function(j,f,g){var h=j["default"];var i=f["default"];var e=Ember.get;h.reopen({buildFragment:function(k){k=this.modelFor(k);return k.create({store:this})},createFragment:function(m,l){var k=this.buildFragment(m);if(l){k.setProperties(l)}k.send("loadedData");return k}});i.reopen({_setup:function(){this._super();this._fragments={}},updateFragmentData:Ember.beforeObserver("data",function(k){var l;for(var m in k._fragments){l=k._fragments[m];if(l&&k._data[m]&&l!==k._data[m]){l.setupData(k._data[m]);k._data[m]=l}}}),adapterDidCommit:function(m){this._super.apply(this,arguments);var k;for(var l in this._fragments){if(k=this._fragments[l]){k.adapterDidCommit()}}},changedAttributes:function(){var k=this._super();Ember.keys(this._fragments).forEach(function(l){if(l in this._attributes){k[l]=true}},this);return k},rollback:function(){this._super();this.rollbackFragments()},rollbackFragments:function(){var k;for(var l in this._fragments){k=this._fragments[l]=this._data[l];k&&k.rollback()}},fragmentDidDirty:function(l,k){if(!e(this,"isDeleted")){this._attributes[l]=k;this.send("becomeDirty")}},fragmentDidReset:function(l,k){delete this._attributes[l];if(!e(this,"isNew")){this.send("propertyWasReset",l)}}});g.Store=h;g.Model=i});d("fragments/model",["ember","../core-model","./states","exports"],function(i,n,e,m){var j=i["default"];var g=n["default"];var k=e["default"];var f=j.get;var h=g.extend(j.Comparable,j.Copyable,{_name:null,_owner:null,currentState:k.empty,setupData:function(s){var o=f(this,"store");var p=f(this,"name");var r=o.modelFor(this.constructor);var q=o.serializerFor(r);this._attributes={};this._data=q.normalize(r,s,p);this.send("pushedData");this.notifyPropertyChange("data")},rollback:function(){this._attributes={};this.rollbackFragments();this.send("rolledBack");this.notifyPropertyChange("data")},compare:function(o,p){return o===p?0:1},copy:function(){var o=f(this,"store");var p=o.modelFor(this.constructor);var q={};j.merge(q,this._data);j.merge(q,this._attributes);return this.store.createFragment(p,q)},adapterDidCommit:function(){if(j.keys(this._inFlightAttributes).length){j.mixin(this._data,this._inFlightAttributes);this._inFlightAttributes={}}var o;for(var p in this._fragments){if(o=this._fragments[p]){o.adapterDidCommit()}}this.transitionTo("saved")},toStringExtension:function(){return"owner("+f(this,"_owner.id")+")"},init:function(){this._super();this._setup()}});function l(p,o,s){if(!o.polymorphic||!s){return p}var r=o.typeKey||"type";var q=s[r];return q||p}m["default"]=h;m.getActualFragmentType=l});d("fragments/states",["ember","../states","exports"],function(j,p,o){var l=j["default"];var g=p["default"];var h=l.get;var k=g.loaded.saved.didSetProperty;var f=g.loaded.updated.uncommitted.propertyWasReset;var e=function(r){var q=h(r,"_owner");var s=h(r,"_name");if(q){q.fragmentDidDirty(s,r)}};var m={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:k,propertyWasReset:l.K,becomeDirty:l.K,rolledBack:l.K,empty:{isEmpty:true,loadedData:function(q){q.transitionTo("loaded.created")},pushedData:function(q){q.transitionTo("loaded.saved")}},loaded:{pushedData:function(q){q.transitionTo("saved")},saved:{setup:function(r){var q=h(r,"_owner");var s=h(r,"_name");if(!q._fragments[s]||r._isInitializing){return}if(!h(q,s+".isDirty")){q.fragmentDidReset(s,r)}},pushedData:l.K,becomeDirty:function(q){q.transitionTo("updated")}},created:{isDirty:true,setup:e},updated:{isDirty:true,setup:e,propertyWasReset:f,rolledBack:function(q){q.transitionTo("saved")}}}};function n(q,r){for(var s in r){q[s]=r[s]}return q}function i(r,s,q){r=n(s?l.create(s):{},r);r.parentState=s;r.stateName=q;for(var t in r){if(!r.hasOwnProperty(t)||t==="parentState"||t==="stateName"){continue}if(typeof r[t]==="object"){r[t]=i(r[t],r,q+"."+t)}}return r}m=i(m,null,"root");o["default"]=m});d("fragments/transform",["../transform","exports"],function(h,g){var f=h["default"];var e=f.extend({deserialize:function(i){return i},serialize:function(i){return i?i.serialize():null}});g["default"]=e});d("initializers",["./fragments/transform","exports"],function(h,g){var e=h["default"];var f=[{name:"fragmentTransform",before:"store",initialize:function(i,j){j.register("transform:fragment",e)}}];g["default"]=f});d("main",["ember","./fragments/ext","./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(p,t,h,l,m,r,e,s){var q=p["default"];var g=t["default"];var o=h["default"];var k=l["default"];var u=m["default"];var j=r.hasOneFragment;var i=r.hasManyFragments;var f=r.fragmentOwner;var n=e["default"];DS.ModelFragment=o;DS.FragmentArray=k;DS.FragmentTransform=u;DS.hasOneFragment=j;DS.hasManyFragments=i;DS.fragmentOwner=f;q.onLoad("Ember.Application",function(v){n.forEach(v.initializer,v)});if(q.libraries){q.libraries.register("Model Fragments","0.2.3")}s["default"]=DS});d("model",["exports"],function(e){e["default"]=DS.Model});d("states",["exports"],function(e){e["default"]=DS.RootState});d("store",["exports"],function(e){e["default"]=DS.Store});d("transform",["exports"],function(e){e["default"]=DS.Transform});a("main")["default"]}());