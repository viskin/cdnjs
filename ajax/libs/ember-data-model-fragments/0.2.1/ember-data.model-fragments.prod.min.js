/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.2.1
 */
(function(){var d,a,c,b;(function(){var f={},e={};d=function(g,h,i){f[g]={deps:h,callback:i}};b=c=a=function(g){if(e[g]){return e[g]}e[g]={};if(!f[g]){throw new Error("Could not find module "+g)}var n=f[g],r=n.deps,q=n.callback,k=[],j;for(var m=0,h=r.length;m<h;m++){if(r[m]==="exports"){k.push(j={})}else{k.push(a(p(r[m])))}}var o=q.apply(this,k);return e[g]=j||o;function p(x){if(x.charAt(0)!=="."){return x}var w=x.split("/");var t=g.split("/").slice(0,-1);for(var v=0,s=w.length;v<s;v++){var u=w[v];if(u===".."){t.pop()}else{if(u==="."){continue}else{t.push(u)}}}return t.join("/")}}})();d("core-model",["ember","./model","exports"],function(l,h,j){var f=l["default"];var k=h["default"];k.proto();var g=["_setup","_unhandledEvent","send","transitionTo","data","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","changedAttributes","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"].reduce(function(n,m){n[m]=k.prototype[m]||f.meta(k.prototype).descs[m];return n},{});var i=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"].reduce(function(n,m){n[m]=k[m]||f.meta(k).descs[m];return n},{});var e=f.Object.extend(g,{eachRelationship:f.K,updateRecordArraysLater:f.K});e.reopenClass(i,{eachRelationship:f.K});j["default"]=e});d("ember",["exports"],function(e){e["default"]=Ember});d("fragments/array/fragment",["ember","./stateful","exports"],function(l,h,j){var e=l["default"];var g=h["default"];var f=e.get;var k=e.EnumerableUtils.map;var i=g.extend({type:null,init:function(){this._super();this._isInitializing=false},setupData:function(r){var m=f(this,"owner");var n=f(m,"store");var p=f(this,"type");var o=f(this,"name");var q=f(this,"content");this._isInitializing=true;r=k(e.makeArray(r),function(u,t){var s=q[t];if(!s){s=n.buildFragment(p);s.setProperties({_owner:m,_name:o})}s.setupData(u);return s});this._isInitializing=false;this._super(r)},adapterDidCommit:function(){this._super();this.invoke("adapterDidCommit")},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty","_originalState"),rollback:function(){this._super();this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(n,t,m){var p=f(this,"owner");var q=f(p,"store");var s=f(this,"type");var r=f(this,"name");var o=this.originalState;if(m){m.forEach(function(v){var u=f(v,"_owner");if(!u){v.setProperties({_owner:p,_name:r})}})}return f(this,"content").replace(n,t,m)},addFragment:function(m){return this.addObject(m)},removeFragment:function(m){return this.removeObject(m)},createFragment:function(q){var m=f(this,"owner");var n=f(m,"store");var p=f(this,"type");var o=n.createFragment(p,q);return this.pushObject(o)}});j["default"]=i});d("fragments/array/stateful",["ember","exports"],function(i,h){var e=i["default"];var g=e.get;var k=e.set;var j=Array.prototype.splice;var f=e.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();k(this,"_originalState",[])},content:function(){return e.A()}.property(),setupData:function(m){var l=g(this,"content");m=e.makeArray(m);k(this,"_originalState",m);this.replaceContent(0,g(this,"content.length"),m)},adapterDidCommit:function(){k(this,"_originalState",this.toArray())},isDirty:function(){return e.compare(this.toArray(),g(this,"_originalState"))!==0}.property("[]","_originalState"),rollback:function(){this.setObjects(g(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var l=g(this,"owner");var m=g(this,"name");if(this.get("isDirty")){l.fragmentDidDirty(m,this)}else{l.fragmentDidReset(m,this)}},toStringExtension:function(){return"owner("+g(this,"owner.id")+")"}});h["default"]=f});d("fragments/attributes",["ember","./array/stateful","./array/fragment","exports"],function(m,p,g,o){var n=m["default"];var e=p["default"];var l=g["default"];var h=n.get;function j(r,q){q=q||{};var s={type:"fragment",isAttribute:true,isFragment:true,options:q};return n.computed(function(w,y){var t=this;var x=this._data[w]||k(this,q,"object");var v=this._fragments[w];function u(z){return z.setProperties({_owner:t,_name:w})}if(x&&x!==v){v||(v=u(this.store.buildFragment(r)));v.setupData(x);this._data[w]=v}else{v=x}if(arguments.length>1){v=y?u(y):null;if(this._data[w]!==v){this.fragmentDidDirty(w,v)}else{this.fragmentDidReset(w,v)}}return this._fragments[w]=v}).property("data").meta(s)}function i(r,q){if(n.typeOf(r)!=="string"){q=r;r=null}q=q||{};var s={type:"fragment",isAttribute:true,isFragment:true,options:q,kind:"hasMany"};return n.computed(function(w,y){var v=this;var x=this._data[w]||k(this,q,"array");var u=this._fragments[w]||null;function t(){var z=r?l:e;return z.create({type:r,name:w,owner:v})}if(x&&x!==u){u||(u=t());u.setupData(x);this._data[w]=u}else{u=x}if(arguments.length>1){if(n.isArray(y)){u||(u=t());u.setObjects(y)}else{if(y===null){u=null}else{}}if(this._data[w]!==u||h(u,"isDirty")){this.fragmentDidDirty(w,u)}else{this.fragmentDidReset(w,u)}}return this._fragments[w]=u}).property("data").meta(s)}function f(){return n.computed.alias("_owner").readOnly()}function k(q,r,s){var t;if(typeof r.defaultValue==="function"){t=r.defaultValue()}else{if(r.defaultValue){t=r.defaultValue}else{return null}}return n.copy(t,true)}o.hasOneFragment=j;o.hasManyFragments=i;o.fragmentOwner=f});d("fragments/ext",["../store","../model","exports"],function(j,f,g){var h=j["default"];var i=f["default"];var e=Ember.get;h.reopen({buildFragment:function(k){k=this.modelFor(k);return k.create({store:this})},createFragment:function(m,l){var k=this.buildFragment(m);if(l){k.setProperties(l)}k.send("loadedData");return k}});i.reopen({_setup:function(){this._super();this._fragments={}},updateFragmentData:Ember.beforeObserver("data",function(k){var l;for(var m in k._fragments){l=k._fragments[m];if(l&&k._data[m]&&l!==k._data[m]){l.setupData(k._data[m]);k._data[m]=l}}}),adapterDidCommit:function(m){this._super.apply(this,arguments);var k;for(var l in this._fragments){if(k=this._fragments[l]){k.adapterDidCommit()}}},changedAttributes:function(){var k=this._super();Ember.keys(this._fragments).forEach(function(l){if(l in this._attributes){k[l]=true}},this);return k},rollback:function(){this._super();this.rollbackFragments()},rollbackFragments:function(){var k;for(var l in this._fragments){k=this._fragments[l]=this._data[l];k&&k.rollback()}},fragmentDidDirty:function(l,k){if(!e(this,"isDeleted")){this._attributes[l]=k;this.send("becomeDirty")}},fragmentDidReset:function(l,k){delete this._attributes[l];if(!e(this,"isNew")){this.send("propertyWasReset",l)}}});g.Store=h;g.Model=i});d("fragments/model",["ember","../core-model","./states","exports"],function(i,m,e,l){var j=i["default"];var g=m["default"];var k=e["default"];var f=j.get;var h=g.extend(j.Comparable,j.Copyable,{_name:null,_owner:null,currentState:k.empty,setupData:function(r){var n=f(this,"store");var o=f(this,"name");var q=n.modelFor(this.constructor);var p=n.serializerFor(q);this._attributes={};this._data=p.normalize(q,r,o);this.send("pushedData");this.notifyPropertyChange("data")},rollback:function(){this._attributes={};this.rollbackFragments();this.send("rolledBack");this.notifyPropertyChange("data")},compare:function(n,o){return n===o?0:1},copy:function(){var n=f(this,"store");var o=n.modelFor(this.constructor);var p={};j.merge(p,this._data);j.merge(p,this._attributes);return this.store.createFragment(o,p)},adapterDidCommit:function(){if(j.keys(this._inFlightAttributes).length){j.mixin(this._data,this._inFlightAttributes);this._inFlightAttributes={}}var n;for(var o in this._fragments){if(n=this._fragments[o]){n.adapterDidCommit()}}this.transitionTo("saved")},toStringExtension:function(){return"owner("+f(this,"_owner.id")+")"},init:function(){this._super();this._setup()}});l["default"]=h});d("fragments/states",["ember","../states","exports"],function(j,p,o){var l=j["default"];var g=p["default"];var h=l.get;var k=g.loaded.saved.didSetProperty;var f=g.loaded.updated.uncommitted.propertyWasReset;var e=function(r){var q=h(r,"_owner");var s=h(r,"_name");if(q){q.fragmentDidDirty(s,r)}};var m={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:k,propertyWasReset:l.K,becomeDirty:l.K,rolledBack:l.K,empty:{isEmpty:true,loadedData:function(q){q.transitionTo("loaded.created")},pushedData:function(q){q.transitionTo("loaded.saved")}},loaded:{pushedData:function(q){q.transitionTo("saved")},saved:{setup:function(r){var q=h(r,"_owner");var s=h(r,"_name");if(!q._fragments[s]||r._isInitializing){return}if(!h(q,s+".isDirty")){q.fragmentDidReset(s,r)}},pushedData:l.K,becomeDirty:function(q){q.transitionTo("updated")}},created:{isDirty:true,setup:e},updated:{isDirty:true,setup:e,propertyWasReset:f,rolledBack:function(q){q.transitionTo("saved")}}}};function n(q,r){for(var s in r){q[s]=r[s]}return q}function i(r,s,q){r=n(s?l.create(s):{},r);r.parentState=s;r.stateName=q;for(var t in r){if(!r.hasOwnProperty(t)||t==="parentState"||t==="stateName"){continue}if(typeof r[t]==="object"){r[t]=i(r[t],r,q+"."+t)}}return r}m=i(m,null,"root");o["default"]=m});d("fragments/transform",["../transform","exports"],function(h,g){var f=h["default"];var e=f.extend({deserialize:function(i){return i},serialize:function(i){return i?i.serialize():null}});g["default"]=e});d("initializers",["./fragments/transform","exports"],function(h,g){var e=h["default"];var f=[{name:"fragmentTransform",before:"store",initialize:function(i,j){j.register("transform:fragment",e)}}];g["default"]=f});d("main",["ember","./fragments/ext","./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(p,t,h,l,m,r,e,s){var q=p["default"];var g=t["default"];var o=h["default"];var k=l["default"];var u=m["default"];var j=r.hasOneFragment;var i=r.hasManyFragments;var f=r.fragmentOwner;var n=e["default"];DS.ModelFragment=o;DS.FragmentArray=k;DS.FragmentTransform=u;DS.hasOneFragment=j;DS.hasManyFragments=i;DS.fragmentOwner=f;q.onLoad("Ember.Application",function(v){n.forEach(v.initializer,v)});if(q.libraries){q.libraries.register("Model Fragments","0.2.1")}s["default"]=DS});d("model",["exports"],function(e){e["default"]=DS.Model});d("states",["exports"],function(e){e["default"]=DS.RootState});d("store",["exports"],function(e){e["default"]=DS.Store});d("transform",["exports"],function(e){e["default"]=DS.Transform});a("main")["default"]}());