/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.3.2
 */
(function(){var d,a,c,b;(function(){var f={},e={};d=function(g,h,i){f[g]={deps:h,callback:i}};b=c=a=function(g){if(e[g]){return e[g]}e[g]={};if(!f[g]){throw new Error("Could not find module "+g)}var n=f[g],r=n.deps,q=n.callback,k=[],j;for(var m=0,h=r.length;m<h;m++){if(r[m]==="exports"){k.push(j={})}else{k.push(a(p(r[m])))}}var o=q.apply(this,k);return e[g]=j||o;function p(x){if(x.charAt(0)!=="."){return x}var w=x.split("/");var t=g.split("/").slice(0,-1);for(var v=0,s=w.length;v<s;v++){var u=w[v];if(u===".."){t.pop()}else{if(u==="."){continue}else{t.push(u)}}}return t.join("/")}}})();d("core-model",["ember","./model","exports"],function(l,h,j){var f=l["default"];var k=h["default"];k.proto();var g=["_setup","_unhandledEvent","_createSnapshot","send","transitionTo","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","changedAttributes","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"].reduce(function(n,m){n[m]=k.prototype[m]||f.meta(k.prototype).descs[m];return n},{});var i=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"].reduce(function(n,m){n[m]=k[m]||f.meta(k).descs[m];return n},{});var e=f.Object.extend(g,{eachRelationship:f.K,updateRecordArraysLater:f.K});e.reopenClass(i,{eachRelationship:f.K});j["default"]=e});d("ember",["exports"],function(e){e["default"]=Ember});d("fragments/array/fragment",["ember","./stateful","../model","exports"],function(j,n,g,l){var k=j["default"];var f=n["default"];var m=g.getActualFragmentType;var h=k.get;var e=k.EnumerableUtils.map;var i=f.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},_processData:function(v){var o=h(this,"owner");var p=h(o,"store");var s=h(this,"type");var r=h(this,"options");var t=h(this,"name");var u=h(this,"content");this._isInitializing=true;var q=e(k.makeArray(v),function(z,x){var w=u[x];if(!w){var y=m(s,r,z);w=p.buildFragment(y);w.setProperties({_owner:o,_name:t})}w.setupData(z);return w});this._isInitializing=false;return q},_createSnapshot:function(){return e(this,function(o){return o._createSnapshot()})},adapterDidCommit:function(){this._super();this.invoke("adapterDidCommit")},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty","_originalState"),rollback:function(){this._super();this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(p,t,o){var s=this;var q=h(this,"owner");var r=h(this,"name");if(o){o.forEach(function(v){var u=h(v,"_owner");if(!u){v.setProperties({_owner:q,_name:r})}})}return h(this,"content").replace(p,t,o)},addFragment:function(o){return this.addObject(o)},removeFragment:function(o){return this.removeObject(o)},createFragment:function(s){var o=h(this,"owner");var p=h(o,"store");var r=h(this,"type");var q=p.createFragment(r,s);return this.pushObject(q)}});l["default"]=i});d("fragments/array/stateful",["ember","exports"],function(i,h){var e=i["default"];var g=e.get;var k=e.set;var j=Array.prototype.splice;var f=e.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();this._pendingData=undefined;k(this,"_originalState",[])},content:function(){return e.A()}.property(),setupData:function(m){if(this._pendingData===m){return}this._pendingData=m;var l=this._processData(m);k(this,"_originalState",l);this.replaceContent(0,g(this,"content.length"),l);this._pendingData=undefined},_processData:function(l){return e.makeArray(l)},_createSnapshot:function(){return this.toArray()},adapterDidCommit:function(){k(this,"_originalState",this.toArray())},isDirty:function(){return e.compare(this.toArray(),g(this,"_originalState"))!==0}.property("[]","_originalState"),rollback:function(){this.setObjects(g(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var l=g(this,"owner");var m=g(this,"name");if(this.get("isDirty")){l.fragmentDidDirty(m,this)}else{l.fragmentDidReset(m,this)}},toStringExtension:function(){return"owner("+g(this,"owner.id")+")"}});h["default"]=f});d("fragments/attributes",["ember","./array/stateful","./array/fragment","./model","exports"],function(n,s,g,l,q){var o=n["default"];var e=s["default"];var m=g["default"];var p=l.getActualFragmentType;var h=o.get;function j(v,t){t=t||{};var u={type:"fragment",isAttribute:true,isFragment:true,options:t};return o.computed(function(B,D){var x=this;var z=this.store;var C=this._data[B]||k(this,t,"object");var A=this._fragments[B];var w=p(v,t,C);function y(E){return E.setProperties({_owner:x,_name:B})}if(!A&&r(z.modelFor(w),C)){A=C}else{if(C&&C!==A){A||(A=y(z.buildFragment(w)));this._data[B]=A;A.setupData(C)}else{A=C}}if(arguments.length>1){A=D?y(D):null;if(this._data[B]!==A){this.fragmentDidDirty(B,A)}else{this.fragmentDidReset(B,A)}}return this._fragments[B]=A}).property().meta(u)}function r(u,t){if(t instanceof u){return true}else{if(o.MODEL_FACTORY_INJECTIONS){return t instanceof u.superclass}}return false}function i(v,t){if(o.typeOf(v)!=="string"){t=v;v=null}t=t||{};var u={type:"fragment",isAttribute:true,isFragment:true,options:t,kind:"hasMany"};return o.computed(function(z,B){var y=this;var A=this._data[z]||k(this,t,"array");var x=this._fragments[z]||null;function w(){var C=v?m:e;return C.create({type:v,options:t,name:z,owner:y})}if(A instanceof e&&!x){x=A}else{if(A&&A!==x){x||(x=w());this._data[z]=x;x.setupData(A)}else{x=A}}if(arguments.length>1){if(o.isArray(B)){x||(x=w());x.setObjects(B)}else{if(B===null){x=null}else{}}if(this._data[z]!==x||h(x,"isDirty")){this.fragmentDidDirty(z,x)}else{this.fragmentDidReset(z,x)}}return this._fragments[z]=x}).property().meta(u)}function f(){return o.computed.alias("_owner").readOnly()}function k(t,u,v){var w;if(typeof u.defaultValue==="function"){w=u.defaultValue()}else{if(u.defaultValue){w=u.defaultValue}else{return null}}return o.copy(w,true)}q.hasOneFragment=j;q.hasManyFragments=i;q.fragmentOwner=f});d("fragments/ext",["../store","../model","exports"],function(j,f,g){var h=j["default"];var i=f["default"];var e=Ember.get;h.reopen({buildFragment:function(k){k=this.modelFor(k);return k.create({store:this})},createFragment:function(m,l){var k=this.buildFragment(m);if(l){k.setProperties(l)}k.send("loadedData");return k}});i.reopen({_setup:function(){this._super();this._fragments={}},_createSnapshot:function(){var k=this._super.apply(this,arguments);var l=k._attributes;Ember.keys(l).forEach(function(n){var m=l[n];if(m&&typeof m._createSnapshot==="function"){l[n]=m._createSnapshot()}});return k},adapterDidCommit:function(m){this._super.apply(this,arguments);var k;for(var l in this._fragments){if(k=this._fragments[l]){k.adapterDidCommit()}}},changedAttributes:function(){var k=this._super();Ember.keys(this._fragments).forEach(function(l){if(l in this._attributes){k[l]=true}},this);return k},rollback:function(){this._super();this.rollbackFragments()},rollbackFragments:function(){for(var k in this._fragments){if(this._fragments[k]){this._fragments[k].rollback()}}},fragmentDidDirty:function(l,k){if(!e(this,"isDeleted")){this._attributes[l]=k;this.send("becomeDirty")}},fragmentDidReset:function(l,k){delete this._attributes[l];if(!e(this,"isNew")){this.send("propertyWasReset",l)}}});g.Store=h;g.Model=i});d("fragments/model",["ember","../core-model","./states","exports"],function(j,o,e,n){var k=j["default"];var g=o["default"];var l=e["default"];var f=k.get;var i=g.extend(k.Comparable,k.Copyable,{_name:null,_owner:null,currentState:l.empty,setupData:function(s){var p=f(this,"store");var r=p.modelFor(this.constructor);var q=p.serializerFor(r);this._attributes={};this._data=q.normalize(r,s);this.send("pushedData");h(this,k.keys(s))},rollback:function(){var p=k.keys(this._attributes);this._attributes={};this.rollbackFragments();this.send("rolledBack");h(this,p)},compare:function(p,q){return p===q?0:1},copy:function(){var p=f(this,"store");var q=p.modelFor(this.constructor);var r={};k.merge(r,this._data);k.merge(r,this._attributes);return this.store.createFragment(q,r)},adapterDidCommit:function(){if(k.keys(this._inFlightAttributes).length){k.mixin(this._data,this._inFlightAttributes);this._inFlightAttributes={}}var p;for(var q in this._fragments){if(p=this._fragments[q]){p.adapterDidCommit()}}this.transitionTo("saved")},toStringExtension:function(){return"owner("+f(this,"_owner.id")+")"},init:function(){this._super();this._setup()}});function h(r,s){k.beginPropertyChanges();for(var q=0,p=s.length;q<p;q++){r.notifyPropertyChange(s[q])}k.endPropertyChanges()}function m(q,p,t){if(!p.polymorphic||!t){return q}var s=p.typeKey||"type";var r=t[s];return r||q}n["default"]=i;n.getActualFragmentType=m});d("fragments/states",["ember","../states","exports"],function(j,p,o){var l=j["default"];var g=p["default"];var h=l.get;var k=g.loaded.saved.didSetProperty;var f=g.loaded.updated.uncommitted.propertyWasReset;var e=function(r){var q=h(r,"_owner");var s=h(r,"_name");if(q){q.fragmentDidDirty(s,r)}};var m={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:k,propertyWasReset:l.K,becomeDirty:l.K,rolledBack:l.K,empty:{isEmpty:true,loadedData:function(q){q.transitionTo("loaded.created")},pushedData:function(q){q.transitionTo("loaded.saved")}},loaded:{pushedData:function(q){q.transitionTo("saved")},saved:{setup:function(r){var q=h(r,"_owner");var s=h(r,"_name");if(!q._fragments[s]||r._isInitializing){return}if(!h(q,s+".isDirty")){q.fragmentDidReset(s,r)}},pushedData:l.K,becomeDirty:function(q){q.transitionTo("updated")}},created:{isDirty:true,setup:e},updated:{isDirty:true,setup:e,propertyWasReset:f,rolledBack:function(q){q.transitionTo("saved")}}}};function n(q,r){for(var s in r){q[s]=r[s]}return q}function i(r,s,q){r=n(s?l.create(s):{},r);r.parentState=s;r.stateName=q;for(var t in r){if(!r.hasOwnProperty(t)||t==="parentState"||t==="stateName"){continue}if(typeof r[t]==="object"){r[t]=i(r[t],r,q+"."+t)}}return r}m=i(m,null,"root");o["default"]=m});d("fragments/transform",["../snapshot","../transform","exports"],function(i,m,k){var j=i["default"];var g=m["default"];var f=Ember.get;var h=Ember.isArray;var e=Ember.EnumerableUtils.map;var n=g.extend({deserialize:function(o){return o},serialize:function(o){if(!o){return null}else{if(h(o)){return e(o,l)}else{return l(o)}}}});function l(o){if(!(o instanceof j)){return o}return f(o,"record.store").serializerFor(o.typeKey).serialize(o)}k["default"]=n});d("initializers",["./fragments/transform","exports"],function(h,g){var e=h["default"];var f=[{name:"fragmentTransform",before:"store",initialize:function(i,j){j.register("transform:fragment",e)}}];g["default"]=f});d("main",["ember","./fragments/ext","./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(p,t,h,l,m,r,e,s){var q=p["default"];var g=t["default"];var o=h["default"];var k=l["default"];var u=m["default"];var j=r.hasOneFragment;var i=r.hasManyFragments;var f=r.fragmentOwner;var n=e["default"];DS.ModelFragment=o;DS.FragmentArray=k;DS.FragmentTransform=u;DS.hasOneFragment=j;DS.hasManyFragments=i;DS.fragmentOwner=f;q.onLoad("Ember.Application",function(v){n.forEach(v.initializer,v)});if(q.libraries){q.libraries.register("Model Fragments","0.3.2")}s["default"]=DS});d("model",["exports"],function(e){e["default"]=DS.Model});d("snapshot",["exports"],function(e){e["default"]=DS.Snapshot});d("states",["exports"],function(e){e["default"]=DS.RootState});d("store",["exports"],function(e){e["default"]=DS.Store});d("transform",["exports"],function(e){e["default"]=DS.Transform});a("main")["default"]}());