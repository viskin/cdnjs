/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2015 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.3.3+8b1fcdd5
 */
(function(){var v=Ember;var aA=DS;var aB=DS.JSONAPISerializer;var d=DS.JSONSerializer;var am=DS.InternalModel;var ap=DS.RootState;var S=DS.Model;var D=DS.Snapshot;var Z=DS.Store;var ae=DS.Transform;var al=v.get;var p=Object.create||v.create;var ah=ap.loaded.saved.didSetProperty;var R=ap.loaded.updated.uncommitted.propertyWasReset;var ad=function(aI){var e=aI._owner;var aJ=aI._name;if(e){ar(e,aJ,aI)}};var g={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:ah,propertyWasReset:v.K,becomeDirty:v.K,rolledBack:v.K,empty:{isEmpty:true,loadedData:function(e){e.transitionTo("loaded.created")},pushedData:function(e){e.transitionTo("loaded.saved")}},loaded:{pushedData:function(e){e.transitionTo("saved")},saved:{setup:function(aI){var e=aI._owner;var aJ=aI._name;if(!e._internalModel._fragments[aJ]||aI._isInitializing){return}if(!al(e,aJ+".hasDirtyAttributes")){U(e,aJ,aI)}},pushedData:v.K,didCommit:v.K,becomeDirty:function(e){e.transitionTo("updated")}},created:{isDirty:true,setup:ad,didCommit:function(e){e.transitionTo("saved")}},updated:{isDirty:true,setup:ad,propertyWasReset:R,didCommit:function(e){e.transitionTo("saved")},rolledBack:function(e){e.transitionTo("saved")}}}};function B(e,aI){for(var aJ in aI){e[aJ]=aI[aJ]}return e}function z(aI,aJ,e){aI=B(aJ?p(aJ):{},aI);aI.parentState=aJ;aI.stateName=e;for(var aK in aI){if(!aI.hasOwnProperty(aK)||aK==="parentState"||aK==="stateName"){continue}if(typeof aI[aK]==="object"){aI[aK]=z(aI[aK],aI,e+"."+aK)}}return aI}g=z(g,null,"root");var ac=g;function ar(e,aJ,aI){if(!al(e,"isDeleted")){e._internalModel._attributes[aJ]=aI;e.send("becomeDirty")}}function U(e,aI){delete e._internalModel._attributes[aI];if(!al(e,"isNew")){e.send("propertyWasReset",aI)}}var r=v.get;var aq=v.set;var aG=v.computed;var aw=v.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();this._pendingData=undefined;aq(this,"_originalState",[])},content:aG(function(){return v.A()}),setupData:function(aI){if(this._pendingData===aI){return}this._pendingData=aI;var e=this._processData(aI);aq(this,"_originalState",e);this.replaceContent(0,r(this,"content.length"),e);this._pendingData=undefined},_processData:function(e){return v.makeArray(e)},_createSnapshot:function(){return this.toArray()},_adapterDidCommit:function(e){if(e){this.setupData(e)}else{aq(this,"_originalState",this.toArray())}},isDirty:aG("hasDirtyAttributes",function(){return this.get("hasDirtyAttributes")}),hasDirtyAttributes:aG("[]","_originalState",function(){return v.compare(this.toArray(),r(this,"_originalState"))!==0}),rollback:function(){this.rollbackAttributes()},rollbackAttributes:function(){this.setObjects(r(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var e=r(this,"owner");var aI=r(this,"name");if(r(this,"hasDirtyAttributes")){ar(e,aI,this)}else{U(e,aI)}},toStringExtension:function(){return"owner("+r(this,"owner.id")+")"}});var av=aw;var aH=Object.keys||Ember.keys;Z.reopen({createFragment:function(e,aL){var aK=this.modelFor(e);Ember.assert("The '"+aK+"' model must be a subclass of DS.ModelFragment",u.detect(aK));var aI=new am(aK,null,this,this.container);aI.currentState=ac.empty;aI._name=null;aI._owner=null;aI.loadedData();var aJ=aI.getRecord();if(aL){aJ.setProperties(aL)}return aJ}});S.reopen({changedAttributes:function(){var aI=this._super();var e=at(this);aH(e._fragments).forEach(function(aJ){if(aJ in e._attributes){aI[aJ]=true}},this);return aI}});function au(aK,e,aI){var aJ=aK[e];aK[e]=function(){var aL=aJ.apply(this,arguments);return aI.call(this,aL,arguments)}}var H=am.prototype;au(H,"createSnapshot",function ag(e){var aI=e._attributes;aH(aI).forEach(function(aK){var aJ=aI[aK];if(aJ&&typeof aJ._createSnapshot==="function"){aI[aK]=aJ._createSnapshot()}});return e});au(H,"rollbackAttributes",function o(){for(var e in this._fragments){if(this._fragments[e]){this._fragments[e].rollbackAttributes()}}});au(H,"adapterDidCommit",function x(aL,aJ){var e=(aJ[0]&&aJ[0].attributes)||{};var aI;for(var aK in this._fragments){if(aI=this._fragments[aK]){aI._adapterDidCommit(e[aK])}}});d.reopen({transformFor:function(e){if(e.indexOf("-mf-")===0){return k(this.container,this.store,e)}return this._super.apply(this,arguments)}});function k(aK,aQ,aL){var aI=aK._registry||aK;var aO="transform:"+aL;var aN=aL.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/);var aM=aN[1];var aP=aN[2];var e=aN[3];if(!aI.has(aO)){var aJ=aK.lookupFactory("transform:"+aM);aI.register(aO,aJ.extend({store:aQ,modelName:aP,polymorphicTypeProp:e}))}return aK.lookup(aO)}var af=v.get;var aE=Object.create||v.create;var X=v.merge;var ai=S.extend(v.Comparable,v.Copyable,{compare:function(e,aI){return e===aI?0:1},copy:function(){var e={};X(e,this._data);X(e,this._attributes);return this.store.createFragment(this.constructor.modelName,e)},_adapterDidCommit:function(e){at(this).setupData({attributes:e||{}})},toStringExtension:function(){return"owner("+af(at(this)._owner,"id")+")"}});function aj(aI,e,aL){if(!e.polymorphic||!aL){return aI}var aK=e.typeKey||"type";var aJ=aL[aK];return aJ||aI}function at(e){var aI=e._internalModel;if(!aI._fragments){aI._fragments=aE(null)}return aI}function aC(aJ,e,aK){var aI=at(aJ);aI._owner=e;aI._name=aK;return aJ}var u=ai;function J(aI,aJ,e){return aI.map?aI.map(aJ,e):c.call(aI,aJ,e)}var W=J;function c(aI){if(this===void 0||this===null||typeof aI!=="function"){throw new TypeError()}var aM=Object(this);var e=aM.length>>>0;var aL=new Array(e);var aK=arguments[1];for(var aJ=0;aJ<e;aJ++){if(aJ in aM){aL[aJ]=aI.call(aK,aM[aJ],aJ,aM)}}return aL}var w=v.get;var t=v.computed;var V=av.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},_processData:function(aO){var e=w(this,"owner");var aI=w(e,"store");var aL=w(this,"type");var aK=w(this,"options");var aM=w(this,"name");var aN=w(this,"content");this._isInitializing=true;var aJ=W(v.makeArray(aO),function(aS,aQ){var aP=aN[aQ];if(!aP){var aR=aj(aL,aK,aS);aP=aI.createFragment(aR);aC(aP,e,aM)}at(aP).setupData({attributes:aS});return aP});this._isInitializing=false;return aJ},_createSnapshot:function(){return this.map(function(e){return e._createSnapshot()})},_adapterDidCommit:function(e){this._super(e);if(!e){this.forEach(function(aI){aI._adapterDidCommit()})}},hasDirtyAttributes:t("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super();this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(aI,aM,e){var aL=this;var aJ=w(this,"owner");var aK=w(this,"name");if(e){e.forEach(function(aO){var aN=at(aO)._owner;if(!aN){aC(aO,aJ,aK)}})}return w(this,"content").replace(aI,aM,e)},addFragment:function(e){return this.addObject(e)},removeFragment:function(e){return this.removeObject(e)},createFragment:function(aL){var e=w(this,"owner");var aI=w(e,"store");var aK=w(this,"type");var aJ=aI.createFragment(aK,aL);return this.pushObject(aJ)}});var aD=V;var Y=window.Ember;var j=Y.computed;var i;try{Y.computed({set:function(){},get:function(){}});i=true}catch(P){i=false}var l=function(){var aL=[];var aI=arguments[arguments.length-1];if(typeof aI==="function"||i){return j.apply(this,arguments)}for(var aJ=0,e=arguments.length-1;aJ<e;aJ++){aL.push(arguments[aJ])}var aK;if(aI.set){aK=function(aM,aN){if(arguments.length>1){return aI.set.call(this,aM,aN)}else{return aI.get.call(this,aM)}}}else{aK=function(aM){return aI.get.call(this,aM)}}aL.push(aK);return j.apply(this,aL)};var m=v.get;function b(aJ,e,aI){var aK="-mf-"+aJ;if(e){aK+="$"+e}if(aI&&aI.polymorphic){aK+="$"+(aI.typeKey||"type")}return aK}function N(aK,aJ){aJ=aJ||{};var aL=b("fragment",aK,aJ);function aI(aP,aN,aR){var aO=at(aN);var aS=aO._data[aR]||I(aO,aJ,"object");var aQ=aO._fragments[aR];var aM=aj(aK,aJ,aS);if(!aQ&&aF(aP.modelFor(aM),aS)){aQ=aS}else{if(aS&&aS!==aQ){aQ||(aQ=aC(aP.createFragment(aM),aN,aR));aO._data[aR]=aQ;at(aQ).setupData({attributes:aS})}else{aQ=aS}}return aQ}function e(aM,aP,aO,aQ){var aN=at(aM);aO=aQ?aC(aQ,aM,aP):null;if(aN._data[aP]!==aO){ar(aM,aP,aO)}else{U(aM,aP)}return aO}return h(aL,aJ,aI,e)}function aF(aI,e){if(e instanceof aI){return true}else{if(v.MODEL_FACTORY_INJECTIONS){return e instanceof aI.superclass}}return false}function F(e,aI){aI||(aI={});if(v.typeOf(e)!=="string"){return q(aI)}var aK=b("fragment-array",e,aI);return G(aK,aI,function aJ(aL,aM){return aD.create({type:e,options:aI,name:aM,owner:aL})})}function q(aI){aI||(aI={});var aJ=b("array");return G(aJ,aI,function e(aK,aL){return av.create({options:aI,name:aL,owner:aK})})}function h(aK,aJ,aI,e){aJ=aJ||{};var aL={type:aK,isAttribute:true,isFragment:true,options:aJ};return l({get:function(aO){var aM=at(this);var aN=aI(this.store,this,aO);return aM._fragments[aO]=aN},set:function(aO,aP){var aM=at(this);var aN=aI(this.store,this,aO);aN=e(this,aO,aN,aP);return aM._fragments[aO]=aN}}).meta(aL)}function G(aL,aK,aI){function aJ(aP,aN,aQ){var aO=at(aN);var aR=aO._data[aQ]||I(aO,aK,"array");var aM=aO._fragments[aQ]||null;if(aR instanceof av&&!aM){aM=aR}else{if(aR&&aR!==aM){aM||(aM=aI(aN,aQ));aO._data[aQ]=aM;aM.setupData(aR)}else{aM=aR}}return aM}function e(aN,aP,aM,aQ){var aO=at(aN);if(v.isArray(aQ)){aM||(aM=aI(aN,aP));aM.setObjects(aQ)}else{if(aQ===null){aM=null}else{}}if(aO._data[aP]!==aM||m(aM,"hasDirtyAttributes")){ar(aN,aP,aM)}else{U(aN,aP)}return aM}return h(aL,aK,aJ,e)}function ab(){return v.computed(function(){return at(this)._owner}).readOnly()}function I(e,aI,aJ){var aK;if(typeof aI.defaultValue==="function"){aK=aI.defaultValue()}else{if(aI.defaultValue){aK=aI.defaultValue}else{return null}}return v.copy(aK,true)}var T=v.makeArray;var Q=ae.extend({deserialize:function ak(e){return e==null?null:T(e)},serialize:function an(e){return e&&e.toArray?e.toArray():e}});var L=Q;var A=v.get;var M=ae.extend({store:null,modelName:null,polymorphicTypeProp:null,deserialize:function az(e){if(e==null){return null}return this.deserializeSingle(e)},serialize:function y(aI){if(!aI){return null}var e=this.store;var aJ=e.serializerFor(aI.modelName);return aJ.serialize(aI)},modelNameFor:function f(aJ){var aI=A(this,"modelName");var e=A(this,"polymorphicTypeProp");if(aJ&&e&&aJ[e]){aI=aJ[e]}return aI},deserializeSingle:function ay(aL){var aI=this.store;var e=this.modelNameFor(aL);var aJ=aI.serializerFor(e);var aN=A(aJ,"isNewSerializerAPI");var aK=aI.modelFor(e);var aM=aJ.normalize(aK,aL);if(aN){return A(aM,"data.attributes")}else{return aM}}});var ax=M;var aa=ax.extend({deserialize:function O(e){if(e==null){return null}return W(e,function(aI){return this.deserializeSingle(aI)},this)},serialize:function n(aI){if(!aI){return null}var e=this.store;return W(aI,function(aJ){var aK=e.serializerFor(aJ.modelName);return aK.serialize(aJ)})}});var K=aa;var a=[{name:"fragmentTransform",before:"store",initialize:function(e,aI){aI.register("transform:fragment",ax);aI.register("transform:fragment-array",K);aI.register("transform:array",L)}}];var s=a;function C(e){e.ModelFragment=u;e.FragmentArray=aD;e.FragmentTransform=ax;e.FragmentArrayTransform=K;e.ArrayTransform=L;e.hasOneFragment=N;e.hasManyFragments=F;e.fragmentOwner=ab}var ao=v.Namespace.create({VERSION:"0.3.3+8b1fcdd5"});C(ao);C(aA);v.onLoad("Ember.Application",function(e){s.forEach(e.initializer,e)});if(v.libraries){v.libraries.register("Model Fragments",ao.VERSION)}var E=ao}).call(this);