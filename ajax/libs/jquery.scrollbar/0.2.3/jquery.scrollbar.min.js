/**
 * jQuery CSS Customizable Scrollbar
 *
 * Copyright 2014, Yuriy Khabarov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * If you found bug, please contact me via email <13real008@gmail.com>
 *
 * @author Yuriy Khabarov aka Gromo
 * @version 0.2.3
 * @url https://github.com/gromo/jquery.scrollbar/
 */
(function(e,t,n){function h(){if(o.webkit){return{height:0,width:0}}if(!o.data.outer){var t={border:"none","box-sizing":"content-box",height:"200px",margin:"0",padding:"0",width:"200px"};o.data.inner=e("<div>").css(e.extend({},t));o.data.outer=e("<div>").css(e.extend({left:"-1000px",overflow:"scroll",position:"absolute",top:"-1000px"},t)).append(o.data.inner).appendTo("body")}o.data.outer.scrollLeft(1e3).scrollTop(1e3);return{height:Math.ceil(o.data.outer.offset().top-o.data.inner.offset().top||0),width:Math.ceil(o.data.outer.offset().left-o.data.inner.offset().left||0)}}function p(n,r){e(t).on({"blur.scrollbar":function(){e(t).add("body").off(".scrollbar");n&&n()},"dragstart.scrollbar":function(e){e.preventDefault();return false},"mouseup.scrollbar":function(){e(t).add("body").off(".scrollbar");n&&n()}});e("body").on({"selectstart.scrollbar":function(e){e.preventDefault();return false}});r&&r.preventDefault();return false}function d(e){var t=e.originalEvent;if(t.axis&&t.axis===t.HORIZONTAL_AXIS)return false;if(t.wheelDeltaX)return false;return true}var r=false;var i=1,s="px";var o={data:{},mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(n.navigator.userAgent),scroll:null,scrolls:[],webkit:n.WebKitPoint?true:false,log:r?function(t,r){var i=t;if(r&&typeof t!="string"){i=[];e.each(t,function(e,t){i.push('"'+e+'": '+t)});i=i.join(", ")}if(n.console&&n.console.log){n.console.log(i)}else{alert(i)}}:function(){}};var u={autoScrollSize:true,autoUpdate:true,disableBodyScroll:false,duration:200,ignoreMobile:true,scrollStep:30,showArrows:false,stepScrolling:true,type:"simple",scrollx:null,scrolly:null,onDestroy:null,onInit:null,onScroll:null,onUpdate:null};var a=function(t,r){if(!o.scroll){o.log("Init jQuery Scrollbar v0.2.3");o.scroll=h();c();e(n).resize(function(){var e=false;if(o.scroll&&(o.scroll.height||o.scroll.width)){var t=h();if(t.height!=o.scroll.height||t.width!=o.scroll.width){o.scroll=t;e=true}}c(e)})}this.container=t;this.options=e.extend({},u,n.jQueryScrollbarOptions||{});this.scrollTo=null;this.scrollx={};this.scrolly={};this.init(r)};a.prototype={destroy:function(){if(!this.wrapper){return}var n=this.container.scrollLeft();var r=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({height:"",margin:""}).removeClass("scroll-content").removeClass("scroll-scrollx_visible").removeClass("scroll-scrolly_visible").off(".scrollbar").scrollLeft(n).scrollTop(r);this.scrollx.scrollbar.removeClass("scroll-scrollx_visible").find("div").andSelf().off(".scrollbar");this.scrolly.scrollbar.removeClass("scroll-scrolly_visible").find("div").andSelf().off(".scrollbar");this.wrapper.remove();e(t).add("body").off(".scrollbar");if(e.isFunction(this.options.onDestroy))this.options.onDestroy.apply(this,[this.container])},getScrollbar:function(t){var n=this.options["scroll"+t];var r={advanced:'<div class="scroll-element_corner"></div>'+'<div class="scroll-arrow scroll-arrow_less"></div>'+'<div class="scroll-arrow scroll-arrow_more"></div>'+'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner-wrapper">'+'        <div class="scroll-element_inner scroll-element_track">'+'            <div class="scroll-element_inner-bottom"></div>'+"        </div>"+"    </div>"+'    <div class="scroll-bar">'+'        <div class="scroll-bar_body">'+'            <div class="scroll-bar_body-inner"></div>'+"        </div>"+'        <div class="scroll-bar_bottom"></div>'+'        <div class="scroll-bar_center"></div>'+"    </div>"+"</div>",simple:'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_track"></div>'+'    <div class="scroll-bar"></div>'+"</div>"};var i=r[this.options.type]?this.options.type:"advanced";if(n){if(typeof n=="string"){n=e(n).appendTo(this.wrapper)}else{n=e(n)}}else{n=e("<div>").addClass("scroll-element").html(r[i]).appendTo(this.wrapper)}if(this.options.showArrows){n.addClass("scroll-element_arrows_visible")}return n.addClass("scroll-"+t)},init:function(n){var r=this;var u=this.container;var a=e.extend(this.options,n||{});var f={x:this.scrollx,y:this.scrolly};var l=this.wrapper;var c={scrollLeft:u.scrollLeft(),scrollTop:u.scrollTop()};if(o.mobile&&a.ignoreMobile){return false}if(!l){this.wrapper=l=u.wrap(e("<div>").css({position:u.css("position")=="absolute"?"absolute":"relative"}).addClass("scroll-wrapper").addClass(u.attr("class"))).parent();u.addClass("scroll-content").css({height:"","margin-bottom":o.scroll.height*-1+s,"margin-right":o.scroll.width*-1+s}).on("scroll.scrollbar",function(t){if(e.isFunction(a.onScroll)){a.onScroll.call(this,{maxScroll:f.y.maxScrollOffset,scroll:u.scrollTop(),size:f.y.size,visible:f.y.visible},{maxScroll:f.x.maxScrollOffset,scroll:u.scrollLeft(),size:f.x.size,visible:f.x.visible})}f.x.isVisible&&f.x.scroller.css("left",u.scrollLeft()*f.x.kx+s);f.y.isVisible&&f.y.scroller.css("top",u.scrollTop()*f.y.kx+s)});l.on("scroll",function(){l.scrollTop(0).scrollLeft(0)});if(a.disableBodyScroll){var h=function(e){d(e)?f.y.isVisible&&f.y.mousewheel(e):f.x.isVisible&&f.x.mousewheel(e)};l.on({"MozMousePixelScroll.scrollbar":h,"mousewheel.scrollbar":h});if(o.mobile){l.on("touchstart.scrollbar",function(n){var r=n.originalEvent.touches&&n.originalEvent.touches[0]||n;var i={pageX:r.pageX,pageY:r.pageY};var s={left:u.scrollLeft(),top:u.scrollTop()};e(t).on({"touchmove.scrollbar":function(e){var t=e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]||e;u.scrollLeft(s.left+i.pageX-t.pageX);u.scrollTop(s.top+i.pageY-t.pageY);e.preventDefault()},"touchend.scrollbar":function(){e(t).off(".scrollbar")}})})}}if(e.isFunction(a.onInit))a.onInit.apply(this,[u])}else{u.css({height:"","margin-bottom":o.scroll.height*-1+s,"margin-right":o.scroll.width*-1+s})}e.each(f,function(n,s){var o=null;var l=1;var c=n=="x"?"scrollLeft":"scrollTop";var h=a.scrollStep;var v=function(){var e=u[c]();u[c](e+h);if(l==1&&e+h>=m)e=u[c]();if(l==-1&&e+h<=m)e=u[c]();if(u[c]()==e&&o){o()}};var m=0;if(!s.scrollbar){s.scrollbar=r.getScrollbar(n);s.scroller=s.scrollbar.find(".scroll-bar");s.mousewheel=function(e){if(!s.isVisible||n=="x"&&d(e)){return true}if(n=="y"&&!d(e)){f.x.mousewheel(e);return true}var t=e.originalEvent.wheelDelta*-1||e.originalEvent.detail;var i=s.size-s.visible-s.offset;if(!(m<=0&&t<0||m>=i&&t>0)){m=m+t;if(m<0)m=0;if(m>i)m=i;r.scrollTo=r.scrollTo||{};r.scrollTo[c]=m;setTimeout(function(){if(r.scrollTo){u.stop().animate(r.scrollTo,240,"linear",function(){m=u[c]()});r.scrollTo=null}},1)}e.preventDefault();return false};s.scrollbar.on({"MozMousePixelScroll.scrollbar":s.mousewheel,"mousewheel.scrollbar":s.mousewheel,"mouseenter.scrollbar":function(){m=u[c]()}});s.scrollbar.find(".scroll-arrow, .scroll-element_track").on("mousedown.scrollbar",function(t){if(t.which!=i)return true;l=1;var f={eventOffset:t[n=="x"?"pageX":"pageY"],maxScrollValue:s.size-s.visible-s.offset,scrollbarOffset:s.scroller.offset()[n=="x"?"left":"top"],scrollbarSize:s.scroller[n=="x"?"outerWidth":"outerHeight"]()};var d=0,g=0;if(e(this).hasClass("scroll-arrow")){l=e(this).hasClass("scroll-arrow_more")?1:-1;h=a.scrollStep*l;m=l>0?f.maxScrollValue:0}else{l=f.eventOffset>f.scrollbarOffset+f.scrollbarSize?1:f.eventOffset<f.scrollbarOffset?-1:0;h=Math.round(s.visible*.75)*l;m=f.eventOffset-f.scrollbarOffset-(a.stepScrolling?l==1?f.scrollbarSize:0:Math.round(f.scrollbarSize/2));m=u[c]()+m/s.kx}r.scrollTo=r.scrollTo||{};r.scrollTo[c]=a.stepScrolling?u[c]()+h:m;if(a.stepScrolling){o=function(){m=u[c]();clearInterval(g);clearTimeout(d);d=0;g=0};d=setTimeout(function(){g=setInterval(v,40)},a.duration+100)}setTimeout(function(){if(r.scrollTo){u.animate(r.scrollTo,a.duration);r.scrollTo=null}},1);return p(o,t)});s.scroller.on("mousedown.scrollbar",function(r){if(r.which!=i)return true;var o=r[n=="x"?"pageX":"pageY"];var a=u[c]();s.scrollbar.addClass("scroll-draggable");e(t).on("mousemove.scrollbar",function(e){var t=parseInt((e[n=="x"?"pageX":"pageY"]-o)/s.kx,10);u[c](a+t)});return p(function(){s.scrollbar.removeClass("scroll-draggable");m=u[c]()},r)})}});e.each(f,function(e,t){var n="scroll-scroll"+e+"_visible";var r=e=="x"?f.y:f.x;t.scrollbar.removeClass(n);r.scrollbar.removeClass(n);u.removeClass(n)});e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});var v=function(t,n){var r="scroll-scroll"+t+"_visible";var i=t=="x"?f.y:f.x;var a=parseInt(u.css(t=="x"?"left":"top"),10)||0;var c=n.size;var h=n.visible+a;n.isVisible=c-h>1;if(n.isVisible){n.scrollbar.addClass(r);i.scrollbar.addClass(r);u.addClass(r)}else{n.scrollbar.removeClass(r);i.scrollbar.removeClass(r);u.removeClass(r)}if(t=="y"&&(n.isVisible||n.size<n.visible)){u.css("height",h+o.scroll.height+s)}if(f.x.size!=u.prop("scrollWidth")||f.y.size!=u.prop("scrollHeight")||f.x.visible!=l.width()||f.y.visible!=l.height()||f.x.offset!=(parseInt(u.css("left"),10)||0)||f.y.offset!=(parseInt(u.css("top"),10)||0)){e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});v(t=="x"?"y":"x",i)}};e.each(f,v);if(e.isFunction(a.onUpdate))a.onUpdate.apply(this,[u]);e.each(f,function(e,t){var n=e=="x"?"left":"top";var r=e=="x"?"outerWidth":"outerHeight";var i=e=="x"?"width":"height";var o=parseInt(u.css(n),10)||0;var f=t.size;var l=t.visible+o;var c=t.scrollbar.find(".scroll-element_size");c=c[r]()+(parseInt(c.css(n),10)||0);if(a.autoScrollSize){t.scrollbarSize=parseInt(c*l/f,10);t.scroller.css(i,t.scrollbarSize+s)}t.scrollbarSize=t.scroller[r]();t.kx=(c-t.scrollbarSize)/(f-l)||1;t.maxScrollOffset=f-l});u.scrollLeft(c.scrollLeft).scrollTop(c.scrollTop).trigger("scroll")}};e.fn.scrollbar=function(t,n){var r=this;if(t==="get")r=null;this.each(function(){var i=e(this);if(i.hasClass("scroll-wrapper")||i.get(0).nodeName=="body"){return true}var s=i.data("scrollbar");if(s){if(t==="get"){r=s;return false}var u=typeof t=="string"&&s[t]?t:"init";s[u].apply(s,e.isArray(n)?n:[]);if(t==="destroy"){i.removeData("scrollbar");while(e.inArray(s,o.scrolls)>=0)o.scrolls.splice(e.inArray(s,o.scrolls),1)}}else{if(typeof t!="string"){s=new a(i,t);i.data("scrollbar",s);o.scrolls.push(s)}}return true});return r};e.fn.scrollbar.options=u;if(n.angular){(function(e){var t=e.module("jQueryScrollbar",[]);t.directive("jqueryScrollbar",function(){return{link:function(e,t){t.scrollbar(e.options).on("$destroy",function(){t.scrollbar("destroy")})},restring:"A",scope:{options:"=jqueryScrollbar"}}})})(n.angular)}var f=0,l=0;var c=function(e){var t,n,i,s,u,a,h;for(t=0;t<o.scrolls.length;t++){s=o.scrolls[t];n=s.container;i=s.options;u=s.wrapper;a=s.scrollx;h=s.scrolly;if(e||i.autoUpdate&&u&&u.is(":visible")&&(n.prop("scrollWidth")!=a.size||n.prop("scrollHeight")!=h.size||u.width()!=a.visible||u.height()!=h.visible)){s.init();if(r){o.log({scrollHeight:n.prop("scrollHeight")+":"+s.scrolly.size,scrollWidth:n.prop("scrollWidth")+":"+s.scrollx.size,visibleHeight:u.height()+":"+s.scrolly.visible,visibleWidth:u.width()+":"+s.scrollx.visible},true);l++}}}if(r&&l>10){o.log("Scroll updates exceed 10");c=function(){}}else{clearTimeout(f);f=setTimeout(c,300)}}})(jQuery,document,window);