{"version":3,"sources":["webpack:///pangu.min.js","webpack:///webpack/bootstrap 318938e3ff5135e566ef?4f25","webpack:///./src/browser/pangu.js?52fc","webpack:///./src/shared/core.js?02df"],"names":["pangu","modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","Pangu","COMMENT_NODE_TYPE","BrowserPangu","_Pangu","this","_this","getPrototypeOf","topTags","ignoreTags","spaceSensitiveTags","spaceLikeTags","blockTags","node","parentNode","nodeName","search","getAttribute","targetNode","childNodes","childNode","nodeType","textContent","xPathQuery","contextNode","arguments","undefined","document","hasSpacing","textNodes","evaluate","XPathResult","ORDERED_NODE_SNAPSHOT_TYPE","currentTextNode","nextTextNode","snapshotLength","snapshotItem","canIgnoreNode","newText","spacing","data","nextSibling","testText","toString","substr","testNewText","nextNode","isFirstTextChild","currentNode","isLastTextChild","previousSibling","panguSpace","createElement","innerHTML","insertBefore","previousElementSibling","removeChild","titleQuery","spacingNodeByXPath","bodyQuery","_arr","_i","tag","hasSpacingPageTitle","spacingPageTitle","hasSpacingPageBody","spacingPageBody","idName","className","tagName","text","replace","oldText","tmpText","callback"],"mappings":"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","file":"pangu.min.js","sourcesContent":["var pangu =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Pangu = __webpack_require__(1).Pangu;\n\t\n\t// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\n\tvar COMMENT_NODE_TYPE = 8;\n\t\n\tvar BrowserPangu = function (_Pangu) {\n\t  _inherits(BrowserPangu, _Pangu);\n\t\n\t  function BrowserPangu() {\n\t    _classCallCheck(this, BrowserPangu);\n\t\n\t    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(BrowserPangu).call(this));\n\t\n\t    _this.topTags = /^(html|head|body|#document)$/i;\n\t    _this.ignoreTags = /^(code|pre|textarea)$/i;\n\t    _this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n\t    _this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n\t    _this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n\t    return _this;\n\t  }\n\t\n\t  _createClass(BrowserPangu, [{\n\t    key: 'canIgnoreNode',\n\t    value: function canIgnoreNode(node) {\n\t      var parentNode = node.parentNode;\n\t\n\t      while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n\t        if (parentNode.getAttribute('contenteditable') === 'true' || parentNode.getAttribute('g_editable') === 'true' || parentNode.nodeName.search(this.ignoreTags) >= 0) {\n\t          return true;\n\t        }\n\t\n\t        parentNode = parentNode.parentNode;\n\t      }\n\t\n\t      return false;\n\t    }\n\t  }, {\n\t    key: 'isFirstTextChild',\n\t    value: function isFirstTextChild(parentNode, targetNode) {\n\t      var childNodes = parentNode.childNodes;\n\t\n\t      // 只判斷第一個含有 text 的 node\n\t      for (var i = 0; i < childNodes.length; i++) {\n\t        var childNode = childNodes[i];\n\t        if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n\t          return childNode === targetNode;\n\t        }\n\t      }\n\t\n\t      // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n\t      // return false;\n\t    }\n\t  }, {\n\t    key: 'isLastTextChild',\n\t    value: function isLastTextChild(parentNode, targetNode) {\n\t      var childNodes = parentNode.childNodes;\n\t\n\t      // 只判斷倒數第一個含有 text 的 node\n\t      for (var i = childNodes.length - 1; i > -1; i--) {\n\t        var childNode = childNodes[i];\n\t        if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n\t          return childNode === targetNode;\n\t        }\n\t      }\n\t\n\t      // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n\t      // return false;\n\t    }\n\t  }, {\n\t    key: 'spacingNodeByXPath',\n\t    value: function spacingNodeByXPath(xPathQuery) {\n\t      var contextNode = arguments.length <= 1 || arguments[1] === undefined ? document : arguments[1];\n\t\n\t      // 是否加了空格\n\t      var hasSpacing = false;\n\t\n\t      // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n\t      // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n\t      // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n\t      // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n\t      var textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\t\n\t      var currentTextNode = undefined;\n\t      var nextTextNode = undefined;\n\t\n\t      // 從最下面、最裡面的節點開始，所以是倒序的\n\t      for (var i = textNodes.snapshotLength - 1; i > -1; --i) {\n\t        currentTextNode = textNodes.snapshotItem(i);\n\t\n\t        if (this.canIgnoreNode(currentTextNode)) {\n\t          nextTextNode = currentTextNode;\n\t          continue;\n\t        }\n\t\n\t        var newText = this.spacing(currentTextNode.data);\n\t        if (currentTextNode.data !== newText) {\n\t          hasSpacing = true;\n\t          currentTextNode.data = newText;\n\t        }\n\t\n\t        // 處理嵌套的 <tag> 中的文字\n\t        if (nextTextNode) {\n\t          // TODO\n\t          // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n\t          // 萬一遇上嵌套的標籤就不行了\n\t          if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n\t            nextTextNode = currentTextNode;\n\t            continue;\n\t          }\n\t\n\t          // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n\t          var testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n\t          var testNewText = this.spacing(testText);\n\t          if (testNewText !== testText) {\n\t            hasSpacing = true;\n\t\n\t            // 往上找 nextTextNode 的 parent node\n\t            // 直到遇到 spaceSensitiveTags\n\t            // 而且 nextTextNode 必須是第一個 text child\n\t            // 才能把空格加在 nextTextNode 的前面\n\t            var nextNode = nextTextNode;\n\t            while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n\t              nextNode = nextNode.parentNode;\n\t            }\n\t\n\t            var currentNode = currentTextNode;\n\t            while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n\t              currentNode = currentNode.parentNode;\n\t            }\n\t\n\t            if (currentNode.nextSibling) {\n\t              if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n\t                nextTextNode = currentTextNode;\n\t                continue;\n\t              }\n\t            }\n\t\n\t            if (currentNode.nodeName.search(this.blockTags) === -1) {\n\t              if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n\t                if (nextNode.nodeName.search(this.ignoreTags) === -1 && nextNode.nodeName.search(this.blockTags) === -1) {\n\t                  if (nextTextNode.previousSibling) {\n\t                    if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n\t                      nextTextNode.data = ' ' + nextTextNode.data;\n\t                    }\n\t                  } else {\n\t                    // dirty hack\n\t                    if (!this.canIgnoreNode(nextTextNode)) {\n\t                      nextTextNode.data = ' ' + nextTextNode.data;\n\t                    }\n\t                  }\n\t                }\n\t              } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n\t                currentTextNode.data = currentTextNode.data + ' ';\n\t              } else {\n\t                var panguSpace = document.createElement('pangu');\n\t                panguSpace.innerHTML = ' ';\n\t\n\t                // 避免一直被加空格\n\t                if (nextNode.previousSibling) {\n\t                  if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n\t                    nextNode.parentNode.insertBefore(panguSpace, nextNode);\n\t                  }\n\t                } else {\n\t                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n\t                }\n\t\n\t                // TODO\n\t                // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n\t                // 這個做法有點蠢，但是不管還是先硬上\n\t                if (!panguSpace.previousElementSibling) {\n\t                  if (panguSpace.parentNode) {\n\t                    panguSpace.parentNode.removeChild(panguSpace);\n\t                  }\n\t                }\n\t              }\n\t            }\n\t          }\n\t        }\n\t\n\t        nextTextNode = currentTextNode;\n\t      }\n\t\n\t      return hasSpacing;\n\t    }\n\t  }, {\n\t    key: 'spacingPageTitle',\n\t    value: function spacingPageTitle() {\n\t      var titleQuery = '/html/head/title/text()';\n\t      var hasSpacing = this.spacingNodeByXPath(titleQuery);\n\t\n\t      return hasSpacing;\n\t    }\n\t  }, {\n\t    key: 'spacingPageBody',\n\t    value: function spacingPageBody() {\n\t      // // >> 任意位置的節點\n\t      // . >> 當前節點\n\t      // .. >> 父節點\n\t      // [] >> 條件\n\t      // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n\t      //\n\t      // [@contenteditable]\n\t      // 帶有 contenteditable 屬性的節點\n\t      //\n\t      // normalize-space(.)\n\t      // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n\t      //\n\t      // name(..)\n\t      // 父節點的名稱\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n\t      //\n\t      // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n\t      // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n\t      // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n\t      //\n\t      // 1. 處理 <title>\n\t      // 2. 處理 <body> 底下的節點\n\t      // 3. 略過 contentEditable 的節點\n\t      // 4. 略過特定節點，例如 <script> 和 <style>\n\t      //\n\t      // 注意，以下的 query 只會取出各節點的 text 內容！\n\t      var bodyQuery = '/html/body//*/text()[normalize-space(.)]';\n\t      var _arr = ['script', 'style', 'textarea'];\n\t      for (var _i = 0; _i < _arr.length; _i++) {\n\t        var tag = _arr[_i];\n\t        // 理論上這幾個 tag 裡面不會包含其他 tag\n\t        // 所以可以直接用 .. 取父節點\n\t        // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n\t        bodyQuery += '[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"' + tag + '\"]';\n\t      }\n\t      var hasSpacing = this.spacingNodeByXPath(bodyQuery);\n\t\n\t      return hasSpacing;\n\t    }\n\t  }, {\n\t    key: 'spacingPage',\n\t    value: function spacingPage() {\n\t      var hasSpacingPageTitle = this.spacingPageTitle();\n\t      var hasSpacingPageBody = this.spacingPageBody();\n\t\n\t      return hasSpacingPageTitle || hasSpacingPageBody;\n\t    }\n\t  }, {\n\t    key: 'spacingElementById',\n\t    value: function spacingElementById(idName) {\n\t      var xPathQuery = 'id(\"' + idName + '\")//text()';\n\t\n\t      var hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\t\n\t      return hasSpacing;\n\t    }\n\t  }, {\n\t    key: 'spacingElementByClassName',\n\t    value: function spacingElementByClassName(className) {\n\t      var xPathQuery = '//*[contains(concat(\" \", normalize-space(@class), \" \"), \"' + className + '\")]//text()';\n\t\n\t      var hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\t\n\t      return hasSpacing;\n\t    }\n\t  }, {\n\t    key: 'spacingElementByTagName',\n\t    value: function spacingElementByTagName(tagName) {\n\t      var xPathQuery = '//' + tagName + '//text()';\n\t\n\t      var hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\t\n\t      return hasSpacing;\n\t    }\n\t  }]);\n\t\n\t  return BrowserPangu;\n\t}(Pangu);\n\t\n\tvar pangu = new BrowserPangu();\n\t\n\tmodule.exports = pangu;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Pangu = function () {\n\t  function Pangu() {\n\t    _classCallCheck(this, Pangu);\n\t  }\n\t\n\t  _createClass(Pangu, [{\n\t    key: 'spacing',\n\t    value: function spacing(text) {\n\t      var newText = text;\n\t\n\t      /*\n\t      \\u2e80-\\u2eff CJK Radicals Supplement\n\t      \\u2f00-\\u2fdf Kangxi Radicals\n\t      \\u3040-\\u309f Hiragana\n\t      \\u30a0-\\u30ff Katakana\n\t      \\u3100-\\u312f Bopomofo\n\t      \\u3200-\\u32ff Enclosed CJK Letters and Months\n\t      \\u3400-\\u4dbf CJK Unified Ideographs Extension A\n\t      \\u4e00-\\u9fff CJK Unified Ideographs\n\t      \\uf900-\\ufaff CJK Compatibility Ideographs\n\t       http://unicode-table.com/en/\n\t      https://github.com/vinta/pangu\n\t      */\n\t\n\t      // cjk_quote >> 跟 Go 版差了一個 '\n\t      // quote_cjk >> 跟 Go 版差了一個 '\n\t      // fix_quote\n\t      // fix_single_quote\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g, '$1 $2');\n\t      newText = newText.replace(/([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n\t      newText = newText.replace(/([\"'\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\"'\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g, '$1$3$4');\n\t\n\t      // cjk_hash\n\t      // hash_cjk\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#(\\S+))/g, '$1 $2');\n\t      newText = newText.replace(/((\\S+)#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $3');\n\t\n\t      // cjk_operator_ans\n\t      // ans_operator_cjk\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g, '$1 $2 $3');\n\t      newText = newText.replace(/([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $3');\n\t\n\t      // cjk_bracket_cjk\n\t      // cjk_bracket\n\t      // bracket_cjk\n\t      // fix_bracket\n\t      var oldText = newText;\n\t      var tmpText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $4');\n\t      newText = tmpText;\n\t      if (oldText === tmpText) {\n\t        newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g, '$1 $2');\n\t        newText = newText.replace(/([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n\t      }\n\t      newText = newText.replace(/([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n\t\n\t      // fix_symbol\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g, '$1$2 $3');\n\t\n\t      // cjk_ans\n\t      // ans_cjk\n\t      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g, '$1 $2');\n\t      newText = newText.replace(/([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n\t\n\t      return newText;\n\t    }\n\t  }, {\n\t    key: 'spacingText',\n\t    value: function spacingText(text, callback) {\n\t      var newText = this.spacing(text);\n\t      callback(null, newText);\n\t    }\n\t  }]);\n\t\n\t  return Pangu;\n\t}();\n\t\n\tmodule.exports.Pangu = Pangu;\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** pangu.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 318938e3ff5135e566ef\n **/","const Pangu = require('../shared/core').Pangu;\n\n// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\nconst COMMENT_NODE_TYPE = 8;\n\nclass BrowserPangu extends Pangu {\n\n  constructor() {\n    super();\n\n    this.topTags = /^(html|head|body|#document)$/i;\n    this.ignoreTags = /^(code|pre|textarea)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n  }\n\n  canIgnoreNode(node) {\n    let parentNode = node.parentNode;\n\n    while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n      if ((parentNode.getAttribute('contenteditable') === 'true') || (parentNode.getAttribute('g_editable') === 'true') || (parentNode.nodeName.search(this.ignoreTags) >= 0)) {\n        return true;\n      }\n\n      parentNode = parentNode.parentNode;\n    }\n\n    return false;\n  }\n\n  isFirstTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n    // return false;\n  }\n\n  isLastTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n    // return false;\n  }\n\n  spacingNodeByXPath(xPathQuery, contextNode = document) {\n    // 是否加了空格\n    let hasSpacing = false;\n\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacing(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        hasSpacing = true;\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacing(testText);\n        if (testNewText !== testText) {\n          hasSpacing = true;\n\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoreTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ' ' + nextTextNode.data;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ' ' + nextTextNode.data;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = currentTextNode.data + ' ';\n            } else {\n              let panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n\n    return hasSpacing;\n  }\n\n  spacingPageTitle() {\n    const titleQuery = '/html/head/title/text()';\n    const hasSpacing = this.spacingNodeByXPath(titleQuery);\n\n    return hasSpacing;\n  }\n\n  spacingPageBody() {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let bodyQuery = '/html/body//*/text()[normalize-space(.)]';\n    for (const tag of ['script', 'style', 'textarea']) {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      bodyQuery += `[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    }\n    const hasSpacing = this.spacingNodeByXPath(bodyQuery);\n\n    return hasSpacing;\n  }\n\n  spacingPage() {\n    const hasSpacingPageTitle = this.spacingPageTitle();\n    const hasSpacingPageBody = this.spacingPageBody();\n\n    return hasSpacingPageTitle || hasSpacingPageBody;\n  }\n\n  spacingElementById(idName) {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n  spacingElementByClassName(className) {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n  spacingElementByTagName(tagName) {\n    const xPathQuery = `//${tagName}//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n}\n\nconst pangu = new BrowserPangu();\n\nmodule.exports = pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser/pangu.js\n **/","class Pangu {\n\n  constructor() {\n  }\n\n  spacing(text) {\n    let newText = text;\n\n    /*\n    \\u2e80-\\u2eff CJK Radicals Supplement\n    \\u2f00-\\u2fdf Kangxi Radicals\n    \\u3040-\\u309f Hiragana\n    \\u30a0-\\u30ff Katakana\n    \\u3100-\\u312f Bopomofo\n    \\u3200-\\u32ff Enclosed CJK Letters and Months\n    \\u3400-\\u4dbf CJK Unified Ideographs Extension A\n    \\u4e00-\\u9fff CJK Unified Ideographs\n    \\uf900-\\ufaff CJK Compatibility Ideographs\n\n    http://unicode-table.com/en/\n    https://github.com/vinta/pangu\n    */\n\n    // cjk_quote >> 跟 Go 版差了一個 '\n    // quote_cjk >> 跟 Go 版差了一個 '\n    // fix_quote\n    // fix_single_quote\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g, '$1 $2');\n    newText = newText.replace(/([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n    newText = newText.replace(/([\"'\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\"'\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g, '$1$3$4');\n\n    // cjk_hash\n    // hash_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#(\\S+))/g, '$1 $2');\n    newText = newText.replace(/((\\S+)#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $3');\n\n    // cjk_operator_ans\n    // ans_operator_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g, '$1 $2 $3');\n    newText = newText.replace(/([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $3');\n\n    // cjk_bracket_cjk\n    // cjk_bracket\n    // bracket_cjk\n    // fix_bracket\n    const oldText = newText;\n    const tmpText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $4');\n    newText = tmpText;\n    if (oldText === tmpText) {\n      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g, '$1 $2');\n      newText = newText.replace(/([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n    }\n    newText = newText.replace(/([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n\n    // fix_symbol\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g, '$1$2 $3');\n\n    // cjk_ans\n    // ans_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g, '$1 $2');\n    newText = newText.replace(/([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n\n    return newText;\n  }\n\n  spacingText(text, callback) {\n    const newText = this.spacing(text);\n    callback(null, newText);\n  }\n\n}\n\nmodule.exports.Pangu = Pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/core.js\n **/"],"sourceRoot":""}