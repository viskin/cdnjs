{"version":3,"sources":["webpack:///webpack/bootstrap 318938e3ff5135e566ef","webpack:///./src/browser/pangu.js","webpack:///./src/shared/core.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;ACtCA,KAAM,KAAK,GAAG,mBAAO,CAAC,CAAgB,CAAC,CAAC,KAAK;;;AAG7C,KAAM,iBAAiB,GAAG,CAAC,CAAC;;KAEtB,YAAY;aAAZ,YAAY;;AAEhB,YAFI,YAAY,GAEF;2BAFV,YAAY;;wEAAZ,YAAY;;AAKd,WAAK,OAAO,GAAG,+BAA+B,CAAC;AAC/C,WAAK,UAAU,GAAG,wBAAwB,CAAC;AAC3C,WAAK,kBAAkB,GAAG,2BAA2B,CAAC;AACtD,WAAK,aAAa,GAAG,wBAAwB,CAAC;AAC9C,WAAK,SAAS,GAAG,8BAA8B,CAAC;;IACjD;;gBAVG,YAAY;;mCAYF,IAAI,EAAE;AAClB,WAAI,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;;AAEjC,cAAO,UAAU,IAAI,UAAU,CAAC,QAAQ,IAAI,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE;AAC3F,aAAK,UAAU,CAAC,YAAY,CAAC,iBAAiB,CAAC,KAAK,MAAM,IAAM,UAAU,CAAC,YAAY,CAAC,YAAY,CAAC,KAAK,MAAO,IAAK,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAE,EAAE;AACvK,kBAAO,IAAI,CAAC;UACb;;AAED,mBAAU,GAAG,UAAU,CAAC,UAAU,CAAC;QACpC;;AAED,cAAO,KAAK,CAAC;MACd;;;sCAEgB,UAAU,EAAE,UAAU,EAAE;AACvC,WAAM,UAAU,GAAG,UAAU,CAAC,UAAU;;;AAGxC,YAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC1C,aAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;AAChC,aAAI,SAAS,CAAC,QAAQ,KAAK,iBAAiB,IAAI,SAAS,CAAC,WAAW,EAAE;AACrE,kBAAO,SAAS,KAAK,UAAU,CAAC;UACjC;QACF;;;;AAAA,MAIF;;;qCAEe,UAAU,EAAE,UAAU,EAAE;AACtC,WAAM,UAAU,GAAG,UAAU,CAAC,UAAU;;;AAGxC,YAAK,IAAI,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;AAC/C,aAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;AAChC,aAAI,SAAS,CAAC,QAAQ,KAAK,iBAAiB,IAAI,SAAS,CAAC,WAAW,EAAE;AACrE,kBAAO,SAAS,KAAK,UAAU,CAAC;UACjC;QACF;;;;AAAA,MAIF;;;wCAEkB,UAAU,EAA0B;WAAxB,WAAW,yDAAG,QAAQ;;;AAEnD,WAAI,UAAU,GAAG,KAAK;;;;;;AAMtB,WAAM,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC,UAAU,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,CAAC,0BAA0B,EAAE,IAAI,CAAC,CAAC;;AAEjH,WAAI,eAAe,aAAC;AACpB,WAAI,YAAY;;;AAGhB,YAAK,IAAI,CAAC,GAAG,SAAS,CAAC,cAAc,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE;AACtD,wBAAe,GAAG,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;;AAE5C,aAAI,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,EAAE;AACvC,uBAAY,GAAG,eAAe,CAAC;AAC/B,oBAAS;UACV;;AAED,aAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AACnD,aAAI,eAAe,CAAC,IAAI,KAAK,OAAO,EAAE;AACpC,qBAAU,GAAG,IAAI,CAAC;AAClB,0BAAe,CAAC,IAAI,GAAG,OAAO,CAAC;UAChC;;;AAGD,aAAI,YAAY,EAAE;;;;AAIhB,eAAI,eAAe,CAAC,WAAW,IAAI,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE;AACvG,yBAAY,GAAG,eAAe,CAAC;AAC/B,sBAAS;YACV;;;AAGD,eAAM,QAAQ,GAAG,eAAe,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACxG,eAAM,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC3C,eAAI,WAAW,KAAK,QAAQ,EAAE;AAC5B,uBAAU,GAAG,IAAI;;;;;;AAMjB,iBAAI,QAAQ,GAAG,YAAY,CAAC;AAC5B,oBAAO,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,EAAE;AAC9I,uBAAQ,GAAG,QAAQ,CAAC,UAAU,CAAC;cAChC;;AAED,iBAAI,WAAW,GAAG,eAAe,CAAC;AAClC,oBAAO,WAAW,CAAC,UAAU,IAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,UAAU,EAAE,WAAW,CAAC,EAAE;AACzJ,0BAAW,GAAG,WAAW,CAAC,UAAU,CAAC;cACtC;;AAED,iBAAI,WAAW,CAAC,WAAW,EAAE;AAC3B,mBAAI,WAAW,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE;AACpE,6BAAY,GAAG,eAAe,CAAC;AAC/B,0BAAS;gBACV;cACF;;AAED,iBAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE;AACtD,mBAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE;AAC5D,qBAAK,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,IAAM,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAE,EAAE;AAC3G,uBAAI,YAAY,CAAC,eAAe,EAAE;AAChC,yBAAI,YAAY,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,EAAE;AAC3E,mCAAY,CAAC,IAAI,GAAG,GAAG,GAAG,YAAY,CAAC,IAAI,CAAC;sBAC7C;oBACF,MAAM;;AAEL,yBAAI,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;AACrC,mCAAY,CAAC,IAAI,GAAG,GAAG,GAAG,YAAY,CAAC,IAAI,CAAC;sBAC7C;oBACF;kBACF;gBACF,MAAM,IAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE;AACtE,gCAAe,CAAC,IAAI,GAAG,eAAe,CAAC,IAAI,GAAG,GAAG,CAAC;gBACnD,MAAM;AACL,qBAAI,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AACjD,2BAAU,CAAC,SAAS,GAAG,GAAG;;;AAG1B,qBAAI,QAAQ,CAAC,eAAe,EAAE;AAC5B,uBAAI,QAAQ,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,EAAE;AACvE,6BAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;oBACxD;kBACF,MAAM;AACL,2BAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;kBACxD;;;;;AAKD,qBAAI,CAAC,UAAU,CAAC,sBAAsB,EAAE;AACtC,uBAAI,UAAU,CAAC,UAAU,EAAE;AACzB,+BAAU,CAAC,UAAU,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;oBAC/C;kBACF;gBACF;cACF;YACF;UACF;;AAED,qBAAY,GAAG,eAAe,CAAC;QAChC;;AAED,cAAO,UAAU,CAAC;MACnB;;;wCAEkB;AACjB,WAAM,UAAU,GAAG,yBAAyB,CAAC;AAC7C,WAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;;AAEvD,cAAO,UAAU,CAAC;MACnB;;;uCAEiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BhB,WAAI,SAAS,GAAG,0CAA0C,CAAC;kBACzC,CAAC,QAAQ,EAAE,OAAO,EAAE,UAAU,CAAC;AAAjD,gDAAmD;AAA9C,aAAM,GAAG;;;;AAIZ,kBAAS,0FAAwF,GAAG,OAAI,CAAC;QAC1G;AACD,WAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;;AAEtD,cAAO,UAAU,CAAC;MACnB;;;mCAEa;AACZ,WAAM,mBAAmB,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;AACpD,WAAM,kBAAkB,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;;AAElD,cAAO,mBAAmB,IAAI,kBAAkB,CAAC;MAClD;;;wCAEkB,MAAM,EAAE;AACzB,WAAM,UAAU,YAAU,MAAM,eAAY,CAAC;;AAE7C,WAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;;AAEvD,cAAO,UAAU,CAAC;MACnB;;;+CAEyB,SAAS,EAAE;AACnC,WAAM,UAAU,iEAA+D,SAAS,gBAAa,CAAC;;AAEtG,WAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;;AAEvD,cAAO,UAAU,CAAC;MACnB;;;6CAEuB,OAAO,EAAE;AAC/B,WAAM,UAAU,UAAQ,OAAO,aAAU,CAAC;;AAE1C,WAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;;AAEvD,cAAO,UAAU,CAAC;MACnB;;;UArPG,YAAY;GAAS,KAAK;;AAyPhC,KAAM,KAAK,GAAG,IAAI,YAAY,EAAE,CAAC;;AAEjC,OAAM,CAAC,OAAO,GAAG,KAAK,C;;;;;;;;;;;;KChQhB,KAAK;AAET,YAFI,KAAK,GAEK;2BAFV,KAAK;IAGR;;gBAHG,KAAK;;6BAKD,IAAI,EAAE;AACZ,WAAI,OAAO,GAAG,IAAI;;;;;;;;;;;;;;;;;;;;AAqBlB,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,iIAAiI,EAAE,OAAO,CAAC,CAAC;AACtK,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,iIAAiI,EAAE,OAAO,CAAC,CAAC;AACtK,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,0DAA0D,EAAE,QAAQ,CAAC,CAAC;AAChG,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4IAA4I,EAAE,QAAQ,CAAC;;;;AAIjL,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,oIAAoI,EAAE,OAAO,CAAC,CAAC;AACzK,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,oIAAoI,EAAE,OAAO,CAAC;;;;AAIxK,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4JAA4J,EAAE,UAAU,CAAC,CAAC;AACpM,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4JAA4J,EAAE,UAAU,CAAC;;;;;;AAMnM,WAAM,OAAO,GAAG,OAAO,CAAC;AACxB,WAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4RAA4R,EAAE,UAAU,CAAC,CAAC;AAC1U,cAAO,GAAG,OAAO,CAAC;AAClB,WAAI,OAAO,KAAK,OAAO,EAAE;AACvB,gBAAO,GAAG,OAAO,CAAC,OAAO,CAAC,8IAA8I,EAAE,OAAO,CAAC,CAAC;AACnL,gBAAO,GAAG,OAAO,CAAC,OAAO,CAAC,8IAA8I,EAAE,OAAO,CAAC,CAAC;QACpL;AACD,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,sDAAsD,EAAE,QAAQ,CAAC;;;AAG3F,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4JAA4J,EAAE,SAAS,CAAC;;;;AAIlM,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,mMAAmM,EAAE,OAAO,CAAC,CAAC;AACxO,cAAO,GAAG,OAAO,CAAC,OAAO,CAAC,iNAAiN,EAAE,OAAO,CAAC,CAAC;;AAEtP,cAAO,OAAO,CAAC;MAChB;;;iCAEW,IAAI,EAAE,QAAQ,EAAE;AAC1B,WAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AACnC,eAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;MACzB;;;UArEG,KAAK;;;AAyEX,OAAM,CAAC,OAAO,CAAC,KAAK,GAAG,KAAK,C","file":"pangu.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 318938e3ff5135e566ef\n **/","const Pangu = require('../shared/core').Pangu;\n\n// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\nconst COMMENT_NODE_TYPE = 8;\n\nclass BrowserPangu extends Pangu {\n\n  constructor() {\n    super();\n\n    this.topTags = /^(html|head|body|#document)$/i;\n    this.ignoreTags = /^(code|pre|textarea)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n  }\n\n  canIgnoreNode(node) {\n    let parentNode = node.parentNode;\n\n    while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n      if ((parentNode.getAttribute('contenteditable') === 'true') || (parentNode.getAttribute('g_editable') === 'true') || (parentNode.nodeName.search(this.ignoreTags) >= 0)) {\n        return true;\n      }\n\n      parentNode = parentNode.parentNode;\n    }\n\n    return false;\n  }\n\n  isFirstTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n    // return false;\n  }\n\n  isLastTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    // 沒有顯式地 return 就是 undefined，放在 if 裡面會被當成 false\n    // return false;\n  }\n\n  spacingNodeByXPath(xPathQuery, contextNode = document) {\n    // 是否加了空格\n    let hasSpacing = false;\n\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacing(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        hasSpacing = true;\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacing(testText);\n        if (testNewText !== testText) {\n          hasSpacing = true;\n\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoreTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ' ' + nextTextNode.data;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ' ' + nextTextNode.data;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = currentTextNode.data + ' ';\n            } else {\n              let panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n\n    return hasSpacing;\n  }\n\n  spacingPageTitle() {\n    const titleQuery = '/html/head/title/text()';\n    const hasSpacing = this.spacingNodeByXPath(titleQuery);\n\n    return hasSpacing;\n  }\n\n  spacingPageBody() {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let bodyQuery = '/html/body//*/text()[normalize-space(.)]';\n    for (const tag of ['script', 'style', 'textarea']) {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      bodyQuery += `[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    }\n    const hasSpacing = this.spacingNodeByXPath(bodyQuery);\n\n    return hasSpacing;\n  }\n\n  spacingPage() {\n    const hasSpacingPageTitle = this.spacingPageTitle();\n    const hasSpacingPageBody = this.spacingPageBody();\n\n    return hasSpacingPageTitle || hasSpacingPageBody;\n  }\n\n  spacingElementById(idName) {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n  spacingElementByClassName(className) {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n  spacingElementByTagName(tagName) {\n    const xPathQuery = `//${tagName}//text()`;\n\n    const hasSpacing = this.spacingNodeByXPath(xPathQuery);\n\n    return hasSpacing;\n  }\n\n}\n\nconst pangu = new BrowserPangu();\n\nmodule.exports = pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser/pangu.js\n **/","class Pangu {\n\n  constructor() {\n  }\n\n  spacing(text) {\n    let newText = text;\n\n    /*\n    \\u2e80-\\u2eff CJK Radicals Supplement\n    \\u2f00-\\u2fdf Kangxi Radicals\n    \\u3040-\\u309f Hiragana\n    \\u30a0-\\u30ff Katakana\n    \\u3100-\\u312f Bopomofo\n    \\u3200-\\u32ff Enclosed CJK Letters and Months\n    \\u3400-\\u4dbf CJK Unified Ideographs Extension A\n    \\u4e00-\\u9fff CJK Unified Ideographs\n    \\uf900-\\ufaff CJK Compatibility Ideographs\n\n    http://unicode-table.com/en/\n    https://github.com/vinta/pangu\n    */\n\n    // cjk_quote >> 跟 Go 版差了一個 '\n    // quote_cjk >> 跟 Go 版差了一個 '\n    // fix_quote\n    // fix_single_quote\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g, '$1 $2');\n    newText = newText.replace(/([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n    newText = newText.replace(/([\"'\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\"'\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g, '$1$3$4');\n\n    // cjk_hash\n    // hash_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#(\\S+))/g, '$1 $2');\n    newText = newText.replace(/((\\S+)#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $3');\n\n    // cjk_operator_ans\n    // ans_operator_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=&\\\\|<>])([A-Za-z0-9])/g, '$1 $2 $3');\n    newText = newText.replace(/([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $3');\n\n    // cjk_bracket_cjk\n    // cjk_bracket\n    // bracket_cjk\n    // fix_bracket\n    const oldText = newText;\n    const tmpText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2 $4');\n    newText = tmpText;\n    if (oldText === tmpText) {\n      newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g, '$1 $2');\n      newText = newText.replace(/([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n    }\n    newText = newText.replace(/([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/g, '$1$3$5');\n\n    // fix_symbol\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g, '$1$2 $3');\n\n    // cjk_ans\n    // ans_cjk\n    newText = newText.replace(/([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g, '$1 $2');\n    newText = newText.replace(/([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g, '$1 $2');\n\n    return newText;\n  }\n\n  spacingText(text, callback) {\n    const newText = this.spacing(text);\n    callback(null, newText);\n  }\n\n}\n\nmodule.exports.Pangu = Pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/core.js\n **/"],"sourceRoot":""}