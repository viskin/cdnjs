{"version":3,"file":"ceb-feature-cqrs-rx.min.js","sources":["../src/ceb-feature-cqrs-rx.js"],"names":["g","factory","exports","module","require","define","amd","cebFeatureCqrs","Rx","this","rootCmdStream","Subject","rootEvtStream","sendCommand","name","payload","metadata","onNext","publishEvent","cmdHandlerFactory","el","cmdName","prepareFn","processFn","cmdStream","filter","cmd","subscribe","apply","evtName","Observable","just","value","evtListenerFactory","evtStream","evt","stream","disposeStream","dispose","libraries","destroyCmdHandler","destroyListenerHandler"],"mappings":";;;;;;;;CAAC,SAAUA,EAAGC,GACV,YAKsB,iBAAZC,SACNC,OAAOD,QAAUD,EAAQG,QAAQ,oBAAqBA,QAAQ,OACtC,kBAAXC,SAAyBA,OAAOC,IAC7CD,OAAO,uBAAwB,mBAAoB,MAAOJ,GAE1DD,EAAEO,eAAiBN,EAAQD,EAAEO,eAAgBP,EAAEQ,KAGrDC,KAAM,SAAUF,EAAgBC,GAC9B,YAEA,IAAIE,GAAgB,GAAIF,GAAGG,QAEvBC,EAAgB,GAAIJ,GAAGG,QAEvBE,EAAc,SAAUC,EAAMC,EAASC,GACvCN,EAAcO,QACVH,KAAMA,EACNC,QAASA,EACTC,SAAUA,KAIdE,EAAe,SAAUJ,EAAMC,EAASC,GACxCJ,EAAcK,QACVH,KAAMA,EACNC,QAASA,EACTC,SAAUA,KAIdG,EAAoB,SAAUC,EAAIC,EAASC,EAAWC,GACtD,GAAIC,GAAYd,EAAce,OAAO,SAAUC,GAC3C,MAAOA,GAAIZ,OAASO,GAExB,OAAOG,GAAUG,UAAU,SAAUD,GACjCA,EAAIE,MAAQ,SAAUC,EAASd,EAASC,GACpCE,EAAaW,EAASd,EAASC,GAAYU,EAAIV,WAEhDM,EACCA,EAAUF,EAAIZ,EAAGsB,WAAWC,KAAKL,IAAMC,UAAU,SAAUK,GACvDT,EAAUH,EAAIM,EAAKM,KAGvBT,EAAUH,EAAIM,EAAKA,MAK3BO,EAAqB,SAAUb,EAAIS,EAASP,EAAWC,GACvD,GAAIW,GAAYtB,EAAca,OAAO,SAAUU,GAC3C,MAAOA,GAAIrB,OAASe,GAExB,OAAOK,GAAUP,UAAU,SAAUQ,GACjC,GAAIC,GAASd,EAAYA,EAAUF,EAAIZ,EAAGsB,WAAWC,KAAKI,IAAQ3B,EAAGsB,WAAWC,KAAKI,EACrFC,GAAOT,UAAU,SAAUK,GACvBT,EAAUH,EAAIe,EAAKH,QAK3BK,EAAgB,SAAUD,GAC1BA,EAAOE,UAYX,OATA/B,GAAegC,UAAU/B,IACrBK,YAAaA,EACbK,aAAcA,EACdC,kBAAmBA,EACnBc,mBAAoBA,EACpBO,kBAAmBH,EACnBI,uBAAwBJ,GAGrB9B","sourcesContent":["(function (g, factory) {\n    'use strict';\n\n    // Export the **ceb-feature-cqrs** function according the detected loader.\n\n    /* istanbul ignore next */\n    if(typeof exports === 'object') {\n        module.exports = factory(require('ceb-feature-cqrs'), require('rx'));\n    } else if(typeof define === 'function' && define.amd) {\n        define('ceb-feature-cqrs-rx', ['ceb-feature-cqrs', 'rx'], factory);\n    } else {\n        g.cebFeatureCqrs = factory(g.cebFeatureCqrs, g.Rx);\n    }\n\n}(this, function (cebFeatureCqrs, Rx) {\n    'use strict';\n\n    var rootCmdStream = new Rx.Subject();\n\n    var rootEvtStream = new Rx.Subject();\n\n    var sendCommand = function (name, payload, metadata) {\n        rootCmdStream.onNext({\n            name: name,\n            payload: payload,\n            metadata: metadata\n        });\n    };\n\n    var publishEvent = function (name, payload, metadata) {\n        rootEvtStream.onNext({\n            name: name,\n            payload: payload,\n            metadata: metadata\n        });\n    };\n\n    var cmdHandlerFactory = function (el, cmdName, prepareFn, processFn) {\n        var cmdStream = rootCmdStream.filter(function (cmd) {\n            return cmd.name === cmdName;\n        });\n        return cmdStream.subscribe(function (cmd) {\n            cmd.apply = function (evtName, payload, metadata) {\n                publishEvent(evtName, payload, metadata || cmd.metadata);\n            };\n            if(prepareFn) {\n                prepareFn(el, Rx.Observable.just(cmd)).subscribe(function (value) {\n                    processFn(el, cmd, value);\n                });\n            } else {\n                processFn(el, cmd, cmd);\n            }\n        });\n    };\n\n    var evtListenerFactory = function (el, evtName, prepareFn, processFn) {\n        var evtStream = rootEvtStream.filter(function (evt) {\n            return evt.name === evtName;\n        });\n        return evtStream.subscribe(function (evt) {\n            var stream = prepareFn ? prepareFn(el, Rx.Observable.just(evt)) : Rx.Observable.just(evt);\n            stream.subscribe(function (value) {\n                processFn(el, evt, value);\n            });\n        });\n    };\n\n    var disposeStream = function (stream) {\n        stream.dispose();\n    };\n\n    cebFeatureCqrs.libraries.Rx = {\n        sendCommand: sendCommand,\n        publishEvent: publishEvent,\n        cmdHandlerFactory: cmdHandlerFactory,\n        evtListenerFactory: evtListenerFactory,\n        destroyCmdHandler: disposeStream,\n        destroyListenerHandler: disposeStream\n    };\n\n    return cebFeatureCqrs;\n}));"]}