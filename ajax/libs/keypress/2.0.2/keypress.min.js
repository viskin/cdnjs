(function(){var d,j,a,k,e,h,l,o,p,m,t,f,b,i,w,r,u,g,s,v,q,n={}.hasOwnProperty,c=[].indexOf||function(z){for(var y=0,x=this.length;y<x;y++){if(y in this&&this[y]===z){return y}}return -1};p={is_unordered:false,is_counting:false,is_exclusive:false,is_solitary:false,prevent_default:false,prevent_repeat:false};v=["meta","alt","option","ctrl","shift","cmd"];g="ctrl";j={};j.debug=false;d=(function(){function x(A){var z,y;for(z in A){if(!n.call(A,z)){continue}y=A[z];if(y!==false){this[z]=y}}this.keys=this.keys||[];this.count=this.count||0}x.prototype.allows_key_repeat=function(){return !this.prevent_repeat&&typeof this.on_keydown==="function"};x.prototype.reset=function(){this.count=0;return this.keyup_fired=null};return x})();j.Listener=(function(){function x(y,C){var z,B,A;this.should_suppress_event_defaults=false;this.should_force_event_defaults=false;this.sequence_delay=800;this._registered_combos=[];this._keys_down=[];this._active_combos=[];this._sequence=[];this._sequence_timer=null;this._prevent_capture=false;this._defaults=C||{};for(B in p){if(!n.call(p,B)){continue}A=p[B];this._defaults[B]=this._defaults[B]||A}y=y||document.body;z=function(F,E,D){if(F.addEventListener){return F.addEventListener(E,D)}else{if(F.attachEvent){return F.attachEvent("on"+E,D)}}};z(y,"keydown",(function(D){return function(E){E=E||window.event;D._receive_input(E,true);return D._bug_catcher(E)}})(this));z(y,"keyup",(function(D){return function(E){E=E||window.event;return D._receive_input(E,false)}})(this));z(window,"blur",(function(D){return function(){var F,H,E,G;G=D._keys_down;for(H=0,E=G.length;H<E;H++){F=G[H];D._key_up(F,{})}return D._keys_down=[]}})(this))}x.prototype._bug_catcher=function(z){var y;if(g==="cmd"&&c.call(this._keys_down,"cmd")>=0&&((y=h(z.keyCode))!=="cmd"&&y!=="shift"&&y!=="alt"&&y!=="caps"&&y!=="tab")){return this._receive_input(z,false)}};x.prototype._cmd_bug_check=function(y){if(g==="cmd"&&c.call(this._keys_down,"cmd")>=0&&c.call(y,"cmd")<0){return false}return true};x.prototype._prevent_default=function(z,y){if((y||this.should_suppress_event_defaults)&&!this.should_force_event_defaults){if(z.preventDefault){z.preventDefault()}else{z.returnValue=false}if(z.stopPropagation){return z.stopPropagation()}}};x.prototype._get_active_combos=function(y){var A,z;A=[];z=m(this._keys_down,function(B){return B!==y});z.push(y);this._match_combo_arrays(z,(function(B){return function(C){if(B._cmd_bug_check(C.keys)){return A.push(C)}}})(this));this._fuzzy_match_combo_arrays(z,(function(B){return function(C){if(c.call(A,C)>=0){return}if(!(C.is_solitary||!B._cmd_bug_check(C.keys))){return A.push(C)}}})(this));return A};x.prototype._get_potential_combos=function(A){var D,y,C,z,B;y=[];B=this._registered_combos;for(C=0,z=B.length;C<z;C++){D=B[C];if(D.is_sequence){continue}if(c.call(D.keys,A)>=0&&this._cmd_bug_check(D.keys)){y.push(D)}}return y};x.prototype._add_to_active_combos=function(z){var N,A,C,M,K,I,D,J,G,F,B,L,y,H,E;J=false;D=true;M=false;if(c.call(this._active_combos,z)>=0){return true}else{if(this._active_combos.length){for(I=G=0,H=this._active_combos.length;0<=H?G<H:G>H;I=0<=H?++G:--G){N=this._active_combos[I];if(!(N&&N.is_exclusive&&z.is_exclusive)){continue}C=N.keys;if(!J){for(F=0,L=C.length;F<L;F++){A=C[F];J=true;if(c.call(z.keys,A)<0){J=false;break}}}if(D&&!J){E=z.keys;for(B=0,y=E.length;B<y;B++){K=E[B];D=false;if(c.call(C,K)<0){D=true;break}}}if(J){if(M){N=this._active_combos.splice(I,1)[0];if(N!=null){N.reset()}}else{N=this._active_combos.splice(I,1,z)[0];if(N!=null){N.reset()}M=true}D=false}}}}if(D){this._active_combos.unshift(z)}return J||D};x.prototype._remove_from_active_combos=function(C){var z,y,B,A;for(y=B=0,A=this._active_combos.length;0<=A?B<A:B>A;y=0<=A?++B:--B){z=this._active_combos[y];if(z===C){C=this._active_combos.splice(y,1)[0];C.reset();break}}};x.prototype._get_possible_sequences=function(){var y,H,F,J,I,C,E,D,A,K,G,B,z;I=[];G=this._registered_combos;for(E=0,K=G.length;E<K;E++){y=G[E];for(F=D=1,B=this._sequence.length;1<=B?D<=B:D>=B;F=1<=B?++D:--D){C=this._sequence.slice(-F);if(!y.is_sequence){continue}if(c.call(y.keys,"shift")<0){C=m(C,function(L){return L!=="shift"});if(!C.length){continue}}for(H=A=0,z=C.length;0<=z?A<z:A>z;H=0<=z?++A:--A){if(y.keys[H]===C[H]){J=true}else{J=false;break}}if(J){I.push(y)}}}return I};x.prototype._add_key_to_sequence=function(z,D){var C,A,B,y;this._sequence.push(z);A=this._get_possible_sequences();if(A.length){for(B=0,y=A.length;B<y;B++){C=A[B];this._prevent_default(D,C.prevent_default)}if(this._sequence_timer){clearTimeout(this._sequence_timer)}if(this.sequence_delay>-1){this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay)}}else{this._sequence=[]}};x.prototype._get_sequence=function(L){var y,H,F,I,J,D,E,C,A,K,G,B,z;G=this._registered_combos;for(E=0,K=G.length;E<K;E++){y=G[E];if(!y.is_sequence){continue}for(F=C=1,B=this._sequence.length;1<=B?C<=B:C>=B;F=1<=B?++C:--C){D=(m(this._sequence,function(M){if(c.call(y.keys,"shift")>=0){return true}return M!=="shift"})).slice(-F);if(y.keys.length!==D.length){continue}for(H=A=0,z=D.length;0<=z?A<z:A>z;H=0<=z?++A:--A){J=D[H];if(c.call(y.keys,"shift")<0){if(J==="shift"){continue}}if(L==="shift"&&c.call(y.keys,"shift")<0){continue}if(y.keys[H]===J){I=true}else{I=false;break}}}if(I){return y}}return false};x.prototype._receive_input=function(z,A){var y;if(this._prevent_capture){if(this._keys_down.length){this._keys_down=[]}return}y=h(z.keyCode);if(!A&&!this._keys_down.length&&(y==="alt"||y===g)){return}if(!y){return}if(A){return this._key_down(y,z)}else{return this._key_up(y,z)}};x.prototype._fire=function(A,B,y,z){if(typeof B["on_"+A]==="function"){this._prevent_default(y,B["on_"+A].call(B["this"],y,B.count,z)!==true)}if(A==="release"){B.count=0}if(A==="keyup"){return B.keyup_fired=true}};x.prototype._match_combo_arrays=function(z,B){var y,D,A,C;C=this._registered_combos;for(D=0,A=C.length;D<A;D++){y=C[D];if((!y.is_unordered&&e(z,y.keys))||(y.is_unordered&&k(z,y.keys))){B(y)}}};x.prototype._fuzzy_match_combo_arrays=function(z,B){var y,D,A,C;C=this._registered_combos;for(D=0,A=C.length;D<A;D++){y=C[D];if((!y.is_unordered&&f(y.keys,z))||(y.is_unordered&&t(y.keys,z))){B(y)}}};x.prototype._keys_remain=function(D){var z,C,B,y,A;A=D.keys;for(B=0,y=A.length;B<y;B++){z=A[B];if(c.call(this._keys_down,z)>=0){C=true;break}}return C};x.prototype._key_down=function(M,I){var B,O,y,G,J,z,L,H,N,E,D,C,K,A,F;N=l(M,I);if(N){M=N}this._add_key_to_sequence(M,I);H=this._get_sequence(M);if(H){this._fire("keydown",H,I)}for(J in s){y=s[J];if(!I[y]){continue}if(J===M||c.call(this._keys_down,J)>=0){continue}this._keys_down.push(J)}for(J in s){y=s[J];if(J===M){continue}if(c.call(this._keys_down,J)>=0&&!I[y]){if(J==="cmd"&&g!=="cmd"){continue}for(G=E=0,F=this._keys_down.length;0<=F?E<F:E>F;G=0<=F?++E:--E){if(this._keys_down[G]===J){this._keys_down.splice(G,1)}}}}O=this._get_active_combos(M);L=this._get_potential_combos(M);for(D=0,K=O.length;D<K;D++){B=O[D];this._handle_combo_down(B,L,M,I)}if(L.length){for(C=0,A=L.length;C<A;C++){z=L[C];this._prevent_default(I,z.prevent_default)}}if(c.call(this._keys_down,M)<0){this._keys_down.push(M)}};x.prototype._handle_combo_down=function(z,F,G,C){var B,y,D,H,A,E;if(c.call(z.keys,G)<0){return false}this._prevent_default(C,z&&z.prevent_default);B=false;if(c.call(this._keys_down,G)>=0){B=true;if(!z.allows_key_repeat()){return false}}H=this._add_to_active_combos(z,G);z.keyup_fired=false;y=false;if(z.is_exclusive){for(A=0,E=F.length;A<E;A++){D=F[A];if(D.is_exclusive&&D.keys.length>z.keys.length){y=true;break}}}if(!y){if(z.is_counting&&typeof z.on_keydown==="function"){z.count+=1}if(H){return this._fire("keydown",z,C,B)}}};x.prototype._key_up=function(S,N){var K,J,O,F,M,I,L,G,C,A,z,y,P,R,Q,H,E,D,B;G=S;L=l(S,N);if(L){S=L}L=r[G];if(N.shiftKey){if(!(L&&c.call(this._keys_down,L)>=0)){S=G}}else{if(!(G&&c.call(this._keys_down,G)>=0)){S=L}}I=this._get_sequence(S);if(I){this._fire("keyup",I,N)}if(c.call(this._keys_down,S)<0){return false}for(M=C=0,H=this._keys_down.length;0<=H?C<H:C>H;M=0<=H?++C:--C){if((E=this._keys_down[M])===S||E===L||E===G){this._keys_down.splice(M,1);break}}J=this._active_combos.length;F=[];D=this._active_combos;for(A=0,P=D.length;A<P;A++){K=D[A];if(c.call(K.keys,S)>=0){F.push(K)}}for(z=0,R=F.length;z<R;z++){O=F[z];this._handle_combo_up(O,N,S)}if(J>1){B=this._active_combos;for(y=0,Q=B.length;y<Q;y++){K=B[y];if(K===void 0||c.call(F,K)>=0){continue}if(!this._keys_remain(K)){this._remove_from_active_combos(K)}}}};x.prototype._handle_combo_up=function(C,B,y){var z,A;this._prevent_default(B,C&&C.prevent_default);A=this._keys_remain(C);if(!C.keyup_fired){z=this._keys_down.slice();z.push(y);if(!C.is_solitary||k(z,C.keys)){this._fire("keyup",C,B);if(C.is_counting&&typeof C.on_keyup==="function"&&typeof C.on_keydown!=="function"){C.count+=1}}}if(!A){this._fire("release",C,B);this._remove_from_active_combos(C)}};x.prototype.simple_combo=function(y,z){return this.register_combo({keys:y,on_keydown:z})};x.prototype.counting_combo=function(z,y){return this.register_combo({keys:z,is_counting:true,is_unordered:false,on_keydown:y})};x.prototype.sequence_combo=function(y,z){return this.register_combo({keys:y,on_keydown:z,is_sequence:true})};x.prototype.register_combo=function(C){var B,A,z,y;if(typeof C.keys==="string"){C.keys=C.keys.split(" ")}y=this._defaults;for(A in y){if(!n.call(y,A)){continue}z=y[A];if(C[A]===void 0){C[A]=z}}B=new d(C);if(q(B)){this._registered_combos.push(B);return B}};x.prototype.register_many=function(C){var B,A,z,y;y=[];for(A=0,z=C.length;A<z;A++){B=C[A];y.push(this.register_combo(B))}return y};x.prototype.unregister_combo=function(A){var D,y,C,z,B;if(!A){return false}y=(function(E){return function(J){var G,I,H,F;F=[];for(G=I=0,H=E._registered_combos.length;0<=H?I<H:I>H;G=0<=H?++I:--I){if(J===E._registered_combos[G]){E._registered_combos.splice(G,1);break}else{F.push(void 0)}}return F}})(this);if(A.keys){return y(A)}else{B=this._registered_combos;for(C=0,z=B.length;C<z;C++){D=B[C];if(!D){continue}}if(typeof A==="string"){A=A.split(" ")}if((D.is_unordered&&k(A,D.keys))||(!D.is_unordered&&e(A,D.keys))){return y(D)}}};x.prototype.unregister_many=function(C){var B,A,z,y;y=[];for(A=0,z=C.length;A<z;A++){B=C[A];y.push(this.unregister_combo(B))}return y};x.prototype.get_registered_combos=function(){return this._registered_combos};x.prototype.reset=function(){return this._registered_combos=[]};x.prototype.listen=function(){return this._prevent_capture=false};x.prototype.stop_listening=function(){return this._prevent_capture=true};x.prototype.get_meta_key=function(){return g};return x})();o=function(){if(navigator.userAgent.indexOf("Mac OS X")!==-1){g="cmd"}};a=function(){if(navigator.userAgent.indexOf("Opera")!==-1){w["17"]="cmd"}};h=function(x){return w[x]};m=function(z,y){var x;if(z.filter){return z.filter(y)}else{return(function(){var C,B,A;A=[];for(C=0,B=z.length;C<B;C++){x=z[C];if(y(x)){A.push(x)}}return A})()}};k=function(z,x){var A,B,y;if(z.length!==x.length){return false}for(B=0,y=z.length;B<y;B++){A=z[B];if(c.call(x,A)>=0){continue}return false}return true};e=function(y,x){var z,B,A;if(y.length!==x.length){return false}for(z=B=0,A=y.length;0<=A?B<A:B>A;z=0<=A?++B:--B){if(y[z]!==x[z]){return false}}return true};t=function(z,x){var A,B,y;for(B=0,y=z.length;B<y;B++){A=z[B];if(c.call(x,A)<0){return false}}return true};f=function(z,x){var A,C,B,D,y;B=0;for(D=0,y=z.length;D<y;D++){C=z[D];A=x.indexOf(C);if(A>=B){B=A}else{return false}}return true};u=function(){if(j.debug){return console.log.apply(console,arguments)}};b=function(y){var z,A,x;z=false;for(x in w){A=w[x];if(y===A){z=true;break}}if(!z){for(x in r){A=r[x];if(y===A){z=true;break}}}return z};q=function(z){var G,F,M,H,J,L,y,K,D,C,A,I,x,E,B;y=true;if(!z.keys.length){u("You're trying to bind a combo with no keys:",z)}for(F=D=0,E=z.keys.length;0<=E?D<E:D>E;F=0<=E?++D:--D){M=z.keys[F];G=i[M];if(G){M=z.keys[F]=G}if(M==="meta"){z.keys.splice(F,1,g)}if(M==="cmd"){u('Warning: use the "meta" key rather than "cmd" for Windows compatibility')}}B=z.keys;for(C=0,I=B.length;C<I;C++){M=B[C];if(!b(M)){u('Do not recognize the key "'+M+'"');y=false}}if(c.call(z.keys,"meta")>=0||c.call(z.keys,"cmd")>=0){J=z.keys.slice();for(A=0,x=v.length;A<x;A++){H=v[A];if((F=J.indexOf(H))>-1){J.splice(F,1)}}if(J.length>1){u("META and CMD key combos cannot have more than 1 non-modifier keys",z,J);y=false}}for(L in z){K=z[L];if(p[L]==="undefined"){u("The property "+L+" is not a valid combo property. Your combo has still been registered.")}}return y};l=function(y,z){var x;if(!z.shiftKey){return false}x=r[y];if(x!=null){return x}return false};s={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"};i={escape:"esc",control:"ctrl",command:"cmd","break":"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"};r={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")"};w={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num"};o();a();if(typeof define==="function"&&define.amd){define([],function(){return j})}else{window.keypress=j}}).call(this);