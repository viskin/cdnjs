"use strict";var sinon=(function(){var a=typeof document!="undefined"&&document.createElement("div");function g(l){var m=false;try{l.appendChild(a);m=a.parentNode==l}catch(k){return false}finally{try{l.removeChild(a)}catch(k){}}return m}function f(k){return a&&k&&k.nodeType===1&&g(k)}return{wrapMethod:function h(l,n,p){if(!l){throw new TypeError("Should wrap property of object")}if(typeof p!="function"){throw new TypeError("Method wrapper should be function")}var k=l[n];var m=typeof k;if(m!="function"){throw new TypeError("Attempted to wrap "+m+" property "+n+" as function")}if(k.restore&&k.restore.sinon){throw new TypeError("Attempted to wrap "+n+" which is already wrapped")}if(k.calledBefore){var o=!!k.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+n+" which is already "+o)}l[n]=p;p.displayName=n;p.restore=function(){l[n]=k};p.restore.sinon=true;return p},extend:function e(n){for(var m=1,k=arguments.length;m<k;m+=1){for(var o in arguments[m]){if(arguments[m].hasOwnProperty(o)){n[o]=arguments[m][o]}if(arguments[m].hasOwnProperty("toString")&&arguments[m].toString!=n.toString){n.toString=arguments[m].toString}}}return n},create:function c(l){var k=function(){};k.prototype=l;return new k()},deepEqual:function i(n,k){if(typeof n!="object"||typeof k!="object"){return n===k}if(f(n)||f(k)){return n===k}if(n===k){return true}if(Object.prototype.toString.call(n)=="[object Array]"){if(n.length!==k.length){return false}for(var p=0,m=n.length;p<m;p+=1){if(!i(n[p],k[p])){return false}}return true}var r,o=0,q=0;for(r in n){o+=1;if(!i(n[r],k[r])){return false}}for(r in k){q+=1}if(o!=q){return false}return true},keys:function j(l){var k=[];for(var m in l){if(l.hasOwnProperty(m)){k.push(m)}}return k.sort()},functionName:function d(l){var k=l.displayName||l.name;if(!k){var m=l.toString().match(/function ([^\s\(]+)/);k=m&&m[1]}return k},functionToString:function b(){if(this.getCall&&this.callCount){var k,m,l=this.callCount;while(l--){k=this.getCall(l).thisValue;for(m in k){if(k[m]===this){return m}}}}return this.displayName||"sinon fake"},getConfig:function(l){var k={};l=l||{};var m=sinon.defaultConfig;for(var n in m){if(m.hasOwnProperty(n)){k[n]=l.hasOwnProperty(n)?l[n]:m[n]}}return k},format:function(k){return""+k},defaultConfig:{injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true}}}());if(typeof module=="object"&&typeof require=="function"){module.exports=sinon;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");module.exports.assert=require("./sinon/assert");module.exports.sandbox=require("./sinon/sandbox");module.exports.test=require("./sinon/test");module.exports.testCase=require("./sinon/test_case");module.exports.assert=require("./sinon/assert")}(function(a){var e=typeof module=="object"&&typeof require=="function";var d;var c=0;if(!a&&e){a=require("sinon")}if(!a){return}function b(f,g){if(!g&&typeof f=="function"){return b.create(f)}if(!f||!g){return b.create(function(){})}var h=f[g];return a.wrapMethod(f,g,b.create(h))}a.extend(b,(function(){var m=Array.prototype.slice;function g(p,s,q,r){p[s]=function(){if(!this.called){return false}var u;var w=0;for(var v=0,t=this.callCount;v<t;v+=1){u=this.getCall(v);if(u[r||s].apply(u,arguments)){w+=1;if(q){return true}}}return w===this.callCount}}function n(r,s,q){if(!r){return}var u=s.length;for(var t=0,p=r.length;t<p;t++){if(r[t].matches(s,q)){return r[t]}}}var f=0;var k={reset:function(){this.called=false;this.calledOnce=false;this.calledTwice=false;this.calledThrice=false;this.callCount=0;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[]},create:function j(r){var p;if(typeof r!="function"){r=function(){}}else{p=a.functionName(r)}function q(){return q.invoke(r,this,m.call(arguments))}a.extend(q,b);delete q.create;a.extend(q,r);q.reset();q.prototype=r.prototype;q.displayName=p||"spy";q.toString=a.functionToString;q._create=a.spy.create;q.id="spy#"+f++;return q},invoke:function h(t,p,q){var v=n(this.fakes,q);var r,s;this.called=true;this.callCount+=1;this.calledOnce=this.callCount==1;this.calledTwice=this.callCount==2;this.calledThrice=this.callCount==3;this.thisValues.push(p);this.args.push(q);this.callIds.push(c++);try{if(v){s=v.invoke(t,p,q)}else{s=(this.func||t).apply(p,q)}}catch(u){this.returnValues.push(undefined);r=u;throw u}finally{this.exceptions.push(r)}this.returnValues.push(s);return s},getCall:function o(p){if(p<0||p>=this.callCount){return null}return d.create(this,this.thisValues[p],this.args[p],this.returnValues[p],this.exceptions[p],this.callIds[p])},calledBefore:function i(p){if(!this.called){return false}if(!p.called){return true}return this.callIds[0]<p.callIds[0]},calledAfter:function l(p){if(!this.called||!p.called){return false}return this.callIds[this.callCount-1]>p.callIds[p.callCount-1]},withArgs:function(){var r=m.call(arguments);if(this.fakes){var q=n(this.fakes,r,true);if(q){return q}}else{this.fakes=[]}var s=this;var p=this._create();p.matchingAguments=r;this.fakes.push(p);p.withArgs=function(){return s.withArgs.apply(s,arguments)};return p},matches:function(q,p){var r=this.matchingAguments;if(r.length<=q.length&&a.deepEqual(r,q.slice(0,r.length))){return !p||r.length==q.length}}};g(k,"calledOn",true);g(k,"alwaysCalledOn",false,"calledOn");g(k,"calledWith",true);g(k,"alwaysCalledWith",false,"calledWith");g(k,"calledWithExactly",true);g(k,"alwaysCalledWithExactly",false,"calledWithExactly");g(k,"threw",true);g(k,"alwaysThrew",false,"threw");g(k,"returned",true);g(k,"alwaysReturned",false,"returned");return k}()));d=(function(){return{create:function h(q,m,n,p,o,r){var l=a.create(d);delete l.create;l.proxy=q;l.thisValue=m;l.args=n;l.returnValue=p;l.exception=o;l.callId=typeof r=="number"&&r||c++;return l},calledOn:function f(l){return this.thisValue===l},calledWith:function i(){for(var n=0,m=arguments.length;n<m;n+=1){if(!a.deepEqual(arguments[n],this.args[n])){return false}}return true},calledWithExactly:function g(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},returned:function j(l){return this.returnValue===l},threw:function k(l){if(typeof l=="undefined"||!this.exception){return !!this.exception}if(typeof l=="string"){return this.exception.name==l}return this.exception===l},calledBefore:function(l){return this.callId<l.callId},calledAfter:function(l){return this.callId>l.callId},toString:function(){var p=this.proxy.toString()+"(";var n=[];for(var o=0,m=this.args.length;o<m;++o){n.push(a.format(this.args[o]))}p=p+n.join(", ")+")";if(typeof this.returnValue!="undefined"){p+=" => "+a.format(this.returnValue)}if(this.exception){p+=" !"+this.exception.name;if(this.exception.message){p+="("+this.exception.message+")"}}return p}}}());if(e){module.exports=b}else{a.spy=b;a.spyCall=d}}(typeof sinon=="object"&&sinon||null));(function(a){var h=typeof module=="object"&&typeof require=="function";if(!a&&h){a=require("sinon")}if(!a){return}function g(i,k,j){if(!!j&&typeof j!="function"){throw new TypeError("Custom stub should be function")}var m;if(j){m=a.spy&&a.spy.create?a.spy.create(j):j}else{m=g.create()}if(!i&&!k){return a.stub.create()}if(!k&&!!i&&typeof i=="object"){for(var l in i){if(i.hasOwnProperty(l)&&typeof i[l]=="function"){g(i,l)}}return i}return a.wrapMethod(i,k,m)}function c(n,k){if(n.callArgAt<0){for(var m=0,j=k.length;m<j;++m){if(!n.callArgProp&&typeof k[m]=="function"){return k[m]}if(n.callArgProp&&k[m]&&typeof k[m][n.callArgProp]=="function"){return k[m][n.callArgProp]}}return null}return k[n.callArgAt]}var f=Array.prototype.join;function d(k,j,i){if(k.callArgAt<0){var l;if(k.callArgProp){l=a.functionName(k)+" expected to yield to '"+k.callArgProp+"', but no object with such a property was passed."}else{l=a.functionName(k)+" expected to yield, but no callback was passed."}if(i.length>0){l+=" Received ["+f.call(i,", ")+"]"}return l}return"argument at index "+k.callArgAt+" is not a function: "+j}function e(k,i){if(typeof k.callArgAt=="number"){var j=c(k,i);if(typeof j!="function"){throw new TypeError(d(k,j,i))}j.apply(null,k.callbackArguments)}}var b=0;a.extend(g,(function(){var n=Array.prototype.slice;function m(o,p){if(typeof o=="string"){this.exception=new Error(p||"");this.exception.name=o}else{if(!o){this.exception=new Error("Error")}else{this.exception=o}}return this}return{create:function k(){var o=function(){if(o.exception){throw o.exception}e(o,arguments);return o.returnValue};o.id="stub#"+b++;var p=o;o=a.spy.create(o);o.func=p;a.extend(o,g);o._create=a.stub.create;o.displayName="stub";o.toString=a.functionToString;return o},returns:function l(o){this.returnValue=o;return this},"throws":m,throwsException:m,callsArg:function i(o){if(typeof o!="number"){throw new TypeError("argument index is not number")}this.callArgAt=o;this.callbackArguments=[];return this},callsArgWith:function j(o){if(typeof o!="number"){throw new TypeError("argument index is not number")}this.callArgAt=o;this.callbackArguments=n.call(arguments,1);return this},yields:function(){this.callArgAt=-1;this.callbackArguments=n.call(arguments,0);return this},yieldsTo:function(o){this.callArgAt=-1;this.callArgProp=o;this.callbackArguments=n.call(arguments,1);return this}}}()));if(h){module.exports=g}else{a.stub=g}}(typeof sinon=="object"&&sinon||null));(function(b){var d=typeof module=="object"&&typeof require=="function";if(!b&&d){b=require("sinon")}if(!b){return}function a(e){if(!e){return b.expectation.create("Anonymous mock")}return a.create(e)}b.mock=a;b.extend(a,(function(){function i(n,o){if(!n){return}for(var m=0,k=n.length;m<k;m+=1){o(n[m])}}return{create:function f(k){if(!k){throw new TypeError("object is null")}var l=b.extend({},a);l.object=k;delete l.create;return l},expects:function e(m){if(!m){throw new TypeError("method is falsy")}if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[m]){this.expectations[m]=[];var l=this;b.wrapMethod(this.object,m,function(){return l.invokeMethod(m,this,arguments)});this.proxies.push(m)}var k=b.expectation.create(m);this.expectations[m].push(k);return k},restore:function h(){var k=this.object;i(this.proxies,function(l){if(typeof k[l].restore=="function"){k[l].restore()}})},verify:function j(){var m=this.expectations||{};var l=[],k=[];i(this.proxies,function(n){i(m[n],function(o){if(!o.met()){l.push(o.toString())}else{k.push(o.toString())}})});this.restore();if(l.length>0){c(l.concat(k).join("\n"))}return true},invokeMethod:function g(q,k,l){var p=this.expectations&&this.expectations[q];var o=p&&p.length||0;for(var m=0;m<o;m+=1){if(!p[m].met()&&p[m].allowsCall(k,l)){return p[m].apply(k,l)}}var n=[];for(m=0;m<o;m+=1){n.push("    "+p[m].toString())}n.unshift("Unexpected call: "+b.spyCall.toString.call({proxy:q,args:l}));c(n.join("\n"))}}}()));function c(f){var e=new Error(f);e.name="ExpectationError";throw e}b.expectation=(function(){var u=Array.prototype.slice;var q=b.spy.invoke;function p(B){if(B==0){return"never"}else{if(B==1){return"once"}else{if(B==2){return"twice"}else{if(B==3){return"thrice"}}}}return B+" times"}function h(B){if(B==0){return"never called"}else{return"called "+p(B)}}function i(C){var D=C.minCalls;var B=C.maxCalls;if(typeof D=="number"&&typeof B=="number"){var E=p(D);if(D!=B){E="at least "+E+" and at most "+p(B)}return E}if(typeof D=="number"){return"at least "+p(D)}return"at most "+p(B)}function x(B){var C=typeof B.minCalls=="number";return !C||B.callCount>=B.minCalls}function m(B){if(typeof B.maxCalls!="number"){return false}return B.callCount==B.maxCalls}return{minCalls:1,maxCalls:1,create:function s(B){var C=b.extend(b.stub.create(),b.expectation);delete C.create;C.method=B;return C},invoke:function A(D,B,C){this.verifyCallAllowed(B,C);return q.apply(this,arguments)},atLeast:function o(B){if(typeof B!="number"){throw new TypeError("'"+B+"' is not number")}if(!this.limitsSet){this.maxCalls=null;this.limitsSet=true}this.minCalls=B;return this},atMost:function z(B){if(typeof B!="number"){throw new TypeError("'"+B+"' is not number")}if(!this.limitsSet){this.minCalls=null;this.limitsSet=true}this.maxCalls=B;return this},never:function j(){return this.exactly(0)},once:function y(){return this.exactly(1)},twice:function w(){return this.exactly(2)},thrice:function f(){return this.exactly(3)},exactly:function k(B){if(typeof B!="number"){throw new TypeError("'"+B+"' is not a number")}this.atLeast(B);return this.atMost(B)},met:function l(){return !this.failed&&x(this)},verifyCallAllowed:function t(C,D){if(m(this)){this.failed=true;c(this.method+" already called "+p(this.maxCalls))}if("expectedThis" in this&&this.expectedThis!==C){c(this.method+" called with "+C+" as thisValue, expected "+this.expectedThis)}if(!("expectedArguments" in this)){return}if(!D||D.length===0){c(this.method+" received no arguments, expected "+this.expectedArguments.join())}if(D.length<this.expectedArguments.length){c(this.method+" received too few arguments ("+D.join()+"), expected "+this.expectedArguments.join())}if(this.expectsExactArgCount&&D.length!=this.expectedArguments.length){c(this.method+" received too many arguments ("+D.join()+"), expected "+this.expectedArguments.join())}for(var E=0,B=this.expectedArguments.length;E<B;E+=1){if(!b.deepEqual(this.expectedArguments[E],D[E])){c(this.method+" received wrong arguments ("+D.join()+"), expected "+this.expectedArguments.join())}}},allowsCall:function g(C,D){if(this.met()){return false}if("expectedThis" in this&&this.expectedThis!==C){return false}if(!("expectedArguments" in this)){return true}D=D||[];if(D.length<this.expectedArguments.length){return false}if(this.expectsExactArgCount&&D.length!=this.expectedArguments.length){return false}for(var E=0,B=this.expectedArguments.length;E<B;E+=1){if(!b.deepEqual(this.expectedArguments[E],D[E])){return false}}return true},withArgs:function v(){this.expectedArguments=u.call(arguments);return this},withExactArgs:function n(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=true;return this},on:function r(B){this.expectedThis=B;return this},toString:function(){var B=(this.expectedArguments||[]).slice();if(!this.expectsExactArgCount){B.push("[...]")}var D=b.spyCall.toString.call({proxy:this.method,args:B});var C=D.replace(", [...","[, ...")+" "+i(this);if(this.met()){return"Expectation met: "+C}return"Expected "+C+" ("+h(this.callCount)+")"},verify:function e(){if(!this.met()){c(this.toString())}return true}}}());if(d){module.exports=a}else{b.mock=a}}(typeof sinon=="object"&&sinon||null));(function(b){var i=typeof module=="object"&&typeof require=="function";if(!b&&i){b=require("sinon")}if(!b){return}function f(n){if(!n.fakes){n.fakes=[]}return n.fakes}function k(r,q){var o=f(r);for(var p=0,n=o.length;p<n;p+=1){if(typeof o[p][q]=="function"){o[p][q]()}}}var e={verify:function l(){k(this,"verify")},restore:function h(){k(this,"restore")},verifyAndRestore:function a(){var n;try{this.verify()}catch(o){n=o}this.restore();if(n){throw n}},add:function m(n){f(this).push(n);return n},spy:function j(){return this.add(b.spy.apply(b,arguments))},stub:function c(n,q,p){if(q){var o=n[q];if(typeof o!="function"){if(!n.hasOwnProperty(q)){throw new TypeError("Cannot stub non-existent own property "+q)}n[q]=p;return this.add({restore:function(){n[q]=o}})}}return this.add(b.stub.apply(b,arguments))},mock:function g(){return this.add(b.mock.apply(b,arguments))},inject:function d(o){var n=this;o.spy=function(){return n.spy.apply(n,arguments)};o.stub=function(){return n.stub.apply(n,arguments)};o.mock=function(){return n.mock.apply(n,arguments)};return o}};if(i){module.exports=e}else{b.collection=e}}(typeof sinon=="object"&&sinon||null));if(typeof sinon=="undefined"){var sinon={}}sinon.clock=(function(){var id=0;function addTimer(args,recurring){if(args.length===0){throw new Error("Function requires at least 1 parameter")}var toId=id++;var delay=args[1]||0;if(!this.timeouts){this.timeouts={}}this.timeouts[toId]={id:toId,func:args[0],callAt:this.now+delay};if(recurring===true){this.timeouts[toId].interval=delay}return toId}function parseTime(str){if(!str){return 0}var strings=str.split(":");var l=strings.length,i=l;var ms=0,parsed;if(l>3||!/^(\d\d:){0,2}\d\d?$/.test(str)){throw new Error("tick only understands numbers and 'h:m:s'")}while(i--){parsed=parseInt(strings[i],10);if(parsed>=60){throw new Error("Invalid time "+str)}ms+=parsed*Math.pow(60,(l-i-1))}return ms*1000}function createObject(object){var newObject;if(Object.create){newObject=Object.create(object)}else{var F=function(){};F.prototype=object;newObject=new F()}newObject.Date.clock=newObject;return newObject}return{now:0,create:function create(now){var clock=createObject(this);if(typeof now=="number"){this.now=now}return clock},setTimeout:function setTimeout(callback,timeout){return addTimer.call(this,arguments,false)},clearTimeout:function clearTimeout(timerId){if(!this.timeouts){this.timeouts=[]}delete this.timeouts[timerId]},setInterval:function setInterval(callback,timeout){return addTimer.call(this,arguments,true)},clearInterval:function clearInterval(timerId){this.clearTimeout(timerId)},tick:function tick(ms){ms=typeof ms=="number"?ms:parseTime(ms);var tickFrom=this.now,tickTo=this.now+ms,previous=this.now;var timer=this.firstTimerInRange(tickFrom,tickTo);while(timer&&tickFrom<=tickTo){if(this.timeouts[timer.id]){tickFrom=this.now=timer.callAt;this.callTimer(timer)}timer=this.firstTimerInRange(previous,tickTo);previous=tickFrom}this.now=tickTo},firstTimerInRange:function(from,to){var timer,smallest,originalTimer;for(var id in this.timeouts){if(this.timeouts.hasOwnProperty(id)){if(this.timeouts[id].callAt<from||this.timeouts[id].callAt>to){continue}if(!smallest||this.timeouts[id].callAt<smallest){originalTimer=this.timeouts[id];smallest=this.timeouts[id].callAt;timer={func:this.timeouts[id].func,callAt:this.timeouts[id].callAt,interval:this.timeouts[id].interval,id:this.timeouts[id].id}}}}return timer||null},callTimer:function(timer){try{if(typeof timer.func=="function"){timer.func.call(null)}else{eval(timer.func)}}catch(e){}if(!this.timeouts[timer.id]){return}if(typeof timer.interval=="number"){this.timeouts[timer.id].callAt+=timer.interval}else{delete this.timeouts[timer.id]}},reset:function reset(){this.timeouts={}},Date:(function(){var NativeDate=Date;function ClockDate(year,month,date,hour,minute,second,ms){switch(arguments.length){case 0:return new NativeDate(ClockDate.clock.now);case 1:return new NativeDate(year);case 2:return new NativeDate(year,month);case 3:return new NativeDate(year,month,date);case 4:return new NativeDate(year,month,date,hour);case 5:return new NativeDate(year,month,date,hour,minute);case 6:return new NativeDate(year,month,date,hour,minute,second);default:return new NativeDate(year,month,date,hour,minute,second,ms)}}if(NativeDate.now){ClockDate.now=function now(){return ClockDate.clock.now}}if(NativeDate.toSource){ClockDate.toSource=function toSource(){return NativeDate.toSource()}}ClockDate.toString=function toString(){return NativeDate.toString()};ClockDate.prototype=NativeDate.prototype;ClockDate.parse=NativeDate.parse;ClockDate.UTC=NativeDate.UTC;return ClockDate}())}}());sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};sinon.useFakeTimers=(function(d){var b=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];function c(){var h;for(var g=0,f=this.methods.length;g<f;g++){h=this.methods[g];d[h]=this["_"+h]}}function e(h,f){f["_"+h]=d[h];d[h]=function(){return f[h].apply(f,arguments)};for(var g in f[h]){if(f[h].hasOwnProperty(g)){d[h][g]=f[h][g]}}d[h].clock=f}return function a(g){var j=sinon.clock.create(g);j.restore=c;j.methods=Array.prototype.slice.call(arguments,typeof g=="number"?1:0);if(j.methods.length===0){j.methods=b}for(var h=0,f=j.methods.length;h<f;h++){e(j.methods[h],j)}return j}}(typeof global!="undefined"?global:this));if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){this.sinon={}}sinon.xhr={XMLHttpRequest:this.XMLHttpRequest};sinon.FakeXMLHttpRequest=(function(){var k={"Accept-Charset":true,"Accept-Encoding":true,Connection:true,"Content-Length":true,Cookie:true,Cookie2:true,"Content-Transfer-Encoding":true,Date:true,Expect:true,Host:true,"Keep-Alive":true,Referer:true,TE:true,Trailer:true,"Transfer-Encoding":true,Upgrade:true,"User-Agent":true,Via:true};function f(){this.readyState=f.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";if(typeof f.onCreate=="function"){f.onCreate(this)}}function j(o){if(o.readyState!==f.OPENED){throw new Error("INVALID_STATE_ERR")}if(o.sendFlag){throw new Error("INVALID_STATE_ERR")}}sinon.extend(f.prototype,{async:true,open:function i(s,p,q,r,o){this.method=s;this.url=p;this.async=typeof q=="boolean"?q:true;this.username=r;this.password=o;this.responseText=null;this.responseXML=null;this.requestHeaders={};this.sendFlag=false;this.readyStateChange(f.OPENED)},readyStateChange:function m(o){this.readyState=o;if(typeof this.onreadystatechange=="function"){this.onreadystatechange()}},setRequestHeader:function h(p,o){j(this);if(k[p]||/^(Sec-|Proxy-)/.test(p)){throw new Error('Refused to set unsafe header "'+p+'"')}if(this.requestHeaders[p]){this.requestHeaders[p]+=","+o}else{this.requestHeaders[p]=o}},setResponseHeaders:function l(o){this.responseHeaders={};for(var p in o){if(o.hasOwnProperty(p)){this.responseHeaders[p]=o[p]}}if(this.async){this.readyStateChange(f.HEADERS_RECEIVED)}},send:function e(p){j(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var o=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=o[0]+";charset=utf-8"}else{this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=p}this.errorFlag=false;this.sendFlag=this.async;this.readyStateChange(f.OPENED);if(typeof this.onSend=="function"){this.onSend(this)}},abort:function g(){this.aborted=true;this.responseText=null;this.errorFlag=true;this.requestHeaders={};if(this.readyState>sinon.FakeXMLHttpRequest.OPENED){this.readyStateChange(sinon.FakeXMLHttpRequest.DONE);this.sendFlag=false}this.readyState=sinon.FakeXMLHttpRequest.UNSENT},getResponseHeader:function n(p){if(this.readyState<f.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(p)){return null}p=p.toLowerCase();for(var o in this.responseHeaders){if(o.toLowerCase()==p){return this.responseHeaders[o]}}return null},getAllResponseHeaders:function c(){if(this.readyState<f.HEADERS_RECEIVED){return""}var o="";for(var p in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(p)&&!/^Set-Cookie2?$/i.test(p)){o+=p+": "+this.responseHeaders[p]+"\r\n"}}return o},setResponseBody:function b(o){if(this.readyState==f.DONE){throw new Error("Request done")}if(this.async&&this.readyState!=f.HEADERS_RECEIVED){throw new Error("No headers received")}var s=this.chunkSize||10;var p=0;this.responseText="";do{if(this.async){this.readyStateChange(f.LOADING)}this.responseText+=o.substring(p,p+s);p+=s}while(p<o.length);var q=this.getResponseHeader("Content-Type");if(this.responseText&&(!q||/(text\/xml)|(application\/xml)|(\+xml)/.test(q))){try{this.responseXML=f.parseXML(this.responseText)}catch(r){}}if(this.async){this.readyStateChange(f.DONE)}else{this.readyState=f.DONE}},respond:function a(p,q,o){this.setResponseHeaders(q||{});this.status=typeof p=="number"?p:200;this.statusText=f.statusCodes[this.status];this.setResponseBody(o||"")}});sinon.extend(f,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});f.parseXML=function d(p){var o;if(typeof DOMParser!="undefined"){var q=new DOMParser();o=q.parseFromString(p,"text/xml")}else{o=new ActiveXObject("Microsoft.XMLDOM");o.async="false";o.loadXML(p)}return o};f.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};return f}());(function(d){var a=d.XMLHttpRequest;var b=d.ActiveXObject;var e=typeof ActiveXObject!="undefined";var c=typeof XMLHttpRequest!="undefined";sinon.useFakeXMLHttpRequest=function(){sinon.FakeXMLHttpRequest.restore=function f(h){if(c){d.XMLHttpRequest=a}if(e){d.ActiveXObject=b}delete sinon.FakeXMLHttpRequest.restore;if(h!==true){delete sinon.FakeXMLHttpRequest.onCreate}};if(c){d.XMLHttpRequest=sinon.FakeXMLHttpRequest}if(e){d.ActiveXObject=function g(h){if(h=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/.test(h)){return new sinon.FakeXMLHttpRequest()}return new b(h)}}return sinon.FakeXMLHttpRequest}}(this));if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){var sinon={}}sinon.fakeServer=(function(){function n(){}function d(o){n.prototype=o;return new n()}function l(p){var o=p;if(Object.prototype.toString.call(p)!="[object Array]"){o=[200,{},p]}if(typeof o[2]!="string"){throw new TypeError("Fake server response body should be string, but was "+typeof o[2])}return o}var g=window.location;var i=new RegExp("^"+g.protocol+"//"+g.host);function f(r,q,p){var t=r.method;var o=!t||t.toLowerCase()==q.toLowerCase();var s=r.url;var u=!s||s==p||(typeof s.test=="function"&&s.test(p));return o&&u}function e(o,r){var s=this.getHTTPMethod(r);var q=r.url;if(!/^https?:\/\//.test(q)||i.test(q)){q=q.replace(i,"")}if(f(o,this.getHTTPMethod(r),q)){if(typeof o.response=="function"){var p=[r].concat(q.match(o.url).slice(1));return o.response.apply(o,p)}return true}return false}return{create:function(){var o=d(this);this.xhr=sinon.useFakeXMLHttpRequest();o.requests=[];this.xhr.onCreate=function(p){o.addRequest(p)};return o},addRequest:function c(o){var p=this;this.requests.push(o);o.onSend=function(){p.handleRequest(this)};if(this.autoRespond&&!this.responding){setTimeout(function(){p.responding=false;p.respond()},this.autoRespondAfter||10);this.responding=true}},getHTTPMethod:function m(o){if(this.fakeHTTPMethods&&/post/i.test(o.method)){var p=o.requestBody.match(/_method=([^\b;]+)/);return !!p?p[1]:o.method}return o.method},handleRequest:function k(o){if(o.async){if(!this.queue){this.queue=[]}this.queue.push(o)}else{this.processRequest(o)}},respondWith:function j(q,p,o){if(arguments.length==1){this.response=l(q)}else{if(!this.responses){this.responses=[]}if(arguments.length==2){o=p;p=q;q=null}this.responses.push({method:q,url:p,response:typeof o=="function"?o:l(o)})}},respond:function a(){var o=this.queue||[];var p;while(p=o.shift()){this.processRequest(p)}},processRequest:function b(r){try{if(r.aborted){return}var p=this.response||[404,{},""];if(this.responses){for(var q=0,o=this.responses.length;q<o;q++){if(e.call(this,this.responses[q],r)){p=this.responses[q].response;break}}}if(r.readyState!=4){r.respond(p[0],p[1],p[2])}}catch(s){}},restore:function h(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}());if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}(function(){function b(){}b.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new b();sinon.fakeServerWithClock.addRequest=function d(h){if(h.async){if(typeof setTimeout.clock=="object"){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=true}if(!this.longestTimeout){var g=this.clock.setTimeout;var e=this.clock.setInterval;var f=this;this.clock.setTimeout=function(i,j){f.longestTimeout=Math.max(j,f.longestTimeout||0);return g.apply(this,arguments)};this.clock.setInterval=function(i,j){f.longestTimeout=Math.max(j,f.longestTimeout||0);return e.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,h)};sinon.fakeServerWithClock.respond=function c(){var e=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=false}}return e};sinon.fakeServerWithClock.restore=function a(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}}());if(typeof module=="object"&&typeof require=="function"){var sinon=require("sinon");sinon.extend(sinon,require("./util/fake_timers"))}(function(){function d(e,f,g,h){if(!h){return}if(f.injectInto){f.injectInto[g]=h}else{e.args.push(h)}}function a(f){var e=sinon.create(sinon.sandbox);if(f.useFakeServer){if(typeof f.useFakeServer=="object"){e.serverPrototype=f.useFakeServer}e.useFakeServer()}if(f.useFakeTimers){if(typeof f.useFakeTimers=="object"){e.useFakeTimers.apply(e,f.useFakeTimers)}else{e.useFakeTimers()}}return e}sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function b(){this.clock=sinon.useFakeTimers.apply(sinon,arguments);return this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function c(){var e=this.serverPrototype||sinon.fakeServer;if(!e||!e.create){return null}this.server=e.create();return this.add(this.server)},inject:function(e){sinon.collection.inject.call(this,e);if(this.clock){e.clock=this.clock}if(this.server){e.server=this.server;e.requests=this.server.requests}return e},create:function(g){if(!g){return sinon.create(sinon.sandbox)}var f=a(g);f.args=f.args||[];var m,k,j=f.inject({});if(g.properties){for(var h=0,e=g.properties.length;h<e;h++){m=g.properties[h];k=j[m]||m=="sandbox"&&f;d(f,g,m,k)}}else{d(f,g,"sandbox",k)}return f}});sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer;if(typeof module!="undefined"){module.exports=sinon.sandbox}}());(function(a){var b=typeof module=="object"&&typeof require=="function";if(!a&&b){a=require("sinon")}if(!a){return}function c(e){var d=typeof e;if(d!="function"){throw new TypeError("sinon.test needs to wrap a test function, got "+d)}return function(){var i=a.getConfig(a.config);i.injectInto=i.injectIntoThis&&this||i.injectInto;var g=a.sandbox.create(i);var j,f;var h=Array.prototype.slice.call(arguments).concat(g.args);try{f=e.apply(this,h)}catch(k){j=k}g.verifyAndRestore();if(j){throw j}return f}}c.config={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};if(b){module.exports=c}else{a.test=c}}(typeof sinon=="object"&&sinon||null));(function(c){var d=typeof module=="object"&&typeof require=="function";if(!c&&d){c=require("sinon")}if(!c||!Object.prototype.hasOwnProperty){return}function b(g,f,e){return function(){if(f){f.apply(this,arguments)}var i,h;try{h=g.apply(this,arguments)}catch(j){i=j}if(e){e.apply(this,arguments)}if(i){throw i}return h}}function a(g,j){if(!g||typeof g!="object"){throw new TypeError("sinon.testCase needs an object with test functions")}j=j||"test";var k=new RegExp("^"+j);var h={},l,m,e;var i=g.setUp;var f=g.tearDown;for(l in g){if(g.hasOwnProperty(l)){m=g[l];if(/^(setUp|tearDown)$/.test(l)){continue}if(typeof m=="function"&&k.test(l)){e=m;if(i||f){e=b(m,i,f)}h[l]=c.test(e)}else{h[l]=g[l]}}}return h}if(d){module.exports=a}else{c.testCase=a}}(typeof sinon=="object"&&sinon||null));(function(e){var k=typeof module=="object"&&typeof require=="function";var l=Array.prototype.slice;var a;if(!e&&k){e=require("sinon")}if(!e){return}function d(r){return r==1&&"once"||r==2&&"twice"||r==3&&"thrice"||(r||0)+" times"}function i(r){if(!r){a.fail("fake is not a spy")}if(typeof r!="function"){a.fail(r+" is not a function")}if(typeof r.getCall!="function"){a.fail(r+" is not stubbed")}}function p(r,t){var s=r.fail||a.fail;s.call(r,t)}function q(s,r){a[s]=function(v){i(v);var u=typeof v[s]=="function"?!v[s].apply(v,l.call(arguments,1)):!v[s];if(u){var x=r.replace("%c",d(v.callCount));x=x.replace("%n",v+"");x=x.replace("%C",function(y){return o(v)});x=x.replace("%t",function(y){return j(v)});x=x.replace("%*",[].slice.call(arguments,1).join(", "));for(var w=0,t=arguments.length;w<t;w++){x=x.replace("%"+w,arguments[w])}p(this,x)}else{a.pass(s)}}}function o(u){var t=[];for(var s=0,r=u.callCount;s<r;++s){t.push("    "+u.getCall(s).toString())}return t.length>0?"\n"+t.join("\n"):""}function j(t){var u=[];for(var s=0,r=t.callCount;s<r;++s){u.push(e.format(t.thisValues[s]))}return u.join(", ")}a={failException:"AssertError",fail:function g(s){var r=new Error(s);r.name=this.failException||a.failException;throw r},pass:function m(r){},called:function c(r){i(r);if(!r.called){p(this,"expected "+r+" to have been called at least once but was never called")}else{a.pass("called")}},notCalled:function h(r){i(r);if(r.called){p(this,"expected "+r+" to not have been called but was called "+d(r.callCount)+o(r))}else{a.pass("notCalled")}},callOrder:function n(){i(arguments[0]);var v=[];var y=[];var s=false;v.push(arguments[0]);for(var u=1,r=arguments.length;u<r;u++){i(arguments[u]);v.push(arguments[u]);if(!arguments[u-1].calledBefore(arguments[u])){s=true}}if(s){y=[].concat(v).sort(function(A,z){var C=A.getCall(0).callId;var B=z.getCall(0).callId;return C<B?-1:1});var t,x;try{t=v.join(", ");x=y.join(", ")}catch(w){}p(this,"expected "+(t||"")+" to be called in order but were called as "+x)}else{a.pass("callOrder")}},callCount:function f(s,r){i(s);if(s.callCount!=r){p(this,"expected "+s+" to be called "+d(r)+" but was called "+d(s.callCount)+o(s))}else{a.pass("callCount")}},expose:function b(v,t){if(!v){throw new TypeError("target is null or undefined")}t=t||{};var u=typeof t.prefix=="undefined"&&"assert"||t.prefix;var s=function(w){if(!u){return w}return u+w.substring(0,1).toUpperCase()+w.substring(1)};for(var r in this){if(!/^(fail|expose)/.test(r)){v[s(r)]=this[r]}}if(typeof t.includeFail=="undefined"||!!t.includeFail){v.fail=this.fail;v.failException=this.failException}return v}};q("calledOnce","expected %n to be called once but was called %c%C");q("calledTwice","expected %n to be called twice but was called %c%C");q("calledThrice","expected %n to be called thrice but was called %c%C");q("calledOn","expected %n to be called with %1 as this but was called with %t");q("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");q("calledWith","expected %n to be called with arguments %*%C");q("alwaysCalledWith","expected %n to always be called with arguments %*%C");q("calledWithExactly","expected %n to be called with exact arguments %*%C");q("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");q("threw","%n did not throw exception%C");q("alwaysThrew","%n did not always throw exception%C");if(k){module.exports=a}else{e.assert=a}}(typeof sinon=="object"&&sinon||null));