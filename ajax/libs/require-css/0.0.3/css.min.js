define(["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}if("undefined"==typeof window)return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;i&&(i[1]||i[7]?(o=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(o=!0,i="webkit"):i[3]||(i[4]?(o=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var s={},u=/^\/|([^\:\/]*:)/;s.pluginBuilder="./css-builder";var a=[],l={},c=[];s.addBuffer=function(e){-1==t(a,e)&&-1==t(c,e)&&(a.push(e),c.push(e))},s.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var o=i.join("/")+"/";o=e.convertURIBase(o,r,"/"),o.match(u)||(o="/"+o),"/"!=o.substr(o.length-1,1)&&(o+="/"),s.inject(e(t,o,r));for(var c=0;c<a.length;c++)(n&&".less"==a[c].substr(a[c].length-5,5)||!n&&".css"==a[c].substr(a[c].length-4,4))&&(!function(e){l[e]=l[e]||!0,setTimeout(function(){"function"==typeof l[e]&&l[e](),delete l[e]},7)}(a[c]),a.splice(c--,1))},s.attachBuffer=function(e,n){for(var r=0;r<a.length;r++)if(a[r]==e)return l[e]=n,!0;return l[e]===!0?(l[e]=n,!0):-1!=t(c,e)?(n(),!0):void 0};var f=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}f(e,t)},10)},d=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}d(e,t)},10)};if("trident"==i&&o)var h=[],p=[],v=0,m=function(e,t){var n;p.push({url:e,cb:t}),n=h.shift(),!n&&v++<12&&(n=document.createElement("style"),r.appendChild(n)),g(n)},g=function(e){var t=p.shift();if(!t)return e.onload=y,void h.push(e);e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var T=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},y=function(){};s.linkLoad=function(e,t){var s=setTimeout(function(){n&&alert("timeout"),t()},1e3*E-100),u=function(){clearTimeout(s),a&&(a.onload=y),setTimeout(t,7)};if(o)if("webkit"==i){var a=T(e);f(a,u),r.appendChild(a)}else if("gecko"==i){var l=document.createElement("style");l.textContent='@import "'+e+'"',d(l,u),r.appendChild(l)}else"trident"==i&&m(e,u);else{var a=T(e);a.onload=u,r.appendChild(a)}};var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],w={},x=function(e,t,n){if(w[e])return void t(w[e]);var r,i,o;if("undefined"!=typeof XMLHttpRequest)r=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i+=1){o=b[i];try{r=new ActiveXObject(o)}catch(s){}if(r){b=[o];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(){var i,o;4===r.readyState&&(i=r.status,i>399&&600>i?(o=new Error(e+" HTTP status: "+i),o.xhr=r,n(o)):(w[e]=r.responseText,t(r.responseText)))},r.send(null)},k=document.createElement("style");k.type="text/css",r.appendChild(k),s.inject=k.styleSheet?function(e){k.styleSheet.cssText+=e}:function(e){k.appendChild(document.createTextNode(e))};var M=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,S=window.location.pathname.split("/");S.pop(),S=S.join("/")+"/";var j=function(t,n,r){t.match(u)||(t="/"+e.convertURIBase(t,S,"/")),x(t,function(i){i=e(i,t,S);for(var o,s=[],u=[],a=[];o=M.exec(i);){var l=o[4]||o[5]||o[7]||o[8]||o[9];s.push(l),u.push(M.lastIndex-o[0].length),a.push(o[0].length)}for(var c=0,f=0;f<s.length;f++)(function(e){j(s[e],function(t){i=i.substr(0,u[e])+t+i.substr(u[e]+a[e]);for(var r=t.length-a[e],o=e+1;o<s.length;o++)u[o]+=r;c++,c==s.length&&n(i)},r)})(f);0==s.length&&n(i)},r)};s.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)};var E,L=!1;return s.load=function(e,t,r,i,u){E=E||i.waitSeconds||7;var a=e+(u?".less":".css");s.attachBuffer(a,r)||(fileUrl=t.toUrl(a),!L&&n&&(alert(o?"hacking links":"not hacking"),L=!0),u?j(fileUrl,function(e){u&&(e=u(e,function(e){s.inject(e),setTimeout(r,7)}))}):s.linkLoad(fileUrl,r))},n&&(s.inspect=function(){return k.styleSheet?k.styleSheet.cssText:k.innerHTML?k.innerHTML:void 0}),s});