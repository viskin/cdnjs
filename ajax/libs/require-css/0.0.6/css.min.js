define(["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}if("undefined"==typeof window)return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;i&&(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={},a=/^\/|([^\:\/]*:)/;o.pluginBuilder="./css-builder";var u=[],l={},c=[];o.addBuffer=function(e){-1==t(u,e)&&-1==t(c,e)&&(u.push(e),c.push(e))},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(a)||(s="/"+s),"/"!=s.substr(s.length-1,1)&&(s+="/"),o.inject(e(t,s,r));for(var c=0;c<u.length;c++)(n&&".less"==u[c].substr(u[c].length-5,5)||!n&&".css"==u[c].substr(u[c].length-4,4))&&(!function(e){l[e]=l[e]||!0,setTimeout(function(){"function"==typeof l[e]&&l[e](),delete l[e]},7)}(u[c]),u.splice(c--,1))},o.attachBuffer=function(e,n){for(var r=0;r<u.length;r++)if(u[r]==e)return l[e]=n,!0;return l[e]===!0?(l[e]=n,!0):-1!=t(c,e)?(n(),!0):void 0};var f=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}f(e,t)},10)},d=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}d(e,t)},10)};if("trident"==i&&s)var h=[],p=[],v=0,m=function(e,t){var n;p.push({url:e,cb:t}),n=h.shift(),!n&&v++<12&&(n=document.createElement("style"),r.appendChild(n)),g(n)},g=function(e){var t=p.shift();if(!t)return e.onload=T,void h.push(e);e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},T=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},1e3*L-100),a=function(){clearTimeout(o),u&&(u.onload=T),setTimeout(t,7)};if(s)if("webkit"==i){var u=y(e);f(u,a),r.appendChild(u)}else if("gecko"==i){var l=document.createElement("style");l.textContent='@import "'+e+'"',d(l,a),r.appendChild(l)}else"trident"==i&&m(e,a);else{var u=y(e);u.onload=a,r.appendChild(u)}};var b,w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],x={},k=function(e,t,n){if(x[e])return void t(x[e]);var r,i,s;if("undefined"!=typeof XMLHttpRequest)r=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i+=1){s=w[i];try{r=new ActiveXObject(s)}catch(o){}if(r){w=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(){var i,s;4===r.readyState&&(i=r.status,i>399&&600>i?(s=new Error(e+" HTTP status: "+i),s.xhr=r,n(s)):(x[e]=r.responseText,t(r.responseText)))},r.send(null)},M=0;o.inject=function(e){31>M&&(b=document.createElement("style"),b.type="text/css",r.appendChild(b),M++),b.styleSheet?b.styleSheet.cssText+=e:b.appendChild(document.createTextNode(e))};var S=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,j=window.location.pathname.split("/");j.pop(),j=j.join("/")+"/";var E=function(t,n,r){t.match(a)||(t="/"+e.convertURIBase(t,j,"/")),k(t,function(i){i=e(i,t,j);for(var s,o=[],a=[],u=[];s=S.exec(i);){var l=s[4]||s[5]||s[7]||s[8]||s[9];o.push(l),a.push(S.lastIndex-s[0].length),u.push(s[0].length)}for(var c=0,f=0;f<o.length;f++)(function(e){E(o[e],function(t){i=i.substr(0,a[e])+t+i.substr(a[e]+u[e]);for(var r=t.length-u[e],s=e+1;s<o.length;s++)a[s]+=r;c++,c==o.length&&n(i)},r)})(f);0==o.length&&n(i)},r)};o.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)};var L,B=!1;return o.load=function(e,t,r,i,a){L=L||i.waitSeconds||7;var u=e+(a?".less":".css");o.attachBuffer(u,r)||(fileUrl=t.toUrl(u),!B&&n&&(alert(s?"hacking links":"not hacking"),B=!0),a?E(fileUrl,function(e){a&&(e=a(e,function(e){o.inject(e),setTimeout(r,7)}))}):o.linkLoad(fileUrl,r))},n&&(o.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0}),o});