define(["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}if("undefined"==typeof window)return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;i&&(i[1]||i[7]?(o=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(o=!0,i="webkit"):i[3]||(i[4]?(o=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var s={};s.pluginBuilder="./css-builder";var u=[],a={},l=[];s.addBuffer=function(e){-1==t(u,e)&&-1==t(l,e)&&(u.push(e),l.push(e))},s.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var o=i.join("/")+"/";o=e.convertURIBase(o,r,"/"),o.match(/^\/|([^\:\/]*:)/)||(o="/"+o),"/"!=o.substr(o.length-1,1)&&(o+="/"),s.inject(e(t,o,r));for(var l=0;l<u.length;l++)(n&&".less"==u[l].substr(u[l].length-5,5)||!n&&".css"==u[l].substr(u[l].length-4,4))&&(!function(e){a[e]=a[e]||!0,setTimeout(function(){"function"==typeof a[e]&&a[e](),delete a[e]},7)}(u[l]),u.splice(l--,1))},s.attachBuffer=function(e,n){for(var r=0;r<u.length;r++)if(u[r]==e)return a[e]=n,!0;return a[e]===!0?(a[e]=n,!0):-1!=t(l,e)?(n(),!0):void 0};var c=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}c(e,t)},10)},f=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}f(e,t)},10)};if("trident"==i&&o)var d=[],h=[],p=0,v=function(e,t){var n;h.push({url:e,cb:t}),n=d.shift(),!n&&p++<12&&(n=document.createElement("style"),r.appendChild(n)),m(n)},m=function(e){var t=h.shift();if(!t)return e.onload=T,void d.push(e);e.onload=function(){t.cb(t.ss),m(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var g=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},T=function(){};s.linkLoad=function(e,t){var s=setTimeout(function(){n&&alert("timeout"),t()},1e3*j-100),u=function(){clearTimeout(s),a&&(a.onload=T),setTimeout(t,7)};if(o)if("webkit"==i){var a=g(e);c(a,u),r.appendChild(a)}else if("gecko"==i){var l=document.createElement("style");l.textContent='@import "'+e+'"',f(l,u),r.appendChild(l)}else"trident"==i&&v(e,u);else{var a=g(e);a.onload=u,r.appendChild(a)}};var y=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b={},w=function(e,t,n){if(b[e])return void t(b[e]);var r,i,o;if("undefined"!=typeof XMLHttpRequest)r=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i+=1){o=y[i];try{r=new ActiveXObject(o)}catch(s){}if(r){y=[o];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(){var i,o;4===r.readyState&&(i=r.status,i>399&&600>i?(o=new Error(e+" HTTP status: "+i),o.xhr=r,n(o)):(b[e]=r.responseText,t(r.responseText)))},r.send(null)},x=document.createElement("style");x.type="text/css",r.appendChild(x),s.inject=x.styleSheet?function(e){x.styleSheet.cssText+=e}:function(e){x.appendChild(document.createTextNode(e))};var k=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,M=window.location.pathname.split("/");M.pop(),M=M.join("/")+"/";var S=function(t,n,r){"/"!=t.substr(0,1)&&(t="/"+e.convertURIBase(t,M,"/")),w(t,function(i){i=e(i,t,M);for(var o,s=[],u=[],a=[];o=k.exec(i);){var l=o[4]||o[5]||o[7]||o[8]||o[9];s.push(l),u.push(k.lastIndex-o[0].length),a.push(o[0].length)}for(var c=0,f=0;f<s.length;f++)(function(e){S(s[e],function(t){i=i.substr(0,u[e])+t+i.substr(u[e]+a[e]);for(var r=t.length-a[e],o=e+1;o<s.length;o++)u[o]+=r;c++,c==s.length&&n(i)},r)})(f);0==s.length&&n(i)},r)};s.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)};var j,E=!1;return s.load=function(e,t,r,i,u){j=j||i.waitSeconds||7;var a=e+(u?".less":".css");s.attachBuffer(a,r)||(fileUrl=t.toUrl(a),!E&&n&&(alert(o?"hacking links":"not hacking"),E=!0),u?S(fileUrl,function(e){u&&(e=u(e,function(e){s.inject(e),setTimeout(r,7)}))}):s.linkLoad(fileUrl,r))},n&&(s.inspect=function(){return x.styleSheet?x.styleSheet.cssText:x.innerHTML?x.innerHTML:void 0}),s});