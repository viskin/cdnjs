var events=require("events");exports.forEach=function(a,c,d){if(!a.length){return d()}var b=0;a.forEach(function(e){c(e,function(f){if(f){d(f);d=function(){}}else{b++;if(b==a.length){d()}}})})};exports.forEachSeries=function(a,d,e){if(!a.length){return e()}var c=0;var b=function(){d(a[c],function(f){if(f){e(f);e=function(){}}else{c++;if(c==a.length){e()}else{b()}}})};b()};var doParallel=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[exports.forEach].concat(b))}};var doSeries=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[exports.forEachSeries].concat(b))}};var _map=function(d,a,c,e){var b=[];a=a.map(function(f,g){return{index:g,value:f}});d(a,function(f,g){c(f.value,function(i,h){b[f.index]=h;g(i)})},function(f){e(f,b)})};exports.map=doParallel(_map);exports.mapSeries=doSeries(_map);exports.reduce=function(a,b,c,d){exports.forEachSeries(a,function(e,f){c(b,e,function(h,g){b=g;f(h)})},function(e){d(e,b)})};exports.inject=exports.reduce;exports.foldl=exports.reduce;exports.reduceRight=function(a,b,c,e){var d=a.map(function(f){return f}).reverse();exports.reduce(d,b,c,e)};exports.foldr=exports.reduceRight;var _filter=function(d,a,c,e){var b=[];a=a.map(function(f,g){return{index:g,value:f}});d(a,function(f,g){c(f.value,function(h){if(h){b.push(f)}g()})},function(f){e(b.sort(function(h,g){return h.index-g.index}).map(function(g){return g.value}))})};exports.filter=doParallel(_filter);exports.filterSeries=doSeries(_filter);exports.select=exports.filter;exports.selectSeries=exports.filterSeries;var _reject=function(d,a,c,e){var b=[];a=a.map(function(f,g){return{index:g,value:f}});d(a,function(f,g){c(f.value,function(h){if(!h){b.push(f)}g()})},function(f){e(b.sort(function(h,g){return h.index-g.index}).map(function(g){return g.value}))})};exports.reject=doParallel(_reject);exports.rejectSeries=doSeries(_reject);var _detect=function(c,a,b,d){c(a,function(e,f){b(e,function(g){g?d(e):f()})},function(e){d()})};exports.detect=doParallel(_detect);exports.detectSeries=doSeries(_detect);exports.some=function(a,b,c){exports.forEach(a,function(d,e){b(d,function(f){if(f){c(true);c=function(){}}e()})},function(d){c(false)})};exports.any=exports.some;exports.every=function(a,b,c){exports.forEach(a,function(d,e){b(d,function(f){if(!f){c(false);c=function(){}}e()})},function(d){c(true)})};exports.all=exports.every;exports.sortBy=function(a,b,c){exports.map(a,function(d,e){b(d,function(f,g){if(f){e(f)}else{e(null,{value:d,criteria:g})}})},function(e,d){if(e){return c(e)}else{c(null,d.sort(function(i,h){var g=i.criteria,f=h.criteria;return g<f?-1:g>f?1:0}).map(function(f){return f.value}))}})};exports.auto=function(e,d){d=d||function(){};var b=Object.keys(e);if(!b.length){return d(null)}var a=[];var c=new events.EventEmitter();c.addListener("taskComplete",function(){if(a.length==b.length){d(null)}});b.forEach(function(g){var f=(e[g] instanceof Function)?[e[g]]:e[g];var l=function(k){if(k){d(k);d=function(){}}else{a.push(g);c.emit("taskComplete")}};var i=f.slice(0,Math.abs(f.length-1))||[];var h=function(){return i.reduce(function(m,k){return(m&&a.indexOf(k)!=-1)},true)};if(h()){f[f.length-1](l)}else{var j=function(){if(h()){c.removeListener("taskComplete",j);f[f.length-1](l)}};c.addListener("taskComplete",j)}})};exports.waterfall=function(c,b){if(!c.length){return b()}b=b||function(){};var a=function(d){return function(g){if(g){b(g);b=function(){}}else{var e=Array.prototype.slice.call(arguments,1);var f=d.next();if(f){e.push(a(f))}else{e.push(b)}process.nextTick(function(){d.apply(null,e)})}}};a(exports.iterator(c))()};exports.parallel=function(b,a){a=a||function(){};exports.map(b,function(c,d){c(function(f){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1){e=e[0]}d.call(null,f,e||null)})},a)};exports.series=function(b,a){a=a||function(){};exports.mapSeries(b,function(c,d){c(function(f){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1){e=e[0]}d.call(null,f,e||null)})},a)};exports.iterator=function(b){var a=function(c){var d=function(){if(b.length){b[c].apply(null,arguments)}return d.next()};d.next=function(){return(c<b.length-1)?a(c+1):undefined};return d};return a(0)};