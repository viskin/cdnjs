// flowchart, v1.0.0
// Copyright (c)2013 Adriano Raiano (adrai).
// Distributed under MIT license
// http://adrai.github.io/js-flowchart/
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd&&define([],b)}(this,function(){function a(a,b){if(!a||"function"==typeof a)return b;var c={};for(var d in b)c[d]=b[d];for(d in a)a[d]&&(c[d]=a[d]);return c}function b(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}function c(a,b,c){for(var d="M{0},{1}",e=2,f=2*c.length+2;f>e;e+=2)d+=" L{"+e+"},{"+(e+1)+"}";for(var g=[b.x,b.y],h=0,f=c.length;f>h;h++)g.push(c[h].x),g.push(c[h].y);var i=a.paper.path(d,g);return i.attr("stroke",a.options["element-color"]),i.attr("stroke-width",a.options["line-width"]),i}function d(a,b,c,d){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);for(var e="M{0},{1}",f=2,g=2*c.length+2;g>f;f+=2)e+=" L{"+f+"},{"+(f+1)+"}";for(var h=[b.x,b.y],i=0,g=c.length;g>i;i++)h.push(c[i].x),h.push(c[i].y);var j=a.paper.path(e,h);if(j.attr({stroke:a.options["line-color"],"stroke-width":a.options["line-width"],"arrow-end":"block"}),d){var k=a.paper.text(0,0,d),l=!1,m=c[0];b.y===m.y&&(l=!0);var n=0;n=b.x>m.x?b.x-(b.x-m.x)/2:m.x-(m.x-b.x)/2;var o=0;return o=b.y>m.y?b.y-(b.y-m.y)/2:m.y-(m.y-b.y)/2,l?(n-=k.getBBox().width/2,o-=a.options["text-margin"]):(n+=a.options["text-margin"],o-=k.getBBox().height/2),k.attr({"text-anchor":"start","font-size":a.options["font-size"],stroke:a.options["font-color"],x:n,y:o}),j}}function e(a,b){b=b||{},this.paper=new Raphael(a),this.options=p.defaults(b,o),this.symbols=[],this.start=null}function f(a,b,c){this.chart=a,this.group=this.chart.paper.set(),this.text=this.chart.paper.text(0,0,b.text),this.text.attr({"text-anchor":"start","font-size":this.chart.options["font-size"],x:this.chart.options["text-margin"],stroke:a.options["font-color"]}),this.group.push(this.text),c&&(c.attr({stroke:this.chart.options["element-color"],"stroke-width":this.chart.options["line-width"],width:this.text.getBBox().width+2*this.chart.options["text-margin"],height:this.text.getBBox().height+2*this.chart.options["text-margin"]}),this.group.push(c),this.text.attr({y:c.getBBox().height/2}),this.initialize())}function g(a,b){var c=a.paper.rect(0,0,0,0,20);f.call(this,a,{text:b||"Start"},c)}function h(a,b){var c=a.paper.rect(0,0,0,0,20);f.call(this,a,{text:b||"End"},c)}function i(a,b){var c=a.paper.rect(0,0,0,0);f.call(this,a,{text:b},c)}function j(a,b){var c=a.paper.rect(0,0,0,0);f.call(this,a,{text:b},c),c.attr({width:this.text.getBBox().width+4*a.options["text-margin"]}),this.text.attr({x:2*a.options["text-margin"]});var d=a.paper.rect(0,0,0,0);d.attr({x:a.options["text-margin"],stroke:a.options["element-color"],"stroke-width":a.options["line-width"],width:this.text.getBBox().width+2*a.options["text-margin"],height:this.text.getBBox().height+2*a.options["text-margin"]}),this.group.push(d),this.initialize()}function k(a,b){f.call(this,a,{text:b}),this.text.attr({x:3*a.options["text-margin"]});var d=this.text.getBBox().width+4*a.options["text-margin"],e=this.text.getBBox().height+2*a.options["text-margin"],g=a.options["text-margin"],h=e/2,i={x:g,y:h},j=[{x:g-a.options["text-margin"],y:e},{x:g-a.options["text-margin"]+d,y:e},{x:g-a.options["text-margin"]+d+2*a.options["text-margin"],y:0},{x:g-a.options["text-margin"]+2*a.options["text-margin"],y:0},{x:g,y:h}],k=c(a,i,j);k.attr({stroke:a.options["element-color"],"stroke-width":a.options["line-width"]}),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),this.initialize()}function l(a,b){f.call(this,a,{text:b}),this.text.attr({x:2*a.options["text-margin"]});var d=this.text.getBBox().width+3*a.options["text-margin"];d+=d/2;var e=this.text.getBBox().height+2*a.options["text-margin"];e+=e/2;var g=d/4,h=e/4;this.text.attr({x:g+a.options["text-margin"]/2});var i={x:g,y:h},j=[{x:g-d/4,y:h+e/4},{x:g-d/4+d/2,y:h+e/4+e/2},{x:g-d/4+d,y:h+e/4},{x:g-d/4+d/2,y:h+e/4-e/2},{x:g-d/4,y:h+e/4}],k=c(a,i,j);k.attr({stroke:a.options["element-color"],"stroke-width":a.options["line-width"]}),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),this.initialize()}function m(a){function b(a){var b=a.indexOf("(")+1,c=a.indexOf(")");return b>=0&&c>=0?d.symbols[a.substring(0,b-1)]:d.symbols[a]}function c(a){var b="next",c=a.indexOf("(")+1,d=a.indexOf(")");return c>=0&&d>=0&&(b=v.substring(c,d)),b}a=a||"",a=a.trim();for(var d={symbols:{},start:null,drawSVG:function(a,b){function c(a){if(f[a.key])return f[a.key];switch(a.symbolType){case"start":f[a.key]=new g(d,a.txt);break;case"end":f[a.key]=new h(d,a.txt);break;case"operation":f[a.key]=new i(d,a.txt);break;case"inputoutput":f[a.key]=new k(d,a.txt);break;case"subroutine":f[a.key]=new j(d,a.txt);break;case"condition":f[a.key]=new l(d,a.txt);break;default:return new Error("Wrong symbol type!")}return f[a.key]}this.diagram&&this.diagram.clean();var d=new e(a,b);this.diagram=d;var f={},m=this;!function n(a,b,e){var f=c(a);return m.start===a?d.startWith(f):b&&e&&!b.pathOk&&(b instanceof l?e.yes===a?b.yes(f):e.no===a&&b.no(f):b.then(f)),f.pathOk?f:(f instanceof l?(a.yes&&n(a.yes,f,a),a.no&&n(a.no,f,a)):a.next&&n(a.next,f,a),f)}(this.start),d.render()},clean:function(){this.diagram.clean()}},f=a.split("\n"),m=1,n=f.length;n>m;){var o=f[m];o.indexOf(":")<0&&o.indexOf("(")<0&&o.indexOf(")")<0&&o.indexOf("->")<0&&o.indexOf("=>")<0?(f[m-1]+="\n"+o,f.splice(m,1),n--):m++}for(;f.length>0;){var p=f.splice(0,1)[0];if(p.indexOf("=>")>=0){var q=p.split("=>"),r={key:q[0],symbolType:q[1],txt:null};if(r.symbolType.indexOf(": ")>=0){var s=r.symbolType.split(": ");r.symbolType=s[0],r.txt=s[1]}d.symbols[r.key]=r}else if(p.indexOf("->")>=0)for(var t=p.split("->"),u=0,n=t.length;n>u;u++){var v=t[u],w=b(v),x=c(v);if(d.start||(d.start=w),n>u+1){var y=t[u+1];w[x]=b(y)}}}return d}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var n={},o={"line-width":3,"line-length":50,"text-margin":10,"font-size":14,"font-color":"black","line-color":"black","element-color":"black"},p={defaults:a,inherits:b};return e.prototype.handle=function(a){this.symbols.indexOf(a)>=-1&&this.symbols.push(a);var b=this;return a instanceof l?(a.yes=function(c){return a.yes_symbol=c,a.no_symbol&&(a.pathOk=!0),b.handle(c)},a.no=function(c){return a.no_symbol=c,a.yes_symbol&&(a.pathOk=!0),b.handle(c)}):a.then=function(c){return a.next=c,a.pathOk=!0,b.handle(c)},a},e.prototype.startWith=function(a){return this.start=a,this.handle(a)},e.prototype.render=function(){var a=0,b=0,c=0,d=0,e=0;for(b=0,c=this.symbols.length;c>b;b++){var f=this.symbols[b];f.width>a&&(a=f.width)}for(b=0,c=this.symbols.length;c>b;b++){var f=this.symbols[b];f.shiftX((a-f.width)/2)}for(b=0,c=this.symbols.length;c>b;b++){var f=this.symbols[b];f.render()}for(b=0,c=this.symbols.length;c>b;b++){var f=this.symbols[b];f.renderLines()}for(d=this.maxXFromLine,b=0,c=this.symbols.length;c>b;b++){var f=this.symbols[b],g=f.getX()+f.width,h=f.getY()+f.height;g>d&&(d=g),h>e&&(e=h)}this.paper.setSize(d+this.options["line-width"],e+this.options["line-width"])},e.prototype.clean=function(){if(this.paper){var a=this.paper.canvas;a.parentNode.removeChild(a)}},f.prototype.initialize=function(){this.group.transform("t"+this.chart.options["line-width"]+","+this.chart.options["line-width"]),this.width=this.group.getBBox().width,this.height=this.group.getBBox().height},f.prototype.getCenter=function(){return{x:this.getX()+this.width/2,y:this.getY()+this.height/2}},f.prototype.getX=function(){return this.group.getBBox().x},f.prototype.getY=function(){return this.group.getBBox().y},f.prototype.shiftX=function(a){this.group.transform("t"+(this.getX()+a)+","+this.getY())},f.prototype.setX=function(a){this.group.transform("t"+a+","+this.getY())},f.prototype.shiftY=function(a){this.group.transform("t"+this.getX()+","+(this.getY()+a))},f.prototype.setY=function(a){this.group.transform("t"+this.getX()+","+a)},f.prototype.getTop=function(){var a=this.getY(),b=this.getX()+this.width/2;return{x:b,y:a}},f.prototype.getBottom=function(){var a=this.getY()+this.height,b=this.getX()+this.width/2;return{x:b,y:a}},f.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX();return{x:b,y:a}},f.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width;return{x:b,y:a}},f.prototype.render=function(){if(this.next){var a=this.getBottom();this.next.getTop(),this.next.isPositioned||(this.next.shiftY(this.getY()+this.height+this.chart.options["line-length"]),this.next.setX(a.x-this.next.width/2),this.next.isPositioned=!0)}},f.prototype.renderLines=function(){this.next&&this.drawLineTo(this.next)},f.prototype.drawLineTo=function(a,b,c){var e=this.getCenter().x,f=this.getCenter().y,g=(this.getTop(),this.getRight()),h=this.getBottom(),i=this.getLeft(),j=a.getCenter().x,k=a.getCenter().y,l=a.getTop(),m=a.getRight(),n=(a.getBottom(),a.getLeft()),o=e===j,p=f===k,q=k>f,r=f>k,s=e>j,t=j>e,u=0;c&&"bottom"!==c||!o||!q?c&&"right"!==c||!p||!t?c&&"left"!==c||!p||!s?c&&"right"!==c||!o||!r?c&&"bottom"!==c||!s?c&&"bottom"!==c||!t?c&&"right"===c&&s?(d(this.chart,g,[{x:g.x+this.chart.options["line-length"]/2,y:g.y},{x:g.x+this.chart.options["line-length"]/2,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y}],b),this.rightStart=!0,a.topEnd=!0,u=g.x+this.chart.options["line-length"]/2):c&&"right"===c&&t&&(d(this.chart,g,[{x:g.x+(g.x-l.x)/2,y:g.y},{x:g.x+(g.x-l.x)/2,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y}],b),this.rightStart=!0,a.topEnd=!0,u=g.x+(g.x-l.x)/2):(d(this.chart,h,[{x:h.x,y:h.y+this.chart.options["line-length"]/2},{x:h.x+(h.x-l.x)/2,y:h.y+this.chart.options["line-length"]/2},{x:h.x+(h.x-l.x)/2,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y}],b),this.bottomStart=!0,a.topEnd=!0,u=h.x+(h.x-l.x)/2):(this.leftEnd&&r?d(this.chart,h,[{x:h.x,y:h.y+this.chart.options["line-length"]/2},{x:h.x+(h.x-l.x)/2,y:h.y+this.chart.options["line-length"]/2},{x:h.x+(h.x-l.x)/2,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y}],b):d(this.chart,h,[{x:h.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y-this.chart.options["line-length"]/2},{x:l.x,y:l.y}],b),this.bottomStart=!0,a.topEnd=!0,u=h.x+(h.x-l.x)/2):(d(this.chart,g,[{x:g.x+this.chart.options["line-length"]/2,y:g.y},{x:g.x+this.chart.options["line-length"]/2,y:m.y},{x:m.x,y:m.y}],b),this.rightStart=!0,a.rightEnd=!0,u=g.x+this.chart.options["line-length"]/2):(d(this.chart,i,m,b),this.leftStart=!0,a.rightEnd=!0,u=m.x):(d(this.chart,g,n,b),this.rightStart=!0,a.leftEnd=!0,u=n.x):(d(this.chart,h,l,b),this.bottomStart=!0,a.topEnd=!0,u=h.x),(!this.chart.maxXFromLine||this.chart.maxXFromLine&&u>this.chart.maxXFromLine)&&(this.chart.maxXFromLine=u)},p.inherits(g,f),p.inherits(h,f),p.inherits(i,f),p.inherits(j,f),p.inherits(k,f),k.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.chart.options["text-margin"];return{x:b,y:a}},k.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width-this.chart.options["text-margin"];return{x:b,y:a}},p.inherits(l,f),l.prototype.render=function(){if(this.yes_symbol){var a=this.getBottom();this.yes_symbol.getTop(),this.yes_symbol.isPositioned||(this.yes_symbol.shiftY(this.getY()+this.height+this.chart.options["line-length"]),this.yes_symbol.setX(a.x-this.yes_symbol.width/2),this.yes_symbol.isPositioned=!0)}if(this.no_symbol){var b=this.getRight();this.no_symbol.getLeft(),this.no_symbol.isPositioned||(this.no_symbol.setY(b.y-this.no_symbol.height/2),this.no_symbol.shiftX(this.group.getBBox().x+this.width+this.chart.options["line-length"]),this.no_symbol.isPositioned=!0)}},l.prototype.renderLines=function(){this.yes_symbol&&this.drawLineTo(this.yes_symbol,"yes"),this.no_symbol&&this.drawLineTo(this.no_symbol,"no","right")},n.parse=m,n});