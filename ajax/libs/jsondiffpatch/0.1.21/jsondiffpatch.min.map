{"version":3,"file":"bundle.js","sources":["/source-files/jsondiffpatch/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/jsondiffpatch/src/main.js","/source-files/jsondiffpatch/src/diffpatcher.js","/source-files/jsondiffpatch/src/date-reviver.js","/source-files/jsondiffpatch/node_modules/fiberglass/node_modules/browserify/node_modules/process/browser.js","/source-files/jsondiffpatch/src/processor.js","/source-files/jsondiffpatch/src/pipe.js","/source-files/jsondiffpatch/src/contexts/diff.js","/source-files/jsondiffpatch/src/contexts/patch.js","/source-files/jsondiffpatch/src/contexts/reverse.js","/source-files/jsondiffpatch/src/filters/trivial.js","/source-files/jsondiffpatch/src/filters/nested.js","/source-files/jsondiffpatch/src/filters/arrays.js","/source-files/jsondiffpatch/src/filters/dates.js","/source-files/jsondiffpatch/src/filters/texts.js","/source-files/jsondiffpatch/src/contexts/context.js","/source-files/jsondiffpatch/src/filters/lcs.js"],"names":["Processor","require","Pipe","DiffContext","PatchContext","ReverseContext","trivial","nested","arrays","dates","texts","DiffPatcher","options","this","processor","pipe","append","collectChildrenDiffFilter","diffFilter","objectsDiffFilter","shouldHaveResult","collectChildrenPatchFilter","patchFilter","collectChildrenReverseFilter","reverseFilter","prototype","apply","arguments","diff","left","right","process","patch","delta","reverse","unpatch","exports","module","key","value","parts","exec","Date","UTC","noop","nextTick","canSetImmediate","window","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","source","data","stopPropagation","length","fn","shift","push","setTimeout","title","browser","env","argv","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","Error","cwd","chdir","selfOptions","pipes","name","input","context","lastPipe","lastContext","nextPipe","nextAfterChildren","next","hasResult","result","undefined","filters","debug","index","filter","log","filterName","exiting","resultCheck","msg","console","prepend","unshift","indexOf","list","names","after","params","Array","slice","call","splice","before","clear","should","error","noResult","Context","isArray","a","setResult","exit","leftType","rightType","leftIsArray","rightIsArray","children","child","childName","_t","hasOwnProperty","lcs","ARRAY_MOVE","arrayIndexOf","array","item","i","index1","index2","objectHash","match","array1","array2","value1","value2","hash1","hash2","hashCache1","hashCache2","matchContext","commonHead","commonTail","len1","len2","trimmed1","trimmed2","seq","get","removedItems","indices1","detectMove","includeValueOnMove","removedItemsLength","indexOnArray2","indices2","isMove","removeItemIndex1","compare","numerically","b","numericallyBy","toRemove","toInsert","toModify","parseInt","sort","indexDiff","removedValue","toInsertLength","insertion","toModifyLength","modification","newName","substr","reverseArrayDeltaIndex","itemDelta","newIndex","uindex","itemDelta2","toString","getTime","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","instance","diff_match_patch","dmpModuleName","dmp","err","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","results","patch_apply","patch_fromText","textPatchFailed","minLength","textDiff","textDeltaReverse","l","lines","line","lineTmp","lineHeader","lineAdd","lineRemove","header","headerRegex","split","lineStart","join","switchTo","parent","root","defaultMatch","lengthMatrix","x","y","matrix","Math","max","backtrack","sequence","subsequence"],"mappings":"AAAA;ACAA;;AG4CA,QAAS4C,SA1CT,GAAIb,SAAUM,OAAOD,UAErBL,SAAQc,SAAW,WACf,GAAIC,GAAoC,mBAAXC,SAC1BA,OAAOC,aACNC,EAA4B,mBAAXF,SAClBA,OAAOG,aAAeH,OAAOI,gBAGhC,IAAIL,EACA,MAAO,UAAUM,GAAK,MAAOL,QAAOC,aAAaI,GAGrD,IAAIH,EAAS,CACT,GAAII,KAYJ,OAXAN,QAAOI,iBAAiB,UAAW,SAAUG,GACzC,GAAIC,GAASD,EAAGC,MAChB,KAAKA,IAAWR,QAAqB,OAAXQ,IAAgC,iBAAZD,EAAGE,OAC7CF,EAAGG,kBACCJ,EAAMK,OAAS,GAAG,CAClB,GAAIC,GAAKN,EAAMO,OACfD,QAGT,GAEI,SAAkBA,GACrBN,EAAMQ,KAAKF,GACXZ,OAAOG,YAAY,eAAgB,MAI3C,MAAO,UAAkBS,GACrBG,WAAWH,EAAI,OAIvB5B,QAAQgC,MAAQ,UAChBhC,QAAQiC,SAAU,EAClBjC,QAAQkC,OACRlC,QAAQmC,QAIRnC,QAAQoC,GAAKvB,KACbb,QAAQqC,YAAcxB,KACtBb,QAAQsC,KAAOzB,KACfb,QAAQuC,IAAM1B,KACdb,QAAQwC,eAAiB3B,KACzBb,QAAQyC,mBAAqB5B,KAC7Bb,QAAQ0C,KAAO7B,KAEfb,QAAQ2C,QAAU,WACd,KAAM,IAAIC,OAAM,qCAIpB5C,QAAQ6C,IAAM,WAAc,MAAO,KACnC7C,QAAQ8C,MAAQ,WACZ,KAAM,IAAIF,OAAM;;AW5DpB,GAAIzE,MAAOD,QAAQ,WAAWC,KAE1BmH,QAAU,YAGdA,SAAQ5F,UAAU+F,UAAY,SAAS/B,GAGtC,MAFA5E,MAAK4E,OAASA,EACd5E,KAAK2E,WAAY,EACV3E,MAGRwG,QAAQ5F,UAAUgG,KAAO,WAExB,MADA5G,MAAKoF,SAAU,EACRpF,MAGRwG,QAAQ5F,UAAUuM,SAAW,SAASzI,EAAMxE,GAS3C,MARoB,gBAATwE,IAAqBA,YAAgBrF,MAC/CW,KAAKwE,SAAWE,GAEhB1E,KAAK0E,KAAOA,EACRxE,IACHF,KAAKwE,SAAWtE,IAGXF,MAGRwG,QAAQ5F,UAAUoC,KAAO,SAASkE,EAAO/C,GAgBxC,MAfA+C,GAAMkG,OAASpN,KACK,mBAATmE,KACV+C,EAAMC,UAAYhD,GAEnB+C,EAAMmG,KAAOrN,KAAKqN,MAAQrN,KAC1BkH,EAAMnH,QAAUmH,EAAMnH,SAAWC,KAAKD,QACjCC,KAAKiH,UAKTjH,KAAKiH,SAASjH,KAAKiH,SAASpE,OAAS,GAAG6B,KAAOwC,EAC/ClH,KAAKiH,SAASjE,KAAKkE,KALnBlH,KAAKiH,UAAYC,GACjBlH,KAAKyE,kBAAoBzE,KAAK0E,MAAQ,KACtC1E,KAAK0E,KAAOwC,GAKbA,EAAMxC,KAAO1E,KACNA,MAGRuB,QAAQiF,QAAUA;;ARhDlB,GAAIA,SAAUpH,QAAQ,aAAaoH,QAE/BlH,YAAc,SAAqB0B,EAAMC,GAC3CjB,KAAKgB,KAAOA,EACZhB,KAAKiB,MAAQA,EACbjB,KAAKE,KAAO,OAGdZ,aAAYsB,UAAY,GAAI4F,SAE5BjF,QAAQjC,YAAcA;;ACVtB,GAAIkH,SAAUpH,QAAQ,aAAaoH,QAE/BjH,aAAe,SAAsByB,EAAMI,GAC7CpB,KAAKgB,KAAOA,EACZhB,KAAKoB,MAAQA,EACbpB,KAAKE,KAAO,QAGdX,cAAaqB,UAAY,GAAI4F,SAE7BjF,QAAQhC,aAAeA;;ACVvB,GAAIiH,SAAUpH,QAAQ,aAAaoH,QAE/BhH,eAAiB,SAAwB4B,GAC3CpB,KAAKoB,MAAQA,EACbpB,KAAKE,KAAO,UAGdV,gBAAeoB,UAAY,GAAI4F,SAE/BjF,QAAQ/B,eAAiBA;;ANRzBgC,OAAOD,QAAU,SAAqBE,EAAKC,GACzC,GAAIC,EACJ,OAAqB,gBAAVD,KACTC,EAAQ,0FAA0FC,KAAKF,IAE9F,GAAIG,MAAKA,KAAKC,KAAKH,EAAM,IAAKA,EAAM,GAAK,GAAIA,EAAM,IAAKA,EAAM,IAAKA,EAAM,IAAKA,EAAM,KAAMA,EAAM,IAAM,KAG1GD;;ADTT,GAAIvC,WAAYC,QAAQ,eAAeD,UACnCE,KAAOD,QAAQ,UAAUC,KACzBC,YAAcF,QAAQ,mBAAmBE,YACzCC,aAAeH,QAAQ,oBAAoBG,aAC3CC,eAAiBJ,QAAQ,sBAAsBI,eAE/CC,QAAUL,QAAQ,qBAClBM,OAASN,QAAQ,oBACjBO,OAASP,QAAQ,oBACjBQ,MAAQR,QAAQ,mBAChBS,MAAQT,QAAQ,mBAEhBU,YAAc,SAAqBC,GACrCC,KAAKC,UAAY,GAAId,WAAUY,GAC/BC,KAAKC,UAAUC,KAAK,GAAIb,MAAK,QAAQc,OACnCT,OAAOU,0BACPX,QAAQY,WACRT,MAAMS,WACNR,MAAMQ,WACNX,OAAOY,kBACPX,OAAOU,YACPE,oBACFP,KAAKC,UAAUC,KAAK,GAAIb,MAAK,SAASc,OACpCT,OAAOc,2BACPb,OAAOa,2BACPf,QAAQgB,YACRZ,MAAMY,YACNf,OAAOe,YACPd,OAAOc,aACPF,oBACFP,KAAKC,UAAUC,KAAK,GAAIb,MAAK,WAAWc,OACtCT,OAAOgB,6BACPf,OAAOe,6BACPjB,QAAQkB,cACRd,MAAMc,cACNjB,OAAOiB,cACPhB,OAAOgB,eACPJ,oBAGJT,aAAYc,UAAUb,QAAU,WAC9B,MAAOC,MAAKC,UAAUF,QAAQc,MAAMb,KAAKC,UAAWa,YAGtDhB,YAAYc,UAAUG,KAAO,SAASC,EAAMC,GAC1C,MAAOjB,MAAKC,UAAUiB,QAAQ,GAAI5B,aAAY0B,EAAMC,KAGtDnB,YAAYc,UAAUO,MAAQ,SAASH,EAAMI,GAC3C,MAAOpB,MAAKC,UAAUiB,QAAQ,GAAI3B,cAAayB,EAAMI,KAGvDtB,YAAYc,UAAUS,QAAU,SAASD,GACvC,MAAOpB,MAAKC,UAAUiB,QAAQ,GAAI1B,gBAAe4B,KAGnDtB,YAAYc,UAAUU,QAAU,SAASL,EAAOG,GAC9C,MAAOpB,MAAKmB,MAAMF,EAAOjB,KAAKqB,QAAQD,KAGxCG,QAAQzB,YAAcA;;AU5DtB,GAAIR,aAAcF,QAAQ,oBAAoBE,YAC1CC,aAAeH,QAAQ,qBAAqBG,aAC5CC,eAAiBJ,QAAQ,uBAAuBI,eAEhD8H,IAAMlI,QAAQ,SAEdmI,WAAa,EAEbd,QAAoC,kBAAlBV,OAAMU,QAE1BV,MAAMU,QAEN,SAASC,GACP,MAAOA,aAAaX,QAGpByB,aAAkD,kBAA5BzB,OAAMnF,UAAU8E,QACxC,SAAS+B,EAAOC,GACd,MAAOD,GAAM/B,QAAQgC,IACnB,SAASD,EAAOC,GAElB,IAAK,GADD7E,GAAS4E,EAAM5E,OACV8E,EAAI,EAAO9E,EAAJ8E,EAAYA,IAC1B,GAAIF,EAAME,KAAOD,EACf,MAAOC,EAGX,OAAO,IAGPtH,WAAa,SAA0BgE,GACzC,GAAKA,EAAQ0C,YAAb,CA0DA,IAtDA,GA6CE/B,GAAO4C,EAAQC,EAMbX,EAnDAY,EAAazD,EAAQtE,SAAWsE,EAAQtE,QAAQ+H,WAEhDC,EAAQ,SAASC,EAAQC,EAAQL,EAAQC,EAAQxD,GACnD,GAAI6D,GAASF,EAAOJ,GAChBO,EAASF,EAAOJ,EACpB,IAAIK,IAAWC,EACb,OAAO,CAET,IAAsB,gBAAXD,IAAyC,gBAAXC,GACvC,OAAO,CAET,KAAKL,EACH,OAAO,CAET,IAAIM,GAAOC,CAUX,OATsB,gBAAXT,IACTvD,EAAQiE,WAAajE,EAAQiE,eAC7BF,EAAQ/D,EAAQiE,WAAWV,GACN,mBAAVQ,KACT/D,EAAQiE,WAAWV,GAAUQ,EAAQN,EAAWI,EAAQN,KAG1DQ,EAAQN,EAAWI,GAEA,mBAAVE,IACF,GAEa,gBAAXP,IACTxD,EAAQkE,WAAalE,EAAQkE,eAC7BF,EAAQhE,EAAQkE,WAAWV,GACN,mBAAVQ,KACThE,EAAQkE,WAAWV,GAAUQ,EAAQP,EAAWK,EAAQN,KAG1DQ,EAAQP,EAAWK,GAEA,mBAAVE,IACF,EAEFD,IAAUC,IAGfG,KACAC,EAAa,EACfC,EAAa,EAEXV,EAAS3D,EAAQrD,KACjBiH,EAAS5D,EAAQpD,MACjB0H,EAAOX,EAAOnF,OACd+F,EAAOX,EAAOpF,OAKE8F,EAAbF,GAAkCG,EAAbH,GAC1BV,EAAMC,EAAQC,EAAQQ,EAAYA,EAAYD,IAC9CxD,EAAQyD,EACRvB,EAAQ,GAAI5H,aAAY+E,EAAQrD,KAAKgE,GAAQX,EAAQpD,MAAM+D,IAC3DX,EAAQrB,KAAKkE,EAAOlC,GACpByD,GAGF,MAAiCE,EAA1BD,EAAaD,GAA+CG,EAA1BF,EAAaD,GACpDV,EAAMC,EAAQC,EAAQU,EAAO,EAAID,EAAYE,EAAO,EAAIF,EAAYF,IACpEZ,EAASe,EAAO,EAAID,EACpBb,EAASe,EAAO,EAAIF,EACpBxB,EAAQ,GAAI5H,aAAY+E,EAAQrD,KAAK4G,GAASvD,EAAQpD,MAAM4G,IAC5DxD,EAAQrB,KAAKkE,EAAOW,GACpBa,GAEF,IAAI9D,EACJ,IAAI6D,EAAaC,IAAeC,EAAM,CACpC,GAAIA,IAASC,EAGX,WADAvE,GAAQsC,UAAU9B,QAAW+B,MAO/B,KAHAhC,EAASA,IACPwC,GAAI,KAEDpC,EAAQyD,EAAoBG,EAAOF,EAAf1D,EAA2BA,IAClDJ,EAAOI,IAAUiD,EAAOjD,GAG1B,YADAX,GAAQsC,UAAU/B,GAAQgC,OAG5B,GAAI6B,EAAaC,IAAeE,EAAM,CAKpC,IAHAhE,EAASA,IACPwC,GAAI,KAEDpC,EAAQyD,EAAoBE,EAAOD,EAAf1D,EAA2BA,IAClDJ,EAAO,IAAMI,IAAUgD,EAAOhD,GAAQ,EAAG,EAG3C,YADAX,GAAQsC,UAAU/B,GAAQgC,OAI5B4B,IAEA,IAAIK,GAAWb,EAAOhC,MAAMyC,EAAYE,EAAOD,GAC3CI,EAAWb,EAAOjC,MAAMyC,EAAYG,EAAOF,GAC3CK,EAAMzB,IAAI0B,IACZH,EAAUC,EACVf,EACAS,GAEES,IAIJ,KAHArE,EAASA,IACPwC,GAAI,KAEDpC,EAAQyD,EAAoBE,EAAOD,EAAf1D,EAA2BA,IAC9CwC,aAAauB,EAAIG,SAAUlE,EAAQyD,GAAc,IAEnD7D,EAAO,IAAMI,IAAUgD,EAAOhD,GAAQ,EAAG,GACzCiE,EAAajG,KAAKgC,GAItB,IAAImE,IAAa,CACb9E,GAAQtE,SAAWsE,EAAQtE,QAAQJ,QAAU0E,EAAQtE,QAAQJ,OAAOwJ,cAAe,IACrFA,GAAa,EAEf,IAAIC,IAAqB,CACrB/E,GAAQtE,SAAWsE,EAAQtE,QAAQJ,QAAU0E,EAAQtE,QAAQJ,OAAOyJ,qBACtEA,GAAqB,EAGvB,IAAIC,GAAqBJ,EAAapG,MACtC,KAAKmC,EAAQyD,EAAoBG,EAAOF,EAAf1D,EAA2BA,IAAS,CAC3D,GAAIsE,GAAgB9B,aAAauB,EAAIQ,SAAUvE,EAAQyD,EACvD,IAAoB,EAAhBa,EAAmB,CAErB,GAAIE,IAAS,CACb,IAAIL,GAAcE,EAAqB,EACrC,IAAK,GAAII,GAAmB,EAAsBJ,EAAnBI,EAAuCA,IAEpE,GADA7B,EAASqB,EAAaQ,GAClB1B,EAAMc,EAAUC,EAAUlB,EAASa,EACrCzD,EAAQyD,EAAYD,GAAe,CAEnC5D,EAAO,IAAMgD,GAAQ1B,OAAO,EAAG,EAAGlB,EAAOuC,YACpC6B,IAEHxE,EAAO,IAAMgD,GAAQ,GAAK,IAG5BC,EAAS7C,EACTkC,EAAQ,GAAI5H,aAAY+E,EAAQrD,KAAK4G,GAASvD,EAAQpD,MAAM4G,IAC5DxD,EAAQrB,KAAKkE,EAAOW,GACpBoB,EAAa/C,OAAOuD,EAAkB,GACtCD,GAAS,CACT,OAIDA,IAEH5E,EAAOI,IAAUiD,EAAOjD,SAI1B4C,GAASmB,EAAIG,SAASI,GAAiBb,EACvCZ,EAASkB,EAAIQ,SAASD,GAAiBb,EACvCvB,EAAQ,GAAI5H,aAAY+E,EAAQrD,KAAK4G,GAASvD,EAAQpD,MAAM4G,IAC5DxD,EAAQrB,KAAKkE,EAAOW,GAIxBxD,EAAQsC,UAAU/B,GAAQgC,QAG5BvG,YAAW8E,WAAa,QAExB,IAAIuE,UACFC,YAAa,SAASjD,EAAGkD,GACvB,MAAOlD,GAAIkD,GAEbC,cAAe,SAAS1F,GACtB,MAAO,UAASuC,EAAGkD,GACjB,MAAOlD,GAAEvC,GAAQyF,EAAEzF,MAKrB1D,YAAc,SAA2B4D,GAC3C,GAAKA,EAAQ3E,QAGY,MAArB2E,EAAQjD,MAAMgG,GAAlB,CAGA,GAAIpC,GAAO4C,EAEPxG,EAAQiD,EAAQjD,MAChBqG,EAAQpD,EAAQrD,KAGhB8I,KACAC,KACAC,IACJ,KAAKhF,IAAS5D,GACZ,GAAc,OAAV4D,EACF,GAAiB,MAAbA,EAAM,GAAY,CAEpB,GAAwB,IAApB5D,EAAM4D,GAAO,IAAY5D,EAAM4D,GAAO,KAAOuC,WAG/C,KAAM,IAAIzD,OAAM,qFACY1C,EAAM4D,GAAO,GAHzC8E,GAAS9G,KAAKiH,SAASjF,EAAMgB,MAAM,GAAI,SAMb,KAAxB5E,EAAM4D,GAAOnC,OAEfkH,EAAS/G,MACPgC,MAAOiF,SAASjF,EAAO,IACvBtD,MAAON,EAAM4D,GAAO,KAItBgF,EAAShH,MACPgC,MAAOiF,SAASjF,EAAO,IACvB5D,MAAOA,EAAM4D,IASvB,KADA8E,EAAWA,EAASI,KAAKR,QAAQC,aAC5B3E,EAAQ8E,EAASjH,OAAS,EAAGmC,GAAS,EAAGA,IAAS,CACrD4C,EAASkC,EAAS9E,EAClB,IAAImF,GAAY/I,EAAM,IAAMwG,GACxBwC,EAAe3C,EAAMvB,OAAO0B,EAAQ,GAAG,EACvCuC,GAAU,KAAO5C,YAEnBwC,EAAS/G,MACPgC,MAAOmF,EAAU,GACjBzI,MAAO0I,IAMbL,EAAWA,EAASG,KAAKR,QAAQG,cAAc,SAC/C,IAAIQ,GAAiBN,EAASlH,MAC9B,KAAKmC,EAAQ,EAAWqF,EAARrF,EAAwBA,IAAS,CAC/C,GAAIsF,GAAYP,EAAS/E,EACzByC,GAAMvB,OAAOoE,EAAUtF,MAAO,EAAGsF,EAAU5I,OAI7C,GACIwF,GADAqD,EAAiBP,EAASnH,MAE9B,IAAI0H,EAAiB,EACnB,IAAKvF,EAAQ,EAAWuF,EAARvF,EAAwBA,IAAS,CAC/C,GAAIwF,GAAeR,EAAShF,EAC5BkC,GAAQ,GAAI3H,cAAa8E,EAAQrD,KAAKwJ,EAAaxF,OAAQwF,EAAapJ,OACxEiD,EAAQrB,KAAKkE,EAAOsD,EAAaxF,OAIrC,MAAKX,GAAQ4C,aAIb5C,GAAQuC,WAHNvC,GAAQsC,UAAUtC,EAAQrD,MAAM4F,QAKpCnG,aAAY0E,WAAa,QAEzB,IAAI3E,4BAA6B,SAAoC6D,GACnE,GAAKA,GAAYA,EAAQ4C,UAGA,MAArB5C,EAAQjD,MAAMgG,GAAlB,CAKA,IAAK,GADDF,GADArE,EAASwB,EAAQ4C,SAASpE,OAErBmC,EAAQ,EAAWnC,EAARmC,EAAgBA,IAClCkC,EAAQ7C,EAAQ4C,SAASjC,GACzBX,EAAQrD,KAAKkG,EAAMC,WAAaD,EAAMtC,MAExCP,GAAQsC,UAAUtC,EAAQrD,MAAM4F,QAElCpG,4BAA2B2E,WAAa,uBAExC,IAAIxE,eAAgB,SAA6B0D,GAC/C,IAAKA,EAAQ3E,OAKX,YAJI2E,EAAQjD,MAAM,KAAOmG,aACvBlD,EAAQoG,QAAU,IAAMpG,EAAQjD,MAAM,GACtCiD,EAAQsC,WAAWtC,EAAQjD,MAAM,GAAI6I,SAAS5F,EAAQ8C,UAAUuD,OAAO,GAAI,IAAKnD,aAAaX,QAIjG,IAAyB,MAArBvC,EAAQjD,MAAMgG,GAAlB,CAGA,GAAIjD,GAAM+C,CACV,KAAK/C,IAAQE,GAAQjD,MACN,OAAT+C,IAGJ+C,EAAQ,GAAI1H,gBAAe6E,EAAQjD,MAAM+C,IACzCE,EAAQrB,KAAKkE,EAAO/C,GAEtBE,GAAQuC,QAEVjG,eAAcwE,WAAa,QAE3B,IAAIwF,wBAAyB,SAASvJ,EAAO4D,EAAO4F,GAClD,GAAIC,GAAW7F,CACf,IAAqB,gBAAVA,IAAmC,MAAbA,EAAM,GACrC6F,EAAWZ,SAASjF,EAAM0F,OAAO,GAAI,QAChC,CACL,GAAII,GAAS,IAAM9F,CACnB,IAAIyB,QAAQmE,IAA+B,IAAjBA,EAAU,GAClCC,EAAWC,MAEX,KAAK,GAAIjD,KAAUzG,GAAO,CACxB,GAAI2J,GAAa3J,EAAMyG,EACnBpB,SAAQsE,IAAeA,EAAW,KAAOxD,YAAcwD,EAAW,GAAGC,aAAehG,IACtF6F,EAAWhD,EAAO6C,OAAO,KAKjC,MAAOG,IAGLnK,6BAA+B,SAAsC2D,GACvE,GAAKA,GAAYA,EAAQ4C,UAGA,MAArB5C,EAAQjD,MAAMgG,GAAlB,CAQA,IAAK,GAJDF,GADArE,EAASwB,EAAQ4C,SAASpE,OAE1BzB,GACFgG,GAAI,KAEGpC,EAAQ,EAAWnC,EAARmC,EAAgBA,IAAS,CAC3CkC,EAAQ7C,EAAQ4C,SAASjC,EACzB,IAAIb,GAAO+C,EAAMuD,OACG,oBAATtG,KACTA,EAAOwG,uBAAuBtG,EAAQjD,MAAO8F,EAAMC,UAAWD,EAAMtC,SAElExD,EAAM+C,KAAU+C,EAAMtC,SACxBxD,EAAM+C,GAAQ+C,EAAMtC,QAGxBP,EAAQsC,UAAUvF,GAAOwF,QAE3BlG,8BAA6ByE,WAAa,wBAE1C5D,QAAQlB,WAAaA,WACrBkB,QAAQd,YAAcA,YACtBc,QAAQf,2BAA6BA,2BACrCe,QAAQZ,cAAgBA,cACxBY,QAAQb,6BAA+BA;;AC3YvC,GAAIL,YAAa,SAAyBgE,GACpCA,EAAQrD,eAAgBa,OAGtBwC,EAAQsC,UAFRtC,EAAQpD,gBAAiBY,MACvBwC,EAAQrD,KAAKiK,YAAc5G,EAAQpD,MAAMgK,WACxB5G,EAAQrD,KAAMqD,EAAQpD,OAEvB4D,QAGDR,EAAQrD,KAAMqD,EAAQpD,QAE3CoD,EAAQuC,QACCvC,EAAQpD,gBAAiBY,OAClCwC,EAAQsC,WAAWtC,EAAQrD,KAAMqD,EAAQpD,QAAQ2F,OAGrDvG,YAAW8E,WAAa,QAExB5D,QAAQlB,WAAaA;;AGVrB,GAAIiN,cAAe,SAAStF,EAAQC,EAAQL,EAAQC,GAClD,MAAOG,GAAOJ,KAAYK,EAAOJ,IAG/B0F,aAAe,SAASvF,EAAQC,EAAQF,EAAO1D,GACjD,GAEImJ,GAAGC,EAFH9E,EAAOX,EAAOnF,OACd+F,EAAOX,EAAOpF,OAId6K,GAAU/E,EAAO,EACrB,KAAK6E,EAAI,EAAO7E,EAAO,EAAX6E,EAAcA,IAExB,IADAE,EAAOF,IAAM5E,EAAO,GACf6E,EAAI,EAAO7E,EAAO,EAAX6E,EAAcA,IACxBC,EAAOF,GAAGC,GAAK,CAKnB,KAFAC,EAAO3F,MAAQA,EAEVyF,EAAI,EAAO7E,EAAO,EAAX6E,EAAcA,IACxB,IAAKC,EAAI,EAAO7E,EAAO,EAAX6E,EAAcA,IAEtBC,EAAOF,GAAGC,GADR1F,EAAMC,EAAQC,EAAQuF,EAAI,EAAGC,EAAI,EAAGpJ,GACvBqJ,EAAOF,EAAI,GAAGC,EAAI,GAAK,EAEvBE,KAAKC,IAAIF,EAAOF,EAAI,GAAGC,GAAIC,EAAOF,GAAGC,EAAI,GAI9D,OAAOC,IAGLG,UAAY,SAASH,EAAQ1F,EAAQC,EAAQL,EAAQC,EAAQxD,GAC/D,GAAe,IAAXuD,GAA2B,IAAXC,EAClB,OACEiG,YACA5E,YACAK,YAIJ,IAAImE,EAAO3F,MAAMC,EAAQC,EAAQL,EAAS,EAAGC,EAAS,EAAGxD,GAAU,CACjE,GAAI0J,GAAcF,UAAUH,EAAQ1F,EAAQC,EAAQL,EAAS,EAAGC,EAAS,EAAGxD,EAI5E,OAHA0J,GAAYD,SAAS9K,KAAKgF,EAAOJ,EAAS,IAC1CmG,EAAY7E,SAASlG,KAAK4E,EAAS,GACnCmG,EAAYxE,SAASvG,KAAK6E,EAAS,GAC5BkG,EAGT,MAAIL,GAAO9F,GAAQC,EAAS,GAAK6F,EAAO9F,EAAS,GAAGC,GAC3CgG,UAAUH,EAAQ1F,EAAQC,EAAQL,EAAQC,EAAS,EAAGxD,GAEtDwJ,UAAUH,EAAQ1F,EAAQC,EAAQL,EAAS,EAAGC,EAAQxD,IAI7D2E,IAAM,SAAShB,EAAQC,EAAQF,EAAO1D,GACxCA,EAAUA,KACV,IAAIqJ,GAASH,aAAavF,EAAQC,EAAQF,GAASuF,aAAcjJ,GAC7DO,EAASiJ,UAAUH,EAAQ1F,EAAQC,EAAQD,EAAOnF,OAAQoF,EAAOpF,OAAQwB,EAI7E,OAHsB,gBAAX2D,IAAyC,gBAAXC,KACvCrD,EAAOkJ,SAAWlJ,EAAOkJ,SAASZ,KAAK,KAElCtI,EAGTrD,SAAQyH,IAAMA;;ALzEd,GAAI1J,aAAcF,QAAQ,oBAAoBE,YAC1CC,aAAeH,QAAQ,qBAAqBG,aAC5CC,eAAiBJ,QAAQ,uBAAuBI,eAEhDY,0BAA4B,SAAmCiE,GACjE,GAAKA,GAAYA,EAAQ4C,SAAzB,CAMA,IAAK,GAFDC,GADArE,EAASwB,EAAQ4C,SAASpE,OAE1B+B,EAASP,EAAQO,OACZI,EAAQ,EAAWnC,EAARmC,EAAgBA,IAClCkC,EAAQ7C,EAAQ4C,SAASjC,GACG,mBAAjBkC,GAAMtC,SAGjBA,EAASA,MACTA,EAAOsC,EAAMC,WAAaD,EAAMtC,OAE9BA,IAAUP,EAAQ0C,cACpBnC,EAAOwC,GAAK,KAEd/C,EAAQsC,UAAU/B,GAAQgC,QAE5BxG,2BAA0B+E,WAAa,iBAEvC,IAAI7E,mBAAoB,SAA2B+D,GACjD,IAAIA,EAAQ0C,aAAoC,WAArB1C,EAAQwC,SAAnC,CAIA,GAAI1C,GAAM+C,CACV,KAAK/C,IAAQE,GAAQrD,KACnBkG,EAAQ,GAAI5H,aAAY+E,EAAQrD,KAAKmD,GAAOE,EAAQpD,MAAMkD,IAC1DE,EAAQrB,KAAKkE,EAAO/C,EAEtB,KAAKA,IAAQE,GAAQpD,MACe,mBAAvBoD,GAAQrD,KAAKmD,KACtB+C,EAAQ,GAAI5H,aAAYuF,OAAWR,EAAQpD,MAAMkD,IACjDE,EAAQrB,KAAKkE,EAAO/C,GAIxB,OAAKE,GAAQ4C,UAAwC,IAA5B5C,EAAQ4C,SAASpE,WAI1CwB,GAAQuC,WAHNvC,GAAQsC,UAAU9B,QAAW+B,QAKjCtG,mBAAkB6E,WAAa,SAE/B,IAAI1E,aAAc,SAA2B4D,GAC3C,GAAKA,EAAQ3E,SAGT2E,EAAQjD,MAAMgG,GAAlB,CAGA,GAAIjD,GAAM+C,CACV,KAAK/C,IAAQE,GAAQjD,MACnB8F,EAAQ,GAAI3H,cAAa8E,EAAQrD,KAAKmD,GAAOE,EAAQjD,MAAM+C,IAC3DE,EAAQrB,KAAKkE,EAAO/C,EAEtBE,GAAQuC,QAEVnG,aAAY0E,WAAa,SAEzB,IAAI3E,4BAA6B,SAAoC6D,GACnE,GAAKA,GAAYA,EAAQ4C,WAGrB5C,EAAQjD,MAAMgG,GAAlB,CAKA,IAAK,GADDF,GADArE,EAASwB,EAAQ4C,SAASpE,OAErBmC,EAAQ,EAAWnC,EAARmC,EAAgBA,IAClCkC,EAAQ7C,EAAQ4C,SAASjC,GACrBX,EAAQrD,KAAKqG,eAAeH,EAAMC,YAA+BtC,SAAjBqC,EAAMtC,aACjDP,GAAQrD,KAAKkG,EAAMC,WACjB9C,EAAQrD,KAAKkG,EAAMC,aAAeD,EAAMtC,SACjDP,EAAQrD,KAAKkG,EAAMC,WAAaD,EAAMtC,OAG1CP,GAAQsC,UAAUtC,EAAQrD,MAAM4F,QAElCpG,4BAA2B2E,WAAa,iBAExC,IAAIxE,eAAgB,SAA6B0D,GAC/C,GAAKA,EAAQ3E,SAGT2E,EAAQjD,MAAMgG,GAAlB,CAGA,GAAIjD,GAAM+C,CACV,KAAK/C,IAAQE,GAAQjD,MACnB8F,EAAQ,GAAI1H,gBAAe6E,EAAQjD,MAAM+C,IACzCE,EAAQrB,KAAKkE,EAAO/C,EAEtBE,GAAQuC,QAEVjG,eAAcwE,WAAa,SAE3B,IAAIzE,8BAA+B,SAAsC2D,GACvE,GAAKA,GAAYA,EAAQ4C,WAGrB5C,EAAQjD,MAAMgG,GAAlB,CAMA,IAAK,GAFDF,GADArE,EAASwB,EAAQ4C,SAASpE,OAE1BzB,KACK4D,EAAQ,EAAWnC,EAARmC,EAAgBA,IAClCkC,EAAQ7C,EAAQ4C,SAASjC,GACrB5D,EAAM8F,EAAMC,aAAeD,EAAMtC,SACnCxD,EAAM8F,EAAMC,WAAaD,EAAMtC,OAGnCP,GAAQsC,UAAUvF,GAAOwF,QAE3BlG,8BAA6ByE,WAAa,kBAE1C5D,QAAQnB,0BAA4BA,0BACpCmB,QAAQjB,kBAAoBA,kBAC5BiB,QAAQd,YAAcA,YACtBc,QAAQf,2BAA6BA,2BACrCe,QAAQZ,cAAgBA,cACxBY,QAAQb,6BAA+BA;;AGhIvC,GAAIwK,WAAY,EACZC,mBAAqB,GACrBC,gBAAkB,KAElBC,kBAAoB,WAGtB,IAAKD,gBAAiB,CACpB,GAAIE,EACJ,IAAgC,mBAArBC,kBAETD,EAAuC,kBAArBC,kBAChB,GAAIA,kBAAqB,GAAIA,kBAAiBA,qBAC3C,IAAuB,kBAAZnM,SAChB,IACE,GAAIoM,GAAgB,gCAChBC,EAAMrM,QAAQ,yBAA2BoM,EAC7CF,GAAW,GAAIG,GAAIF,iBACnB,MAAOG,GACPJ,EAAW,KAGf,IAAKA,EAAU,CACb,GAAIhF,GAAQ,GAAIxC,OAAM,0CAEtB,MADAwC,GAAMqF,4BAA6B,EAC7BrF,EAER8E,iBACErK,KAAM,SAAS6K,EAAMC,GACnB,MAAOP,GAASQ,aAAaR,EAASS,WAAWH,EAAMC,KAEzD1K,MAAO,SAASyK,EAAMzK,GAEpB,IAAK,GADD6K,GAAUV,EAASW,YAAYX,EAASY,eAAe/K,GAAQyK,GAC1DjE,EAAI,EAAGA,EAAIqE,EAAQ,GAAGnJ,OAAQ8E,IACrC,IAAKqE,EAAQ,GAAGrE,GAAI,CAClB,GAAIrB,GAAQ,GAAIxC,OAAM,oBACtBwC,GAAM6F,iBAAkB,EAG5B,MAAOH,GAAQ,KAIrB,MAAOZ,kBAGL/K,WAAa,SAAyBgE,GACxC,GAAyB,WAArBA,EAAQwC,SAAZ,CAGA,GAAIuF,GAAa/H,EAAQtE,SAAWsE,EAAQtE,QAAQsM,UAClDhI,EAAQtE,QAAQsM,SAASD,WAAcjB,kBACzC,IAAI9G,EAAQrD,KAAK6B,OAASuJ,GACxB/H,EAAQpD,MAAM4B,OAASuJ,EAEvB,WADA/H,GAAQsC,WAAWtC,EAAQrD,KAAMqD,EAAQpD,QAAQ2F,MAInD,IAAI7F,GAAOsK,oBAAoBtK,IAC/BsD,GAAQsC,WAAW5F,EAAKsD,EAAQrD,KAAMqD,EAAQpD,OAAQ,EAAGiK,YAAYtE,QAEvEvG,YAAW8E,WAAa,OAExB,IAAI1E,aAAc,SAA0B4D,GAC1C,IAAIA,EAAQ3E,QAGR2E,EAAQjD,MAAM,KAAO8J,UAAzB,CAKA,GAAI/J,GAAQkK,oBAAoBlK,KAChCkD,GAAQsC,UAAUxF,EAAMkD,EAAQrD,KAAMqD,EAAQjD,MAAM,KAAKwF,QAE3DnG,aAAY0E,WAAa,OAEzB,IAAImH,kBAAmB,SAASlL,GAC9B,GAAIuG,GAAG4E,EAAGC,EAAOC,EAAMC,EAErBC,EAAYC,EAASC,EAFSC,EAAS,KACvCC,EAAc,wCAGhB,KADAP,EAAQpL,EAAM4L,MAAM,MACfrF,EAAI,EAAG4E,EAAIC,EAAM3J,OAAY0J,EAAJ5E,EAAOA,IAAK,CACxC8E,EAAOD,EAAM7E,EACb,IAAIsF,GAAYR,EAAKzG,MAAM,EAAG,EACZ,OAAdiH,GACFH,EAASC,EAAYnL,KAAK6K,GAC1BE,EAAahF,EACbiF,EAAU,KACVC,EAAa,KAGbL,EAAMG,GAAc,OAASG,EAAO,GAAK,IAAMA,EAAO,GAAK,KAAOA,EAAO,GAAK,IAAMA,EAAO,GAAK,OACzE,MAAdG,GACTL,EAAUjF,EACV6E,EAAM7E,GAAK,IAAM6E,EAAM7E,GAAG3B,MAAM,GACC,MAA7BwG,EAAM7E,EAAI,GAAG3B,MAAM,EAAG,KAExB0G,EAAUF,EAAM7E,GAChB6E,EAAM7E,GAAK6E,EAAM7E,EAAI,GACrB6E,EAAM7E,EAAI,GAAK+E,IAEM,MAAdO,IACTJ,EAAalF,EACb6E,EAAM7E,GAAK,IAAM6E,EAAM7E,GAAG3B,MAAM,IAGpC,MAAOwG,GAAMU,KAAK,OAGhBvM,cAAgB,SAA4B0D,GAC1CA,EAAQ3E,QAGR2E,EAAQjD,MAAM,KAAO8J,WAKzB7G,EAAQsC,WAAW2F,iBAAiBjI,EAAQjD,MAAM,IAAK,EAAG8J,YAAYtE,OAExEjG,eAAcwE,WAAa,QAE3B5D,QAAQlB,WAAaA,WACrBkB,QAAQd,YAAcA,YACtBc,QAAQZ,cAAgBA;;AJ9HxB,GAAI8F,SAAoC,kBAAlBV,OAAMU,QAE1BV,MAAMU,QAEN,SAASC,GACP,MAAOA,aAAaX,QAGpB1F,WAAa,SAAkCgE,GACjD,GAAIA,EAAQrD,OAASqD,EAAQpD,MAE3B,WADAoD,GAAQsC,UAAU9B,QAAW+B,MAG/B,IAA4B,mBAAjBvC,GAAQrD,KAAsB,CACvC,GAA6B,kBAAlBqD,GAAQpD,MACjB,KAAM,IAAI6C,OAAM,8BAGlB,YADAO,GAAQsC,WAAWtC,EAAQpD,QAAQ2F,OAGrC,GAA6B,mBAAlBvC,GAAQpD,MAEjB,WADAoD,GAAQsC,WAAWtC,EAAQrD,KAAM,EAAG,IAAI4F,MAG1C,IAA4B,kBAAjBvC,GAAQrD,MAAgD,kBAAlBqD,GAAQpD,MACvD,KAAM,IAAI6C,OAAM,8BAIlB,OAFAO,GAAQwC,SAA4B,OAAjBxC,EAAQrD,KAAgB,aAAgBqD,GAAQrD,KACnEqD,EAAQyC,UAA8B,OAAlBzC,EAAQpD,MAAiB,aAAgBoD,GAAQpD,MACjEoD,EAAQwC,WAAaxC,EAAQyC,cAC/BzC,GAAQsC,WAAWtC,EAAQrD,KAAMqD,EAAQpD,QAAQ2F,OAG1B,YAArBvC,EAAQwC,UAA+C,WAArBxC,EAAQwC,aAC5CxC,GAAQsC,WAAWtC,EAAQrD,KAAMqD,EAAQpD,QAAQ2F,QAG1B,WAArBvC,EAAQwC,WACVxC,EAAQ0C,YAAcN,QAAQpC,EAAQrD,OAEd,WAAtBqD,EAAQyC,YACVzC,EAAQ2C,aAAeP,QAAQpC,EAAQpD,QAErCoD,EAAQ0C,cAAgB1C,EAAQ2C,iBAClC3C,GAAQsC,WAAWtC,EAAQrD,KAAMqD,EAAQpD,QAAQ2F,OADnD,QAKFvG,YAAW8E,WAAa,SAExB,IAAI1E,aAAc,SAAmC4D,GACnD,MAA6B,mBAAlBA,GAAQjD,UACjBiD,GAAQsC,UAAUtC,EAAQrD,MAAM4F,QAGlCvC,EAAQ3E,QAAU+G,QAAQpC,EAAQjD,OAC9BiD,EAAQ3E,OAAZ,OAG6B,IAAzB2E,EAAQjD,MAAMyB,WAChBwB,GAAQsC,UAAUtC,EAAQjD,MAAM,IAAIwF,OAGT,IAAzBvC,EAAQjD,MAAMyB,WAChBwB,GAAQsC,UAAUtC,EAAQjD,MAAM,IAAIwF,OAGT,IAAzBvC,EAAQjD,MAAMyB,QAAqC,IAArBwB,EAAQjD,MAAM,OAC9CiD,GAAQsC,UAAU9B,QAAW+B,OAD/B,QAKFnG,aAAY0E,WAAa,SAEzB,IAAIxE,eAAgB,SAA8B0D,GAChD,MAA6B,mBAAlBA,GAAQjD,UACjBiD,GAAQsC,UAAUtC,EAAQjD,OAAOwF,QAGnCvC,EAAQ3E,QAAU+G,QAAQpC,EAAQjD,OAC9BiD,EAAQ3E,OAAZ,OAG6B,IAAzB2E,EAAQjD,MAAMyB,WAChBwB,GAAQsC,WAAWtC,EAAQjD,MAAM,GAAI,EAAG,IAAIwF,OAGjB,IAAzBvC,EAAQjD,MAAMyB,WAChBwB,GAAQsC,WAAWtC,EAAQjD,MAAM,GAAIiD,EAAQjD,MAAM,KAAKwF,OAG7B,IAAzBvC,EAAQjD,MAAMyB,QAAqC,IAArBwB,EAAQjD,MAAM,OAC9CiD,GAAQsC,WAAWtC,EAAQjD,MAAM,KAAKwF,OADxC,QAKFjG,eAAcwE,WAAa,UAE3B5D,QAAQlB,WAAaA,WACrBkB,QAAQd,YAAcA,YACtBc,QAAQZ,cAAgBA;;AJpGxB,GAAItB,MAAO,SAAc8E,GACvBnE,KAAKmE,KAAOA,EACZnE,KAAK8E,WAGPzF,MAAKuB,UAAUM,QAAU,SAASkD,GAChC,IAAKpE,KAAKC,UACR,KAAM,IAAI6D,OAAM,+CAKlB,KAAK,GAHDiB,GAAQ/E,KAAK+E,MACblC,EAAS7C,KAAK8E,QAAQjC,OACtBwB,EAAUD,EACLY,EAAQ,EAAWnC,EAARmC,EAAgBA,IAAS,CAC3C,GAAIC,GAASjF,KAAK8E,QAAQE,EAK1B,IAJID,GACF/E,KAAKkF,IAAI,WAAaD,EAAOE,YAE/BF,EAAOZ,GACgB,gBAAZA,IAAwBA,EAAQe,QAAS,CAClDf,EAAQe,SAAU,CAClB,SAGCf,EAAQK,MAAQ1E,KAAKqF,aACxBrF,KAAKqF,YAAYhB,IAIrBhF,KAAKuB,UAAUsE,IAAM,SAASI,GAC5BC,QAAQL,IAAI,mBAAqBlF,KAAKmE,KAAO,UAAYmB,IAG3DjG,KAAKuB,UAAUT,OAAS,WAEtB,MADAH,MAAK8E,QAAQ9B,KAAKnC,MAAMb,KAAK8E,QAAShE,WAC/Bd,MAGTX,KAAKuB,UAAU4E,QAAU,WAEvB,MADAxF,MAAK8E,QAAQW,QAAQ5E,MAAMb,KAAK8E,QAAShE,WAClCd,MAGTX,KAAKuB,UAAU8E,QAAU,SAASP,GAChC,IAAKA,EACH,KAAM,IAAIrB,OAAM,4BAElB,KAAK,GAAIkB,GAAQ,EAAGA,EAAQhF,KAAK8E,QAAQjC,OAAQmC,IAAS,CACxD,GAAIC,GAASjF,KAAK8E,QAAQE,EAC1B,IAAIC,EAAOE,aAAeA,EACxB,MAAOH,GAGX,KAAM,IAAIlB,OAAM,qBAAuBqB,IAGzC9F,KAAKuB,UAAU+E,KAAO,WAEpB,IAAK,GADDC,MACKZ,EAAQ,EAAGA,EAAQhF,KAAK8E,QAAQjC,OAAQmC,IAAS,CACxD,GAAIC,GAASjF,KAAK8E,QAAQE,EAC1BY,GAAM5C,KAAKiC,EAAOE,YAEpB,MAAOS,IAGTvG,KAAKuB,UAAUiF,MAAQ,SAASV,GAC9B,GAAIH,GAAQhF,KAAK0F,QAAQP,GACrBW,EAASC,MAAMnF,UAAUoF,MAAMC,KAAKnF,UAAW,EACnD,KAAKgF,EAAOjD,OACV,KAAM,IAAIiB,OAAM,uBAIlB,OAFAgC,GAAOL,QAAQT,EAAQ,EAAG,GAC1Be,MAAMnF,UAAUsF,OAAOrF,MAAMb,KAAK8E,QAASgB,GACpC9F,MAGTX,KAAKuB,UAAUuF,OAAS,SAAShB,GAC/B,GAAIH,GAAQhF,KAAK0F,QAAQP,GACrBW,EAASC,MAAMnF,UAAUoF,MAAMC,KAAKnF,UAAW,EACnD,KAAKgF,EAAOjD,OACV,KAAM,IAAIiB,OAAM,uBAIlB,OAFAgC,GAAOL,QAAQT,EAAO,GACtBe,MAAMnF,UAAUsF,OAAOrF,MAAMb,KAAK8E,QAASgB,GACpC9F,MAGTX,KAAKuB,UAAUwF,MAAQ,WAErB,MADApG,MAAK8E,QAAQjC,OAAS,EACf7C,MAGTX,KAAKuB,UAAUL,iBAAmB,SAAS8F,GACzC,GAAIA,KAAW,EAEb,YADArG,KAAKqF,YAAc,KAGrB,KAAIrF,KAAKqF,YAAT,CAGA,GAAInF,GAAOF,IASX,OARAA,MAAKqF,YAAc,SAAShB,GAC1B,IAAKA,EAAQM,UAAW,CACtBY,QAAQL,IAAIb,EACZ,IAAIiC,GAAQ,GAAIxC,OAAM5D,EAAKiE,KAAO,UAElC,MADAmC,GAAMC,UAAW,EACXD,IAGHtG,OAGTuB,QAAQlC,KAAOA;;AD9Gf,GAAIF,WAAY,SAAmBY,GAClCC,KAAKiE,YAAclE,EACnBC,KAAKkE,SAGN/E,WAAUyB,UAAUb,QAAU,SAASA,GAItC,MAHIA,KACHC,KAAKiE,YAAclE,GAEbC,KAAKiE,aAGb9E,UAAUyB,UAAUV,KAAO,SAASiE,EAAMjE,GACzC,GAAoB,gBAATiE,GAAmB,CAC7B,GAAoB,mBAATjE,GACV,MAAOF,MAAKkE,MAAMC,EAElBnE,MAAKkE,MAAMC,GAAQjE,EAGrB,GAAIiE,GAAQA,EAAKA,KAAM,CAEtB,GADAjE,EAAOiE,EACHjE,EAAKD,YAAcD,KAAQ,MAAOE,EACtCF,MAAKkE,MAAMhE,EAAKiE,MAAQjE,EAGzB,MADAA,GAAKD,UAAYD,KACVE,GAGRf,UAAUyB,UAAUM,QAAU,SAASkD,EAAOlE,GAC7C,GAAImE,GAAUD,CACdC,GAAQtE,QAAUC,KAAKD,SAGvB,KAFA,GACIuE,GAAUC,EADVC,EAAWtE,GAAQkE,EAAMlE,MAAQ,UAE9BsE,GACmC,mBAA9BH,GAAQI,oBAElBJ,EAAQK,KAAOL,EAAQI,kBACvBJ,EAAQI,kBAAoB,MAGL,gBAAbD,KACVA,EAAWxE,KAAKE,KAAKsE,IAEtBA,EAAStD,QAAQmD,GACjBE,EAAcF,EACdC,EAAWE,EACXA,EAAW,KACPH,GACCA,EAAQK,OACXL,EAAUA,EAAQK,KAClBF,EAAWD,EAAYC,UAAYH,EAAQnE,MAAQoE,EAItD,OAAOD,GAAQM,UAAYN,EAAQO,OAASC,QAG7CtD,QAAQpC,UAAYA","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(e){var r=require(\"./diffpatcher\").DiffPatcher;exports.DiffPatcher=r,exports.create=function(e){return new r(e)},exports.dateReviver=require(\"./date-reviver\");var t;if(exports.diff=function(){return t||(t=new r),t.diff.apply(t,arguments)},exports.patch=function(){return t||(t=new r),t.patch.apply(t,arguments)},exports.unpatch=function(){return t||(t=new r),t.unpatch.apply(t,arguments)},exports.reverse=function(){return t||(t=new r),t.reverse.apply(t,arguments)},e.browser)exports.homepage=\"{{package-homepage}}\",exports.version=\"{{package-version}}\";else{var o=\"../package.json\",a=require(o);exports.homepage=a.homepage,exports.version=a.version;var n=\"./formatters\",p=require(n);exports.formatters=p,exports.console=p.console}}).call(this,require(\"_process\"));","var Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options) {\n  this.processor = new Processor(options);\n  this.processor.pipe(new Pipe('diff').append(\n    nested.collectChildrenDiffFilter,\n    trivial.diffFilter,\n    dates.diffFilter,\n    texts.diffFilter,\n    nested.objectsDiffFilter,\n    arrays.diffFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('patch').append(\n    nested.collectChildrenPatchFilter,\n    arrays.collectChildrenPatchFilter,\n    trivial.patchFilter,\n    texts.patchFilter,\n    nested.patchFilter,\n    arrays.patchFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('reverse').append(\n    nested.collectChildrenReverseFilter,\n    arrays.collectChildrenReverseFilter,\n    trivial.reverseFilter,\n    texts.reverseFilter,\n    nested.reverseFilter,\n    arrays.reverseFilter\n  ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n  return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n  return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n  return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n  return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n  return this.patch(right, this.reverse(delta));\n};\n\nexports.DiffPatcher = DiffPatcher;\n","// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n  var parts;\n  if (typeof value === 'string') {\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n    if (parts) {\n      return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3], +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n    }\n  }\n  return value;\n};\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","\nvar Processor = function Processor(options){\n\tthis.selfOptions = options;\n\tthis.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n\tif (options) {\n\t\tthis.selfOptions = options;\n\t}\n\treturn this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n\tif (typeof name === 'string') {\n\t\tif (typeof pipe === 'undefined') {\n\t\t\treturn this.pipes[name];\n\t\t} else {\n\t\t\tthis.pipes[name] = pipe;\n\t\t}\n\t}\n\tif (name && name.name) {\n\t\tpipe = name;\n\t\tif (pipe.processor === this) { return pipe; }\n\t\tthis.pipes[pipe.name] = pipe;\n\t}\n\tpipe.processor = this;\n\treturn pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n\tvar context = input;\n\tcontext.options = this.options();\n\tvar nextPipe = pipe || input.pipe || 'default';\n\tvar lastPipe, lastContext;\n\twhile (nextPipe) {\n\t\tif (typeof context.nextAfterChildren !== 'undefined') {\n\t\t\t// children processed and coming back to parent\n\t\t\tcontext.next = context.nextAfterChildren;\n\t\t\tcontext.nextAfterChildren = null;\n\t\t}\n\n\t\tif (typeof nextPipe === 'string') {\n\t\t\tnextPipe = this.pipe(nextPipe);\n\t\t}\n\t\tnextPipe.process(context);\n\t\tlastContext = context;\n\t\tlastPipe = nextPipe;\n\t\tnextPipe = null;\n\t\tif (context) {\n\t\t\tif (context.next) {\n\t\t\t\tcontext = context.next;\n\t\t\t\tnextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n\t\t\t}\n\t\t}\n\t}\n\treturn context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n","var Pipe = function Pipe(name) {\n  this.name = name;\n  this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n  if (!this.processor) {\n    throw new Error('add this pipe to a processor before using it');\n  }\n  var debug = this.debug;\n  var length = this.filters.length;\n  var context = input;\n  for (var index = 0; index < length; index++) {\n    var filter = this.filters[index];\n    if (debug) {\n      this.log('filter: ' + filter.filterName);\n    }\n    filter(context);\n    if (typeof context === 'object' && context.exiting) {\n      context.exiting = false;\n      break;\n    }\n  }\n  if (!context.next && this.resultCheck) {\n    this.resultCheck(context);\n  }\n};\n\nPipe.prototype.log = function(msg) {\n  console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n  this.filters.push.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.prepend = function() {\n  this.filters.unshift.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n  if (!filterName) {\n    throw new Error('a filter name is required');\n  }\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    if (filter.filterName === filterName) {\n      return index;\n    }\n  }\n  throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n  var names = [];\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    names.push(filter.filterName);\n  }\n  return names;\n};\n\nPipe.prototype.after = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index + 1, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.before = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.clear = function() {\n  this.filters.length = 0;\n  return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n  if (should === false) {\n    this.resultCheck = null;\n    return;\n  }\n  if (this.resultCheck) {\n    return;\n  }\n  var pipe = this;\n  this.resultCheck = function(context) {\n    if (!context.hasResult) {\n      console.log(context);\n      var error = new Error(pipe.name + ' failed');\n      error.noResult = true;\n      throw error;\n    }\n  };\n  return this;\n};\n\nexports.Pipe = Pipe;\n","var Context = require('./context').Context;\n\nvar DiffContext = function DiffContext(left, right) {\n  this.left = left;\n  this.right = right;\n  this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nexports.DiffContext = DiffContext;\n","var Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta) {\n  this.left = left;\n  this.delta = delta;\n  this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;\n","var Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta) {\n  this.delta = delta;\n  this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;\n","var isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n  if (context.left === context.right) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  if (typeof context.left === 'undefined') {\n    if (typeof context.right === 'function') {\n      throw new Error('functions are not supported');\n    }\n    context.setResult([context.right]).exit();\n    return;\n  }\n  if (typeof context.right === 'undefined') {\n    context.setResult([context.left, 0, 0]).exit();\n    return;\n  }\n  if (typeof context.left === 'function' || typeof context.right === 'function') {\n    throw new Error('functions are not supported');\n  }\n  context.leftType = context.left === null ? 'null' : typeof context.left;\n  context.rightType = context.right === null ? 'null' : typeof context.right;\n  if (context.leftType !== context.rightType) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'object') {\n    context.leftIsArray = isArray(context.left);\n  }\n  if (context.rightType === 'object') {\n    context.rightIsArray = isArray(context.right);\n  }\n  if (context.leftIsArray !== context.rightIsArray) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult(context.delta[0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult(context.delta[1]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.delta).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult([context.delta[0], 0, 0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult([context.delta[1], context.delta[0]]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult([context.delta[0]]).exit();\n    return;\n  }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var result = context.result;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (typeof child.result === 'undefined') {\n      continue;\n    }\n    result = result || {};\n    result[child.childName] = child.result;\n  }\n  if (result && context.leftIsArray) {\n    result._t = 'a';\n  }\n  context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n  if (context.leftIsArray || context.leftType !== 'object') {\n    return;\n  }\n\n  var name, child;\n  for (name in context.left) {\n    child = new DiffContext(context.left[name], context.right[name]);\n    context.push(child, name);\n  }\n  for (name in context.right) {\n    if (typeof context.left[name] === 'undefined') {\n      child = new DiffContext(undefined, context.right[name]);\n      context.push(child, name);\n    }\n  }\n\n  if (!context.children || context.children.length === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new PatchContext(context.left[name], context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (context.left.hasOwnProperty(child.childName) && child.result === undefined) {\n      delete context.left[child.childName];\n    } else if (context.left[child.childName] !== child.result) {\n      context.left[child.childName] = child.result;\n    }\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {};\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (delta[child.childName] !== child.result) {\n      delta[child.childName] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n  function(array, item) {\n    return array.indexOf(item);\n  } : function(array, item) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\nvar diffFilter = function arraysDiffFilter(context) {\n  if (!context.leftIsArray) {\n    return;\n  }\n\n  var objectHash = context.options && context.options.objectHash;\n\n  var match = function(array1, array2, index1, index2, context) {\n    var value1 = array1[index1];\n    var value2 = array2[index2];\n    if (value1 === value2) {\n      return true;\n    }\n    if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n      return false;\n    }\n    if (!objectHash) {\n      return false;\n    }\n    var hash1, hash2;\n    if (typeof index1 === 'number') {\n      context.hashCache1 = context.hashCache1 || [];\n      hash1 = context.hashCache1[index1];\n      if (typeof hash1 === 'undefined') {\n        context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n      }\n    } else {\n      hash1 = objectHash(value1);\n    }\n    if (typeof hash1 === 'undefined') {\n      return false;\n    }\n    if (typeof index2 === 'number') {\n      context.hashCache2 = context.hashCache2 || [];\n      hash2 = context.hashCache2[index2];\n      if (typeof hash2 === 'undefined') {\n        context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n      }\n    } else {\n      hash2 = objectHash(value2);\n    }\n    if (typeof hash2 === 'undefined') {\n      return false;\n    }\n    return hash1 === hash2;\n  };\n\n  var matchContext = {};\n  var commonHead = 0,\n    commonTail = 0,\n    index, index1, index2;\n  var array1 = context.left;\n  var array2 = context.right;\n  var len1 = array1.length;\n  var len2 = array2.length;\n\n  var child;\n\n  // separate common head\n  while (commonHead < len1 && commonHead < len2 &&\n    match(array1, array2, commonHead, commonHead, matchContext)) {\n    index = commonHead;\n    child = new DiffContext(context.left[index], context.right[index]);\n    context.push(child, index);\n    commonHead++;\n  }\n  // separate common tail\n  while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n    match(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n    index1 = len1 - 1 - commonTail;\n    index2 = len2 - 1 - commonTail;\n    child = new DiffContext(context.left[index1], context.right[index2]);\n    context.push(child, index2);\n    commonTail++;\n  }\n  var result;\n  if (commonHead + commonTail === len1) {\n    if (len1 === len2) {\n      // arrays are identical\n      context.setResult(undefined).exit();\n      return;\n    }\n    // trivial case, a block (1 or more consecutive items) was added\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len2 - commonTail; index++) {\n      result[index] = [array2[index]];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  if (commonHead + commonTail === len2) {\n    // trivial case, a block (1 or more consecutive items) was removed\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n      result['_' + index] = [array1[index], 0, 0];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  // reset hash cache\n  matchContext = {};\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\n  var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n  var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n  var seq = lcs.get(\n    trimmed1, trimmed2,\n    match,\n    matchContext\n  );\n  var removedItems = [];\n  result = result || {\n    _t: 'a'\n  };\n  for (index = commonHead; index < len1 - commonTail; index++) {\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n      // removed\n      result['_' + index] = [array1[index], 0, 0];\n      removedItems.push(index);\n    }\n  }\n\n  var detectMove = true;\n  if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n    detectMove = false;\n  }\n  var includeValueOnMove = false;\n  if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n    includeValueOnMove = true;\n  }\n\n  var removedItemsLength = removedItems.length;\n  for (index = commonHead; index < len2 - commonTail; index++) {\n    var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n    if (indexOnArray2 < 0) {\n      // added, try to match with a removed item and register as position move\n      var isMove = false;\n      if (detectMove && removedItemsLength > 0) {\n        for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n          index1 = removedItems[removeItemIndex1];\n          if (match(trimmed1, trimmed2, index1 - commonHead,\n            index - commonHead, matchContext)) {\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n            result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n            if (!includeValueOnMove) {\n              // don't include moved value on diff, to save bytes\n              result['_' + index1][0] = '';\n            }\n\n            index2 = index;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n            removedItems.splice(removeItemIndex1, 1);\n            isMove = true;\n            break;\n          }\n        }\n      }\n      if (!isMove) {\n        // added\n        result[index] = [array2[index]];\n      }\n    } else {\n      // match, do inner diff\n      index1 = seq.indices1[indexOnArray2] + commonHead;\n      index2 = seq.indices2[indexOnArray2] + commonHead;\n      child = new DiffContext(context.left[index1], context.right[index2]);\n      context.push(child, index2);\n    }\n  }\n\n  context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n  numerically: function(a, b) {\n    return a - b;\n  },\n  numericallyBy: function(name) {\n    return function(a, b) {\n      return a[name] - b[name];\n    };\n  }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var index, index1;\n\n  var delta = context.delta;\n  var array = context.left;\n\n  // first, separate removals, insertions and modifications\n  var toRemove = [];\n  var toInsert = [];\n  var toModify = [];\n  for (index in delta) {\n    if (index !== '_t') {\n      if (index[0] === '_') {\n        // removed item from original array\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n          toRemove.push(parseInt(index.slice(1), 10));\n        } else {\n          throw new Error('only removal or move can be applied at original array indices' +\n            ', invalid diff type: ' + delta[index][2]);\n        }\n      } else {\n        if (delta[index].length === 1) {\n          // added item at new array\n          toInsert.push({\n            index: parseInt(index, 10),\n            value: delta[index][0]\n          });\n        } else {\n          // modified item at new array\n          toModify.push({\n            index: parseInt(index, 10),\n            delta: delta[index]\n          });\n        }\n      }\n    }\n  }\n\n  // remove items, in reverse order to avoid sawing our own floor\n  toRemove = toRemove.sort(compare.numerically);\n  for (index = toRemove.length - 1; index >= 0; index--) {\n    index1 = toRemove[index];\n    var indexDiff = delta['_' + index1];\n    var removedValue = array.splice(index1, 1)[0];\n    if (indexDiff[2] === ARRAY_MOVE) {\n      // reinsert later\n      toInsert.push({\n        index: indexDiff[1],\n        value: removedValue\n      });\n    }\n  }\n\n  // insert items, in reverse order to avoid moving our own floor\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\n  var toInsertLength = toInsert.length;\n  for (index = 0; index < toInsertLength; index++) {\n    var insertion = toInsert[index];\n    array.splice(insertion.index, 0, insertion.value);\n  }\n\n  // apply modifications\n  var toModifyLength = toModify.length;\n  var child;\n  if (toModifyLength > 0) {\n    for (index = 0; index < toModifyLength; index++) {\n      var modification = toModify[index];\n      child = new PatchContext(context.left[modification.index], modification.delta);\n      context.push(child, modification.index);\n    }\n  }\n\n  if (!context.children) {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    context.left[child.childName] = child.result;\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n  if (!context.nested) {\n    if (context.delta[2] === ARRAY_MOVE) {\n      context.newName = '_' + context.delta[1];\n      context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n    }\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    if (name === '_t') {\n      continue;\n    }\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n  var newIndex = index;\n  if (typeof index === 'string' && index[0] === '_') {\n    newIndex = parseInt(index.substr(1), 10);\n  } else {\n    var uindex = '_' + index;\n    if (isArray(itemDelta) && itemDelta[2] === 0) {\n      newIndex = uindex;\n    } else {\n      for (var index2 in delta) {\n        var itemDelta2 = delta[index2];\n        if (isArray(itemDelta2) && itemDelta2[2] === ARRAY_MOVE && itemDelta2[1].toString() === index) {\n          newIndex = index2.substr(1);\n        }\n      }\n    }\n  }\n  return newIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {\n    _t: 'a'\n  };\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    var name = child.newName;\n    if (typeof name === 'undefined') {\n      name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n    }\n    if (delta[name] !== child.result) {\n      delta[name] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var diffFilter = function datesDiffFilter(context) {\n  if (context.left instanceof Date) {\n    if (context.right instanceof Date) {\n      if (context.left.getTime() !== context.right.getTime()) {\n        context.setResult([context.left, context.right]);\n      } else {\n        context.setResult(undefined);\n      }\n    } else {\n      context.setResult([context.left, context.right]);\n    }\n    context.exit();\n  } else if (context.right instanceof Date) {\n    context.setResult([context.left, context.right]).exit();\n  }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;\n","/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function() {\n  /*jshint camelcase: false */\n\n  if (!cachedDiffPatch) {\n    var instance;\n    if (typeof diff_match_patch !== 'undefined') {\n      // already loaded, probably a browser\n      instance = typeof diff_match_patch === 'function' ?\n        new diff_match_patch() : new diff_match_patch.diff_match_patch();\n    } else if (typeof require === 'function') {\n      try {\n        var dmpModuleName = 'diff_match_patch_uncompressed';\n        var dmp = require('../../public/external/' + dmpModuleName);\n        instance = new dmp.diff_match_patch();\n      } catch (err) {\n        instance = null;\n      }\n    }\n    if (!instance) {\n      var error = new Error('text diff_match_patch library not found');\n      error.diff_match_patch_not_found = true;\n      throw error;\n    }\n    cachedDiffPatch = {\n      diff: function(txt1, txt2) {\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\n      },\n      patch: function(txt1, patch) {\n        var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n        for (var i = 0; i < results[1].length; i++) {\n          if (!results[1][i]) {\n            var error = new Error('text patch failed');\n            error.textPatchFailed = true;\n          }\n        }\n        return results[0];\n      }\n    };\n  }\n  return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n  if (context.leftType !== 'string') {\n    return;\n  }\n  var minLength = (context.options && context.options.textDiff &&\n    context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n  if (context.left.length < minLength ||\n    context.right.length < minLength) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  // large text, use a text-diff algorithm\n  var diff = getDiffMatchPatch().diff;\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-patch algorithm\n  var patch = getDiffMatchPatch().patch;\n  context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta) {\n  var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n  lines = delta.split('\\n');\n  for (i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    var lineStart = line.slice(0, 1);\n    if (lineStart === '@') {\n      header = headerRegex.exec(line);\n      lineHeader = i;\n      lineAdd = null;\n      lineRemove = null;\n\n      // fix header\n      lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n    } else if (lineStart === '+') {\n      lineAdd = i;\n      lines[i] = '-' + lines[i].slice(1);\n      if (lines[i - 1].slice(0, 1) === '+') {\n        // swap lines to keep default order (-+)\n        lineTmp = lines[i];\n        lines[i] = lines[i - 1];\n        lines[i - 1] = lineTmp;\n      }\n    } else if (lineStart === '-') {\n      lineRemove = i;\n      lines[i] = '+' + lines[i].slice(1);\n    }\n  }\n  return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-diff algorithm\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;\n","/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n  return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n  var len1 = array1.length;\n  var len2 = array2.length;\n  var x, y;\n\n  // initialize empty matrix of len1+1 x len2+1\n  var matrix = [len1 + 1];\n  for (x = 0; x < len1 + 1; x++) {\n    matrix[x] = [len2 + 1];\n    for (y = 0; y < len2 + 1; y++) {\n      matrix[x][y] = 0;\n    }\n  }\n  matrix.match = match;\n  // save sequence lengths for each coordinate\n  for (x = 1; x < len1 + 1; x++) {\n    for (y = 1; y < len2 + 1; y++) {\n      if (match(array1, array2, x - 1, y - 1, context)) {\n        matrix[x][y] = matrix[x - 1][y - 1] + 1;\n      } else {\n        matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n      }\n    }\n  }\n  return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n  if (index1 === 0 || index2 === 0) {\n    return {\n      sequence: [],\n      indices1: [],\n      indices2: []\n    };\n  }\n\n  if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n    var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n    subsequence.sequence.push(array1[index1 - 1]);\n    subsequence.indices1.push(index1 - 1);\n    subsequence.indices2.push(index2 - 1);\n    return subsequence;\n  }\n\n  if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n    return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n  } else {\n    return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n  }\n};\n\nvar get = function(array1, array2, match, context) {\n  context = context || {};\n  var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n  var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\n    result.sequence = result.sequence.join('');\n  }\n  return result;\n};\n\nexports.get = get;\n"]}