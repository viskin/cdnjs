{"version":3,"file":"bundle.js","sources":["/source-files/jsondiffpatch/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/jsondiffpatch/src/main.js","/source-files/jsondiffpatch/src/date-reviver.js","/source-files/jsondiffpatch/src/diffpatcher.js","/source-files/jsondiffpatch/node_modules/fiberglass/node_modules/browserify/node_modules/process/browser.js","/source-files/jsondiffpatch/src/processor.js","/source-files/jsondiffpatch/src/pipe.js","/source-files/jsondiffpatch/src/contexts/diff.js","/source-files/jsondiffpatch/src/contexts/patch.js","/source-files/jsondiffpatch/src/contexts/reverse.js","/source-files/jsondiffpatch/src/filters/trivial.js","/source-files/jsondiffpatch/src/filters/nested.js","/source-files/jsondiffpatch/src/filters/arrays.js","/source-files/jsondiffpatch/src/filters/dates.js","/source-files/jsondiffpatch/src/filters/texts.js","/source-files/jsondiffpatch/src/contexts/context.js","/source-files/jsondiffpatch/src/filters/lcs.js"],"names":["module","exports","key","value","parts","exec","Date","UTC","Processor","require","Pipe","DiffContext","PatchContext","ReverseContext","trivial","nested","arrays","dates","texts","DiffPatcher","options","this","processor","pipe","append","collectChildrenDiffFilter","diffFilter","objectsDiffFilter","shouldHaveResult","collectChildrenPatchFilter","patchFilter","collectChildrenReverseFilter","reverseFilter","prototype","apply","arguments","diff","left","right","process","patch","delta","reverse","unpatch","noop","nextTick","canSetImmediate","window","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","source","data","stopPropagation","length","fn","shift","push","setTimeout","title","browser","env","argv","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","Error","cwd","chdir","selfOptions","pipes","name","input","context","lastPipe","lastContext","nextPipe","nextAfterChildren","next","hasResult","result","undefined","filters","debug","index","filter","log","filterName","exiting","resultCheck","msg","console","prepend","unshift","indexOf","list","names","after","params","Array","slice","call","splice","before","clear","should","error","noResult","Context","isArray","a","setResult","exit","leftType","rightType","leftIsArray","rightIsArray","children","child","childName","_t","lcs","ARRAY_MOVE","arrayIndexOf","array","item","i","index1","index2","objectHash","match","array1","array2","value1","value2","hash1","hash2","hashCache1","hashCache2","matchContext","commonHead","commonTail","len1","len2","trimmed1","trimmed2","seq","get","removedItems","indices1","detectMove","includeValueOnMove","removedItemsLength","indexOnArray2","indices2","isMove","removeItemIndex1","compare","numerically","b","numericallyBy","toRemove","toInsert","toModify","parseInt","sort","indexDiff","removedValue","toInsertLength","insertion","toModifyLength","modification","newName","substr","reverseArrayDeltaIndex","itemDelta","newIndex","uindex","itemDelta2","toString","getTime","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","instance","diff_match_patch","dmpModuleName","dmp","err","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","results","patch_apply","patch_fromText","textPatchFailed","minLength","textDiff","textDeltaReverse","l","lines","line","lineTmp","lineHeader","lineAdd","lineRemove","header","headerRegex","split","lineStart","join","switchTo","parent","root","defaultMatch","lengthMatrix","x","y","matrix","Math","max","backtrack","sequence","subsequence"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(e){var r=require(\"./diffpatcher\").DiffPatcher;exports.DiffPatcher=r,exports.create=function(e){return new r(e)},exports.dateReviver=require(\"./date-reviver\");var t;if(exports.diff=function(){return t||(t=new r),t.diff.apply(t,arguments)},exports.patch=function(){return t||(t=new r),t.patch.apply(t,arguments)},exports.unpatch=function(){return t||(t=new r),t.unpatch.apply(t,arguments)},exports.reverse=function(){return t||(t=new r),t.reverse.apply(t,arguments)},e.browser)exports.homepage=\"{{package-homepage}}\",exports.version=\"{{package-version}}\";else{var o=\"../package.json\",a=require(o);exports.homepage=a.homepage,exports.version=a.version;var n=\"./formatters\",p=require(n);exports.formatters=p,exports.console=p.console}}).call(this,require(\"_process\"));","\n// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n    var parts;\n    if (typeof value === 'string') {\n        parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n        if (parts) {\n            return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3],\n              +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n        }\n    }\n    return value;\n};\n","\nvar Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options){\n    this.processor = new Processor(options);\n    this.processor.pipe(new Pipe('diff').append(\n        nested.collectChildrenDiffFilter,\n        trivial.diffFilter,\n        dates.diffFilter,\n        texts.diffFilter,\n        nested.objectsDiffFilter,\n        arrays.diffFilter\n        ).shouldHaveResult());\n    this.processor.pipe(new Pipe('patch').append(\n        nested.collectChildrenPatchFilter,\n        arrays.collectChildrenPatchFilter,\n        trivial.patchFilter,\n        texts.patchFilter,\n        nested.patchFilter,\n        arrays.patchFilter\n        ).shouldHaveResult());\n    this.processor.pipe(new Pipe('reverse').append(\n        nested.collectChildrenReverseFilter,\n        arrays.collectChildrenReverseFilter,\n        trivial.reverseFilter,\n        texts.reverseFilter,\n        nested.reverseFilter,\n        arrays.reverseFilter\n        ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n    return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n    return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n    return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n    return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n    return this.patch(right, this.reverse(delta));\n};\n\nexports.DiffPatcher = DiffPatcher;\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","\nvar Processor = function Processor(options){\n\tthis.selfOptions = options;\n\tthis.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n\tif (options) {\n\t\tthis.selfOptions = options;\n\t}\n\treturn this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n\tif (typeof name === 'string') {\n\t\tif (typeof pipe === 'undefined') {\n\t\t\treturn this.pipes[name];\n\t\t} else {\n\t\t\tthis.pipes[name] = pipe;\n\t\t}\n\t}\n\tif (name && name.name) {\n\t\tpipe = name;\n\t\tif (pipe.processor === this) { return pipe; }\n\t\tthis.pipes[pipe.name] = pipe;\n\t}\n\tpipe.processor = this;\n\treturn pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n\tvar context = input;\n\tcontext.options = this.options();\n\tvar nextPipe = pipe || input.pipe || 'default';\n\tvar lastPipe, lastContext;\n\twhile (nextPipe) {\n\t\tif (typeof context.nextAfterChildren !== 'undefined') {\n\t\t\t// children processed and coming back to parent\n\t\t\tcontext.next = context.nextAfterChildren;\n\t\t\tcontext.nextAfterChildren = null;\n\t\t}\n\n\t\tif (typeof nextPipe === 'string') {\n\t\t\tnextPipe = this.pipe(nextPipe);\n\t\t}\n\t\tnextPipe.process(context);\n\t\tlastContext = context;\n\t\tlastPipe = nextPipe;\n\t\tnextPipe = null;\n\t\tif (context) {\n\t\t\tif (context.next) {\n\t\t\t\tcontext = context.next;\n\t\t\t\tnextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n\t\t\t}\n\t\t}\n\t}\n\treturn context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n","\nvar Pipe = function Pipe(name){\n    this.name = name;\n    this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n    if (!this.processor) {\n        throw new Error('add this pipe to a processor before using it');\n    }\n    var debug = this.debug;\n    var length = this.filters.length;\n    var context = input;\n    for (var index = 0; index < length; index++) {\n        var filter = this.filters[index];\n        if (debug) {\n            this.log('filter: ' + filter.filterName);\n        }\n        filter(context);\n        if (typeof context === 'object' && context.exiting) {\n            context.exiting = false;\n            break;\n        }\n    }\n    if (!context.next && this.resultCheck) {\n        this.resultCheck(context);\n    }\n};\n\nPipe.prototype.log = function(msg) {\n    console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n    this.filters.push.apply(this.filters, arguments);\n    return this;\n};\n\nPipe.prototype.prepend = function() {\n    this.filters.unshift.apply(this.filters, arguments);\n    return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n    if (!filterName) {\n        throw new Error('a filter name is required');\n    }\n    for (var index = 0; index < this.filters.length; index++) {\n        var filter = this.filters[index];\n        if (filter.filterName === filterName) {\n            return index;\n        }\n    }\n    throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n    var names = [];\n    for (var index = 0; index < this.filters.length; index++) {\n        var filter = this.filters[index];\n        names.push(filter.filterName);\n    }\n    return names;\n};\n\nPipe.prototype.after = function(filterName) {\n    var index = this.indexOf(filterName);\n    var params = Array.prototype.slice.call(arguments, 1);\n    if (!params.length) {\n        throw new Error('a filter is required');\n    }\n    params.unshift(index + 1, 0);\n    Array.prototype.splice.apply(this.filters, params);\n    return this;\n};\n\nPipe.prototype.before = function(filterName) {\n    var index = this.indexOf(filterName);\n    var params = Array.prototype.slice.call(arguments, 1);\n    if (!params.length) {\n        throw new Error('a filter is required');\n    }\n    params.unshift(index, 0);\n    Array.prototype.splice.apply(this.filters, params);\n    return this;\n};\n\nPipe.prototype.clear = function() {\n    this.filters.length = 0;\n    return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n    if (should === false) {\n        this.resultCheck = null;\n        return;\n    }\n    if (this.resultCheck) { return; }\n    var pipe = this;\n    this.resultCheck = function(context) {\n        if (!context.hasResult) {\n            console.log(context);\n            var error = new Error(pipe.name + ' failed');\n            error.noResult = true;\n            throw error;\n        }\n    };\n    return this;\n};\n\nexports.Pipe = Pipe;","\nvar Context = require('./context').Context;\n\nvar DiffContext = function DiffContext(left, right){\n    this.left = left;\n    this.right = right;\n    this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nexports.DiffContext = DiffContext;","\nvar Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta){\n    this.left = left;\n    this.delta = delta;\n    this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;","\nvar Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta){\n    this.delta = delta;\n    this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;","\nvar isArray = (typeof Array.isArray === 'function') ?\n    // use native function\n    Array.isArray :\n    // use instanceof operator\n    function(a) {\n        return a instanceof Array;\n    };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n    if (context.left === context.right) {\n        context.setResult(undefined).exit();\n        return;\n    }\n    if (typeof context.left === 'undefined') {\n        if (typeof context.right === 'function') {\n            throw new Error('functions are not supported');\n        }\n        context.setResult([context.right]).exit();\n        return;\n    }\n    if (typeof context.right === 'undefined') {\n        context.setResult([context.left, 0, 0]).exit();\n        return;\n    }\n    if (typeof context.left === 'function' || typeof context.right === 'function' ) {\n        throw new Error('functions are not supported');\n    }\n    context.leftType = context.left === null ? 'null' : typeof context.left;\n    context.rightType = context.right === null ? 'null' : typeof context.right;\n    if (context.leftType !== context.rightType) {\n        context.setResult([context.left, context.right]).exit();\n        return;\n    }\n    if (context.leftType === 'boolean' || context.leftType === 'number') {\n        context.setResult([context.left, context.right]).exit();\n        return;\n    }\n    if (context.leftType === 'object') {\n        context.leftIsArray = isArray(context.left);\n    }\n    if (context.rightType === 'object') {\n        context.rightIsArray = isArray(context.right);\n    }\n    if (context.leftIsArray !== context.rightIsArray) {\n        context.setResult([context.left, context.right]).exit();\n        return;\n    }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n    if (typeof context.delta === 'undefined') {\n        context.setResult(context.left).exit();\n        return;\n    }\n    context.nested = !isArray(context.delta);\n    if (context.nested) { return; }\n    if (context.delta.length === 1) {\n        context.setResult(context.delta[0]).exit();\n        return;\n    }\n    if (context.delta.length === 2) {\n        context.setResult(context.delta[1]).exit();\n        return;\n    }\n    if (context.delta.length === 3 && context.delta[2] === 0) {\n        context.setResult(undefined).exit();\n        return;\n    }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n    if (typeof context.delta === 'undefined') {\n        context.setResult(context.delta).exit();\n        return;\n    }\n    context.nested = !isArray(context.delta);\n    if (context.nested) { return; }\n    if (context.delta.length === 1) {\n        context.setResult([context.delta[0], 0, 0]).exit();\n        return;\n    }\n    if (context.delta.length === 2) {\n        context.setResult([context.delta[1], context.delta[0]]).exit();\n        return;\n    }\n    if (context.delta.length === 3 && context.delta[2] === 0) {\n        context.setResult([context.delta[0]]).exit();\n        return;\n    }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n    if (!context || !context.children) { return; }\n    var length = context.children.length;\n    var child;\n    var result = context.result;\n    for (var index = 0; index < length; index++) {\n        child = context.children[index];\n        if (typeof child.result === 'undefined') {\n            continue;\n        }\n        result = result || {};\n        result[child.childName] = child.result;\n    }\n    if (result && context.leftIsArray) {\n        result._t = 'a';\n    }\n    context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n    if (context.leftIsArray || context.leftType !== 'object') { return; }\n\n    var name, child;\n    for (name in context.left) {\n        child = new DiffContext(context.left[name], context.right[name]);\n        context.push(child, name);\n    }\n    for (name in context.right) {\n        if (typeof context.left[name] === 'undefined') {\n            child = new DiffContext(undefined, context.right[name]);\n            context.push(child, name);\n        }\n    }\n\n    if (!context.children || context.children.length === 0) {\n        context.setResult(undefined).exit();\n        return;\n    }\n    context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n    if (!context.nested) { return; }\n    if (context.delta._t) { return; }\n    var name, child;\n    for (name in context.delta) {\n        child = new PatchContext(context.left[name], context.delta[name]);\n        context.push(child, name);\n    }\n    context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n    if (!context || !context.children) { return; }\n    if (context.delta._t) { return; }\n    var length = context.children.length;\n    var child;\n    for (var index = 0; index < length; index++) {\n        child = context.children[index];\n        if (context.left[child.childName] !== child.result) {\n            context.left[child.childName] = child.result;\n        }\n    }\n    context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n    if (!context.nested) { return; }\n    if (context.delta._t) { return; }\n    var name, child;\n    for (name in context.delta) {\n        child = new ReverseContext(context.delta[name]);\n        context.push(child, name);\n    }\n    context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n    if (!context || !context.children) { return; }\n    if (context.delta._t) { return; }\n    var length = context.children.length;\n    var child;\n    var delta = {};\n    for (var index = 0; index < length; index++) {\n        child = context.children[index];\n        if (delta[child.childName] !== child.result) {\n            delta[child.childName] = child.result;\n        }\n    }\n    context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;","\nvar DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n    // use native function\n    Array.isArray :\n    // use instanceof operator\n    function(a) {\n        return a instanceof Array;\n    };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n    function(array, item) {\n        return array.indexOf(item);\n    } : function(array, item) {\n        var length = array.length;\n        for (var i = 0; i < length; i++) {\n            if (array[i] === item) {\n                return i;\n            }\n        }\n        return -1;\n    };\n\nvar diffFilter = function arraysDiffFilter(context){\n    if (!context.leftIsArray) { return; }\n\n    var objectHash = context.options && context.options.objectHash;\n\n    var match = function(array1, array2, index1, index2, context) {\n        var value1 = array1[index1];\n        var value2 = array2[index2];\n        if (value1 === value2) {\n            return true;\n        }\n        if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n            return false;\n        }\n        if (!objectHash) { return false; }\n        var hash1, hash2;\n        if (typeof index1 === 'number') {\n            context.hashCache1 = context.hashCache1 || [];\n            hash1 = context.hashCache1[index1];\n            if (typeof hash1 === 'undefined') {\n                context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n            }\n        } else {\n            hash1 = objectHash(value1);\n        }\n        if (typeof hash1 === 'undefined') {\n            return false;\n        }\n        if (typeof index2 === 'number') {\n            context.hashCache2 = context.hashCache2 || [];\n            hash2 = context.hashCache2[index2];\n            if (typeof hash2 === 'undefined') {\n                context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n            }\n        } else {\n            hash2 = objectHash(value2);\n        }\n        if (typeof hash2 === 'undefined') {\n            return false;\n        }\n        return hash1 === hash2;\n    };\n\n    var matchContext = {};\n    var commonHead = 0, commonTail = 0, index, index1, index2;\n    var array1 = context.left;\n    var array2 = context.right;\n    var len1 = array1.length;\n    var len2 = array2.length;\n\n    var child;\n\n    // separate common head\n    while (commonHead < len1 && commonHead < len2 &&\n        match(array1, array2, commonHead, commonHead, matchContext)) {\n        index = commonHead;\n        child = new DiffContext(context.left[index], context.right[index]);\n        context.push(child, index);\n        commonHead++;\n    }\n    // separate common tail\n    while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n        match(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n        index1 = len1 - 1 - commonTail;\n        index2 = len2 - 1 - commonTail;\n        child = new DiffContext(context.left[index1], context.right[index2]);\n        context.push(child, index2);\n        commonTail++;\n    }\n    var result;\n    if (commonHead + commonTail === len1) {\n        if (len1 === len2) {\n            // arrays are identical\n            context.setResult(undefined).exit();\n            return;\n        }\n        // trivial case, a block (1 or more consecutive items) was added\n        result = result || { _t: 'a' };\n        for (index = commonHead; index < len2 - commonTail; index++) {\n            result[index] = [array2[index]];\n        }\n        context.setResult(result).exit();\n        return;\n    }\n    if (commonHead + commonTail === len2) {\n        // trivial case, a block (1 or more consecutive items) was removed\n        result = result || { _t: 'a' };\n        for (index = commonHead; index < len1 - commonTail; index++) {\n            result['_'+index] = [array1[index], 0, 0];\n        }\n        context.setResult(result).exit();\n        return;\n    }\n    // reset hash cache\n    matchContext = {};\n    // diff is not trivial, find the LCS (Longest Common Subsequence)\n    var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n    var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n    var seq = lcs.get(\n        trimmed1, trimmed2,\n        match,\n        matchContext\n    );\n    var removedItems = [];\n    result = result || { _t: 'a' };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n        if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n            // removed\n            result['_'+index] = [array1[index], 0, 0];\n            removedItems.push(index);\n        }\n    }\n\n    var detectMove = true;\n    if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n        detectMove = false;\n    }\n    var includeValueOnMove = false;\n    if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n        includeValueOnMove = true;\n    }\n\n    var removedItemsLength = removedItems.length;\n    for (index = commonHead; index < len2 - commonTail; index++) {\n        var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n        if (indexOnArray2 < 0) {\n            // added, try to match with a removed item and register as position move\n            var isMove = false;\n            if (detectMove && removedItemsLength > 0) {\n                for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n                    index1 = removedItems[removeItemIndex1];\n                    if (match(trimmed1, trimmed2, index1 - commonHead,\n                        index - commonHead, matchContext)) {\n                        // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n                        result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n                        if (!includeValueOnMove) {\n                            // don't include moved value on diff, to save bytes\n                            result['_' + index1][0] = '';\n                        }\n\n                        index2 = index;\n                        child = new DiffContext(context.left[index1], context.right[index2]);\n                        context.push(child, index2);\n                        removedItems.splice(removeItemIndex1, 1);\n                        isMove = true;\n                        break;\n                    }\n                }\n            }\n            if (!isMove) {\n                // added\n                result[index] = [array2[index]];\n            }\n        } else {\n            // match, do inner diff\n            index1 = seq.indices1[indexOnArray2] + commonHead;\n            index2 = seq.indices2[indexOnArray2] + commonHead;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n        }\n    }\n\n    context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n    numerically: function(a, b) {\n        return a - b;\n    },\n    numericallyBy: function(name) {\n        return function(a, b) {\n            return a[name] - b[name];\n        };\n    }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n    if (!context.nested) { return; }\n    if (context.delta._t !== 'a') { return; }\n    var index, index1;\n\n    var delta = context.delta;\n    var array = context.left;\n\n    // first, separate removals, insertions and modifications\n    var toRemove = [];\n    var toInsert = [];\n    var toModify = [];\n    for (index in delta) {\n        if (index !== '_t') {\n            if (index[0] === '_') {\n                // removed item from original array\n                if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n                    toRemove.push(parseInt(index.slice(1), 10));\n                } else {\n                    throw new Error('only removal or move can be applied at original array indices' +\n                        ', invalid diff type: ' + delta[index][2]);\n                }\n            } else {\n                if (delta[index].length === 1) {\n                    // added item at new array\n                    toInsert.push({\n                        index: parseInt(index, 10),\n                        value: delta[index][0]\n                    });\n                } else {\n                    // modified item at new array\n                    toModify.push({\n                        index: parseInt(index, 10),\n                        delta: delta[index]\n                    });\n                }\n            }\n        }\n    }\n\n    // remove items, in reverse order to avoid sawing our own floor\n    toRemove = toRemove.sort(compare.numerically);\n    for (index = toRemove.length - 1; index >= 0; index--) {\n        index1 = toRemove[index];\n        var indexDiff = delta['_' + index1];\n        var removedValue = array.splice(index1, 1)[0];\n        if (indexDiff[2] === ARRAY_MOVE) {\n            // reinsert later\n            toInsert.push({\n                index: indexDiff[1],\n                value: removedValue\n            });\n        }\n    }\n\n    // insert items, in reverse order to avoid moving our own floor\n    toInsert = toInsert.sort(compare.numericallyBy('index'));\n    var toInsertLength = toInsert.length;\n    for (index = 0; index < toInsertLength; index++) {\n        var insertion = toInsert[index];\n        array.splice(insertion.index, 0, insertion.value);\n    }\n\n    // apply modifications\n    var toModifyLength = toModify.length;\n    var child;\n    if (toModifyLength > 0) {\n        for (index = 0; index < toModifyLength; index++) {\n            var modification = toModify[index];\n            child = new PatchContext(context.left[modification.index], modification.delta);\n            context.push(child, modification.index);\n        }\n    }\n\n    if (!context.children) {\n        context.setResult(context.left).exit();\n        return;\n    }\n    context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n    if (!context || !context.children) { return; }\n    if (context.delta._t !== 'a') { return; }\n    var length = context.children.length;\n    var child;\n    for (var index = 0; index < length; index++) {\n        child = context.children[index];\n        context.left[child.childName] = child.result;\n    }\n    context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n    if (!context.nested) {\n        if (context.delta[2] === ARRAY_MOVE) {\n            context.newName = '_' + context.delta[1];\n            context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n        }\n        return;\n    }\n    if (context.delta._t !== 'a') { return; }\n    var name, child;\n    for (name in context.delta) {\n        if (name === '_t') { continue; }\n        child = new ReverseContext(context.delta[name]);\n        context.push(child, name);\n    }\n    context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n    var newIndex = index;\n    if (typeof index === 'string' && index[0] === '_') {\n        newIndex = parseInt(index.substr(1), 10);\n    } else {\n        var uindex = '_' + index;\n        if (isArray(itemDelta) && itemDelta[2] === 0) {\n            newIndex = uindex;\n        } else {\n            for (var index2 in delta) {\n                var itemDelta2 = delta[index2];\n                if (isArray(itemDelta2) && itemDelta2[2] === ARRAY_MOVE && itemDelta2[1].toString() === index) {\n                    newIndex = index2.substr(1);\n                }\n            }\n        }\n    }\n    return newIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n    if (!context || !context.children) { return; }\n    if (context.delta._t !== 'a') { return; }\n    var length = context.children.length;\n    var child;\n    var delta = { _t: 'a' };\n    for (var index = 0; index < length; index++) {\n        child = context.children[index];\n        var name = child.newName;\n        if (typeof name === 'undefined') {\n            name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n        }\n        if (delta[name] !== child.result) {\n            delta[name] = child.result;\n        }\n    }\n    context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var diffFilter = function datesDiffFilter(context) {\n    if (context.left instanceof Date) {\n        if (context.right instanceof Date) {\n            if (context.left.getTime() !== context.right.getTime()) {\n                context.setResult([context.left, context.right]);\n            } else {\n                context.setResult(undefined);\n            }\n        } else {\n            context.setResult([context.left, context.right]);\n        }\n        context.exit();\n    } else if (context.right instanceof Date) {\n        context.setResult([context.left, context.right]).exit();\n    }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;","/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function(){\n    /*jshint camelcase: false */\n\n    if (!cachedDiffPatch) {\n        var instance;\n        if (typeof diff_match_patch !== 'undefined') {\n            // already loaded, probably a browser\n            instance = typeof diff_match_patch === 'function' ?\n              new diff_match_patch() : new diff_match_patch.diff_match_patch();\n        } else if (typeof require === 'function') {\n            try {\n                var dmpModuleName = 'diff_match_patch_uncompressed';\n                var dmp = require('../../public/external/' + dmpModuleName);\n                instance = new dmp.diff_match_patch();\n            } catch (err) {\n                instance = null;\n            }\n        }\n        if (!instance) {\n            var error = new Error('text diff_match_patch library not found');\n            error.diff_match_patch_not_found = true;\n            throw error;\n        }\n        cachedDiffPatch = {\n            diff: function(txt1, txt2){\n                return instance.patch_toText(instance.patch_make(txt1, txt2));\n            },\n            patch: function(txt1, patch){\n                var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n                for (var i = 0; i < results[1].length; i++) {\n                    if (!results[1][i]) {\n                        var error = new Error('text patch failed');\n                        error.textPatchFailed = true;\n                    }\n                }\n                return results[0];\n            }\n        };\n    }\n    return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n    if (context.leftType !== 'string') { return; }\n    var minLength = (context.options && context.options.textDiff &&\n        context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n    if (context.left.length < minLength ||\n        context.right.length < minLength) {\n        context.setResult([context.left, context.right]).exit();\n        return;\n    }\n    // large text, use a text-diff algorithm\n    var diff = getDiffMatchPatch().diff;\n    context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n    if (context.nested) { return; }\n    if (context.delta[2] !== TEXT_DIFF) { return; }\n\n    // text-diff, use a text-patch algorithm\n    var patch = getDiffMatchPatch().patch;\n    context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta){\n    var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n    lines = delta.split('\\n');\n    for (i = 0, l = lines.length; i<l; i++) {\n        line = lines[i];\n        var lineStart = line.slice(0,1);\n        if (lineStart==='@'){\n            header = headerRegex.exec(line);\n            lineHeader = i;\n            lineAdd = null;\n            lineRemove = null;\n\n            // fix header\n            lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n        } else if (lineStart === '+'){\n            lineAdd = i;\n            lines[i] = '-' + lines[i].slice(1);\n            if (lines[i-1].slice(0,1)==='+') {\n                // swap lines to keep default order (-+)\n                lineTmp = lines[i];\n                lines[i] = lines[i-1];\n                lines[i-1] = lineTmp;\n            }\n        } else if (lineStart === '-'){\n            lineRemove = i;\n            lines[i] = '+' + lines[i].slice(1);\n        }\n    }\n    return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n    if (context.nested) { return; }\n    if (context.delta[2] !== TEXT_DIFF) { return; }\n\n    // text-diff, use a text-diff algorithm\n    context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;","/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n    return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n    var len1 = array1.length;\n    var len2 = array2.length;\n    var x, y;\n\n    // initialize empty matrix of len1+1 x len2+1\n    var matrix = [len1 + 1];\n    for (x = 0; x < len1 + 1; x++) {\n        matrix[x] = [len2 + 1];\n        for (y = 0; y < len2 + 1; y++) {\n            matrix[x][y] = 0;\n        }\n    }\n    matrix.match = match;\n    // save sequence lengths for each coordinate\n    for (x = 1; x < len1 + 1; x++) {\n        for (y = 1; y < len2 + 1; y++) {\n            if (match(array1, array2, x - 1, y - 1, context)) {\n                matrix[x][y] = matrix[x - 1][y - 1] + 1;\n            } else {\n                matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n            }\n        }\n    }\n    return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n    if (index1 === 0 || index2 === 0) {\n        return {\n            sequence: [],\n            indices1: [],\n            indices2: []\n        };\n    }\n\n    if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n        var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n        subsequence.sequence.push(array1[index1 - 1]);\n        subsequence.indices1.push(index1 - 1);\n        subsequence.indices2.push(index2 - 1);\n        return subsequence;\n    }\n\n    if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n        return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n    } else {\n        return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n    }\n};\n\nvar get = function(array1, array2, match, context) {\n    context = context || {};\n    var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n    var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n    if (typeof array1 === 'string' && typeof array2 === 'string') {\n        result.sequence = result.sequence.join('');\n    }\n    return result;\n};\n\nexports.get = get;\n"]}