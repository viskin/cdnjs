(function(){var a=(function(c){c=(c)?c:{};var v={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:false};var j,x,e,z,r,t,g,d,q,s,o,m,p;p={};p.ff=(/firefox/i.test(navigator.userAgent.toLowerCase()));p.chrome=(/chrome/i.test(navigator.userAgent.toLowerCase()));p.opera=(/opera/i.test(navigator.userAgent.toLowerCase()));p.ie=(/msie/i.test(navigator.userAgent.toLowerCase()))||(/trident/i.test(navigator.userAgent.toLowerCase()));p.supported=(p.chrome||p.ff||p.opera);var l=[];o=function(){};d=m=false;var w=function(){j=k(v,c);j.bgColor=C(j.bgColor);j.textColor=C(j.textColor);j.position=j.position.toLowerCase();j.animation=(A.types[""+j.animation])?j.animation:v.animation;if(j.position==="up"){for(var E=0;E<A.types[""+j.animation].length;E++){var F=A.types[""+j.animation][E];if(F.y<0.6){F.y=F.y-0.4}else{F.y=F.y-2*F.y+(1-F.w)}A.types[""+j.animation][E]=F}}j.type=(i[""+j.type])?j.type:v.type;try{x=n.getIcon();r=document.createElement("canvas");g=document.createElement("img");if(x.hasAttribute("href")){g.setAttribute("src",x.getAttribute("href"));g.onload=function(){e=(g.height>0)?g.height:32;z=(g.width>0)?g.width:32;r.height=e;r.width=z;t=r.getContext("2d");B.ready()}}else{g.setAttribute("src","");e=32;z=32;g.height=e;g.width=z;r.height=e;r.width=z;t=r.getContext("2d");B.ready()}}catch(G){throw"Error initializing favico. Message: "+G.message}};var B={};B.ready=function(){d=true;B.reset();o()};B.reset=function(){l=[];q=false;t.clearRect(0,0,z,e);t.drawImage(g,0,0,z,e);n.setIcon(r)};B.start=function(){if(!d||s){return}var E=function(){q=l[0];s=false;if(l.length>0){l.shift();B.start()}else{}};if(l.length>0){s=true;if(q){A.run(q.options,function(){A.run(l[0].options,function(){E()},false)},true)}else{A.run(l[0].options,function(){E()},false)}}};var i={};var h=function(E){E.n=Math.abs(E.n);E.x=z*E.x;E.y=e*E.y;E.w=z*E.w;E.h=e*E.h;return E};i.circle=function(F){F=h(F);var E=false;if(F.n>9&&F.n<100){F.x=F.x-F.w*0.4;F.w=F.w*1.4;E=true}else{if(F.n>=100){F.x=F.x-F.w*0.65;F.w=F.w*1.65;E=true}}t.clearRect(0,0,z,e);t.drawImage(g,0,0,z,e);t.beginPath();t.font=j.fontStyle+" "+Math.floor(F.h*(F.n>99?0.85:1))+"px "+j.fontFamily;t.textAlign="center";if(E){t.moveTo(F.x+F.w/2,F.y);t.lineTo(F.x+F.w-F.h/2,F.y);t.quadraticCurveTo(F.x+F.w,F.y,F.x+F.w,F.y+F.h/2);t.lineTo(F.x+F.w,F.y+F.h-F.h/2);t.quadraticCurveTo(F.x+F.w,F.y+F.h,F.x+F.w-F.h/2,F.y+F.h);t.lineTo(F.x+F.h/2,F.y+F.h);t.quadraticCurveTo(F.x,F.y+F.h,F.x,F.y+F.h-F.h/2);t.lineTo(F.x,F.y+F.h/2);t.quadraticCurveTo(F.x,F.y,F.x+F.h/2,F.y)}else{t.arc(F.x+F.w/2,F.y+F.h/2,F.h/2,0,2*Math.PI)}t.fillStyle="rgba("+j.bgColor.r+","+j.bgColor.g+","+j.bgColor.b+","+F.o+")";t.fill();t.closePath();t.beginPath();t.stroke();t.fillStyle="rgba("+j.textColor.r+","+j.textColor.g+","+j.textColor.b+","+F.o+")";if(F.n>999){t.fillText(((F.n>9999)?9:Math.floor(F.n/1000))+"k+",Math.floor(F.x+F.w/2),Math.floor(F.y+F.h-F.h*0.2))}else{t.fillText(F.n,Math.floor(F.x+F.w/2),Math.floor(F.y+F.h-F.h*0.15))}t.closePath()};i.rectangle=function(F){F=h(F);var E=false;if(F.n>9&&F.n<100){F.x=F.x-F.w*0.4;F.w=F.w*1.4;E=true}else{if(F.n>=100){F.x=F.x-F.w*0.65;F.w=F.w*1.65;E=true}}t.clearRect(0,0,z,e);t.drawImage(g,0,0,z,e);t.beginPath();t.font="bold "+Math.floor(F.h*(F.n>99?0.9:1))+"px sans-serif";t.textAlign="center";t.fillStyle="rgba("+j.bgColor.r+","+j.bgColor.g+","+j.bgColor.b+","+F.o+")";t.fillRect(F.x,F.y,F.w,F.h);t.fillStyle="rgba("+j.textColor.r+","+j.textColor.g+","+j.textColor.b+","+F.o+")";if(F.n>999){t.fillText(((F.n>9999)?9:Math.floor(F.n/1000))+"k+",Math.floor(F.x+F.w/2),Math.floor(F.y+F.h-F.h*0.2))}else{t.fillText(F.n,Math.floor(F.x+F.w/2),Math.floor(F.y+F.h-F.h*0.15))}t.closePath()};var f=function(F,E){o=function(){try{if(F>0){if(A.types[""+E]){j.animation=E}l.push({type:"badge",options:{n:F}});if(l.length>100){throw"Too many badges requests in queue."}B.start()}else{B.reset()}}catch(G){throw"Error setting badge. Message: "+G.message}};if(d){o()}};var u=function(E){o=function(){try{var F=E.width;var H=E.height;var I=document.createElement("img");var G=(F/z<H/e)?(F/z):(H/e);I.setAttribute("src",E.getAttribute("src"));I.height=(H/G);I.width=(F/G);t.clearRect(0,0,z,e);t.drawImage(I,0,0,z,e);n.setIcon(r)}catch(J){throw"Error setting image. Message: "+J.message}};if(d){o()}};var y=function(E){o=function(){try{if(E==="stop"){m=true;B.reset();m=false;return}E.addEventListener("play",function(){D(this)},false)}catch(F){throw"Error setting video. Message: "+F.message}};if(d){o()}};var b=function(F){if(!window.URL||!window.URL.createObjectURL){window.URL=window.URL||{};window.URL.createObjectURL=function(G){return G}}if(p.supported){var E=false;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;o=function(){try{if(F==="stop"){m=true;B.reset();m=false;return}E=document.createElement("video");E.width=z;E.height=e;navigator.getUserMedia({video:true,audio:false},function(H){E.src=URL.createObjectURL(H);E.play();D(E)},function(){})}catch(G){throw"Error setting webcam. Message: "+G.message}};if(d){o()}}};function D(E){if(E.paused||E.ended||m){return false}try{t.clearRect(0,0,z,e);t.drawImage(E,0,0,z,e)}catch(F){}setTimeout(D,A.duration,E);n.setIcon(r)}var n={};n.getIcon=function(){var F=false;var E=function(){var I=document.getElementsByTagName("head")[0].getElementsByTagName("link");for(var G=I.length,H=(G-1);H>=0;H--){if((/icon/i).test(I[H].getAttribute("rel"))){return I[H]}}return false};if(j.elementId){F=document.getElementById(j.elementId);F.setAttribute("href",F.getAttribute("src"))}else{F=E();if(F===false){F=document.createElement("link");F.setAttribute("rel","icon");document.getElementsByTagName("head")[0].appendChild(F)}}F.setAttribute("type","image/png");return F};n.setIcon=function(G){var F=G.toDataURL("image/png");if(j.elementId){document.getElementById(j.elementId).setAttribute("src",F)}else{if(p.ff||p.opera){var E=x;x=document.createElement("link");if(p.opera){x.setAttribute("rel","icon")}x.setAttribute("rel","icon");x.setAttribute("type","image/png");document.getElementsByTagName("head")[0].appendChild(x);x.setAttribute("href",F);if(E.parentNode){E.parentNode.removeChild(E)}}else{x.setAttribute("href",F)}}};function C(G){var F=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;G=G.replace(F,function(I,K,J,H){return K+K+J+J+H+H});var E=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(G);return E?{r:parseInt(E[1],16),g:parseInt(E[2],16),b:parseInt(E[3],16)}:false}function k(H,E){var G={};var F;for(F in H){G[F]=H[F]}for(F in E){G[F]=E[F]}return G}var A={};A.duration=40;A.types={};A.types.fade=[{x:0.4,y:0.4,w:0.6,h:0.6,o:0},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.1},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.2},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.3},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.4},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.5},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.6},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.7},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.8},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];A.types.none=[{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];A.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:0.9,y:0.9,w:0.1,h:0.1,o:1},{x:0.8,y:0.8,w:0.2,h:0.2,o:1},{x:0.7,y:0.7,w:0.3,h:0.3,o:1},{x:0.6,y:0.6,w:0.4,h:0.4,o:1},{x:0.5,y:0.5,w:0.5,h:0.5,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];A.types.popFade=[{x:0.75,y:0.75,w:0,h:0,o:0},{x:0.65,y:0.65,w:0.1,h:0.1,o:0.2},{x:0.6,y:0.6,w:0.2,h:0.2,o:0.4},{x:0.55,y:0.55,w:0.3,h:0.3,o:0.6},{x:0.5,y:0.5,w:0.4,h:0.4,o:0.8},{x:0.45,y:0.45,w:0.5,h:0.5,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];A.types.slide=[{x:0.4,y:1,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.8,w:0.6,h:0.6,o:1},{x:0.4,y:0.7,w:0.6,h:0.6,o:1},{x:0.4,y:0.6,w:0.6,h:0.6,o:1},{x:0.4,y:0.5,w:0.6,h:0.6,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];A.run=function(G,E,F,I){var H=A.types[j.animation];if(F===true){I=(typeof I!=="undefined")?I:H.length-1}else{I=(typeof I!=="undefined")?I:0}E=(E)?E:function(){};if((I<H.length)&&(I>=0)){i[j.type](k(G,H[I]));setTimeout(function(){if(F){I=I-1}else{I=I+1}A.run(G,E,F,I)},A.duration);n.setIcon(r)}else{E();return}};w();return{badge:f,video:y,image:u,webcam:b,reset:B.reset}});if(typeof define!=="undefined"&&define.amd){define([],function(){return a})}else{if(typeof module!=="undefined"&&module.exports){module.exports=a}else{this.Favico=a}}})();