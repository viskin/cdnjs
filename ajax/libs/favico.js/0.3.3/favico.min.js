(function(){var a=(function(d){d=(d)?d:{};var w={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:false};var k,y,f,A,s,u,h,e,r,t,p,n,q;q={};q.ff=(/firefox/i.test(navigator.userAgent.toLowerCase()));q.chrome=(/chrome/i.test(navigator.userAgent.toLowerCase()));q.opera=(/opera/i.test(navigator.userAgent.toLowerCase()));q.ie=(/msie/i.test(navigator.userAgent.toLowerCase()))||(/trident/i.test(navigator.userAgent.toLowerCase()));q.supported=(q.chrome||q.ff||q.opera);var m=[];p=function(){};e=n=false;var x=function(){k=l(w,d);k.bgColor=D(k.bgColor);k.textColor=D(k.textColor);k.position=k.position.toLowerCase();k.animation=(B.types[""+k.animation])?k.animation:w.animation;if(k.position==="up"){for(var F=0;F<B.types[""+k.animation].length;F++){var G=B.types[""+k.animation][F];if(G.y<0.6){G.y=G.y-0.4}else{G.y=G.y-2*G.y+(1-G.w)}B.types[""+k.animation][F]=G}}k.type=(j[""+k.type])?k.type:w.type;try{y=o.getIcon();s=document.createElement("canvas");h=document.createElement("img");if(y.hasAttribute("href")){h.setAttribute("src",y.getAttribute("href"));h.onload=function(){f=(h.height>0)?h.height:32;A=(h.width>0)?h.width:32;s.height=f;s.width=A;u=s.getContext("2d");C.ready()}}else{h.setAttribute("src","");f=32;A=32;h.height=f;h.width=A;s.height=f;s.width=A;u=s.getContext("2d");C.ready()}}catch(H){throw"Error initializing favico. Message: "+H.message}};var C={};C.ready=function(){e=true;C.reset();p()};C.reset=function(){m=[];r=false;u.clearRect(0,0,A,f);u.drawImage(h,0,0,A,f);o.setIcon(s)};C.start=function(){if(!e||t){return}var F=function(){r=m[0];t=false;if(m.length>0){m.shift();C.start()}else{}};if(m.length>0){t=true;if(r){B.run(r.options,function(){B.run(m[0].options,function(){F()},false)},true)}else{B.run(m[0].options,function(){F()},false)}}};var j={};var i=function(F){F.n=Math.abs(F.n);F.x=A*F.x;F.y=f*F.y;F.w=A*F.w;F.h=f*F.h;return F};j.circle=function(G){G=i(G);var F=false;if(G.n>9&&G.n<100){G.x=G.x-G.w*0.4;G.w=G.w*1.4;F=true}else{if(G.n>=100){G.x=G.x-G.w*0.65;G.w=G.w*1.65;F=true}}u.clearRect(0,0,A,f);u.drawImage(h,0,0,A,f);u.beginPath();u.font=k.fontStyle+" "+Math.floor(G.h*(G.n>99?0.85:1))+"px "+k.fontFamily;u.textAlign="center";if(F){u.moveTo(G.x+G.w/2,G.y);u.lineTo(G.x+G.w-G.h/2,G.y);u.quadraticCurveTo(G.x+G.w,G.y,G.x+G.w,G.y+G.h/2);u.lineTo(G.x+G.w,G.y+G.h-G.h/2);u.quadraticCurveTo(G.x+G.w,G.y+G.h,G.x+G.w-G.h/2,G.y+G.h);u.lineTo(G.x+G.h/2,G.y+G.h);u.quadraticCurveTo(G.x,G.y+G.h,G.x,G.y+G.h-G.h/2);u.lineTo(G.x,G.y+G.h/2);u.quadraticCurveTo(G.x,G.y,G.x+G.h/2,G.y)}else{u.arc(G.x+G.w/2,G.y+G.h/2,G.h/2,0,2*Math.PI)}u.fillStyle="rgba("+k.bgColor.r+","+k.bgColor.g+","+k.bgColor.b+","+G.o+")";u.fill();u.closePath();u.beginPath();u.stroke();u.fillStyle="rgba("+k.textColor.r+","+k.textColor.g+","+k.textColor.b+","+G.o+")";if(G.n>999){u.fillText(((G.n>9999)?9:Math.floor(G.n/1000))+"k+",Math.floor(G.x+G.w/2),Math.floor(G.y+G.h-G.h*0.2))}else{u.fillText(G.n,Math.floor(G.x+G.w/2),Math.floor(G.y+G.h-G.h*0.15))}u.closePath()};j.rectangle=function(G){G=i(G);var F=false;if(G.n>9&&G.n<100){G.x=G.x-G.w*0.4;G.w=G.w*1.4;F=true}else{if(G.n>=100){G.x=G.x-G.w*0.65;G.w=G.w*1.65;F=true}}u.clearRect(0,0,A,f);u.drawImage(h,0,0,A,f);u.beginPath();u.font="bold "+Math.floor(G.h*(G.n>99?0.9:1))+"px sans-serif";u.textAlign="center";u.fillStyle="rgba("+k.bgColor.r+","+k.bgColor.g+","+k.bgColor.b+","+G.o+")";u.fillRect(G.x,G.y,G.w,G.h);u.fillStyle="rgba("+k.textColor.r+","+k.textColor.g+","+k.textColor.b+","+G.o+")";if(G.n>999){u.fillText(((G.n>9999)?9:Math.floor(G.n/1000))+"k+",Math.floor(G.x+G.w/2),Math.floor(G.y+G.h-G.h*0.2))}else{u.fillText(G.n,Math.floor(G.x+G.w/2),Math.floor(G.y+G.h-G.h*0.15))}u.closePath()};var g=function(G,F){p=function(){try{if(G>0){if(B.types[""+F]){k.animation=F}m.push({type:"badge",options:{n:G}});if(m.length>100){throw"Too many badges requests in queue."}C.start()}else{C.reset()}}catch(H){throw"Error setting badge. Message: "+H.message}};if(e){p()}};var v=function(F){p=function(){try{var G=F.width;var I=F.height;var J=document.createElement("img");var H=(G/A<I/f)?(G/A):(I/f);J.setAttribute("src",F.getAttribute("src"));J.height=(I/H);J.width=(G/H);u.clearRect(0,0,A,f);u.drawImage(J,0,0,A,f);o.setIcon(s)}catch(K){throw"Error setting image. Message: "+K.message}};if(e){p()}};var z=function(F){p=function(){try{if(F==="stop"){n=true;C.reset();n=false;return}F.addEventListener("play",function(){E(this)},false)}catch(G){throw"Error setting video. Message: "+G.message}};if(e){p()}};var b=function(G){if(!window.URL||!window.URL.createObjectURL){window.URL=window.URL||{};window.URL.createObjectURL=function(H){return H}}if(q.supported){var F=false;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;p=function(){try{if(G==="stop"){n=true;C.reset();n=false;return}F=document.createElement("video");F.width=A;F.height=f;navigator.getUserMedia({video:true,audio:false},function(I){F.src=URL.createObjectURL(I);F.play();E(F)},function(){})}catch(H){throw"Error setting webcam. Message: "+H.message}};if(e){p()}}};function E(F){if(F.paused||F.ended||n){return false}try{u.clearRect(0,0,A,f);u.drawImage(F,0,0,A,f)}catch(G){}setTimeout(E,B.duration,F);o.setIcon(s)}var o={};o.getIcon=function(){var H=false;var F="";var G=function(){var K=document.getElementsByTagName("head")[0].getElementsByTagName("link");for(var I=K.length,J=(I-1);J>=0;J--){if((/icon/i).test(K[J].getAttribute("rel"))){return K[J]}}return false};if(k.elementId){H=document.getElementById(k.elementId);H.setAttribute("href",H.getAttribute("src"))}else{H=G();if(H===false){H=document.createElement("link");H.setAttribute("rel","icon");document.getElementsByTagName("head")[0].appendChild(H)}}F=(k.elementId)?H.src:H.href;if(F.indexOf(document.location.hostname)===-1){throw new Error("Error setting favicon. Favicon image is on different domain (Icon: "+F+", Domain: "+document.location.hostname+")")}H.setAttribute("type","image/png");return H};o.setIcon=function(H){var G=H.toDataURL("image/png");if(k.elementId){document.getElementById(k.elementId).setAttribute("src",G)}else{if(q.ff||q.opera){var F=y;y=document.createElement("link");if(q.opera){y.setAttribute("rel","icon")}y.setAttribute("rel","icon");y.setAttribute("type","image/png");document.getElementsByTagName("head")[0].appendChild(y);y.setAttribute("href",G);if(F.parentNode){F.parentNode.removeChild(F)}}else{y.setAttribute("href",G)}}};function D(H){var G=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;H=H.replace(G,function(J,L,K,I){return L+L+K+K+I+I});var F=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(H);return F?{r:parseInt(F[1],16),g:parseInt(F[2],16),b:parseInt(F[3],16)}:false}function l(I,F){var H={};var G;for(G in I){H[G]=I[G]}for(G in F){H[G]=F[G]}return H}function c(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden}var B={};B.duration=40;B.types={};B.types.fade=[{x:0.4,y:0.4,w:0.6,h:0.6,o:0},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.1},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.2},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.3},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.4},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.5},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.6},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.7},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.8},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];B.types.none=[{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];B.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:0.9,y:0.9,w:0.1,h:0.1,o:1},{x:0.8,y:0.8,w:0.2,h:0.2,o:1},{x:0.7,y:0.7,w:0.3,h:0.3,o:1},{x:0.6,y:0.6,w:0.4,h:0.4,o:1},{x:0.5,y:0.5,w:0.5,h:0.5,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];B.types.popFade=[{x:0.75,y:0.75,w:0,h:0,o:0},{x:0.65,y:0.65,w:0.1,h:0.1,o:0.2},{x:0.6,y:0.6,w:0.2,h:0.2,o:0.4},{x:0.55,y:0.55,w:0.3,h:0.3,o:0.6},{x:0.5,y:0.5,w:0.4,h:0.4,o:0.8},{x:0.45,y:0.45,w:0.5,h:0.5,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];B.types.slide=[{x:0.4,y:1,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.8,w:0.6,h:0.6,o:1},{x:0.4,y:0.7,w:0.6,h:0.6,o:1},{x:0.4,y:0.6,w:0.6,h:0.6,o:1},{x:0.4,y:0.5,w:0.6,h:0.6,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];B.run=function(H,F,G,J){var I=B.types[c()?"none":k.animation];if(G===true){J=(typeof J!=="undefined")?J:I.length-1}else{J=(typeof J!=="undefined")?J:0}F=(F)?F:function(){};if((J<I.length)&&(J>=0)){j[k.type](l(H,I[J]));setTimeout(function(){if(G){J=J-1}else{J=J+1}B.run(H,F,G,J)},B.duration);o.setIcon(s)}else{F();return}};x();return{badge:g,video:z,image:v,webcam:b,reset:C.reset}});if(typeof define!=="undefined"&&define.amd){define([],function(){return a})}else{if(typeof module!=="undefined"&&module.exports){module.exports=a}else{this.Favico=a}}})();