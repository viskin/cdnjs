var Favico=(function(b){b=(b)?b:{};var u={bgColor:"#d00",textColor:"#fff",type:"circle",animation:"slide",elementId:false};var i,w,d,y,q,r,f,c,p,t,n,l,o;var k=[];n=function(){};c=l=false;var v=function(){i=j(u,b);i.bgColor=B(i.bgColor);i.textColor=B(i.textColor);i.animation=(z.types[""+i.animation])?i.animation:u.animation;i.type=(h[""+i.type])?i.type:u.type;try{w=m.getIcon();q=document.createElement("canvas");f=document.createElement("img");f.setAttribute("src",w.getAttribute("href"));f.onload=function(){d=(f.height>0)?f.height:32;y=(f.width>0)?f.width:32;q.height=d;q.width=y;r=q.getContext("2d");A.ready()};o={};o.ff=(/firefox/i.test(navigator.userAgent.toLowerCase()));o.chrome=(/chrome/i.test(navigator.userAgent.toLowerCase()));o.opera=(/opera/i.test(navigator.userAgent.toLowerCase()));o.ie=(/msie/i.test(navigator.userAgent.toLowerCase()))||(/trident/i.test(navigator.userAgent.toLowerCase()));o.supported=(o.chrome||o.ff||o.opera);if(o.ie){console.warn("IE is not supported...")}}catch(D){console.error("Error initializing favico...",D,b)}};var A={};A.ready=function(){c=true;A.reset();n()};A.reset=function(){k=[];p=false;r.clearRect(0,0,y,d);r.drawImage(f,0,0,y,d);m.setIcon(q)};A.start=function(){if(!c||t){return}var D=function(){p=k[0];t=false;if(k.length>0){k.shift();A.start()}else{}};if(k.length>0){t=true;if(p){z.run(p.options,function(){z.run(k[0].options,function(){D()},false)},true)}else{z.run(k[0].options,function(){D()},false)}}};var h={};var g=function(D){D.n=Math.abs(D.n);D.x=y*D.x;D.y=d*D.y;D.w=y*D.w;D.h=d*D.h;return D};h.circle=function(E){E=g(E);var D=(E.n>9);if(D){E.x=E.x-E.w*0.4;E.w=E.w*1.4}r.clearRect(0,0,y,d);r.drawImage(f,0,0,y,d);r.beginPath();r.font="bold "+Math.floor(E.h)+"px sans-serif";r.textAlign="center";if(D){r.moveTo(E.x+E.w/2,E.y);r.lineTo(E.x+E.w-E.h/2,E.y);r.quadraticCurveTo(E.x+E.w,E.y,E.x+E.w,E.y+E.h/2);r.lineTo(E.x+E.w,E.y+E.h-E.h/2);r.quadraticCurveTo(E.x+E.w,E.y+E.h,E.x+E.w-E.h/2,E.y+E.h);r.lineTo(E.x+E.h/2,E.y+E.h);r.quadraticCurveTo(E.x,E.y+E.h,E.x,E.y+E.h-E.h/2);r.lineTo(E.x,E.y+E.h/2);r.quadraticCurveTo(E.x,E.y,E.x+E.h/2,E.y)}else{r.arc(E.x+E.w/2,E.y+E.h/2,E.h/2,0,2*Math.PI)}r.fillStyle="rgba("+i.bgColor.r+","+i.bgColor.g+","+i.bgColor.b+","+E.o+")";r.fill();r.closePath();r.beginPath();r.stroke();r.fillStyle="rgba("+i.textColor.r+","+i.textColor.g+","+i.textColor.b+","+E.o+")";r.fillText((D)?"9+":E.n,Math.floor(E.x+E.w/2),Math.floor(E.y+E.h-E.h*0.15));r.closePath()};h.rectangle=function(E){E=g(E);var D=(E.n>9);if(D){E.x=Math.floor(E.x-E.w*0.4);E.w=Math.floor(E.w*1.4)}r.clearRect(0,0,y,d);r.drawImage(f,0,0,y,d);r.beginPath();r.font="bold "+Math.floor(E.h)+"px sans-serif";r.textAlign="center";r.fillStyle="rgba("+i.bgColor.r+","+i.bgColor.g+","+i.bgColor.b+","+E.o+")";r.fillRect(E.x,E.y,E.w,E.h);r.fillStyle="rgba("+i.textColor.r+","+i.textColor.g+","+i.textColor.b+","+E.o+")";r.fillText((D)?"9+":E.n,Math.floor(E.x+E.w/2),Math.floor(E.y+E.h-E.h*0.15));r.closePath()};var e=function(E,D){n=function(){try{if(E>0){if(z.types[""+D]){i.animation=D}k.push({type:"badge",options:{n:E}});if(k.length>100){console.warn("Too many badges request in queue...")}A.start()}else{A.reset()}}catch(F){console.error("Error setting badge...",F)}};if(c){n()}};var s=function(D){n=function(){try{var E=D.width;var G=D.height;var H=document.createElement("img");var F=(E/y<G/d)?(E/y):(G/d);H.setAttribute("src",D.getAttribute("src"));H.height=(G/F);H.width=(E/F);r.clearRect(0,0,y,d);r.drawImage(H,0,0,y,d);m.setIcon(q)}catch(I){console.error("Error setting image...",I);throw I}};if(c){n()}};var x=function(D){n=function(){try{if(D==="stop"){l=true;A.reset();l=false;return}var E=D.width;var G=D.height;var F=(E/y<G/d)?(E/y):(G/d);D.addEventListener("play",function(){C(this)},false)}catch(H){console.error("Error setting video...",H);throw H}};if(c){n()}};var a=function(E){if(!window.URL||!window.URL.createObjectURL){window.URL=window.URL||{};window.URL.createObjectURL=function(F){return F}}if(o.supported){var D=false;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;n=function(){try{if(E==="stop"){l=true;A.reset();l=false;return}D=document.createElement("video");D.width=y;D.height=d;navigator.getUserMedia({video:true,audio:false},function(G){D.src=URL.createObjectURL(G);D.play();C(D)},function(){})}catch(F){console.error("Error setting webcam...",F);throw F}};if(c){n()}}else{console.log("Sorry. Only chrome and firefox  is supported yet...")}};function C(D){if(D.paused||D.ended||l){return false}try{r.clearRect(0,0,y,d);r.drawImage(D,0,0,y,d)}catch(E){}setTimeout(C,z.duration,D);m.setIcon(q)}var m={};m.getIcon=function(){var E=false;var D=function(){var H=document.getElementsByTagName("head")[0].getElementsByTagName("link");for(var F=H.length,G=(F-1);G>=0;G--){if((/icon/i).test(H[G].getAttribute("rel"))){return H[G]}}return false};if(i.elementId){E=document.getElementById(i.elementId);E.setAttribute("href",E.getAttribute("src"))}else{E=D();if(E===false){E=document.createElement("link");E.setAttribute("rel","icon");document.getElementsByTagName("head")[0].appendChild(E)}}E.setAttribute("type","imapge/png");return E};m.setIcon=function(F){var E=F.toDataURL("image/png");if(i.elementId){document.getElementById(i.elementId).setAttribute("src",E)}else{if(o.ff||o.opera){var G=w.getAttribute("rel");var D=w;w=document.createElement("link");if(o.opera){w.setAttribute("rel","icon")}w.setAttribute("rel","icon");w.setAttribute("type","image/png");document.getElementsByTagName("head")[0].appendChild(w);w.setAttribute("href",E);if(D.parentNode){D.parentNode.removeChild(D)}}else{w.setAttribute("href",E)}}};function B(F){var E=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;F=F.replace(E,function(H,J,I,G){return J+J+I+I+G+G});var D=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(F);return D?{r:parseInt(D[1],16),g:parseInt(D[2],16),b:parseInt(D[3],16)}:false}function j(G,D){var F={};for(var E in G){F[E]=G[E]}for(var E in D){F[E]=D[E]}return F}var z={};z.duration=40;z.types={};z.types.fade=[{x:0.4,y:0.4,w:0.6,h:0.6,o:0},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.1},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.2},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.3},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.4},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.5},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.6},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.7},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.8},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];z.types.none=[{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];z.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:0.9,y:0.9,w:0.1,h:0.1,o:1},{x:0.8,y:0.8,w:0.2,h:0.2,o:1},{x:0.7,y:0.7,w:0.3,h:0.3,o:1},{x:0.6,y:0.6,w:0.4,h:0.4,o:1},{x:0.5,y:0.5,w:0.5,h:0.5,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];z.types.popFade=[{x:0.75,y:0.75,w:0,h:0,o:0},{x:0.65,y:0.65,w:0.1,h:0.1,o:0.2},{x:0.6,y:0.6,w:0.2,h:0.2,o:0.4},{x:0.55,y:0.55,w:0.3,h:0.3,o:0.6},{x:0.5,y:0.5,w:0.4,h:0.4,o:0.8},{x:0.45,y:0.45,w:0.5,h:0.5,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];z.types.slide=[{x:0.4,y:1,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.8,w:0.6,h:0.6,o:1},{x:0.4,y:0.7,w:0.6,h:0.6,o:1},{x:0.4,y:0.6,w:0.6,h:0.6,o:1},{x:0.4,y:0.5,w:0.6,h:0.6,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];z.run=function(F,D,E,H){var G=z.types[i.animation];if(E===true){H=(typeof H!=="undefined")?H:G.length-1}else{H=(typeof H!=="undefined")?H:0}D=(D)?D:function(){};if((H<G.length)&&(H>=0)){h[i.type](j(F,G[H]));setTimeout(function(){if(E){H=H-1}else{H=H+1}z.run(F,D,E,H)},z.duration);m.setIcon(q)}else{D();return}};v();return{badge:e,video:x,image:s,webcam:a,reset:A.reset}});