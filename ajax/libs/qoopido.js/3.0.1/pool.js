(function(t,e){"use strict";function n(){return e.qoopido.initialize("pool",t,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/merge","./function/unique/uuid"],n):n()})(function(t){"use strict";function e(){var t,e,n,i,r,o=this,u=o.metrics,a=o._settings,s=o._queue,c=o._variables,l=1;if(s.length>0&&(c.durationAverage>0&&(l=~~(1>(l=a.frameBudget/c.durationAverage)?1:l)),(t=Math.min(s.length,(e=s.splice(0,l)).length))>0))if(u.inPool+t<=a.maxPoolsize){for(r=(new Date).getTime(),n=0,i=e[n];t>n;n++){var f=i._quid,d=i.dispose;i=o._dispose(i),i._quid=f,i.dispose=d,o._getPool.call(o,i).push(i)}u.inPool+=t,u.inQueue-=t,c.durationSamples+=t,c.durationTotal+=(new Date).getTime()-r,c.durationAverage=c.durationTotal/c.durationSamples}else e.length=0,u.inQueue-=t,u.destroyed+=t}var n,i={interval:15,frameBudget:.5,maxPoolsize:1e3,queueFactor:.2};return n=t.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var r=this;r.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},r._settings=t["function/merge"]({},i,n),r._pool=r._initPool(),r._queue=[],r._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){e.call(r)},r._settings.interval)},_initPool:function(){return[]},_getPool:function(){return this._pool},obtain:function(){var e=this,n=e._getPool.apply(e,arguments).pop();return n?(e.metrics.inPool--,e.metrics.recycled++):(n=e._obtain.apply(e,arguments),n._quid=t["function/unique/uuid"](),n.dispose=function(){e.dispose(n)},e.metrics.total++),e.metrics.inUse++,n},dispose:function(e){var n=this,i=n._queue;return e._quid||(e._quid=t["function/unique/uuid"](),e.dispose=function(){n.dispose(e)},n.metrics.total++,n.metrics.inUse++),i.push(e),n.metrics.inUse--,n.metrics.inQueue++,null}})},window);