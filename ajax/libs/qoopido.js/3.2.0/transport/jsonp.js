(function(t){window.qoopido.registerSingleton("transport/jsonp",t,["../transport","../function/merge","../function/unique/uuid","../url","../dom/element","q"])})(function(t,e,o,r,n,i){"use strict";function s(t,e){var o=this,r=o.dfd,i=o.script,s=o.settings;e="object"==typeof e?o.serialize(e):e,t="".concat(t,t.indexOf("?")>-1?"&":"?","".concat(s.callback,"=",o.id)),t=s.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","".concat("_=",""+(new Date).getTime())):t,t=e?"".concat(t,t.indexOf("?")>-1?"&":"?",e):t,n[o.id]=function(t){try{delete n[o.id]}catch(e){n[o.id]=null}l.call(o),r.resolve(t)},i.on("load readystatechange",function(t){u.call(o,t)}).one("error",function(){a.call(o)}).setAttribute("src",t),m.appendChild(i.element),o.timeout=setTimeout(function(){c.call(o)},s.timeout)}function u(t){var e=this,o=e.dfd;t.readyState&&"loaded"!==t.readyState&&"complete"!==t.readyState||e.script.off()&&e.script.element.dispose&&e.script.element.dispose(),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){c.call(e)},e.settings.timeout),o.notify(t)}function a(){var t=this;l.call(t),t.dfd.reject()}function c(){var t=this;l.call(t),t.dfd.reject(!1)}function l(){var t=this;t.timeout&&clearTimeout(t.timeout),t.script.off().element.dispose()}var p,d=t.q||n.Q,f=e.pool&&e.pool.dom,m=i.getElementsByTagName("head")[0];return p=t.transport.extend({_settings:{callback:"callback",cache:!1,timeout:5e3},load:function(e,o,r){var n={};return e=t.url.resolve(e),n.id="".concat("jsonp-",t["function/unique/string"]()),n.dfd=d.defer(),n.script=t["dom/element"].create(f?f.obtain("script"):i.createElement("script")),n.settings=t["function/merge"]({},this._settings,r),n.timeout=null,n.script.setAttribute("async",!0),s.call(n,e,o),n.dfd.promise}})},window,document);