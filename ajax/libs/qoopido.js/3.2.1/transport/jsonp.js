/*!
* Qoopido.js library v3.2.1, 2014-0-10
* https://github.com/dlueth/qoopido.js
* (c) 2014 Dirk Lueth
* Dual licensed under MIT and GPL
*/
!function(t){window.qoopido.registerSingleton("transport/jsonp",t,["../transport","../function/merge","../function/unique/uuid","../url","../dom/element","q"])}(function(t,e,n,i,o,c){"use strict";function a(t,e){var n=this,i=n.dfd,c=n.script,a=n.settings;e="object"==typeof e?n.serialize(e):e,t="".concat(t,t.indexOf("?")>-1?"&":"?","".concat(a.callback,"=",n.id)),t=a.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","".concat("_=",(new Date).getTime().toString())):t,t=e?"".concat(t,t.indexOf("?")>-1?"&":"?",e):t,o[n.id]=function(t){try{delete o[n.id]}catch(e){o[n.id]=null}u.call(n),i.resolve(t)},c.on("load readystatechange",function(t){r.call(n,t)}).one("error",function(){s.call(n)}).setAttribute("src",t),p.appendChild(c.element),n.timeout=setTimeout(function(){l.call(n)},a.timeout)}function r(t){var e=this,n=e.dfd;t.readyState&&"loaded"!==t.readyState&&"complete"!==t.readyState||e.script.off()&&e.script.element.dispose&&e.script.element.dispose(),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){l.call(e)},e.settings.timeout),n.notify(t)}function s(){var t=this;u.call(t),t.dfd.reject()}function l(){var t=this;u.call(t),t.dfd.reject(!1)}function u(){var t=this;t.timeout&&clearTimeout(t.timeout),t.script.off().element.dispose()}var d,f=t.q||o.Q,m=e.pool&&e.pool.dom,p=c.getElementsByTagName("head")[0];return d=t.transport.extend({_settings:{callback:"callback",cache:!1,timeout:5e3},load:function(e,n,i){var o={};return e=t.url.resolve(e),o.id="".concat("jsonp-",t["function/unique/string"]()),o.dfd=f.defer(),o.script=t["dom/element"].create(m?m.obtain("script"):c.createElement("script")),o.settings=t["function/merge"]({},this._settings,i),o.timeout=null,o.script.setAttribute("async",!0),a.call(o,e,n),o.dfd.promise}})},window,document);