/*! Qoopido.js library 3.6.7, 2015-07-08 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(t){var e=["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr"];window.qoopido.register("dom/element/shrinkimage",t,e)}(function(t,e,n,i,a,r,o){"use strict";function l(e,n){e=t.url.resolve(v.exec(e)[1]),n=n===!0;var i=this,a=t["function/merge"]({},i._settings,t.url.getParameter(e)),r=a.target||(e=e.split("?")[0]).replace(x,"".concat(".q",a.quality,".shrunk"));n||i.removeAttribute(i._settings.attribute).hide(),_.then(function(){if(a.debug===!0)throw new Error("[Qoopido.js] Debug enabled");switch(typeof w[r]){case"object":w[r].one(E,function(t){c.call(i,t.data,n)}),i.emit(k);break;case"string":c.call(i,w[r],n);break;default:w[r]=h.create(r,n?null:i.element).one(A,function(t,a){t.type===E?(w[r]=a,i.emit(I),c.call(i,a,n)):(w[r]=e,c.call(i,e,n))},!1)}})["catch"](function(){w[r]=e,c.call(i,e,n)})}function c(t,e){var n=this;e?(n.setStyle("backgroundImage","url("+t+")"),n.emit(E)):n.one(R,function(){n.show(),n.emit(E)}).setAttribute("src",t)}function s(t){var e=this;t.get(e._url).then(function(t){try{var n=g.parse(t.data);n.width=parseInt(n.width,10),n.height=parseInt(n.height,10),u.call(e,n)}catch(i){e.emit(q)}},function(){e.emit(q)})}function u(t){var e,n,i=this,a=function(a){return e=b&&b.obtain("canvas")||r.createElement("canvas"),e.style.display="none",e.width=t.width,e.height=t.height,n=e.getContext("2d"),n.clearRect(0,0,t.width,t.height),n.drawImage(i.element,0,0,t.width,t.height),i.one(R,o).setAttribute("src",t.alpha),p(a)},o=function(a){var r;return n.globalCompositeOperation="xor",n.drawImage(i.element,0,0,t.width,t.height),r=e.toDataURL("image/png"),l(),i.emit(E,r),p(a)},l=function(){e&&e.dispose&&e.dispose(),i.element.dispose&&i.element.dispose()};i.one(D,function(t){t.type===R?a.call(this,t):(l(),i.emit(q))},!1).setAttribute("src",t.main)}function p(t){return t.preventDefault(),t.stopPropagation(),!1}var d,h,g=a.JSON,m=n.pop(),f={attribute:"data-"+m,quality:80,debug:!1},b=e.pool&&e.pool.dom||null,w={},y=new RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),v=new RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),x=new RegExp("\\.png$","i"),_=t.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png"),k="queued",I="cached",E="loaded",q="failed",A="".concat(E," ",q),R="load",S="error",D="".concat(R," ",S);return d=t["dom/element"].extend({_constructor:function(e,n){var i,a,r=this;d._parent._constructor.call(r,e),r._settings=n=t["function/merge"]({},f,n),i=r.getAttribute(n.attribute),a=r.getStyle("backgroundImage"),"IMG"===r.type&&l.call(r,i),"none"!==a&&y.test(a)&&l.call(r,a,!0)},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),h=t["dom/element"].extend({_url:null,_constructor:function(e,n){var i=this;n||(n=b&&b.obtain("img")||r.createElement("img")),h._parent._constructor.call(i,n),i._url=e,s.call(i,t["transport/xhr"])}}),d},window);