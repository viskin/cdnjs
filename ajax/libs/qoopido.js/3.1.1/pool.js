(function(t,e){"use strict";function n(){return e.qoopido.initialize("pool",t,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/merge","./function/unique/uuid"],n):n()})(function(t){"use strict";function e(){var t,e,n,i=this,r=i.metrics,o=i._settings,u=i._queue,s=i._variables,a=1;if(u.length>0&&(s.durationAverage>0&&(a=~~(1>(a=o.frameBudget/s.durationAverage)?1:a)),(t=Math.min(u.length,(e=u.splice(0,a)).length))>0))if(r.inPool+t<=o.maxPoolsize){n=(new Date).getTime();for(var c=0;t>c;c++){var l=e[c],f=l._quid,d=l.dispose;l=i._dispose(l),l._quid=f,l.dispose=d,i._getPool.call(i,l).push(l)}r.inPool+=t,r.inQueue-=t,s.durationSamples+=t,s.durationTotal+=(new Date).getTime()-n,s.durationAverage=s.durationTotal/s.durationSamples}else{if("function"==typeof i._destroy)for(var p=0;t>p;p++)i._destroy(e[p]);e.length=0,r.inQueue-=t,r.destroyed+=t}}var n,i={interval:1e3/60,frameBudget:.5,maxPoolsize:1e3};return n=t.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var r=this;r.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},r._settings=t["function/merge"]({},i,n),r._pool=r._initPool(),r._queue=[],r._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){e.call(r)},r._settings.interval)},_initPool:function(){return[]},_initElement:function(e){var n=this;return e._quid=t["function/unique/uuid"](),e.dispose=function(){n.dispose(e)},n.metrics.total++,e},_getPool:function(){return this._pool},obtain:function(){var t=this,e=t._getPool.apply(t,arguments).pop();return e?(t.metrics.inPool--,t.metrics.recycled++):e=t._initElement(t._obtain.apply(t,arguments)),"function"==typeof e._obtain&&e._obtain.apply(e,arguments),t.metrics.inUse++,e},dispose:function(t){var e=this,n=e._queue;return t._quid||(t=e._initElement(t),e.metrics.inUse++),"function"==typeof t._dispose&&t._dispose(),n.push(t),e.metrics.inUse--,e.metrics.inQueue++,null}})},window);