(function(t,e){"use strict";function n(){return e.qoopido.initialize("transport/xhr",t,arguments,!0)}"function"==typeof define&&define.amd?define(["../transport","../function/merge","../function/unique/string","../url","q"],n):n()})(function(t,e,n,o,i,r){"use strict";function s(t,e,n){var o,i=this,r=i.xhr,s=i.settings;n="object"==typeof n?i.serialize(n):n,e=s.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=n&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",n):e;for(o in s.xhrOptions)r[o]=s.xhrOptions[o];if(r.open(t,e,s.async,s.username,s.password),r.setRequestHeader){r.setRequestHeader("Accept",s.accept),n&&"GET"!==t&&r.setRequestHeader("Content-Type",s.contentType);for(o in s.header)r.setRequestHeader(o,s.header[o])}r.timeout=s.timeout,r.onprogress=function(t){u.call(i,t)},r.onreadystatechange=r.onload=function(){a.call(i)},r.onerror=function(){c.call(i)},r.send(n||null),i.timeout=setTimeout(function(){l.call(i)},s.timeout)}function u(t){var e=this;e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){l.call(e)},e.settings.timeout),e.dfd.notify(t)}function a(){var t=this,e=t.xhr,n=t.dfd;(e.readyState===r||4===e.readyState)&&(f.call(t),e.status===r||200===e.status?n.resolve({data:e.responseText,xhr:e}):n.reject({status:e.status,xhr:e}))}function c(){var t=this;f.call(t),t.dfd.reject()}function l(){var t=this;t.xhr.abort(),f.call(t),t.dfd.reject()}function f(){var t=this,e=t.xhr;t.timeout&&clearTimeout(t.timeout),e.onprogress=e.onreadystatechange=e.onerror=null}var d,p=o.Q||e[4],m=o.XMLHttpRequest!==r?function(e){return t.url.isLocal(e)?new o.XMLHttpRequest:o.XDomainRequest?new o.XDomainRequest:new o.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return d=t.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(e,n,o,i){var r={};return n=t.url.resolve(n),r.url=n,r.id="".concat("xhr-",t["function/unique/string"]()),r.dfd=p.defer(),r.xhr=m(n),r.settings=t["function/merge"]({},this._settings,i),r.timeout=null,s.call(r,e.toUpperCase(),n,o),r.dfd.promise},get:function(t,e,n){return this.load("GET",t,e,n)},post:function(t,e,n){return this.load("POST",t,e,n)},put:function(t,e,n){return this.load("PUT",t,e,n)},"delete":function(t,e,n){return this.load("DELETE",t,e,n)},head:function(t,e,n){return this.load("HEAD",t,e,n)}})},window,document);