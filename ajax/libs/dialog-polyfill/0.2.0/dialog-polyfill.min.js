var dialogPolyfill=(function(){var b=(window.document.addEventListener?function(d,f,e){d.addEventListener(f,e)}:function(d,f,e){d.attachEvent("on"+f,e)});var a=(window.document.removeEventListener?function(d,f,e){d.removeEventListener(f,e)}:function(d,f,e){d.detachEvent("on"+f,e)});var c={};c.reposition=function(d){var f=document.body.scrollTop||document.documentElement.scrollTop;var e=f+(window.innerHeight-d.offsetHeight)/2;d.style.top=e+"px";d.dialogPolyfillInfo.isTopOverridden=true};c.inNodeList=function(d,f){for(var e=0;e<d.length;++e){if(d[e]==f){return true}}return false};c.isInlinePositionSetByStylesheet=function(g){for(var h=0;h<document.styleSheets.length;++h){var o=document.styleSheets[h];var l=null;try{l=o.cssRules}catch(k){}if(!l){continue}for(var f=0;f<l.length;++f){var n=l[f];var p=null;try{p=document.querySelectorAll(n.selectorText)}catch(k){}if(!p||!c.inNodeList(p,g)){continue}var d=n.style.getPropertyValue("top");var m=n.style.getPropertyValue("bottom");if((d&&d!="auto")||(m&&m!="auto")){return true}}}return false};c.needsCentering=function(e){var d=getComputedStyle(e);if(d.position!="absolute"){return false}if((e.style.top!="auto"&&e.style.top!="")||(e.style.bottom!="auto"&&e.style.bottom!="")){return false}return !c.isInlinePositionSetByStylesheet(e)};c.showDialog=function(e){if(this.open){throw"InvalidStateError: showDialog called on open dialog"}this.open=true;this.setAttribute("open","open");var d=null;var g=null;var f=function(h){for(var j=0;j<h.children.length;j++){var k=h.children[j];if(d===null&&!k.disabled&&(k.nodeName=="BUTTON"||k.nodeName=="INPUT"||k.nodeName=="KEYGEN"||k.nodeName=="SELECT"||k.nodeName=="TEXTAREA")){d=k}if(k.autofocus){g=k;return}f(k);if(g!==null){return}}};f(this);if(g!==null){g.focus()}else{if(d!==null){d.focus()}}if(c.needsCentering(this)){c.reposition(this)}if(e){this.dialogPolyfillInfo.modal=true;c.dm.pushDialog(this)}};c.close=function(d){if(!this.open){throw new InvalidStateError}this.open=false;this.removeAttribute("open");if(typeof d!="undefined"){this.returnValue=d}if(this.dialogPolyfillInfo.isTopOverridden){this.style.top="auto"}if(this.dialogPolyfillInfo.modal){c.dm.removeDialog(this)}var e;if(document.createEvent){e=document.createEvent("HTMLEvents");e.initEvent("close",true,true)}else{e=new Event("close")}this.dispatchEvent(e);return this.returnValue};c.registerDialog=function(d){if(d.show){console.warn("This browser already supports <dialog>, the polyfill may not work correctly.")}b(d,"dialog_submit",function(f){d.close(f.detail.target.value);f.preventDefault();f.stopPropagation()});d.show=c.showDialog.bind(d,false);d.showModal=c.showDialog.bind(d,true);d.close=c.close.bind(d);d.dialogPolyfillInfo={}};TOP_LAYER_ZINDEX=100000;MAX_PENDING_DIALOGS=100000;c.DialogManager=function(){this.pendingDialogStack=[];this.overlay=document.createElement("div");this.overlay.style.width="100%";this.overlay.style.height="100%";this.overlay.style.position="fixed";this.overlay.style.left="0px";this.overlay.style.top="0px";this.overlay.style.backgroundColor="rgba(0,0,0,0.0)";b(this.overlay,"click",function(d){var f=document.createEvent("MouseEvents");f.initMouseEvent(d.type,d.bubbles,d.cancelable,window,d.detail,d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget);document.body.dispatchEvent(f)});b(window,"load",function(){var d=document.getElementsByTagName("form");Array.prototype.forEach.call(d,function(e){if(e.getAttribute("method")=="dialog"){b(e,"click",function(g){if(g.target.type=="submit"){var f;if(CustomEvent){f=new CustomEvent("dialog_submit",{bubbles:true,detail:{target:g.target}})}else{f=document.createEvent("HTMLEvents");f.initEvent("dialog_submit",true,true);f.detail={target:g.target}}this.dispatchEvent(f);g.preventDefault()}})}})})};c.dm=new c.DialogManager();c.DialogManager.prototype.blockDocument=function(){if(!document.body.contains(this.overlay)){document.body.appendChild(this.overlay)}};c.DialogManager.prototype.unblockDocument=function(){document.body.removeChild(this.overlay)};c.DialogManager.prototype.updateStacking=function(){if(this.pendingDialogStack.length==0){this.unblockDocument();return}this.blockDocument();var f=TOP_LAYER_ZINDEX;for(var e=0;e<this.pendingDialogStack.length;e++){if(e==this.pendingDialogStack.length-1){this.overlay.style.zIndex=f++}var d=this.pendingDialogStack[e];d.dialogPolyfillInfo.backdrop.style.zIndex=f++;d.style.zIndex=f++}};c.DialogManager.prototype.cancelDialog=function(f){if(f.keyCode===27&&this.pendingDialogStack.length>0){f.preventDefault();f.stopPropagation();var e=this.pendingDialogStack.slice(-1)[0];var d;if(e){if(CustomEvent){d=new CustomEvent("cancel",{bubbles:false})}else{d=document.createEvent("HTMLEvents");d.initEvent("cancel",false,true)}if(e.dispatchEvent(d)){e.close()}}}};c.DialogManager.prototype.pushDialog=function(e){if(this.pendingDialogStack.length>=MAX_PENDING_DIALOGS){throw"Too many modal dialogs"}var d=document.createElement("div");d.classList.add("backdrop");b(d,"click",function(f){var g=document.createEvent("MouseEvents");g.initMouseEvent(f.type,f.bubbles,f.cancelable,window,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget);e.dispatchEvent(g)});e.parentNode.insertBefore(d,e.nextSibling);e.dialogPolyfillInfo.backdrop=d;this.pendingDialogStack.push(e);this.updateStacking()};c.DialogManager.prototype.removeDialog=function(f){var e=this.pendingDialogStack.indexOf(f);if(e==-1){return}this.pendingDialogStack.splice(e,1);var d=f.dialogPolyfillInfo.backdrop;d.parentNode.removeChild(d);f.dialogPolyfillInfo.backdrop=null;this.updateStacking()};b(document,"keydown",c.dm.cancelDialog.bind(c.dm));return c})();