var dialogPolyfill=function(){var a=window.CustomEvent;a||(a=function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail||null),c},a.prototype=window.Event.prototype);var b={};b.reposition=function(a){var b=document.body.scrollTop||document.documentElement.scrollTop,c=b+(window.innerHeight-a.offsetHeight)/2;a.style.top=Math.max(0,c)+"px",a.dialogPolyfillInfo.isTopOverridden=!0},b.inNodeList=function(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return!0;return!1},b.isInlinePositionSetByStylesheet=function(a){for(var c=0;c<document.styleSheets.length;++c){var d=document.styleSheets[c],e=null;try{e=d.cssRules}catch(f){}if(e)for(var g=0;g<e.length;++g){var h=e[g],i=null;try{i=document.querySelectorAll(h.selectorText)}catch(f){}if(i&&b.inNodeList(i,a)){var j=h.style.getPropertyValue("top"),k=h.style.getPropertyValue("bottom");if(j&&"auto"!=j||k&&"auto"!=k)return!0}}}return!1},b.needsCentering=function(a){var c=window.getComputedStyle(a);return"absolute"!=c.position?!1:"auto"!=a.style.top&&""!=a.style.top||"auto"!=a.style.bottom&&""!=a.style.bottom?!1:!b.isInlinePositionSetByStylesheet(a)},b.showDialog=function(a){if(this.open)throw"InvalidStateError: showDialog called on open dialog";if(this.open=!0,this.setAttribute("open","open"),a){var c=null,d=null,e=function(a){if(a.children)for(var b=0;b<a.children.length;b++){var f=a.children[b];if(null!==c||f.disabled||"BUTTON"!=f.nodeName&&"INPUT"!=f.nodeName&&"KEYGEN"!=f.nodeName&&"SELECT"!=f.nodeName&&"TEXTAREA"!=f.nodeName||(c=f),f.autofocus)return d=f,void 0;if(e(f),null!==d)return}};e(this),null!==d?d.focus():null!==c&&c.focus()}b.needsCentering(this)&&b.reposition(this),a&&(this.dialogPolyfillInfo.modal=!0,b.dm.pushDialog(this));try{null!==d?d.focus():null!==c&&c.focus()}catch(f){}this.style.zoom=1},b.close=function(a){if(!this.open&&!window.HTMLDialogElement)throw"InvalidStateError: close called on closed dialog";this.open=!1,this.removeAttribute("open"),"undefined"!=typeof a&&(this.returnValue=a),this.dialogPolyfillInfo.isTopOverridden&&(this.style.top="auto"),this.dialogPolyfillInfo.modal&&b.dm.removeDialog(this);var c;return document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent("close",!0,!0)):c=new Event("close"),this.dispatchEvent(c),this.returnValue},b.registerDialog=function(a){a.show&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly."),a.addEventListener("dialog_submit",function(b){a.close(b.detail.target.value),b.preventDefault(),b.stopPropagation()}),a.show=b.showDialog.bind(a,!1),a.showModal=b.showDialog.bind(a,!0),a.close=b.close.bind(a),a.dialogPolyfillInfo={}};var c=1e5,d=1e5;return b.DialogManager=function(){this.pendingDialogStack=[],this.overlay=document.createElement("div"),this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.position="fixed",this.overlay.style.left="0px",this.overlay.style.top="0px",this.overlay.style.backgroundColor="rgba(0,0,0,0.0)",this.focusPageLast=this.createFocusable(),this.overlay.appendChild(this.focusPageLast),this.overlay.addEventListener("click",function(a){var b=document.createEvent("MouseEvents");b.initMouseEvent(a.type,a.bubbles,a.cancelable,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget),document.body.dispatchEvent(b)}),window.addEventListener("load",function(){for(var b=document.getElementsByTagName("form"),c=b.length;c--;)!function(b){"dialog"==b.getAttribute("method")&&b.addEventListener("click",function(b){if("submit"==b.target.type){var c=new a("dialog_submit",{bubbles:!0,detail:{target:b.target}});this.dispatchEvent(c),b.preventDefault()}})}(b[c])})},b.DialogManager.prototype.createFocusable=function(a){var b=document.createElement("span");return b.tabIndex=a||0,b.style.opacity=0,b.style.position="static",b},b.DialogManager.prototype.blockDocument=function(){document.body.contains(this.overlay)||(document.body.appendChild(this.overlay),void 0===this.needsDocumentElementFocus&&(document.documentElement.focus(),this.needsDocumentElementFocus=document.activeElement!=document.documentElement),this.needsDocumentElementFocus&&(document.documentElement.tabIndex=1))},b.DialogManager.prototype.unblockDocument=function(){document.body.removeChild(this.overlay),this.needsDocumentElementFocus&&(document.documentElement.tabIndex="")},b.DialogManager.prototype.updateStacking=function(){if(0==this.pendingDialogStack.length)return this.unblockDocument(),void 0;this.blockDocument();for(var a=c,b=0;b<this.pendingDialogStack.length;b++){b==this.pendingDialogStack.length-1&&(this.overlay.style.zIndex=a++);var d=this.pendingDialogStack[b];d.dialogPolyfillInfo.backdrop.style.zIndex=a++,d.style.zIndex=a++}},b.DialogManager.prototype.handleKey=function(b){var c=this.pendingDialogStack.length;if(0!=c){var d=this.pendingDialogStack[c-1],e=d.dialogPolyfillInfo;switch(b.keyCode){case 9:var f=document.activeElement,g=!b.shiftKey;g?f==document.documentElement||f==document.body||f==e.backdrop?e.focusFirst.focus():f==e.focusLast&&e.focusFirst.focus():f==e.focusFirst?e.focusLast.focus():f==this.focusPageLast&&e.focusLast.focus();break;case 27:b.preventDefault(),b.stopPropagation();var h=new a("cancel",{bubbles:!1,cancelable:!0});d.dispatchEvent(h)&&d.close()}}},b.DialogManager.prototype.pushDialog=function(a){if(this.pendingDialogStack.length>=d)throw"Too many modal dialogs";var b=document.createElement("div");b.className="backdrop";var c=function(b){var c=document.createEvent("MouseEvents");c.initMouseEvent(b.type,b.bubbles,b.cancelable,window,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget),a.dispatchEvent(c)};b.addEventListener("click",c),a.parentNode.insertBefore(b,a.nextSibling),a.dialogPolyfillInfo.backdrop=b,a.dialogPolyfillInfo.clickEventListener=c,this.pendingDialogStack.push(a),this.updateStacking(),a.dialogPolyfillInfo.focusFirst=this.createFocusable(),a.dialogPolyfillInfo.focusLast=this.createFocusable(),a.appendChild(a.dialogPolyfillInfo.focusLast),a.insertBefore(a.dialogPolyfillInfo.focusFirst,a.firstChild)},b.DialogManager.prototype.removeDialog=function(a){var b=this.pendingDialogStack.indexOf(a);if(-1!=b){this.pendingDialogStack.splice(b,1);var c=a.dialogPolyfillInfo.backdrop,d=a.dialogPolyfillInfo.clickEventListener;c.removeEventListener("click",d),c.parentNode.removeChild(c),a.dialogPolyfillInfo.backdrop=null,a.dialogPolyfillInfo.clickEventListener=null,this.updateStacking(),a.removeChild(a.dialogPolyfillInfo.focusFirst),a.removeChild(a.dialogPolyfillInfo.focusLast),a.dialogPolyfillInfo.focusFirst=null,a.dialogPolyfillInfo.focusLast=null}},b.dm=new b.DialogManager,document.addEventListener("keydown",b.dm.handleKey.bind(b.dm)),b}();
