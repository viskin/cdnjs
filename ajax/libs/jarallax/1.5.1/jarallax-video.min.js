/*!
 * Name    : Video Worker (wrapper for Youtube and Vimeo)
 * Version : 1.0.0
 * Author  : _nK http://nkdev.info
 * GitHub  : https://github.com/nk-o/jarallax
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(t){"use strict";var i=function(){function e(e,o){var a=this;a.url=e,a.options_default={autoplay:1,loop:1,mute:1,controls:0},a.options=t.extend({},a.options_default,o),a.videoID=a.parseURL(e),a.videoID&&(a.ID=i++,a.loadAPI(),a.init())}var i=0;return e}();i.prototype.parseURL=function(e){function t(e){var t=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,i=e.match(t);return i&&11===i[1].length?i[1]:!1}function i(e){var t=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/,i=e.match(t);return i&&i[3]?i[3]:!1}var o=t(e),a=i(e);return o?(this.type="youtube",o):a?(this.type="vimeo",a):!1},i.prototype.isValid=function(){return!!this.videoID},i.prototype.on=function(e,t){this.userEventsList=this.userEventsList||[],(this.userEventsList[e]||(this.userEventsList[e]=[])).push(t)},i.prototype.off=function(e,t){if(this.userEventsList[e]&&this.userEventsList)if(t)for(var i=0;i<this.userEventsList[e].length;i++)this.userEventsList[e][i]===t&&(this.userEventsList[e][i]=!1);else delete this.userEventsList[e]},i.prototype.fire=function(e){var t=[].slice.call(arguments,1);if(this.userEventsList&&"undefined"!=typeof this.userEventsList[e])for(var i in this.userEventsList[e])this.userEventsList[e][i]&&this.userEventsList[e][i].apply(this,t)},i.prototype.play=function(){this.player&&("youtube"===this.type&&this.player.playVideo&&this.player.playVideo(),"vimeo"===this.type&&this.player.api("play"))},i.prototype.pause=function(){this.player&&("youtube"===this.type&&this.player.pauseVideo&&this.player.pauseVideo(),"vimeo"===this.type&&this.player.api("pause"))},i.prototype.getImageURL=function(e){var i=this;return i.videoImage?void e(i.videoImage):("youtube"===i.type&&(i.videoImage="https://img.youtube.com/vi/"+i.videoID+"/maxresdefault.jpg",e(i.videoImage)),void("vimeo"===i.type&&t.get("https://vimeo.com/api/v2/video/"+i.videoID+".json",function(t){i.videoImage=t[0].thumbnail_large,e(i.videoImage)})))},i.prototype.getIframe=function(i){var o=this;return o.$iframe?void i(o.$iframe):void o.onAPIready(function(){if("youtube"===o.type){o.playerOptions={},o.playerOptions.videoId=o.videoID,o.playerOptions.width=t(window).width(),o.playerOptions.playerVars={autohide:1,rel:0,autoplay:0},o.options.controls||(o.playerOptions.playerVars.iv_load_policy=3,o.playerOptions.playerVars.modestbranding=1,o.playerOptions.playerVars.controls=0,o.playerOptions.playerVars.showinfo=0,o.playerOptions.playerVars.disablekb=1);var a;o.playerOptions.events={onReady:function(e){o.options.mute&&e.target.mute(),o.options.autoplay&&o.play(),o.fire("ready",e)},onStateChange:function(e){o.options.loop&&e.data===YT.PlayerState.ENDED&&e.target.playVideo(),a||e.data!==YT.PlayerState.PLAYING||(a=1,o.fire("started",e))}},o.$iframe||t('<div style="display: none;"><div id="'+o.playerID+'"></div></div>').appendTo("body"),o.player=o.player||new window.YT.Player(o.playerID,o.playerOptions),o.$iframe=o.$iframe||t("#"+o.playerID)}if("vimeo"===o.type){if(o.playerOptions="",o.playerOptions+="player_id="+o.playerID,o.playerOptions+="&autopause=0",o.options.controls||(o.playerOptions+="&badge=0&byline=0&portrait=0&title=0"),o.playerOptions+="&autoplay=0",o.playerOptions+="&loop="+(o.options.loop?1:0),!o.$iframe){var r="https://player.vimeo.com/video/"+o.videoID+"?"+o.playerOptions;t('<div style="display: none;"><iframe id="'+o.playerID+'" src="'+r+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').appendTo("body")}o.$iframe=o.$iframe||t("#"+o.playerID),o.player=o.player||$f(o.$iframe[0]),o.player.addEvent("ready",function(){o.player.api("setVolume",o.options.mute?0:100),o.options.autoplay&&o.play();var t;o.player.addEvent("playProgress",function(e){t||o.fire("started",e),t=1}),o.fire("ready",e)})}i(o.$iframe)})},i.prototype.init=function(){var e=this;e.playerID="VideoWorker-"+e.ID};var o=0,a=0;i.prototype.loadAPI=function(){var e=this;if(!o||!a){var t="";"youtube"!==e.type||o||(o=1,t="//www.youtube.com/iframe_api"),"vimeo"!==e.type||a||(a=1,t="//f.vimeocdn.com/js/froogaloop2.min.js"),"file://"===window.location.origin&&(t="http:"+t);var i=document.createElement("script"),r=document.getElementsByTagName("head")[0];i.src=t,r.appendChild(i),r=null,i=null}};var r=0,n=0,p=t.Deferred(),s=t.Deferred();i.prototype.onAPIready=function(e){var t=this;if("youtube"===t.type&&("undefined"!=typeof YT&&0!==YT.loaded||r?"object"==typeof YT&&1===YT.loaded?e():p.done(function(){e()}):(r=1,window.onYouTubeIframeAPIReady=function(){window.onYouTubeIframeAPIReady=null,p.resolve("done"),e()})),"vimeo"===t.type)if("undefined"!=typeof $f||n)"undefined"!=typeof $f?e():s.done(function(){e()});else{n=1;var i=setInterval(function(){"undefined"!=typeof $f&&(clearInterval(i),s.resolve("done"),e())},20)}},window.VideoWorker=i}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";var t=e.fn.jarallax.constructor,i=t.prototype.init;t.prototype.init=function(){var t=this;i.apply(t),t.video&&t.video.getIframe(function(i){t.$video=e(i).css({position:"fixed",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",visibility:"visible",zIndex:-1}).appendTo(t.image.$container)})};var o=t.prototype.coverImage;t.prototype.coverImage=function(){var e=this;o.apply(e),e.video&&e.image.$item.is("iframe")&&e.image.$item.css({height:e.image.$item.height()+400,top:-200})};var a=t.prototype.initImg;t.prototype.initImg=function(){var t=this;if(t.options.videoSrc||(t.options.videoSrc=t.$item.attr("data-jarallax-video")||!1),t.options.videoSrc){var i=new VideoWorker(t.options.videoSrc);return i.isValid()&&(t.image.useImgTag=!0,i.on("ready",function(){function o(){t.isVisible()?i.play():i.pause()}e(window).on("DOMContentLoaded.jarallax-"+t.instanceID+" load.jarallax-"+t.instanceID+" resize.jarallax-"+t.instanceID+" scroll.jarallax-"+t.instanceID,o),o()}),i.on("started",function(){t.image.$default_item=t.image.$item,t.image.$item=t.$video,t.image.width=t.imgWidth=1280,t.image.height=t.imgHeight=720,t.coverImage(),t.clipContainer(),t.onScroll(),t.image.$default_item&&t.image.$default_item.fadeOut(500)}),t.video=i,i.getImageURL(function(e){t.image.src=e,t.init()})),!1}return a.apply(t)};var r=t.prototype.destroy;t.prototype.destroy=function(){var t=this;e(window).off(".jarallax-"+t.instanceID),r.apply(t)}});
