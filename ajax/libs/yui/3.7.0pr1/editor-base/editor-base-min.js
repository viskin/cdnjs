YUI.add("editor-base",function(e,c){var d=function(){d.superclass.constructor.apply(this,arguments);},b=":last-child",a="body";e.extend(d,e.Base,{frame:null,initializer:function(){var f=new e.Frame({designMode:true,title:d.STRINGS.title,use:d.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock"),host:this}).plug(e.Plugin.ExecCommand);f.after("ready",e.bind(this._afterFrameReady,this));f.addTarget(this);this.frame=f;this.publish("nodeChange",{emitFacade:true,bubbles:true,defaultFn:this._defNodeChangeFn});},destructor:function(){this.frame.destroy();this.detachAll();},copyStyles:function(i,h){if(i.test("a")){return;}var f=["color","fontSize","fontFamily","backgroundColor","fontStyle"],g={};e.each(f,function(j){g[j]=i.getStyle(j);});if(i.ancestor("b,strong")){g.fontWeight="bold";}if(i.ancestor("u")){if(!g.textDecoration){g.textDecoration="underline";}}h.setStyles(g);},_lastBookmark:null,_resolveChangedNode:function(k){var j=this.getInstance(),g,f,i;if(k&&k.test(a)){var h=new j.EditorSelection();if(h&&h.anchorNode){k=h.anchorNode;}}if(j&&k&&k.test("html")){g=j.one(a).one(b);while(!i){if(g){f=g.one(b);if(f){g=f;}else{i=true;}}else{i=true;}}if(g){if(g.test("br")){if(g.previous()){g=g.previous();}else{g=g.get("parentNode");}}if(g){k=g;}}}if(!k){k=j.one(a);}return k;},_defNodeChangeFn:function(t){var j=(new Date()).getTime();var q=this.getInstance(),i,u,p=q.EditorSelection.DEFAULT_BLOCK_TAG;if(e.UA.ie){try{i=q.config.doc.selection.createRange();if(i.getBookmark){this._lastBookmark=i.getBookmark();}}catch(g){}}t.changedNode=this._resolveChangedNode(t.changedNode);switch(t.changedType){case"keydown":if(!e.UA.gecko){if(!d.NC_KEYS[t.changedEvent.keyCode]&&!t.changedEvent.shiftKey&&!t.changedEvent.ctrlKey&&(t.changedEvent.keyCode!==13)){}}break;case"tab":if(!t.changedNode.test("li, li *")&&!t.changedEvent.shiftKey){t.changedEvent.frameEvent.preventDefault();if(e.UA.webkit){this.execCommand("inserttext","\t");}else{if(e.UA.gecko){this.frame.exec._command("inserthtml",d.TABKEY);}else{if(e.UA.ie){this.execCommand("inserthtml",d.TABKEY);}}}}break;case"backspace-up":if(e.UA.webkit&&t.changedNode){t.changedNode.set("innerHTML",t.changedNode.get("innerHTML"));}break;}if(e.UA.webkit&&t.commands&&(t.commands.indent||t.commands.outdent)){var v=q.all(".webkit-indent-blockquote, blockquote");if(v.size()){v.setStyle("margin","");}}var o=this.getDomPath(t.changedNode,false),f={},n,h,l=[],m="",k="";if(t.commands){f=t.commands;}var s=false;e.each(o,function(B){var x=B.tagName.toLowerCase(),C=d.TAG2CMD[x];if(C){f[C]=1;}var A=B.currentStyle||B.style;if((""+A.fontWeight)=="normal"){s=true;}if((""+A.fontWeight)=="bold"){f.bold=1;}if(e.UA.ie){if(A.fontWeight>400){f.bold=1;}}if(A.fontStyle=="italic"){f.italic=1;}if(A.textDecoration.indexOf("underline")>-1){f.underline=1;}if(A.textDecoration.indexOf("line-through")>-1){f.strikethrough=1;}var D=q.one(B);if(D.getStyle("fontFamily")){var z=D.getStyle("fontFamily").split(",")[0].toLowerCase();if(z){n=z;}if(n){n=n.replace(/'/g,"").replace(/"/g,"");}}h=d.NORMALIZE_FONTSIZE(D);var y=B.className.split(" ");e.each(y,function(E){if(E!==""&&(E.substr(0,4)!=="yui_")){l.push(E);}});m=d.FILTER_RGB(D.getStyle("color"));var w=d.FILTER_RGB(A.backgroundColor);if(w!=="transparent"){if(w!==""){k=w;}}});if(s){delete f.bold;delete f.italic;}t.dompath=q.all(o);t.classNames=l;t.commands=f;if(!t.fontFamily){t.fontFamily=n;}if(!t.fontSize){t.fontSize=h;}if(!t.fontColor){t.fontColor=m;}if(!t.backgroundColor){t.backgroundColor=k;}var r=(new Date()).getTime();},getDomPath:function(h,f){var j=[],g,i=this.frame.getInstance();g=i.Node.getDOMNode(h);while(g!==null){if((g===i.config.doc.documentElement)||(g===i.config.doc)||!g.tagName){g=null;break;}if(!i.DOM.inDoc(g)){g=null;break;}if(g.nodeName&&g.nodeType&&(g.nodeType==1)){j.push(g);}if(g==i.config.doc.body){g=null;break;}g=g.parentNode;}if(j.length===0){j[0]=i.config.doc.body;}if(f){return i.all(j.reverse());}else{return j.reverse();}},_afterFrameReady:function(){var f=this.frame.getInstance();this.frame.on("dom:mouseup",e.bind(this._onFrameMouseUp,this));this.frame.on("dom:mousedown",e.bind(this._onFrameMouseDown,this));this.frame.on("dom:keydown",e.bind(this._onFrameKeyDown,this));if(e.UA.ie){this.frame.on("dom:activate",e.bind(this._onFrameActivate,this));this.frame.on("dom:beforedeactivate",e.bind(this._beforeFrameDeactivate,this));}this.frame.on("dom:keyup",e.bind(this._onFrameKeyUp,this));this.frame.on("dom:keypress",e.bind(this._onFrameKeyPress,this));this.frame.on("dom:paste",e.bind(this._onPaste,this));f.EditorSelection.filter();this.fire("ready");},_beforeFrameDeactivate:function(h){if(h.frameTarget.test("html")){return;}var g=this.getInstance(),f=g.config.doc.selection.createRange();if(f.compareEndPoints&&!f.compareEndPoints("StartToEnd",f)){f.pasteHTML('<var id="yui-ie-cursor">');}},_onFrameActivate:function(i){if(i.frameTarget.test("html")){return;}var h=this.getInstance(),g=new h.EditorSelection(),f=g.createRange(),j=h.all("#yui-ie-cursor");if(j.size()){j.each(function(m){m.set("id","");if(f.moveToElementText){try{f.moveToElementText(m._node);var k=f.move("character",-1);if(k===-1){f.move("character",1);}f.select();f.text="";}catch(l){}}m.remove();});}},_onPaste:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"paste",changedEvent:f.frameEvent});},_onFrameMouseUp:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mouseup",changedEvent:f.frameEvent});},_onFrameMouseDown:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mousedown",changedEvent:f.frameEvent});},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(h){var g,f;if(!this._currentSelection){if(this._currentSelectionTimer){this._currentSelectionTimer.cancel();}this._currentSelectionTimer=e.later(850,this,function(){this._currentSelectionClear=true;});g=this.frame.getInstance();f=new g.EditorSelection(h);
this._currentSelection=f;}else{f=this._currentSelection;}g=this.frame.getInstance();f=new g.EditorSelection();this._currentSelection=f;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keydown",changedEvent:h.frameEvent});if(d.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:d.NC_KEYS[h.keyCode],changedEvent:h.frameEvent});this.fire("nodeChange",{changedNode:f.anchorNode,changedType:d.NC_KEYS[h.keyCode]+"-down",changedEvent:h.frameEvent});}}},_onFrameKeyPress:function(g){var f=this._currentSelection;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keypress",changedEvent:g.frameEvent});if(d.NC_KEYS[g.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:d.NC_KEYS[g.keyCode]+"-press",changedEvent:g.frameEvent});}}},_onFrameKeyUp:function(h){var g=this.frame.getInstance(),f=new g.EditorSelection(h);if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keyup",selection:f,changedEvent:h.frameEvent});if(d.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:d.NC_KEYS[h.keyCode]+"-up",selection:f,changedEvent:h.frameEvent});}}if(this._currentSelectionClear){this._currentSelectionClear=this._currentSelection=null;}},execCommand:function(j,l){var g=this.frame.execCommand(j,l),i=this.frame.getInstance(),h=new i.EditorSelection(),f={},k={changedNode:h.anchorNode,changedType:"execcommand",nodes:g};switch(j){case"forecolor":k.fontColor=l;break;case"backcolor":k.backgroundColor=l;break;case"fontsize":k.fontSize=l;break;case"fontname":k.fontFamily=l;break;}f[j]=1;k.commands=f;this.fire("nodeChange",k);return g;},getInstance:function(){return this.frame.getInstance();},render:function(f){this.frame.set("content",this.get("content"));this.frame.render(f);return this;},focus:function(f){this.frame.focus(f);return this;},show:function(){this.frame.show();return this;},hide:function(){this.frame.hide();return this;},getContent:function(){var f="",g=this.getInstance();if(g&&g.EditorSelection){f=g.EditorSelection.unfilter();}f=f.replace(/ _yuid="([^>]*)"/g,"");return f;}},{NORMALIZE_FONTSIZE:function(h){var f=h.getStyle("fontSize"),g=f;switch(f){case"-webkit-xxx-large":f="48px";break;case"xx-large":f="32px";break;case"x-large":f="24px";break;case"large":f="18px";break;case"medium":f="16px";break;case"small":f="13px";break;case"x-small":f="10px";break;}if(g!==f){h.setStyle("fontSize",f);}return f;},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(i){if(i.toLowerCase().indexOf("rgb")!=-1){var l=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi");var h=i.replace(l,"$1,$2,$3,$4,$5").split(",");if(h.length==5){var k=parseInt(h[1],10).toString(16);var j=parseInt(h[2],10).toString(16);var f=parseInt(h[3],10).toString(16);k=k.length==1?"0"+k:k;j=j.length==1?"0"+j:j;f=f.length==1?"0"+f:f;i="#"+k+j+f;}}return i;},TAG2CMD:{"b":"bold","strong":"bold","i":"italic","em":"italic","u":"underline","sup":"superscript","sub":"subscript","img":"insertimage","a":"createlink","ul":"insertunorderedlist","ol":"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["substitute","node","selector-css3","editor-selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{value:'<br class="yui-cursor">',setter:function(f){if(f.substr(0,1)==="\n"){f=f.substr(1);}if(f===""){f='<br class="yui-cursor">';}if(f===" "){if(e.UA.gecko){f='<br class="yui-cursor">';}}return this.frame.set("content",f);},getter:function(){return this.frame.get("content");}},dir:{writeOnce:true,value:"ltr"},linkedcss:{value:"",setter:function(f){if(this.frame){this.frame.set("linkedcss",f);}return f;}},extracss:{value:false,setter:function(f){if(this.frame){this.frame.set("extracss",f);}return f;}},defaultblock:{value:"p"}}});e.EditorBase=d;},"@VERSION@",{"requires":["base","frame","node","exec-command","editor-selection"]});