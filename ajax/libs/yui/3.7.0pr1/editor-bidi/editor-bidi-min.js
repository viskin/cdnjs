YUI.add("editor-bidi",function(a,j){var c=function(){c.superclass.constructor.apply(this,arguments);},i="host",h="dir",f="BODY",d="nodeChange",e="bidiContextChange",b=f+" > p",g="style";a.extend(c,a.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var l=this.get(i),n=l.getInstance(),m=new n.EditorSelection(),k,o;if(m.isCollapsed){k=c.blockParent(m.focusNode);if(k){o=k.getStyle("direction");if(o!==this.lastDirection){l.fire(e,{changedTo:o});this.lastDirection=o;}}}else{l.fire(e,{changedTo:"select"});this.lastDirection=null;}},_afterNodeChange:function(k){if(this.firstEvent||c.EVENTS[k.changedType]){this._checkForChange();this.firstEvent=false;}},_afterMouseUp:function(k){this._checkForChange();this.firstEvent=false;},initializer:function(){var k=this.get(i);this.firstEvent=true;k.after(d,a.bind(this._afterNodeChange,this));k.after("dom:mouseup",a.bind(this._afterMouseUp,this));}},{EVENTS:{"backspace-up":true,"pageup-up":true,"pagedown-down":true,"end-up":true,"home-up":true,"left-up":true,"up-up":true,"right-up":true,"down-up":true,"delete-up":true},BLOCKS:a.EditorSelection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(m,l){var k=m,o,n;if(!k){k=a.one(f);}if(!k.test(c.BLOCKS)){k=k.ancestor(c.BLOCKS);}if(l&&k.test(f)){o=a.Node.create(c.DIV_WRAPPER);k.get("children").each(function(q,p){if(p===0){n=q;}else{o.append(q);}});n.replace(o);o.prepend(n);k=o;}return k;},_NODE_SELECTED:"bidiSelected",addParents:function(n){var k,m,l;for(k=0;k<n.length;k+=1){n[k].setData(c._NODE_SELECTED,true);}for(k=0;k<n.length;k+=1){m=n[k].get("parentNode");if(!m.test(f)&&!m.getData(c._NODE_SELECTED)){l=true;m.get("children").some(function(o){if(!o.getData(c._NODE_SELECTED)){l=false;return true;}});if(l){n.push(m);m.setData(c._NODE_SELECTED,true);}}}for(k=0;k<n.length;k+=1){n[k].clearData(c._NODE_SELECTED);}return n;},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:false}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(k){if(k){if(k.getAttribute(g).match(c.RE_TEXT_ALIGN)){k.setAttribute(g,k.getAttribute(g).replace(c.RE_TEXT_ALIGN,""));}if(k.hasAttribute("align")){k.removeAttribute("align");}}return k;}});a.namespace("Plugin");a.Plugin.EditorBidi=c;a.Plugin.ExecCommand.COMMANDS.bidi=function(n,t){var q=this.getInstance(),l=new q.EditorSelection(),s=this.get(i).get(i).editorBidi,k,o,p,u,m;if(!s){a.error("bidi execCommand is not available without the EditorBiDi plugin.");return;}q.EditorSelection.filterBlocks();if(l.isCollapsed){o=c.blockParent(l.anchorNode);if(!o){o=q.one("body").one(q.EditorSelection.BLOCKS);}o=c.removeTextAlign(o);if(!t){m=o.getAttribute(h);if(!m||m=="ltr"){t="rtl";}else{t="ltr";}}o.setAttribute(h,t);if(a.UA.ie){var r=o.all("br.yui-cursor");if(r.size()===1&&o.get("childNodes").size()==1){r.remove();}}k=o;}else{p=l.getSelected();u=[];p.each(function(v){u.push(c.blockParent(v));});u=q.all(c.addParents(u));u.each(function(w){var v=t;w=c.removeTextAlign(w);if(!v){m=w.getAttribute(h);if(!m||m=="ltr"){v="rtl";}else{v="ltr";}}w.setAttribute(h,v);});k=u;}s._checkForChange();return k;};},"@VERSION@",{"requires":["editor-base"]});