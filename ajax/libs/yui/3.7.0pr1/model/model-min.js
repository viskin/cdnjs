YUI.add("model",function(a,k){var i=YUI.namespace("Env.Model"),f=a.Lang,j=a.Array,h=a.Object,g="change",d="error",e="load",c="save";function b(){b.superclass.constructor.apply(this,arguments);}a.Model=a.extend(b,a.Base,{idAttribute:"id",_allowAdHocAttrs:true,_isYUIModel:true,initializer:function(l){this.changed={};this.lastChange={};this.lists=[];},destroy:function(m,n){var l=this;if(typeof m==="function"){n=m;m=null;}l.onceAfter("destroy",function(){function o(p){if(!p){j.each(l.lists.concat(),function(q){q.remove(l,m);});}n&&n.apply(null,arguments);}if(m&&(m.remove||m["delete"])){l.sync("delete",m,o);}else{o();}});return b.superclass.destroy.call(l);},generateClientId:function(){i.lastId||(i.lastId=0);return this.constructor.NAME+"_"+(i.lastId+=1);},getAsHTML:function(l){var m=this.get(l);return a.Escape.html(f.isValue(m)?String(m):"");},getAsURL:function(l){var m=this.get(l);return encodeURIComponent(f.isValue(m)?String(m):"");},isModified:function(){return this.isNew()||!h.isEmpty(this.changed);},isNew:function(){return !f.isValue(this.get("id"));},load:function(m,n){var l=this;if(typeof m==="function"){n=m;m={};}m||(m={});l.sync("read",m,function(r,p){var q={options:m,response:p},o;if(r){q.error=r;q.src="load";l.fire(d,q);}else{if(!l._loadEvent){l._loadEvent=l.publish(e,{preventable:false});}o=q.parsed=l._parse(p);l.setAttrs(o,m);l.changed={};l.fire(e,q);}n&&n.apply(null,arguments);});return l;},parse:function(l){if(typeof l==="string"){try{return a.JSON.parse(l);}catch(m){this.fire(d,{error:m,response:l,src:"parse"});return null;}}return l;},save:function(m,n){var l=this;if(typeof m==="function"){n=m;m={};}m||(m={});l._validate(l.toJSON(),function(o){if(o){n&&n.call(null,o);return;}l.sync(l.isNew()?"create":"update",m,function(s,q){var r={options:m,response:q},p;if(s){r.error=s;r.src="save";l.fire(d,r);}else{if(!l._saveEvent){l._saveEvent=l.publish(c,{preventable:false});}if(q){p=r.parsed=l._parse(q);l.setAttrs(p,m);}l.changed={};l.fire(c,r);}n&&n.apply(null,arguments);});});return l;},set:function(n,o,m){var l={};l[n]=o;return this.setAttrs(l,m);},setAttrs:function(l,m){var p=this.idAttribute,s,q,n,o,r;m||(m={});r=m._transaction={};if(p!=="id"){l=a.merge(l);if(h.owns(l,p)){l.id=l[p];}else{if(h.owns(l,"id")){l[p]=l.id;}}}for(n in l){if(h.owns(l,n)){this._setAttr(n,l[n],m);}}if(!h.isEmpty(r)){s=this.changed;o=this.lastChange={};for(n in r){if(h.owns(r,n)){q=r[n];s[n]=q.newVal;o[n]={newVal:q.newVal,prevVal:q.prevVal,src:q.src||null};}}if(!m.silent){if(!this._changeEvent){this._changeEvent=this.publish(g,{preventable:false});}this.fire(g,a.merge(m,{changed:o}));}}return this;},sync:function(){var l=j(arguments,0,true).pop();if(typeof l==="function"){l();}},toJSON:function(){var l=this.getAttrs();delete l.clientId;delete l.destroyed;delete l.initialized;if(this.idAttribute!=="id"){delete l.id;}return l;},undo:function(q,m){var p=this.lastChange,o=this.idAttribute,l={},n;q||(q=h.keys(p));j.each(q,function(r){if(h.owns(p,r)){r=r===o?"id":r;n=true;l[r]=p[r].prevVal;}});return n?this.setAttrs(l,m):this;},validate:function(l,m){m&&m();},addAttr:function(m,l,o){var p=this.idAttribute,n,q;if(p&&m===p){n=this._isLazyAttr("id")||this._getAttrCfg("id");q=l.value===l.defaultValue?null:l.value;if(!f.isValue(q)){q=n.value===n.defaultValue?null:n.value;if(!f.isValue(q)){q=f.isValue(l.defaultValue)?l.defaultValue:n.defaultValue;}}l.value=q;if(n.value!==q){n.value=q;if(this._isLazyAttr("id")){this._state.add("id","lazy",n);}else{this._state.add("id","value",q);}}}return b.superclass.addAttr.apply(this,arguments);},_parse:function(l){return this.parse(l);},_validate:function(m,o){var l=this;function n(p){if(f.isValue(p)){l.fire(d,{attributes:m,error:p,src:"validate"});o(p);return;}o();}if(l.validate.length===1){n(l.validate(m,n));}else{l.validate(m,n);}},_defAttrChangeFn:function(m){var l=m.attrName;if(!this._setAttrVal(l,m.subAttrName,m.prevVal,m.newVal)){m.stopImmediatePropagation();}else{m.newVal=this.get(l);if(m._transaction){m._transaction[l]=m;}}}},{NAME:"model",ATTRS:{clientId:{valueFn:"generateClientId",readOnly:true},id:{value:null}}});},"@VERSION@",{"requires":["base-build","escape","json-parse"]});