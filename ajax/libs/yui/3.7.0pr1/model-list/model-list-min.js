YUI.add("model-list",function(b,l){var g=b.Attribute.prototype,j=b.Lang,k=b.Array,c="add",e="create",h="error",i="load",d="remove",f="reset";function a(){a.superclass.constructor.apply(this,arguments);}b.ModelList=b.extend(a,b.Base,{model:b.Model,_isYUIModelList:true,initializer:function(n){n||(n={});var m=this.model=n.model||this.model;if(typeof m==="string"){this.model=b.Object.getValue(b,m.split("."));if(!this.model){b.error("ModelList: Model class not found: "+m);}}this.publish(c,{defaultFn:this._defAddFn});this.publish(f,{defaultFn:this._defResetFn});this.publish(d,{defaultFn:this._defRemoveFn});this.after("*:idChange",this._afterIdChange);this._clear();if(n.items){this.add(n.items,{silent:true});}},destructor:function(){this._clear();},add:function(o,m){var n=o._isYUIModelList;if(n||j.isArray(o)){return k.map(n?o.toArray():o,function(q,p){var r=m||{};if("index" in r){r=b.merge(r,{index:r.index+p});}return this._add(q,r);},this);}else{return this._add(o,m);}},create:function(o,n,p){var m=this;if(typeof n==="function"){p=n;n={};}n||(n={});if(!o._isYUIModel){o=new this.model(o);}m.fire(e,b.merge(n,{model:o}));return o.save(n,function(q){if(!q){m.add(o,n);}p&&p.apply(null,arguments);});},each:function(r,q){var n=this._items.concat(),o,p,m;for(o=0,m=n.length;o<m;o++){p=n[o];r.call(q||p,p,o,this);}return this;},filter:function(p,t){var o=[],n=this._items,q,r,m,s;if(typeof p==="function"){t=p;p={};}for(q=0,m=n.length;q<m;++q){r=n[q];if(t.call(this,r,q,this)){o.push(r);}}if(p.asList){s=new this.constructor({model:this.model});if(o.length){s.add(o,{silent:true});}return s;}else{return o;}},get:function(m){if(this.attrAdded(m)){return g.get.apply(this,arguments);}return this.invoke("get",m);},getAsHTML:function(m){if(this.attrAdded(m)){return b.Escape.html(g.get.apply(this,arguments));}return this.invoke("getAsHTML",m);},getAsURL:function(m){if(this.attrAdded(m)){return encodeURIComponent(g.get.apply(this,arguments));}return this.invoke("getAsURL",m);},getByClientId:function(m){return this._clientIdMap[m]||null;},getById:function(m){return this._idMap[m]||null;},invoke:function(n){var m=[this._items,n].concat(k(arguments,1,true));return k.invoke.apply(k,m);},load:function(n,o){var m=this;if(typeof n==="function"){o=n;n={};}n||(n={});this.sync("read",n,function(s,q){var r={options:n,response:q},p;if(s){r.error=s;r.src="load";m.fire(h,r);}else{if(!m._loadEvent){m._loadEvent=m.publish(i,{preventable:false});}p=r.parsed=m._parse(q);m.reset(p,n);m.fire(i,r);}o&&o.apply(null,arguments);});return this;},map:function(m,n){return k.map(this._items,m,n);},parse:function(m){if(typeof m==="string"){try{return b.JSON.parse(m)||[];}catch(n){this.fire(h,{error:n,response:m,src:"parse"});return null;}}return m||[];},remove:function(o,m){var n=o._isYUIModelList;if(n||j.isArray(o)){o=k.map(n?o.toArray():o,function(p){if(j.isNumber(p)){return this.item(p);}return p;},this);return k.map(o,function(p){return this._remove(p,m);},this);}else{return this._remove(o,m);}},reset:function(o,m){o||(o=[]);m||(m={});var n=b.merge({src:"reset"},m);if(o._isYUIModelList){o=o.toArray();}else{o=k.map(o,function(p){return p._isYUIModel?p:new this.model(p);},this);}n.models=o;if(m.silent){this._defResetFn(n);}else{if(this.comparator){o.sort(b.bind(this._sort,this));}this.fire(f,n);}return this;},some:function(r,q){var n=this._items.concat(),o,p,m;for(o=0,m=n.length;o<m;o++){p=n[o];if(r.call(q||p,p,o,this)){return true;}}return false;},sort:function(m){if(!this.comparator){return this;}var o=this._items.concat(),n;m||(m={});o.sort(b.bind(this._sort,this));n=b.merge(m,{models:o,src:"sort"});m.silent?this._defResetFn(n):this.fire(f,n);return this;},sync:function(){var m=k(arguments,0,true).pop();if(typeof m==="function"){m();}},toArray:function(){return this._items.concat();},toJSON:function(){return this.map(function(m){return m.toJSON();});},_add:function(n,m){var o,p;m||(m={});if(!n._isYUIModel){n=new this.model(n);}p=n.get("id");if(this._clientIdMap[n.get("clientId")]||(j.isValue(p)&&this._idMap[p])){this.fire(h,{error:"Model is already in the list.",model:n,src:"add"});return;}o=b.merge(m,{index:"index" in m?m.index:this._findIndex(n),model:n});m.silent?this._defAddFn(o):this.fire(c,o);return n;},_attachList:function(m){m.lists.push(this);m.addTarget(this);},_clear:function(){k.each(this._items,this._detachList,this);this._clientIdMap={};this._idMap={};this._items=[];},_compare:function(n,m){return n<m?-1:(n>m?1:0);},_detachList:function(n){var m=k.indexOf(n.lists,this);if(m>-1){n.lists.splice(m,1);n.removeTarget(this);}},_findIndex:function(p){var n=this._items,m=n.length,q=0,r,o,s;if(!this.comparator||!m){return m;}s=this.comparator(p);while(q<m){o=(q+m)>>1;r=n[o];if(this._compare(this.comparator(r),s)<0){q=o+1;}else{m=o;}}return q;},_parse:function(m){return this.parse(m);},_remove:function(o,n){var m,p;n||(n={});if(j.isNumber(o)){m=o;o=this.item(m);}else{m=this.indexOf(o);}if(m===-1||!o){this.fire(h,{error:"Model is not in the list.",index:m,model:o,src:"remove"});return;}p=b.merge(n,{index:m,model:o});n.silent?this._defRemoveFn(p):this.fire(d,p);return o;},_sort:function(n,m){return this._compare(this.comparator(n),this.comparator(m));},_afterIdChange:function(o){var m=o.newVal,p=o.prevVal,n=o.target;if(j.isValue(p)){if(this._idMap[p]===n){delete this._idMap[p];}else{return;}}else{if(this.indexOf(n)===-1){return;}}if(j.isValue(m)){this._idMap[m]=n;}},_defAddFn:function(n){var m=n.model,o=m.get("id");this._clientIdMap[m.get("clientId")]=m;if(j.isValue(o)){this._idMap[o]=m;}this._attachList(m);this._items.splice(n.index,0,m);},_defRemoveFn:function(n){var m=n.model,o=m.get("id");this._detachList(m);delete this._clientIdMap[m.get("clientId")];if(j.isValue(o)){delete this._idMap[o];}this._items.splice(n.index,1);},_defResetFn:function(m){if(m.src==="sort"){this._items=m.models.concat();return;}this._clear();if(m.models.length){this.add(m.models,{silent:true});}}},{NAME:"modelList"});b.augment(a,b.ArrayList);},"@VERSION@",{"requires":["array-extras","array-invoke","arraylist","base-build","escape","json-parse","model"]});
