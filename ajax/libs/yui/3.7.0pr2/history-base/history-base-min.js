YUI.add("history-base",function(b,o){var i=b.Lang,e=b.Object,l=YUI.namespace("Env.History"),m=b.Array,n=b.config.doc,f=n.documentMode,j=b.config.win,c={merge:true},h="change",a="add",g="replace";function d(){this._init.apply(this,arguments);}b.augment(d,b.EventTarget,null,null,{emitFacade:true,prefix:"history",preventable:false,queueable:true});if(!l._state){l._state={};}function k(p){return i.type(p)==="object";}d.NAME="historyBase";d.SRC_ADD=a;d.SRC_REPLACE=g;d.html5=!!(j.history&&j.history.pushState&&j.history.replaceState&&("onpopstate" in j||b.UA.gecko>=2)&&(!b.UA.android||b.UA.android>=2.4));d.nativeHashChange=("onhashchange" in j||"onhashchange" in n)&&(!f||f>7);b.mix(d.prototype,{_init:function(q){var p;q=this._config=q||{};this.force=!!q.force;p=this._initialState=this._initialState||q.initialState||null;this.publish(h,{broadcast:2,defaultFn:this._defChangeFn});if(p){this.replace(p);}},add:function(){var p=m(arguments,0,true);p.unshift(a);return this._change.apply(this,p);},addValue:function(q,s,p){var r={};r[q]=s;return this._change(a,r,p);},get:function(q){var r=l._state,p=k(r);if(q){return p&&e.owns(r,q)?r[q]:undefined;}else{return p?b.mix({},r,true):r;}},replace:function(){var p=m(arguments,0,true);p.unshift(g);return this._change.apply(this,p);},replaceValue:function(q,s,p){var r={};r[q]=s;return this._change(g,r,p);},_change:function(r,q,p){p=p?b.merge(c,p):c;if(p.merge&&k(q)&&k(l._state)){q=b.merge(l._state,q);}this._resolveChanges(r,q,p);return this;},_fireEvents:function(r,q,p){this.fire(h,{_options:p,changed:q.changed,newVal:q.newState,prevVal:q.prevState,removed:q.removed,src:r});e.each(q.changed,function(t,s){this._fireChangeEvent(r,s,t);},this);e.each(q.removed,function(t,s){this._fireRemoveEvent(r,s,t);},this);},_fireChangeEvent:function(r,p,q){this.fire(p+"Change",{newVal:q.newVal,prevVal:q.prevVal,src:r});},_fireRemoveEvent:function(r,p,q){this.fire(p+"Remove",{prevVal:q,src:r});},_resolveChanges:function(v,t,q){var u={},p,s=l._state,r={};t||(t={});q||(q={});if(k(t)&&k(s)){e.each(t,function(w,x){var y=s[x];if(w!==y){u[x]={newVal:w,prevVal:y};p=true;}},this);e.each(s,function(x,w){if(!e.owns(t,w)||t[w]===null){delete t[w];r[w]=x;p=true;}},this);}else{p=t!==s;}if(p||this.force){this._fireEvents(v,{changed:u,newState:t,prevState:s,removed:r},q);}},_storeState:function(q,p){l._state=p||{};},_defChangeFn:function(p){this._storeState(p.src,p.newVal,p._options);}},true);b.HistoryBase=d;},"@VERSION@",{"requires":["event-custom-complex"]});