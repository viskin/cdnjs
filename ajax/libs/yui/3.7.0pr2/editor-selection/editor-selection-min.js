YUI.add("editor-selection",function(c,b){var a="textContent",e="innerHTML",d="fontFamily";if(c.UA.ie){a="nodeValue";}c.EditorSelection=function(p){var k,q,g,h,f,m;if(c.config.win.getSelection&&(!c.UA.ie||c.UA.ie<9)){k=c.config.win.getSelection();}else{if(c.config.doc.selection){k=c.config.doc.selection.createRange();}}this._selection=k;if(!k){return false;}if(k.pasteHTML){this.isCollapsed=(k.compareEndPoints("StartToEnd",k))?false:true;if(this.isCollapsed){this.anchorNode=this.focusNode=c.one(k.parentElement());if(p){g=c.config.doc.elementFromPoint(p.clientX,p.clientY);}f=k.duplicate();if(!g){q=k.parentElement();h=q.childNodes;for(m=0;m<h.length;m++){if(f.inRange(k)){if(!g){g=h[m];}}}}this.ieNode=g;if(g){if(g.nodeType!==3){if(g.firstChild){g=g.firstChild;}if(g&&g.tagName&&g.tagName.toLowerCase()==="body"){if(g.firstChild){g=g.firstChild;}}}this.anchorNode=this.focusNode=c.EditorSelection.resolve(g);f.moveToElementText(k.parentElement());var o=k.compareEndPoints("StartToStart",f),r=0;if(o){r=Math.abs(k.move("character",-9999));}this.anchorOffset=this.focusOffset=r;this.anchorTextNode=this.focusTextNode=c.one(g);}}else{if(k.htmlText&&k.htmlText!==""){var l=c.Node.create(k.htmlText);if(l&&l.get("id")){var j=l.get("id");this.anchorNode=this.focusNode=c.one("#"+j);}else{if(l){l=l.get("childNodes");this.anchorNode=this.focusNode=l.item(0);}}}}}else{this.isCollapsed=k.isCollapsed;this.anchorNode=c.EditorSelection.resolve(k.anchorNode);this.focusNode=c.EditorSelection.resolve(k.focusNode);this.anchorOffset=k.anchorOffset;this.focusOffset=k.focusOffset;this.anchorTextNode=c.one(k.anchorNode);this.focusTextNode=c.one(k.focusNode);}if(c.Lang.isString(k.text)){this.text=k.text;}else{if(k.toString){this.text=k.toString();}else{this.text="";}}};c.EditorSelection.removeFontFamily=function(g){g.removeAttribute("face");var f=g.getAttribute("style").toLowerCase();if(f===""||(f=="font-family: ")){g.removeAttribute("style");}if(f.match(c.EditorSelection.REG_FONTFAMILY)){f=f.replace(c.EditorSelection.REG_FONTFAMILY,"");g.setAttribute("style",f);}};c.EditorSelection.filter=function(f){var i=(new Date()).getTime();var h=c.all(c.EditorSelection.ALL),l=c.all("strong,em"),o=c.config.doc,q,g={},j="",m;var k=(new Date()).getTime();h.each(function(s){var r=c.Node.getDOMNode(s);if(r.style[d]){g["."+s._yuid]=r.style[d];s.addClass(s._yuid);c.EditorSelection.removeFontFamily(r);}});var p=(new Date()).getTime();c.all(".hr").addClass("yui-skip").addClass("yui-non");if(c.UA.ie){q=o.getElementsByTagName("hr");c.each(q,function(u){var t=o.createElement("div");t.className="hr yui-non yui-skip";t.setAttribute("readonly",true);t.setAttribute("contenteditable",false);if(u.parentNode){u.parentNode.replaceChild(t,u);}var r=t.style;r.border="1px solid #ccc";r.lineHeight="0";r.height="0";r.fontSize="0";r.marginTop="5px";r.marginBottom="5px";r.marginLeft="0px";r.marginRight="0px";r.padding="0";});}c.each(g,function(s,r){j+=r+" { font-family: "+s.replace(/"/gi,"")+"; }";});c.StyleSheet(j,"editor");l.each(function(v,r){var s=v.get("tagName").toLowerCase(),u="i";if(s==="strong"){u="b";}c.EditorSelection.prototype._swap(l.item(r),u);});m=c.all("ol,ul");m.each(function(s,r){var t=s.all("li");if(!t.size()){s.remove();}});if(f){c.EditorSelection.filterBlocks();}var n=(new Date()).getTime();};c.EditorSelection.filterBlocks=function(){var g=(new Date()).getTime();var o=c.config.doc.body.childNodes,j,h,r=false,l=true,f,t,u,q,n,p,v;if(o){for(j=0;j<o.length;j++){h=c.one(o[j]);if(!h.test(c.EditorSelection.BLOCKS)){l=true;if(o[j].nodeType==3){p=o[j][a].match(c.EditorSelection.REG_CHAR);v=o[j][a].match(c.EditorSelection.REG_NON);if(p===null&&v){l=false;}}if(l){if(!r){r=[];}r.push(o[j]);}}else{r=c.EditorSelection._wrapBlock(r);}}r=c.EditorSelection._wrapBlock(r);}t=c.all(c.EditorSelection.DEFAULT_BLOCK_TAG);if(t.size()===1){u=t.item(0).all("br");if(u.size()===1){if(!u.item(0).test(".yui-cursor")){u.item(0).remove();}var k=t.item(0).get("innerHTML");if(k===""||k===" "){t.set("innerHTML",c.EditorSelection.CURSOR);f=new c.EditorSelection();f.focusCursor(true,true);}if(u.item(0).test(".yui-cursor")&&c.UA.ie){u.item(0).remove();}}}else{t.each(function(s){var i=s.get("innerHTML");if(i===""){s.remove();}});}if(!c.UA.ie){}var m=(new Date()).getTime();};c.EditorSelection.REG_FONTFAMILY=/font-family: ;/;c.EditorSelection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi;c.EditorSelection.REG_NON=/[\s|\n|\t]/gi;c.EditorSelection.REG_NOHTML=/<\S[^><]*>/g;c.EditorSelection._wrapBlock=function(g){if(g){var f=c.Node.create("<"+c.EditorSelection.DEFAULT_BLOCK_TAG+"></"+c.EditorSelection.DEFAULT_BLOCK_TAG+">"),j=c.one(g[0]),h;for(h=1;h<g.length;h++){f.append(g[h]);}j.replace(f);f.prepend(j);}return false;};c.EditorSelection.unfilter=function(){var h=c.all("body [class]"),i="",g,j,f=c.one("body");h.each(function(k){if(k.hasClass(k._yuid)){k.setStyle(d,k.getStyle(d));k.removeClass(k._yuid);if(k.getAttribute("class")===""){k.removeAttribute("class");}}});g=c.all(".yui-non");g.each(function(k){if(!k.hasClass("yui-skip")&&k.get("innerHTML")===""){k.remove();}else{k.removeClass("yui-non").removeClass("yui-skip");}});j=c.all("body [id]");j.each(function(k){if(k.get("id").indexOf("yui_3_")===0){k.removeAttribute("id");k.removeAttribute("_yuid");}});if(f){i=f.get("innerHTML");}c.all(".hr").addClass("yui-skip").addClass("yui-non");return i;};c.EditorSelection.resolve=function(g){if(g&&g.nodeType===3){try{g=g.parentNode;}catch(f){g="body";}}return c.one(g);};c.EditorSelection.getText=function(g){var f=g.get("innerHTML").replace(c.EditorSelection.REG_NOHTML,"");f=f.replace("<span><br></span>","").replace("<br>","");return f;};c.EditorSelection.DEFAULT_BLOCK_TAG="p";c.EditorSelection.ALL="[style],font[face]";c.EditorSelection.BLOCKS="p,div,ul,ol,table,style";c.EditorSelection.TMP="yui-tmp";c.EditorSelection.DEFAULT_TAG="span";c.EditorSelection.CURID="yui-cursor";c.EditorSelection.CUR_WRAPID="yui-cursor-wrapper";c.EditorSelection.CURSOR='<span><br class="yui-cursor"></span>';
c.EditorSelection.hasCursor=function(){var f=c.all("#"+c.EditorSelection.CUR_WRAPID);return f.size();};c.EditorSelection.cleanCursor=function(){var g,f="br.yui-cursor";g=c.all(f);if(g.size()){g.each(function(h){var j=h.get("parentNode.parentNode.childNodes"),i;if(j.size()){h.remove();}else{i=c.EditorSelection.getText(j.item(0));if(i!==""){h.remove();}}});}};c.EditorSelection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(h,f){var g=c.Node.create("<"+f+"></"+f+">");g.set(e,h.get(e));h.set(e,"");h.append(g);return c.Node.getDOMNode(g);},_swap:function(h,f){var g=c.Node.create("<"+f+"></"+f+">");g.set(e,h.get(e));h.replace(g,h);return c.Node.getDOMNode(g);},getSelected:function(){c.EditorSelection.filter();c.config.doc.execCommand("fontname",null,c.EditorSelection.TMP);var g=c.all(c.EditorSelection.ALL),f=[];g.each(function(i,h){if(i.getStyle(d)==c.EditorSelection.TMP){i.setStyle(d,"");c.EditorSelection.removeFontFamily(i);if(!i.test("body")){f.push(c.Node.getDOMNode(g.item(h)));}}});return c.all(f);},insertContent:function(f){return this.insertAtCursor(f,this.anchorTextNode,this.anchorOffset,true);},insertAtCursor:function(l,g,i,o){var q=c.Node.create("<"+c.EditorSelection.DEFAULT_TAG+' class="yui-non"></'+c.EditorSelection.DEFAULT_TAG+">"),f,j,h,p,k=this.createRange(),n;if(g&&g.test("body")){n=c.Node.create("<span></span>");g.append(n);g=n;}if(k.pasteHTML){if(i===0&&g&&!g.previous()&&g.get("nodeType")===3){g.insert(l,"before");if(k.moveToElementText){k.moveToElementText(c.Node.getDOMNode(g.previous()));}k.collapse(false);k.select();return g.previous();}else{p=c.Node.create(l);try{k.pasteHTML('<span id="rte-insert"></span>');}catch(m){}f=c.one("#rte-insert");if(f){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(c.Node.getDOMNode(p));}k.collapse(false);k.select();return p;}else{c.on("available",function(){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(c.Node.getDOMNode(p));}k.collapse(false);k.select();},"#rte-insert");}}}else{if(i>0){f=g.get(a);j=c.one(c.config.doc.createTextNode(f.substr(0,i)));h=c.one(c.config.doc.createTextNode(f.substr(i)));g.replace(j,g);p=c.Node.create(l);if(p.get("nodeType")===11){n=c.Node.create("<span></span>");n.append(p);p=n;}j.insert(p,"after");if(h){p.insert(q,"after");q.insert(h,"after");this.selectNode(q,o);}}else{if(g.get("nodeType")===3){g=g.get("parentNode");}p=c.Node.create(l);l=g.get("innerHTML").replace(/\n/gi,"");if(l===""||l==="<br>"){g.append(p);}else{if(p.get("parentNode")){g.insert(p,"before");}else{c.one("body").prepend(p);}}if(g.get("firstChild").test("br")){g.get("firstChild").remove();}}}return p;},wrapContent:function(g){g=(g)?g:c.EditorSelection.DEFAULT_TAG;if(!this.isCollapsed){var i=this.getSelected(),l=[],h,j,k,f;i.each(function(p,m){var o=p.get("tagName").toLowerCase();if(o==="font"){l.push(this._swap(i.item(m),g));}else{l.push(this._wrap(i.item(m),g));}},this);h=this.createRange();k=l[0];j=l[l.length-1];if(this._selection.removeAllRanges){h.setStart(l[0],0);h.setEnd(j,j.childNodes.length);this._selection.removeAllRanges();this._selection.addRange(h);}else{if(h.moveToElementText){h.moveToElementText(c.Node.getDOMNode(k));f=this.createRange();f.moveToElementText(c.Node.getDOMNode(j));h.setEndPoint("EndToEnd",f);}h.select();}l=c.all(l);return l;}else{return c.all([]);}},replace:function(l,j){var g=this.createRange(),k,f,h,i;if(g.getBookmark){h=g.getBookmark();f=this.anchorNode.get("innerHTML").replace(l,j);this.anchorNode.set("innerHTML",f);g.moveToBookmark(h);i=c.one(g.parentElement());}else{k=this.anchorTextNode;f=k.get(a);h=f.indexOf(l);f=f.replace(l,"");k.set(a,f);i=this.insertAtCursor(j,k,h,true);}return i;},remove:function(){if(this._selection&&this._selection.removeAllRanges){this._selection.removeAllRanges();}return this;},createRange:function(){if(c.config.doc.selection){return c.config.doc.selection.createRange();}else{return c.config.doc.createRange();}},selectNode:function(i,k,f){if(!i){return;}f=f||0;i=c.Node.getDOMNode(i);var g=this.createRange();if(g.selectNode){g.selectNode(i);this._selection.removeAllRanges();this._selection.addRange(g);if(k){try{this._selection.collapse(i,f);}catch(h){this._selection.collapse(i,0);}}}else{if(i.nodeType===3){i=i.parentNode;}try{g.moveToElementText(i);}catch(j){}if(k){g.collapse(((f)?false:true));}g.select();}return this;},setCursor:function(){this.removeCursor(false);return this.insertContent(c.EditorSelection.CURSOR);},getCursor:function(){return c.all("#"+c.EditorSelection.CURID);},removeCursor:function(f){var g=this.getCursor();if(g){if(f){g.removeAttribute("id");g.set("innerHTML",'<br class="yui-cursor">');}else{g.remove();}}return g;},focusCursor:function(h,f){if(h!==false){h=true;}if(f!==false){f=true;}var g=this.removeCursor(true);if(g){g.each(function(i){this.selectNode(i,h,f);},this);}},toString:function(){return"EditorSelection Object";}};c.Selection=c.EditorSelection;},"@VERSION@",{"requires":["node"]});