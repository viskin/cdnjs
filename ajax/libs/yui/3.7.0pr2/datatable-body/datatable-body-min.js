YUI.add("datatable-body",function(Y,NAME){var Lang=Y.Lang,isArray=Lang.isArray,isNumber=Lang.isNumber,isString=Lang.isString,fromTemplate=Lang.sub,htmlEscape=Y.Escape.html,toArray=Y.Array,bind=Y.bind,YObject=Y.Object;Y.namespace("DataTable").BodyView=Y.Base.create("tableBody",Y.View,[],{CELL_TEMPLATE:'<td {headers} class="{className}">{content}</td>',ROW_TEMPLATE:'<tr id="{rowId}" data-yui3-record="{clientId}" class="{rowClass}">{content}</tr>',TBODY_TEMPLATE:'<tbody class="{className}"></tbody>',getCell:function(seed,shift){var tbody=this.tbodyNode,row,cell,index,rowIndexOffset;if(seed&&tbody){isArray(seed)?(row=tbody.get("children").item(seed[0]),cell=row&&row.get("children").item(seed[1])):Y.instanceOf(seed,Y.Node)&&(cell=seed.ancestor("."+this.getClassName("cell"),!0));if(cell&&shift){rowIndexOffset=tbody.get("firstChild.rowIndex");if(isString(shift))switch(shift){case"above":shift=[-1,0];break;case"below":shift=[1,0];break;case"next":shift=[0,1];break;case"previous":shift=[0,-1]}isArray(shift)&&(index=cell.get("parentNode.rowIndex")+shift[0]-rowIndexOffset,row=tbody.get("children").item(index),index=cell.get("cellIndex")+shift[1],cell=row&&row.get("children").item(index))}}return cell||null},getClassName:function(){var host=this.host,args;return host&&host.getClassName?host.getClassName.apply(host,arguments):(args=toArray(arguments),args.unshift(this.constructor.NAME),Y.ClassNameManager.getClassName.apply(Y.ClassNameManager,args))},getRecord:function(seed){var modelList=this.get("modelList"),tbody=this.tbodyNode,row=null,record;return tbody&&(isString(seed)&&(seed=tbody.one("#"+seed)),Y.instanceOf(seed,Y.Node)&&(row=seed.ancestor(function(node){return node.get("parentNode").compareTo(tbody)},!0),record=row&&modelList.getByClientId(row.getData("yui3-record")))),record||null},getRow:function(id){var tbody=this.tbodyNode,row=null;return tbody&&(id&&(id=this._idMap[id.get?id.get("clientId"):id]||id),row=isNumber(id)?tbody.get("children").item(id):tbody.one("#"+id)),row},render:function(){var table=this.get("container"),data=this.get("modelList"),columns=this.get("columns"),tbody=this.tbodyNode||(this.tbodyNode=this._createTBodyNode());return this._createRowTemplate(columns),data&&(tbody.setHTML(this._createDataHTML(columns)),this._applyNodeFormatters(tbody,columns)),tbody.get("parentNode")!==table&&table.appendChild(tbody),this.bindUI(),this},_afterColumnsChange:function(e){this.render()},_afterDataChange:function(e){this.render()},_afterModelListChange:function(e){var handles=this._eventHandles;handles.dataChange&&(handles.dataChange.detach(),delete handles.dataChange,this.bindUI()),this.tbodyNode&&this.render()},_applyNodeFormatters:function(tbody,columns){var host=this.host,data=this.get("modelList"),formatters=[],linerQuery="."+this.getClassName("liner"),rows,i,len;for(i=0,len=columns.length;i<len;++i)columns[i].nodeFormatter&&formatters.push(i);data&&formatters.length&&(rows=tbody.get("childNodes"),data.each(function(record,index){var formatterData={data:record.toJSON(),record:record,rowIndex:index},row=rows.item(index),i,len,col,key,cells,cell,keep;if(row){cells=row.get("childNodes");for(i=0,len=formatters.length;i<len;++i)cell=cells.item(formatters[i]),cell&&(col=formatterData.column=columns[formatters[i]],key=col.key||col.id,formatterData.value=record.get(key),formatterData.td=cell,formatterData.cell=cell.one(linerQuery)||cell,keep=col.nodeFormatter.call(host,formatterData),keep===!1&&cell.destroy(!0))}}))},bindUI:function(){var handles=this._eventHandles,modelList=this.get("modelList"),changeEvent=modelList.model.NAME+":change";handles.columnsChange||(handles.columnsChange=this.after("columnsChange",bind("_afterColumnsChange",this))),modelList&&!handles.dataChange&&(handles.dataChange=modelList.after(["add","remove","reset",changeEvent],bind("_afterDataChange",this)))},_createDataHTML:function(columns){var data=this.get("modelList"),html="";return data&&data.each(function(model,index){html+=this._createRowHTML(model,index,columns)},this),html},_createRowHTML:function(model,index,columns){var data=model.toJSON(),clientId=model.get("clientId"),values={rowId:this._getRowId(clientId),clientId:clientId,rowClass:index%2?this.CLASS_ODD:this.CLASS_EVEN},host=this.host||this,i,len,col,token,value,formatterData;for(i=0,len=columns.length;i<len;++i){col=columns[i],value=data[col.key],token=col._id||col.key,values[token+"-className"]="",col.formatter&&(formatterData={value:value,data:data,column:col,record:model,className:"",rowClass:"",rowIndex:index},typeof col.formatter=="string"?value!==undefined&&(value=fromTemplate(col.formatter,formatterData)):(value=col.formatter.call(host,formatterData),value===undefined&&(value=formatterData.value),values[token+"-className"]=formatterData.className,values.rowClass+=" "+formatterData.rowClass));if(value===undefined||value===null||value==="")value=col.emptyCellValue||"";values[token]=col.allowHTML?value:htmlEscape(value),values.rowClass=values.rowClass.replace(/\s+/g," ")}return fromTemplate(this._rowTemplate,values)},_createRowTemplate:function(columns){var html="",cellTemplate=this.CELL_TEMPLATE,i,len,col,key,token,headers,tokenValues;for(i=0,len=columns.length;i<len;++i)col=columns[i],key=col.key,token=col._id||key,headers=(col._headers||[]).length>1?'headers="'+col._headers.join(" ")+'"':"",tokenValues={content:"{"+token+"}",headers:headers,className:this.getClassName("col",token)+" "+(col.className||"")+" "+this.getClassName("cell")+" {"+token+"-className}"},col.nodeFormatter&&(tokenValues.content=""),html+=fromTemplate(col.cellTemplate||cellTemplate,tokenValues);this._rowTemplate=fromTemplate(this.ROW_TEMPLATE,{content:html})},_createTBodyNode:function(){return Y.Node.create(fromTemplate(this.TBODY_TEMPLATE,{className:this.getClassName("data")}))},destructor:function(){(new Y.EventHandle(YObject.values(this._eventHandles))).detach()},_getRowId:function(clientId){return this._idMap[clientId]||(this._idMap[clientId]=Y.guid())},initializer:function(config){this.host=config.host,this._eventHandles={modelListChange:this.after("modelListChange",bind("_afterModelListChange",this))},this._idMap={},this.CLASS_ODD=this.getClassName("odd"),this.CLASS_EVEN=this.getClassName("even")}})},"@VERSION@",{requires:["datatable-core","view","classnamemanager"]})