YUI.add("autocomplete-base",function(f,n){var g=f.Escape,j=f.Lang,r=f.Array,i=f.Object,d=j.isFunction,s=j.isString,v=j.trim,m=f.Attribute.INVALID_VALUE,p="_functionValidator",y="_sourceSuccess",c="allowBrowserAutocomplete",h="inputNode",x="query",e="queryDelimiter",b="requestTemplate",l="results",o="resultListLocator",k="value",t="valueChange",a="clear",u=x,q=l;function w(){}w.prototype={initializer:function(){f.before(this._bindUIACBase,this,"bindUI");f.before(this._syncUIACBase,this,"syncUI");this.publish(a,{defaultFn:this._defClearFn});this.publish(u,{defaultFn:this._defQueryFn});this.publish(q,{defaultFn:this._defResultsFn});},destructor:function(){this._acBaseEvents&&this._acBaseEvents.detach();delete this._acBaseEvents;delete this._cache;delete this._inputNode;delete this._rawSource;},clearCache:function(){this._cache&&(this._cache={});return this;},sendRequest:function(B,C){var z,A=this.get("source");if(B||B===""){this._set(x,B);}else{B=this.get(x)||"";}if(A){if(!C){C=this.get(b);}z=C?C.call(this,B):B;A.sendRequest({query:B,request:z,callback:{success:f.bind(this._onResponse,this,B)}});}return this;},_bindUIACBase:function(){var A=this.get(h),z=A&&A.tokenInput;if(z){A=z.get(h);this._set("tokenInput",z);}if(!A){f.error("No inputNode specified.");return;}this._inputNode=A;this._acBaseEvents=new f.EventHandle([A.on(t,this._onInputValueChange,this),A.on("blur",this._onInputBlur,this),this.after(c+"Change",this._syncBrowserAutocomplete),this.after("sourceTypeChange",this._afterSourceTypeChange),this.after(t,this._afterValueChange)]);},_syncUIACBase:function(){this._syncBrowserAutocomplete();this.set(k,this.get(h).get(k));},_createArraySource:function(A){var z=this;return{type:"array",sendRequest:function(B){z[y](A.concat(),B);}};},_createFunctionSource:function(A){var z=this;return{type:"function",sendRequest:function(B){var C;function D(E){z[y](E||[],B);}if((C=A(B.query,D))){D(C);}}};},_createObjectSource:function(A){var z=this;return{type:"object",sendRequest:function(B){var C=B.query;z[y](i.owns(A,C)?A[C]:[],B);}};},_functionValidator:function(z){return z===null||d(z);},_getObjectValue:function(C,B){if(!C){return;}for(var A=0,z=B.length;C&&A<z;A++){C=C[B[A]];}return C;},_parseResponse:function(B,z,Q){var H={data:Q,query:B,results:[]},J=this.get(o),I=[],G=z&&z.results,D,A,K,C,P,L,M,N,E,F,O;if(G&&J){G=J.call(this,G);}if(G&&G.length){D=this.get("resultFilters");O=this.get("resultTextLocator");for(L=0,M=G.length;L<M;++L){E=G[L];F=O?O.call(this,E):E.toString();I.push({display:g.html(F),raw:E,text:F});}for(L=0,M=D.length;L<M;++L){I=D[L].call(this,B,I.concat());if(!I){return;}if(!I.length){break;}}if(I.length){K=this.get("resultFormatter");P=this.get("resultHighlighter");N=this.get("maxResults");if(N&&N>0&&I.length>N){I.length=N;}if(P){C=P.call(this,B,I.concat());if(!C){return;}for(L=0,M=C.length;L<M;++L){E=I[L];E.highlighted=C[L];E.display=E.highlighted;}}if(K){A=K.call(this,B,I.concat());if(!A){return;}for(L=0,M=A.length;L<M;++L){I[L].display=A[L];}}}}H.results=I;this.fire(q,H);},_parseValue:function(z){var A=this.get(e);if(A){z=z.split(A);z=z[z.length-1];}return j.trimLeft(z);},_setEnableCache:function(z){this._cache=z?{}:null;},_setLocator:function(z){if(this[p](z)){return z;}var A=this;z=z.toString().split(".");return function(B){return B&&A._getObjectValue(B,z);};},_setRequestTemplate:function(z){if(this[p](z)){return z;}z=z.toString();return function(A){return j.sub(z,{query:encodeURIComponent(A)});};},_setResultFilters:function(B){var z,A;if(B===null){return[];}z=f.AutoCompleteFilters;A=function(C){if(d(C)){return C;}if(s(C)&&z&&d(z[C])){return z[C];}return false;};if(j.isArray(B)){B=r.map(B,A);return r.every(B,function(C){return !!C;})?B:m;}else{B=A(B);return B?[B]:m;}},_setResultHighlighter:function(z){var A;if(this[p](z)){return z;}A=f.AutoCompleteHighlighters;if(s(z)&&A&&d(A[z])){return A[z];}return m;},_setSource:function(B){var z=this.get("sourceType")||j.type(B),A;if((B&&d(B.sendRequest))||B===null||z==="datasource"){this._rawSource=B;return B;}if((A=w.SOURCE_TYPES[z])){this._rawSource=B;return j.isString(A)?this[A](B):A(B);}f.error("Unsupported source type '"+z+"'. Maybe autocomplete-sources isn't loaded?");return m;},_sourceSuccess:function(A,z){z.callback.success({data:A,response:{results:A}});},_syncBrowserAutocomplete:function(){var z=this.get(h);if(z.get("nodeName").toLowerCase()==="input"){z.setAttribute("autocomplete",this.get(c)?"on":"off");}},_updateValue:function(A){var C=this.get(e),B,z,D;A=j.trimLeft(A);if(C){B=v(C);D=r.map(v(this.get(k)).split(C),v);z=D.length;if(z>1){D[z-1]=A;A=D.join(B+" ");}A=A+B+" ";}this.set(k,A);},_afterSourceTypeChange:function(z){if(this._rawSource){this.set("source",this._rawSource);}},_afterValueChange:function(G){var C=G.newVal,A=this,F=G.src===w.UI_SRC,B,D,z,E;if(!F){A._inputNode.set(k,C);}z=A.get("minQueryLength");E=A._parseValue(C)||"";if(z>=0&&E.length>=z){if(F){B=A.get("queryDelay");D=function(){A.fire(u,{inputValue:C,query:E,src:G.src});};if(B){clearTimeout(A._delay);A._delay=setTimeout(D,B);}else{D();}}else{A._set(x,E);}}else{clearTimeout(A._delay);A.fire(a,{prevVal:G.prevVal?A._parseValue(G.prevVal):null,src:G.src});}},_onInputBlur:function(C){var D=this.get(e),z,A,B;if(D&&!this.get("allowTrailingDelimiter")){D=j.trimRight(D);B=A=this._inputNode.get(k);if(D){while((A=j.trimRight(A))&&(z=A.length-D.length)&&A.lastIndexOf(D)===z){A=A.substring(0,z);}}else{A=j.trimRight(A);}if(A!==B){this.set(k,A);}}},_onInputValueChange:function(A){var z=A.newVal;if(z!==this.get(k)){this.set(k,z,{src:w.UI_SRC});}},_onResponse:function(z,A){if(z===(this.get(x)||"")){this._parseResponse(z||"",A.response,A.data);}},_defClearFn:function(){this._set(x,null);this._set(l,[]);},_defQueryFn:function(z){this.sendRequest(z.query);},_defResultsFn:function(z){this._set(l,z[l]);}};w.ATTRS={allowBrowserAutocomplete:{value:false},allowTrailingDelimiter:{value:false},enableCache:{lazyAdd:false,setter:"_setEnableCache",value:true},inputNode:{setter:f.one,writeOnce:"initOnly"},maxResults:{value:0},minQueryLength:{value:1},query:{readOnly:true,value:null},queryDelay:{value:100},queryDelimiter:{value:null},requestTemplate:{setter:"_setRequestTemplate",value:null},resultFilters:{setter:"_setResultFilters",value:[]},resultFormatter:{validator:p,value:null},resultHighlighter:{setter:"_setResultHighlighter",value:null},resultListLocator:{setter:"_setLocator",value:null},results:{readOnly:true,value:[]},resultTextLocator:{setter:"_setLocator",value:null},source:{setter:"_setSource",value:null},sourceType:{value:null},tokenInput:{readOnly:true},value:{value:""}};
w._buildCfg={aggregates:["SOURCE_TYPES"],statics:["UI_SRC"]};w.SOURCE_TYPES={array:"_createArraySource","function":"_createFunctionSource",object:"_createObjectSource"};w.UI_SRC=(f.Widget&&f.Widget.UI_SRC)||"ui";f.AutoCompleteBase=w;},"@VERSION@",{"optional":["autocomplete-sources"],"requires":["array-extras","base-build","escape","event-valuechange","node-base"]});