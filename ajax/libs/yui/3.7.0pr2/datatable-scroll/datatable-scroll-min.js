YUI.add("datatable-scroll",function(Y,NAME){var YLang=Y.Lang,isString=YLang.isString,isNumber=YLang.isNumber,isArray=YLang.isArray,Scrollable;function styleDim(node,style){return parseInt(node.getComputedStyle(style),10)|0}Y.DataTable.Scrollable=Scrollable=function(){},Scrollable.ATTRS={scrollable:{value:!1,setter:"_setScrollable"}},Y.mix(Scrollable.prototype,{scrollTo:function(id){var target;return id&&this._tbodyNode&&(this._yScrollNode||this._xScrollNode)&&(isArray(id)?target=this.getCell(id):isNumber(id)?target=this.getRow(id):isString(id)?target=this._tbodyNode.one("#"+id):id instanceof Y.Node&&id.ancestor(".yui3-datatable")===this.get("boundingBox")&&(target=id),target&&target.scrollIntoView()),this},_CAPTION_TABLE_TEMPLATE:'<table class="{className}" role="presentation"></table>',_SCROLL_LINER_TEMPLATE:'<div class="{className}"></div>',_SCROLLBAR_TEMPLATE:'<div class="{className}"><div></div></div>',_X_SCROLLER_TEMPLATE:'<div class="{className}"></div>',_Y_SCROLL_HEADER_TEMPLATE:'<table cellspacing="0" aria-hidden="true" class="{className}"></table>',_Y_SCROLLER_TEMPLATE:'<div class="{className}"><div class="{scrollerClassName}"></div></div>',_addScrollbarPadding:function(){var fixedHeader=this._yScrollHeader,headerClass="."+this.getClassName("header"),scrollbarWidth,rows,header,i,len;if(fixedHeader){scrollbarWidth=Y.DOM.getScrollbarWidth()+"px",rows=fixedHeader.all("tr");for(i=0,len=rows.size();i<len;i+=+header.get("rowSpan"))header=rows.item(i).all(headerClass).pop(),header.setStyle("paddingRight",scrollbarWidth)}},_afterScrollableChange:function(e){var scroller=this._xScrollNode;this._xScroll&&scroller&&(this._yScroll&&!this._yScrollNode?scroller.setStyle("paddingRight",Y.DOM.getScrollbarWidth()+"px"):!this._yScroll&&this._yScrollNode&&scroller.setStyle("paddingRight","")),this._syncScrollUI()},_afterScrollCaptionChange:function(e){(this._xScroll||this._yScroll)&&this._syncScrollUI()},_afterScrollColumnsChange:function(e){if(this._xScroll||this._yScroll)this._yScroll&&this._yScrollHeader&&this._syncScrollHeaders(),this._syncScrollUI()},_afterScrollDataChange:function(e){(this._xScroll||this._yScroll)&&this._syncScrollUI()},_afterScrollHeightChange:function(e){this._yScroll&&this._syncScrollUI()},_afterScrollSort:function(e){var headers,headerClass;this._yScroll&&this._yScrollHeader&&(headerClass="."+this.getClassName("header"),headers=this._theadNode.all(headerClass),this._yScrollHeader.all(headerClass).each(function(header,i){header.set("className",headers.item(i).get("className"))}))},_afterScrollWidthChange:function(e){(this._xScroll||this._yScroll)&&this._syncScrollUI()},_bindScrollbar:function(){var scrollbar=this._scrollbarNode,scroller=this._yScrollNode;scrollbar&&scroller&&!this._scrollbarEventHandle&&(this._scrollbarEventHandle=new Y.Event.Handle([scrollbar.on("scroll",this._syncScrollPosition,this),scroller.on("scroll",this._syncScrollPosition,this)]))},_bindScrollResize:function(){this._scrollResizeHandle||(this._scrollResizeHandle=Y.on("resize",this._syncScrollUI,null,this))},_bindScrollUI:function(){this.after({columnsChange:Y.bind("_afterScrollColumnsChange",this),heightChange:Y.bind("_afterScrollHeightChange",this),widthChange:Y.bind("_afterScrollWidthChange",this),captionChange:Y.bind("_afterScrollCaptionChange",this),scrollableChange:Y.bind("_afterScrollableChange",this),sort:Y.bind("_afterScrollSort",this)}),this.after(["dataChange","*:add","*:remove","*:reset","*:change"],Y.bind("_afterScrollDataChange",this))},_clearScrollLock:function(){this._scrollLock&&(this._scrollLock.cancel(),delete this._scrollLock)},_createScrollbar:function(){var scrollbar=this._scrollbarNode;return scrollbar||(scrollbar=this._scrollbarNode=Y.Node.create(Y.Lang.sub(this._SCROLLBAR_TEMPLATE,{className:this.getClassName("scrollbar")})),scrollbar.setStyle("width",Y.DOM.getScrollbarWidth()+1+"px")),scrollbar},_createScrollCaptionTable:function(){return this._captionTable||(this._captionTable=Y.Node.create(Y.Lang.sub(this._CAPTION_TABLE_TEMPLATE,{className:this.getClassName("caption","table")})),this._captionTable.empty()),this._captionTable},_createXScrollNode:function(){return this._xScrollNode||(this._xScrollNode=Y.Node.create(Y.Lang.sub(this._X_SCROLLER_TEMPLATE,{className:this.getClassName("x","scroller")}))),this._xScrollNode},_createYScrollHeader:function(){var fixedHeader=this._yScrollHeader;return fixedHeader||(fixedHeader=this._yScrollHeader=Y.Node.create(Y.Lang.sub(this._Y_SCROLL_HEADER_TEMPLATE,{className:this.getClassName("scroll","columns")}))),fixedHeader},_createYScrollNode:function(){var scrollerClass;return this._yScrollNode||(scrollerClass=this.getClassName("y","scroller"),this._yScrollContainer=Y.Node.create(Y.Lang.sub(this._Y_SCROLLER_TEMPLATE,{className:this.getClassName("y","scroller","container"),scrollerClassName:scrollerClass})),this._yScrollNode=this._yScrollContainer.one("."+scrollerClass)),this._yScrollContainer},_disableScrolling:function(){this._removeScrollCaptionTable(),this._disableXScrolling(),this._disableYScrolling(),this._unbindScrollResize(),this._uiSetWidth(this.get("width"))},_disableXScrolling:function(){this._removeXScrollNode()},_disableYScrolling:function(){this._removeYScrollHeader(),this._removeYScrollNode(),this._removeYScrollContainer(),this._removeScrollbar()},destructor:function(){this._unbindScrollbar(),this._unbindScrollResize(),this._clearScrollLock()},initializer:function(){this._setScrollProperties(),this.after(["scrollableChange","heightChange","widthChange"],this._setScrollProperties),this.after("renderView",Y.bind("_syncScrollUI",this)),Y.Do.after(this._bindScrollUI,this,"bindUI")},_removeScrollCaptionTable:function(){this._captionTable&&(this._captionNode&&this._tableNode.prepend(this._captionNode),this._captionTable.remove().destroy(!0),delete this._captionTable)},_removeXScrollNode:function(){var scroller=this._xScrollNode;scroller&&(scroller.replace(scroller.get("childNodes").toFrag()),scroller.remove().destroy(!0),delete this._xScrollNode)},_removeYScrollContainer:function(){var scroller=this._yScrollContainer;scroller&&(scroller.replace(scroller.get("childNodes").toFrag()),scroller.remove().destroy(!0),delete this._yScrollContainer)},_removeYScrollHeader:function(){this._yScrollHeader&&(this._yScrollHeader.remove().destroy(!0),delete this._yScrollHeader)},_removeYScrollNode:function(){var scroller=this._yScrollNode;scroller&&(scroller.replace(scroller.get("childNodes").toFrag()),scroller.remove().destroy(!0),delete this._yScrollNode)},_removeScrollbar:function(){this._scrollbarNode&&(this._scrollbarNode.remove().destroy(!0),delete this._scrollbarNode),this._scrollbarEventHandle&&(this._scrollbarEventHandle.detach(),delete this._scrollbarEventHandle)},_setScrollable:function(val){return val===!0&&(val="xy"),isString(val)&&(val=val.toLowerCase()),val===!1||val==="y"||val==="x"||val==="xy"?val:Y.Attribute.INVALID_VALUE},_setScrollProperties:function(){var scrollable=this.get("scrollable")||"",width=this.get("width"),height=this.get("height");this._xScroll=width&&scrollable.indexOf("x")>-1,this._yScroll=height&&scrollable.indexOf("y")>-1},_syncScrollPosition:function(e){var scrollbar=this._scrollbarNode,scroller=this._yScrollNode,source=e.currentTarget,other;if(scrollbar&&scroller){if(this._scrollLock&&this._scrollLock.source!==source)return;this._clearScrollLock(),this._scrollLock=Y.later(300,this,this._clearScrollLock),this._scrollLock.source=source,other=source===scrollbar?scroller:scrollbar,other.set("scrollTop",source.get("scrollTop"))}},_syncScrollCaptionUI:function(){var caption=this._captionNode,table=this._tableNode,captionTable=this._captionTable,id;caption?(id=caption.getAttribute("id"),captionTable||(captionTable=this._createScrollCaptionTable(),this.get("contentBox").prepend(captionTable)),caption.get("parentNode").compareTo(captionTable)||(captionTable.empty().insert(caption),id||(id=Y.stamp(caption),caption.setAttribute("id",id)),table.setAttribute("aria-describedby",id))):captionTable&&this._removeScrollCaptionTable()},_syncScrollColumnWidths:function(){var widths=[];this._theadNode&&this._yScrollHeader&&(this._theadNode.all("."+this.getClassName("header")).each(function(header){widths.push(Y.UA.ie&&Y.UA.ie<8?header.get("clientWidth")-styleDim(header,"paddingLeft")-styleDim(header,"paddingRight")+"px":header.getComputedStyle("width"))}),this._yScrollHeader.all("."+this.getClassName("scroll","liner")).each(function(liner,i){liner.setStyle("width",widths[i])}))},_syncScrollHeaders:function(){var fixedHeader=this._yScrollHeader,linerTemplate=this._SCROLL_LINER_TEMPLATE,linerClass=this.getClassName("scroll","liner"),headerClass=this.getClassName("header"),headers=this._theadNode.all("."+headerClass);this._theadNode&&fixedHeader&&(fixedHeader.empty().appendChild(this._theadNode.cloneNode(!0)),fixedHeader.all("[id]").removeAttribute("id"),fixedHeader.all("."+headerClass).each(function(header,i){var liner=Y.Node.create(Y.Lang.sub(linerTemplate,{className:linerClass})),refHeader=headers.item(i);liner.setStyle("padding",refHeader.getComputedStyle("paddingTop")+" "+refHeader.getComputedStyle("paddingRight")+" "+refHeader.getComputedStyle("paddingBottom")+" "+refHeader.getComputedStyle("paddingLeft")),liner.appendChild(header.get("childNodes").toFrag()),header.appendChild(liner)},this),this._syncScrollColumnWidths(),this._addScrollbarPadding())},_syncScrollUI:function(){var x=this._xScroll,y=this._yScroll,xScroller=this._xScrollNode,yScroller=this._yScrollNode,scrollLeft=xScroller&&xScroller.get("scrollLeft"),scrollTop=yScroller&&yScroller.get("scrollTop");this._uiSetScrollable(),x||y?((this.get("width")||"").slice(-1)==="%"?this._bindScrollResize():this._unbindScrollResize(),this._syncScrollCaptionUI()):this._disableScrolling(),this._yScrollHeader&&this._yScrollHeader.setStyle("display","none"),x&&(y||this._disableYScrolling(),this._syncXScrollUI(y)),y&&(x||this._disableXScrolling(),this._syncYScrollUI(x)),scrollLeft&&this._xScrollNode&&this._xScrollNode.set("scrollLeft",scrollLeft),scrollTop&&this._yScrollNode&&this._yScrollNode.set("scrollTop",scrollTop)},_syncXScrollUI:function(xy){var scroller=this._xScrollNode,yScroller=this._yScrollContainer,table=this._tableNode,width=this.get("width"),bbWidth=this.get("boundingBox").get("offsetWidth"),scrollbarWidth=Y.DOM.getScrollbarWidth(),borderWidth,tableWidth;scroller||(scroller=this._createXScrollNode(),(yScroller||table).replace(scroller).appendTo(scroller)),borderWidth=styleDim(scroller,"borderLeftWidth")+styleDim(scroller,"borderRightWidth"),scroller.setStyle("width",""),this._uiSetDim("width",""),xy&&this._yScrollContainer&&this._yScrollContainer.setStyle("width",""),Y.UA.ie&&Y.UA.ie<8&&(table.setStyle("width",width),table.get("offsetWidth")),table.setStyle("width",""),tableWidth=table.get("offsetWidth"),table.setStyle("width",tableWidth+"px"),this._uiSetDim("width",width),scroller.setStyle("width",bbWidth-borderWidth+"px"),scroller.get("offsetWidth")-borderWidth>tableWidth&&(xy?table.setStyle("width",scroller.get("offsetWidth")-borderWidth-scrollbarWidth+"px"):table.setStyle("width","100%"))},_syncYScrollUI:function(xy){var yScroller=this._yScrollContainer,yScrollNode=this._yScrollNode,xScroller=this._xScrollNode,fixedHeader=this._yScrollHeader,scrollbar=this._scrollbarNode,table=this._tableNode,thead=this._theadNode,captionTable=this._captionTable,boundingBox=this.get("boundingBox"),contentBox=this.get("contentBox"),width=this.get("width"),height=boundingBox.get("offsetHeight"),scrollbarWidth=Y.DOM.getScrollbarWidth(),outerScroller;captionTable&&!xy&&captionTable.setStyle("width",width||"100%"),yScroller||(yScroller=this._createYScrollNode(),yScrollNode=this._yScrollNode,table.replace(yScroller).appendTo(yScrollNode)),outerScroller=xy?xScroller:yScroller,xy||table.setStyle("width",""),xy&&(height-=scrollbarWidth),yScrollNode.setStyle("height",height-outerScroller.get("offsetTop")-styleDim(outerScroller,"borderTopWidth")-styleDim(outerScroller,"borderBottomWidth")+"px"),xy?yScroller.setStyle("width",table.get("offsetWidth")+scrollbarWidth+"px"):this._uiSetYScrollWidth(width),captionTable&&!xy&&captionTable.setStyle("width",yScroller.get("offsetWidth")+"px"),thead&&!fixedHeader&&(fixedHeader=this._createYScrollHeader(),yScroller.prepend(fixedHeader),this._syncScrollHeaders()),fixedHeader&&(this._syncScrollColumnWidths(),fixedHeader.setStyle("display",""),scrollbar||(scrollbar=this._createScrollbar(),this._bindScrollbar(),contentBox.prepend(scrollbar)),this._uiSetScrollbarHeight(),this._uiSetScrollbarPosition(outerScroller))},_uiSetScrollable:function(){this.get("boundingBox").toggleClass(this.getClassName("scrollable","x"),this._xScroll).toggleClass(this.getClassName("scrollable","y"),this._yScroll)},_uiSetScrollbarHeight:function(){var scrollbar=this._scrollbarNode,scroller=this._yScrollNode,fixedHeader=this._yScrollHeader;scrollbar&&scroller&&fixedHeader&&(scrollbar.get("firstChild").setStyle("height",this._tbodyNode.get("scrollHeight")+"px"),scrollbar.setStyle("height",parseFloat(scroller.getComputedStyle("height"))-parseFloat(fixedHeader.getComputedStyle("height"))+"px"))},_uiSetScrollbarPosition:function(scroller){var scrollbar=this._scrollbarNode,fixedHeader=this._yScrollHeader;scrollbar&&scroller&&fixedHeader&&scrollbar.setStyles({top:parseFloat(fixedHeader.getComputedStyle("height"))+styleDim(scroller,"borderTopWidth")+scroller.get("offsetTop")+"px",left:scroller.get("offsetWidth")-Y.DOM.getScrollbarWidth()-1-styleDim(scroller,"borderRightWidth")+"px"})},_uiSetYScrollWidth:function(width){var scroller=this._yScrollContainer,table=this._tableNode,tableWidth,borderWidth,scrollerWidth,scrollbarWidth;scroller&&table&&(scrollbarWidth=Y.DOM.getScrollbarWidth(),width?(borderWidth=scroller.get("offsetWidth")-scroller.get("clientWidth")+scrollbarWidth,scroller.setStyle("width",width),scrollerWidth=scroller.get("clientWidth")-borderWidth,table.setStyle("width",scrollerWidth+"px"),tableWidth=table.get("offsetWidth"),scroller.setStyle("width",tableWidth+scrollbarWidth+"px")):(table.setStyle("width",""),scroller.setStyle("width",""),scroller.setStyle("width",table.get("offsetWidth")+scrollbarWidth+"px")))},_unbindScrollbar:function(){this._scrollbarEventHandle&&this._scrollbarEventHandle.detach()},_unbindScrollResize:function(){this._scrollResizeHandle&&(this._scrollResizeHandle.detach(),delete this._scrollResizeHandle)}},!0),Y.Base.mix(Y.DataTable,[Scrollable])},"@VERSION@",{requires:["datatable-base","datatable-column-widths","dom-screen"],skinnable:!0})