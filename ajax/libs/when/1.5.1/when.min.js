(function(b,a){b(["module"],function(c){var e,k,u,x,l,d;l=/^false$/i;x="WHEN_PARANOID";if(c&&typeof c.config==="function"){e=c.config().paranoid!==false}else{if(typeof process=="object"){e=!l.test(process.env[x])}else{if(typeof system=="object"){e=!l.test(system.env[x])}else{e=!(a&&a.when_config&&a.when_config.paranoid===false)}}}e=(e&&Object.freeze)||z;m.defer=g;m.resolve=v;m.reject=j;m.all=f;m.some=p;m.any=q;m.map=y;m.reduce=o;m.chain=s;m.isPromise=r;function m(B,D,C,A){return v(B).then(D,C,A)}function v(A){var C,B;if(A instanceof h){C=A}else{if(A!=null&&typeof A.valueOf==="function"){A=A.valueOf()}if(r(A)){B=g();A.then(B.resolve,B.reject,B.progress);C=B.promise}else{C=t(A)}}return C}function j(A){return m(A,function(B){return w(B)})}function h(A){this.then=A}h.prototype=e({always:function(A,B){return this.then(A,A,B)},otherwise:function(A){return this.then(d,A)}});function t(A){var B=new h(function(D){try{return v(D?D(A):A)}catch(C){return w(C)}});return e(B)}function w(B){var A=new h(function(E,C){try{return C?v(C(B)):w(B)}catch(D){return w(D)}});return e(A)}function g(){var J,K,G,E,C,B,H;K=new h(F);J={then:F,resolve:D,reject:I,progress:A,promise:e(K),resolver:e({resolve:D,reject:I,progress:A})};G=[];E=[];C=function(O,M,N){var L=g();G.push(function(P){P.then(O,M).then(L.resolve,L.reject,L.progress)});N&&E.push(N);return L.promise};B=function(N){var L,M=0;while(L=E[M++]){L(N)}};H=function(M){var N,L=0;M=v(M);C=M.then;H=v;B=i;while(N=G[L++]){N(M)}E=G=d;return M};return J;function F(N,L,M){return C(N,L,M)}function D(L){return H(L)}function I(L){return H(w(L))}function A(L){B(L)}}function r(A){return A&&typeof A.then==="function"}function p(D,C,E,B,A){n(2,arguments);return m(D,function(G){var K,I,M,L,N,F,J,H;J=G.length>>>0;K=Math.max(0,Math.min(C,J));I=[];M=g();if(!K){M.resolve(I)}else{N=M.reject;F=M.progress;L=function(O){I.push(O);if(!--K){L=i;M.resolve(I)}};for(H=0;H<J;++H){if(H in G){m(G[H],L,N,F)}}}return M.then(E,B,A)})}function f(C,D,B,A){n(1,arguments);return y(C,z).then(D,B,A)}function q(C,E,B,A){function D(F){return E?E(F[0]):F[0]}return p(C,1,D,B,A)}function y(B,A){return m(B,function(G){var D,F,I,J,K,E,H;I=F=G.length>>>0;D=[];H=g();if(!I){H.resolve(D)}else{K=H.reject;J=function C(M,L){m(M,A).then(function(N){D[L]=N;if(!--I){H.resolve(D)}},K)};for(E=0;E<F;E++){if(E in G){J(G[E],E)}else{--I}}}return H.promise})}function o(C,B){var A=u.call(arguments,1);return m(C,function(E){var D;D=E.length;A[0]=function(G,H,F){return m(G,function(I){return m(H,function(J){return B(I,J,F,D)})})};return k.apply(E,A)})}function s(A,D,C){var B=arguments.length>2;return m(A,function(E){return D.resolve(B?C:E)},D.reject,D.progress)}function n(D,C){var A,B=C.length;while(B>D){A=C[--B];if(A!=null&&typeof A!="function"){throw new Error("arg "+B+" must be a function")}}}function i(){}u=[].slice;k=[].reduce||function(F){var B,D,C,A,E;E=0;B=Object(this);A=B.length>>>0;D=arguments;if(D.length<=1){for(;;){if(E in B){C=B[E++];break}if(++E>=A){throw new TypeError()}}}else{C=D[1]}for(;E<A;++E){if(E in B){C=F(C,B[E],E,B)}}return C};function z(A){return A}return m})})(typeof define=="function"&&define.amd?define:function(b,a){typeof exports==="object"?(module.exports=a()):(this.when=a())},this);