(function(b,a){b(function(g){K.promise=L;K.resolve=u;K.reject=y;K.defer=j;K.join=m;K.all=s;K.map=B;K.reduce=p;K.settle=D;K.any=E;K.some=M;K.isPromise=d;K.isPromiseLike=d;function K(Z,ac,aa,ab){return J(Z).then(ac,aa,ab)}function J(Z){return Z instanceof I?Z:u(Z)}function I(Z,aa){this._message=Z;this.inspect=aa}I.prototype={then:function(ad,aa,ac){var Z,ab;Z=arguments;ab=this._message;return k(function(ag,af,ae){ab("when",Z,ag,ae)},this._status&&this._status.observed())},otherwise:function(Z){return this.then(z,Z)},ensure:function(aa){return typeof aa==="function"?this.then(Z,Z)["yield"](this):this;function Z(){return u(aa())}},done:function(Z,aa){this.then(Z,aa).otherwise(R)},yield:function(Z){return this.then(function(){return Z})},tap:function(Z){return this.then(Z)["yield"](this)},spread:function(Z){return this.then(function(aa){return s(aa,function(ab){return Z.apply(z,ab)})})},always:function(Z,aa){return this.then(Z,Z,aa)}};function u(Z){return L(function(aa){aa(Z)})}function y(Z){return K(Z,t)}function j(){var ab,ac,aa;ab={promise:z,resolve:z,reject:z,notify:z,resolver:{resolve:z,reject:z,notify:z}};ab.promise=ac=L(Z);return ab;function Z(ad,ae,af){ab.resolve=ab.resolver.resolve=function(ag){if(aa){return u(ag)}aa=true;ad(ag);return ac};ab.reject=ab.resolver.reject=function(ag){if(aa){return u(t(ag))}aa=true;ae(ag);return ac};ab.notify=ab.resolver.notify=function(ag){af(ag);return ag}}}function L(Z){return k(Z,U.PromiseStatus&&U.PromiseStatus())}function k(Z,ab){var aj,ae,ac=[];aj=new I(ah,ag);aj._status=ab;try{Z(aa,ai,af)}catch(ad){ai(ad)}return aj;function ah(am,ak,an,al){ac?ac.push(ao):l(function(){ao(ae)});function ao(ap){ap._message(am,ak,an,al)}}function ag(){return ae?ae.inspect():x()}function aa(al){if(!ac){return}var ak=ac;ac=z;l(function(){ae=G(aj,al);if(ab){v(ae,ab)}w(ak,ae)})}function ai(ak){aa(t(ak))}function af(al){if(ac){var ak=ac;l(function(){w(ak,S(al))})}}}function w(Z,ab){for(var aa=0;aa<Z.length;aa++){Z[aa](ab)}}function H(Z){return F(new n(Z),function(){return f(Z)})}function t(Z){return F(new V(Z),function(){return X(Z)})}function F(Z,aa){return new I(function(ac,ab,ad){try{ad(Z[ac].apply(Z,ab))}catch(ae){ad(t(ae))}},aa)}function S(Z){return new I(function(ad,ab,aa,ac){var af=ab[2];try{ac(typeof af==="function"?af(Z):Z)}catch(ae){ac(ae)}})}function G(ab,aa){if(aa===ab){return t(new TypeError())}if(aa instanceof I){return aa}try{var Z=aa===Object(aa)&&aa.then;return typeof Z==="function"?h(Z,aa):H(aa)}catch(ac){return t(ac)}}function h(aa,Z){return L(function(ac,ab){i(aa,Z,ac,ab)})}function n(Z){this.value=Z}n.prototype.when=function(Z){return typeof Z==="function"?Z(this.value):this.value};function V(Z){this.reason=Z}V.prototype.when=function(Z,aa){if(typeof aa==="function"){return aa(this.reason)}else{throw this.reason}};function v(ab,aa){ab.then(Z,ac);function Z(){aa.fulfilled()}function ac(ad){aa.rejected(ad)}}function d(Z){return Z&&typeof Z.then==="function"}function M(ab,aa,ad,Z,ac){return K(ab,function(ae){return L(af).then(ad,Z,ac);function af(aq,at,ar){var ao,an,ap,ah,am,aj,al,ak;al=ae.length>>>0;ao=Math.max(0,Math.min(aa,al));ap=[];an=(al-ao)+1;ah=[];if(!ao){aq(ap)}else{aj=function(au){ah.push(au);if(!--an){am=aj=Q;at(ah)}};am=function(au){ap.push(au);if(!--ao){am=aj=Q;aq(ap)}};for(ak=0;ak<al;++ak){if(ak in ae){K(ae[ak],ag,ai,ar)}}}function ai(au){aj(au)}function ag(au){am(au)}}})}function E(aa,ad,Z,ab){function ac(ae){return ad?ad(ae[0]):ae[0]}return M(aa,1,ac,Z,ab)}function s(aa,ac,Z,ab){return C(aa,Q).then(ac,Z,ab)}function m(){return C(arguments,Q)}function D(Z){return C(Z,f,X)}function B(aa,Z){return C(aa,Z)}function C(ab,Z,aa){return K(ab,function(ad){return k(ac);function ac(al,ak,aj){var ai,af,ah,ag;ah=af=ad.length>>>0;ai=[];if(!ah){al(ai);return}for(ag=0;ag<af;ag++){if(ag in ad){ae(ad[ag],ag)}else{--ah}}function ae(an,am){K(an,Z,aa).then(function(ao){ai[am]=ao;if(!--ah){al(ai)}},ak,aj)}}})}function p(ab,aa){var Z=i(q,arguments,1);return K(ab,function(ad){var ac;ac=ad.length;Z[0]=function(af,ag,ae){return K(af,function(ah){return K(ag,function(ai){return aa(ah,ai,ae,ac)})})};return P.apply(ad,Z)})}function f(Z){return{state:"fulfilled",value:Z}}function X(Z){return{state:"rejected",reason:Z}}function x(){return{state:"pending"}}var P,q,i,W,o,O,Y,c,r,U,N,A,z;N=g;o=[];function l(Z){if(o.push(Z)===1){W(T)}}function T(){w(o);o=[]}O=a.setTimeout;U=typeof console!=="undefined"?console:K;if(typeof process==="object"&&process.nextTick){W=process.nextTick}else{if(A=a.MutationObserver||a.WebKitMutationObserver){W=(function(Z,ab,ac){var aa=Z.createElement("div");new ab(ac).observe(aa,{attributes:true});return function(){aa.setAttribute("x","x")}}(document,A,T))}else{try{W=N("vertx").runOnLoop||N("vertx").runOnContext}catch(e){W=function(Z){O(Z,0)}}}}Y=Function.prototype;c=Y.call;i=Y.bind?c.bind(c):function(aa,Z){return aa.apply(Z,q.call(arguments,2))};r=[];q=r.slice;P=r.reduce||function(ae){var aa,ac,ab,Z,ad;ad=0;aa=Object(this);Z=aa.length>>>0;ac=arguments;if(ac.length<=1){for(;;){if(ad in aa){ab=aa[ad++];break}if(++ad>=Z){throw new TypeError()}}}else{ab=ac[1]}for(;ad<Z;++ad){if(ad in aa){ab=ae(ab,aa[ad],ad,aa)}}return ab};function Q(Z){return Z}function R(Z){if(typeof U.reportUnhandled==="function"){U.reportUnhandled()}else{l(function(){throw Z})}throw Z}return K})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a(require)},this);