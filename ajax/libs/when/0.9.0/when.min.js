(function(b,a){b([],function(){function l(){}var e=Object.freeze||l;function d(){var w,y,q,z,t,s,p,o,n;p=function(E,A,D){var C,B;B={deferred:(C=d()),resolve:E,reject:A,progress:D};if(t){s=s.next=B}else{t=s=B}return C.promise};function r(C,A,B){return p(C,A,B)}function v(A){n("resolve",A)}function x(A){n("reject",A)}o=function(C){var B,A;B=t;while(B){A=B.progress;if(A){A(C)}B=B.next}};function m(A){o(A)}n=function(E,D){var C=p;p=function B(H,F){var G=C(H,F);u(E);return G};n=o=function A(){throw new Error("already completed")};z=D;u(E)};function u(F){while(t){var D,C,A,B;D=t;C=D.deferred;t=t.next;B=D[F];if(B){try{A=B(z);if(g(A)){A.then(C.resolve,C.reject,C.progress)}else{C[F](A===a?z:A)}}catch(E){C.reject(E)}}}}w={};y=w.promise={then:(w.then=r)};q=w.resolver={resolve:(w.resolve=v),reject:(w.reject=x),progress:(w.progress=m)};e(y);e(q);return w}function g(m){return m&&typeof m.then==="function"}function i(n,t,p,m){var o=d();function s(u){return t?t(u):u}function r(u){return p?p(u):u}function q(u){m(u)}if(g(n)){o=f(n.then(s,r,q),o)}else{o.resolve(s(n))}return o.promise}function j(r,u,A,q,x){var w,t,v,B,o,p,z;w=Math.max(0,Math.min(u,r.length));t=[];B=d();v=(A||q||x)?B.then(A,q,x):B.promise;o=function(D){t.push(D);if(--w===0){o=z=l;B.resolve(t)}};function y(D){o(D)}p=function(D){p=z=l;B.reject(D)};function C(D){p(D)}z=function(D){B.progress(D)};function m(D){z(D)}if(w===0){B.resolve(t)}else{var n,s=0;while((n=r[s++])){i(n,y,C,m)}}return v}function k(o,p,n,m){return j(o,o.length,p,n,m)}function h(o,p,n,m){return j(o,1,p,n,m)}function c(m,o,n){return f(f(i(m),o,n),d()).promise}function f(p,n,o){var m=arguments;p.then(function(q){n.resolve(m.length>2?o:q)},function(q){n.reject(q)},function(q){n.progress(q)});return n}i.defer=d;i.isPromise=g;i.some=j;i.all=k;i.any=h;i.chain=c;return i})})(typeof define!="undefined"?define:function(b,a){this.when=a()});