(function(b,a){b(function(g){G.promise=I;G.resolve=t;G.reject=w;G.defer=i;G.join=l;G.all=r;G.map=y;G.reduce=o;G.settle=A;G.any=B;G.some=J;G.isPromise=d;G.isPromiseLike=d;function G(W,Z,X,Y){return t(W).then(Z,X,Y)}function F(W,X){this._message=W;this.inspect=X}F.prototype={then:function(aa,X,Z){var W,Y;W=arguments;Y=this._message;return j(function(ad,ac,ab){Y("when",W,ad,ab)},this._status&&this._status.observed())},otherwise:function(W){return this.then(x,W)},ensure:function(X){return this.then(W,W)["yield"](this);function W(){return t(X())}},yield:function(W){return this.then(function(){return W})},tap:function(W){return this.then(W)["yield"](this)},spread:function(W){return this.then(function(X){return r(X,function(Y){return W.apply(x,Y)})})},always:function(W,X){return this.then(W,W,X)}};function t(W){return I(function(X){X(W)})}function w(W){return G(W,s)}function i(){var Y,Z,X;Y={promise:x,resolve:x,reject:x,notify:x,resolver:{resolve:x,reject:x,notify:x}};Y.promise=Z=I(W);return Y;function W(aa,ab,ac){Y.resolve=Y.resolver.resolve=function(ad){if(X){return t(ad)}X=true;aa(ad);return Z};Y.reject=Y.resolver.reject=function(ad){if(X){return t(s(ad))}X=true;ab(ad);return Z};Y.notify=Y.resolver.notify=function(ad){ac(ad);return ad}}}function I(W){return j(W,R.PromiseStatus&&R.PromiseStatus())}function j(W,Y){var ag,ab,Z=[];ag=new F(ae,ad);ag._status=Y;try{W(X,af,ac)}catch(aa){af(aa)}return ag;function ae(aj,ah,ak,ai){Z?Z.push(al):k(function(){al(ab)});function al(am){am._message(aj,ah,ak,ai)}}function ad(){return ab?ab.inspect():v()}function X(ah){if(!Z){return}ab=D(ah);O(Z,ab);Z=x;if(Y){u(ab,Y)}}function af(ah){X(s(ah))}function ac(ah){if(Z){O(Z,P(ah))}}}function E(W){return C(new m(W),function(){return f(W)})}function s(W){return C(new S(W),function(){return U(W)})}function C(W,X){return new F(function(Z,Y,aa){try{aa(W[Z].apply(W,Y))}catch(ab){aa(s(ab))}},X)}function P(W){return new F(function(aa,Y,X,Z){var ac=Y[2];try{Z(typeof ac==="function"?ac(W):W)}catch(ab){Z(ab)}})}function D(W){if(W instanceof F){return W}if(!(W===Object(W)&&"then" in W)){return E(W)}return I(function(Z,Y,X){k(function(){try{var aa=W.then;if(typeof aa==="function"){h(aa,W,Z,Y,X)}else{Z(E(W))}}catch(ab){Y(ab)}})})}function m(W){this.value=W}m.prototype.when=function(W){return typeof W==="function"?W(this.value):this.value};function S(W){this.reason=W}S.prototype.when=function(W,X){if(typeof X==="function"){return X(this.reason)}else{throw this.reason}};function O(W,X){k(function(){var Z,Y=0;while(Z=W[Y++]){Z(X)}})}function u(Y,X){Y.then(W,Z);function W(){X.fulfilled()}function Z(aa){X.rejected(aa)}}function d(W){return W&&typeof W.then==="function"}function J(Y,X,aa,W,Z){return G(Y,function(ab){return I(ac).then(aa,W,Z);function ac(an,ap,ao){var al,ak,am,ae,aj,ag,ai,ah;ai=ab.length>>>0;al=Math.max(0,Math.min(X,ai));am=[];ak=(ai-al)+1;ae=[];if(!al){an(am)}else{ag=function(aq){ae.push(aq);if(!--ak){aj=ag=N;ap(ae)}};aj=function(aq){am.push(aq);if(!--al){aj=ag=N;an(am)}};for(ah=0;ah<ai;++ah){if(ah in ab){G(ab[ah],ad,af,ao)}}}function af(aq){ag(aq)}function ad(aq){aj(aq)}}})}function B(X,aa,W,Y){function Z(ab){return aa?aa(ab[0]):ab[0]}return J(X,1,Z,W,Y)}function r(X,Z,W,Y){return z(X,N).then(Z,W,Y)}function l(){return z(arguments,N)}function A(W){return z(W,f,U)}function y(X,W){return z(X,W)}function z(Y,W,X){return G(Y,function(aa){return j(Z);function Z(ai,ah,ag){var af,ac,ae,ad;ae=ac=aa.length>>>0;af=[];if(!ae){ai(af);return}for(ad=0;ad<ac;ad++){if(ad in aa){ab(aa[ad],ad)}else{--ae}}function ab(ak,aj){G(ak,W,X).then(function(al){af[aj]=al;ag(al);if(!--ae){ai(af)}},ah)}}})}function o(Y,X){var W=h(p,arguments,1);return G(Y,function(aa){var Z;Z=aa.length;W[0]=function(ac,ad,ab){return G(ac,function(ae){return G(ad,function(af){return X(ae,af,ab,Z)})})};return M.apply(aa,W)})}function f(W){return{state:"fulfilled",value:W}}function U(W){return{state:"rejected",reason:W}}function v(){return{state:"pending"}}var M,p,h,T,n,L,V,c,q,R,K,x;K=g;n=[];function k(W){if(n.push(W)===1){T(Q)}}function Q(){var W,X=0;while(W=n[X++]){W()}n=[]}L=a.setTimeout;R=typeof console!="undefined"?console:G;if(typeof setImmediate==="function"){T=setImmediate.bind(a)}else{if(typeof MessageChannel!=="undefined"){var H=new MessageChannel();H.port1.onmessage=Q;T=function(){H.port2.postMessage(0)}}else{if(typeof process==="object"&&process.nextTick){T=process.nextTick}else{try{T=K("vertx").runOnLoop||K("vertx").runOnContext}catch(e){T=function(W){L(W,0)}}}}}V=Function.prototype;c=V.call;h=V.bind?c.bind(c):function(X,W){return X.apply(W,p.call(arguments,2))};q=[];p=q.slice;M=q.reduce||function(ab){var X,Z,Y,W,aa;aa=0;X=Object(this);W=X.length>>>0;Z=arguments;if(Z.length<=1){for(;;){if(aa in X){Y=X[aa++];break}if(++aa>=W){throw new TypeError()}}}else{Y=Z[1]}for(;aa<W;++aa){if(aa in X){Y=ab(Y,X[aa],aa,X)}}return Y};function N(W){return W}return G})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a(require)},this);