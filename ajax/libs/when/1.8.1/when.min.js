(function(a){a(function(){var i,t,b;j.defer=d;j.resolve=u;j.reject=h;j.join=r;j.all=c;j.map=w;j.reduce=n;j.any=p;j.some=o;j.chain=s;j.isPromise=q;function j(y,B,z,A){return u(y).then(B,z,A)}function u(y){var z;if(y instanceof e){z=y}else{if(q(y)){z=l(y)}else{z=k(y)}}return z}function l(y){var A=d();try{y.then(function(B){A.resolve(B)},function(B){A.reject(B)},function(B){A.progress(B)})}catch(z){A.reject(z)}return A.promise}function h(y){return j(y,v)}function e(y){this.then=y}e.prototype={always:function(y,z){return this.then(y,y,z)},otherwise:function(y){return this.then(b,y)},yield:function(y){return this.then(function(){return y})},spread:function(y){return this.then(function(z){return c(z,function(A){return y.apply(b,A)})})}};function k(y){var z=new e(function(B){try{return u(typeof B=="function"?B(y):y)}catch(A){return v(A)}});return z}function v(z){var y=new e(function(B,A){try{return u(typeof A=="function"?A(z):v(z))}catch(C){return v(C)}});return y}function d(){var H,I,z,C,y,B,E;I=new e(D);H={then:D,resolve:A,reject:G,progress:F,notify:F,promise:I,resolver:{resolve:A,reject:G,progress:F,notify:F}};z=[];C=[];y=function(N,L,M){var K,J;K=d();J=typeof M==="function"?function(P){try{K.notify(M(P))}catch(O){K.notify(O)}}:function(O){K.notify(O)};z.push(function(O){O.then(N,L).then(K.resolve,K.reject,J)});C.push(J);return K.promise};B=function(J){g(C,J);return J};E=function(J){y=J.then;E=u;B=x;g(z,J);C=z=b;return J};return H;function D(L,J,K){return y(L,J,K)}function A(J){return E(u(J))}function G(J){return E(v(J))}function F(J){return B(J)}}function q(y){return y&&typeof y.then==="function"}function o(A,z,C,y,B){m(2,arguments);return j(A,function(G){var M,L,N,E,P,K,H,O,J,I;J=G.length>>>0;M=Math.max(0,Math.min(z,J));N=[];L=(J-M)+1;E=[];P=d();if(!M){P.resolve(N)}else{O=P.notify;H=function(Q){E.push(Q);if(!--L){K=H=f;P.reject(E)}};K=function(Q){N.push(Q);if(!--M){K=H=f;P.resolve(N)}};for(I=0;I<J;++I){if(I in G){j(G[I],D,F,O)}}}return P.promise.then(C,y,B);function F(Q){H(Q)}function D(Q){K(Q)}})}function p(z,C,y,A){function B(D){return C?C(D[0]):D[0]}return o(z,1,B,y,A)}function c(z,B,y,A){m(1,arguments);return w(z,x).then(B,y,A)}function r(){return w(arguments,x)}function w(z,y){return j(z,function(H){var E,B,D,F,C,G;D=B=H.length>>>0;E=[];G=d();if(!D){G.resolve(E)}else{F=function A(J,I){j(J,y).then(function(K){E[I]=K;if(!--D){G.resolve(E)}},G.reject)};for(C=0;C<B;C++){if(C in H){F(H[C],C)}else{--D}}}return G.promise})}function n(A,z){var y=t.call(arguments,1);return j(A,function(C){var B;B=C.length;y[0]=function(E,F,D){return j(E,function(G){return j(F,function(H){return z(G,H,D,B)})})};return i.apply(C,y)})}function s(y,B,A){var z=arguments.length>2;return j(y,function(C){C=z?A:C;B.resolve(C);return C},function(C){B.reject(C);return v(C)},function(C){typeof B.notify==="function"&&B.notify(C);return C})}function g(y,B){var A,z=0;while(A=y[z++]){A(B)}}function m(B,A){var y,z=A.length;while(z>B){y=A[--z];if(y!=null&&typeof y!="function"){throw new Error("arg "+z+" must be a function")}}}function f(){}t=[].slice;i=[].reduce||function(D){var z,B,A,y,C;C=0;z=Object(this);y=z.length>>>0;B=arguments;if(B.length<=1){for(;;){if(C in z){A=z[C++];break}if(++C>=y){throw new TypeError()}}}else{A=B[1]}for(;C<y;++C){if(C in z){A=D(A,z[C],C,z)}}return A};function x(y){return y}return j})})(typeof define=="function"&&define.amd?define:function(a){typeof exports==="object"?(module.exports=a()):(this.when=a())});