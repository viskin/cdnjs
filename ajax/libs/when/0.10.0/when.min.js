(function(a){a([],function(){var c,p,h,b;c=Object.freeze||f;function f(){}function s(u){return new Array(u)}p=Array.prototype.reduce;h=p?function(v,w,u){return p.call(v,w,u)}:function(w,z,v){var x=v;for(var y=0,u=w.length;y<u;y++){x=z(x,w[y],y,w)}return x};function e(){var F,H,y,I,C,A,x,w,v;C=[];A=[];x=function B(M,J,L){var K=e();C.push({deferred:K,resolve:M,reject:J});L&&A.push(L);return K.promise};function z(L,J,K){return x(L,J,K)}function E(J){v("resolve",J)}function G(J){v("reject",J)}w=function(L){var J,K=0;while(J=A[K++]){J(L)}};function u(J){w(J)}v=function(N,M){var L=x;x=function K(Q,O){var P=L(Q,O);D(N);return P};v=w=function J(){throw new Error("already completed")};A=b;I=M;D(N)};function D(Q){var O,N,K,M,J,L=0;J=C;C=[];while(O=J[L++]){N=O.deferred;M=O[Q];try{K=M?M(I):I;if(n(K)){g(K,N)}else{N[Q](K===b?I:K)}}catch(P){N.reject(P)}}}F={};H=F.promise={then:(F.then=z)};y=F.resolver={resolve:(F.resolve=E),reject:(F.reject=G),progress:(F.progress=u)};c(H);c(y);return F}function n(u){return u&&typeof u.then==="function"}function i(v,y,w,u){var x=o(v);return x.then(y,w,u)}function o(u){return n(u)?u:r(u)}function r(v){var u=e();u.resolve(v);return u.promise}function k(z,C,I,y,F){var E,B,D,J,w,x,H;E=Math.max(0,Math.min(C,z.length));B=[];J=e();D=(I||y||F)?J.then(I,y,F):J.promise;w=function(L){B.push(L);if(--E===0){w=H=f;J.resolve(B)}};function G(L){w(L)}x=function(L){x=H=f;J.reject(L)};function K(L){x(L)}H=function(L){J.progress(L)};function u(L){H(L)}if(E===0){J.resolve(B)}else{var v,A=0;while((v=z[A++])){i(v,G,K,u)}}return D}function d(x,z,v,u){var w,y;w=s(x.length);y=l(x,j,w);return i(y,z,v,u)}function j(v,w,u){v[u]=w;return v}function m(w,y,v,u){function x(z){return y(z[0])}return k(w,1,x,v,u)}function t(w,x){function v(A,z,y){return i(x(z),function(B){A[y]=B;return A})}var u=s(w.length);return l(w,v,u)}function l(x,v,u){var w=x.length;return o(h(x,function(z,A,y){return i(z,function(B){return i(A,function(C){return v(B,C,y,w)})})},u))}function q(u,y,x){var w,v;w=o(u);v=arguments.length>2?function(z){return g(w,z,x)}:function(z){return g(w,z)};v(y);return v(i.defer()).promise}function g(w,u,v){w.then(arguments.length>2?function(){u.resolve(v)}:u.resolve,u.reject,u.progress);return u}i.defer=e;i.isPromise=n;i.some=k;i.all=d;i.any=m;i.reduce=l;i.map=t;i.chain=q;return i})})(typeof define!="undefined"?define:typeof module!="undefined"?function(b,a){module.exports=a()}:function(b,a){this.when=a()});