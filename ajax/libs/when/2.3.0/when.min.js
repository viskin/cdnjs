(function(b,a){b(function(){E.promise=G;E.resolve=r;E.reject=u;E.defer=f;E.join=i;E.all=p;E.map=w;E.reduce=l;E.settle=y;E.any=z;E.some=H;E.isPromise=o;function E(T,W,U,V){return r(T).then(W,U,V)}function D(T,U){this._message=T;this.inspect=U}D.prototype={otherwise:function(T){return this.then(v,T)},ensure:function(U){return this.then(T,T)["yield"](this);function T(){return r(U())}},yield:function(T){return this.then(function(){return T})},tap:function(T){return this.then(T)["yield"](this)},spread:function(T){return this.then(function(U){return p(U,function(V){return T.apply(v,V)})})},always:function(T,U){return this.then(T,T,U)}};function r(T){return G(function(U){U(T)})}function u(T){return E(T,q)}function f(){var V,W,U;V={promise:v,resolve:v,reject:v,notify:v,resolver:{resolve:v,reject:v,notify:v}};V.promise=W=G(T);return V;function T(X,Y,Z){V.resolve=V.resolver.resolve=function(aa){if(U){return r(aa)}U=true;X(aa);return W};V.reject=V.resolver.reject=function(aa){if(U){return r(q(aa))}U=true;Y(aa);return W};V.notify=V.resolver.notify=function(aa){Z(aa);return aa}}}function G(T){return g(T,O.PromiseStatus&&O.PromiseStatus())}function g(T,V){var ae,Z,X=[];ae=new D(ac,ab);ae.then=W;try{T(U,ad,aa)}catch(Y){ad(Y)}return ae;function ac(ah,af,ai,ag){X?X.push(aj):h(function(){aj(Z)});function aj(ak){ak._message(ah,af,ai,ag)}}function ab(){return Z?Z.inspect():t()}function W(ai,ag,ah){var af=arguments;return g(function(al,ak,aj){ac("when",af,al,aj)},V&&V.observed())}function U(af){if(!X){return}Z=B(af);L(X,Z);X=v;if(V){s(Z,V)}}function ad(af){U(q(af))}function aa(af){if(X){L(X,M(af))}}}function C(T){return A(new j(T),function(){return d(T)})}function q(T){return A(new P(T),function(){return R(T)})}function A(T,U){return new D(function(W,V,X){try{X(T[W].apply(T,V))}catch(Y){X(q(Y))}},U)}function M(T){return new D(function(X,V,U,W){var Z=V[2];try{W(typeof Z==="function"?Z(T):T)}catch(Y){W(Y)}})}function B(T){if(T instanceof D){return T}if(!(T===Object(T)&&"then" in T)){return C(T)}return G(function(W,V,U){h(function(){try{var X=T.then;if(typeof X==="function"){e(X,T,W,V,U)}else{W(C(T))}}catch(Y){V(Y)}})})}function j(T){this.value=T}j.prototype.when=function(T){return typeof T==="function"?T(this.value):this.value};function P(T){this.reason=T}P.prototype.when=function(T,U){if(typeof U==="function"){return U(this.reason)}else{throw this.reason}};function L(T,U){h(function(){var W,V=0;while(W=T[V++]){W(U)}})}function s(U,T){U._message("when",[function(){T.fulfilled()},function(V){T.rejected(V)}],K,K)}function o(T){return T&&typeof T.then==="function"}function H(V,U,X,T,W){return E(V,function(Y){return G(Z).then(X,T,W);function Z(ak,am,al){var ai,ah,aj,ab,ag,ad,af,ae;af=Y.length>>>0;ai=Math.max(0,Math.min(U,af));aj=[];ah=(af-ai)+1;ab=[];if(!ai){ak(aj)}else{ad=function(an){ab.push(an);if(!--ah){ag=ad=K;am(ab)}};ag=function(an){aj.push(an);if(!--ai){ag=ad=K;ak(aj)}};for(ae=0;ae<af;++ae){if(ae in Y){E(Y[ae],aa,ac,al)}}}function ac(an){ad(an)}function aa(an){ag(an)}}})}function z(U,X,T,V){function W(Y){return X?X(Y[0]):Y[0]}return H(U,1,W,T,V)}function p(U,W,T,V){return x(U,K).then(W,T,V)}function i(){return x(arguments,K)}function y(T){return x(T,d,R)}function w(U,T){return x(U,T)}function x(V,T,U){return E(V,function(X){return G(W);function W(af,ae,ad){var ac,Z,ab,aa;ab=Z=X.length>>>0;ac=[];if(!ab){af(ac);return}for(aa=0;aa<Z;aa++){if(aa in X){Y(X[aa],aa)}else{--ab}}function Y(ah,ag){E(ah,T,U).then(function(ai){ac[ag]=ai;ad(ai);if(!--ab){af(ac)}},ae)}}})}function l(V,U){var T=e(m,arguments,1);return E(V,function(X){var W;W=X.length;T[0]=function(Z,aa,Y){return E(Z,function(ab){return E(aa,function(ac){return U(ab,ac,Y,W)})})};return J.apply(X,T)})}function d(T){return{state:"fulfilled",value:T}}function R(T){return{state:"rejected",reason:T}}function t(){return{state:"pending"}}var J,m,e,Q,k,I,S,c,n,O,v;k=[];function h(T){if(k.push(T)===1){Q(N)}}function N(){var T,U=0;while(T=k[U++]){T()}k=[]}I=a.setTimeout;O=typeof console!="undefined"?console:E;if(typeof setImmediate==="function"){Q=setImmediate.bind(a)}else{if(typeof MessageChannel!=="undefined"){var F=new MessageChannel();F.port1.onmessage=N;Q=function(){F.port2.postMessage(0)}}else{if(typeof process==="object"&&process.nextTick){Q=process.nextTick}else{if(typeof vertx==="object"){Q=vertx.runOnLoop}else{Q=function(T){I(T,0)}}}}}S=Function.prototype;c=S.call;e=S.bind?c.bind(c):function(U,T){return U.apply(T,m.call(arguments,2))};n=[];m=n.slice;J=n.reduce||function(Y){var U,W,V,T,X;X=0;U=Object(this);T=U.length>>>0;W=arguments;if(W.length<=1){for(;;){if(X in U){V=U[X++];break}if(++X>=T){throw new TypeError()}}}else{V=W[1]}for(;X<T;++X){if(X in U){V=Y(V,U[X],X,U)}}return V};function K(T){return T}return E})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a()},this);