(function(b,a){b(function(g){K.promise=L;K.resolve=u;K.reject=y;K.defer=j;K.join=m;K.all=s;K.map=B;K.reduce=p;K.settle=D;K.any=E;K.some=M;K.isPromise=d;K.isPromiseLike=d;function K(Y,ab,Z,aa){return J(Y).then(ab,Z,aa)}function J(Y){return Y instanceof I?Y:u(Y)}function I(Y,Z){this._message=Y;this.inspect=Z}I.prototype={then:function(ac,Z,ab){var Y,aa;Y=arguments;aa=this._message;return k(function(af,ae,ad){aa("when",Y,af,ad)},this._status&&this._status.observed())},otherwise:function(Y){return this.then(z,Y)},ensure:function(Z){return typeof Z==="function"?this.then(Y,Y)["yield"](this):this;function Y(){return u(Z())}},yield:function(Y){return this.then(function(){return Y})},tap:function(Y){return this.then(Y)["yield"](this)},spread:function(Y){return this.then(function(Z){return s(Z,function(aa){return Y.apply(z,aa)})})},always:function(Y,Z){return this.then(Y,Y,Z)}};function u(Y){return L(function(Z){Z(Y)})}function y(Y){return K(Y,t)}function j(){var aa,ab,Z;aa={promise:z,resolve:z,reject:z,notify:z,resolver:{resolve:z,reject:z,notify:z}};aa.promise=ab=L(Y);return aa;function Y(ac,ad,ae){aa.resolve=aa.resolver.resolve=function(af){if(Z){return u(af)}Z=true;ac(af);return ab};aa.reject=aa.resolver.reject=function(af){if(Z){return u(t(af))}Z=true;ad(af);return ab};aa.notify=aa.resolver.notify=function(af){ae(af);return af}}}function L(Y){return k(Y,T.PromiseStatus&&T.PromiseStatus())}function k(Y,aa){var ai,ad,ab=[];ai=new I(ag,af);ai._status=aa;try{Y(Z,ah,ae)}catch(ac){ah(ac)}return ai;function ag(al,aj,am,ak){ab?ab.push(an):l(function(){an(ad)});function an(ao){ao._message(al,aj,am,ak)}}function af(){return ad?ad.inspect():x()}function Z(ak){if(!ab){return}var aj=ab;ab=z;l(function(){ad=G(ai,ak);if(aa){v(ad,aa)}w(aj,ad)})}function ah(aj){Z(t(aj))}function ae(ak){if(ab){var aj=ab;l(function(){w(aj,R(ak))})}}}function w(Y,aa){for(var Z=0;Z<Y.length;Z++){Y[Z](aa)}}function H(Y){return F(new n(Y),function(){return f(Y)})}function t(Y){return F(new U(Y),function(){return W(Y)})}function F(Y,Z){return new I(function(ab,aa,ac){try{ac(Y[ab].apply(Y,aa))}catch(ad){ac(t(ad))}},Z)}function R(Y){return new I(function(ac,aa,Z,ab){var ae=aa[2];try{ab(typeof ae==="function"?ae(Y):Y)}catch(ad){ab(ad)}})}function G(aa,Z){if(Z===aa){return t(new TypeError())}if(Z instanceof I){return Z}try{var Y=Z===Object(Z)&&Z.then;return typeof Y==="function"?h(Y,Z):H(Z)}catch(ab){return t(ab)}}function h(Z,Y){return L(function(ab,aa){i(Z,Y,ab,aa)})}function n(Y){this.value=Y}n.prototype.when=function(Y){return typeof Y==="function"?Y(this.value):this.value};function U(Y){this.reason=Y}U.prototype.when=function(Y,Z){if(typeof Z==="function"){return Z(this.reason)}else{throw this.reason}};function v(aa,Z){aa.then(Y,ab);function Y(){Z.fulfilled()}function ab(ac){Z.rejected(ac)}}function d(Y){return Y&&typeof Y.then==="function"}function M(aa,Z,ac,Y,ab){return K(aa,function(ad){return L(ae).then(ac,Y,ab);function ae(ap,ar,aq){var an,am,ao,ag,al,ai,ak,aj;ak=ad.length>>>0;an=Math.max(0,Math.min(Z,ak));ao=[];am=(ak-an)+1;ag=[];if(!an){ap(ao)}else{ai=function(at){ag.push(at);if(!--am){al=ai=Q;ar(ag)}};al=function(at){ao.push(at);if(!--an){al=ai=Q;ap(ao)}};for(aj=0;aj<ak;++aj){if(aj in ad){K(ad[aj],af,ah,aq)}}}function ah(at){ai(at)}function af(at){al(at)}}})}function E(Z,ac,Y,aa){function ab(ad){return ac?ac(ad[0]):ad[0]}return M(Z,1,ab,Y,aa)}function s(Z,ab,Y,aa){return C(Z,Q).then(ab,Y,aa)}function m(){return C(arguments,Q)}function D(Y){return C(Y,f,W)}function B(Z,Y){return C(Z,Y)}function C(aa,Y,Z){return K(aa,function(ac){return k(ab);function ab(ak,aj,ai){var ah,ae,ag,af;ag=ae=ac.length>>>0;ah=[];if(!ag){ak(ah);return}for(af=0;af<ae;af++){if(af in ac){ad(ac[af],af)}else{--ag}}function ad(am,al){K(am,Y,Z).then(function(an){ah[al]=an;if(!--ag){ak(ah)}},aj,ai)}}})}function p(aa,Z){var Y=i(q,arguments,1);return K(aa,function(ac){var ab;ab=ac.length;Y[0]=function(ae,af,ad){return K(ae,function(ag){return K(af,function(ah){return Z(ag,ah,ad,ab)})})};return P.apply(ac,Y)})}function f(Y){return{state:"fulfilled",value:Y}}function W(Y){return{state:"rejected",reason:Y}}function x(){return{state:"pending"}}var P,q,i,V,o,O,X,c,r,T,N,A,z;N=g;o=[];function l(Y){if(o.push(Y)===1){V(S)}}function S(){w(o);o=[]}O=a.setTimeout;T=typeof console!="undefined"?console:K;if(typeof process==="object"&&process.nextTick){V=process.nextTick}else{if(A=a.MutationObserver||a.WebKitMutationObserver){V=(function(Y,aa,ab){var Z=Y.createElement("div");new aa(ab).observe(Z,{attributes:true});return function(){Z.setAttribute("x","x")}}(document,A,S))}else{try{V=N("vertx").runOnLoop||N("vertx").runOnContext}catch(e){V=function(Y){O(Y,0)}}}}X=Function.prototype;c=X.call;i=X.bind?c.bind(c):function(Z,Y){return Z.apply(Y,q.call(arguments,2))};r=[];q=r.slice;P=r.reduce||function(ad){var Z,ab,aa,Y,ac;ac=0;Z=Object(this);Y=Z.length>>>0;ab=arguments;if(ab.length<=1){for(;;){if(ac in Z){aa=Z[ac++];break}if(++ac>=Y){throw new TypeError()}}}else{aa=ab[1]}for(;ac<Y;++ac){if(ac in Z){aa=ad(aa,Z[ac],ac,Z)}}return aa};function Q(Y){return Y}return K})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a(require)},this);