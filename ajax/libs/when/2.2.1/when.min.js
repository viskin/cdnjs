(function(b,a){b(function(){C.promise=D;C.resolve=q;C.reject=s;C.defer=f;C.join=i;C.all=o;C.map=u;C.reduce=k;C.settle=w;C.any=x;C.some=E;C.isPromise=n;function C(O,R,P,Q){return q(O).then(R,P,Q)}function A(O,P){this.then=O;this.inspect=P}A.prototype={otherwise:function(O){return this.then(t,O)},ensure:function(P){return this.then(O,O)["yield"](this);function O(){return q(P())}},yield:function(O){return this.then(function(){return O})},spread:function(O){return this.then(function(P){return o(P,function(Q){return O.apply(t,Q)})})},always:function(O,P){return this.then(O,O,P)}};function q(O){return D(function(P){P(O)})}function s(O){return C(O,p)}function f(){var Q,R,P;Q={promise:t,resolve:t,reject:t,notify:t,resolver:{resolve:t,reject:t,notify:t}};Q.promise=R=D(O);return Q;function O(S,T,U){Q.resolve=Q.resolver.resolve=function(V){if(P){return q(V)}P=true;S(V);return R};Q.reject=Q.resolver.reject=function(V){if(P){return q(p(V))}P=true;T(V);return R};Q.notify=Q.resolver.notify=function(V){U(V);return V}}}function D(O){return g(O,J.PromiseStatus&&J.PromiseStatus())}function g(O,R){var Y,U,P=[];Y=new A(S,W);try{O(Q,X,V)}catch(T){X(T)}return Y;function S(ac,Z,ab){var aa=g(function(af,ae,ad){P?P.push(ag):h(function(){ag(U)});function ag(ah){ah.then(ac,Z,ab).then(af,ae,ad)}},R&&R.observed());return aa}function W(){return U?U.inspect():r()}function Q(Z){if(!P){return}U=y(Z);B(P,U);P=t;if(R){U.then(function(){R.fulfilled()},function(aa){R.rejected(aa)})}}function X(Z){Q(p(Z))}function V(Z){if(P){B(P,L(Z))}}}function y(O){if(O instanceof A){return O}if(!(O===Object(O)&&"then" in O)){return z(O)}return D(function(R,Q,P){h(function(){try{var S=O.then;if(typeof S==="function"){e(S,O,R,Q,P)}else{R(z(O))}}catch(T){Q(T)}})})}function z(P){var O=new A(function(R){try{return typeof R=="function"?y(R(P)):O}catch(Q){return p(Q)}},function(){return d(P)});return O}function p(P){var O=new A(function(R,Q){try{return typeof Q=="function"?y(Q(P)):O}catch(S){return p(S)}},function(){return M(P)});return O}function L(P){var O=new A(function(Q,R,T){try{return typeof T=="function"?L(T(P)):O}catch(S){return L(S)}});return O}function B(O,P){h(function(){var R,Q=0;while(R=O[Q++]){R(P)}})}function n(O){return O&&typeof O.then==="function"}function E(Q,P,S,O,R){return C(Q,function(T){return D(U).then(S,O,R);function U(af,ah,ag){var ad,ac,ae,W,ab,Y,aa,Z;aa=T.length>>>0;ad=Math.max(0,Math.min(P,aa));ae=[];ac=(aa-ad)+1;W=[];if(!ad){af(ae)}else{Y=function(ai){W.push(ai);if(!--ac){ab=Y=H;ah(W)}};ab=function(ai){ae.push(ai);if(!--ad){ab=Y=H;af(ae)}};for(Z=0;Z<aa;++Z){if(Z in T){C(T[Z],V,X,ag)}}}function X(ai){Y(ai)}function V(ai){ab(ai)}}})}function x(P,S,O,Q){function R(T){return S?S(T[0]):T[0]}return E(P,1,R,O,Q)}function o(P,R,O,Q){return v(P,H).then(R,O,Q)}function i(){return v(arguments,H)}function w(O){return v(O,d,M)}function u(P,O){return v(P,O)}function v(Q,O,P){return C(Q,function(S){return D(R);function R(aa,Z,Y){var X,U,W,V;W=U=S.length>>>0;X=[];if(!W){aa(X);return}for(V=0;V<U;V++){if(V in S){T(S[V],V)}else{--W}}function T(ac,ab){C(ac,O,P).then(function(ad){X[ab]=ad;if(!--W){aa(X)}},Z,Y)}}})}function k(Q,P){var O=e(l,arguments,1);return C(Q,function(S){var R;R=S.length;O[0]=function(U,V,T){return C(U,function(W){return C(V,function(X){return P(W,X,T,R)})})};return G.apply(S,O)})}function d(O){return{state:"fulfilled",value:O}}function M(O){return{state:"rejected",reason:O}}function r(){return{state:"pending"}}var G,l,e,K,j,F,N,c,m,J,t;j=[];function h(O){if(j.push(O)===1){K(I)}}function I(){var O,P=0;while(O=j[P++]){O()}j=[]}J=typeof console!="undefined"?console:C;F=a.setTimeout;K=typeof setImmediate==="function"?setImmediate.bind(a):typeof process==="object"&&process.nextTick?process.nextTick:typeof vertx==="object"?vertx.runOnLoop:function(O){F(O,0)};N=Function.prototype;c=N.call;e=N.bind?c.bind(c):function(P,O){return P.apply(O,l.call(arguments,2))};m=[];l=m.slice;G=m.reduce||function(T){var P,R,Q,O,S;S=0;P=Object(this);O=P.length>>>0;R=arguments;if(R.length<=1){for(;;){if(S in P){Q=P[S++];break}if(++S>=O){throw new TypeError()}}}else{Q=R[1]}for(;S<O;++S){if(S in P){Q=T(Q,P[S],S,P)}}return Q};function H(O){return O}return C})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a()},this);