!function(n){"use strict";n(function(){function n(n,t,r,u){return e(n).then(t,r,u)}function t(n){this.then=n}function e(n){return o(function(t){t(n)})}function r(t){return n(t,c)}function u(){function n(n,o,i){t.resolve=t.resolver.resolve=function(t){return u?e(t):(u=!0,n(t),r)},t.reject=t.resolver.reject=function(n){return u?e(c(n)):(u=!0,o(n),r)},t.notify=t.resolver.notify=function(n){return i(n),n}}var t,r,u;return t={promise:A,resolve:A,reject:A,notify:A,resolver:{resolve:A,reject:A,notify:A}},t.promise=r=o(n),t}function o(n){function e(n,t,e){return o(function(r,u,o){l?l.push(function(i){i.then(n,t,e).then(r,u,o)}):w(function(){h.then(n,t,e).then(r,u,o)})})}function r(n){l&&(h=i(n),a(l,h),l=A)}function u(n){r(c(n))}function f(n){l&&a(l,s(n))}var h,l=[];try{n(r,u,f)}catch(p){u(p)}return new t(e)}function i(n){return n instanceof t?n:n!==Object(n)?f(n):o(function(t,e,r){w(function(){try{var u=n.then;"function"==typeof u?E(u,n,t,e,r):t(f(n))}catch(o){e(o)}})})}function f(n){var e=new t(function(t){try{return"function"==typeof t?i(t(n)):e}catch(r){return c(r)}});return e}function c(n){var e=new t(function(t,r){try{return"function"==typeof r?i(r(n)):e}catch(u){return c(u)}});return e}function s(n){var e=new t(function(t,r,u){try{return"function"==typeof u?s(u(n)):e}catch(o){return s(o)}});return e}function a(n,t){w(function(){for(var e,r=0;e=n[r++];)e(t)})}function h(n){return n&&"function"==typeof n.then}function l(t,e,r,u,i){return b(2,arguments),n(t,function(t){function f(r,u,o){function i(n){p(n)}function f(n){l(n)}var c,s,a,h,l,p,y,v;if(y=t.length>>>0,c=Math.max(0,Math.min(e,y)),a=[],s=y-c+1,h=[],c)for(p=function(n){h.push(n),--s||(l=p=x,u(h))},l=function(n){a.push(n),--c||(l=p=x,r(a))},v=0;y>v;++v)v in t&&n(t[v],f,i,o);else r(a)}return o(f).then(r,u,i)})}function p(n,t,e,r){function u(n){return t?t(n[0]):n[0]}return l(n,1,u,e,r)}function y(n,t,e,r){return b(1,arguments),m(n,T).then(t,e,r)}function v(){return m(arguments,T)}function m(t,e){return n(t,function(t){function r(r,u,o){var i,f,c,s,a;if(c=f=t.length>>>0,i=[],c)for(s=function(t,f){n(t,e).then(function(n){i[f]=n,--c||r(i)},u,o)},a=0;f>a;a++)a in t?s(t[a],a):--c;else r(i)}return o(r)})}function d(t,e){var r=E(I,arguments,1);return n(t,function(t){var u;return u=t.length,r[0]=function(t,r,o){return n(t,function(t){return n(r,function(n){return e(t,n,o,u)})})},k.apply(t,r)})}function w(n){1===O.push(n)&&g()}function g(){M(j)}function j(){for(var n,t=0;n=O[t++];)n();O=[]}function b(n,t){for(var e,r=t.length;r>n;)if(e=t[--r],null!=e&&"function"!=typeof e)throw new Error("arg "+r+" must be a function")}function x(){}function T(n){return n}n.defer=u,n.resolve=e,n.reject=r,n.join=v,n.all=y,n.map=m,n.reduce=d,n.any=p,n.some=l,n.isPromise=h,t.prototype={otherwise:function(n){return this.then(A,n)},ensure:function(n){function t(){return e(n())}var r=this;return this.then(t,t).yield(r)},"yield":function(n){return this.then(function(){return n})},spread:function(n){return this.then(function(t){return y(t,function(t){return n.apply(A,t)})})},always:function(n,t){return this.then(n,n,t)}};var k,I,E,M,O,F,P,q,z,A;return O=[],F=setTimeout,M="function"==typeof setImmediate?"undefined"==typeof window?setImmediate:setImmediate.bind(window):"object"==typeof process&&process.nextTick?process.nextTick:function(n){F(n,0)},P=Function.prototype,q=P.call,E=P.bind?q.bind(q):function(n,t){return n.apply(t,I.call(arguments,2))},z=[],I=z.slice,k=z.reduce||function(n){var t,e,r,u,o;if(o=0,t=Object(this),u=t.length>>>0,e=arguments,e.length<=1)for(;;){if(o in t){r=t[o++];break}if(++o>=u)throw new TypeError}else r=e[1];for(;u>o;++o)o in t&&(r=n(r,t[o],o,t));return r},n})}("function"==typeof define&&define.amd?define:function(n){module.exports=n()});