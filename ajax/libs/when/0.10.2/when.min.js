(function(a){a([],function(){var c,h,b;function f(){}function r(t){return new Array(t)}c=Object.freeze||f;h=[].reduce||function(y){var u,w,v,t,x;x=0;u=Object(this);t=u.length>>>0;w=arguments;if(w.length<=1){for(;;){if(x in u){v=u[x++];break}if(++x>=t){throw new TypeError()}}}else{v=w[1]}for(;x<t;++x){if(x in u){v=y(v,u[x],x,u)}}return v};function e(){var E,G,x,H,B,z,w,v,u;B=[];z=[];w=function A(L,I,K){var J=e();B.push({deferred:J,resolve:L,reject:I});K&&z.push(K);return J.promise};function y(K,I,J){return w(K,I,J)}function D(I){u("resolve",I)}function F(I){u("reject",I)}v=function(K){var I,J=0;while(I=z[J++]){I(K)}};function t(I){v(I)}u=function(M,L){var K=w;w=function J(P,N){var O=K(P,N);C(M);return O};u=v=function I(){throw new Error("already completed")};z=b;H=L;C(M)};function C(P){var N,M,J,L,I,K=0;I=B;B=[];while(N=I[K++]){M=N.deferred;L=N[P];try{J=L?L(H):H;if(n(J)){g(J,M)}else{M[P](J===b?H:J)}}catch(O){M.reject(O)}}}E={};G=E.promise={then:(E.then=y)};x=E.resolver={resolve:(E.resolve=D),reject:(E.reject=F),progress:(E.progress=t)};c(G);c(x);return E}function n(t){return t&&typeof t.then==="function"}function i(u,x,v,t){var w=o(u);return w.then(x,v,t)}function o(t){return n(t)?t:q(t)}function q(u){var t=e();t.resolve(u);return t.promise}function k(I,H,w,z,v){var t,D,J,K,y,B,C,G,F;G=I.length>>>0;t=Math.max(0,Math.min(H,G));D=[];K=e();J=i(K,w,z,v);function E(L){y(L)}function u(L){B(L)}function x(L){C(L)}function A(){y=B=C=f}if(!t){K.resolve(D)}else{y=function(L){D.push(L);if(!--t){A();K.resolve(D)}};B=function(L){A();K.reject(L)};C=K.progress;for(F=0;F<G;++F){if(F in I){i(I[F],E,u,x)}}}return J}function d(w,y,u,t){var v,x;v=r(w.length);x=l(w,j,v);return i(x,y,u,t)}function j(u,v,t){u[t]=v;return u}function m(v,x,u,t){function w(y){return x(y[0])}return k(v,1,w,u,t)}function s(v,w){var u,t;t=v.length;u=r(t);for(;t>=0;--t){if(t in v){u[t]=i(v[t],w)}}return l(u,j,u)}function l(x,v,t){var w,u;w=x.length;u=[function(z,A,y){return i(z,function(B){return i(A,function(C){return v(B,C,y,w)})})}];if(arguments.length>=3){u.push(t)}return o(h.apply(x,u))}function p(t,x,w){var v,u;v=o(t);u=arguments.length>2?function(y){return g(v,y,w)}:function(y){return g(v,y)};u(x);return u(i.defer()).promise}function g(v,t,u){v.then(arguments.length>2?function(){t.resolve(u)}:t.resolve,t.reject,t.progress);return t}i.defer=e;i.isPromise=n;i.some=k;i.all=d;i.any=m;i.reduce=l;i.map=s;i.chain=p;return i})})(typeof define!="undefined"?define:typeof module!="undefined"?function(b,a){module.exports=a()}:function(b,a){this.when=a()});