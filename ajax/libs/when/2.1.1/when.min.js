(function(b,a){b(function(){C.defer=f;C.resolve=p;C.reject=r;C.join=h;C.all=n;C.map=t;C.reduce=j;C.settle=v;C.any=w;C.some=E;C.isPromise=m;C.promise=D;function C(N,Q,O,P){return p(N).then(Q,O,P)}function A(N,O){this.then=N;this.inspect=O}A.prototype={otherwise:function(N){return this.then(s,N)},ensure:function(O){return this.then(N,N)["yield"](this);function N(){return p(O())}},yield:function(N){return this.then(function(){return N})},spread:function(N){return this.then(function(O){return n(O,function(P){return N.apply(s,P)})})},always:function(N,O){return this.then(N,N,O)}};function p(N){return D(function(O){O(N)})}function r(N){return C(N,o)}function f(){var P,Q,O;P={promise:s,resolve:s,reject:s,notify:s,resolver:{resolve:s,reject:s,notify:s}};P.promise=Q=D(N);return P;function N(R,S,T){P.resolve=P.resolver.resolve=function(U){if(O){return p(U)}O=true;R(U);return Q};P.reject=P.resolver.reject=function(U){if(O){return p(o(U))}O=true;S(U);return Q};P.notify=P.resolver.notify=function(U){T(U);return U}}}function D(N){var S,O=[];try{N(P,V,T)}catch(R){V(R)}return new A(Q,U);function Q(Y,W,X){return D(function(ab,aa,Z){O?O.push(function(ac){ac.then(Y,W,X).then(ab,aa,Z)}):g(function(){S.then(Y,W,X).then(ab,aa,Z)})})}function U(){return S?S.inspect():q()}function P(W){if(!O){return}S=x(W);B(O,S);O=s}function V(W){P(o(W))}function T(W){if(O){B(O,K(W))}}}function x(N){if(N instanceof A){return N}if(!(N===Object(N)&&"then" in N)){return z(N)}return D(function(Q,P,O){g(function(){try{var R=N.then;if(typeof R==="function"){e(R,N,Q,P,O)}else{Q(z(N))}}catch(S){P(S)}})})}function z(O){var N=new A(function(Q){try{return typeof Q=="function"?x(Q(O)):N}catch(P){return o(P)}},function(){return d(O)});return N}function o(O){var N=new A(function(Q,P){try{return typeof P=="function"?x(P(O)):N}catch(R){return o(R)}},function(){return L(O)});return N}function K(O){var N=new A(function(P,Q,S){try{return typeof S=="function"?K(S(O)):N}catch(R){return K(R)}});return N}function B(N,O){g(function(){var Q,P=0;while(Q=N[P++]){Q(O)}})}function m(N){return N&&typeof N.then==="function"}function E(P,O,R,N,Q){return C(P,function(S){return D(T).then(R,N,Q);function T(ae,ag,af){var ac,ab,ad,V,aa,X,Z,Y;Z=S.length>>>0;ac=Math.max(0,Math.min(O,Z));ad=[];ab=(Z-ac)+1;V=[];if(!ac){ae(ad)}else{X=function(ah){V.push(ah);if(!--ab){aa=X=H;ag(V)}};aa=function(ah){ad.push(ah);if(!--ac){aa=X=H;ae(ad)}};for(Y=0;Y<Z;++Y){if(Y in S){C(S[Y],U,W,af)}}}function W(ah){X(ah)}function U(ah){aa(ah)}}})}function w(O,R,N,P){function Q(S){return R?R(S[0]):S[0]}return E(O,1,Q,N,P)}function n(O,Q,N,P){return u(O,H).then(Q,N,P)}function h(){return u(arguments,H)}function v(N){return u(N,d,L)}function t(O,N){return u(O,N)}function u(P,N,O){return C(P,function(R){return D(Q);function Q(Z,Y,X){var W,T,V,S,U;V=T=R.length>>>0;W=[];if(!V){Z(W);return}S=function(ab,aa){C(ab,N,O).then(function(ac){W[aa]=ac;if(!--V){Z(W)}},Y,X)};for(U=0;U<T;U++){if(U in R){S(R[U],U)}else{--V}}}})}function j(P,O){var N=e(k,arguments,1);return C(P,function(R){var Q;Q=R.length;N[0]=function(T,U,S){return C(T,function(V){return C(U,function(W){return O(V,W,S,Q)})})};return G.apply(R,N)})}function d(N){return{state:"fulfilled",value:N}}function L(N){return{state:"rejected",reason:N}}function q(){return{state:"pending"}}var G,k,e,J,i,F,M,c,l,s;i=[];function g(N){if(i.push(N)===1){y()}}function y(){J(I)}function I(){var N,O=0;while(N=i[O++]){N()}i=[]}F=a.setTimeout;J=typeof setImmediate==="function"?setImmediate.bind(a):typeof process==="object"&&process.nextTick?process.nextTick:typeof vertx==="object"?vertx.runOnLoop:function(N){F(N,0)};M=Function.prototype;c=M.call;e=M.bind?c.bind(c):function(O,N){return O.apply(N,k.call(arguments,2))};l=[];k=l.slice;G=l.reduce||function(S){var O,Q,P,N,R;R=0;O=Object(this);N=O.length>>>0;Q=arguments;if(Q.length<=1){for(;;){if(R in O){P=O[R++];break}if(++R>=N){throw new TypeError()}}}else{P=Q[1]}for(;R<N;++R){if(R in O){P=S(P,O[R],R,O)}}return P};function H(N){return N}return C})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a()},this);