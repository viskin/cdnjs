!function(f,y,i){var j,p,q;function u(a,b){var c=Math.max(0,a[0]-b[0],b[0]-a[1]),d=Math.max(0,a[2]-b[1],b[1]-a[3]);return c+d}function v(a,b,c){for(var d=a.length,c=c?"offset":"position";d--;){var e=a[d].el?a[d].el:f(a[d]),k=e[c]();b[d]=[k.left,k.left+e.outerWidth(!0),k.top,k.top+e.outerHeight(!0)]}}function l(a,b){var c=b.offset();return{left:a.left-c.left,top:a.top-c.top}}function w(a,b,c){for(var b=[b.left,b.top],c=c&&[c.left,c.top],d,e=a.length,f=[];e--;)d=a[e],f[e]=[e,u(d,b),c&&u(d,c)];return f=
f.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function m(a,b,c,d){a=a.find(b);for(b=a.length;b--;){var e=a.eq(b).data(g);if(e)e[c](d)}}function n(a){this.options=f.extend({},o,a);this.containers=[];this.childGroups=[];this.scrolledProxy=f.proxy(this.scrolled,this);this.dragProxy=f.proxy(this.drag,this);this.dropProxy=f.proxy(this.drop,this);this.options.parentGroup?this.options.parentGroup.childGroups.push(this):(this.placeholder=f(this.options.placeholder),a.isValidTarget||(this.options.isValidTarget=
i))}function r(a,b){this.el=a;this.childGroups=[];this.floatRight=!1;this.dragInitProxy=f.proxy(this.dragInit,this);this.options=f.extend({},z,b);this.group=n.get(this.options);this.rootGroup=this.options.rootGroup=this.options.rootGroup||this.group;this.parentGroup=this.options.parentGroup=this.options.parentGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;this.enable(!0)}var g="sortable",z={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},o={afterMove:function(){},
containerSelector:"ol, ul",handle:"",itemSelector:"li",isValidTarget:function(){return!0},onDrag:function(a,b){a.css(b)},onDragStart:function(a){a.css({height:a.height(),width:a.width()});a.addClass("dragged");f("body").addClass("dragging")},onDrop:function(a){a.removeClass("dragged").attr("style","");f("body").removeClass("dragging")},placeholder:'<li class="placeholder"/>',pullPlaceholder:!0},s={},x=0;"ontouchstart"in y?(j="touchstart",p="touchend",q="touchmove"):(j="mousedown",p="mouseup",q="mousemove");
Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};n.get=function(a){if(!s[a.group]){if(!a.group)a.group=x++;s[a.group]=new n(a)}return s[a.group]};n.prototype={dragInit:function(a,b){this.$document=f(b.el[0].ownerDocument);this.toggleListeners("on");this.item=f(a.target).closest(this.options.itemSelector);this.itemContainer=b;this.setPointer(a)},drag:function(a){a.preventDefault();if(!this.dragging){m(this.item,
this.options.containerSelector,"disable",true);this.options.onDragStart(this.item,this.itemContainer,o.onDragStart);this.item.before(this.placeholder);this.dragging=true}if(this.setPointer(a)){this.options.onDrag(this.item,l(this.pointer,this.item.offsetParent()),o.onDrag);var b=a.pageX,a=a.pageY,c=this.sameResultBox;(!c||c.top>a||c.bottom<a||c.left>b||c.right<b)&&this.searchValidTarget()}},drop:function(a){a.preventDefault();this.toggleListeners("off");if(this.dragging){this.getContainer(this.placeholder).receiveDrop();
m(this.item,this.options.containerSelector,"enable",true);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=i;this.dragging=false}},searchValidTarget:function(a,b){if(!a){a=this.relativePointer||this.pointer;b=this.lastRelativePointer||this.lastPointer}for(var c=w(this.getContainerDimensions(),a,b),d=c.length;d--;){var e=c[d][0];if(!c[d][1]||this.options.pullPlaceholder){e=this.containers[e];if(!this.getOffsetParent())var f=e.getItemOffsetParent(),a=l(a,f),b=
l(b,f);if(e.searchValidTarget(a,b))return true}}},movePlaceholder:function(a,b,c,d){var e=this.lastAppendedItem;if(d||!(e&&e[0]===b[0])){b[c](this.placeholder);this.lastAppendedItem=b;this.sameResultBox=d;this.options.afterMove(this.placeholder,a)}},getContainerDimensions:function(){if(!this.containerDimensions)v(this.getContainers(),this.containerDimensions=[],!this.getOffsetParent());return this.containerDimensions},getContainers:function(){return this.containers},getContainer:function(a){return a.closest(this.options.containerSelector).data(g)},
getOffsetParent:function(){if(this.offsetParent===i){var a=this.containers.length-1,b=this.containers[a].getItemOffsetParent();if(!this.options.parentGroup)for(;a--;)if(b[0]!=this.containers[a].getItemOffsetParent()[0]){b=false;break}this.offsetParent=b}return this.offsetParent},clearOffsetParent:function(){this.offsetParent=i},setPointer:function(a){a={left:a.pageX,top:a.pageY};if(this.getOffsetParent()){var b=l(a,this.getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=
b}this.lastPointer=this.pointer;this.pointer=a;return true},addContainer:function(a){this.containers.push(a)},removeContainer:function(a){this.containers.remove(this.containers.indexOf(a))},scrolled:function(){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(a){this.$document[a](q+"."+g,this.dragProxy)[a](p+"."+g,this.dropProxy)[a]("scroll."+g,this.scrolledProxy)},clearDimensions:function(){this.containerDimensions=i;for(var a=this.containers.length;a--;)this.containers[a].itemDimensions=
i;for(a=this.childGroups.length;a--;)this.childGroups[a].clearDimensions()}};r.prototype={dragInit:function(a){if(!(a.which!==1||!this.options.drag||f(a.target).is(this.options.exclude))){a.preventDefault();a.stopPropagation();this.rootGroup.dragInit(a,this)}},receiveDrop:function(){var a=this.rootGroup,b=a.item;a.placeholder.before(b).detach();a.options.onDrop(b,this,o.onDrop)},searchValidTarget:function(a,b){var c=w(this.getItemDimensions(),a,b),d=c.length,e=this.rootGroup,f=!e.options.isValidTarget||
e.options.isValidTarget(e.item,this);if(!d&&f){e.movePlaceholder(this,this.el,"append");return true}for(;d--;){e=c[d][0];if(!c[d][1]&&this.options.nested&&this.getContainerGroup(e)){if(this.getContainerGroup(e).searchValidTarget(a,b))return true}else if(f){this.movePlaceholder(e,a);return true}}},movePlaceholder:function(a,b){var c=f(this.items[a]),d=this.itemDimensions[a],e="after",g=c.outerWidth(),i=c.outerHeight(),h=c.offset(),h={left:h.left,right:h.left+g,top:h.top,bottom:h.top+i};if(this.options.vertical)if(b.top<=
(d[2]+d[3])/2){e="before";h.bottom=h.bottom-i/2}else h.top=h.top+i/2;else if(b.left<=(d[0]+d[1])/2!=this.floatRight){e="before";h.right=h.right-g/2}else h.left=h.left+g/2;this.rootGroup.movePlaceholder(this,c,e,h)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.el.children(this.rootGroup.options.itemSelector).filter(":not(.dragged)").toArray();v(this.items,this.itemDimensions=[])}return this.itemDimensions},getItemOffsetParent:function(){var a=this.el;return a.css("position")===
"relative"||a.css("position")==="absolute"||a.css("position")==="fixed"?a:a.offsetParent()},getContainerGroup:function(a){var b=f.data(this.items[a],"subContainer");if(b===i){var c=f(this.items[a]).children(this.rootGroup.options.containerSelector),b=false;if(c[0]){b=f.extend({},this.options,{parentGroup:this.group,group:x++});b=c[g](b).data(g).group}f.data(this.items[a],"subContainer",b)}return b}};var t={enable:function(a){this.options.drop&&this.group.addContainer(this);a||m(this.el,this.options.containerSelector,
"enable",true);this.el.on(j+"."+g,this.handle,this.dragInitProxy)},disable:function(a){this.options.drop&&this.group.removeContainer(this);a||m(this.el,this.options.containerSelector,"disable",true);this.el.off(j+"."+g,this.handle,this.dragInitProxy)}};f.extend(r.prototype,t);f.fn[g]=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=f(this),d=c.data(g);d&&t[a]?t[a].apply(d,b):!d&&(a===i||typeof a==="object")&&c.data(g,new r(c,a))})}}(jQuery,window);
