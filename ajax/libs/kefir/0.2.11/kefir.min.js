/*! Kefir.js v0.2.11
 *  https://github.com/pozadi/kefir
 */

!function(a){"use strict";function b(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return arguments[a];return arguments[a-1]}function c(){for(var a=0;a<arguments.length;a++)if(arguments[a])return arguments[a];return arguments[a-1]}function d(a,b){var c,d,e=new Array(a.length+b.length),f=0;if(0===a.length)return b;if(0===b.length)return a;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function e(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c]===b)return c;return-1}function f(a,b){var c,d=a.length;for(c=0;d>c;c++)if(b(a[c]))return c;return-1}function g(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function h(a,b){var c,d,e,f=a.length;if(b>=0&&f>b){if(1===f)return[];for(c=new Array(f-1),d=0,e=0;f>d;d++)d!==b&&(c[e]=a[d],e++);return c}return a}function i(a,b){return h(a,f(a,b))}function j(a,b){var c,d=a.length;for(c=0;d>c;c++)b(a[c])}function k(a,b){var c,d=a.length;for(c=0;d>c;c++)a[c]=b}function l(a,b){return-1!==e(a,b)}function m(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function n(a,b,c){var d,e=Math.min(c,a.length+1),f=a.length-e+1,g=new Array(e);for(d=f;e>d;d++)g[d-f]=a[d];return g[e-1]=b,g}function o(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function p(a,b,c){var d=c?c.length:0;if(null==b)switch(d){case 0:return a();case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2]);case 4:return a(c[0],c[1],c[2],c[3]);default:return a.apply(null,c)}else switch(d){case 0:return a.call(b);default:return a.apply(b,c)}}function q(a,b,c){var e=b[0],f=b[1],g=b[2],h=b[3];switch(c){case 0:switch(b.length){case 0:return a;case 1:return function(){return a(e)};case 2:return function(){return a(e,f)};case 3:return function(){return a(e,f,g)};case 4:return function(){return a(e,f,g,h)};default:return function(){return a.apply(null,b)}}break;case 1:switch(b.length){case 0:return a;case 1:return function(b){return a(e,b)};case 2:return function(b){return a(e,f,b)};case 3:return function(b){return a(e,f,g,b)};case 4:return function(b){return a(e,f,g,h,b)};default:return function(c){return a.apply(null,d(b,[c]))}}break;case 2:switch(b.length){case 0:return a;case 1:return function(b,c){return a(e,b,c)};case 2:return function(b,c){return a(e,f,b,c)};case 3:return function(b,c){return a(e,f,g,b,c)};case 4:return function(b,c){return a(e,f,g,h,b,c)};default:return function(c,e){return a.apply(null,d(b,[c,e]))}}break;default:switch(b.length){case 0:return a;default:return function(){return p(a,null,d(b,arguments))}}}}function r(a,b,c,e){var f=c[0],g=c[1],h=c[2],i=c[3];switch(e){case 0:switch(c.length){case 0:return function(){return a.call(b)};default:return function(){return a.apply(b,c)}}break;case 1:switch(c.length){case 0:return function(c){return a.call(b,c)};case 1:return function(c){return a.call(b,f,c)};case 2:return function(c){return a.call(b,f,g,c)};case 3:return function(c){return a.call(b,f,g,h,c)};case 4:return function(c){return a.call(b,f,g,h,i,c)};default:return function(e){return a.apply(b,d(c,[e]))}}break;case 2:switch(c.length){case 0:return function(c,d){return a.call(b,c,d)};case 1:return function(c,d){return a.call(b,f,c,d)};case 2:return function(c,d){return a.call(b,f,g,c,d)};case 3:return function(c,d){return a.call(b,f,g,h,c,d)};case 4:return function(c,d){return a.call(b,f,g,h,i,c,d)};default:return function(e,f){return a.apply(b,d(c,[e,f]))}}break;default:switch(c.length){case 0:return function(){return a.apply(b,arguments)};default:return function(){return a.apply(b,d(c,arguments))}}}}function s(a,b,c,d){return null==b?q(a,c,d):r(a,b,c,d)}function t(a){var b,c,d;if(a instanceof w)return a;if(E(a))return{fn:a,context:null,args:[]};if(F(a)){if(c=null==a[1]?null:a[1],b=a[0],d=m(a,2,[]),!E(b)){if(null===c||!E(c[b]))throw new Error("Object isn't a function, and can't be converted to it: "+a);b=c[b]}return{fn:b,context:c,args:d}}throw new Error("Object isn't a function, and can't be converted to it: "+a)}function u(a,b){return a=t(a),p(a.fn,a.context,d(a.args,b))}function v(a,b){return a=t(a),s(a.fn,a.context,a.args,b)}function w(a,b){this.context=a.context,this.fn=a.fn,this.args=a.args,this.invoke=s(this.fn,this.context,this.args,b)}function x(a,b){return a instanceof w?a:new w(t(a),null==b?100:b)}function y(a,b,c){return a&&b in a?a[b]:c}function z(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function A(a){var b=function(){};return b.prototype=a,new b}function B(a){var b,c,d=arguments.length;for(b=1;d>b;b++)for(c in arguments[b])a[c]=arguments[b][c];return a}function C(a,b){var c,d=arguments.length;for(a.prototype=A(b.prototype),a.prototype.constructor=a,c=2;d>c;c++)B(a.prototype,arguments[c]);return a}function D(a){return 1===a.length&&db(a[0])?a[0]:g(a)}function E(a){return"function"==typeof a}function F(a){return db(a)||eb(a)}function G(a,b){function c(a,b){M.call(this),this._wait=a,this._intervalId=null;var c=this;this._$onTick=function(){c._onTick()},this._init(b)}C(c,M,{_name:a,_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation:function(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){M.prototype._clear.call(this),this._$onTick=null,this._free()}},b),ab[a]=function(a){return new c(a,m(arguments,1,[]))}}function H(a,b,c){function d(c){function d(b,d){c.call(this),this._source=b,this._name=b._name+"."+a,this._init(d)}return C(d,c,{_clear:function(){c.prototype._clear.call(this),this._source=null,this._free()}},b),d}c=B({streamMethod:function(a){return function(){return new a(this,arguments)}},propertyMethod:function(a,b){return function(){return new b(this,arguments)}}},c||{}),b=B({_init:function(){},_free:function(){},_handleValue:function(a,b){this._send("value",a,b)},_handleEnd:function(a,b){this._send("end",null,b)},_onActivationHook:function(){},_onDeactivationHook:function(){},_handleAny:function(a){switch(a.type){case"value":this._handleValue(a.value,a.current);break;case"end":this._handleEnd(a.value,a.current)}},_onActivation:function(){this._onActivationHook(),this._source.onAny([this._handleAny,this])},_onDeactivation:function(){this._onDeactivationHook(),this._source.offAny([this._handleAny,this])}},b||{});var e=d(M),f=d(N);c.streamMethod&&(M.prototype[a]=c.streamMethod(e,f)),c.propertyMethod&&(N.prototype[a]=c.propertyMethod(e,f))}function I(a,b){function c(c){function d(b,d){c.call(this),this._primary=b,this._secondary=d,this._name=b._name+"."+a,this._lastSecondary=bb,this._secondaryRemoved=!1,this._init()}return C(d,c,{_clear:function(){c.prototype._clear.call(this),this._primary=null,this._secondary=null,this._lastSecondary=null,this._free()}},b),d}b=B({_init:function(){},_free:function(){},_handlePrimaryValue:function(){},_handlePrimaryEnd:function(a,b){this._send("end",null,b)},_handleSecondaryValue:function(a){this._lastSecondary=a},_handleSecondaryEnd:function(){},_handlePrimaryAny:function(a){switch(a.type){case"value":this._handlePrimaryValue(a.value,a.current);break;case"end":this._handlePrimaryEnd(a.value,a.current)}},_handleSecondaryAny:function(a){switch(a.type){case"value":this._handleSecondaryValue(a.value,a.current);break;case"end":this._handleSecondaryEnd(a.value,a.current)}},_removeSecondary:function(){this._secondary.offAny([this._handleSecondaryAny,this]),this._secondary=null,this._secondaryRemoved=!0},_onActivation:function(){this._secondaryRemoved||this._secondary.onAny([this._handleSecondaryAny,this]),this._alive&&this._primary.onAny([this._handlePrimaryAny,this])},_onDeactivation:function(){this._secondaryRemoved||this._secondary.offAny([this._handleSecondaryAny,this]),this._primary.offAny([this._handlePrimaryAny,this])}},b||{});var d=c(M),e=c(N);M.prototype[a]=function(a){return new d(this,a)},N.prototype[a]=function(a){return new e(this,a)}}function J(){this._fns=[]}function K(a,b,c){return{type:a,value:b,current:!!c}}function L(){this._subscribers=new J,this._active=!1,this._alive=!0}function M(){L.call(this)}function N(){L.call(this),this._current=bb}function O(a,b){var c="<"+b.type+(b.current?":current":"")+">";"value"===b.type?console.log(a,c,b.value):console.log(a,c)}function P(a){if(M.call(this),this._queueLim=y(a,"queueLim",0),this._concurLim=y(a,"concurLim",-1),this._drop=y(a,"drop","new"),0===this._concurLim)throw new Error("options.concurLim can't be 0");this._queue=[],this._curSources=[],this._activating=!1}function Q(a){P.call(this),0===a.length?this._send("end"):this._addAll(a),this._initialised=!0}function R(a){P.call(this,{concurLim:1,queueLim:-1}),0===a.length?this._send("end"):this._addAll(a),this._initialised=!0}function S(){P.call(this)}function T(){P.call(this)}function U(a,b,c){P.call(this,c),this._source=a,this._fn=b?v(b,1):null,this._mainEnded=!1,this._lastCurrent=null}function V(a,b,c){M.call(this),0===b.length?this._send("end"):(this._passiveCount=a.length,this._combinator=c?x(c):null,this._sources=d(a,b),this._aliveCount=0,this._currents=new Array(this._sources.length),k(this._currents,bb),this._activating=!1,this._emitAfterActivation=!1,this._endAfterActivation=!1)}function W(a){return function(){return new a(this,arguments)}}function X(a,b){return function(){return new b(this,arguments)}}function Y(a){return{init:function(){return null},step:function(b,c){return a._send("value",c,a._forcedCurrent),null},result:function(){return a._send("end",null,a._forcedCurrent),null}}}function Z(a){M.call(this),this._fn=v(a,1),this._unsubscribe=null}function $(){M.call(this)}function _(a){N.call(this),this._send("value",a),this._send("end")}var ab={};w.prototype.apply=function(a){return p(this.invoke,null,a)},w.prototype.applyWithContext=function(a,b){return null===this.context?p(this.fn,a,d(this.args,b)):this.apply(b)},x.isEqual=function(a,b){return a===b?!0:(a=x(a),b=x(b),a.fn===b.fn&&a.context===b.context&&o(a.args,b.args))},ab.Fn=x;var bb=["<nothing>"],cb=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},db=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},eb=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};eb(arguments)||(eb=function(a){return!(!a||!z(a,"callee"))}),B(J,{callOne:function(a,b){"any"===a.type?a.invoke(b):a.type===b.type&&("value"===a.type?a.invoke(b.value):a.invoke())},callOnce:function(a,b,c){"any"===a?u(b,[c]):a===c.type&&("value"===a?u(b,[c.value]):u(b,[]))}}),B(J.prototype,{add:function(a,b){b=x(b,"end"===a?0:1),b.type=a,this._fns=d(this._fns,[b])},remove:function(a,b){b=x(b),this._fns=i(this._fns,function(c){return c.type===a&&x.isEqual(c,b)})},callAll:function(a){for(var b=this._fns,c=0;c<b.length;c++)J.callOne(b[c],a)},isEmpty:function(){return 0===this._fns.length}});var fb=K("end",void 0,!0);ab.Observable=L,B(L.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(a){this._active!==a&&(this._active=a,a?this._onActivation():this._onDeactivation())},_clear:function(){this._setActive(!1),this._alive=!1,this._subscribers=null},_send:function(a,b,c){this._alive&&(this._subscribers.callAll(K(a,b,c)),"end"===a&&this._clear())},on:function(a,b){return this._alive?(this._subscribers.add(a,b),this._setActive(!0)):J.callOnce(a,b,fb),this},off:function(a,b){return this._alive&&(this._subscribers.remove(a,b),this._subscribers.isEmpty()&&this._setActive(!1)),this},onValue:function(a){return this.on("value",a)},onEnd:function(a){return this.on("end",a)},onAny:function(a){return this.on("any",a)},offValue:function(a){return this.off("value",a)},offEnd:function(a){return this.off("end",a)},offAny:function(a){return this.off("any",a)}}),L.prototype.toString=function(){return"["+this._name+"]"},ab.Stream=M,C(M,L,{_name:"stream"}),ab.Property=N,C(N,L,{_name:"property",_send:function(a,b,c){this._alive&&(c||this._subscribers.callAll(K(a,b)),"value"===a&&(this._current=b),"end"===a&&this._clear())},on:function(a,b){return this._alive&&(this._subscribers.add(a,b),this._setActive(!0)),this._current!==bb&&J.callOnce(a,b,K("value",this._current,!0)),this._alive||J.callOnce(a,b,fb),this}}),L.prototype.log=function(a){return this.onAny([O,null,a||this.toString()]),this},L.prototype.offLog=function(a){return this.offAny([O,null,a||this.toString()]),this},G("withInterval",{_init:function(a){this._fn=v(a[0],1);var b=this;this._emitter={emit:function(a){b._send("value",a)},end:function(){b._send("end")}}},_free:function(){this._fn=null,this._emitter=null},_onTick:function(){this._fn(this._emitter)}}),G("fromPoll",{_init:function(a){this._fn=v(a[0],0)},_free:function(){this._fn=null},_onTick:function(){this._send("value",this._fn())}}),G("interval",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x)}}),G("sequentially",{_init:function(a){this._xs=g(a[0]),0===this._xs.length&&this._send("end")},_free:function(){this._xs=null},_onTick:function(){switch(this._xs.length){case 1:this._send("value",this._xs[0]),this._send("end");break;default:this._send("value",this._xs.shift())}}}),G("repeatedly",{_init:function(a){this._xs=g(a[0]),this._i=-1},_onTick:function(){this._xs.length>0&&(this._i=(this._i+1)%this._xs.length,this._send("value",this._xs[this._i]))}}),G("later",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x),this._send("end")}}),C(P,M,{_name:"abstractPool",_add:function(a){-1===this._concurLim||this._curSources.length<this._concurLim?this._addToCur(a):-1===this._queueLim||this._queue.length<this._queueLim?this._addToQueue(a):"old"===this._drop&&(this._removeOldest(),this._add(a))},_addAll:function(a){var b=this;j(a,function(a){b._add(a)})},_remove:function(a){-1===this._removeCur(a)&&this._removeQueue(a)},_addToQueue:function(a){this._queue=d(this._queue,[a])},_addToCur:function(a){this._curSources=d(this._curSources,[a]),this._active&&this._sub(a)},_sub:function(a){a.onAny([this._handleSubAny,this]),a.onEnd([this._removeCur,this,a])},_unsub:function(a){a.offAny([this._handleSubAny,this]),a.offEnd([this._removeCur,this,a])},_handleSubAny:function(a){"value"===a.type&&this._send("value",a.value,a.current&&this._activating)},_removeQueue:function(a){var b=e(this._queue,a);return this._queue=h(this._queue,b),b},_removeCur:function(a){this._active&&this._unsub(a);var b=e(this._curSources,a);return this._curSources=h(this._curSources,b),-1!==b&&(0!==this._queue.length?this._pullQueue():0===this._curSources.length&&this._onEmpty()),b},_removeOldest:function(){this._removeCur(this._curSources[0])},_pullQueue:function(){0!==this._queue.length&&(this._queue=g(this._queue),this._addToCur(this._queue.shift()))},_onActivation:function(){var a,b=this._curSources;for(this._activating=!0,a=0;a<b.length;a++)this._sub(b[a]);this._activating=!1},_onDeactivation:function(){var a,b=this._curSources;for(a=0;a<b.length;a++)this._unsub(b[a])},_isEmpty:function(){return 0===this._curSources.length},_onEmpty:function(){},_clear:function(){M.prototype._clear.call(this),this._queue=null,this._curSources=null}});var gb={_onEmpty:function(){this._initialised&&this._send("end",null,this._activating)}};C(Q,P,B({_name:"merge"},gb)),ab.merge=function(){return new Q(D(arguments))},L.prototype.merge=function(a){return ab.merge([this,a])},C(R,P,B({_name:"concat"},gb)),ab.concat=function(){return new R(D(arguments))},L.prototype.concat=function(a){return ab.concat([this,a])},C(S,P,{_name:"pool",plug:function(a){return this._add(a),this},unplug:function(a){return this._remove(a),this}}),ab.pool=function(){return new S},C(T,P,{_name:"bus",plug:function(a){return this._add(a),this},unplug:function(a){return this._remove(a),this},emit:function(a){return this._send("value",a),this},end:function(){return this._send("end"),this}}),ab.bus=function(){return new T},C(U,P,{_onActivation:function(){P.prototype._onActivation.call(this),this._activating=!0,this._source.onAny([this._handleMainSource,this]),this._activating=!1},_onDeactivation:function(){P.prototype._onDeactivation.call(this),this._source.offAny([this._handleMainSource,this])},_handleMainSource:function(a){"value"===a.type?(a.current&&this._lastCurrent===a.value||this._add(this._fn?this._fn(a.value):a.value),this._lastCurrent=a.value):this._isEmpty()?this._send("end",null,a.current):this._mainEnded=!0},_onEmpty:function(){this._mainEnded&&this._send("end")},_clear:function(){P.prototype._clear.call(this),this._source=null,this._lastCurrent=null}}),L.prototype.flatMap=function(a){return new U(this,a).setName(this,"flatMap")},L.prototype.flatMapLatest=function(a){return new U(this,a,{concurLim:1,drop:"old"}).setName(this,"flatMapLatest")},L.prototype.flatMapFirst=function(a){return new U(this,a,{concurLim:1}).setName(this,"flatMapFirst")},L.prototype.flatMapConcat=function(a){return new U(this,a,{queueLim:-1,concurLim:1}).setName(this,"flatMapConcat")},L.prototype.flatMapConcurLimit=function(a,b){var c;return 0===b?c=ab.never():(0>b&&(b=-1),c=new U(this,a,{queueLim:-1,concurLim:b})),c.setName(this,"flatMapConcurLimit")},C(V,M,{_name:"sampledBy",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b-this._passiveCount,this._activating=!0,a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this,a]);this._activating=!1,this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull(!0)),this._endAfterActivation&&this._send("end",null,!0)},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this,a])},_emitIfFull:function(a){if(!l(this._currents,bb)){var b=g(this._currents);this._combinator&&(b=this._combinator.apply(this._currents)),this._send("value",b,a)}},_handleAny:function(a,b){"value"===b.type?(this._currents[a]=b.value,a>=this._passiveCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull(b.current))):a>=this._passiveCount&&(this._aliveCount--,0===this._aliveCount&&(this._activating?this._endAfterActivation=!0:this._send("end",null,b.current)))},_clear:function(){M.prototype._clear.call(this),this._sources=null,this._currents=null}}),ab.sampledBy=function(a,b,c){return new V(a,b,c)},L.prototype.sampledBy=function(a,b){return ab.sampledBy([this],[a],b)},ab.combine=function(a,b){var c=new V([],a,b);return c._name="combine",c},L.prototype.combine=function(a,b){return ab.combine([this,a],b)},H("toProperty",{_init:function(a){a.length>0&&this._send("value",a[0])}},{propertyMethod:null,streamMethod:X}),H("changes",{_handleValue:function(a,b){b||this._send("value",a)}},{streamMethod:null,propertyMethod:W}),H("withHandler",{_init:function(a){this._handler=v(a[0],2),this._forcedCurrent=!1;var b=this;this._emitter={emit:function(a){b._send("value",a,b._forcedCurrent)},end:function(){b._send("end",null,b._forcedCurrent)}}},_free:function(){this._handler=null,this._emitter=null},_handleAny:function(a){this._forcedCurrent=a.current,this._handler(this._emitter,a),this._forcedCurrent=!1}}),H("flatten",{_init:function(a){this._fn=a[0]?v(a[0],1):null},_free:function(){this._fn=null},_handleValue:function(a,b){for(var c=null===this._fn?a:this._fn(a),d=0;d<c.length;d++)this._send("value",c[d],b)}}),H("transduce",{_init:function(a){this._xform=a[0](Y(this)),this._forcedCurrent=!0,this._endIfReduced(this._xform.init()),this._forcedCurrent=!1},_free:function(){this._xform=null},_endIfReduced:function(a){null!==a&&this._xform.result(null)},_handleValue:function(a,b){this._forcedCurrent=b,this._endIfReduced(this._xform.step(null,a)),this._forcedCurrent=!1},_handleEnd:function(a,b){this._forcedCurrent=b,this._xform.result(null),this._forcedCurrent=!1}});var hb={_init:function(a){this._fn=v(a[0],1)},_free:function(){this._fn=null}};H("map",B({_handleValue:function(a,b){this._send("value",this._fn(a),b)}},hb)),H("filter",B({_handleValue:function(a,b){this._fn(a)&&this._send("value",a,b)}},hb)),H("takeWhile",B({_handleValue:function(a,b){this._fn(a)?this._send("value",a,b):this._send("end",null,b)}},hb)),H("take",{_init:function(a){this._n=a[0],this._n<=0&&this._send("end")},_handleValue:function(a,b){this._n--,this._send("value",a,b),0===this._n&&this._send("end",null,b)}}),H("skip",{_init:function(a){this._n=a[0]<0?0:a[0]},_handleValue:function(a,b){0===this._n?this._send("value",a,b):this._n--}}),H("skipDuplicates",{_init:function(a){this._fn=a[0]?v(a[0],2):null,this._prev=bb},_free:function(){this._fn=null,this._prev=null},_isEqual:function(a,b){return null===this._fn?a===b:this._fn(a,b)},_handleValue:function(a,b){this._prev!==bb&&this._isEqual(this._prev,a)||(this._send("value",a,b),this._prev=a)}}),H("skipWhile",{_init:function(a){this._fn=v(a[0],1),this._skip=!0},_free:function(){this._fn=null},_handleValue:function(a,b){return this._skip?void(this._fn(a)||(this._skip=!1,this._fn=null,this._send("value",a,b))):void this._send("value",a,b)}}),H("diff",{_init:function(a){this._prev=a[0],this._fn=a[1]?v(a[1],2):null},_free:function(){this._prev=null,this._fn=null},_handleValue:function(a,b){var c=null===this._fn?[this._prev,a]:this._fn(this._prev,a);this._send("value",c,b),this._prev=a}}),H("scan",{_init:function(a){this._send("value",a[0],!0),this._fn=v(a[1],2)},_free:function(){this._fn=null},_handleValue:function(a,b){this._send("value",this._fn(this._current,a),b)}},{streamMethod:X}),H("reduce",{_init:function(a){this._result=a[0],this._fn=v(a[1],2)},_free:function(){this._fn=null,this._result=null},_handleValue:function(a){this._result=this._fn(this._result,a)},_handleEnd:function(a,b){this._send("value",this._result,b),this._send("end",null,b)}}),H("slidingWindow",{_init:function(a){this._max=a[0],this._min=a[1]||0,this._cache=[]},_free:function(){this._cache=null},_handleValue:function(a,b){this._cache=n(this._cache,a,this._max),this._cache.length>=this._min&&this._send("value",this._cache,b)}}),H("debounce",{_init:function(a){this._wait=Math.max(0,a[0]),this._immediate=y(a[1],"immediate",!1),this._lastAttempt=0,this._timeoutId=null,this._laterValue=null,this._endLater=!1;var b=this;this._$later=function(){b._later()}},_free:function(){this._laterValue=null,this._$later=null},_handleValue:function(a,b){b?this._send("value",a,b):(this._lastAttempt=cb(),this._immediate&&!this._timeoutId&&this._send("value",a),this._timeoutId||(this._timeoutId=setTimeout(this._$later,this._wait)),this._immediate||(this._laterValue=a))},_handleEnd:function(a,b){b?this._send("end",null,b):this._timeoutId&&!this._immediate?this._endLater=!0:this._send("end")},_later:function(){var a=cb()-this._lastAttempt;a<this._wait&&a>=0?this._timeoutId=setTimeout(this._$later,this._wait-a):(this._timeoutId=null,this._immediate||(this._send("value",this._laterValue),this._laterValue=null),this._endLater&&this._send("end"))}}),H("throttle",{_init:function(a){this._wait=Math.max(0,a[0]),this._leading=y(a[1],"leading",!0),this._trailing=y(a[1],"trailing",!0),this._trailingValue=null,this._timeoutId=null,this._endLater=!1,this._lastCallTime=0;var b=this;this._$trailingCall=function(){b._trailingCall()}},_free:function(){this._trailingValue=null,this._$trailingCall=null},_handleValue:function(a,b){if(b)this._send("value",a,b);else{var c=cb();0!==this._lastCallTime||this._leading||(this._lastCallTime=c);var d=this._wait-(c-this._lastCallTime);0>=d?(this._cancelTraling(),this._lastCallTime=c,this._send("value",a)):this._trailing&&(this._cancelTraling(),this._trailingValue=a,this._timeoutId=setTimeout(this._$trailingCall,d))}},_handleEnd:function(a,b){b?this._send("end",null,b):this._timeoutId?this._endLater=!0:this._send("end")},_cancelTraling:function(){null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},_trailingCall:function(){this._send("value",this._trailingValue),this._timeoutId=null,this._trailingValue=null,this._lastCallTime=this._leading?cb():0,this._endLater&&this._send("end")}}),H("delay",{_init:function(a){this._wait=Math.max(0,a[0]),this._buff=[];var b=this;this._$shiftBuff=function(){b._send("value",b._buff.shift())}},_free:function(){this._buff=null,this._$shiftBuff=null},_handleValue:function(a,b){b?this._send("value",a,b):(this._buff.push(a),setTimeout(this._$shiftBuff,this._wait))},_handleEnd:function(a,b){if(b)this._send("end",null,b);else{var c=this;setTimeout(function(){c._send("end")},this._wait)}}}),C(Z,M,{_name:"fromBinder",_onActivation:function(){var a,b=this,c=!0,d={emit:function(a){b._send("value",a,c)},end:function(){b._send("end",null,c)}};a=this._fn(d),c=!1,a&&(this._unsubscribe=v(a,0))},_onDeactivation:function(){null!==this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null)},_clear:function(){M.prototype._clear.call(this),this._fn=null}}),ab.fromBinder=function(a){return new Z(a)},C($,M,{_name:"emitter",emit:function(a){return this._send("value",a),this},end:function(){return this._send("end"),this}}),ab.emitter=function(){return new $};var ib=new M;ib._send("end"),ib._name="never",ab.never=function(){return ib},C(_,N,{_name:"constant"}),ab.constant=function(a){return new _(a)},L.prototype.setName=function(a,b){return this._name=b?a._name+"."+b:a,this},L.prototype.mapTo=function(a){return this.map(function(){return a}).setName(this,"mapTo")},L.prototype.pluck=function(a){return this.map(function(b){return b[a]}).setName(this,"pluck")},L.prototype.invoke=function(a){var b=m(arguments,1);return this.map(b?function(c){return p(c[a],c,b)}:function(b){return b[a]()}).setName(this,"invoke")},L.prototype.timestamp=function(){return this.map(function(a){return{value:a,time:cb()}}).setName(this,"timestamp")},L.prototype.tap=function(a){return a=v(a,1),this.map(function(b){return a(b),b}).setName(this,"tap")},ab.and=function(a){return ab.combine(a,b).setName("and")},L.prototype.and=function(a){return this.combine(a,b).setName("and")},ab.or=function(a){return ab.combine(a,c).setName("or")},L.prototype.or=function(a){return this.combine(a,c).setName("or")},L.prototype.not=function(){return this.map(function(a){return!a}).setName(this,"not")},L.prototype.awaiting=function(a){return ab.merge([this.mapTo(!0),a.mapTo(!1)]).skipDuplicates().toProperty(!1).setName(this,"awaiting")},ab.fromCallback=function(a){a=v(a,1);var b=!1;return ab.fromBinder(function(c){b||(a(function(a){c.emit(a),c.end()}),b=!0)}).setName("fromCallback")},ab.fromEvent=function(a,b,c){c=c&&x(c);var d=a.addEventListener||a.addListener||a.bind,e=a.removeEventListener||a.removeListener||a.unbind;return ab.fromBinder(function(f){var g=c?function(){f.emit(c.applyWithContext(this,arguments))}:f.emit;return d.call(a,b,g),function(){e.call(a,b,g)}}).setName("fromEvent")},I("filterBy",{_handlePrimaryValue:function(a,b){this._lastSecondary!==bb&&this._lastSecondary&&this._send("value",a,b)},_handleSecondaryEnd:function(a,b){this._lastSecondary!==bb&&this._lastSecondary||this._send("end",null,b)}}),I("waitFor",{_handlePrimaryValue:function(a,b){this._lastSecondary!==bb&&this._send("value",a,b)},_handleSecondaryValue:function(a){this._lastSecondary=a,this._removeSecondary()},_handleSecondaryEnd:function(a,b){this._lastSecondary===bb&&this._send("end",null,b)}}),I("takeWhileBy",{_handlePrimaryValue:function(a,b){this._lastSecondary!==bb&&this._send("value",a,b)},_handleSecondaryValue:function(a,b){this._lastSecondary=a,this._lastSecondary||this._send("end",null,b)},_handleSecondaryEnd:function(a,b){this._lastSecondary===bb&&this._send("end",null,b)}}),I("skipWhileBy",{_handlePrimaryValue:function(a,b){this._lastSecondary===bb||this._lastSecondary||this._send("value",a,b)},_handleSecondaryValue:function(a){this._lastSecondary=a,this._lastSecondary||this._removeSecondary()},_handleSecondaryEnd:function(a,b){(this._lastSecondary===bb||this._lastSecondary)&&this._send("end",null,b)}}),"function"==typeof define&&define.amd?(define([],function(){return ab}),a.Kefir=ab):"object"==typeof module&&"object"==typeof exports?(module.exports=ab,ab.Kefir=ab):a.Kefir=ab}(this);
//# sourceMappingURL=kefir.min.js.map