/*! kefir - 0.1.8
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){return a instanceof Array?a:Array.prototype.slice.call(a)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a=d(arguments);if(1===a.length)return a[0];for(var b=a.shift(),e=0;e<a.length;e++)for(var f in a[e])c(a[e],f)&&(b[f]=a[e][f]);return b}function g(a,b){a.prototype=e(b.prototype),a.prototype.constructor=a;for(var c=2;c<arguments.length;c++)f(a.prototype,arguments[c]);return a}function h(a,b){for(var d in b)!c(b,d)||d in a||(a[d]=b[d]);return a}function i(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:d(a)}function j(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c?null:[]}function k(a,b){var c=a[1],e=a[2],f=j(a,3);return b&&(f=f.concat(d(b))),c.apply(e,f)}function l(a){return"function"==typeof a}function m(a,b){if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}var n={},o=n.NOTHING=["<nothing>"],p=n.END=["<end>"],q=n.NO_MORE=["<no more>"];n.BunchOfValues=function(a){this.values=a},n.bunch=function(){return new n.BunchOfValues(i(arguments))};var r=n.Observable=function(a,b){l(a)&&(this.__onFirstIn=a),l(b)&&(this.__onLastOut=b),this.__subscribers=[]};g(r,Object,{__ClassName:"Observable",toString:function(){return"["+this.__ClassName+(this.__objName?" | "+this.__objName:"")+"]"},__onFirstIn:b,__onLastOut:b,__on:function(a){if(this.isEnded())"end"===a&&k(arguments);else{var b="value"===a&&!this.__hasSubscribers("value");this.__subscribers.push(arguments),b&&this.__onFirstIn()}},__off:function(a){if(!this.isEnded()){for(var b=0;b<this.__subscribers.length;b++)m(this.__subscribers[b],arguments)&&(this.__subscribers[b]=null);"value"!==a||this.__hasSubscribers("value")||this.__onLastOut()}},__send:function(a){if(!this.isEnded()){for(var b=0;b<this.__subscribers.length;b++){var c=this.__subscribers[b];if(c&&c[0]===a){var d=k(c,j(arguments,1));d===q&&this.__off.apply(this,c)}}"end"===a&&this.__clear()}},__hasSubscribers:function(a){if(this.isEnded())return!1;for(var b=0;b<this.__subscribers.length;b++)if(this.__subscribers[b]&&this.__subscribers[b][0]===a)return!0;return!1},__clear:function(){this.__onLastOut(),c(this,"__onFirstIn")&&(this.__onFirstIn=null),c(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null},__sendValue:function(a){this.__send("value",a)},__sendEnd:function(){this.__send("end")},__sendAny:function(a){if(a===p)this.__sendEnd();else if(a instanceof n.BunchOfValues)for(var b=0;b<a.values.length;b++)this.__sendAny(a.values[b]);else a!==n.NOTHING&&this.__sendValue(a)},onValue:function(){this.__on.apply(this,["value"].concat(d(arguments)))},offValue:function(){this.__off.apply(this,["value"].concat(d(arguments)))},onEnd:function(){this.__on.apply(this,["end"].concat(d(arguments)))},offEnd:function(){this.__off.apply(this,["end"].concat(d(arguments)))},onNewValue:function(){this.onValue.apply(this,arguments)},isEnded:function(){return!this.__subscribers}});var s=n.Stream=function(){r.apply(this,arguments)};g(s,r,{__ClassName:"Stream"});var t=n.Property=function(a,b,c){r.call(this,a,b),this.__cached="undefined"!=typeof c?c:n.NOTHING};g(t,r,{__ClassName:"Property",hasCached:function(){return this.__cached!==n.NOTHING},getCached:function(){return this.__cached},__sendValue:function(a){this.isEnded()||(this.__cached=a),r.prototype.__sendValue.call(this,a)},onNewValue:function(){this.__on.apply(this,["value"].concat(d(arguments)))},onValue:function(){this.hasCached()&&k(["value"].concat(d(arguments)),[this.__cached]),this.onNewValue.apply(this,arguments)}}),r.prototype.log=function(a){function b(b){console.log(a,b)}a||(a=this.toString()),this.onValue(b),this.onEnd(function(){b(p)})};var u=new s;u.__sendEnd(),u.__objName="Kefir.never()",n.never=function(){return u},n.OnceStream=function(a){s.call(this),this.__value=a},g(n.OnceStream,s,{__ClassName:"OnceStream",onValue:function(){this.isEnded()||(k(["value"].concat(d(arguments)),[this.__value]),this.__value=null,this.__sendEnd())}}),n.once=function(a){return new n.OnceStream(a)},n.FromBinderStream=function(a){s.call(this),this.__subscribe=a},g(n.FromBinderStream,s,{__ClassName:"FromBinderStream",__onFirstIn:function(){var a=this;this.__usubscriber=this.__subscribe(function(b){a.__sendAny(b)})},__onLastOut:function(){l(this.__usubscriber)&&this.__usubscriber(),this.__usubscriber=null},__clear:function(){s.prototype.__clear.call(this),this.__subscribe=null}}),n.fromBinder=function(a){return new n.FromBinderStream(a)};var v={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof t&&this instanceof t&&a.hasCached()&&this.__handle(a.getCached())},__handle:function(a){this.__sendAny(a)},__onFirstIn:function(){this.__source.onNewValue(this.__handle,this)},__onLastOut:function(){this.__source.offValue(this.__handle,this)},__clear:function(){r.prototype.__clear.call(this),this.__source=null}};n.PropertyFromStream=function(a,b){t.call(this,null,null,b),this.__Constructor(a)},g(n.PropertyFromStream,t,v,{__ClassName:"PropertyFromStream"}),s.prototype.toProperty=function(a){return new n.PropertyFromStream(this,a)},t.prototype.toProperty=function(a){if("undefined"==typeof a)return this;var b=new n.PropertyFromStream(this);return b.__sendValue(a),b},n.ChangesStream=function(a){s.call(this),this.__Constructor(a)},g(n.ChangesStream,s,v,{__ClassName:"ChangesStream"}),t.prototype.changes=function(){return new n.ChangesStream(this)},n.ScanProperty=function(a,b,c){t.call(this,null,null,b),this.__fn=c,this.__Constructor(a)},g(n.ScanProperty,t,v,{__ClassName:"ScanProperty",__handle:function(a){this.__sendValue(this.__fn(this.getCached(),a))},__clear:function(){v.__clear.call(this),this.__fn=null}}),r.prototype.scan=function(a,b){return new n.ScanProperty(this,a,b)};var w={__Constructor:function(a,b){a instanceof t?t.call(this):s.call(this),this.__mapFn=b,v.__Constructor.call(this,a)},__handle:function(a){this.__sendAny(this.__mapFn(a))},__clear:function(){v.__clear.call(this),this.__mapFn=null}};h(w,v),n.MappedStream=function(){this.__Constructor.apply(this,arguments)},g(n.MappedStream,s,w,{__ClassName:"MappedStream"}),n.MappedProperty=function(){this.__Constructor.apply(this,arguments)},g(n.MappedProperty,t,w,{__ClassName:"MappedProperty"}),s.prototype.map=function(a){return new n.MappedStream(this,a)},t.prototype.map=function(a){return new n.MappedProperty(this,a)},r.prototype.filter=function(a){return this.map(function(b){return a(b)?b:o})},r.prototype.takeWhile=function(a){return this.map(function(b){return a(b)?b:p})},r.prototype.take=function(a){return this.map(function(b){return 0>=a?p:1===a?n.bunch(b,p):(a--,b)})};var x={__initPluggable:function(){this.__plugged=[]},__clearPluggable:function(){this.__plugged=null},__handlePlugged:function(a,b){this.__sendAny(b)},__plug:function(a){if(!this.isEnded()){this.__plugged.push(a);var b=this.__plugged.length-1;this.__hasSubscribers("value")&&a.onValue(this.__handlePlugged,this,b),a.onEnd(this.__unplugById,this,b)}},__unplugById:function(a){if(!this.isEnded()){var b=this.__plugged[a];b&&(this.__plugged[a]=null,b.offValue(this.__handlePlugged,this,a),b.onEnd(this.__unplugById,this,a))}},__unplug:function(a){if(!this.isEnded())for(var b=0;b<this.__plugged.length;b++)this.__plugged[b]===a&&this.__unplugById(b)},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++){var b=this.__plugged[a];b&&b.onValue(this.__handlePlugged,this,a)}},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++){var b=this.__plugged[a];b&&b.offValue(this.__handlePlugged,this,a)}},__hasNoPlugged:function(){if(this.isEnded())return!0;for(var a=0;a<this.__plugged.length;a++)if(this.__plugged[a])return!1;return!0}};n.Bus=function(){s.call(this),this.__initPluggable()},g(n.Bus,s,x,{__ClassName:"Bus",push:function(a){this.__sendAny(a)},plug:function(a){this.__plug(a)},unplug:function(a){this.__unplug(a)},end:function(){this.__sendEnd()},__clear:function(){s.prototype.__clear.call(this),this.__clearPluggable(),this.push=b}}),n.bus=function(){return new n.Bus},n.FlatMappedStream=function(a,b){s.call(this),this.__initPluggable(),this.__sourceStream=a,this.__mapFn=b,a.onEnd(this.__onSourceEnds,this)},g(n.FlatMappedStream,s,x,{__ClassName:"FlatMappedStream",__onSourceEnds:function(){this.__hasNoPlugged()&&this.__sendEnd()},__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.onValue(this.__plugResult,this),x.__onFirstIn.call(this)},__onLastOut:function(){this.__sourceStream.offValue(this.__plugResult,this),x.__onLastOut.call(this)},__unplugById:function(a){x.__unplugById.call(this,a),!this.isEnded()&&this.__hasNoPlugged()&&this.__sourceStream.isEnded()&&this.__sendEnd()},__clear:function(){s.prototype.__clear.call(this),this.__clearPluggable(),this.__sourceStream=null,this.__mapFn=null}}),r.prototype.flatMap=function(a){return new n.FlatMappedStream(this,a)},n.MergedStream=function(){s.call(this),this.__initPluggable();for(var a=i(arguments),b=0;b<a.length;b++)this.__plug(a[b])},g(n.MergedStream,s,x,{__ClassName:"MergedStream",__clear:function(){s.prototype.__clear.call(this),this.__clearPluggable()},__unplugById:function(a){x.__unplugById.call(this,a),this.__hasNoPlugged()&&this.__sendEnd()}}),n.merge=function(){return new n.MergedStream(i(arguments))},r.prototype.merge=function(){return n.merge([this].concat(i(arguments)))},n.CombinedStream=function(a,b){s.call(this),this.__initPluggable();for(var c=0;c<a.length;c++)this.__plug(a[c]);this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__mapFn=b},g(n.CombinedStream,s,x,{__ClassName:"CombinedStream",__unplugById:function(a){x.__unplugById.call(this,a),this.__hasNoPlugged()&&this.__sendEnd()},__handlePlugged:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&(l(this.__mapFn)?this.__sendAny(this.__mapFn.apply(null,this.__cachedValues)):this.__sendValue(this.__cachedValues.slice(0)))},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__clear:function(){s.prototype.__clear.call(this),this.__clearPluggable(),this.__cachedValues=null,this.__hasCached=null,this.__mapFn=null}}),n.combine=function(a,b){return new n.CombinedStream(a,b)},r.prototype.combine=function(a,b){return n.combine([this].concat(a),b)};var y=n.FromPollStream=function(a,b){s.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__bindedSend=function(){c.__sendAny(b())}};g(y,s,{__ClassName:"FromPollStream",__onFirstIn:function(){this.__intervalId=setInterval(this.__bindedSend,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__clear:function(){s.prototype.__clear.call(this),this.__bindedSend=null}}),n.fromPoll=function(a,b){return new y(a,b)},n.interval=function(a,b){return new y(a,function(){return b})},n.sequentially=function(a,b){return b=b.slice(0),new y(a,function(){return 0===b.length?p:1===b.length?n.bunch(b[0],p):b.shift()})},n.repeatedly=function(a,b){var c=-1;return new y(a,function(){return b[++c%b.length]})},"function"==typeof define&&define.amd?(define([],function(){return n}),a.Kefir=n):"object"==typeof module&&"object"==typeof exports?(module.exports=n,n.Kefir=n):a.Kefir=n}(this);