/*! kefir - 0.2.2
 *  https://github.com/pozadi/kefir
 */

!function(a){"use strict";function b(a,b,c){return a&&b in a?a[b]:c}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){var b=function(){};return b.prototype=a,new b}function e(){var a,b,d,e=arguments.length;if(1===e)return arguments[0];for(a=arguments[0],b=1;e>b;b++)for(d in arguments[b])c(arguments[b],d)&&(a[d]=arguments[b][d]);return a}function f(a,b){var c,f=arguments.length;for(a.prototype=d(b.prototype),a.prototype.constructor=a,c=2;f>c;c++)e(a.prototype,arguments[c]);return a}function g(a){return 1===a.length&&r(a[0])?a[0]:p(a)}function h(a,b){if(q(a))return a;if(null!=b&&q(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function i(a,b,c){if(null!=b)return c&&0!==c.length?a.apply(b,c):a.call(b);if(!c||0===c.length)return a();switch(c.length){case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2])}return a.apply(null,c)}function j(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function k(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function l(a,b){var c,d=a.length,e=new Array(d);for(c=0;d>c;c++)e[c]=b(a[c]);return e}function m(a,b){var c,d=a.length;for(c=0;d>c;c++)a[c]=b}function n(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c]===b)return!0;return!1}function o(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function p(a){return r(a)?a:k(a)}function q(a){return"function"==typeof a}function r(a){return"[object Array]"===Object.prototype.toString.call(a)}function s(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function t(a){return a instanceof z?a.toProperty():a}function u(a,b){function c(a,b){z.call(this),this._wait=a,this._intervalId=null;var c=this;this._bindedOnTick=function(){c._onTick()},this._init(b)}f(c,z,{_name:a,_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._bindedOnTick,this._wait)},_onDeactivation:function(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){z.prototype._clear.call(this),this._bindedOnTick=null,this._free()}},b),R[a]=function(a){return new c(a,o(arguments,1,[]))}}function v(a,b,c){function d(b,c){z.call(this),this._source=b,this._name=b._name+"."+a,this._init(c)}function g(b,c){A.call(this),this._source=b,this._name=b._name+"."+a,this._init(c)}c=e({streamMethod:function(a){return function(){return new a(this,arguments)}},propertyMethod:function(a,b){return function(){return new b(this,arguments)}}},c||{}),b=e({_init:function(){},_free:function(){},_handleValue:function(a,b){this._send("value",a,b)},_handleEnd:function(a,b){this._send("end",null,b)},_onActivationHook:function(){},_onDeactivationHook:function(){},_handleAny:function(a,b,c){switch(a){case"value":this._handleValue(b,c);break;case"end":this._handleEnd(b,c)}},_onActivation:function(){this._onActivationHook(),this._source.onAny([this._handleAny,this])},_onDeactivation:function(){this._onDeactivationHook(),this._source.offAny([this._handleAny,this])}},b||{}),f(d,z,{_clear:function(){z.prototype._clear.call(this),this._source=null,this._free()}},b),f(g,A,{_clear:function(){A.prototype._clear.call(this),this._source=null,this._free()}},b),c.streamMethod&&(z.prototype[a]=c.streamMethod(d,g)),c.propertyMethod&&(A.prototype[a]=c.propertyMethod(d,g))}function w(a){if(q(a)||a instanceof w)return a;if(!a||!a.length)throw new Error("can't convert to Fn "+a);if(1===a.length){if(q(a[0]))return a[0];throw new Error("can't convert to Fn "+a)}this.fn=h(a[0],a[1]),this.context=a[1],this.args=o(a,2,null)}function x(){this.value=[],this.end=[],this.any=[],this.total=0}function y(){this._subscribers=new x,this._active=!1,this._alive=!0}function z(){y.call(this)}function A(){y.call(this),this._current=O}function B(a,b,c,d){var e="<"+b+(d?":current":"")+">";"value"===b?console.log(a,e,c):console.log(a,e)}function C(a){z.call(this),0===a.length?this._send("end"):(this._sources=a,this._aliveCount=0)}function D(a,b){A.call(this),0===a.length?this._send("end"):(this._combinator=b?new w(b):null,this._sources=l(a,t),this._aliveCount=0,this._currents=new Array(a.length))}function E(a,b,c){z.call(this),0===b.length?this._send("end"):(this._passiveCount=a.length,this._combinator=c?new w(c):null,this._sources=j(a,b),this._aliveCount=0,this._currents=new Array(this._sources.length),m(this._currents,O))}function F(){z.call(this),this._sources=[]}function G(){F.call(this)}function H(a,b){F.call(this),this._source=a,this._name=a._name+".flatMap",this._fn=b?new w(b):null,this._mainEnded=!1}function I(a){return function(){return new a(this,arguments)}}function J(a,b){return function(){return new b(this,arguments)}}function K(a,b){return a===b}function L(a){z.call(this),this._fn=new w(a),this._unsubscribe=null}function M(){z.call(this)}function N(a){A.call(this),this._send("value",a),this._send("end")}var O=["<nothing>"],P=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},Q=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};Q(arguments)||(Q=function(a){return!(!a||!c(a,"callee"))});var R={};R.Fn=w,w.call=function(a,b){return q(a)?i(a,null,b):a instanceof w?(a.args&&(b=b?j(a.args,b):a.args),i(a.fn,a.context,b)):w.call(new w(a),b)},w.isEqual=function(a,b){return a===b?!0:(a=new w(a),b=new w(b),q(a)||q(b)?a===b:a.fn===b.fn&&a.context===b.context&&s(a.args,b.args))},e(x.prototype,{add:function(a,b){this[a].push(new w(b)),this.total++},remove:function(a,b){var c,d=this[a],e=d.length;for(b=new w(b),c=0;e>c;c++)if(w.isEqual(d[c],b))return d.splice(c,1),void this.total--},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)w.call(d[0],b);else for(d=k(d),c=0;e>c;c++)w.call(d[c],b)},isEmpty:function(){return 0===this.total}}),R.Observable=y,e(y.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(a){this._active!==a&&(this._active=a,a?this._onActivation():this._onDeactivation())},_clear:function(){this._setActive(!1),this._alive=!1,this._subscribers=null},_send:function(a,b,c){this._alive&&("end"===a&&c||("end"===a&&(b=void 0),this._subscribers.call(a,[b,!!c]),this._subscribers.call("any",[a,b,!!c])),"end"===a&&this._clear())},_callWithCurrent:function(a,b,c,d){a===c?w.call(b,[d,!0]):"any"===a&&w.call(b,[c,d,!0])},on:function(a,b){return this._alive&&(this._subscribers.add(a,b),this._setActive(!0)),this._alive||this._callWithCurrent(a,b,"end"),this},off:function(a,b){return this._alive&&(this._subscribers.remove(a,b),this._subscribers.isEmpty()&&this._setActive(!1)),this},toString:function(){return"["+this._name+"]"},onValue:function(a){this.on("value",a)},onEnd:function(a){this.on("end",a)},onAny:function(a){this.on("any",a)},offValue:function(a){this.off("value",a)},offEnd:function(a){this.off("end",a)},offAny:function(a){this.off("any",a)}}),R.Stream=z,f(z,y,{_name:"stream"}),R.Property=A,f(A,y,{_name:"property",_send:function(a,b,c){this._alive&&(c||("end"===a&&(b=void 0),this._subscribers.call(a,[b,!1]),this._subscribers.call("any",[a,b,!1])),"value"===a&&(this._current=b),"end"===a&&this._clear())},on:function(a,b){return this._alive&&(this._subscribers.add(a,b),this._setActive(!0)),this._current!==O&&this._callWithCurrent(a,b,"value",this._current),this._alive||this._callWithCurrent(a,b,"end"),this}}),y.prototype.log=function(a){return this.onAny([B,null,a||this.toString()]),this},y.prototype.offLog=function(a){return this.offAny([B,null,a||this.toString()]),this},u("withInterval",{_init:function(a){this._fn=new w(a[0]);var b=this;this._bindedSend=function(a,c){b._send(a,c)}},_free:function(){this._fn=null,this._bindedSend=null},_onTick:function(){w.call(this._fn,[this._bindedSend])}}),u("fromPoll",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_onTick:function(){this._send("value",w.call(this._fn))}}),u("interval",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x)}}),u("sequentially",{_init:function(a){this._xs=k(a[0]),0===this._xs.length&&this._send("end")},_free:function(){this._xs=null},_onTick:function(){switch(this._xs.length){case 1:this._send("value",this._xs[0]),this._send("end");break;default:this._send("value",this._xs.shift())}}}),u("repeatedly",{_init:function(a){this._xs=k(a[0]),this._i=-1},_onTick:function(){this._xs.length>0&&(this._i=(this._i+1)%this._xs.length,this._send("value",this._xs[this._i]))}}),u("later",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x),this._send("end")}}),f(C,z,{_name:"merge",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b,a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this])},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this])},_handleAny:function(a,b,c){"value"===a?this._send("value",b,c):(this._aliveCount--,0===this._aliveCount&&this._send("end",null,c))},_clear:function(){z.prototype._clear.call(this),this._sources=null}}),R.merge=function(){return new C(g(arguments))},y.prototype.merge=function(a){return R.merge([this,a])},f(D,A,{_name:"combine",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b,m(this._currents,O),a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this,a])},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this,a])},_handleAny:function(a,b,c,d){if("value"===b){if(this._currents[a]=c,!n(this._currents,O)){var e=k(this._currents);this._combinator&&(e=w.call(this._combinator,this._currents)),this._send("value",e,d)}}else this._aliveCount--,0===this._aliveCount&&this._send("end",null,d)},_clear:function(){A.prototype._clear.call(this),this._sources=null}}),R.combine=function(a,b){return new D(a,b)},y.prototype.combine=function(a,b){return R.combine([this,a],b)},f(E,z,{_name:"sampledBy",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b-this._passiveCount,a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this,a])},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this,a])},_handleAny:function(a,b,c,d){if("value"===b){if(this._currents[a]=c,a>=this._passiveCount&&!n(this._currents,O)){var e=k(this._currents);this._combinator&&(e=w.call(this._combinator,this._currents)),this._send("value",e,d)}}else a>=this._passiveCount&&(this._aliveCount--,0===this._aliveCount&&this._send("end",null,d))},_clear:function(){z.prototype._clear.call(this),this._sources=null}}),R.sampledBy=function(a,b,c){return new E(a,b,c)},y.prototype.sampledBy=function(a,b){return R.sampledBy([this],[a],b)},f(F,z,{_name:"abstractPool",_sub:function(a){a.onValue([this._send,this,"value"]),a.onEnd([this._remove,this,a])},_unsub:function(a){a.offValue([this._send,this,"value"]),a.offEnd([this._remove,this,a])},_add:function(a){this._sources.push(a),this._active&&this._sub(a)},_remove:function(a){this._active&&this._unsub(a);for(var b=0;b<this._sources.length;b++)if(this._sources[b]===a)return void this._sources.splice(b,1)},_onActivation:function(){for(var a=k(this._sources),b=0;b<a.length;b++)this._sub(a[b])},_onDeactivation:function(){for(var a=0;a<this._sources.length;a++)this._unsub(this._sources[a])}}),f(G,F,{_name:"pool",add:function(a){return this._add(a),this},remove:function(a){return this._remove(a),this}}),R.pool=function(){return new G},f(H,F,{_onActivation:function(){F.prototype._onActivation.call(this),this._source.onAny([this._handleMainSource,this])},_onDeactivation:function(){F.prototype._onDeactivation.call(this),this._source.offAny([this._handleMainSource,this])},_handleMainSource:function(a,b,c){"value"===a?(this._fn&&(b=w.call(this._fn,[b])),this._add(b)):0===this._sources.length?this._send("end",null,c):this._mainEnded=!0},_remove:function(a){F.prototype._remove.call(this,a),this._mainEnded&&0===this._sources.length&&this._send("end")},_clear:function(){F.prototype._clear.call(this),this._source=null}}),y.prototype.flatMap=function(a){return new H(this,a)},v("toProperty",{_init:function(a){a.length>0&&this._send("value",a[0])}},{propertyMethod:null,streamMethod:J}),v("changes",{_handleValue:function(a,b){b||this._send("value",a)}},{streamMethod:null,propertyMethod:I}),v("withHandler",{_init:function(a){var b=this;this._handler=new w(a[0]),this._bindedSend=function(a,c,d){b._send(a,c,d)}},_free:function(){this._handler=null,this._bindedSend=null},_handleAny:function(a,b,c){w.call(this._handler,[this._bindedSend,a,b,c])}}),v("map",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a,b){this._send("value",w.call(this._fn,[a]),b)}}),v("filter",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a,b){w.call(this._fn,[a])&&this._send("value",a,b)}}),v("takeWhile",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a,b){w.call(this._fn,[a])?this._send("value",a,b):this._send("end",null,b)}}),v("take",{_init:function(a){this._n=a[0],this._n<=0&&this._send("end")},_handleValue:function(a,b){this._n--,this._send("value",a,b),0===this._n&&this._send("end")}}),v("skip",{_init:function(a){this._n=a[0]<0?0:a[0]},_handleValue:function(a,b){0===this._n?this._send("value",a,b):this._n--}}),v("skipDuplicates",{_init:function(a){this._fn=a.length>0?new w(a[0]):K,this._prev=O},_free:function(){this._fn=null,this._prev=null},_handleValue:function(a,b){this._prev!==O&&w.call(this._fn,[this._prev,a])||this._send("value",a,b),this._prev=a}}),v("skipWhile",{_init:function(a){this._fn=new w(a[0]),this._skip=!0},_free:function(){this._fn=null},_handleValue:function(a,b){return this._skip?void(w.call(this._fn,[a])||(this._skip=!1,this._fn=null,this._send("value",a,b))):void this._send("value",a,b)}}),v("diff",{_init:function(a){this._prev=a[0],this._fn=new w(o(a,1))},_free:function(){this._prev=null,this._fn=null},_handleValue:function(a,b){this._send("value",w.call(this._fn,[this._prev,a]),b),this._prev=a}}),v("scan",{_init:function(a){this._send("value",a[0],!0),this._fn=new w(o(a,1))},_free:function(){this._fn=null},_handleValue:function(a,b){this._send("value",w.call(this._fn,[this._current,a]),b)}},{streamMethod:J}),v("reduce",{_init:function(a){this._result=a[0],this._fn=new w(o(a,1))},_free:function(){this._fn=null,this._result=null},_handleValue:function(a){this._result=w.call(this._fn,[this._result,a])},_handleEnd:function(a,b){this._send("value",this._result,b),this._send("end",null,b)}}),v("throttle",{_init:function(a){this._wait=a[0],this._leading=b(a[1],"leading",!0),this._trailing=b(a[1],"trailing",!0),this._trailingCallValue=null,this._trailingCallTimeoutId=null,this._endAfterTrailingCall=!1,this._lastCallTime=0;var c=this;this._makeTrailingCallBinded=function(){c._makeTrailingCall()}},_free:function(){this._trailingCallValue=null,this._makeTrailingCallBinded=null},_handleValue:function(a,b){if(b)return void this._send("value",a,b);var c=P();0!==this._lastCallTime||this._leading||(this._lastCallTime=c);var d=this._wait-(c-this._lastCallTime);0>=d?(this._cancelTralingCall(),this._lastCallTime=c,this._send("value",a)):this._trailing&&this._scheduleTralingCall(a,d)},_handleEnd:function(a,b){return b?void this._send("end",null,b):void(this._trailingCallTimeoutId?this._endAfterTrailingCall=!0:this._send("end"))},_scheduleTralingCall:function(a,b){this._trailingCallTimeoutId&&this._cancelTralingCall(),this._trailingCallValue=a,this._trailingCallTimeoutId=setTimeout(this._makeTrailingCallBinded,b)},_cancelTralingCall:function(){null!==this._trailingCallTimeoutId&&(clearTimeout(this._trailingCallTimeoutId),this._trailingCallTimeoutId=null)},_makeTrailingCall:function(){this._send("value",this._trailingCallValue),this._trailingCallTimeoutId=null,this._trailingCallValue=null,this._lastCallTime=this._leading?P():0,this._endAfterTrailingCall&&this._send("end")}}),v("delay",{_init:function(a){this._wait=a[0]},_handleValue:function(a,b){if(b)return void this._send("value",a,b);var c=this;setTimeout(function(){c._send("value",a)},this._wait)},_handleEnd:function(a,b){if(b)return void this._send("end",null,b);var c=this;setTimeout(function(){c._send("end")},this._wait)}}),f(L,z,{_name:"fromBinder",_onActivation:function(){var a=this,b=!0;this._unsubscribe=w.call(this._fn,[function(c,d){a._send(c,d,b)}]),b=!1},_onDeactivation:function(){q(this._unsubscribe)&&this._unsubscribe(),this._unsubscribe=null},_clear:function(){z.prototype._clear.call(this),this._fn=null}}),R.fromBinder=function(a){return new L(a)},f(M,z,{_name:"emitter",emit:function(a){this._send("value",a)},end:function(){this._send("end")}}),R.emitter=function(){return new M};var S=new z;S._send("end"),S._name="never",R.never=function(){return S},f(N,A,{_name:"constant"}),R.constant=function(a){return new N(a)},"function"==typeof define&&define.amd?(define([],function(){return R}),a.Kefir=R):"object"==typeof module&&"object"==typeof exports?(module.exports=R,R.Kefir=R):a.Kefir=R}(this);
//# sourceMappingURL=kefir.min.js.map