/*! Widget: editable - updated 2/9/2015 (v2.19.1) */
;(function(b){var a=b.tablesorter.editable={editComplete:function(g,e,f,d){f.removeClass("tseditable-last-edited-cell").trigger(e.editable_editComplete,[g]);if(d){setTimeout(function(){f.focus()},50)}},selectAll:function(c){setTimeout(function(){var e,d=document.createRange();d.selectNodeContents(c);e=window.getSelection();e.removeAllRanges();e.addRange(d)},100)},update:function(j,f){var g,e,i,d=[],h=[];if(!f.editable_columnsArray&&b.type(f.editable_columns)==="string"&&f.editable_columns.indexOf("-")>=0){e=f.editable_columns.split(/\s*-\s*/);g=parseInt(e[0],10)||0;e=parseInt(e[1],10)||(j.columns-1);if(e>j.columns){e=j.columns-1}for(;g<=e;g++){d.push(g);h.push("td:nth-child("+(g+1)+")")}}else{if(b.isArray(f.editable_columns)){b.each(f.editable_columnsArray||f.editable_columns,function(k,c){if(c<j.columns){d.push(c);h.push("td:nth-child("+(c+1)+")")}})}}if(!f.editable_columnsArray){f.editable_columnsArray=d;f.editable_columnsArray.sort(function(k,c){return k-c})}e=b("<div>").wrapInner(f.editable_wrapContent).children().length||b.isFunction(f.editable_wrapContent);j.$tbodies.find(h.join(",")).not("."+f.editable_noEdit).each(function(){i=b(this);if(e&&i.children().length===0){i.wrapInner(f.editable_wrapContent)}if(i.children().length){i.children().not("."+f.editable_noEdit).each(function(){var c=b(this);if(f.editable_trimContent){c.text(function(l,k){return b.trim(k)})}c.prop("contenteditable",true)})}else{if(f.editable_trimContent){i.text(function(k,c){return b.trim(c)})}i.prop("contenteditable",true)}})},bindEvents:function(e,d){e.$table.off(("updateComplete pagerComplete ".split(" ").join(".tseditable ")).replace(/\s+/g," ")).on("updateComplete pagerComplete ".split(" ").join(".tseditable "),function(){a.update(e,e.widgetOptions)});e.$tbodies.off(("mouseleave focus blur focusout keydown ".split(" ").join(".tseditable ")).replace(/\s+/g," ")).on("mouseleave.tseditable",function(){if(e.$table.data("contentFocused")){e.$table.data("contentFocused",true);b(":focus").trigger("focusout")}}).on("focus.tseditable","[contenteditable]",function(i){clearTimeout(b(this).data("timer"));e.$table.data("contentFocused",i.target);var h=b(this),g=d.editable_selectAll,f=h.closest("td").index(),c=b.trim(h.text());if(d.editable_enterToAccept){h.on("keydown.tseditable",function(j){if(j.which===13){j.preventDefault()}})}h.data({before:c,original:c});if(typeof d.editable_focused==="function"){d.editable_focused(c,f,h)}if(g){if(typeof g==="function"){if(g(c,f,h)){a.selectAll(h[0])}}else{a.selectAll(h[0])}}}).on("blur focusout keydown ".split(" ").join(".tseditable "),"[contenteditable]",function(j){if(!e.$table.data("contentFocused")){return}var f,k,h=false,i=b(j.target),c=b.trim(i.text()),g=i.closest("td").index();if(j.which===27){i.html(b.trim(i.data("original"))).trigger("blur.tseditable");e.$table.data("contentFocused",false);return false}f=j.which===13&&(d.editable_enterToAccept||j.altKey)||d.editable_autoAccept&&j.type!=="keydown";if(f&&i.data("before")!==c){k=d.editable_validate;h=c;if(typeof(k)==="function"){h=k(c,i.data("original"),g,i)}else{if(typeof(k=b.tablesorter.getColumnData(e.table,k,g))==="function"){h=k(c,i.data("original"),g,i)}}if(f&&h!==false){e.$table.find(".tseditable-last-edited-cell").removeClass("tseditable-last-edited-cell");i.addClass("tseditable-last-edited-cell").html(b.trim(h)).data("before",h).data("original",h).trigger("change");e.$table.trigger("updateCell",[i.closest("td"),false,function(){if(d.editable_autoResort){setTimeout(function(){e.$table.trigger("sorton",[e.sortList,function(){a.editComplete(e,d,e.$table.find(".tseditable-last-edited-cell"),true)},true])},10)}else{a.editComplete(e,d,e.$table.find(".tseditable-last-edited-cell"))}}]);return false}}else{if(!h&&j.type!=="keydown"){clearTimeout(i.data("timer"));i.data("timer",setTimeout(function(){if(b.isFunction(d.editable_blur)){d.editable_blur(b.trim(i.text()),g,i)}},100));i.html(b.trim(i.data("original")))}}})}};b.tablesorter.addWidget({id:"editable",options:{editable_columns:[],editable_enterToAccept:true,editable_autoAccept:true,editable_autoResort:false,editable_wrapContent:"<div>",editable_trimContent:true,editable_validate:null,editable_focused:null,editable_blur:null,editable_selectAll:false,editable_noEdit:"no-edit",editable_editComplete:"editComplete"},init:function(f,e,g,d){if(!d.editable_columns.length){return}a.update(g,d);a.bindEvents(g,d)}})})(jQuery);