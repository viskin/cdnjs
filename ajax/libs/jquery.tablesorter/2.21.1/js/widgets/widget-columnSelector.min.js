!function(e){"use strict";var t=e.tablesorter,o=".tscolsel",l=t.columnSelector={queryAll:"@media only all { [columns] { display: none; } } ",queryBreak:"@media all and (min-width: [size]) { [columns] { display: table-cell; } } ",init:function(n,a,c){var r,u;return r=e(c.columnSelector_layout),r.find("input").add(r.filter("input")).length?(a.tableId="tablesorter"+(new Date).getTime(),a.$table.addClass(a.tableId),u=a.selector={$container:e(c.columnSelector_container||"<div>")},u.$style=e("<style></style>").prop("disabled",!0).appendTo("head"),u.$breakpoints=e("<style></style>").prop("disabled",!0).appendTo("head"),u.isInitializing=!0,l.setupSelector(n,a,c),c.columnSelector_mediaquery&&l.setupBreakpoints(a,c),u.isInitializing=!1,u.$container.length?l.updateCols(a,c):a.debug&&t.log("ColumnSelector: >> container not found"),void a.$table.off("refreshColumnSelector"+o).on("refreshColumnSelector"+o,function(t,o){var n,a=e.isArray(o),c=this.config,r=c.widgetOptions;if(o&&c.selector.$container.length){if(a)for(e.each(o,function(e,t){o[e]=parseInt(t,10)}),n=0;n<c.columns;n++)c.selector.$container.find("input[data-column="+n+"]").prop("checked",e.inArray(n,o)>=0);l.updateAuto(c,r,u.$container.find('input[data-column="auto"]').prop("checked",!a))}else l.updateBreakpoints(c,r),l.updateCols(c,r)})):void(a.debug&&t.log("ColumnSelector: >> ERROR: Column Selector aborting, no input found in the layout! ***"))},setupSelector:function(o,n,a){var c,r=n.selector,u=r.$container,i=a.columnSelector_saveColumns&&t.storage,s=i?t.storage(o,"tablesorter-columnSelector"):[],d=i?t.storage(o,"tablesorter-columnSelector-auto"):{};r.auto=e.isEmptyObject(d)||"boolean"!==e.type(d.auto)?a.columnSelector_mediaqueryState:d.auto,r.states=[],r.$column=[],r.$wrapper=[],r.$checkbox=[],n.$table.children("thead").find("tr:first th",o).each(function(){var o=e(this),i=o.attr(a.columnSelector_priority)||1,d=o.attr("data-column"),p=t.getData(this,n.headers[d],"columnSelector");return isNaN(i)&&i.length>0||"disable"===p||a.columnSelector_columns[d]&&"disable"===a.columnSelector_columns[d]?!0:(r.states[d]=s&&"undefined"!=typeof s[d]?s[d]:"undefined"!=typeof a.columnSelector_columns[d]?a.columnSelector_columns[d]:"true"===p||"false"!==p,r.$column[d]=e(this),c=o.attr(a.columnSelector_name)||o.text(),void(u.length&&(r.$wrapper[d]=e(a.columnSelector_layout.replace(/\{name\}/g,c)).appendTo(u),r.$checkbox[d]=r.$wrapper[d].find("input").add(r.$wrapper[d].filter("input")).attr("data-column",d).toggleClass(a.columnSelector_cssChecked,r.states[d]).prop("checked",r.states[d]).on("change",function(){r.states[d]=this.checked,l.updateCols(n,a)}).change())))})},setupBreakpoints:function(t,n){var a=t.selector;n.columnSelector_mediaquery&&(a.lastIndex=-1,l.updateBreakpoints(t,n),t.$table.off("updateAll"+o).on("updateAll"+o,function(){l.updateBreakpoints(t,n),l.updateCols(t,n)})),a.$container.length&&(n.columnSelector_mediaquery&&(a.$auto=e(n.columnSelector_layout.replace(/\{name\}/g,n.columnSelector_mediaqueryName)).prependTo(a.$container),a.$auto.find("input").add(a.$auto.filter("input")).attr("data-column","auto").prop("checked",a.auto).toggleClass(n.columnSelector_cssChecked,a.auto).on("change",function(){l.updateAuto(t,n,e(this))}).change()),t.$table.off("update"+o).on("update"+o,function(){l.updateCols(t,n)}))},updateAuto:function(o,n,a){var c=o.selector;c.auto=a.prop("checked")||!1,e.each(c.$checkbox,function(e,t){t&&(t[0].disabled=c.auto,c.$wrapper[e].toggleClass("disabled",c.auto))}),n.columnSelector_mediaquery&&l.updateBreakpoints(o,n),l.updateCols(o,n),o.selector.$popup&&o.selector.$popup.find(".tablesorter-column-selector").html(c.$container.html()).find("input").each(function(){var t=e(this).attr("data-column");e(this).prop("checked","auto"===t?c.auto:c.states[t])}),n.columnSelector_saveColumns&&t.storage&&t.storage(o.$table[0],"tablesorter-columnSelector-auto",{auto:c.auto}),c.auto&&o.$table.trigger("columnUpdate")},updateBreakpoints:function(t,o){var n,a,c,r=t.selector,u="."+t.tableId,i=[],s="";if(o.columnSelector_mediaquery&&!r.auto)return r.$breakpoints.prop("disabled",!0),void r.$style.prop("disabled",!1);for(n=0;6>n;n++)c=[],t.$headers.filter("["+o.columnSelector_priority+"="+(n+1)+"]").each(function(){a=parseInt(e(this).attr("data-column"),10)+1,c.push(u+" col:nth-child("+a+")"),c.push(u+" tr th:nth-child("+a+")"),c.push(u+" tr td:nth-child("+a+")")}),c.length&&(i=i.concat(c),s+=l.queryBreak.replace(/\[size\]/g,o.columnSelector_breakpoints[n]).replace(/\[columns\]/g,c.join(",")));r.$style&&r.$style.prop("disabled",!0),i.length&&r.$breakpoints.prop("disabled",!1).html(l.queryAll.replace(/\[columns\]/g,i.join(","))+s)},updateCols:function(o,l){if(!(l.columnSelector_mediaquery&&o.selector.auto||o.selector.isInitializing)){var n,a=o.selector,c=[],r="."+o.tableId;a.$container.find("input[data-column]").filter('[data-column!="auto"]').each(function(){this.checked||(n=parseInt(e(this).attr("data-column"),10)+1,c.push(r+" col:nth-child("+n+")"),c.push(r+" tr th:nth-child("+n+")"),c.push(r+" tr td:nth-child("+n+")")),e(this).toggleClass(l.columnSelector_cssChecked,this.checked)}),l.columnSelector_mediaquery&&a.$breakpoints.prop("disabled",!0),a.$style&&a.$style.prop("disabled",!1).html(c.length?c.join(",")+" { display: none; }":""),l.columnSelector_saveColumns&&t.storage&&t.storage(o.$table[0],"tablesorter-columnSelector",a.states),o.$table.trigger("columnUpdate")}},attachTo:function(t,o){t=e(t)[0];var l,n,a,c=t.config,r=e(o);r.length&&c&&(r.find(".tablesorter-column-selector").length||r.append('<span class="tablesorter-column-selector"></span>'),l=c.selector,n=c.widgetOptions,r.find(".tablesorter-column-selector").html(l.$container.html()).find("input").each(function(){var t=e(this).attr("data-column"),o="auto"===t?l.auto:l.states[t];e(this).toggleClass(n.columnSelector_cssChecked,o).prop("checked",o)}),l.$popup=r.on("change","input",function(){a=e(this).toggleClass(n.columnSelector_cssChecked,this.checked).attr("data-column"),l.$container.find('input[data-column="'+a+'"]').prop("checked",this.checked).trigger("change")}))}};t.addWidget({id:"columnSelector",priority:10,options:{columnSelector_container:null,columnSelector_columns:{},columnSelector_saveColumns:!0,columnSelector_layout:'<label><input type="checkbox">{name}</label>',columnSelector_name:"data-selector-name",columnSelector_mediaquery:!0,columnSelector_mediaqueryName:"Auto: ",columnSelector_mediaqueryState:!0,columnSelector_breakpoints:["20em","30em","40em","50em","60em","70em"],columnSelector_priority:"data-priority",columnSelector_cssChecked:"checked"},init:function(e,t,o,n){l.init(e,o,n)},remove:function(e,t,l,n){if(!n){var a=t.selector;a.$container.empty(),a.$popup&&a.$popup.empty(),a.$style.remove(),a.$breakpoints.remove(),t.$table.off("updateAll"+o+" update"+o)}}})}(jQuery);