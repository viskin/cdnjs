!function(e){"use strict";var t=e.tablesorter.editable={editComplete:function(e,t,i,l){i.removeClass("tseditable-last-edited-cell").trigger(t.editable_editComplete,[e]),l&&setTimeout(function(){i.focus()},50)},selectAll:function(e){setTimeout(function(){var t,i=document.createRange();i.selectNodeContents(e),t=window.getSelection(),t.removeAllRanges(),t.addRange(i)},100)},update:function(t,i){var l,n,a,o=[],d=[];if(!i.editable_columnsArray&&"string"===e.type(i.editable_columns)&&i.editable_columns.indexOf("-")>=0)for(n=i.editable_columns.split(/\s*-\s*/),l=parseInt(n[0],10)||0,n=parseInt(n[1],10)||t.columns-1,n>t.columns&&(n=t.columns-1);n>=l;l++)o.push(l),d.push("td:nth-child("+(l+1)+")");else e.isArray(i.editable_columns)&&e.each(i.editable_columnsArray||i.editable_columns,function(e,i){i<t.columns&&(o.push(i),d.push("td:nth-child("+(i+1)+")"))});i.editable_columnsArray||(i.editable_columnsArray=o,i.editable_columnsArray.sort(function(e,t){return e-t})),n=e("<div>").wrapInner(i.editable_wrapContent).children().length||e.isFunction(i.editable_wrapContent),t.$tbodies.find(d.join(",")).not("."+i.editable_noEdit).each(function(){a=e(this),n&&0===a.children().length&&a.wrapInner(i.editable_wrapContent),a.children().length?a.children().not("."+i.editable_noEdit).each(function(){var t=e(this);i.editable_trimContent&&t.text(function(t,i){return e.trim(i)}),t.prop("contenteditable",!0)}):(i.editable_trimContent&&a.text(function(t,i){return e.trim(i)}),a.prop("contenteditable",!0))})},bindEvents:function(i,l){i.$table.off("updateComplete pagerComplete ".split(" ").join(".tseditable ").replace(/\s+/g," ")).on("updateComplete pagerComplete ".split(" ").join(".tseditable "),function(){t.update(i,i.widgetOptions)}),i.$tbodies.off("mouseleave focus blur focusout keydown ".split(" ").join(".tseditable ").replace(/\s+/g," ")).on("mouseleave.tseditable",function(){i.$table.data("contentFocused")&&(i.$table.data("contentFocused",!0),e(":focus").trigger("focusout"))}).on("focus.tseditable","[contenteditable]",function(n){clearTimeout(e(this).data("timer")),i.$table.data("contentFocused",n.target);var a=e(this),o=l.editable_selectAll,d=a.closest("td").index(),s=e.trim(a.text());l.editable_enterToAccept&&a.on("keydown.tseditable",function(e){13===e.which&&e.preventDefault()}),a.data({before:s,original:s}),"function"==typeof l.editable_focused&&l.editable_focused(s,d,a),o&&("function"==typeof o?o(s,d,a)&&t.selectAll(a[0]):t.selectAll(a[0]))}).on("blur focusout keydown ".split(" ").join(".tseditable "),"[contenteditable]",function(n){if(i.$table.data("contentFocused")){var a,o,d=!1,s=e(n.target),r=e.trim(s.text()),c=s.closest("td").index();if(27===n.which)return s.html(e.trim(s.data("original"))).trigger("blur.tseditable"),i.$table.data("contentFocused",!1),!1;if(a=13===n.which&&(l.editable_enterToAccept||n.altKey)||l.editable_autoAccept&&"keydown"!==n.type,a&&s.data("before")!==r){if(o=l.editable_validate,d=r,"function"==typeof o?d=o(r,s.data("original"),c,s):"function"==typeof(o=e.tablesorter.getColumnData(i.table,o,c))&&(d=o(r,s.data("original"),c,s)),a&&d!==!1)return i.$table.find(".tseditable-last-edited-cell").removeClass("tseditable-last-edited-cell"),s.addClass("tseditable-last-edited-cell").html(e.trim(d)).data("before",d).data("original",d).trigger("change"),i.$table.trigger("updateCell",[s.closest("td"),!1,function(){l.editable_autoResort?setTimeout(function(){i.$table.trigger("sorton",[i.sortList,function(){t.editComplete(i,l,i.$table.find(".tseditable-last-edited-cell"),!0)},!0])},10):t.editComplete(i,l,i.$table.find(".tseditable-last-edited-cell"))}]),!1}else d||"keydown"===n.type||(clearTimeout(s.data("timer")),s.data("timer",setTimeout(function(){e.isFunction(l.editable_blur)&&l.editable_blur(e.trim(s.text()),c,s)},100)),s.html(e.trim(s.data("original"))))}})}};e.tablesorter.addWidget({id:"editable",options:{editable_columns:[],editable_enterToAccept:!0,editable_autoAccept:!0,editable_autoResort:!1,editable_wrapContent:"<div>",editable_trimContent:!0,editable_validate:null,editable_focused:null,editable_blur:null,editable_selectAll:!1,editable_noEdit:"no-edit",editable_editComplete:"editComplete"},init:function(e,i,l,n){n.editable_columns.length&&(t.update(l,n),t.bindEvents(l,n))}})}(jQuery);