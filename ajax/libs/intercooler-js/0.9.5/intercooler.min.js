var Intercooler=Intercooler||function(){"use strict";function remove(e){e.remove()}function showIndicator(e){e.closest(".ic-use-transition").length>0?(e.data("ic-use-transition",!0),e.removeClass("ic-use-transition")):e.show()}function hideIndicator(e){e.data("ic-use-transition")?(e.data("ic-use-transition",null),e.addClass("ic-use-transition")):e.hide()}function fixICAttributeName(e){return USE_DATA?"data-"+e:e}function getICAttribute(e,t){return e.attr(fixICAttributeName(t))}function setICAttribute(e,t,r){e.attr(fixICAttributeName(t),r)}function prepend(e,t){try{e.prepend(t)}catch(r){log(e,formatError(r),"ERROR")}if(getICAttribute(e,"ic-limit-children")){var i=parseInt(getICAttribute(e,"ic-limit-children"));e.children().length>i&&e.children().slice(i,e.children().length).remove()}}function append(e,t){try{e.append(t)}catch(r){log(e,formatError(r),"ERROR")}if(getICAttribute(e,"ic-limit-children")){var i=parseInt(getICAttribute(e,"ic-limit-children"));e.children().length>i&&e.children().slice(0,e.children().length-i).remove()}}function log(e,t,r){if(null==e&&(e=$("body")),e.trigger("log.ic",[t,r,e]),"ERROR"==r){window.console&&window.console.log("Intercooler Error : "+t);var i=closestAttrValue($("body"),"ic-post-errors-to");i&&$.post(i,{error:t})}}function uuid(){return _UUID++}function icSelectorFor(e){return getICAttributeSelector("ic-id='"+getIntercoolerId(e)+"'")}function parseInterval(e){return log(null,"POLL: Parsing interval string "+e,"DEBUG"),"null"==e||"false"==e||""==e?null:e.lastIndexOf("ms")==e.length-2?parseFloat(e.substr(0,e.length-2)):e.lastIndexOf("s")==e.length-1?1e3*parseFloat(e.substr(0,e.length-1)):1e3}function getICAttributeSelector(e){return"["+fixICAttributeName(e)+"]"}function initScrollHandler(){null==_scrollHandler&&(_scrollHandler=function(){$(getICAttributeSelector("ic-trigger-on='scrolled-into-view'")).each(function(){isScrolledIntoView($(this))&&1!=$(this).data("ic-scrolled-into-view-loaded")&&($(this).data("ic-scrolled-into-view-loaded",!0),fireICRequest($(this)))})},$(window).scroll(_scrollHandler))}function currentUrl(){return window.location.pathname+window.location.search+window.location.hash}function createDocument(e){var t=null;return/<(html|body)/i.test(e)?(t=document.documentElement.cloneNode(),t.innerHTML=e):(t=document.documentElement.cloneNode(!0),t.querySelector("body").innerHTML=e),$(t)}function getTarget(e){var t=$(e).closest(getICAttributeSelector("ic-target")),r=getICAttribute(t,"ic-target");return"this"==r?t:r&&0!=r.indexOf("this.")?0==r.indexOf("closest ")?e.closest(r.substr(8)):0==r.indexOf("find ")?e.find(r.substr(5)):$(r):e}function processHeaders(elt,xhr){elt.trigger("beforeHeaders.ic",[elt,xhr]),log(elt,"response headers: "+xhr.getAllResponseHeaders(),"DEBUG");var target=null;if(xhr.getResponseHeader("X-IC-Refresh")){var pathsToRefresh=xhr.getResponseHeader("X-IC-Refresh").split(",");log(elt,"X-IC-Refresh: refreshing "+pathsToRefresh,"DEBUG"),$.each(pathsToRefresh,function(e,t){refreshDependencies(t.replace(/ /g,""),elt)})}if(xhr.getResponseHeader("X-IC-Script")&&(log(elt,"X-IC-Script: evaling "+xhr.getResponseHeader("X-IC-Script"),"DEBUG"),eval(xhr.getResponseHeader("X-IC-Script"))),xhr.getResponseHeader("X-IC-Redirect")&&(log(elt,"X-IC-Redirect: redirecting to "+xhr.getResponseHeader("X-IC-Redirect"),"DEBUG"),window.location=xhr.getResponseHeader("X-IC-Redirect")),"true"==xhr.getResponseHeader("X-IC-CancelPolling")&&cancelPolling($(elt).closest(getICAttributeSelector("ic-poll"))),"true"==xhr.getResponseHeader("X-IC-ResumePolling")){var pollingElt=$(elt).closest(getICAttributeSelector("ic-poll"));setICAttribute(pollingElt,"ic-pause-polling",null),startPolling(pollingElt)}if(xhr.getResponseHeader("X-IC-SetPollInterval")){var pollingElt=$(elt).closest(getICAttributeSelector("ic-poll"));cancelPolling(pollingElt),setICAttribute(pollingElt,"ic-poll",xhr.getResponseHeader("X-IC-SetPollInterval")),startPolling(pollingElt)}xhr.getResponseHeader("X-IC-Open")&&(log(elt,"X-IC-Open: opening "+xhr.getResponseHeader("X-IC-Open"),"DEBUG"),window.open(xhr.getResponseHeader("X-IC-Open")));var triggerValue=xhr.getResponseHeader("X-IC-Trigger");if(triggerValue)if(log(elt,"X-IC-Trigger: found trigger "+triggerValue,"DEBUG"),target=getTarget(elt),xhr.getResponseHeader("X-IC-Trigger-Data")){var triggerArgs=$.parseJSON(xhr.getResponseHeader("X-IC-Trigger-Data"));target.trigger(triggerValue,triggerArgs)}else triggerValue.indexOf("{")>=0?$.each($.parseJSON(triggerValue),function(e,t){target.trigger(e,t)}):target.trigger(triggerValue,[]);return xhr.getResponseHeader("X-IC-Remove")&&elt&&(target=getTarget(elt),log(elt,"X-IC-Remove header found.","DEBUG"),remove(target)),elt.trigger("afterHeaders.ic",[elt,xhr]),!0}function beforeRequest(e){e.addClass("disabled"),e.data("ic-request-in-flight",!0)}function requestCleanup(e,t){e.length>0&&hideIndicator(e),t.removeClass("disabled"),t.data("ic-request-in-flight",!1),t.data("ic-next-request")&&(t.data("ic-next-request")(),t.data("ic-next-request",null))}function replaceOrAddMethod(e,t){if("string"===$.type(e)){var r=/(&|^)_method=[^&]*/,i="&_method="+t;return r.test(e)?e.replace(r,i):e+i}return e.append("_method",t),e}function globalEval(e){return window.eval.call(window,e)}function closestAttrValue(e,t){var r=$(e).closest(getICAttributeSelector(t));return r.length>0?getICAttribute(r,t):null}function formatError(e){var t=e.toString()+"\n";try{t+=e.stack}catch(e){}return t}function handleRemoteRequest(e,t,r,i,n){beforeRequest(e),i=replaceOrAddMethod(i,t);var o=findIndicator(e);o.length>0&&showIndicator(o);var s=uuid(),c=new Date,l="GET"==t?"GET":"POST",a={type:l,url:r,data:i,dataType:"text",headers:{Accept:"text/html-partial, */*; q=0.9","X-IC-Request":!0,"X-HTTP-Method-Override":t},beforeSend:function(n,o){e.trigger("beforeSend.ic",[e,i,o,n,s]),log(e,"before AJAX request "+s+": "+t+" to "+r,"DEBUG");var c=closestAttrValue(e,"ic-on-beforeSend");c&&globalEval("(function (data, settings, xhr) {"+c+"})")(i,o,n)},success:function(t,r,i){e.trigger("success.ic",[e,t,r,i,s]),log(e,"AJAX request "+s+" was successful.","DEBUG");var c=closestAttrValue(e,"ic-on-success");if(!c||0!=globalEval("(function (data, textStatus, xhr) {"+c+"})")(t,r,i)){var l=new Date;try{if(processHeaders(e,i)){log(e,"Processed headers for request "+s+" in "+(new Date-l)+"ms","DEBUG");var a=new Date;if(i.getResponseHeader("X-IC-PushURL")||"true"==closestAttrValue(e,"ic-push-url"))try{requestCleanup(o,e);var u=i.getResponseHeader("X-IC-PushURL")||closestAttrValue(e,"ic-src");_history.snapshotForHistory(u)}catch(g){log(e,"Error during history snapshot for "+s+": "+formatError(g),"ERROR")}n(t,r,e,i),log(e,"Process content for request "+s+" in "+(new Date-a)+"ms","DEBUG")}e.trigger("after.success.ic",[e,t,r,i,s])}catch(g){log(e,"Error processing successful request "+s+" : "+formatError(g),"ERROR")}}},error:function(t,r,i){e.trigger("error.ic",[e,r,i,t]);var n=closestAttrValue(e,"ic-on-error");n&&globalEval("(function (status, str, xhr) {"+n+"})")(r,i,t),log(e,"AJAX request "+s+" experienced an error: "+i,"ERROR")},complete:function(t,r){log(e,"AJAX request "+s+" completed in "+(new Date-c)+"ms","DEBUG"),requestCleanup(o,e);try{$.contains(document,e[0])?$(e).trigger("complete.ic",[e,i,r,t,s]):$("body").trigger("complete.ic",[e,i,r,t,s])}catch(n){log(e,"Error during complete.ic event for "+s+" : "+formatError(n),"ERROR")}var l=closestAttrValue(e,"ic-on-complete");l&&globalEval("(function (xhr, status) {"+l+"})")(t,r)}};"string"!=$.type(i)&&(a.dataType=null,a.processData=!1,a.contentType=!1),$(document).trigger("beforeAjaxSend.ic",a),$.ajax(a)}function findIndicator(e){var t=null;if(getICAttribute($(e),"ic-indicator"))t=$(getICAttribute($(e),"ic-indicator")).first();else if(t=$(e).find(".ic-indicator").first(),0==t.length){var r=closestAttrValue(e,"ic-indicator");r?t=$(r).first():$(e).next().is(".ic-indicator")&&(t=$(e).next())}return t}function processIncludes(e,t){if(0==$.trim(t).indexOf("{")){var r=$.parseJSON(t);$.each(r,function(t,r){e=appendData(e,t,r)})}else $(t).each(function(){var t=$(this).serializeArray();$.each(t,function(t,r){e=appendData(e,r.name,r.value)})});return e}function appendData(e,t,r){return"string"===$.type(e)?e+"&"+t+"="+encodeURIComponent(r):(e.append(t,r),e)}function getParametersForElement(e,t,r){var i=getTarget(t),n=null;t.is("form")&&"multipart/form-data"==t.attr("enctype")?(n=new FormData(t[0]),n=appendData(n,"ic-request",!0)):(n="ic-request=true",n+="GET"!=e&&t.closest("form").length>0?"&"+t.closest("form").serialize():"&"+t.serialize());var o=closestAttrValue(t,"ic-prompt");if(o){var s=prompt(o);if(!s)return null;var c=closestAttrValue(t,"ic-prompt-name")||"ic-prompt-value";n=appendData(n,c,s)}t.attr("id")&&(n=appendData(n,"ic-element-id",t.attr("id"))),t.attr("name")&&(n=appendData(n,"ic-element-name",t.attr("name"))),getICAttribute(i,"ic-id")&&(n=appendData(n,"ic-id",getICAttribute(i,"ic-id"))),i.attr("id")&&(n=appendData(n,"ic-target-id",i.attr("id"))),r&&r.attr("id")&&(n=appendData(n,"ic-trigger-id",r.attr("id"))),r&&r.attr("name")&&(n=appendData(n,"ic-trigger-name",r.attr("name")));var l=closestAttrValue(t,"ic-include");return l&&(n=processIncludes(n,l)),$(getICAttributeSelector("ic-global-include")).each(function(){n=processIncludes(n,getICAttribute($(this),"ic-global-include"))}),n=appendData(n,"ic-current-url",currentUrl()),log(t,"request parameters "+n,"DEBUG"),n}function maybeSetIntercoolerInfo(e){var t=getTarget(e);getIntercoolerId(t),1!=e.data("elementAdded.ic")&&(e.data("elementAdded.ic",!0),e.trigger("elementAdded.ic"))}function getIntercoolerId(e){return getICAttribute(e,"ic-id")||setICAttribute(e,"ic-id",uuid()),getICAttribute(e,"ic-id")}function processNodes(e){e.length>1?e.each(function(){processNodes($(this))}):(processMacros(e),processSources(e),processPolling(e),processTriggerOn(e),processRemoveAfter(e),processAddClasses(e),processRemoveClasses(e))}function fireReadyStuff(e){e.trigger("nodesProcessed.ic"),$.each(_readyHandlers,function(t,r){try{r(e)}catch(i){log(e,formatError(i),"ERROR")}})}function processMacros(e){$.each(_MACROS,function(t,r){0==$(e).closest(".ic-ignore").length&&($(e).is("["+r+"]")&&processMacro(r,$(e)),$(e).find("["+r+"]").each(function(){0==$(this).closest(".ic-ignore").length&&processMacro(r,$(this))}))})}function processSources(e){0==$(e).closest(".ic-ignore").length&&($(e).is(getICAttributeSelector("ic-src"))&&maybeSetIntercoolerInfo($(e)),$(e).find(getICAttributeSelector("ic-src")).each(function(){0==$(this).closest(".ic-ignore").length&&maybeSetIntercoolerInfo($(this))}))}function processPolling(e){0==$(e).closest(".ic-ignore").length&&($(e).is(getICAttributeSelector("ic-poll"))&&(maybeSetIntercoolerInfo($(e)),startPolling(e)),$(e).find(getICAttributeSelector("ic-poll")).each(function(){0==$(this).closest(".ic-ignore").length&&(maybeSetIntercoolerInfo($(this)),startPolling($(this)))}))}function processTriggerOn(e){0==$(e).closest(".ic-ignore").length&&(handleTriggerOn(e),$(e).find(getICAttributeSelector("ic-trigger-on")).each(function(){0==$(this).closest(".ic-ignore").length&&handleTriggerOn($(this))}))}function processRemoveAfter(e){0==$(e).closest(".ic-ignore").length&&(handleRemoveAfter(e),$(e).find(getICAttributeSelector("ic-remove-after")).each(function(){0==$(this).closest(".ic-ignore").length&&handleRemoveAfter($(this))}))}function processAddClasses(e){0==$(e).closest(".ic-ignore").length&&(handleAddClasses(e),$(e).find(getICAttributeSelector("ic-add-class")).each(function(){0==$(this).closest(".ic-ignore").length&&handleAddClasses($(this))}))}function processRemoveClasses(e){0==$(e).closest(".ic-ignore").length&&(handleRemoveClasses(e),$(e).find(getICAttributeSelector("ic-remove-class")).each(function(){0==$(this).closest(".ic-ignore").length&&handleRemoveClasses($(this))}))}function startPolling(e){if(null==e.data("ic-poll-interval-id")&&"true"!=getICAttribute($(e),"ic-pause-polling")){var t=parseInterval(getICAttribute(e,"ic-poll"));if(null!=t){var r=icSelectorFor(e),i=parseInt(getICAttribute(e,"ic-poll-repeats"))||-1,n=0;log(e,"POLL: Starting poll for element "+r,"DEBUG");var o=setInterval(function(){var t=$(r);e.trigger("onPoll.ic",t),0==t.length||n==i||e.data("ic-poll-interval-id")!=o?(log(e,"POLL: Clearing poll for element "+r,"DEBUG"),clearTimeout(o)):fireICRequest(t),n++},t);e.data("ic-poll-interval-id",o)}}}function cancelPolling(e){null!=e.data("ic-poll-interval-id")&&(clearTimeout(e.data("ic-poll-interval-id")),e.data("ic-poll-interval-id",null))}function refreshDependencies(e,t){log(t,"refreshing dependencies for path "+e,"DEBUG"),$(getICAttributeSelector("ic-src")).each(function(){var r=!1;"GET"==verbFor($(this))&&"ignore"!=getICAttribute($(this),"ic-deps")&&"undefined"==typeof getICAttribute($(this),"ic-poll")&&(isDependent(e,getICAttribute($(this),"ic-src"))?null!=t&&$(t)[0]==$(this)[0]||(fireICRequest($(this)),r=!0):(isDependent(e,getICAttribute($(this),"ic-deps"))||"*"==getICAttribute($(this),"ic-deps"))&&(null!=t&&$(t)[0]==$(this)[0]||(fireICRequest($(this)),r=!0))),r&&log($(this),"depends on path "+e+", refreshing...","DEBUG")})}function isDependent(e,t){return!!_isDependentFunction(e,t)}function verbFor(e){return getICAttribute(e,"ic-verb")?getICAttribute(e,"ic-verb").toUpperCase():"GET"}function eventFor(e,t){return"default"==e?$(t).is("button")?"click":$(t).is("form")?"submit":$(t).is(":input")?"change":"click":e}function preventDefault(e,t){return e.is("form")||e.is(":submit")&&1==e.closest("form").length||e.is("a")}function handleRemoveAfter(e){if(getICAttribute($(e),"ic-remove-after")){var t=parseInterval(getICAttribute($(e),"ic-remove-after"));setTimeout(function(){remove(e)},t)}}function parseAndApplyClass(e,t,r){var i="",n=50;if(e.indexOf(":")>0){var o=e.split(":");i=o[0],n=parseInterval(o[1])}else i=e;setTimeout(function(){t[r](i)},n)}function handleAddClasses(e){if(getICAttribute($(e),"ic-add-class"))for(var t=getICAttribute($(e),"ic-add-class").split(","),r=t.length,i=0;r>i;i++)parseAndApplyClass($.trim(t[i]),e,"addClass")}function handleRemoveClasses(e){if(getICAttribute($(e),"ic-remove-class"))for(var t=getICAttribute($(e),"ic-remove-class").split(","),r=t.length,i=0;r>i;i++)parseAndApplyClass($.trim(t[i]),e,"removeClass")}function handleTriggerOn(e){if(getICAttribute($(e),"ic-trigger-on"))if("load"==getICAttribute($(e),"ic-trigger-on"))fireICRequest(e);else if("scrolled-into-view"==getICAttribute($(e),"ic-trigger-on"))initScrollHandler(),setTimeout(function(){$(window).trigger("scroll")},100);else{var t=getICAttribute($(e),"ic-trigger-on").split(" ");$(e).on(eventFor(t[0],$(e)),function(r){var i=closestAttrValue(e,"ic-on-beforeTrigger");if(i&&0==globalEval("(function (evt, elt) {"+i+"})")(r,$(e)))return log($(e),"ic-trigger cancelled by ic-on-beforeTrigger","DEBUG"),!1;if("changed"==t[1]){var n=$(e).val(),o=$(e).data("ic-previous-val");$(e).data("ic-previous-val",n),n!=o&&fireICRequest($(e))}else fireICRequest($(e));return preventDefault(e,r)?(r.preventDefault(),!1):!0})}}function macroIs(e,t){return e==fixICAttributeName(t)}function processMacro(e,t){macroIs(e,"ic-post-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-post-to")),setIfAbsent(t,"ic-verb","POST"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-put-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-put-to")),setIfAbsent(t,"ic-verb","PUT"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-patch-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-patch-to")),setIfAbsent(t,"ic-verb","PATCH"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-get-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-get-from")),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-delete-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-delete-from")),setIfAbsent(t,"ic-verb","DELETE"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-action")&&setIfAbsent(t,"ic-trigger-on","default");var r=null,i=null;if(macroIs(e,"ic-style-src")){r=getICAttribute(t,"ic-style-src").split(":");var n=r[0];i=r[1],setIfAbsent(t,"ic-src",i),setIfAbsent(t,"ic-target","this.style."+n)}if(macroIs(e,"ic-attr-src")){r=getICAttribute(t,"ic-attr-src").split(":");var o=r[0];i=r[1],setIfAbsent(t,"ic-src",i),setIfAbsent(t,"ic-target","this."+o)}macroIs(e,"ic-prepend-from")&&setIfAbsent(t,"ic-src",getICAttribute(t,"ic-prepend-from")),macroIs(e,"ic-append-from")&&setIfAbsent(t,"ic-src",getICAttribute(t,"ic-append-from"))}function setIfAbsent(e,t,r){null==getICAttribute(e,t)&&setICAttribute(e,t,r)}function isScrolledIntoView(e){var t=$(window).scrollTop(),r=t+$(window).height(),i=$(e).offset().top,n=i+$(e).height();return n>=t&&r>=i&&r>=n&&i>=t}function maybeScrollToTarget(e,t){if("false"!=closestAttrValue(e,"ic-scroll-to-target")&&("true"==closestAttrValue(e,"ic-scroll-to-target")||"true"==closestAttrValue(t,"ic-scroll-to-target"))){var r=-50;closestAttrValue(e,"ic-scroll-offset")?r=parseInt(closestAttrValue(e,"ic-scroll-offset")):closestAttrValue(t,"ic-scroll-offset")&&(r=parseInt(closestAttrValue(t,"ic-scroll-offset")));var i=t.offset().top,n=$(window).scrollTop(),o=n+window.innerHeight;(n>i||i>o)&&(r+=i,$("html,body").animate({scrollTop:r},400))}}function getTransitionDuration(e,t){var r=closestAttrValue(e,"ic-transition-duration");if(r)return parseInterval(r);if(r=closestAttrValue(t,"ic-transition-duration"))return parseInterval(r);var i=0,n=$(t).css("transition-duration");n&&(i+=parseInterval(n));var o=$(t).css("transition-delay");return o&&(i+=parseInterval(o)),i}function processICResponse(e,t,r){if(e&&""!=e&&" "!=e){log(t,"response content: \n"+e,"DEBUG");var i=getTarget(t),n=maybeFilter(e,closestAttrValue(t,"ic-select-from-response")),o=function(){if("true"==closestAttrValue(t,"ic-replace-target")){try{i.replaceWith(n)}catch(e){log(t,formatError(e),"ERROR")}processNodes(n),fireReadyStuff($(i))}else{if(t.is(getICAttributeSelector("ic-prepend-from")))prepend(i,n),processNodes(n),fireReadyStuff($(i));else if(t.is(getICAttributeSelector("ic-append-from")))append(i,n),processNodes(n),fireReadyStuff($(i));else{try{i.empty().append(n)}catch(e){log(t,formatError(e),"ERROR")}$(i).children().each(function(){processNodes($(this))}),fireReadyStuff($(i))}1!=r&&maybeScrollToTarget(t,i)}};if(0==i.length)return void log(t,"Invalid target for element: "+getICAttribute($(t).closest(getICAttributeSelector("ic-target")),"ic-target"),"ERROR");var s=getTransitionDuration(t,i);i.addClass("ic-transitioning"),setTimeout(function(){try{o()}catch(e){log(t,"Error during content swaop : "+formatError(e),"ERROR")}setTimeout(function(){try{i.removeClass("ic-transitioning"),_history.updateHistory(),i.trigger("complete_transition.ic",[i])}catch(e){log(t,"Error during transition complete : "+formatError(e),"ERROR")}},20)},s)}else log(t,"Empty response, nothing to do here.","DEBUG")}function maybeFilter(e,t){var r=$.parseHTML(e,null,!0),i=$(r);return t?i.filter(t).add(i.find(t)).contents():i}function getStyleTarget(e){var t=closestAttrValue(e,"ic-target");return t&&0==t.indexOf("this.style.")?t.substr(11):null}function getAttrTarget(e){var t=closestAttrValue(e,"ic-target");return t&&0==t.indexOf("this.")?t.substr(5):null}function fireICRequest(e,t){var r=e;e.is(getICAttributeSelector("ic-src"))||void 0!=getICAttribute(e,"ic-action")||(e=e.closest(getICAttributeSelector("ic-src")));var i=closestAttrValue(e,"ic-confirm");if((!i||confirm(i))&&e.length>0){var n=uuid();e.data("ic-event-id",n);var o=function(){if(1==e.data("ic-request-in-flight"))return void e.data("ic-next-request",o);if(e.data("ic-event-id")==n){var i=getStyleTarget(e),s=i?null:getAttrTarget(e),c=verbFor(e),l=getICAttribute(e,"ic-src");if(l){var a=t||function(t){i?e.css(i,t):s?e.attr(s,t):(processICResponse(t,e),"GET"!=c&&refreshDependencies(getICAttribute(e,"ic-src"),e))},u=getParametersForElement(c,e,r);u&&handleRemoteRequest(e,c,l,u,a)}var g=getICAttribute(e,"ic-action");g&&invokeLocalAction(e,g)}},s=closestAttrValue(e,"ic-trigger-delay");s?setTimeout(o,parseInterval(s)):o()}}function invokeLocalAction(e,t){var r=getTarget(e),i=t.split(";"),n=[],o=0;$.each(i,function(e,t){var i=$.trim(t),s=i,c=[];i.indexOf(":")>0&&(s=i.substr(0,i.indexOf(":")),c=computeArgs(i.substr(i.indexOf(":")+1,i.length))),""==s||("delay"==s?(null==o&&(o=0),o+=parseInterval(c[0]+"")):(null==o&&(o=420),n.push([o,makeApplyAction(r,s,c)]),o=null))}),o=0,$.each(n,function(e,t){o+=t[0],setTimeout(t[1],o)})}function computeArgs(args){try{return eval("["+args+"]")}catch(e){return[$.trim(args)]}}function makeApplyAction(e,t,r){return function(){var i=e[t];i?i.apply(e,r):log(e,"Action "+t+" was not found","ERROR")}}function newIntercoolerHistory(e,t,r,i){function n(e){return null==e||e.slotLimit!=r||e.historyVersion!=i||null==e.lruList}function o(){for(var t=[],n=0;n<e.length;n++)0==e.key(n).indexOf(v)&&t.push(e.key(n));for(var o=0;o<t.length;o++)e.removeItem(t[o]);e.removeItem(m),A={slotLimit:r,historyVersion:i,lruList:[]}}function s(t){var r=A.lruList,i=r.indexOf(t),n=f($("body"));if(i>=0)log(n,"URL found in LRU list, moving to end","INFO"),r.splice(i,1),r.push(t);else if(log(n,"URL not found in LRU list, adding","INFO"),r.push(t),r.length>A.slotLimit){var o=r.shift();log(n,"History overflow, removing local history for "+o,"INFO"),e.removeItem(v+o)}return e.setItem(m,JSON.stringify(A)),r}function c(t){var i=JSON.stringify(t);try{e.setItem(t.id,i)}catch(n){try{o(),e.setItem(t.id,i)}catch(n){log(f($("body")),"Unable to save intercooler history with entire history cleared, is something else eating local storage? History Limit:"+r,"ERROR")}}}function l(e,t,r){var i={url:r,id:v+r,content:e,yOffset:t,timestamp:(new Date).getTime()};return s(r),c(i),i}function a(e){if(null==e.onpopstate||1!=e.onpopstate["ic-on-pop-state-handler"]){var t=e.onpopstate;e.onpopstate=function(e){f($("body")).trigger("handle.onpopstate.ic"),d(e)||t&&t(e),f($("body")).trigger("pageLoad.ic")},e.onpopstate["ic-on-pop-state-handler"]=!0}}function u(){b&&(g(b.newUrl,currentUrl(),b.oldHtml,b.yOffset),b=null)}function g(e,r,i,n){var o=l(i,n,r);t.replaceState({"ic-id":o.id},"","");var s=f($("body")),c=l(s.html(),window.pageYOffset,e);t.pushState({"ic-id":c.id},"",e),s.trigger("pushUrl.ic",[s,c])}function d(t){var r=t.state;if(r&&r["ic-id"]){var i=JSON.parse(e.getItem(r["ic-id"]));if(i)return processICResponse(i.content,f($("body")),!0),i.yOffset&&window.scrollTo(0,i.yOffset),!0;$.get(currentUrl(),{"ic-restore-history":!0},function(e,t){var r=createDocument(e),i=f(r).html();processICResponse(i,f($("body")),!0)})}return!1}function f(e){var t=e.find(getICAttributeSelector("ic-history-elt"));return t.length>0?t:e}function p(e){var t=f($("body"));t.trigger("beforeHistorySnapshot.ic",[t]),b={newUrl:e,oldHtml:t.html(),yOffset:window.pageYOffset}}function h(){var t="",r=[];for(var i in e)r.push(i);r.sort();var n=0;for(var o in r){var s=2*e[r[o]].length;n+=s,t+=r[o]+"="+(s/1024/1024).toFixed(2)+" MB\n"}return t+"\nTOTAL LOCAL STORAGE: "+(n/1024/1024).toFixed(2)+" MB"}function I(){return A}var m="ic-history-support",v="ic-hist-elt-",A=JSON.parse(e.getItem(m)),b=null;return n(A)&&(log(f($("body")),"Intercooler History configuration changed, clearing history","INFO"),o()),null==A&&(A={slotLimit:r,historyVersion:i,lruList:[]}),{clearHistory:o,updateHistory:u,addPopStateHandler:a,snapshotForHistory:p,_internal:{addPopStateHandler:a,supportData:I,dumpLocalStorage:h,updateLRUList:s}}}function getSlotLimit(){return 20}function refresh(e){return"string"==typeof e||e instanceof String?refreshDependencies(e):fireICRequest(e),Intercooler}function init(){var e=$("body");processNodes(e),fireReadyStuff(e),_history.addPopStateHandler(window),location.search&&location.search.indexOf("ic-launch-debugger=true")>=0&&Intercooler.debug()}var USE_DATA="true"==$('meta[name="intercoolerjs:use-data-prefix"]').attr("content"),_MACROS=$.map(["ic-get-from","ic-post-to","ic-put-to","ic-patch-to","ic-delete-from","ic-style-src","ic-attr-src","ic-prepend-from","ic-append-from","ic-action"],function(e){return fixICAttributeName(e)}),_scrollHandler=null,_UUID=1,_readyHandlers=[],_isDependentFunction=function(e,t){if(!e||!t)return!1;var r=e.split(/[\?#]/,1)[0].split("/").filter(function(e){return""!=e}),i=t.split(/[\?#]/,1)[0].split("/").filter(function(e){return""!=e});return""==r||""==i?!1:i.slice(0,r.length).join("/")==r.join("/")||r.slice(0,i.length).join("/")==i.join("/")},_history=newIntercoolerHistory(localStorage,window.history,getSlotLimit(),.1);return $.ajaxTransport("text",function(e,t){if("#"==t.url[0]){var r=fixICAttributeName("ic-local-"),i=$(t.url),n=[],o=200,s="OK";i.each(function(e,t){$.each(t.attributes,function(e,t){if(t.name.substr(0,r.length)==r){var i=t.name.substring(r.length);if("status"==i){var c=t.value.match(/(\d+)\s?(.*)/);null!=c?(o=c[1],s=c[2]):(o="500",s="Attribute Error")}else n.push(i+": "+t.value)}})});var c=i.length>0?i.html():"";return{send:function(e,t){t(o,s,{html:c},n.join("\n"))},abort:function(){}}}return null}),$(function(){init()}),{refresh:refresh,history:_history,triggerRequest:fireICRequest,processNodes:processNodes,closestAttrValue:closestAttrValue,verbFor:verbFor,isDependent:isDependent,getTarget:getTarget,processHeaders:processHeaders,setIsDependentFunction:function(e){_isDependentFunction=e},ready:function(e){_readyHandlers.push(e)},debug:function(){var e=closestAttrValue("body","ic-debugger-url")||"https://intercoolerreleases-leaddynocom.netdna-ssl.com/intercooler-debugger.js";$.getScript(e).fail(function(e,t,r){log($("body"),formatError(r),"ERROR")})},_internal:{init:init,replaceOrAddMethod:replaceOrAddMethod}}}();
//# sourceMappingURL=./intercooler.min.js.map