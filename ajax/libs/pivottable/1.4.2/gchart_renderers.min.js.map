{"version":3,"sources":["/source/gchart_renderers.coffee","gchart_renderers.min.js"],"names":["callWithJQuery","pivotModule","exports","module","require","define","amd","jQuery","$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","colKey","colKeys","dataArray","dataTable","defaults","fullAggName","groupByTitle","h","hAxisTitle","headers","i","j","k","len","len1","numCharsInHAxis","options","ref","result","row","rowKey","rowKeys","title","tree2","v","vAxisTitle","val","wrapper","x","y","localeStrings","vs","by","gchart","width","window","height","extend","getRowKeys","length","push","getColKeys","aggregatorName","valAttrs","join","results","unshift","tree","parseFloat","format","value","google","visualization","DataTable","addColumn","colAttrs","rowAttrs","type","role","addRows","getAggregator","isNumeric","toPrecision","toFixed","arrayToDataTable","hAxis","slantedText","vAxis","tooltip","textStyle","fontName","fontSize","minValue","legend","position","chartArea","css","ChartWrapper","draw","bind","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","Line Chart","Bar Chart","Stacked Bar Chart","isStacked","Area Chart","Scatter Chart","call","this"],"mappings":"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","file":"gchart_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n        \ncallWithJQuery ($) ->\n\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\n        defaults =\n            localeStrings:\n                vs: \"vs\"\n                by: \"by\"\n            gchart:\n                width: -> $(window).width() / 1.4\n                height: -> $(window).height() / 1.4\n\n        opts = $.extend defaults, opts\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n        fullAggName = pivotData.aggregatorName \n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n        headers = (h.join(\"-\") for h in rowKeys)\n        headers.unshift \"\"\n\n        numCharsInHAxis = 0\n        if chartType == \"ScatterChart\"\n            dataArray = []\n            for y, tree2 of pivotData.tree\n                for x, agg of tree2\n                     dataArray.push [\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+\": \\n\"+agg.format(agg.value())\n                        ]\n            dataTable = new google.visualization.DataTable()\n            dataTable.addColumn 'number', pivotData.colAttrs.join(\"-\")\n            dataTable.addColumn 'number', pivotData.rowAttrs.join(\"-\") \n            dataTable.addColumn type: \"string\", role: \"tooltip\"\n            dataTable.addRows dataArray\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            vAxisTitle = pivotData.rowAttrs.join(\"-\")\n            title = \"\"\n        else\n            dataArray = [headers]\n            for colKey in colKeys\n                row = [colKey.join(\"-\")]\n                numCharsInHAxis += row[0].length\n                for rowKey in rowKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        val = agg.value()\n                        if $.isNumeric val\n                            if val < 0\n                                row.push parseFloat(val.toPrecision(3))\n                            else\n                                row.push parseFloat(val.toFixed(3))\n                        else\n                            row.push val\n                    else row.push null\n                dataArray.push row\n\n            dataTable = google.visualization.arrayToDataTable(dataArray)\n\n            title = vAxisTitle = fullAggName\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            groupByTitle = pivotData.rowAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        options = \n            width: opts.gchart.width()\n            height: opts.gchart.height()\n            title: title\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\n            vAxis: {title: vAxisTitle}\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n\n        if chartType == \"ColumnChart\"\n            options.vAxis.minValue = 0\n\n        if chartType == \"ScatterChart\"\n            options.legend = position: \"none\"\n            options.chartArea = {'width': '80%', 'height': '80%'}\n\n        else if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\n            options.legend = position: \"none\"\n\n        options[k] = v for k, v of extraOptions\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\n        wrapper.draw(result[0])    \n        result.bind \"dblclick\", -> \n            editor = new google.visualization.ChartEditor()\n            google.visualization.events.addListener editor, 'ok', -> \n                editor.getChartWrapper().draw(result[0])\n            editor.openDialog(wrapper)\n        return result\n\n    $.pivotUtilities.gchart_renderers = \n        \"Line Chart\": makeGoogleChart(\"LineChart\")\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\n        \"Scatter Chart\": makeGoogleChart(\"ScatterChart\")\n","(function(){var t;(t=function(t){return\"object\"==typeof exports&&\"object\"==typeof module?t(require(\"jquery\")):\"function\"==typeof define&&define.amd?define([\"jquery\"],t):t(jQuery)})(function(t){var e;return e=function(e,r){return function(n,o){var a,i,l,h,u,s,g,d,c,f,p,v,C,w,A,y,j,m,b,S,x,z,T,k,q,D,L,B,F,K;if(s={localeStrings:{vs:\"vs\",by:\"by\"},gchart:{width:function(){return t(window).width()/1.4},height:function(){return t(window).height()/1.4}}},o=t.extend(s,o),T=n.getRowKeys(),0===T.length&&T.push([]),l=n.getColKeys(),0===l.length&&l.push([]),g=n.aggregatorName,n.valAttrs.length&&(g+=\"(\"+n.valAttrs.join(\", \")+\")\"),p=function(){var t,e,r;for(r=[],t=0,e=T.length;e>t;t++)c=T[t],r.push(c.join(\"-\"));return r}(),p.unshift(\"\"),j=0,\"ScatterChart\"===e){h=[],b=n.tree;for(K in b){q=b[K];for(F in q)a=q[F],h.push([parseFloat(F),parseFloat(K),g+\": \\n\"+a.format(a.value())])}u=new google.visualization.DataTable,u.addColumn(\"number\",n.colAttrs.join(\"-\")),u.addColumn(\"number\",n.rowAttrs.join(\"-\")),u.addColumn({type:\"string\",role:\"tooltip\"}),u.addRows(h),f=n.colAttrs.join(\"-\"),L=n.rowAttrs.join(\"-\"),k=\"\"}else{for(h=[p],v=0,A=l.length;A>v;v++){for(i=l[v],x=[i.join(\"-\")],j+=x[0].length,C=0,y=T.length;y>C;C++)z=T[C],a=n.getAggregator(z,i),x.push(null!=a.value()?a.value():null);h.push(x)}u=google.visualization.arrayToDataTable(h),k=L=g,f=n.colAttrs.join(\"-\"),\"\"!==f&&(k+=\" \"+o.localeStrings.vs+\" \"+f),d=n.rowAttrs.join(\"-\"),\"\"!==d&&(k+=\" \"+o.localeStrings.by+\" \"+d)}m={width:o.gchart.width(),height:o.gchart.height(),title:k,hAxis:{title:f,slantedText:j>50},vAxis:{title:L},tooltip:{textStyle:{fontName:\"Arial\",fontSize:12}}},\"ColumnChart\"===e&&(m.vAxis.minValue=0),\"ScatterChart\"===e?(m.legend={position:\"none\"},m.chartArea={width:\"80%\",height:\"80%\"}):2===h[0].length&&\"\"===h[0][1]&&(m.legend={position:\"none\"});for(w in r)D=r[w],m[w]=D;return S=t(\"<div>\").css({width:\"100%\",height:\"100%\"}),B=new google.visualization.ChartWrapper({dataTable:u,chartType:e,options:m}),B.draw(S[0]),S.bind(\"dblclick\",function(){var t;return t=new google.visualization.ChartEditor,google.visualization.events.addListener(t,\"ok\",function(){return t.getChartWrapper().draw(S[0])}),t.openDialog(B)}),S}},t.pivotUtilities.gchart_renderers={\"Line Chart\":e(\"LineChart\"),\"Bar Chart\":e(\"ColumnChart\"),\"Stacked Bar Chart\":e(\"ColumnChart\",{isStacked:!0}),\"Area Chart\":e(\"AreaChart\",{isStacked:!0}),\"Scatter Chart\":e(\"ScatterChart\")}})}).call(this);\n//# sourceMappingURL=gchart_renderers.min.js.map"],"sourceRoot":"/source/"}