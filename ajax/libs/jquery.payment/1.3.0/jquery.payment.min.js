(function(){var e,a,j,c,i,l,o,s,r,h,m,x,u,t,f,v,y,k,q,p,w,A,g,d,z,n=[].slice,b=[].indexOf||function(D){for(var C=0,B=this.length;C<B;C++){if(C in this&&this[C]===D){return C}}return -1};e=window.jQuery||window.Zepto||window.$;e.payment={};e.payment.fn={};e.fn.payment=function(){var B,C;C=arguments[0],B=2<=arguments.length?n.call(arguments,1):[];return e.payment.fn[C].apply(this,B)};i=/(\d{1,4})/g;e.payment.cards=c=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:i,length:[16],cvcLength:[3],luhn:true},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:"forbrugsforeningen",pattern:/^600/,format:i,length:[16],cvcLength:[3],luhn:true},{type:"dankort",pattern:/^5019/,format:i,length:[16],cvcLength:[3],luhn:true},{type:"visa",pattern:/^4/,format:i,length:[13,16],cvcLength:[3],luhn:true},{type:"mastercard",pattern:/^(5[0-5]|2[2-7])/,format:i,length:[16],cvcLength:[3],luhn:true},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:true},{type:"dinersclub",pattern:/^3[0689]/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:true},{type:"discover",pattern:/^6([045]|22)/,format:i,length:[16],cvcLength:[3],luhn:true},{type:"unionpay",pattern:/^(62|88)/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:"jcb",pattern:/^35/,format:i,length:[16],cvcLength:[3],luhn:true}];a=function(D){var C,E,B;D=(D+"").replace(/\D/g,"");for(E=0,B=c.length;E<B;E++){C=c[E];if(C.pattern.test(D)){return C}}};j=function(D){var C,E,B;for(E=0,B=c.length;E<B;E++){C=c[E];if(C.type===D){return C}}};f=function(C){var H,G,F,D,E,B;F=true;D=0;G=(C+"").split("").reverse();for(E=0,B=G.length;E<B;E++){H=G[E];H=parseInt(H,10);if((F=!F)){H*=2}if(H>9){H-=9}D+=H}return D%10===0};t=function(B){var C;if((B.prop("selectionStart")!=null)&&B.prop("selectionStart")!==B.prop("selectionEnd")){return true}if((typeof document!=="undefined"&&document!==null?(C=document.selection)!=null?C.createRange:void 0:void 0)!=null){if(document.selection.createRange().text){return true}}return false};d=function(E,B){var G,C,D;try{G=B.prop("selectionStart")}catch(F){C=F;G=null}D=B.val();B.val(E);if(G!==null&&B.is(":focus")){if(G===D.length){G=E.length}B.prop("selectionStart",G);return B.prop("selectionEnd",G)}};q=function(B){return setTimeout(function(){var C,D;C=e(B.currentTarget);D=C.val();D=D.replace(/\D/g,"");return d(D,C)})};y=function(B){return setTimeout(function(){var C,D;C=e(B.currentTarget);D=C.val();D=e.payment.formatCardNumber(D);return d(D,C)})};s=function(G){var B,C,I,E,D,H,F;I=String.fromCharCode(G.which);if(!/^\d+$/.test(I)){return}B=e(G.currentTarget);F=B.val();C=a(F+I);E=(F.replace(/\D/g,"")+I).length;H=16;if(C){H=C.length[C.length.length-1]}if(E>=H){return}if((B.prop("selectionStart")!=null)&&B.prop("selectionStart")!==F.length){return}if(C&&C.type==="amex"){D=/^(\d{4}|\d{4}\s\d{6})$/}else{D=/(?:^|\s)(\d{4})$/}if(D.test(F)){G.preventDefault();return setTimeout(function(){return B.val(F+" "+I)})}else{if(D.test(F+I)){G.preventDefault();return setTimeout(function(){return B.val(F+I+" ")})}}};l=function(D){var B,C;B=e(D.currentTarget);C=B.val();if(D.which!==8){return}if((B.prop("selectionStart")!=null)&&B.prop("selectionStart")!==C.length){return}if(/\d\s$/.test(C)){D.preventDefault();return setTimeout(function(){return B.val(C.replace(/\d\s$/,""))})}else{if(/\s\d?$/.test(C)){D.preventDefault();return setTimeout(function(){return B.val(C.replace(/\d$/,""))})}}};k=function(B){return setTimeout(function(){var C,D;C=e(B.currentTarget);D=C.val();D=e.payment.formatExpiry(D);return d(D,C)})};r=function(C){var B,E,D;E=String.fromCharCode(C.which);if(!/^\d+$/.test(E)){return}B=e(C.currentTarget);D=B.val()+E;if(/^\d$/.test(D)&&(D!=="0"&&D!=="1")){C.preventDefault();return setTimeout(function(){return B.val("0"+D+" / ")})}else{if(/^\d\d$/.test(D)){C.preventDefault();return setTimeout(function(){return B.val(""+D+" / ")})}}};h=function(C){var B,E,D;E=String.fromCharCode(C.which);if(!/^\d+$/.test(E)){return}B=e(C.currentTarget);D=B.val();if(/^\d\d$/.test(D)){return B.val(""+D+" / ")}};m=function(C){var B,E,D;D=String.fromCharCode(C.which);if(!(D==="/"||D===" ")){return}B=e(C.currentTarget);E=B.val();if(/^\d$/.test(E)&&E!=="0"){return B.val("0"+E+" / ")}};o=function(D){var B,C;B=e(D.currentTarget);C=B.val();if(D.which!==8){return}if((B.prop("selectionStart")!=null)&&B.prop("selectionStart")!==C.length){return}if(/\d\s\/\s$/.test(C)){D.preventDefault();return setTimeout(function(){return B.val(C.replace(/\d\s\/\s$/,""))})}};v=function(B){return setTimeout(function(){var C,D;C=e(B.currentTarget);D=C.val();D=D.replace(/\D/g,"").slice(0,4);return d(D,C)})};x=function(B){if(B.which===229){return e(B.currentTarget).data("ime",true)}};u=function(D){var B,C;B=e(D.currentTarget);C=String.fromCharCode(D.which);if(B.data("ime")===true){B.data("ime",false);B.val(B.val()+C);return B.trigger("input")}};g=function(C){var B;if(C.metaKey||C.ctrlKey){return true}if(C.which===32){return false}if(C.which===0){return true}if(C.which<33){return true}B=String.fromCharCode(C.which);return !!/[\d\s]/.test(B)};w=function(E){var B,C,F,D;B=e(E.currentTarget);F=String.fromCharCode(E.which);if(!/^\d+$/.test(F)){return}if(t(B)){return}D=(B.val()+F).replace(/\D/g,"");C=a(D);if(C){return D.length<=C.length[C.length.length-1]}else{return D.length<=16}};A=function(D){var B,E,C;B=e(D.currentTarget);E=String.fromCharCode(D.which);if(!/^\d+$/.test(E)){return}if(t(B)){return}C=B.val()+E;C=C.replace(/\D/g,"");if(C.length>6){return false}};p=function(C){var B,E,D;B=e(C.currentTarget);E=String.fromCharCode(C.which);if(!/^\d+$/.test(E)){return}if(t(B)){return}D=B.val()+E;return D.length<=4};z=function(F){var C,E,D,B,G;C=e(F.currentTarget);G=C.val();B=e.payment.cardType(G)||"unknown";if(!C.hasClass(B)){E=(function(){var J,I,H;H=[];for(J=0,I=c.length;J<I;J++){D=c[J];H.push(D.type)}return H})();C.removeClass("unknown");C.removeClass(E.join(" "));C.addClass(B);C.toggleClass("identified",B!=="unknown");return C.trigger("payment.cardType",B)}};e.payment.fn.formatCardCVC=function(){this.on("keydown",x);this.on("keyup",u);this.on("keypress",g);this.on("keypress",p);this.on("paste",v);this.on("change",v);this.on("input",v);return this};e.payment.fn.formatCardExpiry=function(){this.on("keydown",x);this.on("keyup",u);this.on("keypress",g);this.on("keypress",A);this.on("keypress",r);this.on("keypress",m);this.on("keypress",h);this.on("keydown",o);this.on("change",k);this.on("input",k);return this};e.payment.fn.formatCardNumber=function(){this.on("keydown",x);this.on("keyup",u);this.on("keypress",g);this.on("keypress",w);this.on("keypress",s);this.on("keydown",l);this.on("keyup",z);this.on("paste",y);this.on("change",y);this.on("input",y);this.on("input",z);return this};e.payment.fn.restrictNumeric=function(){this.on("keydown",x);this.on("keyup",u);this.on("keypress",g);this.on("paste",q);this.on("change",q);this.on("input",q);return this};e.payment.fn.cardExpiryVal=function(){return e.payment.cardExpiryVal(e(this).val())};e.payment.cardExpiryVal=function(E){var F,D,B,C;C=E.split(/[\s\/]+/,2),F=C[0],B=C[1];if((B!=null?B.length:void 0)===2&&/^\d+$/.test(B)){D=(new Date).getFullYear();D=D.toString().slice(0,2);B=D+B}F=parseInt(F,10);B=parseInt(B,10);return{month:F,year:B}};e.payment.validateCardNumber=function(C){var B,D;C=(C+"").replace(/\s+|-/g,"");if(!/^\d+$/.test(C)){return false}B=a(C);if(!B){return false}return(D=C.length,b.call(B.length,D)>=0)&&(B.luhn===false||f(C))};e.payment.validateCardExpiry=function(F,C){var D,B,E;if(typeof F==="object"&&"month" in F){E=F,F=E.month,C=E.year}if(!(F&&C)){return false}F=e.trim(F);C=e.trim(C);if(!/^\d+$/.test(F)){return false}if(!/^\d+$/.test(C)){return false}if(!((1<=F&&F<=12))){return false}if(C.length===2){if(C<70){C="20"+C}else{C="19"+C}}if(C.length!==4){return false}B=new Date(C,F);D=new Date;B.setMonth(B.getMonth()-1);B.setMonth(B.getMonth()+1,1);return B>D};e.payment.validateCardCVC=function(C,D){var B,E;C=e.trim(C);if(!/^\d+$/.test(C)){return false}B=j(D);if(B!=null){return E=C.length,b.call(B.cvcLength,E)>=0}else{return C.length>=3&&C.length<=4}};e.payment.cardType=function(B){var C;if(!B){return null}return((C=a(B))!=null?C.type:void 0)||null};e.payment.formatCardNumber=function(D){var C,B,F,E;D=D.replace(/\D/g,"");C=a(D);if(!C){return D}F=C.length[C.length.length-1];D=D.slice(0,F);if(C.format.global){return(E=D.match(C.format))!=null?E.join(" "):void 0}else{B=C.format.exec(D);if(B==null){return}B.shift();B=e.grep(B,function(G){return G});return B.join(" ")}};e.payment.formatExpiry=function(C){var E,F,B,D;F=C.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);if(!F){return""}E=F[1]||"";B=F[2]||"";D=F[3]||"";if(D.length>0){B=" / "}else{if(B===" /"){E=E.substring(0,1);B=""}else{if(E.length===2||B.length>0){B=" / "}else{if(E.length===1&&(E!=="0"&&E!=="1")){E="0"+E;B=" / "}}}}return E+B+D}}).call(this);