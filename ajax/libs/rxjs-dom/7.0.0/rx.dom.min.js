/* Copyright (c) Microsoft, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){function b(a){return a&&a.Object===Object?a:null}var c={"function":!0,object:!0},d=c[typeof exports]&&exports&&!exports.nodeType?exports:null,e=c[typeof module]&&module&&!module.nodeType?module:null,f=b(d&&e&&"object"==typeof global&&global),g=b(c[typeof self]&&self),h=b(c[typeof window]&&window),i=(e&&e.exports===d?d:null,b(c[typeof this]&&this)),j=f||h!==(i&&i.window)&&h||g||i||Function("return this")();"function"==typeof define&&define.amd?define(["rx"],function(b,c){return a(j,c,b)}):"object"==typeof module&&module&&module.exports===d?module.exports=a(j,module.exports,require("rx")):j.Rx=a(j,{},j.Rx)}).call(this,function(a,b,c,d){function e(a){return function(){try{return a.apply(this,arguments)}catch(b){return D.e=b,D}}}function f(a){if(!B(a))throw new TypeError("fn must be a function");return e(a)}function g(a,b,c,d){this._e=a,this._n=b,this._fn=c,this._u=d,this._e.addEventListener(this._n,this._fn,this._u),this.isDisposed=!1}function h(a,b,c,d){if(a.addEventListener)return new g(a,b,c,d);throw new Error("No listener found")}function i(a,b,c,d){var e=new u,f=Object.prototype.toString;if("[object NodeList]"===f.call(a)||"[object HTMLCollection]"===f.call(a))for(var g=0,j=a.length;j>g;g++)e.add(i(a.item(g),b,c,d));else a&&e.add(h(a,b,c,d));return e}function j(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var b;try{for(var c=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=0;3>d;d++)try{if(b=c[d],new a.ActiveXObject(b))break}catch(e){}return new a.ActiveXObject(b)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}function k(){var b=new a.XMLHttpRequest;if("withCredentials"in b)return b;if(a.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}function l(a,b,c){var d="response"in b?b.response:b.responseText;return d="json"===c.responseType?JSON.parse(d):d,{response:d,status:b.status,responseType:b.responseType,xhr:b,originalEvent:a}}function m(a,b,c){return{type:c,status:b.status,xhr:b,originalEvent:a}}function n(a,b,c,d){a&&(b&&(b.onNext(),b.onCompleted()),c?a.close(c,d):a.close())}function o(b){var c=a.MutationObserver||a.WebKitMutationObserver;return new c(b)}var p=c.Observable,q=c.ObservableBase,r=(p.prototype,c.AnonymousObservable),s=c.internals.AbstractObserver,t=(c.Observer.create,c.Observable.create,c.Disposable.create,c.Disposable),u=c.CompositeDisposable,v=c.BinaryDisposable,w=c.SingleAssignmentDisposable,x=c.Subject,y=c.Scheduler,z=c.DOM={},A={}.hasOwnProperty,B=(c.helpers.noop,c.helpers.isFunction),C=c.internals.inherits,D={e:{}};g.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._e.removeEventListener(this._n,this._fn,this._u))};var E=function(a){function b(b,c,d,e){this._e=b,this._n=c,this._fn=d,this._uc=e,a.call(this)}function c(a,b){return function(){var c=arguments[0];if(b){var c=f(b).apply(null,arguments);if(c===D)return a.onError(c.e)}a.onNext(c)}}return C(b,a),b.prototype.subscribeCore=function(a){return i(this._e,this._n,c(a,this._fn),this._uc)},b}(q),F=z.fromEvent=function(a,b,c,d){var e=B(c)?c:null;return"boolean"==typeof c&&(d=c),"undefined"==typeof d&&(d=!1),new E(a,b,e,d).publish().refCount()};!function(){var b="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu input";a.PointerEvent&&(b+=" pointerdown pointerup pointermove pointerover pointerout pointerenter pointerleave"),a.TouchEvent&&(b+=" touchstart touchend touchmove touchcancel"),b=b.split(" ");for(var c=0,d=b.length;d>c;c++)!function(a){z[a]=function(b,c,d){return F(b,a,c,d)}}(b[c])}();var G=function(b){function c(){b.call(this)}function d(a){return function(){a.onNext(),a.onCompleted()}}function e(b,c){this._o=b,this._fn=c,this._addedHandlers=!1,this.isDisposed=!1,"complete"===a.document.readyState?setTimeout(this._fn,0):(this._addedHandlers=!0,a.document.addEventListener("DOMContentLoaded",this._fn,!1))}return C(c,b),c.prototype.subscribeCore=function(a){return new e(a,d(a))},e.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,a.document.removeEventListener("DOMContentLoaded",this._fn,!1))},c}(q);z.ready=function(){return new G};var H=(function(a){function b(b){this._settings=b,a.call(this)}function c(a,b){this._xhr=a,this._parent=b,this.isDisposed=!1}return C(b,a),b.prototype.subscribeCore=function(a){this._isDone=!1},c.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._parent._isDone||4===this._xhr.readyState||this._xhr.abort())},b}(q),z.ajax=function(b){var c={method:"GET",crossDomain:!1,async:!0,headers:{},responseType:"text",createXHR:function(){return this.crossDomain?k():j()},normalizeError:m,normalizeSuccess:l};if("string"==typeof b)c.url=b;else for(var e in b)A.call(b,e)&&(c[e]=b[e]);var f=c.normalizeError,g=c.normalizeSuccess;return c.crossDomain||c.headers["X-Requested-With"]||(c.headers["X-Requested-With"]="XMLHttpRequest"),c.hasContent=c.body!==d,new r(function(b){var d,e=!1,h=function(a,d){var h=1223===a.status?204:a.status;h>=200&&300>=h||0===h||""===h?(b.onNext(g(d,a,c)),b.onCompleted()):b.onError(f(d,a,"error")),e=!0};try{d=c.createXHR()}catch(i){return b.onError(i)}try{c.user?d.open(c.method,c.url,c.async,c.user,c.password):d.open(c.method,c.url,c.async);var j=c.headers;for(var k in j)A.call(j,k)&&d.setRequestHeader(k,j[k]);d.upload||!("withCredentials"in d)&&a.XDomainRequest?(d.onload=function(a){c.progressObserver&&(c.progressObserver.onNext(a),c.progressObserver.onCompleted()),h(d,a)},c.progressObserver&&(d.onprogress=function(a){c.progressObserver.onNext(a)}),d.onerror=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(f(a,d,"error")),e=!0},d.onabort=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(f(a,d,"abort")),e=!0}):d.onreadystatechange=function(a){4===d.readyState&&h(d,a)},d.send(c.hasContent&&c.body||null)}catch(l){b.onError(l)}return function(){e||4===d.readyState||d.abort()}})});z.post=function(a,b){var c;return"string"==typeof a?c={url:a,body:b,method:"POST"}:"object"==typeof a&&(c=a,c.method="POST"),H(c)},z.get=function(a){var b;return"string"==typeof a?b={url:a}:"object"==typeof a&&(b=a),H(b)},z.getJSON=function(b){if(!a.JSON&&"function"!=typeof a.JSON.parse)throw new TypeError("JSON is not supported in your runtime.");return H({url:b,responseType:"json"}).map(function(a){return a.response})};var I=function(){var b="document"in a&&a.document.createElement("div");return function(a){b.appendChild(a),b.innerHTML=""}}();z.jsonpRequest=function(){var b=0;return function(c){return new r(function(d){var e="callback_"+(b++).toString(36),f={jsonp:"JSONPCallback",async:!0,jsonpCallback:"rxjsjsonpCallbacks"+e};if("string"==typeof c)f.url=c;else for(var g in c)A.call(c,g)&&(f[g]=c[g]);var h=a.document.createElement("script");h.type="text/javascript",h.async=f.async,h.src=f.url.replace(f.jsonp,f.jsonpCallback),a[f.jsonpCallback]=function(b){a[f.jsonpCallback].called=!0,a[f.jsonpCallback].data=b};var i=function(b){"load"!==b.type||a[f.jsonpCallback].called||(b={type:"error"});var c="error"===b.type?400:200,e=a[f.jsonpCallback].data;200===c?(d.onNext({status:c,responseType:"jsonp",response:e,originalEvent:b}),d.onCompleted()):d.onError({type:"error",status:c,originalEvent:b})};h.onload=h.onreadystatechanged=h.onerror=i;var j=a.document.getElementsByTagName("head")[0]||a.document.documentElement;return j.insertBefore(h,j.firstChild),function(){h.onload=h.onreadystatechanged=h.onerror=null,I(h),h=null}})}}();var J=function(a){function b(b,c,d,e,f){this._state=b,this._url=c,this._protocol=d,this._open=e,this._close=f,a.call(this)}function c(a,b){return function c(d){a.onNext(d),a.onCompleted(),b.removeEventListener("open",c,!1)}}function d(a){return function(b){a.onNext(b)}}function e(a){return function(b){a.onError(b)}}function f(a){return function(b){return 1e3===b.code&&b.wasClean?void a.onCompleted():a.onError(b)}}function g(a,b,c,d,e){this._socket=a,this._msgFn=b,this._errFn=c,this._closeFn=d,this._close=e,this.isDisposed=!1}return C(b,a),g.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,n(this._socket,this._close),this._socket.removeEventListener("message",this._msgFn,!1),this._socket.removeEventListener("error",this._errFn,!1),this._socket.removeEventListener("close",this._closeFn,!1))},b.prototype.subscribeCore=function(a){this._state.socket=this._protocol?new WebSocket(this._url,this._protocol):new WebSocket(this._url);var b=c(this._open,this._state.socket),h=d(a),i=e(a),j=f(a);return this._open&&this._state.socket.addEventListener("open",b,!1),this._state.socket.addEventListener("message",h,!1),this._state.socket.addEventListener("error",i,!1),this._state.socket.addEventListener("close",j,!1),new g(this._state.socket,h,i,j,this._close)},b}(q),K=function(a){function b(b,c){this._state=b,this._close=c,a.call(this)}return C(b,a),b.prototype.next=function(a){this._state.socket&&this._state.socket.readyState===WebSocket.OPEN&&this._state.socket.send(a)},b.prototype.error=function(a){if(!a.code)throw new Error('no code specified. be sure to pass { code: ###, reason: "" } to onError()');n(this._state.socket,this._close,a.code,a.reason||"")},b.prototype.completed=function(){n(this._state.socket,this._close,1e3,"")},b}(s);z.fromWebSocket=function(a,b,c,d){if(!WebSocket)throw new TypeError("WebSocket not implemented in your runtime.");var e={socket:null};return x.create(new K(e,d),new J(e,a,b,c,d))};var L=function(a){function b(b){this._state=b,a.call(this)}return C(b,a),b.prototype.next=function(a){this._state.worker&&this._state.worker.postMessage(a)},b.prototype.error=function(a){throw a},b.prototype.completed=function(){},b}(s),M=function(b){function c(a,c){this._state=a,this._url=c,b.call(this)}function d(a){return function(b){a.onNext(b)}}function e(a){return function(b){a.onError(b)}}function f(a,b,c){this._w=a,this._msgFn=b,this._errFn=c,this.isDisposed=!1}return C(c,b),f.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._w.terminate(),this._w.removeEventListener("message",this._msgFn,!1),this._w.removeEventListener("error",this._errFn,!1))},c.prototype.subscribeCore=function(b){this._state.worker=new a.Worker(this._url);var c=d(b),g=e(b);return this._state.worker.addEventListener("message",c,!1),this._state.worker.addEventListener("error",g,!1),new f(this._state.worker,c,g)},c}(q);z.fromWorker=function(b){if(!a.Worker)throw new TypeError("Worker not implemented in your runtime.");var c={worker:null};return x.create(new L(c),new M(c,b))};var N=function(a){function b(b,c){this._target=b,this._options=c,a.call(this)}function c(a){this._m=a,this.isDisposed=!1}return C(b,a),c.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._m.disconnect())},b.prototype.subscribeCore=function(a){var b=o(function(b){a.onNext(b)});return b.observe(this._target,this._options),new c(b)},b}(q);z.fromMutationObserver=function(b,c){if(!a.MutationObserver&&!a.WebKitMutationObserver)throw new TypeError("MutationObserver not implemented in your runtime.");return new N(b,c)};var O=function(b){function c(a){this._opts=a,b.call(this)}return C(c,b),c.prototype.subscribeCore=function(b){a.navigator.geolocation.getCurrentPosition(function(a){b.onNext(a),b.onCompleted()},function(a){b.onError(a)},this._opts)},c}(q),P=function(b){function c(a){this._opts=a,b.call(this)}function d(a){this._id=a,this.isDisposed=!1}return C(c,b),d.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,a.navigator.geolocation.clearWatch(this._id))},c.prototype.subscribeCore=function(b){var c=a.navigator.geolocation.watchPosition(function(a){b.onNext(a)},function(a){b.onError(a)},this._opts);return new d(c)},c}(q);c.DOM.geolocation={getCurrentPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new O(b)},watchPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new P(b).publish().refCount()}};var Q=function(b){function c(a,c,d,e){this._readerFn=a,this._file=c,this._progressObserver=d,this._encoding=e,b.call(this)}function d(a,b){return function(c){b&&b.onCompleted(),a.onNext(c.target.result),a.onCompleted()}}function e(a){return function(b){a.onError(b.target.error)}}function f(a){return function(b){a.onNext(b)}}function g(a,b,c,d,e){this._r=a,this._po=b,this._lFn=c,this._eFn=d,this._pFn=e,this.isDisposed=!1}return C(c,b),g.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._r.readyState===a.FileReader.LOADING&&this._r.abort(),this._r.removeEventListener("load",this._lFn,!1),this._r.removeEventListener("error",this._eFn,!1),this._po&&this._r.removeEventListener("progress",this._pFn,!1))},c.prototype.subscribeCore=function(b){var c=new a.FileReader,h=d(b,this._progressObserver),i=e(b),j=f(this._progressObserver);return c.addEventListener("load",h,!1),c.addEventListener("error",i,!1),this._progressObserver&&c.addEventListener("progress",j,!1),c[this._readerFn](this._file,this._encoding),new g(c,this._progressObserver,h,i,j)},c}(q);z.fromReader=function(b,c){if(!a.FileReader)throw new TypeError("FileReader not implemented in your runtime.");return{asArrayBuffer:function(){return new Q("readAsArrayBuffer",b,c)},asBinaryString:function(){return new Q("readAsBinaryString",b,c)},asDataURL:function(){return new Q("readAsDataURL",b,c)},asText:function(a){return new Q("readAsText",b,c,a)}}};var R=function(a){function b(b,c){this._url=b,this._open=c,a.call(this)}function c(a,b){return function c(d){a.onNext(d),a.onCompleted(),b.removeEventListener("open",c,!1)}}function d(a){return function(b){b.readyState===EventSource.CLOSED?a.onCompleted():a.onError(b)}}function e(a){return function(b){a.onNext(b.data)}}function f(a,b,c){this._s=a,this._errFn=b,this._msgFn=c,this.isDisposed=!1}return C(b,a),f.prototype.dispose=function(){this.isDisposed||(this._s.removeEventListener("error",this._errFn,!1),this._s.removeEventListener("message",this._msgFn,!1),this._s.close())},b.prototype.subscribeCore=function(a){var b=new EventSource(this._url),g=c(this._open,b),h=d(a),i=e(a);return this._open&&b.addEventListener("open",g,!1),b.addEventListener("error",h,!1),b.addEventListener("message",i,!1),new f(b,h,i)},b}(q);z.fromEventSource=function(b,c){if(!a.EventSource)throw new TypeError("EventSource not implemented in your runtime.");return new R(b,c)};var S,T;return a.requestAnimationFrame?(S=a.requestAnimationFrame,T=a.cancelAnimationFrame):a.mozRequestAnimationFrame?(S=a.mozRequestAnimationFrame,T=a.mozCancelAnimationFrame):a.webkitRequestAnimationFrame?(S=a.webkitRequestAnimationFrame,T=a.webkitCancelAnimationFrame):a.msRequestAnimationFrame?(S=a.msRequestAnimationFrame,T=a.msCancelAnimationFrame):a.oRequestAnimationFrame?(S=a.oRequestAnimationFrame,T=a.oCancelAnimationFrame):(S=function(b){a.setTimeout(b,1e3/60)},T=a.clearTimeout),y.requestAnimationFrame=function(){var b=function(b){function c(){b.call(this)}function d(a,b,c,d){return function(){!a.isDisposed&&a.setDisposable(t._fixup(b(c,d)))}}function e(a,b){this._id=b,this._method=a,this.isDisposed=!1}return C(c,b),e.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._method.call(null,this._id))},c.prototype.schedule=function(a,b){var c=new w,f=S(d(c,b,this,a));return new v(c,new e(T,f))},c.prototype._scheduleFuture=function(b,c,f){if(0===c)return this.schedule(b,f);var g=new w,h=a.setTimeout(d(g,f,this,b),c);return new v(g,new e(a.clearTimeout,h))},c}(y);return new b}(),y.microtask=function(){function b(a){delete h[a]}function c(d){if(i)a.setTimeout(function(){c(d)},0);else{var e=h[d];if(e){i=!0;try{e()}catch(f){throw f}finally{b(d),i=!1}}}}function d(){if(!a.postMessage||a.importScripts)return!1;var b=!1,c=a.onmessage;return a.onmessage=function(){b=!0},a.postMessage("","*"),a.onmessage=c,b}function e(a){"string"==typeof a.data&&a.data.substring(0,n.length)===n&&c(a.data.substring(n.length))}var f,g=1,h={},i=!1,j=a.MutationObserver||a.WebKitMutationObserver;if(j){var k="drainqueue_",l=new j(function(a){a.forEach(function(a){c(a.attributeName.substring(k.length))})}),m=a.document.createElement("div");l.observe(m,{attributes:!0}),a.addEventListener("unload",function(){l.disconnect(),l=null},!1),f=function(a){var b=g++;return h[b]=a,m.setAttribute(k+b,"drainQueue"),b}}else if("function"==typeof a.setImmediate)f=function(b){var d=g++;return h[d]=b,a.setImmediate(function(){c(d)}),d};else if(d()){var n="ms.rx.schedule"+Math.random();a.addEventListener?a.addEventListener("message",e,!1):a.attachEvent&&a.attachEvent("onmessage",e),f=function(b){var c=g++;return h[c]=b,a.postMessage(n+c,"*"),c}}else if(a.MessageChannel){var o=new a.MessageChannel;o.port1.onmessage=function(a){c(a.data)},f=function(a){var b=g++;return h[b]=a,o.port2.postMessage(b),b}}else f="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(b){var d=a.document.createElement("script"),e=g++;return h[e]=b,d.onreadystatechange=function(){c(e),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},a.document.documentElement.appendChild(d),e}:function(b){var d=g++;return h[d]=b,a.setTimeout(function(){c(d)},0),d};var p=function(c){function d(){c.call(this)}function e(a,b,c,d){return function(){!a.isDisposed&&a.setDisposable(t._fixup(b(c,d)))}}function g(a,b){this._id=b,this._method=a,this.isDisposed=!1}return C(d,c),g.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._method.call(null,this._id))},d.prototype.schedule=function(a,c){var d=new w,h=f(e(d,c,this,a));return new v(d,new g(b,h))},d.prototype._scheduleFuture=function(b,c,d){if(0===c)return this.schedule(b,d);var f=new w,h=a.setTimeout(e(f,d,this,b),c);return new v(f,new g(a.clearTimeout,h))},d}(y);return new p}(),c});
//# sourceMappingURL=rx.dom.map