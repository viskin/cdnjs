var Mustache=function(){var e=function(){};return e.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],render:function(e,r,t,n){if(-1==e.indexOf(this.otag)){if(n)return e;this.send(e)}n||(this.buffer=[]),e=this.render_pragmas(e);var i=this.render_section(e,r,t);return n?this.render_tags(i,r,t,n):void this.render_tags(i,r,t,n)},send:function(e){""!=e&&this.buffer.push(e)},render_pragmas:function(e){if(-1==e.indexOf(this.otag+"%"))return e;var r=this,t=new RegExp(this.otag+"%([\\w_-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return e.replace(t,function(e,t,n){if(r.pragmas[t]={},n){var i=n.split("=");r.pragmas[t][i[0]]=i[1]}return""})},render_partial:function(e,r,t){if("object"!=typeof r[e])throw{message:"subcontext for '"+e+"' is not an object"};if(!t||!t[e])throw{message:"unknown_partial"};return this.render(t[e],r[e],t,!0)},render_section:function(e,r,t){if(-1==e.indexOf(this.otag+"#"))return e;var n=this,i=new RegExp(this.otag+"\\#(.+)"+this.ctag+"\\s*([\\s\\S]+?)"+this.otag+"\\/\\1"+this.ctag+"\\s*","mg");return e.replace(i,function(e,i,a){var s=n.find(i,r);return n.is_array(s)?n.map(s,function(e){return n.render(a,n.merge(r,n.create_context(e)),t,!0)}).join(""):s?n.render(a,r,t,!0):""})},render_tags:function(e,r,t,n){for(var i=this,a=function(){return new RegExp(i.otag+"(=|!|>|\\{|%)?([^/#]+?)\\1?"+i.ctag+"+","g")},s=a(),u=e.split("\n"),o=0;o<u.length;o++)u[o]=u[o].replace(s,function(e,n,u){switch(n){case"!":return e;case"=":return i.set_delimiters(u),s=a(),"";case">":return i.render_partial(u,r,t);case"{":return i.find(u,r);default:return i.escape(i.find(u,r))}},this),n||this.send(u[o]);return u.join("\n")},set_delimiters:function(e){var r=e.split(" ");this.otag=this.escape_regex(r[0]),this.ctag=this.escape_regex(r[1])},escape_regex:function(e){if(!arguments.callee.sRE){var r=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+r.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,r){return e=this.trim(e),"function"==typeof r[e]?r[e].apply(r):void 0!==r[e]?r[e]:""},escape:function(e){return e.toString().replace(/[&"<>\\]/g,function(e){switch(e){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'"';case"<":return"&lt;";case">":return"&gt;";default:return e}})},merge:function(e,r){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);return t},create_context:function(e){if(this.is_object(e))return e;if(this.pragmas["IMPLICIT-ITERATOR"]){var r=this.pragmas["IMPLICIT-ITERATOR"].iterator||".",t={};return t[r]=e,t}},is_object:function(e){return e&&"object"==typeof e},is_array:function(e){return e&&"object"==typeof e&&e.constructor===Array},trim:function(e){return e.replace(/^\s*|\s*$/g,"")},map:function(e,r){if("function"==typeof e.map)return e.map(r);var t=[],n=e.length;for(i=0;n>i;i++)t.push(r(e[i]));return t}},{name:"mustache.js",version:"0.2.2",to_html:function(r,t,n,i){var a=new e;return i&&(a.send=i),a.render(r,t,n),a.buffer.join("\n")}}}();