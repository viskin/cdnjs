/*
 * jqModal - Minimalist Modaling with jQuery
 *
 * Copyright (c) 2007-2014 Brice Burgess @iceburg_net
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 * 
 * $Version: 2014.01.30 +r17 (aka 1.0.0)
 * Requires: jQuery 1.2.3+
 */
(function(jQuery,window,undefined){$.fn.jqm=function(options){var o=$.extend({},$.jqm.params,options);return this.each(function(){var e=$(this),jqm=$(this).data('jqm');if(!jqm)jqm={ID:I++};e.data('jqm',$.extend(o,jqm)).addClass('jqm-init');o.trigger&&$(this).jqmAddTrigger(o.trigger)})};$.fn.jqmAddTrigger=function(trigger){return this.each(function(){if(!addTrigger($(this),'jqmShow',trigger))err("jqmAddTrigger must be called on initialized modals")})};$.fn.jqmAddClose=function(trigger){return this.each(function(){if(!addTrigger($(this),'jqmHide',trigger))err("jqmAddClose must be called on initialized modals")})};$.fn.jqmShow=function(trigger){return this.each(function(){!this._jqmShown&&show($(this),trigger)})};$.fn.jqmHide=function(trigger){return this.each(function(){this._jqmShown&&hide($(this),trigger)})};var err=function(msg){if(window.console&&window.console.error)window.console.error(msg)},show=function(e,t){var o=e.data('jqm'),t=t||window.event,z=(parseInt(e.css('z-index'))),z=(z>0)?z:3000,v=$('<div></div>').addClass(o.overlayClass).css({height:'100%',width:'100%',position:'fixed',left:0,top:0,'z-index':z-1,opacity:o.overlay/100});h={w:e,c:o,o:v,t:t};e.css('z-index',z);if(o.ajax){var target=o.target||e,url=o.ajax;target=(typeof target=='string')?$(target,e):$(target);if(url.substr(0,1)=='@')url=$(t).attr(url.substring(1));target.html(o.ajaxText).load(url,function(){o.onLoad&&o.onLoad.call(this,h);open(h)})}else{open(h)}},hide=function(e,t){var o=e.data('jqm'),t=t||window.event,h={w:e,c:o,o:e.data('jqmv'),t:t};close(h)},onShow=function(hash){if(hash.c.overlay>0)hash.o.prependTo('body');hash.w.show();$.jqm.focusFunc(hash.w);return true},onHide=function(hash){hash.w.hide()&&hash.o&&hash.o.remove();return true},addTrigger=function(e,key,trigger){if(!e.data('jqm'))return false;return $(trigger).each(function(){this[key]=this[key]||[];this[key].push(e)}).click(function(){var trigger=this;$.each(this[key],function(i,e){e[key](trigger)});return false})},open=function(h){var e=h.w,v=h.o,o=h.c;if(o.onShow(h)!==false){e[0]._jqmShown=true;if(o.modal){!A[0]&&F('bind');A.push(e)}else e.jqmAddClose(v);o.closeClass&&e.jqmAddClose($('.'+o.closeClass,e));o.toTop&&v&&e.before('<span id="jqmP'+o.ID+'"></span>').insertAfter(v);e.data('jqmv',v)}},close=function(h){var e=h.w,v=h.o,o=h.c;if(o.onHide(h)!==false){e[0]._jqmShown=false;if(o.modal){A.pop();!A[0]&&F('unbind')}o.toTop&&v&&$('#jqmP'+o.ID).after(e).remove()}},F=function(t){$(document)[t]("keypress keydown mousedown",X)},X=function(e){var modal=$(e.target).data('jqm')||$(e.target).parents('.jqm-init:first').data('jqm'),activeModal=A[A.length-1].data('jqm');if(modal&&modal.ID==activeModal.ID)return true;return $.jqm.focusFunc(activeModal)},I=0,A=[];$.jqm={params:{overlay:50,overlayClass:'jqmOverlay',closeClass:'jqmClose',trigger:'.jqModal',ajax:false,target:false,ajaxText:'',modal:false,toTop:false,onShow:onShow,onHide:onHide,onLoad:false},focusFunc:function(e){$(':input:visible:first',e).focus();return false}}})(jQuery,window);