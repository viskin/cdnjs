(function(b){function a(c){this.init(c)}a.prototype={value:0,size:100,startAngle:-Math.PI,thickness:"auto",fill:{gradient:["#3aeabb","#fdd250"]},emptyFill:"rgba(0, 0, 0, .1)",animation:{duration:1200,easing:"circleProgressEasing"},animationStartValue:0,reverse:false,el:null,canvas:null,ctx:null,radius:0,arcFill:null,lastFrameValue:0,init:function(c){b.extend(this,c);this.radius=this.size/2;this.initWidget();this.initFill();this.draw()},initWidget:function(){var c=this.canvas=this.canvas||b("<canvas>").prependTo(this.el)[0];c.width=this.size;c.height=this.size;this.ctx=c.getContext("2d")},initFill:function(){var h=this,g=this.fill,k=this.ctx,l=this.size;if(!g){throw Error("The fill is not specified!")}if(g.color){this.arcFill=g.color}if(g.gradient){var c=g.gradient;if(c.length==1){this.arcFill=c[0]}else{if(c.length>1){var j=k.createLinearGradient(0,0,l,0);for(var d=0;d<c.length;d++){j.addColorStop(d/(c.length-1),c[d])}this.arcFill=j}}}if(g.image){var e;if(g.image instanceof Image){e=g.image}else{e=new Image();e.src=g.image}if(e.complete){f()}else{e.onload=f}}function f(){var i=b("<canvas>")[0];i.width=h.size;i.height=h.size;i.getContext("2d").drawImage(e,0,0,l,l);h.arcFill=h.ctx.createPattern(i,"no-repeat");h.drawFrame(h.lastFrameValue)}},draw:function(){if(this.animation){this.drawAnimated(this.value)}else{this.drawFrame(this.value)}},drawFrame:function(c){this.lastFrameValue=c;this.ctx.clearRect(0,0,this.size,this.size);this.drawArc(c);this.drawEmptyArc(c)},drawArc:function(e){var d=this.ctx,g=this.radius,f=this.getThickness(),c=this.startAngle;d.save();d.beginPath();if(!this.reverse){d.arc(g,g,g-f/2,c,c+Math.PI*2*e)}else{d.arc(g,g,g-f/2,c-Math.PI*2*e,c)}d.lineWidth=f;d.strokeStyle=this.arcFill;d.stroke();d.restore()},drawEmptyArc:function(e){var d=this.ctx,g=this.radius,f=this.getThickness(),c=this.startAngle;if(e<1){d.save();d.beginPath();if(e<=0){d.arc(g,g,g-f/2,0,Math.PI*2)}else{if(!this.reverse){d.arc(g,g,g-f/2,c+Math.PI*2*e,c)}else{d.arc(g,g,g-f/2,c,c-Math.PI*2*e)}}d.lineWidth=f;d.strokeStyle=this.emptyFill;d.stroke();d.restore()}},drawAnimated:function(d){var c=this,e=this.el;e.trigger("circle-animation-start");b(this.canvas).stop(true,true).css({animationProgress:0}).animate({animationProgress:1},b.extend({},this.animation,{step:function(g){var f=c.animationStartValue*(1-g)+d*g;c.drawFrame(f);e.trigger("circle-animation-progress",[g,f])},complete:function(){e.trigger("circle-animation-end")}}))},getThickness:function(){return b.isNumeric(this.thickness)?this.thickness:this.size/14}};b.circleProgress={defaults:a.prototype};b.easing.circleProgressEasing=function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g*g+e}return i/2*((g-=2)*g*g+2)+e};b.fn.circleProgress=function(d){var c="circle-progress";if(d=="widget"){var e=this.data(c);return e&&e.canvas}return this.each(function(){var h=b(this),f=h.data(c),g=b.isPlainObject(d)?d:{};if(f){f.init(g);f.draw()}else{g.el=h;f=new a(g);h.data(c,f)}})}})(jQuery);