/*!
* js-data-localstorage
* @version 2.0.0-beta.3 - Homepage <http://www.js-data.io/docs/dslocalstorageadapter>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2015 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-localstorage/blob/master/LICENSE>
*
* @overview localStorage adapter for js-data.
*/

!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("js-data")):"function"==typeof define&&define.amd?define(["js-data"],b):"object"==typeof exports?exports.DSLocalStorageAdapter=b(require("js-data")):a.DSLocalStorageAdapter=b(a.JSData)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a){C.push(a)}function e(){if(C.length){var a=C.shift();a()}}function f(a){C.length?d(a):a()}function g(a){return new t.Promise(a).then(function(a){return setTimeout(function(){C.length&&e()},0),a})}var h=function(a){return a&&a.__esModule?a:{"default":a}},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(b,"__esModule",{value:!0});var k=c(1),l=h(k),m=c(2),n=h(m),o=c(3),p=h(o),q=c(4),r=h(q),s=new l["default"].DS,t=l["default"].DSUtils,u=t.makePath,v=t.deepMixIn,w=t.toJson,x=t.fromJson,y=t.forEach,z=t.removeCircular,A=s.defaults.defaultFilter,B=function E(){j(this,E)};B.prototype.basePath="";var C=[],D=function(){function a(b){j(this,a),b=b||{},this.defaults=new B,v(this.defaults,b)}return i(a,[{key:"getPath",value:function(a,b){return u(b.basePath||this.defaults.basePath||a.basePath,a.name)}},{key:"getIdPath",value:function(a,b,c){return u(b.basePath||this.defaults.basePath||a.basePath,a.getEndpoint(c,b),c)}},{key:"getIds",value:function(a,b){var c=void 0,d=this.getPath(a,b),e=localStorage.getItem(d);return e?c=x(e):(localStorage.setItem(d,w({})),c={}),c}},{key:"saveKeys",value:function(a,b,c){localStorage.setItem(this.getPath(b,c),w(a))}},{key:"ensureId",value:function(a,b,c){var d=this.getIds(b,c);d[a]=1,this.saveKeys(d,b,c)}},{key:"removeId",value:function(a,b,c){var d=this.getIds(b,c);delete d[a],this.saveKeys(d,b,c)}},{key:"GET",value:function(a){return new t.Promise(function(b){var c=localStorage.getItem(a);b(c?x(c):void 0)})}},{key:"PUT",value:function(a,b){var c=this;return c.GET(a).then(function(d){return d&&v(d,z(b)),localStorage.setItem(a,w(d||b)),c.GET(a)})}},{key:"DEL",value:function(a){return new t.Promise(function(b){localStorage.removeItem(a),b()})}},{key:"find",value:function(a,b,c){var d=this;return g(function(e,g){f(function(){d.GET(d.getIdPath(a,c||{},b)).then(function(a){return a?e(a):g(new Error("Not Found!"))})})})}},{key:"findAll",value:function(a,b,c){var d=this;return g(function(e,g){f(function(){try{!function(){c=c||{},"allowSimpleWhere"in c||(c.allowSimpleWhere=!0);var f=[],g=p["default"](d.getIds(a,c));y(g,function(b){var e=localStorage.getItem(d.getIdPath(a,c,b));e&&f.push(x(e))}),e(A.call(s,f,a.name,b,c))}()}catch(f){g(f)}})})}},{key:"create",value:function(a,b,c){var d=this;return g(function(e,g){f(function(){b[a.idAttribute]=b[a.idAttribute]||r["default"](),c=c||{},d.PUT(u(d.getIdPath(a,c,b[a.idAttribute])),n["default"](b,a.relationFields||[])).then(function(b){d.ensureId(b[a.idAttribute],a,c),e(b)})["catch"](g)})})}},{key:"update",value:function(a,b,c,d){var e=this;return g(function(g,h){f(function(){d=d||{},e.PUT(e.getIdPath(a,d,b),n["default"](c,a.relationFields||[])).then(function(b){e.ensureId(b[a.idAttribute],a,d),g(b)})["catch"](h)})})}},{key:"updateAll",value:function(a,b,c,d){var e=this;return g(function(g,h){f(function(){e.findAll(a,c,d).then(function(c){var f=[];y(c,function(c){return f.push(e.update(a,c[a.idAttribute],n["default"](b,a.relationFields||[]),d))}),g(t.Promise.all(f))})["catch"](h)})})}},{key:"destroy",value:function(a,b,c){var d=this;return g(function(e,g){f(function(){c=c||{},d.DEL(d.getIdPath(a,c,b)).then(function(){return d.removeId(b,a.name,c)}).then(e,g)})})}},{key:"destroyAll",value:function(a,b,c){var d=this;return g(function(e,g){f(function(){d.findAll(a,b,c).then(function(b){var f=[];y(b,function(b){return f.push(d.destroy(a,b[a.idAttribute],c))}),e(t.Promise.all(f))})["catch"](g)})})}}]),a}();b["default"]=D,a.exports=b["default"]},function(b,c,d){b.exports=a},function(a,b,c){function d(a,b){var c="string"!=typeof arguments[1]?arguments[1]:e(arguments,1),d={};for(var g in a)a.hasOwnProperty(g)&&!f(c,g)&&(d[g]=a[g]);return d}var e=c(5),f=c(6);a.exports=d},function(a,b,c){var d=c(7),e=Object.keys||function(a){var b=[];return d(a,function(a,c){b.push(c)}),b};a.exports=e},function(a,b,c){function d(){return e(8)+"-"+e(4)+"-4"+e(3)+"-"+f(8,9,"a","b")+e(3)+"-"+e(12)}var e=c(8),f=c(9);a.exports=d},function(a,b,c){function d(a,b,c){var d=a.length;b=null==b?0:0>b?Math.max(d+b,0):Math.min(b,d),c=null==c?d:0>c?Math.max(d+c,0):Math.min(c,d);for(var e=[];c>b;)e.push(a[b++]);return e}a.exports=d},function(a,b,c){function d(a,b){return-1!==e(a,b)}var e=c(10);a.exports=d},function(a,b,c){function d(a,b,c){f(a,function(d,f){return e(a,f)?b.call(c,a[f],f,a):void 0})}var e=c(11),f=c(12);a.exports=d},function(a,b,c){function d(a){a=a&&a>0?a:6;for(var b="";a--;)b+=e(f);return b}var e=c(9),f="0123456789abcdef".split("");a.exports=d},function(a,b,c){function d(a){var b=1===arguments.length&&f(a)?a:arguments;return b[e(0,b.length-1)]}var e=c(13),f=c(14);a.exports=d},function(a,b,c){function d(a,b,c){if(c=c||0,null==a)return-1;for(var d=a.length,e=0>c?d+c:c;d>e;){if(a[e]===b)return e;e++}return-1}a.exports=d},function(a,b,c){function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}a.exports=d},function(a,b,c){function d(){h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],g=!0;for(var a in{toString:null})g=!1}function e(a,b,c){var e,j=0;null==g&&d();for(e in a)if(f(b,a,e,c)===!1)break;if(g)for(var k=a.constructor,l=!!k&&a===k.prototype;(e=h[j++])&&("constructor"===e&&(l||!i(a,e))||a[e]===Object.prototype[e]||f(b,a,e,c)!==!1););}function f(a,b,c,d){return a.call(d,b[c],c,b)}var g,h,i=c(11);a.exports=e},function(a,b,c){function d(a,b){return a=null==a?e:~~a,b=null==b?f:~~b,Math.round(g(a-.5,b+.499999999999))}var e=c(15),f=c(16),g=c(17);a.exports=d},function(a,b,c){var d=c(18),e=Array.isArray||function(a){return d(a,"Array")};a.exports=e},function(a,b,c){a.exports=-2147483648},function(a,b,c){a.exports=2147483647},function(a,b,c){function d(a,b){return a=null==a?f:a,b=null==b?g:b,a+(b-a)*e()}var e=c(19),f=c(15),g=c(16);a.exports=d},function(a,b,c){function d(a,b){return e(a)===b}var e=c(20);a.exports=d},function(a,b,c){function d(){return d.get()}d.get=Math.random,a.exports=d},function(a,b,c){function d(a){return null===a?"Null":a===e?"Undefined":f.exec(g.call(a))[1]}var e,f=/^\[object (.*)\]$/,g=Object.prototype.toString;a.exports=d}])});
//# sourceMappingURL=js-data-localstorage.min.map