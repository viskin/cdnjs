/*!
* js-data-localstorage
* @version 3.0.0-beta.2 - Homepage <https://github.com/js-data/js-data-localstorage>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2016 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-localstorage/blob/master/LICENSE>
*
* @overview localStorage adapter for js-data.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("js-data")):"function"==typeof define&&define.amd?define("js-data-localstorage",["exports","js-data"],e):e(t.JSDataLocalStorage=t.JSDataLocalStorage||{},t.JSData)}(this,function(t,e){"use strict";function n(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(t){var n=this;t||(t={}),e.utils.fillIn(t,b),e.utils.fillIn(n,t)}function i(t,n,r){var i=this;n||(n={}),i.data=t,e.utils.fillIn(i,n),i.op=r}function o(t){return null!=t&&""!==t}function u(t,e){return e||(e=""),t.filter(o).join(e)}function a(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=u(e,"/");return r.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function s(t){q.push(t)}function l(){q.length&&!$&&($=!0,q[0]())}function f(t){q.length?s(t):(s(t),l())}function c(t){return new Promise(t).then(function(t){return $=!1,q.shift(),setTimeout(l,0),t},function(t){return $=!1,q.shift(),setTimeout(l,0),e.utils.reject(t)})}function d(t){e.utils.classCallCheck(this,d),t||(t={}),e.utils.fillIn(t,N),r.call(this,t)}var h={};h.typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},h.defineProperty=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},h.slicedToArray=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var p=function(){for(var t=this,n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];var o=r[r.length-1];return t.dbg.apply(t,[o.op].concat(r)),e.utils.resolve()},y=function(){for(var t=this,n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];var o=r[r.length-2];return t.dbg.apply(t,[o.op].concat(r)),e.utils.resolve()},v=function(t){var e={},n=[];return t.forEach(function(t){t in e||(n.push(t),e[t]=0)}),n},g=function(t,n){return e.utils.omit(n,t.relationFields||[])},b={debug:!1,raw:!1};r.extend=e.utils.extend,e.utils.addHiddenPropsToTarget(r.prototype,{afterCount:y,afterCreate:y,afterCreateMany:y,afterDestroy:y,afterDestroyAll:y,afterFind:y,afterFindAll:y,afterSum:y,afterUpdate:y,afterUpdateAll:y,afterUpdateMany:y,beforeCount:p,beforeCreate:p,beforeCreateMany:p,beforeDestroy:p,beforeDestroyAll:p,beforeFind:p,beforeFindAll:p,beforeSum:p,beforeUpdate:p,beforeUpdateAll:p,beforeUpdateMany:p,dbg:function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];this.log.apply(this,["debug"].concat(e))},count:function(t,n,r){var o=this,u=void 0;return n||(n={}),r||(r={}),u=r.op="beforeCount",e.utils.resolve(o[u](t,n,r)).then(function(){return u=r.op="count",o.dbg(u,t,n,r),e.utils.resolve(o._count(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];f||(f={});var c=new i(l,f,u);return c=o.respond(c,r),u=r.op="afterCount",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})},create:function(t,n,r){var o=this,u=void 0;return n||(n={}),r||(r={}),u=r.op="beforeCreate",e.utils.resolve(o[u](t,n,r)).then(function(i){return n=e.utils.isUndefined(i)?n:i,n=g(t,n),u=r.op="create",o.dbg(u,t,n,r),e.utils.resolve(o._create(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];f||(f={});var c=new i(l,f,"create");return c.created=l?1:0,c=o.respond(c,r),u=r.op="afterCreate",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})},createMany:function(t,n,r){var o=this,u=void 0;return n||(n={}),r||(r={}),u=r.op="beforeCreateMany",e.utils.resolve(o[u](t,n,r)).then(function(i){return n=e.utils.isUndefined(i)?n:i,n=n.map(function(e){return g(t,e)}),u=r.op="createMany",o.dbg(u,t,n,r),e.utils.resolve(o._createMany(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];l||(l=[]),f||(f={});var c=new i(l,f,"createMany");return c.created=l.length,c=o.respond(c,r),u=r.op="afterCreateMany",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})},destroy:function(t,n,r){var o=this,u=void 0;return r||(r={}),u=r.op="beforeDestroy",e.utils.resolve(o[u](t,n,r)).then(function(){return u=r.op="destroy",o.dbg(u,t,n,r),e.utils.resolve(o._destroy(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];f||(f={});var c=new i(l,f,"destroy");return c=o.respond(c,r),u=r.op="afterDestroy",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})},destroyAll:function(t,n,r){var o=this,u=void 0;return n||(n={}),r||(r={}),u=r.op="beforeDestroyAll",e.utils.resolve(o[u](t,n,r)).then(function(){return u=r.op="destroyAll",o.dbg(u,t,n,r),e.utils.resolve(o._destroyAll(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];f||(f={});var c=new i(l,f,"destroyAll");return c=o.respond(c,r),u=r.op="afterDestroyAll",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})},loadBelongsTo:function(t,n,r,i){var o=this,u=n.getRelation();if(!e.utils.isObject(r)||e.utils.isArray(r)){var a=r.map(function(e){return o.makeBelongsToForeignKey(t,n,e)}).filter(function(t){return t});return o.findAll(u,{where:h.defineProperty({},u.idAttribute,{in:a})},i).then(function(t){r.forEach(function(e){t.forEach(function(t){t[u.idAttribute]===e[n.foreignKey]&&n.setLocalField(e,t)})})})}var s=function(){var e=r;return{v:o.find(u,o.makeBelongsToForeignKey(t,n,e),i).then(function(t){n.setLocalField(e,t)})}}();return"object"===("undefined"==typeof s?"undefined":h.typeof(s))?s.v:void 0},find:function(t,n,r){var o=this,u=void 0,a=void 0;return r||(r={}),r.with||(r.with=[]),a=r.op="beforeFind",e.utils.resolve(o[a](t,n,r)).then(function(){return a=r.op="find",o.dbg(a,t,n,r),e.utils.resolve(o._find(t,n,r))}).then(function(n){var i=h.slicedToArray(n,1),a=i[0];if(a){u=a;var s=[];return e.utils.forEachRelation(t,r,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,u,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,u,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,u,n)):r="hasOne"===e.type?o.loadHasOne(t,e,u,n):o.loadHasMany(t,e,u,n),r&&s.push(r)}),Promise.all(s)}}).then(function(){var s=new i(u,{},"find");return s.found=u?1:0,s=o.respond(s,r),a=r.op="afterFind",e.utils.resolve(o[a](t,n,r,s)).then(function(t){return e.utils.isUndefined(t)?s:t})})},findAll:function(t,n,r){var o=this;r||(r={}),r.with||(r.with=[]);var u=[],a=void 0,s=r._activeWith;if(e.utils.isObject(s)){var l=s.query||{};s.replace?n=l:e.utils.deepFillIn(n,l)}return a=r.op="beforeFindAll",e.utils.resolve(o[a](t,n,r)).then(function(){return a=r.op="findAll",o.dbg(a,t,n,r),e.utils.resolve(o._findAll(t,n,r))}).then(function(n){var i=h.slicedToArray(n,1),a=i[0];a||(a=[]),u=a;var s=[];return e.utils.forEachRelation(t,r,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,u,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,u,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,u,n)):r="hasMany"===e.type?o.loadHasMany(t,e,u,n):o.loadHasOne(t,e,u,n),r&&s.push(r)}),Promise.all(s)}).then(function(){var s=new i(u,{},"findAll");return s.found=u.length,s=o.respond(s,r),a=r.op="afterFindAll",e.utils.resolve(o[a](t,n,r,s)).then(function(t){return e.utils.isUndefined(t)?s:t})})},getOpt:function(t,n){return n||(n={}),e.utils.isUndefined(n[t])?e.utils.plainCopy(this[t]):e.utils.plainCopy(n[t])},loadHasMany:function(t,n,r,i){var o=this,u=!1;e.utils.isObject(r)&&!e.utils.isArray(r)&&(u=!0,r=[r]);var a=r.map(function(e){return o.makeHasManyForeignKey(t,n,e)}),s={where:{}},l=s.where[n.foreignKey]={};return u?l["=="]=a[0]:l.in=a.filter(function(t){return t}),o.findAll(n.getRelation(),s,i).then(function(i){r.forEach(function(r){var o=[];u?o=i:i.forEach(function(i){e.utils.get(i,n.foreignKey)===r[t.idAttribute]&&o.push(i)}),n.setLocalField(r,o)})})},loadHasManyLocalKeys:function(t,n,r,i){var o=this,u=void 0,a=n.getRelation();if(e.utils.isObject(r)&&!e.utils.isArray(r)&&(u=r),u)return o.findAll(a,{where:h.defineProperty({},a.idAttribute,{in:o.makeHasManyLocalKeys(t,n,u)})},i).then(function(t){n.setLocalField(u,t)});var s=function(){var u=[];return r.forEach(function(e){u=u.concat(o.self.makeHasManyLocalKeys(t,n,e))}),{v:o.findAll(a,{where:h.defineProperty({},a.idAttribute,{in:v(u).filter(function(t){return t})})},i).then(function(t){return r.forEach(function(r){var i=[],o=e.utils.get(r,n.localKeys)||[];o=e.utils.isArray(o)?o:Object.keys(o),t.forEach(function(t){o&&-1!==o.indexOf(t[a.idAttribute])&&i.push(t)}),n.setLocalField(r,i)}),t})}}();return"object"===("undefined"==typeof s?"undefined":h.typeof(s))?s.v:void 0},loadHasManyForeignKeys:function(t,n,r,i){var o=this,u=n.getRelation(),a=t.idAttribute,s=void 0;return e.utils.isObject(r)&&!e.utils.isArray(r)&&(s=r),s?o.findAll(n.getRelation(),{where:h.defineProperty({},n.foreignKeys,{contains:o.makeHasManyForeignKeys(t,n,s)})},i).then(function(t){n.setLocalField(s,t)}):o.findAll(u,{where:h.defineProperty({},n.foreignKeys,{isectNotEmpty:r.map(function(e){return o.makeHasManyForeignKeys(t,n,e)})})},i).then(function(t){var i=n.foreignKeys;r.forEach(function(r){var o=[],u=e.utils.get(r,a);t.forEach(function(n){var r=e.utils.get(t,i)||[];-1!==r.indexOf(u)&&o.push(n)}),n.setLocalField(r,o)})})},loadHasOne:function(t,n,r,i){return e.utils.isObject(r)&&!e.utils.isArray(r)&&(r=[r]),this.loadHasMany(t,n,r,i).then(function(){r.forEach(function(t){var r=n.getLocalField(t);e.utils.isArray(r)&&r.length&&n.setLocalField(t,r[0])})})},log:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];if(t&&!n.length&&(n.push(t),t="debug"),"debug"!==t||this.debug){var i=t.toUpperCase()+": (Adapter)";if(console[t]){var o;(o=console)[t].apply(o,[i].concat(n))}else{var u;(u=console).log.apply(u,[i].concat(n))}}},makeHasManyForeignKey:function(t,e,n){return e.getForeignKey(n)},makeHasManyLocalKeys:function(t,n,r){var i=[],o=e.utils.get(r,n.localKeys)||[];return o=e.utils.isArray(o)?o:Object.keys(o),i=i.concat(o),v(i).filter(function(t){return t})},makeHasManyForeignKeys:function(t,n,r){return e.utils.get(r,t.idAttribute)},makeBelongsToForeignKey:function(t,e,n){return e.getForeignKey(n)},sum:function(t,n,r,o){var u=this,a=void 0;if(!e.utils.isString(n))throw new Error("field must be a string!");return r||(r={}),o||(o={}),a=o.op="beforeSum",e.utils.resolve(u[a](t,n,r,o)).then(function(){return a=o.op="sum",u.dbg(a,t,n,r,o),e.utils.resolve(u._sum(t,n,r,o))}).then(function(s){var l=h.slicedToArray(s,2),f=l[0],c=l[1];c||(c={});var d=new i(f,c,a);return d=u.respond(d,o),a=o.op="afterSum",e.utils.resolve(u[a](t,n,r,o,d)).then(function(t){return e.utils.isUndefined(t)?d:t})})},respond:function(t,e){return this.getOpt("raw",e)?t:t.data},update:function(t,n,r,o){var u=this;r||(r={}),o||(o={});var a=void 0;return a=o.op="beforeUpdate",e.utils.resolve(u[a](t,n,r,o)).then(function(i){return r=e.utils.isUndefined(i)?r:i,r=g(t,r),a=o.op="update",u.dbg(a,t,n,r,o),e.utils.resolve(u._update(t,n,r,o))}).then(function(s){var l=h.slicedToArray(s,2),f=l[0],c=l[1];c||(c={});var d=new i(f,c,"update");return d.updated=f?1:0,d=u.respond(d,o),a=o.op="afterUpdate",e.utils.resolve(u[a](t,n,r,o,d)).then(function(t){return e.utils.isUndefined(t)?d:t})})},updateAll:function(t,n,r,o){var u=this;n||(n={}),r||(r={}),o||(o={});var a=void 0;return a=o.op="beforeUpdateAll",e.utils.resolve(u[a](t,n,r,o)).then(function(i){return n=e.utils.isUndefined(i)?n:i,n=g(t,n),a=o.op="updateAll",u.dbg(a,t,n,r,o),e.utils.resolve(u._updateAll(t,n,r,o))}).then(function(s){var l=h.slicedToArray(s,2),f=l[0],c=l[1];f||(f=[]),c||(c={});var d=new i(f,c,"updateAll");return d.updated=f.length,d=u.respond(d,o),a=o.op="afterUpdateAll",e.utils.resolve(u[a](t,n,r,o,d)).then(function(t){return e.utils.isUndefined(t)?d:t})})},updateMany:function(t,n,r){var o=this;n||(n=[]),r||(r={});var u=void 0,a=t.idAttribute;return n=n.filter(function(t){return e.utils.get(t,a)}),u=r.op="beforeUpdateMany",e.utils.resolve(o[u](t,n,r)).then(function(i){return n=e.utils.isUndefined(i)?n:i,n=n.map(function(e){return g(t,e)}),u=r.op="updateMany",o.dbg(u,t,n,r),e.utils.resolve(o._updateMany(t,n,r))}).then(function(a){var s=h.slicedToArray(a,2),l=s[0],f=s[1];l||(l=[]),f||(f={});var c=new i(l,f,"updateMany");return c.updated=l.length,c=o.respond(c,r),u=r.op="afterUpdateMany",e.utils.resolve(o[u](t,n,r,c)).then(function(t){return e.utils.isUndefined(t)?c:t})})}});var m=n(function(t){function e(t){return null===t?"Null":t===n?"Undefined":r.exec(i.call(t))[1]}var n,r=/^\[object (.*)\]$/,i=Object.prototype.toString;t.exports=e}),A=m&&"object"==typeof m&&"default"in m?m.default:m,M=n(function(t){function e(t,e){return n(t)===e}var n=A;t.exports=e}),I=M&&"object"==typeof M&&"default"in M?M.default:M,P=n(function(t){var e=I,n=Array.isArray||function(t){return e(t,"Array")};t.exports=n}),_=P&&"object"==typeof P&&"default"in P?P.default:P,j=n(function(t){t.exports=2147483647}),K=j&&"object"==typeof j&&"default"in j?j.default:j,w=n(function(t){t.exports=-2147483648}),F=w&&"object"==typeof w&&"default"in w?w.default:w,U=n(function(t){function e(){return e.get()}e.get=Math.random,t.exports=e}),T=U&&"object"==typeof U&&"default"in U?U.default:U,x=n(function(t){function e(t,e){return t=null==t?r:t,e=null==e?i:e,t+(e-t)*n()}var n=T,r=F,i=K;t.exports=e}),H=x&&"object"==typeof x&&"default"in x?x.default:x,O=n(function(t){function e(t,e){return t=null==t?n:~~t,e=null==e?r:~~e,Math.round(i(t-.5,e+.499999999999))}var n=F,r=K,i=H;t.exports=e}),S=O&&"object"==typeof O&&"default"in O?O.default:O,E=n(function(t){function e(t){var e=1===arguments.length&&r(t)?t:arguments;return e[n(0,e.length-1)]}var n=S,r=_;t.exports=e}),C=E&&"object"==typeof E&&"default"in E?E.default:E,L=n(function(t){function e(t){t=t&&t>0?t:6;for(var e="";t--;)e+=n(r);return e}var n=C,r="0123456789abcdef".split("");t.exports=e}),k=L&&"object"==typeof L&&"default"in L?L.default:L,J=n(function(t){function e(){return n(8)+"-"+n(4)+"-4"+n(3)+"-"+r(8,9,"a","b")+n(3)+"-"+n(12)}var n=k,r=C;t.exports=e}),D=J&&"object"==typeof J&&"default"in J?J.default:J,R=D,B=r.prototype,N={basePath:"",storage:{getItem:function(t){return e.utils.resolve(localStorage.getItem(t))},setItem:function(t,n){return e.utils.resolve(localStorage.setItem(t,n))},removeItem:function(t){return e.utils.resolve(localStorage.removeItem(t))}}},q=[],$=!1;d.prototype=Object.create(r.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),Object.defineProperty(d,"__super__",{configurable:!0,value:r}),d.extend=e.utils.extend,e.utils.addHiddenPropsToTarget(d.prototype,{_count:function(t,e,n){return this._findAll(t,e,n).then(function(t){return t[0]=t[0].length,t})},_createHelper:function(t,n,r){var i=this;n=e.utils.plainCopy(n);var o=t.idAttribute,u=n.map(function(t){var n=e.utils.get(t,o);return e.utils.isUndefined(n)&&(n=R(),e.utils.set(t,o,n)),n}),a=u.map(function(e){return i.getIdPath(t,r,e)}),s=n.map(function(t,n){return i.storage.setItem(a[n],e.utils.toJson(t))});return e.utils.Promise.all(s).then(function(){return i.ensureId(u,t,r)}).then(function(){return e.utils.Promise.all(a.map(function(t){return i.storage.getItem(t)}))}).then(function(t){return t.map(function(t){return e.utils.fromJson(t)})})},_create:function(t,e,n){return this._createHelper(t,[e],n).then(function(t){return[t[0],{}]})},_createMany:function(t,e,n){return this._createHelper(t,e,n).then(function(t){return[t,{}]})},_destroy:function(t,e,n){var r=this;return this.storage.removeItem(this.getIdPath(t,n,e)).then(function(){return r.removeId(e,t,n)}).then(function(){return[void 0,{}]})},_destroyAll:function(t,n,r){var i=this;return this._findAll(t,n,r).then(function(n){var o=h.slicedToArray(n,1),u=o[0],a=t.idAttribute,s=u.map(function(t){return e.utils.get(t,a)}),l=s.map(function(e){return i.storage.removeItem(i.getIdPath(t,r,e))});return e.utils.Promise.all(l).then(function(){return i.removeId(s,t,r)})}).then(function(){return[void 0,{}]})},_find:function(t,n,r){var i=this.getIdPath(t,r,n);return this.storage.getItem(i).then(function(t){return[t?e.utils.fromJson(t):void 0,{}]})},_findAll:function(t,n,r){var i=this;return n||(n={}),this.getIds(t,r).then(function(n){var o=Object.keys(n).map(function(e){return i.storage.getItem(i.getIdPath(t,r,e))});return e.utils.Promise.all(o)}).then(function(t){return t.map(function(t){return t?e.utils.fromJson(t):void 0}).filter(function(t){return t})}).then(function(t){var r=new e.Query({index:{getAll:function(){return t}}});return[r.filter(n).run(),{}]})},_sum:function(t,n,r,i){return this._findAll(t,r,i).then(function(t){return t[0]=t[0].reduce(function(t,r){return t+(e.utils.get(r,n)||0)},0),t})},_update:function(t,n,r,i){var o=this;return r||(r={}),this._find(t,n,i).then(function(u){var a=h.slicedToArray(u,1),s=a[0];if(!s)throw new Error("Not Found");var l=o.getIdPath(t,i,n);return e.utils.deepMixIn(s,r),o.storage.setItem(l,e.utils.toJson(s))}).then(function(){return o._find(t,n,i)})},_updateAll:function(t,n,r,i){var o=this;return this._findAll(t,r,i).then(function(r){var u=h.slicedToArray(r,1),a=u[0],s=t.idAttribute,l=a.map(function(r){r||(r={});var u=e.utils.get(r,s),a=o.getIdPath(t,i,u);return e.utils.deepMixIn(r,n),o.storage.setItem(a,e.utils.toJson(r)).then(function(){return o._find(t,u,i)}).then(function(t){return t[0]})});return e.utils.Promise.all(l)}).then(function(t){return[t,{}]})},_updateMany:function(t,n,r){var i=this;n||(n=[]);var o=t.idAttribute,u=n.filter(function(t){return t}).map(function(n){var u=e.utils.get(n,o);if(!e.utils.isUndefined(u)){var a=i.getIdPath(t,r,u);return i.storage.getItem(a).then(function(t){if(t){var r=e.utils.fromJson(t);return e.utils.deepMixIn(r,n),i.storage.setItem(a,e.utils.toJson(r))}}).then(function(){return i._find(t,u,r)}).then(function(t){return t[0]})}}).filter(function(t){return t});return e.utils.Promise.all(u).then(function(t){return[t,{}]})},create:function(t,e,n){var r=this;return c(function(i,o){f(function(){B.create.call(r,t,e,n).then(i,o)})})},createMany:function(t,e,n){var r=this;return c(function(i,o){f(function(){B.createMany.call(r,t,e,n).then(i,o)})})},destroy:function(t,e,n){var r=this;return c(function(i,o){f(function(){B.destroy.call(r,t,e,n).then(i,o)})})},destroyAll:function(t,e,n){var r=this;return c(function(i,o){f(function(){B.destroyAll.call(r,t,e,n).then(i,o)})})},ensureId:function(t,n,r){var i=this;return this.getIds(n,r).then(function(o){if(e.utils.isArray(t)){if(!t.length)return;t.forEach(function(t){o[t]=1})}else o[t]=1;return i.saveKeys(o,n,r)})},getPath:function(t,e){return e=e||{},a(void 0===e.basePath?void 0===t.basePath?this.basePath:t.basePath:e.basePath,t.name)},getIdPath:function(t,e,n){return e=e||{},a(e.basePath||this.basePath||t.basePath,t.endpoint,n)},getIds:function(t,n){var r=void 0,i=this.getPath(t,n);return this.storage.getItem(i).then(function(t){return r=t?e.utils.fromJson(t):{}})},removeId:function(t,n,r){var i=this;return this.getIds(n,r).then(function(o){if(e.utils.isArray(t)){if(!t.length)return;t.forEach(function(t){delete o[t]})}else delete o[t];return i.saveKeys(o,n,r)})},saveKeys:function(t,n,r){t||(t={});var i=this.getPath(n,r);return Object.keys(t).length?this.storage.setItem(i,e.utils.toJson(t)):this.storage.removeItem(i)},update:function(t,e,n,r){var i=this;return c(function(o,u){f(function(){B.update.call(i,t,e,n,r).then(o,u)})})},updateAll:function(t,e,n,r){var i=this;return c(function(o,u){f(function(){B.updateAll.call(i,t,e,n,r).then(o,u)})})},updateMany:function(t,e,n){var r=this;return c(function(i,o){f(function(){B.updateMany.call(r,t,e,n).then(i,o)})})}});var Q={beta:2,full:"3.0.0-beta.2",major:3,minor:0,patch:0};t.LocalStorageAdapter=d,t.version=Q,t.default=d});
//# sourceMappingURL=js-data-localstorage.min.map