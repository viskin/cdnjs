/*! jQuery UI Virtual Keyboard Virtual Caret v1.0 (beta) */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=a.keyboard;b.firefox="undefined"!=typeof window.mozInnerScreenX,a.extend(b.css,{caret:"ui-keyboard-caret"}),a.fn.addCaret=function(c){var d={caretClass:"",charAttr:"data-character",charIndex:1,offsetX:0,offsetY:0,adjustHt:0};return this.each(function(){var e,f=a(this).data("keyboard");f&&(e=f.caret_options=a.extend({},d,c),f.caret_namespace=f.namespace+"caret",f.extensionNamespace.push(f.caret_namespace),f.textareaCaretProperties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],f.caret_setup=function(){var c="keyup keypress mouseup mouseleave ".split(" ").join(f.caret_namespace+" "),d="position:absolute;visibility:hidden;top:-9999em;left:-9999em;white-space:pre-wrap;"+("INPUT"===f.preview.nodeName?"":"word-wrap:break-word;");f.caret_$div=a('<div class="ui-keyboard-mirror-div" style="'+d+'">').appendTo(f.$keyboard),f.$caret=a('<div class="ui-keyboard-caret '+e.caretClass+'" style="position:absolute;">').insertAfter(f.$preview),f.$el.unbind(b.events.kbChange+f.caret_namespace).bind(b.events.kbChange+f.caret_namespace,function(){f.findCaretPos()}),f.$preview.unbind(c).bind(c,function(){f.findCaretPos()})},f.findCaretPos=function(){var a,c,d,g,h,i,j=f.preview,k="INPUT"===j.nodeName,l=f.caret_$div[0];a=l.style,c=window.getComputedStyle?getComputedStyle(j):j.currentStyle,g=b.caret(f.$preview),h=Math["ltr"===c.direction?"max":"min"](g.start,g.end),f.textareaCaretProperties.forEach(function(b){a[b]=c[b]}),b.firefox?(a.width=parseInt(c.width,10)-2+"px",j.scrollHeight>parseInt(c.height,10)&&(a.overflowY="scroll")):a.width=parseInt(k?j.scrollWidth:c.width,10)+(k?50:0)+"px",l.textContent=j.value.substring(0,h),"INPUT"===j.nodeName&&(l.textContent=l.textContent.replace(/\x20/g," "));var m=document.createElement("span");m.textContent=j.value.substring(h)||".",l.appendChild(m),f.caretPos={top:m.offsetTop+parseInt(c.borderTopWidth,10)+e.offsetY,left:m.offsetLeft+parseInt(c.borderLeftWidth,10)+e.offsetX},d=parseInt(f.$caret.css("margin-top"),10),a=Math.round(parseFloat(f.$preview.css("font-size"))+2*d)+e.adjustHt,f.$caret.css({top:j.offsetTop-j.scrollTop+f.caretPos.top-d,left:j.offsetLeft-j.scrollLeft+f.caretPos.left,height:a}),i=j.value.substring(h,h+e.charIndex).replace(/\s/," ")||" ",f.$caret.attr(e.charAttr,i)},f.options.alwaysOpen&&f.isVisible()&&f.caret_setup(),f.$el.unbind(f.caret_namespace).bind(b.events.kbBeforeVisible+f.caret_namespace,function(){f.caret_setup()}).bind(b.events.kbHidden+f.caret_namespace,function(){f.$caret=null,f.caret_$div=null}))})}});