/*
 * AnythingSlider Video Controller 1.2 beta minified
 * for AnythingSlider v1.6+
 * By Rob Garrison (aka Mottie & Fudgey)
 * Dual licensed under the MIT and GPL licenses.
 */

(function(d){d.fn.anythingSliderVideo=function(){return this.each(function(){var a,c,b,e,f=d(this).data("AnythingSlider");if(f){a=f.video={};a.hasSwfo=typeof swfobject!=="undefined"&&swfobject.hasOwnProperty("embedSWF")&&typeof swfobject.embedSWF==="function"?true:false;a.list={};a.hasVid=false;a.hasEmbed=false;a.services=d.fn.anythingSliderVideo.services;a.len=0;a.hasEmbedCount=0;a.hasiframeCount=0;a.$items=f.$items.filter(":not(.cloned)");for(b in a.services)if(typeof b==="string")e=a.services[b].selector, a.$items.find(e).each(function(){c=d(this);c.attr("id",d.anythingSliderVideoDefaults.videoID+a.len);a.list[a.len]={id:d.anythingSliderVideoDefaults.videoID+a.len++,panel:c.closest(".panel")[0],service:b,selector:e,status:-1};a.hasVid=true;e.match("embed|object")?(a.hasEmbed=true,a.hasEmbedCount++):e.match("iframe")&&a.hasiframeCount++});d.each(a.list,function(b,c){var k,e,g,h,l=d(c.panel).find(c.selector),i=a.services[c.service],j=i.initAPI||"";a.hasEmbed&&a.hasSwfo&&c.selector.match("embed|object")? l.each(function(){e=d(this).parent()[0].tagName==="OBJECT"?d(this).parent():d(this);g=e[0].tagName==="EMBED"?e.attr("src"):e.find("embed").attr("src")||e.children().filter("[name=movie]").attr("value");h=d.extend(true,{},{flashvars:null,params:{allowScriptAccess:"always",wmode:f.options.addWmodeToObject,allowfullscreen:true},attr:{"class":e.attr("class"),style:e.attr("style"),"data-url":g}},i.embedOpts);e.wrap('<div id="'+c.id+'"></div>');swfobject.embedSWF(g+(j===""?"":j+c.id),c.id,e.attr("width"), e.attr("height"),"10",null,h.flashvars,h.params,h.attr,function(){if(i.hasOwnProperty("init"))a.list[b].player=i.init(f,c.id,b);b>=a.hasEmbedCount&&f.$el.trigger("swf_completed",f)})}):c.selector.match("iframe")&&l.each(function(){g=d(this).attr("src");k=(g.match(/\?/g)?"":"?")+"&wmode="+f.options.addWmodeToObject;d(this).attr("src",function(a,b){return b+k+(j===""?"":j+c.id)})})});a.gup=function(a,b){var a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+a+"=([^&#]*)").exec(b||window.location.href); return c===null?"":c[1]};a.postMsg=function(a,b){var c=d("#"+b);c.length&&c[0].contentWindow.postMessage(a,c.attr("src").split("?")[0])};a.message=function(b){if(b.data&&!/infoDelivery/g.test(b.data)){var c=d.parseJSON(b.data);d.each(a.list,function(b){a.services[a.list[b].service].hasOwnProperty("message")&&a.services[a.list[b].service].message(f,c)})}};a.control=function(b){var c,d=a.list,e=b==="pause"?f.$lastPage[0]:f.$currentPage[0],g=false;for(c=0;c<a.len;c++)d[c].panel===e&&a.services[d[c].service].hasOwnProperty(b)&& (g=a.services[d[c].service][b](f,d[c].id,c));return g};a.hasiframeCount&&(window.addEventListener?window.addEventListener("message",a.message,false):window.attachEvent("onmessage",a.message,false));f.$el.bind("slide_init",function(){a.control("pause")}).bind("slide_complete",function(){a.control("cont")});f.options.isVideoPlaying=function(){return a.control("isPlaying")}}})};d.anythingSliderVideoDefaults={videoID:"asvideo",resumeVideo:false};d.fn.anythingSliderVideo.services={video:{selector:"video", cont:function(a,c){var b=d("#"+c);b.length&&b[0].paused&&b[0].currentTime>0&&!b[0].ended&&b[0].play()},pause:function(){d("video").each(function(){typeof this.pause!=="undefined"&&this.pause()})},isPlaying:function(a,c){var b=d("#"+c);return b.length&&typeof b[0].pause!=="undefined"&&!b[0].paused&&!b[0].ended?true:false}},vimeo1:{selector:"iframe[src*=vimeo]",initAPI:"&api=1&player_id=",cont:function(a,c,b){d.anythingSliderVideoDefaults.resumeVideo&&a.video.list[b].status==="pause"&&a.video.postMsg('{"method":"play"}', c)},pause:function(a){d("iframe[src*=vimeo]").each(function(){a.video.postMsg('{"method":"pause"}',this.id)})},message:function(a,c){var b,e=c.player_id||"";if(e!==""&&(b=e.replace(d.anythingSliderVideoDefaults.videoID,""),c.event==="ready"&&(a.video.postMsg('{"method":"addEventListener","value":"play"}',e),a.video.postMsg('{"method":"addEventListener","value":"pause"}',e),a.video.postMsg('{"method":"addEventListener","value":"finish"}',e)),a.video.list[b]))a.video.list[b].status=c.event},isPlaying:function(a, c,b){return a.video.list[b].status==="play"?true:false}},vimeo2:{selector:"object[data-url*=vimeo], embed[src*=vimeo]",embedOpts:{flashvars:{api:1}},cont:function(a,c){if(d.anythingSliderVideoDefaults.resumeVideo){var b=d("#"+c);typeof b[0].api_play==="function"&&b[0].api_paused()&&b[0].api_getCurrentTime()!==0&&b[0].api_getDuration()-b[0].api_getCurrentTime()>2&&b[0].api_play()}},pause:function(){d("object[data-url*=vimeo], embed[src*=vimeo]").each(function(){var a=this.tagName==="EMBED"?d(this).parent()[0]: this;typeof a.api_pause==="function"&&a.api_pause()})},isPlaying:function(a,c){var b=d("#"+c);return typeof b[0].api_paused==="function"&&!b[0].api_paused()?true:false}},youtube1:{selector:"iframe[src*=youtube]",initAPI:"&iv_load_policy=3&enablejsapi=1&playerapiid=",cont:function(a,c,b){d.anythingSliderVideoDefaults.resumeVideo&&a.video.list[b].status===2&&a.video.postMsg('{"event":"command","func":"playVideo"}',c)},pause:function(a,c){d("iframe[src*=youtube]").each(function(){a.video.postMsg('{"event":"command","func":"pauseVideo"}', c)})},message:function(a,c){if(c.event!=="infoDelivery"&&c.info&&c.info.videoUrl){var b=a.video.gup("v",c.info.videoUrl),b=d("iframe[src*="+b+"]"),e;if(b.length&&(b=b[0].id,e=b.replace(d.anythingSliderVideoDefaults.videoID,""),c.event==="onReady"&&a.video.postMsg('{"event":"listening","func":"onStateChange"}',b),c.event==="onStateChange"&&a.video.list[e]))a.video.list[e].status=c.info.playerState}},isPlaying:function(a,c,b){a=a.video.list[b].status;return a===1||a>2?true:false}},youtube2:{selector:"object[data-url*=youtube], embed[src*=youtube]", initAPI:"&iv_load_policy=3&enablejsapi=1&version=3&playerapiid=",cont:function(a,c){if(d.anythingSliderVideoDefaults.resumeVideo){var b=d("#"+c);b.length&&typeof b[0].getPlayerState==="function"&&b[0].getPlayerState()>0&&b[0].playVideo()}},pause:function(){d("object[data-url*=youtube], embed[src*=youtube]").each(function(){var a=this.tagName==="EMBED"?d(this).parent()[0]:this;typeof a.getPlayerState==="function"&&a.getPlayerState()>0&&a.pauseVideo()})},isPlaying:function(a,c){var b=d("#"+c);return typeof b[0].getPlayerState=== "function"&&(b[0].getPlayerState()===1||b[0].getPlayerState()>2)?true:false}}}})(jQuery);jQuery(window).load(function(){jQuery(".anythingBase").anythingSliderVideo()});
