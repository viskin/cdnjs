(function(a){if(typeof define==="function"&&define.amd){define(["load-image"],a)}else{a(window.loadImage)}}(function(b){if(!window.navigator||!window.navigator.platform||!(/iP(hone|od|ad)/).test(window.navigator.platform)){return}var a=b.renderImageToCanvas;b.detectSubsampling=function(c){var d,e;if(c.width*c.height>1024*1024){d=document.createElement("canvas");d.width=d.height=1;e=d.getContext("2d");e.drawImage(c,-c.width+1,0);return e.getImageData(0,0,1,1).data[3]===0}return false};b.detectVerticalSquash=function(h,e){var d=document.createElement("canvas"),c=d.getContext("2d"),g,j,i,k,f;d.width=1;d.height=e;c.drawImage(h,0,0);g=c.getImageData(0,0,1,e).data;j=0;i=e;k=e;while(k>j){f=g[(k-1)*4+3];if(f===0){i=k}else{j=k}k=(i+j)>>1}return(k/e)||1};b.renderImageToCanvas=function(g,t,o,n,m,f,s,r,h,j){if(t._type==="image/jpeg"){var e=g.getContext("2d"),d=document.createElement("canvas"),l=1024,c=d.getContext("2d"),p,q,k,i;d.width=l;d.height=l;e.save();p=b.detectSubsampling(t);if(p){m/=2;f/=2}q=b.detectVerticalSquash(t,f);if(p&&q!==1){h=Math.ceil(l*h/m);j=Math.ceil(l*j/f/q);r=0;i=0;while(i<f){s=0;k=0;while(k<m){c.clearRect(0,0,l,l);c.drawImage(t,o,n,m,f,-k,-i,m,f);e.drawImage(d,0,0,l,l,s,r,h,j);k+=l;s+=h}i+=l;r+=j}e.restore();return g}}return a(g,t,o,n,m,f,s,r,h,j)}}));