(function($){"use strict";var loadImage=function(file,callback,options){var img=document.createElement("img");var url;var oUrl;img.onerror=callback;img.onload=function(){if(oUrl&&!(options&&options.noRevoke)){loadImage.revokeObjectURL(oUrl)}if(callback){callback(loadImage.scale(img,options))}};if(loadImage.isInstanceOf("Blob",file)||loadImage.isInstanceOf("File",file)){url=oUrl=loadImage.createObjectURL(file);img._type=file.type}else if(typeof file==="string"){url=file;if(options&&options.crossOrigin){img.crossOrigin=options.crossOrigin}}else{return false}if(url){img.src=url;return img}return loadImage.readFile(file,function(e){var target=e.target;if(target&&target.result){img.src=target.result}else{if(callback){callback(e)}}})};var urlAPI=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;loadImage.isInstanceOf=function(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"};loadImage.transformCoordinates=function(){return};loadImage.getTransformedOptions=function(img,options){var aspectRatio=options.aspectRatio;var newOptions;var i;var width;var height;if(!aspectRatio){return options}newOptions={};for(i in options){if(options.hasOwnProperty(i)){newOptions[i]=options[i]}}newOptions.crop=true;width=img.naturalWidth||img.width;height=img.naturalHeight||img.height;if(width/height>aspectRatio){newOptions.maxWidth=height*aspectRatio;newOptions.maxHeight=height}else{newOptions.maxWidth=width;newOptions.maxHeight=width/aspectRatio}return newOptions};loadImage.renderImageToCanvas=function(canvas,img,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight){canvas.getContext("2d").drawImage(img,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight);return canvas};loadImage.hasCanvasOption=function(options){return options.canvas||options.crop||!!options.aspectRatio};loadImage.scale=function(img,options){options=options||{};var canvas=document.createElement("canvas");var useCanvas=img.getContext||loadImage.hasCanvasOption(options)&&canvas.getContext;var width=img.naturalWidth||img.width;var height=img.naturalHeight||img.height;var destWidth=width;var destHeight=height;var maxWidth;var maxHeight;var minWidth;var minHeight;var sourceWidth;var sourceHeight;var sourceX;var sourceY;var pixelRatio;var tmp;function scaleUp(){var scale=Math.max((minWidth||destWidth)/destWidth,(minHeight||destHeight)/destHeight);if(scale>1){destWidth*=scale;destHeight*=scale}}function scaleDown(){var scale=Math.min((maxWidth||destWidth)/destWidth,(maxHeight||destHeight)/destHeight);if(scale<1){destWidth*=scale;destHeight*=scale}}if(useCanvas){options=loadImage.getTransformedOptions(img,options);sourceX=options.left||0;sourceY=options.top||0;if(options.sourceWidth){sourceWidth=options.sourceWidth;if(options.right!==undefined&&options.left===undefined){sourceX=width-sourceWidth-options.right}}else{sourceWidth=width-sourceX-(options.right||0)}if(options.sourceHeight){sourceHeight=options.sourceHeight;if(options.bottom!==undefined&&options.top===undefined){sourceY=height-sourceHeight-options.bottom}}else{sourceHeight=height-sourceY-(options.bottom||0)}destWidth=sourceWidth;destHeight=sourceHeight}maxWidth=options.maxWidth;maxHeight=options.maxHeight;minWidth=options.minWidth;minHeight=options.minHeight;if(useCanvas&&maxWidth&&maxHeight&&options.crop){destWidth=maxWidth;destHeight=maxHeight;tmp=sourceWidth/sourceHeight-maxWidth/maxHeight;if(tmp<0){sourceHeight=maxHeight*sourceWidth/maxWidth;if(options.top===undefined&&options.bottom===undefined){sourceY=(height-sourceHeight)/2}}else if(tmp>0){sourceWidth=maxWidth*sourceHeight/maxHeight;if(options.left===undefined&&options.right===undefined){sourceX=(width-sourceWidth)/2}}}else{if(options.contain||options.cover){minWidth=maxWidth=maxWidth||minWidth;minHeight=maxHeight=maxHeight||minHeight}if(options.cover){scaleDown();scaleUp()}else{scaleUp();scaleDown()}}if(useCanvas){pixelRatio=options.pixelRatio;if(pixelRatio>1){canvas.style.width=destWidth+"px";canvas.style.height=destHeight+"px";destWidth*=pixelRatio;destHeight*=pixelRatio;canvas.getContext("2d").scale(pixelRatio,pixelRatio)}canvas.width=destWidth;canvas.height=destHeight;loadImage.transformCoordinates(canvas,options);return loadImage.renderImageToCanvas(canvas,img,sourceX,sourceY,sourceWidth,sourceHeight,0,0,destWidth,destHeight)}img.width=destWidth;img.height=destHeight;return img};loadImage.createObjectURL=function(file){return urlAPI?urlAPI.createObjectURL(file):false};loadImage.revokeObjectURL=function(url){return urlAPI?urlAPI.revokeObjectURL(url):false};loadImage.readFile=function(file,callback,method){if(window.FileReader){var fileReader=new FileReader;fileReader.onload=fileReader.onerror=callback;method=method||"readAsDataURL";if(fileReader[method]){fileReader[method](file);return fileReader}}return false};if(typeof define==="function"&&define.amd){define(function(){return loadImage})}else if(typeof module==="object"&&module.exports){module.exports=loadImage}else{$.loadImage=loadImage}})(window);