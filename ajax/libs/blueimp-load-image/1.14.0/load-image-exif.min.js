!function(factory){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-meta"],factory):factory(window.loadImage)}(function(loadImage){"use strict";loadImage.ExifMap=function(){return this},loadImage.ExifMap.prototype.map={Orientation:274},loadImage.ExifMap.prototype.get=function(id){return this[id]||this[this.map[id]]},loadImage.getExifThumbnail=function(dataView,offset,length){var hexData,i,b;if(!length||offset+length>dataView.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(hexData=[],i=0;length>i;i+=1)b=dataView.getUint8(offset+i),hexData.push((16>b?"0":"")+b.toString(16));return"data:image/jpeg,%"+hexData.join("%")},loadImage.exifTagTypes={1:{getValue:function(dataView,dataOffset){return dataView.getUint8(dataOffset)},size:1},2:{getValue:function(dataView,dataOffset){return String.fromCharCode(dataView.getUint8(dataOffset))},size:1,ascii:!0},3:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint16(dataOffset,littleEndian)},size:2},4:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint32(dataOffset,littleEndian)},size:4},5:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint32(dataOffset,littleEndian)/dataView.getUint32(dataOffset+4,littleEndian)},size:8},9:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getInt32(dataOffset,littleEndian)},size:4},10:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getInt32(dataOffset,littleEndian)/dataView.getInt32(dataOffset+4,littleEndian)},size:8}},loadImage.exifTagTypes[7]=loadImage.exifTagTypes[1],loadImage.getExifValue=function(dataView,tiffOffset,offset,type,length,littleEndian){var tagSize,dataOffset,values,i,str,c,tagType=loadImage.exifTagTypes[type];if(!tagType)return void console.log("Invalid Exif data: Invalid tag type.");if(tagSize=tagType.size*length,dataOffset=tagSize>4?tiffOffset+dataView.getUint32(offset+8,littleEndian):offset+8,dataOffset+tagSize>dataView.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===length)return tagType.getValue(dataView,dataOffset,littleEndian);for(values=[],i=0;length>i;i+=1)values[i]=tagType.getValue(dataView,dataOffset+i*tagType.size,littleEndian);if(tagType.ascii){for(str="",i=0;i<values.length&&(c=values[i],"\x00"!==c);i+=1)str+=c;return str}return values},loadImage.parseExifTag=function(dataView,tiffOffset,offset,littleEndian,data){var tag=dataView.getUint16(offset,littleEndian);data.exif[tag]=loadImage.getExifValue(dataView,tiffOffset,offset,dataView.getUint16(offset+2,littleEndian),dataView.getUint32(offset+4,littleEndian),littleEndian)},loadImage.parseExifTags=function(dataView,tiffOffset,dirOffset,littleEndian,data){var tagsNumber,dirEndOffset,i;if(dirOffset+6>dataView.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(tagsNumber=dataView.getUint16(dirOffset,littleEndian),dirEndOffset=dirOffset+2+12*tagsNumber,dirEndOffset+4>dataView.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(i=0;tagsNumber>i;i+=1)this.parseExifTag(dataView,tiffOffset,dirOffset+2+12*i,littleEndian,data);return dataView.getUint32(dirEndOffset,littleEndian)},loadImage.parseExifData=function(dataView,offset,length,data,options){if(!options.disableExif){var littleEndian,dirOffset,thumbnailData,tiffOffset=offset+10;if(1165519206===dataView.getUint32(offset+4)){if(tiffOffset+8>dataView.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==dataView.getUint16(offset+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(dataView.getUint16(tiffOffset)){case 18761:littleEndian=!0;break;case 19789:littleEndian=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==dataView.getUint16(tiffOffset+2,littleEndian))return void console.log("Invalid Exif data: Missing TIFF marker.");dirOffset=dataView.getUint32(tiffOffset+4,littleEndian),data.exif=new loadImage.ExifMap,dirOffset=loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+dirOffset,littleEndian,data),dirOffset&&!options.disableExifThumbnail&&(thumbnailData={exif:{}},dirOffset=loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+dirOffset,littleEndian,thumbnailData),thumbnailData.exif[513]&&(data.exif.Thumbnail=loadImage.getExifThumbnail(dataView,tiffOffset+thumbnailData.exif[513],thumbnailData.exif[514]))),data.exif[34665]&&!options.disableExifSub&&loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+data.exif[34665],littleEndian,data),data.exif[34853]&&!options.disableExifGps&&loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+data.exif[34853],littleEndian,data)}}},loadImage.metaDataParsers.jpeg[65505].push(loadImage.parseExifData)});