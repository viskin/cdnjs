(function(a){if(typeof define==="function"&&define.amd){define(["load-image"],a)}else{a(window.loadImage)}}(function(b){if(!window.navigator||!window.navigator.platform||!(/iP(hone|od|ad)/).test(window.navigator.platform)){return}var a=b.renderImageToCanvas;b.detectSubsampling=function(c){var d,e;if(c.width*c.height>1024*1024){d=document.createElement("canvas");d.width=d.height=1;e=d.getContext("2d");e.drawImage(c,-c.width+1,0);return e.getImageData(0,0,1,1).data[3]===0}return false};b.detectVerticalSquash=function(g,j){var l=g.naturalHeight||g.height,d=document.createElement("canvas"),c=d.getContext("2d"),f,i,h,k,e;if(j){l/=2}d.width=1;d.height=l;c.drawImage(g,0,0);f=c.getImageData(0,0,1,l).data;i=0;h=l;k=l;while(k>i){e=f[(k-1)*4+3];if(e===0){h=k}else{i=k}k=(h+i)>>1}return(k/l)||1};b.renderImageToCanvas=function(h,t,p,o,n,g,s,r,i,k){if(t._type==="image/jpeg"){var f=h.getContext("2d"),d=document.createElement("canvas"),m=1024,c=d.getContext("2d"),e,q,l,j;d.width=m;d.height=m;f.save();e=b.detectSubsampling(t);if(e){p/=2;o/=2;n/=2;g/=2}q=b.detectVerticalSquash(t,e);if(e&&q!==1){o*=q;i=Math.ceil(m*i/n);k=Math.ceil(m*k/g/q);r=0;j=0;while(j<g){s=0;l=0;while(l<n){c.clearRect(0,0,m,m);c.drawImage(t,p,o,n,g,-l,-j,n,g);f.drawImage(d,0,0,m,m,s,r,i,k);l+=m;s+=i}j+=m;r+=k}f.restore();return h}}return a(h,t,p,o,n,g,s,r,i,k)}}));