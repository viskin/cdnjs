(function(g){var e=false;var k=200;var c=(location.hash==="#debug");function o(q){if(c){console.log(q)}}var l=["Days","Hours","Minutes","Seconds"];var h={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var i={Seconds:1,Minutes:60,Hours:3600,Days:86400,Months:2678400,Years:31536000};function f(s){var r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;s=s.replace(r,function(u,w,v,t){return w+w+v+v+t+t});var q=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return q?{r:parseInt(q[1],16),g:parseInt(q[2],16),b:parseInt(q[3],16)}:null}function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function m(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function p(v){var r=v.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(r!==null&&r.length>0){var t=v.split(" ");var q=t[0].split("-");var s=t[1].split(":");return new Date(q[0],q[1]-1,q[2],s[0],s[1],s[2])}var u=Date.parse(v);if(!isNaN(u)){return u}u=Date.parse(v.replace(/-/g,"/").replace("T"," "));if(!isNaN(u)){return u}return new Date()}function d(E,G,B,x,w){var z={};var y={};var r={};var F={};var A={};var v={};var t=null;for(var u in x){var D=x[u];var s;if(t===null){s=B/i[D]}else{s=i[t]/i[D]}var q=(E/i[D]);var C=(G/i[D]);if(w){q=Math.floor(q)}if(w){C=Math.floor(C)}if(D!=="Days"){q=q%s;C=C%s}z[D]=q;r[D]=Math.abs(q);y[D]=C;v[D]=Math.abs(C);F[D]=Math.abs(q)/s;A[D]=Math.abs(C)/s;t=D}return{raw_time:z,raw_old_time:y,time:r,old_time:v,pct:F,old_pct:A}}var a={};if(window!==window.top&&typeof window.top.TC_Instance_List!=="undefined"){a=window.top.TC_Instance_List}else{window.top.TC_Instance_List=a}(function(){var r=["webkit","moz"];for(var q=0;q<r.length&&!window.top.requestAnimationFrame;++q){window.top.requestAnimationFrame=window.top[r[q]+"RequestAnimationFrame"];window.top.cancelAnimationFrame=window.top[r[q]+"CancelAnimationFrame"]}if(!window.top.requestAnimationFrame||!window.top.cancelAnimationFrame){window.top.requestAnimationFrame=function(x,u,s){if(typeof s==="undefined"){s={data:{last_frame:0}}}var t=new Date().getTime();var v=Math.max(0,16-(t-s.data.last_frame));var w=window.top.setTimeout(function(){x(t+v)},v);s.data.last_frame=t+v;return w};window.top.cancelAnimationFrame=function(s){clearTimeout(s)}}})();var b=function(r,q){this.element=r;this.container;this.listeners=null;this.data={paused:false,last_frame:0,animation_frame:null,timer:false,total_duration:null,prev_time:null,drawn_units:[],text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.config=null;this.setOptions(q);this.initialize()};b.prototype.initialize=function(w){this.data.drawn_units=[];for(var x in this.config.time){if(this.config.time[x].show){this.data.drawn_units.push(x)}}g(this.element).children("div.time_circles").remove();if(typeof w==="undefined"){w=true}if(w||this.listeners===null){this.listeners={all:[],visible:[]}}this.container=g("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);this.data.attributes.canvas=g("<canvas>");try{this.data.attributes.context=this.data.attributes.canvas[0].getContext("2d")}catch(v){e=true}var z=this.element.offsetHeight;var q=this.element.offsetWidth;if(z===0){z=g(this.element).height()}if(q===0){q=g(this.element).width()}if(z===0&&q>0){z=q/this.data.drawn_units.length}else{if(q===0&&z>0){q=z*this.data.drawn_units.length}}this.data.attributes.canvas[0].height=z;this.data.attributes.canvas[0].width=q;this.data.attributes.canvas.appendTo(this.container);this.data.attributes.item_size=Math.min(this.data.attributes.canvas[0].width/this.data.drawn_units.length,this.data.attributes.canvas[0].height);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var t=0;for(var y in this.data.text_elements){if(!this.config.time[y].show){continue}var r=g("<div>");r.addClass("textDiv_"+y);r.css("top",Math.round(0.35*this.data.attributes.item_size));r.css("left",Math.round(t++*this.data.attributes.item_size));r.css("width",this.data.attributes.item_size);r.appendTo(this.container);var u=g("<h4>");u.text(this.config.time[y].text);u.css("font-size",Math.round(0.07*this.data.attributes.item_size));u.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");u.appendTo(r);var s=g("<span>");s.css("font-size",Math.round(0.21*this.data.attributes.item_size));s.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");s.appendTo(r);this.data.text_elements[y]=s}if(this.config.start&&this.data.paused===false){this.start()}};b.prototype.update=function(){var w,F;var G=this.data.prev_time;var I=new Date();this.data.prev_time=I;if(G===null){G=I}if(!this.config.count_past_zero){if(I>this.data.attributes.ref_date){for(var D in this.data.drawn_units){var J=this.data.drawn_units[D];this.data.text_elements[J].text("0");var v=(D*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var u=this.data.attributes.item_size/2;var A=this.config.time[J].color;this.drawArc(v,u,A,0)}this.stop();return}}w=(this.data.attributes.ref_date-I)/1000;F=(this.data.attributes.ref_date-G)/1000;var E=this.config.animation!=="smooth";var q=d(w,F,this.data.total_duration,this.data.drawn_units,E);var r=d(w,F,i.Years,l,E);var D=0;var B=0;var t=null;var C=this.data.drawn_units.slice();for(var D in l){var J=l[D];if(Math.floor(r.raw_time[J])!==Math.floor(r.raw_old_time[J])){this.notifyListeners(J,Math.floor(r.time[J]),Math.floor(w),"all")}if(C.indexOf(J)<0){continue}if(Math.floor(q.raw_time[J])!==Math.floor(q.raw_old_time[J])){this.notifyListeners(J,Math.floor(q.time[J]),Math.floor(w),"visible")}this.data.text_elements[J].text(Math.floor(Math.abs(q.time[J])));var v=(B*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var u=this.data.attributes.item_size/2;var A=this.config.time[J].color;if(this.config.animation==="smooth"){if(t!==null){if(Math.floor(q.time[t])>Math.floor(q.old_time[t])){this.radialFade(v,u,A,1,J);this.data.state.fading[J]=true}else{if(Math.floor(q.time[t])<Math.floor(q.old_time[t])){this.radialFade(v,u,A,0,J);this.data.state.fading[J]=true}}}if(!this.data.state.fading[J]){this.drawArc(v,u,A,q.pct[J])}}else{this.animateArc(v,u,A,q.pct[J],q.old_pct[J],(new Date()).getTime()+k)}t=J;B++}var z=this;var s=function(){z.update.call(z)};if(this.config.animation==="smooth"){this.data.animation_frame=window.top.requestAnimationFrame(s,z.element,z)}else{var H=(w%1)*1000;if(H<0){H=1000+H}H+=50;z.data.animation_frame=window.top.setTimeout(function(){z.data.animation_frame=window.top.requestAnimationFrame(s,z.element,z)},H)}};b.prototype.animateArc=function(z,v,s,r,w,u){if(e){return}var A=w-r;if(Math.abs(A)>0.5){if(r===0){this.radialFade(z,v,s,1)}else{this.radialFade(z,v,s,0)}}else{var q=(k-(u-(new Date()).getTime()))/k;if(q>1){q=1}var B=(w*(1-q))+(r*q);this.drawArc(z,v,s,B);if(q>=1){return}var t=this;window.top.requestAnimationFrame(function(){t.animateArc(z,v,s,r,w,u)},this.element,null)}};b.prototype.drawArc=function(z,w,r,A){if(e){return}var u=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);this.data.attributes.context.clearRect(z-u,w-u,u*2,u*2);if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(z,w,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var v,q,B;var t=(-0.5*Math.PI);var C=2*Math.PI;v=t+(this.config.start_angle/360*C);var s=(2*A*Math.PI);if(this.config.direction==="Both"){B=false;v-=(s/2);q=v+s}else{if(this.config.direction==="Clockwise"){B=false;q=v+s}else{B=true;q=v-s}}this.data.attributes.context.beginPath();this.data.attributes.context.arc(z,w,this.data.attributes.radius,v,q,B);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=r;this.data.attributes.context.stroke()};b.prototype.radialFade=function(w,v,r,z,A){var u=f(r);var t=this;var q=0.2*((z===1)?-1:1);var s;for(s=0;z<=1&&z>=0;s++){(function(){var x=50*s;var y="rgba("+u.r+", "+u.g+", "+u.b+", "+(Math.round(z*10)/10)+")";window.top.setTimeout(function(){t.drawArc(w,v,y,1)},x)}());z+=q}if(typeof A!==undefined){window.top.setTimeout(function(){t.data.state.fading[A]=false},50*s)}};b.prototype.timeLeft=function(){var q=new Date();return((this.data.attributes.ref_date-q)/1000)};b.prototype.start=function(){window.top.cancelAnimationFrame(this.data.animation_frame);window.top.clearTimeout(this.data.animation_frame);var r=g(this.element).data("date");if(typeof r==="undefined"){r=g(this.element).attr("data-date")}if(typeof r==="string"){this.data.attributes.ref_date=p(r)}else{if(typeof this.data.timer==="number"){if(this.data.paused){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.timer*1000)}}else{var q=g(this.element).data("timer");if(typeof q==="undefined"){q=g(this.element).attr("data-timer")}if(typeof q==="string"){q=parseFloat(q)}if(typeof q==="number"){this.data.timer=q;this.data.attributes.ref_date=(new Date()).getTime()+(q*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}}this.data.paused=false;this.update()};b.prototype.restart=function(){this.data.timer=false;this.start()};b.prototype.stop=function(){if(typeof this.data.timer==="number"){this.data.timer=this.timeLeft(this)}this.data.paused=true;window.top.cancelAnimationFrame(this.data.animation_frame)};b.prototype.destroy=function(){this.stop();this.container.remove();g(this.element).removeAttr("data-tc-id");g(this.element).removeData("tc-id")};b.prototype.setOptions=function(q){if(this.config===null){this.default_options.ref_date=new Date();this.config=g.extend(true,{},this.default_options)}g.extend(true,this.config,q);this.data.total_duration=this.config.total_duration;if(typeof this.data.total_duration==="string"){if(typeof i[this.data.total_duration]!=="undefined"){this.data.total_duration=i[this.data.total_duration]}else{if(this.data.total_duration==="Auto"){for(var r in this.config.time){if(this.config.time[r].show){this.data.total_duration=i[h[r]];break}}}else{this.data.total_duration=i.Years;console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto")}}}};b.prototype.addListener=function(s,q,r){if(typeof s!=="function"){return}if(typeof r==="undefined"){r="visible"}this.listeners[r].push({func:s,scope:q})};b.prototype.notifyListeners=function(t,v,s,r){for(var q=0;q<this.listeners[r].length;q++){var u=this.listeners[r][q];u.func.apply(u.scope,[t,v,s])}};b.prototype.default_options={ref_date:new Date(),start:true,animation:"smooth",count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,total_duration:"Auto",direction:"Clockwise",start_angle:0,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var j=function(r,q){this.elements=r;this.options=q;this.foreach()};j.prototype.getInstance=function(t){var q;var s=g(t).data("tc-id");if(typeof s==="undefined"){s=m();g(t).attr("data-tc-id",s)}if(typeof a[s]==="undefined"){var r=this.options;var u=g(t).data("options");if(typeof u==="string"){u=JSON.parse(u)}if(typeof u==="object"){r=g.extend(true,{},this.options,u)}q=new b(t,r);a[s]=q}else{q=a[s];if(typeof this.options!=="undefined"){q.setOptions(this.options)}}return q};j.prototype.foreach=function(r){var q=this;this.elements.each(function(){var s=q.getInstance(this);if(typeof r==="function"){r(s)}});return this};j.prototype.start=function(){this.foreach(function(q){q.start()});return this};j.prototype.stop=function(){this.foreach(function(q){q.stop()});return this};j.prototype.restart=function(){this.foreach(function(q){q.restart()});return this};j.prototype.rebuild=function(){this.foreach(function(q){q.initialize(false)});return this};j.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()};j.prototype.addListener=function(r,q){if(typeof q==="undefined"){q="visible"}var s=this;this.foreach(function(t){t.addListener(r,s.elements,q)});return this};j.prototype.destroy=function(){this.foreach(function(q){q.destroy()});return this};j.prototype.end=function(){return this.elements};g.fn.TimeCircles=function(q){return new j(this,q)}}(jQuery));