(function(f){var c=(location.hash==="#debug");function l(o){if(c){console.log(o)}}var j=["Days","Hours","Minutes","Seconds"];var g={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var h={Seconds:1,Minutes:60,Hours:3600,Days:86400,Years:31536000};function e(q){var p=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;q=q.replace(p,function(t,v,u,s){return v+v+u+u+s+s});var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(q);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function m(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function k(){return m()+m()+"-"+m()+"-"+m()+"-"+m()+"-"+m()+m()+m()}function n(t){var p=t.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(p!==null&&p.length>0){var r=t.split(" ");var o=r[0].split("-");var q=r[1].split(":");return new Date(o[0],o[1]-1,o[2],q[0],q[1],q[2])}var s=Date.parse(t);if(!isNaN(s)){return s}s=Date.parse(t.replace(/-/g,"/").replace("T"," "));if(!isNaN(s)){return s}return new Date()}function d(A,C,p,v){var x={};var w={};var q={};var B={};var u={};var s=null;for(var t in v){var z=v[t];if(s===null){s=p}var r=h[s]/h[z];var o=(A/h[z]);var y=(C/h[z]);if(z!=="Days"){o=o%r;y=y%r}x[z]=o;q[z]=Math.abs(o);w[z]=y;u[z]=Math.abs(y);B[z]=Math.abs(o)/r;s=z}return{raw_time:x,raw_old_time:w,time:q,old_time:u,pct:B}}var a={};if(window!==window.top&&typeof window.top.TC_Instance_List!=="undefined"){a=window.top.TC_Instance_List}else{window.top.TC_Instance_List=a}var b=function(p,o){this.element=p;this.container;this.timer=null;this.data={prev_time:null,drawn_units:[],super_unit:null,text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.config=null;this.setOptions(o);this.initialize()};b.prototype.initialize=function(){this.data.super_unit=null;this.data.drawn_units=[];for(var v in this.config.time){if(this.config.time[v].show){this.data.drawn_units.push(v);if(this.data.super_unit===null){this.data.super_unit=g[v]}}}f(this.element).children("div.time_circles").remove();this.listeners={all:[],visible:[]};this.container=f("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);this.data.attributes.canvas=f("<canvas>");this.data.attributes.context=this.data.attributes.canvas[0].getContext("2d");var o=this.element.offsetHeight;var u=this.element.offsetWidth;if(o===0){o=f(this.element).height()}if(u===0){u=f(this.element).width()}if(o===0&&u>0){o=u/this.data.drawn_units.length}else{if(u===0&&o>0){u=o*this.data.drawn_units.length}}this.data.attributes.canvas[0].height=o;this.data.attributes.canvas[0].width=u;this.data.attributes.canvas.appendTo(this.container);this.data.attributes.item_size=Math.min(this.data.attributes.canvas[0].width/this.data.drawn_units.length,this.data.attributes.canvas[0].height);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var t=0;for(var s in this.data.text_elements){if(!this.config.time[s].show){continue}var q=f("<div>");q.addClass("textDiv_"+s);q.css("top",Math.round(0.35*this.data.attributes.item_size));q.css("left",Math.round(t++*this.data.attributes.item_size));q.css("width",this.data.attributes.item_size);q.appendTo(this.container);var p=f("<h4>");p.text(this.config.time[s].text);p.css("font-size",Math.round(0.07*this.data.attributes.item_size));p.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");p.appendTo(q);var r=f("<span>");r.css("font-size",Math.round(0.21*this.data.attributes.item_size));r.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");r.appendTo(q);this.data.text_elements[s]=r}if(this.config.start&&this.timer===null){this.start()}};b.prototype.updateArc=function(){var A,D;var o=this.data.prev_time;var r=new Date();this.data.prev_time=r;if(o===null){o=r}if(!this.config.count_past_zero){if(r>this.data.attributes.ref_date){for(var u in this.data.drawn_units){var C=this.data.drawn_units[u];this.data.text_elements[C].text(Math.floor(time[C]));var z=(u*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var w=this.data.attributes.item_size/2;var s=this.config.time[C].color;this.drawArc(z,w,s,0)}this.stop();return}}A=(this.data.attributes.ref_date-r)/1000;D=(this.data.attributes.ref_date-o)/1000;var p=d(A,D,this.data.super_unit,this.data.drawn_units);var q=d(A,D,"Years",j);var u=0;var t=0;var B=null;var v=this.data.drawn_units.slice();for(var u in j){var C=j[u];if(Math.floor(q.raw_time[C])!==Math.floor(q.raw_old_time[C])){this.notifyListeners(C,Math.floor(q.time[C]),Math.floor(A),"all")}if(v.indexOf(C)<0){continue}if(Math.floor(p.raw_time[C])!==Math.floor(p.raw_old_time[C])){this.notifyListeners(C,Math.floor(p.time[C]),Math.floor(A),"visible")}this.data.text_elements[C].text(Math.floor(Math.abs(p.time[C])));var z=(t*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var w=this.data.attributes.item_size/2;var s=this.config.time[C].color;if(B!==null){if(Math.floor(p.time[B])>Math.floor(p.old_time[B])){this.radialFade(z,w,s,1,C);this.data.state.fading[C]=true}else{if(Math.floor(p.time[B])<Math.floor(p.old_time[B])){this.radialFade(z,w,s,0,C);this.data.state.fading[C]=true}}}if(!this.data.state.fading[C]){this.drawArc(z,w,s,p.pct[C])}B=C;t++}};b.prototype.drawArc=function(o,v,q,t){var u=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);this.data.attributes.context.clearRect(o-u,v-u,u*2,u*2);if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(o,v,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var s=(-0.5*Math.PI);var p=(-0.5*Math.PI)+(2*t*Math.PI);var r=false;this.data.attributes.context.beginPath();this.data.attributes.context.arc(o,v,this.data.attributes.radius,s,p,r);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=q;this.data.attributes.context.stroke()};b.prototype.radialFade=function(u,t,p,v,w){var s=e(p);var r=this;var o=0.2*((v===1)?-1:1);var q;for(q=0;v<=1&&v>=0;q++){(function(){var x="rgba("+s.r+", "+s.g+", "+s.b+", "+(Math.round(v*10)/10)+")";window.top.setTimeout(function(){r.drawArc(u,t,x,1)},50*q)}());v+=o}window.top.setTimeout(function(){r.data.state.fading[w]=false},50*q)};b.prototype.timeLeft=function(){var o=new Date();return((this.data.attributes.ref_date-o)/1000)};b.prototype.start=function(){var p=f(this.element).data("date");if(typeof p==="undefined"){p=f(this.element).attr("data-date")}if(typeof p==="string"){this.data.attributes.ref_date=n(p)}else{if(typeof this.data.attributes.timer==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.attributes.timer*1000)}else{var o=f(this.element).data("timer");if(typeof o==="undefined"){o=f(this.element).attr("data-timer")}if(typeof o==="string"){o=parseFloat(o)}if(typeof o==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(o*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}}var q=this;this.timer=window.top.setInterval(function(){q.updateArc()},this.config.refresh_interval*1000)};b.prototype.restart=function(){this.data.attributes.timer=null;this.start()};b.prototype.stop=function(){if(typeof this.data.attributes.timer==="number"){this.data.attributes.timer=this.timeLeft(this)}window.top.clearInterval(this.timer)};b.prototype.destroy=function(){this.stop();this.container.remove();f(this.element).removeData("tc-id")};b.prototype.setOptions=function(o){if(this.config===null){this.default_options.ref_date=new Date();this.config=f.extend(true,{},this.default_options)}f.extend(true,this.config,o)};b.prototype.addListener=function(q,o,p){if(typeof q!=="function"){return}if(typeof p==="undefined"){p="visible"}this.listeners[p].push({func:q,scope:o})};b.prototype.notifyListeners=function(r,t,q,p){for(var o=0;o<this.listeners[p].length;o++){var s=this.listeners[p][o];s.func.apply(s.scope,[r,t,q])}};b.prototype.default_options={ref_date:new Date(),start:true,refresh_interval:0.1,count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var i=function(p,o){this.elements=p;this.options=o;this.foreach()};i.prototype.getInstance=function(r){var o;var q=f(r).data("tc-id");if(typeof q==="undefined"){q=k();f(r).attr("data-tc-id",q)}if(typeof a[q]==="undefined"){var s=f(r).data("options");var p=this.options;if(typeof s==="object"){p=f.extend(true,{},this.options,s)}o=new b(r,p);a[q]=o}else{o=a[q];if(typeof this.options!=="undefined"){o.setOptions(this.options)}}return o};i.prototype.foreach=function(p){var o=this;this.elements.each(function(){var q=o.getInstance(this);if(typeof p==="function"){p(q)}});return this};i.prototype.start=function(){this.foreach(function(o){o.start()});return this};i.prototype.stop=function(){this.foreach(function(o){o.stop()});return this};i.prototype.restart=function(){this.foreach(function(o){o.restart()});return this};i.prototype.rebuild=function(){this.foreach(function(o){o.initialize()});return this};i.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()};i.prototype.addListener=function(p,o){if(typeof o==="undefined"){o="visible"}var q=this;this.foreach(function(r){r.addListener(p,q.elements,o)});return this};i.prototype.destroy=function(){this.foreach(function(o){o.destroy()});return this};i.prototype.end=function(){return this.elements};f.fn.TimeCircles=function(o){return new i(this,o)}}(jQuery));