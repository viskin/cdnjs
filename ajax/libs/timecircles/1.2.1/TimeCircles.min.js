(function(g){var e=false;var c=(location.hash==="#debug");function n(p){if(c){console.log(p)}}var k=["Days","Hours","Minutes","Seconds"];var h={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var i={Seconds:1,Minutes:60,Hours:3600,Days:86400,Months:2678400,Years:31536000};function f(r){var q=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;r=r.replace(q,function(t,v,u,s){return v+v+u+u+s+s});var p=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return p?{r:parseInt(p[1],16),g:parseInt(p[2],16),b:parseInt(p[3],16)}:null}function m(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function l(){return m()+m()+"-"+m()+"-"+m()+"-"+m()+"-"+m()+m()+m()}function o(u){var q=u.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(q!==null&&q.length>0){var s=u.split(" ");var p=s[0].split("-");var r=s[1].split(":");return new Date(p[0],p[1]-1,p[2],r[0],r[1],r[2])}var t=Date.parse(u);if(!isNaN(t)){return t}t=Date.parse(u.replace(/-/g,"/").replace("T"," "));if(!isNaN(t)){return t}return new Date()}function d(B,D,y,v){var x={};var w={};var q={};var C={};var u={};var s=null;for(var t in v){var A=v[t];var r;if(s===null){r=y/i[A]}else{r=i[s]/i[A]}var p=(B/i[A]);var z=(D/i[A]);if(A!=="Days"){p=p%r;z=z%r}x[A]=p;q[A]=Math.abs(p);w[A]=z;u[A]=Math.abs(z);C[A]=Math.abs(p)/r;s=A}return{raw_time:x,raw_old_time:w,time:q,old_time:u,pct:C}}var a={};if(window!==window.top&&typeof window.top.TC_Instance_List!=="undefined"){a=window.top.TC_Instance_List}else{window.top.TC_Instance_List=a}var b=function(q,p){this.element=q;this.container;this.timer=null;this.listeners=null;this.data={total_duration:null,prev_time:null,drawn_units:[],text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.config=null;this.setOptions(p);this.initialize()};b.prototype.initialize=function(v){this.data.drawn_units=[];for(var w in this.config.time){if(this.config.time[w].show){this.data.drawn_units.push(w)}}g(this.element).children("div.time_circles").remove();if(typeof v==="undefined"){v=true}if(v||this.listeners===null){this.listeners={all:[],visible:[]}}this.container=g("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);this.data.attributes.canvas=g("<canvas>");try{this.data.attributes.context=this.data.attributes.canvas[0].getContext("2d")}catch(u){e=true}var y=this.element.offsetHeight;var p=this.element.offsetWidth;if(y===0){y=g(this.element).height()}if(p===0){p=g(this.element).width()}if(y===0&&p>0){y=p/this.data.drawn_units.length}else{if(p===0&&y>0){p=y*this.data.drawn_units.length}}this.data.attributes.canvas[0].height=y;this.data.attributes.canvas[0].width=p;this.data.attributes.canvas.appendTo(this.container);this.data.attributes.item_size=Math.min(this.data.attributes.canvas[0].width/this.data.drawn_units.length,this.data.attributes.canvas[0].height);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var s=0;for(var x in this.data.text_elements){if(!this.config.time[x].show){continue}var q=g("<div>");q.addClass("textDiv_"+x);q.css("top",Math.round(0.35*this.data.attributes.item_size));q.css("left",Math.round(s++*this.data.attributes.item_size));q.css("width",this.data.attributes.item_size);q.appendTo(this.container);var t=g("<h4>");t.text(this.config.time[x].text);t.css("font-size",Math.round(0.07*this.data.attributes.item_size));t.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");t.appendTo(q);var r=g("<span>");r.css("font-size",Math.round(0.21*this.data.attributes.item_size));r.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");r.appendTo(q);this.data.text_elements[x]=r}if(this.config.start&&this.timer===null){this.start()}};b.prototype.updateArc=function(){var B,E;var p=this.data.prev_time;var s=new Date();this.data.prev_time=s;if(p===null){p=s}if(!this.config.count_past_zero){if(s>this.data.attributes.ref_date){for(var v in this.data.drawn_units){var D=this.data.drawn_units[v];this.data.text_elements[D].text("0");var A=(v*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var z=this.data.attributes.item_size/2;var t=this.config.time[D].color;this.drawArc(A,z,t,0)}this.stop();return}}B=(this.data.attributes.ref_date-s)/1000;E=(this.data.attributes.ref_date-p)/1000;var q=d(B,E,this.data.total_duration,this.data.drawn_units);var r=d(B,E,i.Years,k);var v=0;var u=0;var C=null;var w=this.data.drawn_units.slice();for(var v in k){var D=k[v];if(Math.floor(r.raw_time[D])!==Math.floor(r.raw_old_time[D])){this.notifyListeners(D,Math.floor(r.time[D]),Math.floor(B),"all")}if(w.indexOf(D)<0){continue}if(Math.floor(q.raw_time[D])!==Math.floor(q.raw_old_time[D])){this.notifyListeners(D,Math.floor(q.time[D]),Math.floor(B),"visible")}this.data.text_elements[D].text(Math.floor(Math.abs(q.time[D])));var A=(u*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var z=this.data.attributes.item_size/2;var t=this.config.time[D].color;if(C!==null){if(Math.floor(q.time[C])>Math.floor(q.old_time[C])){this.radialFade(A,z,t,1,D);this.data.state.fading[D]=true}else{if(Math.floor(q.time[C])<Math.floor(q.old_time[C])){this.radialFade(A,z,t,0,D);this.data.state.fading[D]=true}}}if(!this.data.state.fading[D]){this.drawArc(A,z,t,q.pct[D])}C=D;u++}};b.prototype.drawArc=function(w,v,q,z){if(e){return}var t=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);this.data.attributes.context.clearRect(w-t,v-t,t*2,t*2);if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(w,v,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var u,p,A;var s=(-0.5*Math.PI);var B=2*Math.PI;u=s+(this.config.start_angle/360*B);var r=(2*z*Math.PI);if(this.config.direction==="Both"){A=false;u-=(r/2);p=u+r}else{if(this.config.direction==="Clockwise"){A=false;p=u+r}else{A=true;p=u-r}}u=(u+B)%B;p=(p+B)%B;this.data.attributes.context.beginPath();this.data.attributes.context.arc(w,v,this.data.attributes.radius,u,p,A);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=q;this.data.attributes.context.stroke()};b.prototype.radialFade=function(v,u,q,w,z){var t=f(q);var s=this;var p=0.2*((w===1)?-1:1);var r;for(r=0;w<=1&&w>=0;r++){(function(){var x="rgba("+t.r+", "+t.g+", "+t.b+", "+(Math.round(w*10)/10)+")";window.top.setTimeout(function(){s.drawArc(v,u,x,1)},50*r)}());w+=p}window.top.setTimeout(function(){s.data.state.fading[z]=false},50*r)};b.prototype.timeLeft=function(){var p=new Date();return((this.data.attributes.ref_date-p)/1000)};b.prototype.start=function(){var q=g(this.element).data("date");if(typeof q==="undefined"){q=g(this.element).attr("data-date")}if(typeof q==="string"){this.data.attributes.ref_date=o(q)}else{if(typeof this.data.attributes.timer==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.attributes.timer*1000)}else{var p=g(this.element).data("timer");if(typeof p==="undefined"){p=g(this.element).attr("data-timer")}if(typeof p==="string"){p=parseFloat(p)}if(typeof p==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(p*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}}var r=this;this.timer=window.top.setInterval(function(){r.updateArc()},this.config.refresh_interval*1000)};b.prototype.restart=function(){this.data.attributes.timer=null;this.start()};b.prototype.stop=function(){if(typeof this.data.attributes.timer==="number"){this.data.attributes.timer=this.timeLeft(this)}window.top.clearInterval(this.timer)};b.prototype.destroy=function(){this.stop();this.container.remove();g(this.element).removeAttr("data-tc-id");g(this.element).removeData("tc-id")};b.prototype.setOptions=function(p){if(this.config===null){this.default_options.ref_date=new Date();this.config=g.extend(true,{},this.default_options)}g.extend(true,this.config,p);this.data.total_duration=this.config.total_duration;if(typeof this.data.total_duration==="string"){if(typeof i[this.data.total_duration]!=="undefined"){this.data.total_duration=i[this.data.total_duration]}else{if(this.data.total_duration==="Auto"){for(var q in this.config.time){if(this.config.time[q].show){this.data.total_duration=i[h[q]];break}}}else{this.data.total_duration=i.Years;console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto")}}}};b.prototype.addListener=function(r,p,q){if(typeof r!=="function"){return}if(typeof q==="undefined"){q="visible"}this.listeners[q].push({func:r,scope:p})};b.prototype.notifyListeners=function(s,u,r,q){for(var p=0;p<this.listeners[q].length;p++){var t=this.listeners[q][p];t.func.apply(t.scope,[s,u,r])}};b.prototype.default_options={ref_date:new Date(),start:true,refresh_interval:0.1,count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,total_duration:"Auto",direction:"Clockwise",start_angle:0,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var j=function(q,p){this.elements=q;this.options=p;this.foreach()};j.prototype.getInstance=function(s){var p;var r=g(s).data("tc-id");if(typeof r==="undefined"){r=l();g(s).attr("data-tc-id",r)}if(typeof a[r]==="undefined"){var q=this.options;var t=g(s).data("options");if(typeof t==="string"){t=JSON.parse(t)}if(typeof t==="object"){q=g.extend(true,{},this.options,t)}p=new b(s,q);a[r]=p}else{p=a[r];if(typeof this.options!=="undefined"){p.setOptions(this.options)}}return p};j.prototype.foreach=function(q){var p=this;this.elements.each(function(){var r=p.getInstance(this);if(typeof q==="function"){q(r)}});return this};j.prototype.start=function(){this.foreach(function(p){p.start()});return this};j.prototype.stop=function(){this.foreach(function(p){p.stop()});return this};j.prototype.restart=function(){this.foreach(function(p){p.restart()});return this};j.prototype.rebuild=function(){this.foreach(function(p){p.initialize(false)});return this};j.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()};j.prototype.addListener=function(q,p){if(typeof p==="undefined"){p="visible"}var r=this;this.foreach(function(s){s.addListener(q,r.elements,p)});return this};j.prototype.destroy=function(){this.foreach(function(p){p.destroy()});return this};j.prototype.end=function(){return this.elements};g.fn.TimeCircles=function(p){return new j(this,p)}}(jQuery));