(function(g){var e=false;var k=200;var c=(location.hash==="#debug");function o(r){if(c){console.log(r)}}var l=["Days","Hours","Minutes","Seconds"];var h={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var i={Seconds:1,Minutes:60,Hours:3600,Days:86400,Months:2678400,Years:31536000};function f(t){var s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(s,function(v,x,w,u){return x+x+w+w+u+u});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null}function q(){var r=document.createElement("canvas");return !!(r.getContext&&r.getContext("2d"))}function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function m(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(s){var r=this.length>>>0;var t=Number(arguments[1])||0;t=(t<0)?Math.ceil(t):Math.floor(t);if(t<0){t+=r}for(;t<r;t++){if(t in this&&this[t]===s){return t}}return -1}}function p(w){var s=w.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(s!==null&&s.length>0){var u=w.split(" ");var r=u[0].split("-");var t=u[1].split(":");return new Date(r[0],r[1]-1,r[2],t[0],t[1],t[2])}var v=Date.parse(w);if(!isNaN(v)){return v}v=Date.parse(w.replace(/-/g,"/").replace("T"," "));if(!isNaN(v)){return v}return new Date()}function d(F,H,C,y,x){var A={};var z={};var s={};var G={};var B={};var w={};var u=null;for(var v in y){var E=y[v];var t;if(u===null){t=C/i[E]}else{t=i[u]/i[E]}var r=(F/i[E]);var D=(H/i[E]);if(x){r=Math.floor(r)}if(x){D=Math.floor(D)}if(E!=="Days"){r=r%t;D=D%t}A[E]=r;s[E]=Math.abs(r);z[E]=D;w[E]=Math.abs(D);G[E]=Math.abs(r)/t;B[E]=Math.abs(D)/t;u=E}return{raw_time:A,raw_old_time:z,time:s,old_time:w,pct:G,old_pct:B}}var a={};if(window!==window.top&&typeof window.top.TC_Instance_List!=="undefined"){a=window.top.TC_Instance_List}else{window.top.TC_Instance_List=a}(function(){var s=["webkit","moz"];for(var r=0;r<s.length&&!window.top.requestAnimationFrame;++r){window.top.requestAnimationFrame=window.top[s[r]+"RequestAnimationFrame"];window.top.cancelAnimationFrame=window.top[s[r]+"CancelAnimationFrame"]}if(!window.top.requestAnimationFrame||!window.top.cancelAnimationFrame){window.top.requestAnimationFrame=function(y,v,t){if(typeof t==="undefined"){t={data:{last_frame:0}}}var u=new Date().getTime();var w=Math.max(0,16-(u-t.data.last_frame));var x=window.top.setTimeout(function(){y(u+w)},w);t.data.last_frame=u+w;return x};window.top.cancelAnimationFrame=function(t){clearTimeout(t)}}})();var b=function(s,r){this.element=s;this.container;this.listeners=null;this.data={paused:false,last_frame:0,animation_frame:null,timer:false,total_duration:null,prev_time:null,drawn_units:[],text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.config=null;this.setOptions(r);this.initialize()};b.prototype.initialize=function(x){this.data.drawn_units=[];for(var z in this.config.time){if(this.config.time[z].show){this.data.drawn_units.push(z)}}g(this.element).children("div.time_circles").remove();if(typeof x==="undefined"){x=true}if(x||this.listeners===null){this.listeners={all:[],visible:[]}}this.container=g("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);var B=this.element.offsetHeight;var s=this.element.offsetWidth;if(B===0){B=g(this.element).height()}if(s===0){s=g(this.element).width()}if(B===0&&s>0){B=s/this.data.drawn_units.length}else{if(s===0&&B>0){s=B*this.data.drawn_units.length}}var y=document.createElement("canvas");y.width=s;y.height=B;this.data.attributes.canvas=g(y);this.data.attributes.canvas.appendTo(this.container);var w=q();if(!w&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(y);e=true;w=true}if(w){this.data.attributes.context=y.getContext("2d")}this.data.attributes.item_size=Math.min(s/this.data.drawn_units.length,B);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var u=0;for(var A in this.data.text_elements){if(!this.config.time[A].show){continue}var r=g("<div>");r.addClass("textDiv_"+A);r.css("top",Math.round(0.35*this.data.attributes.item_size));r.css("left",Math.round(u++*this.data.attributes.item_size));r.css("width",this.data.attributes.item_size);r.appendTo(this.container);var v=g("<h4>");v.text(this.config.time[A].text);v.css("font-size",Math.round(0.07*this.data.attributes.item_size));v.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");v.appendTo(r);var t=g("<span>");t.css("font-size",Math.round(0.21*this.data.attributes.item_size));t.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");t.appendTo(r);this.data.text_elements[A]=t}if(this.config.start&&this.data.paused===false){this.start()}};b.prototype.update=function(){if(e){this.data.attributes.context.clearRect(0,0,this.data.attributes.canvas[0].width,this.data.attributes.canvas[0].hright)}var z,G;var H=this.data.prev_time;var J=new Date();this.data.prev_time=J;if(H===null){H=J}if(!this.config.count_past_zero){if(J>this.data.attributes.ref_date){for(var E in this.data.drawn_units){var K=this.data.drawn_units[E];this.data.text_elements[K].text("0");var w=(E*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var v=this.data.attributes.item_size/2;var B=this.config.time[K].color;this.drawArc(w,v,B,0)}this.stop();return}}z=(this.data.attributes.ref_date-J)/1000;G=(this.data.attributes.ref_date-H)/1000;var F=this.config.animation!=="smooth";var r=d(z,G,this.data.total_duration,this.data.drawn_units,F);var s=d(z,G,i.Years,l,F);var E=0;var C=0;var u=null;var D=this.data.drawn_units.slice();for(var E in l){var K=l[E];if(Math.floor(s.raw_time[K])!==Math.floor(s.raw_old_time[K])){this.notifyListeners(K,Math.floor(s.time[K]),Math.floor(z),"all")}if(D.indexOf(K)<0){continue}if(Math.floor(r.raw_time[K])!==Math.floor(r.raw_old_time[K])){this.notifyListeners(K,Math.floor(r.time[K]),Math.floor(z),"visible")}this.data.text_elements[K].text(Math.floor(Math.abs(r.time[K])));var w=(C*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var v=this.data.attributes.item_size/2;var B=this.config.time[K].color;if(this.config.animation==="smooth"){if(u!==null&&!e){if(Math.floor(r.time[u])>Math.floor(r.old_time[u])){this.radialFade(w,v,B,1,K);this.data.state.fading[K]=true}else{if(Math.floor(r.time[u])<Math.floor(r.old_time[u])){this.radialFade(w,v,B,0,K);this.data.state.fading[K]=true}}}if(!this.data.state.fading[K]){this.drawArc(w,v,B,r.pct[K])}}else{this.animateArc(w,v,B,r.pct[K],r.old_pct[K],(new Date()).getTime()+k)}u=K;C++}var A=this;var t=function(){A.update.call(A)};if(this.config.animation==="smooth"){this.data.animation_frame=window.top.requestAnimationFrame(t,A.element,A)}else{var I=(z%1)*1000;if(I<0){I=1000+I}I+=50;A.data.animation_frame=window.top.setTimeout(function(){A.data.animation_frame=window.top.requestAnimationFrame(t,A.element,A)},I)}};b.prototype.animateArc=function(A,w,t,s,z,v){if(this.data.attributes.context===null){return}var B=z-s;if(Math.abs(B)>0.5){if(s===0){this.radialFade(A,w,t,1)}else{this.radialFade(A,w,t,0)}}else{var r=(k-(v-(new Date()).getTime()))/k;if(r>1){r=1}var C=(z*(1-r))+(s*r);this.drawArc(A,w,t,C);if(r>=1){return}var u=this;window.top.requestAnimationFrame(function(){u.animateArc(A,w,t,s,z,v)},this.element)}};b.prototype.drawArc=function(A,z,s,B){if(this.data.attributes.context===null){return}var v=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);if(!e){this.data.attributes.context.clearRect(A-v,z-v,v*2,v*2)}if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(A,z,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var w,r,C;var u=(-0.5*Math.PI);var D=2*Math.PI;w=u+(this.config.start_angle/360*D);var t=(2*B*Math.PI);if(this.config.direction==="Both"){C=false;w-=(t/2);r=w+t}else{if(this.config.direction==="Clockwise"){C=false;r=w+t}else{C=true;r=w-t}}this.data.attributes.context.beginPath();this.data.attributes.context.arc(A,z,this.data.attributes.radius,w,r,C);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=s;this.data.attributes.context.stroke()};b.prototype.radialFade=function(z,w,s,A,B){var v=f(s);var u=this;var r=0.2*((A===1)?-1:1);var t;for(t=0;A<=1&&A>=0;t++){(function(){var x=50*t;var y="rgba("+v.r+", "+v.g+", "+v.b+", "+(Math.round(A*10)/10)+")";window.top.setTimeout(function(){u.drawArc(z,w,y,1)},x)}());A+=r}if(typeof B!==undefined){window.top.setTimeout(function(){u.data.state.fading[B]=false},50*t)}};b.prototype.timeLeft=function(){var r=new Date();return((this.data.attributes.ref_date-r)/1000)};b.prototype.start=function(){window.top.cancelAnimationFrame(this.data.animation_frame);window.top.clearTimeout(this.data.animation_frame);var s=g(this.element).data("date");if(typeof s==="undefined"){s=g(this.element).attr("data-date")}if(typeof s==="string"){this.data.attributes.ref_date=p(s)}else{if(typeof this.data.timer==="number"){if(this.data.paused){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.timer*1000)}}else{var r=g(this.element).data("timer");if(typeof r==="undefined"){r=g(this.element).attr("data-timer")}if(typeof r==="string"){r=parseFloat(r)}if(typeof r==="number"){this.data.timer=r;this.data.attributes.ref_date=(new Date()).getTime()+(r*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}}this.data.paused=false;this.update.call(this)};b.prototype.restart=function(){this.data.timer=false;this.start()};b.prototype.stop=function(){if(typeof this.data.timer==="number"){this.data.timer=this.timeLeft(this)}this.data.paused=true;window.top.cancelAnimationFrame(this.data.animation_frame)};b.prototype.destroy=function(){this.stop();this.container.remove();g(this.element).removeAttr("data-tc-id");g(this.element).removeData("tc-id")};b.prototype.setOptions=function(r){if(this.config===null){this.default_options.ref_date=new Date();this.config=g.extend(true,{},this.default_options)}g.extend(true,this.config,r);this.data.total_duration=this.config.total_duration;if(typeof this.data.total_duration==="string"){if(typeof i[this.data.total_duration]!=="undefined"){this.data.total_duration=i[this.data.total_duration]}else{if(this.data.total_duration==="Auto"){for(var s in this.config.time){if(this.config.time[s].show){this.data.total_duration=i[h[s]];break}}}else{this.data.total_duration=i.Years;console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto")}}}};b.prototype.addListener=function(t,r,s){if(typeof t!=="function"){return}if(typeof s==="undefined"){s="visible"}this.listeners[s].push({func:t,scope:r})};b.prototype.notifyListeners=function(u,w,t,s){for(var r=0;r<this.listeners[s].length;r++){var v=this.listeners[s][r];v.func.apply(v.scope,[u,w,t])}};b.prototype.default_options={ref_date:new Date(),start:true,animation:"smooth",count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,total_duration:"Auto",direction:"Clockwise",start_angle:0,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var j=function(s,r){this.elements=s;this.options=r;this.foreach()};j.prototype.getInstance=function(u){var r;var t=g(u).data("tc-id");if(typeof t==="undefined"){t=m();g(u).attr("data-tc-id",t)}if(typeof a[t]==="undefined"){var s=this.options;var v=g(u).data("options");if(typeof v==="string"){v=JSON.parse(v)}if(typeof v==="object"){s=g.extend(true,{},this.options,v)}r=new b(u,s);a[t]=r}else{r=a[t];if(typeof this.options!=="undefined"){r.setOptions(this.options)}}return r};j.prototype.foreach=function(s){var r=this;this.elements.each(function(){var t=r.getInstance(this);if(typeof s==="function"){s(t)}});return this};j.prototype.start=function(){this.foreach(function(r){r.start()});return this};j.prototype.stop=function(){this.foreach(function(r){r.stop()});return this};j.prototype.restart=function(){this.foreach(function(r){r.restart()});return this};j.prototype.rebuild=function(){this.foreach(function(r){r.initialize(false)});return this};j.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()};j.prototype.addListener=function(s,r){if(typeof r==="undefined"){r="visible"}var t=this;this.foreach(function(u){u.addListener(s,t.elements,r)});return this};j.prototype.destroy=function(){this.foreach(function(r){r.destroy()});return this};j.prototype.end=function(){return this.elements};g.fn.TimeCircles=function(r){return new j(this,r)}}(jQuery));