(function(e){var c=(location.hash==="#debug");function j(m){if(c){console.log(m)}}var f={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var g={Seconds:1,Minutes:60,Hours:3600,Days:86400,Years:31536000};function d(o){var n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;o=o.replace(n,function(q,t,s,p){return t+t+s+s+p+p});var m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return m?{r:parseInt(m[1],16),g:parseInt(m[2],16),b:parseInt(m[3],16)}:null}function k(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function i(){return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()}function l(r){var n=r.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(n!==null&&n.length>0){var p=r.split(" ");var m=p[0].split("-");var o=p[1].split(":");return new Date(m[0],m[1]-1,m[2],o[0],o[1],o[2])}var q=Date.parse(r);if(!isNaN(q)){return q}q=Date.parse(r.replace(/-/g,"/").replace("T"," "));if(!isNaN(q)){return q}return new Date()}var a={};var b=function(p,u){this.element=p;this.container;this.timer=null;this.data={prev_time:null,drawn_units:[],super_unit:null,text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.listeners=[];this.config=null;this.setOptions(u);this.container=e("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);this.data.attributes.canvas=e("<canvas>");this.data.attributes.context=this.data.attributes.canvas[0].getContext("2d");var t=this.element.offsetHeight;var m=this.element.offsetWidth;if(t===0){t=e(this.element).height()}if(m===0){m=e(this.element).width()}if(t===0&&m>0){t=m/this.data.drawn_units.length}else{if(m===0&&t>0){m=t*this.data.drawn_units.length}}this.data.attributes.canvas[0].height=t;this.data.attributes.canvas[0].width=m;this.data.attributes.canvas.appendTo(this.container);this.data.attributes.item_size=Math.min(this.data.attributes.canvas[0].width/this.data.drawn_units.length,this.data.attributes.canvas[0].height);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var q=0;for(var s in this.data.text_elements){if(!this.config.time[s].show){continue}var n=e("<div>");n.addClass("textDiv_"+s);n.css("top",Math.round(0.35*this.data.attributes.item_size));n.css("left",Math.round(q++*this.data.attributes.item_size));n.css("width",this.data.attributes.item_size);n.appendTo(this.container);var r=e("<h4>");r.text(this.config.time[s].text);r.css("font-size",Math.round(0.07*this.data.attributes.item_size));r.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");r.appendTo(n);var o=e("<span>");o.css("font-size",Math.round(0.21*this.data.attributes.item_size));o.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");o.appendTo(n);this.data.text_elements[s]=o}if(this.config.start){this.start()}};b.prototype.updateArc=function(){var t,o,C,z;var E=this.data.prev_time;var G=new Date();this.data.prev_time=G;if(E===null){E=G}if(!this.config.count_past_zero){if(G>this.data.attributes.ref_date){for(var B in this.data.drawn_units){var H=this.data.drawn_units[B];this.data.text_elements[H].text(Math.floor(p[H]));var s=(B*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var r=this.data.attributes.item_size/2;var A=this.config.time[H].color;this.drawArc(s,r,A,0)}this.stop();return}}o=(G-this.data.attributes.ref_date)/1000;t=Math.abs(o);z=(E-this.data.attributes.ref_date)/1000;C=Math.abs(z);var p={};var n={};var v={};var m=null;for(var B in this.data.drawn_units){var u=this.data.drawn_units[B];if(m===null){m=this.data.super_unit}var F=g[m]/g[u];var D=(t/g[u]);var w=(C/g[u]);if(u!=="Days"){D=D%F;w=w%F}p[u]=D;n[u]=D/F;v[u]=w;m=u}var B=0;var q=null;for(var B in this.data.drawn_units){var H=this.data.drawn_units[B];this.data.text_elements[H].text(Math.floor(p[H]));var s=(B*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var r=this.data.attributes.item_size/2;var A=this.config.time[H].color;if(Math.floor(p[H])!==Math.floor(v[H])){this.notifyListeners(H,Math.floor(p[H]),Math.floor(o))}if(q!==null){if(Math.floor(p[q])>Math.floor(v[q])){this.radialFade(s,r,A,1,H);this.data.state.fading[H]=true}else{if(Math.floor(p[q])<Math.floor(v[q])){this.radialFade(s,r,A,0,H);this.data.state.fading[H]=true}}}if(!this.data.state.fading[H]){this.drawArc(s,r,A,n[H])}q=H;B++}};b.prototype.drawArc=function(m,t,o,r){var s=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);this.data.attributes.context.clearRect(m-s,t-s,s*2,s*2);if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(m,t,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var q=(-0.5*Math.PI);var n=(-0.5*Math.PI)+(2*r*Math.PI);var p=false;this.data.attributes.context.beginPath();this.data.attributes.context.arc(m,t,this.data.attributes.radius,q,n,p);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=o;this.data.attributes.context.stroke()};b.prototype.radialFade=function(s,r,n,t,u){var q=d(n);var p=this;var m=0.2*((t===1)?-1:1);var o;for(o=0;t<=1&&t>=0;o++){(function(){var v="rgba("+q.r+", "+q.g+", "+q.b+", "+(Math.round(t*10)/10)+")";setTimeout(function(){p.drawArc(s,r,v,1)},50*o)}());t+=m}setTimeout(function(){p.data.state.fading[u]=false},50*o)};b.prototype.timeLeft=function(){var m=new Date();return((this.data.attributes.ref_date-m)/1000)};b.prototype.start=function(){var n=e(this.element).data("date");if(typeof n==="string"){this.data.attributes.ref_date=l(n)}else{var m=e(this.element).attr("data-timer");if(typeof m==="string"){this.data.attributes.timer=parseFloat(m);e(this.element).removeAttr("data-timer")}else{if(typeof this.config.timer==="string"){this.data.attributes.timer=parseFloat(this.config.timer);this.config.timer=null}else{if(typeof this.config.timer==="number"){this.data.attributes.timer=o.config.timer;this.config.timer=null}}}if(typeof this.data.attributes.timer==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.attributes.timer*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}var o=this;this.timer=setInterval(function(){o.updateArc()},this.config.refresh_interval*1000)};b.prototype.stop=function(){if(typeof this.data.attributes.timer==="number"){this.data.attributes.timer=this.timeLeft(this)}clearInterval(this.timer)};b.prototype.destroy=function(){this.stop();this.container.remove();e(this.element).removeData("tc-id")};b.prototype.setOptions=function(m){if(this.config===null){this.default_options.ref_date=new Date();this.config=e.extend(true,{},this.default_options)}e.extend(true,this.config,m);this.data.super_unit=null;this.data.drawn_units=[];for(var n in this.config.time){if(this.config.time[n].show){this.data.drawn_units.push(n);if(this.data.super_unit===null){this.data.super_unit=f[n]}}}};b.prototype.addListener=function(m){if(typeof m!=="function"){return}this.listeners.push(m)};b.prototype.notifyListeners=function(o,p,n){for(var m=0;m<this.listeners.length;m++){this.listeners[m](o,p,n)}};b.prototype.default_options={ref_date:new Date(),start:true,refresh_interval:0.1,count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var h=function(n,m){this.elements=n;this.options=m;this.foreach()};h.prototype.foreach=function(n){var m=this;this.elements.each(function(){var o;var q=e(this).data("tc-id");if(typeof q==="undefined"){q=i();e(this).data("tc-id",q)}if(typeof a[q]==="undefined"){var r=e(this).data("options");var p=m.options;if(typeof r==="object"){p=e.extend(true,{},m.options,r)}o=new b(this,p);a[q]=o}else{o=a[q];if(typeof m.options!=="undefined"){o.setOptions(m.options)}}if(typeof n==="function"){n(o)}});return this};h.prototype.all_instances=function(){return a};h.prototype.start=function(){this.foreach(function(m){m.start()});return this};h.prototype.stop=function(){this.foreach(function(m){m.stop()});return this};h.prototype.addListener=function(m){this.foreach(function(n){n.addListener(m)});return this};h.prototype.destroy=function(){this.foreach(function(m){m.destroy()});return this};h.prototype.end=function(){return this.elements};e.fn.TimeCircles=function(m){return new h(this,m)}}(jQuery));