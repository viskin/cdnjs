(function(e){var c=(location.hash==="#debug");function j(l){if(c){console.log(l)}}var f={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var g={Seconds:1,Minutes:60,Hours:3600,Days:86400,Years:31536000};function d(n){var m=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;n=n.replace(m,function(p,s,q,o){return s+s+q+q+o+o});var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return l?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16)}:null}function k(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function i(){return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()}var a={};var b=function(o,t){this.element=o;this.container;this.timer=null;this.data={drawn_units:[],super_unit:null,text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.listeners=[];this.config=null;this.setOptions(t);this.container=e("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);this.data.attributes.canvas=e("<canvas>");this.data.attributes.context=this.data.attributes.canvas[0].getContext("2d");var s=this.element.offsetHeight;var l=this.element.offsetWidth;if(s===0&&l>0){s=l/this.data.drawn_units.length}else{if(l===0&&s>0){l=s*this.data.drawn_units.length}}this.data.attributes.canvas[0].height=s;this.data.attributes.canvas[0].width=l;this.data.attributes.canvas.appendTo(this.container);this.data.attributes.item_size=Math.min(this.data.attributes.canvas[0].width/this.data.drawn_units.length,this.data.attributes.canvas[0].height);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);var p=0;for(var r in this.data.text_elements){if(!this.config.time[r].show){continue}var m=e("<div>");m.addClass("textDiv_"+r);m.css("top",Math.round(0.35*this.data.attributes.item_size));m.css("left",Math.round(p++*this.data.attributes.item_size));m.css("width",this.data.attributes.item_size);m.appendTo(this.container);var q=e("<h4>");q.text(this.config.time[r].text);q.css("font-size",Math.round(0.07*this.data.attributes.item_size));q.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");q.appendTo(m);var n=e("<span>");n.css("font-size",Math.round(0.21*this.data.attributes.item_size));n.css("line-height",Math.round(0.07*this.data.attributes.item_size)+"px");n.appendTo(m);this.data.text_elements[r]=n}if(this.config.start){this.start()}};b.prototype.updateArc=function(){var r,z;var D=(1000*this.config.refresh_interval);var E=new Date();if(this.config.count_past_zero){var B=E-D;r=Math.abs(E-this.data.attributes.ref_date)/1000;z=Math.abs(this.data.attributes.ref_date-B)/1000}else{r=Math.max(this.data.attributes.ref_date-E,0)/1000;z=r+(E>this.data.attributes.ref_date)?0:D}var n={};var m={};var t={};var l=null;for(var w in this.data.drawn_units){var s=this.data.drawn_units[w];if(l===null){l=this.data.super_unit}var C=g[l]/g[s];var A=(r/g[s]);var u=(z/g[s]);if(s!=="Days"){A=A%C;u=u%C}n[s]=A;m[s]=A/C;t[s]=u;l=s}var w=0;var p=null;for(var w in this.data.drawn_units){var F=this.data.drawn_units[w];this.data.text_elements[F].text(Math.floor(n[F]));var q=(w*this.data.attributes.item_size)+(this.data.attributes.item_size/2);var o=this.data.attributes.item_size/2;var v=this.config.time[F].color;if(Math.floor(n[F])!==Math.floor(t[F])){this.notifyListeners(F,Math.floor(n[F]),Math.floor(r))}if(p!==null){if(Math.floor(n[p])>Math.floor(t[p])){this.radialFade(q,o,v,1,F);this.data.state.fading[F]=true}else{if(Math.floor(n[p])<Math.floor(t[p])){this.radialFade(q,o,v,0,F);this.data.state.fading[F]=true}}}if(!this.data.state.fading[F]){this.drawArc(q,o,v,m[F])}p=F;w++}};b.prototype.drawArc=function(l,s,n,q){var r=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);this.data.attributes.context.clearRect(l-r,s-r,r*2,r*2);if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(l,s,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var p=(-0.5*Math.PI);var m=(-0.5*Math.PI)+(2*q*Math.PI);var o=false;this.data.attributes.context.beginPath();this.data.attributes.context.arc(l,s,this.data.attributes.radius,p,m,o);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=n;this.data.attributes.context.stroke()};b.prototype.radialFade=function(r,q,m,s,t){var p=d(m);var o=this;var l=0.2*((s===1)?-1:1);var n;for(n=0;s<=1&&s>=0;n++){(function(){var u="rgba("+p.r+", "+p.g+", "+p.b+", "+(Math.round(s*10)/10)+")";setTimeout(function(){o.drawArc(r,q,u,1)},50*n)}());s+=l}setTimeout(function(){o.data.state.fading[t]=false},50*n)};b.prototype.timeLeft=function(){var l=new Date();return((this.data.attributes.ref_date-l)/1000)};b.prototype.start=function(){var m=e(this.element).data("date");if(typeof m==="string"){if(m.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/).length>0){m=m.replace(" ","T")}this.data.attributes.ref_date=Date.parse(m)}else{var l=e(this.element).attr("data-timer");if(typeof l==="string"){this.data.attributes.timer=parseFloat(l);e(this.element).removeAttr("data-timer")}else{if(typeof this.config.timer==="string"){this.data.attributes.timer=parseFloat(this.config.timer);this.config.timer=null}else{if(typeof this.config.timer==="number"){this.data.attributes.timer=n.config.timer;this.config.timer=null}}}if(typeof this.data.attributes.timer==="number"){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.attributes.timer*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}var n=this;this.timer=setInterval(function(){n.updateArc()},this.config.refresh_interval*1000)};b.prototype.stop=function(){if(typeof this.data.attributes.timer==="number"){this.data.attributes.timer=this.timeLeft(this)}clearInterval(this.timer)};b.prototype.destroy=function(){this.stop();this.container.remove();e(this.element).removeData("tc-id")};b.prototype.setOptions=function(l){if(this.config===null){this.default_options.ref_date=new Date();this.config=e.extend(true,{},this.default_options)}e.extend(true,this.config,l);this.data.super_unit=null;this.data.drawn_units=[];for(var m in this.config.time){if(this.config.time[m].show){this.data.drawn_units.push(m);if(this.data.super_unit===null){this.data.super_unit=f[m]}}}};b.prototype.addListener=function(l){if(typeof l!=="function"){return}this.listeners.push(l)};b.prototype.notifyListeners=function(n,o,m){for(var l=0;l<this.listeners.length;l++){this.listeners[l](n,o,m)}};b.prototype.default_options={ref_date:new Date(),start:true,refresh_interval:0.1,count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var h=function(m,l){this.elements=m;this.options=l;this.foreach()};h.prototype.foreach=function(m){var l=this;this.elements.each(function(){var n;var p=e(this).data("tc-id");if(typeof p==="undefined"){p=i();e(this).data("tc-id",p)}if(typeof a[p]==="undefined"){var q=e(this).data("options");var o=l.options;if(typeof q==="object"){o=e.extend(true,{},l.options,q)}n=new b(this,o);a[p]=n}else{n=a[p];if(typeof l.options!=="undefined"){n.setOptions(l.options)}}if(typeof m==="function"){m(n)}});return this};h.prototype.start=function(){this.foreach(function(l){l.start()});return this};h.prototype.stop=function(){this.foreach(function(l){l.stop()});return this};h.prototype.addListener=function(l){this.foreach(function(m){m.addListener(l)});return this};h.prototype.destroy=function(){this.foreach(function(l){l.destroy()});return this};h.prototype.end=function(){return this.elements};e.fn.TimeCircles=function(l){return new h(this,l)}}(jQuery));