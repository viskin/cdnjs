(function(a){a.fn.smoothState=function(f){if(!history.pushState){return}var i=false,m=false,o={},s=a("body"),k=a(window),h=(window.console||false);f=a.extend({innerPageSelector:"",prefetch:false,blacklist:".no-smoothstate, [rel='nofollow'], [target]",loadingBodyClass:"loading-cursor",development:false,pageCacheSize:5,frameDelay:400,renderFrame:[function(w){return a("<div/>").append(w).html()}],alterRequestUrl:function(w){return w},onAfter:function(){},onBefore:function(){k.scrollTop(0)}},f);function l(w,x){if(o.hasOwnProperty(w)){if(o[w]===null){setTimeout(function(){s.addClass(f.loadingBodyClass);l(w,x)},10)}else{if(o[w]==="error"){window.location=w}else{s.removeClass(f.loadingBodyClass);f.onBefore(w,x);n(w,x)}}}else{r(w);l(w,x)}}function r(w){if(!o.hasOwnProperty(w)){o[w]=null;var x=f.alterRequestUrl(w),y=a.ajax(x);y.success(function(z){o=t(o,f.pageCacheSize);o[w]={title:a(z).filter("title").text(),html:z}});y.error(function(){o[w]="error"})}}function t(x,w){if(!Object.keys){Object.keys=function(A){var z=[],y;for(y in A){if(Object.prototype.hasOwnProperty.call(A,y)){z.push(y)}}return z}}if(Object.keys(x).length>w){x={}}return x}function n(y,z){var w=z.prop("id"),x=(w.length)?a(a(o[y].html).find("#"+w).html()):"";if(w.length&&x.length){u(x,z);d(o[y].title,y,w)}else{if(f.development&&h){if(!w.length){h.warn("The following container has no ID: ",z[0])}else{if(!x.length){h.warn("No element with an ID of '#"+w+"' in response from "+y)}}}else{window.location=y}}}function u(w,z){var x,y;for(x=0;x<f.renderFrame.length;x+=1){y=(x===f.renderFrame.length-1);v(x,w,z,y)}}function d(x,w,y){document.title=x;if(!i){history.pushState({id:y},x,w);m=true}else{i=false}}function v(x,w,A,z){var y=f.frameDelay*x;setTimeout(function(){var B=f.renderFrame[x](w,A);A.html(B);if(z){f.onAfter(w,A)}},y)}function q(x){var w=x.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof w[1]==="string"&&w[1].length>0&&w[1].toLowerCase()!==location.protocol){return true}if(typeof w[2]==="string"&&w[2].length>0&&w[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false}function e(y){var x=(y.indexOf(window.location.pathname)>0)?true:false,w=(y.indexOf("#")>0)?true:false;return(x&&w)?true:false}function b(x){var w=x.prop("href");return(!q(w)&&!e(w)&&!x.is(f.blacklist))}function g(x,w){var z=a(x),y=a(w,z).first();return(y.length)?y:z}function c(y){y.stopPropagation();var x=a(y.currentTarget),w=x.prop("href");if(b(x)){r(w)}}function p(y){y.stopPropagation();var x=a(y.currentTarget),w=x.prop("href"),z=g(y.delegateTarget,f.innerPageSelector);if(b(x)){y.preventDefault();l(w,z)}}function j(){var w=window.location.href;if(!e(w)&&history.state){i=true;l(w,a("#"+history.state.id))}else{if(history.state===null&&m){window.location=w}}}window.onpopstate=j;return this.each(function(){var w=a(this);w.on("click","a",p);if(f.prefetch){w.on("mouseover touchstart","a",c)}})}})(jQuery);