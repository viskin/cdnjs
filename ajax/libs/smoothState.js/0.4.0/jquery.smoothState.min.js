(function(f,h,j,c){var e=f("html, body"),i=(h.console||false),a=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,g="ss"+Math.round(Math.random()*100000),d={anchors:"a",prefetch:false,blacklist:".no-smoothstate, [target]",development:false,pageCacheSize:0,alterRequestUrl:function(n){return n},onStart:{duration:0,render:function(n,o){e.scrollTop(0)}},onProgress:{duration:0,render:function(n,o){e.css("cursor","wait");e.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(o,p,n){e.css("cursor","auto");e.find("a").css("cursor","auto");p.html(n)}},onAfter:function(o,p,n){}},l={isExternal:function(o){var n=o.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof n[1]==="string"&&n[1].length>0&&n[1].toLowerCase()!==location.protocol){return true}if(typeof n[2]==="string"&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false},isHash:function(p){var o=(p.indexOf(h.location.pathname)>0)?true:false,n=(p.indexOf("#")>0)?true:false;return(o&&n)?true:false},shouldLoad:function(p,o){var n=p.prop("href");return(!l.isExternal(n)&&!l.isHash(n)&&!p.is(o))},htmlDoc:function(o){var p,n=f(),q=o.replace(a,function(r,u,t,s){var v={};if(!u){n=n.add("<"+t+"/>");if(s){f.each(f("<div"+s+"/>")[0].attributes,function(x,w){v[w.name]=w.value})}n.eq(-1).attr(v)}return"<"+u+"div"+(u?"":' id="'+g+(n.length-1)+'"')+">"});if(!n.length){return f(o)}if(!p){p=f("<div/>")}p.html(q);f.each(n,function(r){var s=p.find("#"+g+r).before(n[r]);n.eq(r).html(s.contents());s.remove()});return p.children().unwrap()},clearIfOverCapacity:function(o,n){if(!Object.keys){Object.keys=function(r){var q=[],p;for(p in r){if(Object.prototype.hasOwnProperty.call(r,p)){q.push(p)}}return q}}if(Object.keys(o).length>n){o={}}return o},getContentById:function(q,n){var p=f(q,n).html(),o=(p.length)?f(p):null;return o},storePageIn:function(o,n,p){var q=l.htmlDoc(p);o[n]={status:"loaded",title:q.find("title").text(),html:q};return o},triggerAllAnimationEndEvent:function(n){var t=0,r="animationstart webkitAnimationStart oanimationstart MSAnimationStart",o="animationend webkitAnimationEnd oanimationend MSAnimationEnd",q="allanimationend",p=function(u){if(f(u.delegateTarget).is(n)){u.stopPropagation();t++}},s=function(u){if(f(u.delegateTarget).is(n)){u.stopPropagation();t--;if(t===0){n.trigger(q)}}};n.on(r,p);n.on(o,s);n.on("allanimationend ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(u){t=0;l.redraw(n)})},redraw:function(n){n.hide(0,function(){f(this).show()})}},b=function(q){if(q.state!==null){var o=h.location.href,n=f("#"+q.state.id),p=n.data("smoothState");if(p.href!==o&&!l.isHash(o)){p.load(o,true)}}},k=function(r,y){var w=f(r),o={},x=h.location.href,v=function(A,z){z=z||false;var D=false,B=false,C={loaded:function(){var E=D?"ss.onProgressEnd":"ss.onStartEnd";if(!B||!D){w.one(E,function(){u(A)})}else{if(B){u(A)}}if(!z){history.pushState({id:w.prop("id")},o[A].title,A)}w.data("smoothState").href=A},fetching:function(){if(!D){D=true;w.one("ss.onStartEnd",function(){y.onProgress.render(A,w,null);setTimeout(function(){w.trigger("ss.onProgressEnd");B=true},y.onStart.duration)})}setTimeout(function(){C[o[A].status]()},10)},error:function(){h.location=A}};if(!o.hasOwnProperty(A)){n(A)}y.onStart.render(A,w,null);setTimeout(function(){w.trigger("ss.onStartEnd")},y.onStart.duration);C[o[A].status]()},u=function(B){var z="#"+w.prop("id"),A=l.getContentById(z,o[B].html);if(A){y.onEnd.render(B,w,A);w.one("ss.onEndEnd",function(){y.onAfter(B,w,A)});setTimeout(function(){w.trigger("ss.onEndEnd")},y.onEnd.duration)}else{if(!A&&y.development&&i){i.warn("No element with an id of "+z+"' in response from "+B+" in "+object)}else{h.location=B}}},n=function(z){o[z]={status:"fetching"};var A=y.alterRequestUrl(z)||z,B=f.ajax(A);B.success(function(C){o=l.clearIfOverCapacity(o,y.pageCacheSize);l.storePageIn(o,z,C)});B.error(function(){o[z].status="error"})},s=function(B){var A=f(B.currentTarget),z=A.prop("href");if(l.shouldLoad(A,y.blacklist)){B.stopPropagation();n(z)}},t=function(B){var A=f(B.currentTarget),z=A.prop("href"),C=f(B.delegateTarget);if(l.shouldLoad(A,y.blacklist)){B.stopPropagation();B.preventDefault();v(z)}},p=function(z){z.on("click",y.anchors,t);if(y.prefetch){z.on("mouseover touchstart",y.anchors,s)}},q=function(A){var z=w.addClass(A).prop("class");w.removeClass(z);w[0].offsetWidth=w[0].offsetWidth;w.addClass(z);w.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){w.removeClass(A)})};y=f.extend(d,y);if(history.state===null){history.replaceState({id:w.prop("id")},j.title,x)}l.storePageIn(o,x,j.documentElement.outerHTML);l.triggerAllAnimationEndEvent(w);p(w);return{href:x,cache:o,load:v,fetch:n,toggleAnimationClass:q}},m=function(n){return this.each(function(){if(this.id&&!f.data(this,"smoothState")){f.data(this,"smoothState",new k(this,n))}else{if(!this.id&&i){i.warn("Every smoothState container needs an id but the following one does not have one:",this)}}})};h.onpopstate=b;f.smoothStateUtility=l;f.fn.smoothState=m})(jQuery,window,document);