(function(a){a.fn.smoothState=function(f){var s=false,n=false,l={},q=a("body"),i=a(window),g=(window.console||false);f=a.extend({prefetch:false,blacklist:".no-smoothstate, [rel='nofollow'], [target]",loadingBodyClass:"loading-cursor",development:false,pageCacheSize:5,frameDelay:400,renderFrame:[function(v){return a("<div/>").append(v).html()}],alterRequestUrl:function(v){return v},onAfter:function(){},onBefore:function(){i.scrollTop(0)}},f);function j(v,w){if(l.hasOwnProperty(v)){if(l[v]===null){setTimeout(function(){q.addClass(f.loadingBodyClass);j(v,w)},10)}else{if(l[v]==="error"){window.location=v}else{q.removeClass(f.loadingBodyClass);f.onBefore(v,w);k(v,w)}}}else{p(v);j(v,w)}}function p(v){if(!l.hasOwnProperty(v)){l[v]=null;var w=f.alterRequestUrl(v),x=a.ajax(w);x.success(function(y){l=r(l,f.pageCacheSize);l[v]={title:a(y).filter("title").text(),html:y}});x.error(function(){l[v]="error"})}}function r(w,v){if(!Object.keys){Object.keys=function(z){var y=[],x;for(x in z){if(Object.prototype.hasOwnProperty.call(z,x)){y.push(x)}}return y}}if(Object.keys(w).length>v){w={}}return w}function k(x,y){var v=y.prop("id"),w=(v.length)?a(a("<div/>").append(l[x].html).find("#"+v).html()):"";if(v.length&&w.length){t(w,y);d(l[x].title,x,v)}else{if(f.development&&g){if(!v.length){g.warn("The following container has no ID: ",y[0])}else{if(!w.length){g.warn("No element with an ID of '#"+v+"' in response from "+x)}}}else{window.location=x}}}function t(v,y){var w,x;for(w=0;w<f.renderFrame.length;w+=1){x=(w===f.renderFrame.length-1);u(w,v,y,x)}}function d(w,v,x){document.title=w;if(!s){history.pushState({id:x},w,v);n=true}else{s=false}}function u(w,v,z,y){var x=f.frameDelay*w;setTimeout(function(){var A=f.renderFrame[w](v,z);z.html(A);if(y){f.onAfter(v,z)}},x)}function o(w){var v=w.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof v[1]==="string"&&v[1].length>0&&v[1].toLowerCase()!==location.protocol){return true}if(typeof v[2]==="string"&&v[2].length>0&&v[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false}function e(x){var w=(x.indexOf(window.location.pathname)>0)?true:false,v=(x.indexOf("#")>0)?true:false;return(w&&v)?true:false}function b(w){var v=w.prop("href");return(!o(v)&&!e(v)&&!w.is(f.blacklist))}function c(x){x.stopPropagation();var w=a(x.currentTarget),v=w.prop("href");if(b(w)){p(v)}}function m(x){x.stopPropagation();var w=a(x.currentTarget),v=w.prop("href"),y=a(x.delegateTarget);if(b(w)){x.preventDefault();j(v,y)}}function h(){var v=window.location.href;if(!e(v)&&history.state){s=true;j(v,a("#"+history.state.id))}else{if(history.state===null&&n){window.location=v}}}window.onpopstate=h;return this.each(function(){var v=a(this);v.on("click","a",m);if(f.prefetch){v.on("mouseover touchstart","a",c)}})}})(jQuery);