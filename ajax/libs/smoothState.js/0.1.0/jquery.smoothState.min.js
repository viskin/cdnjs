(function(a){a.fn.smoothState=function(f){var i=false,n={},r=a("body"),k=a(window),h=(window.console||false);f=a.extend({innerPageSelector:"",prefetch:false,blacklist:".no-smoothstate, [rel='nofollow'], [target]",loadingBodyClass:"loading-cursor",development:false,pageCacheSize:5,frameDelay:400,renderFrame:[function(v){return a("<div/>").append(v).html()}],alterRequestUrl:function(v){return v},onAfter:function(){},onBefore:function(){k.scrollTop(0)}},f);function l(v,w){if(n.hasOwnProperty(v)){if(n[v]===null){setTimeout(function(){r.addClass(f.loadingBodyClass);l(v,w)},10)}else{if(n[v]==="error"){window.location=v}else{r.removeClass(f.loadingBodyClass);f.onBefore(v,w);m(v,w)}}}else{q(v);l(v,w)}}function q(v){if(!n.hasOwnProperty(v)){n[v]=null;var w=f.alterRequestUrl(v),x=a.ajax(w);x.success(function(y){n=s(n,f.pageCacheSize);n[v]={title:a(y).filter("title").text(),html:y}});x.error(function(){n[v]="error"})}}function s(w,v){if(!Object.keys){Object.keys=function(z){var y=[],x;for(x in z){if(Object.prototype.hasOwnProperty.call(z,x)){y.push(x)}}return y}}if(Object.keys(w).length>v){w={}}return w}function m(x,y){var v=y.prop("id"),w=(v.length)?a(a(n[x].html).find("#"+v).html()):"";if(v.length&&w.length){t(w,y);d(n[x].title,x,v)}else{if(f.development&&h){if(!v.length){h.warn("The following container has no ID: ",y[0])}else{if(!w.length){h.warn("No element with an ID of '#"+v+"' in response from "+x)}}}else{window.location=x}}}function t(v,y){var w,x;for(w=0;w<f.renderFrame.length;w+=1){x=(w===f.renderFrame.length-1);u(w,v,y,x)}}function d(w,v,x){document.title=w;if(!i&&history.pushState){history.pushState({id:x},w,v)}}function u(w,v,z,y){var x=f.frameDelay*w;setTimeout(function(){var A=f.renderFrame[w](v,z);z.html(A);if(y){f.onAfter(v,z)}},x)}function p(w){var v=w.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof v[1]==="string"&&v[1].length>0&&v[1].toLowerCase()!==location.protocol){return true}if(typeof v[2]==="string"&&v[2].length>0&&v[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false}function e(x){var w=(x.indexOf(window.location.pathname)>0)?true:false,v=(x.indexOf("#")>0)?true:false;return(w&&v)?true:false}function b(w){var v=w.prop("href");return(!p(v)&&!e(v)&&!w.is(f.blacklist))}function g(w,v){var y=a(w),x=a(v,y).first();return(x.length)?x:y}function c(x){x.stopPropagation();var w=a(x.currentTarget),v=w.prop("href");if(b(w)){q(v)}}function o(x){x.stopPropagation();var w=a(x.currentTarget),v=w.prop("href"),y=g(x.delegateTarget,f.innerPageSelector);if(b(w)){x.preventDefault();l(v,y)}}function j(){var v=window.location.href;if(!p(v)&&!e(v)&&history.state){i=true;l(v,a("#"+history.state.id))}else{if(history.state===null&&i){window.location=v}}}window.onpopstate=j;return this.each(function(){var v=a(this);v.on("click touchend","a",o);if(f.prefetch){v.on("mouseover touchstart","a",c)}})}})(jQuery);