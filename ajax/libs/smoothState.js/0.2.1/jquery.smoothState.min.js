/*!
 * jQuery htmlDoc "fixer" - v0.2pre - 8/8/2011
 * http://benalman.com/projects/jquery-misc-plugins/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(a){a.fn.smoothState=function(f){var v=false,o=false,m={},s=a("body"),j=a(window),h=(window.console||false),g=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,t="ss"+Math.round(Math.random()*100*100);f=a.extend({prefetch:false,blacklist:".no-smoothstate, [rel='nofollow'], [target]",loadingBodyClass:"loading-cursor",development:false,pageCacheSize:5,frameDelay:400,renderFrame:[function(y){return a("<div/>").append(y).html()}],alterRequestUrl:function(y){return y},onAfter:function(){},onBefore:function(){j.scrollTop(0)}},f);function k(y,z){if(m.hasOwnProperty(y)){if(m[y]===null){setTimeout(function(){s.addClass(f.loadingBodyClass);k(y,z)},10)}else{if(m[y]==="error"){window.location=y}else{s.removeClass(f.loadingBodyClass);f.onBefore(y,z);l(y,z)}}}else{q(y);k(y,z)}}function q(y){if(!m.hasOwnProperty(y)){m[y]=null;var z=f.alterRequestUrl(y),A=a.ajax(z);A.success(function(B){m=u(m,f.pageCacheSize);m[y]={title:a(B).filter("title").text(),html:B}});A.error(function(){m[y]="error"})}}function u(z,y){if(!Object.keys){Object.keys=function(C){var B=[],A;for(A in C){if(Object.prototype.hasOwnProperty.call(C,A)){B.push(A)}}return B}}if(Object.keys(z).length>y){z={}}return z}function l(B,C){var z=C.prop("id"),y=r(m[B].html),A=(z.length)?y.find("#"+z).html():"";if(z.length&&A.length){w(A,C);d(m[B].title,B,z)}else{if(f.development&&h){if(!z.length){h.warn("The following container has no ID: ",C[0])}else{if(!A.length){h.warn("No element with an ID of '#"+z+"' in response from "+B)}}}else{window.location=B}}}function w(y,B){var z,A;for(z=0;z<f.renderFrame.length;z+=1){A=(z===f.renderFrame.length-1);x(z,y,B,A)}}function d(z,y,A){document.title=z;if(!v){history.pushState({id:A},z,y);o=true}else{v=false}}function x(z,y,C,B){var A=f.frameDelay*z;setTimeout(function(){var D=f.renderFrame[z](y,C);C.html(D);if(B){f.onAfter(y,C)}},A)}function p(z){var y=z.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof y[1]==="string"&&y[1].length>0&&y[1].toLowerCase()!==location.protocol){return true}if(typeof y[2]==="string"&&y[2].length>0&&y[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false}function e(A){var z=(A.indexOf(window.location.pathname)>0)?true:false,y=(A.indexOf("#")>0)?true:false;return(z&&y)?true:false}function b(z){var y=z.prop("href");return(!p(y)&&!e(y)&&!z.is(f.blacklist))}function r(z){var A,y=a(),B=z.replace(g,function(C,F,E,D){var G={};if(!F){y=y.add("<"+E+"/>");if(D){a.each(a("<div"+D+"/>")[0].attributes,function(I,H){G[H.name]=H.value})}y.eq(-1).attr(G)}return"<"+F+"div"+(F?"":' id="'+t+(y.length-1)+'"')+">"});if(!y.length){return a(z)}if(!A){A=a("<div/>")}A.html(B);a.each(y,function(C){var D=A.find("#"+t+C).before(y[C]);y.eq(C).html(D.contents());D.remove()});return A.children().unwrap()}function c(A){A.stopPropagation();var z=a(A.currentTarget),y=z.prop("href");if(b(z)){q(y)}}function n(A){A.stopPropagation();var z=a(A.currentTarget),y=z.prop("href"),B=a(A.delegateTarget);if(b(z)){A.preventDefault();k(y,B)}}function i(){var y=window.location.href;if(!e(y)&&history.state){v=true;k(y,a("#"+history.state.id))}else{if(history.state===null&&o){window.location=y}}}window.onpopstate=i;return this.each(function(){var y=a(this);y.on("click","a",n);if(f.prefetch){y.on("mouseover touchstart","a",c)}})}})(jQuery);