(function(e,f,h,b){var d=e("html, body"),g=(f.console||false),c={anchors:"a",prefetch:false,blacklist:".no-smoothstate, [target]",development:false,pageCacheSize:0,alterRequestUrl:function(l){return l},onStart:{duration:0,render:function(l,m){d.scrollTop(0)}},onProgress:{duration:0,render:function(l,m){d.css("cursor","wait");d.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(m,n,l){d.css("cursor","auto");d.find("a").css("cursor","auto");n.html(l)}},callback:function(m,n,l){}},j={isExternal:function(m){var l=m.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof l[1]==="string"&&l[1].length>0&&l[1].toLowerCase()!==location.protocol){return true}if(typeof l[2]==="string"&&l[2].length>0&&l[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false},isHash:function(n){var m=(n.indexOf(f.location.pathname)>0)?true:false,l=(n.indexOf("#")>0)?true:false;return(m&&l)?true:false},shouldLoad:function(n,m){var l=n.prop("href");return(!j.isExternal(l)&&!j.isHash(l)&&!n.is(m))},htmlDoc:function(n){var o,m=e(),l=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,q="ss"+Math.round(Math.random()*100000),p=n.replace(l,function(r,u,t,s){var v={};if(!u){m=m.add("<"+t+"/>");if(s){e.each(e("<div"+s+"/>")[0].attributes,function(x,w){v[w.name]=w.value})}m.eq(-1).attr(v)}return"<"+u+"div"+(u?"":' id="'+q+(m.length-1)+'"')+">"});if(!m.length){return e(n)}if(!o){o=e("<div/>")}o.html(p);e.each(m,function(r){var s=o.find("#"+q+r).before(m[r]);m.eq(r).html(s.contents());s.remove()});return o.children().unwrap()},clearIfOverCapacity:function(m,l){if(!Object.keys){Object.keys=function(p){var o=[],n;for(n in p){if(Object.prototype.hasOwnProperty.call(p,n)){o.push(n)}}return o}}if(Object.keys(m).length>l){m={}}return m},getContentById:function(p,l){l=(l instanceof jQuery)?l:j.htmlDoc(l);var n=l.find(p),o=(n.length)?e.trim(n.html()):l.filter(p).html(),m=(o.length)?e(o):null;return m},storePageIn:function(n,m,l){l=(l instanceof jQuery)?l:j.htmlDoc(l);n[m]={status:"loaded",title:l.find("title").text(),html:l};return n},triggerAllAnimationEndEvent:function(l,r){r=" "+r||"";var s=0,p="animationstart webkitAnimationStart oanimationstart MSAnimationStart",m="animationend webkitAnimationEnd oanimationend MSAnimationEnd",o="allanimationend",n=function(t){if(e(t.delegateTarget).is(l)){t.stopPropagation();s++}},q=function(t){if(e(t.delegateTarget).is(l)){t.stopPropagation();s--;if(s===0){l.trigger(o)}}};l.on(p,n);l.on(m,q);l.on("allanimationend"+r,function(t){s=0;j.redraw(l)})},redraw:function(l){l.height(0);setTimeout(function(){l.height("auto")},0)}},a=function(o){if(o.state!==null){var m=f.location.href,l=e("#"+o.state.id),n=l.data("smoothState");if(n.href!==m&&!j.isHash(m)){n.load(m,true)}}},i=function(p,w){var u=e(p),m={},v=f.location.href,t=function(y,x){x=x||false;var B=false,z=false,A={loaded:function(){var C=B?"ss.onProgressEnd":"ss.onStartEnd";if(!z||!B){u.one(C,function(){s(y)})}else{if(z){s(y)}}if(!x){history.pushState({id:u.prop("id")},m[y].title,y)}},fetching:function(){if(!B){B=true;u.one("ss.onStartEnd",function(){w.onProgress.render(y,u,null);setTimeout(function(){u.trigger("ss.onProgressEnd");z=true},w.onStart.duration)})}setTimeout(function(){if(m.hasOwnProperty(y)){A[m[y].status]()}},10)},error:function(){f.location=y}};if(!m.hasOwnProperty(y)){l(y)}w.onStart.render(y,u,null);setTimeout(function(){u.trigger("ss.onStartEnd")},w.onStart.duration);A[m[y].status]()},s=function(z){var x="#"+u.prop("id"),y=j.getContentById(x,m[z].html);if(y){h.title=m[z].title;u.data("smoothState").href=z;w.onEnd.render(z,u,y);u.one("ss.onEndEnd",function(){w.callback(z,u,y)});setTimeout(function(){u.trigger("ss.onEndEnd")},w.onEnd.duration)}else{if(!y&&w.development&&g){g.warn("No element with an id of "+x+"' in response from "+z+" in "+object)}else{f.location=z}}},l=function(x){if(m.hasOwnProperty(x)){return}m=j.clearIfOverCapacity(m,w.pageCacheSize);m[x]={status:"fetching"};var y=w.alterRequestUrl(x)||x,z=e.ajax(y);z.success(function(A){j.storePageIn(m,x,A);u.data("smoothState").cache=m});z.error(function(){m[x].status="error"})},q=function(z){var y=e(z.currentTarget),x=y.prop("href");if(j.shouldLoad(y,w.blacklist)){z.stopPropagation();l(x)}},r=function(z){var y=e(z.currentTarget),x=y.prop("href"),A=e(z.delegateTarget);if(j.shouldLoad(y,w.blacklist)){z.stopPropagation();z.preventDefault();t(x)}},n=function(x){x.on("click",w.anchors,r);if(w.prefetch){x.on("mouseover touchstart",w.anchors,q)}},o=function(y){var x=u.addClass(y).prop("class");u.removeClass(x);setTimeout(function(){u.addClass(x)},0);u.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){u.removeClass(y)})};w=e.extend(c,w);if(history.state===null){history.replaceState({id:u.prop("id")},h.title,v)}j.storePageIn(m,v,h.documentElement.outerHTML);j.triggerAllAnimationEndEvent(u,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd");n(u);return{href:v,cache:m,load:t,fetch:l,toggleAnimationClass:o}},k=function(l){return this.each(function(){if(this.id&&!e.data(this,"smoothState")){e.data(this,"smoothState",new i(this,l))}else{if(!this.id&&g){g.warn("Every smoothState container needs an id but the following one does not have one:",this)}}})};f.onpopstate=a;e.smoothStateUtility=j;e.fn.smoothState=k})(jQuery,window,document);