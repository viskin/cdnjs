(function(f,h,j,c){var e=f("html, body"),i=(h.console||false),a=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,g="ss"+Math.round(Math.random()*100000),d={prefetch:false,blacklist:".no-smoothstate, [target]",development:false,pageCacheSize:0,alterRequestUrl:function(n){return n},onStart:function(n,o){e.scrollTop(0)},onProgress:function(n,o){e.css("cursor","wait");e.find("a").css("cursor","wait")},onEnd:function(o,p,n){e.css("cursor","auto");e.find("a").css("cursor","auto");p.html(n)}},l={isExternal:function(o){var n=o.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof n[1]==="string"&&n[1].length>0&&n[1].toLowerCase()!==location.protocol){return true}if(typeof n[2]==="string"&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false},isHash:function(p){var o=(p.indexOf(h.location.pathname)>0)?true:false,n=(p.indexOf("#")>0)?true:false;return(o&&n)?true:false},shouldLoad:function(p,o){var n=p.prop("href");return(!l.isExternal(n)&&!l.isHash(n)&&!p.is(o))},htmlDoc:function(o){var p,n=f(),q=o.replace(a,function(r,u,t,s){var v={};if(!u){n=n.add("<"+t+"/>");if(s){f.each(f("<div"+s+"/>")[0].attributes,function(x,w){v[w.name]=w.value})}n.eq(-1).attr(v)}return"<"+u+"div"+(u?"":' id="'+g+(n.length-1)+'"')+">"});if(!n.length){return f(o)}if(!p){p=f("<div/>")}p.html(q);f.each(n,function(r){var s=p.find("#"+g+r).before(n[r]);n.eq(r).html(s.contents());s.remove()});return p.children().unwrap()},clearIfOverCapacity:function(o,n){if(!Object.keys){Object.keys=function(r){var q=[],p;for(p in r){if(Object.prototype.hasOwnProperty.call(r,p)){q.push(p)}}return q}}if(Object.keys(o).length>n){o={}}return o},getContentById:function(q,n){var p=f(q,n).html(),o=(p.length)?f(p):null;return o},storePageIn:function(o,n,p){var q=l.htmlDoc(p);o[n]={status:"loaded",title:q.find("title").text(),html:q};return o},triggerAllAnimationEndEvent:function(n){var t=0,r="animationstart webkitAnimationStart oanimationstart MSAnimationStart",o="animationend webkitAnimationEnd oanimationend MSAnimationEnd",q="ss.allanimationend",u=function(v){n.trigger(q);l.redraw(n)},p=function(v){v.stopPropagation();t++},s=function(v){v.stopPropagation();t--;if(t===0){u()}};n.on(r,p);n.on(o,s)},triggerCallback:function(n,o){n.one("ss.allanimationend",o);setTimeout(function(){n.trigger("animationstart");n.trigger("animationend")},100)},redraw:function(n){n.hide(0,function(){f(this).show()})}},b=function(p){if(p.state!==null){var n=h.location.href,o=f("#"+p.state.id).data("smoothState");if(o.href!==n&&!l.isHash(n)){o.load(n,true)}}},k=function(r,y){var w=f(r),o={},x=h.location.href,v=function(A,z){z=z||false;var C=false,B={loaded:function(){u(A);if(!z){history.pushState({id:w.prop("id")},o[A].title,A)}w.data("smoothState").href=A},fetching:function(){setTimeout(function(){if(!C){l.triggerCallback(w,function(){y.onProgress(A,w,null)});C=true}B[o[A].status]()},10)},error:function(){h.location=A}};if(!o.hasOwnProperty(A)){n(A)}y.onStart(A,w,null);B[o[A].status]()},u=function(B){var z="#"+w.prop("id"),A=l.getContentById(z,o[B].html);if(A){l.triggerCallback(w,function(){y.onEnd(B,w,A)})}else{if(!A&&y.development&&i){i.warn("No element with an id of "+z+"' in response from "+B+" in "+object)}else{h.location=B}}},n=function(z){o[z]={status:"fetching"};var A=y.alterRequestUrl(z)||z,B=f.ajax(A);B.success(function(C){o=l.clearIfOverCapacity(o,y.pageCacheSize);l.storePageIn(o,z,C)});B.error(function(){o[z].status="error"})},s=function(B){B.stopPropagation();var A=f(B.currentTarget),z=A.prop("href");if(l.shouldLoad(A,y.blacklist)){n(z)}},t=function(B){B.stopPropagation();var A=f(B.currentTarget),z=A.prop("href"),C=f(B.delegateTarget);if(l.shouldLoad(A,y.blacklist)){B.preventDefault();v(z)}},p=function(z){z.on("click","a",t);if(y.prefetch){z.on("mouseover touchstart","a",s)}},q=function(z){var A=w.addClass(z).prop("class");w.removeClass(A);setTimeout(function(){w.addClass(A);l.triggerCallback(w,function(){w.removeClass(z)})},0)};y=f.extend(d,y);if(history.state===null){history.replaceState({id:w.prop("id")},j.title,x)}l.storePageIn(o,x,j.documentElement.outerHTML);p(w);l.triggerAllAnimationEndEvent(w);return{href:x,cache:o,load:v,fetch:n,toggleAnimationClass:q}},m=function(n){return this.each(function(){if(this.id&&!f.data(this,"smoothState")){f.data(this,"smoothState",new k(this,n))}else{if(!this.id&&i){i.warn("Every smoothState container needs an id but the following one does not have one:",this)}}})};h.onpopstate=b;f.smoothStateUtility=l;f.fn.smoothState=m})(jQuery,window,document);