(function(){var r,g,p,o,i,m,d,k,b,v,e,f,a,s,j,l,q,x,t,u,h,c=function(y,z){return function(){return y.apply(z,arguments)}},n={}.hasOwnProperty,w=function(B,z){for(var y in z){if(n.call(z,y)){B[y]=z[y]}}function A(){this.constructor=B}A.prototype=z.prototype;B.prototype=new A();B.__super__=z.prototype;return B};h=Tether.Utils,v=h.extend,k=h.addClass,l=h.removeClass,a=h.hasClass,e=h.getBounds,o=h.Evented;g=13;p=27;i=32;d=38;r=40;t="ontouchstart" in document.documentElement;b=t?"touchstart":"click";u=function(){return t&&(innerWidth<=640||innerHeight<=640)};s=function(y){return Array.prototype.reduce.call(y,function(A,z){if(A===z){return z}else{return false}})};f=function(){var y;return(y=document.querySelector(".select-target-focused"))!=null?y.selectInstance:void 0};q="";x=void 0;j=void 0;document.addEventListener("keypress",function(C){var A,z,y,B;if(!(y=f())){return}if(C.charCode===0){return}if(C.keyCode===i){C.preventDefault()}clearTimeout(x);x=setTimeout(function(){return q=""},500);q+=String.fromCharCode(C.charCode);A=y.findOptionsByPrefix(q);if(A.length===1){y.selectOption(A[0]);return}if(q.length>1&&s(q)){z=y.findOptionsByPrefix(q[0]);if(z.length){B=z.indexOf(y.getChosen());B+=1;B=B%z.length;y.selectOption(z[B]);return}}if(A.length){y.selectOption(A[0])}});document.addEventListener("keydown",function(A){var z,y,B;if(!(z=f())){return}if((y=A.keyCode)===d||y===r||y===p){A.preventDefault()}if(z.isOpen()){switch(A.keyCode){case d:case r:return z.moveHighlight(A.keyCode);case g:return z.selectHighlightedOption();case p:z.close();return z.target.focus()}}else{if((B=A.keyCode)===d||B===r||B===i){return z.open()}}});m=(function(y){w(z,y);z.defaults={alignToHighlighed:"auto",className:"select-theme-default"};function z(A){this.options=A;this.update=c(this.update,this);this.options=v({},z.defaults,this.options);this.select=this.options.el;if(this.select.selectInstance!=null){throw new Error("This element has already been turned into a Select")}this.setupTarget();this.renderTarget();this.setupDrop();this.renderDrop();this.setupSelect();this.setupTether();this.bindClick();this.bindMutationEvents();this.value=this.select.value}z.prototype.useNative=function(){return this.options.useNative===true||(u()&&this.options.useNative!==false)};z.prototype.setupTarget=function(){var A,B=this;this.target=document.createElement("a");this.target.href="javascript:;";k(this.target,"select-target");A=this.select.getAttribute("tabindex")||0;this.target.setAttribute("tabindex",A);if(this.options.className){k(this.target,this.options.className)}this.target.selectInstance=this;this.target.addEventListener("click",function(){if(!B.isOpen()){return B.target.focus()}else{return B.target.blur()}});this.target.addEventListener("focus",function(){return k(B.target,"select-target-focused")});this.target.addEventListener("blur",function(C){if(B.isOpen()){if(C.relatedTarget&&!B.drop.contains(C.relatedTarget)){B.close()}}return l(B.target,"select-target-focused")});return this.select.parentNode.insertBefore(this.target,this.select.nextSibling)};z.prototype.setupDrop=function(){var A=this;this.drop=document.createElement("div");k(this.drop,"select");if(this.options.className){k(this.drop,this.options.className)}document.body.appendChild(this.drop);this.drop.addEventListener("click",function(B){if(a(B.target,"select-option")){return A.pickOption(B.target)}});this.drop.addEventListener("mousemove",function(B){if(a(B.target,"select-option")){return A.highlightOption(B.target)}});this.content=document.createElement("div");k(this.content,"select-content");return this.drop.appendChild(this.content)};z.prototype.open=function(){var B,A,C=this;k(this.target,"select-open");if(this.useNative()){this.select.style.display="block";setTimeout(function(){var D;D=document.createEvent("MouseEvents");D.initEvent("mousedown",true,true);return C.select.dispatchEvent(D)});return}k(this.drop,"select-open");setTimeout(function(){return C.tether.enable()});A=this.drop.querySelector(".select-option-selected");if(!A){return}this.highlightOption(A);this.scrollDropContentToOption(A);B=function(){var E,F,D;if(a(C.drop,"tether-abutted-left")||a(C.drop,"tether-abutted-bottom")){E=e(C.drop);D=e(A);F=E.top-(D.top+D.height);return C.drop.style.top=(parseFloat(C.drop.style.top)||0)+F+"px"}};if(this.options.alignToHighlighted==="always"||(this.options.alignToHighlighted==="auto"&&this.content.scrollHeight<=this.content.clientHeight)){setTimeout(B)}return this.trigger("open")};z.prototype.close=function(){l(this.target,"select-open");if(this.useNative()){this.select.style.display="none";return}this.tether.disable();l(this.drop,"select-open");return this.trigger("close")};z.prototype.toggle=function(){if(this.isOpen()){return this.close()}else{return this.open()}};z.prototype.isOpen=function(){return a(this.drop,"select-open")};z.prototype.bindClick=function(){var A=this;this.target.addEventListener(b,function(B){B.preventDefault();return A.toggle()});return document.addEventListener(b,function(B){if(!A.isOpen()){return}if(B.target===A.drop||A.drop.contains(B.target)){return}if(B.target===A.target||A.target.contains(B.target)){return}return A.close()})};z.prototype.setupTether=function(){return this.tether=new Tether({element:this.drop,target:this.target,attachment:"top left",targetAttachment:"bottom left",classPrefix:"select",constraints:[{to:"window",attachment:"together"}]})};z.prototype.renderTarget=function(){var C,D,B,A;this.target.innerHTML="";A=this.select.querySelectorAll("option");for(D=0,B=A.length;D<B;D++){C=A[D];if(C.selected){this.target.innerHTML=C.innerHTML;break}}return this.target.appendChild(document.createElement("b"))};z.prototype.renderDrop=function(){var D,C,F,E,B,A;F=document.createElement("ul");k(F,"select-options");A=this.select.querySelectorAll("option");for(E=0,B=A.length;E<B;E++){D=A[E];C=document.createElement("li");k(C,"select-option");C.setAttribute("data-value",D.value);C.innerHTML=D.innerHTML;if(D.selected){k(C,"select-option-selected")}F.appendChild(C)}this.content.innerHTML="";return this.content.appendChild(F)};z.prototype.update=function(){this.renderDrop();return this.renderTarget()};z.prototype.setupSelect=function(){this.select.selectInstance=this;k(this.select,"select-select");return this.select.addEventListener("change",this.update)};z.prototype.bindMutationEvents=function(){if(window.MutationObserver!=null){this.observer=new MutationObserver(this.update);return this.observer.observe(this.select,{childList:true,attributes:true,characterData:true,subtree:true})}else{return this.select.addEventListener("DOMSubtreeModified",this.update)}};z.prototype.findOptionsByPrefix=function(B){var A;A=this.drop.querySelectorAll(".select-option");B=B.toLowerCase();return Array.prototype.filter.call(A,function(C){return C.innerHTML.toLowerCase().substr(0,B.length)===B})};z.prototype.findOptionsByValue=function(B){var A;A=this.drop.querySelectorAll(".select-option");return Array.prototype.filter.call(A,function(C){return C.getAttribute("data-value")===B})};z.prototype.getChosen=function(){if(this.isOpen()){return this.drop.querySelector(".select-option-highlight")}else{return this.drop.querySelector(".select-option-selected")}};z.prototype.selectOption=function(A){if(this.isOpen()){this.highlightOption(A);return this.scrollDropContentToOption(A)}else{return this.pickOption(A,false)}};z.prototype.resetSelection=function(){return this.selectOption(this.drop.querySelector(".select-option"))};z.prototype.highlightOption=function(A){var B;B=this.drop.querySelector(".select-option-highlight");if(B!=null){l(B,"select-option-highlight")}k(A,"select-option-highlight");return this.trigger("highlight",{option:A})};z.prototype.moveHighlight=function(E){var C,A,D,B;if(!(C=this.drop.querySelector(".select-option-highlight"))){this.highlightOption(this.drop.querySelector(".select-option"));return}B=this.drop.querySelectorAll(".select-option");A=Array.prototype.indexOf.call(B,C);if(!(A>=0)){return}if(E===d){A-=1}else{A+=1}if(A<0||A>=B.length){return}D=B[A];this.highlightOption(D);return this.scrollDropContentToOption(D)};z.prototype.scrollDropContentToOption=function(C){var A,B;if(this.content.scrollHeight>this.content.clientHeight){A=e(this.content);B=e(C);return this.content.scrollTop=B.top-(A.top-this.content.scrollTop)}};z.prototype.selectHighlightedOption=function(){return this.pickOption(this.drop.querySelector(".select-option-highlight"))};z.prototype.pickOption=function(A,B){var C=this;if(B==null){B=true}this.value=this.select.value=A.getAttribute("data-value");this.triggerChange();if(B){return setTimeout(function(){C.close();return C.target.focus()})}};z.prototype.triggerChange=function(){var A;A=document.createEvent("HTMLEvents");A.initEvent("change",true,false);this.select.dispatchEvent(A);return this.trigger("change",{value:this.select.value})};z.prototype.change=function(B){var A;A=this.findOptionsByValue(B);if(!A.length){throw new Error('Select Error: An option with the value "'+B+"\" doesn't exist")}return this.pickOption(A[0],false)};return z})(o);m.init=function(B){var C,D,A,y,z;if(B==null){B={}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",function(){return m.init(B)});return}if(B.selector==null){B.selector="select"}y=document.querySelectorAll(B.selector);z=[];for(D=0,A=y.length;D<A;D++){C=y[D];if(!C.selectInstance){z.push(new m(v({el:C},B)))}else{z.push(void 0)}}return z};window.Select=m}).call(this);