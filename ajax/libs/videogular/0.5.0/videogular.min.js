"use strict";angular.module("com.2fdevs.videogular",["ngSanitize"]).constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).service("VG_UTILS",function(){this.fixEventOffset=function(a){if(navigator.userAgent.match(/Firefox/i)){var b=a.currentTarget.currentStyle||window.getComputedStyle(a.target,null),c=parseInt(b.borderLeftWidth,10),d=parseInt(b.borderTopWidth,10),e=a.currentTarget.getBoundingClientRect(),f=a.clientX-c-e.left,g=a.clientY-d-e.top;a.offsetX=f,a.offsetY=g}return a},this.getZIndex=function(){var a=1;return angular.element("*").filter(function(){return"auto"!==angular.element(this).css("zIndex")}).each(function(){var b=parseInt(angular.element(this).css("zIndex"));b>a&&(a=b+1)}),a},this.secondsToDate=function(a){var b=new Date;return b.setTime(1e3*a),b},this.isMobileDevice=function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},this.isiOSDevice=function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)}}).run(["$window","VG_UTILS",function(a,b){var c,d={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:void 0,onexit:"webkitendfullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",onchange:"msfullscreenchange",onerror:"msfullscreenerror"}};for(var e in d)if(d[e].enabled in document){c=d[e],c.isFullScreen=function(){return null!=document[this.element]};break}b.isiOSDevice()&&(c=d.ios,c.isFullScreen=function(){return null!=document[this.element]}),angular.element(a)[0].fullScreenAPI=c}]).directive("videogular",["$window","VG_STATES","VG_UTILS",function(a,b,c){return{restrict:"E",scope:{theme:"=vgTheme",autoPlay:"=vgAutoplay",vgComplete:"&",vgUpdateVolume:"&",vgUpdateTime:"&",vgUpdateState:"&",vgPlayerReady:"&",vgChangeSource:"&"},controller:["$scope","$timeout",function(d,e){var f=null,g=!1,h=!1,i=this,j=d.vgComplete(),k=d.vgUpdateVolume(),l=d.vgUpdateTime(),m=d.vgUpdateState(),n=d.vgPlayerReady(),o=d.vgChangeSource();this.onVideoReady=function(a){d.API.isReady=!0,d.API.currentState=b.STOP,d.API.videoElement=angular.element(a.target),h=!0,d.vgPlayerReady()&&(n=d.vgPlayerReady())(i),(d.autoPlay&&!c.isMobileDevice()||d.API.currentState===b.PLAY)&&e(function(){i.play()})},this.onUpdateTime=function(a){d.API.currentTime=c.secondsToDate(a.target.currentTime),d.API.totalTime=c.secondsToDate(a.target.duration),d.API.timeLeft=c.secondsToDate(a.target.duration-a.target.currentTime),d.vgUpdateTime()&&(l=d.vgUpdateTime())(a.target.currentTime,a.target.duration),d.$apply()},this.$on=function(){d.$on.apply(d,arguments)},this.isPlayerReady=function(){return d.API.isReady},this.seekTime=function(a,b){var e;b?(e=a*this.videoElement[0].duration/100,this.videoElement[0].currentTime=e):(e=a,this.videoElement[0].currentTime=e),d.API.currentTime=c.secondsToDate(e)},this.playPause=function(){this.videoElement[0].paused?this.play():this.pause()},this.setState=function(a){return a&&a!=d.API.currentState&&(d.vgUpdateState()&&(m=d.vgUpdateState())(a),d.API.currentState=a),d.API.currentState},this.play=function(){this.videoElement[0].play(),this.setState(b.PLAY)},this.pause=function(){this.videoElement[0].pause(),this.setState(b.PAUSE)},this.stop=function(){this.videoElement[0].pause(),this.videoElement[0].currentTime=0,this.setState(b.STOP)},this.toggleFullScreen=function(){angular.element(a)[0].fullScreenAPI?angular.element(a)[0].fullScreenAPI.isFullScreen()?c.isMobileDevice()||document[angular.element(a)[0].fullScreenAPI.exit]():c.isMobileDevice()?c.isiOSDevice()?h?this.enterElementInFullScreen(this.videoElement[0]):(g=!0,this.play()):this.enterElementInFullScreen(this.videoElement[0]):this.enterElementInFullScreen(this.elementScope[0]):(d.API.isFullScreen?(this.videogularElement.removeClass("fullscreen"),this.videogularElement.css("z-index",0)):(this.videogularElement.addClass("fullscreen"),this.videogularElement.css("z-index",c.getZIndex())),d.API.isFullScreen=!d.API.isFullScreen)},this.enterElementInFullScreen=function(b){b[angular.element(a)[0].fullScreenAPI.request]()},this.changeSource=function(a){d.vgChangeSource()&&(o=d.vgChangeSource())(a)},this.setVolume=function(a){d.vgUpdateVolume()&&(k=d.vgUpdateVolume())(a),this.videoElement[0].volume=a,d.API.volume=a},this.updateTheme=function(a){if(f)for(var b=document.getElementsByTagName("link"),c=0,d=b.length;d>c;c++)b[c].outerHTML.indexOf(f)>=0&&b[c].parentNode.removeChild(b[c]);if(a){var e=angular.element(document).find("head");e.append("<link rel='stylesheet' href='"+a+"'>"),f=a}},this.onStartBuffering=function(){d.API.isBuffering=!0},this.onStartPlaying=function(a){a.target.width++,a.target.width--,d.API.isBuffering=!1},this.onComplete=function(){d.vgComplete()&&(j=d.vgComplete())(),i.setState(b.STOP),d.API.isCompleted=!0,d.$apply()},d.API=this,d.init=function(){d.API.isReady=!1,d.API.isCompleted=!1,d.API.currentTime=0,d.API.totalTime=0,d.API.timeLeft=0,i.updateTheme(d.theme),d.addBindings(),angular.element(a)[0].fullScreenAPI&&document.addEventListener(angular.element(a)[0].fullScreenAPI.onchange,d.onFullScreenChange)},d.addBindings=function(){d.$watch("theme",function(a,b){a!=b&&i.updateTheme(a)}),d.$watch("autoPlay",function(a,b){a!=b&&a&&i.play()})},d.onFullScreenChange=function(){d.API.isFullScreen=angular.element(a)[0].fullScreenAPI.isFullScreen(),d.$apply()},d.init()}],link:{pre:function(a,b,c,d){d.videogularElement=b,d.elementScope=angular.element(b)}}}}]).directive("vgVideo",["$compile",function(a){return{restrict:"E",require:"^videogular",scope:{vgSrc:"="},link:function(b,c,d,e){var f=angular.element('<video vg-source="vgSrc"></video>'),g=a(f)(b);f[0].addEventListener("loadedmetadata",e.onVideoReady,!1),f[0].addEventListener("waiting",e.onStartBuffering,!1),f[0].addEventListener("ended",e.onComplete,!1),f[0].addEventListener("playing",e.onStartPlaying,!1),f[0].addEventListener("timeupdate",e.onUpdateTime,!1),c.append(g)}}}]).directive("vgSource",[function(){return{restrict:"A",link:{pre:function(a,b,c){function d(){if(f="",g[0].canPlayType){for(var a=0,b=e.length;b>a;a++)if(f=g[0].canPlayType(e[a].type),"maybe"==f||"probably"==f){g.attr("src",e[a].src),g.attr("type",e[a].type);break}}else g.attr("src",e[0].src),g.attr("type",e[0].type)}var e,f,g=b;a.$watch(c.vgSource,function(a,b){e&&a==b||!a||(e=a,d())})}}}}]);