"use strict";angular.module("com.2fdevs.videogular",["ngSanitize"]).constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).constant("VG_EVENTS",{ON_PLAY:"onVgPlay",ON_PAUSE:"onVgPause",ON_PLAY_PAUSE:"onVgPlayPause",ON_START_PLAYING:"onVgStartPlaying",ON_COMPLETE:"onVgComplete",ON_SET_STATE:"onVgSetState",ON_SET_VOLUME:"onVgSetVolume",ON_TOGGLE_FULLSCREEN:"onVgToggleFullscreen",ON_ENTER_FULLSCREEN:"onVgEnterFullscreen",ON_EXIT_FULLSCREEN:"onVgExitFullscreen",ON_BUFFERING:"onVgBuffering",ON_UPDATE_TIME:"onVgUpdateTime",ON_SEEK_TIME:"onVgSeekTime",ON_UPDATE_SIZE:"onVgUpdateSize",ON_UPDATE_THEME:"onVgUpdateTheme",ON_PLAYER_READY:"onVgPlayerReady",ON_LOAD_POSTER:"onVgLoadPoster"}).service("VG_UTILS",function(){this.fixEventOffset=function(c){if(navigator.userAgent.match(/Firefox/i)){var d=c.currentTarget.currentStyle||window.getComputedStyle(c.currentTarget,null);var b=parseInt(d.borderLeftWidth,10);var f=parseInt(d.borderTopWidth,10);var e=c.currentTarget.getBoundingClientRect();var a=c.clientX-b-e.left;var g=c.clientY-f-e.top;c.offsetX=a;c.offsetY=g}return c};this.getZIndex=function(){var a=1;$("*").filter(function(){return $(this).css("zIndex")!=="auto"}).each(function(){var b=parseInt($(this).css("zIndex"));if(a<b){a=b+1}});return a};this.isMobileDevice=function(){return(typeof window.orientation!=="undefined")||(navigator.userAgent.indexOf("IEMobile")!==-1)};this.isiOSDevice=function(){return(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))}}).run(["$window","VG_UTILS",function(c,e){var b;var d={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:undefined,onexit:"webkitendfullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"}};for(var a in d){if(d[a].enabled in document){b=d[a];b.isFullScreen=function(){return(document[this.element]!=null)};break}}if(e.isiOSDevice()){b=d.ios;b.isFullScreen=function(){return(document[this.element]!=null)}}angular.element(c)[0].fullScreenAPI=b}]).directive("videogular",["$window","VG_STATES","VG_EVENTS","VG_UTILS",function(c,a,b,d){return{restrict:"E",scope:{playerWidth:"=vgWidth",playerHeight:"=vgHeight",theme:"=vgTheme",autoPlay:"=vgAutoplay",responsive:"=vgResponsive",stretch:"=vgStretch",vgComplete:"&",vgUpdateVolume:"&",vgUpdateTime:"&",vgUpdateSize:"&",vgUpdateState:"&",vgPlayerReady:"&"},controller:function(q){var o=null;var i=null;var f=null;var z=a.STOP;var s=q.stretch;var n=0;var u=0;var p=false;var w=false;var h=false;var j=false;var k=false;var y=false;var m=false;var x=this;var v=q.vgComplete();var e=q.vgUpdateVolume();var g=q.vgUpdateTime();var t=q.vgUpdateSize();var r=q.vgUpdateState();var l=q.vgPlayerReady();this.$on=function(){q.$on.apply(q,arguments)};this.isPlayerReady=function(){return y};this.seekTime=function(A){this.videoElement[0].currentTime=A};this.playPause=function(){if(this.videoElement[0].paused){this.videoElement[0].play();this.setState(a.PLAY);q.$emit(b.ON_PLAY)}else{this.videoElement[0].pause();this.setState(a.PAUSE);q.$emit(b.ON_PAUSE)}};this.setState=function(A){if(A&&A!=z){if(r){r(A)}z=A;q.$emit(b.ON_SET_STATE,[z])}return z};this.play=function(){this.videoElement[0].play();this.setState(a.PLAY);q.$emit(b.ON_PLAY)};this.pause=function(){this.videoElement[0].pause();this.setState(a.PAUSE);q.$emit(b.ON_PAUSE)};this.toggleFullScreen=function(){if(!angular.element(c)[0].fullScreenAPI){if(w){this.videogularElement.removeClass("fullscreen");this.videogularElement.css("z-index",0)}else{this.videogularElement.addClass("fullscreen");this.videogularElement.css("z-index",d.getZIndex())}w=!w;q.updateSize()}else{if(angular.element(c)[0].fullScreenAPI.isFullScreen()){if(!d.isMobileDevice()){document[angular.element(c)[0].fullScreenAPI.exit]()}}else{if(d.isMobileDevice()){if(d.isiOSDevice()){if(h){this.enterElementInFullScreen(this.videoElement[0])}else{p=true;this.play()}}else{this.enterElementInFullScreen(this.videoElement[0])}}else{this.enterElementInFullScreen(this.elementScope[0])}}}};this.enterElementInFullScreen=function(A){A[angular.element(c)[0].fullScreenAPI.request]()};this.setVolume=function(A){if(e){e(A)}this.videoElement[0].volume=A;q.$emit(b.ON_SET_VOLUME,[A])};this.updateTheme=function(E){if(o){var B=document.getElementsByTagName("link");for(var C=0,A=B.length;C<A;C++){if(B[C].outerHTML.indexOf(o)>=0){B[C].parentNode.removeChild(B[C])}}}if(E){var D=angular.element(document).find("head");D.append("<link rel='stylesheet' href='"+E+"'>");o=E}};this.updateStretch=function(A){s=A;q.updateSize()};this.setSize=function(B,A){i=B;f=A;q.updateSize()};this.getSize=function(){return{width:i,height:f}};q.API=this;q.init=function(){x.updateTheme(q.theme);q.addBindings();if(q.playerWidth==undefined||q.playerHeight==undefined||q.responsive==true){m=true;angular.element(c).bind("resize",q.onResizeBrowser)}else{n=q.playerWidth;u=q.playerHeight;x.setSize(n,u)}if(angular.element(c)[0].fullScreenAPI){document.addEventListener(angular.element(c)[0].fullScreenAPI.onchange,q.onFullScreenChange)}};q.addBindings=function(){q.$watch("playerWidth",function(B,A){if(B!=A){x.setSize(B,f)}});q.$watch("playerHeight",function(B,A){if(B!=A){x.setSize(i,B)}});q.$watch("theme",function(B,A){if(B!=A){x.updateTheme(B)}});q.$watch("stretch",function(B,A){if(B!=A){x.updateStretch(B)}});q.$watch("autoPlay",function(B,A){if(B!=A){x.play()}});q.$watch("responsive",function(B,A){if(B!=A){m=B;if(m){angular.element(c).bind("resize",q.onResizeBrowser);q.onResizeBrowser()}else{angular.element(c).unbind("resize",q.onResizeBrowser);i=q.playerWidth;f=q.playerHeight;q.updateSize()}}})};q.onElementReady=function(){j=true;if(k){q.onPlayerReady()}};q.onVideoReady=function(){k=true;if(j){q.onPlayerReady()}};q.onPlayerReady=function(){x.videoElement[0].addEventListener("loadedmetadata",q.onLoadedMetaData);q.doPlayerReady()};q.onLoadedMetaData=function(){h=true;q.doPlayerReady()};q.doPlayerReady=function(){if(m){var B=x.elementScope[0].parentNode.clientWidth*100/x.videoElement[0].videoWidth;var A=x.videoElement[0].videoHeight*B/100;i=x.elementScope[0].parentNode.clientWidth;f=A}y=true;q.updateSize();if(l){l(x)}q.$emit(b.ON_PLAYER_READY);if(q.autoPlay&&!d.isMobileDevice()||z===a.PLAY){x.play()}};q.updateSize=function(){if(y){var B;var A;var C;if(angular.element(c)[0].fullScreenAPI&&angular.element(c)[0].fullScreenAPI.isFullScreen()||w){x.elementScope.css("width",parseInt(window.screen.width,10)+"px");x.elementScope.css("height",parseInt(window.screen.height,10)+"px");B=q.getVideoSize(window.screen.width,window.screen.height);if(w){n=c.innerWidth;u=c.innerHeight}else{n=c.screen.width;u=c.screen.height}}else{x.elementScope.css("width",parseInt(i,10)+"px");x.elementScope.css("height",parseInt(f,10)+"px");B=q.getVideoSize(i,f);n=i;u=f}if(f==0||isNaN(f)){n=B.width;u=B.height}if(B.width==0){B.width=i}if(B.height==0){B.height=f}C=(n-B.width)/2;A=(u-B.height)/2;x.videoElement.attr("width",parseInt(B.width,10));x.videoElement.attr("height",parseInt(B.height,10));x.videoElement.css("width",parseInt(B.width,10)+"px");x.videoElement.css("height",parseInt(B.height,10));x.videoElement.css("top",A+"px");x.videoElement.css("left",C+"px");x.elementScope.css("width",parseInt(n,10)+"px");x.elementScope.css("height",parseInt(u,10)+"px");if(t){t(n,u)}q.$emit(b.ON_UPDATE_SIZE,[n,u])}};q.onResizeBrowser=function(){var B=x.elementScope[0].parentNode.clientWidth*100/x.videoElement[0].videoWidth;var A=x.videoElement[0].videoHeight*B/100;i=x.elementScope[0].parentNode.clientWidth;f=A;q.updateSize()};q.onFullScreenChange=function(A){if(angular.element(c)[0].fullScreenAPI.isFullScreen()){q.$emit(b.ON_ENTER_FULLSCREEN)}else{q.$emit(b.ON_EXIT_FULLSCREEN)}q.updateSize();q.$apply()};q.onComplete=function(A){if(v){v()}x.setState(a.STOP);q.$emit(b.ON_COMPLETE);q.$apply()};q.onStartBuffering=function(A){q.$emit(b.ON_BUFFERING);q.$apply()};q.onStartPlaying=function(A){A.target.width++;A.target.width--;q.$emit(b.ON_START_PLAYING,[A.target.duration]);q.$apply()};q.onUpdateTime=function(A){if(g){g(A.target.currentTime,A.target.duration)}q.$emit(b.ON_UPDATE_TIME,[A.target.currentTime,A.target.duration]);q.$apply()};q.getVideoSize=function(B,D){var C;var E;var A={};var F=x.videoElement[0].videoWidth/x.videoElement[0].videoHeight>B/D;A.width=B;A.height=D;if(s=="fit"&&F||s=="fill"&&!F){C=B*100/x.videoElement[0].videoWidth;A.height=x.videoElement[0].videoHeight*C/100}else{if(s=="fill"&&F||s=="fit"&&!F){E=D*100/x.videoElement[0].videoHeight;A.width=x.videoElement[0].videoWidth*E/100}else{A.width=x.videoElement[0].videoWidth;A.height=x.videoElement[0].videoHeight}}if(A.height==0||isNaN(A.height)){A.width=x.elementScope[0].parentElement.clientWidth;A.height=A.width*9/16}return A};q.init()},link:{pre:function(g,h,e,f){f.videogularElement=h;f.elementScope=angular.element(h);f.videoElement=f.elementScope.find("video");f.videoElement[0].addEventListener("waiting",g.onStartBuffering,false);f.videoElement[0].addEventListener("ended",g.onComplete,false);f.videoElement[0].addEventListener("playing",g.onStartPlaying,false);f.videoElement[0].addEventListener("timeupdate",g.onUpdateTime,false);f.elementScope.ready(g.onElementReady);f.videoElement.ready(g.onVideoReady)}}}}]);