angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(e,t,n,r){return function(i,s,o){s.attr("draggable","true");if(o.dndDisableIf){i.$watch(o.dndDisableIf,function(e){s.attr("draggable",!e)})}s.on("dragstart",function(e){e=e.originalEvent||e;e.dataTransfer.setData("Text",angular.toJson(i.$eval(o.dndDraggable)));e.dataTransfer.effectAllowed=o.dndEffectAllowed||"move";s.addClass("dndDragging");t(function(){s.addClass("dndDraggingSource")},0);n.dropEffect="none";r.isDragging=true;r.dragType=o.dndType?i.$eval(o.dndType):undefined;e.stopPropagation()});s.on("dragend",function(t){t=t.originalEvent||t;var u=t.dataTransfer.dropEffect!=="none"?t.dataTransfer.dropEffect:n.dropEffect;i.$apply(function(){switch(u){case"move":e(o.dndMoved)(i);break;case"copy":e(o.dndCopied)(i);break}});s.removeClass("dndDragging");s.removeClass("dndDraggingSource");r.isDragging=false;t.stopPropagation()});s.on("click",function(t){t=t.originalEvent||t;i.$apply(function(){e(o.dndSelected)(i)});t.stopPropagation()});s.on("selectstart",function(){if(this.dragDrop)this.dragDrop();return false})}}]).directive("dndList",["$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(e,t,n){return function(r,i,s){function f(e){if(!e)return true;for(var t=0;t<e.length;t++){if(e[t]==="Text"||e[t]==="text/plain")return true}return false}var o=angular.element("<li class='dndPlaceholder'></li>");var u=o[0];var a=i[0];i.on("dragover",function(e){e=e.originalEvent||e;if(!n.isDragging)return true;if(!f(e.dataTransfer.types))return true;if(s.dndAllowedTypes){var t=r.$eval(s.dndAllowedTypes);if(angular.isArray(t)&&t.indexOf(n.dragType)===-1){return true}}if(s.dndDisableIf&&r.$eval(s.dndDisableIf))return true;if(u.parentNode!=a){i.append(o)}if(e.target.parentNode===a&&e.target!==u){var l=(e.offsetY||e.layerY)<e.target.offsetHeight/2;a.insertBefore(u,l?e.target:e.target.nextSibling)}else if(e.target===a){if(e.offsetY<u.offsetTop){while(u.previousElementSibling&&(u.previousElementSibling.offsetHeight===0||e.offsetY<u.previousElementSibling.offsetTop+u.previousElementSibling.offsetHeight/2)){a.insertBefore(u,u.previousElementSibling)}}else{while(u.nextElementSibling&&e.offsetY>u.nextElementSibling.offsetTop+u.nextElementSibling.offsetHeight/2){a.insertBefore(u,u.nextElementSibling.nextElementSibling)}}}i.addClass("dndDragover");e.preventDefault();e.stopPropagation();return false});i.on("drop",function(e){e=e.originalEvent||e;var n=JSON.parse(e.dataTransfer.getData("Text")||e.dataTransfer.getData("text/plain"));var f=r.$eval(s.dndList);var l=Array.prototype.indexOf.call(a.children,u);r.$apply(function(){f.splice(l,0,n)});if(e.dataTransfer.dropEffect==="none"){t.dropEffect=e.dataTransfer.effectAllowed==="copyMove"?e.ctrlKey?"copy":"move":e.dataTransfer.effectAllowed}o.remove();i.removeClass("dndDragover");e.preventDefault();e.stopPropagation();return false});i.on("dragleave",function(t){t=t.originalEvent||t;i.removeClass("dndDragover");e(function(){if(!i.hasClass("dndDragover")){o.remove()}},100)})}}]).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}})
