/*!
	photobox v1.4.5
	(c) 2012 Yair Even Or <http://dropthebit.com>

	based (~12%) on Picbox v2.2 from:
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(b,k){function R(a){a.preventDefault();m.removeClass("active");m=b(this).parent().addClass("active");a=b.inArray(this,b(a.delegateTarget).data("a"));return B(a,0,1)}function H(a){a&&(d.src=I);b(d).css({transition:"0s"}).removeAttr("style");b(f).show().addClass("show");b(f).on("click","img",function(a){a.stopPropagation()});b(f).on(q,function(){b(d).addClass("zoomable");b(f).off(q).addClass("on")});C&&b(f).trigger("MSTransitionEnd");g.hideFlash&&b.each(["object","embed"],function(c,h){b(h).each(function(){a&& (this._picbox=this.style.visibility);this.style.visibility=a?"hidden":this._picbox})});b(k)[a?"on":"off"]({"keydown.photobox":S,"mousewheel.photobox":T});g.thumbs&&(m.removeAttr("class"),b(U).on("resize.photobox",J),J())}function J(){D=e[0].clientWidth;E=e[0].firstChild.clientWidth;var a=E>D?"on":"off";!K&&e[a]("mousemove",V)}function V(a){e[0].scrollLeft=a.pageX*(E/D)-500}function S(a){a=a.keyCode;var b=g.keys;return 0<=b.close.indexOf(a)&&F()||0<=b.next.indexOf(a)&&x("next")||0<=b.prev.indexOf(a)&& x("prev")||!0}function x(a){if(b(pbOverlay).hasClass("hide"))return!1;a="pbPrevBtn"==this.id||"prev"==a?r:s;var c="both"==e.css("clear");return B(a,0,c)}function B(a,c,h){0<=a&&(t=a,y=j[a][0],r=(t||(g.loop?j.length:0))-1,s=(t+1)%j.length||(g.loop?0:-1),L(),b(f).addClass("pbLoading").removeClass("error"),!g.loop&&a==j.length-1?z.addClass("hide"):z.removeClass("hide"),!g.loop&&0==a?A.addClass("hide"):A.removeClass("hide"),g.thumbs&&(m.removeClass("active"),m=e.find("li").eq(a).addClass("active"),h|| (h=m[0].offsetLeft+m[0].clientWidth/2-l.clientWidth/2,c&&e.delay(800),!c&&e.stop(),e.animate({scrollLeft:h},500,"swing"))),0<=r&&(M.src=j[r][0]),0<=s&&(N.src=j[s][0]),g.counter&&u.find(".counter").text("( "+(t+1)+" / "+j.length+" )"),g.title&&u.find(".title").text(j[a][1]),b(d).siblings().hide(),n=new Image,n.onload=function(){var a=function(){b(d).css({transition:"0s"}).attr("class","prepare").hide().off(q);b(f).removeClass("hide");d.src=y;setTimeout(function(){b(d).removeAttr("style");setTimeout(function(){d.className= ""},0)},0)};c?a():(b(f).addClass("hide"),b(d).on(q,a),"0"==b(d).css("opacity")&&a());b(f).removeClass("pbLoading")},n.onerror=function(){b(f).removeClass("pbLoading").addClass("error");d.src=I;n.onerror=null},n.src=y);return!1}function T(a,c){var h=b(d).data("zoom")||1,O=d.getBoundingClientRect(),h=h+c/10;0.1>h&&(h=0.1);b(d).data("zoom",h).css({transform:"scale("+h+")"});if(O.height>l.clientHeight||O.width>l.clientWidth)b(k).on("mousemove.photobox",W);else b(k).off("mousemove.photobox"),d.style[v]= "50% 50%";return!1}function W(a){var b=100*((a.clientY/l.clientHeight*(l.clientHeight+200)-100)/l.clientHeight);a=(100*(a.clientX/l.clientWidth)).toFixed(2)+"% "+b.toFixed(2)+"%";d.style[v]=a}function L(){n.onload=function(){};n.src=M.src=N.src=y}function F(){function a(){b(f).removeClass("show hide on");b(d).removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom",1);X&&setTimeout(function(){b(f).hide()},200)}L();t=r=s=-1;b(document).off("mousemove");H();b(f).addClass("hide"); b(d).on(q,a);C&&a();setTimeout(a,500);return!1}function G(a){var c=a||window.event,h=[].slice.call(arguments,1),d=0,f=0,e=0;a=b.event.fix(c);a.type="mousewheel";c.wheelDelta&&(d=c.wheelDelta/120);c.detail&&(d=-c.detail/3);e=d;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(e=0,f=-1*d);void 0!==c.wheelDeltaY&&(e=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120);h.unshift(a,d,f,e);return(b.event.dispatch||b.event.handle).apply(this,h)}var U=b(window),g,j=[],e,w,t=-1,y,r,s,l,q="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", C=!("placeholder"in document.createElement("input")),X=!!window.ActiveXObject,K="ontouchend"in document,v,D,E,m=b(),I="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",n={},M=new Image,N=new Image,f,d,A,z,u,P={loop:!0,thumbs:!0,counter:!0,title:!0,hideFlash:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}};b(k).ready(function(){b(k.body).prepend(b([f=b('<div id="pbOverlay">').hide().on("click",F).append(b('<div class="pbLoader"><b></b><b></b><b></b></div>'), A=b('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",x),z=b('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",x),imageWrap=b('<div class="imageWrap">').append(d=b("<img>")[0])[0],b('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",F)[0],u=b('<div id="pbCaption">').append('<div class="title">').append('<div class="counter">'))[0]]));a:{var a="transformOrigin",c,e=k.body.style,g=["ms","O","Moz","Webkit"];if(""==e[a])v=a;else{a=a[0].toUpperCase()+a.slice(1);for(c= g.length;c--;)if(""==e[g[c]+a]){v=g[c]+a;break a}v=void 0}}});b.photobox=function(a,c){g=b.extend(P,c||{});C&&b(f).addClass("msie");H(1);2>j.length&&u.find(".counter").remove();return B(a,!0)};b.fn.photobox=function(a){w=this;w=w.filter(function(){var a=this.firstElementChild||this.children[0];if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;j.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0});if(P.thumbs||a.thumbs){var c=w;e=b("<div>").addClass("pbThumbs");K&&e.css("overflow", "auto");var d=b("<ul>").appendTo(e),g;c.each(function(){g=k.createElement("a");g.href=this.href;g.appendChild(b(this.children[0]).clone()[0]);b("<li>").append(g).appendTo(d)});e.appendTo(u);b(f).addClass("thumbs");e.on("click","a",R).data("a",e.find("a"))}b(this.context).on("click",this.selector,function(c){c.preventDefault();2>j.length&&A.add(z).remove();l=k.documentElement;return b.photobox(b.inArray(this,w),a)});return this};var p=["DOMMouseScroll","mousewheel"];if(b.event.fixHooks)for(var Q=p.length;Q;)b.event.fixHooks[p[--Q]]= b.event.mouseHooks;b.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=p.length;a;)this.addEventListener(p[--a],G,!1);else this.onmousewheel=G},teardown:function(){if(this.removeEventListener)for(var a=p.length;a;)this.removeEventListener(p[--a],G,!1);else this.onmousewheel=null}};b.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery,document);