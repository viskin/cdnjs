/*!
	photobox v1.5
	(c) 2012 Yair Even Or <http://dropthebit.com>

	based (~12%) on Picbox v2.2 from:
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(c,j){function J(a){var b,c=j.createElement("p").style,d=["ms","O","Moz","Webkit"];if(""==c[a])return a;a=a[0].toUpperCase()+a.slice(1);for(b=d.length;b--;)if(""==c[d[b]+a])return d[b]+a}function K(a){a&&(e[0].src=L,e.css({transition:"0s"}).removeAttr("style"),f.show().addClass("show"),f.on("click","img",function(a){a.stopPropagation()}),f.on(p,function(){f.off(p).addClass("on")}),q&&f.trigger("MSTransitionEnd"),d.thumbs&&(r.removeAttr("class"),c(X).on("resize.photobox",M),M()));d.hideFlash&& c.each(["object","embed"],function(b,k){c(k).each(function(){a&&(this._photobox=this.style.visibility);this.style.visibility=a?"hidden":this._photobox})});c(j)[a?"on":"off"]({"keydown.photobox":Y,"mousewheel.photobox":Z})}function M(){B=g[0].clientWidth;C=g[0].firstChild.clientWidth;var a=C>B?"on":"off";!N&&g[a]("mousemove",$)}function $(a){g[0].scrollLeft=a.pageX*(C/B)-500}function Y(a){a=a.keyCode;var b=d.keys;return 0<=b.close.indexOf(a)&&O()||0<=b.next.indexOf(a)&&v("next")||0<=b.prev.indexOf(a)&& v("prev")||!0}function v(a){if(f.hasClass("hide"))return!1;a="pbPrevBtn"==this.id||"prev"==a?w:u;var b="both"==g.css("clear");x(a,0,b);return!1}function x(a,b,c){if(!a||0>a)a=0;y=a;z=m[a][0];w=(y||(d.loop?m.length:0))-1;u=(y+1)%m.length||(d.loop?0:-1);P();f.addClass("pbLoading").removeClass("error");!d.loop&&a==m.length-1?D.addClass("hide"):D.removeClass("hide");!d.loop&&0==a?E.addClass("hide"):E.removeClass("hide");if(d.thumbs){var W=a;r.removeClass("active");r=g.find("li").eq(W).addClass("active"); c||(c=r[0].offsetLeft+r[0].clientWidth/2-n.clientWidth/2,b&&g.delay(800),!b&&g.stop(),g.animate({scrollLeft:c},500,"swing"))}0<=w&&(Q.src=m[w][0]);0<=u&&(R.src=m[u][0]);d.counter&&F.find(".counter").text("( "+(y+1)+" / "+m.length+" )");d.title&&F.find(".title").text(m[a][1]);q&&f.addClass("hide");d.autoplay&&h.progress.reset();s=new Image;s.onload=function(){var a=function(){e.off(p).css({transition:"0s"});e[0].src=z;e[0].className="prepare";setTimeout(function(){f.removeClass("hide");e.removeAttr("style").prop("class", "");setTimeout(function(){e[0].className="";e.on(p,S);q&&S()},0)},50)};f.removeClass("pbLoading").addClass("hide");e.removeClass("zoomable");b?a():(e.on(p,a),q&&a())};s.onerror=function(){f.removeClass("pbLoading").addClass("error");e[0].src=L;s.onerror=null};s.src=z}function S(){e.off(p);e.addClass("zoomable");l&&d.autoplay&&h.play()}function Z(a,b){var k=e.data("zoom")||1,d=e[0].getBoundingClientRect(),k=k+b/10;0.1>k&&(k=0.1);e.data("zoom",k).css({transform:"scale("+k+")"});if(d.height>n.clientHeight|| d.width>n.clientWidth)c(j).on("mousemove.photobox",aa);else c(j).off("mousemove.photobox"),e[0].style[T]="50% 50%";return!1}function aa(a){var b=100*((a.clientY/n.clientHeight*(n.clientHeight+200)-100)/n.clientHeight);a=(100*(a.clientX/n.clientWidth)).toFixed(2)+"% "+b.toFixed(2)+"%";e[0].style[T]=a}function P(){clearTimeout(G);c(j).off("mousemove.photobox");s.onload=function(){};s.src=Q.src=R.src=z}function O(){function a(){f.removeClass("show on hide");e.removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom", 1);ba&&setTimeout(function(){f.hide()},200)}P();K();f.removeClass("on").addClass("hide");e.on(p,a);q&&a();setTimeout(a,500);return!1}function H(a){var b=a||window.event,k=[].slice.call(arguments,1),d=0,e=0,f=0;a=c.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);f=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);k.unshift(a,d,e,f);return(c.event.dispatch|| c.event.handle).apply(this,k)}var X=c(window),I,d,m=[],y=-1,z,w,u,G=!1,A,n,h,p="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",q=!("placeholder"in j.createElement("input")),ba=!!window.ActiveXObject,N="ontouchend"in j,B,C,r=c(),L="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",T=J("transformOrigin"),ca=J("transition"),s={},Q=new Image,R=new Image,e,E,D,F,l,g,da={loop:!0,thumbs:!0,counter:!0,title:!0,autoplay:!1,time:3E3,hideFlash:!0,keys:{close:"27, 88, 67", prev:"37, 80",next:"39, 78"}},f=c('<div id="pbOverlay">').hide().append(c('<div class="pbLoader"><b></b><b></b><b></b></div>'),E=c('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",v),D=c('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",v),imageWrap=c('<div class="imageWrap">').append(e=c("<img>"))[0],c('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",O)[0],l=c('<div id="pbAutoplayBtn">').append(c('<div class="pbProgress">')),F=c('<div id="pbCaption">').append('<div class="title"><div class="counter">', g=c("<div>").addClass("pbThumbs")));c(j).ready(function(){q&&f.addClass("msie");l.on("click",h.toggle);g.on("click","a",A.click);N&&g.css("overflow","auto");c(j.body).prepend(c(f));n=j.documentElement});c.fn.photobox=function(a,b){"string"!=typeof a&&(a="a");var d=c.extend({},da,b||{});(new I(d,this,a)).init();return this};I=function(a,b,d){this.options=c.extend({},a);this.target=d;this.selector=c(b||j);this.thumbsList=null;a=this.imageLinksFilter(b.find(d));this.imageLinks=a[0];this.images=a[1]}; var U=window.MutationObserver||window.WebKitMutationObserver,ea=window.addEventListener;I.prototype={init:function(){var a=this;this.selector.data("_photobox",this);this.options.thumbs&&(this.thumbsList=A.generate(this.imageLinks));this.selector.on("click.photobox",this.target,function(b){b.preventDefault();a.open(this)});this.observerTimeout=null;1==this.selector[0].nodeType&&this.observeDOM(this.selector[0],function(){clearTimeout(this.observerTimeout);this.observerTimeout=setTimeout(function(){var b= a.imageLinksFilter(a.selector.find(a.target));a.imageLinks=b[0];a.images=b[1];a.thumbsList=A.generate(a.imageLinks)},50)})},open:function(a){a=c.inArray(a,this.imageLinks);if(-1==a)return!1;d=this.options;m=this.images;g.html(this.thumbsList);f[d.thumbs?"addClass":"removeClass"]("thumbs");2>this.images.length?f.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(f.addClass("hasArrows hasCounter"),1E3<d.time?(f.addClass("hasAutoplay"),d.autoplay?h.progress.start():h.pause()):f.removeClass("hasAutoplay")); K(1);return x(a,!0)},imageLinksFilter:function(a){var b=[];return[a.filter(function(){var a=this.firstElementChild||this.children[0];if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;b.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0}),b]},observeDOM:function(a,b){U?(new U(function(a){(a[0].addedNodes.length||a[0].removedNodes.length)&&b()})).observe(a,{childList:!0,subtree:!0}):ea&&(a.addEventListener("DOMNodeInserted",b,!1),a.addEventListener("DOMNodeRemoved",b, !1))}};A={generate:function(a){var b=c("<ul>"),d,f=[],e,g;for(e=a.toArray().length;e--;)d=a[e],g=d.children[0].title||d.children[0].alt||"",f.push('<li><a href="'+d.href+'"><img src="'+d.children[0].src+'" alt="" title="'+g+'" /></a></li>');b.html(f.reverse().join(""));return b},click:function(a){a.preventDefault();r.removeClass("active");r=c(this).parent().addClass("active");a=c(this.parentNode).index();return x(a,0,1)}};h={play:function(){G=setTimeout(function(){x(u)},d.time);h.progress.start(); l.removeClass("play");h.setTitle("Click to stop autoplay");d.autoplay=!0},pause:function(){clearTimeout(G);h.progress.reset();l.addClass("play");h.setTitle("Click to resume autoplay");d.autoplay=!1},progress:{reset:function(){l.find("div").removeAttr("style");setTimeout(function(){l.removeClass("playing")},200)},start:function(){q||l.find("div").css(ca,d.time+"ms");l.addClass("playing")}},setTitle:function(a){a&&l.prop("title",a+" (every "+d.time/1E3+" seconds)")},toggle:function(a){a.stopPropagation(); d.autoplay?h.pause():h.play()}};var t=["DOMMouseScroll","mousewheel"];if(c.event.fixHooks)for(var V=t.length;V;)c.event.fixHooks[t[--V]]=c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=t.length;a;)this.addEventListener(t[--a],H,!1);else this.onmousewheel=H},teardown:function(){if(this.removeEventListener)for(var a=t.length;a;)this.removeEventListener(t[--a],H,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel", a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery,document);