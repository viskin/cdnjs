/*!
	photobox v1.6.5
	(c) 2012 Yair Even Or <http://dropthebit.com>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(c){function N(a){var b,g=k.createElement("p").style,c=["ms","O","Moz","Webkit"];if(""==g[a])return a;a=a[0].toUpperCase()+a.slice(1);for(b=c.length;b--;)if(""==g[c[b]+a])return c[b]+a}function Z(a){a=a.keyCode;var b=d.keys;return 0<=b.close.indexOf(a)&&G()||0<=b.next.indexOf(a)&&v(w)||0<=b.prev.indexOf(a)&&v(A)||!0}function O(){v("pbPrevBtn"==this.id?A:w);return!1}function v(a,b,g){if(e.hasClass("hide"))return!1;if(!a||0>a)a=0;B=a;x=l[a][0];A=(B||(d.loop?l.length:0))-1;w=(B+1)%l.length|| (d.loop?0:-1);P();e.addClass("pbLoading").removeClass("error");!d.loop&&a==l.length-1?H.addClass("hide"):H.removeClass("hide");!d.loop&&0==a?I.addClass("hide"):I.removeClass("hide");d.thumbs&&n.changeActive(a,b,g);0<=A&&(Q.src=l[A][0]);0<=w&&(R.src=l[w][0]);d.counter&&C.find(".counter").text("( "+(B+1)+" / "+l.length+" )");d.title&&C.find(".title").text(l[a][1]);r&&e.addClass("hide");d.autoplay&&h.progress.reset();s=new Image;s.onload=function(){var a=function(){f.off(t).css({transition:"0s"});f[0].src= x;f[0].className="prepare";setTimeout(function(){e.removeClass("hide");f.removeAttr("style").prop("class","");setTimeout(function(){f[0].className="";f.on(t,S);r&&S()},0)},50)};e.removeClass("pbLoading").addClass("hide");f.removeClass("zoomable");b?a():(f.on(t,a),r&&a())};s.onerror=function(){e.removeClass("pbLoading").addClass("error");f[0].src=T;s.onerror=null};s.src=x;D.save()}function S(){f.off(t);f.addClass("zoomable");m&&d.autoplay&&h.play();"function"==typeof E.callback&&E.callback()}function $(a, b){var g=f.data("zoom")||1,d=f[0].getBoundingClientRect(),g=g+b/10;0.1>g&&(g=0.1);f.data("zoom",g).css({transform:"scale("+g+")"});if(d.height>p.clientHeight||d.width>p.clientWidth)c(k).on("mousemove.photobox",aa);else c(k).off("mousemove.photobox"),f[0].style[U]="50% 50%";return!1}function ba(a,b){a.preventDefault();var g=E.thumbsList;g.css("height",g[0].clientHeight+10*b);g=C[0].clientHeight/2;J[0].style.cssText="margin-top: -"+g+"px; padding: "+g+"px 0;";j.hide().show(0);n.calc()}function aa(a){var b= 100*((a.clientY/p.clientHeight*(p.clientHeight+200)-100)/p.clientHeight);a=(100*(a.clientX/p.clientWidth)).toFixed(2)+"% "+b.toFixed(2)+"%";f[0].style[U]=a}function P(){clearTimeout(h.autoPlayTimer);c(k).off("mousemove.photobox");s.onload=function(){};s.src=Q.src=R.src=x}function G(){function a(){""!=e[0].className&&(e.removeClass("show hide"),f.removeAttr("class").removeAttr("style").off().data("zoom",1),ca&&setTimeout(function(){e.hide()},200))}P();F.prototype.setup();D.clear();e.removeClass("on").addClass("hide"); f.on(t,a);r&&a();setTimeout(a,500)}function K(a){var b=a||u.event,g=[].slice.call(arguments,1),d=0,e=0,f=0;a=c.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);f=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);g.unshift(a,d,e,f);return(c.event.dispatch||c.event.handle).apply(this,g)}var k=document,u=window,F,y=[],E,d,l=[],B=-1,x,A,w,n,p,h,t="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", r=!("placeholder"in k.createElement("input")),ca=!!u.ActiveXObject,V="ontouchend"in k,L,M,q=c(),T="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",U=N("transformOrigin"),da=N("transition"),s={},Q=new Image,R=new Image,f,I,H,C,m,j,J,ea={loop:!0,thumbs:!0,counter:!0,title:!0,autoplay:!1,time:3E3,history:!0,hideFlash:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}},e=c('<div id="pbOverlay">').hide().append(c('<div class="pbLoader"><b></b><b></b><b></b></div>'), J=c('<div class="imageWrap">').append(f=c("<img>"),I=c('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",O),H=c('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",O)),c('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",G)[0],m=c('<div id="pbAutoplayBtn">').append(c('<div class="pbProgress">')),C=c('<div id="pbCaption">').append('<div class="title"></div><div class="counter">',j=c("<div>").addClass("pbThumbs")));c(k).ready(function(){r&&e.addClass("msie");m.on("click", h.toggle);j.on("click","a",n.click);V&&j.css("overflow","auto");e.on("click","img",function(a){a.stopPropagation()});c(k.body).prepend(c(e));p=k.documentElement});c.fn.photobox=function(a,b,g){"string"!=typeof a&&(a="a");b=c.extend({},ea,b||{});a=new F(b,this,a);a.callback=g;y.push(a);D.load();return this};F=function(a,b,g){this.options=c.extend({},a);this.target=g;this.selector=c(b||k);this.thumbsList=null;a=this.imageLinksFilter(b.find(g));this.imageLinks=a[0];this.images=a[1];this.init()};var W= u.MutationObserver||u.WebKitMutationObserver,fa=u.addEventListener;F.prototype={init:function(){var a=this;this.selector.data("_photobox",this);this.options.thumbs&&(this.thumbsList=n.generate(this.imageLinks));this.selector.on("click.photobox",this.target,function(b){b.preventDefault();a.open(this)});this.observerTimeout=null;1==this.selector[0].nodeType&&this.observeDOM(this.selector[0],function(){clearTimeout(this.observerTimeout);this.observerTimeout=setTimeout(function(){var b=a.imageLinksFilter(a.selector.find(a.target)); a.imageLinks=b[0];a.images=b[1];a.thumbsList=n.generate(a.imageLinks)},50)})},open:function(a){a=c.inArray(a,this.imageLinks);if(-1==a)return!1;d=this.options;l=this.images;E=this;this.setup(1);return v(a,!0)},imageLinksFilter:function(a){var b=[];return[a.filter(function(){var a=this.firstElementChild||this.children[0];if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;b.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0}),b]},observeDOM:function(a,b){W?(new W(function(a){(a[0].addedNodes.length|| a[0].removedNodes.length)&&b()})).observe(a,{childList:!0,subtree:!0}):fa&&(a.addEventListener("DOMNodeInserted",b,!1),a.addEventListener("DOMNodeRemoved",b,!1))},setup:function(a){var b=a?"on":"off";a?(f[0].src=T,f.css({transition:"0s"}).removeAttr("style"),e.show(),j.html(this.thumbsList),e[d.thumbs?"addClass":"removeClass"]("thumbs"),d.thumbs&&(q.removeAttr("class"),c(u).on("resize.photobox",n.calc),n.calc()),2>this.images.length?e.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(e.addClass("hasArrows hasCounter"), 1E3<d.time?(e.addClass("hasAutoplay"),d.autoplay?h.progress.start():h.pause()):e.removeClass("hasAutoplay")),e.on(t,function(){e.off(t).addClass("on")}).addClass("show"),r&&e.trigger("MSTransitionEnd")):c(u).off("resize.photobox");d.hideFlash&&c.each(["object","embed"],function(b,d){c(d).each(function(){a&&(this._photobox=this.style.visibility);this.style.visibility=a?"hidden":this._photobox})});c(k)[b]({"keydown.photobox":Z});J[b]({"mousewheel.photobox":$});j[b]({"mousewheel.photobox":ba})}};n={generate:function(a){var b= c("<ul>"),d,e=[],f,h;for(f=a.toArray().length;f--;)d=a[f],h=d.children[0].title||d.children[0].alt||"",e.push('<li><a href="'+d.href+'"><img src="'+d.children[0].src+'" alt="" title="'+h+'" /></a></li>');b.html(e.reverse().join(""));return b},click:function(a){a.preventDefault();q.removeClass("active");q=c(this).parent().addClass("active");a=c(this.parentNode).index();return v(a,0,1)},changeActiveTimeout:null,changeActive:function(a,b,c){q.index();q.removeClass("active");q=j.find("li").eq(a).addClass("active"); c||(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var a=q[0].offsetLeft+q[0].clientWidth/2-p.clientWidth/2;b?j.delay(800):j.stop();j.animate({scrollLeft:a},500,"swing")},200))},calc:function(){L=j[0].clientWidth;M=j[0].firstChild.clientWidth;var a=M>L?"on":"off";!V&&j[a]("mousemove",n.move);return this},move:function(a){j[0].scrollLeft=a.pageX*(M/L)-500}};h={autoPlayTimer:!1,play:function(){h.autoPlayTimer=setTimeout(function(){v(w)},d.time);h.progress.start(); m.removeClass("play");h.setTitle("Click to stop autoplay");d.autoplay=!0},pause:function(){clearTimeout(h.autoPlayTimer);h.progress.reset();m.addClass("play");h.setTitle("Click to resume autoplay");d.autoplay=!1},progress:{reset:function(){m.find("div").removeAttr("style");setTimeout(function(){m.removeClass("playing")},200)},start:function(){r||m.find("div").css(da,d.time+"ms");m.addClass("playing")}},setTitle:function(a){a&&m.prop("title",a+" (every "+d.time/1E3+" seconds)")},toggle:function(a){a.stopPropagation(); h[d.autoplay?"pause":"play"]()}};var D={save:function(){"pushState"in window.history&&(decodeURIComponent(window.location.hash.slice(1))!=x&&d.history)&&window.history.pushState("photobox",k.title+"-"+l[B][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(x))},load:function(){if(d&&!d.history)return!1;var a=decodeURIComponent(window.location.hash.slice(1)),b,c;if(!a&&e.hasClass("show"))G();else for(b=0;b<y.length;b++)for(c in y[b].images)if(y[b].images[c][0]==a)return y[b].open(y[b].imageLinks[c]), !0},clear:function(){d.history&&"pushState"in window.history&&window.history.pushState("photobox",k.title,window.location.pathname+window.location.search)}},X=window.onpopstate;window.onpopstate=function(a){X&&X.apply(this,arguments);"photobox"==a.state&&D.load()};var z=["DOMMouseScroll","mousewheel"];if(c.event.fixHooks)for(var Y=z.length;Y;)c.event.fixHooks[z[--Y]]=c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=z.length;a;)this.addEventListener(z[--a], K,!1);else this.onmousewheel=K},teardown:function(){if(this.removeEventListener)for(var a=z.length;a;)this.removeEventListener(z[--a],K,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);