var __extends=this.__extends||function(a,b){function g(){this.constructor=a}for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);g.prototype=b.prototype;a.prototype=new g};function JL(a){if(!a)return JL.__;var b="";return("."+a).split(".").reduce(function(a,e,h,f){b=b?b+("."+e):e;e=a["__"+b];void 0===e&&(JL.Logger.prototype=a,e=new JL.Logger(b),a["__"+b]=e);return e},JL.__)}
(function(a){function b(a,c,b){void 0!==c[a]&&(null===c[a]?delete b[a]:b[a]=c[a])}function g(d){if(null!=a.enabled&&!a.enabled||null!=a.maxMessages&&1>a.maxMessages)return!1;try{if(d.userAgentRegex&&!RegExp(d.userAgentRegex).test(navigator.userAgent))return!1}catch(c){}try{if(d.ipRegex&&a.clientIP&&!RegExp(d.ipRegex).test(a.clientIP))return!1}catch(b){}return!0}function e(a,c){try{if(a.disallow&&RegExp(a.disallow).test(c))return!1}catch(b){}return!0}a.enabled;a.maxMessages;a.clientIP;a.requestId;
a.setOptions=function(a){b("enabled",a,this);b("maxMessages",a,this);b("clientIP",a,this);b("requestId",a,this);return this};a.getAllLevel=function(){return-2147483648};a.getTraceLevel=function(){return 1E3};a.getDebugLevel=function(){return 2E3};a.getInfoLevel=function(){return 3E3};a.getWarnLevel=function(){return 4E3};a.getErrorLevel=function(){return 5E3};a.getFatalLevel=function(){return 6E3};a.getOffLevel=function(){return 2147483647};var h=function(){return function(a,c,b,l){this.l=a;this.m=
c;this.n=b;this.t=l}}();a.LogItem=h;var f=function(){function d(c,b){this.appenderName=c;this.sendLogItems=b;this.level=a.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}d.prototype.setOptions=function(c){b("level",c,this);b("ipRegex",c,this);b("userAgentRegex",c,this);b("disallow",c,this);b("sendWithBufferLevel",c,this);b("storeInBufferLevel",c,this);b("bufferSize",c,this);b("batchSize",
c,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};d.prototype.log=function(c,a,b){!g(this)||!e(this,a)||c<this.storeInBufferLevel||(a=new h(c,a,b,(new Date).getTime()),c<this.level?0<this.bufferSize&&(this.buffer.push(a),this.buffer.length>this.bufferSize&&this.buffer.shift()):(c<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(a),this.batchBuffer.length>=this.batchSize&&
this.sendBatch()))};d.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=a.maxMessages&&1>a.maxMessages||(null!=a.maxMessages&&(a.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return d}();a.Appender=f;var k=function(d){function c(a){d.call(this,a,c.prototype.sendLogItemsAjax);this.url="/jsnlog.logger"}__extends(c,d);c.prototype.setOptions=function(a){b("url",a,this);d.prototype.setOptions.call(this,a);return this};c.prototype.sendLogItemsAjax=
function(c){try{var b=JSON.stringify({r:a.requestId,lg:c}),d=new XMLHttpRequest;d.open("POST",this.url);d.setRequestHeader("Content-Type","application/json");d.send(b)}catch(e){}};return c}(f);a.AjaxAppender=k;f=function(){function a(c){this.loggerName=c;this.seenRegexes=[]}a.prototype.stringifyLogObject=function(a){switch(typeof a){case "string":return a;case "number":return a.toString();case "boolean":return a.toString();case "undefined":return"undefined";case "function":return a instanceof RegExp?
a.toString():this.stringifyLogObject(a());case "object":return a instanceof RegExp||a instanceof String||a instanceof Number||a instanceof Boolean?a.toString():JSON.stringify(a);default:return"unknown"}};a.prototype.setOptions=function(a){b("level",a,this);b("userAgentRegex",a,this);b("disallow",a,this);b("ipRegex",a,this);b("appenders",a,this);b("onceOnly",a,this);this.seenRegexes=[];return this};a.prototype.log=function(a,b){var d=0,f;if(!this.appenders)return this;if(a>=this.level&&g(this)&&(f=
this.stringifyLogObject(b),e(this,f))){if(this.onceOnly)for(d=this.onceOnly.length-1;0<=d;){if(RegExp(this.onceOnly[d]).test(f)){if(this.seenRegexes[d])return this;this.seenRegexes[d]=!0}d--}for(d=this.appenders.length-1;0<=d;)this.appenders[d].log(a,f,this.loggerName),d--}return this};a.prototype.trace=function(a){return this.log(1E3,a)};a.prototype.debug=function(a){return this.log(2E3,a)};a.prototype.info=function(a){return this.log(3E3,a)};a.prototype.warn=function(a){return this.log(4E3,a)};
a.prototype.error=function(a){return this.log(5E3,a)};a.prototype.fatal=function(a){return this.log(6E3,a)};return a}();a.Logger=f;f=new k("");a.__=new a.Logger("");a.__.setOptions({level:a.getDebugLevel(),appenders:[f]});a.createAjaxAppender=function(a){return new k(a)}})(JL||(JL={}));var exports;"undefined"!==typeof exports&&(exports.JL=JL);var define;"function"==typeof define&&define.amd&&define(function(){return JL});
