!function(t,e,i,s){function n(e,i){var s=this;return this.settings=i,this._defaults=a,this.elems={},e.find(this.settings.imageSelector).each(function(){s.settings.images.push({title:t(this).attr("title"),src:t(this).attr("href"),height:!1,width:!1})}),i.displayAsALink?(this.createLink().off("click").on("click",function(t){s.init(s.settings.firstImage),t.preventDefault()}),e.hide()):e.find(this.settings.imageSelector).each(function(e){t(this).off("click").on("click",function(t){s.init(e),t.preventDefault()})}),{open:function(t){var t=t||0;s.init(t)},close:function(){s.close()},next:function(){s.change(1)},prev:function(){s.change(-1)},"goto":function(t){s.init(t)},current:function(){return s.currentImage}}}var o=0,a={container:e,linksContainer:".chocolat-links",imageSelector:".chocolat-image",fullWindow:!1,fullScreen:!1,displayAsALink:!1,loop:!1,linkImages:!0,setTitle:"",separator1:"|",separator2:"/",mobileBreakpoint:480,setIndex:0,firstImage:0,lastImage:!1,currentImage:!1,initialized:!1,timer:!1,timerDebounce:!1,images:[]};n.prototype={init:function(t){this.settings.initialized||(this.setDomContainer(),this.markup(),this.events(),this.settings.lastImage=this.settings.images.length-1,this.settings.initialized=!0),this.load(t)},preload:function(e,i){i=this.optFuncParam(i),imgLoader=new Image,imgLoader.onload=t.proxy(i,this,e,imgLoader),imgLoader.src=this.settings.images[e].src},load:function(e){this.settings.fullScreen&&this.openFullScreen(),this.settings.currentImage!==e&&(this.elems.overlay.fadeIn(800),this.settings.timer=setTimeout(function(){t.proxy(this.elems.loader.fadeIn(),this)},400),this.preload(e,this.place))},place:function(e,i){var s=this;this.settings.currentImage=e,this.description(),this.pagination(),this.breakpoint(),this.elems.img.fadeTo(200,0,function(){s.storeImgSize(i,e),fitting=s.fit(s.settings.images[e].height,s.settings.images[e].width,t(s.settings.container).height(),t(s.settings.container).width(),s.getOutMarginH(),s.getOutMarginW()),s.center(fitting.width,fitting.height,fitting.left,fitting.top,150,s.appear(e)),s.arrows()})},appear:function(t){var e=this;clearTimeout(this.settings.timer),this.elems.loader.stop().fadeOut(300,function(){e.elems.img.attr("src",e.settings.images[t].src).fadeTo(400,1)})},fit:function(t,e,i,s,n,o){var a=s-o,h=i-n,c=h/a,l=i/s,r=t/e;return"cover"==this.settings.fullWindow?l>r?(height=i,width=height/r):(width=s,height=width*r):(r>c?(height=h,width=height/r):(width=a,height=width*r),!this.settings.fullWindow&&(width>=e||height>=t)&&(width=e,height=t)),{height:height,width:width,top:(i-height)/2,left:(s-width)/2}},center:function(e,i,s,n,o,a){a=this.optFuncParam(a),this.elems.content.animate({width:e,height:i,left:s,top:n},o,t.proxy(a(),this)).css("overflow","visible")},change:function(t){var e=this.settings.currentImage+parseInt(t);e>this.settings.lastImage?this.settings.loop&&this.load(0):0>e?this.settings.loop&&this.load(this.settings.lastImage):this.load(e)},arrows:function(){this.settings.loop?t([this.elems.left[0],this.elems.right[0]]).css("display","block"):this.settings.linkImages?(this.settings.currentImage==this.settings.lastImage?this.elems.right.fadeOut(300):this.elems.right.fadeIn(300),0==this.settings.currentImage?this.elems.left.fadeOut(300):this.elems.left.fadeIn(300)):t([this.elems.left[0],this.elems.right[0]]).css("display","none")},description:function(){var e=this;this.elems.description.fadeTo(200,0,function(){t(this).html(e.settings.images[e.settings.currentImage].title).fadeTo(400,1)})},pagination:function(){var e=this,i=this.settings.lastImage+1,s=this.settings.currentImage+1,n=""==this.settings.setTitle?"":this.settings.separator1;this.elems.pagination.fadeTo(200,0,function(){t(this).html(e.settings.setTitle+" "+n+" "+s+e.settings.separator2+i).fadeTo(400,1)})},breakpoint:function(){t(this.settings.container).width()<this.settings.mobileBreakpoint?this.elems.domContainer.addClass("chocolat-mobile"):this.elems.domContainer.removeClass("chocolat-mobile")},storeImgSize:function(t,e){this.settings.images[e].height&&this.settings.images[e].width||(this.settings.images[e].height=t.height,this.settings.images[e].width=t.width)},close:function(){var e=[this.elems.overlay[0],this.elems.loader[0],this.elems.content[0]],i=this;t.when(t(e).fadeOut(200)).then(function(){i.elems.domContainer.removeClass("chocolat-open chocolat-mobile chocolat-in-container chocolat-cover")}),this.settings.currentImage=!1,this.settings.initialized=!1},getOutMarginW:function(){var t=this.elems.left.outerWidth()-this.elems.left.width(),e=this.elems.right.outerWidth()-this.elems.right.width();return t+e},getOutMarginH:function(){return this.elems.top.outerHeight()+this.elems.bottom.outerHeight()},markup:function(){this.elems.domContainer.addClass("chocolat-open"),"cover"==this.settings.fullWindow&&this.elems.domContainer.addClass("chocolat-cover"),this.settings.container!==e&&this.elems.domContainer.addClass("chocolat-in-container");this.elems.overlay=t("<div/>",{"class":"chocolat-overlay"}).appendTo(this.elems.domContainer),this.elems.loader=t("<div/>",{"class":"chocolat-loader"}).appendTo(this.elems.domContainer),this.elems.content=t("<div/>",{"class":"chocolat-content",id:"chocolat-content-"+this.settings.setIndex}).appendTo(this.elems.domContainer),this.elems.img=t("<img/>",{"class":"chocolat-img",src:""}).appendTo(this.elems.content),this.elems.top=t("<div/>",{"class":"chocolat-top"}).appendTo(this.elems.content),this.elems.left=t("<div/>",{"class":"chocolat-left"}).appendTo(this.elems.content),this.elems.right=t("<div/>",{"class":"chocolat-right"}).appendTo(this.elems.content),this.elems.bottom=t("<div/>",{"class":"chocolat-bottom"}).appendTo(this.elems.content),this.elems.description=t("<span/>",{"class":"chocolat-description"}).appendTo(this.elems.bottom),this.elems.pagination=t("<span/>",{"class":"chocolat-pagination"}).appendTo(this.elems.bottom),this.elems.close=t("<span/>",{"class":"chocolat-close"}).appendTo(this.elems.top)},createLink:function(){var e=t("<li/>").appendTo(this.settings.linksContainer);return t("<a/>",{id:"chocolat-set-"+this.settings.setIndex,"class":"chocolat-link",href:"#"}).html(this.settings.setTitle).appendTo(e)},openFullScreen:function(){var t=i.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},events:function(){var s=this;t(i).off("keydown").on("keydown",function(t){37==t.keyCode?s.change(-1):39==t.keyCode?s.change(1):27==t.keyCode&&s.close()}),t(this.elems.content).find(".chocolat-right").off("click").on("click",function(){s.change(1)}),t(this.elems.content).find(".chocolat-left").off("click").on("click",function(){s.change(-1)}),t([this.elems.overlay[0],this.elems.close[0]]).off("click").on("click",function(){s.close()}),t(e).on("resize",function(){s.settings.initialized&&s.debounce(50,function(){s.breakpoint(),fitting=s.fit(s.settings.images[s.settings.currentImage].height,s.settings.images[s.settings.currentImage].width,t(s.settings.container).height(),t(s.settings.container).width(),s.getOutMarginH(),s.getOutMarginW()),s.center(fitting.width,fitting.height,fitting.left,fitting.top,150)})})},setDomContainer:function(){"object"==typeof this.settings.container?this.elems.domContainer=t("body"):this.elems.domContainer=t(this.settings.container)},debounce:function(t,e){clearTimeout(this.settings.timerDebounce),this.settings.timerDebounce=setTimeout(function(){e()},t)},optFuncParam:function(e){return t.isFunction(e)?e:function(){}}},t.fn.Chocolat=function(e){return this.each(function(){o++;var i=t.extend(!0,{},a,e,{setIndex:o});t.data(this,"api-chocolat")||t.data(this,"api-chocolat",new n(t(this),i))})}}(jQuery,window,document);