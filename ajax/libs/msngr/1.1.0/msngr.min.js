var msngr=msngr||function(){"use strict";return{version:"1.1.0",extend:function(obj,target){if(target=target||msngr,"[object Object]"===Object.prototype.toString.call(obj))for(var key in obj)obj.hasOwnProperty(key)&&("[object Object]"===Object.prototype.toString.call(obj[key])?(void 0===target[key]&&(target[key]={}),target[key]=msngr.extend(obj[key],target[key])):target[key]="[object Array]"===Object.prototype.toString.call(obj[key])?(target[key]||[]).concat(obj[key]):obj[key]);return target}}}();msngr.extend(function(){"use strict";return{utils:{argumentsToArray:function(args){return msngr.utils.isArray(args)?args:Array.prototype.slice.call(args,0)}}}}()),msngr.extend(function(){"use strict";return{utils:{isHtmlElement:function(obj){var t=this.getType(obj);return 0===t.indexOf("[object HTML")||0===t.indexOf("[object global]")},isNodeList:function(obj){return"[object NodeList]"===this.getType(obj)},findElement:function(element,root){var elms=msngr.utils.findElements(element);return void 0!==elms&&elms.length>0?elms[0]:elms},findElements:function(selector,root){var elm;if(msngr.utils.isHtmlElement(selector)&&(elm=selector),void 0===elm&&msngr.utils.isString(selector)){var doc=root||document,result=doc.querySelectorAll(selector);null!==result&&(elm=result)}return elm},getDomPath:function(element){var node=msngr.utils.isHtmlElement(element)?element:void 0;return void 0===node?void 0:(void 0===node.id&&(node.id=msngr.utils.id()),"#"+node.id)},querySelectorAllWithEq:function(selector,root){if(void 0===selector)return null;for(var doc=root||document,queue=[],process=function(input){if(-1===input.indexOf(":eq("))return void 0;var eqlLoc=input.indexOf(":eq("),sel=input.substring(0,eqlLoc),ind=input.substring(eqlLoc+4,input.indexOf(")",eqlLoc));selector=input.substring(input.indexOf(")",eqlLoc)+1,input.length),">"===sel.charAt(0)&&(sel=sel.substring(1,sel.length)),">"===selector.charAt(0)&&(selector=selector.substring(1,selector.length)),queue.push({selector:sel,index:parseInt(ind,10)})};-1!==selector.indexOf(":eq");)process(selector);for(var result;queue.length>0;){var item=queue.shift();result=(result||doc).querySelectorAll(item.selector)[item.index]}return selector.trim().length>0?(result||doc).querySelectorAll(selector):[result]},querySelectorWithEq:function(selector){return msngr.utils.querySelectorAllWithEq(selector)[0]}}}}()),msngr.extend(function(){"use strict";var nowPerformance=function(){return performance.now()},nowNode=function(){return process.hrtime()[1]/1e6},nowLegacy=function(){return(new Date).getTime()},nowExec=void 0,nowExecDebugLabel="",lastNow=void 0;return{utils:{id:function(){var d=msngr.utils.now(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)});return uuid},now:function(noDuplicate){void 0===nowExec&&("undefined"!=typeof performance?(nowExec=nowPerformance,nowExecDebugLabel="performance"):"undefined"!=typeof process?(nowExec=nowNode,nowExecDebugLabel="node"):(nowExec=nowLegacy,nowExecDebugLabel="legacy"));var now=nowExec();return noDuplicate===!0&&lastNow===now?msngr.utils.now(noDuplicate):(lastNow=now,now)}}}}()),msngr.extend(function(){"use strict";return{utils:{getType:function(obj){return msngr.utils.exist(obj)?Object.prototype.toString.call(obj):""+obj},isArguments:function(obj){return"[object Arguments]"===msngr.utils.getType(obj)},areArguments:function(){return msngr.utils.reiterativeValidation(msngr.utils.isArguments,msngr.utils.argumentsToArray(arguments))},isNullOrUndefined:function(obj){return void 0===obj||null===obj},exist:function(obj){return!msngr.utils.isNullOrUndefined(obj)},exists:function(){return msngr.utils.reiterativeValidation(msngr.utils.exist,msngr.utils.argumentsToArray(arguments))},isString:function(str){return"[object String]"===msngr.utils.getType(str)},areStrings:function(){return msngr.utils.reiterativeValidation(msngr.utils.isString,msngr.utils.argumentsToArray(arguments))},isDate:function(obj){return"[object Date]"===msngr.utils.getType(obj)},areDates:function(){return msngr.utils.reiterativeValidation(msngr.utils.isDate,msngr.utils.argumentsToArray(arguments))},isArray:function(obj){return"[object Array]"===msngr.utils.getType(obj)},areArrays:function(){return msngr.utils.reiterativeValidation(msngr.utils.isArray,msngr.utils.argumentsToArray(arguments))},isNumber:function(obj){return"[object Number]"===msngr.utils.getType(obj)},areNumbers:function(){return msngr.utils.reiterativeValidation(msngr.utils.isNumber,msngr.utils.argumentsToArray(arguments))},isObject:function(obj){return"[object Object]"===msngr.utils.getType(obj)},areObjects:function(){return msngr.utils.reiterativeValidation(msngr.utils.isObject,msngr.utils.argumentsToArray(arguments))},isFunction:function(func){return"[object Function]"===msngr.utils.getType(func)},areFunctions:function(){return msngr.utils.reiterativeValidation(msngr.utils.isFunction,msngr.utils.argumentsToArray(arguments))},isEmptyString:function(str){var isStr=msngr.utils.isString(str);return void 0===str||null===str||isStr&&0===str.toString().trim().length?!0:!1},areEmptyStrings:function(){return msngr.utils.reiterativeValidation(msngr.utils.isEmptyString,msngr.utils.argumentsToArray(arguments))},hasWildCard:function(str){return-1!==str.indexOf("*")},reiterativeValidation:function(validationMethod,inputs){var result=!1;if(msngr.utils.exist(validationMethod)&&msngr.utils.exist(inputs)){msngr.utils.isArray(inputs)||(inputs=[inputs]);for(var i=0;i<inputs.length&&(result=validationMethod.apply(this,[inputs[i]]),result!==!1);++i);}return result}}}}()),msngr.extend(function(){"use strict";return{builders:{msg:function(){return function(){for(var message={},props=["topic","category","dataType","payload"].concat(msngr.getAvailableActions()),obj={build:function(){return message}},i=0;i<props.length;++i)!function(key){obj[key]=function(input){return message[key]=input,obj}}(props[i]);return obj}()}}}}()),msngr.extend(function(){"use strict";var id_to_message={},direct_index={topic_to_id:{},topic_cat_to_id:{},topic_type_to_id:{},topic_cat_type_to_id:{}},index_count=0,deleteValueFromArray=function(arr,value){var inx=arr.indexOf(value),endIndex=arr.length-1;if(inx!==endIndex){var temp=arr[endIndex];arr[endIndex]=arr[inx],arr[inx]=temp}arr.pop()};return{store:{index:function(message){if(msngr.utils.exist(message)&&msngr.utils.exist(message.topic)){var uuid=msngr.utils.id();return id_to_message[uuid]=message,void 0===direct_index.topic_to_id[message.topic]&&(direct_index.topic_to_id[message.topic]=[]),direct_index.topic_to_id[message.topic].push(uuid),msngr.utils.exist(message.category)&&(void 0===direct_index.topic_cat_to_id[message.topic]&&(direct_index.topic_cat_to_id[message.topic]={}),void 0===direct_index.topic_cat_to_id[message.topic][message.category]&&(direct_index.topic_cat_to_id[message.topic][message.category]=[]),direct_index.topic_cat_to_id[message.topic][message.category].push(uuid)),msngr.utils.exist(message.dataType)&&(void 0===direct_index.topic_type_to_id[message.topic]&&(direct_index.topic_type_to_id[message.topic]={}),void 0===direct_index.topic_type_to_id[message.topic][message.dataType]&&(direct_index.topic_type_to_id[message.topic][message.dataType]=[]),direct_index.topic_type_to_id[message.topic][message.dataType].push(uuid)),msngr.utils.exist(message.category)&&msngr.utils.exist(message.dataType)&&(void 0===direct_index.topic_cat_type_to_id[message.topic]&&(direct_index.topic_cat_type_to_id[message.topic]={}),void 0===direct_index.topic_cat_type_to_id[message.topic][message.category]&&(direct_index.topic_cat_type_to_id[message.topic][message.category]={}),void 0===direct_index.topic_cat_type_to_id[message.topic][message.category][message.dataType]&&(direct_index.topic_cat_type_to_id[message.topic][message.category][message.dataType]=[]),direct_index.topic_cat_type_to_id[message.topic][message.category][message.dataType].push(uuid)),index_count++,uuid}return void 0},"delete":function(uuid){if(msngr.utils.exist(uuid)&&msngr.utils.exist(id_to_message[uuid])){var message=id_to_message[uuid];return msngr.utils.exist(message.topic)&&(deleteValueFromArray(direct_index.topic_to_id[message.topic],uuid),msngr.utils.exist(message.category)&&deleteValueFromArray(direct_index.topic_cat_to_id[message.topic][message.category],uuid),msngr.utils.exist(message.dataType)&&deleteValueFromArray(direct_index.topic_type_to_id[message.topic][message.dataType],uuid),msngr.utils.exist(message.category)&&msngr.utils.exist(message.dataType)&&deleteValueFromArray(direct_index.topic_cat_type_to_id[message.topic][message.category][message.dataType],uuid)),delete id_to_message[uuid],index_count--,!0}return!1},query:function(message){if(msngr.utils.exist(message)&&msngr.utils.exist(message.topic)){if(!msngr.utils.exist(message.category)&&!msngr.utils.exist(message.dataType))return direct_index.topic_to_id[message.topic]||[];if(msngr.utils.exist(message.category)&&!msngr.utils.exist(message.dataType))return(direct_index.topic_cat_to_id[message.topic]||{})[message.category]||[];if(msngr.utils.exist(message.dataType)&&!msngr.utils.exist(message.category))return(direct_index.topic_type_to_id[message.topic]||{})[message.dataType]||[];if(msngr.utils.exist(message.category)&&msngr.utils.exist(message.dataType))return((direct_index.topic_cat_type_to_id[message.topic]||{})[message.category]||{})[message.dataType]||[]}return[]},clear:function(){return id_to_message={},direct_index={topic_to_id:{},topic_cat_to_id:{},topic_type_to_id:{},topic_cat_type_to_id:{}},index_count=0,!0},count:function(){return index_count}}}}()),msngr.extend(function(){"use strict";var InvalidParametersException=function(str){return{severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",str)}},registerdPaths={},registerdEvents=0,listener=function(event){var node=this,path=msngr.utils.getDomPath(node);return msngr.utils.exist(registerdPaths[path])&&msngr.utils.exist(registerdPaths[path][event.type])?msngr.emit(registerdPaths[path][event.type],event):msngr};return{bind:function(element,event,topic,category,dataType){if(!msngr.utils.exist(element)||!msngr.utils.exist(event)||!msngr.utils.exist(topic))throw InvalidParametersException("bind");if(msngr.utils.isObject(topic)&&!msngr.utils.exist(topic.topic))throw InvalidParametersException("bind");var node=msngr.utils.findElement(element),path=msngr.utils.getDomPath(node);msngr.utils.exist(registerdPaths[path])||(registerdPaths[path]={});var message=void 0;return msngr.utils.isObject(topic)?message=topic:(message={},message.topic=topic,msngr.utils.exist(category)&&(message.category=category),msngr.utils.exist(dataType)&&(message.dataType=dataType)),registerdPaths[path][event]=message,node.addEventListener(event,listener),registerdEvents++,msngr},unbind:function(element,event){var node=msngr.utils.findElement(element),path=msngr.utils.getDomPath(node);return msngr.utils.exist(registerdPaths[path])&&msngr.utils.exist(registerdPaths[path][event])&&(node.removeEventListener(event,listener),delete registerdPaths[path][event],registerdEvents--),msngr},getBindCount:function(){return registerdEvents}}}()),msngr.extend(function(){"use strict";var InvalidParameters=function(str){return{severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",str)}},delegates={},delegateCount=0,executeSync=function(method,context,params,message){!function(m,c,p,msg){var cont=!0,wrap={preventDefault:function(){cont=!1},payload:p[0],done:function(){cont===!0&&m.apply(c,[wrap.payload])}};msngr.act(msg,wrap)}(method,context,params,message)},execute=function(method,context,params,message){!function(m,c,p,msg){setTimeout(function(){executeSync(m,c,p,msg)},0)}(method,context,params,message)},_emit=function(message,payload,callback){var uuids=msngr.store.query(message);if(uuids.length>0)for(var i=0;i<uuids.length;++i){var del=delegates[uuids[i]],params=[];msngr.utils.exist(payload||message.payload)&&params.push(payload||message.payload),execute(del.callback,del.context,params,message)}return msngr},_on=function(message,callback){var uuid=msngr.store.index(message);return delegates[uuid]={callback:callback,context:message.context||this,onedMessage:message},delegateCount++,msngr},_drop=function(message,func){var uuids=msngr.store.query(message);if(uuids.length>0)for(var i=0;i<uuids.length;++i){var uuid=uuids[i];msngr.utils.exist(func)?delegates[uuid].callback===func&&(delete delegates[uuid],delegateCount--,msngr.store["delete"](uuid)):(delete delegates[uuid],delegateCount--,msngr.store["delete"](uuid))}return msngr};return{emit:function(topic,category,dataType,payload,callback){if(!msngr.utils.exist(topic))throw InvalidParameters("emit");var message;if(msngr.utils.isObject(topic))return message=topic,!msngr.utils.exist(payload)&&msngr.utils.exist(category)&&(payload=category),!msngr.utils.exist(callback)&&msngr.utils.exist(dataType)&&msngr.utils.isFunction(dataType)&&(callback=dataType),_emit(message,payload,callback);message={};var args=msngr.utils.argumentsToArray(arguments);return message.topic=args.shift(),!msngr.utils.exist(payload)&&args.length>0&&msngr.utils.isObject(args[0])?(payload=args.shift(),_emit(message,payload)):(message.category=args.shift(),args.length>0&&msngr.utils.isObject(args[0])?(payload=args.shift(),_emit(message,payload)):(message.dataType=args.shift(),_emit(message,payload)))},on:function(topic,category,dataType,callback){if(!msngr.utils.exist(topic))throw InvalidParameters("on");var message;if(msngr.utils.isObject(topic))return message=topic,!msngr.utils.exist(callback)&&msngr.utils.exist(category)&&(callback=category),_on(message,callback);if(arguments.length>1){message={};var args=msngr.utils.argumentsToArray(arguments);return message.topic=args.shift(),message.category=args.shift(),message.dataType=args.shift(),callback=callback||args.pop(),msngr.utils.isFunction(message.category)&&!msngr.utils.exist(message.dataType)&&(callback=message.category,delete message.category,delete message.dataType),msngr.utils.isFunction(message.dataType)&&msngr.utils.exist(message.category)&&(callback=message.dataType,delete message.dataType),_on(message,callback)}throw InvalidParameters("on")},drop:function(topic,category,dataType,callback){if(!msngr.utils.exist(topic))throw InvalidParameters("drop");var message;if(msngr.utils.isObject(topic))return message=topic,!msngr.utils.exist(callback)&&msngr.utils.exist(category)&&(callback=category),_drop(message,callback);if(arguments.length>0){message={};var args=msngr.utils.argumentsToArray(arguments);return message.topic=args.shift(),message.category=args.shift(),message.dataType=args.shift(),callback=callback||args.pop(),msngr.utils.isFunction(message.category)&&!msngr.utils.exist(message.dataType)&&(callback=message.category,delete message.category,delete message.dataType),msngr.utils.isFunction(message.dataType)&&msngr.utils.exist(message.category)&&(callback=message.dataType,delete message.dataType),_drop(message,callback)}throw InvalidParameters("drop")},dropAll:function(){return delegates={},delegateCount=0,msngr.store.clear(),msngr},getMessageCount:function(){return delegateCount}}}()),msngr.extend(function(){"use strict";var InvalidParameters=function(str){return{name:"InvalidParameters",severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",str)}},ReservedKeywords=function(keyword){return{name:"ReservedKeywordsException",severity:"unrecoverable",message:"Reserved keyword {keyword} supplied as action.".replace("{keyword}",keyword)}},reservedProperties=["topic","category","dataType","payload"],actions={},actionsCount=0;return{action:function(property,handler){if(!msngr.utils.exist(property)||!msngr.utils.exist(handler))throw InvalidParameters("action");if(-1!==reservedProperties.indexOf(property))throw ReservedKeywords(property);actions[property]=handler,actionsCount++},inaction:function(property){if(!msngr.utils.exist(property))throw InvalidParameters("inaction");delete actions[property],actionsCount--},act:function(message,superWrap){if(!msngr.utils.exist(message)||!msngr.utils.exist(superWrap))throw InvalidParameters("act");!function(msg,sw){if(actionsCount>0){var wrap={preventDefault:function(){sw.preventDefault()},payload:sw.payload};for(var key in msg)msg.hasOwnProperty(key)&&-1===reservedProperties.indexOf(key)&&void 0!==actions[key]&&actions[key].apply(this,[msg,wrap]);sw.payload=wrap.payload}return sw.done()}(message,superWrap)},getActionCount:function(){return actionsCount},getAvailableActions:function(){return Object.keys(actions)}}}()),msngr.action("dom",function(message,wrap){"use strict";if(msngr.utils.exist(message.dom)){var norm={gather:void 0,doc:void 0};if(msngr.utils.isObject(message.dom)?(msngr.utils.exist(message.dom.gather)&&(norm.gather=msngr.utils.isArray(message.dom.gather)?message.dom.gather:[message.dom.gather]),msngr.utils.exist(message.dom.root||message.dom.doc)&&(norm.doc=message.dom.root||message.dom.doc)):msngr.utils.isArray(message.dom)?norm.gather=message.dom:msngr.utils.isString(message.dom)&&(norm.gather=[message.dom]),msngr.utils.exist(norm.gather)&&norm.gather.length>0){msngr.utils.isObject(wrap.payload)||(wrap.payload={});for(var i=0;i<norm.gather.length;++i){var elms=msngr.utils.findElements(norm.gather[i],message.dom.root);if(msngr.utils.exist(elms)&&elms.length>0)for(var j=0;j<elms.length;++j){var prop,elm=elms[j];msngr.utils.exist(elm.getAttribute("name"))&&!msngr.utils.isEmptyString(elm.getAttribute("name"))?prop=elm.getAttribute("name"):msngr.utils.exist(elm.id)&&!msngr.utils.isEmptyString(elm.id)?(prop=elm.getAttribute("id"),console.log(elm.id)):prop=elm.tagName.toLowerCase()+j,wrap.payload[prop]=elm.value}}}}return msngr}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);