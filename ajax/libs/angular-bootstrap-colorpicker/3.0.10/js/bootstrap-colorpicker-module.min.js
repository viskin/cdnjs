"use strict";angular.module("colorpicker.module",[]).factory("Helper",function(){return{closestSlider:function(b){var a=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector;if(a.bind(b)("I")){return b.parentNode}return b},getOffset:function(c,b){var a=0,f=0,e=0,d=0;while(c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop)){a+=c.offsetLeft;f+=c.offsetTop;if(!b&&c.tagName==="BODY"){e+=document.documentElement.scrollLeft||c.scrollLeft;d+=document.documentElement.scrollTop||c.scrollTop}else{e+=c.scrollLeft;d+=c.scrollTop}c=c.offsetParent}return{top:f,left:a,scrollX:e,scrollY:d}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["Helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d===j?(i-c)/k:d===i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},setColor:function(e){e=e.toLowerCase();for(var d in a.stringParsers){if(a.stringParsers.hasOwnProperty(d)){var f=a.stringParsers[d];var c=f.re.exec(e),b=c&&f.parse(c);if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r,10)<<16)|(parseInt(e.g,10)<<8)|parseInt(e.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(a){var b={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},c={};return{getSlider:function(){return b},getLeftPosition:function(d){return Math.max(0,Math.min(b.maxLeft,b.left+((d.pageX||c.left)-c.left)))},getTopPosition:function(d){return Math.max(0,Math.min(b.maxTop,b.top+((d.pageY||c.top)-c.top)))},setSlider:function(e,d){var f=a.closestSlider(e.target),g=a.getOffset(f,d);b.knob=f.children[0].style;b.left=e.pageX-g.left-window.pageXOffset+g.scrollX;b.top=e.pageY-g.top-window.pageYOffset+g.scrollY;c={left:e.pageX,top:e.pageY}},setSaturation:function(e,d){b={maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"};this.setSlider(e,d)},setHue:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"};this.setSlider(e,d)},setAlpha:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"};this.setSlider(e,d)},setKnob:function(e,d){b.knob.top=e+"px";b.knob.left=d+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function(e,a,d,c,b){return{require:"?ngModel",restrict:"A",link:function(v,z,u,p){var y=u.colorpicker?u.colorpicker:"hex",G=angular.isDefined(u.colorpickerPosition)?u.colorpickerPosition:"bottom",l=angular.isDefined(u.colorpickerInline)?u.colorpickerInline:false,f=angular.isDefined(u.colorpickerFixedPosition)?u.colorpickerFixedPosition:false,F=angular.isDefined(u.colorpickerParent)?z.parent():angular.element(document.body),j=angular.isDefined(u.colorpickerWithInput)?u.colorpickerWithInput:false,i=j?'<input type="text" name="colorpicker-input">':"",h=!l?'<button type="button" class="close close-colorpicker">&times;</button>':"",D='<div class="colorpicker dropdown"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview>'+i+h+"</div></div>",w=angular.element(D),C=d,t,I=w.find("colorpicker-hue"),n=w.find("colorpicker-saturation"),g=w.find("colorpicker-preview"),q=w.find("i");a(w)(v);if(j){var r=w.find("input");r.on("mousedown",function(J){J.stopPropagation()}).on("keyup",function(K){var J=this.value;z.val(J);if(p){v.$apply(p.$setViewValue(J))}K.stopPropagation();K.preventDefault()});z.on("keyup",function(){r.val(z.val())})}var m=function(){e.on("mousemove",B);e.on("mouseup",x)};if(y==="rgba"){w.addClass("alpha");t=w.find("colorpicker-alpha");t.on("click",function(J){c.setAlpha(J,f);B(J)}).on("mousedown",function(J){c.setAlpha(J,f);m()})}I.on("click",function(J){c.setHue(J,f);B(J)}).on("mousedown",function(J){c.setHue(J,f);m()});n.on("click",function(J){c.setSaturation(J,f);B(J)}).on("mousedown",function(J){c.setSaturation(J,f);m()});if(f){w.addClass("colorpicker-fixed-position")}w.addClass("colorpicker-position-"+G);if(l==="true"){w.addClass("colorpicker-inline")}F.append(w);if(p){p.$render=function(){z.val(p.$viewValue)};v.$watch(u.ngModel,function(J){o();if(j){r.val(J)}})}z.on("$destroy",function(){w.remove()});var s=function(){try{g.css("backgroundColor",C[y]())}catch(J){g.css("backgroundColor",C.toHex())}n.css("backgroundColor",C.toHex(C.value.h,1,1,1));if(y==="rgba"){t.css.backgroundColor=C.toHex()}};var B=function(L){var N=c.getLeftPosition(L),M=c.getTopPosition(L),K=c.getSlider();c.setKnob(M,N);if(K.callLeft){C[K.callLeft].call(C,N/100)}if(K.callTop){C[K.callTop].call(C,M/100)}s();var J=C[y]();z.val(J);if(p){v.$apply(p.$setViewValue(J))}if(j){r.val(J)}return false};var x=function(){e.off("mousemove",B);e.off("mouseup",x)};var o=function(){C.setColor(z.val());q.eq(0).css({left:C.value.s*100+"px",top:100-C.value.b*100+"px"});q.eq(1).css("top",100*(1-C.value.h)+"px");q.eq(2).css("top",100*(1-C.value.a)+"px");s()};var A=function(){var K,J=b.getOffset(z[0]);if(angular.isDefined(u.colorpickerParent)){J.left=0;J.top=0}if(G==="top"){K={top:J.top-147,left:J.left}}else{if(G==="right"){K={top:J.top,left:J.left+126}}else{if(G==="bottom"){K={top:J.top+z[0].offsetHeight+2,left:J.left}}else{if(G==="left"){K={top:J.top,left:J.left-150}}}}}return{top:K.top+"px",left:K.left+"px"}};var k=function(){H()};if(l===false){z.on("click",function(){o();w.addClass("colorpicker-visible").css(A());e.on("mousedown",k)})}else{o();w.addClass("colorpicker-visible").css(A())}w.on("mousedown",function(J){J.stopPropagation();J.preventDefault()});var E=function(J){if(p){v.$emit(J,{name:u.ngModel,value:p.$modelValue})}};var H=function(){if(w.hasClass("colorpicker-visible")){w.removeClass("colorpicker-visible");E("colorpicker-closed");e.off("mousedown",k)}};w.find("button").on("click",function(){H()})}}}]);