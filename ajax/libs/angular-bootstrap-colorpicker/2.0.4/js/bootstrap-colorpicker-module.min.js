"use strict";angular.module("colorpicker.module",[]).factory("helper",function(){return{closest:function(c,a){var b=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector;while(c){if(b.bind(c)(a)){return c}else{c=c.parentNode}}return false},getOffset:function(b){var a=0,c=0;while(b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop)){a+=b.offsetLeft;c+=b.offsetTop;b=b.offsetParent}return{top:c,left:a}},extend:function(){for(var b=1;b<arguments.length;b++){for(var a in arguments[b]){if(arguments[b].hasOwnProperty(a)){arguments[0][a]=arguments[b][a]}}}return arguments[0]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d==j?(i-c)/k:d==i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},HueToRGB:function(d,c,b){if(b<0){b+=1}else{if(b>1){b-=1}}if((b*6)<1){return d+(c-d)*b*6}else{if((b*2)<1){return c}else{if((b*3)<2){return d+(c-d)*((2/3)-b)*6}else{return d}}}},setColor:function(f){f=f.toLowerCase();for(var d in a.stringParsers){var g=a.stringParsers[d];var c=g.re.exec(f),b=c&&g.parse(c),e=g.space||"rgba";if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r)<<16)|(parseInt(e.g)<<8)|parseInt(e.b)).toString(16).substr(1)}}}]).directive("colorpicker",["$document","$compile","Color","helper",function(d,a,c,b){return{require:"?ngModel",restrict:"A",link:function(m,s,l,i){var w='<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div></div></div><button class="close close-colorpicker">&times;</button></div>',o=angular.element(w),v=c,h,e,g,j,p=null,n=null;var r=l.colorpicker?l.colorpicker:"hex";var x=l.colorpickerPosition?l.colorpickerPosition:"bottom";a(o)(m);e={enabled:r==="rgba",css:null};if(e.enabled===true){o.addClass("alpha");e.css=o.find("div")[2].style}o.addClass("colorpicker-position-"+x);angular.element(document.body).append(o);if(i){i.$render=function(){s.val(i.$viewValue)};m.$watch(l.ngModel,function(){f()})}s.bind("$destroy",function(){o.remove()});g=o.find("div")[0].style;h=o.find("div")[4].style;j=o.find("i");var k=function(){try{h.backgroundColor=v[r]()}catch(A){h.backgroundColor=v.toHex()}g.backgroundColor=v.toHex(v.value.h,1,1,1);if(e.enabled===true){e.css.backgroundColor=v.toHex()}};var y=function(B){B.stopPropagation();B.preventDefault();var A=b.closest(B.target,"div");if(A.className==="colorpicker-saturation"){n=b.extend({},{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"})}else{if(A.className==="colorpicker-hue"){n=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"})}else{if(A.className==="colorpicker-alpha"){n=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"})}else{n=null;return false}}}n.knob=A.children[0].style;n.left=B.pageX-b.getOffset(A).left;n.top=B.pageY-b.getOffset(A).top;p={left:B.pageX,top:B.pageY}};var u=function(B){if(!n){return}var D=Math.max(0,Math.min(n.maxLeft,n.left+((B.pageX||p.left)-p.left)));var C=Math.max(0,Math.min(n.maxTop,n.top+((B.pageY||p.top)-p.top)));n.knob.left=D+"px";n.knob.top=C+"px";if(n.callLeft){v[n.callLeft].call(v,D/100)}if(n.callTop){v[n.callTop].call(v,C/100)}k();var A=v[r]();s.val(A);if(i){m.$apply(i.$setViewValue(A))}return false};var q=function(){d.unbind("mousemove",u);d.unbind("mouseup",q)};var f=function(){v.setColor(s.val());j.eq(0).css({left:v.value.s*100+"px",top:100-v.value.b*100+"px"});j.eq(1).css("top",100*(1-v.value.h)+"px");j.eq(2).css("top",100*(1-v.value.a)+"px");k()};var t=function(){var B,A=b.getOffset(s[0]);if(x==="top"){B={top:A.top-146,left:A.left}}else{if(x==="right"){B={top:A.top,left:A.left+141}}else{if(x==="bottom"){B={top:A.top+s[0].offsetHeight,left:A.left}}else{if(x==="left"){B={top:A.top,left:A.left-131}}}}}return{top:B.top+"px",left:B.left+"px"}};s.bind("click",function(){f();o.addClass("colorpicker-visible").css(t())});o.bind("mousedown",function(A){A.stopPropagation();A.preventDefault()});o.find("div").bind("click",function(A){y(A);u(A)});o.find("div").bind("mousedown",function(A){y(A);d.bind("mousemove",u);d.bind("mouseup",q)});var z=function(){if(o.hasClass("colorpicker-visible")){o.removeClass("colorpicker-visible")}};o.find("button").bind("click",function(){z()});d.bind("mousedown",function(){z()})}}}]);