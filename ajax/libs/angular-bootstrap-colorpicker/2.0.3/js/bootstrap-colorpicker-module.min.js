"use strict";angular.module("colorpicker.module",[]).factory("helper",function(){return{closest:function(c,a){var b=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector;while(c){if(b.bind(c)(a)){return c}else{c=c.parentNode}}return false},getOffset:function(b){var a=0,c=0;while(b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop)){a+=b.offsetLeft;c+=b.offsetTop;b=b.offsetParent}return{top:c,left:a}},extend:function(){for(var b=1;b<arguments.length;b++){for(var a in arguments[b]){if(arguments[b].hasOwnProperty(a)){arguments[0][a]=arguments[b][a]}}}return arguments[0]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d==j?(i-c)/k:d==i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},HueToRGB:function(d,c,b){if(b<0){b+=1}else{if(b>1){b-=1}}if((b*6)<1){return d+(c-d)*b*6}else{if((b*2)<1){return c}else{if((b*3)<2){return d+(c-d)*((2/3)-b)*6}else{return d}}}},setColor:function(f){f=f.toLowerCase();for(var d in a.stringParsers){var g=a.stringParsers[d];var c=g.re.exec(f),b=c&&g.parse(c),e=g.space||"rgba";if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r)<<16)|(parseInt(e.g)<<8)|parseInt(e.b)).toString(16).substr(1)}}}]).directive("colorpicker",["$document","$compile","Color","helper",function(d,a,c,b){return{require:"?ngModel",restrict:"A",link:function(m,s,l,i){var v='<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>',o=angular.element(v),u=c,h,e,g,j,p=null,n=null;var r=l.colorpicker?l.colorpicker:"hex";a(o)(m);e={enabled:r==="rgba",css:null};if(e.enabled===true){o.addClass("alpha");e.css=o.find("div")[2].style}angular.element(document.body).append(o);if(i){i.$render=function(){s.val(i.$viewValue)};m.$watch(l.ngModel,function(){f()})}s.bind("$destroy",function(){o.remove()});g=o.find("div")[0].style;h=o.find("div")[4].style;j=o.find("i");var k=function(){try{h.backgroundColor=u[r]()}catch(x){h.backgroundColor=u.toHex()}g.backgroundColor=u.toHex(u.value.h,1,1,1);if(e.enabled===true){e.css.backgroundColor=u.toHex()}};var w=function(y){y.stopPropagation();y.preventDefault();var x=b.closest(y.target,"div");if(x.className==="colorpicker-saturation"){n=b.extend({},{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"})}else{if(x.className==="colorpicker-hue"){n=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"})}else{if(x.className==="colorpicker-alpha"){n=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"})}else{return false}}}n.knob=x.children[0].style;n.left=y.pageX-b.getOffset(x).left;n.top=y.pageY-b.getOffset(x).top;p={left:y.pageX,top:y.pageY}};var t=function(y){var A=Math.max(0,Math.min(n.maxLeft,n.left+((y.pageX||p.left)-p.left)));var z=Math.max(0,Math.min(n.maxTop,n.top+((y.pageY||p.top)-p.top)));n.knob.left=A+"px";n.knob.top=z+"px";if(n.callLeft){u[n.callLeft].call(u,A/100)}if(n.callTop){u[n.callTop].call(u,z/100)}k();var x=u[r]();s.val(x);if(i){m.$apply(i.$setViewValue(x))}return false};var q=function(){d.unbind("mousemove",t);d.unbind("mouseup",q)};var f=function(){u.setColor(s.val());j.eq(0).css({left:u.value.s*100+"px",top:100-u.value.b*100+"px"});j.eq(1).css("top",100*(1-u.value.h)+"px");j.eq(2).css("top",100*(1-u.value.a)+"px");k()};s.bind("click",function(){f();o.addClass("colorpicker-visible").css({top:b.getOffset(s[0]).top+s[0].offsetHeight+"px",left:b.getOffset(s[0]).left+"px"})});o.bind("mousedown",function(x){x.stopPropagation();x.preventDefault()});o.find("div").bind("click",function(x){w(x);t(x)});o.find("div").bind("mousedown",function(x){w(x);d.bind("mousemove",t);d.bind("mouseup",q)});d.bind("mousedown",function(){if(o.hasClass("colorpicker-visible")){o.removeClass("colorpicker-visible")}})}}}]);