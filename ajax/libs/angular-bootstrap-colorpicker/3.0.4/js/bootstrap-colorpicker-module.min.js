"use strict";angular.module("colorpicker.module",[]).factory("Helper",function(){return{closestSlider:function(b){var a=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector;if(a.bind(b)("I")){return b.parentNode}return b},getOffset:function(b){var a=0,c=0;while(b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop)){a+=b.offsetLeft;c+=b.offsetTop;b=b.offsetParent}return{top:c,left:a}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["Helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d==j?(i-c)/k:d==i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},HueToRGB:function(d,c,b){if(b<0){b+=1}else{if(b>1){b-=1}}if((b*6)<1){return d+(c-d)*b*6}else{if((b*2)<1){return c}else{if((b*3)<2){return d+(c-d)*((2/3)-b)*6}else{return d}}}},setColor:function(f){f=f.toLowerCase();for(var d in a.stringParsers){var g=a.stringParsers[d];var c=g.re.exec(f),b=c&&g.parse(c),e=g.space||"rgba";if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r,10)<<16)|(parseInt(e.g,10)<<8)|parseInt(e.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(a){var b={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},c={};return{getSlider:function(){return b},getLeftPosition:function(d){return Math.max(0,Math.min(b.maxLeft,b.left+((d.pageX||c.left)-c.left)))},getTopPosition:function(d){return Math.max(0,Math.min(b.maxTop,b.top+((d.pageY||c.top)-c.top)))},setSlider:function(e,d){var f=a.closestSlider(e.target);b.knob=f.children[0].style;b.left=e.pageX-a.getOffset(f).left;b.top=e.pageY-a.getOffset(f).top;if(d){b.left-=window.pageXOffset;b.top-=window.pageYOffset}c={left:e.pageX,top:e.pageY}},setSaturation:function(e,d){b={maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"};this.setSlider(e,d)},setHue:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"};this.setSlider(e,d)},setAlpha:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"};this.setSlider(e,d)},setKnob:function(e,d){b.knob.top=e+"px";b.knob.left=d+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function(e,a,d,c,b){return{require:"?ngModel",restrict:"A",link:function(p,t,o,k){var x='<div class="colorpicker dropdown"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview><button class="close close-colorpicker">&times;</button></div></div>',q=angular.element(x),w=d,n,B=q.find("colorpicker-hue"),h=q.find("colorpicker-saturation"),g=q.find("colorpicker-preview"),l=q.find("i"),s=o.colorpicker?o.colorpicker:"hex",z=angular.isDefined(o.colorpickerPosition)?o.colorpickerPosition:"bottom",f=angular.isDefined(o.colorpickerFixedPosition)?o.colorpickerFixedPosition:false,y=angular.isDefined(o.colorpickerParent)?t.parent():angular.element(document.body);a(q)(p);var i=function(){e.on("mousemove",v);e.on("mouseup",r)};if(s==="rgba"){q.addClass("alpha");n=q.find("colorpicker-alpha");n.on("click",function(C){c.setAlpha(C,f);v(C)}).on("mousedown",function(C){c.setAlpha(C,f);i()})}B.on("click",function(C){c.setHue(C,f);v(C)}).on("mousedown",function(C){c.setHue(C,f);i()});h.on("click",function(C){c.setSaturation(C,f);v(C)}).on("mousedown",function(C){c.setSaturation(C,f);i()});if(f){q.addClass("colorpicker-fixed-position")}q.addClass("colorpicker-position-"+z);y.append(q);if(k){k.$render=function(){t.val(k.$viewValue)};p.$watch(o.ngModel,function(){j()})}t.on("$destroy",function(){q.remove()});var m=function(){try{g.css("backgroundColor",w[s]())}catch(C){g.css("backgroundColor",w.toHex())}h.css("backgroundColor",w.toHex(w.value.h,1,1,1));if(s==="rgba"){n.css.backgroundColor=w.toHex()}};var v=function(E){var G=c.getLeftPosition(E),F=c.getTopPosition(E),D=c.getSlider();c.setKnob(F,G);if(D.callLeft){w[D.callLeft].call(w,G/100)}if(D.callTop){w[D.callTop].call(w,F/100)}m();var C=w[s]();t.val(C);if(k){p.$apply(k.$setViewValue(C))}return false};var r=function(){e.off("mousemove",v);e.off("mouseup",r)};var j=function(){w.setColor(t.val());l.eq(0).css({left:w.value.s*100+"px",top:100-w.value.b*100+"px"});l.eq(1).css("top",100*(1-w.value.h)+"px");l.eq(2).css("top",100*(1-w.value.a)+"px");m()};var u=function(){var D,C=b.getOffset(t[0]);if(z==="top"){D={top:C.top-147,left:C.left}}else{if(z==="right"){D={top:C.top,left:C.left+126}}else{if(z==="bottom"){D={top:C.top+t[0].offsetHeight+2,left:C.left}}else{if(z==="left"){D={top:C.top,left:C.left-150}}}}}return{top:D.top+"px",left:D.left+"px"}};t.on("click",function(){j();q.addClass("colorpicker-visible").css(u())});q.on("mousedown",function(C){C.stopPropagation();C.preventDefault()});var A=function(){if(q.hasClass("colorpicker-visible")){q.removeClass("colorpicker-visible")}};q.find("button").on("click",function(){A()});e.on("mousedown",function(){A()})}}}]);