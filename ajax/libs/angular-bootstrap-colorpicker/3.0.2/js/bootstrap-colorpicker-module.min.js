"use strict";angular.module("colorpicker.module",[]).factory("helper",function(){return{closest:function(c,a){var b=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector;while(c){if(b.bind(c)(a)){return c}else{c=c.parentNode}}return false},getOffset:function(b){var a=0,c=0;while(b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop)){a+=b.offsetLeft;c+=b.offsetTop;b=b.offsetParent}return{top:c,left:a}},extend:function(){for(var b=1;b<arguments.length;b++){for(var a in arguments[b]){if(arguments[b].hasOwnProperty(a)){arguments[0][a]=arguments[b][a]}}}return arguments[0]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d==j?(i-c)/k:d==i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},HueToRGB:function(d,c,b){if(b<0){b+=1}else{if(b>1){b-=1}}if((b*6)<1){return d+(c-d)*b*6}else{if((b*2)<1){return c}else{if((b*3)<2){return d+(c-d)*((2/3)-b)*6}else{return d}}}},setColor:function(f){f=f.toLowerCase();for(var d in a.stringParsers){var g=a.stringParsers[d];var c=g.re.exec(f),b=c&&g.parse(c),e=g.space||"rgba";if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r)<<16)|(parseInt(e.g)<<8)|parseInt(e.b)).toString(16).substr(1)}}}]).directive("colorpicker",["$document","$compile","Color","helper",function(d,a,c,b){return{require:"?ngModel",restrict:"A",link:function(n,t,m,j){var x='<div class="colorpicker dropdown"><ul class="dropdown-menu"><li class="colorpicker-saturation"><i></i></li><li class="colorpicker-hue"><i></i></li><li class="colorpicker-alpha"><i></i></li><li class="colorpicker-color"><div></div></li><button class="close close-colorpicker">&times;</button></ul></div>',p=angular.element(x),w=c,i,f,h,k,q=null,o=null;var s=m.colorpicker?m.colorpicker:"hex";var z=m.colorpickerPosition?m.colorpickerPosition:"bottom";var e=m.colorpickerFixedPosition?m.colorpickerFixedPosition:false;a(p)(n);f={enabled:s==="rgba",css:null};if(f.enabled===true){p.addClass("alpha");f.css=p.find("li")[2].style}if(e){p.addClass("colorpicker-fixed-position")}p.addClass("colorpicker-position-"+z);angular.element(document.body).append(p);if(j){j.$render=function(){t.val(j.$viewValue)};n.$watch(m.ngModel,function(){g()})}t.bind("$destroy",function(){p.remove()});h=p.find("li")[0].style;i=p.find("div")[0].style;k=p.find("i");var l=function(){try{i.backgroundColor=w[s]()}catch(B){i.backgroundColor=w.toHex()}h.backgroundColor=w.toHex(w.value.h,1,1,1);if(f.enabled===true){f.css.backgroundColor=w.toHex()}};var y=function(C){C.stopPropagation();C.preventDefault();var B=b.closest(C.target,"li");if(B.className==="colorpicker-saturation"){o=b.extend({},{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"})}else{if(B.className==="colorpicker-hue"){o=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"})}else{if(B.className==="colorpicker-alpha"){o=b.extend({},{maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"})}else{o=null;return false}}}o.knob=B.children[0].style;o.left=C.pageX-b.getOffset(B).left;o.top=C.pageY-b.getOffset(B).top;if(e){o.left-=window.pageXOffset;o.top-=window.pageYOffset}q={left:C.pageX,top:C.pageY}};var v=function(C){if(!o){return}var E=Math.max(0,Math.min(o.maxLeft,o.left+((C.pageX||q.left)-q.left)));var D=Math.max(0,Math.min(o.maxTop,o.top+((C.pageY||q.top)-q.top)));o.knob.left=E+"px";o.knob.top=D+"px";if(o.callLeft){w[o.callLeft].call(w,E/100)}if(o.callTop){w[o.callTop].call(w,D/100)}l();var B=w[s]();t.val(B);if(j){n.$apply(j.$setViewValue(B))}return false};var r=function(){d.unbind("mousemove",v);d.unbind("mouseup",r)};var g=function(){w.setColor(t.val());k.eq(0).css({left:w.value.s*100+"px",top:100-w.value.b*100+"px"});k.eq(1).css("top",100*(1-w.value.h)+"px");k.eq(2).css("top",100*(1-w.value.a)+"px");l()};var u=function(){var C,B=b.getOffset(t[0]);if(z==="top"){C={top:B.top-147,left:B.left}}else{if(z==="right"){C={top:B.top,left:B.left+126}}else{if(z==="bottom"){C={top:B.top+t[0].offsetHeight+2,left:B.left}}else{if(z==="left"){C={top:B.top,left:B.left-150}}}}}return{top:C.top+"px",left:C.left+"px"}};t.bind("click",function(){g();p.addClass("colorpicker-visible").css(u())});p.bind("mousedown",function(B){B.stopPropagation();B.preventDefault()});p.find("li").bind("click",function(B){y(B);v(B)});p.find("li").bind("mousedown",function(B){y(B);d.bind("mousemove",v);d.bind("mouseup",r)});var A=function(){if(p.hasClass("colorpicker-visible")){p.removeClass("colorpicker-visible")}};p.find("button").bind("click",function(){A()});d.bind("mousedown",function(){A()})}}}]);