/**
 * MinDB - Database on JavaScript
 *
 * Will Wen Gunn(iwillwen) and other contributors
 *
 * @license MIT-license
 * @copyright 2012-2015 iwillwen(willwengunn@gmail.com)
 */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.stores=n.exports}}(this,function(e){"use strict";!function(t,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof e)n(e);else{var o={exports:{}};n(o.exports),t.stores=o.exports}}(void 0,function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),o=function(){function e(){t(this,e)}return n(e,[{key:"get",value:function(e){return sessionStorage?sessionStorage.getItem(e):!1}},{key:"set",value:function(e,t){return sessionStorage?sessionStorage.setItem(e,t):!1}},{key:"remove",value:function(e){return sessionStorage?sessionStorage.removeItem(e):!1}}]),e}();e.memStore=o;var r=function(){function e(){t(this,e)}return n(e,[{key:"get",value:function(e){return localStorage?localStorage.getItem(e):!1}},{key:"set",value:function(e,t){return localStorage?localStorage.setItem(e,t):!1}},{key:"remove",value:function(e){return localStorage?localStorage.removeItem(e):!1}}]),e}();e.localStore=r})});
!function(e,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var t={exports:{}};r(t.exports),e.utils=t.exports}}(this,function(e){"use strict";!function(r,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof e&&"undefined"!=typeof module)t(e,module);else{var n={exports:{}};t(n.exports,n),r.utils=n.exports}}(void 0,function(e,r){r.exports={noop:function(){return!1},inherits:function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(){for(var e=arguments[0],r=[].slice.call(arguments,1),t=0,n=r.length;n>t;t++){var i=Object.getOwnPropertyNames(r[t]||{}),o=!0,u=!1,f=void 0;try{for(var a,l=i[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var s=a.value;e[s]=r[t][s]}}catch(c){u=!0,f=c}finally{try{!o&&l["return"]&&l["return"]()}finally{if(u)throw f}}}return e},isNumber:function(e){return"[object Number]"==toString.call(e)},isUndefined:function(e){return void 0===e},isObject:function(e){return e===Object(e)},arrayUnique:function(e){for(var r={},t=[],n=0,i=e.length;i>n;++n)(!r.hasOwnProperty(e[n])||utils.isObject(e[n]))&&(t.push(e[n]),r[e[n]]=1);return t},arrayInter:function(e){var r=[].slice.call(arguments,1);return utils.arrayUnique(e).filter(function(e){var t=!0,n=!0,i=!1,o=void 0;try{for(var u,f=r[Symbol.iterator]();!(n=(u=f.next()).done);n=!0){var a=u.value;a.indexOf(e)<0&&(t=!1)}}catch(l){i=!0,o=l}finally{try{!n&&f["return"]&&f["return"]()}finally{if(i)throw o}}return t})},arrayDiff:function(e){var r=[].slice.call(arguments,1);return e.filter(function(e){var t=!0,n=!0,i=!1,o=void 0;try{for(var u,f=r[Symbol.iterator]();!(n=(u=f.next()).done);n=!0){var a=u.value;a.indexOf(e)>=0&&(t=!1)}}catch(l){i=!0,o=l}finally{try{!n&&f["return"]&&f["return"]()}finally{if(i)throw o}}return t})},flatten:function(e){function r(r,t,n,i){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}(function(e,r,t,n){for(var i=[],o=0,u=n||0,f=getLength(e);f>u;u++){var a=e[u];if(isArrayLike(a)&&(_.isArray(a)||_.isArguments(a))){r||(a=flatten(a,r,t));var l=0,s=a.length;for(i.length+=s;s>l;)i[o++]=a[l++]}else t||(i[o++]=a)}return i})}})});
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.events=n.exports}}(this,function(e){"use strict";!function(t,n){if("function"==typeof define&&define.amd)define(["exports","../utils.js"],n);else if("undefined"!=typeof e)n(e,require("../utils.js"));else{var s={exports:{}};n(s.exports,t.utils),t.events=s.exports}}(void 0,function(e,t){function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){var t=null,n=a,s=a;return v?(t=new v(function(e,t){n=e,s=t}),t.resolve=function(){for(var e=arguments.length,s=Array(e),r=0;e>r;r++)s[r]=arguments[r];n.apply(t,s)},t.reject=function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];s.apply(t,n)}):t=new l,t}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();e.Promise=r;var o=n(t),a=o["default"].noop,h=void 0||window||global,u=10,f=function(){function e(){s(this,e),this._events=this._events||{},this._maxListeners=this._maxListeners||u}return i(e,[{key:"setMaxListeners",value:function(e){if("number"!=typeof e||0>e)throw TypeError("n must be a positive number");this._maxListeners=e}},{key:"emit",value:function(e){var t,n,s,r,i,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||"object"==typeof this._events.error&&!this._events.error.length)){if(t=arguments[1],!this.domain)throw t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');return t||(t=new TypeError('Uncaught, unspecified "error" event.')),!1}if(n=this._events[e],"undefined"==typeof n)return!1;if("function"==typeof n)switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,r=new Array(s-1),i=1;s>i;i++)r[i-1]=arguments[i];n.apply(this,r)}else if("object"==typeof n){for(s=arguments.length,r=new Array(s-1),i=1;s>i;i++)r[i-1]=arguments[i];for(o=n.slice(),s=o.length,i=0;s>i;i++)o[i].apply(this,r)}return!0}},{key:"addListener",value:function(e,t){var n;if("function"!=typeof t)throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,"function"==typeof t.listener?t.listener:t),this._events[e]?"object"==typeof this._events[e]?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,"object"!=typeof this._events[e]||this._events[e].warned||(n=this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())),this}},{key:"once",value:function(e,t){function n(){this.removeListener(e,n),t.apply(this,arguments)}if("function"!=typeof t)throw TypeError("listener must be a function");return n.listener=t,this.on(e,n),this}},{key:"removeListener",value:function(e,t){var n,s,r,i;if("function"!=typeof t)throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,s=-1,n===t||"function"==typeof n.listener&&n.listener===t)this._events[e]=void 0,this._events.removeListener&&this.emit("removeListener",e,t);else if("object"==typeof n){for(i=r;i-->0;)if(n[i]===t||n[i].listener&&n[i].listener===t){s=i;break}if(0>s)return this;1===n.length?(n.length=0,this._events[e]=void 0):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this}},{key:"removeAllListeners",value:function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&(this._events[e]=void 0),this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],"function"==typeof n)this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return this._events[e]=void 0,this}},{key:"listeners",value:function(e){var t;return t=this._events&&this._events[e]?"function"==typeof this._events[e]?[this._events[e]]:this._events[e].slice():[]}}]),e}();e.EventEmitter=f,f.prototype.on=f.prototype.addListener,f.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?"function"==typeof e._events[t]?1:e._events[t].length:0},f.inherits=function(e){o["default"].inherits(e,f)};var l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?a:arguments[0];s(this,e),this._settled=!1,this._success=!1,this._args=[],this._callbacks=[],this._onReject=a,t(this.resolve.bind(this),this.reject.bind(this))}return i(e,[{key:"then",value:function(t){var n=this,s=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new e;return this._onReject=s,this._callbacks.push(function(){for(var e=arguments.length,s=Array(e),i=0;e>i;i++)s[i]=arguments[i];var o=t.apply(n,s);o&&"function"==typeof o.then&&o.then(r.resolve.bind(r),r.reject.bind(r))}),this._settled&&(this._success?this.resolve.apply(this,this._args):this.onReject.apply(this,this._args)),r}},{key:"catch",value:function(e){return this._onReject=e,this}},{key:"resolve",value:function(){for(var e=!0,t=!1,n=void 0,s=arguments.length,r=Array(s),i=0;s>i;i++)r[i]=arguments[i];try{for(var o,a=this._callbacks[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var h=o.value;h.apply(this,r)}}catch(u){t=!0,n=u}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}this._args=r,this._settled=!0,this._success=!0}},{key:"reject",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this._onReject.apply(this,t),this._args=t,this._settled=!0}}]),e}(),v=h.Promise})});
!function(e,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var t={exports:{}};n(t.exports),e.mix=t.exports}}(this,function(e){"use strict";!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],t);else if("undefined"!=typeof e&&"undefined"!=typeof module)t(e,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};t(r.exports,r,n.utils,n.events),n.mix=r.exports}}(void 0,function(e,n,t,r){function u(e){return e&&e.__esModule?e:{"default":e}}var i=function(){function e(e,n){var t=[],r=!0,u=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(a){u=!0,i=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(u)throw i}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=u(t),o=(void 0||window||global,s["default"].noop),a={};n.exports=a;var c=null;a.set=function(e,n,t){var u=this,i=new r.Promise;i.then(function(t){u.emit("set",e,n),c&&clearTimeout(c),c=setTimeout(u.save.bind(u),1e3)});var o=this.store;t=t||s["default"].noop;var a="min-"+e;if(o.async){var l=function(r){var s=JSON.stringify(n);o.set(a,s,function(r){return r?(i.reject(r),t(r)):(u._keys[e]=0,i.resolve([e,n]),void t(null,e,n))})};o.ready?l():o.on("ready",l)}else try{var f=JSON.stringify(n);o.set(a,f),this._keys[e]=0,i.resolve([e,n]),t(null,e,n)}catch(v){i.reject(v),t(v)}return i},a.setnx=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return this.exists(e,function(r,s){return r&&(u(r),i.reject(r)),s?i.reject(new Error("The key is exists.")):void t.set(e,n,u).then(function(e,n){u(null,e,n),i.resolve([e,n])},function(e){u(e),i.reject(e)})}),i},a.setex=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise,a=function(n){u.del(e,o)};return this.set(e,t,function(e,t){setTimeout(a,1e3*n),i(e,t)}).then(function(e,t){setTimeout(a,1e3*n),s.resolve([e,t]),i(null,e,t)},function(e){s.reject(e),i(e)}),s},a.psetex=function(e,n,t){var u=this,i=arguments,a=arguments.length<=3||void 0===arguments[3]?o:arguments[3],c=new r.Promise,l=function(n){u.del(e,s["default"].noop)};return this.set(e,t,function(e,t){setTimeout(l,n),a(e,t)}).then(function(e){setTimeout(l,n),c.resolve.apply(c,i)},c.reject.bind(c)),c},a.mset=function(e){function n(){f.length?(i(f),s.reject(f)):(i(null,l),s.resolve(l))}var t=this,u=arguments,i=arguments.length<=1||void 0===arguments[1]?o:arguments[1],s=new r.Promise,a=Object.keys(e),c=0,l=[],f=[],v=function g(r,i){delete a[i],t.set(r,e[r]).then(function(e){l.push(u),c++,a[c]?g(a[c],c):n()},function(e){return f.push(e),c++,a[c]?g(a[c],c):n()})};return v(a[c],c),s},a.msetnx=function(e){function n(){return f.length?(i(f),s.reject(f)):(i(null,l),void s.resolve(l))}var t=this,u=arguments,i=arguments.length<=1||void 0===arguments[1]?o:arguments[1],s=new r.Promise,a=Object.keys(e),c=0,l=[],f=[],v=function g(r,i){delete a[i],t.setnx(r,e[r]).then(function(e){l.push(u),c++,a[c]?g(a[c],c):n()},function(e){f.push(e),n()})};return v(a[c],c),s},a.append=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return this.exists(e).then(function(n){if(n)return t.get(e);var u=new r.Promise;return u.resolve(""),u}).then(function(r){return t.set(e,r+n)}).then(function(e,n){return t.strlen(e)}).then(function(e){i.resolve(e),u(null,e)},function(e){i.reject(e),u(e)}),i},a.get=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],u=new r.Promise;u.then(function(t){return n.emit("get",e,t)});var i=this.store,s="min-"+e;if(i.async){var a=function(e){i.get(s,function(e,n){if(e){var r=new Error("no such key");return u.reject(r),t(r)}if(n){var i=JSON.parse(n);u.resolve(i),t(null,i)}else{var e=new Error("no such key");u.resolve(e),t(e)}})};i.ready?a():i.on("ready",a)}else try{var c=this.store.get(s);if(c){var l=JSON.parse(c);setTimeout(function(e){return u.resolve(l)},100),t(null,l)}else{var f=new Error("no such key");setTimeout(function(e){return u.reject(f)},100),t(f)}}catch(f){setTimeout(function(e){return u.reject(f)},100),t(f)}return u},a.getrange=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;s.then(function(r){return u.emit("getrange",e,n,t,r)});var a=t-n+1;return this.get(e).then(function(e){var t=e.substr(n,a);s.resolve(t),i(null,t)},function(e){s.reject(e),i(e)}),s},a.mget=function(e){function n(){c.length?(u(c),i.reject(c)):(u(null,a),i.resolve(a))}var t=this,u=arguments.length<=1||void 0===arguments[1]?o:arguments[1],i=new r.Promise,s=0,a=[],c=[],l=function f(r,u){for(var i=!0;i;){var o=r,l=u;i=!1,delete e[l],o?t.get(o,function(t,r){return t?(c.push(t),a.push(null),s++,e[s]?f(e[s],s):n()):(a.push(r),s++,void(e[s]?f(e[s],s):n()))}):(s++,r=e[s],u=s,i=!0)}};return l(e[s],s),i},a.getset=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;i.then(function(r){return t.emit("getset",e,n,r)});var s=null;return this.get(e).then(function(r){return s=r,t.set(e,n)}).then(function(e){i.resolve(s),u(null,s)},function(e){i.reject(e),u(e)}),i},a.strlen=function(e){var n=arguments.length<=1||void 0===arguments[1]?o:arguments[1],t=new r.Promise;return this.get(e).then(function(e){if("string"==typeof e){var r=e.length;t.resolve(r),n(null,r)}else{var u=new TypeError;t.reject(u),n(u)}},function(e){t.reject(e),n(e)}),t},a.incr=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],u=new r.Promise;return u.then(function(t){return n.emit("incr",e,t)}),this.get(e).then(function(){var r=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return isNaN(parseInt(r))?(u.reject("value wrong"),t("value wrong")):(r=parseInt(r),n.set(e,++r))}).then(function(e){var n=i(e,2),r=(n[0],n[1]);u.resolve(r),t(null,r)},function(e){u.reject(e),t(e)}),u},a.incrby=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return i.then(function(r){return t.emit("incrby",e,n,r)}),this.exists(e).then(function(n){if(n)return t.get(e);var u=new r.Promise;return u.resolve(0),u}).then(function(r){return isNaN(parseFloat(r))?(i.reject("value wrong"),u("value wrong")):(r=parseFloat(r),t.set(e,r+n))}).then(function(e,n){i.resolve(n),u(null,n)},function(e){i.reject(e),u(e)}),i},a.incrbyfloat=a.incrby,a.decr=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],u=new r.Promise;return u.then(function(t){return n.emit("decr",e,t)}),this.exists(e).then(function(t){if(t)return n.get(e);var u=new r.Promise;return u.resolve(0),u}).then(function(r){return isNaN(parseInt(r))?(u.reject("value wrong"),t("value wrong")):(r=parseInt(r),n.set(e,--r))}).then(function(e,n){u.resolve(n),t(null,n)},function(e){u.reject(e),t(e)}),u},a.decrby=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return i.then(function(r){return t.emit("decrby",e,n,r)}),this.exists(e).then(function(n){if(n)return t.get(e);var u=new r.Promise;return u.resolve(0),u}).then(function(r){return isNaN(parseInt(r))?(i.reject("value wrong"),u("value wrong")):(r=parseInt(r),t.set(e,r-n))}).then(function(e,n){i.resolve(n),u(null,n)},function(e){i.reject(e),u(e)}),i}})});
!function(e,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var t={exports:{}};n(t.exports),e.hash=t.exports}}(this,function(e){"use strict";!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],t);else if("undefined"!=typeof e&&"undefined"!=typeof module)t(e,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};t(r.exports,r,n.utils,n.events),n.hash=r.exports}}(void 0,function(e,n,t,r){function i(e){return e&&e.__esModule?e:{"default":e}}var u=function(){function e(e,n){var t=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(l){i=!0,u=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=i(t),o=(void 0||window||global,s["default"].noop),l={};n.exports=l,l.hset=function(e,n,t){var i=this,u=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return this.exists(e,function(r,o){if(r)return s.reject(r),u(r);if(o)i.get(e,function(r,o){return r?(s.reject(r),u(r)):(o[n]=t,void i.set(e,o,function(r,i,o){return r?(s.reject(r),u(r)):(s.resolve(e,n,t),void u(null,e,n,t))}))});else{var l={};l[n]=t,i.set(e,l,function(r,o,l){return r?(reject(r),u(r)):(i._keys[e]=1,s.resolve([e,n,t]),void u(null,e,n,t))})}}),s.then(function(r){i.emit("hset",e,n,t)}),s},l.hsetnx=function(e,n,t){var i=this,u=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return this.hexists(e,n,function(r,o){if(r)return s.reject(r),u(r);if(o){var r=new Error("The field of the hash is exists");return s.reject(r),u(r)}i.hset(e,n,t,function(e){e&&(reject(e),u(e)),s.resolve("OK"),u(null,"OK")})}),s},l.hmset=function(e,n){var t=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise,u=Object.keys(n),s=this.multi();return u.forEach(function(t){s.hset(e,t,n[t])}),s.exec(function(e,n){t(null,n),i.resolve(n)}),i},l.hget=function(e,n){var t=this,i=arguments.length<=2||void 0===arguments[2]?o:arguments[2],u=new r.Promise;return this.hexists(e,n,function(r,s){if(r)return u.reject(r),i(r);if(s)t.get(e).then(function(e){var t=e[n];u.resolve(t),i(null,t)},function(e){u.reject(e),i(e)});else{var r=new Error("no such field");u.reject(r),i(r)}}),u},l.hmget=function(e,n){var t=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise,u=[],s=this.multi();return n.forEach(function(n){s.hget(e,n)}),s.exec(function(e,n){return e?(t(e),i.reject(e)):(u=n.map(function(e){return e[0]}),i.resolve(u),void t(null,u))}),i},l.hgetall=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],i=new r.Promise;return this.exists(e,function(r,u){if(r)return t(r),i.reject(r);if(!u){var r=new Error("no such key");return t(r),i.reject(r)}n.get(e).then(function(e){i.resolve(e),t(null,e)},function(e){})}),i},l.hdel=function(e,n){var t=this,i=arguments.length<=2||void 0===arguments[2]?o:arguments[2],s=new r.Promise;return s.then(function(e){var n=u(e,3),r=n[0],i=n[1],s=n[2];t.emit("hdel",r,i,s)}),this.hexists(e.field,function(r,u){if(r)return i(r),s.reject(r);if(!u){var r=new Error("no such key");return i(r),s.reject(r)}t.get(e).then(function(r){var u=r[n];delete r[n],t.set(e,r).then(function(t){s.resolve([e,n,u]),i(null,e,n,u)},function(e){s.reject(e),i(e)})},function(e){i(e)})}),s},l.hlen=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],i=new r.Promise;return this.exists(e,function(r,u){return r?(i.reject(r),t(r)):void(u?n.get(e).then(function(e){var n=Object.keys(e).length;i.resolve(n),t(null,n)},function(e){i.reject(e),t(e)}):(i.resolve(0),t(null,0)))}),i},l.hkeys=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],i=new r.Promise;return this.exists(e,function(r,u){return r?(i.reject(r),t(r)):void(u?n.get(e).then(function(e){var n=Object.keys(e);i.resolve(n),t(null,n)},function(e){i.reject(e),t(e)}):(i.resolve(0),t(null,0)))}),i},l.hexists=function(e,n){var t=this,i=arguments.length<=2||void 0===arguments[2]?o:arguments[2],u=new r.Promise;return this.exists(e).then(function(n){return n?t.get(e):(u.resolve(!1),void i(null,!1))}).then(function(e){e.hasOwnProperty(n)?(u.resolve(!0),i(null,!0)):(u.resolve(!1),i(null,!1))},function(e){u.reject(e),i(e)}),u},l.hincr=function(e,n){var t=this,i=arguments.length<=2||void 0===arguments[2]?o:arguments[2],u=new r.Promise;return u.then(function(r){t.emit("hincr",e,n,r)}),this.hexists(e,n).then(function(e){if(e)return t.hget(e);var n=new r.Promise;return n.resolve(0),n}).then(function(r){return isNaN(parseFloat(r))?(u.reject("value wrong"),i("value wrong")):(r=parseFloat(r),t.hset(e,n,++r))}).then(function(e,n,t){u.resolve(t),i(null,t)},function(e){u.reject(e),i(null,e)}),u},l.hincrby=function(e,n,t){var i=this,u=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return s.then(function(t){i.emit("hincr",e,n,t)}),this.hexists(e,n).then(function(e){if(e)return i.hget(e);var n=new r.Promise;return n.resolve(0),n}).then(function(r){return isNaN(parseFloat(r))?(s.reject("value wrong"),u("value wrong")):(r=parseFloat(r),i.hset(e,n,r+t))}).then(function(e,n,t){s.resolve(t),u(null,t)},function(e){s.reject(e),u(null,e)}),s},l.hincrbyfloat=l.hincrby,l.hdecr=function(e,n){var t=this,i=arguments.length<=2||void 0===arguments[2]?o:arguments[2],u=new r.Promise;return u.then(function(r){t.emit("hdecr",e,n,r)}),this.hexists(e,n).then(function(i){if(i)return t.hget(e,n);var u=new r.Promise;return u.resolve(0),u}).then(function(r){return isNaN(parseFloat(r))?(u.reject("value wrong"),i("value wrong")):(r=parseFloat(r),t.hset(e,n,--r))}).then(function(e,n,t){u.resolve(t),i(null,t)},function(e){u.reject(e),i(e)}),u},l.hdecrby=function(e,n,t){var i=this,u=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return s.then(function(t){i.emit("hincr",e,n,t)}),this.hexists(e,n).then(function(e){if(e)return i.hget(e);var n=new r.Promise;return n.resolve(0),n}).then(function(r){return isNaN(parseFloat(r))?(s.reject("value wrong"),u("value wrong")):(r=parseFloat(r),i.hset(e,n,r-t))}).then(function(e,n,t){s.resolve(t),u(null,t)},function(e){s.reject(e),u(null,e)}),s}})});
!function(e,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var t={exports:{}};n(t.exports),e.list=t.exports}}(this,function(e){"use strict";!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],t);else if("undefined"!=typeof e&&"undefined"!=typeof module)t(e,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};t(r.exports,r,n.utils,n.events),n.list=r.exports}}(void 0,function(e,n,t,r){function u(e){return e&&e.__esModule?e:{"default":e}}var i=function(){function e(e,n){var t=[],r=!0,u=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(o){u=!0,i=o}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw i}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=u(t),l=void 0||window||global,o=s["default"].noop,f={};n.exports=f,f.lpush=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return i.then(function(r){return t.emit("lpush",e,n,r)}),this.exists(e,function(r,s){if(r)return i.reject(r),u(r);if(s)t.get(e,function(r,s){return r?(i.reject(r),u(r)):(s.unshift(n),void t.set(e,s,function(e){if(e)return i.reject(e),u(e);var n=s.length;i.resolve(n),u(null,n)}))});else{var l=[n];t.set(e,l,function(n){return n?(i.reject(n),u(n)):(t._keys[e]=2,i.resolve(1),void u(null,1))})}}),i},f.lpushx=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return i.then(function(r){return t.emit("lpush",e,n,r)}),this.exists(e,function(r,s){if(r)return i.reject(r),u(r);if(!s){var r=new Error("no such key");return u(r),i.reject(r)}t.get(e,function(r,s){if(r)return i.reject(r),u(r);if(!s.length){var r=new Error("The list is empty.");return u(r),i.reject(r)}s.unshift(n),t.set(e,s,function(e){if(e)return i.reject(e),u(e);var n=s.length;i.resolve(n),u(null,n)})})}),i},f.rpush=function(e,n,t){var u=this,i=new r.Promise;return i.then(function(t){return u.emit("rpush",e,n,t)}),this.exists(e,function(r,s){if(r)return i.reject(r),t(r);if(s)u.get(e,function(r,s){return r?(i.reject(r),t(r)):(s.push(n),void u.set(e,s,function(e){if(e)return i.reject(e),t(e);var n=s.length;i.resolve(n),t(null,n)}))});else{var l=[n];u.set(e,l,function(e){return e?(i.reject(e),t(e)):(i.resolve(1),void t(null,1))})}}),i},f.rpushx=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return i.then(function(r){return t.emit("rpush",e,n,r)}),this.exists(e,function(r,s){if(r)return i.reject(r),u(r);if(!s){var r=new Error("no such key");return u(r),i.reject(r)}t.get(e,function(r,s){if(r)return i.reject(r),u(r);if(!s.length){var r=new Error("The list is empty.");return u(r),i.reject(r)}s.push(n),t.set(e,s,function(e){if(e)return i.reject(e),u(e);var n=s.length;i.resolve(n),u(null,n)})})}),i},f.lpop=function(e,n){var t=this,u=new r.Promise,i=null;return u.then(function(n){return t.emit("lpop",e,n)}),this.exists(e).then(function(r){return r?t.get(e):(u.resolve(null),void n(null,null))}).then(function(n){return i=n.shift(),t.set(e,n)}).then(function(e){u.resolve(i),n(null,i)},function(e){u.reject(e),n(e)}),u},f.rpop=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],u=new r.Promise;u.then(function(t){return n.emit("rpop",e,t)});var i=null;return this.exists(e).then(function(n){return n?l.get(e):(u.resolve(null),void t(null,null))}).then(function(n){return i=n.pop(),l.set(e,n)}).then(function(e){u.resolve(i),t(null,i)},function(e){u.reject(e),t(e)}),u},f.llen=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?o:arguments[1],u=new r.Promise;return this.exists(e,function(r,i){return r?(u.reject(r),t(r)):void(i?n.get(e,function(e,n){if(e)return u.reject(e),t(e);var r=n.length;u.resolve(r),t(null,r)}):(u.resolve(0),t(null,0)))}),u},f.lrange=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return this.exists(e,function(r,l){return r?(s.reject(r),i(r)):void(l?u.get(e,function(e,r){if(e)return s.reject(e),i(e);var u=r.slice(n,t+1);s.resolve(u),i(null,u)}):(s.resolve(null),i(null,null)))}),s},f.lrem=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return s.then(function(r){return u.emit("lrem",e,n,t,r)}),this.exists(e,function(r,l){return r?(s.reject(r),i(r)):void(l?u.get(e,function(e,r){if(e)return s.reject(e),i(e);var u=0;switch(!0){case n>0:for(var l=0;l<r.length&&n>u;l++)if(r[l]===t){{r.splice(l,1)[0]}u++}break;case 0>n:for(var l=r.length-1;l>=0&&n>u;l--)if(r[l]===t){{r.splice(l,1)[0]}u++}break;case n=0:for(var l=r.length-1;l>=0;l--)if(r[l]===t){{r.splice(l,1)[0]}u++}}s.resolve(u),i(null,u)}):(s.resolve(null),i(null,null)))}),s},f.lset=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return s.then(function(r){return u.emit("lset",e,n,t,r)}),this.exists(e,function(r,l){if(r)return s.reject(r),i(r);if(!l){var r=new Error("no such key");return s.reject(r),i(r)}u.get(e,function(r,l){if(r)return s.reject(r),i(r);if(!l[n]||!l.length){var r=new Error("no such key");return s.reject(r),i(r)}l[n]=t,u.set(e,l,function(e){if(e)return s.reject(e),i(e);var n=l.length;s.resolve(n),i(null,n)})})}),s},f.ltrim=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return this.exists(e,function(r,l){return r?(s.reject(r),i(r)):void(l?u.get(e,function(e,r){if(e)return s.reject(e),i(e);var u=r.splice(n,t+1);s.resolve(u),i(null,u)}):(s.resolve(null),i(null,null)))}),s},f.lindex=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise;return this.exists(e,function(r,s){return r?(i.reject(r),u(r)):void(s?t.get(e,function(e,t){if(e)return i.reject(e),u(e);var r=t[n];i.resolve(r),u(null,r)}):(i.resolve(null),u(null,null)))}),i},f.linsertBefore=function(e,n,t,u){var i=this,s=new r.Promise;return s.then(function(r){return i.emit("linsertBefore",e,n,t,r)}),this.exists(e,function(r,l){return r?(s.reject(r),u(r)):void(l?i.get(e,function(r,l){if(r)return s.reject(r),u(r);var o=l.indexOf(n);return 0>o?(s.resolve(null),u(null,null)):(l.splice(o,1,t,n),void i.set(e,l,function(e){if(e)return s.reject(e),u(e);var n=l.length;s.resolve(n),u(null,n)}))}):(s.resolve(null),u(null,null)))}),s},f.linsertAfter=function(e,n,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],s=new r.Promise;return s.then(function(r){return u.emit("linsertAfter",e,n,t,r)}),this.exists(e,function(r,l){return r?(s.reject(r),i(r)):void(l?u.get(e,function(r,l){if(r)return s.reject(r),i(r);var o=l.indexOf(n);return 0>o?(s.resolve(null),i(null,null)):(l.splice(o,0,t),void u.set(e,l,function(e){if(e)return s.reject(e),i(e);var n=l.length;s.resolve(n),i(null,n)}))}):(s.resolve(null),i(null,null)))}),s},f.rpoplpush=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],s=new r.Promise,l=null;return s.then(function(r){var u=i(r,2),s=u[0],l=u[1];return t.emit("rpoplpush",e,n,s,l)}),this.rpop(e).then(function(e){return t.lpush(n,l=e)}).then(function(e){s.resolve([l,e]),u(null,l,e)},function(e){u(e),s.reject(e)}),s},f.lpoprpush=function(e,n){var t=this,u=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new r.Promise,s=null;return i.then(function(r,u){return t.emit("lpoprpush",e,n,r,u)}),this.lpop(e).then(function(e){return t.rpush(n,s=e)}).then(function(e){i.resolve(s,e),u(null,s,e)},function(e){u(e),i.reject(e)}),i}})});
!function(n,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var t={exports:{}};e(t.exports),n.set=t.exports}}(this,function(n){"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],t);else if("undefined"!=typeof n&&"undefined"!=typeof module)t(n,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};t(r.exports,r,e.utils,e.events),e.set=r.exports}}(void 0,function(n,e,t,r){function u(n){return n&&n.__esModule?n:{"default":n}}var i=function(){function n(n,e){var t=[],r=!0,u=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done)&&(t.push(o.value),!e||t.length!==e);r=!0);}catch(a){u=!0,i=a}finally{try{!r&&s["return"]&&s["return"]()}finally{if(u)throw i}}return t}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=u(t),s=(void 0||window||global,o["default"].noop),a={};e.exports=a,a.sadd=function(n){for(var e=this,t=arguments,u=arguments.length,i=Array(u>1?u-1:0),a=1;u>a;a++)i[a-1]=arguments[a];var l=new r.Promise(s);l.then(function(t){return e.emit("sadd",n,t)});var f=0;if(i[i.length-1]instanceof Function)var c=i.splice(i.length-1,1)[0];else var c=s;return this.exists(n).then(function(t){if(t)return e.get(n);var r=o["default"].arrayUnique(i);return e.set(n,r)}).then(function(r){if(Array.isArray(t[0])){var u=t[0],o=!0,s=!1,a=void 0;try{for(var h,v=i[Symbol.iterator]();!(o=(h=v.next()).done);o=!0){var m=h.value;if(u.indexOf(m)>=0)return;u.push(m),f++}}catch(d){s=!0,a=d}finally{try{!o&&v["return"]&&v["return"]()}finally{if(s)throw a}}return e.set(n,u)}"string"==typeof t[0]&&(f+=i.length,e._keys[n]=3,l.resolve(f),c(null,f))}).then(function(t){e._keys[n]=3,l.resolve(f),c(null,f)},function(n){l.reject(n),c(n)}),l},a.srem=function(n){for(var e=this,t=arguments.length,u=Array(t>1?t-1:0),i=1;t>i;i++)u[i-1]=arguments[i];var o=new r.Promise(s),a=s;o.then(function(t){return e.emit("srem",n,u,t)});var l=0;return u[u.length-1]instanceof Function&&(a=u.pop()),this.exists(n).then(function(t){return t?e.get(n):new Error("no such key")}).then(function(t){var r=!0,i=!1,o=void 0;try{for(var s,a=u[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var f=s.value,c=t.indexOf(f);c>=0&&(t.splice(c,1),l++)}}catch(h){i=!0,o=h}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return e.set(n,t)}).then(function(t){e._keys[n]=3,o.resolve(l),a(null,l)},function(n){o.reject(n),a(n)}),o},a.smembers=function(n){var e=this,t=arguments.length<=1||void 0===arguments[1]?s:arguments[1],u=new r.Promise(s);return this.exists(n).then(function(t){return t?e.get(n):new Error("no such key")}).then(function(n){u.resolve(n),t(null,n)},function(n){u.reject(n),t(n)}),u},a.sismember=function(n,e){var t=this,u=arguments.length<=2||void 0===arguments[2]?s:arguments[2],i=new r.Promise(s);return this.exists(n).then(function(e){return e?t.get(n):new Error("no such key")}).then(function(n){var t=n.indexOf(e)>=0?1:0;i.resolve(t),u(null,t)},function(n){i.reject(n),u(n)}),i},a.scard=function(n){var e=this,t=arguments.length<=1||void 0===arguments[1]?s:arguments[1],u=new r.Promise(s);return this.exists(n).then(function(t){return t?e.get(n):new Error("no such key")}).then(function(n){var e=n.length;u.resolve(e),t(null,e)},function(n){u.reject(n),t(n)}),u},a.smove=function(n,e,t){var u=this,i=arguments.length<=3||void 0===arguments[3]?s:arguments[3],o=new r.Promise(s);return o.then(function(r){return u.emit("smove",n,e,t,r)}),this.exists(key).then(function(e){return e?u.sismember(n,t):new Error("no such key")}).then(function(e){return e?u.srem(n,t):new Error("no such member")}).then(function(n){return u.sismember(e,t)}).then(function(n){return n?(u._keys[key]=3,o.resolve(0),i(null,0),void 0):u.sadd(e,t)}).then(function(n){u._keys[key]=3,o.resolve(1),i(null,1)},function(n){o.reject(n),i(n)}),o},a.srandmember=function(n){var e=this,t=arguments.length<=1||void 0===arguments[1]?s:arguments[1],u=new r.Promise(s);return this.exists(n).then(function(r){return r?e.get(n):(u.resolve(null),void t(null,null))}).then(function(n){var e=Math.random()*n.length||0,r=n[e];u.resolve(r),t(null,r)},function(n){u.reject(n),t(n)}),u},a.spop=function(n){var e=this,t=arguments.length<=1||void 0===arguments[1]?s:arguments[1],u=new r.Promise(s);u.then(function(t){return e.emit("spop",n,t)});var i=null;return this.exists(n).then(function(r){return r?e.srandmember(n):(u.resolve(null),void t(null,null))}).then(function(t){return i=t,e.srem(n,i)}).then(function(n){u.resolve(i),t(null,i)},function(n){u.reject(n),t(n)}),u},a.sunion=function(){for(var n=this,e=arguments.length,t=Array(e),u=0;e>u;u++)t[u]=arguments[u];var i=new r.Promise(s),a=s,l=null;t[t.length-1]instanceof Function&&(a=t.pop());var f=[](l=function(e){var r=t[e];r?n.exists(r).then(function(t){return t?n.get(r):void l(++e)}).then(function(n){Array.isArray(n)&&(f=f.concat(n)),l(++e)},function(n){return i.reject(n),a(n)}):(f=o["default"].arrayUnique(f),i.resolve(f),a(null,f))})(0);return i},a.sunionstore=function(n){for(var e=this,t=arguments.length,u=Array(t>1?t-1:0),o=1;t>o;o++)u[o-1]=arguments[o];var a=new r.Promise(s),l=s;a.then(function(t){var r=i(t,2),o=r[0],s=r[1];return e.emit("sunionstore",n,u,o,s)}),u[u.length-1]instanceof Function&&(l=u.pop());var f=null;return this.sunion(u).then(function(t){return f=t,e.exists(n)}).then(function(t){return t?e.del(n):e.sadd(n,f)}).then(function(t){return"number"!=typeof t?e.sadd(n,f):(a.resolve([t,f]),void l(null,t,f))}).then(function(n){a.resolve(n,f),l(null,n,f)},function(n){a.reject(n),l(n)}),a},a.sinter=function(){for(var n=this,e=arguments.length,t=Array(e),u=0;e>u;u++)t[u]=arguments[u];var i=new r.Promise(s),a=s,l=null;t[t.length-1]instanceof Function&&(a=t.pop());var f=[](l=function(e){var r=t[e];if(r)n.exists(r).then(function(t){return t?n.get(r):void l(++e)}).then(function(n){Array.isArray(n)&&f.push(n),l(++e)},function(n){return i.reject(n),a(n)});else{var u=o["default"].arrayInter.apply(o["default"],f);i.resolve(u),a(null,u)}})(0);return i},a.sinterstore=function(n){for(var e=this,t=new r.Promise(s),u=s,i=arguments.length,o=Array(i>1?i-1:0),a=1;i>a;a++)o[a-1]=arguments[a];o[o.length-1]instanceof Function&&(u=o.pop());var l=null;return this.sinter.apply(this,o).then(function(t){return l=t,e.exists(n)}).then(function(t){return t?e.del(n):(l.unshift(n),e.sadd.apply(e,l))}).then(function(r){return"string"!=typeof r?e.sadd(n,l):(t.resolve(l.length,l),void u(null,l.length,l))}).then(function(n){t.resolve(l.length,l),u(null,l.length,l)},function(n){t.reject(n),u(n)}),t},a.sdiff=function(){for(var n=this,e=arguments.length,t=Array(e),u=0;e>u;u++)t[u]=arguments[u];var i=new r.Promise(s),a=s,l=null;t[t.length-1]instanceof Function&&(a=t.pop());var f=[](l=function(e){var r=t[e];if(r)n.exists(r).then(function(t){return t?n.get(r):void l(++e)}).then(function(n){Array.isArray(n)&&f.push(n),l(++e)},function(n){return i.reject(n),a(n)});else{var u=o["default"].arrayDiff.apply(o["default"],f);i.resolve(u),a(null,u)}})(0);return i},a.sdiffstore=function(n){for(var e=this,t=new r.Promise(s),u=s,i=arguments.length,o=Array(i>1?i-1:0),a=1;i>a;a++)o[a-1]=arguments[a];o[o.length-1]instanceof Function&&(u=o.pop());var l=null;return this.sdiff(o).then(function(t){return l=t,e.exists(n)}).then(function(t){return t?e.del(n):e.sadd(n,l)}).then(function(r){return"number"!=typeof r?e.sadd(n,l):(t.resolve(r,l),void u(null,r,l))}).then(function(n){t.resolve(n,l),u(null,n,l)},function(n){t.reject(n),u(n)}),t}})});
!function(e,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var t={exports:{}};n(t.exports),e.zset=t.exports}}(this,function(e){"use strict";!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],t);else if("undefined"!=typeof e&&"undefined"!=typeof module)t(e,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};t(r.exports,r,n.utils,n.events),n.zset=r.exports}}(void 0,function(e,n,t,r){function s(e){return e&&e.__esModule?e:{"default":e}}var u=s(t),i=(void 0||window||global,u["default"].noop),o={};n.exports=o,o.zadd=function(e,n,t){var s=this,u=arguments.length<=3||void 0===arguments[3]?i:arguments[3],o=new r.Promise(i);return o.then(function(r){return s.emit("zadd",e,n,t,r)}),this.exists(e).then(function(r){if(r)return s.get(e);var u={};return u[n]=[0],s.set(e,{ms:[t],hsm:{0:n},shm:u})}).then(function(r){if("string"==typeof r)s._keys[e]=4,o.resolve(1,1),u(null,1,1);else if("object"==typeof r){var i=r;if(i.ms.indexOf(t)>=0){var c=i.ms.length;return o.resolve(0,c),u(null,0,c)}var f=i.ms.length;return i.ms.push(t),i.hsm[f]=n,Array.isArray(i.shm[n])?i.shm[n].push(f):i.shm[n]=[f],s.set(e,i)}}).then(function(e,n){s._keys[e]=4;var t=n.ms.length;o.resolve(1,t),u(null,1,t)},function(e){o.reject(e),u(e)}),o},o.zcard=function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?i:arguments[1],s=new r.Promise(i);return this.exists(e).then(function(r){if(r)return n.get(e);var u=new Error("no such key");s.reject(u),t(u)}).then(function(e){var n=e.ms.filter(Boolean).length;s.resolve(n),t(null,n)},function(e){s.reject(e),t(e)}),s},o.zcount=function(e,n,t){var s=this,u=arguments.length<=3||void 0===arguments[3]?i:arguments[3],o=new r.Promise(i);return o.then(function(r){return s.emit("zcount",e,n,t,value)}),this.exists(e).then(function(n){if(n)return s.get(e);var t=new Error("no such key");o.reject(t),u(t)}).then(function(e){var r=Object.keys(e.shm).filter(function(e){return e>=n&&t>=e}).map(function(n){return e.shm[n]}),s=r.map(function(e){return e.length}).reduce(function(e,n){return e+n});o.resolve(s),u(null,s)},function(e){o.reject(e),u(e)}),o},o.zrem=function(e){for(var n=this,t=arguments.length,s=Array(t>1?t-1:0),u=1;t>u;u++)s[u-1]=arguments[u];var o=new r.Promise(i),c=i;s[s.length-1]instanceof Function&&(c=s.pop()),o.then(function(t){return n.emit("zrem",e,s,t)});var f=0;return this.exists(e).then(function(t){if(t)return n.get(e);var r=new Error("no such key");o.reject(r),c(r)}).then(function(e){var n=(s.length,new r.Promise(i)),t=!0,u=!1,o=void 0;try{for(var c,h=s[Symbol.iterator]();!(t=(c=h.next()).done);t=!0){var a=c.value,m=e.ms.indexOf(a);if(m>=0){e.ms[a]=0;var l=e.hsm[a];delete e.hsm[a];var v=e.shm[l].indexOf(a);v>=0&&e.shm[l].splice(v,1),f++}}}catch(g){u=!0,o=g}finally{try{!t&&h["return"]&&h["return"]()}finally{if(u)throw o}}return n.resolve(e),n}).then(function(t){return n.set(e,t)}).then(function(e){o.resolve(f),c(null,f)},function(e){o.reject(e),c(null,e)}),o},o.zscore=function(e,n){var t=this,s=arguments.length<=2||void 0===arguments[2]?i:arguments[2],u=new r.Promise(i);return this.exists(e).then(function(n){if(n)return t.get(e);var r=new Error("no such key");u.reject(r),s(r)}).then(function(e){var t=e.ms.indexOf(n);if(t>=0){var r=e.hsm[t];u.resolve(r),s(null,r)}else{var i=new Error("This member does not be in the set");u.reject(i),s(i)}}),u},o.zrange=function(e,n,t){var s=this,o=arguments.length<=3||void 0===arguments[3]?i:arguments[3],c=new r.Promise(i);return this.exists(e).then(function(n){if(n)return this.get(e);var t=new Error("no such key");c.reject(t),o(t)}).then(function(e){var r=Object.keys(e.shm).filter(function(e){return e>=n&&t>=e}).map(function(n){return e.shm[n]}),s=u["default"].flatten(r.map(function(n){return n.map(function(n){return e.ms[n]})})).reduce(function(e,n){return e.concat(n)});c.resolve(s),o(null,s)},function(e){c.reject(e),o(e)}),c.withScore=function(){var n=arguments.length<=0||void 0===arguments[0]?i:arguments[0],t=new r.Promise(i);return c.then(function(r){var u=s.multi();r.forEach(function(n){return u.zscore(e,n)}),u.exec(function(e,s){if(e)return n(e),t.reject(e);var u=s.map(function(e,n){return{member:r[n],score:e[0]}});t.resolve(u),n(null,u)})}),t},c},o.zrevrange=function(e,n,t){var s=this,o=arguments.length<=3||void 0===arguments[3]?i:arguments[3],c=new r.Promise(i);return this.exists(e).then(function(n){if(n)return s.get(e);var t=new Error("no such key");c.reject(t),o(t)}).then(function(e){var r=Object.keys(e.shm).reverse().filter(function(e){return e>=n&&t>=e}).map(function(n){return e.shm[n]}),s=u["default"].flatten(r.map(function(n){return n.map(function(n){return e.ms[n]})})).reduce(function(e,n){return e.concat(n)});c.resolve(s),o(null,s)},function(e){c.reject(e),o(e)}),c.withScore=function(){var n=arguments.length<=0||void 0===arguments[0]?i:arguments[0],t=new r.Promise(i);return c.then(function(r){var u=s.multi();r.forEach(function(n){return u.zscore(e,n)}),u.exec(function(e,s){if(e)return n(e),t.reject(e);var u=s.map(function(e,n){return{member:r[n],score:e[0]}});t.resolve(u),n(null,u)})}),t},c},o.zincrby=function(e,n,t){var s=this,u=arguments.length<=3||void 0===arguments[3]?i:arguments[3],o=new r.Promise(i);o.then(function(r){return s.emit("zincrby",e,n,t,r)});var c=null;return this.exists(e).then(function(r){return r?s.zscore(e,t):void s.zadd(e,n,t,u).then(o.resolve.bind(o),o.reject.bind(o))}).then(function(n){return s.get(e)}).then(function(r){var u=r.ms.indexOf(t),i=r.hsm[u];c=i+n;var o=r.shm[i].indexOf(u);return r.shm[i].splice(o,1),r.hsm[u]=c,r.shm[c]?r.shm[c].push(u):r.shm[c]=[u],s.set(e,r)}).then(function(e){o.resolve(c),u(null,c)},function(e){o.reject(e),u(e)}),o},o.zdecrby=function(e,n,t){var s=this,u=arguments.length<=3||void 0===arguments[3]?i:arguments[3],o=new r.Promise(i);o.then(function(e){return s.emit("zdecrby",keys,n,t,e)});var c=null;return this.exists(e).then(function(n){if(n)return s.zscore(e,t);var r=new Error("no such key");o.reject(r),u(r)}).then(function(n){return s.get(e)}).then(function(r){var u=r.ms.indexOf(t),i=r.hsm[u];c=i-n;var o=r.shm[i].indexOf(u);return r.shm[i].splice(o,1),r.hsm[u]=c,r.shm[c]?r.shm[c].push(u):r.shm[c]=[u],s.set(e,r)}).then(function(e){o.resolve(c),u(null,c)},function(e){o.reject(e),u(e)}),o},o.zrank=function(e,n){var t=this,s=arguments.length<=2||void 0===arguments[2]?i:arguments[2],u=new r.Promise(i);return this.exists(e).then(function(n){if(n)return t.get(e);var r=new Error("no such key");u.reject(r),s(r)}).then(function(e){var t=Object.keys(e.shm),r=e.hsm[e.ms.indexOf(n)],i=t.indexOf(r);u.resolve(i),s(null,i)},function(e){u.reject(e),s(e)}),u},o.zrevrank=function(e,n){var t=this,s=arguments.length<=2||void 0===arguments[2]?i:arguments[2],u=new r.Promise(i);return this.exists(e).then(function(n){if(n)return t.get(e);var r=new Error("no such key");u.reject(r),s(r)}).then(function(e){var t=Object.keys(e.shm),r=e.hsm[e.ms.indexOf(n)],i=t.reverse().indexOf(r);u.resolve(i),s(null,i)},function(e){u.reject(e),s(e)}),u}})});
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.mise=n.exports}}(this,function(e){"use strict";!function(t,n){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js"],n);else if("undefined"!=typeof e&&"undefined"!=typeof module)n(e,module,require("./utils.js"),require("./deps/events.js"));else{var r={exports:{}};n(r.exports,r,t.utils,t.events),t.mise=r.exports}}(void 0,function(e,t,n,r){function s(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(n),l=(void 0||window||global,o["default"].noop),a={};t.exports=a;var f=function(){function e(t){var n=this,r=arguments;i(this,e),this.queue=[],this.last=null,this.state=0,this.min=t;for(var s in _nano)_nano.hasOwnProperty(s)&&"function"==typeof _nano[s]&&!function(e){n[e]=function(){return n.queue.push({method:e,args:r}),n}}(s)}return u(e,[{key:"exec",value:function(){var e=this,t=arguments,n=arguments.length<=0||void 0===arguments[0]?l:arguments[0],r=[],s=null(s=function(i){i?e.min[i.method].apply(e.min,i.args).then(function(n){r.push(t),s(e.queue.shift())},function(e){n(e,r)}):n(null,r)})(this.queue.shift())}}]),e}();a.multi=function(){return new f(void 0)};var c=function(){function e(t,n){var s=this,u=arguments,a=arguments.length<=2||void 0===arguments[2]?l:arguments[2];i(this,e);var f=null;this.min=n,this.callback=a,this.result=[],this.keys={},this.promise=new r.Promise(l),this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?e-t:JSON.stringify(e)>JSON.stringify(t)};var c=function(e){s.min.exists(t).then(function(e){return e?s.min.get(t):new Error("no such key")}).then(function(e){var t=new r.Promise(l);switch(!0){case Array.isArray(e):t.resolve(e);break;case e.ms&&Array.isArray(e.ms):t.resolve(e.ms);break;default:return new Error("content type wrong")}return t}).then(function(e){s.result=e.sort(s.sortFn),s.result.forEach(function(e){s.keys[e]=e}),s.promise.resolve(s.result),s.callback(null,s.result)},function(e){s.promise.reject(e),s.callback(e)})}(f=function(e){var t=e.shift();t?(s[t]=function(){return s.promise[t].apply(s.promise,u)},f(e)):c()})(["then","done"])}return u(e,[{key:"by",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1],r={},s=[],i=null;if(e.indexOf("->")>0){var u=e.indexOf("->");i=e.substr(u+2),e=e.substr(0,e.length-u)}return this.min.keys(e).then(function(n){for(var i=new RegExp(e.replace("?","(.)").replace("*","(.*)")),u=0;u<n.length;u++){var o=i.exec(n[u])[1];t.result.indexOf(o)>=0&&(r[n[u]]=o)}return s=Object.keys(r),t.min.mget(s.slice())}).then(function(e){for(var i={},u=0;u<e.length;u++)i[JSON.stringify(e[u])]=s[u];e.sort(t.sortFn);var o=e.map(function(e){return i[JSON.stringify(e)]}).map(function(e){return r[e]});t.result=o,t.promise.resolve(o),n(null,o)},function(e){t.promise.reject(e),n(e),t.callback(e)}),this}},{key:"asc",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?e-t:JSON.stringify(e)>JSON.stringify(t)};var n=function(n){e.result=n.sort(e.sortFn),e.promise.resolve(e.result),t(null,e.result)};return this.promise.ended?n(this.result):this.promise.once("resolve",n),this}},{key:"desc",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?t-e:JSON.stringify(e)<JSON.stringify(t)};var n=function(n){e.result=n.sort(e.sortFn),e.promise.resolve(e.result),t(null,e.result)};return this.promise.ended?n(this.result):this.promise.once("resolve",n),this}},{key:"get",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1],r=function(r){var s=[],i=null(i=function(r){var u=r.shift();if(o["default"].isUndefined(u))t.result=s,t.promise.resolve(s),n(null,s);else if(Array.isArray(u)){var l=t.keys[u[0]];t.min.get(e.replace("*",l)).then(function(e){u.push(e),s.push(u),i(r)},function(e){t.promise.reject(e),n(e)})}else if(u.substr||o["default"].isNumber(u)){var l=t.keys[u];t.min.get(e.replace("*",l)).then(function(e){s.push([e]),e.substr||o["default"].isNumber(e)?t.keys[e]=l:t.keys[JSON.stringify(e)]=l,i(r)},function(e){t.promise.reject(e),n(e)})}})(r.slice())};return this.promise.ended?r(this.result):this.promise.once("resolve",r),this}},{key:"hget",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?l:arguments[2],s=function(s){var i=[],u=null(u=function(s){var l=s.shift();if(o["default"].isUndefined(l))n.result=i,n.promise.resolve(i),r(null,i);else if(Array.isArray(l)){var a=n.keys[l[0]];n.min.hget(e.replace("*",a),t).then(function(e){l.push(e),i.push(l),u(s)},function(e){n.promise.reject(e),r(e)})}else if(l.substr||o["default"].isNumber(l)){var a=n.keys[l];n.min.hget(e.replace("*",a)).then(function(e){i.push([e]),e.substr||o["default"].isNumber(e)?n.keys[e]=a:n.keys[JSON.stringify(e)]=a,u(s)},function(e){n.promise.reject(e),r(e)})}})(s.slice())};return this.promise.ended?s(this.result):this.promise.once("resolve",s),this}},{key:"limit",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?l:arguments[2],s=function(s){n.result=s.splice(e,t),n.promise.resolve(n.result),r(null,n.result)};return this.promise.ended?s(this.result):this.promise.once("resolve",s),this}},{key:"flatten",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];if(this.promise.ended){for(var n=[],r=0;r<this.result.length;r++)for(var s=0;s<this.result[r].length;s++)n.push(this.result[r][s]);this.result=n,this.promise.resolve(n),t(null,n)}else this.promise.once("resolve",function(n){for(var r=[],s=0;s<n.length;s++)for(var i=0;i<n[s].length;i++)r.push(n[s][i]);e.result=r,e.promise.resolve(r),t(null,r)});return this}},{key:"store",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.promise.ended?this.min.set(e,this.result).then(function(e){t.promise.resolve(t.result),n(null,t.result)},function(e){t.promise.reject(e),n(e)}):this.promise.once("resolve",function(r){t.min.set(e,r).then(function(e){t.promise.resolve(r),n(null,r)},function(e){t.promise.reject(e),n(e)})}),this}}]),e}();a.sort=function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return new c(e,void 0,t)};var h=function(){function e(t,n,r,s){i(this,e),n=n||"*",this.cursor=t||0,this.pattern=new RegExp(n.replace("*","(.*)")),this.limit=r>-1?r:10,this.end=this.cursor,this.parent=s}return u(e,[{key:"scan",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0],n=[];return this.parent.get("min_keys").then(function(r){r=JSON.parse(r);var s=null,i=Object.keys(r)(s=function(r){var u=i[r];if(u&&e.pattern.test(u)&&"min_keys"!==u){if(n.push(u),++e.end-e.cursor>=e.limit)return t(null,n,e.end)}else if(!u)return e.end=0,t(null,n,e.end);return s(++r)})(e.cursor)},function(e){t(e)}),this}},{key:"match",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.pattern=new RegExp(e.replace("*","(.*)")),this.end=this.cursor,this.scan(t)}},{key:"count",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.limit=e,this.end=this.cursor,this.scan(t)}}]),e}();a.scan=function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1],n=new h(e,null,-1,void 0);return n.scan(t),n}})});
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.min=n.exports}}(this,function(e){"use strict";!function(t,n){if("function"==typeof define&&define.amd)define(["exports","module","./utils.js","./deps/events.js","./mix.js","./hash.js","./list.js","./set.js","./zset.js","./mise.js","./stores.js"],n);else if("undefined"!=typeof e&&"undefined"!=typeof module)n(e,module,require("./utils.js"),require("./deps/events.js"),require("./mix.js"),require("./hash.js"),require("./list.js"),require("./set.js"),require("./zset.js"),require("./mise.js"),require("./stores.js"));else{var r={exports:{}};n(r.exports,r,t.utils,t.events,t.mix,t.hash,t.list,t.set,t.zset,t.mise,t.stores),t.min=r.exports}}(void 0,function(e,t,n,r,s,i,u,o,a,l,m){function f(e){return e&&e.__esModule?e:{"default":e}}var c=function(){function e(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var u,o=e[Symbol.iterator]();!(r=(u=o.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(a){s=!0,i=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(s)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=f(n),d=f(s),v=f(i),g=f(u),y=f(o),p=f(a),j=f(l),x=(void 0||window||global,h["default"].noop),k={};t.exports=k,h["default"].extend(k,r.EventEmitter.prototype),k.EventEmitter=r.EventEmitter,k.Promise=r.Promise,k.memStore=m.memStore,k.localStore=m.localStore,k.store=new m.localStore;var w=k._keys={},_=null,b={0:"mix",1:"hash",2:"list",3:"set",4:"zset"};k.fork=function(){var e={};for(var t in void 0)(void 0).hasOwnProperty(t)&&(e[t]=(void 0)[t]);return e},k.del=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?x:arguments[1],s=new r.Promise(x);s.then(function(){t.emit("del",e),_&&clearTimeout(_),_=setTimeout(t.save.bind(t),1e3)});var i=this.store,u="min-"+e;if(i.async){var o=function(){i.remove(u,function(r){return r?(s.reject(r),n(r)):(delete t._keys[e],s.resolve(e),void n(null,e))})};i.ready?o():i.on("ready",o)}else try{i.remove(u),delete this._keys[e],s.resolve(e),n(null,e)}catch(a){s.reject(a),n(a)}return this.emit("del",e),s},k.exists=function(e){var t=arguments.length<=1||void 0===arguments[1]?x:arguments[1],n=new r.Promise(x);try{this.get(e).then(function(e){return"undefined"==typeof e?(n.resolve(!1),t(null,!1)):(n.resolve(!0),t(null,!0))},function(e){n.resolve(!1),t(null,!1)})}catch(s){return n.reject(s),t(s)}return n},k.renamenx=function(e,t){var n=this,s=arguments.length<=2||void 0===arguments[2]?x:arguments[2],i=new r.Promise(x);i.then(function(r){n.emit("rename",e,t),_&&clearTimeout(_),_=setTimeout(n.save.bind(n),5e3)});try{var u=function(e){i.reject(e),s(e)},o=null,a=null;this.exists(e).then(function(t){if(t)return n.get(e);var r=new Error("no such key");u(r)}).then(function(t){return o=n._keys[e],a=t,n.del(e)}).then(function(e){return n.set(t,a,s)}).then(function(e){n._keys[t]=o,i.resolve("OK"),s(null,"OK")},u)}catch(l){u(l)}return i},k.rename=function(e,t){var n=this,s=arguments.length<=2||void 0===arguments[2]?x:arguments[2],i=new r.Promise(x);i.then(function(r){n.emit("rename",e,t),_&&clearTimeout(_),_=setTimeout(n.save.bind(n),5e3)});var u=function(e){i.reject(e),s(e)};return e==t?u(new Error("The key is equal to the new key.")):this.renamenx.apply(this,arguments).then(i.resolve.bind(i),i.reject.bind(i)),i},k.keys=function(e){var t=arguments.length<=1||void 0===arguments[1]?x:arguments[1],n=new r.Promise,s=Object.keys(this._keys),i=e.replace("?","(.)").replace("*","(.*)");i=new RegExp(i);for(var u=[],o=0;o<s.length;o++)s[o].match(i)&&u.push(s[o]);return setTimeout(function(e){return n.resolve(u)},100),t(null,u),n},k.randomkey=function(){var e=arguments.length<=0||void 0===arguments[0]?x:arguments[0],t=new r.Promise(x),n=Object.keys(this._keys),s=Math.round(Math.random()*(n.length-1)),i=n[s];return t.resolve(i),e(null,i),t},k.type=function(e){var t=arguments.length<=1||void 0===arguments[1]?x:arguments[1],n=new r.Promise(x);return this._keys.hasOwnProperty(e)?(n.resolve(b[this._keys[e]]),t(null,t)):(n.resolve(null),t(null,null)),n},k.empty=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?x:arguments[0],n=new r.Promise(x),s=Object.keys(this._keys),i=null,u=0;return n.then(function(t){e.emit("empty",t),_&&clearTimeout(_),_=setTimeout(e.save.bind(e),5e3)})(i=function(r){r?e.del(r,function(e){e||u++,i(s.shift())}):(n.resolve(u),t(null,u))})(s.shift()),n},k.save=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?x:arguments[0],n=new r.Promise(x);return n.then(function(t){var n=c(t,2),r=n[0],s=n[1];e.emit("save",r,s)}),this.set("min_keys",JSON.stringify(this._keys)).then(function(t){return e.dump()}).then(function(e,r){n.resolve([e,r]),t(e,r)},function(e){n.reject(e),t(e)}),n},k.dump=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?x:arguments[0],n=null,s=new r.Promise,i={};return this.keys("*",function(r,u){return r?(s.reject(r),t(r)):void(n=function(r){if(r)e.get(r).then(function(e){i[r]=e,n(u.shift())},function(e){s.reject(e),t(e)});else{var o=JSON.stringify(i);s.resolve([i,o]),t(null,i,o)}})(u.shift())}),s},k.restore=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?x:arguments[1],s=new r.Promise(x),i=null;s.then(function(e){t.save(function(e){t.emit("restore")})});var u=Object.keys(e)(i=function(r,o){r?t.set(r,e[r]).then(function(e){i(u.shift(),o)},function(e){s.reject(e),n(e)}):o()})(u.shift(),function(e){t.exists("min_keys").then(function(e){return e?t.get("min_keys"):(s.resolve(),void n())}).then(function(e){w=JSON.parse(e),s.resolve(),n()})});return s};var P={};k.watch=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?"set":arguments[2],s=Math.random().toString(32).substr(2);return P[e]||(P[e]={}),P[e][s]=function(r){for(var s=arguments.length,i=Array(s>1?s-1:0),u=1;s>u;u++)i[u-1]=arguments[u];r===e&&t.call.apply(t,[n].concat(i))},P[e][s].command=r,this.on(r,P[e][s]),s},k.unwatch=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?"set":arguments[2];this.removeListener(n,P[e][t])},k.unwatchForKey=function(e){var t=P[e];for(var n in t){var r=t[n];this.removeListener(r.command,r)}},h["default"].extend(k,v["default"]),h["default"].extend(k,g["default"]),h["default"].extend(k,y["default"]),h["default"].extend(k,p["default"]),h["default"].extend(k,j["default"]),h["default"].extend(k,d["default"]),k.exists("min_keys").then(function(e){return e?k.get("min_keys"):void 0}).then(function(e){k._keys=JSON.parse(e)})})});
//# sourceMappingURL=maps/min.js.map