/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 p2.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("function"==typeof bootstrap)bootstrap("p2",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=a}else"undefined"!=typeof window?window.p2=a():self.p2=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){b.exports={Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./constraints/ContactEquation"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./constraints/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./constraints/FrictionEquation"),GridBroadphase:a("./collision/GridBroadphase"),GSSolver:a("./solver/GSSolver"),Island:a("./solver/IslandSolver"),IslandSolver:a("./solver/IslandSolver"),Line:a("./shapes/Line"),Material:a("./material/Material"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),PointToPointConstraint:a("./constraints/PointToPointConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),Rectangle:a("./shapes/Rectangle"),RotationalVelocityEquation:a("./constraints/RotationalVelocityEquation"),SAP1DBroadphase:a("./collision/SAP1DBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),World:a("./world/World"),QuadTree:a("./collision/QuadTree").QuadTree,vec2:a("./math/vec2"),version:a("../package.json").version}},{"../package.json":2,"./objects/Body":3,"./collision/Broadphase":4,"./shapes/Capsule":5,"./shapes/Circle":6,"./constraints/Constraint":7,"./constraints/ContactEquation":8,"./material/ContactMaterial":9,"./shapes/Convex":10,"./constraints/DistanceConstraint":11,"./constraints/Equation":12,"./events/EventEmitter":13,"./constraints/FrictionEquation":14,"./collision/GridBroadphase":15,"./solver/GSSolver":16,"./solver/IslandSolver":17,"./shapes/Line":18,"./material/Material":19,"./collision/NaiveBroadphase":20,"./shapes/Particle":21,"./shapes/Plane":22,"./constraints/PointToPointConstraint":23,"./constraints/PrismaticConstraint":24,"./shapes/Rectangle":25,"./constraints/RotationalVelocityEquation":26,"./collision/SAP1DBroadphase":27,"./shapes/Shape":28,"./solver/Solver":29,"./objects/Spring":30,"./world/World":31,"./collision/QuadTree":32,"./math/vec2":33}],2:[function(a,b){b.exports={name:"p2",version:"0.2.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest",nodeunit:"latest",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"*","grunt-browserify":"*",browserify:"*"},dependencies:{"gl-matrix":"2.0.0"}}},{}],7:[function(a,b){function c(a,b){this.equations=[],this.bodyA=a,this.bodyB=b}b.exports=c},{}],9:[function(a,b){function c(a,b,c){c=c||{},this.id=d++,this.materialA=a,this.materialB=b,this.friction="undefined"!=typeof c.friction?Number(c.friction):.3,this.restitution="undefined"!=typeof c.restitution?Number(c.restitution):.3,this.stiffness="undefined"!=typeof c.stiffness?Number(c.stiffness):1e7,this.relaxation="undefined"!=typeof c.relaxation?Number(c.relaxation):3,this.frictionStiffness="undefined"!=typeof c.frictionStiffness?Number(c.frictionStiffness):1e7,this.frictionRelaxation="undefined"!=typeof c.frictionRelaxation?Number(c.frictionRelaxation):3}b.exports=c;var d=0},{}],12:[function(a,b){function c(a,b,c,d){this.minForce="undefined"==typeof c?-1e6:c,this.maxForce="undefined"==typeof d?1e6:d,this.bi=a,this.bj=b,this.stiffness=1e6,this.relaxation=4,this.a=0,this.b=0,this.eps=0,this.h=0,this.updateSpookParams(1/60)}b.exports=c,c.prototype.constructor=c,c.prototype.updateSpookParams=function(a){var b=this.stiffness,c=this.relaxation,d=a;this.a=4/(d*(1+4*c)),this.b=4*c/(1+4*c),this.eps=4/(d*d*b*(1+4*c)),this.h=a}},{}],13:[function(a,b){var c=function(){};b.exports=c,c.prototype={constructor:c,on:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;return void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},off:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a].indexOf(b);-1!==d&&c[a].splice(d,1)}},emit:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++)c[d].call(this,a)}return this}}}},{}],19:[function(a,b){function c(){this.id=d++}b.exports=c;var d=0},{}],28:[function(a,b){function c(a){this.type=a,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,a&&this.updateBoundingRadius(),this.material=null}b.exports=c,c.CIRCLE=1,c.PARTICLE=2,c.PLANE=4,c.CONVEX=8,c.LINE=16,c.RECTANGLE=32,c.CAPSULE=64,c.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},c.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")}},{}],29:[function(a,b){function c(){this.equations=[]}b.exports=c,c.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},c.prototype.addEquation=function(a){this.equations.push(a)},c.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!=b&&this.equations.splice(b,1)},c.prototype.removeAllEquations=function(){this.equations=[]}},{}],3:[function(a,b){function c(a){a=a||{},this.id=++c._idCounter,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.updateMassProperties(),this.position=d.fromValues(0,0),a.position&&d.copy(this.position,a.position),this.velocity=d.fromValues(0,0),a.velocity&&d.copy(this.velocity,a.velocity),this.vlambda=d.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=d.create(),a.force&&d.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.motionState=0==this.mass?c.STATIC:c.DYNAMIC,this.boundingRadius=0}var d=a("../math/vec2");b.exports=c;var e=d.fromValues(0,0);c._idCounter=0,c.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=this.shapeOffsets,c=a.length,f=0,g=0;g!==c;g++){var h=a[g],i=d.length(b[g]||e),j=h.boundingRadius;i+j>f&&(f=i+j)}this.boundingRadius=f},c.prototype.addShape=function(a,b,c){this.shapes.push(a),this.shapeOffsets.push(b),this.shapeAngles.push(c),this.updateMassProperties(),this.updateBoundingRadius()},c.prototype.updateMassProperties=function(){for(var a=this.shapes,b=a.length,c=this.mass/b,f=0,g=0;b>g;g++){var h=a[g],i=d.squaredLength(this.shapeOffsets[g]||e),j=h.computeMomentOfInertia(c);f+=j+c*i}this.inertia=f,this.invMass=this.mass>0?1/this.mass:0,this.invInertia=f>0?1/f:0};var f=d.create();c.prototype.applyForce=function(a,b){var c=f;d.sub(c,b,this.position),d.add(this.force,this.force,a);var e=d.crossLength(c,a);this.angularForce+=e},c.prototype.toLocalFrame=function(a,b){d.toLocalFrame(a,b,this.position,this.angle)},c.prototype.toWorldFrame=function(a,b){d.toGlobalFrame(a,b,this.position,this.angle)},c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4},{"../math/vec2":33}],4:[function(a,b){function c(){}var d=a("../math/vec2");a("./Nearphase"),a("./../shapes/Shape"),b.exports=c,c.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var e=d.create();d.create(),d.fromValues(0,1),c.boundingRadiusCheck=function(a,b){d.sub(e,a.position,b.position);var c=d.squaredLength(e),f=a.boundingRadius+b.boundingRadius;return f*f>=c}},{"../math/vec2":33,"./Nearphase":34,"./../shapes/Shape":28}],5:[function(a,b){function c(a,b){this.length=a||1,this.radius=b||1,d.call(this,d.CAPSULE)}var d=a("./Shape");a("../math/vec2"),b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius,c=this.length+b,d=2*b;return a*(d*d+c*c)/12},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2}},{"./Shape":28,"../math/vec2":33}],6:[function(a,b){function c(a){this.radius=a||1,d.call(this,d.CIRCLE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius}},{"./Shape":28}],8:[function(a,b){function c(a,b){d.call(this,a,b,0,1e6),this.penetration=0,this.ri=e.create(),this.penetrationVec=e.create(),this.rj=e.create(),this.ni=e.create(),this.rixn=e.create(),this.rjxn=e.create(),this.rixw=e.create(),this.rjxw=e.create(),this.relVel=e.create(),this.relForce=e.create()}var d=a("./Equation"),e=a("../math/vec2"),f=a("../math/mat2");b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeB=function(a,b,c){var d=this.bi,f=this.bj,g=this.ri,h=this.rj,i=d.position,j=f.position,k=d.velocity,l=d.angularVelocity,m=d.force,n=d.angularForce,o=f.velocity,p=f.angularVelocity,q=f.force,r=f.angularForce,s=(this.relVel,this.relForce,this.penetrationVec),t=d.invMass,u=f.invMass,v=d.invInertia,w=f.invInertia,x=this.ni,y=this.rixn=e.crossLength(g,x),z=this.rjxn=e.crossLength(h,x);e.set(s,0,0),e.add(s,j,h),e.sub(s,s,i),e.sub(s,s,g);var A=e.dot(x,s),B=e.dot(o,x)-e.dot(k,x)+p*z-l*y,C=e.dot(q,x)*u-e.dot(m,x)*t+w*r*z-v*n*y,D=-A*a-B*b-c*C;return D};var g=e.create(),h=f.create(),i=f.create();c.prototype.computeC=function(a){var b=this.bi,c=this.bj,d=this.ni,j=this.rixn,k=this.rjxn,l=g,m=h,n=i;f.identity(m),f.identity(n),m[0]=m[3]=b.invMass,n[0]=n[3]=c.invMass;var o=e.dot(d,e.transformMat2(l,d,m))+e.dot(d,e.transformMat2(l,d,n))+a;return o+=b.invInertia*j*j,o+=c.invInertia*k*k};{e.create()}c.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=e.dot(this.ni,a.vlambda),c-=a.wlambda*this.rixn,c+=e.dot(this.ni,b.vlambda),c+=b.wlambda*this.rjxn};var j=e.create();c.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixn,g=this.rjxn,k=this.ni,l=j,m=h,n=i;f.identity(m),f.identity(n),m[0]=m[3]=b.invMass,n[0]=n[3]=c.invMass,e.scale(l,e.transformMat2(l,k,m),-a),e.add(b.vlambda,b.vlambda,l),e.scale(l,e.transformMat2(l,k,n),a),e.add(c.vlambda,c.vlambda,l),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*g*a}},{"./Equation":12,"../math/vec2":33,"../math/mat2":35}],10:[function(a,b){function c(a){this.vertices=a||[],this.centerOfMass=e.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,this.updateBoundingRadius(),d.call(this,d.CONVEX)}var d=a("./Shape"),e=a("../math/vec2"),f=a("../math/polyk");b.exports=c,c.prototype=new d,c.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.push(c[0],c[1])}for(var d=f.Triangulate(a),b=0;b<d.length;b+=3){var e=d[b],g=d[b+1],h=d[b+2];this.triangles.push([e,g,h])}};{var g=e.create(),h=e.create(),i=e.create(),j=e.create(),k=e.create(),l=(e.create(),e.create()),m=e.create();e.create()}c.prototype.updateCenterOfMass=function(){var a=this.triangles,b=this.vertices,c=this.centerOfMass,d=g,f=i,n=j,o=k,p=l,q=m,r=h;e.set(c,0,0);for(var s=0;s<a.length;s++){var t=a[s],f=b[t[0]],n=b[t[1]],o=b[t[2]];e.centroid(d,f,n,o),e.sub(p,o,f),e.sub(q,o,n);var u=.5*e.crossLength(p,q);e.scale(r,d,u),e.add(c,c,r)}},c.prototype.computeMomentOfInertia=function(a){for(var b=0,c=[],d=0;d<this.vertices.length;d++){var g=this.vertices[d];c.push(g[0],g[1])}var h=f.Triangulate(c),i=f.GetArea(c),j=a/i,k=e.create(),l=e.create(),m=e.create(),n=e.create(),o=(e.create(),e.create(),e.create()),p=e.create();e.create();for(var d=0;d<h.length;d+=3){var q=h[d],r=h[d+1],s=h[d+2];e.set(k,c[2*q],c[2*q+1]),e.set(l,c[2*r],c[2*r+1]),e.set(m,c[2*s],c[2*s+1]),e.centroid(n,k,l,m),e.sub(o,m,k),e.sub(p,m,l);var t=.5*e.crossLength(o,p),u=e.length(o),v=2*t/u,w=u*Math.pow(v,3)/36,x=u*v/2*j,y=e.squaredLength(n);b+=w+x*y}return b},c.prototype.updateBoundingRadius=function(){for(var a=this.vertices,b=0,c=0;c!==a.length;c++){var d=e.squaredLength(a[c]);d>b&&(b=d)}this.boundingRadius=Math.sqrt(b)}},{"./Shape":28,"../math/vec2":33,"../math/polyk":36}],11:[function(a,b){function c(a,b,c,f){d.call(this,a,b),this.distance=c,"undefined"==typeof f&&(f=1e6);var g=new e(a,b);this.equations=[g],g.minForce=-f,g.maxForce=f}var d=a("./Constraint"),e=a("./ContactEquation"),f=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=this.distance;f.sub(a.ni,c.position,b.position),f.normalize(a.ni,a.ni),f.scale(a.ri,a.ni,.5*d),f.scale(a.rj,a.ni,.5*-d)}},{"./Constraint":7,"./ContactEquation":8,"../math/vec2":33}],14:[function(a,b){function c(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}function d(a,b,c){f.call(this,a,b,-c,c),this.ri=e.create(),this.rj=e.create(),this.t=e.create(),this.rixt=0,this.rjxt=0}var e=a("../math/vec2"),f=a("./Equation");b.exports=d;var g=e.dot;d.prototype=new f,d.prototype.constructor=d,d.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a};var h=[0,0,0],i=[0,0,0];d.prototype.computeB=function(a,b,d){var a=this.a,b=this.b,e=this.bi,f=this.bj,j=this.ri,k=this.rj,l=this.rixt,m=this.rjxt,n=this.t;c(h,[j[0],j[1],0],[n[0],n[1],0]),c(i,[k[0],k[1],0],[n[0],n[1],0]);var l=this.rixt=h[2],m=this.rjxt=i[2],o=0,p=-g(e.velocity,n)+g(f.velocity,n)-l*e.angularVelocity+m*f.angularVelocity,q=-g(e.force,n)*e.invMass+g(f.force,n)*f.invMass-l*e.invInertia*e.angularForce+m*f.invInertia*f.angularForce,r=-o*a-p*b-d*q;return r},d.prototype.computeC=function(a){var b,c=this.bi,d=this.bj,e=this.rixt,f=this.rjxt;return b=c.invMass+d.invMass+a,b+=c.invInertia*e*e,b+=d.invInertia*f*f},d.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=e.dot(this.t,a.vlambda),c-=a.wlambda*this.rixt,c+=e.dot(this.t,b.vlambda),c+=b.wlambda*this.rjxt};var j=e.create();d.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixt,f=this.rjxt,g=this.t,h=j;e.scale(h,g,-b.invMass*a),e.add(b.vlambda,b.vlambda,h),e.scale(h,g,c.invMass*a),e.add(c.vlambda,c.vlambda,h),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*f*a}},{"../math/vec2":33,"./Equation":12}],15:[function(a,b){function d(a,b,c,d,e,f){h.apply(this),e=e||10,f=f||10,this.binsizeX=(b-a)/e,this.binsizeY=(d-c)/f,this.nx=e,this.ny=f,this.xmin=a,this.ymin=c,this.xmax=b,this.ymax=d}var e=a("../shapes/Circle"),f=a("../shapes/Plane"),g=a("../shapes/Particle"),h=a("../collision/Broadphase");a("../math/vec2"),b.exports=d,d.prototype=new h,d.prototype.getBinIndex=function(a,b){var c=this.nx,d=this.ny,e=this.xmin,f=this.ymin,g=this.xmax,h=this.ymax,i=Math.floor(c*(a-e)/(g-e)),j=Math.floor(d*(b-f)/(h-f));return i*d+j},d.prototype.getCollisionPairs=function(a){for(var b=[],d=a.bodies,i=i=d.length,j=this.binsizeX,k=this.binsizeY,l=[],m=nx*ny,n=0;m>n;n++)l.push([]);for(var o=nx/(xmax-xmin),p=ny/(ymax-ymin),n=0;n!==i;n++){var q=d[n],r=q.shape;if(void 0!==r)if(r instanceof e)for(var s=q.position[0],t=q.position[1],u=r.radius,v=Math.floor(o*(s-u-xmin)),w=Math.floor(p*(t-u-ymin)),x=Math.floor(o*(s+u-xmin)),y=Math.floor(p*(t+u-ymin)),z=v;x>=z;z++)for(var A=w;y>=A;A++){var B=z,C=A;B*(ny-1)+C>=0&&m>B*(ny-1)+C&&l[B*(ny-1)+C].push(q)}else{if(!(r instanceof f))throw new Error("Shape not supported in GridBroadphase!");if(0==q.angle)for(var t=q.position[1],z=0;z!==m&&t>ymin+k*(z-1);z++)for(var A=0;nx>A;A++){var B=A,C=Math.floor(p*(k*z-ymin));l[B*(ny-1)+C].push(q)}else if(q.angle==.5*Math.PI)for(var s=q.position[0],z=0;z!==m&&s>xmin+j*(z-1);z++)for(var A=0;ny>A;A++){var C=A,B=Math.floor(o*(j*z-xmin));l[B*(ny-1)+C].push(q)}else for(var z=0;z!==m;z++)l[z].push(q)}}for(var n=0;n!==m;n++)for(var D=l[n],z=0,E=D.length;z!==E;z++)for(var q=D[z],r=q.shape,A=0;A!==z;A++){var F=D[A],G=F.shape;r instanceof e?G instanceof e?c=h.circleCircle(q,F):G instanceof g?c=h.circleParticle(q,F):G instanceof f&&(c=h.circlePlane(q,F)):r instanceof g?G instanceof e&&(c=h.circleParticle(F,q)):r instanceof f&&G instanceof e&&(c=h.circlePlane(F,q))}return b}},{"../shapes/Circle":6,"../shapes/Plane":22,"../shapes/Particle":21,"../collision/Broadphase":4,"../math/vec2":33}],16:[function(a,b){function c(a){e.call(this),a=a||{},this.iterations=a.iterations||10,this.tolerance=a.tolerance||0,this.debug=a.debug||!1,this.arrayStep=30,this.lambda=new f(this.arrayStep),this.Bs=new f(this.arrayStep),this.invCs=new f(this.arrayStep),this.useGlobalEquationParameters=!0,this.stiffness=1e6,this.relaxation=4,this.useZeroRHS=!1}var d=a("../math/vec2"),e=a("./Solver");b.exports=c;var f=Float32Array||Array;c.prototype=new e,c.prototype.setSpookParams=function(a,b){this.stiffness=a,this.relaxation=b},c.prototype.solve=function(a,b){var c=0,e=this.iterations,g=this.tolerance*this.tolerance,h=this.equations,i=h.length,j=b.bodies,k=b.bodies.length,l=a,m=this.relaxation,n=this.stiffness,o=4/(l*l*n*(1+4*m)),p=4/(l*(1+4*m)),q=4*m/(1+4*m),r=this.useGlobalEquationParameters,s=d.add,t=d.set,u=this.useZeroRHS;this.lambda.length<i&&(this.lambda=new f(i+this.arrayStep),this.Bs=new f(i+this.arrayStep),this.invCs=new f(i+this.arrayStep));for(var v=this.invCs,w=this.Bs,x=this.lambda,y=0;y!==i;y++){var z=h[y];x[y]=0;var A=p,B=q,C=o;r||(l!==z.h&&z.updateSpookParams(l),A=z.a,B=z.b,C=z.eps),w[y]=z.computeB(A,B,l),v[y]=1/z.computeC(C)}var D,z,E,F,G,H,I;if(0!==i){var y,J,K,L,M;for(y=0;y!==k;y++){var q=j[y],N=q.vlambda;t(N,0,0),q.wlambda=0}for(c=0;c!==e;c++){for(G=0,J=0;J!==i;J++){z=h[J];var C=r?o:z.eps;L=z.maxForce,K=z.minForce,D=w[J],E=v[J],I=x[J],H=z.computeGWlambda(C),u&&(D=0),F=E*(D-H-C*I),M=I+F,K>M?F=K-I:M>L&&(F=L-I),x[J]+=F,G+=Math.abs(F),z.addToWlambda(F)}if(g>=G*G)break}for(y=0;y!==k;y++){var q=j[y],O=q.velocity;s(O,O,q.vlambda),q.angularVelocity+=q.wlambda}}errorTot=G}},{"../math/vec2":33,"./Solver":29}],17:[function(a,b){function c(a){f.call(this),this.subsolver=a,this.numIslands=0,this._nodePool=[]}function d(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.motionState&i))return d}return!1}function e(a,b){var c=[];for(c.push(a),a.visited=!0,b(a);c.length;)for(var e,f=c.pop();e=d(f.children);)e.visited=!0,b(e),c.push(e)}var f=a("./Solver"),g=(a("../math/vec2"),a("../solver/Island")),h=a("../objects/Body"),i=h.STATIC;b.exports=c,c.prototype=new Object(f.prototype),c.prototype.solve=function(a,b){function c(a){v.push(a.body);for(var b=a.eqs.length,c=0;c!==b;c++){var d=a.eqs[c];-1===u.indexOf(d)&&u.push(d)}}var f=[],h=b.bodies,i=this.equations,j=i.length,k=h.length;this.subsolver,this._workers,this._workerData,this._workerIslandGroups;for(var l=0;l!==k;l++)this._nodePool.length?f.push(this._nodePool.pop()):f.push({body:h[l],children:[],eqs:[],visited:!1});for(var l=0;l!==k;l++){var m=f[l];m.body=h[l],m.children.length=0,m.eqs.length=0,m.visited=!1}for(var n=0;n!==j;n++){var o=i[n],l=h.indexOf(o.bi),p=h.indexOf(o.bj),q=f[l],r=f[p];q.children.push(r),q.eqs.push(o),r.children.push(q),r.eqs.push(o)}for(var s,t=0,u=[],v=[],w=[];s=d(f);){var x=new g;u.length=0,v.length=0,e(s,c);for(var y=u.length,l=0;l!==y;l++){var o=u[l];x.equations.push(o)}t++,w.push(x)}this.numIslands=t;for(var l=0;l<w.length;l++)w[l].solve(a,this.subsolver)}},{"./Solver":29,"../math/vec2":33,"../solver/Island":37,"../objects/Body":3}],18:[function(a,b){function c(a){this.length=a,d.call(this,d.LINE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2}},{"./Shape":28}],20:[function(a,b){function c(){d.apply(this)}var d=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2"),b.exports=c,c.prototype=new d,c.prototype.getCollisionPairs=function(a){for(var b=a.bodies,c=[],e=0,f=b.length;e!==f;e++)for(var g=b[e],h=0;e>h;h++){var i=b[h];d.boundingRadiusCheck(g,i)&&c.push(g,i)}return c}},{"../shapes/Circle":6,"../shapes/Plane":22,"../shapes/Shape":28,"../shapes/Particle":21,"../collision/Broadphase":4,"../math/vec2":33}],21:[function(a,b){function c(){d.call(this,d.PARTICLE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0},c.prototype.updateBoundingRadius=function(){this.boundingRadius=0}},{"./Shape":28}],22:[function(a,b){function c(){d.call(this,d.PLANE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0},c.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE}},{"./Shape":28}],23:[function(a,b){function c(a,b,c,f,g){d.call(this,a,c),g="undefined"!=typeof g?g:1e7,this.pivotA=b,this.pivotB=f;var h=this.equations=[new e(a,c),new e(a,c)],i=h[0],j=h[1];j.minForce=i.minForce=-g,j.maxForce=i.maxForce=g,this.motorEquation=null,this.motorVelocity=1}var d=a("./Constraint"),e=a("./ContactEquation"),f=a("./RotationalVelocityEquation"),g=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,f=e[0],h=e[1];g.subtract(f.ni,b.position,a.position),g.normalize(f.ni,f.ni),g.rotate(f.ri,c,a.angle),g.rotate(f.rj,d,b.angle),g.rotate(h.ni,f.ni,Math.PI/2),g.copy(h.ri,f.ri),g.copy(h.rj,f.rj)},c.prototype.enableMotor=function(){this.motorEquation||(this.motorEquation=new f(this.bodyA,this.bodyB),this.equations.push(this.motorEquation))},c.prototype.disableMotor=function(){if(this.motorEquation){var a=this.equations.indexOf(this.motorEquation);this.motorEquation=null,this.equations.splice(a,1)}},c.prototype.setMotorSpeed=function(a){if(this.motorEquation){var b=this.equations.indexOf(this.motorEquation);this.equations[b].relativeVelocity=a}}},{"./Constraint":7,"./ContactEquation":8,"./RotationalVelocityEquation":26,"../math/vec2":33}],24:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b);var g=this.maxForce="undefined"==typeof c.maxForce?c.maxForce:1e6,h=this.equations=[new e(a,b),new e(b,a)],i=h[0],j=h[1];i.minForce=j.minForce=-g,i.maxForce=j.maxForce=g;var k=f.create();c.worldAxis?f.copy(k,c.worldAxis):f.sub(k,b.position,a.position),f.normalize(k,k),this.localAxisA=f.create(),this.localAxisB=f.create(),c.localAxisA?f.copy(this.localAxisA,c.localAxisA):f.rotate(this.localAxisA,k,-a.angle),c.localAxisB?f.copy(this.localAxisB,c.localAxisB):f.rotate(this.localAxisB,k,-b.angle)}var d=a("./Constraint"),e=a("./ContactEquation"),f=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.equations[0],b=this.equations[1],c=this.bodyA,d=this.bodyB;f.rotate(a.ni,this.localAxisA,c.angle-Math.PI/2),f.rotate(b.ni,this.localAxisB,d.angle+Math.PI/2);var e=f.create();f.sub(e,d.position,c.position),f.scale(a.ri,a.ni,-f.dot(a.ni,e)),f.scale(b.ri,b.ni,f.dot(b.ni,e)),f.add(a.rj,a.ri,e),f.sub(b.rj,b.ri,e),f.set(a.ri,0,0),f.set(b.ri,0,0)}},{"./Constraint":7,"./ContactEquation":8,"../math/vec2":33}],25:[function(a,b){function c(a,b){var c=[d.fromValues(-a/2,-b/2),d.fromValues(a/2,-b/2),d.fromValues(a/2,b/2),d.fromValues(-a/2,b/2)];this.width=a,this.height=b,e.call(this,c)}var d=a("../math/vec2"),e=(a("./Shape"),a("./Convex"));b.exports=c,c.prototype=new e,c.prototype.computeMomentOfInertia=function(a){var b=this.width,c=this.height;return a*(c*c+b*b)/12},c.prototype.updateBoundingRadius=function(){var a=this.width,b=this.height;this.boundingRadius=Math.sqrt(a*a+b*b)/2}},{"../math/vec2":33,"./Shape":28,"./Convex":10}],26:[function(a,b){function c(a,b){d.call(this,a,b,-1e6,1e6),this.relativeVelocity=1,this.ratio=1}var d=a("./Equation"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeB=function(a,b,c){var d=this.bi,e=this.bj,f=(d.velocity,d.angularVelocity),g=d.angularForce,h=(e.velocity,e.angularVelocity),i=e.angularForce,j=d.invInertia,k=e.invInertia,l=0,m=this.ratio*h-f+this.relativeVelocity,n=k*i-j*g,o=-l*a-m*b-c*n;return o},c.prototype.computeC=function(a){var b=this.bi,c=this.bj,d=b.invInertia+c.invInertia+a;return d},e.create(),c.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=b.wlambda-a.wlambda;return c},e.create(),c.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj;b.wlambda-=b.invInertia*a,c.wlambda+=c.invInertia*a}},{"./Equation":12,"../math/vec2":33}],27:[function(a,b){function c(a){d.apply(this),this.axisList=a.bodies.slice(0),this.world=a,this.axisIndex=0;var b=this.axisList;a.on("addBody",function(a){b.push(a.body)}).on("removeBody",function(a){var c=b.indexOf(a.body);-1!==c&&b.splice(c,1)})}var d=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2"),b.exports=c,c.prototype=new d,c.sortAxisListX=function(a,b){return a.position[0]-a.boundingRadius-(b.position[0]-b.boundingRadius)},c.sortAxisListY=function(a,b){return a.position[1]-a.boundingRadius-(b.position[1]-b.boundingRadius)},c.prototype.getCollisionPairs=function(){var a=this.axisList,b=[],e=this.axisIndex;a.sort(0===e?c.sortAxisListX:c.sortAxisListY);for(var f=0,g=a.length;f!==g;f++)for(var h=a[f],i=f+1;g>i;i++){var j=a[i],k=(h.position[e]-h.boundingRadius,h.position[e]+h.boundingRadius),l=j.position[e]-j.boundingRadius;if(j.position[e]+j.boundingRadius,l>k)break;d.boundingRadiusCheck(h,j)&&b.push(h,j)}return b}},{"../shapes/Circle":6,"../shapes/Plane":22,"../shapes/Shape":28,"../shapes/Particle":21,"../collision/Broadphase":4,"../math/vec2":33}],30:[function(a,b){function c(a,b,c){c=c||{},this.restLength="number"==typeof c.restLength?c.restLength:1,this.stiffness=c.stiffness||100,this.damping=c.damping||1,this.bodyA=a,this.bodyB=b,this.localAnchorA=d.fromValues(0,0),this.localAnchorB=d.fromValues(0,0),c.localAnchorA&&d.copy(this.localAnchorA,c.localAnchorA),c.localAnchorB&&d.copy(this.localAnchorB,c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var d=a("../math/vec2");b.exports=c,c.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)},c.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)},c.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)},c.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var e=d.create(),f=d.create(),g=d.create(),h=d.create(),i=d.create(),j=d.create(),k=d.create(),l=d.create(),m=d.create();c.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,n=this.bodyA,o=this.bodyB,p=e,q=f,r=g,s=h,t=m,u=i,v=j,w=k,x=l;this.getWorldAnchorA(u),this.getWorldAnchorB(v),d.sub(w,u,n.position),d.sub(x,v,o.position),d.sub(p,v,u);var y=d.len(p);d.normalize(q,p),d.sub(r,o.velocity,n.velocity),d.crossZV(t,o.angularVelocity,x),d.add(r,r,t),d.crossZV(t,n.angularVelocity,w),d.sub(r,r,t),d.scale(s,q,-a*(y-c)-b*d.dot(r,q)),d.sub(n.force,n.force,s),d.add(o.force,o.force,s);var z=d.crossLength(w,s),A=d.crossLength(x,s);n.angularForce-=z,o.angularForce-=A}},{"../math/vec2":33}],31:[function(a,b){function c(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function d(a){o.apply(this),a=a||{},this.springs=[],this.bodies=[],this.solver=a.solver||new e,this.nearphase=new v,this.gravity=a.gravity||g.fromValues(0,-9.78),this.doProfiling=a.doProfiling||!1,this.lastStepTime=0,this.broadphase=a.broadphase||new f,this.constraints=[],this.defaultFriction=.1,this.lastTimeStep=1/60,this.applySpringForces=!0,this.contactMaterials=[],this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.addSpringEvent={type:"addSpring",body:null}}var e=a("../solver/GSSolver"),f=a("../collision/NaiveBroadphase"),g=a("../math/vec2"),h=a("../shapes/Circle"),i=a("../shapes/Rectangle"),j=a("../shapes/Convex"),k=a("../shapes/Line"),l=a("../shapes/Plane"),m=a("../shapes/Capsule"),n=a("../shapes/Particle"),o=a("../events/EventEmitter"),p=a("../objects/Body"),q=a("../objects/Spring"),r=a("../constraints/DistanceConstraint"),s=a("../constraints/PointToPointConstraint"),t=a("../constraints/PrismaticConstraint"),u=a("../../package.json"),v=(a("../collision/Broadphase"),a("../collision/Nearphase"));b.exports=d,d.prototype=new Object(o.prototype),d.prototype.addConstraint=function(a){this.constraints.push(a),a.id=this._constraintIdCounter++},d.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)},d.prototype.getContactMaterial=function(a,b){for(var c=this.contactMaterials,d=0,e=c.length;d!==e;d++){var f=c[d];if(f.materialA===a&&f.materialB===b||f.materialA===b&&f.materialB===a)return f}return!1},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)};var w=(g.create(),g.create(),g.create(),g.create(),g.create()),x=g.create(),y=g.fromValues(0,0),z=g.fromValues(0,0),A=g.fromValues(0,0);d.prototype.step=function(a){var b,d,e=this,f=this.doProfiling,o=this.springs.length,p=this.springs,q=this.bodies,r=this.gravity,s=this.solver,t=this.bodies.length,u=this.broadphase,v=this.nearphase,B=this.constraints,C=w,D=x,E=g.scale,F=g.add,G=g.rotate;this.lastTimeStep=a,f&&(b=c());for(var H=0;H!==t;H++){var I=q[H].force;F(I,I,r)}if(this.applySpringForces)for(var H=0;H!==o;H++){var J=p[H];J.applyForce()}var K=u.getCollisionPairs(this),L=g.length(this.gravity);v.reset();for(var H=0,M=K.length;H!==M;H+=2)for(var N=K[H],O=K[H+1],P=0;P<N.shapes.length;P++)for(var Q=N.shapes[P],R=N.shapeOffsets[P]||A,S=N.shapeAngles[P]||0,T=0;T<O.shapes.length;T++){var U=O.shapes[T],V=O.shapeOffsets[T]||A,W=O.shapeAngles[T]||0;if(0!==(Q.collisionGroup&U.collisionMask)&&0!==(U.collisionGroup&Q.collisionMask)){var X=N.invMass+O.invMass;X>0&&(X=1/X);var Y=this.defaultFriction;if(Q.material&&U.material){var Z=this.getContactMaterial(Q.material,U.material);Z&&(Y=Z.friction)}var $=Y*L*X;G(y,R,N.angle),G(z,V,O.angle),F(y,y,N.position),F(z,z,O.position);var _=S+N.angle,ab=W+O.angle;v.enableFriction=Y>0,v.slipForce=$,Q instanceof h?U instanceof h?v.circleCircle(N,Q,y,_,O,U,z,ab):U instanceof n?v.circleParticle(N,Q,y,_,O,U,z,ab):U instanceof l?v.circlePlane(N,Q,y,_,O,U,z,ab):U instanceof i?v.circleConvex(N,Q,y,_,O,U,z,ab):U instanceof j?v.circleConvex(N,Q,y,_,O,U,z,ab):U instanceof k?v.circleLine(N,Q,y,_,O,U,z,ab):U instanceof m&&v.circleCapsule(N,Q,y,_,O,U,z,ab):Q instanceof n?U instanceof h?v.circleParticle(O,U,z,ab,N,Q,y,_):U instanceof l?v.particlePlane(N,Q,y,_,O,U,z,ab):U instanceof i?v.particleConvex(N,Q,y,_,O,U,z,ab):U instanceof j?v.particleConvex(N,Q,y,_,O,U,z,ab):U instanceof m&&v.particleCapsule(N,Q,y,_,O,U,z,ab):Q instanceof l?U instanceof h?v.circlePlane(O,U,z,ab,N,Q,y,_):U instanceof n?v.particlePlane(O,U,z,ab,N,Q,y,_):U instanceof i?v.convexPlane(O,U,z,ab,N,Q,y,_):U instanceof j?v.convexPlane(O,U,z,ab,N,Q,y,_):U instanceof k?v.planeLine(N,Q,y,_,O,U,z,ab):U instanceof m&&v.capsulePlane(O,U,z,ab,N,Q,y,_):Q instanceof i?U instanceof l?v.convexPlane(N,Q,y,_,O,U,z,ab):U instanceof h?v.circleConvex(O,U,z,ab,N,Q,y,_):U instanceof i?v.convexConvex(O,U,z,ab,N,Q,y,_):U instanceof j?v.convexConvex(O,U,z,ab,N,Q,y,_):U instanceof n&&v.particleConvex(O,U,z,ab,N,Q,y,_):Q instanceof j?U instanceof l?v.convexPlane(N,Q,y,_,O,U,z,ab):U instanceof h?v.circleConvex(O,U,z,ab,N,Q,y,_):U instanceof i?v.convexConvex(O,U,z,ab,N,Q,y,_):U instanceof j?v.convexConvex(N,Q,y,_,O,U,z,ab):U instanceof n&&v.particleConvex(O,U,z,ab,N,Q,y,_):Q instanceof k?U instanceof h?v.circleLine(O,U,z,ab,N,Q,y,_):U instanceof l&&v.planeLine(O,U,z,ab,N,Q,y,_):Q instanceof m&&(U instanceof l&&v.capsulePlane(N,Q,y,_,O,U,z,ab),U instanceof h&&v.circleCapsule(O,U,z,ab,N,Q,y,_),U instanceof n&&v.particleCapsule(O,U,z,ab,N,Q,y,_))
}}for(var H=0,bb=v.contactEquations.length;H!==bb;H++)s.addEquation(v.contactEquations[H]);for(var H=0,cb=v.frictionEquations.length;H!==cb;H++)s.addEquation(v.frictionEquations[H]);var db=B.length;for(H=0;H!==db;H++){var eb=B[H];eb.update();for(var fb=0,gb=eb.equations.length;fb!==gb;fb++){var hb=eb.equations[fb];s.addEquation(hb)}}s.solve(a,this),s.removeAllEquations();for(var H=0;H!==t;H++){var ib=q[H];if(ib.mass>0){var jb=ib.invMass,kb=ib.force,lb=ib.position,mb=ib.velocity;ib.angularVelocity+=ib.angularForce*ib.invInertia*a,ib.angle+=ib.angularVelocity*a,E(C,kb,a*jb),F(mb,C,mb),E(D,mb,a),F(lb,lb,D)}}for(var H=0;H!==t;H++){var N=q[H];g.set(N.force,0,0),N.angularForce=0}f&&(d=c(),e.lastStepTime=d-b),this.emit(this.postStepEvent)},d.prototype.addSpring=function(a){this.springs.push(a),this.addSpringEvent.spring=a,this.emit(this.addSpringEvent)},d.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1===b&&this.springs.splice(b,1)},d.prototype.addBody=function(a){this.bodies.push(a),this.addBodyEvent.body=a,this.emit(this.addBodyEvent)},d.prototype.removeBody=function(a){var b=this.bodies.indexOf(a);-1!==b&&this.bodies.splice(b,1)},d.prototype.toJSON=function(){function a(a){return[a[0],a[1]]}for(var b={p2:u.version.split(".").slice(0,2).join("."),bodies:[],springs:[],solver:{},gravity:a(this.gravity),broadphase:{},constraints:[]},c=0;c<this.springs.length;c++){var d=this.springs[c];b.springs.push({bodyA:this.bodies.indexOf(d.bodyA),bodyB:this.bodies.indexOf(d.bodyB),stiffness:d.stiffness,damping:d.damping,restLength:d.restLength,localAnchorA:a(d.localAnchorA),localAnchorB:a(d.localAnchorB)})}for(var c=0;c<this.constraints.length;c++){var e=this.constraints[c],f={bodyA:this.bodies.indexOf(e.bodyA),bodyB:this.bodies.indexOf(e.bodyB)};if(e instanceof r)f.type="DistanceConstraint",f.distance=e.distance;else if(e instanceof s)f.type="PointToPointConstraint",f.pivotA=a(e.pivotA),f.pivotB=a(e.pivotB),f.maxForce=e.maxForce;else{if(!(e instanceof t)){console.error("Constraint not supported yet!");continue}f.type="PrismaticConstraint",f.localAxisA=a(e.localAxisA),f.localAxisB=a(e.localAxisB),f.maxForce=e.maxForce}b.constraints.push(f)}for(var c=0;c<this.bodies.length;c++){for(var g=this.bodies[c],o=g.shapes,p=[],q=0;q<o.length;q++){var v,d=o[q];if(d instanceof h)v={type:"Circle",radius:d.radius};else if(d instanceof l)v={type:"Plane"};else if(d instanceof n)v={type:"Particle"};else if(d instanceof k)v={type:"Line",length:d.length};else if(d instanceof i)v={type:"Rectangle",width:d.width,height:d.height};else if(d instanceof j){for(var w=[],x=0;x<d.vertices.length;x++)w.push(a(d.vertices[x]));v={type:"Convex",verts:w}}else{if(!(d instanceof m))throw new Error("Shape type not supported yet!");v={type:"Capsule",length:d.length,radius:d.radius}}v.offset=a(g.shapeOffsets[q]||[0,0]),v.angle=g.shapeAngles[q]||0,v.collisionGroup=d.collisionGroup,v.collisionMask=d.collisionMask,p.push(v)}b.bodies.push({mass:g.mass,angle:g.angle,position:a(g.position),velocity:a(g.velocity),angularVelocity:g.angularVelocity,force:a(g.force),shapes:p})}return b},d.prototype.fromJSON=function(a){if(this.clear(),!a.p2)return!1;switch(a.p2){case"0.2":g.copy(this.gravity,a.gravity);for(var b=0;b<a.bodies.length;b++){for(var c=a.bodies[b],d=c.shapes,e=new p({mass:c.mass,position:c.position,angle:c.angle,velocity:c.velocity,angularVelocity:c.angularVelocity,force:c.force}),f=0;f<d.length;f++){var o,u=d[f];switch(u.type){case"Circle":o=new h(u.radius);break;case"Plane":o=new l;break;case"Particle":o=new n;break;case"Line":o=new k(u.length);break;case"Rectangle":o=new i(u.width,u.height);break;case"Convex":o=new j(u.verts);break;case"Capsule":o=new m(u.length,u.radius);break;default:throw new Error("Shape type not supported: "+u.type)}o.collisionMask=u.collisionMask,o.collisionGroup=u.collisionGroup,e.addShape(o,u.offset,u.angle)}this.addBody(e)}for(var b=0;b<a.springs.length;b++){var u=a.springs[b],v=new q(this.bodies[u.bodyA],this.bodies[u.bodyB],{stiffness:u.stiffness,damping:u.damping,restLength:u.restLength,localAnchorA:u.localAnchorA,localAnchorB:u.localAnchorB});this.addSpring(v)}for(var b=0;b<a.constraints.length;b++){var w,x=a.constraints[b];switch(x.type){case"DistanceConstraint":w=new r(this.bodies[x.bodyA],this.bodies[x.bodyB],x.distance);break;case"PointToPointConstraint":w=new s(this.bodies[x.bodyA],x.pivotA,this.bodies[x.bodyB],x.pivotB,x.maxForce);break;case"PrismaticConstraint":w=new t(this.bodies[x.bodyA],this.bodies[x.bodyB],{maxForce:x.maxForce,localAxisA:x.localAxisA,localAxisB:x.localAxisB});break;default:throw new Error("Constraint type not recognized: "+x.type)}this.addConstraint(w)}break;default:return!1}return!0},d.prototype.clear=function(){for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);for(var c=this.bodies,b=c.length-1;b>=0;b--)this.removeBody(c[b]);for(var d=this.springs,b=d.length-1;b>=0;b--)this.removeSpring(d[b])},d.prototype.clone=function(){var a=new d;return a.fromJSON(this.toJSON()),a};var B=g.create(),C=g.fromValues(0,0),D=g.fromValues(0,0);d.prototype.hitTest=function(a,b,c){c=c||0;var d=new p({position:a}),e=new n,f=a,i=0,k=B,o=C,q=D;d.addShape(e);for(var r=this.nearphase,s=[],t=0,u=b.length;t!==u;t++)for(var v=b[t],w=0,x=v.shapes.length;w!==x;w++){var y=v.shapes[w],z=v.shapeOffsets[w]||o,A=v.shapeAngles[w]||0;g.rotate(k,z,v.angle),g.add(k,k,v.position);var E=A+v.angle;(y instanceof h&&r.circleParticle(v,y,k,E,d,e,f,i,!0)||y instanceof j&&r.particleConvex(d,e,f,i,v,y,k,E,!0)||y instanceof l&&r.particlePlane(d,e,f,i,v,y,k,E,!0)||y instanceof m&&r.particleCapsule(d,e,f,i,v,y,k,E,!0)||y instanceof n&&g.squaredLength(g.sub(q,k,a))<c*c)&&s.push(v)}return s}},{"../../package.json":2,"../solver/GSSolver":16,"../collision/NaiveBroadphase":20,"../math/vec2":33,"../shapes/Circle":6,"../shapes/Rectangle":25,"../shapes/Convex":10,"../shapes/Line":18,"../shapes/Plane":22,"../shapes/Capsule":5,"../shapes/Particle":21,"../events/EventEmitter":13,"../objects/Body":3,"../objects/Spring":30,"../constraints/DistanceConstraint":11,"../constraints/PointToPointConstraint":23,"../constraints/PrismaticConstraint":24,"../collision/Broadphase":4,"../collision/Nearphase":34}],32:[function(a,b){function c(a,b,c,f){var g;g=b?new d(a,0,c,f):new e(a,0,c,f),this.root=g}function d(a,b,c,d){this.bounds=a,this.children=[],this.nodes=[],d&&(this.maxChildren=d),c&&(this.maxDepth=c),b&&(this.depth=b)}function e(a,b,c,e){d.call(this,a,b,c,e),this.stuckChildren=[]}var f=a("../shapes/Plane"),g=a("../collision/Broadphase");b.exports={QuadTree:c,Node:d,BoundsNode:e},c.prototype.insert=function(a){if(a instanceof Array)for(var b=a.length,c=0;b>c;c++)this.root.insert(a[c]);else this.root.insert(a)},c.prototype.clear=function(){this.root.clear()},c.prototype.retrieve=function(a){var b=this.root.retrieve(a).slice(0);return b},c.prototype.getCollisionPairs=function(a){var b=[];this.insert(a.bodies);for(var c=0;c!==a.bodies.length;c++)for(var d=a.bodies[c],e=this.retrieve(d),f=0,h=e.length;f!==h;f++){var i=e[f];if(d!==i){for(var j=!1,k=0,l=b.length;l>k;k+=2){var m=b[k],n=b[k+1];if(m==i&&n==d||n==i&&m==d){j=!0;break}}!j&&g.bodiesCollide(d,i)&&b.push(d,i)}}return this.clear(),b},d.prototype.classConstructor=d,d.prototype.children=null,d.prototype.depth=0,d.prototype.maxChildren=4,d.prototype.maxDepth=4,d.TOP_LEFT=0,d.TOP_RIGHT=1,d.BOTTOM_LEFT=2,d.BOTTOM_RIGHT=3,d.prototype.insert=function(a){if(this.nodes.length){var b=this.findIndex(a);return this.nodes[b].insert(a),void 0}this.children.push(a);var c=this.children.length;if(!(this.depth>=this.maxDepth)&&c>this.maxChildren){this.subdivide();for(var d=0;c>d;d++)this.insert(this.children[d]);this.children.length=0}},d.prototype.retrieve=function(a){if(this.nodes.length){var b=this.findIndex(a);return this.nodes[b].retrieve(a)}return this.children},d.prototype.findIndex=function(a){var b=this.bounds,c=a.position[0]-a.boundingRadius>b.x+b.width/2?!1:!0,e=a.position[1]-a.boundingRadius>b.y+b.height/2?!1:!0;a instanceof f&&(c=e=!1);var g=d.TOP_LEFT;return c?e||(g=d.BOTTOM_LEFT):g=e?d.TOP_RIGHT:d.BOTTOM_RIGHT,g},d.prototype.subdivide=function(){var a=this.depth+1,b=this.bounds.x,c=this.bounds.y,e=this.bounds.width/2,f=this.bounds.height/2,g=b+e,h=c+f;this.nodes[d.TOP_LEFT]=new this.classConstructor({x:b,y:c,width:e,height:f},a),this.nodes[d.TOP_RIGHT]=new this.classConstructor({x:g,y:c,width:e,height:f},a),this.nodes[d.BOTTOM_LEFT]=new this.classConstructor({x:b,y:h,width:e,height:f},a),this.nodes[d.BOTTOM_RIGHT]=new this.classConstructor({x:g,y:h,width:e,height:f},a)},d.prototype.clear=function(){this.children.length=0;for(var a=this.nodes.length,b=0;a>b;b++)this.nodes[b].clear();this.nodes.length=0},e.prototype=new d,e.prototype.classConstructor=e,e.prototype.stuckChildren=null,e.prototype.out=[],e.prototype.insert=function(a){if(this.nodes.length){var b=this.findIndex(a),c=this.nodes[b];return!(a instanceof f)&&a.position[0]-a.boundingRadius>=c.bounds.x&&a.position[0]+a.boundingRadius<=c.bounds.x+c.bounds.width&&a.position[1]-a.boundingRadius>=c.bounds.y&&a.position[1]+a.boundingRadius<=c.bounds.y+c.bounds.height?this.nodes[b].insert(a):this.stuckChildren.push(a),void 0}this.children.push(a);var d=this.children.length;if(this.depth<this.maxDepth&&d>this.maxChildren){this.subdivide();for(var e=0;d>e;e++)this.insert(this.children[e]);this.children.length=0}},e.prototype.getChildren=function(){return this.children.concat(this.stuckChildren)},e.prototype.retrieve=function(a){var b=this.out;if(b.length=0,this.nodes.length){var c=this.findIndex(a);b.push.apply(b,this.nodes[c].retrieve(a))}return b.push.apply(b,this.stuckChildren),b.push.apply(b,this.children),b},e.prototype.clear=function(){this.stuckChildren.length=0,this.children.length=0;var a=this.nodes.length;if(a){for(var b=0;a>b;b++)this.nodes[b].clear();this.nodes.length=0}}},{"../shapes/Plane":22,"../collision/Broadphase":4}],33:[function(a,b){var c=a("../../node_modules/gl-matrix/src/gl-matrix/vec2").vec2;c.getX=function(a){return a[0]},c.getY=function(a){return a[1]},c.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},c.crossVZ=function(a,b,d){return c.rotate(a,b,-Math.PI/2),c.scale(a,a,d),a},c.crossZV=function(a,b,d){return c.rotate(a,d,Math.PI/2),c.scale(a,a,b),a},c.rotate=function(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=b[0],g=b[1];a[0]=d*f-e*g,a[1]=e*f+d*g},c.toLocalFrame=function(a,b,d,e){c.copy(a,b),c.sub(a,a,d),c.rotate(a,a,-e)},c.toGlobalFrame=function(a,b,d,e){c.copy(a,b),c.rotate(a,a,e),c.add(a,a,d)},c.centroid=function(a,b,d,e){return c.add(a,b,d),c.add(a,a,e),c.scale(a,a,1/3),a},b.exports=c},{"../../node_modules/gl-matrix/src/gl-matrix/vec2":38}],36:[function(a,b){var c={};c.GetArea=function(a){if(a.length<6)return 0;for(var b=a.length-2,c=0,d=0;b>d;d+=2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return c+=(a[0]-a[b])*(a[b+1]+a[1]),.5*-c},c.Triangulate=function(a){var b=a.length>>1;if(3>b)return[];for(var d=[],e=[],f=0;b>f;f++)e.push(f);for(var f=0,g=b;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[2*h],l=a[2*h+1],m=a[2*i],n=a[2*i+1],o=a[2*j],p=a[2*j+1],q=!1;if(c._convex(k,l,m,n,o,p)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!=h&&s!=i&&s!=j&&c._PointInTriangle(a[2*s],a[2*s+1],k,l,m,n,o,p)){q=!1;break}}}if(q)d.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g)break}return d.push(e[0],e[1],e[2]),d},c._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},c._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0},b.exports=c},{}],37:[function(a,b){function c(){this.equations=[],this.bodies=[]}b.exports=c,c.prototype.reset=function(){this.equations.length=this.bodies.length=0},c.prototype.getBodies=function(){for(var a=[],b=[],c=this.equations,d=0;d!==c.length;d++){var e=c[d];-1===b.indexOf(e.bi.id)&&(a.push(e.bi),b.push(e.bi.id)),-1===b.indexOf(e.bj.id)&&(a.push(e.bj),b.push(e.bj.id))}return a},c.prototype.solve=function(a,b){var c=[];b.removeAllEquations();for(var d=this.equations.length,e=0;e!==d;e++)b.addEquation(this.equations[e]);for(var f=this.getBodies(),g=f.length,e=0;e!==g;e++)c.push(f[e]);b.solve(a,{bodies:c})}},{}],38:[function(a,b,c){var d={};if(!e)var e=1e-6;d.create=function(){return new Float32Array(2)},d.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},d.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},d.set=function(a,b,c){return a[0]=b,a[1]=c,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},d.sub=d.subtract,d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},d.mul=d.multiply,d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},d.div=d.divide,d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},d.dist=d.distance,d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},d.sqrDist=d.squaredDistance,d.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},d.len=d.length,d.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},d.sqrLen=d.squaredLength,d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},d.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},d.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},d.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof c&&(c.vec2=d)},{}],34:[function(a,b){function c(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[]}var d=a("../math/vec2"),e=d.sub,f=d.add,g=d.dot,h=a("../constraints/ContactEquation"),i=a("../constraints/FrictionEquation"),j=a("../shapes/Circle");b.exports=c;var k=d.fromValues(0,1),l=d.fromValues(0,0),m=d.fromValues(0,0),n=d.fromValues(0,0),o=d.fromValues(0,0),p=d.fromValues(0,0),q=d.fromValues(0,0),r=d.fromValues(0,0),s=d.fromValues(0,0),t=d.fromValues(0,0),u=d.fromValues(0,0),v=d.fromValues(0,0),w=d.fromValues(0,0),x=d.fromValues(0,0),y=d.fromValues(0,0);d.fromValues(0,0),c.prototype.reset=function(){if(this.reuseObjects){for(var a=this.contactEquations,b=this.frictionEquations,c=this.reusableFrictionEquations,d=this.reusableContactEquations,e=0,f=a.length;e!==f;e++)d.push(a[e]);for(var e=0,f=b.length;e!==f;e++)c.push(b[e])}this.contactEquations.length=this.frictionEquations.length=0},c.prototype.createContactEquation=function(a,b){var c=this.reusableContactEquations.length?this.reusableContactEquations.pop():new h(a,b);return c.bi=a,c.bj=b,c},c.prototype.createFrictionEquation=function(a,b){var c=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new i(a,b);return c.bi=a,c.bj=b,c.setSlipForce(this.slipForce),c},c.prototype.createFrictionFromContact=function(a){var b=this.createFrictionEquation(a.bi,a.bj);return d.copy(b.ri,a.ri),d.copy(b.rj,a.rj),d.rotate(b.t,a.ni,-Math.PI/2),b},c.prototype.planeLine=function(a,b,c,h,i,j,u,v){var w=j,x=v,y=i,z=u,A=c,B=h,C=a,D=l,E=m,F=n,G=o,H=p,I=q,J=r,K=s,L=t;d.set(D,-w.length/2,0),d.set(E,w.length/2,0),d.rotate(F,D,x),d.rotate(G,E,x),f(F,F,z),f(G,G,z),d.copy(D,F),d.copy(E,G),e(H,E,D),d.normalize(I,H),d.rotate(L,I,-Math.PI/2),d.rotate(K,k,B);for(var M=[D,E],N=0;N<M.length;N++){var O=M[N];e(J,O,A);var P=g(J,K);if(0>P){var Q=this.createContactEquation(C,y);d.copy(Q.ni,K),d.normalize(Q.ni,Q.ni),d.scale(J,K,P),e(Q.ri,O,J),e(Q.ri,Q.ri,C.position),e(Q.rj,O,z),f(Q.rj,Q.rj,z),e(Q.rj,Q.rj,y.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q))}}},c.prototype.particleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius,0)},c.prototype.circleLine=function(a,b,c,h,i,j,k,z,A,B,C){var D=j,E=z,F=i,G=k,H=c,I=a,J=b,B=B||0,C="undefined"!=typeof C?C:J.radius,K=l,L=m,M=n,N=o,O=p,P=q,Q=r,R=s,S=t,T=u,U=v,V=w,W=x,X=y;d.set(R,-D.length/2,0),d.set(S,D.length/2,0),d.rotate(T,R,E),d.rotate(U,S,E),f(T,T,G),f(U,U,G),d.copy(R,T),d.copy(S,U),e(P,S,R),d.normalize(Q,P),d.rotate(O,Q,-Math.PI/2),e(V,H,R);var Y=g(V,O);if(e(N,R,G),e(W,H,G),Math.abs(Y)<C+B){d.scale(K,O,Y),e(M,H,K),d.scale(L,O,g(O,W)),d.normalize(L,L),d.scale(L,L,B),f(M,M,L);var Z=g(Q,M),$=g(Q,R),_=g(Q,S);if(Z>$&&_>Z){if(A)return!0;var ab=this.createContactEquation(I,F);return d.scale(ab.ni,K,-1),d.normalize(ab.ni,ab.ni),d.scale(ab.ri,ab.ni,C),f(ab.ri,ab.ri,H),e(ab.ri,ab.ri,I.position),e(ab.rj,M,G),f(ab.rj,ab.rj,G),e(ab.rj,ab.rj,F.position),this.contactEquations.push(ab),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ab)),!0}}for(var bb=[R,S],cb=0;cb<bb.length;cb++){var db=bb[cb];if(e(V,db,H),d.squaredLength(V)<(C+B)*(C+B)){if(A)return!0;var ab=this.createContactEquation(I,F);return d.copy(ab.ni,V),d.normalize(ab.ni,ab.ni),d.scale(ab.ri,ab.ni,C),f(ab.ri,ab.ri,H),e(ab.ri,ab.ri,I.position),e(ab.rj,db,G),d.scale(X,ab.ni,-B),f(ab.rj,ab.rj,X),f(ab.rj,ab.rj,G),e(ab.rj,ab.rj,F.position),this.contactEquations.push(ab),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ab)),!0}}return!1},c.prototype.circleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius)},c.prototype.circleConvex=function(a,b,c,h,i,j,k,w){var x=j,y=w,z=i,A=k,B=c,C=a,D=b,E=l,F=m,G=n,H=o,I=p,J=q,K=r,L=s,M=t,N=u,O=v;verts=x.vertices;for(var P=0;P<verts.length;P++){var Q=verts[P],R=verts[(P+1)%verts.length];d.rotate(E,Q,y),d.rotate(F,R,y),f(E,E,A),f(F,F,A),e(G,F,E),d.normalize(H,G),d.rotate(I,H,-Math.PI/2),e(N,B,E);var S=g(N,I);if(e(J,E,A),e(K,B,A),S<D.radius&&g(J,K)>0){d.scale(L,I,S),e(M,B,L);var T=g(H,M),U=g(H,E),V=g(H,F);if(T>U&&V>T){var W=this.createContactEquation(C,z);return d.scale(W.ni,L,-1),d.normalize(W.ni,W.ni),d.scale(W.ri,W.ni,D.radius),f(W.ri,W.ri,B),e(W.ri,W.ri,C.position),e(W.rj,M,A),f(W.rj,W.rj,A),e(W.rj,W.rj,z.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),!0}}}for(var P=0;P<verts.length;P++){var X=verts[P];if(d.rotate(O,X,y),f(O,O,A),e(N,O,B),d.squaredLength(N)<D.radius*D.radius){var W=this.createContactEquation(C,z);return d.copy(W.ni,N),d.normalize(W.ni,W.ni),d.scale(W.ri,W.ni,D.radius),f(W.ri,W.ri,B),e(W.ri,W.ri,C.position),e(W.rj,O,A),f(W.rj,W.rj,A),e(W.rj,W.rj,z.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),!0}}return!1},c.prototype.particleConvex=function(a,b,c,h,i,j,k,v,y){var z=j,A=v,B=i,C=k,D=c,E=a,F=l,G=m,H=n,I=o,J=p,K=q,L=r,M=s,N=t,O=u,P=-1,Q=null,R=w,S=x;verts=z.vertices;for(var T=0;T<verts.length;T++){var U=verts[T],V=verts[(T+1)%verts.length];d.rotate(F,U,A),d.rotate(G,V,A),f(F,F,C),f(G,G,C),e(H,G,F),d.normalize(I,H),d.rotate(J,I,-Math.PI/2),e(O,D,F);var W=g(O,J);if(e(K,F,C),e(L,D,C),0>W&&g(K,L)>=0){d.scale(M,J,W),e(N,D,M);var X=g(I,N),Y=g(I,F),Z=g(I,G);if(X>Y&&Z>X){if(y)return!0;(null===Q||Q*Q>W*W)&&(Q=W,P=T,d.copy(R,M),d.copy(S,N))}}}if(-1!=P){var $=this.createContactEquation(E,B);return d.copy($.ni,R),d.normalize($.ni,$.ni),d.set($.ri,0,0),f($.ri,$.ri,D),e($.ri,$.ri,E.position),e($.rj,S,C),f($.rj,$.rj,C),e($.rj,$.rj,B.position),this.contactEquations.push($),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($)),!0}return!1},c.prototype.circleCircle=function(a,b,c,g,h,i,j,k,m){var n=a,o=b,p=c,q=h,r=i,s=j,t=l;e(t,c,j);var u=b.radius+i.radius;if(d.squaredLength(t)>u*u)return!1;if(m)return!0;var v=this.createContactEquation(n,q);return e(v.ni,s,p),d.normalize(v.ni,v.ni),d.scale(v.ri,v.ni,o.radius),d.scale(v.rj,v.ni,-r.radius),f(v.ri,v.ri,p),e(v.ri,v.ri,n.position),f(v.rj,v.rj,s),e(v.rj,v.rj,q.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),!0},c.prototype.convexPlane=function(a,b,c,h,i,j,o,p){var q=a,r=c,s=h,t=i,u=o,v=p,w=l,x=m,y=n,z=0;d.rotate(x,k,v);for(var A=0;A<b.vertices.length;A++){var B=b.vertices[A];if(d.rotate(w,B,s),f(w,w,r),e(y,w,u),g(y,x)<0){z++;var C=this.createContactEquation(t,q);e(y,w,u),d.copy(C.ni,x);var D=g(y,C.ni);if(d.scale(y,C.ni,D),e(C.rj,w,q.position),e(C.ri,w,y),e(C.ri,C.ri,t.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),z>=2)break}}return z>0},c.prototype.particlePlane=function(a,b,c,f,h,i,j,n,o){var p=a,q=c,r=h,s=j,t=n,u=l,v=m;t=t||0,e(u,q,s),d.rotate(v,k,t);var w=g(u,v);if(w>0)return!1;if(o)return!0;var x=this.createContactEquation(r,p);return d.copy(x.ni,v),d.scale(u,x.ni,w),e(x.ri,q,u),e(x.ri,x.ri,r.position),e(x.rj,q,p.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),!0},c.prototype.circleParticle=function(a,b,c,g,h,i,j,k,m){var n=a,o=b,p=c,q=h,r=j,s=l;if(e(s,r,p),d.squaredLength(s)>o.radius*o.radius)return!1;if(m)return!0;var t=this.createContactEquation(n,q);return d.copy(t.ni,s),d.normalize(t.ni,t.ni),d.scale(t.ri,t.ni,o.radius),f(t.ri,t.ri,p),e(t.ri,t.ri,n.position),e(t.rj,r,q.position),this.contactEquations.push(t),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(t)),!0};{var z=new j(1),A=d.create(),B=d.create();d.create()}c.prototype.capsulePlane=function(a,b,c,e,g,h,i,j){var k=A,l=B,m=z;d.set(k,-b.length/2,0),d.rotate(k,k,e),f(k,k,c),d.set(l,b.length/2,0),d.rotate(l,l,e),f(l,l,c),m.radius=b.radius,this.circlePlane(a,m,k,0,g,h,i,j),this.circlePlane(a,m,l,0,g,h,i,j)},c.prototype.circlePlane=function(a,b,c,h,i,j,o,p){var q=a,r=b,s=c,t=i,u=o,v=p;v=v||0;var w=l,x=m,y=n;e(w,s,u),d.rotate(x,k,v);var z=g(x,w);if(z>r.radius)return!1;var A=this.createContactEquation(t,q);return d.copy(A.ni,x),d.scale(A.rj,A.ni,-r.radius),f(A.rj,A.rj,s),e(A.rj,A.rj,q.position),d.scale(y,A.ni,z),e(A.ri,w,y),f(A.ri,A.ri,u),e(A.ri,A.ri,t.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A)),!0},c.prototype.convexConvex=function(a,b,h,i,j,k,q,u){var v=l,w=m,x=n,y=o,z=p,A=r,B=s,C=t,D=c.findSeparatingAxis(b,h,i,k,q,u,v);if(!D)return!1;e(B,q,h),g(v,B)>0&&d.scale(v,v,-1);var E=c.getClosestEdge(b,i,v,!0),F=c.getClosestEdge(k,u,v);if(-1==E||-1==F)return!1;for(var G=0;2>G;G++){var H=E,I=F,J=b,K=k,L=h,M=q,N=i,O=u,P=a,Q=j;if(0==G){var R;R=H,H=I,I=R,R=J,J=K,K=R,R=L,L=M,M=R,R=N,N=O,O=R,R=P,P=Q,Q=R}for(var S=I;I+2>S;S++){var T=K.vertices[(S+K.vertices.length)%K.vertices.length];d.rotate(w,T,O),f(w,w,M);for(var U=0,V=H-1;H+2>V;V++){var W=J.vertices[(V+J.vertices.length)%J.vertices.length],X=J.vertices[(V+1+J.vertices.length)%J.vertices.length];d.rotate(x,W,N),d.rotate(y,X,N),f(x,x,L),f(y,y,L),e(z,y,x),d.rotate(C,z,-Math.PI/2),d.normalize(C,C),e(B,w,x);var Y=g(C,B);0>Y&&U++}if(3==U){var Z=this.createContactEquation(P,Q),W=J.vertices[H%J.vertices.length],X=J.vertices[(H+1)%J.vertices.length];d.rotate(x,W,N),d.rotate(y,X,N),f(x,x,L),f(y,y,L),e(z,y,x),d.rotate(Z.ni,z,-Math.PI/2),d.normalize(Z.ni,Z.ni),e(B,w,x);var Y=g(Z.ni,B);d.scale(A,Z.ni,Y),e(Z.ri,w,L),e(Z.ri,Z.ri,A),f(Z.ri,Z.ri,L),e(Z.ri,Z.ri,P.position),e(Z.rj,w,M),f(Z.rj,Z.rj,M),e(Z.rj,Z.rj,Q.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z))}}}};var C=d.fromValues(0,0);c.projectConvexOntoAxis=function(a,b,c,e,f){var h,i,j=null,k=null,l=C;d.rotate(l,e,-c);for(var m=0;m<a.vertices.length;m++)h=a.vertices[m],i=g(h,l),(null===j||i>j)&&(j=i),(null===k||k>i)&&(k=i);if(k>j){var n=k;k=j,j=n}var o=g(b,e);d.set(f,k+o,j+o)};var D=d.fromValues(0,0),E=d.fromValues(0,0),F=d.fromValues(0,0),G=d.fromValues(0,0),H=d.fromValues(0,0),I=d.fromValues(0,0);c.findSeparatingAxis=function(a,b,f,g,h,i,j){for(var k=null,l=!1,m=!1,n=D,o=E,p=F,q=G,r=H,s=I,t=0;2>t;t++){var u=a,v=f;1==t&&(u=g,v=i);for(var w=0;w<u.vertices.length;w++){d.rotate(o,u.vertices[w],v),d.rotate(p,u.vertices[(w+1)%u.vertices.length],v),e(n,p,o),d.rotate(q,n,-Math.PI/2),d.normalize(q,q),c.projectConvexOntoAxis(a,b,f,q,r),c.projectConvexOntoAxis(g,h,i,q,s);var x=r,y=s,z=!1;r[0]>s[0]&&(y=r,x=s,z=!0);var A=y[0]-x[1];l=0>A,(null===k||A>k)&&(d.copy(j,q),k=A,m=l)}}return m};var J=d.fromValues(0,0),K=d.fromValues(0,0),L=d.fromValues(0,0);c.getClosestEdge=function(a,b,c,f){var h=J,i=K,j=L;d.rotate(h,c,-b),f&&d.scale(h,h,-1);for(var k=-1,l=0;l<a.vertices.length;l++){e(i,a.vertices[(l+1)%a.vertices.length],a.vertices[l%a.vertices.length]),d.rotate(j,i,-Math.PI/2),d.normalize(j,j);var m=g(j,h);(-1==k||m>maxDot)&&(k=l%a.vertices.length,maxDot=m)}return k}},{"../math/vec2":33,"../constraints/ContactEquation":8,"../constraints/FrictionEquation":14,"../shapes/Circle":6}],35:[function(a,b){var c=a("../../node_modules/gl-matrix/src/gl-matrix/mat2").mat2;b.exports=c},{"../../node_modules/gl-matrix/src/gl-matrix/mat2":39}],39:[function(a,b,c){var d={},e=new Float32Array([1,0,0,1]);if(!f)var f=1e-6;d.create=function(){return new Float32Array(e)},d.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},d.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},d.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},d.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},d.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},d.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},d.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},d.mul=d.multiply,d.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},d.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},d.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof c&&(c.mat2=d)},{}]},{},[1])(1)});