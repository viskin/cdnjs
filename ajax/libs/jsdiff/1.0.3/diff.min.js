var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function n(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n}function t(e){var n=e;return n=n.replace(/&/g,"&amp;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n=n.replace(/"/g,"&quot;")}var o=function(e){this.ignoreWhitespace=e};o.prototype={diff:function(n,t){if(t==n)return[{value:t}];if(!t)return[{value:n,removed:!0}];if(!n)return[{value:t,added:!0}];t=this.tokenize(t),n=this.tokenize(n);var o=t.length,r=n.length,i=o+r,u=[{newPos:-1,components:[]}],s=this.extractCommon(u[0],t,n,0);if(u[0].newPos+1>=o&&s+1>=r)return u[0].components;for(var a=1;i>=a;a++)for(var d=-1*a;a>=d;d+=2){var f,l=u[d-1],h=u[d+1];s=(h?h.newPos:0)-d,l&&(u[d-1]=void 0);var p=l&&l.newPos+1<o,v=h&&s>=0&&r>s;if(p||v){!p||v&&l.newPos<h.newPos?(f=e(h),this.pushComponent(f.components,n[s],void 0,!0)):(f=e(l),f.newPos++,this.pushComponent(f.components,t[f.newPos],!0,void 0));var s=this.extractCommon(f,t,n,d);if(f.newPos+1>=o&&s+1>=r)return f.components;u[d]=f}else u[d]=void 0}},pushComponent:function(e,n,t,o){var r=e[e.length-1];r&&r.added===t&&r.removed===o?e[e.length-1]={value:this.join(r.value,n),added:t,removed:o}:e.push({value:n,added:t,removed:o})},extractCommon:function(e,n,t,o){for(var r=n.length,i=t.length,u=e.newPos,s=u-o;r>u+1&&i>s+1&&this.equals(n[u+1],t[s+1]);)u++,s++,this.pushComponent(e.components,n[u],void 0,void 0);return e.newPos=u,s},equals:function(e,n){var t=/\S/;return!this.ignoreWhitespace||t.test(e)||t.test(n)?e==n:!0},join:function(e,n){return e+n},tokenize:function(e){return e}};var r=new o,i=new o(!0);i.tokenize=function(e){return n(e.split(/(\s+|\b)/))};var u=new o(!0);u.tokenize=function(e){return n(e.split(/([{}:;,]|\s+)/))};var s=new o;return s.tokenize=function(e){return e.split(/^/m)},{diffChars:function(e,n){return r.diff(e,n)},diffWords:function(e,n){return i.diff(e,n)},diffLines:function(e,n){return s.diff(e,n)},diffCss:function(e,n){return u.diff(e,n)},createPatch:function(e,n,t,o,r){function i(e){return e.map(function(e){return" "+e})}function u(e,n,t){var o=d[d.length-2],r=n===d.length-2,i=n===d.length-3&&(t.added===!o.added||t.removed===!o.removed);/\n$/.test(t.value)||!r&&!i||e.push("\\ No newline at end of file")}var a=[];a.push("Index: "+e),a.push("==================================================================="),a.push("--- "+e+("undefined"==typeof o?"":"	"+o)),a.push("+++ "+e+("undefined"==typeof r?"":"	"+r));var d=s.diff(n,t);d[d.length-1].value||d.pop(),d.push({value:"",lines:[]});for(var f=0,l=0,h=[],p=1,v=1,c=0;c<d.length;c++){var m=d[c],g=m.lines||m.value.replace(/\n$/,"").split("\n");if(m.lines=g,m.added||m.removed){if(!f){var w=d[c-1];f=p,l=v,w&&(h=i(w.lines.slice(-4)),f-=h.length,l-=h.length)}h.push.apply(h,g.map(function(e){return(m.added?"+":"-")+e})),u(h,c,m),m.added?v+=g.length:p+=g.length}else{if(f)if(g.length<=8&&c<d.length-2)h.push.apply(h,i(g));else{var P=Math.min(g.length,4);a.push("@@ -"+f+","+(p-f+P)+" +"+l+","+(v-l+P)+" @@"),a.push.apply(a,h),a.push.apply(a,i(g.slice(0,P))),g.length<=4&&u(a,c,m),f=0,l=0,h=[]}p+=g.length,v+=g.length}}return a.join("\n")+"\n"},convertChangesToXML:function(e){for(var n=[],o=0;o<e.length;o++){var r=e[o];r.added?n.push("<ins>"):r.removed&&n.push("<del>"),n.push(t(r.value)),r.added?n.push("</ins>"):r.removed&&n.push("</del>")}return n.join("")},convertChangesToDMP:function(e){for(var n,t=[],o=0;o<e.length;o++)n=e[o],t.push([n.added?1:n.removed?-1:0,n.value]);return t}}}();"undefined"!=typeof module&&(module.exports=JsDiff);