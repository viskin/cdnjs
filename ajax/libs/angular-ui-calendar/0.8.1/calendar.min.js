angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function(d,g){var c=1,b=1,e=d.eventSources,f=d.calendarWatchEvent?d.calendarWatchEvent:angular.noop,a=function(h){var i;if(h){i=function(){var j=arguments;g(function(){h.apply(this,j)})}}return i};this.eventsFingerprint=function(h){if(!h.__uiCalId){h.__uiCalId=b++}return""+h.__uiCalId+(h.id||"")+(h.title||"")+(h.url||"")+(+h.start||"")+(+h.end||"")+(h.allDay||"")+(h.className||"")+f(h)||""};this.sourcesFingerprint=function(h){return h.__id||(h.__id=c++)};this.allEvents=function(){var h=[];for(var l=0,m=e.length;l<m;l++){var o=e[l];if(angular.isArray(o)){h.push(o)}else{if(angular.isObject(o)&&angular.isArray(o.events)){var j={};for(var k in o){if(k!=="_uiCalId"&&k!=="events"){j[k]=o[k]}}for(var n=0;n<o.events.length;n++){angular.extend(o.events[n],j)}h.push(o.events)}}}return Array.prototype.concat.apply([],h)};this.changeWatcher=function(h,k){var i;var l=function(){var t=angular.isFunction(h)?h():h;var o=[],q,r;for(var p=0,s=t.length;p<s;p++){r=t[p];q=k(r);m[q]=r;o.push(q)}return o};var j=function(q,p){var o=[],s={},r,t;for(r=0,t=p.length;r<t;r++){s[p[r]]=true}for(r=0,t=q.length;r<t;r++){if(!s[q[r]]){o.push(q[r])}}return o};var m={};var n=function(y,w){var t,q,p,r;var s={};var o=j(w,y);for(t=0,q=o.length;t<q;t++){var u=o[t];p=m[u];delete m[u];var v=k(p);if(v===u){i.onRemoved(p)}else{s[v]=u;i.onChanged(p)}}var x=j(y,w);for(t=0,q=x.length;t<q;t++){r=x[t];p=m[r];if(!s[r]){i.onAdded(p)}}};return i={subscribe:function(o,p){o.$watch(l,function(r,q){if(!p||p(r,q)!==false){n(r,q)}},true)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}};this.getFullCalendarConfig=function(i,j){var h={};angular.extend(h,j);angular.extend(h,i);angular.forEach(h,function(l,k){if(typeof l==="function"){h[k]=a(h[k])}});return h}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(c,a){var d=function(g){var f,e;f=[];for(e in g){f[e]=g[e]}return f};var b=a.DATETIME_FORMATS;c=angular.extend({monthNames:d(b.MONTH),monthNamesShort:d(b.SHORTMONTH),dayNames:d(b.DAY),dayNamesShort:d(b.SHORTDAY)},c||{});return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(m,h,k,g){var e=m.eventSources,f=false,j=g.changeWatcher(e,g.sourcesFingerprint),l=g.changeWatcher(g.allEvents,g.eventsFingerprint),n=null;function i(){var q=k.uiCalendar?m.$parent.$eval(k.uiCalendar):{},p;p=g.getFullCalendarConfig(q,c);n={eventSources:e};angular.extend(n,p);var s={};for(var r in n){if(r!=="eventSources"){s[r]=n[r]}}return JSON.stringify(s)}m.destroy=function(){if(k.calendar){m.calendar=m.$parent[k.calendar]=h.html("")}else{m.calendar=h.html("")}};m.init=function(){m.calendar.fullCalendar(n)};j.onAdded=function(o){m.calendar.fullCalendar("addEventSource",o);f=true};j.onRemoved=function(o){m.calendar.fullCalendar("removeEventSource",o);f=true};l.onAdded=function(o){m.calendar.fullCalendar("renderEvent",o)};l.onRemoved=function(o){m.calendar.fullCalendar("removeEvents",function(p){return p===o})};l.onChanged=function(o){m.calendar.fullCalendar("updateEvent",o)};j.subscribe(m);l.subscribe(m,function(p,o){if(f===true){f=false;return false}});m.$watch(i,function(p,o){m.destroy();m.init()})}}}]);