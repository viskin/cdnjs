/*! p5.sound.js v0.2.16 2015-11-13 */(function(e,t){typeof define=="function"&&define.amd?define("p5.sound",["p5"],function(e){t(e)}):typeof exports=="object"?t(require("../p5")):t(e.p5)})(this,function(e){var t;t=function(){"use strict";(function(e,t,n){function r(e){if(!e)return;e.setTargetAtTime||(e.setTargetAtTime=e.setTargetValueAtTime)}return t=t||{},"use strict",window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),AudioContext.prototype.hasOwnProperty("createPeriodicWave")||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var e=this.internal_createGain();return r(e.gain),e},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(e){var t=e?this.internal_createDelay(e):this.internal_createDelay();return r(t.delayTime),t},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var e=this.internal_createBufferSource();return e.start?(e.internal_start=e.start,e.start=function(t,n,r){typeof r!="undefined"?e.internal_start(t||0,n,r):e.internal_start(t||0,n||0)}):e.start=function(e,t,n){t||n?this.noteGrainOn(e||0,t,n):this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},r(e.playbackRate),e},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var e=this.internal_createDynamicsCompressor();return r(e.threshold),r(e.knee),r(e.ratio),r(e.reduction),r(e.attack),r(e.release),e},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var e=this.internal_createBiquadFilter();return r(e.frequency),r(e.detune),r(e.Q),r(e.gain),e},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var e=this.internal_createOscillator();return e.start?(e.internal_start=e.start,e.start=function(t){e.internal_start(t||0)}):e.start=function(e){this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},e.setPeriodicWave||(e.setPeriodicWave=e.setWaveTable),r(e.frequency),r(e.detune),e})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext),t})(window);var t=new window.AudioContext;e.prototype.getAudioContext=function(){return t},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var n=document.createElement("audio");e.prototype.isSupported=function(){return!!n.canPlayType};var r=function(){return!!n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"')},i=function(){return!!n.canPlayType&&n.canPlayType("audio/mpeg;")},s=function(){return!!n.canPlayType&&n.canPlayType('audio/wav; codecs="1"')},o=function(){return!!n.canPlayType&&(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/aac;"))},u=function(){return!!n.canPlayType&&n.canPlayType("audio/x-aiff;")};e.prototype.isFileSupported=function(e){switch(e.toLowerCase()){case"mp3":return i();case"wav":return s();case"ogg":return r();case"aac","m4a","mp4":return o();case"aif","aiff":return u();default:return!1}};var a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;if(a){var f=!1,l=function(){if(f)return;var e=t.createBuffer(1,1,22050),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0),console.log("start ios!"),t.state==="running"&&(f=!0)};document.addEventListener("touchend",l,!1),document.addEventListener("touchstart",l,!1)}}();var n;n=function(){"use strict";var t=function(){var t=e.prototype.getAudioContext();this.input=t.createGain(),this.output=t.createGain(),this.limiter=t.createDynamicsCompressor(),this.limiter.threshold.value=0,this.limiter.ratio.value=100,this.audiocontext=t,this.output.disconnect(),this.inputSources=[],this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=t.createGain(),this.fftMeter=t.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},n=new t;return e.prototype.getMasterVolume=function(){return n.output.gain.value},e.prototype.masterVolume=function(e,t,r){if(typeof e=="number"){var t=t||0,r=r||0,i=n.audiocontext.currentTime,s=n.output.gain.value;n.output.gain.cancelScheduledValues(i+r),n.output.gain.linearRampToValueAtTime(s,i+r),n.output.gain.linearRampToValueAtTime(e,i+r+t)}else{if(!e)return n.output.gain;e.connect(n.output.gain)}},e.soundOut=n,e.soundOut._silentNode=n.audiocontext.createGain(),e.soundOut._silentNode.gain.value=0,e.soundOut._silentNode.connect(n.audiocontext.destination),n}(t);var r;r=function(){"use strict";var t=n;e.prototype.sampleRate=function(){return t.audiocontext.sampleRate},e.prototype.freqToMidi=function(e){var t=Math.log(e/440)/Math.log(2),n=Math.round(12*t)+57;return n},e.prototype.midiToFreq=function(e){return 440*Math.pow(2,(e-69)/12)},e.prototype.soundFormats=function(){t.extensions=[];for(var e=0;e<arguments.length;e++){arguments[e]=arguments[e].toLowerCase();if(!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[e])>-1))throw arguments[e]+" is not a valid sound format!";t.extensions.push(arguments[e])}},e.prototype.disposeSound=function(){for(var e=0;e<t.soundArray.length;e++)t.soundArray[e].dispose()},e.prototype.registerMethod("remove",e.prototype.disposeSound),e.prototype._checkFileFormats=function(n){var r;if(typeof n=="string"){r=n;var i=r.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(i)>-1){var s=e.prototype.isFileSupported(i);if(s)r=r;else{var o=r.split("."),u=o[o.length-1];for(var a=0;a<t.extensions.length;a++){var f=t.extensions[a],s=e.prototype.isFileSupported(f);if(s){u="",o.length===2&&(u+=o[0]);for(var a=1;a<=o.length-2;a++){var l=o[a];u+="."+l}r=u+=".",r=r+=f;break}}}}else for(var a=0;a<t.extensions.length;a++){var f=t.extensions[a],s=e.prototype.isFileSupported(f);if(s){r=r+"."+f;break}}}else if(typeof n=="object")for(var a=0;a<n.length;a++){var f=n[a].split(".").pop(),s=e.prototype.isFileSupported(f);if(s){r=n[a];break}}return r},e.prototype._mathChain=function(e,t,n,r,i){for(var s in e.mathOps)e.mathOps[s]instanceof i&&(e.mathOps[s].dispose(),n=s,n<e.mathOps.length-1&&(r=e.mathOps[s+1]));return e.mathOps[n-1].disconnect(),e.mathOps[n-1].connect(t),t.connect(r),e.mathOps[n]=t,e}}(n);var i;i=function(){"use strict";var t=n,r=t.audiocontext;typeof r.createStereoPanner!="undefined"?(e.Panner=function(e,t,n){this.stereoPanner=this.input=r.createStereoPanner(),e.connect(this.stereoPanner),this.stereoPanner.connect(t)},e.Panner.prototype.pan=function(e,t){var n=t||0,i=r.currentTime+n;this.stereoPanner.pan.linearRampToValueAtTime(e,i)},e.Panner.prototype.inputChannels=function(e){},e.Panner.prototype.connect=function(e){this.stereoPanner.connect(e)},e.Panner.prototype.disconnect=function(e){this.stereoPanner.disconnect()}):(e.Panner=function(e,t,n){this.input=r.createGain(),e.connect(this.input),this.left=r.createGain(),this.right=r.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",n>1?(this.splitter=r.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=r.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(t)},e.Panner.prototype.pan=function(e,t){var n=t||0,i=r.currentTime+n,s=(e+1)/2,o=Math.cos(s*Math.PI/2),u=Math.sin(s*Math.PI/2);this.left.gain.linearRampToValueAtTime(u,i),this.right.gain.linearRampToValueAtTime(o,i)},e.Panner.prototype.inputChannels=function(e){e===1?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):e===2&&(typeof (this.splitter==="undefined")&&(this.splitter=r.createChannelSplitter(2)),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},e.Panner.prototype.connect=function(e){this.output.connect(e)},e.Panner.prototype.disconnect=function(e){this.output.disconnect()}),e.Panner3D=function(e,t){var n=r.createPanner();return n.panningModel="HRTF",n.distanceModel="linear",n.setPosition(0,0,0),e.connect(n),n.connect(t),n.pan=function(e,t,r){n.setPosition(e,t,r)},n}}(n);var s;s=function(){"use strict";function u(e,t){var n={},r=e.length;for(var i=0;i<r;i++){if(e[i]>t){var o=e[i],u=new s(o,i);n[i]=u,i+=6e3}i++}return n}function a(e){var t=[],n=Object.keys(e).sort();for(var r=0;r<n.length;r++)for(var i=0;i<10;i++){var s=e[n[r]],o=e[n[r+i]];if(s&&o){var u=s.sampleIndex,a=o.sampleIndex,f=a-u;f>0&&s.intervals.push(f);var l=t.some(function(e,t){if(e.interval===f)return e.count++,e});l||t.push({interval:f,count:1})}}return t}function f(e,t){var n=[];return e.forEach(function(e,r){try{var i=Math.abs(60/(e.interval/t));i=c(i);var s=n.some(function(t){if(t.tempo===i)return t.count+=e.count});if(!s){if(isNaN(i))return;n.push({tempo:Math.round(i),count:e.count})}}catch(o){throw o}}),n}function l(e,t,n,r){var i=[],s=Object.keys(e).sort();for(var o=0;o<s.length;o++){var u=s[o],a=e[u];for(var f=0;f<a.intervals.length;f++){var l=Math.round(Math.abs(60/(a.intervals[f]/n)));l=c(l);var h=l-t;Math.abs(l-t)<r&&i.push(a.sampleIndex/44100)}}return i=i.filter(function(e,t,n){var r=n[t+1]-e;if(r>.01)return!0}),i}function c(e){if(!isFinite(e)||e==0)return;while(e<90)e*=2;while(e>180&&e>90)e/=2;return e}var t=n,r=t.audiocontext;e.SoundFile=function(n,r,i){if(typeof n!="undefined"){if(typeof n=="string"||typeof n[0]=="string"){var s=e.prototype._checkFileFormats(n);this.url=s}else if(typeof n=="object"&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";n.file&&(n=n.file),this.file=n}this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._lastPos=0,this._counterNode,this._scopeNode,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.gain=1,this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.amplitude=new e.Amplitude,this.output.connect(this.amplitude.input),this.panPosition=0,this.panner=new e.Panner(this.output,t.input,2),(this.url||this.file)&&this.load(r),t.soundArray.push(this),typeof i=="function"?this.whileLoading=i:this.whileLoading=function(){}},e.prototype.registerPreloadMethod("loadSound",e.prototype),e.prototype.loadSound=function(t,n,r){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var i=new e.SoundFile(t,n,r);return i},e.SoundFile.prototype.load=function(e){if(this.url!=undefined&&this.url!=""){var t=this,n=new XMLHttpRequest;n.addEventListener("progress",function(e){t._updateProgress(e)},!1),n.open("GET",this.url,!0),n.responseType="arraybuffer";var i=this;n.onload=function(){r.decodeAudioData(n.response,function(t){i.buffer=t,i.panner.inputChannels(t.numberOfChannels),e&&e(i)})},n.send()}else if(this.file!=undefined){var s=new FileReader,i=this;s.onload=function(){r.decodeAudioData(s.result,function(t){i.buffer=t,i.panner.inputChannels(t.numberOfChannels),e&&e(i)})},s.readAsArrayBuffer(this.file)}},e.SoundFile.prototype._updateProgress=function(e){if(e.lengthComputable){var t=Math.log(e.loaded/e.total*9.9);this.whileLoading(t)}else console.log("size unknown")},e.SoundFile.prototype.isLoaded=function(){return this.buffer?!0:!1},e.SoundFile.prototype.play=function(e,n,r,i,s){var o=this,u=t.audiocontext.currentTime,a,f,e=e||0;e<0&&(e=0),e+=u;if(!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";this._pauseTime=0;if(this.mode==="restart"&&this.buffer&&this.bufferSourceNode){var u=t.audiocontext.currentTime;this.bufferSourceNode.stop(e),this._counterNode.stop(e)}this.bufferSourceNode=this._initSourceNode(),this._counterNode=this._initCounterNode();if(i){if(!(i>=0&&i<this.buffer.duration))throw"start time out of range";a=i}else a=0;s?s=s<=this.buffer.duration-a?s:this.buffer.duration:s=this.buffer.duration-a;var l=r||1;this.bufferSourceNode.connect(this.output),this.output.gain.value=l,n=n||Math.abs(this.playbackRate),this.bufferSourceNode.playbackRate.setValueAtTime(n,u),this._paused?(this.bufferSourceNode.start(e,this.pauseTime,s),this._counterNode.start(e,this.pauseTime,s)):(this.bufferSourceNode.start(e,a,s),this._counterNode.start(e,a,s)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.onended=function(e){var t=this;this._playing=!1,setTimeout(function(){o.bufferSourceNodes.splice(t._arrayIndex,1),o.bufferSourceNodes.length===0&&(o._playing=!1)},1)},this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping;if(this._looping===!0){var f=a+s;this.bufferSourceNode.loopStart=a,this.bufferSourceNode.loopEnd=f,this._counterNode.loopStart=a,this._counterNode.loopEnd=f}},e.SoundFile.prototype.playMode=function(e){var n=e.toLowerCase();if(n==="restart"&&this.buffer&&this.bufferSourceNode)for(var r=0;r<this.bufferSourceNodes.length-1;r++){var i=t.audiocontext.currentTime;this.bufferSourceNodes[r].stop(i)}if(n!=="restart"&&n!=="sustain")throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=n},e.SoundFile.prototype.pause=function(e){var n=t.audiocontext.currentTime,e=e||0,r=e+n;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(r),this._counterNode.stop(r),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},e.SoundFile.prototype.loop=function(e,t,n,r,i){this._looping=!0,this.play(e,t,n,r,i)},e.SoundFile.prototype.setLoop=function(e){if(e===!0)this._looping=!0;else{if(e!==!1)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},e.SoundFile.prototype.isLooping=function(){return this.bufferSourceNode?this._looping===!0&&this.isPlaying()===!0?!0:!1:!1},e.SoundFile.prototype.isPlaying=function(){return this._playing},e.SoundFile.prototype.isPaused=function(){return this._paused},e.SoundFile.prototype.stop=function(e){var n=e||0;if(this.mode=="sustain")this.stopAll(n),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var r=t.audiocontext.currentTime,i=n||0;this.pauseTime=0,this.bufferSourceNode.stop(r+i),this._counterNode.stop(r+i),this._playing=!1,this._paused=!1}},e.SoundFile.prototype.stopAll=function(e){var n=t.audiocontext.currentTime,r=e||0;if(this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length;i++)if(typeof this.bufferSourceNodes[i]!=undefined)try{this.bufferSourceNodes[i].stop(n+r)}catch(s){}this._counterNode.stop(n+r)}},e.SoundFile.prototype.setVolume=function(e,n,r){if(typeof e=="number"){var n=n||0,r=r||0,i=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(i+r),this.output.gain.linearRampToValueAtTime(s,i+r),this.output.gain.linearRampToValueAtTime(e,i+r+n)}else{if(!e)return this.output.gain;e.connect(this.output.gain)}},e.SoundFile.prototype.amp=e.SoundFile.prototype.setVolume,e.SoundFile.prototype.fade=e.SoundFile.prototype.setVolume,e.SoundFile.prototype.getVolume=function(){return this.output.gain.value},e.SoundFile.prototype.pan=function(e,t){this.panPosition=e,this.panner.pan(e,t)},e.SoundFile.prototype.getPan=function(){return this.panPosition},e.SoundFile.prototype.rate=function(e){if(this.playbackRate===e&&this.bufferSourceNode&&this.bufferSourceNode.playbackRate.value===e)return;this.playbackRate=e;var n=e;this.playbackRate===0&&this._playing&&this.pause();if(this.playbackRate<0&&!this.reversed){var r=this.currentTime(),i=this.bufferSourceNode.playbackRate.value;this.reverseBuffer(),n=Math.abs(e);var s=(r-this.duration())/n;this.pauseTime=s}else this.playbackRate>0&&this.reversed&&this.reverseBuffer();if(this.bufferSourceNode){var o=t.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(o),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(n),o),this._counterNode.playbackRate.cancelScheduledValues(o),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(n),o)}},e.SoundFile.prototype.setPitch=function(e){var t=midiToFreq(e)/midiToFreq(60);this.rate(t)},e.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},e.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},e.SoundFile.prototype.currentTime=function(){return this._pauseTime>0?this._pauseTime:this._lastPos/r.sampleRate},e.SoundFile.prototype.jump=function(e,t){if(e<0||e>this.buffer.duration)throw"jump time out of range";if(t>this.buffer.duration-e)throw"end time out of range";var n=e||0,r=t||this.buffer.duration-e;this.isPlaying()&&this.stop(),this.play(0,this.playbackRate,this.output.gain.value,n,r)},e.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},e.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},e.SoundFile.prototype.frames=function(){return this.buffer.length},e.SoundFile.prototype.getPeaks=function(e){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";e||(e=window.width*5);if(this.buffer){var t=this.buffer,n=t.length/e,r=~~(n/10)||1,i=t.numberOfChannels,s=new Float32Array(Math.round(e));for(var o=0;o<i;o++){var u=t.getChannelData(o);for(var a=0;a<e;a++){var f=~~(a*n),l=~~(f+n),c=0;for(var h=f;h<l;h+=r){var p=u[h];p>c?c=p:-p>c&&(c=p)}if(o===0||Math.abs(c)>s[a])s[a]=c}}return s}},e.SoundFile.prototype.reverseBuffer=function(){var e=this.getVolume();this.setVolume(0,.01,0),this.pause();if(!this.buffer)throw"SoundFile is not done loading";for(var t=0;t<this.buffer.numberOfChannels;t++)Array.prototype.reverse.call(this.buffer.getChannelData(t));this.reversed=!this.reversed,this.setVolume(e,.01,.0101),this.play()},e.SoundFile.prototype._onEnded=function(e){e.onended=function(e){var n=t.audiocontext.currentTime;e.stop(n)}},e.SoundFile.prototype.add=function(){},e.SoundFile.prototype.dispose=function(){var e=t.audiocontext.currentTime;this.stop(e);if(this.buffer&&this.bufferSourceNode){for(var n=0;n<this.bufferSourceNodes.length-1;n++)if(this.bufferSourceNodes[n]!==null){this.bufferSourceNodes[n].disconnect();try{this.bufferSourceNodes[n].stop(e)}catch(r){}this.bufferSourceNodes[n]=null}if(this.isPlaying()){try{this._counterNode.stop(e)}catch(r){console.log(r)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},e.SoundFile.prototype.connect=function(e){e?e.hasOwnProperty("input")?this.panner.connect(e.input):this.panner.connect(e):this.panner.connect(t.input)},e.SoundFile.prototype.disconnect=function(e){this.panner.disconnect(e)},e.SoundFile.prototype.getLevel=function(e){return e&&(this.amplitude.smoothing=e),this.amplitude.getLevel()},e.SoundFile.prototype.setPath=function(t,n){var r=e.prototype._checkFileFormats(t);this.url=r,this.load(n)},e.SoundFile.prototype.setBuffer=function(e){var t=e.length,n=e[0].length,i=r.createBuffer(t,n,r.sampleRate);!e[0]instanceof Float32Array&&(e[0]=new Float32Array(e[0]));for(var s=0;s<t;s++){var o=i.getChannelData(s);o.set(e[s])}this.buffer=i,this.panner.inputChannels(t)},e.SoundFile.prototype._initCounterNode=function(){var t=this,n=r.currentTime,s=r.createBufferSource();return t._scopeNode&&(t._scopeNode.disconnect(),t._scopeNode=null),t._scopeNode=r.createScriptProcessor(256,1,1),s.buffer=i(t.buffer),s.playbackRate.setValueAtTime(t.playbackRate,n),s.connect(t._scopeNode),t._scopeNode.connect(e.soundOut._silentNode),t._scopeNode.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0);t._lastPos=n[n.length-1]||0,t._onTimeUpdate(t._lastPos)},s},e.SoundFile.prototype._initSourceNode=function(){var e=this,t=r.currentTime,n=r.createBufferSource();return n.buffer=e.buffer,n.playbackRate.setValueAtTime(e.playbackRate,t),n};var i=function(e){var t=new Float32Array(e.length),n=r.createBuffer(1,e.length,44100);for(var i=0;i<e.length;i++)t[i]=i;return n.getChannelData(0).set(t),n};e.SoundFile.prototype.processPeaks=function(e,t,n,r){var i=this.buffer.length,s=this.buffer.sampleRate,c=this.buffer,h=t||.9,p=h,d=n||.22,v=r||200,m=new OfflineAudioContext(1,i,s),g=m.createBufferSource();g.buffer=c;var y=m.createBiquadFilter();y.type="lowpass",g.connect(y),y.connect(m.destination),g.start(0),m.startRendering(),m.oncomplete=function(t){var n={},r=t.renderedBuffer,i=r.getChannelData(0);do o=u(i,p),p-=.005;while(Object.keys(o).length<v&&p>=d);var s=a(o),c=f(s,r.sampleRate),h=c.sort(function(e,t){return t.count-e.count}).splice(0,5);this.tempo=h[0].tempo;var m=5,g=l(o,h[0].tempo,r.sampleRate,m);e(g)}};var s=function(e,t){this.sampleIndex=t,this.amplitude=e,this.tempos=[],this.intervals=[]},o=[];e.SoundFile.prototype.addCue=function(e,t,n){var r=this._cueIDCounter++,i=new h(t,e,r,n);return this._cues.push(i),r},e.SoundFile.prototype.removeCue=function(e){for(var t=0;t<this._cues.length;t++){var n=this._cues[t];n.id===e&&this.cues.splice(t,1)}this._cues.length===0},e.SoundFile.prototype.clearCues=function(){this._cues=[]},e.SoundFile.prototype._onTimeUpdate=function(e){var t=e/this.buffer.sampleRate;for(var n=0;n<this._cues.length;n++){var r=this._cues[n].time,i=this._cues[n].val;this._prevTime<r&&r<=t&&this._cues[n].callback(i)}this._prevTime=t};var h=function(e,t,n,r){this.callback=e,this.time=t,this.id=n,this.val=r}}(t,n);var o;o=function(){"use strict";var t=n;e.Amplitude=function(e){this.bufferSize=2048,this.audiocontext=t.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=e||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),t.meter.connect(this.processor)},e.Amplitude.prototype.setInput=function(n,r){t.meter.disconnect(),r&&(this.smoothing=r),n==null?(console.log("Amplitude input source is not ready! Connecting to master output instead"),t.meter.connect(this.processor)):n instanceof e.Signal?n.output.connect(this.processor):n?(n.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):t.meter.connect(this.processor)},e.Amplitude.prototype.connect=function(e){e?e.hasOwnProperty("input")?this.output.connect(e.input):this.output.connect(e):this.output.connect(this.panner.connect(t.input))},e.Amplitude.prototype.disconnect=function(e){this.output.disconnect()},e.Amplitude.prototype._audioProcess=function(e){for(var t=0;t<e.inputBuffer.numberOfChannels;t++){var n=e.inputBuffer.getChannelData(t),r=n.length,i=0,s=0,o;for(var u=0;u<r;u++)o=n[u],this.normalize?(i+=Math.max(Math.min(o/this.volMax,1),-1),s+=Math.max(Math.min(o/this.volMax,1),-1)*Math.max(Math.min(o/this.volMax,1),-1)):(i+=o,s+=o*o);var a=i/r,f=Math.sqrt(s/r);this.stereoVol[t]=Math.max(f,this.stereoVol[t]*this.smoothing),this.stereoAvg[t]=Math.max(a,this.stereoVol[t]*this.smoothing),this.volMax=Math.max(this.stereoVol[t],this.volMax)}var l=this,c=this.stereoVol.reduce(function(e,t,n){return l.stereoVolNorm[n-1]=Math.max(Math.min(l.stereoVol[n-1]/l.volMax,1),0),l.stereoVolNorm[n]=Math.max(Math.min(l.stereoVol[n]/l.volMax,1),0),e+t});this.volume=c/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},e.Amplitude.prototype.getLevel=function(e){return typeof e!="undefined"?this.normalize?this.stereoVolNorm[e]:this.stereoVol[e]:this.normalize?this.volNorm:this.volume},e.Amplitude.prototype.toggleNormalize=function(e){typeof e=="boolean"?this.normalize=e:this.normalize=!this.normalize},e.Amplitude.prototype.smooth=function(e){e>=0&&e<1?this.smoothing=e:console.log("Error: smoothing must be between 0 and 1")}}(n);var u;u=function(){"use strict";var t=n;e.FFT=function(e,n){this.smoothing=e||.8,this.bins=n||1024;var r=n*2||2048;this.input=this.analyser=t.audiocontext.createAnalyser(),t.fftMeter.connect(this.analyser),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=r,this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3]},e.FFT.prototype.setInput=function(e){e?(e.output?e.output.connect(this.analyser):e.connect&&e.connect(this.analyser),t.fftMeter.disconnect()):t.fftMeter.connect(this.analyser)},e.FFT.prototype.waveform=function(){var t,n,r;for(var i=0;i<arguments.length;i++)typeof arguments[i]=="number"&&(t=arguments[i],this.analyser.fftSize=t*2),typeof arguments[i]=="string"&&(n=arguments[i]);if(n&&!e.prototype._isSafari())return s(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;o(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);var r=new Array;for(var i=0;i<this.timeDomain.length;i++){var u=e.prototype.map(this.timeDomain[i],0,255,-1,1);r.push(u)}return r},e.FFT.prototype.analyze=function(){var e,t;for(var n=0;n<arguments.length;n++)typeof arguments[n]=="number"&&(e=this.bins=arguments[n],this.analyser.fftSize=this.bins*2),typeof arguments[n]=="string"&&(t=arguments[n]);if(t&&t.toLowerCase()==="db")return r(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;i(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var s=Array.apply([],this.freqDomain);return s.length===this.analyser.fftSize,s.constructor===Array,s},e.FFT.prototype.getEnergy=function(e,n){var r=t.audiocontext.sampleRate/2;e==="bass"?(e=this.bass[0],n=this.bass[1]):e==="lowMid"?(e=this.lowMid[0],n=this.lowMid[1]):e==="mid"?(e=this.mid[0],n=this.mid[1]):e==="highMid"?(e=this.highMid[0],n=this.highMid[1]):e==="treble"&&(e=this.treble[0],n=this.treble[1]);if(typeof e!="number")throw"invalid input for getEnergy()";if(!n){var i=Math.round(e/r*this.freqDomain.length);return this.freqDomain[i]}if(e&&n){if(e>n){var s=n;n=e,e=s}var o=Math.round(e/r*this.freqDomain.length),u=Math.round(n/r*this.freqDomain.length),a=0,f=0;for(var l=o;l<=u;l++)a+=this.freqDomain[l],f+=1;var c=a/f;return c}throw"invalid input for getEnergy()"},e.FFT.prototype.getFreq=function(e,t){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var n=this.getEnergy(e,t);return n},e.FFT.prototype.smooth=function(e){e&&(this.smoothing=e),this.analyser.smoothingTimeConstant=e};var r=function(e){e.freqDomain instanceof Float32Array==0&&(e.freqDomain=new Float32Array(e.analyser.frequencyBinCount))},i=function(e){e.freqDomain instanceof Uint8Array==0&&(e.freqDomain=new Uint8Array(e.analyser.frequencyBinCount))},s=function(e){e.timeDomain instanceof Float32Array==0&&(e.timeDomain=new Float32Array(e.analyser.frequencyBinCount))},o=function(e){e.timeDomain instanceof Uint8Array==0&&(e.timeDomain=new Uint8Array(e.analyser.frequencyBinCount))}}(n);var a;a=function(){"use strict";function e(e){return e===void 0}var t;e(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),e(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext);if(!e(AudioContext)){t=new AudioContext,typeof AudioContext.prototype.createGain!="function"&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),typeof AudioContext.prototype.createDelay!="function"&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),typeof AudioContext.prototype.createPeriodicWave!="function"&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),typeof AudioBufferSourceNode.prototype.start!="function"&&(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),typeof AudioBufferSourceNode.prototype.stop!="function"&&(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),typeof OscillatorNode.prototype.start!="function"&&(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),typeof OscillatorNode.prototype.stop!="function"&&(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),typeof OscillatorNode.prototype.setPeriodicWave!="function"&&(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),window.Tone||(AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(t,n,r){if(t.input)Array.isArray(t.input)?(e(r)&&(r=0),this.connect(t.input[r])):this.connect(t.input,n,r);else try{t instanceof AudioNode?this._nativeConnect(t,n,r):this._nativeConnect(t,n)}catch(i){throw new Error("error connecting to node: "+t)}});var n=function(t,n){e(t)||t===1?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),e(n)||n===1?this.output=this.context.createGain():n>1&&(this.output=new Array(t))};n.context=t,n.prototype.context=n.context,n.prototype.bufferSize=2048,n.prototype.bufferTime=n.prototype.bufferSize/n.context.sampleRate,n.prototype.connect=function(e,t,n){Array.isArray(this.output)?(t=this.defaultArg(t,0),this.output[t].connect(e,0,n)):this.output.connect(e,t,n)},n.prototype.disconnect=function(e){Array.isArray(this.output)?(e=this.defaultArg(e,0),this.output[e].disconnect()):this.output.disconnect()},n.prototype.connectSeries=function(){if(arguments.length>1){var e=arguments[0];for(var t=1;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}}},n.prototype.connectParallel=function(){var e=arguments[0];if(arguments.length>1)for(var t=1;t<arguments.length;t++){var n=arguments[t];e.connect(n)}},n.prototype.chain=function(){if(arguments.length>0){var e=this;for(var t=0;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}}},n.prototype.fan=function(){if(arguments.length>0)for(var e=1;e<arguments.length;e++)this.connect(arguments[e])},AudioNode.prototype.chain=n.prototype.chain,AudioNode.prototype.fan=n.prototype.fan,n.prototype.defaultArg=function(t,n){if(typeof t=="object"&&typeof n=="object"){var r={};for(var i in t)r[i]=this.defaultArg(t[i],t[i]);for(var s in n)r[s]=this.defaultArg(t[s],n[s]);return r}return e(t)?n:t},n.prototype.optionsObject=function(e,t,n){var r={};if(e.length===1&&typeof e[0]=="object")r=e[0];else for(var i=0;i<t.length;i++)r[t[i]]=e[i];return this.isUndef(n)?r:this.defaultArg(r,n)},n.prototype.isUndef=e,n.prototype.equalPowerScale=function(e){var t=.5*Math.PI;return Math.sin(e*t)},n.prototype.logScale=function(e){return Math.max(this.normalize(this.gainToDb(e),-100,0),0)},n.prototype.expScale=function(e){return this.dbToGain(this.interpolate(e,-100,0))},n.prototype.dbToGain=function(e){return Math.pow(2,e/6)},n.prototype.gainToDb=function(e){return 20*(Math.log(e)/Math.LN10)},n.prototype.interpolate=function(e,t,n){return e*(n-t)+t},n.prototype.normalize=function(e,t,n){if(t>n){var r=n;n=t,t=r}else if(t==n)return 0;return(e-t)/(n-t)},n.prototype.dispose=function(){this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null)};var r=null;n.prototype.noGC=function(){this.output.connect(r)},AudioNode.prototype.noGC=function(){this.connect(r)},n.prototype
.now=function(){return this.context.currentTime},n.prototype.samplesToSeconds=function(e){return e/this.context.sampleRate},n.prototype.toSamples=function(e){var t=this.toSeconds(e);return Math.round(t*this.context.sampleRate)},n.prototype.toSeconds=function(e,t){t=this.defaultArg(t,this.now());if(typeof e=="number")return e;if(typeof e=="string"){var n=0;return e.charAt(0)==="+"&&(e=e.slice(1),n=t),parseFloat(e)+n}return t},n.prototype.frequencyToSeconds=function(e){return 1/parseFloat(e)},n.prototype.secondsToFrequency=function(e){return 1/e};var i=[];return n._initAudioContext=function(e){e(n.context),i.push(e)},n.setContext=function(e){n.prototype.context=e,n.context=e;for(var t=0;t<i.length;t++)i[t](e)},n.extend=function(t,r){function i(){}e(r)&&(r=n),i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t},n.startMobile=function(){var e=n.context.createOscillator(),t=n.context.createGain();t.gain.value=0,e.connect(t),t.connect(n.context.destination);var r=n.context.currentTime;e.start(r),e.stop(r+1)},n._initAudioContext(function(e){n.prototype.bufferTime=n.prototype.bufferSize/e.sampleRate,r=e.createGain(),r.gain.value=0,r.connect(e.destination)}),n}throw new Error("Web Audio is not supported in this browser")}();var f;f=function(e){"use strict";return e.SignalBase=function(){},e.extend(e.SignalBase),e.SignalBase.prototype.connect=function(t,n,r){t instanceof e.Signal?t.setValue(0):t instanceof AudioParam&&(t.value=0),e.prototype.connect.call(this,t,n,r)},e.SignalBase.prototype.dispose=function(){e.prototype.dispose.call(this)},e.SignalBase}(a);var l;l=function(e){"use strict";return e.WaveShaper=function(e,t){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.setCurve(e):isFinite(e)||this.isUndef(e)?this._curve=new Float32Array(this.defaultArg(e,1024)):typeof e=="function"&&(this._curve=new Float32Array(this.defaultArg(t,1024)),this.setMap(e))},e.extend(e.WaveShaper,e.SignalBase),e.WaveShaper.prototype.setMap=function(e){for(var t=0,n=this._curve.length;t<n;t++){var r=t/n*2-1,i=t/(n-1)*2-1;this._curve[t]=e(r,t,i)}this._shaper.curve=this._curve},e.WaveShaper.prototype.setCurve=function(e){if(this._isSafari()){var t=e[0];e.unshift(t)}this._curve=new Float32Array(e),this._shaper.curve=this._curve},e.WaveShaper.prototype.setOversample=function(e){this._shaper.oversample=e},e.WaveShaper.prototype._isSafari=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")!==-1&&e.indexOf("chrome")===-1},e.WaveShaper.prototype.dispose=function(){e.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null},e.WaveShaper}(a);var c;c=function(e){"use strict";return e.Signal=function(t){this._scalar=this.context.createGain(),this.input=this.output=this.context.createGain(),this._syncRatio=1,this.value=this.defaultArg(t,0),e.Signal._constant.chain(this._scalar,this.output)},e.extend(e.Signal,e.SignalBase),e.Signal.prototype.getValue=function(){return this._scalar.gain.value},e.Signal.prototype.setValue=function(e){this._syncRatio===0?e=0:e*=this._syncRatio,this._scalar.gain.value=e},e.Signal.prototype.setValueAtTime=function(e,t){e*=this._syncRatio,this._scalar.gain.setValueAtTime(e,this.toSeconds(t))},e.Signal.prototype.setCurrentValueNow=function(e){e=this.defaultArg(e,this.now());var t=this.getValue();return this.cancelScheduledValues(e),this._scalar.gain.setValueAtTime(t,e),t},e.Signal.prototype.linearRampToValueAtTime=function(e,t){e*=this._syncRatio,this._scalar.gain.linearRampToValueAtTime(e,this.toSeconds(t))},e.Signal.prototype.exponentialRampToValueAtTime=function(e,t){e*=this._syncRatio;try{this._scalar.gain.exponentialRampToValueAtTime(e,this.toSeconds(t))}catch(n){this._scalar.gain.linearRampToValueAtTime(e,this.toSeconds(t))}},e.Signal.prototype.exponentialRampToValueNow=function(e,t){var n=this.now();this.setCurrentValueNow(n),t.toString().charAt(0)==="+"&&(t=t.substr(1)),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t))},e.Signal.prototype.linearRampToValueNow=function(e,t){var n=this.now();this.setCurrentValueNow(n),e*=this._syncRatio,t.toString().charAt(0)==="+"&&(t=t.substr(1)),this._scalar.gain.linearRampToValueAtTime(e,n+this.toSeconds(t))},e.Signal.prototype.setTargetAtTime=function(e,t,n){e*=this._syncRatio,this._scalar.gain.setTargetAtTime(e,this.toSeconds(t),n)},e.Signal.prototype.setValueCurveAtTime=function(e,t,n){for(var r=0;r<e.length;r++)e[r]*=this._syncRatio;this._scalar.gain.setValueCurveAtTime(e,this.toSeconds(t),this.toSeconds(n))},e.Signal.prototype.cancelScheduledValues=function(e){this._scalar.gain.cancelScheduledValues(this.toSeconds(e))},e.Signal.prototype.sync=function(e,t){t?this._syncRatio=t:e.getValue()!==0?this._syncRatio=this.getValue()/e.getValue():this._syncRatio=0,this._scalar.disconnect(),this._scalar=this.context.createGain(),this.connectSeries(e,this._scalar,this.output),this._scalar.gain.value=this._syncRatio},e.Signal.prototype.unsync=function(){var t=this.getValue();this._scalar.disconnect(),this._scalar=this.context.createGain(),this._scalar.gain.value=t/this._syncRatio,this._syncRatio=1,e.Signal._constant.chain(this._scalar,this.output)},e.Signal.prototype.dispose=function(){e.prototype.dispose.call(this),this._scalar.disconnect(),this._scalar=null},Object.defineProperty(e.Signal.prototype,"value",{get:function(){return this.getValue()},set:function(e){this.setValue(e)}}),e.Signal._generator=null,e.Signal._constant=null,e._initAudioContext(function(t){e.Signal._generator=t.createOscillator(),e.Signal._constant=new e.WaveShaper([1,1]),e.Signal._generator.connect(e.Signal._constant),e.Signal._generator.start(0),e.Signal._generator.noGC()}),e.Signal}(a);var h;h=function(e){"use strict";return e.Add=function(t){e.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._value=null,isFinite(t)&&(this._value=new e.Signal(t),this._value.connect(this._sum))},e.extend(e.Add,e.SignalBase),e.Add.prototype.setValue=function(e){if(this._value===null)throw new Error("cannot switch from signal to number");this._value.setValue(e)},e.Add.prototype.dispose=function(){e.prototype.dispose.call(this),this._sum=null,this._value&&(this._value.dispose(),this._value=null)},e.Add}(a);var p;p=function(e){"use strict";return e.Multiply=function(t){e.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._factor=this.input[1]=this.output.gain,this._factor.value=this.defaultArg(t,0)},e.extend(e.Multiply,e.SignalBase),e.Multiply.prototype.setValue=function(e){this._factor.value=e},e.Multiply.prototype.dispose=function(){e.prototype.dispose.call(this),this._mult=null,this._factor=null},e.Multiply}(a);var d;d=function(e){"use strict";return e.Scale=function(t,n){this._outputMin=this.defaultArg(t,0),this._outputMax=this.defaultArg(n,1),this._scale=this.input=new e.Multiply(1),this._add=this.output=new e.Add(0),this._scale.connect(this._add),this._setRange()},e.extend(e.Scale,e.SignalBase),e.Scale.prototype.setMin=function(e){this._outputMin=e,this._setRange()},e.Scale.prototype.setMax=function(e){this._outputMax=e,this._setRange()},e.Scale.prototype._setRange=function(){this._add.setValue(this._outputMin),this._scale.setValue(this._outputMax-this._outputMin)},e.Scale.prototype.dispose=function(){e.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null},e.Scale}(a,h,p);var v;v=function(){"use strict";var t=c,r=h,i=p,s=d,o=a,u=n;o.setContext(u.audiocontext),e.Signal=function(e){var n=new t(e);return n},t.prototype.fade=t.prototype.linearRampToValueAtTime,i.prototype.fade=t.prototype.fade,r.prototype.fade=t.prototype.fade,s.prototype.fade=t.prototype.fade,t.prototype.setInput=function(e){e.connect(this)},i.prototype.setInput=t.prototype.setInput,r.prototype.setInput=t.prototype.setInput,s.prototype.setInput=t.prototype.setInput,t.prototype.add=function(e){var t=new r(e);return this.connect(t),t},i.prototype.add=t.prototype.add,r.prototype.add=t.prototype.add,s.prototype.add=t.prototype.add,t.prototype.mult=function(e){var t=new i(e);return this.connect(t),t},i.prototype.mult=t.prototype.mult,r.prototype.mult=t.prototype.mult,s.prototype.mult=t.prototype.mult,t.prototype.scale=function(t,n,r,i){var o,u;arguments.length===4?(o=e.prototype.map(r,t,n,0,1)-.5,u=e.prototype.map(i,t,n,0,1)-.5):(o=arguments[0],u=arguments[1]);var a=new s(o,u);return this.connect(a),a},i.prototype.scale=t.prototype.scale,r.prototype.scale=t.prototype.scale,s.prototype.scale=t.prototype.scale}(c,h,p,d,a,n);var m;m=function(){"use strict";var t=n,r=c,i=h,s=p,o=d;e.Oscillator=function(n,r){if(typeof n=="string"){var i=r;r=n,n=i}if(typeof r=="number"){var i=r;r=n,n=i}this.started=!1,this.oscillator=t.audiocontext.createOscillator(),this.f=n||440,this.oscillator.frequency.setValueAtTime(this.f,t.audiocontext.currentTime),this.oscillator.type=r||"sine";var s=this.oscillator;this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,t.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=t.input,this.panner=new e.Panner(this.output,this.connection,1),this.mathOps=[this.output],t.soundArray.push(this)},e.Oscillator.prototype.start=function(e,n){if(this.started){var r=t.audiocontext.currentTime;this.stop(r)}if(!this.started){var i=n||this.f,s=this.oscillator.type;this.oscillator=t.audiocontext.createOscillator(),this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(i),t.audiocontext.currentTime),this.oscillator.type=s,this.oscillator.connect(this.output),e=e||0,this.oscillator.start(e+t.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var o in this._freqMods)typeof this._freqMods[o].connect!="undefined"&&this._freqMods[o].connect(this.oscillator.frequency);this.started=!0}},e.Oscillator.prototype.stop=function(e){if(this.started){var n=e||0,r=t.audiocontext.currentTime;this.oscillator.stop(n+r),this.started=!1}},e.Oscillator.prototype.amp=function(e,n,r){var i=this;if(typeof e=="number"){var n=n||0,r=r||0,s=t.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(s),this.output.gain.linearRampToValueAtTime(o,s+r),this.output.gain.linearRampToValueAtTime(e,s+r+n)}else{if(!e)return this.output.gain;console.log(e),e.connect(i.output.gain)}},e.Oscillator.prototype.fade=e.Oscillator.prototype.amp,e.Oscillator.prototype.getAmp=function(){return this.output.gain.value},e.Oscillator.prototype.freq=function(e,n,r){if(typeof e=="number"&&!isNaN(e)){this.f=e;var i=t.audiocontext.currentTime,n=n||0,r=r||0,s=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(i),this.oscillator.frequency.setValueAtTime(s,i+r),e>0?this.oscillator.frequency.exponentialRampToValueAtTime(e,r+n+i):this.oscillator.frequency.linearRampToValueAtTime(e,r+n+i)}else{if(!e)return this.oscillator.frequency;e.output&&(e=e.output),e.connect(this.oscillator.frequency),this._freqMods.push(e)}},e.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},e.Oscillator.prototype.setType=function(e){this.oscillator.type=e},e.Oscillator.prototype.getType=function(){return this.oscillator.type},e.Oscillator.prototype.connect=function(e){e?e.hasOwnProperty("input")?(this.panner.connect(e.input),this.connection=e.input):(this.panner.connect(e),this.connection=e):this.panner.connect(t.input)},e.Oscillator.prototype.disconnect=function(e){this.output.disconnect(),this.panner.disconnect(),this.output.connect(this.panner),this.oscMods=[]},e.Oscillator.prototype.pan=function(e,t){this.panPosition=e,this.panner.pan(e,t)},e.Oscillator.prototype.getPan=function(){return this.panPosition},e.Oscillator.prototype.dispose=function(){if(this.oscillator){var e=t.audiocontext.currentTime;this.stop(e),this.disconnect(),this.oscillator.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},e.Oscillator.prototype.phase=function(n){this.dNode||(this.dNode=t.audiocontext.createDelay(),this.output.disconnect(),this.output.connect(this.dNode),this.dNode.connect(this.panner));var r=t.audiocontext.currentTime;this.dNode.delayTime.linearRampToValueAtTime(e.prototype.map(n,0,1,0,1/this.oscillator.frequency.value),r)};var u=function(e,t,n,r,i){var s=e.oscillator;for(var o in e.mathOps)e.mathOps[o]instanceof i&&(s.disconnect(),e.mathOps[o].dispose(),n=o,n<e.mathOps.length-2&&(r=e.mathOps[o+1]));return n==e.mathOps.length-1&&e.mathOps.push(r),o>0&&(s=e.mathOps[o-1]),s.disconnect(),s.connect(t),t.connect(r),e.mathOps[n]=t,e};e.Oscillator.prototype.add=function(e){var t=new i(e),n=this.mathOps.length-1,r=this.output;return u(this,t,n,r,i)},e.Oscillator.prototype.mult=function(e){var t=new s(e),n=this.mathOps.length-1,r=this.output;return u(this,t,n,r,s)},e.Oscillator.prototype.scale=function(t,n,r,i){var s,a;arguments.length===4?(s=e.prototype.map(r,t,n,0,1)-.5,a=e.prototype.map(i,t,n,0,1)-.5):(s=arguments[0],a=arguments[1]);var f=new o(s,a),l=this.mathOps.length-1,c=this.output;return u(this,f,l,c,o)},e.SinOsc=function(t){e.Oscillator.call(this,t,"sine")},e.SinOsc.prototype=Object.create(e.Oscillator.prototype),e.TriOsc=function(t){e.Oscillator.call(this,t,"triangle")},e.TriOsc.prototype=Object.create(e.Oscillator.prototype),e.SawOsc=function(t){e.Oscillator.call(this,t,"sawtooth")},e.SawOsc.prototype=Object.create(e.Oscillator.prototype),e.SqrOsc=function(t){e.Oscillator.call(this,t,"square")},e.SqrOsc.prototype=Object.create(e.Oscillator.prototype)}(n,c,h,p,d);var g;g=function(){"use strict";var t=n,r=h,i=p,s=d,o=a;o.setContext(t.audiocontext);var u=null,f=!1;e.Env=function(n,r,i,s,o,u,a,f){this.aTime=n,this.aLevel=r,this.dTime=i||0,this.dLevel=s||0,this.sTime=o||0,this.sLevel=u||0,this.rTime=a||0,this.rLevel=f||0,this.output=t.audiocontext.createGain(),this.control=new e.Signal,this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],t.soundArray.push(this)},e.Env.prototype.set=function(e,t,n,r,i,s,o,u){this.aTime=e,this.aLevel=t,this.dTime=n||0,this.dLevel=r||0,this.sTime=i||0,this.sLevel=s||0,this.rTime=o||0,this.rLevel=u||0},e.Env.prototype.setInput=function(e){for(var t=0;t<arguments.length;t++)this.connect(arguments[t])},e.Env.prototype.ctrl=function(e){this.connect(e)},e.Env.prototype.play=function(e,n){var r=t.audiocontext.currentTime,i=n||0,s=r+i;e&&this.connection!==e&&this.connect(e);var o=this.control.getValue();this.control.cancelScheduledValues(s),this.control.linearRampToValueAtTime(o,s),this.control.linearRampToValueAtTime(this.aLevel,s+this.aTime),this.control.linearRampToValueAtTime(this.dLevel,s+this.aTime+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,s+this.aTime+this.dTime+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,s+this.aTime+this.dTime+this.sTime+this.rTime);var u=s+this.aTime+this.dTime+this.sTime+this.rTime},e.Env.prototype.triggerAttack=function(e,n){var r=t.audiocontext.currentTime,i=n||0,s=r+i;this.lastAttack=s,f=!0;var o=this.control.getValue();console.log(o),this.control.cancelScheduledValues(s),this.control.linearRampToValueAtTime(o,s),e&&this.connection!==e&&this.connect(e),this.control.linearRampToValueAtTime(this.aLevel,s+this.aTime),this.control.linearRampToValueAtTime(this.aLevel,s+this.aTime),this.control.linearRampToValueAtTime(this.dLevel,s+this.aTime+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,s+this.aTime+this.dTime+this.sTime)},e.Env.prototype.triggerRelease=function(e,n){if(!f)return;var r=t.audiocontext.currentTime,i=n||0,s=r+i,o;e&&this.connection!==e&&this.connect(e),this.control.cancelScheduledValues(s);if(r-this.lastAttack<this.aTime){var a=this.aTime-(s-this.lastAttack);this.control.linearRampToValueAtTime(this.aLevel,s+a),this.control.linearRampToValueAtTime(this.dLevel,s+a+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,s+a+this.dTime+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,s+a+this.dTime+this.sTime+this.rTime),o=s+this.dTime+this.sTime+this.rTime}else if(r-this.lastAttack<this.aTime+this.dTime){var l=this.aTime+this.dTime-(r-this.lastAttack);this.control.linearRampToValueAtTime(this.dLevel,s+l),this.control.linearRampToValueAtTime(this.sLevel,s+l+.01),this.control.linearRampToValueAtTime(this.rLevel,s+l+.01+this.rTime),o=s+this.sTime+this.rTime}else if(r-this.lastAttack<this.aTime+this.dTime+this.sTime){var c=this.aTime+this.dTime+this.sTime-(r-this.lastAttack);this.control.linearRampToValueAtTime(this.sLevel,s+c),this.control.linearRampToValueAtTime(this.rLevel,s+c+this.rTime),o=s+this.rTime}else this.control.linearRampToValueAtTime(this.sLevel,s),this.control.linearRampToValueAtTime(this.rLevel,s+this.rTime),o=s+this.dTime+this.sTime+this.rTime;var h=s+this.aTime+this.dTime+this.sTime+this.rTime;this.connection&&this.connection.hasOwnProperty("oscillator")?(u=this.connection.oscillator,u.stop(h+.01)):this.connect&&this.connection.hasOwnProperty("source")&&(u=this.connection.source,u.stop(h+.01)),f=!1},e.Env.prototype.connect=function(n){this.connection=n;if(n instanceof e.Oscillator||n instanceof e.SoundFile||n instanceof e.AudioIn||n instanceof e.Reverb||n instanceof e.Noise||n instanceof e.Filter||n instanceof e.Delay)n=n.output.gain;n instanceof AudioParam&&n.setValueAtTime(0,t.audiocontext.currentTime),n instanceof e.Signal&&n.setValue(0),this.output.connect(n)},e.Env.prototype.disconnect=function(e){this.output.disconnect()},e.Env.prototype.add=function(t){var n=new r(t),i=this.mathOps.length,s=this.output;return e.prototype._mathChain(this,n,i,s,r)},e.Env.prototype.mult=function(t){var n=new i(t),r=this.mathOps.length,s=this.output;return e.prototype._mathChain(this,n,r,s,i)},e.Env.prototype.scale=function(t,n,r,i){var o=new s(t,n,r,i),u=this.mathOps.length,a=this.output;return e.prototype._mathChain(this,o,u,a,s)},e.Env.prototype.dispose=function(){var e=t.audiocontext.currentTime;this.disconnect();try{this.control.dispose(),this.control=null}catch(n){}for(var r=1;r<this.mathOps.length;r++)mathOps[r].dispose()}}(n,h,p,d,a);var y;y=function(){"use strict";function r(){var e=t.audiocontext,n=e.createBuffer(1,2048,e.sampleRate),r=n.getChannelData(0);for(var i=0;i<2048;i++)r[i]=1;var s=e.createBufferSource();return s.buffer=n,s.loop=!0,s}var t=n;e.Pulse=function(n,i){e.Oscillator.call(this,n,"sawtooth"),this.w=i||0,this.osc2=new e.SawOsc(n),this.dNode=t.audiocontext.createDelay(),this.dcOffset=r(),this.dcGain=t.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=n||440;var s=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=s,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},e.Pulse.prototype=Object.create(e.Oscillator.prototype),e.Pulse.prototype.width=function(t){if(typeof t=="number"){if(t<=1&&t>=0){this.w=t;var n=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=n}this.dcGain.gain.value=1.7*(.5-this.w)}else{t.connect(this.dNode.delayTime);var r=new e.SignalAdd(-0.5);r.setInput(t),r=r.mult(-1),r=r.mult(1.7),r.connect(this.dcGain.gain)}},e.Pulse.prototype.start=function(e,n){var i=t.audiocontext.currentTime,s=n||0;if(!this.started){var o=e||this.f,u=this.oscillator.type;this.oscillator=t.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(o,i),this.oscillator.type=u,this.oscillator.connect(this.output),this.oscillator.start(s+i),this.osc2.oscillator=t.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(o,s+i),this.osc2.oscillator.type=u,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(s+i),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=r(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(s+i),this.mods!==undefined&&this.mods.frequency!==undefined&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},e.Pulse.prototype.stop=function(e){if(this.started){var n=e||0,r=t.audiocontext.currentTime;this.oscillator.stop(n+r),this.osc2.oscillator.stop(n+r),this.dcOffset.stop(n+r),this.started=!1,this.osc2.started=!1}},e.Pulse.prototype.freq=function(e,n,r){if(typeof e=="number"){this.f=e;var i=t.audiocontext.currentTime,n=n||0,r=r||0,s=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(i),this.oscillator.frequency.setValueAtTime(s,i+r),this.oscillator.frequency.exponentialRampToValueAtTime(e,r+n+i),this.osc2.oscillator.frequency.cancelScheduledValues(i),this.osc2.oscillator.frequency.setValueAtTime(s,i+r),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(e,r+n+i),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else e.output&&(e.output.disconnect(),e.output.connect(this.oscillator.frequency),e.output.connect(this.osc2.oscillator.frequency),this.freqMod=e)}}(n,m);var b;b=function(){"use strict";var t=n;e.Noise=function(t){e.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,this.buffer=r},e.Noise.prototype=Object.create(e.Oscillator.prototype);var r=function(){var e=2*t.audiocontext.sampleRate,n=t.audiocontext.createBuffer(1,e,t.audiocontext.sampleRate),r=n.getChannelData(0);for(var i=0;i<e;i++)r[i]=Math.random()*2-1;return n.type="white",n}(),i=function(){var e=2*t.audiocontext.sampleRate,n=t.audiocontext.createBuffer(1,e,t.audiocontext.sampleRate),r=n.getChannelData(0),i,s,o,u,a,f,l;i=s=o=u=a=f=l=0;for(var c=0;c<e;c++){var h=Math.random()*2-1;i=.99886*i+h*.0555179,s=.99332*s+h*.0750759,o=.969*o+h*.153852,u=.8665*u+h*.3104856,a=.55*a+h*.5329522,f=-0.7616*f-h*.016898,r[c]=i+s+o+u+a+f+l+h*.5362,r[c]*=.11,l=h*.115926}return n.type="pink",n}(),s=function(){var e=2*t.audiocontext.sampleRate,n=t.audiocontext.createBuffer(1,e,t.audiocontext.sampleRate),r=n.getChannelData(0),i=0;for(var s=0;s<e;s++){var o=Math.random()*2-1;r[s]=(i+.02*o)/1.02,i=r[s],r[s]*=3.5}return n.type="brown",n}();e.Noise.prototype.setType=function(e){switch(e){case"white":this.buffer=r;break;case"pink":this.buffer=i;break;case"brown":this.buffer=s;break;default:this.buffer=r}if(this.started){var n=t.audiocontext.currentTime;this.stop(n),this.start(n+.01)}},e.Noise.prototype.getType=function(){return this.buffer.type},e.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=t.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var e=t.audiocontext.currentTime;this.noise.start(e),this.started=!0},e.Noise.prototype.stop=function(){var e=t.audiocontext.currentTime;this.noise&&(this.noise.stop(e),this.started=!1)},e.Noise.prototype.dispose=function(){var e=t.audiocontext.currentTime;this.noise&&(this.noise.disconnect(),this.stop(e)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(n);var w;w=function(){"use strict";var t=n;e.AudioIn=function(){this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=0,this.enabled=!1,this.amplitude=new e.Amplitude,this.output.connect(this.amplitude.input),typeof window.MediaStreamTrack=="undefined"?window.alert("This browser does not support MediaStreamTrack"):typeof window.MediaStreamTrack.getSources=="function"&&window.MediaStreamTrack.getSources(this._gotSources),t.soundArray.push(this)},e.AudioIn.prototype.start=function(){var e=this;if(t.inputSources[e.currentSource]){var n=t.inputSources[e.currentSource].id,r={audio:{optional:[{sourceId:n}]}};navigator.getUserMedia(r,this._onStream=function(n){e.stream=n,e.enabled=!0,e.mediaStream=t.audiocontext.createMediaStreamSource(n),e.mediaStream.connect(e.output),e.amplitude.setInput(e.output)},this._onStreamError=function(e){console.error(e)})}else window.navigator.getUserMedia({audio:!0},this._onStream=function(n){e.stream=n,e.enabled=!0,e.mediaStream=t.audiocontext.createMediaStreamSource(n),e.mediaStream.connect(e.output),e.amplitude.setInput(e.output)},this._onStreamError=function(e){console.error(e)})},e.AudioIn.prototype.stop=function(){this.stream&&this.stream.stop()},e.AudioIn.prototype.connect=function(e){e?e.hasOwnProperty("input")?this.output.connect(e.input):e.hasOwnProperty("analyser")?this.output.connect(e.analyser):this.output.connect(e):this.output.connect(t.input)},e.AudioIn.prototype.disconnect=function(e){this.output.disconnect(e),this.output.connect(this.amplitude.input)},e.AudioIn.prototype.getLevel=function(e){return e&&(this.amplitude.smoothing=e),this.amplitude.getLevel()},e.AudioIn.prototype._gotSources=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.kind==="audio")return n}},e.AudioIn.prototype.amp=function(e,n){if(n){var r=n||0,i=this.output.gain.value;this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.setValueAtTime(i,t.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(e,r+t.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.setValueAtTime(e,t.audiocontext.currentTime)},e.AudioIn.prototype.listSources=function(){return console.log("listSources is deprecated - please use AudioIn.getSources"),console.log("input sources: "),t.inputSources.length>0?t.inputSources:"This browser does not support MediaStreamTrack.getSources()"},e.AudioIn.prototype.getSources=function(e){typeof window.MediaStreamTrack.getSources=="function"?window.MediaStreamTrack.getSources(function(n){for(var r=0,i=n.length;r<i;r++){var s=n[r];s.kind==="audio"&&t.inputSources.push(s)}e(t.inputSources)}):console.log("This browser does not support MediaStreamTrack.getSources()")},e.AudioIn.prototype.setSource=function(e){var n=this;t.inputSources.length>0&&e<t.inputSources.length?(n.currentSource=e,console.log("set source to "+t.inputSources[n.currentSource].id)):console.log("unable to set input source")},e.AudioIn.prototype.dispose=function(){this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),this.amplitude=null,this.output=null}}(n);var E;E=function(){"use strict";var t=n;e.Filter=function(e){this.ac=t.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.output),this.connect(),e&&this.setType(e)},e.Filter.prototype.process=function(e,t,n){e.connect(this.input),this.set(t,n)},e.Filter.prototype.set=function(e,t,n){e&&this.freq(e,n),t&&this.res(t,n)},e.Filter.prototype.freq=function(e,t){var n=this,r=t||0;return e<=0&&(e=1),typeof e=="number"?(n.biquad.frequency.value=e,n.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+r),n.biquad.frequency.exponentialRampToValueAtTime(e,this.ac.currentTime+.02+r)):e&&e.connect(this.biquad.frequency),n.biquad.frequency.value},e.Filter.prototype.res=function(e,t){var n=this,r=t||0;return typeof e=="number"?(n.biquad.Q.value=e,n.biquad.Q.cancelScheduledValues(n.ac.currentTime+.01+r),n.biquad.Q.linearRampToValueAtTime(e,n.ac.currentTime+.02+r)):e&&freq.connect(this.biquad.Q),n.biquad.Q.value},e.Filter.prototype.setType=function(e){this.biquad.type=e},e.Filter.prototype.amp=function(e,n,r){var n=n||0,r=r||0,i=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(i),this.output.gain.linearRampToValueAtTime(s,i+r+.001),this.output.gain.linearRampToValueAtTime(e,i+r+n+.001)},e.Filter.prototype.connect=function(t){var n=t||e.soundOut.input;this.output.connect(n)},e.Filter.prototype.disconnect=function(){this.output.disconnect()},e.LowPass=function(){e.Filter.call(this,"lowpass")},e.LowPass.prototype=Object.create(e.Filter.prototype),e.HighPass=function(){e.Filter.call(this,"highpass")},e.HighPass.prototype=Object.create(e.Filter.prototype),e.BandPass=function(){e.Filter.call(this,"bandpass")},e.BandPass.prototype=Object.create(e.Filter.prototype)}(n);var S;S=function(){"use strict";var t=n,r=E;e.Delay=function(){this.ac=t.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new e.Filter,this._rightFilter=new e.Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this.lowPass=this._leftFilter,this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.output),this.output.connect(e.soundOut.input),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue},e.Delay.prototype.process=function(e,t,n,r){var i=n||0,s=t||0;if(i>=1)throw new Error("Feedback value will force a positive feedback loop.");if(s>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");e.connect(this.input),this.leftDelay.delayTime.setValueAtTime(s,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(s,this.ac.currentTime),this._leftGain.gain.setValueAtTime(i,this.ac.currentTime),this._rightGain.gain.setValueAtTime(i,this.ac.currentTime),r&&(this._leftFilter.freq(r),this._rightFilter.freq(r))},e.Delay.prototype.delayTime=function(e){typeof e!="number"?(e.connect(this.leftDelay.delayTime),e.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime))},e.Delay.prototype.feedback=function(e){if(typeof e!="number")e.connect(this._leftGain.gain),e.connect(this._rightGain.gain);else{if(e>=1)throw new Error("Feedback value will force a positive feedback loop.");this._leftGain.gain.exponentialRampToValueAtTime(e,this.ac.currentTime),this._rightGain.gain.exponentialRampToValueAtTime(e,this.ac.currentTime)}},e.Delay.prototype.filter=function(e,t){this._leftFilter.set(e,t),this._rightFilter.set(e,t)},e.Delay.prototype.setType=function(e){e===1&&(e="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1);switch(e){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._leftFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._leftFilter.output.connect(this.rightDelay)}},e.Delay.prototype.amp=function(e,n,r){var n=n||0,r=r||0,i=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(i),this.output.gain.linearRampToValueAtTime(s,i+r+.001),this.output.gain.linearRampToValueAtTime(e,i+r+n+.001)},e.Delay.prototype.connect=function(t){var n=t||e.soundOut.input;this.output.connect(n)},e.Delay.prototype.disconnect=function(){this.output.disconnect()}}(n,E);var x;x=function(){"use strict";var t=n;e.Reverb=function(){this.ac=t.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse(),this.connect(),t.soundArray.push(this)},e.Reverb.prototype.process=function(e,t,n,r){e.connect(this.input);var i=!1;t&&(this._seconds=t,i=!0),n&&(this._decay=n),r&&(this._reverse=r),i&&this._buildImpulse()},e.Reverb.prototype.set=function(e,t,n){var r=!1;e&&(this._seconds=e,r=!0),t&&(this._decay=t),n&&(this
._reverse=n),r&&this._buildImpulse()},e.Reverb.prototype.amp=function(e,n,r){var n=n||0,r=r||0,i=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(i),this.output.gain.linearRampToValueAtTime(s,i+r+.001),this.output.gain.linearRampToValueAtTime(e,i+r+n+.001)},e.Reverb.prototype.connect=function(t){var n=t||e.soundOut.input;this.output.connect(n.input?n.input:n)},e.Reverb.prototype.disconnect=function(){this.output.disconnect()},e.Reverb.prototype._buildImpulse=function(){var e=this.ac.sampleRate,t=e*this._seconds,n=this._decay,r=this.ac.createBuffer(2,t,e),i=r.getChannelData(0),s=r.getChannelData(1),o,u;for(u=0;u<t;u++)o=this.reverse?t-u:u,i[u]=(Math.random()*2-1)*Math.pow(1-o/t,n),s[u]=(Math.random()*2-1)*Math.pow(1-o/t,n);this.convolverNode.buffer=r},e.Reverb.prototype.dispose=function(){this.convolverNode&&(this.convolverNode.buffer=null,this.convolverNode=null),typeof this.output!="undefined"&&(this.output.disconnect(),this.output=null),typeof this.panner!="undefined"&&(this.panner.disconnect(),this.panner=null)},e.Convolver=function(e,n){this.ac=t.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),e?(this.impulses=[],this._loadBuffer(e,n)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()),this.connect(),t.soundArray.push(this)},e.Convolver.prototype=Object.create(e.Reverb.prototype),e.prototype.registerPreloadMethod("createConvolver",e.prototype),e.prototype.createConvolver=function(t,n){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var r=new e.Convolver(t,n);return r.impulses=[],r},e.Convolver.prototype._loadBuffer=function(t,n){t=e.prototype._checkFileFormats(t);var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer";var i=this;r.onload=function(){var s=e.prototype.getAudioContext();s.decodeAudioData(r.response,function(e){var r={},s=t.split("/");r.name=s[s.length-1],r.audioBuffer=e,i.impulses.push(r),i.convolverNode.buffer=r.audioBuffer,n&&n(r)})},r.send()},e.Convolver.prototype.set=null,e.Convolver.prototype.process=function(e){e.connect(this.input)},e.Convolver.prototype.impulses=[],e.Convolver.prototype.addImpulse=function(e,t){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(e,t)},e.Convolver.prototype.resetImpulse=function(e,t){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(e,t)},e.Convolver.prototype.toggleImpulse=function(e){typeof e=="number"&&e<this.impulses.length&&(this.convolverNode.buffer=this.impulses[e].audioBuffer);if(typeof e=="string")for(var t=0;t<this.impulses.length;t++)if(this.impulses[t].name===e){this.convolverNode.buffer=this.impulses[t].audioBuffer;break}},e.Convolver.prototype.dispose=function(){for(var e in this.impulses)this.impulses[e]=null;this.convolverNode.disconnect(),this.concolverNode=null,typeof this.output!="undefined"&&(this.output.disconnect(),this.output=null),typeof this.panner!="undefined"&&(this.panner.disconnect(),this.panner=null)}}(n,t);var T;T=function(e){"use strict";return e.Clock=function(t,n){this._oscillator=null,this._jsNode=this.context.createScriptProcessor(this.bufferSize,1,1),this._jsNode.onaudioprocess=this._processBuffer.bind(this),this._controlSignal=new e.Signal(1),this._upTick=!1,this.tick=this.defaultArg(n,function(){}),this._jsNode.noGC(),this.setRate(t)},e.extend(e.Clock),e.Clock.prototype.setRate=function(e,t){var n=this.secondsToFrequency(this.toSeconds(e));t?this._controlSignal.exponentialRampToValueNow(n,t):(this._controlSignal.cancelScheduledValues(0),this._controlSignal.setValue(n))},e.Clock.prototype.getRate=function(){return this._controlSignal.getValue()},e.Clock.prototype.start=function(e){this._oscillator=this.context.createOscillator(),this._oscillator.type="square",this._oscillator.connect(this._jsNode),this._controlSignal.connect(this._oscillator.frequency),this._upTick=!1;var t=this.toSeconds(e);this._oscillator.start(t),this._oscillator.onended=function(){}},e.Clock.prototype.stop=function(e,t){var n=this.toSeconds(e);this._oscillator.onended=t,this._oscillator.stop(n)},e.Clock.prototype._processBuffer=function(e){var t=this.defaultArg(e.playbackTime,this.now()),n=this._jsNode.bufferSize,r=e.inputBuffer.getChannelData(0),i=this._upTick,s=this;for(var o=0;o<n;o++){var u=r[o];u>0&&!i?(i=!0,setTimeout(function(){var e=t+s.samplesToSeconds(o+n*2);return function(){s.tick(e)}}(),0)):u<0&&i&&(i=!1)}this._upTick=i},e.Clock.prototype.dispose=function(){this._jsNode.disconnect(),this._controlSignal.dispose(),this._oscillator&&(this._oscillator.onended(),this._oscillator.disconnect()),this._jsNode.onaudioprocess=function(){},this._jsNode=null,this._controlSignal=null,this._oscillator=null},e.Clock}(a);var N;N=function(){"use strict";var t=n,r=T,i=t.audiocontext;e.Metro=function(){this.clock=new r(i.sampleRate,this.ontick.bind(this)),this.syncedParts=[],this.bpm=120,this._init(),this.tickCallback=function(){}};var s=0,o=0;e.Metro.prototype.ontick=function(e){var n=e-s,r=e-t.audiocontext.currentTime;if(n-o<=-0.02)return;s=e;for(var i in this.syncedParts){var u=this.syncedParts[i];u.incrementStep(r);for(var a in u.phrases){var f=u.phrases[a],l=f.sequence,c=this.metroTicks%l.length;l[c]!==0&&(this.metroTicks<l.length||!f.looping)&&f.callback(r,l[c])}}this.metroTicks+=1,this.tickCallback(r)},e.Metro.prototype.setBPM=function(e,n){var r=60/(e*this.tatums);o=r;var i=n||0;this.clock.setRate(r,n+t.audiocontext.currentTime),this.bpm=e},e.Metro.prototype.getBPM=function(e){return this.clock.getRate()/this.tatums*60},e.Metro.prototype._init=function(){this.metroTicks=0},e.Metro.prototype.resetSync=function(e){this.syncedParts=[e]},e.Metro.prototype.pushSync=function(e){this.syncedParts.push(e)},e.Metro.prototype.start=function(e){var t=e||0;this.clock.start(t),this.setBPM(this.bpm)},e.Metro.prototype.stop=function(e){var t=e||0;this.clock._oscillator&&this.clock.stop(t)},e.Metro.prototype.beatLength=function(e){this.tatums=1/e/4}}(n,T);var C;C=function(){"use strict";function i(e){e.currentPart++,e.currentPart>=e.parts.length?(e.scoreStep=0,e.onended()):(e.scoreStep=0,e.parts[e.currentPart-1].stop(),e.parts[e.currentPart].start())}var t=n,r=120;e.prototype.setBPM=function(e,n){r=e;for(var i in t.parts)t.parts[i].setBPM(r,n)},e.Phrase=function(e,t,n){this.phraseStep=0,this.name=e,this.callback=t,this.sequence=n},e.Part=function(n,i){this.length=n||0,this.partStep=0,this.phrases=[],this.looping=!1,this.isPlaying=!1,this.onended=function(){this.stop()},this.tatums=i||.0625,this.metro=new e.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(r),t.parts.push(this),this.callback=function(){}},e.Part.prototype.setBPM=function(e,t){this.metro.setBPM(e,t)},e.Part.prototype.getBPM=function(){return this.metro.getBPM()},e.Part.prototype.start=function(e){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var t=e||0;this.metro.start(t)}},e.Part.prototype.loop=function(e){this.looping=!0,this.onended=function(){this.partStep=0};var t=e||0;this.start(t)},e.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},e.Part.prototype.stop=function(e){this.partStep=0,this.pause(e)},e.Part.prototype.pause=function(e){this.isPlaying=!1;var t=e||0;this.metro.stop(t)},e.Part.prototype.addPhrase=function(t,n,r){var i;if(arguments.length===3)i=new e.Phrase(t,n,r);else{if(!(arguments[0]instanceof e.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";i=arguments[0]}this.phrases.push(i),i.sequence.length>this.length&&(this.length=i.sequence.length)},e.Part.prototype.removePhrase=function(e){for(var t in this.phrases)this.phrases[t].name===e&&this.phrases.split(t,1)},e.Part.prototype.getPhrase=function(e){for(var t in this.phrases)if(this.phrases[t].name===e)return this.phrases[t]},e.Part.prototype.replaceSequence=function(e,t){for(var n in this.phrases)this.phrases[n].name===e&&(this.phrases[n].sequence=t)},e.Part.prototype.incrementStep=function(e){this.partStep<this.length-1?(this.callback(e),this.partStep+=1):(this.looping&&this.callback(e),this.onended(),this.partStep=0)},e.Part.prototype.onStep=function(e){this.callback=e},e.Score=function(){this.parts=[],this.currentPart=0;var e=this;for(var t in arguments)this.parts[t]=arguments[t],this.parts[t].nextPart=this.parts[t+1],this.parts[t].onended=function(){e.resetPart(t),i(e)};this.looping=!1},e.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},e.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},e.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},e.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},e.Score.prototype.loop=function(){this.looping=!0,this.start()},e.Score.prototype.noLoop=function(){this.looping=!1},e.Score.prototype.resetParts=function(){for(var e in this.parts)this.resetPart(e)},e.Score.prototype.resetPart=function(e){this.parts[e].stop(),this.parts[e].partStep=0;for(var t in this.parts[e].phrases)this.parts[e].phrases[t].phraseStep=0},e.Score.prototype.setBPM=function(e,t){for(var n in this.parts)this.parts[n].setBPM(e,t)}}(n);var k;k=function(){"use strict";function i(e,t){var n=e.length+t.length,r=new Float32Array(n),i=0;for(var s=0;s<n;)r[s++]=e[i],r[s++]=t[i],i++;return r}function s(e,t,n){var r=n.length;for(var i=0;i<r;i++)e.setUint8(t+i,n.charCodeAt(i))}var t=n,r=t.audiocontext;e.SoundRecorder=function(){this.input=r.createGain(),this.output=r.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=r.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(e.soundOut._silentNode),this.setInput(),t.soundArray.push(this)},e.SoundRecorder.prototype.setInput=function(t){this.input.disconnect(),this.input=null,this.input=r.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),t?t.connect(this.input):e.soundOut.output.connect(this.input)},e.SoundRecorder.prototype.record=function(e,t,n){this.recording=!0,t&&(this.sampleLimit=Math.round(t*r.sampleRate)),e&&n?this._callback=function(){this.buffer=this._getBuffer(),e.setBuffer(this.buffer),n()}:e&&(this._callback=function(){this.buffer=this._getBuffer(),e.setBuffer(this.buffer)})},e.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},e.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},e.SoundRecorder.prototype._audioprocess=function(e){if(this.recording===!1)return;if(this.recording===!0)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(t)),this._rightBuffers.push(new Float32Array(n)),this.recordedSamples+=this.bufferSize}},e.SoundRecorder.prototype._getBuffer=function(){var e=[];return e.push(this._mergeBuffers(this._leftBuffers)),e.push(this._mergeBuffers(this._rightBuffers)),e},e.SoundRecorder.prototype._mergeBuffers=function(e){var t=new Float32Array(this.recordedSamples),n=0,r=e.length;for(var i=0;i<r;i++){var s=e[i];t.set(s,n),n+=s.length}return t},e.SoundRecorder.prototype.dispose=function(){this._clear(),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},e.prototype.saveSound=function(t,n){var r=t.buffer.getChannelData(0),o=t.buffer.getChannelData(1),u=i(r,o),a=new ArrayBuffer(44+u.length*2),f=new DataView(a);s(f,0,"RIFF"),f.setUint32(4,44+u.length*2,!0),s(f,8,"WAVE"),s(f,12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,1,!0),f.setUint16(22,2,!0),f.setUint32(24,44100,!0),f.setUint32(28,176400,!0),f.setUint16(32,4,!0),f.setUint16(34,16,!0),s(f,36,"data"),f.setUint32(40,u.length*2,!0);var l=u.length,c=44,h=1;for(var p=0;p<l;p++)f.setInt16(c,u[p]*32767*h,!0),c+=2;e.prototype.writeFile([f],n,"wav")}}(t,n);var L;L=function(){"use strict";var t=n;e.PeakDetect=function(e,t,n,r){var i;this.framesPerPeak=r||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=n||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=e||40,this.f2=t||2e4,this._onPeak=function(){}},e.PeakDetect.prototype.update=function(e){var t=this.energy=e.getEnergy(this.f1,this.f2)/255;t>this.cutoff&&t>this.threshold&&t-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=t*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=t,this.penergy=t},e.PeakDetect.prototype.onPeak=function(e,t){var n=this;n._onPeak=function(){e(n.energy,t)}}}(n);var A;A=function(){"use strict";var t=n;e.Gain=function(){this.ac=t.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output)},e.Gain.prototype.setInput=function(e){e.connect(this.input)},e.Gain.prototype.connect=function(t){var n=t||e.soundOut.input;this.output.connect(n.input?n.input:n)},e.Gain.prototype.disconnect=function(){this.output.disconnect()},e.Gain.prototype.amp=function(e,n,r){var n=n||0,r=r||0,i=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(i),this.output.gain.linearRampToValueAtTime(s,i+r),this.output.gain.linearRampToValueAtTime(e,i+r+n)}}(n,t);var O;O=function(){"use strict";var e=t;return e}(t,n,r,i,s,o,u,v,m,g,y,b,w,E,S,x,N,C,k,L,A)});