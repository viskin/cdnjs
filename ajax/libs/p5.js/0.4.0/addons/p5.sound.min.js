/*! p5.sound.js v0.1.7 2015-01-30 */
;var sndcore;sndcore=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=new window.AudioContext();p5.prototype.getAudioContext=function(){return a};if(typeof a.createGain!=="function"){window.audioContext.createGain=window.audioContext.createGainNode}if(typeof a.createDelay!=="function"){window.audioContext.createDelay=window.audioContext.createDelayNode}if(typeof window.AudioBufferSourceNode.prototype.start!=="function"){window.AudioBufferSourceNode.prototype.start=window.AudioBufferSourceNode.prototype.noteGrainOn}if(typeof window.AudioBufferSourceNode.prototype.stop!=="function"){window.AudioBufferSourceNode.prototype.stop=window.AudioBufferSourceNode.prototype.noteOff}if(typeof window.OscillatorNode.prototype.start!=="function"){window.OscillatorNode.prototype.start=window.OscillatorNode.prototype.noteOn}if(typeof window.OscillatorNode.prototype.stop!=="function"){window.OscillatorNode.prototype.stop=window.OscillatorNode.prototype.noteOff}if(!window.AudioContext.prototype.hasOwnProperty("createScriptProcessor")){window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createJavaScriptNode}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var d=document.createElement("audio");p5.prototype.isSupported=function(){return !!d.canPlayType};var b=function(){return !!d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"')};var g=function(){return !!d.canPlayType&&d.canPlayType("audio/mpeg;")};var f=function(){return !!d.canPlayType&&d.canPlayType('audio/wav; codecs="1"')};var h=function(){return !!d.canPlayType&&(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;"))};var c=function(){return !!d.canPlayType&&d.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(i){switch(i.toLowerCase()){case"mp3":return g();case"wav":return f();case"ogg":return b();case"aac","m4a","mp4":return h();case"aif","aiff":return c();default:return false}};var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;if(e){window.addEventListener("touchstart",function(){var i=a.createBuffer(1,1,22050);var j=a.createBufferSource();j.buffer=i;j.connect(a.destination);j.start(0)},false)}}();var master;master=function(){var a=function(){var c=p5.prototype.getAudioContext();this.input=c.createGain();this.output=c.createGain();this.limiter=c.createDynamicsCompressor();this.limiter.threshold.value=0;this.limiter.ratio.value=100;this.audiocontext=c;this.output.disconnect(this.audiocontext.destination);this.inputSources=[];this.input.connect(this.limiter);this.limiter.connect(this.output);this.meter=c.createGain();this.output.connect(this.meter);this.output.connect(this.audiocontext.destination);this.soundArray=[];this.parts=[];this.extensions=[]};var b=new a();p5.soundOut=b;p5.soundOut._silentNode=b.audiocontext.createGain();p5.soundOut._silentNode.gain.value=0;p5.soundOut._silentNode.connect(b.audiocontext.destination);return b}(sndcore);var helpers;helpers=function(){var a=master;p5.prototype.masterVolume=function(b){a.output.gain.value=b};p5.prototype.sampleRate=function(){return a.audiocontext.sampleRate};p5.prototype.getMasterVolume=function(){return a.output.gain.value};p5.prototype.freqToMidi=function(c){var d=Math.log(c/440)/Math.log(2);var b=Math.round(12*d)+57;return b};p5.prototype.midiToFreq=function(b){return 440*Math.pow(2,(b-69)/12)};p5.prototype.soundFormats=function(){a.extensions=[];for(var b=0;b<arguments.length;b++){arguments[b]=arguments[b].toLowerCase();if(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[b])>-1){a.extensions.push(arguments[b])}else{throw arguments[b]+" is not a valid sound format!"}}};p5.prototype.disposeSound=function(){for(var b=0;b<a.soundArray.length;b++){a.soundArray[b].dispose()}};p5.prototype.registerMethod("remove",p5.prototype.disposeSound);p5.prototype._checkFileFormats=function(j){var k;if(typeof j==="string"){k=j;var f=k.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(f)>-1){var b=p5.prototype.isFileSupported(f);if(b){k=k}else{var d=k.split(".");var g=d[d.length-1];for(var e=0;e<a.extensions.length;e++){var h=a.extensions[e];var b=p5.prototype.isFileSupported(h);if(b){g="";if(d.length===2){g+=d[0]}for(var e=1;e<=d.length-2;e++){var c=d[e];g+="."+c}k=g+=".";k=k+=h;break}}}}else{for(var e=0;e<a.extensions.length;e++){var h=a.extensions[e];var b=p5.prototype.isFileSupported(h);if(b){k=k+"."+h;break}}}}else{if(typeof j==="object"){for(var e=0;e<j.length;e++){var h=j[e].split(".").pop();var b=p5.prototype.isFileSupported(h);if(b){k=j[e];break}}}}return k};p5.prototype._mathChain=function(g,e,f,b,d){for(var c in g.mathOps){if(g.mathOps[c] instanceof d){g.mathOps[c].dispose();f=c;if(f<g.mathOps.length-1){b=g.mathOps[c+1]}}}g.mathOps[f-1].disconnect();g.mathOps[f-1].connect(e);e.connect(b);g.mathOps[f]=e;return g}}(master);var panner;panner=function(){var b=master;var a=b.audiocontext;p5.Panner=function(d,c,e){this.input=a.createGain();d.connect(this.input);this.left=a.createGain();this.right=a.createGain();this.left.channelInterpretation="discrete";this.right.channelInterpretation="discrete";if(e>1){this.splitter=a.createChannelSplitter(2);this.input.connect(this.splitter);this.splitter.connect(this.left,1);this.splitter.connect(this.right,0)}else{this.input.connect(this.left);this.input.connect(this.right)}this.output=a.createChannelMerger(2);this.left.connect(this.output,0,1);this.right.connect(this.output,0,0);this.output.connect(c)};p5.Panner.prototype.pan=function(i,g){var h=g||0;var e=a.currentTime+h;var c=(i+1)/2;var d=Math.cos(c*Math.PI/2);var f=Math.sin(c*Math.PI/2);this.left.gain.linearRampToValueAtTime(d,e);this.right.gain.linearRampToValueAtTime(f,e)};p5.Panner.prototype.inputChannels=function(c){if(c===1){this.input.disconnect();this.input.connect(this.left);this.input.connect(this.right)}else{if(c===2){if(typeof(this.splitter==="undefined")){this.splitter=a.createChannelSplitter(2)}this.input.disconnect();this.input.connect(this.splitter);this.splitter.connect(this.left,1);this.splitter.connect(this.right,0)}}};p5.Panner.prototype.connect=function(c){this.output.connect(c)};p5.Panner.prototype.disconnect=function(c){this.output.disconnect()};p5.Panner3D=function(d,c){var e=a.createPanner();e.panningModel="HRTF";e.distanceModel="linear";e.setPosition(0,0,0);d.connect(e);e.connect(c);e.pan=function(h,g,f){e.setPosition(h,g,f)};return e}}(master);var soundfile;soundfile=function(){var a=master;p5.SoundFile=function(e,d,b){var c=p5.prototype._checkFileFormats(e);this.url=c;this.sources=[];this.source=null;this.buffer=null;this.playbackRate=1;this.gain=1;this.input=a.audiocontext.createGain();this.output=a.audiocontext.createGain();this.reversed=false;this.startTime=0;this.endTime=null;this.playing=false;this.paused=null;this.mode="sustain";this.startMillis=null;this.amplitude=new p5.Amplitude();this.output.connect(this.amplitude.input);this.panPosition=0;this.panner=new p5.Panner(this.output,a.input,2);if(this.url){this.load(d)}a.soundArray.push(this);if(typeof b==="function"){this.whileLoading=b}else{this.whileLoading=function(){}}};p5.prototype.registerPreloadMethod("loadSound");p5.prototype.loadSound=function(d,e,b){if(window.location.origin.indexOf("file://")>-1){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}var c=new p5.SoundFile(d,e,b);return c};p5.SoundFile.prototype.load=function(e){var d=this;var c=new XMLHttpRequest();c.addEventListener("progress",function(f){d._updateProgress(f)},false);c.open("GET",this.url,true);c.responseType="arraybuffer";var b=this;c.onload=function(){var f=p5.prototype.getAudioContext();f.decodeAudioData(c.response,function(g){b.buffer=g;b.panner.inputChannels(g.numberOfChannels);if(e){e(b)}})};c.send()};p5.SoundFile.prototype._updateProgress=function(b){if(b.lengthComputable){var c=Math.log(b.loaded/b.total*9.9);this.whileLoading(c)}else{console.log("size unknown")}};p5.SoundFile.prototype.isLoaded=function(){if(this.buffer){return true}else{return false}};p5.SoundFile.prototype.play=function(h,g,e,f,c){var d=a.audiocontext.currentTime;var h=h||0;if(h<0){h=0}if(this.buffer){if(this.mode==="restart"&&this.buffer&&this.source){var d=a.audiocontext.currentTime;this.source.stop(h)}if(f){if(f>=0&&f<this.buffer.duration){this.startTime=f}else{throw"start time out of range"}}if(c){if(c>=0&&c<=this.buffer.duration){this.endTime=c}else{throw"end time out of range"}}else{this.endTime=this.buffer.duration}this.source=a.audiocontext.createBufferSource();this.source.buffer=this.buffer;this.source.loop=this.looping;if(this.source.loop===true){this.source.loopStart=this.startTime;this.source.loopEnd=this.endTime}this.source.onended=function(){};if(!this.source.gain){this.source.gain=a.audiocontext.createGain();this.source.connect(this.source.gain);var b=e||1;this.source.gain.gain.setValueAtTime(b,a.audiocontext.currentTime);this.source.gain.connect(this.output)}else{this.source.gain.value=e||1;this.source.connect(this.output)}this.source.playbackRate.cancelScheduledValues(d);g=g||Math.abs(this.playbackRate);this.source.playbackRate.setValueAtTime(g,d);if(this.paused){this.wasUnpaused=true}if(this.paused&&this.wasUnpaused){this.source.start(h,this.pauseTime,this.endTime)}else{this.wasUnpaused=false;this.pauseTime=0;this.source.start(h,this.startTime,this.endTime)}this.startSeconds=h+d;this.playing=true;this.paused=false;this.sources.push(this.source)}else{throw"not ready to play file, buffer has yet to load. Try preload()"}};p5.SoundFile.prototype.playMode=function(e){var d=e.toLowerCase();if(d==="restart"&&this.buffer&&this.source){for(var c=0;c<this.sources.length-1;c++){var b=a.audiocontext.currentTime;this.sources[c].stop(b)}}if(d==="restart"||d==="sustain"){this.mode=d}else{throw'Invalid play mode. Must be either "restart" or "sustain"'}};p5.SoundFile.prototype.pause=function(e){var c=a.audiocontext.currentTime;var e=e||0;var d=e+c;var b=this.looping;if(this.isPlaying()&&this.buffer&&this.source){this.pauseTime=this.currentTime();this.source.stop(d);this.paused=true;this.wasUnpaused=false;this.playing=false}};p5.SoundFile.prototype.loop=function(d,b,c,e){this.looping=true;this.play(d,b,c,e)};p5.SoundFile.prototype.setLoop=function(b){if(b===true){this.looping=true}else{if(b===false){this.looping=false}else{throw"Error: setLoop accepts either true or false"}}if(this.source){this.source.loop=this.looping}};p5.SoundFile.prototype.isLooping=function(){if(!this.source){return false}if(this.looping===true&&this.isPlaying()===true){return true}return false};p5.SoundFile.prototype.isPlaying=function(){if(this.playing!==null){return this.playing}else{return false}};p5.SoundFile.prototype.isPaused=function(){if(!this.paused){return false}return this.paused};p5.SoundFile.prototype.stop=function(d){if(this.mode=="sustain"){this.stopAll();this.playing=false;this.pauseTime=0;this.wasUnpaused=false;this.paused=false}else{if(this.buffer&&this.source){var b=a.audiocontext.currentTime;var c=d||0;this.source.stop(b+c);this.playing=false;this.pauseTime=0;this.wasUnpaused=false;this.paused=false}}};p5.SoundFile.prototype.stopAll=function(){if(this.buffer&&this.source){for(var c=0;c<this.sources.length;c++){if(this.sources[c]!==null){var b=a.audiocontext.currentTime;this.sources[c].stop(b)}}}};p5.SoundFile.prototype.setVolume=function(c,f,d){if(typeof c==="number"){var f=f||0;var d=d||0;var b=a.audiocontext.currentTime;var e=this.output.gain.value;this.output.gain.cancelScheduledValues(b+d);this.output.gain.linearRampToValueAtTime(e,b+d);this.output.gain.linearRampToValueAtTime(c,b+d+f)}else{if(c){c.connect(this.output.gain)}else{return this.output.gain}}};p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume;p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume;p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value};p5.SoundFile.prototype.pan=function(b,c){this.panPosition=b;this.panner.pan(b,c)};p5.SoundFile.prototype.getPan=function(){return this.panPosition};p5.SoundFile.prototype.rate=function(g){if(this.playbackRate===g&&this.source){if(this.source.playbackRate.value===g){return}}this.playbackRate=g;var e=g;if(this.playbackRate===0&&this.playing){this.pause()}if(this.playbackRate<0&&!this.reversed){var f=this.currentTime();var b=this.source.playbackRate.value;this.reverseBuffer();e=Math.abs(g);var d=(f-this.duration())/e;this.pauseTime=d}else{if(this.playbackRate>0&&this.reversed){this.reverseBuffer()}}if(this.source){var c=a.audiocontext.currentTime;this.source.playbackRate.cancelScheduledValues(c);this.source.playbackRate.linearRampToValueAtTime(Math.abs(e),c)}};p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate};p5.SoundFile.prototype.duration=function(){if(this.buffer){return this.buffer.duration}else{return 0}};p5.SoundFile.prototype.currentTime=function(){var b;if(this.isPlaying()){var c=a.audiocontext.currentTime-this.startSeconds+this.startTime+this.pauseTime;b=c*this.playbackRate%(this.duration()*this.playbackRate);console.log("1");return b}else{if(this.paused){return this.pauseTime}else{return this.startTime}}};p5.SoundFile.prototype.jump=function(d,b){if(d<0||d>this.buffer.duration){throw"jump time out of range"}if(b<d||b>this.buffer.duration){throw"end time out of range"}this.startTime=d||0;if(b){this.endTime=b}else{this.endTime=this.buffer.duration}if(this.isPlaying()){var c=a.audiocontext.currentTime;this.stop(c);this.play(d,this.endTime)}};p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels};p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate};p5.SoundFile.prototype.frames=function(){return this.buffer.length};p5.SoundFile.prototype.getPeaks=function(d){if(this.buffer){if(!d){d=window.width*5}if(this.buffer){var k=this.buffer;var e=k.length/d;var m=~~(e/10)||1;var n=k.numberOfChannels;var q=new Float32Array(Math.round(d));for(var o=0;o<n;o++){var f=k.getChannelData(o);for(var l=0;l<d;l++){var b=~~(l*e);var g=~~(b+e);var p=0;for(var h=b;h<g;h+=m){var r=f[h];if(r>p){p=r}else{if(-r>p){p=r}}}if(o===0||p>q[l]){q[l]=p}}}return q}}else{throw"Cannot load peaks yet, buffer is not loaded"}};p5.SoundFile.prototype.reverseBuffer=function(){var b=this.getVolume();this.setVolume(0,0.01,0);this.pause();if(this.buffer){Array.prototype.reverse.call(this.buffer.getChannelData(0));Array.prototype.reverse.call(this.buffer.getChannelData(1));this.reversed=!this.reversed}else{throw"SoundFile is not done loading"}this.setVolume(b,0.01,0.0101);this.play()};p5.SoundFile.prototype._onEnded=function(b){b.onended=function(d){var c=a.audiocontext.currentTime;d.stop(c)}};p5.SoundFile.prototype.add=function(){};p5.SoundFile.prototype.dispose=function(){if(this.buffer&&this.source){for(var c=0;c<this.sources.length-1;c++){if(this.sources[c]!==null){var b=a.audiocontext.currentTime;this.sources[c].stop(b);this.sources[c]=null}}}if(this.output){this.output.disconnect();this.output=null}if(this.panner){this.panner.disconnect();this.panner=null}};p5.SoundFile.prototype.connect=function(b){if(!b){this.panner.connect(a.input)}else{if(b.hasOwnProperty("input")){this.panner.connect(b.input)}else{this.panner.connect(b)}}};p5.SoundFile.prototype.disconnect=function(b){this.panner.disconnect(b)};p5.SoundFile.prototype.getLevel=function(b){if(b){this.amplitude.smoothing=b}return this.amplitude.getLevel()};p5.SoundFile.prototype.setPath=function(c,d){var b=p5.prototype._checkFileFormats(c);this.url=b;this.load(d)};p5.SoundFile.prototype.setBuffer=function(c){var f=a.audiocontext;var b=f.createBuffer(2,c[0].length,f.sampleRate);var d=0;for(var g=0;g<c.length;g++){var e=b.getChannelData(g);e.set(c[g]);d++}this.buffer=b;this.panner.inputChannels(d)}}(sndcore,master);var amplitude;amplitude=function(){var a=master;p5.Amplitude=function(b){this.bufferSize=2048;this.audiocontext=a.audiocontext;this.processor=this.audiocontext.createScriptProcessor(this.bufferSize);this.input=this.processor;this.output=this.audiocontext.createGain();this.smoothing=b||0;this.volume=0;this.average=0;this.volMax=0.001;this.normalize=false;this.processor.onaudioprocess=this.volumeAudioProcess.bind(this);this.processor.connect(this.output);this.output.gain.value=0;this.output.connect(this.audiocontext.destination);a.meter.connect(this.processor)};p5.Amplitude.prototype.setInput=function(c,b){a.meter.disconnect(this.processor);if(b){this.smoothing=b}if(c==null){console.log("Amplitude input source is not ready! Connecting to master output instead");a.meter.connect(this.processor)}else{if(c instanceof p5.Signal){c.output.connect(this.processor)}else{if(c){c.connect(this.processor);this.processor.disconnect();this.processor.connect(this.output)}else{a.meter.connect(this.processor)}}}};p5.Amplitude.prototype.connect=function(b){if(b){if(b.hasOwnProperty("input")){this.output.connect(b.input)}else{this.output.connect(b)}}else{this.output.connect(this.panner.connect(a.input))}};p5.Amplitude.prototype.disconnect=function(b){this.output.disconnect()};p5.Amplitude.prototype.volumeAudioProcess=function(b){var e=b.inputBuffer.getChannelData(0);var k=e.length;var g=0;var f=0;var h;for(var d=0;d<k;d++){h=e[d];if(this.normalize){g+=Math.max(Math.min(h/this.volMax,1),-1);f+=Math.max(Math.min(h/this.volMax,1),-1)*Math.max(Math.min(h/this.volMax,1),-1)}else{g+=h;f+=h*h}}var c=g/k;var j=Math.sqrt(f/k);this.volume=Math.max(j,this.volume*this.smoothing);this.volMax=Math.max(this.volume,this.volMax);this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)};p5.Amplitude.prototype.getLevel=function(){if(this.normalize){return this.volNorm}else{return this.volume}};p5.Amplitude.prototype.toggleNormalize=function(b){if(typeof b==="boolean"){this.normalize=b}else{this.normalize=!this.normalize}};p5.Amplitude.prototype.smooth=function(b){if(b>=0&&b<1){this.smoothing=b}else{console.log("Error: smoothing must be between 0 and 1")}}}(master);var fft;fft=function(){var a=master;p5.FFT=function(b,c){var e=b||0.8;if(b===0){e=b}var d=c*2||2048;this.analyser=a.audiocontext.createAnalyser();a.output.connect(this.analyser);this.analyser.smoothingTimeConstant=e;this.analyser.fftSize=d;this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount);this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount);this.bass=[20,140];this.lowMid=[140,400];this.mid=[400,2600];this.highMid=[2600,5200];this.treble=[5200,14000]};p5.FFT.prototype.setInput=function(c,b){if(b){this.analyser.fftSize=b*2}if(c.output){c.output.connect(this.analyser)}else{c.connect(this.analyser)}};p5.FFT.prototype.waveform=function(c){if(c){this.analyser.fftSize=c*2}this.analyser.getByteTimeDomainData(this.timeDomain);var b=Array.apply([],this.timeDomain);b.length===this.analyser.fftSize;b.constructor===Array;return b};p5.FFT.prototype.analyze=function(c){if(c){this.analyser.fftSize=c*2}this.analyser.getByteFrequencyData(this.freqDomain);var b=Array.apply([],this.freqDomain);b.length===this.analyser.fftSize;b.constructor===Array;return b};p5.FFT.prototype.getEnergy=function(m,l){var d=a.audiocontext.sampleRate/2;if(m==="bass"){m=this.bass[0];l=this.bass[1]}else{if(m==="lowMid"){m=this.lowMid[0];l=this.lowMid[1]}else{if(m==="mid"){m=this.mid[0];l=this.mid[1]}else{if(m==="highMid"){m=this.highMid[0];l=this.highMid[1]}else{if(m==="treble"){m=this.treble[0];l=this.treble[1]}}}}}if(typeof m!=="number"){throw"invalid input for getEnergy()"}else{if(!l){var h=Math.round(m/d*this.freqDomain.length);return this.freqDomain[h]}else{if(m&&l){if(m>l){var c=l;l=m;m=c}var k=Math.round(m/d*this.freqDomain.length);var b=Math.round(l/d*this.freqDomain.length);var j=0;var e=0;for(var f=k;f<=b;f++){j+=this.freqDomain[f];e+=1}var g=j/e;return g}else{throw"invalid input for getEnergy()"}}}};p5.FFT.prototype.getFreq=function(d,c){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var b=this.getEnergy(d,c);return b};p5.FFT.prototype.smooth=function(b){this.analyser.smoothingTimeConstant=b}}(master);var Tone_core_Tone;Tone_core_Tone=function(){function c(f){return f===void 0}var e;if(c(window.AudioContext)){window.AudioContext=window.webkitAudioContext}if(c(window.OfflineAudioContext)){window.OfflineAudioContext=window.webkitOfflineAudioContext}if(!c(AudioContext)){e=new AudioContext()}else{throw new Error("Web Audio is not supported in this browser")}if(typeof AudioContext.prototype.createGain!=="function"){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}if(typeof AudioContext.prototype.createDelay!=="function"){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}if(typeof AudioContext.prototype.createPeriodicWave!=="function"){AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable}if(typeof AudioBufferSourceNode.prototype.start!=="function"){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}if(typeof AudioBufferSourceNode.prototype.stop!=="function"){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}if(typeof OscillatorNode.prototype.start!=="function"){OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn}if(typeof OscillatorNode.prototype.stop!=="function"){OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff}if(typeof OscillatorNode.prototype.setPeriodicWave!=="function"){OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable}AudioNode.prototype._nativeConnect=AudioNode.prototype.connect;AudioNode.prototype.connect=function(i,g,f){if(i.input){if(Array.isArray(i.input)){if(c(f)){f=0}this.connect(i.input[f])}else{this.connect(i.input,g,f)}}else{try{if(i instanceof AudioNode){this._nativeConnect(i,g,f)}else{this._nativeConnect(i,g)}}catch(h){throw new Error("error connecting to node: "+i)}}};var b=function(f,g){if(c(f)||f===1){this.input=this.context.createGain()}else{if(f>1){this.input=new Array(f)}}if(c(g)||g===1){this.output=this.context.createGain()}else{if(g>1){this.output=new Array(f)}}};b.context=e;b.prototype.context=b.context;b.prototype.bufferSize=2048;b.prototype.bufferTime=b.prototype.bufferSize/b.context.sampleRate;b.prototype.connect=function(g,f,h){if(Array.isArray(this.output)){f=this.defaultArg(f,0);this.output[f].connect(g,0,h)}else{this.output.connect(g,f,h)}};b.prototype.disconnect=function(f){if(Array.isArray(this.output)){f=this.defaultArg(f,0);this.output[f].disconnect()}else{this.output.disconnect()}};b.prototype.connectSeries=function(){if(arguments.length>1){var g=arguments[0];for(var f=1;f<arguments.length;f++){var h=arguments[f];g.connect(h);g=h}}};b.prototype.connectParallel=function(){var h=arguments[0];if(arguments.length>1){for(var f=1;f<arguments.length;f++){var g=arguments[f];h.connect(g)}}};b.prototype.chain=function(){if(arguments.length>0){var g=this;for(var f=0;f<arguments.length;f++){var h=arguments[f];g.connect(h);g=h}}};b.prototype.fan=function(){if(arguments.length>0){for(var f=1;f<arguments.length;f++){this.connect(arguments[f])}}};AudioNode.prototype.chain=b.prototype.chain;AudioNode.prototype.fan=b.prototype.fan;b.prototype.defaultArg=function(j,i){if(typeof j==="object"&&typeof i==="object"){var f={};for(var h in j){f[h]=this.defaultArg(j[h],j[h])}for(var g in i){f[g]=this.defaultArg(j[g],i[g])}return f}else{return c(j)?i:j}};b.prototype.optionsObject=function(f,j,k){var g={};if(f.length===1&&typeof f[0]==="object"){g=f[0]}else{for(var h=0;h<j.length;h++){g[j[h]]=f[h]}}if(!this.isUndef(k)){return this.defaultArg(g,k)}else{return g}};b.prototype.isUndef=c;b.prototype.equalPowerScale=function(g){var f=0.5*Math.PI;return Math.sin(g*f)};b.prototype.logScale=function(f){return Math.max(this.normalize(this.gainToDb(f),-100,0),0)};b.prototype.expScale=function(f){return this.dbToGain(this.interpolate(f,-100,0))};b.prototype.dbToGain=function(f){return Math.pow(2,f/6)};b.prototype.gainToDb=function(f){return 20*(Math.log(f)/Math.LN10)};b.prototype.interpolate=function(g,f,h){return g*(h-f)+f};b.prototype.normalize=function(f,i,h){if(i>h){var g=h;h=i;i=g}else{if(i==h){return 0}}return(f-i)/(h-i)};b.prototype.dispose=function(){if(!this.isUndef(this.input)){if(this.input instanceof AudioNode){this.input.disconnect()}this.input=null}if(!this.isUndef(this.output)){if(this.output instanceof AudioNode){this.output.disconnect()}this.output=null}};var d=null;b.prototype.noGC=function(){this.output.connect(d)};AudioNode.prototype.noGC=function(){this.connect(d)};b.prototype.now=function(){return this.context.currentTime};b.prototype.samplesToSeconds=function(f){return f/this.context.sampleRate};b.prototype.toSamples=function(f){var g=this.toSeconds(f);return Math.round(g*this.context.sampleRate)};b.prototype.toSeconds=function(h,f){f=this.defaultArg(f,this.now());if(typeof h==="number"){return h}else{if(typeof h==="string"){var g=0;if(h.charAt(0)==="+"){h=h.slice(1);g=f}return parseFloat(h)+g}else{return f}}};b.prototype.frequencyToSeconds=function(f){return 1/parseFloat(f)};b.prototype.secondsToFrequency=function(f){return 1/f};var a=[];b._initAudioContext=function(f){f(b.context);a.push(f)};b.setContext=function(f){b.prototype.context=f;b.context=f;for(var g=0;g<a.length;g++){a[g](f)}};b.extend=function(h,f){if(c(f)){f=b}function g(){}g.prototype=f.prototype;h.prototype=new g();h.prototype.constructor=h};b.startMobile=function(){var h=b.context.createOscillator();var f=b.context.createGain();f.gain.value=0;h.connect(f);f.connect(b.context.destination);var g=b.context.currentTime;h.start(g);h.stop(g+1)};b._initAudioContext(function(f){b.prototype.bufferTime=b.prototype.bufferSize/f.sampleRate;d=f.createGain();d.gain.value=0;d.connect(f.destination)});console.log("%c * Tone.js r3 * ","background: #000; color: #fff");return b}();var Tone_signal_SignalBase;Tone_signal_SignalBase=function(a){a.SignalBase=function(){};a.extend(a.SignalBase);a.SignalBase.prototype.connect=function(c,d,b){if(c instanceof a.Signal){c.setValue(0)}else{if(c instanceof AudioParam){c.value=0}}a.prototype.connect.call(this,c,d,b)};a.SignalBase.prototype.dispose=function(){a.prototype.dispose.call(this)};return a.SignalBase}(Tone_core_Tone);var Tone_signal_WaveShaper;Tone_signal_WaveShaper=function(a){a.WaveShaper=function(b,c){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;if(Array.isArray(b)){this.setCurve(b)}else{if(isFinite(b)||this.isUndef(b)){this._curve=new Float32Array(this.defaultArg(b,1024))}else{if(typeof b==="function"){this._curve=new Float32Array(this.defaultArg(c,1024));this.setMap(b)}}}};a.extend(a.WaveShaper,a.SignalBase);a.WaveShaper.prototype.setMap=function(d){for(var e=0,b=this._curve.length;e<b;e++){var f=e/b*2-1;var c=e/(b-1)*2-1;this._curve[e]=d(f,e,c)}this._shaper.curve=this._curve};a.WaveShaper.prototype.setCurve=function(b){if(this._isSafari()){var c=b[0];b.unshift(c)}this._curve=new Float32Array(b);this._shaper.curve=this._curve};a.WaveShaper.prototype.setOversample=function(b){this._shaper.oversample=b};a.WaveShaper.prototype._isSafari=function(){var b=navigator.userAgent.toLowerCase();return b.indexOf("safari")!==-1&&b.indexOf("chrome")===-1};a.WaveShaper.prototype.dispose=function(){a.prototype.dispose.call(this);this._shaper.disconnect();this._shaper=null;this._curve=null};return a.WaveShaper}(Tone_core_Tone);var Tone_signal_Signal;Tone_signal_Signal=function(a){a.Signal=function(b){this._scalar=this.context.createGain();this.input=this.output=this.context.createGain();this._syncRatio=1;this.value=this.defaultArg(b,0);a.Signal._constant.chain(this._scalar,this.output)};a.extend(a.Signal,a.SignalBase);a.Signal.prototype.getValue=function(){return this._scalar.gain.value};a.Signal.prototype.setValue=function(b){if(this._syncRatio===0){b=0}else{b*=this._syncRatio}this._scalar.gain.value=b};a.Signal.prototype.setValueAtTime=function(b,c){b*=this._syncRatio;this._scalar.gain.setValueAtTime(b,this.toSeconds(c))};a.Signal.prototype.setCurrentValueNow=function(c){c=this.defaultArg(c,this.now());var b=this.getValue();this.cancelScheduledValues(c);this._scalar.gain.setValueAtTime(b,c);return b};a.Signal.prototype.linearRampToValueAtTime=function(c,b){c*=this._syncRatio;this._scalar.gain.linearRampToValueAtTime(c,this.toSeconds(b))};a.Signal.prototype.exponentialRampToValueAtTime=function(c,b){c*=this._syncRatio;try{this._scalar.gain.exponentialRampToValueAtTime(c,this.toSeconds(b))}catch(d){this._scalar.gain.linearRampToValueAtTime(c,this.toSeconds(b))}};a.Signal.prototype.exponentialRampToValueNow=function(d,b){var c=this.now();this.setCurrentValueNow(c);if(b.toString().charAt(0)==="+"){b=b.substr(1)}this.exponentialRampToValueAtTime(d,c+this.toSeconds(b))};a.Signal.prototype.linearRampToValueNow=function(d,b){var c=this.now();this.setCurrentValueNow(c);d*=this._syncRatio;if(b.toString().charAt(0)==="+"){b=b.substr(1)}this._scalar.gain.linearRampToValueAtTime(d,c+this.toSeconds(b))};a.Signal.prototype.setTargetAtTime=function(d,b,c){d*=this._syncRatio;this._scalar.gain.setTargetAtTime(d,this.toSeconds(b),c)};a.Signal.prototype.setValueCurveAtTime=function(b,d,e){for(var c=0;c<b.length;c++){b[c]*=this._syncRatio}this._scalar.gain.setValueCurveAtTime(b,this.toSeconds(d),this.toSeconds(e))};a.Signal.prototype.cancelScheduledValues=function(b){this._scalar.gain.cancelScheduledValues(this.toSeconds(b))};a.Signal.prototype.sync=function(c,b){if(b){this._syncRatio=b}else{if(c.getValue()!==0){this._syncRatio=this.getValue()/c.getValue()}else{this._syncRatio=0}}this._scalar.disconnect();this._scalar=this.context.createGain();this.connectSeries(c,this._scalar,this.output);this._scalar.gain.value=this._syncRatio};a.Signal.prototype.unsync=function(){var b=this.getValue();this._scalar.disconnect();this._scalar=this.context.createGain();this._scalar.gain.value=b/this._syncRatio;this._syncRatio=1;a.Signal._constant.chain(this._scalar,this.output)};a.Signal.prototype.dispose=function(){a.prototype.dispose.call(this);this._scalar.disconnect();this._scalar=null};Object.defineProperty(a.Signal.prototype,"value",{get:function(){return this.getValue()},set:function(b){this.setValue(b)}});a.Signal._generator=null;a.Signal._constant=null;a._initAudioContext(function(b){a.Signal._generator=b.createOscillator();a.Signal._constant=new a.WaveShaper([1,1]);a.Signal._generator.connect(a.Signal._constant);a.Signal._generator.start(0);a.Signal._generator.noGC()});return a.Signal}(Tone_core_Tone);var Tone_signal_Add;Tone_signal_Add=function(a){a.Add=function(b){a.call(this,2,0);this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain();this._value=null;if(isFinite(b)){this._value=new a.Signal(b);this._value.connect(this._sum)}};a.extend(a.Add,a.SignalBase);a.Add.prototype.setValue=function(b){if(this._value!==null){this._value.setValue(b)}else{throw new Error("cannot switch from signal to number")}};a.Add.prototype.dispose=function(){a.prototype.dispose.call(this);this._sum=null;if(this._value){this._value.dispose();this._value=null}};return a.Add}(Tone_core_Tone);var Tone_signal_Multiply;Tone_signal_Multiply=function(a){a.Multiply=function(b){a.call(this,2,0);this._mult=this.input[0]=this.output=this.context.createGain();this._factor=this.input[1]=this.output.gain;this._factor.value=this.defaultArg(b,0)};a.extend(a.Multiply,a.SignalBase);a.Multiply.prototype.setValue=function(b){this._factor.value=b};a.Multiply.prototype.dispose=function(){a.prototype.dispose.call(this);this._mult=null;this._factor=null};return a.Multiply}(Tone_core_Tone);var Tone_signal_Scale;Tone_signal_Scale=function(a){a.Scale=function(b,c){this._outputMin=this.defaultArg(b,0);this._outputMax=this.defaultArg(c,1);this._scale=this.input=new a.Multiply(1);this._add=this.output=new a.Add(0);this._scale.connect(this._add);this._setRange()};a.extend(a.Scale,a.SignalBase);a.Scale.prototype.setMin=function(b){this._outputMin=b;this._setRange()};a.Scale.prototype.setMax=function(b){this._outputMax=b;this._setRange()};a.Scale.prototype._setRange=function(){this._add.setValue(this._outputMin);this._scale.setValue(this._outputMax-this._outputMin)};a.Scale.prototype.dispose=function(){a.prototype.dispose.call(this);this._add.dispose();this._add=null;this._scale.dispose();this._scale=null};return a.Scale}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Multiply);var signal;signal=function(){var e=Tone_signal_Signal;var b=Tone_signal_Add;var d=Tone_signal_Multiply;var a=Tone_signal_Scale;var c=Tone_core_Tone;var f=master;c.setContext(f.audiocontext);p5.Signal=function(h){var g=new e(h);return g};e.prototype.fade=e.prototype.linearRampToValueAtTime;d.prototype.fade=e.prototype.fade;b.prototype.fade=e.prototype.fade;a.prototype.fade=e.prototype.fade;e.prototype.setInput=function(g){g.connect(this)};d.prototype.setInput=e.prototype.setInput;b.prototype.setInput=e.prototype.setInput;a.prototype.setInput=e.prototype.setInput;e.prototype.add=function(g){var h=new b(g);this.connect(h);return h};d.prototype.add=e.prototype.add;b.prototype.add=e.prototype.add;a.prototype.add=e.prototype.add;e.prototype.mult=function(g){var h=new d(g);this.connect(h);return h};d.prototype.mult=e.prototype.mult;b.prototype.mult=e.prototype.mult;a.prototype.mult=e.prototype.mult;e.prototype.scale=function(h,m,g,l){var k,i;if(arguments.length===4){k=p5.prototype.map(g,h,m,0,1)-0.5;i=p5.prototype.map(l,h,m,0,1)-0.5}else{k=arguments[0];i=arguments[1]}var j=new a(k,i);this.connect(j);return j};d.prototype.scale=e.prototype.scale;b.prototype.scale=e.prototype.scale;a.prototype.scale=e.prototype.scale}(Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone,master);var oscillator;oscillator=function(){var f=master;var d=Tone_signal_Signal;var b=Tone_signal_Add;var c=Tone_signal_Multiply;var a=Tone_signal_Scale;p5.Oscillator=function(i,g){if(typeof i==="string"){var h=g;g=i;i=h}if(typeof g==="number"){var h=g;g=i;i=h}this.started=false;this.oscillator=f.audiocontext.createOscillator();this.f=i||440;this.oscillator.frequency.setValueAtTime(this.f,f.audiocontext.currentTime);this.oscillator.type=g||"sine";var j=this.oscillator;this.input=f.audiocontext.createGain();this.output=f.audiocontext.createGain();this._freqMods=[];this.output.gain.value=0.5;this.output.gain.setValueAtTime(0.5,f.audiocontext.currentTime);this.oscillator.connect(this.output);this.panPosition=0;this.connection=f.input;this.panner=new p5.Panner(this.output,this.connection,1);this.mathOps=[this.output];f.soundArray.push(this)};p5.Oscillator.prototype.start=function(m,k){if(this.started){var g=f.audiocontext.currentTime;this.stop(g)}if(!this.started){var l=k||this.f;var j=this.oscillator.type;this.oscillator=f.audiocontext.createOscillator();this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(l),f.audiocontext.currentTime);this.oscillator.type=j;this.oscillator.connect(this.output);m=m||0;this.oscillator.start(m+f.audiocontext.currentTime);this.freqNode=this.oscillator.frequency;for(var h in this._freqMods){if(typeof this._freqMods[h].connect!=="undefined"){this._freqMods[h].connect(this.oscillator.frequency)}}this.started=true}};p5.Oscillator.prototype.stop=function(i){if(this.started){var h=i||0;var g=f.audiocontext.currentTime;this.oscillator.stop(h+g);this.started=false}};p5.Oscillator.prototype.amp=function(i,l,j){var g=this;if(typeof i==="number"){var l=l||0;var j=j||0;var h=f.audiocontext.currentTime;var k=this.output.gain.value;this.output.gain.cancelScheduledValues(h);this.output.gain.linearRampToValueAtTime(k,h+j);this.output.gain.linearRampToValueAtTime(i,h+j+l)}else{if(i){console.log(i);i.connect(g.output.gain)}else{return this.output.gain}}};p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp;p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value};p5.Oscillator.prototype.freq=function(j,k,i){if(typeof j==="number"&&!isNaN(j)){this.f=j;var g=f.audiocontext.currentTime;var k=k||0;var i=i||0;var h=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(g);this.oscillator.frequency.setValueAtTime(h,g+i);if(j>0){this.oscillator.frequency.exponentialRampToValueAtTime(j,i+k+g)}else{this.oscillator.frequency.linearRampToValueAtTime(j,i+k+g)}}else{if(j){if(j.output){j=j.output}j.connect(this.oscillator.frequency);this._freqMods.push(j)}else{return this.oscillator.frequency}}};p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value};p5.Oscillator.prototype.setType=function(g){this.oscillator.type=g};p5.Oscillator.prototype.getType=function(){return this.oscillator.type};p5.Oscillator.prototype.connect=function(g){if(!g){this.panner.connect(f.input)}else{if(g.hasOwnProperty("input")){this.panner.connect(g.input);this.connection=g.input}else{this.panner.connect(g);this.connection=g}}};p5.Oscillator.prototype.disconnect=function(g){this.output.disconnect();this.panner.disconnect();this.output.connect(this.panner);this.oscMods=[]};p5.Oscillator.prototype.pan=function(g,h){this.panPosition=g;this.panner.pan(g,h)};p5.Oscillator.prototype.getPan=function(){return this.panPosition};p5.Oscillator.prototype.dispose=function(){if(this.oscillator){var g=f.audiocontext.currentTime;this.stop(g);this.disconnect();this.oscillator.disconnect();this.panner=null;this.oscillator=null}if(this.osc2){this.osc2.dispose()}};p5.Oscillator.prototype.phase=function(h){if(!this.dNode){this.dNode=f.audiocontext.createDelay();this.output.disconnect();this.output.connect(this.dNode);this.dNode.connect(this.panner)}var g=f.audiocontext.currentTime;this.dNode.delayTime.linearRampToValueAtTime(p5.prototype.map(h,0,1,0,1/this.oscillator.frequency.value),g)};var e=function(n,k,m,g,j){var l=n.oscillator;for(var h in n.mathOps){if(n.mathOps[h] instanceof j){l.disconnect();n.mathOps[h].dispose();m=h;if(m<n.mathOps.length-2){g=n.mathOps[h+1]}}}if(m==n.mathOps.length-1){n.mathOps.push(g)}if(h>0){l=n.mathOps[h-1]}l.disconnect();l.connect(k);k.connect(g);n.mathOps[m]=k;return n};p5.Oscillator.prototype.add=function(h){var i=new b(h);var j=this.mathOps.length-1;var g=this.output;return e(this,i,j,g,b)};p5.Oscillator.prototype.mult=function(h){var i=new c(h);var j=this.mathOps.length-1;var g=this.output;return e(this,i,j,g,c)};p5.Oscillator.prototype.scale=function(l,o,g,j){var m,h;if(arguments.length===4){m=p5.prototype.map(g,l,o,0,1)-0.5;h=p5.prototype.map(j,l,o,0,1)-0.5}else{m=arguments[0];h=arguments[1]}var i=new a(m,h);var k=this.mathOps.length-1;var n=this.output;return e(this,i,k,n,a)};p5.SinOsc=function(g){p5.Oscillator.call(this,g,"sine")};p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype);p5.TriOsc=function(g){p5.Oscillator.call(this,g,"triangle")};p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype);p5.SawOsc=function(g){p5.Oscillator.call(this,g,"sawtooth")};p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype);p5.SqrOsc=function(g){p5.Oscillator.call(this,g,"square")};p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale);var env;env=function(){var f=master;var c=Tone_signal_Add;var e=Tone_signal_Multiply;var b=Tone_signal_Scale;var d=Tone_core_Tone;d.setContext(f.audiocontext);var a=null;p5.Env=function(l,h,k,g,j,n,i,m){this.aTime=l;this.aLevel=h;this.dTime=k||0;this.dLevel=g||0;this.sTime=j||0;this.sLevel=n||0;this.rTime=i||0;this.rLevel=m||0;this.output=f.audiocontext.createGain();this.control=new p5.Signal();this.control.connect(this.output);this.timeoutID=null;this.connection=null;this.mathOps=[this.control];f.soundArray.push(this)};p5.Env.prototype.set=function(l,h,k,g,j,n,i,m){this.aTime=l;this.aLevel=h;this.dTime=k||0;this.dLevel=g||0;this.sTime=j||0;this.sLevel=n||0;this.rTime=i||0;this.rLevel=m||0};p5.Env.prototype.setInput=function(g){this.connect(g)};p5.Env.prototype.ctrl=function(g){this.connect(g)};p5.Env.prototype.play=function(l,g){var i=f.audiocontext.currentTime;var k=g||0;var j=i+k+0.0001;if(typeof this.timeoutID==="number"){window.clearTimeout(this.timeoutID)}if(l){if(this.connection!==l){this.connect(l)}}this.control.cancelScheduledValues(j-0.0001);this.control.linearRampToValueAtTime(0,j-0.00005);this.control.linearRampToValueAtTime(this.aLevel,j+this.aTime);this.control.linearRampToValueAtTime(this.dLevel,j+this.aTime+this.dTime);this.control.linearRampToValueAtTime(this.sLevel,j+this.aTime+this.dTime+this.sTime);this.control.linearRampToValueAtTime(this.rLevel,j+this.aTime+this.dTime+this.sTime+this.rTime);var h=j+this.aTime+this.dTime+this.sTime+this.rTime};p5.Env.prototype.triggerAttack=function(l,g){var i=f.audiocontext.currentTime;var k=g||0;var j=i+k+0.0001;this.lastAttack=j;if(typeof this.timeoutID==="number"){window.clearTimeout(this.timeoutID)}var h=this.control.getValue();this.control.cancelScheduledValues(j-0.0001);this.control.linearRampToValueAtTime(h,j-0.00005);if(l){if(this.connection!==l){this.connect(l)}}this.control.linearRampToValueAtTime(this.aLevel,j+this.aTime);this.control.linearRampToValueAtTime(this.aLevel,j+this.aTime);this.control.linearRampToValueAtTime(this.dLevel,j+this.aTime+this.dTime);this.control.linearRampToValueAtTime(this.sLevel,j+this.aTime+this.dTime+this.sTime)};p5.Env.prototype.triggerRelease=function(m,p){var h=f.audiocontext.currentTime;var i=p||0;var n=h+i+0.00001;var g;if(m){if(this.connection!==m){this.connect(m)}}this.control.cancelScheduledValues(n-0.00001);if(h-this.lastAttack<this.aTime){var l=this.aTime-(n-this.lastAttack);this.control.linearRampToValueAtTime(this.aLevel,n+l);this.control.linearRampToValueAtTime(this.dLevel,n+l+this.dTime);this.control.linearRampToValueAtTime(this.sLevel,n+l+this.dTime+this.sTime);this.control.linearRampToValueAtTime(this.rLevel,n+l+this.dTime+this.sTime+this.rTime);g=n+this.dTime+this.sTime+this.rTime}else{if(h-this.lastAttack<this.aTime+this.dTime){var j=this.aTime+this.dTime-(h-this.lastAttack);this.control.linearRampToValueAtTime(this.dLevel,n+j);this.control.linearRampToValueAtTime(this.sLevel,n+j+0.01);this.control.linearRampToValueAtTime(this.rLevel,n+j+0.01+this.rTime);g=n+this.sTime+this.rTime}else{if(h-this.lastAttack<this.aTime+this.dTime+this.sTime){var o=this.aTime+this.dTime+this.sTime-(h-this.lastAttack);this.control.linearRampToValueAtTime(this.sLevel,n+o);this.control.linearRampToValueAtTime(this.rLevel,n+o+this.rTime);g=n+this.rTime}else{this.control.linearRampToValueAtTime(this.sLevel,n);this.control.linearRampToValueAtTime(this.rLevel,n+this.rTime);g=n+this.dTime+this.sTime+this.rTime}}}var k=n+this.aTime+this.dTime+this.sTime+this.rTime;if(this.connection&&this.connection.hasOwnProperty("oscillator")){a=this.connection.oscillator;a.stop(k+0.01)}else{if(this.connect&&this.connection.hasOwnProperty("source")){a=this.connection.source;a.stop(k+0.01)}}};p5.Env.prototype.connect=function(g){this.disconnect();this.connection=g;if(g instanceof p5.Oscillator||g instanceof p5.SoundFile||g instanceof p5.AudioIn||g instanceof p5.Reverb||g instanceof p5.Noise||g instanceof p5.Filter||g instanceof p5.Delay){g=g.output.gain}if(g instanceof AudioParam){g.setValueAtTime(0,f.audiocontext.currentTime)}if(g instanceof p5.Signal){g.setValue(0)}this.output.connect(g)};p5.Env.prototype.disconnect=function(g){this.output.disconnect()};p5.Env.prototype.add=function(h){var i=new c(h);var j=this.mathOps.length;var g=this.output;return p5.prototype._mathChain(this,i,j,g,c)};p5.Env.prototype.mult=function(h){var i=new e(h);var j=this.mathOps.length;var g=this.output;return p5.prototype._mathChain(this,i,j,g,e)};p5.Env.prototype.scale=function(i,m,h,l){var k=new b(i,m,h,l);var j=this.mathOps.length;var g=this.output;return p5.prototype._mathChain(this,k,j,g,b)};p5.Env.prototype.dispose=function(){var g=f.audiocontext.currentTime;this.disconnect();this.control.dispose();this.control=null;for(var h=1;h<this.mathOps.length;h++){mathOps[h].dispose()}}}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone);var pulse;pulse=function(){var b=master;p5.Pulse=function(d,c){p5.Oscillator.call(this,d,"sawtooth");this.w=c||0;this.osc2=new p5.SawOsc(d);this.dNode=b.audiocontext.createDelay();this.dcOffset=a();this.dcGain=b.audiocontext.createGain();this.dcOffset.connect(this.dcGain);this.dcGain.connect(this.output);this.f=d||440;var e=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=e;this.dcGain.gain.value=1.7*(0.5-this.w);this.osc2.disconnect();this.osc2.output.gain.minValue=-10;this.osc2.output.gain.maxValue=10;this.osc2.panner.disconnect();this.osc2.amp(-1);this.osc2.output.connect(this.dNode);this.dNode.connect(this.output);this.output.gain.value=1;this.output.connect(this.panner)};p5.Pulse.prototype=Object.create(p5.Oscillator.prototype);p5.Pulse.prototype.width=function(c){if(typeof c==="number"){if(c<=1&&c>=0){this.w=c;var e=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=e}this.dcGain.gain.value=1.7*(0.5-this.w)}else{c.connect(this.dNode.delayTime);var d=new p5.SignalAdd(-0.5);d.setInput(c);d=d.mult(-1);d=d.mult(1.7);d.connect(this.dcGain.gain)}};p5.Pulse.prototype.start=function(g,i){var c=b.audiocontext.currentTime;var d=i||0;if(!this.started){var h=g||this.f;var e=this.oscillator.type;this.oscillator=b.audiocontext.createOscillator();this.oscillator.frequency.setValueAtTime(h,c);this.oscillator.type=e;this.oscillator.connect(this.output);this.oscillator.start(d+c);this.osc2.oscillator=b.audiocontext.createOscillator();this.osc2.oscillator.frequency.setValueAtTime(h,d+c);this.osc2.oscillator.type=e;this.osc2.oscillator.connect(this.osc2.output);this.osc2.start(d+c);this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency];this.dcOffset=a();this.dcOffset.connect(this.dcGain);this.dcOffset.start(d+c);if(this.mods!==undefined&&this.mods.frequency!==undefined){this.mods.frequency.connect(this.freqNode[0]);this.mods.frequency.connect(this.freqNode[1])}this.started=true;this.osc2.started=true}};p5.Pulse.prototype.stop=function(e){if(this.started){var d=e||0;var c=b.audiocontext.currentTime;this.oscillator.stop(d+c);this.osc2.oscillator.stop(d+c);this.dcOffset.stop(d+c);this.started=false;this.osc2.started=false}};p5.Pulse.prototype.freq=function(f,g,e){if(typeof f==="number"){this.f=f;var c=b.audiocontext.currentTime;var g=g||0;var e=e||0;var d=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(c);this.oscillator.frequency.setValueAtTime(d,c+e);this.oscillator.frequency.exponentialRampToValueAtTime(f,e+g+c);this.osc2.oscillator.frequency.cancelScheduledValues(c);this.osc2.oscillator.frequency.setValueAtTime(d,c+e);this.osc2.oscillator.frequency.exponentialRampToValueAtTime(f,e+g+c);if(this.freqMod){this.freqMod.output.disconnect();this.freqMod=null}}else{if(f.output){f.output.disconnect();f.output.connect(this.oscillator.frequency);f.output.connect(this.osc2.oscillator.frequency);this.freqMod=f}}};function a(){var e=b.audiocontext;var c=e.createBuffer(1,2048,e.sampleRate);var f=c.getChannelData(0);for(var d=0;d<2048;d++){f[d]=1}var g=e.createBufferSource();g.buffer=c;g.loop=true;return g}}(master,oscillator);var noise;noise=function(){var d=master;p5.Noise=function(e){p5.Oscillator.call(this);delete this.f;delete this.freq;delete this.oscillator;this.buffer=b};p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var b=function(){var h=2*d.audiocontext.sampleRate;var e=d.audiocontext.createBuffer(1,h,d.audiocontext.sampleRate);var g=e.getChannelData(0);for(var f=0;f<h;f++){g[f]=Math.random()*2-1}e.type="white";return e}();var a=function(){var f=2*d.audiocontext.sampleRate;var e=d.audiocontext.createBuffer(1,f,d.audiocontext.sampleRate);var q=e.getChannelData(0);var p,o,n,m,l,k,h;p=o=n=m=l=k=h=0;for(var g=0;g<f;g++){var j=Math.random()*2-1;p=0.99886*p+j*0.0555179;o=0.99332*o+j*0.0750759;n=0.969*n+j*0.153852;m=0.8665*m+j*0.3104856;l=0.55*l+j*0.5329522;k=-0.7616*k-j*0.016898;q[g]=p+o+n+m+l+k+h+j*0.5362;q[g]*=0.11;h=j*0.115926}e.type="pink";return e}();var c=function(){var k=2*d.audiocontext.sampleRate;var h=d.audiocontext.createBuffer(1,k,d.audiocontext.sampleRate);var j=h.getChannelData(0);var e=0;for(var g=0;g<k;g++){var f=Math.random()*2-1;j[g]=(e+0.02*f)/1.02;e=j[g];j[g]*=3.5}h.type="brown";return h}();p5.Noise.prototype.setType=function(f){switch(f){case"white":this.buffer=b;break;case"pink":this.buffer=a;break;case"brown":this.buffer=c;break;default:this.buffer=b}if(this.started){var e=d.audiocontext.currentTime;this.stop(e);this.start(e+0.01)}};p5.Noise.prototype.getType=function(){return this.buffer.type};p5.Noise.prototype.start=function(){if(this.started){this.stop()}this.noise=d.audiocontext.createBufferSource();this.noise.buffer=this.buffer;this.noise.loop=true;this.noise.connect(this.output);var e=d.audiocontext.currentTime;this.noise.start(e);this.started=true};p5.Noise.prototype.stop=function(){var e=d.audiocontext.currentTime;if(this.noise){this.noise.stop(e);this.started=false}};p5.Noise.prototype.dispose=function(){var e=d.audiocontext.currentTime;if(this.noise){this.noise.disconnect();this.stop(e)}if(this.output){this.output.disconnect()}if(this.panner){this.panner.disconnect()}this.output=null;this.panner=null;this.buffer=null;this.noise=null}}(master);var audioin;audioin=function(){var a=master;p5.AudioIn=function(){this.input=a.audiocontext.createGain();this.output=a.audiocontext.createGain();this.stream=null;this.mediaStream=null;this.currentSource=0;this.enabled=false;this.amplitude=new p5.Amplitude();this.output.connect(this.amplitude.input);if(typeof window.MediaStreamTrack==="undefined"){window.alert("This browser does not support MediaStreamTrack")}else{if(typeof window.MediaStreamTrack.getSources!=="undefined"){window.MediaStreamTrack.getSources(this._gotSources)}else{}}a.soundArray.push(this)};p5.AudioIn.prototype.start=function(){var b=this;if(a.inputSources[b.currentSource]){var c=a.inputSources[b.currentSource].id;var d={audio:{optional:[{sourceId:c}]}};navigator.getUserMedia(d,this._onStream=function(e){b.stream=e;b.enabled=true;b.mediaStream=a.audiocontext.createMediaStreamSource(e);b.mediaStream.connect(b.output);b.amplitude.setInput(b.output)},this._onStreamError=function(e){console.error(e)})}else{window.navigator.getUserMedia({audio:true},this._onStream=function(e){b.stream=e;b.enabled=true;b.mediaStream=a.audiocontext.createMediaStreamSource(e);b.mediaStream.connect(b.output);b.amplitude.setInput(b.output)},this._onStreamError=function(e){console.error(e)})}};p5.AudioIn.prototype.stop=function(){if(this.stream){this.stream.stop()}};p5.AudioIn.prototype.connect=function(b){if(b){if(b.hasOwnProperty("input")){this.output.connect(b.input)}else{if(b.hasOwnProperty("analyser")){this.output.connect(b.analyser)}else{this.output.connect(b)}}}else{this.output.connect(a.input)}};p5.AudioIn.prototype.disconnect=function(b){this.output.disconnect(b);this.output.connect(this.amplitude.input)};p5.AudioIn.prototype.getLevel=function(b){if(b){this.amplitude.smoothing=b}return this.amplitude.getLevel()};p5.AudioIn.prototype._gotSources=function(c){for(var b=0;b!==c.length;b++){var d=c[b];if(d.kind==="audio"){a.inputSources.push(d)}}};p5.AudioIn.prototype.amp=function(c,b){if(b){var e=b||0;var d=this.output.gain.value;this.output.gain.cancelScheduledValues(a.audiocontext.currentTime);this.output.gain.setValueAtTime(d,a.audiocontext.currentTime);this.output.gain.linearRampToValueAtTime(c,e+a.audiocontext.currentTime)}else{this.output.gain.cancelScheduledValues(a.audiocontext.currentTime);this.output.gain.setValueAtTime(c,a.audiocontext.currentTime)}};p5.AudioIn.prototype.listSources=function(){console.log("input sources: ");console.log(a.inputSources);if(a.inputSources.length>0){return a.inputSources}else{return"This browser does not support MediaStreamTrack.getSources()"}};p5.AudioIn.prototype.setSource=function(c){var b=this;if(a.inputSources.length>0&&c<a.inputSources.length){b.currentSource=c;console.log("set source to "+a.inputSources[b.currentSource].id)}else{console.log("unable to set input source")}};p5.AudioIn.prototype.dispose=function(){this.stop();if(this.output){this.output.disconnect()}if(this.amplitude){this.amplitude.disconnect()}this.amplitude=null;this.output=null}}(master);var filter;filter=function(){var a=master;p5.Filter=function(b){this.ac=a.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this.biquad=this.ac.createBiquadFilter();this.input.connect(this.biquad);this.biquad.connect(this.output);this.connect();if(b){this.setType(b)}};p5.Filter.prototype.process=function(d,c,b){d.connect(this.input);this.set(c,b)};p5.Filter.prototype.set=function(d,b,c){if(d){this.freq(d,c)}if(b){this.res(b,c)}};p5.Filter.prototype.freq=function(e,d){var b=this;var c=d||0;if(e<=0){e=1}if(typeof e==="number"){b.biquad.frequency.value=e;b.biquad.frequency.cancelScheduledValues(this.ac.currentTime+0.01+c);b.biquad.frequency.exponentialRampToValueAtTime(e,this.ac.currentTime+0.02+c)}else{if(e){e.connect(this.biquad.frequency)}}return b.biquad.frequency.value};p5.Filter.prototype.res=function(d,e){var b=this;var c=e||0;if(typeof d=="number"){b.biquad.Q.value=d;b.biquad.Q.cancelScheduledValues(b.ac.currentTime+0.01+c);b.biquad.Q.linearRampToValueAtTime(d,b.ac.currentTime+0.02+c)}else{if(d){freq.connect(this.biquad.Q)}}return b.biquad.Q.value};p5.Filter.prototype.setType=function(b){this.biquad.type=b};p5.Filter.prototype.amp=function(c,f,d){var f=f||0;var d=d||0;var b=a.audiocontext.currentTime;var e=this.output.gain.value;this.output.gain.cancelScheduledValues(b);this.output.gain.linearRampToValueAtTime(e,b+d+0.001);this.output.gain.linearRampToValueAtTime(c,b+d+f+0.001)};p5.Filter.prototype.connect=function(c){var b=c||p5.soundOut.input;this.output.connect(b)};p5.Filter.prototype.disconnect=function(){this.output.disconnect()};p5.LowPass=function(){p5.Filter.call(this,"lowpass")};p5.LowPass.prototype=Object.create(p5.Filter.prototype);p5.HighPass=function(){p5.Filter.call(this,"highpass")};p5.HighPass.prototype=Object.create(p5.Filter.prototype);p5.BandPass=function(){p5.Filter.call(this,"bandpass")};p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(master);var delay;delay=function(){var b=master;var a=filter;p5.Delay=function(){this.ac=b.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this._split=this.ac.createChannelSplitter(2);this._merge=this.ac.createChannelMerger(2);this._leftGain=this.ac.createGain();this._rightGain=this.ac.createGain();this.leftDelay=this.ac.createDelay();this.rightDelay=this.ac.createDelay();this._leftFilter=new p5.Filter();this._rightFilter=new p5.Filter();this._leftFilter.disconnect();this._rightFilter.disconnect();this.lowPass=this._leftFilter;this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._leftFilter.biquad.Q.setValueAtTime(0.3,this.ac.currentTime);this._rightFilter.biquad.Q.setValueAtTime(0.3,this.ac.currentTime);this.input.connect(this._split);this.leftDelay.connect(this._leftGain);this.rightDelay.connect(this._rightGain);this._leftGain.connect(this._leftFilter.input);this._rightGain.connect(this._rightFilter.input);this._merge.connect(this.output);this.output.connect(p5.soundOut.input);this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this.setType(0);this._maxDelay=this.leftDelay.delayTime.maxValue};p5.Delay.prototype.process=function(h,c,e,g){var d=e||0;var f=c||0;if(d>=1){throw new Error("Feedback value will force a positive feedback loop.")}if(f>=this._maxDelay){throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.")}h.connect(this.input);this.leftDelay.delayTime.setValueAtTime(f,this.ac.currentTime);this.rightDelay.delayTime.setValueAtTime(f,this.ac.currentTime);this._leftGain.gain.setValueAtTime(d,this.ac.currentTime);this._rightGain.gain.setValueAtTime(d,this.ac.currentTime);if(g){this._leftFilter.freq(g);this._rightFilter.freq(g)}};p5.Delay.prototype.delayTime=function(c){if(typeof c!=="number"){c.connect(this.leftDelay.delayTime);c.connect(this.rightDelay.delayTime)}else{this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime);this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime);this.leftDelay.delayTime.linearRampToValueAtTime(c,this.ac.currentTime);this.rightDelay.delayTime.linearRampToValueAtTime(c,this.ac.currentTime)}};p5.Delay.prototype.feedback=function(c){if(typeof c!=="number"){c.connect(this._leftGain.gain);c.connect(this._rightGain.gain)}else{if(c>=1){throw new Error("Feedback value will force a positive feedback loop.")}else{this._leftGain.gain.exponentialRampToValueAtTime(c,this.ac.currentTime);this._rightGain.gain.exponentialRampToValueAtTime(c,this.ac.currentTime)}}};p5.Delay.prototype.filter=function(d,c){this._leftFilter.set(d,c);this._rightFilter.set(d,c)};p5.Delay.prototype.setType=function(c){if(c===1){c="pingPong"}this._split.disconnect();this._leftFilter.disconnect();this._rightFilter.disconnect();this._split.connect(this.leftDelay,0);this._split.connect(this.rightDelay,1);switch(c){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type);this._leftFilter.output.connect(this._merge,0,0);this._rightFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.rightDelay);this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0);this._leftFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.leftDelay);this._leftFilter.output.connect(this.rightDelay)}};p5.Delay.prototype.amp=function(d,g,e){var g=g||0;var e=e||0;var c=b.audiocontext.currentTime;var f=this.output.gain.value;this.output.gain.cancelScheduledValues(c);this.output.gain.linearRampToValueAtTime(f,c+e+0.001);this.output.gain.linearRampToValueAtTime(d,c+e+g+0.001)};p5.Delay.prototype.connect=function(d){var c=d||p5.soundOut.input;this.output.connect(c)};p5.Delay.prototype.disconnect=function(){this.output.disconnect()}}(master,filter);var reverb;reverb=function(){var a=master;p5.Reverb=function(){this.ac=a.audiocontext;this.convolverNode=this.ac.createConvolver();this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=0.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.output);this._seconds=3;this._decay=2;this._reverse=false;this._buildImpulse();this.connect();a.soundArray.push(this)};p5.Reverb.prototype.process=function(f,e,d,c){f.connect(this.input);var b=false;if(e){this._seconds=e;b=true}if(d){this._decay=d}if(c){this._reverse=c}if(b){this._buildImpulse()}};p5.Reverb.prototype.set=function(e,d,c){var b=false;if(e){this._seconds=e;b=true}if(d){this._decay=d}if(c){this._reverse=c}if(b){this._buildImpulse()}};p5.Reverb.prototype.amp=function(c,f,d){var f=f||0;var d=d||0;var b=a.audiocontext.currentTime;var e=this.output.gain.value;this.output.gain.cancelScheduledValues(b);this.output.gain.linearRampToValueAtTime(e,b+d+0.001);this.output.gain.linearRampToValueAtTime(c,b+d+f+0.001)};p5.Reverb.prototype.connect=function(c){var b=c||p5.soundOut.input;this.output.connect(b.input?b.input:b)};p5.Reverb.prototype.disconnect=function(){this.output.disconnect()};p5.Reverb.prototype._buildImpulse=function(){var d=this.ac.sampleRate;var f=d*this._seconds;var e=this._decay;var h=this.ac.createBuffer(2,f,d);var b=h.getChannelData(0);var g=h.getChannelData(1);var j,c;for(c=0;c<f;c++){j=this.reverse?f-c:c;b[c]=(Math.random()*2-1)*Math.pow(1-j/f,e);g[c]=(Math.random()*2-1)*Math.pow(1-j/f,e)}this.convolverNode.buffer=h};p5.Reverb.prototype.dispose=function(){this.convolverNode.buffer=null;this.convolverNode=null;if(typeof this.output!=="undefined"){this.output.disconnect();this.output=null}if(typeof this.panner!=="undefined"){this.panner.disconnect();this.panner=null}};p5.Convolver=function(b,c){this.ac=a.audiocontext;this.convolverNode=this.ac.createConvolver();this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=0.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.output);if(b){this.impulses=[];this._loadBuffer(b,c)}else{this._seconds=3;this._decay=2;this._reverse=false;this._buildImpulse()}this.connect();a.soundArray.push(this)};p5.Convolver.prototype=Object.create(p5.Reverb.prototype);p5.prototype.registerPreloadMethod("createConvolver");p5.prototype.createConvolver=function(c,d){if(window.location.origin.indexOf("file://")>-1){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}var b=new p5.Convolver(c,d);b.impulses=[];return b};p5.Convolver.prototype._loadBuffer=function(d,e){d=p5.prototype._checkFileFormats(d);var c=new XMLHttpRequest();c.open("GET",d,true);c.responseType="arraybuffer";var b=this;c.onload=function(){var f=p5.prototype.getAudioContext();f.decodeAudioData(c.response,function(i){var g={};var h=d.split("/");g.name=h[h.length-1];g.audioBuffer=i;b.impulses.push(g);b.convolverNode.buffer=g.audioBuffer;if(e){e(g)}})};c.send()};p5.Convolver.prototype.set=null;p5.Convolver.prototype.process=function(b){b.connect(this.input)};p5.Convolver.prototype.impulses=[];p5.Convolver.prototype.addImpulse=function(b,c){if(window.location.origin.indexOf("file://")>-1){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}this._loadBuffer(b,c)};p5.Convolver.prototype.resetImpulse=function(b,c){if(window.location.origin.indexOf("file://")>-1){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}this.impulses=[];this._loadBuffer(b,c)};p5.Convolver.prototype.toggleImpulse=function(c){if(typeof c==="number"&&c<this.impulses.length){this.convolverNode.buffer=this.impulses[c].audioBuffer}if(typeof c==="string"){for(var b=0;b<this.impulses.length;b++){if(this.impulses[b].name===c){this.convolverNode.buffer=this.impulses[b].audioBuffer;break}}}};p5.Convolver.prototype.dispose=function(){for(var b in this.impulses){this.impulses[b]=null}this.convolverNode.disconnect();this.concolverNode=null;if(typeof this.output!=="undefined"){this.output.disconnect();this.output=null}if(typeof this.panner!=="undefined"){this.panner.disconnect();this.panner=null}}}(master,sndcore);var Tone_core_Clock;Tone_core_Clock=function(a){a.Clock=function(b,c){this._oscillator=null;this._jsNode=this.context.createScriptProcessor(this.bufferSize,1,1);this._jsNode.onaudioprocess=this._processBuffer.bind(this);this._controlSignal=new a.Signal(1);this._upTick=false;this.tick=this.defaultArg(c,function(){});this._jsNode.noGC();this.setRate(b)};a.extend(a.Clock);a.Clock.prototype.setRate=function(b,d){var c=this.secondsToFrequency(this.toSeconds(b));if(!d){this._controlSignal.cancelScheduledValues(0);this._controlSignal.setValue(c)}else{this._controlSignal.exponentialRampToValueNow(c,d)}};a.Clock.prototype.getRate=function(){return this._controlSignal.getValue()};a.Clock.prototype.start=function(c){this._oscillator=this.context.createOscillator();this._oscillator.type="square";this._oscillator.connect(this._jsNode);this._controlSignal.connect(this._oscillator.frequency);this._upTick=false;var b=this.toSeconds(c);this._oscillator.start(b);this._oscillator.onended=function(){}};a.Clock.prototype.stop=function(d,c){var b=this.toSeconds(d);this._oscillator.onended=c;this._oscillator.stop(b)};a.Clock.prototype._processBuffer=function(g){var c=this.defaultArg(g.playbackTime,this.now());var j=this._jsNode.bufferSize;var f=g.inputBuffer.getChannelData(0);var h=this._upTick;var b=this;for(var d=0;d<j;d++){var e=f[d];if(e>0&&!h){h=true;setTimeout(function(){var i=c+b.samplesToSeconds(d+j*2);return function(){b.tick(i)}}(),0)}else{if(e<0&&h){h=false}}}this._upTick=h};a.Clock.prototype.dispose=function(){this._jsNode.disconnect();this._controlSignal.dispose();if(this._oscillator){this._oscillator.onended();this._oscillator.disconnect()}this._jsNode.onaudioprocess=function(){};this._jsNode=null;this._controlSignal=null;this._oscillator=null};return a.Clock}(Tone_core_Tone);var metro;metro=function(){var c=master;var e=Tone_core_Clock;var a=c.audiocontext;p5.Metro=function(){this.clock=new e(a.sampleRate,this.ontick.bind(this));this.syncedParts=[];this.bpm=120;this._init();this.tickCallback=function(){}};var d=0;var b=0;p5.Metro.prototype.ontick=function(m){var o=m-d;var p=m-c.audiocontext.currentTime;if(o-b<=-0.02){return}else{d=m;for(var k in this.syncedParts){var g=this.syncedParts[k];g.incrementStep(p);for(var h in g.phrases){var l=g.phrases[h];var f=l.sequence;var n=this.metroTicks%f.length;if(f[n]!==0&&(this.metroTicks<f.length||!l.looping)){l.callback(f[n],p)}}}this.metroTicks+=1;this.tickCallback(p)}};p5.Metro.prototype.setBPM=function(h,i){var g=60/(h*this.tatums);b=g;var f=i||0;this.clock.setRate(g,i+c.audiocontext.currentTime);this.bpm=h};p5.Metro.prototype.getBPM=function(f){return this.clock.getRate()/this.tatums*60};p5.Metro.prototype._init=function(){this.metroTicks=0};p5.Metro.prototype.resetSync=function(f){this.syncedParts=[f]};p5.Metro.prototype.pushSync=function(f){this.syncedParts.push(f)};p5.Metro.prototype.start=function(g){var f=g||0;this.clock.start(f);this.setBPM(this.bpm)};p5.Metro.prototype.stop=function(g){var f=g||0;if(this.clock._oscillator){this.clock.stop(f)}};p5.Metro.prototype.beatLength=function(f){this.tatums=1/f/4}}(master,Tone_core_Clock);var looper;looper=function(){var c=master;var b=120;p5.prototype.setBPM=function(e,f){b=e;for(var d in c.parts){c.parts[d].setBPM(b,f)}};p5.Phrase=function(d,f,e){this.phraseStep=0;this.name=d;this.callback=f;this.sequence=e};p5.Part=function(d,e){this.length=d||0;this.partStep=0;this.phrases=[];this.looping=false;this.isPlaying=false;this.onended=function(){this.stop()};this.tatums=e||0.0625;this.metro=new p5.Metro();this.metro._init();this.metro.beatLength(this.tatums);this.metro.setBPM(b);c.parts.push(this);this.callback=function(){}};p5.Part.prototype.setBPM=function(d,e){this.metro.setBPM(d,e)};p5.Part.prototype.getBPM=function(){return this.metro.getBPM()};p5.Part.prototype.start=function(e){if(!this.isPlaying){this.isPlaying=true;this.metro.resetSync(this);var d=e||0;this.metro.start(d)}};p5.Part.prototype.loop=function(e){this.looping=true;this.onended=function(){this.partStep=0};var d=e||0;this.start(d)};p5.Part.prototype.noLoop=function(){this.looping=false;this.onended=function(){this.stop()}};p5.Part.prototype.stop=function(d){this.partStep=0;this.pause(d)};p5.Part.prototype.pause=function(e){this.isPlaying=false;var d=e||0;this.metro.stop(d)};p5.Part.prototype.addPhrase=function(d,g,f){var e;if(arguments.length===3){e=new p5.Phrase(d,g,f)}else{if(arguments[0] instanceof p5.Phrase){e=arguments[0]}else{throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase"}}this.phrases.push(e);if(e.sequence.length>this.length){this.length=e.sequence.length}};p5.Part.prototype.removePhrase=function(d){for(var e in this.phrases){if(this.phrases[e].name===d){this.phrases.split(e,1)}}};p5.Part.prototype.getPhrase=function(d){for(var e in this.phrases){if(this.phrases[e].name===d){return this.phrases[e]}}};p5.Part.prototype.replaceSequence=function(d,f){for(var e in this.phrases){if(this.phrases[e].name===d){this.phrases[e].sequence=f}}};p5.Part.prototype.incrementStep=function(d){if(this.partStep<this.length-1){this.callback(d);this.partStep+=1}else{if(this.looping){this.callback(d)}this.onended();this.partStep=0}};p5.Part.prototype.onStep=function(d){this.callback=d};p5.Score=function(){this.parts=[];this.currentPart=0;var d=this;for(var e in arguments){this.parts[e]=arguments[e];this.parts[e].nextPart=this.parts[e+1];this.parts[e].onended=function(){d.resetPart(e);a(d)}}this.looping=false};p5.Score.prototype.onended=function(){if(this.looping){this.parts[0].start()}else{this.parts[this.parts.length-1].onended=function(){this.stop();this.resetParts()}}this.currentPart=0};p5.Score.prototype.start=function(){this.parts[this.currentPart].start();this.scoreStep=0};p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop();this.currentPart=0;this.scoreStep=0};p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()};p5.Score.prototype.loop=function(){this.looping=true;this.start()};p5.Score.prototype.noLoop=function(){this.looping=false};p5.Score.prototype.resetParts=function(){for(var d in this.parts){this.resetPart(d)}};p5.Score.prototype.resetPart=function(d){this.parts[d].stop();this.parts[d].partStep=0;for(var e in this.parts[d].phrases){this.parts[d].phrases[e].phraseStep=0}};p5.Score.prototype.setBPM=function(e,f){for(var d in this.parts){this.parts[d].setBPM(e,f)}};function a(d){d.currentPart++;if(d.currentPart>=d.parts.length){d.scoreStep=0;d.onended()}else{d.scoreStep=0;d.parts[d.currentPart-1].stop();d.parts[d.currentPart].start()}}}(master);var soundRecorder;soundRecorder=function(){var d=master;var c=d.audiocontext;p5.SoundRecorder=function(){this.input=c.createGain();this.output=c.createGain();this.recording=false;this.bufferSize=1024;this._channels=2;this._clear();this._jsNode=c.createScriptProcessor(this.bufferSize,this._channels,2);this._jsNode.onaudioprocess=this._audioprocess.bind(this);this._callback=function(){};this._jsNode.connect(p5.soundOut._silentNode);this.setInput();d.soundArray.push(this)};p5.SoundRecorder.prototype.setInput=function(e){this.input.disconnect();this.input=null;this.input=c.createGain();this.input.connect(this._jsNode);this.input.connect(this.output);if(e){e.connect(this.input)}else{p5.soundOut.output.connect(this.input)}};p5.SoundRecorder.prototype.record=function(f,e,g){this.recording=true;if(e){this.sampleLimit=Math.round(e*c.sampleRate)}if(f&&g){this._callback=function(){this.buffer=this._getBuffer();f.setBuffer(this.buffer);g()}}else{if(f){this._callback=function(){this.buffer=this._getBuffer();f.setBuffer(this.buffer)}}}};p5.SoundRecorder.prototype.stop=function(){this.recording=false;this._callback();this._clear()};p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[];this._rightBuffers=[];this.recordedSamples=0;this.sampleLimit=null};p5.SoundRecorder.prototype._audioprocess=function(f){if(this.recording===false){return}else{if(this.recording===true){if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit){this.stop()}else{var g=f.inputBuffer.getChannelData(0);var e=f.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(g));this._rightBuffers.push(new Float32Array(e));this.recordedSamples+=this.bufferSize}}}};p5.SoundRecorder.prototype._getBuffer=function(){var e=[];e.push(this._mergeBuffers(this._leftBuffers));e.push(this._mergeBuffers(this._rightBuffers));return e};p5.SoundRecorder.prototype._mergeBuffers=function(j){var e=new Float32Array(this.recordedSamples);var k=0;var g=j.length;for(var h=0;h<g;h++){var f=j[h];e.set(f,k);k+=f.length}return e};p5.SoundRecorder.prototype.dispose=function(){this._clear();this._callback=function(){};if(this.input){this.input.disconnect()}this.input=null;this._jsNode=null};p5.prototype.saveSound=function(e,f){var m=e.buffer.getChannelData(0);var g=e.buffer.getChannelData(1);var p=a(m,g);var h=new ArrayBuffer(44+p.length*2);var o=new DataView(h);b(o,0,"RIFF");o.setUint32(4,44+p.length*2,true);b(o,8,"WAVE");b(o,12,"fmt ");o.setUint32(16,16,true);o.setUint16(20,1,true);o.setUint16(22,2,true);o.setUint32(24,44100,true);o.setUint32(28,44100*4,true);o.setUint16(32,4,true);o.setUint16(34,16,true);b(o,36,"data");o.setUint32(40,p.length*2,true);var n=p.length;var l=44;var k=1;for(var j=0;j<n;j++){o.setInt16(l,p[j]*(32767*k),true);l+=2}p5.prototype.writeFile([o],f,"wav")};function a(g,f){var i=g.length+f.length;var e=new Float32Array(i);var j=0;for(var h=0;h<i;){e[h++]=g[j];e[h++]=f[j];j++}return e}function b(e,j,g){var f=g.length;for(var h=0;h<f;h++){e.setUint8(j+h,g.charCodeAt(h))}}}(sndcore,master);var src_app;src_app=function(){var a=sndcore;return a}(sndcore,master,helpers,panner,soundfile,amplitude,fft,signal,oscillator,env,pulse,noise,audioin,filter,delay,reverb,metro,looper,soundRecorder);