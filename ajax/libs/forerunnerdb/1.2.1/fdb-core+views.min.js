fdb-core+views.js:1: WARNING - Suspicious code. The result of the 'not' operator is not being used.
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.ForerunnerDB=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
^

0 error(s), 1 warning(s)
function m(D){throw D;}var n=void 0,r=!0,x=!1;
function A(){return function q(u,a,k){function e(f,h){if(!a[f]){if(!u[f]){var b="function"==typeof require&&require;if(!h&&b)return b(f,r);if(c)return c(f,r);b=Error("Cannot find module '"+f+"'");m((b.code="MODULE_NOT_FOUND",b))}b=a[f]={g:{}};u[f][0].call(b.g,function(b){var c=u[f][1][b];return e(c?c:b)},b,b.g,q,u,a,k)}return a[f].g}for(var c="function"==typeof require&&require,f=0;f<k.length;f++)e(k[f]);return e}({1:[function(q,u){var a=q("../lib/Core");q("../lib/View");u.g=a},{"../lib/Core":3,"../lib/View":12}],
2:[function(q,u){function a(b){this.e.apply(this,arguments)}var k,e,c,f,g,h;k=q("./Shared");a.prototype.e=function(b){this.d="_id";this.s=new g("primary");this.ea=new g("primaryCrc");this.ba=new g("crcLookup");this.j=b;this.a=[];this.Wa=[];this.da=new f;this.q=0;this.c={};this.J={f:[],update:[],remove:[],F:[]};this.ca={f:100,update:100,remove:100,F:100};this.Va={f:1,update:1,remove:1,F:1};this.Ga(this)};k.p.Gb=a;c=q("./Overload");f=q("./Metrics");g=q("./KeyValueStore");h=q("./Path");q("./Index");
q("./Crc");e=k.p.ra;a.prototype.debug=new c([function(){return this.c.all},function(b){if(b!==n){if("boolean"===typeof b){this.c.all=b;for(var d=0;d<this.D.length;d++)this.D[d].debug(b);return this}return this.c[b]||this.h&&this.h.c&&this.h.c[b]||this.c.all}return this.c.all},function(b,d){if(b!==n){if(d!==n){this.c[b]=d;for(var c=0;c<this.D.length;c++)this.D[c].debug(b,d);return this}return this.c[b]||this.h&&this.h.c&&this.h.c[b]}return this.c.all}]);a.prototype.name=function(b){return b!==n?(this.j=
b,this):this.j};a.prototype.t=function(b,d){this.r=this.r||{};if(b in this.r){if(this.r[b]["*"]){var c=this.r[b]["*"],w=c.length,a;for(a=0;a<w;a++)c[a].apply(this,Array.prototype.slice.call(arguments,1))}if(d instanceof Array&&d[0]&&d[0][this.d]){var c=this.r[b],h,e,w=d.length;for(a=0;a<w;a++)if(c[d[a][this.d]]){h=c[d[a][this.d]].length;for(e=0;e<h;e++)c[d[a][this.d]][e].apply(this,Array.prototype.slice.call(arguments,1))}}}return this};a.prototype.primaryKey=function(b){return b!==n?(this.d=b,this.s.primaryKey(b),
this.Ea(),this):this.d};a.prototype.ab=function(b,d){this.t("insert",b,d)};a.prototype.cb=function(b){this.t("update",b)};a.prototype.bb=function(b){this.t("remove",b)};a.prototype.db=function(b){return b!==n?(this.h=b,this):this.h};a.prototype.setData=function(b,d,c){if(b){var w=this.da.create("setData");w.start();b instanceof Array||(b=[b]);w.time("transformIn");b=this.na(b);w.time("transformIn");var a=this.a;this.a=[];b.length&&(this.a=this.a.concat(b));w.time("_rebuildPrimaryKeyIndex");this.Ea(d);
w.time("_rebuildPrimaryKeyIndex");w.stop();this.t("setData",this.a,a)}c&&c(x);return this};a.prototype.Ea=function(b){var d=b&&b.sb!==n?b.sb:r;b=b&&b.Eb!==n?b.Eb:r;var c,w,a,h=this.s,e=this.ea,f=this.ba,g=this.d,t;h.truncate();e.truncate();f.truncate();c=this.a;for(w=c.length;w--;)a=c[w],d&&this.wa(a),b?h.R(a[g],a)||m("Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+a[this.d]):(t=JSON.stringify(a),h.set(a[g],
a),e.set(a[g],t),f.set(t,a))};a.prototype.wa=function(b){b[this.d]===n&&(b[this.d]=this.Oa())};a.prototype.truncate=function(){this.t("truncate",this.a);this.a.length=0;this.W("change");return this};a.prototype.F=function(b,d){if(b){var c=this.J.F,a=this.ca.F,h={},e;if(b instanceof Array){if(b.length>a){this.J.F=c.concat(b);this.la("upsert",d);return}h=[];for(c=0;c<b.length;c++)h.push(this.F(b[c]));d&&d();return h}b[this.d]?(e={},e[this.d]=b[this.d],this.count(e)?h.ka="update":h.ka="insert"):h.ka=
"insert";switch(h.ka){case "insert":h.result=this.f(b);break;case "update":h.result=this.update(e,b)}return h}d&&d()};a.prototype.update=function(b,d,c){function a(w){if(d&&d[f]!==n&&d[f]!=w[f]){h.s.$(w[f]);var e=h.L(w,d,b,c,"");if(h.s.R(w[f],w))return e;m("Primary key violation in update! Key violated: "+w[f])}return h.L(w,d,b,c,"")}d=this.m(d);d=this.na(d);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var h=this,e=this.da.create("update"),f=this.d,g,
v,t=this.D;e.start();e.time("Retrieve documents to update");g=this.find(b,{m:x});e.time("Retrieve documents to update");if(g.length&&(e.time("Update documents"),v=g.filter(a),e.time("Update documents"),v.length)){if(t&&t.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());e.time("Inform views of update");for(g=0;g<t.length;g++)t[g].update(b,d);e.time("Inform views of update")}this.cb(v);this.W("change",{type:"update",data:v})}e.stop();return v||[]};a.prototype.L=
function(b,d,c,a,e){d=this.m(d);e=e||"";"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));var f=x,g=x,s,v,t,l,p;for(l in d)if(d.hasOwnProperty(l)){s=x;if("$"===l.substr(0,1))switch(l){case "$inc":s=r;for(p in d[l])d[l].hasOwnProperty(p)&&"$"!==p.substr(0,1)&&("number"===typeof b[p]?(this.lb(b,p,d[l][p]),f=r):m("Cannot increment field that is not a number! ("+p+")!"));break;case "$push":s=r;for(p in d[l])d[l].hasOwnProperty(p)&&"$"!==p.substr(0,1)&&(b[p]instanceof Array?(this.Ia(b[p],d[l][p]),f=r):m("Cannot push to a key that is not an array! ("+
p+")!"));break;case "$addToSet":s=r;for(p in d[l])if(d[l].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array){v=b[p];var k;t=v.length;var q,g=r;k=a&&a.Fb;var u,y;k&&k.key?(u=x,y=new h(k.key),q=y.value(d[l][p])[0]):(q=JSON.stringify(d[l][p]),u=r);for(k=0;k<t;k++)if(u){if(JSON.stringify(v[k])===q){g=x;break}}else if(q===y.value(v[k])[0]){g=x;break}g&&(this.Ia(b[p],d[l][p]),f=r)}else m("Cannot push to a key that is not an array! ("+p+")!");break;case "$splicePush":s=r;for(p in d[l])d[l].hasOwnProperty(p)&&
"$"!==p.substr(0,1)&&(b[p]instanceof Array?(v=d[l].pa,v!==n?(delete d[l][p].pa,this.ob(b[p],v,d[l][p]),f=r):m("Cannot splicePush without a $index integer value!")):m("Cannot splicePush with a key that is not an array! ("+p+")!"));break;case "$move":s=r;for(p in d[l])if(d[l].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array)for(t=0;t<b[p].length;t++){if(this.l(b[p][t],d[l][p])){v=d[l].pa;v!==n?(this.nb(b[p],t,v),f=r):m("Cannot move without a $index integer value!");break}}else m("Cannot pull from a key that is not an array! ("+
p+")!");break;case "$pull":for(p in s=r,d[l])if(d[l].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array){v=[];for(t=0;t<b[p].length;t++)this.l(b[p][t],d[l][p])&&v.push(t);for(t=v.length;t--;)this.mb(b[p],v[t]),f=r}else m("Cannot pull from a key that is not an array! ("+p+")!")}if(".$"===l.substr(l.length-2,2)&&(s=r,l=l.substr(0,l.length-2),g=new h(e+"."+l),b[l]&&b[l]instanceof Array&&b[l].length)){v=[];for(t=0;t<b[l].length;t++)this.l(b[l][t],g.value(c)[0])&&v.push(t);for(t=0;t<v.length;t++)(g=
this.L(b[l][v[t]],d[l+".$"],c,a,e+"."+l))&&(f=r)}if(!s)if("object"===typeof d[l])if(null!==b[l]&&"object"===typeof b[l])if(s=b[l]instanceof Array,v=d[l]instanceof Array,s||v)if(!v&&s)for(t=0;t<b[l].length;t++)(g=this.L(b[l][t],d[l],c,a,e+"."+l))&&(f=r);else this.ha(b,l,d[l]),f=r;else(g=this.L(b[l],d[l],c,a,e+"."+l))&&(f=r);else this.ha(b,l,d[l]),f=r;else b[l]!==d[l]&&(this.ha(b,l,d[l]),f=r)}return f};a.prototype.ha=function(b,d,c){this.q?($.A(b).setProperty(d,c),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+
d+'" for collection "'+this.name()+'"')):(b[d]=c,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+d+'" for collection "'+this.name()+'"'))};a.prototype.nb=function(b,d,c){this.q?($.A(b).move(d,c),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+d+'" to "'+c+'" for collection "'+this.name()+'"')):(b.splice(c,0,b.splice(d,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+
d+'" to "'+c+'" for collection "'+this.name()+'"'))};a.prototype.ob=function(b,d,c){b.length>d?this.q?$.A(b).f(d,c):b.splice(d,0,c):this.q?$.A(b).f(c):b.push(c)};a.prototype.Ia=function(b,d){this.q?$.A(b).f(d):b.push(d)};a.prototype.mb=function(b,d){this.q?$.A(b).remove(d):b.splice(d,1)};a.prototype.lb=function(b,d,c){this.q?$.A(b).setProperty(d,b[d]+c):b[d]+=c};a.prototype.remove=function(b){var d,c,a=this.D,e;if(b instanceof Array){a=[];for(d=0;d<b.length;d++)a.push(this.remove(b[d]));return a}d=
this.find(b,{m:x});if(d.length){for(e=0;e<d.length;e++)c=d[e],this.eb(c),c=this.a.indexOf(c),this.q?$.A(this.a).remove(c):this.a.splice(c,1);if(a&&a.length)for(e=0;e<a.length;e++)a[e].remove(b);this.bb(d);this.W("change",{type:"remove",data:d})}return d};a.prototype.W=function(){var b=this,d;!this.$a&&(!this.h||this.h&&!this.h.$a)?(d=arguments,this.ta&&clearTimeout(this.ta),this.ta=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+d[0]);b.t.apply(b,d)},100)):this.t.apply(this,
arguments)};a.prototype.la=function(b,d){var c=this.J[b],a=this.ca[b],e=this.Va[b];if(c.length){var h=this;c.length&&(c=c.length>a?c.splice(0,a):c.splice(0,c.length),this[b](c));setTimeout(function(){h.la(b,d)},e)}else d&&d()};a.prototype.f=function(b,d,c){"function"===typeof d?(c=d,d=this.a.length):d===n&&(d=this.a.length);b=this.na(b);return this.za(b,d,c)};a.prototype.za=function(b,d,c){var a=this.J.f,e=this.ca.f,h=[],f=[],g=this.D;if(b instanceof Array){if(b.length>e){this.J.f=a.concat(b);this.la("insert",
c);return}for(e=0;e<b.length;e++)a=this.ya(b[e],d+e),a===r?h.push(b[e]):f.push({rb:b[e],reason:a})}else a=this.ya(b,d),a===r?h.push(b):f.push({rb:b,reason:a});if(g&&g.length)for(a=0;a<g.length;a++)g[a].f(b,d);this.ab(h,f);c&&c();this.W("change",{type:"insert",data:h});return{Wb:h,Vb:f}};a.prototype.ya=function(b,d){if(b){var c;this.wa(b);if(c=this.tb(b))return"Index violation in index: "+c;this.Ya(b);this.q?$.A(this.a).f(d,b):this.a.splice(d,0,b);return r}return"No document passed to insert"};a.prototype.Ya=
function(b){var d=this.T,c,a=JSON.stringify(b);this.s.R(b[this.d],b);this.ea.R(b[this.d],a);this.ba.R(a,b);for(c in d)d.hasOwnProperty(c)&&d[c].f(b)};a.prototype.eb=function(b){var d=this.T,c,a=JSON.stringify(b);this.s.$(b[this.d]);this.ea.$(b[this.d]);this.ba.$(a);for(c in d)d.hasOwnProperty(c)&&d[c].remove(b)};a.prototype.Bb=function(b){b=this.find(b,n);(new a).Ga(this).primaryKey(this.d).setData(b)};a.prototype.Ga=function(b){this.Qb=b;return this};a.prototype.m=function(b){return JSON.parse(JSON.stringify(b))};
a.prototype.find=function(b,d){function c(d){return e.l(d,b,"and")}b=b||{};d=d||{};d.m=d.m!==n?d.m:r;var a=this.da.create("find"),e=this,f,g=r,s,k,t,l,p,q,u,C,y,z=[];a.start();if(b){a.time("analyseQuery");f=this.Ua(b,d,a);a.time("analyseQuery");a.data("analysis",f);if(f.La&&f.Qa){a.time("joinReferences");for(k=0;k<f.ia.length;k++)l=f.ia[k],t=new h(f.Ma[l]),t=t.value(b)[0],this.h.V(f.ia[k]).Bb(t);a.time("joinReferences")}f.u.length&&(!d||d&&!d.$b)?(a.data("index.potential",f.u),a.data("index.used",
f.u[0].index),a.time("indexLookup"),s=f.u[0].z,a.time("indexLookup"),f.u[0].n.I===f.u[0].n.o&&(g=x)):a.N("usedIndex",x);g&&(s&&s.length?(f=s.length,a.time("tableScan: "+f),s=s.filter(c)):(f=this.a.length,a.time("tableScan: "+f),s=this.a.filter(c)),d.sort&&(a.time("sort"),s=this.sort(d.sort,s),a.time("sort")),a.time("tableScan: "+f));d.ja&&(s&&s.length>d.ja)&&(s.length=d.ja,a.data("limit",d.ja));d.m&&(a.time("decouple"),s=this.m(s),a.time("decouple"),a.data("flag.decouple",r));if(d.join){for(f=0;f<
d.join.length;f++)for(l in d.join[f])if(d.join[f].hasOwnProperty(l)){C=l;g=this.h.V(l);k=d.join[f][l];for(y=0;y<s.length;y++){q={};u=t=x;for(p in k)if(k.hasOwnProperty(p))if("$"===p.substr(0,1))switch(p){case "$as":C=k[p];break;case "$multi":t=k[p];break;case "$require":u=k[p]}else q[p]=(new h(k[p])).value(s[y])[0];q=g.find(q);!u||u&&q[0]?s[y][C]=t===x?q[0]:q:z.push(s[y])}}a.data("flag.join",r)}if(z.length){a.time("removalQueue");for(p=0;p<z.length;p++)l=s.indexOf(z[p]),-1<l&&s.splice(l,1);a.time("removalQueue")}if(d.transform){a.time("transform");
for(p=0;p<s.length;p++)s.splice(p,1,d.transform(s[p]));a.time("transform");a.data("flag.transform",r)}this.i&&this.C&&(a.time("transformOut"),s=this.Cb(s),a.time("transformOut"));a.data("results",s.length);a.stop()}else a.stop(),s=[];s.Pb=a;return s};a.prototype.transform=function(b){return b!==n?("object"===typeof b?(b.enabled!==n&&(this.i=b.enabled),b.G!==n&&(this.B=b.G),b.H!==n&&(this.C=b.H)):this.i=b===x?x:r,this):{enabled:this.i,G:this.B,H:this.C}};a.prototype.na=function(b){if(this.i&&this.B){if(b instanceof
Array){var d=[],c;for(c=0;c<b.length;c++)d[c]=this.B(b[c]);return d}return this.B(b)}return b};a.prototype.Cb=function(b){if(this.i&&this.C){if(b instanceof Array){var d=[],c;for(c=0;c<b.length;c++)d[c]=this.C(b[c]);return d}return this.C(b)}return b};a.prototype.sort=function(b,d){d=d||[];var c=[],a,e;for(a in b)b.hasOwnProperty(a)&&(e={},e[a]=b[a],e.Ta=a,c.push(e));return 2>c.length?this.fa(b,d):this.sa(c,d)};a.prototype.sa=function(b,d){var c=b.shift(),a,e,f=[];if(0<b.length){d=this.fa(c,d);a=
this.pb(c.Ta,d);for(e in a)a.hasOwnProperty(e)&&(c=[].concat(b),f=f.concat(this.sa(c,a[e])));return f}return this.fa(c,d)};a.prototype.fa=function(b,d){var c=new h,a=c.parse(b,r)[0];c.path(a.path);return d.sort(1===a.value?function(b,d){var a=c.value(b)[0],e=c.value(d)[0];return"string"===typeof a&&"string"===typeof e?a.localeCompare(e):a>e?1:a<e?-1:0}:function(b,d){var a=c.value(b)[0],e=c.value(d)[0];return"string"===typeof a&&"string"===typeof e?1===a.localeCompare(e)?-1:1:a>e?-1:a<e?1:0})};a.prototype.pb=
function(b,d){var c,a={};for(c=0;c<d.length;c++)a[d[c][b]]=a[d[c][b]]||[],a[d[c][b]].push(d[c]);return a};a.prototype.Ua=function(b,c,a){var e={Ra:[this.j],u:[],La:x,Qa:x,Ma:{},P:b,options:c},f,g=[],k=[],s,q,t,l,p;a.time("checkIndexes");b[this.d]!==n&&(a.time("checkIndexMatch: Primary Key"),s=new h,e.u.push({z:this.s.z(b,c),n:{Na:[this.d],o:1,I:s.Ja(b)},index:this.s}),a.time("checkIndexMatch: Primary Key"));for(p in this.xa)if(this.xa.hasOwnProperty(p)&&(q=this.xa[p],t=q.name(),a.time("checkIndexMatch: "+
t),s=q.match(b,c),l=q.z(b,c),0<s.o&&e.u.push({z:l,n:s,index:q}),a.time("checkIndexMatch: "+t),s.I===s.o))break;a.time("checkIndexes");1<e.u.length&&(a.time("findOptimalIndex"),e.u.sort(function(b,c){return b.n.I===b.n.o?-1:c.n.I===c.n.o?1:b.n.o===c.n.o?b.z.length-c.z.length:c.n.o-b.n.o}),a.time("findOptimalIndex"));if(c.join){e.La=r;for(a=0;a<c.join.length;a++)for(f in c.join[a])c.join[a].hasOwnProperty(f)&&(g.push(f),"$as"in c.join[a][f]?k.push(c.join[a][f].$as):k.push(f));for(f=0;f<k.length;f++)if(c=
this.Da(b,k[f],""))e.Ma[g[f]]=c,e.Qa=r;e.ia=g;e.Ra=e.Ra.concat(g)}return e};a.prototype.Da=function(b,c,a){for(var e in b)if(b.hasOwnProperty(e)){if(e===c)return a&&(a+="."),a+e;if("object"===typeof b[e])return a&&(a+="."),a+=e,this.Da(b[e],c,a)}return x};a.prototype.l=function(b,c,a){var e,f;e=typeof b;f=typeof c;var h=r,g;if(("string"===e||"number"===e)&&("string"===f||"number"===f))b!==c&&(h=x);else for(g in c)if(c.hasOwnProperty(g)){e=x;if("$"===g.substr(0,1))switch(g){case "$gt":if(b>c[g]){if("or"===
a)return r}else h=x;e=r;break;case "$gte":if(b>=c[g]){if("or"===a)return r}else h=x;e=r;break;case "$lt":if(b<c[g]){if("or"===a)return r}else h=x;e=r;break;case "$lte":if(b<=c[g]){if("or"===a)return r}else h=x;e=r;break;case "$exists":if(b===n!==c[g]){if("or"===a)return r}else h=x;e=r;break;case "$or":e=r;for(f=0;f<c[g].length;f++){if(this.l(b,c[g][f],"and"))return r;h=x}break;case "$and":e=r;for(f=0;f<c[g].length;f++)if(!this.l(b,c[g][f],"and"))return x;break;case "$in":if(c[g]instanceof Array){e=
c[g];f=e.length;var k,q=x;for(k=0;k<f;k++)if(e[k]===b){q=r;break}if(q){if("or"===a)return r}else h=x}else m("Cannot use a $nin operator on a non-array key: "+g);e=r;break;case "$nin":if(c[g]instanceof Array){e=c[g];f=e.length;q=r;for(k=0;k<f;k++)if(e[k]===b){q=x;break}if(q){if("or"===a)return r}else h=x}else m("Cannot use a $nin operator on a non-array key: "+g);e=r;break;case "$ne":if(b!=c[g]){if("or"===a)return r}else h=x;e=r}if(!e&&c[g]instanceof RegExp)if(e=r,"object"===typeof b&&b[g]!==n&&c[g].test(b[g])){if("or"===
a)return r}else h=x;if(!e)if("object"===typeof c[g])if(b[g]!==n){if(b[g]instanceof Array&&!(c[g]instanceof Array)){e=x;for(f=0;f<b[g].length&&!(e=this.l(b[g][f],c[g],n));f++);}else if(!(b[g]instanceof Array)&&c[g]instanceof Array){e=x;for(f=0;f<c[g].length&&!(e=this.l(b[g],c[g][f],n));f++);}else e="object"===typeof b?this.l(b[g],c[g],n):this.l(n,c[g],n);if(e){if("or"===a)return r}else h=x}else if(c[g]&&c[g].$exists!==n)if(e=this.l(n,c[g],n)){if("or"===a)return r}else h=x;else h=x;else if(b&&b[g]===
c[g]){if("or"===a)return r}else if(b&&b[g]&&b[g]instanceof Array&&c[g]&&"object"!==typeof c[g]){e=x;for(f=0;f<b[g].length&&!(e=this.l(b[g][f],c[g],n));f++);if(e){if("or"===a)return r}else h=x}else h=x;if("and"===a&&!h)return x}return h};a.prototype.count=function(b,c){return b?this.find(b,c).length:this.a.length};a.prototype.tb=function(b){var c,a=this.T,e,f;if(this.s.get(b[this.d]))c=this.s;else for(e in a)if(a.hasOwnProperty(e)&&(f=a[e],f.unique()&&f.Db(b))){c=f;break}return c?c.name():x};a.prototype.index=
function(b){if(this.T)return this.T[b]};a.prototype.Oa=function(b){var c=Math.pow(10,17);if(b){var a=0,e=b.length,f;for(f=0;f<e;f++)a+=b.charCodeAt(f)*c;b=a.toString(16)}else k.X++,b=(k.X+(Math.random()*c+Math.random()*c+Math.random()*c+Math.random()*c)).toString(16);return b};e.prototype.V=function(b,c){if(b)return this.v[b]||this.debug()&&console.log("Creating collection "+b),this.v[b]=this.v[b]||(new a(b)).db(this),c!==n&&this.v[b].primaryKey(c),this.v[b];m("Cannot get collection with undefined name!")};
u.g=a},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Overload":9,"./Path":10,"./Shared":11}],3:[function(q,u){function a(){this.e.apply(this,arguments)}var k,e;k=q("./Shared.js");a.prototype.e=function(){this.v={};this.c={}};k.p.ra=a;e=q("./Overload.js");q("./Collection.js");q("./Metrics.js");q("./Crc.js");a.prototype.m=function(c){return JSON.parse(JSON.stringify(c))};a.prototype.debug=new e([function(){return this.c.all},function(c){return c!==n&&"boolean"===typeof c?(this.c.all=c,
this):this.c.all},function(c,a){return c!==n?a!==n?(this.c[c]=a,this):this.c[c]:this.c.all}]);a.prototype.t=function(c,a){this.r=this.r||{};if(c in this.r){var e=this.r[c],h=e.length,b;for(b=0;b<h;b++)e[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};a.prototype.Oa=function(c){var a,e,h=Math.pow(10,17),b;if(c){a=0;e=c.length;for(b=0;b<e;b++)a+=c.charCodeAt(b)*h;c=a.toString(16)}else k.X++,c=(k.X+(Math.random()*h+Math.random()*h+Math.random()*h+Math.random()*h)).toString(16);return c};
u.g=a},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(q,u){var a=function(){var a=[],e,c,f;for(c=0;256>c;c++){e=c;for(f=0;8>f;f++)e=e&1?3988292384^e>>>1:e>>>1;a[c]=e}return a}();u.g=function(k){var e=-1,c;for(c=0;c<k.length;c++)e=e>>>8^a[(e^k.charCodeAt(c))&255];return(e^-1)>>>0}},{}],5:[function(q,u){function a(){this.e.apply(this,arguments)}var k=q("./Shared"),e=q("./Path");a.prototype.e=function(c,a,e){this.S={};this.Fa=0;this.Xa=this.Za(c,c);
this.data({});this.unique(a&&a.unique?a.unique:x);c!==n&&this.keys(c);e!==n&&this.V(e);this.name(a&&a.name?a.name:this.Xa)};k.p.Ib=a;a.prototype.data=function(c){return c!==n?(this.a=c,this):this.a};a.prototype.name=function(c){return c!==n?(this.j=c,this):this.j};a.prototype.V=function(c){return c!==n?(this.v=c,this):this.v};a.prototype.keys=function(c){return c!==n?(this.w=c,this.Rb=(new e).parse(this.w).length,this):this.w};a.prototype.type=function(c){return c!==n?(this.kb=c,this):this.kb};a.prototype.unique=
function(c){return c!==n?(this.ga=c,this):this.ga};a.prototype.f=function(c){var a,e;this.ga&&(a=this.U(c,this.w),this.Ha[a]=c);a=this.Aa(c,this.w);for(e=0;e<a.length;e++)this.zb(a[e],c)};a.prototype.remove=function(c){var a,e;this.ga&&(a=this.U(c,this.w),delete this.Ha[a]);a=this.Aa(c,this.w);for(e=0;e<a.length;e++)this.xb(a[e],c)};a.prototype.Db=function(c){c=this.U(c,this.w);return Boolean(this.Ha[c])};a.prototype.zb=function(c,a){var e=this.a[c]=this.a[c]||[];-1===e.indexOf(a)&&(e.push(a),this.Fa++,
this.yb(a,e))};a.prototype.xb=function(c,a){var e=this.a[c],h;h=e.indexOf(a);-1<h&&(e.splice(h,1),this.Fa--,this.wb(a));e.length||delete this.a[c]};a.prototype.yb=function(c,a){var e=c[this.v.primaryKey()];this.S[e]=this.S[e]||[];e=this.S[e];-1===e.indexOf(a)&&e.push(a)};a.prototype.wb=function(c){c=c[this.v.primaryKey()];delete this.S[c]};a.prototype.z=function(c){return this.a[this.U(c,this.w)]||[]};a.prototype.match=function(c){return(new e).Ka(this.w,c)};a.prototype.U=function(c,a){var g=new e,
h,b="",d;h=g.parse(a);for(d=0;d<h.length;d++)b&&(b+="_"),b+=g.value(c,h[d].path).join(":");return b};a.prototype.Za=function(c,a){var g=new e,h,b="",d;h=g.parse(a);for(d=0;d<h.length;d++)b&&(b+="_"),b+=g.ub(c,h[d].path);return b};a.prototype.Aa=function(c,a){var g=new e,h,b=[],d,k,q,u;h=g.parse(a);for(q=0;q<h.length;q++){d=g.value(c,h[q].path);for(k=0;k<d.length;k++)if(0===q)b.push(d[k]);else for(u=0;u<b.length;u++)b[u]=b[u]+"_"+d[k]}return b};u.g=a},{"./Path":10,"./Shared":11}],6:[function(q,u){function a(a){this.e.apply(this,
arguments)}var k=q("./Shared");a.prototype.e=function(a){this.j=a;this.a={};this.d="_id"};k.p.Jb=a;a.prototype.name=function(a){return a!==n?(this.j=a,this):this.j};a.prototype.primaryKey=function(a){return a!==n?(this.d=a,this):this.d};a.prototype.truncate=function(){this.a={};return this};a.prototype.set=function(a,c){this.a[a]=c?c:r;return this};a.prototype.get=function(a){return this.a[a]};a.prototype.z=function(a){a=a[this.d];var c,f,g,h;if(a instanceof Array){f=a.length;h=[];for(c=0;c<f;c++)(g=
this.a[a[c]])&&h.push(g);return h}if(a instanceof RegExp){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&a.test(c)&&h.push(this.a[c]);return h}if("object"===typeof a){if(a.Sa){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&c!==a.Sa&&h.push(this.a[c]);return h}if(a.oa&&a.oa instanceof Array){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&-1<a.oa.indexOf(c)&&h.push(this.a[c]);return h}if(a.qa&&a.qa instanceof Array){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&-1===a.qa.indexOf(c)&&h.push(this.a[c]);
return h}if(a.aa&&a.aa instanceof Array){h=[];for(c=0;c<a.aa.length;c++)h=h.concat(this.z(a.aa[c]));return h}}else return g=this.a[a],g!==n?[g]:[]};a.prototype.$=function(a){delete this.a[a]};a.prototype.R=function(a,c){return this.a[a]===n?(this.a[a]=c,r):x};u.g=a},{"./Shared":11}],7:[function(q,u){function a(){this.e.apply(this,arguments)}var k=q("./Shared"),e=q("./Operation");a.prototype.e=function(){this.a=[]};k.p.Kb=a;a.prototype.create=function(a){a=new e(a);this.va&&this.a.push(a);return a};
a.prototype.start=function(){this.va=r;return this};a.prototype.stop=function(){this.va=x;return this};u.g=a},{"./Operation":8,"./Shared":11}],8:[function(q,u){function a(a){this.Pa=new e;this.Ub=0;this.e.apply(this,arguments)}var k=q("./Shared"),e=q("./Path");a.prototype.e=function(a){this.a={Xb:a,index:{Yb:[],ac:x},Ab:[],time:{Q:0,Y:0,Z:0,vb:{}},N:{},log:[]}};k.p.Lb=a;a.prototype.start=function(){this.a.time.Q=(new Date).getTime()};a.prototype.log=function(a){if(a){var e=0<this.Sb.length?this.a.log[this.a.log.length-
1].time:0;a={event:a,time:(new Date).getTime(),qb:0};this.a.log.push(a);e&&(a.qb=a.time-e);return this}return this.a.log};a.prototype.time=function(a){if(a!==n){var e=this.a.time.vb,e=e[a]=e[a]||{};e.Q?(e.Y=(new Date).getTime(),e.Z=e.Y-e.Q,e.ma.Z=e.Z,delete e.ma):(e.Q=(new Date).getTime(),e.ma={name:a},this.a.Ab.push(e.ma));return this}return this.a.time};a.prototype.N=function(a,e){if(a!==n&&e!==n)this.a.N[a]=e;else return a!==n?this.a.N[a]:this.a.N};a.prototype.data=function(a,e){return e!==n?(this.Pa.set(this.a,
a,e),this):this.Pa.get(this.a,a)};a.prototype.stop=function(){this.a.time.Y=(new Date).getTime();this.a.time.Z=this.a.time.Y-this.a.time.Q};u.g=a},{"./Path":10,"./Shared":11}],9:[function(q,u){function a(a){if(a){var e,c=a.length;return function(){for(e=0;e<c;e++)if(a[e].length===arguments.length)return a[e].apply(this,arguments);return null}}return function(){}}q("./Shared").p.Mb=a;u.g=a},{"./Shared":11}],10:[function(q,u){function a(a){this.e.apply(this,arguments)}var k=q("./Shared");a.prototype.e=
function(a){a&&this.path(a)};k.p.Nb=a;a.prototype.path=function(a){return a!==n?(this.Ba=this.M(a),this.Ca=this.Ba.split("."),this):this.Ba};a.prototype.Ja=function(a){var c=0,f;for(f in a)a.hasOwnProperty(f)&&a[f]!==n&&("object"!==typeof a[f]?c++:c+=this.Ja(a[f]));return c};a.prototype.Ka=function(a,c){var f,g={},h=0,b=0,d;for(d in c)c.hasOwnProperty(d)&&("object"===typeof c[d]?(f=this.Ka(a[d],c[d]),g[d]=f.Na,b+=f.I,h+=f.o):(b++,a&&a[d]&&"object"!==typeof a[d]?(g[d]=r,h++):g[d]=x));return{Na:g,o:h,
I:b}};a.prototype.parse=function(a,c){var f=[],g="",h,b,d;for(b in a)if(a.hasOwnProperty(b))if(g=b,"object"===typeof a[b])if(c){h=this.parse(a[b],c);for(d=0;d<h.length;d++)f.push({path:g+"."+h[d].path,value:h[d].value})}else{h=this.parse(a[b]);for(d=0;d<h.length;d++)f.push({path:g+"."+h[d].path})}else c?f.push({path:g,value:a[b]}):f.push({path:g});return f};a.prototype.value=function(a,c){if(a!==n&&"object"===typeof a){var f,g,h,b,d=[],k;c!==n&&(c=this.M(c),f=c.split("."));f=f||this.Ca;g=f.length;
h=a;for(k=0;k<g;k++){h=h[f[k]];if(b instanceof Array){for(g=0;g<b.length;g++)d=d.concat(this.value(b,g+"."+f[k]));return d}if(!h||"object"!==typeof h)break;b=h}return[h]}return[]};a.prototype.set=function(a,c,f){if(a!==n&&c!==n){var g;c=this.M(c);c=c.split(".");g=c.shift();c.length?(a[g]=a[g]||{},this.set(a[g],c.join("."),f)):a[g]=f}return a};a.prototype.get=function(a,c){return this.value(a,c)[0]};a.prototype.push=function(a,c,f){if(a!==n&&c!==n){var g;c=this.M(c);c=c.split(".");g=c.shift();c.length?
(a[g]=a[g]||{},this.set(a[g],c.join("."),f)):(a[g]=a[g]||[],a[g]instanceof Array?a[g].push(f):m("Cannot push to a path whose endpoint is not an array!"))}return a};a.prototype.ub=function(a,c){var f,g,h,b,d;c!==n&&(c=this.M(c),f=c.split("."));f=f||this.Ca;g=f.length;h=a;for(d=0;d<g;d++)if(h=h[f[d]],!h||"object"!==typeof h){b=f[d]+":"+h;break}return b};a.prototype.M=function(a){"."===a.substr(0,1)&&(a=a.substr(1,a.length-1));return a};u.g=a},{"./Shared":11}],11:[function(q,u){u.g={X:0,p:{},Zb:{}}},
{}],12:[function(q,u){function a(a,b,c){this.e.apply(this,arguments)}var k,e,c,f,g;k=q("./Shared");a.prototype.e=function(a,b,c){this.j=a;this.ua=[];this.Wa=[];this.r={};this.K={P:b,options:c};this.c={};this.b=new e("__FDB__view_privateData_"+this.j)};k.p.Ob=a;e=q("./Collection");g=q("./Overload");c=e.prototype.e;k=k.p.ra;f=k.prototype.e;a.prototype.debug=new g([function(){return this.c.all},function(a){return a!==n&&"boolean"===typeof a?(this.c.all=a,this.b.debug(a),this.O().debug(a),this):this.c.all},
function(a,b){return a!==n?b!==n?(this.c[a]=b,this.b.debug(a,b),this.O().debug(a,b),this):this.c[a]:this.c.all}]);a.prototype.name=function(a){return a!==n?(this.j=a,this):this.j};a.prototype.find=function(a,b){return this.O().find(a,b)};a.prototype.f=function(a,b,c){a=this.b.m(a);"function"===typeof b?(c=b,b=this.b.length):b===n&&(b=this.b.length);this.fb(a,b);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.b.name()+
'"');return this.b.za(a,b,c)};a.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.b.name()+'"');var c=this.b.update(a,b),e,f,g;if(this.i&&this.B){e=this.k.primaryKey();for(var k=0;k<c.length;k++)f={},g=c[k],f[e]=g[e],this.jb(f,g)}return c};a.prototype.remove=function(a){this.hb(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+
this.b.name()+'"');return this.b.remove(a)};a.prototype.t=function(){this.b.t.apply(this.b,arguments)};a.prototype.db=function(a){return a!==n?(this.h=a,this.b.db(a),this.O().db(a),this):this.h};a.prototype.primaryKey=function(){return this.b.primaryKey()};a.prototype.P=function(a,b){return a!==n?(this.K.P=a,(b===n||b===r)&&this.refresh(),this):this.K.P};a.prototype.refresh=function(){var a,b=this.O(),c;this.b.remove();b.remove();for(c=0;c<this.ua.length;c++)a=this.ua[c],this.b.f(a.find(this.K.P,
this.K.options));a=this.b.find({},this.K.options);b.q?$.A(b.a).refresh(a):(this.b.a.length=0,this.b.a=this.b.a.concat(a));return this};a.prototype.count=function(){return this.b&&this.b.a?this.b.a.length:0};a.prototype.transform=function(a){return a!==n?("object"===typeof a?(a.enabled!==n&&(this.i=a.enabled),a.G!==n&&(this.B=a.G),a.H!==n&&(this.C=a.H)):this.i=a===x?x:r,this.gb(this.b.primaryKey()),this.ib(this.b.find()),this):{enabled:this.i,G:this.B,H:this.C}};a.prototype.O=function(){return this.i?
this.k:this.b};a.prototype.ib=function(a){this.i&&(this.k=new e("__FDB__view_publicData_"+this.j),this.k.db(this.b.h),this.k.transform({enabled:r,G:this.B,H:this.C}),this.k.setData(a))};a.prototype.fb=function(a,b){this.i&&this.k&&this.k.f(a,b)};a.prototype.jb=function(a,b){this.i&&this.k&&this.k.update(a,b)};a.prototype.hb=function(a){this.i&&this.k&&this.k.remove(a)};a.prototype.gb=function(a){this.i&&this.k&&this.k.primaryKey(a)};e.prototype.e=function(){this.D=[];c.apply(this,arguments)};k.prototype.e=
function(){this.D={};f.apply(this,arguments)};u.g=a},{"./Collection":2,"./Overload":9,"./Shared":11}]},{},[1])(1)}if("object"==typeof exports&&"undefined"!=typeof module)module.g=A();else if("function"==typeof define&&define.Tb)define([],A);else{var B;"undefined"!=typeof window?B=window:"undefined"!=typeof global?B=global:"undefined"!=typeof self&&(B=self);B.Hb=A()}r;
