!function(v){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=v();else if("function"==typeof define&&define.amd)define([],v);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=v()}}(function(){return function h(r,p,g){function a(d,n){if(!p[d]){if(!r[d]){var c="function"==typeof require&&require;if(!n&&c)return c(d,!0);if(e)return e(d,!0);c=Error("Cannot find module '"+d+"'");throw c.code="MODULE_NOT_FOUND",
c;}c=p[d]={exports:{}};r[d][0].call(c.exports,function(b){var f=r[d][1][b];return a(f?f:b)},c,c.exports,h,r,p,g)}return p[d].exports}for(var e="function"==typeof require&&require,d=0;d<g.length;d++)a(g[d]);return a}({1:[function(h,r,p){h=h("../lib/Core");r.exports=h},{"../lib/Core":3}],2:[function(h,r,p){var g,a,e,d,k,n;g=h("./Shared");var c=function(b){this.init.apply(this,arguments)};c.prototype.init=function(b){this._primaryKey="_id";this._primaryIndex=new e("primary");this._primaryCrc=new e("primaryCrc");
this._crcLookup=new e("crcLookup");this._name=b;this._data=[];this._groups=[];this._metrics=new a;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};g.modules.Collection=c;p=h("./Overload");a=h("./Metrics");e=h("./KeyValueStore");d=h("./Path");k=h("./Index");n=h("./Crc");h=g.modules.Core;c.prototype.debug=new p([function(){return this._debug.all},
function(b){if(void 0!==b){if("boolean"===typeof b){this._debug.all=b;for(var f=0;f<this._views.length;f++)this._views[f].debug(b);return this}return this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]||this._debug.all}return this._debug.all},function(b,f){if(void 0!==b){if(void 0!==f){this._debug[b]=f;for(var m=0;m<this._views.length;m++)this._views[m].debug(b,f);return this}return this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]}return this._debug.all}]);c.prototype.crc=n;
c.prototype.name=function(b){return void 0!==b?(this._name=b,this):this._name};c.prototype.on=new p([function(b,f){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||[];this._listeners[b]["*"].push(f);return this},function(b,f,m){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][f]=this._listeners[b][f]||[];this._listeners[b][f].push(m);return this}]);c.prototype.off=new p([function(b){this._listeners&&
this._listeners[b]&&b in this._listeners&&delete this._listeners[b];return this},function(b,f){var m,a;"string"===typeof f?this._listeners&&this._listeners[b]&&this._listeners[b][f]&&delete this._listeners[b][f]:b in this._listeners&&(m=this._listeners[b]["*"],a=m.indexOf(f),-1<a&&m.splice(a,1));return this},function(b,f,m){this._listeners&&b in this._listeners&&(b=this._listeners[b][f],m=b.indexOf(m),-1<m&&b.splice(m,1))}]);c.prototype.emit=function(b,f){this._listeners=this._listeners||{};if(b in
this._listeners){if(this._listeners[b]["*"]){var m=this._listeners[b]["*"],a=m.length,s;for(s=0;s<a;s++)m[s].apply(this,Array.prototype.slice.call(arguments,1))}if(f instanceof Array&&f[0]&&f[0][this._primaryKey]){var m=this._listeners[b],d,q,a=f.length;for(s=0;s<a;s++)if(m[f[s][this._primaryKey]])for(d=m[f[s][this._primaryKey]].length,q=0;q<d;q++)m[f[s][this._primaryKey]][q].apply(this,Array.prototype.slice.call(arguments,1))}}return this};c.prototype.drop=function(){if(this._db&&this._name){this.debug()&&
console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var b=[],f;for(f=0;f<this._groups.length;f++)b.push(this._groups[f]);for(f=0;f<b.length;f++)this._groups[f].removeCollection(this);return!0}return!1};c.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=b,this._primaryIndex.primaryKey(b),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};c.prototype._onInsert=function(b,f){this.emit("insert",b,f)};c.prototype._onUpdate=function(b){this.emit("update",
b)};c.prototype._onRemove=function(b){this.emit("remove",b)};c.prototype.db=function(b){return void 0!==b?(this._db=b,this):this._db};c.prototype.setData=function(b,f,m){if(b){var a=this._metrics.create("setData");a.start();f=f||{};f.decouple=void 0!==f.decouple?f.decouple:!0;f.decouple&&(b=this.decouple(b));b instanceof Array||(b=[b]);a.time("transformIn");b=this.transformIn(b);a.time("transformIn");var s=this._data;this._data=[];b.length&&(this._data=this._data.concat(b));a.time("_rebuildPrimaryKeyIndex");
this._rebuildPrimaryKeyIndex(f);a.time("_rebuildPrimaryKeyIndex");a.stop();this.emit("setData",this._data,s)}m&&m(!1);return this};c.prototype._rebuildPrimaryKeyIndex=function(b){var f=b&&void 0!==b.ensureKeys?b.ensureKeys:!0;b=b&&void 0!==b.violationCheck?b.violationCheck:!0;var m,a,s,d=this._primaryIndex,q=this._primaryCrc,c=this._crcLookup,e=this._primaryKey,g;d.truncate();q.truncate();c.truncate();m=this._data;for(a=m.length;a--;)if(s=m[a],f&&this._ensurePrimaryKey(s),b){if(!d.uniqueSet(s[e],
s))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+s[this._primaryKey];}else g=JSON.stringify(s),d.set(s[e],s),q.set(s[e],g),c.set(g,s)};c.prototype._ensurePrimaryKey=function(b){void 0===b[this._primaryKey]&&(b[this._primaryKey]=this.objectId())};c.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};c.prototype.upsert=function(b,f){if(b){var m=
this._deferQueue.upsert,a=this._deferThreshold.upsert,d={},e;if(b instanceof Array){if(b.length>a){this._deferQueue.upsert=m.concat(b);this.processQueue("upsert",f);return}d=[];for(m=0;m<b.length;m++)d.push(this.upsert(b[m]));f&&f();return d}b[this._primaryKey]?(e={},e[this._primaryKey]=b[this._primaryKey],this.count(e)?d.op="update":d.op="insert"):d.op="insert";switch(d.op){case "insert":d.result=this.insert(b);break;case "update":d.result=this.update(e,b)}return d}f&&f()};c.prototype.update=function(b,
f,m){f=this.decouple(f);f=this.transformIn(f);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var a=this,d=this._metrics.create("update"),e=this._primaryKey,q,c,g=function(d){if(f&&void 0!==f[e]&&f[e]!=d[e]){a._primaryIndex.unSet(d[e]);var c=a._updateObject(d,f,b,m,"");if(a._primaryIndex.uniqueSet(d[e],d))return c;throw"Primary key violation in update! Key violated: "+d[e];}return a._updateObject(d,f,b,m,"")},k=this._views;d.start();d.time("Retrieve documents to update");
q=this.find(b,{decouple:!1});d.time("Retrieve documents to update");if(q.length&&(d.time("Update documents"),c=q.filter(g),d.time("Update documents"),c.length)){if(k&&k.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());d.time("Inform views of update");for(q=0;q<k.length;q++)k[q].update(b,f);d.time("Inform views of update")}this._onUpdate(c);this.deferEmit("change",{type:"update",data:c})}d.stop();return c||[]};c.prototype.updateById=function(b,f){var m={};m[this._primaryKey]=
b;return this.update(m,f)};c.prototype._updateObject=function(b,f,m,a,e,c){f=this.decouple(f);e=e||"";"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));var q=!1,g=!1,k,h,n,l;for(l in f)if(f.hasOwnProperty(l)){k=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:k=!0,(g=this._updateObject(b,f[l],m,a,e,l))&&(q=!0)}if(this._isPositionalKey(l)&&(k=!0,l=l.substr(0,l.length-2),g=new d(e+"."+l),b[l]&&b[l]instanceof Array&&b[l].length)){h=[];for(n=0;n<b[l].length;n++)this._match(b[l][n],g.value(m)[0])&&
h.push(n);for(n=0;n<h.length;n++)(g=this._updateObject(b[l][h[n]],f[l+".$"],m,a,e+"."+l,c))&&(q=!0)}if(!k)if(c||"object"!==typeof f[l])switch(c){case "$inc":this._updateIncrement(b,l,f[l]);q=!0;break;case "$push":void 0===b[l]&&(b[l]=[]);if(b[l]instanceof Array){if(void 0!==f[l].$position&&f[l].$each instanceof Array)for(q=f[l].$position,k=f[l].$each.length,n=0;n<k;n++)this._updateSplicePush(b[l],q+n,f[l].$each[n]);else if(f[l].$each instanceof Array)for(k=f[l].$each.length,n=0;n<k;n++)this._updatePush(b[l],
f[l].$each[n]);else this._updatePush(b[l],f[l]);q=!0}else throw"Cannot push to a key that is not an array! ("+l+")!";break;case "$pull":if(b[l]instanceof Array){h=[];for(n=0;n<b[l].length;n++)this._match(b[l][n],f[l])&&h.push(n);for(k=h.length;k--;)this._updatePull(b[l],h[k]),q=!0}else throw"Cannot pull from a key that is not an array! ("+l+")!";break;case "$addToSet":void 0===b[l]&&(b[l]=[]);if(b[l]instanceof Array){n=b[l];var p;h=n.length;var r;k=!0;p=a&&a.$addToSet;var t;p&&p.key?(g=!1,t=new d(p.key),
r=t.value(f[l])[0]):(r=JSON.stringify(f[l]),g=!0);for(p=0;p<h;p++)if(g){if(JSON.stringify(n[p])===r){k=!1;break}}else if(r===t.value(n[p])[0]){k=!1;break}k&&(this._updatePush(b[l],f[l]),q=!0)}else throw"Cannot push to a key that is not an array! (undefined)!";break;case "$splicePush":void 0===b[l]&&(b[l]=[]);if(b[l]instanceof Array)if(q=f.$index,void 0!==q)delete f.$index,this._updateSplicePush(b[l],q,f[l]),q=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+
l+")!";break;case "$move":if(b[l]instanceof Array)for(n=0;n<b[l].length;n++){if(this._match(b[l][n],f[l])){q=f[l].$index;if(void 0!==q)this._updateSpliceMove(b[l],n,q),q=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot pull from a key that is not an array! ("+l+")!";break;case "$mul":this._updateMultiply(b,l,f[l]);q=!0;break;case "$rename":this._updateRename(b,l,f[l]);q=!0;break;case "$unset":this._updateUnset(b,l);q=!0;break;case "$pop":if(b[l]instanceof Array)this._updatePop(b[l],
f[l])&&(q=!0);else throw"Cannot pop from a key that is not an array! ("+l+")!";break;default:b[l]!==f[l]&&(this._updateProperty(b,l,f[l]),q=!0)}else if(null!==b[l]&&"object"===typeof b[l])if(n=b[l]instanceof Array,h=f[l]instanceof Array,n||h)if(!h&&n)for(n=0;n<b[l].length;n++)(g=this._updateObject(b[l][n],f[l],m,a,e+"."+l,c))&&(q=!0);else b[l]!==f[l]&&(this._updateProperty(b,l,f[l]),q=!0);else(g=this._updateObject(b[l],f[l],m,a,e+"."+l,c))&&(q=!0);else b[l]!==f[l]&&(this._updateProperty(b,l,f[l]),
q=!0)}return q};c.prototype._isPositionalKey=function(b){return".$"===b.substr(b.length-2,2)};c.prototype._updateProperty=function(b,f,m){this._linked?($.observable(b).setProperty(f,m),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+f+'" for collection "'+this.name()+'"')):(b[f]=m,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+f+'" for collection "'+this.name()+'"'))};c.prototype._updateIncrement=function(b,
f,m){this._linked?$.observable(b).setProperty(f,b[f]+m):b[f]+=m};c.prototype._updateSpliceMove=function(b,f,m){this._linked?($.observable(b).move(f,m),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+f+'" to "'+m+'" for collection "'+this.name()+'"')):(b.splice(m,0,b.splice(f,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+f+'" to "'+m+'" for collection "'+this.name()+'"'))};c.prototype._updateSplicePush=
function(b,f,m){b.length>f?this._linked?$.observable(b).insert(f,m):b.splice(f,0,m):this._linked?$.observable(b).insert(m):b.push(m)};c.prototype._updatePush=function(b,f){this._linked?$.observable(b).insert(f):b.push(f)};c.prototype._updatePull=function(b,f){this._linked?$.observable(b).remove(f):b.splice(f,1)};c.prototype._updateMultiply=function(b,f,m){this._linked?$.observable(b).setProperty(f,b[f]*m):b[f]*=m};c.prototype._updateRename=function(b,f,m){var a=b[f];this._linked?($.observable(b).setProperty(m,
a),$.observable(b).removeProperty(f)):(b[m]=a,delete b[f])};c.prototype._updateUnset=function(b,f){this._linked?$.observable(b).removeProperty(f):delete b[f]};c.prototype._updatePop=function(b,f){var m,a=!1;0<b.length&&(this._linked?(1===f?m=b.length-1:-1===f&&(m=0),-1<m&&($.observable(arr).remove(m),a=!0)):1===f?(b.pop(),a=!0):-1===f&&(b.shift(),a=!0));return a};c.prototype.remove=function(b){var f,m,a=this._views,d;if(b instanceof Array){a=[];for(f=0;f<b.length;f++)a.push(this.remove(b[f]));return a}f=
this.find(b,{decouple:!1});if(f.length){for(d=0;d<f.length;d++)m=f[d],this._removeIndex(m),m=this._data.indexOf(m),this._linked?$.observable(this._data).remove(m):this._data.splice(m,1);if(a&&a.length)for(d=0;d<a.length;d++)a[d].remove(b);this._onRemove(f);this.deferEmit("change",{type:"remove",data:f})}return f};c.prototype.removeById=function(b){var f={};f[this._primaryKey]=b;return this.remove(f)};c.prototype.deferEmit=function(){var b=this,f;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?
this.emit.apply(this,arguments):(f=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+f[0]);b.emit.apply(b,f)},100))};c.prototype.processQueue=function(b,f){var m=this._deferQueue[b],a=this._deferThreshold[b],d=this._deferTime[b];if(m.length){var e=this;m.length&&(m=m.length>a?m.splice(0,a):m.splice(0,m.length),this[b](m));setTimeout(function(){e.processQueue(b,f)},d)}else f&&f()};c.prototype.insert=
function(b,f,m){"function"===typeof f?(m=f,f=this._data.length):void 0===f&&(f=this._data.length);b=this.transformIn(b);return this._insertHandle(b,f,m)};c.prototype._insertHandle=function(b,f,m){var a=this._deferQueue.insert,d=this._deferThreshold.insert,e=[],c=[],g=this._views;if(b instanceof Array){if(b.length>d){this._deferQueue.insert=a.concat(b);this.processQueue("insert",m);return}for(d=0;d<b.length;d++)a=this._insert(b[d],f+d),!0===a?e.push(b[d]):c.push({doc:b[d],reason:a})}else a=this._insert(b,
f),!0===a?e.push(b):c.push({doc:b,reason:a});if(g&&g.length)for(a=0;a<g.length;a++)g[a].insert(b,f);this._onInsert(e,c);m&&m();this.deferEmit("change",{type:"insert",data:e});return{inserted:e,failed:c}};c.prototype._insert=function(b,f){if(b){var m;this._ensurePrimaryKey(b);if(m=this.insertIndexViolation(b))return"Index violation in index: "+m;this._insertIndex(b);this._linked?$.observable(this._data).insert(f,b):this._data.splice(f,0,b);return!0}return"No document passed to insert"};c.prototype._insertIndex=
function(b){var f=this._indexByName,m,a=JSON.stringify(b);this._primaryIndex.uniqueSet(b[this._primaryKey],b);this._primaryCrc.uniqueSet(b[this._primaryKey],a);this._crcLookup.uniqueSet(a,b);for(m in f)f.hasOwnProperty(m)&&f[m].insert(b)};c.prototype._removeIndex=function(b){var f=this._indexByName,a,d=JSON.stringify(b);this._primaryIndex.unSet(b[this._primaryKey]);this._primaryCrc.unSet(b[this._primaryKey]);this._crcLookup.unSet(d);for(a in f)f.hasOwnProperty(a)&&f[a].remove(b)};c.prototype.subset=
function(b,f){var a=this.find(b,f);return(new c)._subsetOf(this).primaryKey(this._primaryKey).setData(a)};c.prototype.subsetOf=function(){return this.__subsetOf};c.prototype._subsetOf=function(b){this.__subsetOf=b;return this};c.prototype.distinct=function(b,f,a){f=this.find(f,a);b=new d(b);a={};var e=[],c,g;for(g=0;g<f.length;g++)(c=b.value(f[g])[0])&&!a[c]&&(a[c]=!0,e.push(c));return e};c.prototype.decouple=function(b){return JSON.parse(JSON.stringify(b))};c.prototype.findById=function(b,f){var a=
{};a[this._primaryKey]=b;return this.find(a,f)[0]};c.prototype.peek=function(b,f){var a=this._data,d=a.length,e,g,q=new c;if("string"===typeof b){for(e=0;e<d;e++)g=JSON.stringify(a[e]),-1<g.indexOf(b)&&q.insert(a[e]);return q.find({},f)}return this.find(b,f)};c.prototype.explain=function(b,f){return this.find(b,f).__fdbOp._data};c.prototype.find=function(b,f){b=b||{};f=f||{};f.decouple=void 0!==f.decouple?f.decouple:!0;var a=this._metrics.create("find"),e=this,c,g=!0,q,k,h,n,p,l,r,w,t,u=[];k=function(f){return e._match(f,
b,"and")};a.start();if(b){a.time("analyseQuery");c=this._analyseQuery(b,f,a);a.time("analyseQuery");a.data("analysis",c);if(c.hasJoin&&c.queriesJoin){a.time("joinReferences");for(h=0;h<c.joinsOn.length;h++)p=c.joinsOn[h],n=new d(c.joinQueries[p]),n=n.value(b)[0],this._db.collection(c.joinsOn[h]).subset(n);a.time("joinReferences")}c.indexMatch.length&&(!f||f&&!f.skipIndex)?(a.data("index.potential",c.indexMatch),a.data("index.used",c.indexMatch[0].index),a.time("indexLookup"),q=c.indexMatch[0].lookup,
a.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===c.indexMatch[0].keyData.matchedKeyCount&&(g=!1)):a.flag("usedIndex",!1);g&&(q&&q.length?(c=q.length,a.time("tableScan: "+c),q=q.filter(k)):(c=this._data.length,a.time("tableScan: "+c),q=this._data.filter(k)),f.sort&&(a.time("sort"),q=this.sort(f.sort,q),a.time("sort")),a.time("tableScan: "+c));f.limit&&q&&q.length>f.limit&&(q.length=f.limit,a.data("limit",f.limit));f.decouple&&(a.time("decouple"),q=this.decouple(q),a.time("decouple"),a.data("flag.decouple",
!0));if(f.join){for(k=0;k<f.join.length;k++)for(p in f.join[k])if(f.join[k].hasOwnProperty(p))for(w=p,c=this._db.collection(p),g=f.join[k][p],t=0;t<q.length;t++){r={};n=h=!1;for(l in g)if(g.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":w=g[l];break;case "$multi":h=g[l];break;case "$require":n=g[l];break;default:l.substr(0,3)}else r[l]=(new d(g[l])).value(q[t])[0];r=c.find(r);!n||n&&r[0]?q[t][w]=!1===h?r[0]:r:u.push(q[t])}a.data("flag.join",!0)}if(u.length){a.time("removalQueue");for(l=
0;l<u.length;l++)p=q.indexOf(u[l]),-1<p&&q.splice(p,1);a.time("removalQueue")}if(f.transform){a.time("transform");for(l=0;l<q.length;l++)q.splice(l,1,f.transform(q[l]));a.time("transform");a.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(a.time("transformOut"),q=this.transformOut(q),a.time("transformOut"));a.data("results",q.length);a.stop()}else a.stop(),q=[];q.__fdbOp=a;return q};c.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&
(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};c.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof Array){var f=[],a;for(a=0;a<b.length;a++)f[a]=this._transformIn(b[a]);return f}return this._transformIn(b)}return b};c.prototype.transformOut=
function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof Array){var f=[],a;for(a=0;a<b.length;a++)f[a]=this._transformOut(b[a]);return f}return this._transformOut(b)}return b};c.prototype.sort=function(b,f){f=f||[];var a=[],d,c;for(d in b)b.hasOwnProperty(d)&&(c={},c[d]=b[d],c.___fdbKey=d,a.push(c));return 2>a.length?this._sort(b,f):this._bucketSort(a,f)};c.prototype._bucketSort=function(b,f){var a=b.shift(),d,c,e=[];if(0<b.length){f=this._sort(a,f);d=this.bucket(a.___fdbKey,f);
for(c in d)d.hasOwnProperty(c)&&(a=[].concat(b),e=e.concat(this._bucketSort(a,d[c])));return e}return this._sort(a,f)};c.prototype._sort=function(b,f){var a=new d,c=a.parse(b,!0)[0];a.path(c.path);return f.sort(1===c.value?function(b,f){var d=a.value(b)[0],c=a.value(f)[0];return"string"===typeof d&&"string"===typeof c?d.localeCompare(c):d>c?1:d<c?-1:0}:function(b,f){var d=a.value(b)[0],c=a.value(f)[0];return"string"===typeof d&&"string"===typeof c?1===d.localeCompare(c)?-1:1:d>c?-1:d<c?1:0})};c.prototype.bucket=
function(b,f){var a,d={};for(a=0;a<f.length;a++)d[f[a][b]]=d[f[a][b]]||[],d[f[a][b]].push(f[a]);return d};c.prototype._analyseQuery=function(b,f,a){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:f},e,g=[],k=[],h,n,p,r,l;a.time("checkIndexes");void 0!==b[this._primaryKey]&&(a.time("checkIndexMatch: Primary Key"),h=new d,c.indexMatch.push({lookup:this._primaryIndex.lookup(b,f),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:h.countKeys(b)},
index:this._primaryIndex}),a.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],p=n.name(),a.time("checkIndexMatch: "+p),h=n.match(b,f),r=n.lookup(b,f),0<h.matchedKeyCount&&c.indexMatch.push({lookup:r,keyData:h,index:n}),a.time("checkIndexMatch: "+p),h.totalKeyCount===h.matchedKeyCount))break;a.time("checkIndexes");1<c.indexMatch.length&&(a.time("findOptimalIndex"),c.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===
b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),a.time("findOptimalIndex"));if(f.join){c.hasJoin=!0;for(a=0;a<f.join.length;a++)for(e in f.join[a])f.join[a].hasOwnProperty(e)&&(g.push(e),"$as"in f.join[a][e]?k.push(f.join[a][e].$as):k.push(e));for(e=0;e<k.length;e++)if(f=this._queryReferencesCollection(b,k[e],""))c.joinQueries[g[e]]=
f,c.queriesJoin=!0;c.joinsOn=g;c.queriesOn=c.queriesOn.concat(g)}return c};c.prototype._queryReferencesCollection=function(b,a,d){for(var c in b)if(b.hasOwnProperty(c)){if(c===a)return d&&(d+="."),d+c;if("object"===typeof b[c])return d&&(d+="."),d+=c,this._queryReferencesCollection(b[c],a,d)}return!1};c.prototype._match=function(b,a,d){var c,e;c=typeof b;e=typeof a;var g=!0,k;if(!("string"!==c&&"number"!==c||"string"!==e&&"number"!==e))b!==a&&(g=!1);else for(k in a)if(a.hasOwnProperty(k)){c=!1;if("$"===
k.substr(0,1))switch(k){case "$gt":if(b>a[k]){if("or"===d)return!0}else g=!1;c=!0;break;case "$gte":if(b>=a[k]){if("or"===d)return!0}else g=!1;c=!0;break;case "$lt":if(b<a[k]){if("or"===d)return!0}else g=!1;c=!0;break;case "$lte":if(b<=a[k]){if("or"===d)return!0}else g=!1;c=!0;break;case "$exists":if(void 0===b!==a[k]){if("or"===d)return!0}else g=!1;c=!0;break;case "$or":c=!0;for(e=0;e<a[k].length;e++){if(this._match(b,a[k][e],"and"))return!0;g=!1}break;case "$and":c=!0;for(e=0;e<a[k].length;e++)if(!this._match(b,
a[k][e],"and"))return!1;break;case "$in":if(a[k]instanceof Array){c=a[k];e=c.length;var h,n=!1;for(h=0;h<e;h++)if(c[h]===b){n=!0;break}if(n){if("or"===d)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+k;c=!0;break;case "$nin":if(a[k]instanceof Array){c=a[k];e=c.length;n=!0;for(h=0;h<e;h++)if(c[h]===b){n=!1;break}if(n){if("or"===d)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+k;c=!0;break;case "$ne":if(b!=a[k]){if("or"===d)return!0}else g=
!1;c=!0}if(!c&&a[k]instanceof RegExp)if(c=!0,"object"===typeof b&&void 0!==b[k]&&a[k].test(b[k])){if("or"===d)return!0}else g=!1;if(!c)if("object"===typeof a[k])if(void 0!==b[k]){if(b[k]instanceof Array&&!(a[k]instanceof Array))for(c=!1,e=0;e<b[k].length&&!(c=this._match(b[k][e],a[k],void 0));e++);else if(!(b[k]instanceof Array)&&a[k]instanceof Array)for(c=!1,e=0;e<a[k].length&&!(c=this._match(b[k],a[k][e],void 0));e++);else c="object"===typeof b?this._match(b[k],a[k],void 0):this._match(void 0,a[k],
void 0);if(c){if("or"===d)return!0}else g=!1}else if(a[k]&&void 0!==a[k].$exists)if(c=this._match(void 0,a[k],void 0)){if("or"===d)return!0}else g=!1;else g=!1;else if(b&&b[k]===a[k]){if("or"===d)return!0}else if(b&&b[k]&&b[k]instanceof Array&&a[k]&&"object"!==typeof a[k]){c=!1;for(e=0;e<b[k].length&&!(c=this._match(b[k][e],a[k],void 0));e++);if(c){if("or"===d)return!0}else g=!1}else g=!1;if("and"===d&&!g)return!1}return g};c.prototype.count=function(b,a){return b?this.find(b,a).length:this._data.length};
c.prototype.link=function(b,a){this._links=this._links||{};if(!this._links[a]){if($(b).length){if(!$.templates[a]){var d=$(a);if(d.length)$.views.templates(a,$(d[0]).html());else throw"Unable to bind collection to target because template does not exist: "+a;}$.templates[a].link(b,this._data);this._links[a]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+
b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+a;};c.prototype.unlink=function(b,a){this._links=this._links||{};if(this._links[a])return $.templates[a].unlink(b),delete this._links[a],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)};c.prototype.findSub=
function(b,a,c,e){var g=new d(a);b=this.find(b);var k=b.length,h,n,p=this._db.collection("__FDB_temp_"+this.objectId()),r={parents:k,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<k;h++)if(n=g.value(b[h])[0]){p.setData(n);n=p.find(c,e);if(e.returnFirst&&n.length)return n[0];r.subDocs.push(n);r.subDocTotal+=n.length;r.pathFound=!0}p.drop();if(e.noStats)return r.subDocs;r.pathFound||(r.err="No objects found in the parent documents with a matching path of: "+a);return r};c.prototype.insertIndexViolation=
function(b){var a,d=this._indexByName,c,e;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(c in d)if(d.hasOwnProperty(c)&&(e=d[c],e.unique()&&e.violation(b))){a=e;break}return a?a.name():!1};c.prototype.ensureIndex=function(b,a){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var d=new k(b,a,this),c={start:(new Date).getTime()};if(this._indexByName[d.name()])return{err:"Index with that name already exists"};if(this._indexById[d.id()])return{err:"Index with those keys already exists"};
d.rebuild();this._indexByName[d.name()]=d;this._indexById[d.id()]=d;c.end=(new Date).getTime();c.total=c.end-c.start;this._lastOp={type:"ensureIndex",stats:{time:c}};return{index:d,id:d.id(),name:d.name(),state:d.state()}};c.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};c.prototype.lastOp=function(){return this._metrics.list()};c.prototype.objectId=function(b){var a=Math.pow(10,17);if(b){var d=0,c=b.length,e;for(e=0;e<c;e++)d+=b.charCodeAt(e)*a;b=d.toString(16)}else g.idCounter++,
b=(g.idCounter+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b};c.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},d=this.primaryKey(),c,e,k,g;if(d===b.primaryKey()){c=b._data;g=c.length;for(e=0;e<g;e++)k=c[e],this._primaryIndex.get(k[d])?this._primaryCrc.get(k[d])!==b._primaryCrc.get(k[d])&&a.update.push(k):a.insert.push(k);c=this._data;g=c.length;for(e=0;e<g;e++)k=c[e],b._primaryIndex.get(k[d])||a.remove.push(k)}return a};h.prototype.collection=
function(a,d){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new c(a)).db(this),void 0!==d&&this._collection[a].primaryKey(d),this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],d;for(d in this._collection)this._collection.hasOwnProperty(d)&&a.push({name:d,count:this._collection[d].count()});
return a};r.exports=c},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Overload":9,"./Path":10,"./Shared":11}],3:[function(h,r,p){var g,a;g=h("./Shared.js");var e=function(){this.init.apply(this,arguments)};e.prototype.init=function(){this._collection={};this._debug={}};g.modules.Core=e;p=h("./Overload.js");a=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");e.prototype._isServer=!1;e.prototype.isClient=function(){return!this._isServer};e.prototype.isServer=function(){return this._isServer};
e.prototype.crc=h;e.prototype.isClient=function(){return!this._isServer};e.prototype.isServer=function(){return this._isServer};e.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};e.prototype.debug=new p([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this):this._debug.all},function(a,e){return void 0!==a?void 0!==e?(this._debug[a]=e,this):this._debug[a]:this._debug.all}]);e.prototype.arrayToCollection=function(d){return(new a).setData(d)};
e.prototype.on=function(a,e){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(e);return this};e.prototype.off=function(a,e){if(a in this._listeners){var g=this._listeners[a],c=g.indexOf(e);-1<c&&g.splice(c,1)}return this};e.prototype.emit=function(a,e){this._listeners=this._listeners||{};if(a in this._listeners){var g=this._listeners[a],c=g.length,b;for(b=0;b<c;b++)g[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};e.prototype.objectId=
function(a){var e,h,c=Math.pow(10,17),b;if(a){e=0;h=a.length;for(b=0;b<h;b++)e+=a.charCodeAt(b)*c;a=e.toString(16)}else g.idCounter++,a=(g.idCounter+(Math.random()*c+Math.random()*c+Math.random()*c+Math.random()*c)).toString(16);return a};e.prototype.peek=function(a){var e,g,c=[],b=typeof a;for(e in this._collection)this._collection.hasOwnProperty(e)&&(g=this._collection[e],c="string"===b?c.concat(g.peek(a)):c.concat(g.find(a)));return c};e.prototype.peekCat=function(a){var e,g,c={},b,f=typeof a;
for(e in this._collection)this._collection.hasOwnProperty(e)&&(g=this._collection[e],(b="string"===f?g.peek(a):g.find(a))&&b.length&&(c[g.name()]=b));return c};r.exports=e},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(h,r,p){var g=function(){var a=[],e,d,g;for(d=0;256>d;d++){e=d;for(g=0;8>g;g++)e=e&1?3988292384^e>>>1:e>>>1;a[d]=e}return a}();r.exports=function(a){var e=-1,d;for(d=0;d<a.length;d++)e=e>>>8^g[(e^a.charCodeAt(d))&255];return(e^-1)>>>
0}},{}],5:[function(h,r,p){p=h("./Shared");var g=h("./Path");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(a,e,d){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(e&&e.unique?e.unique:!1);void 0!==a&&this.keys(a);void 0!==d&&this.collection(d);this.name(e&&e.name?e.name:this._id)};p.modules.Index=h;h.prototype.id=function(){return this._id};h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};
h.prototype.data=function(a){return void 0!==a?(this._data=a,this):this._data};h.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};h.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};h.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new g).parse(this._keys).length,this):this._keys};h.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};h.prototype.unique=function(a){return void 0!==
a?(this._unique=a,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},{decouple:!1,sort:this._keys}).find(),e,d=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(e=0;e<d;e++)this.insert(a[e])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(a,e){var d,g;this._unique&&(d=this._itemHash(a,this._keys),this._uniqueLookup[d]=a);d=this._itemHashArr(a,this._keys);
for(g=0;g<d.length;g++)this.pushToPathValue(d[g],a)};h.prototype.remove=function(a,e){var d,g;this._unique&&(d=this._itemHash(a,this._keys),delete this._uniqueLookup[d]);d=this._itemHashArr(a,this._keys);for(g=0;g<d.length;g++)this.pullFromPathValue(d[g],a)};h.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};h.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};h.prototype.pushToPathValue=function(a,e){var d=this._data[a]=
this._data[a]||[];-1===d.indexOf(e)&&(d.push(e),this._size++,this.pushToCrossRef(e,d))};h.prototype.pullFromPathValue=function(a,e){var d=this._data[a],g;g=d.indexOf(e);-1<g&&(d.splice(g,1),this._size--,this.pullFromCrossRef(e,d));d.length||delete this._data[a]};h.prototype.pull=function(a){var e=a[this._collection.primaryKey()],d=this._crossRef[e],g,h=d.length,c;for(g=0;g<h;g++)c=d[g],this._pullFromArray(c,a);this._size--;delete this._crossRef[e]};h.prototype._pullFromArray=function(a,e){for(var d=
a.length;d--;)a[d]===e&&a.splice(d,1)};h.prototype.pushToCrossRef=function(a,e){var d=a[this._collection.primaryKey()];this._crossRef[d]=this._crossRef[d]||[];d=this._crossRef[d];-1===d.indexOf(e)&&d.push(e)};h.prototype.pullFromCrossRef=function(a,e){var d=a[this._collection.primaryKey()];delete this._crossRef[d]};h.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};h.prototype.match=function(a,e){return(new g).countObjectPaths(this._keys,a)};h.prototype._itemHash=
function(a,e){var d=new g,k,h="",c;k=d.parse(e);for(c=0;c<k.length;c++)h&&(h+="_"),h+=d.value(a,k[c].path).join(":");return h};h.prototype._itemKeyHash=function(a,e){var d=new g,k,h="",c;k=d.parse(e);for(c=0;c<k.length;c++)h&&(h+="_"),h+=d.keyValue(a,k[c].path);return h};h.prototype._itemHashArr=function(a,e){var d=new g,k,h=[],c,b,f,m;k=d.parse(e);for(f=0;f<k.length;f++)for(c=d.value(a,k[f].path),b=0;b<c.length;b++)if(0===f)h.push(c[b]);else for(m=0;m<h.length;m++)h[m]=h[m]+"_"+c[b];return h};r.exports=
h},{"./Path":10,"./Shared":11}],6:[function(h,r,p){h=h("./Shared");p=function(g){this.init.apply(this,arguments)};p.prototype.init=function(g){this._name=g;this._data={};this._primaryKey="_id"};h.modules.KeyValueStore=p;p.prototype.name=function(g){return void 0!==g?(this._name=g,this):this._name};p.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey=g,this):this._primaryKey};p.prototype.truncate=function(){this._data={};return this};p.prototype.set=function(g,a){this._data[g]=a?
a:!0;return this};p.prototype.get=function(g){return this._data[g]};p.prototype.lookup=function(g){g=g[this._primaryKey];var a,e,d,k;if(g instanceof Array){e=g.length;k=[];for(a=0;a<e;a++)(d=this._data[g[a]])&&k.push(d);return k}if(g instanceof RegExp){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&g.test(a)&&k.push(this._data[a]);return k}if("object"===typeof g){if(g.$ne){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==g.$ne&&k.push(this._data[a]);return k}if(g.$in&&g.$in instanceof
Array){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<g.$in.indexOf(a)&&k.push(this._data[a]);return k}if(g.$nin&&g.$nin instanceof Array){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===g.$nin.indexOf(a)&&k.push(this._data[a]);return k}if(g.$or&&g.$or instanceof Array){k=[];for(a=0;a<g.$or.length;a++)k=k.concat(this.lookup(g.$or[a]));return k}}else return d=this._data[g],void 0!==d?[d]:[]};p.prototype.unSet=function(g){delete this._data[g];return this};p.prototype.uniqueSet=
function(g,a){return void 0===this._data[g]?(this._data[g]=a,!0):!1};r.exports=p},{"./Shared":11}],7:[function(h,r,p){p=h("./Shared");var g=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};p.modules.Metrics=h;h.prototype.create=function(a){a=new g(a);this._enabled&&this._data.push(a);return a};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};h.prototype.clear=function(){this._data=
[];return this};h.prototype.list=function(){return this._data};r.exports=h},{"./Operation":8,"./Shared":11}],8:[function(h,r,p){p=h("./Shared");var g=h("./Path");h=function(a){this.pathSolver=new g;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};p.modules.Operation=h;h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=
function(a){if(a){var e=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);e&&(a.delta=a.time-e);return this}return this._data.log};h.prototype.time=function(a){if(void 0!==a){var e=this._data.time.process,e=e[a]=e[a]||{};e.startMs?(e.stopMs=(new Date).getTime(),e.totalMs=e.stopMs-e.startMs,e.stepObj.totalMs=e.totalMs,delete e.stepObj):(e.startMs=(new Date).getTime(),e.stepObj={name:a},this._data.steps.push(e.stepObj));
return this}return this._data.time};h.prototype.flag=function(a,e){if(void 0!==a&&void 0!==e)this._data.flag[a]=e;else return void 0!==a?this._data.flag[a]:this._data.flag};h.prototype.data=function(a,e,d){return void 0!==e?(this.pathSolver.set(this._data,a,e),this):this.pathSolver.get(this._data,a)};h.prototype.pushData=function(a,e,d){this.pathSolver.push(this._data,a,e)};h.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};
r.exports=h},{"./Path":10,"./Shared":11}],9:[function(h,r,p){p=function(g){if(g){var a,e=g.length;return function(){for(a=0;a<e;a++)if(g[a].length===arguments.length)return g[a].apply(this,arguments);return null}}return function(){}};h("./Shared").modules.Overload=p;r.exports=p},{"./Shared":11}],10:[function(h,r,p){h=h("./Shared");p=function(g){this.init.apply(this,arguments)};p.prototype.init=function(g){g&&this.path(g)};h.modules.Path=p;p.prototype.path=function(g){return void 0!==g?(this._path=
this.clean(g),this._pathParts=this._path.split("."),this):this._path};p.prototype.hasObjectPaths=function(g,a){var e=!0,d;for(d in g)if(g.hasOwnProperty(d)&&(void 0===a[d]||"object"===typeof g[d]&&(e=this.hasObjectPaths(g[d],a[d]),!e)))return!1;return e};p.prototype.countKeys=function(g){var a=0,e;for(e in g)g.hasOwnProperty(e)&&void 0!==g[e]&&("object"!==typeof g[e]?a++:a+=this.countKeys(g[e]));return a};p.prototype.countObjectPaths=function(g,a){var e,d={},k=0,h=0,c;for(c in a)a.hasOwnProperty(c)&&
("object"===typeof a[c]?(e=this.countObjectPaths(g[c],a[c]),d[c]=e.matchedKeys,h+=e.totalKeyCount,k+=e.matchedKeyCount):(h++,g&&g[c]&&"object"!==typeof g[c]?(d[c]=!0,k++):d[c]=!1));return{matchedKeys:d,matchedKeyCount:k,totalKeyCount:h}};p.prototype.parse=function(g,a){var e=[],d="",h,n,c;for(n in g)if(g.hasOwnProperty(n))if(d=n,"object"===typeof g[n])if(a)for(h=this.parse(g[n],a),c=0;c<h.length;c++)e.push({path:d+"."+h[c].path,value:h[c].value});else for(h=this.parse(g[n]),c=0;c<h.length;c++)e.push({path:d+
"."+h[c].path});else a?e.push({path:d,value:g[n]}):e.push({path:d});return e};p.prototype.parseArr=function(g,a){a=a||{};return this._parseArr(g,"",[],a)};p.prototype._parseArr=function(g,a,e,d){var h,n="";a=a||"";e=e||[];for(h in g)g.hasOwnProperty(h)&&(!d.ignore||d.ignore&&!d.ignore.test(h))&&(n=a?a+"."+h:h,"object"===typeof g[h]?this._parseArr(g[h],n,e,d):e.push(n));return e};p.prototype.value=function(g,a){if(void 0!==g&&"object"===typeof g){var e,d,h,n,c=[],b;void 0!==a&&(a=this.clean(a),e=a.split("."));
e=e||this._pathParts;d=e.length;h=g;for(b=0;b<d;b++){h=h[e[b]];if(n instanceof Array){for(d=0;d<n.length;d++)c=c.concat(this.value(n,d+"."+e[b]));return c}if(!h||"object"!==typeof h)break;n=h}return[h]}return[]};p.prototype.set=function(g,a,e){if(void 0!==g&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();a.length?(g[d]=g[d]||{},this.set(g[d],a.join("."),e)):g[d]=e}return g};p.prototype.get=function(g,a){return this.value(g,a)[0]};p.prototype.push=function(g,a,e){if(void 0!==g&&void 0!==
a){var d;a=this.clean(a);a=a.split(".");d=a.shift();if(a.length)g[d]=g[d]||{},this.set(g[d],a.join("."),e);else if(g[d]=g[d]||[],g[d]instanceof Array)g[d].push(e);else throw"Cannot push to a path whose endpoint is not an array!";}return g};p.prototype.keyValue=function(g,a){var e,d,h,n,c;void 0!==a&&(a=this.clean(a),e=a.split("."));e=e||this._pathParts;d=e.length;h=g;for(c=0;c<d;c++)if(h=h[e[c]],!h||"object"!==typeof h){n=e[c]+":"+h;break}return n};p.prototype.clean=function(g){"."===g.substr(0,1)&&
(g=g.substr(1,g.length-1));return g};r.exports=p},{"./Shared":11}],11:[function(h,r,p){r.exports={idCounter:0,modules:{},prototypes:{}}},{}]},{},[1])(1)});
