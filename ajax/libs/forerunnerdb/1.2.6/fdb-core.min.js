!function(w){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=w();else if("function"==typeof define&&define.amd)define([],w);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.ForerunnerDB=w()}}(function(){return function g(p,k,c){function a(d,q){if(!k[d]){if(!p[d]){var f="function"==typeof require&&require;if(!q&&f)return f(d,!0);if(l)return l(d,!0);f=Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",
f;}f=k[d]={exports:{}};p[d][0].call(f.exports,function(b){var e=p[d][1][b];return a(e?e:b)},f,f.exports,g,p,k,c)}return k[d].exports}for(var l="function"==typeof require&&require,d=0;d<c.length;d++)a(c[d]);return a}({1:[function(g,p,k){g=g("../lib/Core");p.exports=g},{"../lib/Core":3}],2:[function(g,p,k){var c,a,l,d,h,q;c=g("./Shared");var f=function(b){this.init.apply(this,arguments)};f.prototype.init=function(b){this._primaryKey="_id";this._primaryIndex=new l("primary");this._primaryCrc=new l("primaryCrc");
this._crcLookup=new l("crcLookup");this._name=b;this._data=[];this._groups=[];this._metrics=new a;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};c.modules.Collection=f;k=g("./Overload");a=g("./Metrics");l=g("./KeyValueStore");d=g("./Path");h=g("./Index");q=g("./Crc");g=c.modules.Core;f.prototype.debug=new k([function(){return this._debug.all},
function(b){if(void 0!==b){if("boolean"===typeof b){this._debug.all=b;for(var e=0;e<this._views.length;e++)this._views[e].debug(b);return this}return this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]||this._debug.all}return this._debug.all},function(b,e){if(void 0!==b){if(void 0!==e){this._debug[b]=e;for(var n=0;n<this._views.length;n++)this._views[n].debug(b,e);return this}return this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]}return this._debug.all}]);f.prototype.crc=q;
f.prototype.name=function(b){return void 0!==b?(this._name=b,this):this._name};f.prototype.on=new k([function(b,e){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||[];this._listeners[b]["*"].push(e);return this},function(b,e,n){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][e]=this._listeners[b][e]||[];this._listeners[b][e].push(n);return this}]);f.prototype.off=new k([function(b){this._listeners&&
this._listeners[b]&&b in this._listeners&&delete this._listeners[b];return this},function(b,e){var n,a;"string"===typeof e?this._listeners&&this._listeners[b]&&this._listeners[b][e]&&delete this._listeners[b][e]:b in this._listeners&&(n=this._listeners[b]["*"],a=n.indexOf(e),-1<a&&n.splice(a,1));return this},function(b,e,n){this._listeners&&b in this._listeners&&(b=this._listeners[b][e],n=b.indexOf(n),-1<n&&b.splice(n,1))}]);f.prototype.emit=function(b,e){this._listeners=this._listeners||{};if(b in
this._listeners){if(this._listeners[b]["*"]){var n=this._listeners[b]["*"],a=n.length,r;for(r=0;r<a;r++)n[r].apply(this,Array.prototype.slice.call(arguments,1))}if(e instanceof Array&&e[0]&&e[0][this._primaryKey]){var n=this._listeners[b],d,f,a=e.length;for(r=0;r<a;r++)if(n[e[r][this._primaryKey]])for(d=n[e[r][this._primaryKey]].length,f=0;f<d;f++)n[e[r][this._primaryKey]][f].apply(this,Array.prototype.slice.call(arguments,1))}}return this};f.prototype.drop=function(){if(this._db&&this._name){this.debug()&&
console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var b=[],e;for(e=0;e<this._groups.length;e++)b.push(this._groups[e]);for(e=0;e<b.length;e++)this._groups[e].removeCollection(this);return!0}return!1};f.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=b,this._primaryIndex.primaryKey(b),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};f.prototype._onInsert=function(b,e){this.emit("insert",b,e)};f.prototype._onUpdate=function(b){this.emit("update",
b)};f.prototype._onRemove=function(b){this.emit("remove",b)};f.prototype.db=function(b){return void 0!==b?(this._db=b,this):this._db};f.prototype.setData=function(b,e,n){if(b){var a=this._metrics.create("setData");a.start();e=e||{};e.decouple=void 0!==e.decouple?e.decouple:!0;e.decouple&&(b=this.decouple(b));b instanceof Array||(b=[b]);a.time("transformIn");b=this.transformIn(b);a.time("transformIn");var r=this._data;this._data=[];b.length&&(this._data=this._data.concat(b));a.time("_rebuildPrimaryKeyIndex");
this._rebuildPrimaryKeyIndex(e);a.time("_rebuildPrimaryKeyIndex");a.stop();this.emit("setData",this._data,r)}n&&n(!1);return this};f.prototype._rebuildPrimaryKeyIndex=function(b){var e=b&&void 0!==b.ensureKeys?b.ensureKeys:!0;b=b&&void 0!==b.violationCheck?b.violationCheck:!0;var n,a,r,d=this._primaryIndex,f=this._primaryCrc,l=this._crcLookup,c=this._primaryKey,h;d.truncate();f.truncate();l.truncate();n=this._data;for(a=n.length;a--;)if(r=n[a],e&&this._ensurePrimaryKey(r),b){if(!d.uniqueSet(r[c],
r))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+r[this._primaryKey];}else h=JSON.stringify(r),d.set(r[c],r),f.set(r[c],h),l.set(h,r)};f.prototype._ensurePrimaryKey=function(b){void 0===b[this._primaryKey]&&(b[this._primaryKey]=this.objectId())};f.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};f.prototype.upsert=function(b,e){if(b){var n=
this._deferQueue.upsert,a=this._deferThreshold.upsert,d={},f;if(b instanceof Array){if(b.length>a){this._deferQueue.upsert=n.concat(b);this.processQueue("upsert",e);return}d=[];for(n=0;n<b.length;n++)d.push(this.upsert(b[n]));e&&e();return d}b[this._primaryKey]?(f={},f[this._primaryKey]=b[this._primaryKey],this.count(f)?d.op="update":d.op="insert"):d.op="insert";switch(d.op){case "insert":d.result=this.insert(b);break;case "update":d.result=this.update(f,b)}return d}e&&e()};f.prototype.update=function(b,
e,n){e=this.decouple(e);e=this.transformIn(e);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var a=this,d=this._metrics.create("update"),f=this._primaryKey,l,c,h=function(d){if(e&&void 0!==e[f]&&e[f]!=d[f]){a._primaryIndex.unSet(d[f]);var l=a._updateObject(d,e,b,n,"");if(a._primaryIndex.uniqueSet(d[f],d))return l;throw"Primary key violation in update! Key violated: "+d[f];}return a._updateObject(d,e,b,n,"")},g=this._views;d.start();d.time("Retrieve documents to update");
l=this.find(b,{decouple:!1});d.time("Retrieve documents to update");if(l.length&&(d.time("Update documents"),c=l.filter(h),d.time("Update documents"),c.length)){if(g&&g.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());d.time("Inform views of update");for(l=0;l<g.length;l++)g[l].update(b,e);d.time("Inform views of update")}this._onUpdate(c);this.deferEmit("change",{type:"update",data:c})}d.stop();return c||[]};f.prototype.updateById=function(b,e){var n={};n[this._primaryKey]=
b;return this.update(n,e)};f.prototype._updateObject=function(b,e,n,a,f,l){e=this.decouple(e);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var c=!1,h=!1,g,q,k,m;for(m in e)if(e.hasOwnProperty(m)){g=!1;if("$"===m.substr(0,1))switch(m){case "$index":break;default:g=!0,(h=this._updateObject(b,e[m],n,a,f,m))&&(c=!0)}if(this._isPositionalKey(m)&&(g=!0,m=m.substr(0,m.length-2),h=new d(f+"."+m),b[m]&&b[m]instanceof Array&&b[m].length)){q=[];for(k=0;k<b[m].length;k++)this._match(b[m][k],h.value(n)[0])&&
q.push(k);for(k=0;k<q.length;k++)(h=this._updateObject(b[m][q[k]],e[m+".$"],n,a,f+"."+m,l))&&(c=!0)}if(!g)if(l||"object"!==typeof e[m])switch(l){case "$inc":this._updateIncrement(b,m,e[m]);c=!0;break;case "$push":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array){if(void 0!==e[m].$position&&e[m].$each instanceof Array)for(h=e[m].$position,g=e[m].$each.length,k=0;k<g;k++)this._updateSplicePush(b[m],h+k,e[m].$each[k]);else if(e[m].$each instanceof Array)for(g=e[m].$each.length,k=0;k<g;k++)this._updatePush(b[m],
e[m].$each[k]);else this._updatePush(b[m],e[m]);c=!0}else throw"Cannot push to a key that is not an array! ("+m+")";break;case "$pull":if(b[m]instanceof Array){q=[];for(k=0;k<b[m].length;k++)this._match(b[m][k],e[m])&&q.push(k);for(g=q.length;g--;)this._updatePull(b[m],q[g]),c=!0}break;case "$pullAll":if(b[m]instanceof Array)if(e[m]instanceof Array){if(q=b[m],g=q.length,0<g)for(;g--;){for(h=0;h<e[m].length;h++)q[g]===e[m][h]&&(this._updatePull(b[m],g),g--,c=!0);if(0>g)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+
m+")";break;case "$addToSet":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array){k=b[m];var p;q=k.length;var t;g=!0;p=a&&a.$addToSet;var s;p&&p.key?(h=!1,s=new d(p.key),t=s.value(e[m])[0]):(t=JSON.stringify(e[m]),h=!0);for(p=0;p<q;p++)if(h){if(JSON.stringify(k[p])===t){g=!1;break}}else if(t===s.value(k[p])[0]){g=!1;break}g&&(this._updatePush(b[m],e[m]),c=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array)if(h=
e.$index,void 0!==h)delete e.$index,this._updateSplicePush(b[m],h,e[m]),c=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+m+")";break;case "$move":if(b[m]instanceof Array)for(k=0;k<b[m].length;k++){if(this._match(b[m][k],e[m])){c=e[m].$index;if(void 0!==c)this._updateSpliceMove(b[m],k,c),c=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+m+")";
break;case "$mul":this._updateMultiply(b,m,e[m]);c=!0;break;case "$rename":this._updateRename(b,m,e[m]);c=!0;break;case "$unset":this._updateUnset(b,m);c=!0;break;case "$pop":if(b[m]instanceof Array)this._updatePop(b[m],e[m])&&(c=!0);else throw"Cannot pop from a key that is not an array! ("+m+")";break;default:b[m]!==e[m]&&(this._updateProperty(b,m,e[m]),c=!0)}else if(null!==b[m]&&"object"===typeof b[m])if(k=b[m]instanceof Array,q=e[m]instanceof Array,k||q)if(!q&&k)for(k=0;k<b[m].length;k++)(h=this._updateObject(b[m][k],
e[m],n,a,f+"."+m,l))&&(c=!0);else b[m]!==e[m]&&(this._updateProperty(b,m,e[m]),c=!0);else(h=this._updateObject(b[m],e[m],n,a,f+"."+m,l))&&(c=!0);else b[m]!==e[m]&&(this._updateProperty(b,m,e[m]),c=!0)}return c};f.prototype._isPositionalKey=function(b){return".$"===b.substr(b.length-2,2)};f.prototype._updateProperty=function(b,e,n){this._linked?($.observable(b).setProperty(e,n),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+e+'" for collection "'+this.name()+
'"')):(b[e]=n,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+e+'" for collection "'+this.name()+'"'))};f.prototype._updateIncrement=function(b,e,n){this._linked?$.observable(b).setProperty(e,b[e]+n):b[e]+=n};f.prototype._updateSpliceMove=function(b,e,n){this._linked?($.observable(b).move(e,n),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+e+'" to "'+n+'" for collection "'+this.name()+'"')):(b.splice(n,
0,b.splice(e,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+e+'" to "'+n+'" for collection "'+this.name()+'"'))};f.prototype._updateSplicePush=function(b,e,n){b.length>e?this._linked?$.observable(b).insert(e,n):b.splice(e,0,n):this._linked?$.observable(b).insert(n):b.push(n)};f.prototype._updatePush=function(b,e){this._linked?$.observable(b).insert(e):b.push(e)};f.prototype._updatePull=function(b,e){this._linked?$.observable(b).remove(e):
b.splice(e,1)};f.prototype._updateMultiply=function(b,e,n){this._linked?$.observable(b).setProperty(e,b[e]*n):b[e]*=n};f.prototype._updateRename=function(b,e,n){var a=b[e];this._linked?($.observable(b).setProperty(n,a),$.observable(b).removeProperty(e)):(b[n]=a,delete b[e])};f.prototype._updateUnset=function(b,e){this._linked?$.observable(b).removeProperty(e):delete b[e]};f.prototype._updatePop=function(b,e){var n,a=!1;0<b.length&&(this._linked?(1===e?n=b.length-1:-1===e&&(n=0),-1<n&&($.observable(arr).remove(n),
a=!0)):1===e?(b.pop(),a=!0):-1===e&&(b.shift(),a=!0));return a};f.prototype.remove=function(b){var e,n,a=this._views,d;if(b instanceof Array){a=[];for(e=0;e<b.length;e++)a.push(this.remove(b[e]));return a}e=this.find(b,{decouple:!1});if(e.length){for(d=0;d<e.length;d++)n=e[d],this._removeIndex(n),n=this._data.indexOf(n),this._linked?$.observable(this._data).remove(n):this._data.splice(n,1);if(a&&a.length)for(d=0;d<a.length;d++)a[d].remove(b);this._onRemove(e);this.deferEmit("change",{type:"remove",
data:e})}return e};f.prototype.removeById=function(b){var e={};e[this._primaryKey]=b;return this.remove(e)};f.prototype.deferEmit=function(){var b=this,e;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(e=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+e[0]);b.emit.apply(b,e)},100))};f.prototype.processQueue=function(b,e){var n=this._deferQueue[b],
a=this._deferThreshold[b],d=this._deferTime[b];if(n.length){var f=this;n.length&&(n=n.length>a?n.splice(0,a):n.splice(0,n.length),this[b](n));setTimeout(function(){f.processQueue(b,e)},d)}else e&&e()};f.prototype.insert=function(b,e,n){"function"===typeof e?(n=e,e=this._data.length):void 0===e&&(e=this._data.length);b=this.transformIn(b);return this._insertHandle(b,e,n)};f.prototype._insertHandle=function(b,e,n){var a=this._deferQueue.insert,d=this._deferThreshold.insert,f=[],c=[],l=this._views;if(b instanceof
Array){if(b.length>d){this._deferQueue.insert=a.concat(b);this.processQueue("insert",n);return}for(d=0;d<b.length;d++)a=this._insert(b[d],e+d),!0===a?f.push(b[d]):c.push({doc:b[d],reason:a})}else a=this._insert(b,e),!0===a?f.push(b):c.push({doc:b,reason:a});if(l&&l.length)for(a=0;a<l.length;a++)l[a].insert(b,e);this._onInsert(f,c);n&&n();this.deferEmit("change",{type:"insert",data:f});return{inserted:f,failed:c}};f.prototype._insert=function(b,e){if(b){var n;this._ensurePrimaryKey(b);if(n=this.insertIndexViolation(b))return"Index violation in index: "+
n;this._insertIndex(b);this._linked?$.observable(this._data).insert(e,b):this._data.splice(e,0,b);return!0}return"No document passed to insert"};f.prototype._insertIndex=function(b){var e=this._indexByName,n,a=JSON.stringify(b);this._primaryIndex.uniqueSet(b[this._primaryKey],b);this._primaryCrc.uniqueSet(b[this._primaryKey],a);this._crcLookup.uniqueSet(a,b);for(n in e)e.hasOwnProperty(n)&&e[n].insert(b)};f.prototype._removeIndex=function(b){var e=this._indexByName,a,d=JSON.stringify(b);this._primaryIndex.unSet(b[this._primaryKey]);
this._primaryCrc.unSet(b[this._primaryKey]);this._crcLookup.unSet(d);for(a in e)e.hasOwnProperty(a)&&e[a].remove(b)};f.prototype.subset=function(b,e){var a=this.find(b,e);return(new f)._subsetOf(this).primaryKey(this._primaryKey).setData(a)};f.prototype.subsetOf=function(){return this.__subsetOf};f.prototype._subsetOf=function(b){this.__subsetOf=b;return this};f.prototype.distinct=function(b,e,a){e=this.find(e,a);b=new d(b);a={};var f=[],c,l;for(l=0;l<e.length;l++)(c=b.value(e[l])[0])&&!a[c]&&(a[c]=
!0,f.push(c));return f};f.prototype.decouple=function(b){return JSON.parse(JSON.stringify(b))};f.prototype.findById=function(b,e){var a={};a[this._primaryKey]=b;return this.find(a,e)[0]};f.prototype.peek=function(b,e){var a=this._data,d=a.length,c,l,h=new f;if("string"===typeof b){for(c=0;c<d;c++)l=JSON.stringify(a[c]),-1<l.indexOf(b)&&h.insert(a[c]);return h.find({},e)}return this.find(b,e)};f.prototype.explain=function(b,e){return this.find(b,e).__fdbOp._data};f.prototype.find=function(b,e){b=b||
{};e=e||{};e.decouple=void 0!==e.decouple?e.decouple:!0;var a=this._metrics.create("find"),f=this,c,l=!0,h,g,k,q,p,m,u,t,s,v=[];g=function(e){return f._match(e,b,"and")};a.start();if(b){a.time("analyseQuery");c=this._analyseQuery(b,e,a);a.time("analyseQuery");a.data("analysis",c);if(c.hasJoin&&c.queriesJoin){a.time("joinReferences");for(k=0;k<c.joinsOn.length;k++)p=c.joinsOn[k],q=new d(c.joinQueries[p]),q=q.value(b)[0],this._db.collection(c.joinsOn[k]).subset(q);a.time("joinReferences")}c.indexMatch.length&&
(!e||e&&!e.skipIndex)?(a.data("index.potential",c.indexMatch),a.data("index.used",c.indexMatch[0].index),a.time("indexLookup"),h=c.indexMatch[0].lookup,a.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===c.indexMatch[0].keyData.matchedKeyCount&&(l=!1)):a.flag("usedIndex",!1);l&&(h&&h.length?(c=h.length,a.time("tableScan: "+c),h=h.filter(g)):(c=this._data.length,a.time("tableScan: "+c),h=this._data.filter(g)),e.sort&&(a.time("sort"),h=this.sort(e.sort,h),a.time("sort")),a.time("tableScan: "+
c));e.limit&&h&&h.length>e.limit&&(h.length=e.limit,a.data("limit",e.limit));e.decouple&&(a.time("decouple"),h=this.decouple(h),a.time("decouple"),a.data("flag.decouple",!0));if(e.join){for(g=0;g<e.join.length;g++)for(p in e.join[g])if(e.join[g].hasOwnProperty(p))for(t=p,c=this._db.collection(p),l=e.join[g][p],s=0;s<h.length;s++){u={};q=k=!1;for(m in l)if(l.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":t=l[m];break;case "$multi":k=l[m];break;case "$require":q=l[m];break;default:m.substr(0,
3)}else u[m]=(new d(l[m])).value(h[s])[0];u=c.find(u);!q||q&&u[0]?h[s][t]=!1===k?u[0]:u:v.push(h[s])}a.data("flag.join",!0)}if(v.length){a.time("removalQueue");for(m=0;m<v.length;m++)p=h.indexOf(v[m]),-1<p&&h.splice(p,1);a.time("removalQueue")}if(e.transform){a.time("transform");for(m=0;m<h.length;m++)h.splice(m,1,e.transform(h[m]));a.time("transform");a.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(a.time("transformOut"),h=this.transformOut(h),a.time("transformOut"));a.data("results",
h.length);a.stop()}else a.stop(),h=[];h.__fdbOp=a;return h};f.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof
Array){var e=[],a;for(a=0;a<b.length;a++)e[a]=this._transformIn(b[a]);return e}return this._transformIn(b)}return b};f.prototype.transformOut=function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof Array){var e=[],a;for(a=0;a<b.length;a++)e[a]=this._transformOut(b[a]);return e}return this._transformOut(b)}return b};f.prototype.sort=function(b,e){e=e||[];var a=[],d,c;for(d in b)b.hasOwnProperty(d)&&(c={},c[d]=b[d],c.___fdbKey=d,a.push(c));return 2>a.length?this._sort(b,e):this._bucketSort(a,
e)};f.prototype._bucketSort=function(b,e){var a=b.shift(),d,c,f=[];if(0<b.length){e=this._sort(a,e);d=this.bucket(a.___fdbKey,e);for(c in d)d.hasOwnProperty(c)&&(a=[].concat(b),f=f.concat(this._bucketSort(a,d[c])));return f}return this._sort(a,e)};f.prototype._sort=function(b,e){var a=new d,c=a.parse(b,!0)[0];a.path(c.path);return e.sort(1===c.value?function(b,e){var d=a.value(b)[0],c=a.value(e)[0];return"string"===typeof d&&"string"===typeof c?d.localeCompare(c):d>c?1:d<c?-1:0}:function(b,e){var d=
a.value(b)[0],c=a.value(e)[0];return"string"===typeof d&&"string"===typeof c?1===d.localeCompare(c)?-1:1:d>c?-1:d<c?1:0})};f.prototype.bucket=function(b,e){var a,d={};for(a=0;a<e.length;a++)d[e[a][b]]=d[e[a][b]]||[],d[e[a][b]].push(e[a]);return d};f.prototype._analyseQuery=function(b,e,a){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:e},f,l=[],h=[],g,k,q,p,m;a.time("checkIndexes");void 0!==b[this._primaryKey]&&(a.time("checkIndexMatch: Primary Key"),
g=new d,c.indexMatch.push({lookup:this._primaryIndex.lookup(b,e),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:g.countKeys(b)},index:this._primaryIndex}),a.time("checkIndexMatch: Primary Key"));for(m in this._indexById)if(this._indexById.hasOwnProperty(m)&&(k=this._indexById[m],q=k.name(),a.time("checkIndexMatch: "+q),g=k.match(b,e),p=k.lookup(b,e),0<g.matchedKeyCount&&c.indexMatch.push({lookup:p,keyData:g,index:k}),a.time("checkIndexMatch: "+q),g.totalKeyCount===g.matchedKeyCount))break;
a.time("checkIndexes");1<c.indexMatch.length&&(a.time("findOptimalIndex"),c.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),a.time("findOptimalIndex"));if(e.join){c.hasJoin=!0;for(a=0;a<e.join.length;a++)for(f in e.join[a])e.join[a].hasOwnProperty(f)&&(l.push(f),
"$as"in e.join[a][f]?h.push(e.join[a][f].$as):h.push(f));for(f=0;f<h.length;f++)if(e=this._queryReferencesCollection(b,h[f],""))c.joinQueries[l[f]]=e,c.queriesJoin=!0;c.joinsOn=l;c.queriesOn=c.queriesOn.concat(l)}return c};f.prototype._queryReferencesCollection=function(b,a,d){for(var c in b)if(b.hasOwnProperty(c)){if(c===a)return d&&(d+="."),d+c;if("object"===typeof b[c])return d&&(d+="."),d+=c,this._queryReferencesCollection(b[c],a,d)}return!1};f.prototype._match=function(b,a,d){var c,f;c=typeof b;
f=typeof a;var l=!0,h;if(!("string"!==c&&"number"!==c||"string"!==f&&"number"!==f))b!==a&&(l=!1);else for(h in a)if(a.hasOwnProperty(h)){c=!1;if("$"===h.substr(0,1))switch(h){case "$gt":if(b>a[h]){if("or"===d)return!0}else l=!1;c=!0;break;case "$gte":if(b>=a[h]){if("or"===d)return!0}else l=!1;c=!0;break;case "$lt":if(b<a[h]){if("or"===d)return!0}else l=!1;c=!0;break;case "$lte":if(b<=a[h]){if("or"===d)return!0}else l=!1;c=!0;break;case "$exists":if(void 0===b!==a[h]){if("or"===d)return!0}else l=!1;
c=!0;break;case "$or":c=!0;for(f=0;f<a[h].length;f++){if(this._match(b,a[h][f],"and"))return!0;l=!1}break;case "$and":c=!0;for(f=0;f<a[h].length;f++)if(!this._match(b,a[h][f],"and"))return!1;break;case "$in":if(a[h]instanceof Array){c=a[h];f=c.length;var g,k=!1;for(g=0;g<f;g++)if(c[g]===b){k=!0;break}if(k){if("or"===d)return!0}else l=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;c=!0;break;case "$nin":if(a[h]instanceof Array){c=a[h];f=c.length;k=!0;for(g=0;g<f;g++)if(c[g]===b){k=
!1;break}if(k){if("or"===d)return!0}else l=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;c=!0;break;case "$ne":if(b!=a[h]){if("or"===d)return!0}else l=!1;c=!0}if(!c&&a[h]instanceof RegExp)if(c=!0,"object"===typeof b&&void 0!==b[h]&&a[h].test(b[h])){if("or"===d)return!0}else l=!1;if(!c)if("object"===typeof a[h])if(void 0!==b[h]){if(b[h]instanceof Array&&!(a[h]instanceof Array))for(c=!1,f=0;f<b[h].length&&!(c=this._match(b[h][f],a[h],void 0));f++);else if(!(b[h]instanceof Array)&&
a[h]instanceof Array)for(c=!1,f=0;f<a[h].length&&!(c=this._match(b[h],a[h][f],void 0));f++);else c="object"===typeof b?this._match(b[h],a[h],void 0):this._match(void 0,a[h],void 0);if(c){if("or"===d)return!0}else l=!1}else if(a[h]&&void 0!==a[h].$exists)if(c=this._match(void 0,a[h],void 0)){if("or"===d)return!0}else l=!1;else l=!1;else if(b&&b[h]===a[h]){if("or"===d)return!0}else if(b&&b[h]&&b[h]instanceof Array&&a[h]&&"object"!==typeof a[h]){c=!1;for(f=0;f<b[h].length&&!(c=this._match(b[h][f],a[h],
void 0));f++);if(c){if("or"===d)return!0}else l=!1}else l=!1;if("and"===d&&!l)return!1}return l};f.prototype.count=function(b,a){return b?this.find(b,a).length:this._data.length};f.prototype.link=function(b,a){this._links=this._links||{};if(!this._links[a]){if($(b).length){if(!$.templates[a]){var d=$(a);if(d.length)$.views.templates(a,$(d[0]).html());else throw"Unable to bind collection to target because template does not exist: "+a;}$.templates[a].link(b,this._data);this._links[a]=b;this._linked++;
this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+a;};f.prototype.unlink=function(b,a){this._links=this._links||{};if(this._links[a])return $.templates[a].unlink(b),delete this._links[a],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+
this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)};f.prototype.findSub=function(b,a,c,f){var h=new d(a);b=this.find(b);var l=b.length,g,k,q=this._db.collection("__FDB_temp_"+this.objectId()),p={parents:l,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(g=0;g<l;g++)if(k=h.value(b[g])[0]){q.setData(k);k=q.find(c,f);if(f.returnFirst&&k.length)return k[0];p.subDocs.push(k);p.subDocTotal+=k.length;p.pathFound=!0}q.drop();
if(f.noStats)return p.subDocs;p.pathFound||(p.err="No objects found in the parent documents with a matching path of: "+a);return p};f.prototype.insertIndexViolation=function(b){var a,d=this._indexByName,c,f;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(c in d)if(d.hasOwnProperty(c)&&(f=d[c],f.unique()&&f.violation(b))){a=f;break}return a?a.name():!1};f.prototype.ensureIndex=function(b,a){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var d=
new h(b,a,this),c={start:(new Date).getTime()};if(this._indexByName[d.name()])return{err:"Index with that name already exists"};if(this._indexById[d.id()])return{err:"Index with those keys already exists"};d.rebuild();this._indexByName[d.name()]=d;this._indexById[d.id()]=d;c.end=(new Date).getTime();c.total=c.end-c.start;this._lastOp={type:"ensureIndex",stats:{time:c}};return{index:d,id:d.id(),name:d.name(),state:d.state()}};f.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};
f.prototype.lastOp=function(){return this._metrics.list()};f.prototype.objectId=function(b){var a=Math.pow(10,17);if(b){var d=0,f=b.length,h;for(h=0;h<f;h++)d+=b.charCodeAt(h)*a;b=d.toString(16)}else c.idCounter++,b=(c.idCounter+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b};f.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},d=this.primaryKey(),c,f,h,l;if(d===b.primaryKey()){c=b._data;l=c.length;for(f=0;f<l;f++)h=c[f],this._primaryIndex.get(h[d])?
this._primaryCrc.get(h[d])!==b._primaryCrc.get(h[d])&&a.update.push(h):a.insert.push(h);c=this._data;l=c.length;for(f=0;f<l;f++)h=c[f],b._primaryIndex.get(h[d])||a.remove.push(h)}return a};g.prototype.collection=function(a,d){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new f(a)).db(this),void 0!==d&&this._collection[a].primaryKey(d),this._collection[a];throw"Cannot get collection with undefined name!";};g.prototype.collectionExists=
function(a){return Boolean(this._collection[a])};g.prototype.collections=function(){var a=[],d;for(d in this._collection)this._collection.hasOwnProperty(d)&&a.push({name:d,count:this._collection[d].count()});return a};p.exports=f},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Overload":9,"./Path":10,"./Shared":11}],3:[function(g,p,k){var c,a;c=g("./Shared.js");var l=function(){this.init.apply(this,arguments)};l.prototype.init=function(){this._collection={};this._debug={}};c.modules.Core=
l;k=g("./Overload.js");a=g("./Collection.js");g("./Metrics.js");g=g("./Crc.js");l.prototype._isServer=!1;l.prototype.isClient=function(){return!this._isServer};l.prototype.isServer=function(){return this._isServer};l.prototype.crc=g;l.prototype.isClient=function(){return!this._isServer};l.prototype.isServer=function(){return this._isServer};l.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};l.prototype.debug=new k([function(){return this._debug.all},function(a){return void 0!==
a&&"boolean"===typeof a?(this._debug.all=a,this):this._debug.all},function(a,c){return void 0!==a?void 0!==c?(this._debug[a]=c,this):this._debug[a]:this._debug.all}]);l.prototype.arrayToCollection=function(d){return(new a).setData(d)};l.prototype.on=function(a,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(c);return this};l.prototype.off=function(a,c){if(a in this._listeners){var l=this._listeners[a],f=l.indexOf(c);-1<f&&l.splice(f,1)}return this};
l.prototype.emit=function(a,c){this._listeners=this._listeners||{};if(a in this._listeners){var l=this._listeners[a],f=l.length,b;for(b=0;b<f;b++)l[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};l.prototype.objectId=function(a){var h,l,f=Math.pow(10,17),b;if(a){h=0;l=a.length;for(b=0;b<l;b++)h+=a.charCodeAt(b)*f;a=h.toString(16)}else c.idCounter++,a=(c.idCounter+(Math.random()*f+Math.random()*f+Math.random()*f+Math.random()*f)).toString(16);return a};l.prototype.peek=function(a){var c,
l,f=[],b=typeof a;for(c in this._collection)this._collection.hasOwnProperty(c)&&(l=this._collection[c],f="string"===b?f.concat(l.peek(a)):f.concat(l.find(a)));return f};l.prototype.peekCat=function(a){var c,l,f={},b,e=typeof a;for(c in this._collection)this._collection.hasOwnProperty(c)&&(l=this._collection[c],(b="string"===e?l.peek(a):l.find(a))&&b.length&&(f[l.name()]=b));return f};p.exports=l},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(g,
p,k){var c=function(){var a=[],c,d,h;for(d=0;256>d;d++){c=d;for(h=0;8>h;h++)c=c&1?3988292384^c>>>1:c>>>1;a[d]=c}return a}();p.exports=function(a){var l=-1,d;for(d=0;d<a.length;d++)l=l>>>8^c[(l^a.charCodeAt(d))&255];return(l^-1)>>>0}},{}],5:[function(g,p,k){k=g("./Shared");var c=g("./Path");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(a,c,d){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==a&&this.keys(a);
void 0!==d&&this.collection(d);this.name(c&&c.name?c.name:this._id)};k.modules.Index=g;g.prototype.id=function(){return this._id};g.prototype.state=function(){return this._state};g.prototype.size=function(){return this._size};g.prototype.data=function(a){return void 0!==a?(this._data=a,this):this._data};g.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};g.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};g.prototype.keys=function(a){return void 0!==
a?(this._keys=a,this._keyCount=(new c).parse(this._keys).length,this):this._keys};g.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};g.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};g.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},{decouple:!1,sort:this._keys}).find(),c,d=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<d;c++)this.insert(a[c])}this._state={name:this._name,keys:this._keys,
indexSize:this._size,built:new Date,updated:new Date,ok:!0}};g.prototype.insert=function(a,c){var d,h;this._unique&&(d=this._itemHash(a,this._keys),this._uniqueLookup[d]=a);d=this._itemHashArr(a,this._keys);for(h=0;h<d.length;h++)this.pushToPathValue(d[h],a)};g.prototype.remove=function(a,c){var d,h;this._unique&&(d=this._itemHash(a,this._keys),delete this._uniqueLookup[d]);d=this._itemHashArr(a,this._keys);for(h=0;h<d.length;h++)this.pullFromPathValue(d[h],a)};g.prototype.violation=function(a){a=
this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};g.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};g.prototype.pushToPathValue=function(a,c){var d=this._data[a]=this._data[a]||[];-1===d.indexOf(c)&&(d.push(c),this._size++,this.pushToCrossRef(c,d))};g.prototype.pullFromPathValue=function(a,c){var d=this._data[a],h;h=d.indexOf(c);-1<h&&(d.splice(h,1),this._size--,this.pullFromCrossRef(c,d));d.length||delete this._data[a]};g.prototype.pull=function(a){var c=
a[this._collection.primaryKey()],d=this._crossRef[c],h,g=d.length,f;for(h=0;h<g;h++)f=d[h],this._pullFromArray(f,a);this._size--;delete this._crossRef[c]};g.prototype._pullFromArray=function(a,c){for(var d=a.length;d--;)a[d]===c&&a.splice(d,1)};g.prototype.pushToCrossRef=function(a,c){var d=a[this._collection.primaryKey()];this._crossRef[d]=this._crossRef[d]||[];d=this._crossRef[d];-1===d.indexOf(c)&&d.push(c)};g.prototype.pullFromCrossRef=function(a,c){var d=a[this._collection.primaryKey()];delete this._crossRef[d]};
g.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};g.prototype.match=function(a,l){return(new c).countObjectPaths(this._keys,a)};g.prototype._itemHash=function(a,l){var d=new c,h,g="",f;h=d.parse(l);for(f=0;f<h.length;f++)g&&(g+="_"),g+=d.value(a,h[f].path).join(":");return g};g.prototype._itemKeyHash=function(a,l){var d=new c,h,g="",f;h=d.parse(l);for(f=0;f<h.length;f++)g&&(g+="_"),g+=d.keyValue(a,h[f].path);return g};g.prototype._itemHashArr=function(a,l){var d=
new c,h,g=[],f,b,e,k;h=d.parse(l);for(e=0;e<h.length;e++)for(f=d.value(a,h[e].path),b=0;b<f.length;b++)if(0===e)g.push(f[b]);else for(k=0;k<g.length;k++)g[k]=g[k]+"_"+f[b];return g};p.exports=g},{"./Path":10,"./Shared":11}],6:[function(g,p,k){g=g("./Shared");k=function(c){this.init.apply(this,arguments)};k.prototype.init=function(c){this._name=c;this._data={};this._primaryKey="_id"};g.modules.KeyValueStore=k;k.prototype.name=function(c){return void 0!==c?(this._name=c,this):this._name};k.prototype.primaryKey=
function(c){return void 0!==c?(this._primaryKey=c,this):this._primaryKey};k.prototype.truncate=function(){this._data={};return this};k.prototype.set=function(c,a){this._data[c]=a?a:!0;return this};k.prototype.get=function(c){return this._data[c]};k.prototype.lookup=function(c){c=c[this._primaryKey];var a,l,d,h;if(c instanceof Array){l=c.length;h=[];for(a=0;a<l;a++)(d=this._data[c[a]])&&h.push(d);return h}if(c instanceof RegExp){h=[];for(a in this._data)this._data.hasOwnProperty(a)&&c.test(a)&&h.push(this._data[a]);
return h}if("object"===typeof c){if(c.$ne){h=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==c.$ne&&h.push(this._data[a]);return h}if(c.$in&&c.$in instanceof Array){h=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<c.$in.indexOf(a)&&h.push(this._data[a]);return h}if(c.$nin&&c.$nin instanceof Array){h=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===c.$nin.indexOf(a)&&h.push(this._data[a]);return h}if(c.$or&&c.$or instanceof Array){h=[];for(a=0;a<c.$or.length;a++)h=h.concat(this.lookup(c.$or[a]));
return h}}else return d=this._data[c],void 0!==d?[d]:[]};k.prototype.unSet=function(c){delete this._data[c];return this};k.prototype.uniqueSet=function(c,a){return void 0===this._data[c]?(this._data[c]=a,!0):!1};p.exports=k},{"./Shared":11}],7:[function(g,p,k){k=g("./Shared");var c=g("./Operation");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(){this._data=[]};k.modules.Metrics=g;g.prototype.create=function(a){a=new c(a);this._enabled&&this._data.push(a);return a};g.prototype.start=
function(){this._enabled=!0;return this};g.prototype.stop=function(){this._enabled=!1;return this};g.prototype.clear=function(){this._data=[];return this};g.prototype.list=function(){return this._data};p.exports=g},{"./Operation":8,"./Shared":11}],8:[function(g,p,k){k=g("./Shared");var c=g("./Path");g=function(a){this.pathSolver=new c;this.counter=0;this.init.apply(this,arguments)};g.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,
totalMs:0,process:{}},flag:{},log:[]}};k.modules.Operation=g;g.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};g.prototype.log=function(a){if(a){var c=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);c&&(a.delta=a.time-c);return this}return this._data.log};g.prototype.time=function(a){if(void 0!==a){var c=this._data.time.process,c=c[a]=c[a]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=
c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj={name:a},this._data.steps.push(c.stepObj));return this}return this._data.time};g.prototype.flag=function(a,c){if(void 0!==a&&void 0!==c)this._data.flag[a]=c;else return void 0!==a?this._data.flag[a]:this._data.flag};g.prototype.data=function(a,c,d){return void 0!==c?(this.pathSolver.set(this._data,a,c),this):this.pathSolver.get(this._data,a)};g.prototype.pushData=function(a,c,d){this.pathSolver.push(this._data,
a,c)};g.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};p.exports=g},{"./Path":10,"./Shared":11}],9:[function(g,p,k){k=function(c){if(c){var a,g=c.length;return function(){for(a=0;a<g;a++)if(c[a].length===arguments.length)return c[a].apply(this,arguments);return null}}return function(){}};g("./Shared").modules.Overload=k;p.exports=k},{"./Shared":11}],10:[function(g,p,k){g=g("./Shared");k=function(c){this.init.apply(this,
arguments)};k.prototype.init=function(c){c&&this.path(c)};g.modules.Path=k;k.prototype.path=function(c){return void 0!==c?(this._path=this.clean(c),this._pathParts=this._path.split("."),this):this._path};k.prototype.hasObjectPaths=function(c,a){var g=!0,d;for(d in c)if(c.hasOwnProperty(d)&&(void 0===a[d]||"object"===typeof c[d]&&(g=this.hasObjectPaths(c[d],a[d]),!g)))return!1;return g};k.prototype.countKeys=function(c){var a=0,g;for(g in c)c.hasOwnProperty(g)&&void 0!==c[g]&&("object"!==typeof c[g]?
a++:a+=this.countKeys(c[g]));return a};k.prototype.countObjectPaths=function(c,a){var g,d={},h=0,k=0,f;for(f in a)a.hasOwnProperty(f)&&("object"===typeof a[f]?(g=this.countObjectPaths(c[f],a[f]),d[f]=g.matchedKeys,k+=g.totalKeyCount,h+=g.matchedKeyCount):(k++,c&&c[f]&&"object"!==typeof c[f]?(d[f]=!0,h++):d[f]=!1));return{matchedKeys:d,matchedKeyCount:h,totalKeyCount:k}};k.prototype.parse=function(c,a){var g=[],d="",h,k,f;for(k in c)if(c.hasOwnProperty(k))if(d=k,"object"===typeof c[k])if(a)for(h=this.parse(c[k],
a),f=0;f<h.length;f++)g.push({path:d+"."+h[f].path,value:h[f].value});else for(h=this.parse(c[k]),f=0;f<h.length;f++)g.push({path:d+"."+h[f].path});else a?g.push({path:d,value:c[k]}):g.push({path:d});return g};k.prototype.parseArr=function(c,a){a=a||{};return this._parseArr(c,"",[],a)};k.prototype._parseArr=function(c,a,g,d){var h,k="";a=a||"";g=g||[];for(h in c)c.hasOwnProperty(h)&&(!d.ignore||d.ignore&&!d.ignore.test(h))&&(k=a?a+"."+h:h,"object"===typeof c[h]?this._parseArr(c[h],k,g,d):g.push(k));
return g};k.prototype.value=function(c,a){if(void 0!==c&&"object"===typeof c){var g,d,h,k,f=[],b;void 0!==a&&(a=this.clean(a),g=a.split("."));g=g||this._pathParts;d=g.length;h=c;for(b=0;b<d;b++){h=h[g[b]];if(k instanceof Array){for(d=0;d<k.length;d++)f=f.concat(this.value(k,d+"."+g[b]));return f}if(!h||"object"!==typeof h)break;k=h}return[h]}return[]};k.prototype.set=function(c,a,g){if(void 0!==c&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();a.length?(c[d]=c[d]||{},this.set(c[d],a.join("."),
g)):c[d]=g}return c};k.prototype.get=function(c,a){return this.value(c,a)[0]};k.prototype.push=function(c,a,g){if(void 0!==c&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();if(a.length)c[d]=c[d]||{},this.set(c[d],a.join("."),g);else if(c[d]=c[d]||[],c[d]instanceof Array)c[d].push(g);else throw"Cannot push to a path whose endpoint is not an array!";}return c};k.prototype.keyValue=function(c,a){var g,d,h,k,f;void 0!==a&&(a=this.clean(a),g=a.split("."));g=g||this._pathParts;d=g.length;
h=c;for(f=0;f<d;f++)if(h=h[g[f]],!h||"object"!==typeof h){k=g[f]+":"+h;break}return k};k.prototype.clean=function(c){"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));return c};p.exports=k},{"./Shared":11}],11:[function(g,p,k){p.exports={idCounter:0,modules:{},prototypes:{}}},{}]},{},[1])(1)});
