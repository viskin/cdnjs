(function(Snap){Snap.plugin(function(Snap,Element,Paper,glob,Fragment){var zpd=function(options,cb){var me=this,root=me.node,rootChildNodes=me.node.childNodes,preUniqueId="snapsvgzpd-",state="none",svgRoot=null,stateTarget,stateOrigin,stateTf;me.gelem=document.createElementNS("http://www.w3.org/2000/svg","g");me.gelem.id=preUniqueId+me.id;root.appendChild(me.gelem);(function(){var index=0;while(rootChildNodes.length-1>index){if(!rootChildNodes[index]){index++;continue}me.gelem.appendChild(rootChildNodes[index])}})();me.pan=true;me.zoom=true;me.drag=false;me.zoomScale=.2;if(typeof options==="function"){cb=options}else if(typeof options==="object"){for(prop in options){me[prop]=options[prop]}}function setupHandlers(){root.onmouseup=handleMouseUp;root.onmousedown=handleMouseDown;root.onmousemove=handleMouseMove;if(navigator.userAgent.toLowerCase().indexOf("webkit")>=0)root.addEventListener("mousewheel",handleMouseWheel,false);else root.addEventListener("DOMMouseScroll",handleMouseWheel,false);if(cb)cb(null,me)}function getEventPoint(evt){var p=root.createSVGPoint();p.x=evt.clientX;p.y=evt.clientY;return p}function setCTM(element,matrix){var s="matrix("+matrix.a+","+matrix.b+","+matrix.c+","+matrix.d+","+matrix.e+","+matrix.f+")";element.setAttribute("transform",s)}function dumpMatrix(matrix){var s="[ "+matrix.a+", "+matrix.c+", "+matrix.e+"\n  "+matrix.b+", "+matrix.d+", "+matrix.f+"\n  0, 0, 1 ]";return s}function setAttributes(element,attributes){for(var i in attributes)element.setAttributeNS(null,i,attributes[i])}function handleMouseWheel(evt){if(!me.zoom)return;if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;var svgDoc=evt.target.ownerDocument;var delta;if(evt.wheelDelta)delta=evt.wheelDelta/360;else delta=evt.detail/-9;var z=Math.pow(1+me.zoomScale,delta);var g=svgDoc.getElementById(preUniqueId+me.id);var p=getEventPoint(evt);p=p.matrixTransform(g.getCTM().inverse());var k=root.createSVGMatrix().translate(p.x,p.y).scale(z).translate(-p.x,-p.y);setCTM(g,g.getCTM().multiply(k));if(typeof stateTf=="undefined")stateTf=g.getCTM().inverse();stateTf=stateTf.multiply(k.inverse())}function handleMouseMove(evt){if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;var svgDoc=evt.target.ownerDocument;var g=svgDoc.getElementById(preUniqueId+me.id);if(state=="pan"&&me.pan){var p=getEventPoint(evt).matrixTransform(stateTf);setCTM(g,stateTf.inverse().translate(p.x-stateOrigin.x,p.y-stateOrigin.y))}else if(state=="drag"&&me.drag){var p=getEventPoint(evt).matrixTransform(g.getCTM().inverse());setCTM(stateTarget,root.createSVGMatrix().translate(p.x-stateOrigin.x,p.y-stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));stateOrigin=p}}function handleMouseDown(evt){if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;var svgDoc=evt.target.ownerDocument;var g=svgDoc.getElementById(preUniqueId+me.id);if(evt.target.tagName=="svg"||!me.drag){state="pan";stateTf=g.getCTM().inverse();stateOrigin=getEventPoint(evt).matrixTransform(stateTf)}else{state="drag";stateTarget=evt.target;console.log(evt);stateTf=g.getCTM().inverse();stateOrigin=getEventPoint(evt).matrixTransform(stateTf)}}function handleMouseUp(evt){if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;var svgDoc=evt.target.ownerDocument;if(state=="pan"||state=="drag"){state=""}}setupHandlers()};Paper.prototype.zpd=zpd})})(Snap);