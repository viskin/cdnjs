(function(Snap){Snap.plugin(function(Snap,Element,Paper,glob,Fragment){var snapsvgzpd={uniqueIdPrefix:"snapsvg-zpd-",dataStore:{}};var rootSvgObject;var _removeNodeKeepChildren=function removeNodeKeepChildren(node){if(!node.parentNode){return}while(node.firstChild){node.parentNode.insertBefore(node.firstChild,node)}node.parentNode.removeChild(node)};var _increaseDecreaseOrNumber=function increaseDecreaseOrNumber(defaultValue,input){if(input===undefined){return parseInt(defaultValue)}else if(input[0]=="+"){return defaultValue+parseInt(input.split("+")[1])}else if(input[0]=="-"){return defaultValue-parseInt(input.split("-")[1])}else{return parseInt(input)}};var _setCTM=function setCTM(element,matrix,threshold){if(threshold&&typeof threshold==="object"){if(matrix.a<=threshold[0]){return}if(matrix.d>=threshold[1]){return}}var s="matrix("+matrix.a+","+matrix.b+","+matrix.c+","+matrix.d+","+matrix.e+","+matrix.f+")";element.setAttribute("transform",s)};var _dumpMatrix=function dumpMatrix(matrix){var s="[ "+matrix.a+", "+matrix.c+", "+matrix.e+"\n  "+matrix.b+", "+matrix.d+", "+matrix.f+"\n  0, 0, 1 ]";return s};var _getEventPoint=function getEventPoint(event,svgNode){var p=svgNode.node.createSVGPoint();p.x=event.clientX;p.y=event.clientY;return p};var _getSvgMatrixAsString=function _getMatrixAsString(matrix){return"matrix("+matrix.a+","+matrix.b+","+matrix.c+","+matrix.d+","+matrix.e+","+matrix.f+")"};var _initZpdElement=function initAndGetZpdElement(svgObject,options){rootSvgObject=svgObject.node;var rootChildNodes=svgObject.node.childNodes;var gElement=svgObject.g();var gNode=gElement.node;gNode.id=snapsvgzpd.uniqueIdPrefix+svgObject.id;if(options.load&&typeof options.load==="object"){var matrix=options.load;var matrixString="matrix("+matrix.a+","+matrix.b+","+matrix.c+","+matrix.d+","+matrix.e+","+matrix.f+")";gElement.transform(matrixString)}else{gElement.transform("matrix")}var index=0;var noOfChildNodes=rootChildNodes.length-1;while(index<noOfChildNodes){gNode.appendChild(rootChildNodes[0]);index+=1}var data={svg:svgObject,root:svgObject.node,state:"none",stateTarget:null,stateOrigin:null,stateTf:null};var item={element:gElement,data:data,options:options};item.handlerFunctions=_getHandlerFunctions(item);return item};var _getHandlerFunctions=function getHandlerFunctions(zpdElement){var handleMouseUp=function handleMouseUp(event){if(event.preventDefault){event.preventDefault()}event.returnValue=false;if(zpdElement.data.state=="pan"||zpdElement.data.state=="drag"){zpdElement.data.state=""}};var handleMouseDown=function handleMouseDown(event){if(event.preventDefault){event.preventDefault()}event.returnValue=false;var g=zpdElement.element.node;if(event.target.tagName=="svg"||!zpdElement.options.drag){zpdElement.data.state="pan";zpdElement.data.stateTf=g.getCTM().inverse();zpdElement.data.stateOrigin=_getEventPoint(event,zpdElement.data.svg).matrixTransform(zpdElement.data.stateTf)}else{zpdElement.data.state="drag";zpdElement.data.stateTarget=event.target;zpdElement.data.stateTf=g.getCTM().inverse();zpdElement.data.stateOrigin=_getEventPoint(event,zpdElement.data.svg).matrixTransform(zpdElement.data.stateTf)}};var handleMouseMove=function handleMouseMove(event){if(event.preventDefault){event.preventDefault()}event.returnValue=false;var g=zpdElement.element.node;if(zpdElement.data.state=="pan"&&zpdElement.options.pan){var p=_getEventPoint(event,zpdElement.data.svg).matrixTransform(zpdElement.data.stateTf);_setCTM(g,zpdElement.data.stateTf.inverse().translate(p.x-zpdElement.data.stateOrigin.x,p.y-zpdElement.data.stateOrigin.y))}else if(zpdElement.data.state=="drag"&&zpdElement.options.drag){var dragPoint=_getEventPoint(event,zpdElement.data.svg).matrixTransform(g.getCTM().inverse());_setCTM(zpdElement.data.stateTarget,zpdElement.data.root.createSVGMatrix().translate(dragPoint.x-zpdElement.data.stateOrigin.x,dragPoint.y-zpdElement.data.stateOrigin.y).multiply(g.getCTM().inverse()).multiply(zpdElement.data.stateTarget.getCTM()));zpdElement.data.stateOrigin=dragPoint}};var handleMouseWheel=function handleMouseWheel(event){if(!zpdElement.options.zoom){return}if(event.preventDefault){event.preventDefault()}event.returnValue=false;var delta=0;if(event.wheelDelta){delta=event.wheelDelta/360}else{delta=event.detail/-9}var z=Math.pow(1+zpdElement.options.zoomScale,delta);var g=zpdElement.element.node;var p=_getEventPoint(event,zpdElement.data.svg);p=p.matrixTransform(g.getCTM().inverse());var k=zpdElement.data.root.createSVGMatrix().translate(p.x,p.y).scale(z).translate(-p.x,-p.y);_setCTM(g,g.getCTM().multiply(k),zpdElement.options.zoomThreshold);if(typeof stateTf=="undefined"){zpdElement.data.stateTf=g.getCTM().inverse()}zpdElement.data.stateTf=zpdElement.data.stateTf.multiply(k.inverse())};return{mouseUp:handleMouseUp,mouseDown:handleMouseDown,mouseMove:handleMouseMove,mouseWheel:handleMouseWheel}};var _setupHandlers=function setupHandlers(svgElement,handlerFunctions){if("onmouseup"in document.documentElement){svgElement.addEventListener("mouseup",handlerFunctions.mouseUp,false);svgElement.addEventListener("mousedown",handlerFunctions.mouseDown,false);svgElement.addEventListener("mousemove",handlerFunctions.mouseMove,false);if(navigator.userAgent.toLowerCase().indexOf("webkit")>=0||navigator.userAgent.toLowerCase().indexOf("trident")>=0){svgElement.addEventListener("mousewheel",handlerFunctions.mouseWheel,false)}else{svgElement.addEventListener("DOMMouseScroll",handlerFunctions.mouseWheel,false)}}};var _tearDownHandlers=function tearDownHandlers(svgElement,handlerFunctions){svgElement.removeEventListener("mouseup",handlerFunctions.mouseUp,false);svgElement.removeEventListener("mousedown",handlerFunctions.mouseDown,false);svgElement.removeEventListener("mousemove",handlerFunctions.mouseMove,false);if(navigator.userAgent.toLowerCase().indexOf("webkit")>=0||navigator.userAgent.toLowerCase().indexOf("trident")>=0){svgElement.removeEventListener("mousewheel",handlerFunctions.mouseWheel,false)}else{svgElement.removeEventListener("DOMMouseScroll",handlerFunctions.mouseWheel,false)}};var zpd=function(options,callbackFunc){var self=this;var zpdOptions={pan:true,zoom:true,drag:false,zoomScale:.2,zoomThreshold:null};var situation,situationState={init:"init",reinit:"reinit",destroy:"destroy",save:"save",origin:"origin",callback:"callback"};var zpdElement=null;if(typeof options==="function"){callbackFunc=options;situation=situationState.callback}if(snapsvgzpd.dataStore.hasOwnProperty(self.id)){zpdElement=snapsvgzpd.dataStore[self.id];if(typeof options==="object"){for(var prop in options){zpdElement.options[prop]=options[prop]}situation=situationState.reinit}else if(typeof options==="string"){situation=options}}else{if(typeof options==="object"){for(var prop2 in options){zpdOptions[prop2]=options[prop2]}situation=situationState.init}else if(typeof options==="string"){situation=options}zpdElement=_initZpdElement(self,zpdOptions);_setupHandlers(self.node,zpdElement.handlerFunctions);snapsvgzpd.dataStore[self.id]=zpdElement}switch(situation){case situationState.init:case situationState.reinit:case situationState.callback:if(callbackFunc){callbackFunc(null,zpdElement)}return;case situationState.destroy:_tearDownHandlers(self.node,zpdElement.handlerFunctions);_removeNodeKeepChildren(self.node.firstChild);delete snapsvgzpd.dataStore[self.id];if(callbackFunc){callbackFunc(null,zpdElement)}return;case situationState.save:var g=document.getElementById(snapsvgzpd.uniqueIdPrefix+self.id);var returnValue=g.getCTM();if(callbackFunc){callbackFunc(null,returnValue)}return returnValue;case situationState.origin:self.zoomTo(1,1e3);if(callbackFunc){callbackFunc(null,zpdElement)}return}};var zoomTo=function(zoom,interval,ease,callbackFunction){if(zoom<0||typeof zoom!=="number"){console.error("zoomTo(arg) should be a number and greater than 0");return}if(typeof interval!=="number"){interval=3e3}var self=this;if(snapsvgzpd.dataStore.hasOwnProperty(self.id)){var zpdElement=snapsvgzpd.dataStore[self.id].element;var currentTransformMatrix=zpdElement.node.getTransformToElement(rootSvgObject);var currentZoom=currentTransformMatrix.a;var originX=currentTransformMatrix.e;var originY=currentTransformMatrix.f;var boundingBox=zpdElement.getBBox();var deltaX=parseFloat(boundingBox.width)/2;var deltaY=parseFloat(boundingBox.height)/2;Snap.animate(currentZoom,zoom,function(value){var deltaZoom=value/currentZoom;if(value!==currentZoom){currentTransformMatrix.e=originX-(deltaX*deltaZoom-deltaX);currentTransformMatrix.f=originY-(deltaY*deltaZoom-deltaY);currentTransformMatrix.a=value;currentTransformMatrix.d=value;zpdElement.node.setAttribute("transform",_getSvgMatrixAsString(currentTransformMatrix))}},interval,ease,callbackFunction)}};var panTo=function(x,y,interval,ease,cb){var self=this;if(snapsvgzpd.dataStore.hasOwnProperty(self.id)){var zpdElement=snapsvgzpd.dataStore[self.id].element;var gMatrix=zpdElement.node.getCTM(),matrixX=_increaseDecreaseOrNumber(gMatrix.e,x),matrixY=_increaseDecreaseOrNumber(gMatrix.f,y),matrixString="matrix("+gMatrix.a+","+gMatrix.b+","+gMatrix.c+","+gMatrix.d+","+matrixX+","+matrixY+")";zpdElement.animate({transform:matrixString},interval||10,ease||null,function(){if(cb){cb(null,zpdElement)}})}};var rotate=function(a,x,y,interval,ease,cb){var self=this;if(snapsvgzpd.dataStore.hasOwnProperty(self.id)){var zpdElement=snapsvgzpd.dataStore[self.id].element;var gMatrix=zpdElement.node.getCTM(),matrixString="matrix("+gMatrix.a+","+gMatrix.b+","+gMatrix.c+","+gMatrix.d+","+gMatrix.e+","+gMatrix.f+")";if(!x||typeof x!=="number"){x=self.node.offsetWidth/2}if(!y||typeof y!=="number"){y=self.node.offsetHeight/2}zpdElement.animate({transform:new Snap.Matrix(gMatrix).rotate(a,x,y)},interval||10,ease||null,function(){if(cb){cb(null,zpdElement)}})}};Paper.prototype.zpd=zpd;Paper.prototype.zoomTo=zoomTo;Paper.prototype.panTo=panTo;Paper.prototype.rotate=rotate})})(Snap);