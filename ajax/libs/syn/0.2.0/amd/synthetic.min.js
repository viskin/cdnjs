define(function(require,exports,module){var bind,unbind,schedule,activeElement,opts=window.syn?window.syn:{},extend=function(d,s){var p;for(p in s)d[p]=s[p];return d},browser={msie:!(!window.attachEvent||window.opera),opera:!!window.opera,webkit:navigator.userAgent.indexOf("AppleWebKit/")>-1,safari:navigator.userAgent.indexOf("AppleWebKit/")>-1&&-1===navigator.userAgent.indexOf("Chrome/"),gecko:navigator.userAgent.indexOf("Gecko")>-1,mobilesafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),rhino:navigator.userAgent.match(/Rhino/)&&!0},createEventObject=function(type,options,element){var event=element.ownerDocument.createEventObject();return extend(event,options)},data={},id=1,expando="_synthetic"+(new Date).getTime(),key=/keypress|keyup|keydown/,page=/load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll/,syn=function(type,element,options,callback){return new syn.init(type,element,options,callback)};syn.config=opts,syn.__tryFocus=function(element){try{element.focus()}catch(e){}},bind=function(el,ev,f){return el.addEventListener?el.addEventListener(ev,f,!1):el.attachEvent("on"+ev,f)},unbind=function(el,ev,f){return el.addEventListener?el.removeEventListener(ev,f,!1):el.detachEvent("on"+ev,f)},schedule=syn.config.schedule||function(fn,ms){setTimeout(fn,ms)},extend(syn,{init:function(type,element,options,callback){var args=syn.args(options,element,callback),self=this;this.queue=[],this.element=args.element,"function"==typeof this[type]?this[type](args.element,args.options,function(defaults,el){args.callback&&args.callback.apply(self,arguments),self.done.apply(self,arguments)}):(this.result=syn.trigger(args.element,type,args.options),args.callback&&args.callback.call(this,args.element,this.result))},jquery:function(el,fast){return window.FuncUnit&&window.FuncUnit.jQuery?window.FuncUnit.jQuery:el?syn.helpers.getWindow(el).jQuery||window.jQuery:window.jQuery},args:function(){for(var res={},i=0;i<arguments.length;i++)"function"==typeof arguments[i]?res.callback=arguments[i]:arguments[i]&&arguments[i].jquery?res.element=arguments[i][0]:arguments[i]&&arguments[i].nodeName?res.element=arguments[i]:res.options&&"string"==typeof arguments[i]?res.element=document.getElementById(arguments[i]):arguments[i]&&(res.options=arguments[i]);return res},click:function(element,options,callback){syn("click!",element,options,callback)},defaults:{focus:function(){if(!syn.support.focusChanges){var element=this,nodeName=element.nodeName.toLowerCase();syn.data(element,"syntheticvalue",element.value),("input"===nodeName||"textarea"===nodeName)&&bind(element,"blur",function blur(){syn.data(element,"syntheticvalue")!==element.value&&syn.trigger(element,"change",{}),unbind(element,"blur",blur)})}},submit:function(){syn.onParents(this,function(el){return"form"===el.nodeName.toLowerCase()?(el.submit(),!1):void 0})}},changeOnBlur:function(element,prop,value){bind(element,"blur",function onblur(){value!==element[prop]&&syn.trigger(element,"change",{}),unbind(element,"blur",onblur)})},closest:function(el,type){for(;el&&el.nodeName.toLowerCase()!==type.toLowerCase();)el=el.parentNode;return el},data:function(el,key,value){var d;return el[expando]||(el[expando]=id++),data[el[expando]]||(data[el[expando]]={}),d=data[el[expando]],value?void(data[el[expando]][key]=value):data[el[expando]][key]},onParents:function(el,func){for(var res;el&&res!==!1;)res=func(el),el=el.parentNode;return el},focusable:/^(a|area|frame|iframe|label|input|select|textarea|button|html|object)$/i,isFocusable:function(elem){var attributeNode;return elem.getAttributeNode&&(attributeNode=elem.getAttributeNode("tabIndex")),this.focusable.test(elem.nodeName)||attributeNode&&attributeNode.specified&&syn.isVisible(elem)},isVisible:function(elem){return elem.offsetWidth&&elem.offsetHeight||elem.clientWidth&&elem.clientHeight},tabIndex:function(elem){var attributeNode=elem.getAttributeNode("tabIndex");return attributeNode&&attributeNode.specified&&(parseInt(elem.getAttribute("tabIndex"))||0)},bind:bind,unbind:unbind,schedule:schedule,browser:browser,helpers:{createEventObject:createEventObject,createBasicStandardEvent:function(type,defaults,doc){var event;try{event=doc.createEvent("Events")}catch(e2){event=doc.createEvent("UIEvents")}finally{event.initEvent(type,!0,!0),extend(event,defaults)}return event},inArray:function(item,array){for(var i=0;i<array.length;i++)if(array[i]===item)return i;return-1},getWindow:function(element){return element.ownerDocument?element.ownerDocument.defaultView||element.ownerDocument.parentWindow:void 0},extend:extend,scrollOffset:function(win,set){var doc=win.document.documentElement,body=win.document.body;return set?void window.scrollTo(set.left,set.top):{left:(doc&&doc.scrollLeft||body&&body.scrollLeft||0)+(doc.clientLeft||0),top:(doc&&doc.scrollTop||body&&body.scrollTop||0)+(doc.clientTop||0)}},scrollDimensions:function(win){var doc=win.document.documentElement,body=win.document.body,docWidth=doc.clientWidth,docHeight=doc.clientHeight,compat="CSS1Compat"===win.document.compatMode;return{height:compat&&docHeight||body.clientHeight||docHeight,width:compat&&docWidth||body.clientWidth||docWidth}},addOffset:function(options,el){var off,jq=syn.jquery(el);"object"==typeof options&&void 0===options.clientX&&void 0===options.clientY&&void 0===options.pageX&&void 0===options.pageY&&jq&&(el=jq(el),off=el.offset(),options.pageX=off.left+el.width()/2,options.pageY=off.top+el.height()/2)}},key:{ctrlKey:null,altKey:null,shiftKey:null,metaKey:null},dispatch:function(event,element,type,autoPrevent){if(element.dispatchEvent&&event){var preventDefault=event.preventDefault,prevents=autoPrevent?-1:0;return autoPrevent&&bind(element,type,function ontype(ev){ev.preventDefault(),unbind(this,type,ontype)}),event.preventDefault=function(){prevents++,++prevents>0&&preventDefault.apply(this,[])},element.dispatchEvent(event),0>=prevents}try{window.event=event}catch(e){}return element.sourceIndex<=0||element.fireEvent&&element.fireEvent("on"+type,event)},create:{page:{event:function(type,options,element){var event,doc=syn.helpers.getWindow(element).document||document;if(doc.createEvent)return event=doc.createEvent("Events"),event.initEvent(type,!0,!0),event;try{event=createEventObject(type,options,element)}catch(e){}return event}},focus:{event:function(type,options,element){return syn.onParents(element,function(el){if(syn.isFocusable(el)){if("html"!==el.nodeName.toLowerCase())syn.__tryFocus(el),activeElement=el;else if(activeElement){var doc=syn.helpers.getWindow(element).document;if(doc!==window.document)return!1;doc.activeElement?(doc.activeElement.blur(),activeElement=null):(activeElement.blur(),activeElement=null)}return!1}}),!0}}},support:{clickChanges:!1,clickSubmits:!1,keypressSubmits:!1,mouseupSubmits:!1,radioClickChanges:!1,focusChanges:!1,linkHrefJS:!1,keyCharacters:!1,backspaceWorks:!1,mouseDownUpClicks:!1,tabKeyTabs:!1,keypressOnAnchorClicks:!1,optionClickBubbles:!1,ready:0},trigger:function(element,type,options){options||(options={});var event,ret,autoPrevent,create=syn.create,setup=create[type]&&create[type].setup,kind=key.test(type)?"key":page.test(type)?"page":"mouse",createType=create[type]||{},createKind=create[kind],dispatchEl=element;return 2===syn.support.ready&&setup&&setup(type,options,element),autoPrevent=options._autoPrevent,delete options._autoPrevent,createType.event?ret=createType.event(type,options,element):(options=createKind.options?createKind.options(type,options,element):options,!syn.support.changeBubbles&&/option/i.test(element.nodeName)&&(dispatchEl=element.parentNode),event=createKind.event(type,options,dispatchEl),ret=syn.dispatch(event,dispatchEl,type,autoPrevent)),ret&&2===syn.support.ready&&syn.defaults[type]&&syn.defaults[type].call(element,options,autoPrevent),ret},eventSupported:function(eventName){var el=document.createElement("div");eventName="on"+eventName;var isSupported=eventName in el;return isSupported||(el.setAttribute(eventName,"return;"),isSupported="function"==typeof el[eventName]),el=null,isSupported}}),extend(syn.init.prototype,{then:function(type,element,options,callback){syn.autoDelay&&this.delay();var args=syn.args(options,element,callback),self=this;return this.queue.unshift(function(el,prevented){return"function"!=typeof this[type]?(this.result=syn.trigger(args.element,type,args.options),args.callback&&args.callback.call(this,args.element,this.result),this):(this.element=args.element||el,void this[type](this.element,args.options,function(defaults,el){args.callback&&args.callback.apply(self,arguments),self.done.apply(self,arguments)}))}),this},delay:function(timeout,callback){"function"==typeof timeout&&(callback=timeout,timeout=null),timeout=timeout||600;var self=this;return this.queue.unshift(function(){schedule(function(){callback&&callback.apply(self,[]),self.done.apply(self,arguments)},timeout)}),this},done:function(defaults,el){el&&(this.element=el),this.queue.length&&this.queue.pop().call(this,this.element,defaults)},_click:function(element,options,callback,force){syn.helpers.addOffset(options,element),syn.trigger(element,"mousedown",options),schedule(function(){syn.trigger(element,"mouseup",options),!syn.support.mouseDownUpClicks||force?(syn.trigger(element,"click",options),callback(!0)):(syn.create.click.setup("click",options,element),syn.defaults.click.call(element),schedule(function(){callback(!0)},1))},1)},_rightClick:function(element,options,callback){syn.helpers.addOffset(options,element);var mouseopts=extend(extend({},syn.mouse.browser.right.mouseup),options);syn.trigger(element,"mousedown",mouseopts),schedule(function(){syn.trigger(element,"mouseup",mouseopts),syn.mouse.browser.right.contextmenu&&syn.trigger(element,"contextmenu",extend(extend({},syn.mouse.browser.right.contextmenu),options)),callback(!0)},1)},_dblclick:function(element,options,callback){syn.helpers.addOffset(options,element);var self=this;this._click(element,options,function(){schedule(function(){self._click(element,options,function(){syn.trigger(element,"dblclick",options),callback(!0)},!0)},2)})}});for(var actions=["click","dblclick","move","drag","key","type","rightClick"],makeAction=function(name){syn[name]=function(element,options,callback){return syn("_"+name,element,options,callback)},syn.init.prototype[name]=function(element,options,callback){return this.then("_"+name,element,options,callback)}},i=0;i<actions.length;i++)makeAction(actions[i]);module.exports=syn});