(function(b){function d(v){var u={};if(v.selectionStart===undefined){v.focus();var t=document.selection.createRange();u.length=t.text.length;t.moveStart("character",-v.value.length);u.end=t.text.length;u.start=u.end-u.length}else{u.start=v.selectionStart;u.end=v.selectionEnd;u.length=u.end-u.start}return u}function s(v,w,t){if(v.selectionStart===undefined){v.focus();var u=v.createTextRange();u.collapse(true);u.moveEnd("character",t);u.moveStart("character",w);u.select()}else{v.selectionStart=w;v.selectionEnd=t}}function i(u,t){b.each(t,function(v,w){if(typeof w==="function"){t[v]=w(u,t,v)}else{if(typeof u.autoNumeric[w]==="function"){t[v]=u.autoNumeric[w](u,t,v)}}})}function a(u,t){if(typeof(u[t])==="string"){u[t]*=1}}function r(x,w){i(x,w);w.oEvent=null;w.tagList=["DD","DT","H1","H2","H3","H4","H5","H6","LABEL","P","SPAN","TD","TH"];var A=w.vMax.toString().split("."),v=(!w.vMin&&w.vMin!==0)?[]:w.vMin.toString().split(".");a(w,"vMax");a(w,"vMin");a(w,"mDec");w.allowLeading=true;w.aNeg=w.vMin<0?"-":"";A[0]=A[0].replace("-","");v[0]=v[0].replace("-","");w.mInt=Math.max(A[0].length,v[0].length,1);if(w.mDec===null){var z=0,u=0;if(A[1]){z=A[1].length}if(v[1]){u=v[1].length}w.mDec=Math.max(z,u)}if(w.altDec===null&&w.mDec>0){if(w.aDec==="."&&w.aSep!==","){w.altDec=","}else{if(w.aDec===","&&w.aSep!=="."){w.altDec="."}}}var t=w.aNeg?"([-\\"+w.aNeg+"]?)":"(-?)";w.aNegRegAutoStrip=t;w.skipFirstAutoStrip=new RegExp(t+"[^-"+(w.aNeg?"\\"+w.aNeg:"")+"\\"+w.aDec+"\\d].*?(\\d|\\"+w.aDec+"\\d)");w.skipLastAutoStrip=new RegExp("(\\d\\"+w.aDec+"?)[^\\"+w.aDec+"\\d]\\D*$");var y="-"+w.aNum+"\\"+w.aDec;if(w.altDec&&w.altDec!==w.aSep){y+=w.altDec}w.allowedAutoStrip=new RegExp("[^"+y+"]","gi");w.numRegAutoStrip=new RegExp(t+"(?:\\"+w.aDec+"?(\\d+\\"+w.aDec+"\\d+)|(\\d*(?:\\"+w.aDec+"\\d*)?))");return w}function k(w,v,z){if(v.aSign){while(w.indexOf(v.aSign)>-1){w=w.replace(v.aSign,"")}}w=w.replace(v.skipFirstAutoStrip,"$1$2");w=w.replace(v.skipLastAutoStrip,"$1");w=w.replace(v.allowedAutoStrip,"");if(v.altDec){w=w.replace(v.altDec,v.aDec)}var t=w.match(v.numRegAutoStrip);w=t?[t[1],t[2],t[3]].join(""):"";if((v.lZero==="allow"||v.lZero==="keep")&&z!=="strip"){var x=[],y="";x=w.split(v.aDec);if(x[0].indexOf("-")!==-1){y="-";x[0]=x[0].replace("-","")}if(x[0].length>v.mInt&&x[0].charAt(0)==="0"){x[0]=x[0].slice(1)}w=y+x.join(v.aDec)}if((z&&v.lZero==="deny")||(z&&v.lZero==="allow"&&v.allowLeading===false)){var u="^"+v.aNegRegAutoStrip+"0*(\\d"+(z==="leading"?")":"|$)");u=new RegExp(u);w=w.replace(u,"$1$2")}return w}function c(u,v,t){v=v.split("");if(t==="set"||t==="focusout"){u=u.replace("-","");u=v[0]+u+v[1]}else{if((t==="get"||t==="focusin"||t==="pageLoad")&&u.charAt(0)===v[0]){u=u.replace(v[0],"-");u=u.replace(v[1],"")}}return u}function m(u,t,w){if(t&&w){var v=u.split(t);if(v[1]&&v[1].length>w){if(w>0){v[1]=v[1].substring(0,w);u=v.join(t)}else{u=v[0]}}}return u}function l(v,u,t){if(u&&u!=="."){v=v.replace(u,".")}if(t&&t!=="-"){v=v.replace(t,"-")}if(!v.match(/\d/)){v+="0"}return v}function h(v,u,t){if(t&&t!=="-"){v=v.replace("-",t)}if(u&&u!=="."){v=v.replace(".",u)}return v}function n(u,t){u=k(u,t);u=m(u,t.aDec,t.mDec);u=l(u,t.aDec,t.aNeg);var v=+u;if(t.oEvent==="set"&&(v<t.vMin||v>t.vMax)){b.error("The value ("+v+") from the 'set' method falls outside of the vMin / vMax range")}return v>=t.vMin&&v<=t.vMax}function p(u,v,t){if(u===""||u===v.aNeg){if(v.wEmpty==="zero"){return u+"0"}if(v.wEmpty==="sign"||t){return u+v.aSign}return u}return null}function e(v,z){v=k(v,z);var y=v,A=p(v,z,true);if(A!==null){return A}var t="";if(z.dGroup===2){t=/(\d)((\d)(\d{2}?)+)$/}else{if(z.dGroup===4){t=/(\d)((\d{4}?)+)$/}else{t=/(\d)((\d{3}?)+)$/}}var x=v.split(z.aDec);if(z.altDec&&x.length===1){x=v.split(z.altDec)}var w=x[0];if(z.aSep){while(t.test(w)){w=w.replace(t,"$1"+z.aSep+"$2")}}if(z.mDec!==0&&x.length>1){if(x[1].length>z.mDec){x[1]=x[1].substring(0,z.mDec)}v=w+z.aDec+x[1]}else{v=w}if(z.aSign){var u=v.indexOf(z.aNeg)!==-1;v=v.replace(z.aNeg,"");v=z.pSign==="p"?z.aSign+v:v+z.aSign;if(u){v=z.aNeg+v}}if(z.oEvent==="set"&&y<0&&z.nBracket!==null){v=c(v,z.nBracket,z.oEvent)}return v}function q(z,y){z=(z==="")?"0":z.toString();a(y,"mDec");var t="",C=0,H="",E=(typeof(y.aPad)==="boolean"||y.aPad===null)?(y.aPad?y.mDec:0):+y.aPad;var u=function(I){var J=E===0?(/(\.[1-9]*)0*$/):E===1?(/(\.\d[1-9]*)0*$/):new RegExp("(\\.\\d{"+E+"}[1-9]*)0*$");I=I.replace(J,"$1");if(E===0){I=I.replace(/\.$/,"")}return I};if(z.charAt(0)==="-"){H="-";z=z.replace("-","")}if(!z.match(/^\d/)){z="0"+z}if(H==="-"&&+z===0){H=""}if((+z>0&&y.lZero!=="keep")||(z.length>0&&y.lZero==="allow")){z=z.replace(/^0*(\d)/,"$1")}var F=z.lastIndexOf(".");var B=F===-1?z.length-1:F;var D=(z.length-1)-B;if(D<=y.mDec){t=z;if(D<E){if(F===-1){t+="."}while(D<E){var v="000000".substring(0,E-D);t+=v;D+=v.length}}else{if(D>E){t=u(t)}else{if(D===0&&E===0){t=t.replace(/\.$/,"")}}}return H+t}var w=F+y.mDec;var x=+z.charAt(w+1);var A=z.substring(0,w+1).split("");var G=(z.charAt(w)===".")?(z.charAt(w-1)%2):(z.charAt(w)%2);if((x>4&&y.mRound==="S")||(x>4&&y.mRound==="A"&&H==="")||(x>5&&y.mRound==="A"&&H==="-")||(x>5&&y.mRound==="s")||(x>5&&y.mRound==="a"&&H==="")||(x>4&&y.mRound==="a"&&H==="-")||(x>5&&y.mRound==="B")||(x===5&&y.mRound==="B"&&G===1)||(x>0&&y.mRound==="C"&&H==="")||(x>0&&y.mRound==="F"&&H==="-")||(x>0&&y.mRound==="U")){for(C=(A.length-1);C>=0;C-=1){if(A[C]!=="."){A[C]=+A[C]+1;if(A[C]<10){break}else{if(C>0){A[C]="0"}}}}}A=A.slice(0,w+1);t=u(A.join(""));return H+t}function j(u,t){this.settings=t;this.that=u;this.$that=b(u);this.formatted=false;this.settingsClone=r(this.$that,this.settings);this.value=u.value}j.prototype={init:function(t){this.value=this.that.value;this.settingsClone=r(this.$that,this.settings);this.ctrlKey=t.ctrlKey;this.cmdKey=t.metaKey;this.shiftKey=t.shiftKey;this.selection=d(this.that);if(t.type==="keydown"||t.type==="keyup"){this.kdCode=t.keyCode}this.which=t.which;this.processed=false;this.formatted=false},setSelection:function(v,t,u){v=Math.max(v,0);t=Math.min(t,this.that.value.length);this.selection={start:v,end:t,length:t-v};if(u===undefined||u){s(this.that,v,t)}},setPosition:function(u,t){this.setSelection(u,u,t)},getBeforeAfter:function(){var u=this.value;var v=u.substring(0,this.selection.start);var t=u.substring(this.selection.end,u.length);return[v,t]},getBeforeAfterStriped:function(){var t=this.getBeforeAfter();t[0]=k(t[0],this.settingsClone);t[1]=k(t[1],this.settingsClone);return t},normalizeParts:function(y,w){var u=this.settingsClone;w=k(w,u);var x=w.match(/^\d/)?true:"leading";y=k(y,u,x);if((y===""||y===u.aNeg)&&u.lZero==="deny"){if(w>""){w=w.replace(/^0*(\d)/,"$1")}}var v=y+w;if(u.aDec){var t=v.match(new RegExp("^"+u.aNegRegAutoStrip+"\\"+u.aDec));if(t){y=y.replace(t[1],t[1]+"0");v=y+w}}if(u.wEmpty==="zero"&&(v===u.aNeg||v==="")){y+="0"}return[y,w]},setValueParts:function(y,w){var u=this.settingsClone;var x=this.normalizeParts(y,w);var v=x.join("");var t=x[0].length;if(n(v,u)){v=m(v,u.aDec,u.mDec);if(t>v.length){t=v.length}this.value=v;this.setPosition(t,false);return true}return false},signPosition:function(){var u=this.settingsClone,x=u.aSign,w=this.that;if(x){var v=x.length;if(u.pSign==="p"){var y=u.aNeg&&w.value&&w.value.charAt(0)===u.aNeg;return y?[1,v+1]:[0,v]}var t=w.value.length;return[t-v,t]}return[1000,-1]},expandSelectionOnSign:function(u){var t=this.signPosition();var v=this.selection;if(v.start<t[1]&&v.end>t[0]){if((v.start<t[0]||v.end>t[1])&&this.value.substring(Math.max(v.start,t[0]),Math.min(v.end,t[1])).match(/^\s*$/)){if(v.start<t[0]){this.setSelection(v.start,t[0],u)}else{this.setSelection(t[1],v.end,u)}}else{this.setSelection(Math.min(v.start,t[0]),Math.max(v.end,t[1]),u)}}},checkPaste:function(){if(this.valuePartsBeforePaste!==undefined){var u=this.getBeforeAfter();var t=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste;u[0]=u[0].substr(0,t[0].length)+k(u[0].substr(t[0].length),this.settingsClone);if(!this.setValueParts(u[0],u[1])){this.value=t.join("");this.setPosition(t[0].length,false)}}},skipAllways:function(x){var t=this.kdCode,z=this.which,y=this.ctrlKey,u=this.cmdKey;if(t===17&&x.type==="keyup"&&this.valuePartsBeforePaste!==undefined){this.checkPaste();return false}if((t>=112&&t<=123)||(t>=91&&t<=93)||(t>=9&&t<=31)||(t<8&&(z===0||z===t))||t===144||t===145||t===45){return true}if((y||u)&&t===65){return true}if((y||u)&&(t===67||t===86||t===88)){if(x.type==="keydown"){this.expandSelectionOnSign()}if(t===86){if(x.type==="keydown"||x.type==="keypress"){if(this.valuePartsBeforePaste===undefined){this.valuePartsBeforePaste=this.getBeforeAfter()}}else{this.checkPaste()}}return x.type==="keydown"||x.type==="keypress"||t===67}if(y||u){return true}if(t===37||t===39){var v=this.settingsClone.aSep,A=this.selection.start,w=this.that.value;if(x.type==="keydown"&&v&&!this.shiftKey){if(t===37&&w.charAt(A-2)===v){this.setPosition(A-1)}else{if(t===39&&w.charAt(A)===v){this.setPosition(A+1)}}}return true}if(t>=34&&t<=40){return true}return false},processAllways:function(){var t;if(this.kdCode===8||this.kdCode===46){if(!this.selection.length){t=this.getBeforeAfterStriped();if(this.kdCode===8){t[0]=t[0].substring(0,t[0].length-1)}else{t[1]=t[1].substring(1,t[1].length)}this.setValueParts(t[0],t[1])}else{this.expandSelectionOnSign(false);t=this.getBeforeAfterStriped();this.setValueParts(t[0],t[1])}return true}return false},processKeypress:function(){var t=this.settingsClone;var u=String.fromCharCode(this.which);var x=this.getBeforeAfterStriped();var w=x[0],v=x[1];if(u===t.aDec||(t.altDec&&u===t.altDec)||((u==="."||u===",")&&this.kdCode===110)){if(!t.mDec||!t.aDec){return true}if(t.aNeg&&v.indexOf(t.aNeg)>-1){return true}if(w.indexOf(t.aDec)>-1){return true}if(v.indexOf(t.aDec)>0){return true}if(v.indexOf(t.aDec)===0){v=v.substr(1)}this.setValueParts(w+t.aDec,v);return true}if(u==="-"||u==="+"){if(!t.aNeg){return true}if(w===""&&v.indexOf(t.aNeg)>-1){w=t.aNeg;v=v.substring(1,v.length)}if(w.charAt(0)===t.aNeg){w=w.substring(1,w.length)}else{w=(u==="-")?t.aNeg+w:w}this.setValueParts(w,v);return true}if(u>="0"&&u<="9"){if(t.aNeg&&w===""&&v.indexOf(t.aNeg)>-1){w=t.aNeg;v=v.substring(1,v.length)}this.setValueParts(w+u,v);return true}return true},formatQuick:function(){var B=this.settingsClone;var u=this.getBeforeAfterStriped();var C=this.value;if((B.aSep===""||(B.aSep!==""&&C.indexOf(B.aSep)===-1))&&(B.aSign===""||(B.aSign!==""&&C.indexOf(B.aSign)===-1))){var t=[],D="";t=C.split(B.aDec);if(t[0].indexOf("-")>-1){D="-";t[0]=t[0].replace("-","");u[0]=u[0].replace("-","")}if(t[0].length>B.mInt&&u[0].charAt(0)==="0"){u[0]=u[0].slice(1)}u[0]=D+u[0]}var A=e(this.value,this.settingsClone);var w=A.length;if(A){var x=u[0].split("");var v=0;for(v;v<x.length;v+=1){if(!x[v].match("\\d")){x[v]="\\"+x[v]}}var y=new RegExp("^.*?"+x.join(".*?"));var z=A.match(y);if(z){w=z[0].length;if(((w===0&&A.charAt(0)!==B.aNeg)||(w===1&&A.charAt(0)===B.aNeg))&&B.aSign&&B.pSign==="p"){w=this.settingsClone.aSign.length+(A.charAt(0)==="-"?1:0)}}else{if(B.aSign&&B.pSign==="s"){w-=B.aSign.length}}}this.that.value=A;this.setPosition(w);this.formatted=true}};function f(t){if(typeof t==="string"){t=t.replace(/\[/g,"\\[").replace(/\]/g,"\\]");t="#"+t.replace(/(:|\.)/g,"\\$1")}return b(t)}function g(t,v){var w=t.data("autoNumeric");if(!w){w={};t.data("autoNumeric",w)}var u=w.holder;if(u===undefined&&v){u=new j(t.get(0),v);w.holder=u}return u}var o={init:function(t){return this.each(function(){var y=b(this);var v=y.data("autoNumeric");var x=y.data();if(typeof v!=="object"){var w={aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",altDec:null,aSign:"",pSign:"p",vMax:"999999999.99",vMin:"0.00",mDec:null,mRound:"S",aPad:true,nBracket:null,wEmpty:"empty",lZero:"allow",aForm:true,onSomeEvent:function(){}};v=b.extend({},w,x,t);if(v.aDec===v.aSep){b.error("autoNumeric will not function properly when the decimal character aDec: '"+v.aDec+"' and thousand seperater aSep: '"+v.aSep+"' are the same character");return this}if(b.inArray(y.prop("tagName"),v.tagList)!==-1){b.error("The <"+y.prop("tagName")+"> is not supported by autoNumeric()");return this}y.data("autoNumeric",v)}else{b.error("autoNumeric has already been initialized. If you are trying to pass options please use the 'update' method");return this}var u=g(y,v);if(v.runOnce===undefined&&v.aForm&&(y[0].value||y.text()!==""||v.wEmpty!=="empty")){if(y.is("input[type=text], input:not([type])")){if(v.nBracket!==null&&(y[0].value||v.wEmpty!=="empty")){v.oEvent="pageLoad";y[0].value=c(y[0].value,v.nBracket,v.oEvent);y[0].value=k(y[0].value,v)}y.autoNumeric("set",y.val())}if(b.inArray(y.prop("tagName"),v.tagList)!==-1){y.autoNumeric("set",y.text())}}v.runOnce=true;if(y.is("input[type=text], input:not([type])")&&!y.is("[readonly]")){y.bind("keydown.autoNumeric",function(z){u=g(y);if(u.settings.aDec===u.settings.aSep){b.error("autoNumeric will not function properly when the decimal character aDec: '"+u.settings.aDec+"' and thousand seperater aSep: '"+u.settings.aSep+"' are the same character");return this}u.init(z);u.settings.oEvent="keydown";if(u.skipAllways(z)){u.processed=true;return true}if(u.processAllways()){u.processed=true;u.formatQuick();z.preventDefault();return false}u.formatted=false;return true});y.bind("keypress.autoNumeric",function(A){var z=g(y),B=z.processed;z.init(A);z.settings.oEvent="keypress";if(z.skipAllways(A)){return true}if(B){A.preventDefault();return false}if(z.processAllways()||z.processKeypress()){z.formatQuick();A.preventDefault();return false}z.formatted=false});y.bind("keyup.autoNumeric",function(B){var z=g(y);z.init(B);z.settings.oEvent="keyup";var A=z.skipAllways(B);z.kdCode=0;delete z.valuePartsBeforePaste;if(A){return true}if(this.value===""){return true}if(!z.formatted){z.formatQuick()}});y.bind("focusin.autoNumeric",function(){var A=g(y);A.settingsClone.oEvent="focusin";if(A.settingsClone.nBracket!==null){var B=y.val();y.val(c(B,A.settingsClone.nBracket,A.settingsClone.oEvent))}A.inVal=y.val();var z=p(A.inVal,A.settingsClone,true);if(z!==null){y.val(z)}});y.bind("focusout.autoNumeric",function(){var B=g(y),A=B.settingsClone,D=y.val(),z=D;B.settingsClone.oEvent="focusout";var E="";if(A.lZero==="allow"){A.allowLeading=false;E="leading"}if(D!==""){D=k(D,A,E);if(p(D,A)===null&&n(D,A,y[0])){D=l(D,A.aDec,A.aNeg);D=q(D,A);D=h(D,A.aDec,A.aNeg)}else{D=""}}var C=p(D,A,false);if(C===null){C=e(D,A)}if(C!==z){y.val(C)}if(C!==B.inVal){y.change();delete B.inVal}if(A.nBracket!==null&&y.autoNumeric("get")<0){B.settingsClone.oEvent="focusout";y.val(c(y.val(),A.nBracket,A.oEvent))}})}else{if(y.is("input[type=text], input:not([type])")&&y.is("[readonly]")){this.blur()}}})},destroy:function(){return b(this).each(function(){var t=b(this);t.unbind(".autoNumeric");t.removeData("autoNumeric")})},update:function(t){return b(this).each(function(){var w=f(b(this)),v=w.data("autoNumeric");if(typeof v!=="object"){b.error("You must initialize autoNumeric('init', {options}) prior to calling the 'update' method");return this}var u=w.autoNumeric("get");v=b.extend(v,t);if(v.aDec===v.aSep){b.error("autoNumeric will not function properly when the decimal character aDec: '"+v.aDec+"' and thousand seperater aSep: '"+v.aSep+"' are the same character");return this}w.data("autoNumeric",v);if(w.val()!==""||w.text()!==""){return w.autoNumeric("set",u)}return})},set:function(t){return b(this).each(function(){var w=f(b(this)),u=w.data("autoNumeric"),v=t;if(v<0.000001&&v>0){v=(v+1).toString();v=v.substring(1)}if(v<0&&v>-1){v=(v-1).toString();v="-"+v.substring(2)}u.oEvent="set";if(typeof u!=="object"){b.error("You must initialize autoNumeric('init', {options}) prior to calling the 'set' method");return this}v.toString();v=q(v,u);v=h(v,u.aDec,u.aNeg);if(!n(v,u)){v=q("",u)}v=e(v,u);if(w.is("input[type=text], input:not([type])")){return w.val(v)}if(b.inArray(w.prop("tagName"),u.tagList)!==-1){return w.text(v)}b.error("The <"+w.prop("tagName")+"> is not supported by autoNumeric()");return false})},get:function(){var v=f(b(this)),u=v.data("autoNumeric");u.oEvent="get";if(typeof u!=="object"){b.error("You must initialize autoNumeric('init', {options}) prior to calling the 'get' method");return this}var t="";if(v.is("input[type=text], input:not([type])")){t=v.eq(0).val()}else{if(b.inArray(v.prop("tagName"),u.tagList)!==-1){t=v.eq(0).text()}else{b.error("The <"+v.prop("tagName")+"> is not supported by autoNumeric()");return false}}if(t===""&&u.wEmpty==="empty"){return t}if(u.nBracket!==null&&t!==""){t=c(t,u.nBracket,u.oEvent)}if(u.runOnce||u.aForm===false){t=k(t,u)}t=l(t,u.aDec,u.aNeg);if(+t===0&&u.lZero!=="keep"){t="0"}if(u.lZero==="keep"){return t}return +t},getString:function(){var v=false,x=f(b(this)),z=x.serialize(),w=z.split("&"),t=0;for(t;t<w.length;t+=1){var y=w[t].split("=");var u=b("input:text[name="+y[0]+"]").data("autoNumeric");if(typeof u==="object"){if(y[1]!==""){y[1]=b("input[name="+y[0]+"]").autoNumeric("get");w[t]=y.join("=")}else{w[t]=y.join("=")}v=true}}if(v===true){return w.join("&")}b.error("You must initialize autoNumeric('init', {options}) prior to calling the 'getString' method");return this},getArray:function(){var u=false,v=f(b(this)),t=v.serializeArray();b.each(t,function(w,y){var x=b("input:text[name="+y.name+"]").data("autoNumeric");if(typeof x==="object"){if(y.value!==""){y.value=b("input[name="+y.name+"]").autoNumeric("get").toString()}u=true}});if(u===true){return t}b.error("You must initialize autoNumeric('init', {options}) prior to calling the 'getArray' method");return this},getSettings:function(){var t=f(b(this));return t.eq(0).data("autoNumeric")}};b.fn.autoNumeric=function(t){if(o[t]){return o[t].apply(this,Array.prototype.slice.call(arguments,1))}if(typeof t==="object"||!t){return o.init.apply(this,arguments)}b.error('Method "'+t+'" is not supported by autoNumeric()')}}(jQuery));